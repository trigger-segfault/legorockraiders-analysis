#include "source.h"
#include "datatypes.h"
#include "functypes.h"
#include "globals.h"


void __cdecl lego::main::Main_InitAdvisors(char *keyBasePath,Struct_bc *structbc,undefined4 ptr_1c)
{
	globals::g_Advisors_TABLE[0] = "Advisor_Objective";
	globals::g_Advisors_TABLE[1] = "Advisor_ObjectiveAcheived";
	globals::g_Advisors_TABLE[2] = "Advisor_ObjectiveFailed";
	globals::g_Advisors_TABLE[3] = "Advisor_IconPoint_Normal";
	globals::g_Advisors_TABLE[4] = "Advisor_IconPoint_BackButton";
	globals::g_Advisors_TABLE[5] = "Advisor_IconPoint_TopButtons";
	globals::g_Advisors_TABLE[6] = "Advisor_PanelPoint_RadarToggle";
	globals::g_Advisors_TABLE[7] = "Advisor_PanelPoint_RadarTaggedObjectView";
	globals::g_Advisors_TABLE[8] = "Advisor_PanelPoint_RadarZoomIn";
	globals::g_Advisors_TABLE[9] = "Advisor_PanelPoint_RadarZoomOut";
	globals::g_Advisors_TABLE[10] = "Advisor_PanelPoint_RadarMapView";
	globals::g_Advisors_TABLE[11] = "Advisor_PanelPoint_InfoDockGoto";
	globals::g_Advisors_TABLE[12] = "Advisor_PanelPoint_InfoDockClose";
	globals::g_Advisors_TABLE[13] = "Advisor_PanelPoint_TopPanelInfo";
	globals::g_Advisors_TABLE[14] = "Advisor_PanelPoint_TopPanelOptions";
	globals::g_Advisors_TABLE[15] = "Advisor_PanelPoint_TopPanelPriorities";
	globals::g_Advisors_TABLE[16] = "Advisor_PanelPoint_TopPanelCallToArms";
	globals::g_Advisors_TABLE[17] = "Advisor_PanelPoint_TopPanelGoBack";
	globals::g_Advisors_TABLE[18] = "Advisor_PanelPoint_ControlZoomIn";
	globals::g_Advisors_TABLE[19] = "Advisor_PanelPoint_ControlZoomOut";
	globals::g_Advisors_TABLE[20] = "Advisor_TalkInGame";
	globals::g_AdvisorAnims_TABLE[0] = "Advisor_Anim_PointToMap";
	globals::g_AdvisorAnims_TABLE[1] = "Advisor_Anim_Point_N";
	globals::g_AdvisorAnims_TABLE[2] = "Advisor_Anim_Point_NE";
	globals::g_AdvisorAnims_TABLE[3] = "Advisor_Anim_Point_E";
	globals::g_AdvisorAnims_TABLE[4] = "Advisor_Anim_Point_SE";
	globals::g_AdvisorAnims_TABLE[5] = "Advisor_Anim_Point_S";
	globals::g_AdvisorAnims_TABLE[6] = "Advisor_Anim_Point_SW";
	globals::g_AdvisorAnims_TABLE[7] = "Advisor_Anim_Point_W";
	globals::g_AdvisorAnims_TABLE[8] = "Advisor_Anim_Point_NW";
	globals::g_AdvisorAnims_TABLE[9] = "Advisor_Anim_Point_Up";
	globals::g_AdvisorAnims_TABLE[10] = "Advisor_Anim_Talk_Top";
	globals::g_AdvisorAnims_ResRoot = structbc->resData_24;
	DAT_004b41b0 = ptr_1c;
	ResourceData_004b41b8 =
			 res::Res_CreateLight(structbc->resData_24,D3DRMLIGHT_DIRECTIONAL,1.0,1.0,1.0);
	res::Res_SetFrameOrientation(ResourceData_004b41b8,structbc->resData_24,0.0,0.0,-1.0,0.0,1.0,0.0);
	res::Res_UnkSetup3DFrameTransform(ResourceData_004b41b8,1);
	FLAGS_004b41bc = 0;
	return;
}



void __cdecl FUN_004011c0(void)
{
	if (lego::globals::g_AdvisorAnimsData_TABLE[*(int *)(&DAT_004b3e04 + DAT_004b41a8 * 0x24)].resData
			!= NULL) {
		lego::res::Res_UnkSetup3DFrameTransform
							(lego::globals::g_AdvisorAnimsData_TABLE
							 [*(int *)(&DAT_004b3e04 + DAT_004b41a8 * 0x24)].resData,1);
	}
	FLAGS_004b41bc &= 0xfffffffe;
	lego::res::Res_UnkSetup3DFrameTransform(ResourceData_004b41b8,1);
	return;
}



void __cdecl FUN_00401210(float param_1)
{
	FUN_00477290(DAT_004b41b0);
	FUN_004772b0(DAT_004b41b0);
	FLOAT_004b41b4 = 0.96;
	return;
}



// sqrt(((a.x - b.x)*(a.x - b.x)) + ((a.y - b.y)*(a.y - b.y)))

float10 __cdecl lego::math::Vector2_Distance(Point2F *a,Point2F *b)
{
	float10 fVar1;
	float10 fVar2;
	
	fVar1 = (float10)a->y - (float10)b->y;
	fVar2 = (float10)a->x - (float10)b->x;
	return SQRT(fVar2 * fVar2 + fVar1 * (float10)(float)fVar1);
}



void __cdecl lego::main::Main_LoadAdvisorAnims(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	ResourceData *resData1;
	char **ppcVar2;
	AdvisorAnimData *pAVar3;
	float10 fVar4;
	char *local_54;
	char *local_50;
	char *local_4c;
	char local_40 [64];
	
	pAVar3 = globals::g_AdvisorAnimsData_TABLE;
	ppcVar2 = globals::g_AdvisorAnims_TABLE;
	do {
		pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Advisor",*ppcVar2,0);
		pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
		if (pcVar1 == NULL) {
			if ((globals::g_CMDLINE_FLAGS & CMD_REDUCEANIMATION) == CMD_NONE) {
				std::sprintf(local_40,"!%s",*ppcVar2);
				pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Advisor",*ppcVar2,0);
				pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			}
			if (pcVar1 != NULL) goto LAB_004012f0;
		}
		else {
LAB_004012f0:
			util::stringSplit(pcVar1,&local_54,",");
			resData1 = res::Res_LoadResource(globals::g_AdvisorAnims_ResRoot,local_54,"LWS",1);
			pAVar3->resData = resData1;
			if (resData1 != NULL) {
				res::Res_SetFrameOrientation
									(resData1,globals::g_AdvisorAnims_ResRoot,0.0,0.0,1.0,0.0,1.0,0.0);
				res::Res_UnkSetup3DFrameTransform(pAVar3->resData,1);
			}
			fVar4 = std::atof(local_50);
			pAVar3->loopStartTime = (float)(fVar4 * (float10)25.0);
			fVar4 = std::atof(local_4c);
			pAVar3->loopEndTime = (float)(fVar4 * (float10)25.0);
		}
		ppcVar2 = ppcVar2 + 1;
		pAVar3 = pAVar3 + 1;
		if ((char **)((int)globals::g_AdvisorAnims_TABLE + 0x2b) < ppcVar2) {
			return;
		}
	} while( true );
}



BOOL __cdecl lego::game::Game_GetAdvisor(char *advisorName,int *out_index)
{
	int iVar1;
	char **ppcVar2;
	int iVar3;
	
	iVar3 = 0;
	ppcVar2 = globals::g_Advisors_TABLE;
	do {
		iVar1 = std::_stricmp(*ppcVar2,advisorName);
		if (iVar1 == 0) {
			*out_index = iVar3;
			return 1;
		}
		ppcVar2 = ppcVar2 + 1;
		iVar3 += 1;
	} while (ppcVar2 < &DAT_004b3e04);
	return 0;
}



// out_vector = { (a.y * b.z) - (a.z * b.y),
//                (a.z * b.x) - (a.x * b.z),
//                (a.x * b.y) - (a.y * b.x) }

Vector3F * __cdecl lego::math::Vector3_CrossProduct(Vector3F *out_vector,Vector3F *a,Vector3F *b)
{
	out_vector->x = b->z * a->y - a->z * b->y;
	out_vector->y = a->z * b->x - b->z * a->x;
	out_vector->z = b->y * a->x - a->y * b->x;
	return out_vector;
}



BOOL __cdecl lego::res::Res_GetAdvisorResource(char *advisorName,int *out_index)
{
	int iVar1;
	char **ppcVar2;
	int iVar3;
	
	iVar3 = 0;
	ppcVar2 = globals::g_AdvisorAnims_TABLE;
	do {
		iVar1 = std::_stricmp((char *)*(ResourceData **)ppcVar2,advisorName);
		if (iVar1 == 0) {
			*out_index = iVar3;
			return 1;
		}
		ppcVar2 = (char **)((int)ppcVar2 + 4);
		iVar3 += 1;
	} while (ppcVar2 < globals::g_AdvisorAnimsData_TABLE);
	return 0;
}



// out_vector = a + b

Vector3F * __cdecl lego::math::Vector3_Add(Vector3F *out_vector,Vector3F *a,Vector3F *b)
{
	out_vector->x = b->x + a->x;
	out_vector->y = a->y + b->y;
	out_vector->z = a->z + b->z;
	return out_vector;
}



void __cdecl
lego::main::Main_LoadAdvisorPositions
					(CFGProperty *root,char *keyBasePath,int screenWidth,int screenHeight)
{
	char *keyPath;
	CFGProperty *prop;
	BOOL BVar1;
	int iVar2;
	float10 fVar3;
	int local_c4;
	int local_c0;
	int local_bc;
	float local_b8;
	float local_b4;
	int local_b0;
	int advisorIndex;
	char *stringParts [6];
	char advisorKeyPath [128];
	
	std::sprintf(advisorKeyPath,"AdvisorPositions%ix%i",screenWidth,screenHeight);
	keyPath = cfg::CFG_JoinPath(keyBasePath,advisorKeyPath,0);
	for (prop = cfg::CFG_GetBlockFirstChild(root,keyPath); prop != NULL;
			prop = cfg::CFG_NextFlatProperty(prop)) {
		local_c0 = 0x1a;
										// 12 is the number of panels, which means 12 is treated as invalid (NULL?)
		local_c4 = 12;
		BVar1 = game::Game_GetAdvisor(prop->key,&advisorIndex);
		if (BVar1 != 0) {
			util::stringSplit(prop->value,stringParts,",");
			BVar1 = res::Res_GetAdvisorResource(stringParts[0],&local_bc);
			if ((BVar1 != 0) &&
				 (((iVar2 = std::_stricmp("NULL",stringParts[1]), iVar2 == 0 ||
					 (BVar1 = unk::Lego_GetTexts(stringParts[1],&local_c0), BVar1 != 0)) &&
					(BVar1 = snd::Snd_GetSFX(stringParts[2],&local_b0), BVar1 != 0)))) {
				fVar3 = std::atof(stringParts[3]);
				local_b8 = (float)fVar3;
				fVar3 = std::atof(stringParts[4]);
				local_b4 = (float)fVar3;
				iVar2 = std::_stricmp("NULL",stringParts[5]);
				if ((iVar2 == 0) || (BVar1 = game::Game_GetPanel(stringParts[5],&local_c4), BVar1 != 0)) {
					res::Res_AddAdvisorPosition
										(advisorIndex,local_bc,local_c0,local_b0,local_c4,local_b8,local_b4);
				}
			}
		}
	}
	return;
}



// out_vector = a - b

Vector3F * __cdecl lego::math::Vector3_Subtract(Vector3F *out_vector,Vector3F *a,Vector3F *b)
{
	out_vector->x = a->x - b->x;
	out_vector->y = a->y - b->y;
	out_vector->z = a->z - b->z;
	return out_vector;
}



// out_vector = a * scalar

Vector3F * __cdecl lego::math::Vector3_Scale(Vector3F *out_vector,Vector3F *a,float scalar)
{
	out_vector->x = scalar * a->x;
	out_vector->y = a->y * scalar;
	out_vector->z = a->z * scalar;
	return out_vector;
}



// ref_vector = ref_vector * (1.0 / modulus(ref_vector))
// REFERENCE: modulus(ref_vector) -> sqrt(dot_product(ref_vector, ref_vector))

Vector3F * __cdecl lego::math::Vector3_Normalize(Vector3F *ref_vector)
{
	float fVar1;
	
										// Vector3_Modulus (without 1.0 / _)
	fVar1 = 1.0 / SQRT(ref_vector->x * ref_vector->x +
										 ref_vector->z * ref_vector->z + ref_vector->y * ref_vector->y);
	ref_vector->x = fVar1 * ref_vector->x;
	ref_vector->y = fVar1 * ref_vector->y;
	ref_vector->z = fVar1 * ref_vector->z;
	return ref_vector;
}



void __cdecl
lego::res::Res_AddAdvisorPosition
					(int param_1,undefined4 param_2,int param_3,undefined4 param_4,int param_5,
					undefined4 param_6,undefined4 param_7)
{
	int iVar1;
	
	iVar1 = param_1 * 0x24;
	*(undefined4 *)(&DAT_004b3e24 + iVar1) = 0x20000;
	*(undefined4 *)(&DAT_004b3e04 + iVar1) = param_2;
	*(int *)(&DAT_004b3e08 + iVar1) = param_3;
	*(undefined4 *)(&DAT_004b3e0c + iVar1) = param_4;
	*(undefined4 *)(&DAT_004b3e14 + iVar1) = param_6;
	*(undefined4 *)(&DAT_004b3e18 + iVar1) = param_7;
	*(undefined4 *)(&DAT_004b3e1c + iVar1) = param_6;
	*(undefined4 *)(&DAT_004b3e20 + iVar1) = param_7;
	*(int *)(&DAT_004b3e10 + iVar1) = param_5;
	if (param_5 == 0xc) {
		*(uint *)(&DAT_004b3e24 + iVar1) = *(uint *)(&DAT_004b3e24 + iVar1) | 0x10000;
	}
	if (param_3 != 0x1a) {
		*(uint *)(&DAT_004b3e24 + iVar1) = *(uint *)(&DAT_004b3e24 + iVar1) | 0x40000;
	}
	return;
}



void __cdecl FUN_00401780(int param_1,int param_2,undefined4 param_3,undefined4 param_4)
{
	int iVar1;
	
	iVar1 = param_1 * 0x24;
	*(undefined4 *)(&DAT_004b3e14 + iVar1) = param_3;
	*(undefined4 *)(&DAT_004b3e18 + iVar1) = param_4;
	*(int *)(&DAT_004b3e10 + iVar1) = param_2;
	if (param_2 == 0xc) {
		*(uint *)(&DAT_004b3e24 + iVar1) = *(uint *)(&DAT_004b3e24 + iVar1) | 0x10000;
		return;
	}
	*(uint *)(&DAT_004b3e24 + iVar1) = *(uint *)(&DAT_004b3e24 + iVar1) & 0xfffeffff;
	return;
}



void __cdecl FUN_004017d0(int param_1,undefined4 *param_2,undefined4 *param_3)
{
	*param_2 = *(undefined4 *)(&DAT_004b3e1c + param_1 * 0x24);
	*param_3 = *(undefined4 *)(&DAT_004b3e20 + param_1 * 0x24);
	return;
}



BOOL __cdecl FUN_00401800(int param_1,int param_2)
{
	if ((((*(uint *)(&DAT_004b3e24 + param_1 * 0x24) & 0x20000) != 0) &&
			(lego::globals::g_Game.unkbool_308 != 0)) && ((FLAGS_004b41bc & 1) == 0)) {
		DAT_004b41a8 = param_1;
		FUN_00401870(param_1);
		if (param_2 != 0) {
			FLAGS_004b41bc = FLAGS_004b41bc | 3;
			return 1;
		}
		FLAGS_004b41bc = FLAGS_004b41bc & 0xfffffffd | 1;
		return 1;
	}
	return 0;
}



void __cdecl FUN_00401870(int param_1)
{
	ResourceData *resData;
	
	resData = lego::globals::g_AdvisorAnimsData_TABLE[*(int *)(&DAT_004b3e04 + param_1 * 0x24)].
						resData;
	if (resData != NULL) {
		lego::res::Res_UnkSetup3DFrameTransform(resData,0);
		lego::res::Res_DoCallbacks(resData,0.0);
		lego::snd::Snd_Play_FUN_00465260(*(int *)(&DAT_004b3e0c + param_1 * 0x24),0);
		lego::snd::Audio_AddToSoundQueue1(0x2a,0);
	}
	return;
}



void __cdecl FUN_004018d0(float param_1)
{
	ResourceData *resData;
	float fVar1;
	BOOL BVar2;
	int iVar3;
	
	fVar1 = DAT_004b41a8;
	iVar3 = (int)DAT_004b41a8 * 0x24;
	resData = lego::globals::g_AdvisorAnimsData_TABLE[*(int *)(&DAT_004b3e04 + iVar3)].resData;
	if (resData != NULL) {
		if (((FLAGS_004b41bc & 1) != 0) && (lego::globals::g_Game.unkbool_308 != 0)) {
			if ((*(uint *)(&DAT_004b3e24 + iVar3) & 0x40000) != 0) {
				lego::front::Text_DisplayType(*(TextType *)(&DAT_004b3e08 + iVar3),1,0);
			}
			lego::res::Res_UnkSetup3DFrameTransform(resData,0);
			lego::res::Res_UnkSetup3DFrameTransform(ResourceData_004b41b8,0);
			FUN_00473780(ResourceData_004b41b8,(undefined **)resData);
			FUN_00401a70(fVar1);
			BVar2 = FUN_004019b0(*(int *)(&DAT_004b3e04 + iVar3),param_1);
			if (BVar2 != 0) {
				return;
			}
			FLAGS_004b41bc &= 0xfffffffe;
		}
		lego::res::Res_UnkSetup3DFrameTransform(resData,1);
	}
	lego::res::Res_UnkSetup3DFrameTransform(ResourceData_004b41b8,1);
	return;
}



BOOL __cdecl FUN_004019b0(int param_1,float param_2)
{
	ResourceData *resData;
	float10 fVar1;
	
	resData = lego::globals::g_AdvisorAnimsData_TABLE[param_1].resData;
	fVar1 = lego::res::Res_DoAnimElapsedCallbacks(resData,param_2);
	if (((byte)FLAGS_004b41bc & 2) == 0) {
		if ((ushort)((ushort)(fVar1 < (float10)0.0) << 8 | (ushort)(fVar1 == (float10)0.0) << 0xe) == 0)
		{
			return 0;
		}
	}
	else {
		if ((ushort)((ushort)(fVar1 < (float10)0.0) << 8 | (ushort)(fVar1 == (float10)0.0) << 0xe) == 0)
		{
			lego::res::Res_DoCallbacks
								(resData,(float)((float10)lego::globals::g_AdvisorAnimsData_TABLE[param_1].
																					loopStartTime + fVar1));
			return 1;
		}
		fVar1 = lego::res::Res_GetAnimFloat10(resData);
		if ((float10)lego::globals::g_AdvisorAnimsData_TABLE[param_1].loopEndTime <= fVar1) {
			lego::res::Res_DoCallbacks
								(resData,(float)((fVar1 - (float10)lego::globals::g_AdvisorAnimsData_TABLE[param_1].
																									 loopEndTime) +
																(float10)lego::globals::g_AdvisorAnimsData_TABLE[param_1].
																				 loopStartTime));
			return 1;
		}
	}
	return 1;
}



void __cdecl lego::unk::Lego_ClearFlag2__004b41bc(void)
{
	FLAGS_004b41bc = FLAGS_004b41bc & 0xfffffffd;
	return;
}



void __cdecl FUN_00401a70(float param_1)
{
	ResourceData *resData1;
	int iVar1;
	float local_20;
	float local_1c;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	undefined4 local_4;
	
	iVar1 = (int)param_1 * 0x24;
	resData1 = lego::globals::g_AdvisorAnimsData_TABLE[*(int *)(&DAT_004b3e04 + iVar1)].resData;
	if ((*(uint *)(&DAT_004b3e24 + iVar1) & 0x10000) == 0) {
		FUN_0045a9c0(*(int *)(&DAT_004b3e10 + iVar1),&param_1,&local_20);
	}
	else {
		param_1 = 0.0;
		local_20 = 0.0;
	}
	local_10 = *(float *)(&DAT_004b3e14 + iVar1) + param_1;
	local_8 = FLOAT_004b41b4;
	local_c = *(float *)(&DAT_004b3e18 + iVar1) + local_20;
	local_4 = 0x3f800000;
	FUN_00477550(DAT_004b41b0,&local_1c,&local_10);
	lego::res::Res_SetFramePosition(resData1,NULL,local_1c,local_18,local_14);
	return;
}



ProgrammerMode __cdecl lego::main::Config_GetProgrammerMode(void)
{
	return globals::g_PROGRAMMER_MODE;
}



char * __cdecl lego::game::Game_GetStartLevel(void)
{
	return (char *)(-(uint)((globals::g_CMDLINE_FLAGS & CMD_STARTLEVEL) != CMD_NONE) & 0x506f8c);
}



uint __cdecl lego::unk::Lego_GetFlag1__004b41bc(void)
{
	return FLAGS_004b41bc & 1;
}



int __cdecl lego::main::Config_GetResolutionWidth(void)
{
	return globals::g_RESOLUTION.width;
}



int __cdecl lego::main::Config_GetResolutionHeight(void)
{
	return globals::g_RESOLUTION.height;
}



ImageFont * __cdecl FUN_00401b90(ImageFont *font,char *format,...)
{
	FUN_0047a410(font,(uint *)&font,NULL,(byte *)format,(undefined4 *)&stack0x0000000c);
	return font;
}



void __cdecl FUN_00401bc0(ImageFont *param_1,uint *param_2,int *param_3,byte *param_4,...)
{
	FUN_0047a410(param_1,param_2,param_3,param_4,(undefined4 *)&stack0x00000014);
	return;
}



int __cdecl lego::game::Game_GetAIPriority(char *aiPriorityName,int *out_index)
{
	int iVar1;
	char **ppcVar2;
	int iVar3;
	
	iVar3 = 0;
	ppcVar2 = globals::g_AIPriorities_TABLE;
	do {
		iVar1 = std::_stricmp(aiPriorityName,*ppcVar2);
		if (iVar1 == 0) {
			*out_index = iVar3;
			return 1;
		}
		ppcVar2 = ppcVar2 + 1;
		iVar3 += 1;
	} while (ppcVar2 < globals::g_AIPriorityValues_TABLE);
	return 0;
}



void __cdecl lego::pool::ReservedPool_AITask___Init(void)
{
	int iVar1;
	AITaskData **ppAVar2;
	uint *puVar3;
	
	ppAVar2 = globals::ReservedPool_AITask___g_TABLE;
	for (iVar1 = 0xc; iVar1 != 0; iVar1 += -1) {
		*ppAVar2 = NULL;
		ppAVar2 = ppAVar2 + 1;
	}
	lego::globals::g_AITaskTypes_TABLE[0] = "AITask_Type_Goto";
	lego::globals::g_AITaskTypes_TABLE[1] = "AITask_Type_Follow";
	lego::globals::g_AITaskTypes_TABLE[2] = "AITask_Type_FollowAttack";
	lego::globals::g_AITaskTypes_TABLE[3] = "AITask_Type_Collect";
	lego::globals::g_AITaskTypes_TABLE[4] = "AITask_Type_Gather";
	lego::globals::g_AITaskTypes_TABLE[12] = "AITask_Type_Clear";
	lego::globals::g_AITaskTypes_TABLE[5] = "AITask_Type_Deposit";
	lego::globals::g_AITaskTypes_TABLE[6] = "AITask_Type_Dump";
	lego::globals::g_AITaskTypes_TABLE[7] = "AITask_Type_Request";
	lego::globals::g_AITaskTypes_TABLE[10] = "AITask_Type_Repair";
	lego::globals::g_AITaskTypes_TABLE[8] = "AITask_Type_Dig";
	lego::globals::g_AITaskTypes_TABLE[9] = "AITask_Type_Dynamite";
	lego::globals::g_AITaskTypes_TABLE[11] = "AITask_Type_Reinforce";
	lego::globals::g_AITaskTypes_TABLE[13] = "AITask_Type_Wait";
	lego::globals::g_AITaskTypes_TABLE[14] = "AITask_Type_AnimationWait";
	lego::globals::g_AITaskTypes_TABLE[15] = "AITask_Type_ElecFence";
	lego::globals::g_AITaskTypes_TABLE[16] = "AITask_Type_Eat";
	lego::globals::g_AITaskTypes_TABLE[17] = "AITask_Type_GotoEat";
	lego::globals::g_AITaskTypes_TABLE[18] = "AITask_Type_FindDriver";
	lego::globals::g_AITaskTypes_TABLE[19] = "AITask_Type_GetTool";
	lego::globals::g_AITaskTypes_TABLE[20] = "AITask_Type_BirdScarer";
	lego::globals::g_AITaskTypes_TABLE[21] = "AITask_Type_Upgrade";
	lego::globals::g_AITaskTypes_TABLE[22] = "AITask_Type_BuildPath";
	lego::globals::g_AITaskTypes_TABLE[23] = "AITask_Type_Train";
	lego::globals::g_AITaskTypes_TABLE[24] = "AITask_Type_Depart";
	lego::globals::g_AITaskTypes_TABLE[25] = "AITask_Type_AttackPath";
	lego::globals::g_AITaskTypes_TABLE[26] = "AITask_Type_AttackRockMonster";
	lego::globals::g_AITaskTypes_TABLE[27] = "AITask_Type_Recharge";
	lego::globals::g_AITaskTypes_TABLE[28] = "AITask_Type_Dock";
	lego::globals::g_AITaskTypes_TABLE[29] = "AITask_Type_AttackObject";
	lego::globals::g_AITaskTypes_TABLE[30] = "AITask_Type_FindLoad";
	lego::globals::g_AIPriorities_TABLE[0] = "AI_Priority_Crystal";
	lego::globals::g_AIPriorities_TABLE[1] = "AI_Priority_Ore";
	lego::globals::g_AIPriorities_TABLE[2] = "AI_Priority_DefaultCollect";
	lego::globals::g_AIPriorities_TABLE[3] = "AI_Priority_Destruction";
	lego::globals::g_AIPriorities_TABLE[4] = "AI_Priority_Construction";
	lego::globals::g_AIPriorities_TABLE[5] = "AI_Priority_Request";
	lego::globals::g_AIPriorities_TABLE[6] = "AI_Priority_Reinforce";
	lego::globals::g_AIPriorities_TABLE[7] = "AI_Priority_Repair";
	lego::globals::g_AIPriorities_TABLE[8] = "AI_Priority_Clearing";
	lego::globals::g_AIPriorities_TABLE[9] = "AI_Priority_Storage";
	lego::globals::g_AIPriorities_TABLE[10] = "AI_Priority_Refining";
	lego::globals::g_AIPriorities_TABLE[11] = "AI_Priority_HealthLow";
	lego::globals::g_AIPriorities_TABLE[12] = "AI_Priority_GetIn";
	lego::globals::g_AIPriorities_TABLE[13] = "AI_Priority_Upgrade";
	lego::globals::g_AIPriorities_TABLE[14] = "AI_Priority_BuildPath";
	lego::globals::g_AIPriorities_TABLE[15] = "AI_Priority_AttackRockMonster";
	lego::globals::g_AIPriorities_TABLE[16] = "AI_Priority_Barrier";
	lego::globals::g_AIPriorities_TABLE[17] = "AI_Priority_FindLoad";
	lego::globals::g_AIPriorities_TABLE[18] = "AI_Priority_Recharge";
	lego::globals::g_AIPriorities_TABLE[19] = "AI_Priority_UpgradeBuilding";
	lego::globals::g_AIPriorities_TABLE[20] = "AI_Priority_Gather";
	lego::globals::g_AIPriorities_TABLE[21] = "AI_Priority_Steal";
	lego::globals::g_AIPriorities_TABLE[22] = "AI_Priority_Punch";
	lego::globals::g_AIPriorities_TABLE[23] = "AI_Priority_Depart";
	lego::globals::g_AIPriorities_TABLE[24] = "AI_Priority_AttackPath";
	lego::globals::g_AIPriorities_TABLE[26] = "AI_Priority_Congregate";
	lego::globals::g_AIPriorities_TABLE[25] = "AI_Priority_AttackObject";
	puVar3 = lego::globals::g_AIPriorityValues_TABLE;
	for (iVar1 = 0x1b; iVar1 != 0; iVar1 += -1) {
		*puVar3 = 0x31;
		puVar3 = puVar3 + 1;
	}
	globals::ReservedPool_AITask___g_NEXT = NULL;
	globals::ReservedPool_AITask___g_COUNT = 0;
	lego::globals::g_AIPriorityValues_TABLE[0] = 0x37;
	lego::globals::g_AIPriorityValues_TABLE[3] = 0x28;
	lego::globals::g_AIPriorityValues_TABLE[4] = 0x3c;
	lego::globals::g_AIPriorityValues_TABLE[5] = 0x14;
	lego::globals::g_AIPriorityValues_TABLE[6] = 0x46;
	lego::globals::g_AIPriorityValues_TABLE[8] = 0x14;
	lego::globals::g_AIPriorityValues_TABLE[9] = 5;
	lego::globals::g_AIPriorityValues_TABLE[10] = 0xf;
	lego::globals::g_AIPriorityValues_TABLE[15] = 0x38;
	lego::globals::g_AIPriorityValues_TABLE[19] = 99;
	lego::globals::g_AIPriorityValues_TABLE[20] = 0x31;
	lego::globals::g_AIPriorityValues_TABLE[21] = 0x5a;
	lego::globals::g_AIPriorityValues_TABLE[22] = 0x31;
	lego::globals::g_AIPriorityValues_TABLE[23] = 0;
	lego::globals::g_AIPriorityValues_TABLE[24] = 0x14;
	lego::globals::g_AIPriorityValues_TABLE[25] = 0x1e;
	lego::globals::g_AIPriorityValues_TABLE[26] = 99;
	globals::ReservedPool_AITask___g_INITFLAGS = 1;
	return;
}



void __cdecl FUN_00401f40(int param_1,int param_2,Point2I *param_3)
{
	AITaskData **ppAVar1;
	AITaskData *pAVar2;
	
	pAVar2 = lego::globals::g_AITaskUnkPtr;
	if (lego::globals::g_AITaskUnkPtr != NULL) {
		do {
			if (pAVar2->taskType == param_1) {
				if ((param_2 != 0) && ((LiveObject *)param_2 == pAVar2->object_10)) {
					pAVar2->flags_5c = pAVar2->flags_5c | 0x10000;
				}
				if (((param_3 != NULL) && (param_3->x == (pAVar2->position).x)) &&
					 (param_3->y == (pAVar2->position).y)) {
					pAVar2->flags_5c = pAVar2->flags_5c | 0x10000;
				}
			}
			ppAVar1 = &pAVar2->next;
			pAVar2 = *ppAVar1;
		} while (*ppAVar1 != NULL);
	}
	return;
}



void __cdecl FUN_00401fa0(AITaskData *aiTask,AIPriorityType priorityIndex)
{
	uint uVar1;
	
	if ((aiTask->flags_5c & 0x30000) == 0) {
		uVar1 = lego::globals::g_AIPriorityValues_TABLE[priorityIndex];
		aiTask->priorityType = priorityIndex;
		aiTask->priorityValue = uVar1;
		return;
	}
	aiTask->priorityValue = 99;
	aiTask->priorityType = priorityIndex;
	return;
}



void __cdecl lego::game::Game_SetAITaskValue2(int index,uint aiTaskValue)
{
	globals::g_AIPriorityValues_TABLE[index] = aiTaskValue;
	return;
}



void __cdecl lego::game::Game_SetIsPriorityDisabled(int priorityIndex,BOOL isDisabled)
{
	globals::g_Priorities_bool2_TABLE[priorityIndex] = isDisabled;
	return;
}



BOOL __cdecl lego::game::Game_IsPriorityDisabled(int priorityIndex)
{
	return globals::g_Priorities_bool2_TABLE[priorityIndex];
}



void __cdecl lego::pool::ReservedPool_AITask___Cleanup(void)
{
	AITaskData **ppAVar1;
	
	ppAVar1 = globals::ReservedPool_AITask___g_TABLE;
	do {
		if (*ppAVar1 != NULL) {
			std::free(*ppAVar1);
		}
		ppAVar1 = ppAVar1 + 1;
	} while (ppAVar1 < &globals::ReservedPool_AITask___g_NEXT);
	globals::ReservedPool_AITask___g_NEXT = NULL;
	globals::ReservedPool_AITask___g_INITFLAGS = 0;
	return;
}



void __cdecl FUN_00402040(BOOL param_1)
{
	int iVar1;
	undefined4 *puVar2;
	BOOL *pBVar3;
	
	if (param_1 != 0) {
		lego::pool::globals::ReservedPool_AITask___g_INITFLAGS =
				 lego::pool::globals::ReservedPool_AITask___g_INITFLAGS & 0xfffffffd;
		return;
	}
	FUN_00406470(FUN_00402120,NULL);
	lego::pool::globals::ReservedPool_AITask___g_INITFLAGS |= 2;
	lego::globals::g_AITaskUnkPtr = NULL;
	lego::globals::g_AITaskDataNext = NULL;
	puVar2 = &DAT_004b44f4;
	for (iVar1 = 0x12c0; iVar1 != 0; iVar1 += -1) {
		*puVar2 = 0;
		puVar2 = puVar2 + 1;
	}
	pBVar3 = lego::globals::g_Priorities_bool2_TABLE;
	for (iVar1 = 0x1b; iVar1 != 0; iVar1 += -1) {
		*pBVar3 = 0;
		pBVar3 = pBVar3 + 1;
	}
	return;
}



void __cdecl lego::game::Level_SetNoGather(BOOL noGather)
{
	AITaskData *pAVar1;
	
	if (noGather == 0) {
		FUN_00402730(0);
	}
	pAVar1 = pool::ReservedPool_AITask___Next(AITASK_DEPART);
	FUN_00401fa0(pAVar1,AIPRIORITY_DEPART);
	pAVar1->flags_5c = pAVar1->flags_5c | 0x40;
	pAVar1->next = globals::g_AITaskDataNext;
	globals::g_AITaskDataNext = pAVar1;
	pAVar1 = pool::ReservedPool_AITask___Next(AITASK_RECHARGE);
	FUN_00403f60(pAVar1,AIPRIORITY_CRYSTAL);
	pAVar1->flags_5c = pAVar1->flags_5c & 0xffffffef | 0x440;
	return;
}



undefined4 __cdecl FUN_00402120(AITaskData *param_1)
{
	lego::pool::ReservedPool_AITask___Release(param_1,1);
	return 0;
}



void __cdecl lego::util::free2(undefined *param_1)
{
	std::free(param_1);
	return;
}



void FUN_00402150(undefined param_1)
{
	float fVar1;
	AITaskData *pAVar2;
	uint uVar3;
	uint uVar4;
	
	uVar4 = lego::globals::g_AIPriorityValues_TABLE[1];
	if ((int)lego::globals::g_AIPriorityValues_TABLE[1] <=
			(int)lego::globals::g_AIPriorityValues_TABLE[0]) {
		uVar4 = lego::globals::g_AIPriorityValues_TABLE[0];
	}
	uVar3 = lego::globals::g_AIPriorityValues_TABLE[4];
	if (((int)lego::globals::g_AIPriorityValues_TABLE[4] < (int)uVar4) &&
		 (uVar3 = lego::globals::g_AIPriorityValues_TABLE[0],
		 (int)lego::globals::g_AIPriorityValues_TABLE[0] <
		 (int)lego::globals::g_AIPriorityValues_TABLE[1])) {
		uVar3 = lego::globals::g_AIPriorityValues_TABLE[1];
	}
	lego::globals::g_AIPriorityValues_TABLE[16] = uVar3 + 1;
	if ((lego::pool::globals::ReservedPool_AITask___g_INITFLAGS & 0x80000000) == 0) {
		FUN_00406470(FUN_00404180,(LiveObject *)&param_1);
		for (pAVar2 = lego::globals::g_AITaskUnkPtr; pAVar2 != NULL; pAVar2 = pAVar2->next) {
			if (((pAVar2->taskType == AITASK_REPAIR) && ((pAVar2->flags_5c & 0x200000) == 0)) &&
				 ((fVar1 = pAVar2->object_10->health,
					(ushort)((ushort)(fVar1 < 0.0) << 8 | (ushort)(fVar1 == 0.0) << 0xe) != 0 ||
					(100.0 <= pAVar2->object_10->health)))) {
				pAVar2->flags_5c = pAVar2->flags_5c | 0x20;
			}
		}
		FUN_00402240(&lego::globals::g_AITaskUnkPtr);
		FUN_00402240(&lego::globals::g_AITaskDataNext);
		INT_004b4424 = 0;
		UINT_004b44f0 = 0;
		FUN_00437a70(FUN_004041b0,(LiveObject *)&param_1);
		FUN_00405b40();
		FUN_00405880();
	}
	return;
}



void __cdecl FUN_00402240(AITaskData **ref_aiTask)
{
	AITaskData **ppAVar1;
	AITaskData *pAVar2;
	AITaskData *pAVar3;
	uint uVar4;
	bool bVar5;
	AITaskData **ppAVar6;
	BOOL BVar7;
	int iVar8;
	int iVar9;
	int iVar10;
	AITaskData *pAVar11;
	uint number;
	int *piVar12;
	AITaskData *local_4dc;
	int local_4d0 [5];
	undefined4 local_4bc;
	undefined4 local_4b8;
	undefined4 local_4b4;
	AITaskData *local_4b0 [300];
	
	local_4dc = NULL;
	pAVar2 = *ref_aiTask;
	pAVar11 = NULL;
	while (pAVar3 = pAVar11, pAVar11 = pAVar2, pAVar11 != NULL) {
		pAVar2 = pAVar11->next;
		if ((*(byte *)&pAVar11->flags_5c & 0x20) != 0) {
			if (pAVar3 == NULL) {
				*ref_aiTask = pAVar2;
				lego::pool::ReservedPool_AITask___Release(pAVar11,0);
				pAVar11 = pAVar3;
			}
			else {
				pAVar3->next = pAVar2;
				lego::pool::ReservedPool_AITask___Release(pAVar11,0);
				pAVar11 = pAVar3;
			}
		}
	}
	number = 0;
	pAVar2 = local_4dc;
	if (*ref_aiTask != NULL) {
		ppAVar6 = local_4b0;
		pAVar11 = *ref_aiTask;
		do {
			pAVar3 = pAVar11->next;
			pAVar2 = pAVar11;
			if (number == 300) break;
			*ppAVar6 = pAVar11;
			ppAVar6 = ppAVar6 + 1;
			number += 1;
			if ((lego::globals::g_Priorities_bool2_TABLE[pAVar11->priorityType] == 0) ||
				 ((pAVar11->flags_5c & 0x10000) != 0)) {
				uVar4 = pAVar11->flags_5c;
				pAVar11->flags_5c = uVar4 & 0xfff7ffff;
				if ((uVar4 & 0x30000) == 0) {
					pAVar11->priorityValue = lego::globals::g_AIPriorityValues_TABLE[pAVar11->priorityType];
				}
				else {
					pAVar11->priorityValue = 99;
				}
			}
			else {
				pAVar11->flags_5c = pAVar11->flags_5c | 0x80000;
			}
			if (pAVar11->taskType == AITASK_DIG) {
				if ((*(byte *)&pAVar11->flags_5c & 8) == 0) {
					BVar7 = FUN_00432e70((pAVar11->position).x,(pAVar11->position).y);
					if (BVar7 != 0) {
						pAVar11->priorityValue = 0;
					}
				}
				else {
					local_4d0[0] = 0;
					local_4d0[1] = 0;
					local_4d0[2] = 0;
					local_4b4 = 0;
					local_4d0[3] = 0xffffffff;
					local_4d0[4] = 0xffffffff;
					local_4bc = 0xffffffff;
					local_4b8 = 0xffffffff;
					bVar5 = false;
					piVar12 = local_4d0;
					iVar10 = 4;
					do {
						BVar7 = lego::game::Level_GetBlockFlags1_10Not8
															(*piVar12 + (pAVar11->position).x,piVar12[1] + (pAVar11->position).y);
						if (BVar7 != 0) {
							bVar5 = true;
						}
						piVar12 = piVar12 + 2;
						iVar10 += -1;
					} while (iVar10 != 0);
					if (bVar5) {
						if (pAVar11->priorityValue == 0) {
							pAVar11->float_18 = (float)&DAT_42c80000;
						}
					}
					else {
						pAVar11->priorityValue = 0;
					}
				}
			}
			pAVar11 = pAVar3;
			pAVar2 = local_4dc;
		} while (pAVar3 != NULL);
	}
	local_4dc = pAVar2;
	if (number != 0) {
		std::qsort(local_4b0,number,4,(CompareCallback *)&LAB_00403eb0);
		iVar10 = number - 1;
		iVar9 = 0;
		if (iVar10 != 0) {
			ppAVar6 = local_4b0;
			iVar8 = iVar10;
			do {
				pAVar2 = *ppAVar6;
				ppAVar1 = ppAVar6 + 1;
				ppAVar6 = ppAVar6 + 1;
				iVar8 += -1;
				pAVar2->next = *ppAVar1;
				iVar9 = iVar10;
			} while (iVar8 != 0);
		}
		local_4b0[iVar9]->next = local_4dc;
		*ref_aiTask = local_4b0[0];
	}
	return;
}



void __cdecl FUN_00402440(Point2I *position,BOOL param_2,BOOL param_3)
{
	LevelData *pLVar1;
	uint uVar2;
	BOOL BVar3;
	AITaskData *aiTask;
	int iVar4;
	
	pLVar1 = lego::game::GetLevel();
	uVar2 = lego::game::Level_IsBlockSolid(position);
	if (uVar2 == 0) {
		uVar2 = lego::game::Level_IsBlockLava(position);
		if (uVar2 == 0) {
			BVar3 = FUN_00432ec0(position->x,position->y);
			if (BVar3 != 0) {
				aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_DIG);
				(aiTask->position).x = position->x;
				(aiTask->position).y = position->y;
				if (param_2 != 0) {
					aiTask->flags_5c = aiTask->flags_5c | 8;
				}
				FUN_00402530(aiTask,1);
				FUN_00403f60(aiTask,AIPRIORITY_DESTRUCTION);
				uVar2 = aiTask->flags_5c;
				aiTask->flags_5c = uVar2 | 0x80;
				if (param_3 != 0) {
					aiTask->flags_5c = uVar2 | 0x20080;
				}
				if (param_2 == 0) {
					FUN_0044f7a0(pLVar1->surfaceMap,position->x,position->y,1);
					iVar4 = (pLVar1->dimensions).width * position->y + position->x;
					pLVar1->blocks[iVar4].flags1 = pLVar1->blocks[iVar4].flags1 | 0x800000;
				}
			}
		}
	}
	return;
}



void __cdecl FUN_00402530(AITaskData *aiTask,BOOL param_2)
{
	uint *puVar1;
	void **ppvVar2;
	BOOL BVar3;
	uint uVar4;
	
	BVar3 = lego::game::Game_IsAnyUnitsSelected();
	if (BVar3 != 0) {
		puVar1 = (uint *)&aiTask->field_0x44;
		ppvVar2 = &aiTask->ptr_40;
		aiTask->flags_5c = aiTask->flags_5c | 0x140;
		FUN_004527e0(ppvVar2,puVar1);
		uVar4 = 0;
		if (*puVar1 != 0) {
			do {
				lego::game::LiveObject_UnkDoRouting_FUN_00441c00
									(*(LiveObject **)((int)*ppvVar2 + uVar4 * 4),0);
				if (param_2 != 0) {
					FUN_0043a130(*(LiveObject **)((int)*ppvVar2 + uVar4 * 4),0);
				}
				uVar4 += 1;
			} while (uVar4 < *puVar1);
		}
	}
	return;
}



void __cdecl lego::game::LiveObject_Create_InitCanShoot(LiveObject *liveObj)
{
	BOOL BVar1;
	AITaskData *aiTask;
	
	GetLevel();
	if (liveObj != NULL) {
		BVar1 = LiveObject_CanShootObject(liveObj);
		if (BVar1 != 0) {
			aiTask = pool::ReservedPool_AITask___Next(AITASK_ATTACKROCKMONSTER);
			FUN_00403f60(aiTask,AIPRIORITY_ATTACKROCKMONSTER);
			aiTask->object_10 = liveObj;
			aiTask->flags_5c = aiTask->flags_5c & 0xffffffef | 0x40040;
		}
	}
	return;
}



void __cdecl FUN_004025f0(LiveObject *liveObj)
{
	BOOL BVar1;
	
	if ((liveObj->carryingThisObject == NULL) && ((liveObj->flags4_3ec & 0x100) == 0)) {
		BVar1 = FUN_00406470(FUN_00402630,liveObj);
		if (BVar1 == 0) {
			FUN_00402650(liveObj,0.0);
		}
	}
	return;
}



BOOL __cdecl FUN_00402630(AITaskData *aiTask,LiveObject *liveObj)
{
	if ((aiTask->taskType == AITASK_COLLECT) && (aiTask->object_10 == liveObj)) {
		return 1;
	}
	return 0;
}



void __cdecl FUN_00402650(LiveObject *liveObj,float param_2)
{
	ObjectType OVar1;
	AITaskData *aiTask;
	AIPriorityType priorityIndex;
	
	priorityIndex = AIPRIORITY_DEFAULTCOLLECT;
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_COLLECT);
	aiTask->object_10 = liveObj;
	aiTask->float_18 = param_2;
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_POWERCRYSTAL) {
		priorityIndex = -(uint)((liveObj->flags3_3e8 & 0x80000000) != LIVEOBJ3_NONE) & 0x12;
	}
	else {
		if (OVar1 == OBJECT_ORE) {
			priorityIndex = AIPRIORITY_ORE;
		}
		else {
			if (OVar1 == OBJECT_BARRIER) {
				priorityIndex = AIPRIORITY_BARRIER;
			}
			else {
				if (OVar1 == OBJECT_DYNAMITE) {
					aiTask->mode_3c = 8;
					priorityIndex = AIPRIORITY_DESTRUCTION;
				}
			}
		}
	}
	FUN_00403f60(aiTask,priorityIndex);
	FUN_00402780(liveObj);
	return;
}



void __cdecl FUN_004026d0(Point2I *position)
{
	BOOL BVar1;
	int iVar2;
	AITaskData *aiTask;
	
	BVar1 = lego::game::Level_IsBlockPowerPath(position);
	if (BVar1 == 0) {
		iVar2 = lego::game::Level_GetBlockRubbleLevel_OrFlag200000(position);
		if (iVar2 == 0) {
			BVar1 = FUN_0040add0(OBJECT_PATH,0,0);
			if (BVar1 != 0) {
				aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_BUILDPATH);
				(aiTask->position).x = position->x;
				(aiTask->position).y = position->y;
				FUN_00403f60(aiTask,AIPRIORITY_BUILDPATH);
			}
		}
	}
	return;
}



void __cdecl FUN_00402730(int count)
{
	AITaskData *aiTask;
	bool bVar1;
	
	bVar1 = count == 0;
	if (bVar1) {
		count = 1;
	}
	if (true) {
		do {
			aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_GATHER);
			FUN_00401fa0(aiTask,AIPRIORITY_GATHER);
			if (bVar1) {
				aiTask->flags_5c = aiTask->flags_5c | 0x40;
			}
			FUN_00403fa0(aiTask);
			count += -1;
		} while (count != 0);
	}
	return;
}



void __cdecl FUN_00402780(LiveObject *liveObj)
{
	AITaskData *aiTask;
	
	if (liveObj->objType == OBJECT_POWERCRYSTAL) {
		aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_COLLECT);
		aiTask->object_10 = liveObj;
		FUN_00401fa0(aiTask,AIPRIORITY_STEAL);
		FUN_00403fa0(aiTask);
		aiTask->flags_5c = aiTask->flags_5c | 0x2000;
	}
	return;
}



void __cdecl FUN_004027c0(LiveObject *liveObj,TrainedFlags training,BOOL param_3)
{
	BOOL BVar1;
	AITaskData *aiTask;
	AIPriorityType priorityIndex;
	
	BVar1 = lego::game::LiveObject_HasTraining(liveObj,training);
	if (BVar1 == 0) {
		return;
	}
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_TRAIN);
	aiTask->object_10 = liveObj;
	aiTask->mode_3c = training;
	if (false) {
switchD_004027fb_caseD_3:
		priorityIndex = AIPRIORITY_UPGRADE;
	}
	else {
		switch(training) {
		case TRAINED_PILOT:
		case TRAINED_SAILOR:
		case TRAINED_DRIVER:
			priorityIndex = AIPRIORITY_GETIN;
			break;
		default:
			goto switchD_004027fb_caseD_3;
		case TRAINED_DYNAMITE:
			priorityIndex = AIPRIORITY_DESTRUCTION;
			break;
		case TRAINED_REPAIR:
			priorityIndex = AIPRIORITY_REPAIR;
			break;
		case TRAINED_SCANNER:
			priorityIndex = AIPRIORITY_CONSTRUCTION;
		}
	}
	if (param_3 != 0) {
		FUN_00402530(aiTask,1);
	}
	FUN_00403f60(aiTask,priorityIndex);
	aiTask->flags_5c = aiTask->flags_5c & 0xffffffbf;
	return;
}



void __cdecl FUN_00402890(LiveObject *liveObj)
{
	AITaskData *aiTask;
	ObjectStatsFlags3 OVar1;
	ObjectStatsFlags1 OVar2;
	
	if ((*(byte *)&liveObj->flags2_3e4 & 0x10) == 0) {
		aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_FINDDRIVER);
		aiTask->object_10 = liveObj;
		liveObj->flags2_3e4 = liveObj->flags2_3e4 | 0x10;
		OVar1 = lego::game::LiveObject_GetStatsFlags3(liveObj);
		if ((OVar1 & STATS3_NEEDSPILOT) == STATS3_NONE) {
			OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj);
			if ((OVar2 & STATS1_CROSSLAND) == STATS1_NONE) {
				OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj);
				if ((OVar2 & STATS1_CROSSWATER) != STATS1_NONE) {
					aiTask->mode_3c = 2;
				}
			}
			else {
				OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj);
				if ((OVar2 & STATS1_CROSSWATER) == STATS1_NONE) {
					aiTask->mode_3c = 4;
				}
				else {
					aiTask->mode_3c = 1;
				}
			}
		}
		else {
			aiTask->mode_3c = 1;
		}
		OVar1 = lego::game::LiveObject_GetStatsFlags3(liveObj);
		if (((OVar1 & STATS3_TAKECARRYINGDRIVERS) != STATS3_NONE) &&
			 ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE)) {
			aiTask->flags_5c = aiTask->flags_5c | 0x100000;
		}
		FUN_00402530(aiTask,~aiTask->flags_5c >> 0x14 & 1);
		aiTask->flags_5c = aiTask->flags_5c & 0xffffffbf;
		FUN_00403f60(aiTask,AIPRIORITY_GETIN);
	}
	return;
}



void __cdecl FUN_00402970(ObjectType param_1)
{
	ObjectType local_8;
	int local_4;
	
	local_8 = param_1;
	local_4 = 0;
	FUN_00406470(FUN_004029a0,(LiveObject *)&local_8);
	return;
}



BOOL __cdecl FUN_004029a0(AITaskData *aiTask,Point2I **param_2)
{
	if (((aiTask->taskType == AITASK_ATTACKPATH) && ((*param_2)->x == (aiTask->position).x)) &&
		 ((*param_2)->y == (aiTask->position).y)) {
		aiTask->flags_5c = aiTask->flags_5c | 0x20;
	}
	return 0;
}



void __cdecl FUN_004029d0(LiveObject *liveObj)
{
	FUN_00406470(FUN_004029f0,liveObj);
	return;
}



BOOL __cdecl FUN_004029f0(AITaskData *aiTask,LiveObject *liveObj)
{
	if ((aiTask->taskType == AITASK_ATTACKROCKMONSTER) && (aiTask->object_10 == liveObj)) {
		aiTask->flags_5c = aiTask->flags_5c | 0x20;
	}
	return 0;
}



void __cdecl FUN_00402a10(Point2I *param_1,int param_2)
{
	LevelData *level;
	Point2I *local_8;
	int local_4;
	
	level = lego::game::GetLevel();
	local_8 = param_1;
	local_4 = param_2;
	FUN_00406470(FUN_00402ae0,(LiveObject *)&local_8);
	FUN_0044f830(level->surfaceMap,param_1->x,param_1->y);
	return;
}



void __cdecl FUN_00402a60(ObjectType param_1)
{
	ObjectType local_8;
	int local_4;
	
	local_8 = param_1;
	local_4 = 0;
	FUN_00406470(FUN_00402b50,(LiveObject *)&local_8);
	return;
}



void __cdecl FUN_00402a90(ObjectType param_1,BOOL param_2)
{
	ObjectType local_8;
	int local_4;
	
	local_4 = 0;
	local_8 = param_1;
	if (param_2 != 0) {
		FUN_00406470(FUN_00402bd0,(LiveObject *)&local_8);
		return;
	}
	FUN_00406470(FUN_00402ba0,(LiveObject *)&local_8);
	return;
}



undefined4 __cdecl FUN_00402ae0(AITaskData *aiTask,Point2I **param_2)
{
	AITaskType AVar1;
	bool bVar2;
	
	bVar2 = false;
	AVar1 = aiTask->taskType;
	if (AVar1 == AITASK_DIG) {
		if (param_2[1] != NULL) {
			if ((*(byte *)&aiTask->flags_5c & 8) != 0) goto LAB_00402b16;
			if (param_2[1] != NULL) goto LAB_00402b1b;
		}
		if ((*(byte *)&aiTask->flags_5c & 8) != 0) goto LAB_00402b1b;
	}
	else {
		if ((AVar1 != AITASK_DYNAMITE) && (AVar1 != AITASK_REINFORCE)) goto LAB_00402b1b;
	}
LAB_00402b16:
	bVar2 = true;
LAB_00402b1b:
	if (((bVar2) && ((*param_2)->x == (aiTask->position).x)) &&
		 ((*param_2)->y == (aiTask->position).y)) {
		aiTask->flags_5c = aiTask->flags_5c | 0x20;
		lego::game::Level_SetBlockFlags1_8000000(*param_2,0);
	}
	return 0;
}



BOOL __cdecl FUN_00402b50(AITaskData *aiTask,Point2I **param_2)
{
	LevelSurfaceMap *pLVar1;
	int iVar2;
	int iVar3;
	
	if (((aiTask->taskType == AITASK_REINFORCE) && ((*param_2)->x == (aiTask->position).x)) &&
		 ((*param_2)->y == (aiTask->position).y)) {
		iVar3 = (aiTask->position).y;
		aiTask->flags_5c = aiTask->flags_5c | 0x20;
		iVar2 = (aiTask->position).x;
		pLVar1 = lego::game::GetSurfaceMap();
		FUN_0044f830(pLVar1,iVar2,iVar3);
	}
	return 0;
}



BOOL __cdecl FUN_00402ba0(AITaskData *aiTask,Point2I **param_2)
{
	if (((aiTask->taskType == AITASK_CLEAR) && ((*param_2)->x == (aiTask->position).x)) &&
		 ((*param_2)->y == (aiTask->position).y)) {
		aiTask->flags_5c = aiTask->flags_5c | 0x20;
	}
	return 0;
}



BOOL __cdecl FUN_00402bd0(AITaskData *aiTask,Point2I **param_2)
{
	if (((aiTask->taskType == AITASK_CLEAR) && ((*param_2)->x == (aiTask->position).x)) &&
		 ((*param_2)->y == (aiTask->position).y)) {
		aiTask->float_18 = 500.0;
	}
	return 0;
}



void __cdecl FUN_00402c00(AITaskData *param_1)
{
	AITaskData **ppAVar1;
	AITaskData *pAVar2;
	
	if (param_1->taskType == AITASK_GETTOOL) {
		if (*(int *)&param_1->field_0x58 != 0) {
			FUN_00406470(FUN_00402c60,(LiveObject *)&param_1);
			return;
		}
	}
	else {
		if ((*(int *)&param_1->field_0x58 != 0) &&
			 (pAVar2 = lego::globals::g_AITaskUnkPtr, lego::globals::g_AITaskUnkPtr != NULL)) {
			do {
				if ((pAVar2->taskType == AITASK_GETTOOL) && (*(AITaskData **)&param_1->field_0x58 == pAVar2)
					 ) {
					pAVar2->flags_5c = pAVar2->flags_5c | 0x20;
				}
				ppAVar1 = &pAVar2->next;
				pAVar2 = *ppAVar1;
			} while (*ppAVar1 != NULL);
		}
	}
	return;
}



BOOL __cdecl FUN_00402c60(int param_1,int param_2)
{
	return (uint)(*(int *)(param_1 + 0x58) == param_2);
}



BOOL __cdecl FUN_00402c80(Point2I *position,BOOL param_2)
{
	BOOL BVar1;
	uint uVar2;
	AITaskData *aiTask;
	LevelSurfaceMap *surfMap;
	int x;
	int y;
	int index;
	
	if ((lego::globals::g_Game.level)->blocks
			[((lego::globals::g_Game.level)->dimensions).width * position->y + position->x].terrain !=
			TERRAIN_IMMOVABLE) {
		BVar1 = lego::game::Level_GetBlockFlags1_10Not8(position->x,position->y);
		if (BVar1 != 0) {
			uVar2 = lego::game::Level_GetBlockFlags1_8000000(position);
			if (uVar2 == 0) {
				aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_DYNAMITE);
				(aiTask->position).x = position->x;
				uVar2 = aiTask->flags_5c;
				(aiTask->position).y = position->y;
				aiTask->objType = OBJECT_DYNAMITE;
				aiTask->objIndex = -1;
				aiTask->objLevel = 0;
				aiTask->flags_5c = uVar2 | 0x400;
				if (param_2 == 0) {
					FUN_00402530(aiTask,1);
				}
				FUN_00403f60(aiTask,AIPRIORITY_DESTRUCTION);
				FUN_00403740(position,OBJECT_DYNAMITE,0,0);
				lego::game::Level_SetBlockFlags1_8000000(position,1);
				y = position->y;
				x = position->x;
				index = 2;
				surfMap = lego::game::GetSurfaceMap();
				FUN_0044f7a0(surfMap,x,y,index);
				return 1;
			}
		}
	}
	return 0;
}



void __cdecl FUN_00402d70(Point2I *position)
{
	uint uVar1;
	BOOL BVar2;
	AITaskData *aiTask;
	
	BVar2 = lego::game::Level_GetBlockFlags1_8(position->x,position->y);
	if (BVar2 != 0) {
		aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_SONICBLASTER);
		uVar1 = aiTask->flags_5c;
		(aiTask->position).x = position->x;
		(aiTask->position).y = position->y;
		aiTask->objType = OBJECT_SONICBLASTER;
		aiTask->objIndex = -1;
		aiTask->objLevel = 0;
		aiTask->flags_5c = uVar1 | 0x400;
		FUN_00402530(aiTask,1);
		FUN_00403f60(aiTask,AIPRIORITY_DESTRUCTION);
		FUN_00403740(position,OBJECT_SONICBLASTER,0,0);
	}
	return;
}



void __cdecl FUN_00402df0(LiveObject *liveObj)
{
	ObjectStatsFlags3 OVar1;
	AITaskData *aiTask;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags3(liveObj);
	if ((((OVar1 & STATS3_CARRYVEHICLES) != STATS3_NONE) &&
			((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE)) &&
		 ((liveObj->flags4_3ec & 0x10000) == 0)) {
		aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_FINDLOAD);
		aiTask->object_10 = liveObj;
		liveObj->flags4_3ec = liveObj->flags4_3ec | 0x10000;
		FUN_00403f60(aiTask,AIPRIORITY_FINDLOAD);
		aiTask->flags_5c = aiTask->flags_5c & 0xffffffbf | 0x100010;
	}
	return;
}



void __cdecl FUN_00402e60(LiveObject *liveObj,BOOL param_2)
{
	AITaskData *aiTask;
	
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_REPAIR);
	aiTask->object_10 = liveObj;
	aiTask->mode_3c = 0x10;
	if (param_2 != 0) {
		aiTask->flags_5c = aiTask->flags_5c | 0x200000;
	}
	FUN_00403f60(aiTask,(-(uint)(param_2 != 0) & 0xc) + AIPRIORITY_REPAIR);
	return;
}



void __cdecl FUN_00402ea0(LiveObject *liveObj,LiveObject *param_2)
{
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	
	pAVar1 = lego::pool::ReservedPool_AITask___Next(AITASK_GOTOEAT);
	pAVar1->object_10 = param_2;
	pAVar2 = FUN_004040c0(liveObj);
	if (pAVar2 != NULL) {
		pAVar2->next = pAVar1;
		return;
	}
	liveObj->aitask_2f0 = pAVar1;
	return;
}



void __cdecl FUN_00402ee0(Point2I *position)
{
	uint uVar1;
	AITaskData *aiTask;
	
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_ELECFENCE);
	uVar1 = aiTask->flags_5c;
	(aiTask->position).x = position->x;
	(aiTask->position).y = position->y;
	aiTask->objType = OBJECT_ELECTRICFENCE;
	aiTask->objIndex = -1;
	aiTask->objLevel = 0;
	aiTask->flags_5c = uVar1 | 0x400;
	FUN_00402530(aiTask,1);
	FUN_00403f60(aiTask,AIPRIORITY_CONSTRUCTION);
	FUN_00403740(position,OBJECT_ELECTRICFENCE,0,0);
	FUN_00432400(position->x,position->y,1);
	return;
}



void __cdecl FUN_00402f60(Point2I *param_1)
{
	BOOL BVar1;
	AITaskData *aiTask;
	LevelSurfaceMap *surfMap;
	int x;
	int y;
	int index;
	
	BVar1 = lego::game::Level_GetBlockFlags1_10Not8(param_1->x,param_1->y);
	if (BVar1 != 0) {
		BVar1 = lego::game::Level_GetBlockFlags1_20(param_1->x,param_1->y);
		if (BVar1 == 0) {
			aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_REINFORCE);
			(aiTask->position).x = param_1->x;
			(aiTask->position).y = param_1->y;
			FUN_00402530(aiTask,1);
			FUN_00403f60(aiTask,AIPRIORITY_REINFORCE);
			y = param_1->y;
			x = param_1->x;
			index = 3;
			surfMap = lego::game::GetSurfaceMap();
			FUN_0044f7a0(surfMap,x,y,index);
		}
	}
	return;
}



void __cdecl FUN_00402fe0(Point2I *param_1,undefined4 param_2)
{
	AITaskData *aiTask;
	
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_CLEAR);
	(aiTask->position).x = param_1->x;
	(aiTask->position).y = param_1->y;
	*(undefined4 *)&aiTask->field_0x54 = param_2;
	FUN_00403f60(aiTask,AIPRIORITY_CLEARING);
	return;
}



void __cdecl FUN_00403010(int *param_1)
{
	int *piVar1;
	int iVar2;
	AITaskData *aiTask;
	undefined4 *puVar3;
	uint uVar4;
	undefined4 *puVar5;
	
	piVar1 = param_1;
	iVar2 = FUN_0046a3e0(*param_1,(int *)&param_1);
	if (iVar2 != 0) {
		piVar1[0x17] = piVar1[0x17] | 0x1000;
		aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_GETTOOL);
		if ((piVar1[0x17] & 0x100U) != 0) {
			puVar3 = (undefined4 *)std::malloc(piVar1[0x11] << 2);
			aiTask->ptr_40 = puVar3;
			puVar5 = (undefined4 *)piVar1[0x10];
			for (uVar4 = piVar1[0x11] & 0x3fffffff; uVar4 != 0; uVar4 -= 1) {
				*puVar3 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar3 = puVar3 + 1;
			}
			for (iVar2 = 0; iVar2 != 0; iVar2 += -1) {
				*(undefined *)puVar3 = *(undefined *)puVar5;
				puVar5 = (undefined4 *)((int)puVar5 + 1);
				puVar3 = (undefined4 *)((int)puVar3 + 1);
			}
			*(int *)&aiTask->field_0x44 = piVar1[0x11];
			aiTask->flags_5c = aiTask->flags_5c | 0x100;
		}
		aiTask->flags_5c = aiTask->flags_5c | 0x10;
		*(int **)&aiTask->field_0x38 = param_1;
		*(int **)&aiTask->field_0x58 = piVar1;
		piVar1[0x16] = (int)aiTask;
		FUN_00403f60(aiTask,piVar1[0x13]);
	}
	return;
}



undefined4 __cdecl FUN_004030c0(undefined4 param_1)
{
	AITaskData *aiTask;
	
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_GETTOOL);
	*(undefined4 *)&aiTask->field_0x38 = param_1;
	*(undefined4 *)&aiTask->field_0x58 = 0;
	FUN_00402530(aiTask,1);
	aiTask->flags_5c = aiTask->flags_5c & 0xffffffbf | 0x10;
	FUN_00403f60(aiTask,AIPRIORITY_DEFAULTCOLLECT);
	return 1;
}



undefined4 __cdecl FUN_00403110(int param_1)
{
	BOOL BVar1;
	uint uVar2;
	LiveObject **ppLVar3;
	uint uVar4;
	
	BVar1 = lego::game::Game_IsAnyUnitsSelected();
	if (BVar1 == 0) {
		uVar2 = 0;
		if (INT_004b4424 != 0) {
			ppLVar3 = (LiveObject **)&DAT_004b435c;
			while ((*ppLVar3 == NULL ||
						 (BVar1 = lego::game::LiveObject_HasToolEquipped(*ppLVar3,param_1), BVar1 == 0))) {
				uVar2 += 1;
				ppLVar3 = ppLVar3 + 1;
				if ((uint)INT_004b4424 <= uVar2) {
					return 0;
				}
			}
			return 1;
		}
	}
	else {
		uVar2 = lego::game::Game_GetNumSelectedUnits();
		ppLVar3 = lego::game::Game_GetSelectedUnits();
		uVar4 = 0;
		if (uVar2 != 0) {
			do {
				BVar1 = lego::game::LiveObject_HasToolEquipped(*ppLVar3,param_1);
				if (BVar1 != 0) {
					return 1;
				}
				uVar4 += 1;
				ppLVar3 = ppLVar3 + 1;
			} while (uVar4 < uVar2);
			return 0;
		}
	}
	return 0;
}



void __cdecl FUN_004031a0(int *param_1,int param_2,undefined4 *param_3,int param_4)
{
	LiveObject *liveObj;
	AITaskData *pAVar1;
	ObjectStatsFlags1 OVar2;
	AITaskData *pAVar3;
	
	if ((param_2 != 0) && (param_2 != 0)) {
		do {
			pAVar1 = lego::pool::ReservedPool_AITask___Next(AITASK_GOTO);
			(pAVar1->position).x = *param_3;
			(pAVar1->position).y = param_3[1];
			pAVar1->flags_5c = 4;
			liveObj = (LiveObject *)*param_1;
			OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj);
			if ((((OVar2 & STATS1_CANBEDRIVEN) == STATS1_NONE) || (liveObj->drivenObject != NULL)) &&
				 ((liveObj->carryingThisObject == NULL && ((*(byte *)&liveObj->flags3_3e8 & 0x80) != 0)))) {
				if (param_4 != 0) {
					FUN_00404030(liveObj);
				}
				pAVar3 = FUN_004040c0(liveObj);
				if (pAVar3 == NULL) {
					liveObj->aitask_2f0 = pAVar1;
				}
				else {
					pAVar3->next = pAVar1;
				}
			}
			param_1 = (int *)((LiveObject **)param_1 + 1);
			param_2 += -1;
		} while (param_2 != 0);
	}
	return;
}



void __cdecl FUN_00403250(LiveObject *liveObj,int param_2)
{
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	LiveObject *pLVar3;
	Point2F local_8;
	
	pLVar3 = NULL;
	if ((liveObj->objType == OBJECT_MINIFIGURE) &&
		 ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE)) {
		lego::game::LiveObject_GetPosition(liveObj,(float *)&local_8,&local_8.y);
		pLVar3 = (LiveObject *)FUN_004390b0(&local_8);
	}
	else {
		if (liveObj->objType == OBJECT_VEHICLE) {
			pLVar3 = (LiveObject *)FUN_00438eb0(liveObj);
		}
	}
	if (pLVar3 != NULL) {
		pAVar1 = lego::pool::ReservedPool_AITask___Next(AITASK_UPGRADE);
		pAVar1->object_10 = pLVar3;
		pAVar1->objLevel = param_2;
		FUN_00404030(liveObj);
		pAVar2 = FUN_004040c0(liveObj);
		if (pAVar2 != NULL) {
			pAVar2->next = pAVar1;
			return;
		}
		liveObj->aitask_2f0 = pAVar1;
	}
	return;
}



void __cdecl FUN_004032f0(LiveObject *liveObj)
{
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	
	pAVar1 = lego::pool::ReservedPool_AITask___Next(AITASK_DOCK);
	pAVar2 = FUN_004040c0(liveObj);
	if (pAVar2 != NULL) {
		pAVar2->next = pAVar1;
		return;
	}
	liveObj->aitask_2f0 = pAVar1;
	return;
}



void __cdecl FUN_00403320(undefined4 *param_1)
{
	uint uVar1;
	AITaskData *aiTask;
	
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_GOTO);
	(aiTask->position).x = *param_1;
	uVar1 = aiTask->flags_5c;
	(aiTask->position).y = param_1[1];
	aiTask->flags_5c = uVar1 & 0xffffffef | 0x40;
	FUN_00401fa0(aiTask,AIPRIORITY_CONGREGATE);
	FUN_00403fa0(aiTask);
	return;
}



void __cdecl FUN_00403360(int *param_1)
{
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	AITaskData *pAVar3;
	
	pAVar1 = lego::globals::g_AITaskDataNext;
	pAVar3 = NULL;
	if (lego::globals::g_AITaskDataNext != NULL) {
		do {
			pAVar2 = pAVar1;
			pAVar1 = pAVar2->next;
			if (((pAVar2->taskType == AITASK_GOTO) && ((pAVar2->position).x == *param_1)) &&
				 ((pAVar2->position).y == param_1[1])) {
				if (pAVar3 == NULL) {
					lego::globals::g_AITaskDataNext = pAVar1;
					lego::pool::ReservedPool_AITask___Release(pAVar2,0);
					return;
				}
				pAVar3->next = pAVar1;
				lego::pool::ReservedPool_AITask___Release(pAVar2,0);
				return;
			}
			pAVar3 = pAVar2;
		} while (pAVar1 != NULL);
	}
	return;
}



void __cdecl FUN_004033d0(LiveObject *liveObj)
{
	AITaskData *aiTask;
	
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_ATTACKOBJECT);
	aiTask->object_10 = liveObj;
	FUN_00401fa0(aiTask,AIPRIORITY_ATTACKOBJECT);
	FUN_00403fa0(aiTask);
	aiTask->flags_5c = aiTask->flags_5c | 0x40;
	return;
}



void __cdecl FUN_00403410(undefined4 *param_1)
{
	AITaskData *aiTask;
	
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_ATTACKPATH);
	(aiTask->position).x = *param_1;
	(aiTask->position).y = param_1[1];
	FUN_00401fa0(aiTask,AIPRIORITY_ATTACKPATH);
	FUN_00403fa0(aiTask);
	return;
}



void __cdecl FUN_00403450(LiveObject *liveObj)
{
	AITaskData *aiTask;
	
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_REPAIR);
	aiTask->object_10 = liveObj;
	FUN_00401fa0(aiTask,AIPRIORITY_PUNCH);
	FUN_00403fa0(aiTask);
	aiTask->flags_5c = aiTask->flags_5c | 0x40;
	return;
}



void __cdecl FUN_00403490(LiveObject *liveObj)
{
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	AITaskData *pAVar3;
	AITaskData *pAVar4;
	
	pAVar3 = NULL;
	pAVar2 = lego::globals::g_AITaskDataNext;
	if (lego::globals::g_AITaskDataNext != NULL) {
		do {
			pAVar1 = pAVar2->next;
			pAVar4 = pAVar2;
			if ((pAVar2->taskType == AITASK_REPAIR) && (liveObj == pAVar2->object_10)) {
				pAVar4 = pAVar3;
				if (pAVar3 == NULL) {
					lego::globals::g_AITaskDataNext = pAVar1;
					lego::pool::ReservedPool_AITask___Release(pAVar2,0);
				}
				else {
					pAVar3->next = pAVar1;
					lego::pool::ReservedPool_AITask___Release(pAVar2,0);
				}
			}
			pAVar2 = pAVar1;
			pAVar3 = pAVar4;
		} while (pAVar1 != NULL);
	}
	return;
}



void __cdecl FUN_004034f0(int *param_1,undefined4 *param_2,undefined4 param_3)
{
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	
	pAVar1 = lego::pool::ReservedPool_AITask___Next(AITASK_GOTO);
	(pAVar1->position).x = *param_2;
	(pAVar1->position).y = param_2[1];
	pAVar1->field_4 = param_3;
	pAVar2 = FUN_004040c0((LiveObject *)param_1);
	if (pAVar2 != NULL) {
		pAVar2->next = pAVar1;
		return;
	}
	param_1[0xbc] = (int)pAVar1;
	FUN_00407380((LiveObject *)param_1);
	return;
}



void __cdecl FUN_00403540(LiveObject *liveObj,LiveObject *param_2)
{
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	
	if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) {
		pAVar1 = lego::pool::ReservedPool_AITask___Next(AITASK_DEPOSITE);
		pAVar1->object_10 = param_2;
		pAVar2 = FUN_004040c0(liveObj);
		if (pAVar2 != NULL) {
			pAVar2->next = pAVar1;
			return;
		}
		liveObj->aitask_2f0 = pAVar1;
	}
	return;
}



void __cdecl FUN_00403580(int *param_1,int param_2,LiveObject *param_3)
{
	LiveObject *liveObj;
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	
	if ((param_2 != 0) && (param_2 != 0)) {
		do {
			pAVar1 = lego::pool::ReservedPool_AITask___Next(AITASK_FOLLOW);
			pAVar1->object_10 = param_3;
			pAVar1->unkExpiryTime = 0.0;
			liveObj = (LiveObject *)*param_1;
			FUN_00404030(liveObj);
			pAVar2 = FUN_004040c0(liveObj);
			if (pAVar2 == NULL) {
				liveObj->aitask_2f0 = pAVar1;
			}
			else {
				pAVar2->next = pAVar1;
			}
			param_1 = (int *)((LiveObject **)param_1 + 1);
			param_2 += -1;
		} while (param_2 != 0);
	}
	return;
}



void __cdecl FUN_004035f0(int param_1,LiveObject *param_2)
{
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	
	pAVar1 = lego::pool::ReservedPool_AITask___Next(AITASK_FOLLOWATTACK);
	pAVar1->object_10 = param_2;
	pAVar1->unkExpiryTime = 0.0;
	pAVar2 = FUN_004040c0((LiveObject *)param_1);
	if (pAVar2 != NULL) {
		pAVar2->next = pAVar1;
		return;
	}
	*(AITaskData **)(param_1 + 0x2f0) = pAVar1;
	return;
}



void __cdecl FUN_00403630(int param_1,int param_2,int param_3,int param_4)
{
	AITaskData **ppAVar1;
	AITaskData *pAVar2;
	
	pAVar2 = lego::globals::g_AITaskUnkPtr;
	if (lego::globals::g_AITaskUnkPtr != NULL) {
		do {
			if (((pAVar2->taskType == AITASK_REQUEST) && (pAVar2->field_2c == param_1)) &&
				 ((param_2 == 0 || ((param_3 == pAVar2->objType && (param_4 == pAVar2->objIndex)))))) {
				pAVar2->flags_5c = pAVar2->flags_5c | 0x20;
			}
			ppAVar1 = &pAVar2->next;
			pAVar2 = *ppAVar1;
		} while (*ppAVar1 != NULL);
	}
	return;
}



void __cdecl
FUN_00403680(ObjectType objType,int objLevel,int objIndex,Point2I *position,undefined4 param_5,
						Point2F *pointFloat,BOOL param_7)
{
	int iVar1;
	AITaskData *aiTask;
	float10 fVar2;
	
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_REQUEST);
	aiTask->objType = objType;
	aiTask->objIndex = objLevel;
	aiTask->objLevel = objIndex;
	(aiTask->position).x = position->x;
	iVar1 = position->y;
	aiTask->field_2c = param_5;
	(aiTask->position).y = iVar1;
	if (pointFloat == NULL) {
		fVar2 = lego::game::Game_ChooseRandomRange(0.4,0.6);
		(aiTask->pointf_30).x = (float)fVar2;
		fVar2 = lego::game::Game_ChooseRandomRange(0.4,0.6);
		(aiTask->pointf_30).y = (float)fVar2;
	}
	else {
		(aiTask->pointf_30).x = pointFloat->x;
		(aiTask->pointf_30).y = pointFloat->y;
	}
	if (param_7 != 0) {
		aiTask->flags_5c = aiTask->flags_5c | 0x800;
	}
	aiTask->object_10 = NULL;
	aiTask->unkExpiryTime = 0.0;
	FUN_00403f60(aiTask,AIPRIORITY_REQUEST);
	aiTask->flags_5c = aiTask->flags_5c | 0x400;
	FUN_00403740(position,objType,objLevel,objIndex);
	return;
}



void __cdecl FUN_00403740(Point2I *position,ObjectType objType,int objIndex,int objLevel)
{
	LiveObject *pLVar1;
	int iVar2;
	LiveObject *liveObj;
	
	pLVar1 = FUN_00438d20(position,objType,objIndex,objLevel);
	if (pLVar1 == NULL) {
		if (((objIndex != 0) && (objType == OBJECT_ORE)) &&
			 (pLVar1 = FUN_00438d20(position,OBJECT_ORE,0,objLevel), pLVar1 != NULL)) {
			liveObj = FUN_00438da0(NULL,position,OBJECT_ORE,0);
			iVar2 = lego::game::LiveObject_GetMaxCarry(liveObj);
			if (iVar2 == 0) {
				return;
			}
			do {
				FUN_0043a910(pLVar1,OBJECT_ORE,0,objLevel);
				iVar2 += -1;
			} while (iVar2 != 0);
			return;
		}
	}
	else {
		iVar2 = FUN_0043a910(pLVar1,objType,objIndex,objLevel);
		if (iVar2 != 0) {
			return;
		}
	}
	iVar2 = objIndex * 0x10 + objType * 0xf0 + objLevel;
	(&DAT_004b44f4)[iVar2] = (&DAT_004b44f4)[iVar2] + 1;
	return;
}



AITaskData * __cdecl FUN_004037f0(LiveObject *liveObj,ObjectType objType,int objIndex,int objLevel)
{
	AITaskData *aiTask;
	
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_DEPOSITE);
	aiTask->object_10 = liveObj;
	aiTask->unkExpiryTime = 0.0;
	aiTask->objType = objType;
	aiTask->objIndex = objIndex;
	aiTask->objLevel = objLevel;
	FUN_00403f60(aiTask,AIPRIORITY_REFINING);
	aiTask->flags_5c = aiTask->flags_5c & 0xffffffef | 0x4c0;
	return aiTask;
}



void __cdecl FUN_00403840(LiveObject *liveObj)
{
	int iVar1;
	uint objIndex;
	ObjectType objType;
	uint objLevel;
	uint *puVar2;
	int local_8;
	uint local_4;
	
	objType = OBJECT_NONE;
	puVar2 = &DAT_004b44f4;
	do {
		objIndex = 0;
		do {
			objLevel = 0;
			do {
				local_8 = 0;
				local_4 = 0;
				if (*puVar2 != 0) {
					do {
						iVar1 = FUN_00404e40(objType,objIndex,objLevel);
						if ((iVar1 == 0) ||
							 (iVar1 = FUN_0043a910(liveObj,objType,objIndex,objLevel), iVar1 != 0)) {
							local_8 += 1;
						}
						local_4 += 1;
					} while (local_4 < *puVar2);
				}
				objLevel += 1;
				*puVar2 = *puVar2 - local_8;
				puVar2 = puVar2 + 1;
			} while (objLevel < 0x10);
			objIndex += 1;
		} while (objIndex < 0xf);
		objType += OBJECT_VEHICLE;
	} while (puVar2 < lego::globals::g_Priorities_bool2_TABLE);
	return;
}



void __cdecl FUN_004038d0(LiveObject *liveObj)
{
	AITaskData *aiTask;
	
	aiTask = FUN_004037f0(liveObj,OBJECT_NONE,-1,0);
	FUN_00401fa0(aiTask,AIPRIORITY_STORAGE);
	FUN_00403840(liveObj);
	return;
}



void __cdecl FUN_00403900(LiveObject *liveObj)
{
	AITaskData *aiTask;
	
	aiTask = lego::pool::ReservedPool_AITask___Next(AITASK_GOTOEAT);
	aiTask->object_10 = liveObj;
	aiTask->unkExpiryTime = 0.0;
	FUN_00403f60(aiTask,AIPRIORITY_CRYSTAL);
	aiTask->flags_5c = aiTask->flags_5c & 0xffffffef | 0xc0;
	return;
}



void __cdecl FUN_00403940(LiveObject *liveObj)
{
	FUN_00406470(FUN_00403960,liveObj);
	return;
}



undefined4 __cdecl FUN_00403960(int *param_1,int param_2)
{
	if ((*param_1 == 5) && (param_2 == param_1[4])) {
		param_1[0x17] = param_1[0x17] | 0x20;
	}
	return 0;
}



void __cdecl FUN_00403980(LiveObject *liveObj)
{
	uint uVar1;
	AITaskData *pAVar2;
	AITaskData *aiTask;
	
	if (((byte)lego::pool::globals::ReservedPool_AITask___g_INITFLAGS & 2) == 0) {
		aiTask = liveObj->aitask_2f0;
		while (aiTask != NULL) {
			uVar1 = aiTask->flags_5c;
			pAVar2 = aiTask->next;
			if (((uVar1 & 0x10) == 0) || ((uVar1 & 0x20) != 0)) {
				if (((uVar1 & 0x2000) == 0) || ((uVar1 & 0x20) != 0)) {
					lego::pool::ReservedPool_AITask___Release(aiTask,0);
					aiTask = pAVar2;
				}
				else {
					FUN_00403fa0(aiTask);
					aiTask = pAVar2;
				}
			}
			else {
				FUN_00403f60(aiTask,aiTask->priorityType);
				aiTask = pAVar2;
			}
		}
		liveObj->aitask_2f0 = NULL;
		FUN_00406470(FUN_00403a00,liveObj);
	}
	return;
}



BOOL __cdecl FUN_00403a00(AITaskData *aiTask,LiveObject *liveObj)
{
	if (liveObj == aiTask->object_10) {
		aiTask->flags_5c = aiTask->flags_5c | 0x20;
	}
	return 0;
}



void __cdecl FUN_00403a20(LiveObject *liveObj,BOOL param_2)
{
	AITaskData *pAVar1;
	
	pAVar1 = liveObj->aitask_2f0;
	if (pAVar1 != NULL) {
		if (param_2 == 0) {
			pAVar1->flags_5c = pAVar1->flags_5c & 0xfffffffe;
		}
		else {
			if (pAVar1->taskType == AITASK_GOTO) {
				FUN_00404110(liveObj);
				if (liveObj->objType == OBJECT_ROCKMONSTER) {
					lego::game::Level_AddMessageAction(MESSAGE_ROCKMONSTERGOTO_COMPLETE,liveObj,0,NULL);
					return;
				}
			}
		}
	}
	return;
}



void __cdecl FUN_00403a70(LiveObject *liveObj)
{
	uint *puVar1;
	
	if (liveObj->aitask_2f0 != NULL) {
		puVar1 = &liveObj->aitask_2f0->flags_5c;
		*puVar1 = *puVar1 & 0xfffffffe;
	}
	return;
}



void __cdecl FUN_00403a90(LiveObject *liveObj)
{
	LiveObject *carriedObj;
	uint uVar1;
	LiveObject **ppLVar2;
	
	if ((((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) &&
			((liveObj->flags1_3e0 & 0x2000) == LIVEOBJ1_NONE)) &&
		 (uVar1 = 0, liveObj->numCarriedObjects != 0)) {
		ppLVar2 = liveObj->carriedObjects;
		do {
			carriedObj = *ppLVar2;
			FUN_00403b30(liveObj,AITASK_DEPOSITE,carriedObj);
			FUN_00403b30(liveObj,AITASK_DUMP,carriedObj);
			FUN_00403b30(liveObj,AITASK_DYNAMITE,carriedObj);
			FUN_00403b30(liveObj,AITASK_ELECFENCE,carriedObj);
			FUN_00403b30(liveObj,AITASK_REQUEST,carriedObj);
			FUN_00403b30(liveObj,AITASK_GATHER,NULL);
			FUN_00403b30(liveObj,AITASK_SONICBLASTER,carriedObj);
			uVar1 += 1;
			ppLVar2 = ppLVar2 + 1;
		} while (uVar1 < liveObj->numCarriedObjects);
	}
	return;
}



void __cdecl FUN_00403b30(LiveObject *holderObj,AITaskType taskType,LiveObject *carriedObj)
{
	AITaskData **ppAVar1;
	AITaskType AVar2;
	LevelSurfaceMap *pLVar3;
	AITaskData *pAVar4;
	AITaskData *pAVar5;
	int iVar6;
	int iVar7;
	
	if (((byte)lego::pool::globals::ReservedPool_AITask___g_INITFLAGS & 2) != 0) {
		return;
	}
	pAVar4 = NULL;
	pAVar5 = holderObj->aitask_2f0;
	if (pAVar5 == NULL) {
		return;
	}
	while (taskType != pAVar5->taskType) {
		ppAVar1 = &pAVar5->next;
		pAVar4 = pAVar5;
		pAVar5 = *ppAVar1;
		if (*ppAVar1 == NULL) {
			return;
		}
	}
	AVar2 = pAVar5->taskType;
	if (AVar2 == AITASK_DEPOSITE) {
LAB_00403b90:
		if (AVar2 == AITASK_REQUEST) goto LAB_00403b95;
	}
	else {
		if (AVar2 != AITASK_REQUEST) {
			if ((((AVar2 != AITASK_DUMP) && (AVar2 != AITASK_COLLECT)) && (AVar2 != AITASK_DYNAMITE)) &&
				 ((AVar2 != AITASK_ELECFENCE && (AVar2 != AITASK_SONICBLASTER)))) goto LAB_00403c01;
			goto LAB_00403b90;
		}
LAB_00403b95:
		FUN_00403680(pAVar5->objType,pAVar5->objIndex,pAVar5->objLevel,&pAVar5->position,
								 pAVar5->field_2c,&pAVar5->pointf_30,pAVar5->flags_5c & 0x800);
	}
	if (pAVar5->taskType == AITASK_DYNAMITE) {
		lego::game::Level_SetBlockFlags1_8000000(&pAVar5->position,0);
		iVar7 = (pAVar5->position).y;
		iVar6 = (pAVar5->position).x;
		pLVar3 = lego::game::GetSurfaceMap();
		FUN_0044f830(pLVar3,iVar6,iVar7);
	}
	FUN_00402650(carriedObj,150.0);
	FUN_00402780(carriedObj);
LAB_00403c01:
	if (pAVar4 == NULL) {
		holderObj->aitask_2f0 = pAVar5->next;
		lego::pool::ReservedPool_AITask___Release(pAVar5,0);
		return;
	}
	pAVar4->next = pAVar5->next;
	lego::pool::ReservedPool_AITask___Release(pAVar5,0);
	return;
}



void __cdecl FUN_00403c40(LiveObject *liveObj1,int param_2,LiveObject *liveObj2,BOOL param_4)
{
	Point2I *pPVar1;
	bool bVar2;
	LiveObject *liveObj;
	AITaskData *pAVar3;
	LiveObject *pLVar4;
	int iVar5;
	LevelBlockFlags1 LVar6;
	AITaskData *pAVar7;
	AITaskData *pAVar8;
	int iVar9;
	
	liveObj = liveObj1;
	if (((byte)lego::pool::globals::ReservedPool_AITask___g_INITFLAGS & 2) == 0) {
		if ((param_2 == 3) &&
			 (pLVar4 = FUN_00438da0(liveObj1,NULL,liveObj2->objType,liveObj2->objLevel), pLVar4 != NULL))
		{
			lego::game::Level_AddMessageAction(MESSAGE_COLLECTCRYSTAL_COMPLETE,liveObj1,(BOOL)pLVar4,NULL)
			;
		}
		pAVar3 = liveObj1->aitask_2f0;
		pAVar8 = NULL;
		if (liveObj1->aitask_2f0 != NULL) {
LAB_00403c9a:
			pAVar7 = pAVar3;
			if (param_2 != pAVar7->taskType) goto code_r0x00403ca4;
			liveObj1 = NULL;
			bVar2 = false;
			if (param_4 != 0) {
				if (pAVar8 == NULL) {
					liveObj->aitask_2f0 = pAVar7->next;
				}
				else {
					pAVar8->next = pAVar7->next;
				}
			}
			if (pAVar7->taskType == AITASK_REQUEST) {
				iVar9 = pAVar7->field_2c;
				bVar2 = true;
				liveObj1 = liveObj2;
				iVar5 = FUN_00408ca0(iVar9,liveObj2->objType,liveObj2->objIndex);
				if (iVar5 == 0) {
					FUN_00403630(iVar9,1,liveObj2->objType,liveObj2->objIndex);
					bVar2 = false;
				}
			}
			else {
				iVar9 = param_2;
				if (pAVar7->taskType == AITASK_CLEAR) {
					if (liveObj->objType == OBJECT_VEHICLE) {
						for (LVar6 = (lego::globals::g_Game.level)->blocks
												 [(pAVar7->position).y * ((lego::globals::g_Game.level)->dimensions).width +
													(pAVar7->position).x].flags1 & BLOCK1_RUBBLE_FULL; LVar6 != BLOCK1_NONE;
								LVar6 += ~BLOCK1_NONE) {
							FUN_00432bc0(&pAVar7->position);
							lego::game::Level_AddMessageAction
												(*(MessageType *)&pAVar7->field_0x54,0,0,(undefined4 *)&pAVar7->position);
						}
					}
					pPVar1 = &pAVar7->position;
					FUN_00432bc0(pPVar1);
					lego::game::Level_AddMessageAction
										(*(MessageType *)&pAVar7->field_0x54,0,0,(undefined4 *)pPVar1);
					FUN_00432640((int *)pPVar1,0);
					FUN_00433050((int *)pPVar1,0);
				}
				else {
					if (param_2 == 0x17) {
						lego::game::LiveObject_TrainMiniFigure_instantunk(liveObj,pAVar7->mode_3c);
						lego::front::Text_DisplayType(TEXT_MANTRAINED,1,0);
					}
				}
			}
			if (param_4 != 0) {
				lego::pool::ReservedPool_AITask___Release(pAVar7,0);
			}
			if (bVar2) {
				FUN_00408c10(iVar9,liveObj1);
			}
		}
LAB_00403dfc:
		if (param_2 == 3) {
			FUN_00403e20(liveObj2);
		}
	}
	return;
code_r0x00403ca4:
	pAVar3 = pAVar7->next;
	pAVar8 = pAVar7;
	if (pAVar7->next == NULL) goto LAB_00403dfc;
	goto LAB_00403c9a;
}



void __cdecl FUN_00403e20(LiveObject *liveObj)
{
	FUN_00406470(FUN_00403e40,liveObj);
	return;
}



undefined4 __cdecl FUN_00403e40(AITaskData *aiTask,LiveObject *liveObj)
{
	if ((aiTask->taskType == AITASK_COLLECT) && (aiTask->object_10 == liveObj)) {
		aiTask->flags_5c = aiTask->flags_5c | 0x20;
	}
	return 0;
}



void __cdecl FUN_00403e60(LiveObject *liveObj)
{
	AITaskData *pAVar1;
	
	if ((liveObj->aitask_2f0 == NULL) || (liveObj->aitask_2f0->taskType != AITASK_ANIMATIONWAIT)) {
		pAVar1 = lego::pool::ReservedPool_AITask___Next(AITASK_ANIMATIONWAIT);
		pAVar1->next = liveObj->aitask_2f0;
		liveObj->aitask_2f0 = pAVar1;
	}
	return;
}



void __cdecl FUN_00403e90(LiveObject *liveObj)
{
	if ((liveObj->aitask_2f0 != NULL) && (liveObj->aitask_2f0->taskType == AITASK_ANIMATIONWAIT)) {
		FUN_00404110(liveObj);
	}
	return;
}



void __cdecl FUN_00403f60(AITaskData *aiTask,AIPriorityType priorityIndex)
{
	aiTask->next = lego::globals::g_AITaskUnkPtr;
	lego::globals::g_AITaskUnkPtr = aiTask;
	aiTask->unkExpiryTime = 1500.0;
	aiTask->flags_5c = aiTask->flags_5c & 0xfffffffe | 0x10;
	aiTask->priorityValue = lego::globals::g_AIPriorityValues_TABLE[priorityIndex];
	aiTask->priorityType = priorityIndex;
	return;
}



void __cdecl FUN_00403fa0(AITaskData *aiTask)
{
	aiTask->next = lego::globals::g_AITaskDataNext;
	lego::globals::g_AITaskDataNext = aiTask;
	aiTask->unkExpiryTime = 1500.0;
	aiTask->flags_5c = aiTask->flags_5c & 0xffffffee;
	return;
}



void __cdecl lego::game::Game_UnkLiveObjectHandleDynamite(LiveObject *liveObj)
{
	if (((byte)pool::globals::ReservedPool_AITask___g_INITFLAGS & 6) == 0) {
		FUN_00403b30(liveObj,AITASK_GOTO,NULL);
		if (((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) &&
			 (liveObj->carriedObjects[0]->objType == OBJECT_DYNAMITE)) {
			FUN_00403b30(liveObj,AITASK_DYNAMITE,liveObj->carriedObjects[0]);
		}
		FUN_00404030(liveObj);
		LiveObject__ReleaseTaskReferences(liveObj);
	}
	return;
}



void __cdecl FUN_00404030(LiveObject *liveObj)
{
	uint uVar1;
	AITaskData *pAVar2;
	AITaskData *pAVar3;
	AITaskData *pAVar4;
	
	pAVar3 = NULL;
	pAVar2 = liveObj->aitask_2f0;
	while (pAVar4 = pAVar2, pAVar4 != NULL) {
		uVar1 = pAVar4->flags_5c;
		pAVar2 = pAVar4->next;
		if ((uVar1 & 4) == 0) {
			if (((uVar1 & 0x10) == 0) || ((uVar1 & 0x20) != 0)) {
				if (((uVar1 & 0x2000) == 0) || ((uVar1 & 0x20) != 0)) {
					if (pAVar3 == NULL) {
						pAVar4->next = NULL;
						pAVar3 = pAVar4;
					}
					else {
						pAVar3->next = pAVar4;
						pAVar4->next = NULL;
					}
				}
				else {
					pAVar4->next = lego::globals::g_AITaskDataNext;
					lego::globals::g_AITaskDataNext = pAVar4;
				}
			}
			else {
				pAVar4->next = lego::globals::g_AITaskUnkPtr;
				lego::globals::g_AITaskUnkPtr = pAVar4;
			}
		}
		else {
			lego::pool::ReservedPool_AITask___Release(pAVar4,0);
		}
	}
	liveObj->aitask_2f0 = pAVar3;
	return;
}



AITaskData * __cdecl FUN_004040c0(LiveObject *liveObj)
{
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	
	pAVar2 = liveObj->aitask_2f0;
	if (pAVar2 != NULL) {
		for (pAVar1 = pAVar2->next; pAVar1 != NULL; pAVar1 = pAVar1->next) {
			pAVar2 = pAVar1;
		}
	}
	return pAVar2;
}



BOOL __cdecl lego::game::LiveObject_IsCurrentTaskType(LiveObject *liveObj,AITaskType taskType)
{
	AITaskData *pAVar1;
	
	pAVar1 = liveObj->aitask_2f0;
	if (pAVar1 == NULL) {
		return (BOOL)NULL;
	}
	do {
		if (taskType == pAVar1->taskType) {
			return (BOOL)(AITaskData *)0x1;
		}
		pAVar1 = pAVar1->next;
	} while (pAVar1 != NULL);
	return (BOOL)pAVar1;
}



AITaskData * __cdecl FUN_00404110(LiveObject *liveObj)
{
	AITaskData *pAVar1;
	uint uVar2;
	
	pAVar1 = liveObj->aitask_2f0;
	if (pAVar1 != NULL) {
		liveObj->aitask_2f0 = pAVar1->next;
		uVar2 = pAVar1->flags_5c;
		if (((uVar2 & 0x10) != 0) && ((uVar2 & 0x20) == 0)) {
			pAVar1->next = lego::globals::g_AITaskUnkPtr;
			lego::globals::g_AITaskUnkPtr = pAVar1;
			return liveObj->aitask_2f0;
		}
		if (((uVar2 & 0x2000) != 0) && ((uVar2 & 0x20) == 0)) {
			pAVar1->next = lego::globals::g_AITaskDataNext;
			lego::globals::g_AITaskDataNext = pAVar1;
			return liveObj->aitask_2f0;
		}
		lego::pool::ReservedPool_AITask___Release(pAVar1,0);
	}
	return liveObj->aitask_2f0;
}



undefined4 __cdecl FUN_00404180(int param_1,float *param_2)
{
	if ((*(byte *)(param_1 + 0x5c) & 0x80) == 0) {
		*(float *)(param_1 + 0x14) = *(float *)(param_1 + 0x14) - *param_2;
	}
	*(float *)(param_1 + 0x18) = *(float *)(param_1 + 0x18) - *param_2;
	return 0;
}



undefined4 __cdecl FUN_004041b0(LiveObject *liveObj,float *param_2)
{
	float fVar1;
	AITaskType AVar2;
	LiveObject *pLVar3;
	ObjectType OVar4;
	LiveObject *pLVar5;
	bool bVar6;
	bool bVar7;
	BOOL BVar8;
	int iVar9;
	ObjectStatsFlags1 OVar10;
	LevelSurfaceMap *surfMap;
	AITaskData *pAVar11;
	float fVar12;
	uint uVar13;
	LiveObject *pLVar14;
	float10 fVar15;
	uint x;
	float *pfVar16;
	void *local_6c;
	void *local_68;
	undefined local_64 [4];
	float local_60;
	VehicleData *local_5c;
	float local_58;
	VehicleData *local_54;
	float local_50;
	VehicleData *local_4c;
	float local_48;
	VehicleData *local_44;
	float local_40;
	float local_3c;
	uint local_38;
	int local_34;
	float local_30;
	float local_2c;
	float local_18;
	float local_14;
	
	pLVar3 = liveObj;
	lego::pool::globals::ReservedPool_AITask___g_INITFLAGS |= 4;
	if (((((((liveObj->flags3_3e8 & 0x400000) == LIVEOBJ3_NONE) ||
				 ((ushort)((ushort)(liveObj->health < 0.0) << 8 | (ushort)(liveObj->health == 0.0) << 0xe)
					!= 0)) || (BVar8 = FUN_004294f0(liveObj), pfVar16 = param_2, BVar8 != 0)) ||
			 ((liveObj->drivenObject != NULL && (liveObj->objType == OBJECT_MINIFIGURE)))) ||
			(liveObj->carryingThisObject != NULL)) ||
		 (((liveObj->flags2_3e4 & 0x8004000) != LIVEOBJ2_NONE ||
			((liveObj->flags1_3e0 & 0x800000) != LIVEOBJ1_NONE)))) goto LAB_00404c90;
	pAVar11 = liveObj->aitask_2f0;
	local_6c = NULL;
	if (pAVar11 == NULL) {
		local_60 = 0.0;
		local_5c = NULL;
		liveObj->float_338 = *param_2 + liveObj->float_338;
		lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_38,&local_34);
		if (((liveObj->float_338 == *pfVar16) || ((*(byte *)&liveObj->flags4_3ec & 0xc0) != 0)) ||
			 (BVar8 = FUN_004439d0(liveObj,&local_38,&local_60,0), BVar8 == 0)) {
			if ((ushort)((ushort)(liveObj->float_338 < 250.0) << 8 |
									(ushort)(liveObj->float_338 == 250.0) << 0xe) == 0) {
				if ((liveObj->objType == OBJECT_MINIFIGURE) && (BVar8 = FUN_004294f0(liveObj), BVar8 == 0))
				{
					FUN_00443930(liveObj);
				}
				liveObj->float_338 = 0.0;
			}
			else {
				liveObj = NULL;
				pLVar14 = (LiveObject *)lego::globals::g_AITaskUnkPtr;
				pLVar5 = (LiveObject *)lego::globals::g_AITaskUnkPtr;
				if (lego::globals::g_AITaskUnkPtr == NULL) {
LAB_00404c21:
					if (pLVar14 != NULL) {
						FUN_00406290((undefined4 *)pLVar14,(int)liveObj,pLVar3);
						goto LAB_00404c90;
					}
				}
				else {
					do {
						pLVar14 = pLVar5;
						fVar12 = pLVar14->floats_34[10];
						if ((((((uint)fVar12 & 0x80000) == 0) &&
								 ((((uint)fVar12 & 0x100000) != 0 ||
									((BVar8 = FUN_00439c80(pLVar3), BVar8 == 0 &&
									 (fVar12 = pLVar14->floats_34[10], ((uint)fVar12 & 0x400) == 0)))))) &&
								((((uint)fVar12 & 0x100) != 0 || (BVar8 = FUN_004528d0(pLVar3,NULL), BVar8 == 0))))
							 && ((((uint)pLVar14->floats_34[10] & 0x100) == 0 ||
									 (BVar8 = lego::game::LiveObject_FindIndexOfInTable
																			((LiveObject **)pLVar14->floats_34[3],
																			 (uint)pLVar14->floats_34[4],pLVar3,NULL), BVar8 != 0)))) {
							local_58 = (float)((Point2I *)&pLVar14->customName)->x;
							local_54 = pLVar14->vehicle;
							iVar9 = FUN_00404ef0((int *)pLVar14,pLVar3,NULL,&local_58,&param_2,1,1);
							if ((iVar9 != 0) && (param_2 == NULL)) {
								if (((uint)pLVar14->floats_34[10] & 0x100000) != 0) goto LAB_00404c21;
								lego::game::LiveObject_GetBlockCoordinates(pLVar3,(int *)&local_50,(int *)&local_4c)
								;
								OVar4 = pLVar14->objType;
								if ((((OVar4 == OBJECT_UPGRADEPART) || (OVar4 == OBJECT_ELECTRICFENCE)) ||
										(OVar4 == 0x17)) ||
									 ((OVar4 == 0x15 ||
										((OVar4 == OBJECT_DYNAMITE && ((*(byte *)(pLVar14->floats_34 + 10) & 8) == 0))))
									 )) {
									if (((local_58 == local_50) &&
											(uVar13 = (int)(VehicleData *)((int)local_54 - (int)local_4c) >> 0x1f,
											((uint)(VehicleData *)((int)local_54 - (int)local_4c) ^ uVar13) - uVar13 == 1)
											) || ((local_54 == local_4c &&
														(uVar13 = (int)local_58 - (int)local_50 >> 0x1f,
														((int)local_58 - (int)local_50 ^ uVar13) - uVar13 == 1))))
									goto LAB_00404c21;
								}
								else {
									if ((local_58 == local_50) && (local_54 == local_4c)) goto LAB_00404c21;
								}
							}
						}
						if ((((((uint)pLVar14->floats_34[10] & 0x400) != 0) &&
								 (BVar8 = FUN_00439c80(pLVar3), BVar8 != 0)) &&
								((pLVar3->flags3_3e8 & 0x200000) == LIVEOBJ3_NONE)) &&
							 (pLVar3->objType != OBJECT_ROCKMONSTER)) {
							pLVar5 = pLVar3->carriedObjects[0];
							if ((pLVar5->flags3_3e8 & 0x80000000) == LIVEOBJ3_NONE) {
								if ((pLVar14->upgrade == NULL) ||
									 (((pLVar5->objLevel == pLVar14->routingBlocksTotal &&
										 ((pLVar14->routeptr_24 == (void *)0xffffffff ||
											((void *)pLVar5->objIndex == pLVar14->routeptr_24)))) &&
										((UpgradeData *)pLVar5->objType == pLVar14->upgrade)))) {
									OVar4 = pLVar14->objType;
									bVar6 = false;
									bVar7 = false;
									if (((OVar4 == OBJECT_ORE) || (OVar4 == OBJECT_BARRIER)) ||
										 ((OVar4 == OBJECT_PATH || (OVar4 == 0x14)))) {
LAB_00404b3f:
										bVar6 = true;
									}
									else {
										if (OVar4 == OBJECT_BOULDER) {
											if ((LiveObject *)pLVar14->miniFigure == NULL) goto LAB_00404b3f;
											BVar8 = FUN_00438870((LiveObject *)pLVar14->miniFigure,0);
											if (BVar8 != 0) {
												BVar8 = FUN_0043a5c0(pLVar3,(LiveObject *)pLVar14->miniFigure);
												if (BVar8 != 0) goto LAB_00404c21;
												bVar7 = true;
											}
										}
									}
									if (bVar6) {
										if (pLVar14->objType == OBJECT_BARRIER) {
											iVar9 = FUN_00431ba0((int *)pLVar3,(int *)&pLVar14->customName,
																					 (int *)&local_48,1);
											if (iVar9 == 0) {
												bVar7 = true;
											}
										}
										else {
											local_48 = (float)((Point2I *)&pLVar14->customName)->x;
											local_44 = pLVar14->vehicle;
										}
										if (!bVar7) {
											lego::game::LiveObject_GetBlockCoordinates
																(pLVar3,(int *)&local_40,(int *)&local_3c);
											iVar9 = FUN_00440ef0(pLVar3,local_40,local_3c,local_48,local_44,&local_6c,
																					 &local_68,local_64);
											if (iVar9 == 0) {
												bVar7 = true;
												goto LAB_00404bc6;
											}
											std::free(local_6c);
											std::free(local_68);
											goto LAB_00404c21;
										}
									}
									else {
LAB_00404bc6:
										if (!bVar7) goto LAB_00404bd1;
									}
									pLVar14->building = (BuildingData *)0x42960000;
								}
							}
							else {
								if (pLVar14->objType == 0x1b) goto LAB_00404c21;
							}
						}
LAB_00404bd1:
						if ((((uint)pLVar14->floats_34[10] & 0x100) != 0) &&
							 (BVar8 = lego::game::LiveObject_FindIndexOfInTable
																	((LiveObject **)pLVar14->floats_34[3],(uint)pLVar14->floats_34[4],
																	 pLVar3,NULL), BVar8 != 0)) {
							pLVar14 = NULL;
							goto LAB_00404c21;
						}
						pLVar5 = (LiveObject *)pLVar14->floats_34[0xb];
						liveObj = pLVar14;
					} while ((LiveObject *)pLVar14->floats_34[0xb] != NULL);
				}
				BVar8 = FUN_00439c80(pLVar3);
				if (BVar8 == 0) {
					if ((uint)INT_004b4424 < 0x32) {
						(&DAT_004b435c)[INT_004b4424] = pLVar3;
						INT_004b4424 += 1;
					}
					if (((UINT_004b44f0 < 0x32) && (pLVar3->objType == OBJECT_ROCKMONSTER)) &&
						 ((pLVar3->flags3_3e8 & 0x80000000) == LIVEOBJ3_NONE)) {
						(&DAT_004b4428)[UINT_004b44f0] = pLVar3;
						UINT_004b44f0 += 1;
					}
				}
			}
		}
		else {
			if ((local_60 != 0.0) && (local_5c != NULL)) {
				pAVar11 = lego::pool::ReservedPool_AITask___Next(AITASK_GOTO);
				liveObj->aitask_2f0 = pAVar11;
				(pAVar11->position).x = (int)local_60;
				(pAVar11->position).y = (int)local_5c;
			}
		}
		goto LAB_00404c90;
	}
	liveObj->float_338 = 0.0;
	uVar13 = pAVar11->flags_5c;
	if ((uVar13 & 0x20) != 0) {
		FUN_00404110(liveObj);
		lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,0);
		goto LAB_00404c90;
	}
	AVar2 = pAVar11->taskType;
	if ((AVar2 == AITASK_WAIT) &&
		 ((ushort)((ushort)(pAVar11->unkExpiryTime < 0.0) << 8 |
							(ushort)(pAVar11->unkExpiryTime == 0.0) << 0xe) != 0)) {
		FUN_00404110(liveObj);
	}
	else {
		if (AVar2 == AITASK_FOLLOW) {
			if ((ushort)((ushort)(pAVar11->unkExpiryTime < 0.0) << 8 |
									(ushort)(pAVar11->unkExpiryTime == 0.0) << 0xe) != 0) {
				lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_48,(int *)&local_44);
				lego::game::LiveObject_GetBlockCoordinates
									(pAVar11->object_10,(int *)&local_50,(int *)&local_4c);
				if ((local_48 == local_50) && (local_44 == local_4c)) goto LAB_0040441c;
LAB_004043f4:
				FUN_00404d30((float *)liveObj,&local_50,NULL);
				pAVar11->unkExpiryTime = 50.0;
			}
		}
		else {
			if (AVar2 == AITASK_FOLLOWATTACK) {
				if ((ushort)((ushort)(pAVar11->unkExpiryTime < 0.0) << 8 |
										(ushort)(pAVar11->unkExpiryTime == 0.0) << 0xe) != 0) {
					fVar12 = pAVar11->object_10->health;
					fVar1 = pAVar11->object_10->stats->PainThreshold;
					if ((ushort)((ushort)(fVar12 < fVar1) << 8 | (ushort)(fVar12 == fVar1) << 0xe) == 0) {
						lego::game::LiveObject_GetPosition(liveObj,&local_48,(float *)&local_44);
						lego::game::LiveObject_GetPosition(pAVar11->object_10,&local_58,(float *)&local_54);
						fVar12 = SQRT(((float)local_44 - (float)local_54) * ((float)local_44 - (float)local_54)
													+ (local_48 - local_58) * (local_48 - local_58));
						if ((ushort)((ushort)(fVar12 < 130.0) << 8 | (ushort)(fVar12 == 130.0) << 0xe) == 0) {
							lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_60,(int *)&local_5c);
							lego::game::LiveObject_GetBlockCoordinates
												(pAVar11->object_10,(int *)&local_50,(int *)&local_4c);
							if ((local_60 != local_50) || (local_5c != local_4c)) goto LAB_004043f4;
						}
						else {
							iVar9 = FUN_00442190(liveObj,(int *)pAVar11->object_10,2);
							if (iVar9 == 0) {
								pAVar11->unkExpiryTime = 25.0;
								goto LAB_004047ed;
							}
						}
LAB_0040441c:
						pAVar11->unkExpiryTime = 50.0;
					}
					else {
						pAVar11->flags_5c = uVar13 | 0x20;
					}
				}
			}
			else {
				if (((uVar13 & 1) == 0) && ((liveObj->flags3_3e8 & 0x200000) == LIVEOBJ3_NONE)) {
					iVar9 = 1;
					if (true) {
						switch(AVar2) {
						case AITASK_GOTO:
							lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_48,(int *)&local_44);
							if ((local_48 == (float)(pAVar11->position).x) &&
								 (local_44 == (VehicleData *)(pAVar11->position).y)) {
								iVar9 = 1;
								FUN_00404110(liveObj);
							}
							else {
								uVar13 = (pAVar11->position).y;
								x = (pAVar11->position).x;
								pfVar16 = &local_30;
								surfMap = lego::game::GetSurfaceMap();
								FUN_00450390(surfMap,x,uVar13,pfVar16);
								fVar15 = lego::game::Game_ChooseRandomRange(local_30 - -6.0,local_18 - 6.0);
								local_40 = (float)fVar15;
								fVar15 = lego::game::Game_ChooseRandomRange(local_14 - -6.0,local_2c - 6.0);
								local_3c = (float)fVar15;
								OVar10 = lego::game::LiveObject_GetStatsFlags1(liveObj);
								iVar9 = FUN_00404d30((float *)liveObj,(float *)&pAVar11->position,
																		 (float *)(-(uint)((OVar10 & STATS1_ROUTEAVOIDANCE) !=
																											STATS1_NONE) & (uint)&local_40));
							}
							break;
						case AITASK_COLLECT:
							iVar9 = FUN_00439ce0(liveObj,pAVar11->object_10);
							break;
						case AITASK_GATHER:
							iVar9 = FUN_00447390(liveObj);
							break;
						case AITASK_DEPOSITE:
							iVar9 = FUN_0043a5c0(liveObj,pAVar11->object_10);
							break;
						case AITASK_DUMP:
							iVar9 = FUN_0043a3e0((int *)liveObj,(float *)&pAVar11->position,
																	 (float *)&pAVar11->pointf_30,1,uVar13 & 0x800);
							break;
						case AITASK_REQUEST:
							iVar9 = FUN_0043a3e0((int *)liveObj,(float *)&pAVar11->position,
																	 (float *)&pAVar11->pointf_30,1,uVar13 & 0x800);
							break;
						case AITASK_DIG:
							if ((((uVar13 & 8) != 0) &&
									(OVar10 = lego::game::LiveObject_GetStatsFlags1(liveObj),
									(OVar10 & STATS1_SINGLEWIDTHDIG) != STATS1_NONE)) ||
								 ((*(byte *)&pAVar11->flags_5c & 8) == 0)) {
								iVar9 = FUN_00447100((int *)liveObj,(pAVar11->position).x,(pAVar11->position).y,
																		 pAVar11->flags_5c & 8);
							}
							break;
						case AITASK_DYNAMITE:
							iVar9 = FUN_00448ac0((int *)liveObj,(uint *)&pAVar11->position);
							break;
						case AITASK_REPAIR:
							iVar9 = FUN_00449360((int *)liveObj,(int *)pAVar11->object_10,1,uVar13 & 0x200000);
							break;
						case AITASK_REINFORCE:
							iVar9 = FUN_00449500((int *)liveObj,(uint *)&pAVar11->position);
							break;
						case AITASK_CLEAR:
							iVar9 = FUN_00449570((int *)liveObj,(float *)&pAVar11->position);
							break;
						case AITASK_ELECFENCE:
							iVar9 = FUN_00448d20((int *)liveObj,(float *)&pAVar11->position);
							break;
						case AITASK_EAT:
							iVar9 = FUN_00449d80(liveObj,pAVar11->object_10);
							break;
						case AITASK_GOTOEAT:
							iVar9 = FUN_00449d80(liveObj,pAVar11->object_10);
							break;
						case AITASK_FINDDRIVER:
							iVar9 = FUN_00440690((int *)liveObj,(float *)pAVar11->object_10);
							break;
						case AITASK_GETTOOL:
							iVar9 = FUN_0044b7c0((int *)liveObj,*(float **)&pAVar11->field_0x38);
							FUN_004072a0((int)liveObj);
							break;
						case AITASK_SONICBLASTER:
							iVar9 = FUN_00448b40((int *)liveObj,(float *)&pAVar11->position);
							break;
						case AITASK_UPGRADE:
							iVar9 = FUN_00448f50((int *)liveObj,(float *)pAVar11->object_10,pAVar11->objLevel);
							break;
						case AITASK_BUILDPATH:
							iVar9 = FUN_00448f10((uint *)liveObj);
							break;
						case AITASK_TRAIN:
							iVar9 = FUN_00449170((int *)liveObj,(int *)pAVar11->object_10,0);
							break;
						case AITASK_DEPART:
							iVar9 = FUN_004499c0(liveObj);
							break;
						case AITASK_ATTACKPATH:
							iVar9 = FUN_004498d0(liveObj,(float *)&pAVar11->position);
							break;
						case AITASK_ATTACKROCKMONSTER:
							pLVar3 = pAVar11->object_10;
							if ((pLVar3 == NULL) || (pLVar3->field_364 == 0)) {
LAB_0040469f:
								iVar9 = FUN_004496f0((int *)liveObj,(float *)pAVar11->object_10);
							}
							else {
								if ((pLVar3->flags2_3e4 & 0x8000000) == LIVEOBJ2_NONE) {
									iVar9 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
									if ((iVar9 == 0) ||
										 (pAVar11->object_10->stats->PainThreshold <= pAVar11->object_10->health))
									goto LAB_0040469f;
									iVar9 = 0;
								}
								else {
									iVar9 = 0;
								}
							}
							break;
						case AITASK_RECHARGE:
							iVar9 = FUN_004492d0((int *)liveObj);
							break;
						case AITASK_DOCK:
							iVar9 = FUN_004402b0((int *)liveObj);
							break;
						case AITASK_ATTACKOBJECT:
							iVar9 = FUN_004497e0((int *)liveObj,(undefined4 *)pAVar11->object_10);
							break;
						case AITASK_FINDLOAD:
							iVar9 = FUN_00440130((int *)liveObj,(float *)pAVar11->object_10);
						}
					}
					if (iVar9 == 0) {
						local_6c = (void *)0x1;
					}
					else {
						pAVar11->flags_5c = pAVar11->flags_5c | 1;
					}
				}
			}
		}
	}
LAB_004047ed:
	if (local_6c != NULL) {
		if ((pAVar11->taskType == AITASK_DIG) && ((*(byte *)&pAVar11->flags_5c & 8) != 0)) {
			pAVar11->float_18 = (float)&DAT_42c80000;
		}
		if (((*(byte *)&pAVar11->flags_5c & 0x10) != 0) && (pAVar11->unkExpiryTime < 0.0)) {
			pAVar11->unkExpiryTime = 1500.0;
		}
		FUN_00404110(liveObj);
	}
LAB_00404c90:
	lego::pool::globals::ReservedPool_AITask___g_INITFLAGS =
			 lego::pool::globals::ReservedPool_AITask___g_INITFLAGS & 0xfffffffb;
	return 0;
}



undefined4 __cdecl FUN_00404d30(float *param_1,float *param_2,float *param_3)
{
	float *liveObj;
	int iVar1;
	float *local_10;
	uint local_c;
	float local_8;
	float local_4;
	
	liveObj = param_1;
	lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_1,(int *)&local_8,(int *)&local_4);
	if ((local_8 == *param_2) && (local_4 == param_2[1])) {
		param_1 = &local_8;
		local_10 = &local_4;
		local_c = 1;
	}
	else {
		iVar1 = FUN_00440ef0(liveObj,local_8,local_4,*param_2,param_2[1],&param_1,&local_10,&local_c);
		if (iVar1 == 0) {
			return 0;
		}
	}
	FUN_004419c0((LiveObject *)liveObj,local_c,param_1,local_10,param_3);
	if (param_1 != &local_8) {
		std::free(param_1);
		std::free(local_10);
	}
	return 1;
}



void __cdecl FUN_00404e00(int *param_1)
{
	if ((*param_1 == OBJECT_POWERCRYSTAL) && ((param_1[0xfa] & 0x80000000U) != 0)) {
		FUN_0044a690(param_1,NULL);
		return;
	}
	FUN_00404e40(*param_1,param_1[1],param_1[0xcc]);
	return;
}



void __cdecl FUN_00404e40(ObjectType objType,int objIndex,int objLevel)
{
	ObjectType local_c;
	int local_8;
	char *local_4;
	
	local_c = objType;
	local_8 = objIndex;
	local_4 = (char *)objLevel;
	FUN_00406470(FUN_00404e80,(LiveObject *)&local_c);
	return;
}



undefined4 __cdecl FUN_00404e80(int *param_1,int *param_2)
{
	int iVar1;
	BOOL BVar2;
	
	iVar1 = *param_1;
	if (iVar1 != 5) {
		if (((iVar1 != 7) && (iVar1 != 9)) && (iVar1 != 0xf)) {
			return 0;
		}
		if (((iVar1 != 5) && ((LiveObject *)param_1[4] != NULL)) &&
			 (BVar2 = FUN_00438870((LiveObject *)param_1[4],0), BVar2 == 0)) {
			return 0;
		}
	}
	if ((param_1[8] != 0) &&
		 (((*param_2 != param_1[8] || ((param_1[9] != -1 && (param_2[1] != param_1[9])))) ||
			(param_2[2] != param_1[10])))) {
		return 0;
	}
	return 1;
}



undefined4 __cdecl
FUN_00404ef0(int *param_1,LiveObject *liveObj_2,float *param_3,float *param_4,undefined4 *param_5,
						int param_6,int param_7)
{
	int *piVar1;
	LiveFlags5 LVar2;
	ObjectStatsFlags1 OVar3;
	int iVar4;
	BOOL BVar5;
	ResourceData *pRVar6;
	ObjectStatsFlags3 OVar7;
	LevelSurfaceMap *pLVar8;
	LiveObject *liveObj;
	float10 fVar9;
	float fVar10;
	uint x;
	float y;
	uint uVar11;
	float *out_y;
	float *pfVar12;
	Vector3F local_18;
	Vector3F local_c;
	
	if (param_5 != NULL) {
		*param_5 = 0;
	}
	if (((*param_1 != 3) || (*(int *)param_1[4] != 8)) &&
		 ((ushort)((ushort)((float)param_1[6] < 0.0) << 8 | (ushort)((float)param_1[6] == 0.0) << 0xe)
			== 0)) {
		return 0;
	}
	OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj_2);
	if (((OVar3 & STATS1_CANBEDRIVEN) != STATS1_NONE) && (liveObj_2->drivenObject == NULL)) {
		return 0;
	}
	if ((liveObj_2->flags1_3e0 & 0x800000) != LIVEOBJ1_NONE) {
		return 0;
	}
	if ((liveObj_2->flags4_3ec & 0x400) != 0) {
		return 0;
	}
	if (((((byte)lego::globals::g_Game.flags2 & 1) != 0) &&
			(iVar4 = FUN_0044c7f0((int *)liveObj_2), iVar4 != 0)) && (*param_1 != 0x1a)) {
		return 0;
	}
	iVar4 = *param_1;
	if (iVar4 == 0x1a) {
		iVar4 = FUN_004496a0((int *)liveObj_2);
		if (iVar4 == 0) {
			return 0;
		}
		iVar4 = FUN_004723f0((undefined4 *)liveObj_2,(undefined4 *)param_1[4]);
		if (iVar4 == 0) {
			return 0;
		}
		iVar4 = FUN_00471c20((undefined4 *)liveObj_2,(undefined4 *)param_1[4]);
		if (iVar4 != 0) {
			return 0;
		}
		BVar5 = FUN_00438870((LiveObject *)param_1[4],1);
		if (BVar5 == 0) {
			return 0;
		}
		if (((byte)lego::globals::g_Game.flags2 & 1) == 0) {
			return 0;
		}
		if (param_3 != NULL) {
			lego::game::LiveObject_GetPosition((LiveObject *)param_1[4],param_3,param_3 + 1);
		}
		if (param_4 != NULL) {
			lego::game::LiveObject_GetBlockCoordinates
								((LiveObject *)param_1[4],(int *)param_4,(int *)(param_4 + 1));
			return 1;
		}
	}
	else {
		if (iVar4 == 0x1e) {
			pRVar6 = lego::game::LiveObject_GetDepositNull((LiveObject *)param_1[4]);
			if ((pRVar6 == NULL) ||
				 (OVar7 = lego::game::LiveObject_GetStatsFlags3(liveObj_2),
				 (OVar7 & STATS3_VEHICLECANBECARRIED) == STATS3_NONE)) {
				return 0;
			}
			lego::res::Res_GetPosition(pRVar6,NULL,&local_18);
			if (param_3 != NULL) {
				*param_3 = local_18.x;
				param_3[1] = local_18.y;
			}
			if (param_4 != NULL) {
				pfVar12 = param_4 + 1;
				pLVar8 = lego::game::GetSurfaceMap();
				lego::game::SurfaceMap_ToBlockCoordinatesNoZ
									(pLVar8,local_18.x,local_18.y,(int *)param_4,(int *)pfVar12);
				return 1;
			}
		}
		else {
			if (iVar4 == 3) {
				if ((*(byte *)&liveObj_2->flags3_3e8 & 0x40) == 0) {
					return 0;
				}
				BVar5 = FUN_00439e90(liveObj_2,(LiveObject *)param_1[4],1);
				if (BVar5 == 0) {
					return 0;
				}
				if ((liveObj_2->objType == OBJECT_VEHICLE) &&
					 (iVar4 = lego::game::LiveObject_GetMaxCarry(liveObj_2), iVar4 == 0)) {
					return 0;
				}
				piVar1 = (int *)param_1[4];
				iVar4 = *piVar1;
				if (((iVar4 == 8) && ((*(byte *)&liveObj_2->flags5_3f0 & 8) == 0)) && (param_7 != 0)) {
					return 0;
				}
				if ((liveObj_2->objType == OBJECT_ROCKMONSTER) && (iVar4 != 6)) {
					return 0;
				}
				if (liveObj_2->objType == OBJECT_VEHICLE) {
					if (iVar4 == 9) {
						return 0;
					}
					if (true) {
						if ((iVar4 == 6) && ((piVar1[0xfa] & 0x80000000U) != 0)) {
							return 0;
						}
						if (((true) && ((liveObj_2->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE)) &&
							 (liveObj_2->carriedObjects[0]->objType == OBJECT_ELECTRICFENCE)) {
							return 0;
						}
					}
				}
				iVar4 = FUN_00404e00(piVar1);
				if (iVar4 == 0) {
					return 0;
				}
				BVar5 = FUN_00439e40(liveObj_2,(undefined4 *)param_1[4]);
				if (BVar5 == 0) {
					return 0;
				}
				if (param_3 != NULL) {
					lego::game::LiveObject_GetPosition((LiveObject *)param_1[4],param_3,param_3 + 1);
				}
				if (param_4 != NULL) {
					lego::game::LiveObject_GetBlockCoordinates
										((LiveObject *)param_1[4],(int *)param_4,(int *)(param_4 + 1));
					return 1;
				}
			}
			else {
				if (((iVar4 == 8) || (iVar4 == 0)) || ((iVar4 == 0xb || (iVar4 == 0xc)))) {
					BVar5 = 1;
					if (iVar4 == 8) {
						BVar5 = FUN_004326a0(liveObj_2,param_1[2],param_1[3],param_1[0x17] & 8,1);
					}
					if (((param_6 != 0) && (iVar4 = *param_1, iVar4 != 0)) &&
						 ((iVar4 != 9 && (iVar4 = FUN_0044b780((int *)liveObj_2,iVar4), iVar4 == 0)))) {
						return 0;
					}
					if ((*param_1 == 0xb) && (liveObj_2->objType != OBJECT_MINIFIGURE)) {
						return 0;
					}
					if ((*param_1 == 0xc) &&
						 (OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj_2),
						 (OVar3 & STATS1_CANCLEARRUBBLE) == STATS1_NONE)) {
						return 0;
					}
					if (*param_1 == 8) {
						if ((*(byte *)&liveObj_2->flags3_3e8 & 2) == 0) {
							return 0;
						}
						if (BVar5 == 0) {
							return 0;
						}
						if (((*(byte *)(param_1 + 0x17) & 8) != 0) &&
							 (OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj_2),
							 (OVar3 & STATS1_SINGLEWIDTHDIG) == STATS1_NONE)) {
							return 0;
						}
					}
					if (param_3 != NULL) {
						uVar11 = param_1[3];
						pfVar12 = param_3 + 1;
						x = param_1[2];
						pLVar8 = lego::game::GetSurfaceMap();
						FUN_0044f900(pLVar8,x,uVar11,param_3,pfVar12);
					}
					if (param_4 != NULL) {
						*param_4 = (float)param_1[2];
						param_4[1] = (float)param_1[3];
					}
				}
				else {
					if (iVar4 == 10) {
						if ((param_6 != 0) && (iVar4 = FUN_0044b780((int *)liveObj_2,10), iVar4 == 0)) {
							return 0;
						}
						if (((param_7 != 0) && ((*(byte *)&liveObj_2->flags5_3f0 & 0x10) == 0)) &&
							 ((param_1[0x17] & 0x200000U) == 0)) {
							return 0;
						}
						if (liveObj_2->objType != OBJECT_MINIFIGURE) {
							return 0;
						}
						if (param_3 != NULL) {
							lego::game::LiveObject_GetPosition((LiveObject *)param_1[4],param_3,param_3 + 1);
							if (param_4 == NULL) {
								return 1;
							}
							lego::game::LiveObject_GetBlockCoordinates
												((LiveObject *)param_1[4],(int *)param_4,(int *)(param_4 + 1));
							return 1;
						}
					}
					else {
						if (iVar4 == 0x11) {
							BVar5 = FUN_00438870((LiveObject *)param_1[4],0);
							if (BVar5 == 0) {
								return 0;
							}
							if (((liveObj_2->objType == OBJECT_MINIFIGURE) &&
									((liveObj_2->flags2_3e4 & LIVEOBJ2_UNK_800) == LIVEOBJ2_NONE)) &&
								 (fVar10 = liveObj_2->health * 0.01 * lego::globals::g_Game.MinEnergyForEat,
								 (ushort)((ushort)(liveObj_2->energy < fVar10) << 8 |
												 (ushort)(liveObj_2->energy == fVar10) << 0xe) != 0)) {
								if ((liveObj_2->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE) {
									return 1;
								}
								return 0;
							}
							return 0;
						}
						if (iVar4 == 0x12) {
							if ((((liveObj_2->objType != OBJECT_MINIFIGURE) || (liveObj_2->aitask_2f0 != NULL)) ||
									(liveObj_2->drivenObject != NULL)) ||
								 (((param_1[0xf] & liveObj_2->flags5_3f0) == 0 && (param_7 != 0)))) {
								return 0;
							}
							OVar3 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1[4]);
							if ((OVar3 & STATS1_CROSSLAND) == STATS1_NONE) {
								if ((((*(byte *)(param_1[4] + 0x3ec) & 0x40) != 0) &&
										(piVar1 = *(int **)(param_1[4] + 0x2fc), piVar1 != NULL)) &&
									 ((*piVar1 == 4 &&
										(pRVar6 = lego::res::Building_GetEntranceNull((BuildingData *)piVar1[6]),
										pRVar6 != NULL)))) {
									lego::res::Res_GetPosition(pRVar6,NULL,&local_c);
									if (param_3 != NULL) {
										*param_3 = local_c.x;
										param_3[1] = local_c.y;
									}
									if (param_4 == NULL) {
										return 1;
									}
									pfVar12 = param_4 + 1;
									pLVar8 = lego::game::GetSurfaceMap();
									lego::game::SurfaceMap_ToBlockCoordinatesNoZ
														(pLVar8,local_c.x,local_c.y,(int *)param_4,(int *)pfVar12);
									return 1;
								}
								iVar4 = FUN_0043a100((undefined4 *)param_1[4],(uint *)&local_18);
								if (iVar4 == 0) {
									return 0;
								}
								if (param_3 != NULL) {
									pfVar12 = param_3 + 1;
									fVar10 = local_18.x;
									y = local_18.y;
									pLVar8 = lego::game::GetSurfaceMap();
									FUN_0044f900(pLVar8,(uint)fVar10,(uint)y,param_3,pfVar12);
								}
								if (param_4 == NULL) {
									return 1;
								}
								*param_4 = local_18.x;
								param_4[1] = local_18.y;
								return 1;
							}
							if (param_3 != NULL) {
								lego::game::LiveObject_GetPosition((LiveObject *)param_1[4],param_3,param_3 + 1);
								if (param_4 == NULL) {
									return 1;
								}
								lego::game::LiveObject_GetBlockCoordinates
													((LiveObject *)param_1[4],(int *)param_4,(int *)(param_4 + 1));
								return 1;
							}
						}
						else {
							if (iVar4 == 0x15) {
								if (liveObj_2->objType != OBJECT_VEHICLE) {
									return 0;
								}
								if (liveObj_2->drivenObject != NULL) {
									pRVar6 = lego::game::LiveObject_GetDepositNull((LiveObject *)param_1[4]);
									lego::res::Res_GetPosition(pRVar6,NULL,&local_c);
									if (param_3 != NULL) {
										*param_3 = local_c.x;
										param_3[1] = local_c.y;
									}
									if (param_4 == NULL) {
										return 1;
									}
									pfVar12 = param_4 + 1;
									pLVar8 = lego::game::GetSurfaceMap();
									lego::game::SurfaceMap_ToBlockCoordinatesNoZ
														(pLVar8,local_c.x,local_c.y,(int *)param_4,(int *)pfVar12);
									return 1;
								}
								return 0;
							}
							if (iVar4 != 0x17) {
								if (iVar4 != 0x16) {
									if (iVar4 == 0x13) {
										if (((liveObj_2->objType == OBJECT_MINIFIGURE) &&
												(iVar4 = lego::game::LiveObject_GetNumOfToolsCanCarry(liveObj_2), iVar4 != 0
												)) && (BVar5 = lego::game::LiveObject_HasToolEquipped
																								 (liveObj_2,param_1[0xe]), BVar5 == 0)) {
											lego::game::LiveObject_GetPosition(liveObj_2,(float *)&local_18,&local_18.y);
											liveObj = (LiveObject *)FUN_004390b0((Point2F *)&local_18);
											if (liveObj != NULL) {
												if (param_3 == NULL) {
													return 1;
												}
												lego::game::LiveObject_GetPosition(liveObj,param_3,param_3 + 1);
												return 1;
											}
										}
										return 0;
									}
									if (param_5 == NULL) {
										return 1;
									}
									*param_5 = 1;
									return 1;
								}
								if (liveObj_2->objType != OBJECT_MINIFIGURE) {
									return 0;
								}
								pfVar12 = (float *)(param_1 + 2);
								iVar4 = lego::util::return_1(pfVar12);
								if (iVar4 != 0) {
									if (param_3 != NULL) {
										uVar11 = param_1[3];
										out_y = param_3 + 1;
										fVar10 = *pfVar12;
										pLVar8 = lego::game::GetSurfaceMap();
										FUN_0044f900(pLVar8,(uint)fVar10,uVar11,param_3,out_y);
									}
									if (param_4 == NULL) {
										return 1;
									}
									*param_4 = *pfVar12;
									param_4[1] = (float)param_1[3];
									return 1;
								}
								return 0;
							}
							if (liveObj_2->objType != OBJECT_MINIFIGURE) {
								return 0;
							}
							LVar2 = liveObj_2->flags5_3f0;
							if (((LVar2 & 1) != 0) && (param_1[0xf] == 1)) {
								return 0;
							}
							if (((LVar2 & 2) != 0) && (param_1[0xf] == 2)) {
								return 0;
							}
							if (((LVar2 & 4) != 0) && (param_1[0xf] == 4)) {
								return 0;
							}
							if (((LVar2 & 8) != 0) && (param_1[0xf] == 8)) {
								return 0;
							}
							if (((LVar2 & 0x10) != 0) && (param_1[0xf] == 0x10)) {
								return 0;
							}
							if (((LVar2 & 0x20) != 0) && (param_1[0xf] == 0x20)) {
								return 0;
							}
							fVar9 = lego::game::Level_GetTrainTime();
							if ((ushort)((ushort)(fVar9 < (float10)liveObj_2->elapsedTime1) << 8 |
													(ushort)(fVar9 == (float10)liveObj_2->elapsedTime1) << 0xe) == 0) {
								return 0;
							}
							if (param_3 != NULL) {
								lego::game::LiveObject_GetPosition((LiveObject *)param_1[4],param_3,param_3 + 1);
							}
						}
					}
					if (param_4 != NULL) {
						lego::game::LiveObject_GetBlockCoordinates
											((LiveObject *)param_1[4],(int *)param_4,(int *)(param_4 + 1));
						return 1;
					}
				}
			}
		}
	}
	return 1;
}



void FUN_00405880(void)
{
	LiveObject *liveObj;
	AITaskType AVar1;
	float fVar2;
	float fVar3;
	bool bVar4;
	BOOL BVar5;
	int iVar6;
	ObjectStatsFlags2 OVar7;
	AITaskData *pAVar8;
	uint uVar9;
	AITaskData *pAVar10;
	float10 fVar11;
	LiveObject **local_24;
	AITaskData *local_1c;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	int local_8;
	int local_4;
	
	local_1c = NULL;
	pAVar8 = lego::globals::g_AITaskDataNext;
	if (lego::globals::g_AITaskDataNext != NULL) {
		do {
			pAVar10 = pAVar8;
			if ((ushort)((ushort)(pAVar10->float_18 < 0.0) << 8 |
									(ushort)(pAVar10->float_18 == 0.0) << 0xe) != 0) {
				bVar4 = false;
				uVar9 = 0;
				if (UINT_004b44f0 != 0) {
					local_24 = (LiveObject **)&DAT_004b4428;
					do {
						liveObj = *local_24;
						lego::game::LiveObject_GetPosition(liveObj,&local_18,&local_14);
						lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_8,&local_4);
						fVar11 = lego::game::LiveObject_GetPainThreshold(liveObj);
						if (fVar11 < (float10)liveObj->health) {
							AVar1 = pAVar10->taskType;
							if (AVar1 == AITASK_GATHER) {
								BVar5 = FUN_004439b0(liveObj);
								if ((BVar5 != 0) && (iVar6 = FUN_004373c0(4,0), iVar6 != 0)) {
									bVar4 = true;
								}
							}
							else {
								if (AVar1 == AITASK_REPAIR) {
									OVar7 = lego::game::LiveObject_GetStatsFlags2(liveObj);
									if (((OVar7 & STATS2_DRAINPOWER) == STATS2_NONE) ||
										 ((BVar5 = FUN_00438870(pAVar10->object_10,0), BVar5 != 0 &&
											(OVar7 = lego::game::LiveObject_GetStatsFlags2(pAVar10->object_10),
											(OVar7 & STATS2_SELFPOWERED) == STATS2_NONE)))) {
										lego::game::LiveObject_GetPosition(pAVar10->object_10,&local_10,&local_c);
										fVar3 = local_18 - local_10;
										fVar2 = local_14 - local_c;
										fVar11 = lego::game::LiveObject_GetAttackRadius(liveObj);
										if ((float10)SQRT(fVar2 * fVar2 + fVar3 * fVar3) < fVar11) {
											bVar4 = true;
											OVar7 = lego::game::LiveObject_GetStatsFlags2(liveObj);
											if ((OVar7 & STATS2_DRAINPOWER) == STATS2_NONE) {
												pAVar10->float_18 = 750.0;
											}
										}
									}
								}
								else {
									if (AVar1 == AITASK_COLLECT) {
										iVar6 = FUN_0043c910(liveObj);
joined_r0x00405a76:
										if (iVar6 != 0) {
											bVar4 = true;
											pAVar10->float_18 = 250.0;
										}
									}
									else {
										if (AVar1 == AITASK_ATTACKPATH) {
											OVar7 = lego::game::LiveObject_GetStatsFlags2(liveObj);
											if ((OVar7 & STATS2_ATTACKPATHS) != STATS2_NONE) {
												bVar4 = true;
											}
										}
										else {
											if (AVar1 == AITASK_GOTO) {
												BVar5 = FUN_004439b0(liveObj);
												if ((BVar5 != 0) &&
													 (((pAVar10->position).x != local_8 || ((pAVar10->position).y != local_4))
													 )) {
													bVar4 = true;
												}
											}
											else {
												if (AVar1 == AITASK_ATTACKOBJECT) {
													iVar6 = FUN_004439b0(liveObj);
													goto joined_r0x00405a76;
												}
											}
										}
									}
								}
							}
						}
						if ((pAVar10->taskType == AITASK_DEPART) &&
							 ((BVar5 = FUN_004439b0(liveObj), BVar5 != 0 ||
								(OVar7 = lego::game::LiveObject_GetStatsFlags2(liveObj),
								(OVar7 & STATS2_USEHOLES) != STATS2_NONE)))) {
							bVar4 = true;
						}
						if (bVar4) {
							UINT_004b44f0 -= 1;
							(&DAT_004b4428)[uVar9] = (&DAT_004b4428)[UINT_004b44f0];
							if ((*(byte *)&pAVar10->flags_5c & 0x40) == 0) {
								if (local_1c == NULL) {
									lego::globals::g_AITaskDataNext = pAVar10->next;
								}
								else {
									local_1c->next = pAVar10->next;
								}
								pAVar10->next = NULL;
								liveObj->aitask_2f0 = pAVar10;
							}
							else {
								pAVar8 = (AITaskData *)FUN_00406330((undefined4 *)pAVar10);
								liveObj->aitask_2f0 = pAVar8;
							}
							break;
						}
						uVar9 += 1;
						local_24 = local_24 + 1;
					} while (uVar9 < UINT_004b44f0);
				}
			}
			pAVar8 = pAVar10->next;
			local_1c = pAVar10;
		} while (pAVar10->next != NULL);
	}
	return;
}



void FUN_00405b40(void)
{
	AITaskType AVar1;
	bool bVar2;
	AITaskData *pAVar3;
	BOOL BVar4;
	int iVar5;
	LevelSurfaceMap *pLVar6;
	int iVar7;
	uint uVar8;
	LiveObject *pLVar9;
	LiveObject *pLVar10;
	LiveObject **ppLVar11;
	AITaskData *pAVar12;
	float fVar13;
	float fVar14;
	int *piVar15;
	int *piVar16;
	LiveObject *local_94;
	LiveObject *local_90;
	LiveObject **local_8c;
	MessageType local_88;
	uint local_84;
	int local_80;
	int local_7c;
	MessageType local_78;
	float local_74;
	float local_70;
	int local_6c;
	int local_68;
	int local_64;
	int local_60;
	uint local_5c;
	int local_58;
	int local_54;
	AITaskData *local_50;
	float local_4c;
	float local_48;
	float local_44;
	float local_40;
	float local_3c;
	void *local_38;
	int local_34;
	void *local_30;
	Point2F local_2c;
	int local_24;
	int local_20;
	float local_18;
	undefined local_14 [4];
	int local_10 [2];
	Point2F local_8;
	
	local_50 = NULL;
	local_44 = 99999.0;
	pAVar3 = lego::globals::g_AITaskUnkPtr;
	if (lego::globals::g_AITaskUnkPtr != NULL) {
		do {
			pAVar12 = pAVar3;
			if (((ushort)((ushort)(pAVar12->float_18 < 0.0) << 8 |
									 (ushort)(pAVar12->float_18 == 0.0) << 0xe) != 0) &&
				 ((pAVar12->flags_5c & 0x80400) == 0)) {
				pLVar9 = NULL;
				local_90 = NULL;
				local_84 = 0;
				if (INT_004b4424 != 0) {
					local_8c = (LiveObject **)&DAT_004b435c;
					pLVar10 = pLVar9;
					do {
						pLVar9 = *local_8c;
						if (pLVar9 != NULL) {
							if ((pAVar12->flags_5c & 0x100) == 0) {
								BVar4 = FUN_004528d0(pLVar9,NULL);
								pLVar10 = local_90;
								if (BVar4 == 0) {
									if ((pAVar12->flags_5c & 0x100) != 0) goto LAB_00405bda;
									goto LAB_00405bf5;
								}
							}
							else {
LAB_00405bda:
								BVar4 = lego::game::LiveObject_FindIndexOfInTable
																	((LiveObject **)pAVar12->ptr_40,*(uint *)&pAVar12->field_0x44,
																	 pLVar9,NULL);
								pLVar10 = local_90;
								if (BVar4 != 0) {
LAB_00405bf5:
									lego::game::LiveObject_GetPosition(pLVar9,&local_4c,&local_48);
									iVar5 = FUN_00404ef0((int *)pAVar12,pLVar9,&local_74,NULL,&local_34,1,1);
									if (iVar5 != 0) {
										piVar16 = &local_68;
										piVar15 = &local_6c;
										fVar13 = local_74;
										fVar14 = local_70;
										pLVar6 = lego::game::GetSurfaceMap();
										BVar4 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
																			(pLVar6,fVar13,fVar14,piVar15,piVar16);
										if (BVar4 != 0) {
											piVar16 = &local_60;
											piVar15 = &local_64;
											fVar13 = local_4c;
											fVar14 = local_48;
											pLVar6 = lego::game::GetSurfaceMap();
											BVar4 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
																				(pLVar6,fVar13,fVar14,piVar15,piVar16);
											if (BVar4 != 0) {
												AVar1 = pAVar12->taskType;
												local_94 = (LiveObject *)0x1;
												if ((((((AVar1 == AITASK_DIG) && ((*(byte *)&pAVar12->flags_5c & 8) == 0))
															|| (AVar1 == AITASK_REPAIR)) ||
														 ((AVar1 == AITASK_REINFORCE || (AVar1 == AITASK_TRAIN)))) ||
														(AVar1 == AITASK_GETTOOL)) &&
													 (((local_64 != local_6c ||
														 (uVar8 = local_60 - local_68 >> 0x1f,
														 (local_60 - local_68 ^ uVar8) - uVar8 != 1)) &&
														((local_60 != local_68 ||
														 (uVar8 = local_64 - local_6c >> 0x1f,
														 (local_64 - local_6c ^ uVar8) - uVar8 != 1)))))) {
													local_24 = local_6c;
													local_20 = local_68;
													iVar7 = FUN_00431ba0((int *)local_90,&local_24,&local_6c,1);
													if (iVar7 == 0) {
														local_94 = (LiveObject *)iVar7;
													}
												}
												if (local_94 != NULL) {
													iVar5 = FUN_00440ef0(pLVar9,local_64,local_60,local_6c,local_68,&local_30,
																							 &local_38,local_14);
													if (iVar5 == 0) {
														pAVar12->float_18 = 75.0;
													}
													else {
														std::free(local_30);
														std::free(local_38);
													}
												}
											}
										}
									}
									if (local_34 != 0) {
										local_5c = local_84;
										local_40 = local_74;
										local_3c = local_70;
										break;
									}
									pLVar10 = local_90;
									if (iVar5 != 0) {
										local_18 = local_70 - local_48;
										fVar13 = SQRT(local_18 * local_18 +
																	(local_74 - local_4c) * (local_74 - local_4c));
										FUN_00442560(pLVar9,&local_8);
										if ((local_90 == NULL) || (fVar13 < local_44)) {
											local_5c = local_84;
											local_40 = local_74;
											local_3c = local_70;
											pLVar10 = pLVar9;
											local_90 = pLVar9;
											local_44 = fVar13;
										}
									}
								}
							}
						}
						pLVar9 = pLVar10;
						local_84 += 1;
						local_8c = local_8c + 1;
						pLVar10 = pLVar9;
					} while (local_84 < (uint)INT_004b4424);
				}
				if (pLVar9 == NULL) {
					if (((pAVar12->flags_5c & 0x1000) == 0) && (uVar8 = 0, INT_004b4424 != 0)) {
						ppLVar11 = (LiveObject **)&DAT_004b435c;
						do {
							pLVar9 = *ppLVar11;
							if (pLVar9 != NULL) {
								if ((pAVar12->flags_5c & 0x100) == 0) {
									BVar4 = FUN_004528d0(pLVar9,NULL);
									if (BVar4 == 0) {
										if ((pAVar12->flags_5c & 0x100) != 0) goto LAB_004060b6;
										goto LAB_004060cd;
									}
								}
								else {
LAB_004060b6:
									BVar4 = lego::game::LiveObject_FindIndexOfInTable
																		((LiveObject **)pAVar12->ptr_40,*(uint *)&pAVar12->field_0x44,
																		 pLVar9,NULL);
									if (BVar4 != 0) {
LAB_004060cd:
										iVar5 = FUN_00404ef0((int *)pAVar12,pLVar9,NULL,NULL,NULL,0,1);
										if (iVar5 != 0) {
											FUN_00403010((int *)pAVar12);
											break;
										}
									}
								}
							}
							uVar8 += 1;
							ppLVar11 = ppLVar11 + 1;
						} while (uVar8 < (uint)INT_004b4424);
					}
					if (((pAVar12->taskType != AITASK_TRAIN) && (pAVar12->mode_3c != 0)) &&
						 ((pAVar12->flags_5c & 0x8000) == 0)) {
						uVar8 = 0;
						local_94 = NULL;
						bVar2 = false;
						if (INT_004b4424 != 0) {
							ppLVar11 = (LiveObject **)&DAT_004b435c;
							do {
								pLVar9 = *ppLVar11;
								if (pLVar9 != NULL) {
									if ((pAVar12->flags_5c & 0x100) == 0) {
										BVar4 = FUN_004528d0(pLVar9,NULL);
										if (BVar4 == 0) {
											if ((pAVar12->flags_5c & 0x100) != 0) goto LAB_0040615f;
											goto LAB_00406176;
										}
									}
									else {
LAB_0040615f:
										BVar4 = lego::game::LiveObject_FindIndexOfInTable
																			((LiveObject **)pAVar12->ptr_40,*(uint *)&pAVar12->field_0x44,
																			 pLVar9,NULL);
										if (BVar4 != 0) {
LAB_00406176:
											iVar5 = FUN_00404ef0((int *)pAVar12,pLVar9,(float *)&local_2c,NULL,NULL,0,0);
											if ((iVar5 != 0) &&
												 (iVar5 = FUN_00404ef0((int *)pAVar12,pLVar9,(float *)&local_2c,NULL,NULL,0,
																							 1), local_94 = pLVar9, iVar5 != 0)) {
												bVar2 = true;
												break;
											}
										}
									}
								}
								uVar8 += 1;
								ppLVar11 = ppLVar11 + 1;
							} while (uVar8 < (uint)INT_004b4424);
						}
						if (((local_94 != NULL) && (!bVar2)) &&
							 (pLVar9 = (LiveObject *)FUN_00439110(NULL,&local_2c,pAVar12->mode_3c), pLVar9 != NULL
							 )) {
							FUN_004027c0(pLVar9,pAVar12->mode_3c,(uint)(pAVar12->mode_3c != TRAINED_REPAIR));
							pAVar12->flags_5c = pAVar12->flags_5c | 0x8000;
						}
					}
				}
				else {
					bVar2 = true;
					lego::game::LiveObject_GetBlockCoordinates(pLVar9,&local_58,&local_54);
					piVar16 = &local_7c;
					piVar15 = &local_80;
					fVar13 = local_40;
					fVar14 = local_3c;
					pLVar6 = lego::game::GetSurfaceMap();
					lego::game::SurfaceMap_ToBlockCoordinatesNoZ(pLVar6,fVar13,fVar14,piVar15,piVar16);
					AVar1 = pAVar12->taskType;
					if (((((AVar1 == AITASK_CLEAR) || (AVar1 == AITASK_COLLECT)) ||
							 (AVar1 == AITASK_BUILDPATH)) || (AVar1 == AITASK_UPGRADE)) &&
						 ((local_58 != local_80 || (local_54 != local_7c)))) {
						if (pAVar12->object_48 == NULL) {
							if (true) {
								switch(AVar1) {
								case AITASK_COLLECT:
									local_78 = MESSAGE_COLLECTCRYSTAL;
									break;
								case AITASK_CLEAR:
									local_78 = MESSAGE_CLEAR;
									break;
								case AITASK_UPGRADE:
									local_78 = MESSAGE_UPGRADE;
									break;
								case AITASK_BUILDPATH:
									local_78 = MESSAGE_BUILDPATH;
								}
							}
							lego::game::Level_AddMessageAction(local_78,pLVar9,(BOOL)pAVar12,&local_80);
							if ((pAVar12->flags_5c & 0x100) == 0) {
								pAVar12->object_48 = pLVar9;
							}
							if ((pAVar12->taskType == AITASK_CLEAR) && (pLVar9->objType == OBJECT_VEHICLE)) {
								FUN_00402a90(&pAVar12->position,1);
								pAVar12->float_18 = 0.0;
							}
						}
LAB_00406042:
						bVar2 = false;
					}
					else {
						if ((((AVar1 == AITASK_DIG) && ((*(byte *)&pAVar12->flags_5c & 8) == 0)) ||
								(((AVar1 == AITASK_REPAIR || (AVar1 == AITASK_REINFORCE)) ||
								 ((AVar1 == AITASK_TRAIN || (AVar1 == AITASK_GETTOOL)))))) &&
							 (((local_58 != local_80 ||
								 (uVar8 = local_54 - local_7c >> 0x1f, (local_54 - local_7c ^ uVar8) - uVar8 != 1))
								&& ((local_54 != local_7c ||
										(uVar8 = local_58 - local_80 >> 0x1f, (local_58 - local_80 ^ uVar8) - uVar8 != 1
										)))))) {
							if (pAVar12->object_48 == NULL) {
								if (true) {
									switch(AVar1) {
									case AITASK_DIG:
										local_88 = MESSAGE_DIG;
										break;
									case AITASK_REPAIR:
										local_88 = MESSAGE_REPAIR;
										break;
									case AITASK_REINFORCE:
										local_88 = MESSAGE_REINFORCE;
										break;
									case AITASK_GETTOOL:
										local_88 = MESSAGE_COLLECTTOOL;
										break;
									case AITASK_TRAIN:
										local_88 = MESSAGE_TRAIN;
									}
								}
								iVar5 = FUN_00431ba0((int *)pLVar9,&local_80,local_10,1);
								if (iVar5 == 0) {
									pAVar12->priorityValue = pAVar12->priorityValue - 1;
								}
								else {
									lego::game::Level_AddMessageAction(local_88,pLVar9,(BOOL)pAVar12,local_10);
									if ((pAVar12->flags_5c & 0x100) == 0) {
										pAVar12->object_48 = pLVar9;
									}
								}
							}
							goto LAB_00406042;
						}
					}
					if (bVar2) {
						FUN_00406290((undefined4 *)pAVar12,(int)local_50,pLVar9);
					}
					INT_004b4424 += -1;
					(&DAT_004b435c)[local_5c] = (&DAT_004b435c)[INT_004b4424];
				}
			}
			pAVar3 = pAVar12->next;
			local_50 = pAVar12;
		} while (pAVar12->next != NULL);
	}
	return;
}



void __cdecl FUN_00406290(undefined4 *param_1,int param_2,LiveObject *liveObj)
{
	AITaskData *pAVar1;
	
	if ((*(byte *)(param_1 + 0x17) & 0x40) == 0) {
		if (param_2 == 0) {
			lego::globals::g_AITaskUnkPtr = (AITaskData *)param_1[0x18];
		}
		else {
			*(undefined4 *)(param_2 + 0x60) = param_1[0x18];
		}
		param_1[0x18] = 0;
		liveObj->aitask_2f0 = (AITaskData *)param_1;
	}
	else {
		pAVar1 = (AITaskData *)FUN_00406330(param_1);
		liveObj->aitask_2f0 = pAVar1;
		if ((param_1[0x17] & 0x40000) != 0) {
			param_1[6] = 0x41c80000;
		}
	}
	lego::game::LiveObject__ReleaseTaskReferences(liveObj);
	FUN_00407380(liveObj);
	return;
}



void __cdecl lego::game::LiveObject__ReleaseTaskReferences(LiveObject *liveObj)
{
	AITaskData **ppAVar1;
	AITaskData *pAVar2;
	
	pAVar2 = globals::g_AITaskUnkPtr;
	if (globals::g_AITaskUnkPtr != NULL) {
		do {
			if (pAVar2->object_48 == liveObj) {
				pAVar2->object_48 = NULL;
			}
			ppAVar1 = &pAVar2->next;
			pAVar2 = *ppAVar1;
		} while (*ppAVar1 != NULL);
	}
	return;
}



void __cdecl FUN_00406330(undefined4 *param_1)
{
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	int iVar3;
	AITaskData *pAVar4;
	
	pAVar2 = lego::pool::ReservedPool_AITask___Next(*param_1);
	pAVar1 = pAVar2->pool_m_next;
	pAVar4 = pAVar2;
	for (iVar3 = 0x1a; iVar3 != 0; iVar3 += -1) {
		pAVar4->taskType = *param_1;
		param_1 = param_1 + 1;
		pAVar4 = (AITaskData *)&pAVar4->field_4;
	}
	pAVar2->pool_m_next = pAVar1;
	pAVar2->flags_5c = pAVar2->flags_5c | 0x200;
	pAVar2->next = NULL;
	return;
}



AITaskData * __cdecl lego::pool::ReservedPool_AITask___Next(AITaskType taskType)
{
	AITaskData *pAVar1;
	DWORD DVar2;
	int iVar3;
	AITaskData *pAVar4;
	
	if (globals::ReservedPool_AITask___g_NEXT == NULL) {
		ReservedPool_AITask___Alloc();
	}
	pAVar1 = globals::ReservedPool_AITask___g_NEXT;
	pAVar4 = globals::ReservedPool_AITask___g_NEXT;
	globals::ReservedPool_AITask___g_NEXT = globals::ReservedPool_AITask___g_NEXT->pool_m_next;
	for (iVar3 = 0x1a; iVar3 != 0; iVar3 += -1) {
		pAVar4->taskType = AITASK_GOTO;
		pAVar4 = (AITaskData *)&pAVar4->field_4;
	}
	pAVar1->pool_m_next = pAVar1;
	DVar2 = timeGetTime();
	pAVar1->taskStartTime = DVar2;
	pAVar1->taskType = taskType;
	return pAVar1;
}



void __cdecl lego::pool::ReservedPool_AITask___Release(AITaskData *param_1,BOOL param_2)
{
	if (param_2 == 0) {
		FUN_00402c00(param_1);
	}
	if ((param_1->ptr_40 != NULL) && ((param_1->flags_5c & 0x200) == 0)) {
		std::free(param_1->ptr_40);
	}
	param_1->pool_m_next = globals::ReservedPool_AITask___g_NEXT;
	globals::ReservedPool_AITask___g_NEXT = param_1;
	return;
}



void __cdecl lego::pool::ReservedPool_AITask___Alloc(void)
{
	AITaskData *pAVar1;
	AITaskData *pAVar2;
	int iVar3;
	uint uVar4;
	
	uVar4 = 1 << ((byte)globals::ReservedPool_AITask___g_COUNT & 0x1f);
	pAVar2 = (AITaskData *)std::malloc(uVar4 * 0x68);
	globals::ReservedPool_AITask___g_TABLE[globals::ReservedPool_AITask___g_COUNT] = pAVar2;
	pAVar2 = globals::ReservedPool_AITask___g_TABLE[globals::ReservedPool_AITask___g_COUNT];
	if (pAVar2 != NULL) {
		globals::ReservedPool_AITask___g_COUNT += 1;
		if (1 < uVar4) {
			iVar3 = uVar4 - 1;
			pAVar1 = pAVar2;
			do {
				pAVar1->pool_m_next = pAVar1 + 1;
				iVar3 += -1;
				pAVar1 = pAVar1 + 1;
			} while (iVar3 != 0);
		}
		pAVar2[uVar4 - 1].pool_m_next = globals::ReservedPool_AITask___g_NEXT;
		globals::ReservedPool_AITask___g_NEXT = pAVar2;
	}
	return;
}



BOOL __cdecl FUN_00406470(undefined *taskFunction,LiveObject *liveObj)
{
	int iVar1;
	int iVar2;
	AITaskData **ppAVar3;
	uint uVar4;
	uint uVar5;
	uint local_4;
	
	local_4 = 0;
	if (lego::pool::globals::ReservedPool_AITask___g_COUNT == 0) {
		return 0;
	}
	ppAVar3 = lego::pool::globals::ReservedPool_AITask___g_TABLE;
	do {
		if (*ppAVar3 != NULL) {
			uVar5 = 0;
			uVar4 = 1 << ((byte)local_4 & 0x1f);
			if (uVar4 != 0) {
				iVar2 = 0;
				do {
					iVar1 = (int)&(*ppAVar3)->taskType + iVar2;
					if (((iVar1 != 0) && (*(int *)(iVar1 + 100) == iVar1)) &&
						 (iVar1 = (*(code *)taskFunction)(iVar1,liveObj), iVar1 != 0)) {
						return 1;
					}
					uVar5 += 1;
					iVar2 += 0x68;
				} while (uVar5 < uVar4);
			}
		}
		local_4 += 1;
		ppAVar3 = ppAVar3 + 1;
		if (lego::pool::globals::ReservedPool_AITask___g_COUNT <= local_4) {
			return 0;
		}
	} while( true );
}



IDirectDraw4 * __cdecl lego::draw::Draw_GetDirectDraw(void)
{
	return lego::globals::g_IDirectDraw4;
}



IDirectDrawSurface4 * __cdecl lego::draw::Draw_GetDrawingSurface(void)
{
	return lego::globals::g_IDirectDrawSurface4_DrawTarget;
}



void __cdecl
FUN_00406520(float *param_1,float *param_2,float *param_3,float *param_4,float *param_5,
						float param_6)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	float fVar6;
	
	fVar1 = *param_3 * 3.0 + *param_2;
	fVar5 = param_6 * param_6;
	fVar4 = (fVar1 - *param_2) * 3.0;
	fVar3 = ((*param_4 - *param_5 * 3.0) - fVar1) * 3.0 - fVar4;
	fVar1 = param_5[1];
	fVar6 = param_3[1] * 3.0 + param_2[1];
	fVar2 = param_4[1];
	*param_1 = fVar4 * param_6 +
						 fVar3 * fVar5 + (((*param_4 - *param_2) - fVar4) - fVar3) * fVar5 * param_6 + *param_2;
	fVar3 = (fVar6 - param_2[1]) * 3.0;
	fVar1 = ((fVar2 - fVar1 * 3.0) - fVar6) * 3.0 - fVar3;
	param_1[1] = fVar1 * fVar5 +
							 fVar3 * param_6 + (((param_4[1] - param_2[1]) - fVar3) - fVar1) * fVar5 * param_6 +
							 param_2[1];
	return;
}



float10 __cdecl FUN_00406660(float *param_1,float *param_2)
{
	return SQRT(((float10)param_1[1] - (float10)param_2[1]) *
							((float10)param_1[1] - (float10)param_2[1]) +
							((float10)*param_1 - (float10)*param_2) *
							(float10)(float)((float10)*param_1 - (float10)*param_2));
}



void __cdecl FUN_00406690(float *param_1,float param_2)
{
	float fVar1;
	
	fVar1 = SQRT(*param_1 * *param_1 + param_1[1] * param_1[1]) / param_2;
	*param_1 = *param_1 / fVar1;
	param_1[1] = param_1[1] / fVar1;
	return;
}



float10 __cdecl FUN_004066e0(uint *param_1)
{
	uint *puVar1;
	uint uVar2;
	float *pfVar3;
	float10 fVar4;
	float local_4;
	
	uVar2 = 1;
	local_4 = 0.0;
	param_1[0x65] = 0;
	if (1 < *param_1) {
		pfVar3 = (float *)(param_1 + 0x66);
		puVar1 = param_1;
		do {
			fVar4 = FUN_00406660((float *)(puVar1 + 1),(float *)(puVar1 + 3));
			*pfVar3 = (float)fVar4;
			uVar2 += 1;
			pfVar3 = pfVar3 + 1;
			local_4 = (float)(fVar4 + (float10)local_4);
			puVar1 = puVar1 + 2;
		} while (uVar2 < *param_1);
	}
	return (float10)local_4;
}



void __cdecl
FUN_00406750(uint *param_1,float *param_2,float *param_3,float *param_4,float *param_5,uint param_6)
{
	uint uVar1;
	float *pfVar2;
	
	if (0x31 < param_6) {
		param_6 = 0x32;
	}
	uVar1 = 1;
	*param_1 = param_6;
	param_1[1] = (uint)*param_2;
	param_1[2] = (uint)param_2[1];
	if (1 < param_6) {
		pfVar2 = (float *)(param_1 + 3);
		do {
			FUN_00406520(pfVar2,param_2,param_3,param_4,param_5,
									 (float)(ulonglong)uVar1 * (1.0 / (float)(ulonglong)(param_6 - 1)));
			uVar1 += 1;
			pfVar2 = pfVar2 + 2;
		} while (uVar1 < param_6);
	}
	return;
}



uint __cdecl FUN_004067f0(uint *param_1,float param_2,float *param_3)
{
	float fVar1;
	float fVar2;
	uint uVar3;
	float fVar4;
	uint uVar5;
	float *pfVar6;
	
	fVar4 = 0.0;
	uVar3 = *param_1;
	uVar5 = 1;
	if (1 < uVar3) {
		pfVar6 = (float *)(param_1 + 0x66);
		do {
			fVar4 = fVar4 + *pfVar6;
			if (param_2 < fVar4) break;
			uVar5 += 1;
			pfVar6 = pfVar6 + 1;
		} while (uVar5 < uVar3);
	}
	if (uVar5 < uVar3) {
		*param_3 = (float)param_1[uVar5 * 2 + -1];
		param_3[1] = (float)param_1[uVar5 * 2];
		fVar1 = (float)param_1[uVar5 * 2 + 2];
		fVar2 = (float)param_1[uVar5 * 2];
		fVar4 = (param_2 - (fVar4 - (float)param_1[uVar5 + 0x65])) / (float)param_1[uVar5 + 0x65];
		*param_3 = ((float)param_1[uVar5 * 2 + 1] - (float)param_1[uVar5 * 2 + -1]) * fVar4 +
							 (float)param_1[uVar5 * 2 + -1];
		param_3[1] = (fVar1 - fVar2) * fVar4 + (float)param_1[uVar5 * 2];
		return uVar5;
	}
	*param_3 = (float)param_1[uVar5 * 2 + -1];
	param_3[1] = (float)param_1[uVar5 * 2];
	return uVar5;
}



BOOL __cdecl lego::res::Creature_IsCameraFlipDir(CreatureData *creature)
{
	return (uint)(creature->CameraFlipDir == BOOL3_TRUE);
}



BOOL __cdecl
lego::res::Res_LoadAEFileCreature
					(CreatureData *creature,int index,ResourceData *resRoot,char *aeFilename,char *rootName)
{
	char cVar1;
	int iVar2;
	CFGProperty *prop;
	ResourceData *pRVar3;
	char *pcVar4;
	BOOL3 BVar5;
	PolyMeshData *pPVar6;
	uint uVar7;
	uint uVar8;
	int *piVar9;
	int iVar10;
	undefined4 *puVar11;
	char *pcVar12;
	undefined4 *puVar13;
	BOOL local_994;
	char *local_990;
	int local_98c [99];
	undefined4 local_800 [256];
	char local_400 [1024];
	
	uVar7 = 0xffffffff;
	pcVar4 = aeFilename;
	do {
		pcVar12 = pcVar4;
		if (uVar7 == 0) break;
		uVar7 -= 1;
		pcVar12 = pcVar4 + 1;
		cVar1 = *pcVar4;
		pcVar4 = pcVar12;
	} while (cVar1 != '\0');
	uVar7 = ~uVar7;
	puVar11 = (undefined4 *)(pcVar12 + -uVar7);
	puVar13 = local_800;
	for (uVar8 = uVar7 >> 2; uVar8 != 0; uVar8 -= 1) {
		*puVar13 = *puVar11;
		puVar11 = puVar11 + 1;
		puVar13 = puVar13 + 1;
	}
	local_994 = 0;
	for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
		*(undefined *)puVar13 = *(undefined *)puVar11;
		puVar11 = (undefined4 *)((int)puVar11 + 1);
		puVar13 = (undefined4 *)((int)puVar13 + 1);
	}
	uVar7 = util::stringSplit((char *)local_800,&local_990,"\\");
	if (1 < uVar7) {
		piVar9 = local_98c;
		iVar10 = uVar7 - 1;
		do {
			iVar2 = *piVar9;
			piVar9 = piVar9 + 1;
			iVar10 += -1;
			*(undefined *)(iVar2 + -1) = 0x5c;
		} while (iVar10 != 0);
	}
	std::sprintf(local_400,"%s\\%s.%s",local_800,(&local_990)[uVar7 - 1],"ae");
	prop = cfg::CFG_Open(local_400);
	if (prop != NULL) {
		pRVar3 = Res_LoadResource(resRoot,aeFilename,"ACT",1);
		creature->aeResData = pRVar3;
		if (pRVar3 != NULL) {
			pcVar4 = cfg::CFG_JoinPath(rootName,"CameraNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			creature->CameraNullName = pcVar4;
			if (pcVar4 == NULL) {
				creature->CameraNullFrames = 0;
			}
			else {
				pcVar4 = cfg::CFG_JoinPath(rootName,"CameraNullFrames",0);
				pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				if (pcVar4 == NULL) {
					pcVar4 = ____EMPTYSTR__;
				}
				else {
					pcVar4 = cfg::CFG_JoinPath(rootName,"CameraNullFrames",0);
					pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				}
				uVar7 = std::atoi(pcVar4);
				creature->CameraNullFrames = uVar7;
				pcVar4 = cfg::CFG_JoinPath(rootName,"CameraFlipDir",0);
				BVar5 = cfg::CFG_GetPropertyBool(prop,pcVar4);
				creature->CameraFlipDir = BVar5;
			}
			pcVar4 = cfg::CFG_JoinPath(rootName,"DrillNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			creature->DrillNullName = pcVar4;
			pcVar4 = cfg::CFG_JoinPath(rootName,"FootStepNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			creature->FootStepNullName = pcVar4;
			pcVar4 = cfg::CFG_JoinPath(rootName,"CarryNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			creature->CarryNullName = pcVar4;
			pcVar4 = cfg::CFG_JoinPath(rootName,"ThrowNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			creature->ThrowNullName = pcVar4;
			pcVar4 = cfg::CFG_JoinPath(rootName,"DepositNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			creature->DepositNullName = pcVar4;
			creature->objIndex = index;
			pPVar6 = Res_LoadPolyMesh(prop,rootName,aeFilename,POLY_MEDIUM,1);
			creature->subdata_64 = pPVar6;
			pPVar6 = Res_LoadPolyMesh(prop,rootName,aeFilename,POLY_HIGH,1);
			creature->subdata_68 = pPVar6;
			pPVar6 = Res_LoadPolyMesh(prop,rootName,aeFilename,POLY_FP,creature->CameraNullFrames);
			creature->subdata_6c = pPVar6;
			creature->flags = 1;
			local_994 = 1;
		}
		cfg::CFG_Close(prop);
	}
	return local_994;
}



void __cdecl FUN_00406b30(CreatureData *creature,BOOL param_2)
{
	FUN_00451e80(creature->subdata_64,creature->aeResData,(uint)(param_2 == 0),0);
	return;
}



void __cdecl FUN_00406b60(CreatureData *creature,BOOL param_2)
{
	FUN_00451e80(creature->subdata_68,creature->aeResData,(uint)(param_2 == 0),0);
	return;
}



void __cdecl FUN_00406b90(CreatureData *creature,int param_2,int param_3)
{
	FUN_00451e80(creature->subdata_6c,creature->aeResData,(uint)(param_2 == 0),param_3);
	return;
}



void __cdecl FUN_00406bc0(BasicObjectData *basicObjData,BOOL use3rdFrame)
{
	lego::res::Res_UnkSetup3DFrameTransform(basicObjData->aeResData,use3rdFrame);
	return;
}



void __cdecl lego::res::Creature_Duplicate(CreatureData *in_creature,CreatureData *out_creature)
{
	PolyMeshData *pPVar1;
	ResourceData *pRVar2;
	int iVar3;
	CreatureData *pCVar4;
	CreatureData *pCVar5;
	
	pCVar4 = in_creature;
	pCVar5 = out_creature;
	for (iVar3 = 0x1d; iVar3 != 0; iVar3 += -1) {
		pCVar5->objIndex = pCVar4->objIndex;
		pCVar4 = (CreatureData *)&pCVar4->aeResData;
		pCVar5 = (CreatureData *)&pCVar5->aeResData;
	}
	out_creature->flags = out_creature->flags & 0xfffffffe;
	pPVar1 = PolyMesh_Duplicate(in_creature->subdata_64);
	out_creature->subdata_64 = pPVar1;
	pPVar1 = PolyMesh_Duplicate(in_creature->subdata_68);
	out_creature->subdata_68 = pPVar1;
	pPVar1 = PolyMesh_Duplicate(in_creature->subdata_6c);
	out_creature->subdata_6c = pPVar1;
	pRVar2 = Res_DuplicateResource(in_creature->aeResData);
	out_creature->aeResData = pRVar2;
	return;
}



void __cdecl lego::res::Creature_DoCallbacks(CreatureData *creature,float elapsed)
{
	Res_DoCallbacks(creature->aeResData,elapsed);
	return;
}



float10 __cdecl FUN_00406c60(CreatureData *creature,float elapsed,uint param_3)
{
	float fVar1;
	int iVar2;
	float10 fVar3;
	
	fVar3 = lego::res::Res_DoAnimElapsedCallbacks(creature->aeResData,elapsed);
	fVar1 = (float)fVar3;
	if ((1 < param_3) && (fVar1 != 0.0)) {
		iVar2 = lego::res::Res_GetAnimAppData_Fieldc(creature->aeResData);
		return (float10)fVar1 - (float10)(ulonglong)(iVar2 * (param_3 - 1));
	}
	return (float10)fVar1;
}



float10 __cdecl lego::res::Creature_GetAnimFloat10(CreatureData *creature)
{
	float10 fVar1;
	
	fVar1 = Res_GetAnimFloat10(creature->aeResData);
	return fVar1;
}



void __cdecl lego::res::Creature_SetOrientation(CreatureData *creature,float x,float y)
{
	Res_SetFrameOrientation(creature->aeResData,NULL,x,y,0.0,0.0,0.0,-1.0);
	return;
}



void __cdecl
lego::res::Creature_SetPosition
					(CreatureData *creature,float x,float y,GetSurfaceZCallback *getZcallback,
					LevelSurfaceMap *surfMap)
{
	float10 fVar1;
	
	fVar1 = (*getZcallback)(x,y,surfMap);
	Res_SetFramePosition(creature->aeResData,NULL,x,y,(float)fVar1);
	return;
}



ResourceData * __cdecl lego::game::LiveObject_GetAEResource(BasicObjectData *basicObjData)
{
	return basicObjData->aeResData;
}



BOOL __cdecl FUN_00406d70(CreatureData *creature,char *activityName,float elapsed)
{
	uint uVar1;
	BOOL BVar2;
	undefined4 *puVar3;
	
	FUN_00451ef0(creature->subdata_64);
	FUN_00451ef0(creature->subdata_68);
	FUN_00451ef0(creature->subdata_6c);
	uVar1 = 0;
	creature->field_40 = 0;
	creature->field_44 = 0;
	creature->resData_48 = NULL;
	creature->field_4c = 0;
	creature->field_50 = 0;
	if (creature->CameraNullFrames != 0) {
		puVar3 = creature->cameraFramesTable_54;
		do {
			*puVar3 = 0;
			uVar1 += 1;
			puVar3 = puVar3 + 1;
		} while (uVar1 < creature->CameraNullFrames);
	}
	BVar2 = lego::res::Res_ResourceShortNormal_FUN_00473630(creature->aeResData,activityName);
	lego::res::Res_DoCallbacks(creature->aeResData,elapsed);
	return BVar2;
}



void __cdecl lego::res::Creature_Destroy(CreatureData *creature)
{
	PolyMesh_Destroy(creature->subdata_64);
	PolyMesh_Destroy(creature->subdata_68);
	PolyMesh_Destroy(creature->subdata_6c);
	if ((*(byte *)&creature->flags & 1) != 0) {
		if (creature->DrillNullName != NULL) {
			std::free(creature->DrillNullName);
		}
		if (creature->FootStepNullName != NULL) {
			std::free(creature->FootStepNullName);
		}
		if (creature->CameraNullName != NULL) {
			std::free(creature->CameraNullName);
		}
		if (creature->CarryNullName != NULL) {
			std::free(creature->CarryNullName);
		}
		if (creature->ThrowNullName != NULL) {
			std::free(creature->ThrowNullName);
		}
	}
	pool::ReservedPool_ResourceData___Release(creature->aeResData);
	return;
}



ResourceData * __cdecl FUN_00406e80(BasicObjectData *basicObjData,char *name,int param_3)
{
	char *pcVar1;
	ResourceData *pRVar2;
	
	pcVar1 = lego::res::Res_GetNull(basicObjData->aeResData,name,&param_3);
	pRVar2 = FUN_00473e80(basicObjData->aeResData,pcVar1,0,NULL);
	return pRVar2;
}



ResourceData * __cdecl lego::res::Creature_GetCameraNull(CreatureData *creature,int cameraIndex)
{
	ResourceData *pRVar1;
	
	pRVar1 = (ResourceData *)creature->CameraNullName;
	if (pRVar1 != NULL) {
		if (creature->cameraFramesTable_54[cameraIndex] == 0) {
			pRVar1 = FUN_00406e80((BasicObjectData *)creature,pRVar1,cameraIndex);
			creature->cameraFramesTable_54[cameraIndex] = pRVar1;
		}
		pRVar1 = (ResourceData *)creature->cameraFramesTable_54[cameraIndex];
	}
	return pRVar1;
}



ResourceData * __cdecl lego::res::Creature_GetDrillNull(CreatureData *creature)
{
	ResourceData *pRVar1;
	
	pRVar1 = (ResourceData *)creature->field_40;
	if (pRVar1 == NULL) {
		if (creature->DrillNullName != NULL) {
			pRVar1 = FUN_00406e80((BasicObjectData *)creature,creature->DrillNullName,0);
			creature->field_40 = pRVar1;
			return pRVar1;
		}
		pRVar1 = NULL;
	}
	return pRVar1;
}



ResourceData * __cdecl lego::res::Creature_GetCarryNull(CreatureData *creature)
{
	ResourceData *pRVar1;
	
	if (creature->CarryNullName == NULL) {
		pRVar1 = NULL;
	}
	else {
		pRVar1 = creature->resData_48;
		if (pRVar1 == NULL) {
			pRVar1 = FUN_00406e80((BasicObjectData *)creature,creature->CarryNullName,0);
			creature->resData_48 = pRVar1;
			return pRVar1;
		}
	}
	return pRVar1;
}



ResourceData * __cdecl lego::res::Creature_GetDepositNull(CreatureData *creature)
{
	ResourceData *pRVar1;
	
	if (creature->DepositNullName == NULL) {
		pRVar1 = NULL;
	}
	else {
		pRVar1 = (ResourceData *)creature->field_50;
		if (pRVar1 == NULL) {
			pRVar1 = FUN_00406e80((BasicObjectData *)creature,creature->DepositNullName,0);
			creature->field_50 = pRVar1;
			return pRVar1;
		}
	}
	return pRVar1;
}



BOOL __cdecl FUN_00406f70(CreatureData *creature)
{
	ResourceData *pRVar1;
	float10 fVar2;
	
	if ((creature->field_4c == 0) && (creature->ThrowNullName != NULL)) {
		pRVar1 = FUN_00406e80((BasicObjectData *)creature,creature->ThrowNullName,0);
		creature->field_4c = pRVar1;
	}
	if ((ResourceData *)creature->field_4c != NULL) {
		fVar2 = FUN_00475990((ResourceData *)creature->field_4c);
		if (fVar2 != (float10)1.0) {
			return 1;
		}
	}
	return 0;
}



float10 __cdecl lego::game::LiveObject_GetCreatureResFloat(CreatureData *creature)
{
	float10 fVar1;
	
	fVar1 = res::Res_GetActFrameFloat14(creature->aeResData);
	return fVar1;
}



void __cdecl lego::main::Main_Init_Bubble(void)
{
	globals::g_Bubbles_TABLE[0] = "Bubble_CantDo";
	globals::g_Bubbles_TABLE[1] = "Bubble_Idle";
	globals::g_Bubbles_TABLE[2] = "Bubble_CollectCrystal";
	globals::g_Bubbles_TABLE[3] = "Bubble_CollectOre";
	globals::g_Bubbles_TABLE[4] = "Bubble_CollectStud";
	globals::g_Bubbles_TABLE[5] = "Bubble_CollectDynamite";
	globals::g_Bubbles_TABLE[6] = "Bubble_CollectBarrier";
	globals::g_Bubbles_TABLE[7] = "Bubble_CollectElecFence";
	globals::g_Bubbles_TABLE[8] = "Bubble_CollectDrill";
	globals::g_Bubbles_TABLE[9] = "Bubble_CollectSpade";
	globals::g_Bubbles_TABLE[10] = "Bubble_CollectHammer";
	globals::g_Bubbles_TABLE[11] = "Bubble_CollectSpanner";
	globals::g_Bubbles_TABLE[12] = "Bubble_CollectLaser";
	globals::g_Bubbles_TABLE[13] = "Bubble_CollectPusher";
	globals::g_Bubbles_TABLE[14] = "Bubble_CollectFreezer";
	globals::g_Bubbles_TABLE[15] = "Bubble_CollectBirdScarer";
	globals::g_Bubbles_TABLE[16] = "Bubble_CarryCrystal";
	globals::g_Bubbles_TABLE[17] = "Bubble_CarryOre";
	globals::g_Bubbles_TABLE[18] = "Bubble_CarryStud";
	globals::g_Bubbles_TABLE[19] = "Bubble_CarryDynamite";
	globals::g_Bubbles_TABLE[20] = "Bubble_CarryBarrier";
	globals::g_Bubbles_TABLE[21] = "Bubble_CarryElecFence";
	globals::g_Bubbles_TABLE[22] = "Bubble_Goto";
	globals::g_Bubbles_TABLE[23] = "Bubble_Dynamite";
	globals::g_Bubbles_TABLE[24] = "Bubble_Reinforce";
	globals::g_Bubbles_TABLE[25] = "Bubble_Drill";
	globals::g_Bubbles_TABLE[26] = "Bubble_Repair";
	globals::g_Bubbles_TABLE[27] = "Bubble_Dig";
	globals::g_Bubbles_TABLE[28] = "Bubble_Flee";
	globals::g_Bubbles_TABLE[29] = "Bubble_PowerOff";
	globals::g_Bubbles_TABLE[30] = "Bubble_CallToArms";
	globals::g_Bubbles_TABLE[31] = "Bubble_ElecFence";
	globals::g_Bubbles_TABLE[32] = "Bubble_Eat";
	globals::g_Bubbles_TABLE[33] = "Bubble_Drive";
	globals::g_Bubbles_TABLE[34] = "Bubble_Upgrade";
	globals::g_Bubbles_TABLE[35] = "Bubble_BuildPath";
	globals::g_Bubbles_TABLE[36] = "Bubble_Train";
	globals::g_Bubbles_TABLE[37] = "Bubble_Recharge";
	globals::g_Bubbles_TABLE[38] = "Bubble_Request";
	return;
}



void __cdecl lego::main::Main_Load_Bubbles(CFGProperty *root)
{
	char cVar1;
	bool bVar2;
	char *pcVar3;
	CFGProperty *prop;
	ImageBMP *image;
	int iVar4;
	char *pcVar5;
	
	pcVar3 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Bubbles",0);
	prop = cfg::CFG_GetBlockFirstChild(root,pcVar3);
	do {
		if (prop == NULL) {
			return;
		}
		pcVar3 = prop->key;
		bVar2 = true;
		if (pcVar3 != NULL) {
			iVar4 = -1;
			pcVar5 = pcVar3;
			do {
				if (iVar4 == 0) break;
				iVar4 += -1;
				cVar1 = *pcVar5;
				pcVar5 = pcVar5 + 1;
			} while (cVar1 != '\0');
			if ((iVar4 != -2) && (*pcVar3 == '!')) {
				if ((globals::g_CMDLINE_FLAGS & CMD_REDUCEIMAGES) == CMD_NONE) {
					pcVar3 = pcVar3 + 1;
				}
				else {
					bVar2 = false;
				}
			}
		}
		if (bVar2) {
			iVar4 = Main_GetBubbleIndex(pcVar3);
			image = lego::image::Image_LoadBMP(prop->value,0,0);
			globals::g_Bubbles_bmp_TABLE[iVar4] = image;
			if (image != NULL) {
				lego::image::Image_unkFogFromFloat__0047deb0(image,0.0,0.0,0.0,0.0,0.0,0.0);
			}
		}
		prop = cfg::CFG_NextFlatProperty(prop);
	} while( true );
}



int __cdecl lego::main::Main_GetBubbleIndex(char *bubbleName)
{
	int iVar1;
	char **ppcVar2;
	int iVar3;
	
	iVar3 = 0;
	ppcVar2 = globals::g_Bubbles_TABLE;
	do {
		iVar1 = std::_stricmp(*ppcVar2,bubbleName);
		if (iVar1 == 0) {
			return iVar3;
		}
		ppcVar2 = ppcVar2 + 1;
		iVar3 += 1;
	} while ((int)ppcVar2 < 0x55899c);
	return iVar1;
}



void __cdecl lego::game::Game_ToggleObjectUIsAlwaysVisible(void)
{
	globals::g_ObjectUIsAlwaysVisible = (uint)(globals::g_ObjectUIsAlwaysVisible == 0);
	return;
}



BOOL __cdecl FUN_00407290(void)
{
	return lego::globals::g_ObjectUIsAlwaysVisible;
}



void __cdecl FUN_004072a0(int param_1)
{
	if (lego::globals::g_ObjectUIsAlwaysVisible != 0) {
		*(undefined4 *)(param_1 + 0x388) = 0;
		FUN_00407940(param_1,(undefined4 *)(param_1 + 0x38c));
	}
	return;
}



void __cdecl FUN_004072d0(LiveObject *liveObj)
{
	Struct_8__00558bc4 *pSVar1;
	
	pSVar1 = TABLE_50__Struct_8__00558bc4__005589e4;
	do {
		if (liveObj == pSVar1->object_0) {
			pSVar1->object_0 = NULL;
		}
		pSVar1 = pSVar1 + 1;
	} while (pSVar1 < TABLE_50__Struct_8__00558bc4__00558a84);
	pSVar1 = TABLE_50__Struct_8__00558bc4__00558a84;
	do {
		if (liveObj == pSVar1->object_0) {
			pSVar1->object_0 = NULL;
		}
		pSVar1 = pSVar1 + 1;
	} while (pSVar1 < TABLE_50__Struct_8__00558bc4__00558b24);
	pSVar1 = TABLE_50__Struct_8__00558bc4__00558b24;
	do {
		if (liveObj == pSVar1->object_0) {
			pSVar1->object_0 = NULL;
		}
		pSVar1 = pSVar1 + 1;
	} while (pSVar1 < TABLE_50__Struct_8__00558bc4__00558bc4);
	pSVar1 = TABLE_50__Struct_8__00558bc4__00558bc4;
	do {
		if (liveObj == pSVar1->object_0) {
			pSVar1->object_0 = NULL;
		}
		pSVar1 = pSVar1 + 1;
	} while (pSVar1 < (Struct_8__00558bc4 *)&DAT_00558d54);
	return;
}



void __cdecl FUN_00407340(LiveObject *liveObj)
{
	Struct_8__00558bc4 *pSVar1;
	int iVar2;
	
	if (liveObj->objType == OBJECT_BUILDING) {
		iVar2 = 0;
		pSVar1 = TABLE_50__Struct_8__00558bc4__00558b24;
		do {
			if (liveObj == pSVar1->object_0) break;
			pSVar1 = pSVar1 + 1;
			iVar2 += 1;
		} while (pSVar1 < TABLE_50__Struct_8__00558bc4__00558bc4);
		if (iVar2 == 0x14) {
			pSVar1 = TABLE_50__Struct_8__00558bc4__00558b24;
			while (pSVar1->object_0 != NULL) {
				pSVar1 = pSVar1 + 1;
				if ((Struct_8__00558bc4 *)((int)&TABLE_50__Struct_8__00558bc4__00558b24[0x13].float_4 + 3U)
						< pSVar1) {
					return;
				}
			}
			pSVar1->object_0 = liveObj;
		}
	}
	return;
}



void __cdecl FUN_00407380(LiveObject *liveObj)
{
	Struct_8__00558bc4 *pSVar1;
	int iVar2;
	Struct_8__00558bc4 *pSVar3;
	
	if (liveObj->objType == OBJECT_MINIFIGURE) {
		iVar2 = 0;
		pSVar1 = TABLE_50__Struct_8__00558bc4__00558a84;
		do {
			pSVar3 = pSVar1;
			if (liveObj == pSVar3->object_0) break;
			iVar2 += 1;
			pSVar1 = pSVar3 + 1;
		} while (pSVar3 + 1 < TABLE_50__Struct_8__00558bc4__00558b24);
		if (iVar2 == 0x14) {
			iVar2 = 0;
			pSVar1 = TABLE_50__Struct_8__00558bc4__00558a84;
			do {
				pSVar3 = pSVar1;
				if (pSVar3->object_0 == NULL) {
					pSVar3->object_0 = liveObj;
					break;
				}
				iVar2 += 1;
				pSVar1 = pSVar3 + 1;
			} while (pSVar3 + 1 < TABLE_50__Struct_8__00558bc4__00558b24);
			if (iVar2 == 0x14) {
				return;
			}
		}
		pSVar3->float_4 = 12.5;
	}
	return;
}



void __cdecl FUN_004073e0(int *param_1)
{
	Struct_8__00558bc4 *pSVar1;
	int iVar2;
	Struct_8__00558bc4 *pSVar3;
	
	if (*param_1 == 2) {
		iVar2 = 0;
		pSVar1 = TABLE_50__Struct_8__00558bc4__00558bc4;
		do {
			pSVar3 = pSVar1;
			if ((LiveObject *)param_1 == pSVar3->object_0) break;
			iVar2 += 1;
			pSVar1 = pSVar3 + 1;
		} while (pSVar3 + 1 < (Struct_8__00558bc4 *)&DAT_00558d54);
		if (iVar2 == 0x32) {
			iVar2 = 0;
			pSVar1 = TABLE_50__Struct_8__00558bc4__00558bc4;
			do {
				pSVar3 = pSVar1;
				if (pSVar3->object_0 == NULL) {
					pSVar3->object_0 = (LiveObject *)param_1;
					break;
				}
				iVar2 += 1;
				pSVar1 = pSVar3 + 1;
			} while (pSVar3 + 1 < (Struct_8__00558bc4 *)&DAT_00558d54);
			if (iVar2 == 0x32) {
				return;
			}
		}
		pSVar3->float_4 = 2250000.0;
	}
	return;
}



void __cdecl FUN_00407440(int *param_1,float param_2)
{
	float *pfVar1;
	
	if (*param_1 == 2) {
		pfVar1 = &TABLE_50__Struct_8__00558bc4__00558bc4[0].float_4;
		do {
			if (pfVar1[-1] != 0.0) {
				*pfVar1 = param_2;
			}
			pfVar1 = pfVar1 + 2;
		} while (pfVar1 < &DAT_00558d58);
	}
	return;
}



void __cdecl FUN_00407470(LiveObject *liveObj)
{
	Struct_8__00558bc4 *pSVar1;
	ObjectStatsFlags3 OVar2;
	int iVar3;
	Struct_8__00558bc4 *pSVar4;
	
	OVar2 = lego::game::LiveObject_GetStatsFlags3(liveObj);
	if ((OVar2 & STATS3_SHOWHEALTHBAR) != STATS3_NONE) {
		iVar3 = 0;
		pSVar1 = TABLE_50__Struct_8__00558bc4__005589e4;
		do {
			pSVar4 = pSVar1;
			if (liveObj == pSVar4->object_0) break;
			iVar3 += 1;
			pSVar1 = pSVar4 + 1;
		} while (pSVar4 + 1 < TABLE_50__Struct_8__00558bc4__00558a84);
		if (iVar3 == 0x14) {
			iVar3 = 0;
			pSVar1 = TABLE_50__Struct_8__00558bc4__005589e4;
			do {
				pSVar4 = pSVar1;
				if (pSVar4->object_0 == NULL) {
					pSVar4->object_0 = liveObj;
					break;
				}
				iVar3 += 1;
				pSVar1 = pSVar4 + 1;
			} while (pSVar4 + 1 < TABLE_50__Struct_8__00558bc4__00558a84);
			if (iVar3 == 0x14) {
				return;
			}
		}
		pSVar4->float_4 = 37.5;
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_004074d0(float param_1)
{
	LiveObject *pLVar1;
	float fVar2;
	void *bitmap;
	undefined4 *puVar3;
	BOOL BVar4;
	ResourceData *pRVar5;
	int iVar6;
	Struct_8__00558bc4 *pSVar7;
	float10 fVar8;
	longlong lVar9;
	ResourceData *pRVar10;
	Vector3F *pVVar11;
	undefined4 *local_14;
	float local_10;
	Vector3F local_c;
	
	if ((lego::globals::g_ObjectUIsAlwaysVisible != 0) &&
		 (BVar4 = lego::unk::Game_IsNotBool308__00425cb0(), BVar4 == 0)) {
		FUN_00437a70(FUN_00407890,(LiveObject *)&param_1);
	}
	pSVar7 = TABLE_50__Struct_8__00558bc4__005589e4;
	do {
		pLVar1 = pSVar7->object_0;
		if (pLVar1 != NULL) {
			if ((((pLVar1->objType != OBJECT_MINIFIGURE) || (lego::globals::g_ObjectUIsAlwaysVisible == 0)
					 ) && (BVar4 = lego::unk::Game_IsNotBool308__00425cb0(), BVar4 == 0)) &&
				 ((pLVar1->flags1_3e0 & 0x600000) == LIVEOBJ1_NONE)) {
				pVVar11 = &local_c;
				pRVar10 = NULL;
				pRVar5 = lego::game::LiveObject_GetResource(pLVar1);
				lego::res::Res_GetPosition(pRVar5,pRVar10,pVVar11);
				fVar8 = lego::game::LiveObject_GetCollHeight(pLVar1);
				local_c.z = (float)((float10)local_c.z - fVar8);
				FUN_00477590((int)lego::globals::g_Game.ptr_1c,&local_14,&local_c);
				lVar9 = __ftol((float10)local_10);
				iVar6 = (int)lVar9;
				lVar9 = __ftol((float10)(float)local_14);
				FUN_00459dc0((int *)pLVar1,(int)lVar9,iVar6);
			}
			fVar2 = pSVar7->float_4 - param_1;
			pSVar7->float_4 = fVar2;
			if (fVar2 < 0.0) {
				pSVar7->object_0 = NULL;
			}
		}
		pSVar7 = pSVar7 + 1;
	} while (pSVar7 < TABLE_50__Struct_8__00558bc4__00558a84);
	BVar4 = lego::unk::Game_IsNotBool308__00425cb0();
	if (BVar4 == 0) {
		if (12.5 <= _DAT_004b9a18) {
			if (25.0 <= _DAT_004b9a18) {
				_DAT_004b9a18 = _DAT_004b9a18 - 25.0;
			}
		}
		else {
			pSVar7 = TABLE_50__Struct_8__00558bc4__00558b24;
			do {
				bitmap = lego::globals::g_Bubbles_bmp_TABLE[29];
				pLVar1 = pSVar7->object_0;
				if (pLVar1 != NULL) {
					if ((pLVar1->flags3_3e8 & 0x20000000) == LIVEOBJ3_NONE) {
						pVVar11 = &local_c;
						pRVar10 = NULL;
						pRVar5 = lego::game::LiveObject_GetResource(pLVar1);
						lego::res::Res_GetPosition(pRVar5,pRVar10,pVVar11);
						fVar8 = lego::game::LiveObject_GetCollHeight(pLVar1);
						local_c.z = (float)((float10)local_c.z - fVar8);
						FUN_00477590((int)lego::globals::g_Game.ptr_1c,&local_14,&local_c);
						local_10 = local_10 - (float)*(int *)((int)bitmap + 8);
						local_14 = (undefined4 *)((float)local_14 - (float)*(int *)((int)bitmap + 4) * 0.5);
						lego::image::Image_Blt__0047df70((ImageBMP *)bitmap,NULL,(float *)&local_14,NULL);
					}
					else {
						pSVar7->object_0 = NULL;
					}
				}
				pSVar7 = pSVar7 + 1;
			} while (pSVar7 < TABLE_50__Struct_8__00558bc4__00558bc4);
		}
		_DAT_004b9a18 = _DAT_004b9a18 + param_1;
	}
	pSVar7 = TABLE_50__Struct_8__00558bc4__00558a84;
	do {
		pLVar1 = pSVar7->object_0;
		if (pLVar1 != NULL) {
			if (((pLVar1->objType != OBJECT_MINIFIGURE) || (lego::globals::g_ObjectUIsAlwaysVisible == 0))
				 && (((pLVar1->flags1_3e0 & 0x600000) == LIVEOBJ1_NONE &&
						 (BVar4 = lego::unk::Game_IsNotBool308__00425cb0(), BVar4 == 0)))) {
				local_14 = NULL;
				FUN_004077f0((undefined4 *)pLVar1,param_1,(int *)&local_14,&local_c);
				puVar3 = local_14;
				if ((local_14 != NULL) && (local_14 != (undefined4 *)lego::globals::g_Bubbles_bmp_TABLE[1]))
				{
					lVar9 = __ftol((float10)local_c.y);
					iVar6 = (int)lVar9;
					lVar9 = __ftol((float10)local_c.x);
					FUN_0045a290(puVar3,(int)lVar9,iVar6);
				}
			}
			fVar2 = pSVar7->float_4 - param_1;
			pSVar7->float_4 = fVar2;
			if (fVar2 < 0.0) {
				pSVar7->object_0 = NULL;
			}
		}
		pSVar7 = pSVar7 + 1;
	} while (pSVar7 < TABLE_50__Struct_8__00558bc4__00558b24);
	pSVar7 = TABLE_50__Struct_8__00558bc4__00558bc4;
	do {
		pLVar1 = pSVar7->object_0;
		if (pLVar1 != NULL) {
			if (((lego::globals::g_ObjectUIsAlwaysVisible == 0) &&
					((pLVar1->flags1_3e0 & 0x600000) == LIVEOBJ1_NONE)) &&
				 (BVar4 = lego::unk::Game_IsNotBool308__00425cb0(), BVar4 == 0)) {
				local_14 = NULL;
				FUN_004077f0((undefined4 *)pLVar1,param_1,(int *)&local_14,&local_c);
				puVar3 = local_14;
				if (local_14 != NULL) {
					lVar9 = __ftol((float10)local_c.y);
					iVar6 = (int)lVar9;
					lVar9 = __ftol((float10)local_c.x);
					FUN_0045a290(puVar3,(int)lVar9,iVar6);
				}
			}
			if ((ushort)((ushort)(pSVar7->float_4 < 0.0) << 8 | (ushort)(pSVar7->float_4 == 0.0) << 0xe)
					!= 0) {
				pSVar7->object_0 = NULL;
			}
		}
		pSVar7 = pSVar7 + 1;
	} while (pSVar7 < (Struct_8__00558bc4 *)&DAT_00558d54);
	return;
}



void __cdecl FUN_004077f0(undefined4 *param_1,float param_2,int *param_3,undefined4 param_4)
{
	float fVar1;
	ResourceData *resData;
	float10 fVar2;
	ResourceData *opt_refResData;
	Vector3F *out_position;
	Vector3F local_c;
	
	out_position = &local_c;
	opt_refResData = NULL;
	resData = lego::game::LiveObject_GetResource((LiveObject *)param_1);
	lego::res::Res_GetPosition(resData,opt_refResData,out_position);
	fVar2 = lego::game::LiveObject_GetCollHeight((LiveObject *)param_1);
	local_c.z = (float)((float10)local_c.z - fVar2);
	FUN_00477590((int)lego::globals::g_Game.ptr_1c,param_4,&local_c);
	fVar1 = (float)param_1[0xe2] - param_2;
	param_1[0xe2] = fVar1;
	if ((ushort)((ushort)(fVar1 < 0.0) << 8 | (ushort)(fVar1 == 0.0) << 0xe) == 0) {
		*param_3 = param_1[0xe3];
	}
	else {
		FUN_00407940((int)param_1,param_3);
	}
	if (*param_3 == 0) {
		*param_3 = (int)lego::globals::g_Bubbles_bmp_TABLE[1];
	}
	return;
}



undefined4 __cdecl FUN_00407890(int *param_1,float *param_2)
{
	float *pfVar1;
	int iVar2;
	longlong lVar3;
	float local_8;
	float local_4;
	
	local_8 = *param_2;
	if ((*param_1 == 2) && ((param_1[0xf8] & 0x600000U) == 0)) {
		param_2 = NULL;
		FUN_004077f0(param_1,local_8,(int *)&param_2,&local_8);
		lVar3 = __ftol((float10)local_4);
		iVar2 = (int)lVar3;
		lVar3 = __ftol((float10)local_8);
		FUN_00459dc0(param_1,(int)lVar3,iVar2);
		lVar3 = __ftol((float10)local_4);
		iVar2 = (int)lVar3;
		lVar3 = __ftol((float10)local_8);
		FUN_0045a210(param_1,(int)lVar3,iVar2);
		pfVar1 = param_2;
		if (param_2 != NULL) {
			lVar3 = __ftol((float10)local_4);
			iVar2 = (int)lVar3;
			lVar3 = __ftol((float10)local_8);
			FUN_0045a290(pfVar1,(int)lVar3,iVar2);
		}
	}
	return 0;
}



void __cdecl FUN_00407940(int param_1,undefined4 *param_2)
{
	int *piVar1;
	int *piVar2;
	int iVar3;
	
	piVar1 = *(int **)(param_1 + 0x2f0);
	if ((*(byte *)(param_1 + 0x3ec) & 0x20) != 0) {
		*param_2 = lego::globals::g_Bubbles_bmp_TABLE[30];
		return;
	}
	if ((*(uint *)(param_1 + 0x3e0) & 0x800000) != 0) {
		*param_2 = lego::globals::g_Bubbles_bmp_TABLE[28];
		return;
	}
	if ((*(uint *)(param_1 + 0x3e0) & 0x80000000) != 0) {
		*param_2 = lego::globals::g_Bubbles_bmp_TABLE[0];
		return;
	}
	if (piVar1 != NULL) {
		iVar3 = *piVar1;
		while ((iVar3 == 0xe && (piVar2 = (int *)piVar1[0x18], piVar2 != NULL))) {
			iVar3 = *piVar2;
			piVar1 = piVar2;
		}
		if (true) {
			switch(*piVar1) {
			case 0:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[22];
				return;
			case 3:
				iVar3 = *(int *)piVar1[4];
				if (iVar3 == 6) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[2];
					return;
				}
				if (iVar3 == 7) {
					if (((int *)piVar1[4])[1] == 0) {
						*param_2 = lego::globals::g_Bubbles_bmp_TABLE[3];
						return;
					}
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[4];
					return;
				}
				if (iVar3 == 8) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[5];
					return;
				}
				if (iVar3 == 9) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[6];
					return;
				}
				if (iVar3 == 0xb) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[7];
					return;
				}
				break;
			case 5:
				piVar1 = *(int **)(param_1 + 0x308);
				if (piVar1 != NULL) {
					iVar3 = *piVar1;
					if (iVar3 == 6) {
						*param_2 = lego::globals::g_Bubbles_bmp_TABLE[16];
						return;
					}
					if (iVar3 == 7) {
						if (piVar1[1] == 0) {
							*param_2 = lego::globals::g_Bubbles_bmp_TABLE[17];
							return;
						}
						*param_2 = lego::globals::g_Bubbles_bmp_TABLE[18];
						return;
					}
					if (iVar3 == 8) {
						*param_2 = lego::globals::g_Bubbles_bmp_TABLE[19];
						return;
					}
					if (iVar3 == 9) {
						*param_2 = lego::globals::g_Bubbles_bmp_TABLE[20];
						return;
					}
					if (iVar3 == 0xb) {
						*param_2 = lego::globals::g_Bubbles_bmp_TABLE[21];
						return;
					}
				}
				break;
			case 7:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[38];
				break;
			case 8:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[25];
				return;
			case 9:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[23];
				return;
			case 10:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[26];
				return;
			case 0xb:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[24];
				return;
			case 0xc:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[27];
				return;
			case 0xf:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[31];
				return;
			case 0x10:
			case 0x11:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[32];
				return;
			case 0x12:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[33];
				return;
			case 0x13:
				iVar3 = piVar1[0xe];
				if (iVar3 == 0) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[8];
					return;
				}
				if (iVar3 == 1) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[9];
					return;
				}
				if (iVar3 == 2) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[10];
					return;
				}
				if (iVar3 == 3) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[11];
					return;
				}
				if (iVar3 == 4) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[12];
					return;
				}
				if (iVar3 == 5) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[13];
					return;
				}
				if (iVar3 == 7) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[14];
					return;
				}
				if (iVar3 == 6) {
					*param_2 = lego::globals::g_Bubbles_bmp_TABLE[15];
					return;
				}
				break;
			case 0x15:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[34];
				return;
			case 0x16:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[35];
				return;
			case 0x17:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[36];
				return;
			case 0x1b:
				*param_2 = lego::globals::g_Bubbles_bmp_TABLE[37];
				return;
			}
		}
	}
	return;
}



BOOL __cdecl
lego::res::Res_LoadAEFileBuilding
					(BuildingData *building,int index,ResourceData *resData,char *filename,char *rootName)
{
	char cVar1;
	int iVar2;
	ResourceData *pRVar3;
	CFGProperty *prop;
	char *pcVar4;
	Point2I *pPVar5;
	int iVar6;
	uint uVar7;
	uint uVar8;
	int *piVar9;
	undefined4 *puVar10;
	BuildingData *pBVar11;
	undefined4 *puVar12;
	float10 fVar13;
	char **local_99c;
	int local_998;
	char *local_994 [2];
	int local_98c [99];
	char local_800 [1024];
	char filepath [1024];
	
	pBVar11 = building;
	for (iVar6 = 0x53; iVar6 != 0; iVar6 += -1) {
		pBVar11->objIndex = 0;
		pBVar11 = (BuildingData *)&pBVar11->aeResData;
	}
	pRVar3 = Res_LoadResource(resData,filename,"ACT",1);
	building->aeResData = pRVar3;
	if (pRVar3 == NULL) {
		return 0;
	}
	uVar7 = 0xffffffff;
	do {
		pcVar4 = filename;
		if (uVar7 == 0) break;
		uVar7 -= 1;
		pcVar4 = filename + 1;
		cVar1 = *filename;
		filename = pcVar4;
	} while (cVar1 != '\0');
	uVar7 = ~uVar7;
	puVar10 = (undefined4 *)(pcVar4 + -uVar7);
	puVar12 = (undefined4 *)local_800;
	for (uVar8 = uVar7 >> 2; uVar8 != 0; uVar8 -= 1) {
		*puVar12 = *puVar10;
		puVar10 = puVar10 + 1;
		puVar12 = puVar12 + 1;
	}
	for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
		*(undefined *)puVar12 = *(undefined *)puVar10;
		puVar10 = (undefined4 *)((int)puVar10 + 1);
		puVar12 = (undefined4 *)((int)puVar12 + 1);
	}
	uVar7 = util::stringSplit(local_800,local_994 + 1,"\\");
	if (1 < uVar7) {
		piVar9 = local_98c;
		iVar6 = uVar7 - 1;
		do {
			iVar2 = *piVar9;
			piVar9 = piVar9 + 1;
			iVar6 += -1;
			*(undefined *)(iVar2 + -1) = '\\';
		} while (iVar6 != 0);
	}
	std::sprintf(filepath,"%s\\%s.%s",local_800,local_994[uVar7],"ae");
	prop = cfg::CFG_Open(filepath);
	if (prop != NULL) {
		pcVar4 = cfg::CFG_JoinPath(rootName,"CarryNullName",0);
		pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
		building->CarryNullName = pcVar4;
		if (pcVar4 == NULL) {
			building->CarryNullFrames = 0;
		}
		else {
			pcVar4 = cfg::CFG_JoinPath(rootName,"CarryNullFrames",0);
			pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
			if (pcVar4 == NULL) {
				uVar7 = std::atoi(____EMPTYSTR__);
				building->CarryNullFrames = uVar7;
			}
			else {
				pcVar4 = cfg::CFG_JoinPath(rootName,"CarryNullFrames",0);
				pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				uVar7 = std::atoi(pcVar4);
				building->CarryNullFrames = uVar7;
			}
		}
		pcVar4 = cfg::CFG_JoinPath(rootName,"CameraNullName",0);
		pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
		building->CameraNullName = pcVar4;
		if (pcVar4 == NULL) {
			building->CameraNullFrames = 0;
		}
		else {
			pcVar4 = cfg::CFG_JoinPath(rootName,"CameraNullFrames",0);
			pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
			if (pcVar4 == NULL) {
				uVar7 = std::atoi(____EMPTYSTR__);
				building->CameraNullFrames = uVar7;
			}
			else {
				pcVar4 = cfg::CFG_JoinPath(rootName,"CameraNullFrames",0);
				pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				uVar7 = std::atoi(pcVar4);
				building->CameraNullFrames = uVar7;
			}
		}
		pcVar4 = cfg::CFG_JoinPath(rootName,"ToolNullName",0);
		pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
		building->ToolNullName = pcVar4;
		if (pcVar4 == NULL) {
			building->ToolNullFrames = 0;
		}
		else {
			pcVar4 = cfg::CFG_JoinPath(rootName,"ToolNullFrames",0);
			pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
			if (pcVar4 == NULL) {
				uVar7 = std::atoi(____EMPTYSTR__);
				building->ToolNullFrames = uVar7;
			}
			else {
				pcVar4 = cfg::CFG_JoinPath(rootName,"ToolNullFrames",0);
				pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				uVar7 = std::atoi(pcVar4);
				building->ToolNullFrames = uVar7;
			}
		}
		pcVar4 = cfg::CFG_JoinPath(rootName,"DepositNullName",0);
		pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
		building->DepositNullName = pcVar4;
		pcVar4 = cfg::CFG_JoinPath(rootName,"FireNullName",0);
		pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
		building->FireNullName = pcVar4;
		pcVar4 = cfg::CFG_JoinPath(rootName,"EntranceNullName",0);
		pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
		building->EntranceNullName = pcVar4;
		pcVar4 = cfg::CFG_JoinPath(rootName,"yPivot",0);
		pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
		building->yPivot = pcVar4;
		pcVar4 = cfg::CFG_JoinPath(rootName,"xPivot",0);
		pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
		building->xPivot = pcVar4;
		pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMaxZ",0);
		pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
		if (pcVar4 == NULL) {
			building->PivotMaxZ = 1.0;
		}
		else {
			pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMaxZ",0);
			pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
			if (pcVar4 == NULL) {
				fVar13 = std::atof(____EMPTYSTR__);
				building->PivotMaxZ = (float)fVar13;
			}
			else {
				pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMaxZ",0);
				pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				fVar13 = std::atof(pcVar4);
				building->PivotMaxZ = (float)fVar13;
			}
		}
		pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMinZ",0);
		pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
		if (pcVar4 == NULL) {
			building->PivotMinZ = -1.0;
		}
		else {
			pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMinZ",0);
			pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
			if (pcVar4 == NULL) {
				fVar13 = std::atof(____EMPTYSTR__);
				building->PivotMinZ = (float)fVar13;
			}
			else {
				pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMinZ",0);
				pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				fVar13 = std::atof(pcVar4);
				building->PivotMinZ = (float)fVar13;
			}
		}
		Res_LoadUpgradeLevels(&building->upgrades,prop,rootName);
		pPVar5 = (Point2I *)std::malloc(0x50);
		building->shapePoints = pPVar5;
		building->shapeCount = 1;
		pPVar5->y = 0;
		building->shapePoints->x = 0;
		pcVar4 = cfg::CFG_JoinPath(rootName,"Shape",0);
		pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
		local_994[0] = pcVar4;
		if (pcVar4 != NULL) {
			local_998 = util::stringSplit(pcVar4,local_994 + 1,":");
			if (local_998 != 0) {
				local_99c = local_994;
				do {
					local_99c = local_99c + 1;
					uVar7 = building->shapeCount;
					pPVar5 = building->shapePoints;
					pcVar4 = *local_99c;
					building->shapeCount = uVar7 + 1;
					iVar6 = std::atoi(pcVar4);
					pPVar5[uVar7].x = iVar6;
					pcVar4 = std::strstr(pcVar4,",");
					iVar6 = std::atoi(pcVar4 + 1);
					pPVar5[uVar7].y = iVar6;
					local_998 += -1;
					pcVar4 = local_994[0];
				} while (local_998 != 0);
			}
			std::free(pcVar4);
		}
		pcVar4 = cfg::CFG_JoinPath(rootName,"PowerLevelScene",0);
		pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
		if (pcVar4 != NULL) {
			std::sprintf(filepath,"%s\\%s",local_800,pcVar4);
			pRVar3 = Res_LoadResource(resData,filepath,"LWS",1);
			building->PowerLevelScene = pRVar3;
		}
		cfg::CFG_Close(prop);
	}
	Res_UnkSetup3DFrameTransform(building->aeResData,1);
	building->objIndex = index;
	building->flags = 0;
	return 1;
}



void __cdecl FUN_00408210(int param_1,int param_2)
{
	float fVar1;
	
	if (param_2 == 0) {
		fVar1 = (*(float *)(param_1 + 0x80) - 0.1) * 10.0 * 0.1111111;
	}
	else {
		fVar1 = *(float *)(param_1 + 0x80) - (1.0 - *(float *)(param_1 + 0x80)) * -0.1;
	}
	*(float *)(param_1 + 0x80) = fVar1;
	if (*(float *)(param_1 + 0x80) < 0.0) {
		*(undefined4 *)(param_1 + 0x80) = 0;
	}
	*(uint *)(param_1 + 0x148) = *(uint *)(param_1 + 0x148) | 2;
	return;
}



Point2I * __cdecl FUN_00408290(BuildingData *param_1,undefined4 *out_param_2)
{
	if (out_param_2 != NULL) {
		*out_param_2 = param_1->shapeCount;
	}
	return param_1->shapePoints;
}



void __cdecl lego::res::Object_SetOwnerObject(BasicObjectData *basicObjData,LiveObject *liveObj)
{
	Res_SetOwnerObject(basicObjData->aeResData,liveObj);
	return;
}



void __cdecl lego::game::LiveObject_BuildingUnkUpgrades(BuildingData *building,char *frameName)
{
	int *opt_index;
	LiveObject *pLVar1;
	uint uVar2;
	BuildingData *basicObjData;
	undefined4 *puVar3;
	ResourceData *pRVar4;
	ResourceData *resData;
	char *pcVar5;
	undefined4 *puVar6;
	int iVar7;
	UpgradeData *upgrade;
	uint local_14;
	int local_10;
	uint local_c;
	int local_8;
	UpgradeData *local_4;
	
	basicObjData = building;
	iVar7 = 3;
	pLVar1 = (LiveObject *)(building->upgrades).upgradeObjs;
	puVar3 = (undefined4 *)&building->field_0xc4;
	puVar6 = (undefined4 *)&building->field_0xa0;
	do {
		puVar3[0x1a] = 0;
		*puVar3 = 0;
		puVar3[-3] = 0;
		*puVar6 = 0;
		puVar3 = puVar3 + 1;
		iVar7 += -1;
		puVar6[1] = 0;
		puVar6 = puVar6 + 2;
	} while (iVar7 != 0);
	building->count_144 = 0;
	do {
		if (pLVar1 == NULL) {
			return;
		}
		upgrade = pLVar1->upgrade;
		iVar7 = upgrade->field_c;
		local_8 = iVar7;
		local_4 = upgrade;
		pRVar4 = FUN_00406e80((BasicObjectData *)basicObjData,*(undefined4 *)(iVar7 + 8),
													*(undefined4 *)(iVar7 + 4));
		resData = LiveObject_GetAEResource((BasicObjectData *)upgrade);
		FUN_004759d0(resData,pRVar4);
		res::Res_IdentityFrameTransform(resData);
		if (frameName == NULL) {
			res::Res_ResourceShortNormal_FUN_00473630(upgrade->aeResData,globals::g_Activities_TABLE[0]);
		}
		else {
			FUN_0046c3f0(upgrade,frameName);
		}
		if (*(int *)(iVar7 + 0xc) != 0) {
			uVar2 = basicObjData->count_144;
			local_10 = 0;
			*(undefined4 *)(&basicObjData->field_0xd8 + uVar2 * 4) = 0;
			local_14 = 0;
			opt_index = (int *)(&basicObjData->field_0xd8 + uVar2 * 4);
			building = (BuildingData *)(basicObjData->cameraFramesTable_40 + uVar2 * 2 + 0x18);
			local_c = uVar2;
			do {
				building->objIndex = 0;
				pcVar5 = res::Res_GetNull(basicObjData->aeResData,basicObjData->FireNullName,opt_index);
				pRVar4 = FUN_00473e80(resData,pcVar5,0,NULL);
				basicObjData->cameraFramesTable_40[*opt_index + uVar2 * 2 + 0x18] = pRVar4;
				iVar7 = basicObjData->cameraFramesTable_40[uVar2 * 2 + *opt_index + 0x18];
				*opt_index = *opt_index + 1;
				if (iVar7 == 0) break;
				local_14 += 1;
				building = (BuildingData *)&building->aeResData;
			} while (local_14 < 2);
			pcVar5 = res::Res_GetNull(basicObjData->aeResData,basicObjData->xPivot,&local_10);
			pRVar4 = FUN_00473e80(resData,pcVar5,0,NULL);
			uVar2 = local_c;
			basicObjData->cameraFramesTable_40[local_c + 0x1e] = pRVar4;
			pcVar5 = res::Res_GetNull(basicObjData->aeResData,basicObjData->yPivot,&local_10);
			pRVar4 = FUN_00473e80(resData,pcVar5,0,NULL);
			*(ResourceData **)(&basicObjData->field_0xc4 + uVar2 * 4) = pRVar4;
			*(int *)(&basicObjData->field_0x12c + uVar2 * 4) = local_8;
			basicObjData->count_144 = basicObjData->count_144 + 1;
			upgrade = local_4;
		}
		pLVar1 = upgrade->object_8;
	} while( true );
}



BOOL __cdecl FUN_004084a0(BuildingData *building,char *activityName,float elapsed)
{
	uint uVar1;
	BOOL BVar2;
	undefined4 *puVar3;
	
	uVar1 = 0;
	if (building->CarryNullFrames != 0) {
		puVar3 = building->carryFramesTable_28;
		do {
			*puVar3 = 0;
			uVar1 += 1;
			puVar3 = puVar3 + 1;
		} while (uVar1 < building->CarryNullFrames);
	}
	uVar1 = 0;
	if (building->CameraNullFrames != 0) {
		puVar3 = building->cameraFramesTable_40;
		do {
			*puVar3 = 0;
			uVar1 += 1;
			puVar3 = puVar3 + 1;
		} while (uVar1 < building->CameraNullFrames);
	}
	building->field_68 = 0;
	building->field_6c = 0;
	BVar2 = lego::res::Res_ResourceShortNormal_FUN_00473630(building->aeResData,activityName);
	lego::res::Res_DoCallbacks(building->aeResData,elapsed);
	lego::game::LiveObject_BuildingUnkUpgrades(building,activityName);
	return BVar2;
}



int __cdecl FUN_00408520(BuildingData *param_1,int param_2)
{
	ResourceData *pRVar1;
	char *name;
	
	name = param_1->CameraNullName;
	if (name != NULL) {
		if (param_1->cameraFramesTable_40[param_2] == 0) {
			pRVar1 = FUN_00406e80((BasicObjectData *)param_1,name,param_2);
			param_1->cameraFramesTable_40[param_2] = pRVar1;
		}
		name = (char *)param_1->cameraFramesTable_40[param_2];
	}
	return (int)name;
}



void __cdecl lego::res::Building_Duplicate(BuildingData *in_building,BuildingData *out_building)
{
	ResourceData *pRVar1;
	int iVar2;
	BuildingData *pBVar3;
	BuildingData *pBVar4;
	
	pBVar3 = in_building;
	pBVar4 = out_building;
	for (iVar2 = 0x53; iVar2 != 0; iVar2 += -1) {
		pBVar4->objIndex = pBVar3->objIndex;
		pBVar3 = (BuildingData *)&pBVar3->aeResData;
		pBVar4 = (BuildingData *)&pBVar4->aeResData;
	}
	out_building->flags = out_building->flags & 0xfffffffe;
	pRVar1 = Res_DuplicateResource(in_building->aeResData);
	out_building->aeResData = pRVar1;
	if (in_building->PowerLevelScene != NULL) {
		pRVar1 = Res_DuplicateResource(in_building->PowerLevelScene);
		out_building->PowerLevelScene = pRVar1;
	}
	return;
}



void __cdecl FUN_004085a0(BuildingData *param_1,BOOL param_2)
{
	lego::res::Res_UnkSetup3DFrameTransform(param_1->aeResData,param_2);
	if (param_1->PowerLevelScene != NULL) {
		lego::res::Res_UnkSetup3DFrameTransform(param_1->PowerLevelScene,param_2);
	}
	return;
}



void __cdecl lego::res::Object_GetFlag8(BasicObjectData *basicObjData)
{
	Res_GetFlag8(basicObjData->aeResData);
	return;
}



void __cdecl lego::res::Building_SetOrientation(BuildingData *building,float x,float y)
{
	Res_SetFrameOrientation(building->aeResData,NULL,x,y,0.0,0.0,0.0,-1.0);
	if (building->PowerLevelScene != NULL) {
		Res_SetFrameOrientation(building->PowerLevelScene,NULL,x,y,0.0,0.0,0.0,-1.0);
	}
	return;
}



void __cdecl
lego::res::Building_SetPosition
					(BuildingData *building,float x,float y,undefined *getZcallback,LevelSurfaceMap *surfMap)
{
	float10 fVar1;
	
	fVar1 = (float10)(*(code *)getZcallback)(x,y,surfMap);
	Res_SetFramePosition(building->aeResData,NULL,x,y,(float)fVar1);
	if (building->PowerLevelScene != NULL) {
		Res_SetFramePosition(building->PowerLevelScene,NULL,x,y,(float)fVar1);
	}
	return;
}



ResourceData * __cdecl lego::res::Building_GetCarryNull(BuildingData *building,int carryIndex)
{
	ResourceData *pRVar1;
	
	if (building->CarryNullName == NULL) {
		return NULL;
	}
	if ((ResourceData *)building->carryFramesTable_28[carryIndex] != NULL) {
		return (ResourceData *)building->carryFramesTable_28[carryIndex];
	}
	pRVar1 = FUN_00406e80((BasicObjectData *)building,building->CarryNullName,carryIndex);
	building->carryFramesTable_28[carryIndex] = pRVar1;
	return pRVar1;
}



ResourceData * __cdecl lego::res::Building_GetDepositNull(BuildingData *building)
{
	ResourceData *pRVar1;
	
	if (building->DepositNullName == NULL) {
		pRVar1 = NULL;
	}
	else {
		pRVar1 = (ResourceData *)building->field_68;
		if (pRVar1 == NULL) {
			pRVar1 = FUN_00406e80((BasicObjectData *)building,building->DepositNullName,0);
			building->field_68 = pRVar1;
			return pRVar1;
		}
	}
	return pRVar1;
}



ResourceData * __cdecl lego::res::Building_GetEntranceNull(BuildingData *building)
{
	ResourceData *pRVar1;
	
	if (building->EntranceNullName == NULL) {
		pRVar1 = NULL;
	}
	else {
		pRVar1 = (ResourceData *)building->field_6c;
		if (pRVar1 == NULL) {
			pRVar1 = FUN_00406e80((BasicObjectData *)building,building->EntranceNullName,0);
			building->field_6c = pRVar1;
			return pRVar1;
		}
	}
	return pRVar1;
}



ResourceData * __cdecl lego::res::Building_GetToolNull(BuildingData *building,int toolIndex)
{
	ResourceData *pRVar1;
	
	if (building->ToolNullName == NULL) {
		return NULL;
	}
	if ((ResourceData *)building->cameraFramesTable_40[toolIndex + 4] != NULL) {
		return (ResourceData *)building->cameraFramesTable_40[toolIndex + 4];
	}
	pRVar1 = FUN_00406e80((BasicObjectData *)building,building->ToolNullName,toolIndex);
	building->cameraFramesTable_40[toolIndex + 4] = pRVar1;
	return pRVar1;
}



int __cdecl lego::res::Res_GetBuildingCarryNullFrames(BuildingData *building)
{
	return building->CarryNullFrames;
}



float10 __cdecl FUN_00408790(BuildingData *building,float elapsed,uint param_3)
{
	BuildingData *pBVar1;
	BuildingData *pBVar2;
	int iVar3;
	uint uVar4;
	float10 fVar5;
	
	pBVar2 = building;
	fVar5 = lego::res::Res_DoAnimElapsedCallbacks(building->aeResData,elapsed);
	pBVar1 = (BuildingData *)(float)fVar5;
	if ((1 < param_3) && ((float)pBVar1 != 0.0)) {
		iVar3 = lego::res::Res_GetAnimAppData_Fieldc(building->aeResData);
		pBVar1 = (BuildingData *)((float)pBVar1 - (float)(ulonglong)(iVar3 * (param_3 - 1)));
	}
	building = pBVar1;
	if ((*(byte *)&pBVar2->flags & 2) != 0) {
		if (pBVar2->PowerLevelScene != NULL) {
			uVar4 = lego::res::Res_GetAnimAppData_Fieldc(pBVar2->PowerLevelScene);
			lego::res::Res_DoCallbacks
								(pBVar2->PowerLevelScene,(float)(ulonglong)uVar4 * (float)pBVar2->field_80);
		}
		pBVar2->flags = pBVar2->flags & 0xfffffffd;
	}
	return (float10)(float)building;
}



float10 __cdecl lego::res::Building_GetAnimFloat14_zero(BuildingData *building)
{
	return (float10)0.0;
}



void __cdecl lego::game::LiveObject_ReleaseBuilding(BuildingData *building)
{
	LiveObject_BuildingChangeUpgradeParts(building,-1);
	if (building->PowerLevelScene != NULL) {
		pool::ReservedPool_ResourceData___Release(building->PowerLevelScene);
	}
	pool::ReservedPool_ResourceData___Release(building->aeResData);
	return;
}



BOOL __cdecl FUN_004088a0(BuildingData *building,int levelBit,BOOL condition)
{
	uint uVar1;
	
	uVar1 = 1 << ((byte)levelBit & 0x1f);
	if ((condition != 0) && (((building->upgrades).levelsMask & uVar1) != 0)) {
		return 0;
	}
	return (building->upgrades).levelsMask & uVar1;
}



void __cdecl lego::game::LiveObject_BuildingChangeUpgradeParts(BuildingData *building,int objLevel)
{
	LiveObject_ChangeUpgradeParts(&building->upgrades,objLevel);
	LiveObject_BuildingUnkUpgrades(building,NULL);
	return;
}



float10 __cdecl FUN_00408900(float *param_1,float *param_2,float *param_3)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	float10 fVar6;
	unkbyte10 Var7;
	
	fVar3 = *param_3 - *param_2;
	fVar5 = param_3[1] - param_2[1];
	fVar1 = (float)((float10)*param_1 - (float10)*param_3);
	fVar2 = (float)((float10)param_1[1] - (float10)param_3[1]);
	fVar6 = SQRT(((float10)param_1[1] - (float10)param_3[1]) * (float10)fVar2 +
							 ((float10)*param_1 - (float10)*param_3) * (float10)fVar1);
	fVar4 = 1.0 / SQRT(fVar5 * fVar5 + fVar3 * fVar3);
	fVar3 = fVar4 * fVar3;
	fVar4 = fVar4 * fVar5;
	if ((float10)(float)((float10)1.0 / fVar6) * (float10)fVar2 * (float10)fVar4 +
			((float10)1.0 / fVar6) * (float10)fVar1 * (float10)fVar3 < (float10)0.0) {
		fVar5 = *param_1 - *param_2;
		fVar1 = param_1[1] - param_2[1];
		fVar2 = SQRT(fVar1 * fVar1 + fVar5 * fVar5);
		fVar1 = (1.0 / fVar2) * fVar1 * fVar4 + (1.0 / fVar2) * fVar5 * fVar3;
		if ((ushort)((ushort)(fVar1 < 0.0) << 8 | (ushort)(fVar1 == 0.0) << 0xe) != 0) {
			return (float10)fVar2;
		}
		Var7 = FUN_0048e350();
		fVar6 = (float10)fsin(Var7);
		fVar6 = fVar6 * (float10)fVar2;
	}
	return fVar6;
}



float10 __cdecl FUN_00408a30(float *param_1,float *param_2,float *param_3,uint param_4)
{
	float *pfVar1;
	int iVar2;
	float *pfVar3;
	float10 fVar4;
	
	fVar4 = FUN_00408900(param_1,param_2,param_3);
	pfVar1 = (float *)(float)fVar4;
	if (1 < param_4) {
		pfVar3 = (float *)((int)param_3 - (int)param_2);
		iVar2 = param_4 - 1;
		param_3 = (float *)(float)fVar4;
		do {
			param_2 = param_2 + 2;
			fVar4 = FUN_00408900(param_1,param_2,(float *)((int)pfVar3 + (int)param_2));
			if (fVar4 < (float10)(float)param_3) {
				param_3 = (float *)(float)fVar4;
			}
			iVar2 += -1;
			pfVar1 = param_3;
		} while (iVar2 != 0);
	}
	param_3 = pfVar1;
	return (float10)(float)param_3;
}



void __cdecl FUN_00408a90(float *param_1,float *param_2,float *param_3,float *param_4)
{
	float fVar1;
	float fVar2;
	float fVar3;
	
	fVar3 = *param_2 - *param_1;
	fVar1 = param_2[1] - param_1[1];
	fVar2 = 1.0 / SQRT(fVar1 * fVar1 + fVar3 * fVar3);
	fVar3 = fVar2 * fVar3;
	fVar2 = fVar2 * fVar1;
	fVar1 = (param_3[1] - param_1[1]) * fVar2 + (*param_3 - *param_1) * fVar3;
	*param_4 = fVar1 * fVar3 + *param_1;
	param_4[1] = fVar1 * fVar2 + param_1[1];
	return;
}



void __cdecl FUN_00408b20(float *param_1,float *param_2,float *param_3,float *param_4)
{
	float fVar1;
	float fVar2;
	float fVar3;
	
	fVar1 = param_2[1];
	fVar2 = *param_2;
	fVar3 = 1.0 / SQRT(fVar1 * fVar1 + fVar2 * fVar2);
	fVar2 = fVar3 * fVar2;
	fVar3 = fVar3 * fVar1;
	fVar1 = (param_3[1] - param_1[1]) * fVar3 + (*param_3 - *param_1) * fVar2;
	*param_4 = fVar1 * fVar2 + *param_1;
	param_4[1] = fVar1 * fVar3 + param_1[1];
	return;
}



uint __cdecl lego::game::Game_GetBuildingBase(char *name)
{
	byte bVar1;
	byte *pbVar2;
	int iVar3;
	uint uVar4;
	byte *pbVar5;
	char **ppcVar6;
	bool bVar7;
	
	uVar4 = 0;
	if (globals::g_BuildingBase_COUNT == 0) {
		return 0;
	}
	ppcVar6 = globals::g_BuildingBase_TABLE;
	do {
		pbVar2 = (byte *)*ppcVar6;
		pbVar5 = (byte *)name;
		do {
			bVar1 = *pbVar2;
			bVar7 = bVar1 < *pbVar5;
			if (bVar1 != *pbVar5) {
LAB_00408bee:
				iVar3 = (1 - (uint)bVar7) - (uint)(bVar7 != 0);
				goto LAB_00408bf3;
			}
			if (bVar1 == 0) break;
			bVar1 = pbVar2[1];
			bVar7 = bVar1 < pbVar5[1];
			if (bVar1 != pbVar5[1]) goto LAB_00408bee;
			pbVar2 = pbVar2 + 2;
			pbVar5 = pbVar5 + 2;
		} while (bVar1 != 0);
		iVar3 = 0;
LAB_00408bf3:
		if (iVar3 == 0) {
			return uVar4;
		}
		uVar4 += 1;
		ppcVar6 = (char **)((byte **)ppcVar6 + 1);
		if (globals::g_BuildingBase_COUNT <= uVar4) {
			return globals::g_BuildingBase_COUNT;
		}
	} while( true );
}



void __cdecl FUN_00408c10(int param_1,LiveObject *liveObj)
{
	int iVar1;
	
	iVar1 = FUN_00408ff0(NULL,&param_1);
	if (iVar1 == 0) {
		if (liveObj->objType == OBJECT_POWERCRYSTAL) {
			lego::game::Level_AddMessageAction(MESSAGE_GENERATECRYSTAL_COMPLETE,liveObj,0,NULL);
			return;
		}
		lego::game::Level_AddMessageAction(MESSAGE_GENERATEORE_COMPLETE,liveObj,0,NULL);
	}
	else {
		if (liveObj != NULL) {
			liveObj->flags4_3ec = liveObj->flags4_3ec | 0x100;
			*(LiveObject **)(iVar1 + 0x2c + *(int *)(iVar1 + 0xcc) * 4) = liveObj;
			*(int *)(iVar1 + 0xcc) = *(int *)(iVar1 + 0xcc) + 1;
			*(int *)(iVar1 + 0x20) = *(int *)(iVar1 + 0x20) + 1;
		}
		if (*(int *)(iVar1 + 0x1c) == *(int *)(iVar1 + 0x20)) {
			*(undefined4 *)(iVar1 + 0x28) = 0x42fa0000;
			*(uint *)(iVar1 + 0xd0) = *(uint *)(iVar1 + 0xd0) | 1;
			return;
		}
	}
	return;
}



undefined4 __cdecl FUN_00408ca0(int param_1,int param_2,int param_3)
{
	int iVar1;
	int iVar2;
	int *piVar3;
	uint uVar4;
	ObjectType objType;
	uint uVar5;
	
	piVar3 = (int *)FUN_00408ff0(NULL,&param_1);
	iVar2 = param_3;
	iVar1 = param_2;
	if (piVar3 != NULL) {
		uVar4 = FUN_00408d40((int)piVar3,param_2,param_3);
		objType = (-(uint)((piVar3[0x34] & 2U) != 0) & 0xb) + OBJECT_BUILDING;
		if (iVar1 == 6) {
			uVar5 = lego::game::Object_GetCostCrystal(objType,*piVar3,0);
		}
		else {
			if (iVar1 != 7) {
				return 1;
			}
			if (iVar2 == 0) {
				uVar5 = lego::game::Object_GetCostOre(objType,*piVar3,0);
			}
			else {
				uVar5 = lego::game::Object_GetCostRefinedOre(objType,*piVar3,0);
			}
		}
		if (uVar4 < uVar5) {
			return 1;
		}
	}
	return 0;
}



int __cdecl FUN_00408d40(int param_1,int param_2,int param_3)
{
	int iVar1;
	int **ppiVar2;
	int iVar3;
	
	iVar1 = 0;
	iVar3 = *(int *)(param_1 + 0x20);
	if (iVar3 != 0) {
		ppiVar2 = (int **)(param_1 + 0x2c);
		do {
			if ((param_2 == **ppiVar2) && (param_3 == (*ppiVar2)[1])) {
				iVar1 += 1;
			}
			ppiVar2 = ppiVar2 + 1;
			iVar3 += -1;
		} while (iVar3 != 0);
	}
	return iVar1;
}



void __cdecl
lego::game::Level_SpawnCarryableObject
					(Point2I *position,ObjectType objType,int objIndex,int objLevel,int count)
{
	int iVar1;
	
	iVar1 = FUN_00408ff0(position,NULL);
	if ((objType == OBJECT_ORE) && (objIndex == 1)) {
		*(uint *)(iVar1 + 0xd0) = *(uint *)(iVar1 + 0xd0) | 8;
	}
	if (count != 0) {
		do {
			*(int *)(iVar1 + 0x1c) = *(int *)(iVar1 + 0x1c) + 1;
			FUN_00403680(objType,objIndex,objLevel,position,*(undefined4 *)(iVar1 + 8),NULL,0);
			count += -1;
		} while (count != 0);
	}
	return;
}



void __cdecl FUN_00408df0(int *param_1,uint *param_2,uint param_3)
{
	uint *puVar1;
	bool bVar2;
	int iVar3;
	LevelSurfaceMap *surfMap;
	uint *puVar4;
	uint uVar5;
	uint *puVar6;
	uint *puVar7;
	Point2I *position;
	uint *puVar8;
	float10 fVar9;
	uint local_4c;
	int local_40 [5];
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	Point2F local_20;
	float local_18;
	undefined4 local_14;
	undefined4 local_10;
	float local_c;
	float local_8;
	undefined4 local_4;
	
	iVar3 = FUN_00408ff0((Point2I *)param_1,NULL);
	surfMap = lego::game::GetSurfaceMap();
	fVar9 = lego::game::SurfaceMap_GetFloat10(surfMap);
	local_40[2] = 1;
	local_2c = 1;
	local_40[1] = 0xffffffff;
	local_28 = 0xffffffff;
	local_40[0] = 0;
	local_40[3] = 0;
	local_40[4] = 0;
	local_24 = 0;
	local_4c = 0;
	local_20.x = 0.5;
	local_14 = 0x3f000000;
	local_10 = 0x3f000000;
	local_4 = 0x3f000000;
	local_c = (float)((float10)8.8 / fVar9);
	local_20.y = 1.0 - local_c;
	if (param_3 != 0) {
		puVar6 = param_2 + 1;
		puVar8 = param_2 + 2;
		position = (Point2I *)param_2;
		local_18 = local_20.y;
		local_8 = local_c;
		do {
			if (((local_4c == param_3 - 1) || (position->x != *puVar8)) || (*puVar6 != puVar8[1])) {
				param_1 = NULL;
				do {
					bVar2 = false;
					uVar5 = 0;
					puVar4 = param_2;
					puVar1 = param_2;
					do {
						puVar7 = puVar1 + 2;
						if (((uVar5 == param_3 - 1) || (*puVar4 != *puVar7)) || (puVar4[1] != puVar1[3])) {
							if ((*puVar4 ==
									 *(int *)((int)((int)register0x00000010 + -0x40) + (int)param_1) + position->x) &&
								 (puVar4[1] == *puVar6 + *(int *)((int)register0x00000010 + -0x3c + (int)param_1)))
							{
								bVar2 = true;
							}
						}
						else {
							uVar5 += 1;
							puVar7 = puVar1 + 4;
							puVar4 = puVar4 + 2;
						}
						uVar5 += 1;
						puVar4 = puVar4 + 2;
						puVar1 = puVar7;
					} while (uVar5 < param_3);
					if (!bVar2) {
						FUN_00403680(OBJECT_BARRIER,0,0,position,*(undefined4 *)(iVar3 + 8),
												 (Point2F *)((int)&local_20.x + (int)param_1),1);
						*(int *)(iVar3 + 0x1c) = *(int *)(iVar3 + 0x1c) + 1;
					}
					param_1 = param_1 + 2;
				} while (param_1 < &DAT_00000020);
			}
			else {
				local_4c += 1;
				puVar8 = puVar8 + 2;
				position = position + 1;
				puVar6 = puVar6 + 2;
			}
			local_4c += 1;
			puVar8 = puVar8 + 2;
			position = position + 1;
			puVar6 = puVar6 + 2;
		} while (local_4c < param_3);
	}
	return;
}



BOOL __cdecl FUN_00408fd0(Point2I *param_1)
{
	int iVar1;
	
	iVar1 = FUN_00408ff0(param_1,NULL);
	return (uint)(iVar1 != 0);
}



int __cdecl FUN_00408ff0(Point2I *param_1,int *param_2)
{
	int *piVar1;
	int iVar2;
	
	iVar2 = DAT_004b9a24;
	if (DAT_004b9a24 != 0) {
		do {
			if (param_1 == NULL) {
				if ((param_2 != NULL) && (*param_2 == *(int *)(iVar2 + 8))) {
					return iVar2;
				}
			}
			else {
				if ((param_1->x == *(int *)(iVar2 + 0xc)) && (param_1->y == *(int *)(iVar2 + 0x10))) {
					return iVar2;
				}
			}
			piVar1 = (int *)(iVar2 + 0x24);
			iVar2 = *piVar1;
		} while (*piVar1 != 0);
	}
	return 0;
}



void __cdecl FUN_00409040(int *param_1)
{
	undefined *puVar1;
	
	puVar1 = (undefined *)FUN_00408ff0((Point2I *)param_1,NULL);
	if (puVar1 != NULL) {
		FUN_0041cee0((Point2I *)param_1);
		FUN_00409970((int)puVar1);
		FUN_00409920(puVar1);
	}
	return;
}



void __cdecl FUN_00409080(Point2I *position)
{
	LiveFlags4 *pLVar1;
	LiveObject *liveObj;
	undefined *puVar2;
	uint uVar3;
	LiveObject **ppLVar4;
	
	puVar2 = (undefined *)FUN_00408ff0(position,NULL);
	FUN_00432490(position,0);
	uVar3 = 0;
	if (*(int *)(puVar2 + 0xcc) != 0) {
		ppLVar4 = (LiveObject **)(puVar2 + 0x2c);
		do {
			liveObj = *ppLVar4;
			pLVar1 = &liveObj->flags4_3ec;
			*pLVar1 = *pLVar1 & 0xfffffeff;
			FUN_00402650(liveObj,0.0);
			uVar3 += 1;
			ppLVar4 = ppLVar4 + 1;
		} while (uVar3 < *(uint *)(puVar2 + 0xcc));
	}
	FUN_0041cee0(position);
	FUN_00403630(*(int *)(puVar2 + 8),0,0,0);
	FUN_00409920(puVar2);
	return;
}



void __cdecl FUN_00409110(undefined4 param_1)
{
	uint *puVar1;
	uint uVar2;
	uint *puVar3;
	
	puVar3 = DAT_004b9a24;
	if (DAT_004b9a24 != NULL) {
		do {
			uVar2 = puVar3[0x34];
			puVar1 = (uint *)puVar3[9];
			if (((uVar2 & 2) == 0) || ((uVar2 & 4) != 0)) {
				if ((uVar2 & 1) != 0) {
					if ((uVar2 & 2) == 0) {
						uVar2 = FUN_004091a0(puVar3);
						if (uVar2 != 0) {
							FUN_00409970((int)puVar3);
							FUN_00409a60(puVar3,1);
							FUN_00409920((undefined *)puVar3);
						}
					}
					else {
						FUN_004026d0((Point2I *)(puVar3 + 3));
						puVar3[0x34] = puVar3[0x34] & 0xfffffffe;
					}
				}
			}
			else {
				FUN_00409480((int)puVar3);
			}
			puVar3 = puVar1;
		} while (puVar1 != NULL);
	}
	return;
}



uint __cdecl FUN_004091a0(LiveObject *param_1)
{
	BOOL BVar1;
	
	BVar1 = FUN_00437a70((LiveObjectPredicate *)&LAB_004091c0,param_1);
	return (uint)(BVar1 == 0);
}



BOOL __cdecl FUN_00409230(Point2I *position)
{
	BOOL BVar1;
	undefined4 *puVar2;
	
	BVar1 = lego::game::Level_IsBlockPowerPath(position);
	if (BVar1 == 0) {
		puVar2 = lego::unk::Lego_AllocStruct_d4(position);
		FUN_00432490(position,1);
		puVar2[0x34] = puVar2[0x34] | 2;
		FUN_0041cee0(position);
		return 1;
	}
	return 0;
}



undefined4 * __cdecl lego::unk::Lego_AllocStruct_d4(Point2I *position)
{
	undefined4 *puVar1;
	int iVar2;
	undefined4 *puVar3;
	
	puVar1 = (undefined4 *)std::malloc(0xd4);
	puVar3 = puVar1;
	for (iVar2 = 0x35; iVar2 != 0; iVar2 += -1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	puVar1[8] = 0;
	puVar1[7] = 0;
	puVar1[2] = UINT_004b9a20;
	UINT_004b9a20 += 1;
	puVar1[3] = position->x;
	puVar1[4] = position->y;
	puVar1[9] = DAT_004b9a24;
	DAT_004b9a24 = puVar1;
	return puVar1;
}



void __cdecl FUN_004092e0(int *param_1)
{
	Point2I *pPVar1;
	BOOL BVar2;
	uint uVar3;
	Point2I *position;
	int iVar4;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_20[0] = 0;
	local_20[1] = 0xffffffff;
	local_20[2] = 1;
	local_20[3] = 0;
	local_20[4] = 0;
	local_c = 1;
	local_8 = 0xffffffff;
	local_4 = 0;
	iVar4 = 4;
	pPVar1 = (Point2I *)&stack0xffffffd8;
	do {
		position = pPVar1 + 1;
		position->x = position->x + *param_1;
		pPVar1[1].y = pPVar1[1].y + param_1[1];
		BVar2 = lego::game::Level_IsBlockPowerPath(position);
		if (BVar2 == 0) {
			BVar2 = FUN_004329d0(position->x,pPVar1[1].y,1);
			if (BVar2 != 0) goto LAB_00409350;
		}
		else {
LAB_00409350:
			uVar3 = FUN_004320a0((int *)position);
			if (uVar3 == 0) {
				FUN_00432030((int *)position);
				FUN_004092e0((int *)position);
			}
		}
		iVar4 += -1;
		pPVar1 = position;
		if (iVar4 == 0) {
			return;
		}
	} while( true );
}



undefined4 __cdecl FUN_00409380(int *param_1,int param_2)
{
	undefined4 uVar1;
	
	uVar1 = FUN_004093a0(param_1,param_2);
	FUN_00432230();
	return uVar1;
}



undefined4 __cdecl FUN_004093a0(int *param_1,int param_2)
{
	uint uVar1;
	int iVar2;
	BOOL BVar3;
	Point2I *position;
	uint uVar4;
	Point2I local_20;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	uVar4 = 0;
	local_20.x = 0;
	local_20.y = -1;
	local_18 = 1;
	local_14 = 0;
	local_10 = 0;
	local_c = 1;
	local_8 = 0xffffffff;
	local_4 = 0;
	position = &local_20;
	do {
		position->x = position->x + *param_1;
		position->y = position->y + param_1[1];
		uVar1 = FUN_00432f90((int *)position);
		if (((uVar1 != 0) && (iVar2 = FUN_00438930((undefined4 *)position), iVar2 != 0)) &&
			 (BVar3 = FUN_004389e0(iVar2,param_2), BVar3 != 0)) {
			return 1;
		}
		BVar3 = lego::game::Level_IsBlockPowerPath(position);
		if (((BVar3 != 0) || (BVar3 = FUN_004329d0(position->x,position->y,1), BVar3 != 0)) &&
			 (uVar1 = FUN_00432200((int *)position), uVar1 == 0)) {
			FUN_004321a0((int *)position);
			iVar2 = FUN_004093a0((int *)position,param_2);
			if (iVar2 != 0) {
				return 1;
			}
		}
		uVar4 += 1;
		position = position + 1;
	} while (uVar4 < 4);
	return 0;
}



void __cdecl FUN_00409480(int param_1)
{
	Point2I *position;
	int iVar1;
	LiveObject *pLVar2;
	int iVar3;
	int iVar4;
	
	position = (Point2I *)(param_1 + 0xc);
	iVar1 = lego::util::return_1(position);
	if (iVar1 != 0) {
		pLVar2 = FUN_00438da0(NULL,position,OBJECT_ORE,0);
		iVar3 = lego::game::Object_GetCostCrystal(OBJECT_PATH,0,0);
		iVar1 = lego::game::Object_GetCostOre(OBJECT_PATH,0,0);
		iVar4 = lego::game::Object_GetCostRefinedOre(OBJECT_PATH,0,0);
		lego::game::Level_SpawnCarryableObject(position,OBJECT_POWERCRYSTAL,0,0,iVar3);
		if ((pLVar2 == NULL) || (iVar4 == 0)) {
			iVar3 = 0;
		}
		else {
			iVar3 = 1;
			iVar1 = iVar4;
		}
		lego::game::Level_SpawnCarryableObject(position,OBJECT_ORE,iVar3,0,iVar1);
		*(uint *)(param_1 + 0xd0) = *(uint *)(param_1 + 0xd0) | 4;
	}
	return;
}



void __cdecl FUN_00409530(Point2I *position)
{
	LiveObject *pLVar1;
	LevelData *level;
	undefined *puVar2;
	int iVar3;
	int iVar4;
	uint uVar5;
	LiveObject **ppLVar6;
	uint uVar7;
	
	level = lego::globals::g_Game.level;
	puVar2 = (undefined *)FUN_00408ff0(position,NULL);
	if ((puVar2 != NULL) && (*(int *)(puVar2 + 0x1c) != *(int *)(puVar2 + 0x20))) {
		uVar7 = *(uint *)(puVar2 + 0x18);
		uVar5 = 0;
		if (uVar7 != 0) {
			do {
				if (((uVar5 != uVar7 - 1) &&
						(iVar3 = *(int *)(puVar2 + 0x14),
						*(int *)(iVar3 + uVar5 * 8) == *(int *)(iVar3 + 8 + uVar5 * 8))) &&
					 (iVar4 = *(int *)(iVar3 + 4 + uVar5 * 8), iVar4 == *(int *)(iVar3 + 0xc + uVar5 * 8))) {
					iVar3 = iVar4 * (level->dimensions).width + *(int *)(iVar3 + uVar5 * 8);
					level->blocks[iVar3].flags1 = level->blocks[iVar3].flags1 & ~BLOCK1_UNK_8000;
				}
				iVar3 = uVar5 * 8;
				iVar4 = *(int *)(iVar3 + 4 + *(int *)(puVar2 + 0x14)) * (level->dimensions).width +
								*(int *)(iVar3 + *(int *)(puVar2 + 0x14));
				level->blocks[iVar4].flags1 = level->blocks[iVar4].flags1 & ~BLOCK1_UNK_100000;
				level->blocks
				[*(int *)(iVar3 + 4 + *(int *)(puVar2 + 0x14)) * (level->dimensions).width +
				 *(int *)(iVar3 + *(int *)(puVar2 + 0x14))].field_10 = 0;
				lego::game::Level_UpdateBlockSurfaceUnk
									(level,*(int *)(*(int *)(puVar2 + 0x14) + iVar3),
									 ((int *)(*(int *)(puVar2 + 0x14) + iVar3))[1]);
				FUN_0041cee0((Point2I *)(iVar3 + *(int *)(puVar2 + 0x14)));
				uVar7 = *(uint *)(puVar2 + 0x18);
				uVar5 += 1;
			} while (uVar5 < uVar7);
		}
		uVar7 = 0;
		if (*(int *)(puVar2 + 0xcc) != 0) {
			ppLVar6 = (LiveObject **)(puVar2 + 0x2c);
			do {
				pLVar1 = *ppLVar6;
				if (pLVar1->objType == OBJECT_BARRIER) {
					pLVar1->flags3_3e8 = pLVar1->flags3_3e8 | 0x800000;
					(*ppLVar6)->health = -1.0;
				}
				else {
					pLVar1->flags4_3ec = pLVar1->flags4_3ec & 0xfffffeff;
					FUN_00402650(*ppLVar6,0.0);
				}
				uVar7 += 1;
				ppLVar6 = ppLVar6 + 1;
			} while (uVar7 < *(uint *)(puVar2 + 0xcc));
		}
		FUN_00403630(*(int *)(puVar2 + 8),0,0,0);
		FUN_00409920(puVar2);
	}
	return;
}



int __cdecl FUN_004096c0(int objIndex,Point2I *param_2,int param_3,Point2I *param_4,uint count)
{
	LevelBlockFlags1 *pLVar1;
	bool bVar2;
	LevelData *level;
	int *piVar3;
	int *piVar4;
	LevelSurfaceMap *pLVar5;
	uint uVar6;
	int iVar7;
	Point2I *pPVar8;
	Point2I *pPVar9;
	uint *puVar10;
	float fVar11;
	
	level = lego::globals::g_Game.level;
	piVar3 = lego::unk::Lego_AllocStruct_d4(param_2);
	*piVar3 = objIndex;
	piVar3[1] = param_3;
	piVar4 = (int *)std::malloc(count * 8);
	piVar3[5] = (int)piVar4;
	pPVar8 = param_4;
	for (uVar6 = count * 8 >> 2; uVar6 != 0; uVar6 -= 1) {
		*piVar4 = pPVar8->x;
		pPVar8 = (Point2I *)&pPVar8->y;
		piVar4 = piVar4 + 1;
	}
	fVar11 = 4.0;
	for (iVar7 = 0; iVar7 != 0; iVar7 += -1) {
		*(undefined *)piVar4 = *(undefined *)&pPVar8->x;
		pPVar8 = (Point2I *)((int)&pPVar8->x + 1);
		piVar4 = (int *)((int)piVar4 + 1);
	}
	puVar10 = (uint *)piVar3[5];
	piVar3[6] = count;
	uVar6 = count;
	pLVar5 = lego::game::GetSurfaceMap();
	FUN_0044ed90(pLVar5,puVar10,uVar6,fVar11);
	param_2 = NULL;
	if (count != 0) {
		pPVar8 = param_4 + 1;
		do {
			if (((param_2 == (Point2I *)(count - 1)) || (param_4->x != pPVar8->x)) ||
				 (param_4->y != pPVar8->y)) {
				bVar2 = false;
			}
			else {
				bVar2 = true;
				pLVar1 = &level->blocks[param_4->y * (level->dimensions).width + param_4->x].flags1;
				*pLVar1 = *pLVar1 | BLOCK1_UNK_8000;
				level->blocks[param_4->y * (level->dimensions).width + param_4->x].field_10 = piVar3;
			}
			iVar7 = param_4->y * (level->dimensions).width + param_4->x;
			level->blocks[iVar7].flags1 = level->blocks[iVar7].flags1 | BLOCK1_UNK_100000;
			level->blocks[param_4->y * (level->dimensions).width + param_4->x].field_10 = piVar3;
			lego::game::Level_UpdateBlockSurfaceUnk(level,param_4->x,param_4->y);
			FUN_00409870(param_4);
			FUN_0041cee0(param_4);
			pPVar9 = param_4;
			if (bVar2) {
				param_2 = (Point2I *)((int)&param_2->x + 1);
				pPVar9 = param_4 + 1;
				pPVar8 = pPVar8 + 1;
			}
			param_4 = pPVar8;
			param_2 = (Point2I *)((int)&param_2->x + 1);
			pPVar8 = param_4 + 1;
			param_4 = pPVar9 + 1;
		} while (param_2 < count);
	}
	return piVar3[2];
}



void __cdecl FUN_00409870(Point2I *param_1)
{
	int *piVar1;
	int iVar2;
	Point2I locations [8];
	
	locations[0].x = -1;
	locations[0].y = -1;
	locations[1].x = 0;
	locations[1].y = -1;
	locations[2].x = 1;
	locations[2].y = -1;
	locations[3].x = 1;
	locations[3].y = 0;
	locations[4].x = 1;
	locations[4].y = 1;
	locations[5].x = 0;
	locations[5].y = 1;
	locations[6].x = -1;
	locations[6].y = 1;
	locations[7].x = -1;
	locations[7].y = 0;
	iVar2 = 8;
	piVar1 = (int *)&stack0xffffffb8;
	do {
		FUN_004332b0(lego::globals::g_Game.level,param_1->x + piVar1[2],piVar1[3] + param_1->y);
		iVar2 += -1;
		piVar1 = piVar1 + 2;
	} while (iVar2 != 0);
	return;
}



void __cdecl FUN_00409900(void)
{
	undefined *puVar1;
	undefined *puVar2;
	
	puVar2 = DAT_004b9a24;
	if (DAT_004b9a24 != NULL) {
		do {
			puVar1 = *(undefined **)(puVar2 + 0x24);
			FUN_00409920(puVar2);
			puVar2 = puVar1;
		} while (puVar1 != NULL);
	}
	return;
}



void __cdecl FUN_00409920(undefined *param_1)
{
	undefined *puVar1;
	undefined *puVar2;
	undefined *puVar3;
	
	puVar1 = DAT_004b9a24;
	puVar3 = NULL;
	if (DAT_004b9a24 != NULL) {
		do {
			puVar2 = puVar1;
			if (puVar2 == param_1) {
				if (puVar3 == NULL) {
					DAT_004b9a24 = *(undefined **)(puVar2 + 0x24);
				}
				else {
					*(undefined4 *)(puVar3 + 0x24) = *(undefined4 *)(puVar2 + 0x24);
				}
				break;
			}
			puVar1 = *(undefined **)(puVar2 + 0x24);
			puVar3 = puVar2;
		} while (*(undefined **)(puVar2 + 0x24) != NULL);
	}
	std::free(*(void **)(param_1 + 0x14));
	std::free(param_1);
	return;
}



void __cdecl FUN_00409970(int param_1)
{
	int iVar1;
	uint uVar2;
	int *piVar3;
	
	uVar2 = 0;
	if (*(int *)(param_1 + 0xcc) != 0) {
		piVar3 = (int *)(param_1 + 0x2c);
		do {
			iVar1 = *piVar3;
			piVar3 = piVar3 + 1;
			*(undefined4 *)(iVar1 + 0x340) = 0xbf800000;
			uVar2 += 1;
			*(uint *)(iVar1 + 1000) = *(uint *)(iVar1 + 1000) | 0x800000;
		} while (uVar2 < *(uint *)(param_1 + 0xcc));
	}
	return;
}



void __cdecl
FUN_004099c0(uint param_1,int *param_2,undefined4 param_3,uint *param_4,uint param_5,int param_6)
{
	LevelSurfaceMap *pLVar1;
	int iVar2;
	uint *puVar3;
	float fVar4;
	uint local_d4 [4];
	int local_c4;
	uint *local_c0;
	uint local_bc;
	
	puVar3 = local_d4;
	for (iVar2 = 0x35; iVar2 != 0; iVar2 += -1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	local_d4[3] = *param_2;
	local_c4 = param_2[1];
	local_d4[0] = param_1;
	local_d4[1] = param_3;
	fVar4 = 4.0;
	local_c0 = param_4;
	local_bc = param_5;
	pLVar1 = lego::game::GetSurfaceMap();
	FUN_0044ed90(pLVar1,param_4,param_5,fVar4);
	FUN_00409870((Point2I *)param_2);
	FUN_00409a60(local_d4,param_6);
	return;
}



uint * __cdecl FUN_00409a60(uint *param_1,int param_2)
{
	int iVar1;
	int *piVar2;
	ulonglong uVar3;
	LevelSurfaceMap *surfMap;
	LiveObject *liveObj;
	uint uVar4;
	ObjectStatsFlags1 OVar5;
	ObjectStatsFlags2 OVar6;
	uint uVar7;
	uint x;
	float *out_x;
	float *out_y;
	float local_c;
	float local_8;
	undefined4 uStack4;
	
	uVar7 = 0;
	uStack4 = 0;
	out_y = &local_c;
	local_8 = (float)param_1[1];
	out_x = &local_8;
	uVar4 = param_1[4];
	uVar3 = (ulonglong)(uint)local_8;
	x = param_1[3];
	surfMap = lego::game::GetSurfaceMap();
	FUN_0044f900(surfMap,x,uVar4,out_x,out_y);
	liveObj = lego::game::Game_CreateLiveResourceObject
											((ResourceData *)(lego::globals::g_Game.BuildingData_TABLE + *param_1),
											 OBJECT_BUILDING,*param_1,0,local_8,local_c,(float)uVar3 * 1.570796);
	if (param_2 != 0) {
		FUN_00447dc0((uint *)liveObj);
		lego::game::Info_FUN_00419ab0(INFO_CONSTRUCTED,NULL,liveObj,NULL);
	}
	uVar4 = param_1[6];
	if (uVar4 != 0) {
		do {
			if (uVar7 == uVar4 - 1) {
LAB_00409b4b:
				OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj);
				iVar1 = uVar7 * 8;
				if ((OVar5 & STATS1_TOOLSTORE) == STATS1_NONE) {
					FUN_0041cee0((Point2I *)(iVar1 + param_1[5]));
					FUN_00432380(*(int **)(iVar1 + param_1[5]),*(int **)(iVar1 + 4 + param_1[5]));
					OVar6 = lego::game::LiveObject_GetStatsFlags2(liveObj);
					if ((OVar6 & STATS2_GENERATEPOWER) != STATS2_NONE) {
						FUN_00432500((int *)(iVar1 + param_1[5]));
					}
					FUN_00409c00((int *)(iVar1 + param_1[5]));
				}
				else {
					FUN_00432320((int **)(iVar1 + param_1[5]));
				}
				FUN_0040cdd0(*(int *)(iVar1 + param_1[5]),*(int *)(iVar1 + 4 + param_1[5]));
			}
			else {
				uVar4 = param_1[5];
				iVar1 = uVar7 * 8;
				if ((*(int *)(iVar1 + uVar4) != *(int *)(iVar1 + 8 + uVar4)) ||
					 (piVar2 = *(int **)(iVar1 + 4 + uVar4), piVar2 != *(int **)(iVar1 + 0xc + uVar4)))
				goto LAB_00409b4b;
				FUN_004323c0(*(int **)(iVar1 + uVar4),piVar2);
				FUN_004403f0((int)liveObj,(int *)(iVar1 + param_1[5]));
				uVar7 += 1;
			}
			uVar4 = param_1[6];
			uVar7 += 1;
		} while (uVar7 < uVar4);
	}
	return (uint *)liveObj;
}



void __cdecl FUN_00409c00(int *param_1)
{
	int iVar1;
	Point2I *pPVar2;
	Point2I local_20;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_20.x = 0;
	local_20.y = -1;
	local_18 = 1;
	local_14 = 0;
	local_10 = 0;
	local_c = 1;
	local_8 = 0xffffffff;
	local_4 = 0;
	pPVar2 = &local_20;
	iVar1 = 4;
	do {
		pPVar2->x = pPVar2->x + *param_1;
		pPVar2->y = pPVar2->y + param_1[1];
		FUN_00402a10(pPVar2,0);
		pPVar2 = pPVar2 + 1;
		iVar1 += -1;
	} while (iVar1 != 0);
	return;
}



void __cdecl lego::unk::Lego_SetBool_004b9a54(BOOL param_1)
{
	BOOL_004b9a54 = param_1;
	return;
}



void __cdecl FUN_00409c80(LiveObject *liveObj)
{
	Point2I *pPVar1;
	bool bVar2;
	int iVar3;
	Point2I *pPVar4;
	LevelSurfaceMap *pLVar5;
	Point2I *pPVar6;
	int iVar7;
	uint uVar8;
	float10 fVar9;
	uint x;
	uint y;
	float *out_x;
	float x_00;
	float *out_y;
	float y_00;
	uint local_34;
	Point2F local_30;
	int local_28;
	int local_24;
	float local_20;
	float local_1c;
	float local_18;
	float local_14;
	float local_10;
	Vector3F local_c;
	
	FUN_00442560(liveObj,&local_30);
	lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_28,&local_24);
	lego::game::LiveObject_GetPosition(liveObj,&local_20,&local_1c);
	if (ABS(local_30.x) <= ABS(local_30.y)) {
		if ((ushort)((ushort)(local_30.y < 0.0) << 8 | (ushort)(local_30.y == 0.0) << 0xe) == 0) {
			iVar7 = 0;
		}
		else {
			iVar7 = 2;
		}
	}
	else {
		if ((ushort)((ushort)(local_30.x < 0.0) << 8 | (ushort)(local_30.x == 0.0) << 0xe) == 0) {
			iVar7 = 1;
		}
		else {
			iVar7 = 3;
		}
	}
	iVar3 = FUN_00408290(lego::globals::g_Game.BuildingData_TABLE + liveObj->objIndex,&local_34);
	pPVar4 = (Point2I *)FUN_004643d0(&local_28,iVar3,local_34,iVar7);
	uVar8 = 0;
	pPVar1 = pPVar4;
	if (local_34 != 0) {
		do {
			pPVar6 = pPVar1 + 1;
			if (((uVar8 == local_34 - 1) || (pPVar4->x != pPVar6->x)) || (pPVar4->y != pPVar1[1].y)) {
				bVar2 = false;
			}
			else {
				bVar2 = true;
			}
			FUN_00432290((int **)pPVar4);
			FUN_004322f0((int *)pPVar4);
			if ((*(byte *)&liveObj->flags4_3ec & 8) == 0) {
				y = pPVar4->y;
				out_y = &local_14;
				out_x = &local_18;
				x = pPVar4->x;
				pLVar5 = lego::game::GetSurfaceMap();
				FUN_0044f900(pLVar5,x,y,out_x,out_y);
				x_00 = local_18;
				y_00 = local_14;
				pLVar5 = lego::game::GetSurfaceMap();
				fVar9 = lego::game::SurfaceMap_UnkGetZ(pLVar5,x_00,y_00);
				local_10 = (float)fVar9;
				lego::math::Vector3_Random(&local_c);
				local_c.z = 0.0;
				FUN_0040cc10(3,&local_18,(undefined4 *)&local_c);
				FUN_00430250(pPVar4,0x3b);
			}
			FUN_0040cdd0(pPVar4->x,pPVar4->y);
			if (bVar2) {
				uVar8 += 1;
				pPVar6 = pPVar1 + 2;
				pPVar4 = pPVar4 + 1;
			}
			uVar8 += 1;
			pPVar4 = pPVar4 + 1;
			pPVar1 = pPVar6;
		} while (uVar8 < local_34);
	}
	FUN_00409e50(liveObj);
	return;
}



void __cdecl FUN_00409e50(LiveObject *liveObj)
{
	int iVar1;
	int iVar2;
	Point2I local_8;
	
	if ((liveObj->flags4_3ec & 0x800) == 0) {
		lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_8,&local_8.y);
		iVar1 = lego::game::Object_GetCostOre(OBJECT_BUILDING,liveObj->objIndex,liveObj->objLevel);
		iVar2 = lego::game::Object_GetCostCrystal(OBJECT_BUILDING,liveObj->objIndex,liveObj->objLevel);
		lego::game::Object_GetCostRefinedOre(OBJECT_BUILDING,liveObj->objIndex,liveObj->objLevel);
		if (BOOL_004b9a54 == 0) {
			for (; iVar2 != 0; iVar2 += -1) {
				lego::game::Level_GenerateCrystal(&local_8,0,NULL,0);
			}
			for (; iVar1 != 0; iVar1 += -1) {
				lego::game::Level_GenerateOre(&local_8,0,NULL,0);
			}
		}
		liveObj->flags4_3ec = liveObj->flags4_3ec | 0x800;
	}
	return;
}



void __cdecl FUN_00409f20(LiveObject *liveObj)
{
	bool bVar1;
	bool bVar2;
	bool bVar3;
	ObjectStatsFlags1 OVar4;
	Point2F local_8;
	
	bVar3 = false;
	bVar1 = false;
	bVar2 = false;
	lego::game::LiveObject_GetPosition(liveObj,(float *)&local_8,&local_8.y);
	OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if (((OVar4 & STATS1_SMALLTELEPORTER) != STATS1_NONE) &&
		 (lego::globals::g_Game.placeDestSmallTeleporter == liveObj)) {
		bVar1 = true;
	}
	OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if (((OVar4 & STATS1_BIGTELEPORTER) != STATS1_NONE) &&
		 (lego::globals::g_Game.placeDestBigTeleporter == liveObj)) {
		bVar2 = true;
	}
	OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if (((OVar4 & STATS1_WATERTELEPORTER) != STATS1_NONE) &&
		 (lego::globals::g_Game.placeDestWaterTeleporter == liveObj)) {
		bVar3 = true;
	}
	if (bVar1) {
		lego::globals::g_Game.placeDestSmallTeleporter = (LiveObject *)FUN_00438ff0(&local_8);
	}
	if (bVar2) {
		lego::globals::g_Game.placeDestBigTeleporter = (LiveObject *)FUN_00438f90(&local_8);
	}
	if (bVar3) {
		lego::globals::g_Game.placeDestWaterTeleporter = (LiveObject *)FUN_00439050(&local_8);
	}
	lego::pool::ReservedPool_LiveObject___Release(liveObj);
	FUN_00439c50();
	return;
}



void __cdecl lego::main::Main_ShowCreditsFiles(char *textFile,ImageFont *font,char *aviFile)
{
	int *piVar1;
	LwoFrame *pLVar2;
	undefined **ppuVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	DWORD DVar7;
	ImageFont *pIVar8;
	int iVar9;
	int iVar10;
	int iVar11;
	char **ppcVar12;
	int iVar13;
	int local_444;
	uint local_440;
	uint local_43c;
	DWORD local_438;
	int local_434;
	uint local_430;
	int *local_42c;
	int local_428;
	int local_424;
	char **local_420;
	int local_41c;
	undefined **local_418;
	BOOL local_414;
	undefined4 local_410;
	undefined4 local_40c;
	int local_408;
	int local_404;
	char local_400 [1024];
	
	local_434 = 0;
	local_43c = 0;
	local_424 = 0;
	local_438 = timeGetTime();
	local_410 = 0;
	local_40c = 0;
	local_408 = globals::g_RESOLUTION.width;
	local_404 = globals::g_RESOLUTION.height;
	local_430 = draw::Font_GetField_be4(font);
	iVar13 = (uint)globals::g_RESOLUTION.height / local_430 + 1;
	local_41c = globals::g_RESOLUTION.width / 2;
	local_428 = iVar13;
	std::sprintf(local_400,"%s.cconv",textFile);
	pLVar2 = (LwoFrame *)lego::file::File_ReadAllBytes(local_400,&local_440);
	if ((pLVar2 != NULL) ||
		 (pLVar2 = (LwoFrame *)lego::file::File_ReadAllBytes(textFile,&local_440), pLVar2 != NULL)) {
		local_42c = FUN_0048df40(pLVar2,local_440 + 4);
		*(undefined *)(local_440 + (int)local_42c) = 0;
		ppuVar3 = (undefined **)video::Avi_FUN_0047ef50(aviFile);
		if (1 < (int)local_440) {
			iVar9 = local_440 - 1;
			piVar1 = local_42c;
			do {
				if ((*(char *)piVar1 == '\r') && (*(char *)(int *)((int)piVar1 + 1) == '\n')) {
					local_434 += 1;
				}
				iVar9 += -1;
				piVar1 = (int *)((int)piVar1 + 1);
			} while (iVar9 != 0);
		}
		local_434 += 1;
		local_418 = ppuVar3;
		local_420 = (char **)std::malloc(local_434 * 4);
		util::stringSplit((char *)local_42c,local_420,"\r\n");
		iVar9 = -iVar13;
		iVar10 = 0;
		local_444 = iVar9;
		do {
			iVar4 = input::Input_GetNumKeysPressed();
			if ((iVar4 != 0) || ((globals::g_ButtonState_LeftDown == 0 && (iVar10 != 0)))) {
				local_424 = 1;
			}
			local_414 = globals::g_ButtonState_LeftDown;
			FUN_0047efb0(ppuVar3);
			uVar5 = FUN_0047f020((int)ppuVar3);
			uVar6 = FUN_0047f010((int)ppuVar3);
			if (uVar5 <= uVar6) {
				FUN_0047f000(ppuVar3,0);
			}
			FUN_0047efc0((int)ppuVar3,&local_410);
			DVar7 = timeGetTime();
			iVar10 = iVar9;
			if (0x21 < DVar7 - local_438) {
				local_43c += 1;
				if (local_43c == local_430) {
					iVar10 = iVar9 + 1;
					local_43c = 0;
					local_444 = iVar10;
					if (iVar9 == local_434) {
						iVar10 = -iVar13;
						local_444 = iVar10;
					}
				}
				uVar5 = local_438 + 0x21;
				local_438 = uVar5;
				DVar7 = timeGetTime();
				if (uVar5 < DVar7) {
					local_438 = timeGetTime();
				}
			}
			iVar9 = iVar10;
			if (iVar10 < local_434) {
				iVar11 = iVar10 * local_430;
				ppcVar12 = local_420 + iVar10;
				iVar4 = iVar11;
				do {
					iVar9 = local_444;
					ppuVar3 = local_418;
					iVar13 = local_428;
					if (local_428 < iVar10 - local_444) break;
					if (-1 < iVar10) {
						pIVar8 = FUN_00401b90(font,"%s",*ppcVar12);
						FUN_0047a440(font,local_41c - (int)pIVar8 / 2,(iVar4 - iVar11) - local_43c,"%s",
												 *ppcVar12);
					}
					iVar10 += 1;
					iVar4 += local_430;
					ppcVar12 = ppcVar12 + 1;
					ppuVar3 = local_418;
					iVar13 = local_428;
				} while (iVar10 < local_434);
			}
			FUN_00465460(1.0);
			uVar5 = FUN_0047f040((int)ppuVar3);
			if (uVar5 == 0) {
				Main_UpdateAndRender__004781f0(1);
				Sleep(10);
			}
			else {
				Main_UpdateAndRender__004781f0(0);
			}
			iVar10 = local_414;
		} while (local_424 == 0);
		if (ppuVar3 != NULL) {
			FUN_0047f030(ppuVar3);
		}
		std::free(local_420);
		std::free(local_42c);
	}
	return;
}



void __cdecl FUN_0040a300(void)
{
	uint *puVar1;
	
	puVar1 = (uint *)&DAT_004b9aa0;
	do {
		if ((*puVar1 & 1) != 0) {
			*puVar1 = *puVar1 & 0xfffffffe;
			lego::res::Res_UnkSetup3DFrameTransform((ResourceData *)puVar1[-7],1);
		}
		puVar1 = puVar1 + 8;
	} while (puVar1 < &DAT_004b9be0);
	return;
}



void __cdecl lego::main::Main_LoadHealthFont(char *dirname,char *fileBaseName)
{
	int **ppiVar1;
	uint uVar2;
	char local_208 [260];
	char local_104 [260];
	
	uVar2 = 0;
	do {
		std::sprintf(local_104,"%s\\",dirname);
		if (fileBaseName == NULL) {
			std::sprintf(local_208,"%i.bmp",uVar2);
		}
		else {
			std::sprintf(local_208,"%s%i.bmp",fileBaseName);
		}
		if (uVar2 == 10) {
			DAT_004b9a80 = draw::Draw_LoadAnimFrame(local_104,local_208,0,0);
		}
		else {
			ppiVar1 = draw::Draw_LoadAnimFrame(local_104,local_208,0,0);
			(&globals::g_HealthFontFrames)[uVar2] = ppiVar1;
		}
		uVar2 += 1;
	} while (uVar2 < 0xb);
	return;
}



void __cdecl FUN_0040a3e0(int *param_1,uint param_2)
{
	BOOL BVar1;
	ResourceData **ppRVar2;
	ResourceData *pRVar3;
	Struct_34 *pSVar4;
	int iVar5;
	float10 fVar6;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_18 = 0;
	local_14 = 2;
	local_10 = 1;
	local_c = 0;
	local_8 = 3;
	local_4 = 2;
	BVar1 = FUN_0040aa10((LiveObject *)param_1);
	if ((((BVar1 != 0) && (param_2 != 0)) && (param_2 < 999)) &&
		 (ppRVar2 = (ResourceData **)FUN_0040a4f0(), ppRVar2 != NULL)) {
		ppRVar2[6] = NULL;
		ppRVar2[4] = NULL;
		ppRVar2[3] = NULL;
		fVar6 = lego::game::LiveObject_GetCollHeight((LiveObject *)param_1);
		ppRVar2[5] = (ResourceData *)(float)-fVar6;
		if (*ppRVar2 == NULL) {
			pRVar3 = lego::game::LiveObject_GetResource((LiveObject *)param_1);
			pRVar3 = lego::pool::ReservedPool_ResourceData___Next(pRVar3);
			*ppRVar2 = pRVar3;
			pSVar4 = lego::res::Res_Unk_CreateUserVisualStruct34
												 (pRVar3->frame2,FUN_0040a670,0x3000,ppRVar2,0);
			ppRVar2[1] = (ResourceData *)pSVar4;
			iVar5 = 4;
			do {
				FUN_004824e0((Struct_34 *)ppRVar2[1],4,2,3,(undefined2 *)&local_18);
				iVar5 += -1;
			} while (iVar5 != 0);
		}
		else {
			pRVar3 = lego::game::LiveObject_GetResource((LiveObject *)param_1);
			FUN_004759d0(*ppRVar2,pRVar3);
			lego::res::Res_UnkSetup3DFrameTransform(*ppRVar2,0);
		}
		FUN_0040a510((int)ppRVar2,param_2);
	}
	return;
}



undefined4 * FUN_0040a4f0(void)
{
	undefined4 *puVar1;
	
	puVar1 = &DAT_004b9a84;
	do {
		if ((*(byte *)(puVar1 + 7) & 1) == 0) {
			puVar1[7] = puVar1[7] | 1;
			return puVar1;
		}
		puVar1 = puVar1 + 8;
	} while (puVar1 < &DAT_004b9bc4);
	return NULL;
}



void __cdecl FUN_0040a510(int param_1,uint param_2)
{
	uint uVar1;
	uint uVar2;
	Struct_34 *pSVar3;
	float r;
	float g;
	uint local_4;
	
	uVar1 = 0;
	local_4 = 0;
	uVar2 = 0;
	do {
		if (param_2 < 5) {
			FUN_00483530(*(Struct_34 **)(param_1 + 4),uVar2,0.0,1.0,0.0,0);
			pSVar3 = *(Struct_34 **)(param_1 + 4);
			g = 1.0;
			r = 0.0;
		}
		else {
			if (param_2 < 10) {
				FUN_00483530(*(Struct_34 **)(param_1 + 4),uVar2,1.0,1.0,0.0,0);
				pSVar3 = *(Struct_34 **)(param_1 + 4);
				g = 1.0;
				r = 1.0;
			}
			else {
				FUN_00483530(*(Struct_34 **)(param_1 + 4),uVar2,1.0,0.25,0.0,0);
				pSVar3 = *(Struct_34 **)(param_1 + 4);
				g = 0.25;
				r = 1.0;
			}
		}
		FUN_00483530(pSVar3,uVar2,r,g,0.0,3);
		uVar2 += 1;
	} while (uVar2 < 4);
	uVar2 = 1;
	if (param_2 != 0) {
		do {
			uVar1 += 1;
			uVar2 *= 10;
			local_4 = uVar1;
		} while (uVar2 <= param_2);
	}
	uVar1 = 0;
	if (local_4 != 0) {
		do {
			FUN_00483380(*(Struct_34 **)(param_1 + 4),uVar1,
									 (undefined **)(&lego::globals::g_HealthFontFrames)[param_2 % 10]);
			FUN_00482a60(*(Struct_34 **)(param_1 + 4),uVar1,0);
			param_2 = (param_2 - param_2 % 10) / 10;
			uVar1 += 1;
		} while (uVar1 < local_4);
	}
	FUN_00483380(*(Struct_34 **)(param_1 + 4),uVar1,DAT_004b9a80);
	for (uVar1 = local_4 + 1; uVar1 < 4; uVar1 += 1) {
		FUN_00482a60(*(Struct_34 **)(param_1 + 4),uVar1,1);
	}
	*(uint *)(param_1 + 8) = local_4 + 1;
	return;
}



void __cdecl FUN_0040a670(undefined4 param_1,ResourceData **param_2,int param_3)
{
	float fVar1;
	float fVar2;
	float fVar3;
	ResourceData *resData;
	ResourceData *resData_00;
	ResourceData *pRVar4;
	float local_88;
	Vector3F local_80;
	float local_74;
	float local_70;
	float local_6c;
	Vector3F local_68;
	float local_5c;
	float local_58;
	float local_54;
	float local_50;
	float local_4c;
	float local_48;
	float local_44;
	float local_40;
	float local_3c;
	float local_38;
	float local_34;
	float local_30;
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	Vector3F local_c;
	
	local_2c = 0;
	local_28 = 0;
	local_24 = 0x3f800000;
	local_20 = 0;
	local_1c = 0x3f800000;
	local_18 = 0x3f800000;
	local_14 = 0;
	local_10 = 0x3f800000;
	resData = (ResourceData *)FUN_004294d0();
	pRVar4 = param_2[6];
	lego::res::Res_SetFrameOrientation(*param_2,NULL,0.0,0.0,1.0,0.0,1.0,0.0);
	resData_00 = (ResourceData *)FUN_00477230(param_3);
	lego::res::Res_GetOrientation(resData_00,NULL,&local_68,&local_80);
	lego::res::Res_GetPosition(resData,NULL,&local_c);
	fVar1 = local_80.y * local_68.z;
	fVar2 = local_80.z * local_68.y;
	fVar3 = local_80.z * local_68.x;
	local_68.z = local_80.x * local_68.z;
	local_68.y = local_80.x * local_68.y;
	local_68.x = local_80.y * local_68.x;
	local_6c = (((float)pRVar4 * 0.06666667 + (float)pRVar4 * 0.06666667) - -1.0) * 3.0;
	local_80.x = local_6c * local_80.x;
	local_80.y = local_6c * local_80.y;
	local_88 = 1.0 - (float)ZEXT48(param_2[2]) * 0.5;
	local_80.z = local_6c * local_80.z;
	local_74 = local_6c * (fVar1 - fVar2);
	pRVar4 = NULL;
	local_70 = local_6c * (fVar3 - local_68.z);
	local_6c = local_6c * (local_68.y - local_68.x);
	if (param_2[2] != NULL) {
		do {
			local_5c = (float)param_2[3] - local_88 * local_74;
			local_58 = (float)param_2[4] - local_88 * local_70;
			local_54 = (float)param_2[5] - local_88 * local_6c;
			local_50 = local_74 + local_5c;
			local_4c = local_70 + local_58;
			local_48 = local_6c + local_54;
			local_38 = local_80.x + local_5c;
			local_34 = local_80.y + local_58;
			local_44 = local_80.x + local_50;
			local_30 = local_80.z + local_54;
			local_40 = local_80.y + local_4c;
			local_3c = local_80.z + local_48;
			FUN_004827c0((int)param_2[1],(int)pRVar4,0,4,(int)&local_5c,(float *)&local_c,&local_2c);
			local_88 = local_88 - -1.0;
			pRVar4 = (ResourceData *)((int)&pRVar4->frame1 + 1);
		} while (pRVar4 < param_2[2]);
	}
	return;
}



void __cdecl FUN_0040a940(float param_1)
{
	undefined4 *puVar1;
	
	puVar1 = &DAT_004b9a84;
	do {
		if ((*(byte *)(puVar1 + 7) & 1) != 0) {
			FUN_0040a970(puVar1,param_1);
		}
		puVar1 = puVar1 + 8;
	} while (puVar1 < &DAT_004b9bc4);
	return;
}



void __cdecl FUN_0040a970(undefined4 *param_1,float param_2)
{
	float fVar1;
	uint index;
	
	if ((float)param_1[6] < 15.0) {
		param_1[3] = (float)param_1[3] + 0.0;
		index = 0;
		param_1[4] = (float)param_1[4] + 0.0;
		param_1[5] = param_2 * -1.0 + (float)param_1[5];
		fVar1 = (float)param_1[6];
		if (param_1[2] != 0) {
			do {
				FUN_004836e0((Struct_34 *)param_1[1],index,1.0 - fVar1 * 0.06666667,4);
				index += 1;
			} while (index < (uint)param_1[2]);
		}
		param_1[6] = param_2 + (float)param_1[6];
		return;
	}
	param_1[7] = param_1[7] & 0xfffffffe;
	lego::res::Res_UnkSetup3DFrameTransform((ResourceData *)*param_1,1);
	return;
}



BOOL __cdecl FUN_0040aa10(LiveObject *liveObj)
{
	ObjectStatsFlags2 OVar1;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags2(liveObj);
	if ((((OVar1 & STATS2_DONTSHOWDAMAGE) == STATS2_NONE) && (liveObj->objType != OBJECT_DYNAMITE)) &&
		 (liveObj->objType != OBJECT_SONICBLASTER)) {
		return 1;
	}
	return 0;
}



void __cdecl FUN_0040aa40(int param_1)
{
	lego::globals::g_MiscObjectDependencies_TABLE[299].levels_field_44[0] = (uint)(param_1 == 0);
	return;
}



void __cdecl FUN_0040aa60(void)
{
	uint *puVar1;
	int iVar2;
	uint *puVar3;
	int iVar4;
	
	puVar3 = lego::globals::g_MiscObjectDependencies_TABLE[0].levels_flags;
	do {
		iVar4 = 0xf;
		do {
			iVar2 = 0x10;
			puVar1 = puVar3;
			do {
				iVar2 += -1;
				*puVar1 = *puVar1 & 0xfffffef3;
				puVar1 = puVar1 + 1;
			} while (iVar2 != 0);
			puVar3 = puVar3 + 0x31;
			iVar4 += -1;
		} while (iVar4 != 0);
	} while (puVar3 < &DAT_004c81fc);
	return;
}



void __cdecl lego::main::Main_Load_Dependencies(CFGProperty *root,char *keyBasePath)
{
	char *keyPath;
	CFGProperty *prop;
	int iVar1;
	BOOL BVar2;
	int iVar3;
	uint *puVar4;
	int iVar5;
	void *pvVar6;
	char **ppcVar7;
	uint length;
	int local_50;
	int local_4c;
	ObjectType local_48;
	int local_44;
	char *local_40;
	char *local_3c;
	char *local_38;
	char *local_34;
	char *local_30;
	char *local_28 [10];
	
	keyPath = cfg::CFG_JoinPath(keyBasePath,"Dependencies",0);
	for (prop = cfg::CFG_GetBlockFirstChild(root,keyPath); prop != NULL;
			prop = cfg::CFG_NextFlatProperty(prop)) {
		iVar1 = util::stringSplit(prop->key,&local_40,":");
		BVar2 = game::Game_GetObjectByName(local_3c,(ObjectType *)&keyBasePath,&local_50,NULL);
		if (BVar2 != 0) {
			iVar3 = std::_stricmp(local_40,"HitOnceStay");
			if (iVar1 == 3) {
				iVar1 = std::atoi(local_38);
				game::Object_GetLevels((ObjectType)keyBasePath,local_50);
				if (iVar3 == 0) {
					iVar3 = local_50 + (int)keyBasePath * 0xf;
					globals::g_MiscObjectDependencies_TABLE[iVar3].levels_flags[iVar1] =
							 globals::g_MiscObjectDependencies_TABLE[iVar3].levels_flags[iVar1] | 1;
				}
				globals::g_MiscObjectDependencies_TABLE[local_50 + (int)keyBasePath * 0xf].field_0 = 1;
			}
			else {
				iVar1 = 0;
				if (iVar3 == 0) {
					iVar3 = 0x10;
					puVar4 = globals::g_MiscObjectDependencies_TABLE[local_50 + (int)keyBasePath * 0xf].
									 levels_flags;
					do {
						iVar3 += -1;
						*puVar4 = *puVar4 | 1;
						puVar4 = puVar4 + 1;
					} while (iVar3 != 0);
				}
				globals::g_MiscObjectDependencies_TABLE[local_50 + (int)keyBasePath * 0xf].field_0 = 0;
			}
			iVar3 = util::stringSplit(prop->value,local_28,",");
			length = iVar3 << 4;
			iVar5 = (iVar1 + (local_50 + (int)keyBasePath * 0xf) * 0x31) * 4;
			pvVar6 = std::malloc(length);
			*(void **)(&DAT_004b9c08 + iVar5) = pvVar6;
			*(int *)(&DAT_004b9bc8 + iVar5) = iVar3;
			if (iVar3 != 0) {
				ppcVar7 = local_28;
				local_44 = iVar3;
				do {
					iVar3 = util::stringSplit(*ppcVar7,&local_34,":");
					BVar2 = game::Game_GetObjectByName(local_34,&local_48,&local_4c,NULL);
					if (BVar2 != 0) {
						*(ObjectType *)
						 (*(int *)(&DAT_004b9c08 + (iVar1 + (local_50 + (int)keyBasePath * 0xf) * 0x31) * 4) +
							-0x10 + length) = local_48;
						*(int *)(*(int *)(&DAT_004b9c08 +
														 (iVar1 + (local_50 + (int)keyBasePath * 0xf) * 0x31) * 4) + -0xc +
										length) = local_4c;
						if (iVar3 == 2) {
							iVar3 = std::atoi(local_30);
							game::Object_GetLevels(local_48,local_4c);
							*(int *)(*(int *)(&DAT_004b9c08 +
															 (iVar1 + (local_50 + (int)keyBasePath * 0xf) * 0x31) * 4) + -8 +
											length) = iVar3;
							*(undefined4 *)
							 (*(int *)(&DAT_004b9c08 + (iVar1 + (local_50 + (int)keyBasePath * 0xf) * 0x31) * 4) +
								-4 + length) = 1;
						}
						else {
							*(undefined4 *)
							 (*(int *)(&DAT_004b9c08 + (iVar1 + (local_50 + (int)keyBasePath * 0xf) * 0x31) * 4) +
								-4 + length) = 0;
						}
					}
					ppcVar7 = ppcVar7 + 1;
					length -= 0x10;
					local_44 += -1;
				} while (local_44 != 0);
			}
		}
	}
	Main_Init_MiscObjectDependencies();
	return;
}



BOOL __cdecl FUN_0040add0(ObjectType objType,int objIndex,int objLevel)
{
	uint *puVar1;
	uint uVar2;
	BOOL BVar3;
	int iVar4;
	ObjectType OVar5;
	
	if (lego::globals::g_MiscObjectDependencies_TABLE[299].levels_field_44[0] == 0) {
		iVar4 = objIndex + objType * 0xf;
		puVar1 = lego::globals::g_MiscObjectDependencies_TABLE[iVar4].levels_flags + objLevel;
		if ((*(byte *)(lego::globals::g_MiscObjectDependencies_TABLE[iVar4].levels_flags + objLevel) & 2
				) == 0) {
			FUN_0040aec0(objType,objIndex,objLevel,&objIndex,&objType);
			OVar5 = OBJECT_NONE;
			if (objType != OBJECT_NONE) {
				iVar4 = 0;
				do {
					BVar3 = FUN_00437a70(FUN_0040ae70,(LiveObject *)(objIndex + iVar4));
					if (BVar3 == 0) {
						return 0;
					}
					OVar5 += OBJECT_VEHICLE;
					iVar4 += 0x10;
				} while (OVar5 < objType);
			}
			uVar2 = *puVar1;
			if ((uVar2 & 1) != 0) {
				*puVar1 = uVar2 | 2;
			}
		}
	}
	return 1;
}



undefined4 __cdecl FUN_0040ae70(int *param_1,int *param_2)
{
	BOOL BVar1;
	
	BVar1 = FUN_004394c0(*param_2);
	if (BVar1 == 0) {
		if (*param_2 != *param_1) {
			return 0;
		}
		if (param_2[1] != param_1[1]) {
			return 0;
		}
		if ((param_2[3] != 0) && ((uint)param_1[0xcc] < (uint)param_2[2])) {
			return 0;
		}
	}
	return 1;
}



void __cdecl
FUN_0040aec0(int param_1,int param_2,int param_3,undefined4 *param_4,undefined4 *param_5)
{
	int iVar1;
	
	iVar1 = param_2 + param_1 * 0xf;
	if (lego::globals::g_MiscObjectDependencies_TABLE[iVar1].field_0 != 0) {
		iVar1 = (param_3 + iVar1 * 0x31) * 4;
		*param_4 = *(undefined4 *)(&DAT_004b9c08 + iVar1);
		*param_5 = *(undefined4 *)(&DAT_004b9bc8 + iVar1);
		return;
	}
	*param_4 = *(undefined4 *)(&DAT_004b9c08 + iVar1 * 0xc4);
	*param_5 = *(undefined4 *)(&DAT_004b9bc8 + iVar1 * 0xc4);
	return;
}



void __cdecl FUN_0040af30(ObjectType objType,int objIndex,int objLevel,int param_4)
{
	int iVar1;
	int iVar2;
	uint uVar3;
	int iVar4;
	uint uVar5;
	uint local_c;
	MiscObjectDependencies *local_8;
	uint local_4;
	
	iVar1 = param_4;
	local_8 = lego::globals::g_MiscObjectDependencies_TABLE;
	iVar4 = 0;
	*(undefined4 *)(param_4 + 0x200) = 0;
	do {
		uVar3 = 0;
		do {
			if (local_8->field_0 == 0) {
				FUN_0040aec0(iVar4,uVar3,0,&param_4,&local_c);
				uVar5 = 0;
				if (local_c != 0) {
					iVar2 = 0;
					do {
						if (((*(ObjectType *)(param_4 + iVar2) == objType) &&
								(*(int *)(param_4 + 4 + iVar2) == objIndex)) &&
							 ((*(int *)(param_4 + 0xc + iVar2) == 0 || (*(int *)(param_4 + 8 + iVar2) == objLevel)
								))) {
							*(int *)(iVar1 + *(int *)(iVar1 + 0x200) * 4) = iVar4;
							*(uint *)(iVar1 + 0x80 + *(int *)(iVar1 + 0x200) * 4) = uVar3;
							*(undefined4 *)(iVar1 + 0x180 + *(int *)(iVar1 + 0x200) * 4) = 0;
							*(int *)(iVar1 + 0x200) = *(int *)(iVar1 + 0x200) + 1;
						}
						uVar5 += 1;
						iVar2 += 0x10;
					} while (uVar5 < local_c);
				}
			}
			else {
				uVar5 = 0;
				do {
					FUN_0040aec0(iVar4,uVar3,uVar5,&param_4,&local_c);
					iVar2 = 0;
					local_4 = 0;
					if (local_c != 0) {
						do {
							if (((*(ObjectType *)(param_4 + iVar2) == objType) &&
									(*(int *)(param_4 + 4 + iVar2) == objIndex)) &&
								 ((*(int *)(param_4 + 0xc + iVar2) == 0 ||
									(*(int *)(param_4 + 8 + iVar2) == objLevel)))) {
								*(int *)(iVar1 + *(int *)(iVar1 + 0x200) * 4) = iVar4;
								*(uint *)(iVar1 + 0x80 + *(int *)(iVar1 + 0x200) * 4) = uVar3;
								*(uint *)(iVar1 + 0x100 + *(int *)(iVar1 + 0x200) * 4) = uVar5;
								*(undefined4 *)(iVar1 + 0x180 + *(int *)(iVar1 + 0x200) * 4) = 1;
								*(int *)(iVar1 + 0x200) = *(int *)(iVar1 + 0x200) + 1;
							}
							iVar2 += 0x10;
							local_4 += 1;
						} while (local_4 < local_c);
					}
					uVar5 += 1;
				} while (uVar5 < 0x10);
			}
			uVar3 += 1;
			local_8 = local_8 + 1;
		} while (uVar3 < 0xf);
		iVar4 += 1;
	} while (local_8 < (MiscObjectDependencies *)&DAT_004c81f8);
	return;
}



void __cdecl lego::main::Main_Init_MiscObjectDependencies(void)
{
	BOOL BVar1;
	uint uVar2;
	uint objIndex;
	uint objNumber;
	uint objLevel;
	ObjectType local_4;
	
	objNumber = 0;
	local_4 = OBJECT_NONE;
	do {
		objIndex = 0;
		do {
			objLevel = 0;
			do {
				if ((objLevel == 1) &&
					 (globals::g_MiscObjectDependencies_TABLE[objIndex + objNumber].field_0 != 0)) break;
				if ((*(byte *)(globals::g_MiscObjectDependencies_TABLE[objIndex + objNumber].levels_flags +
											objLevel) & 8) == 0) {
					BVar1 = FUN_0040add0(local_4,objIndex,objLevel);
					uVar2 = globals::g_MiscObjectDependencies_TABLE[objIndex + objNumber].levels_flags
									[objLevel];
					if (BVar1 == 0) {
						if ((uVar2 & 4) != 0) goto LAB_0040b14c;
					}
					else {
						if ((uVar2 & 4) == 0) {
							uVar2 |= 4;
						}
						else {
LAB_0040b14c:
							uVar2 = uVar2 & 0xfffffffb | 8;
						}
						globals::g_MiscObjectDependencies_TABLE[objIndex + objNumber].levels_flags[objLevel] =
								 uVar2;
					}
				}
				objLevel += 1;
			} while (objLevel < 0x10);
			objIndex += 1;
		} while (objIndex < 0xf);
		objNumber += 0xf;
		local_4 += OBJECT_VEHICLE;
		if (299 < objNumber) {
			return;
		}
	} while( true );
}



uint __cdecl FUN_0040b180(int param_1,int param_2,int param_3)
{
	int iVar1;
	
	iVar1 = param_2 + param_1 * 0xf;
	if (lego::globals::g_MiscObjectDependencies_TABLE[iVar1].field_0 != 0) {
		return lego::globals::g_MiscObjectDependencies_TABLE[iVar1].levels_flags[param_3] & 4;
	}
	return lego::globals::g_MiscObjectDependencies_TABLE[iVar1].levels_flags[0] & 4;
}



void __cdecl
lego::game::Object_SetDependencyLevelFlag_100(ObjectType objType,int objIndex,int objLevel)
{
	int iVar1;
	
	iVar1 = objIndex + objType * 0xf;
	globals::g_MiscObjectDependencies_TABLE[iVar1].levels_flags[objLevel] =
			 globals::g_MiscObjectDependencies_TABLE[iVar1].levels_flags[objLevel] | 0x100;
	return;
}



uint __cdecl
lego::game::Object_GetDependencyLevelFlag_100(ObjectType objType,int objIndex,int objLevel)
{
	return globals::g_MiscObjectDependencies_TABLE[objIndex + objType * 0xf].levels_flags[objLevel] &
				 0x100;
}



SurfaceTextureGrid * __cdecl
lego::game::Level_LoadTextureBaseName(char *textureBaseName,uint width,uint height)
{
	SurfaceTextureGrid *buffer;
	DirectXSurfaceTuple **ppDVar1;
	DirectXSurfaceTuple *pDVar2;
	uint uVar3;
	uint uVar4;
	int iVar5;
	int local_404;
	char local_400 [1024];
	
	buffer = (SurfaceTextureGrid *)std::malloc(0xc);
	uVar3 = 0;
	if (buffer != NULL) {
		ppDVar1 = (DirectXSurfaceTuple **)std::malloc(height * width * 4);
		buffer->gridSurfaces = ppDVar1;
		if (ppDVar1 == NULL) {
			std::free(buffer);
			buffer = NULL;
		}
		else {
			(buffer->gridSize).width = width;
			(buffer->gridSize).height = height;
			if (height != 0) {
				local_404 = 0;
				do {
					uVar4 = 0;
					iVar5 = local_404;
					if (width != 0) {
						do {
							std::sprintf(local_400,"%s%0.1x%0.1x.bmp",textureBaseName,uVar4,uVar3);
							pDVar2 = draw::Draw_UnkMakeDirectXSurfaceTuple(local_400,1,NULL,NULL);
							uVar4 += 1;
							*(DirectXSurfaceTuple **)((int)buffer->gridSurfaces + iVar5) = pDVar2;
							iVar5 = iVar5 + 4;
						} while (uVar4 < width);
					}
					uVar3 += 1;
					local_404 += width * 4;
				} while (uVar3 < height);
				return buffer;
			}
		}
	}
	return buffer;
}



void __cdecl FUN_0040b340(uint *param_1)
{
	uint uVar1;
	uint uVar2;
	uint uVar3;
	
	uVar2 = 0;
	if (param_1[1] != 0) {
		do {
			uVar1 = *param_1;
			uVar3 = 0;
			if (uVar1 != 0) {
				do {
					FUN_004749d0(*(int ***)(param_1[2] + (uVar2 * uVar1 + uVar3) * 4));
					uVar1 = *param_1;
					uVar3 += 1;
				} while (uVar3 < uVar1);
			}
			uVar2 += 1;
		} while (uVar2 < param_1[1]);
	}
	std::free((void *)param_1[2]);
	std::free(param_1);
	return;
}



float10 __cdecl FUN_0040b3a0(int param_1,int param_2,float *param_3,int param_4)
{
	float *pfVar1;
	float *pfVar2;
	int iVar3;
	float10 fVar4;
	float10 fVar5;
	float local_78;
	float local_70;
	float local_6c [2];
	float local_64 [3];
	float local_58 [3];
	float local_4c [3];
	float local_40 [16];
	
	local_78 = 1.0;
	iVar3 = 4;
	pfVar2 = local_40;
	pfVar1 = &local_70;
	do {
		FUN_00477570(param_2,pfVar2,(param_1 - (int)&local_70) + (int)pfVar1);
		iVar3 += -1;
		*pfVar1 = *pfVar2 / pfVar2[3];
		pfVar1[1] = pfVar2[1] / pfVar2[3];
		pfVar2 = pfVar2 + 4;
		pfVar1 = pfVar1 + 3;
	} while (iVar3 != 0);
	if (param_4 == 0) {
		pfVar2 = local_40 + 2;
		pfVar1 = local_6c;
		iVar3 = 4;
		do {
			if (0.0 <= pfVar1[-1]) {
				if (0.0 <= *pfVar1) {
					if ((ushort)((ushort)(pfVar1[-1] < *param_3) << 8 |
											(ushort)(pfVar1[-1] == *param_3) << 0xe) == 0) {
						local_78 = local_78 - 0.25;
					}
					else {
						if ((ushort)((ushort)(*pfVar1 < param_3[1]) << 8 |
												(ushort)(*pfVar1 == param_3[1]) << 0xe) == 0) {
							local_78 = local_78 - 0.25;
						}
						else {
							if (((ushort)((ushort)(*pfVar2 < pfVar2[1]) << 8 |
													 (ushort)(*pfVar2 == pfVar2[1]) << 0xe) == 0) || (*pfVar2 < 0.0)) {
								local_78 = local_78 - 0.25;
							}
						}
					}
				}
				else {
					local_78 = local_78 - 0.25;
				}
			}
			else {
				local_78 = local_78 - 0.25;
			}
			pfVar1 = pfVar1 + 3;
			pfVar2 = pfVar2 + 4;
			iVar3 += -1;
		} while (iVar3 != 0);
	}
	if ((ushort)((ushort)(local_78 < 0.0) << 8 | (ushort)(local_78 == 0.0) << 0xe) != 0) {
		return (float10)0.0;
	}
	fVar4 = FUN_004798f0(local_58,local_64,&local_70,0);
	fVar5 = FUN_004798f0(&local_70,local_4c,local_58,0);
	return (fVar5 + (float10)(float)fVar4) * (float10)local_78;
}



ProMeshData * __cdecl
FUN_0040b520(ResourceData *resData,char *meshName_a,char *meshName_b,float blockSize,
						SurfaceTextureGrid *surfTextGrid)
{
	ProMeshData *buffer;
	ResourceData *pRVar1;
	void *buffer_00;
	float *pfVar2;
	int iVar3;
	float fVar4;
	undefined4 *puVar5;
	ProMeshData *pPVar6;
	uint uVar7;
	undefined4 *puVar8;
	
	if (meshName_b == NULL) {
		meshName_b = meshName_a;
	}
	buffer = (ProMeshData *)std::malloc(0x340);
	if (buffer != NULL) {
		pRVar1 = lego::res::Res_LoadResource(resData,meshName_a,"LWO:NOTEXTURE",1);
		buffer->promesh_a = pRVar1;
		if (pRVar1 != NULL) {
			pRVar1 = lego::res::Res_LoadResource(resData,meshName_b,"LWO:NOTEXTURE",1);
			buffer->promesh_b = pRVar1;
			if (pRVar1 == NULL) {
				pRVar1 = lego::res::Res_LoadResource(resData,meshName_a,"LWO:NOTEXTURE",1);
				buffer->promesh_b = pRVar1;
			}
			fVar4 = blockSize * 0.01;
			buffer->field_32c = 0;
			buffer->BlockSize = blockSize;
			buffer->surfTextGrid = surfTextGrid;
			puVar5 = buffer->table_a;
			blockSize = 2.802597e-45;
			pPVar6 = buffer;
			do {
				FUN_00475150(pPVar6->promesh_a,fVar4,fVar4,fVar4);
				FUN_004750f0(pPVar6->promesh_a,0,1);
				lego::res::Res_UnkSetup3DFrameTransform(pPVar6->promesh_a,1);
				puVar8 = puVar5;
				for (iVar3 = 100; iVar3 != 0; iVar3 += -1) {
					*puVar8 = 0;
					puVar8 = puVar8 + 1;
				}
				pPVar6 = (ProMeshData *)&pPVar6->promesh_b;
				puVar5 = puVar5 + 100;
				blockSize = (float)((int)blockSize + -1);
			} while (blockSize != 0.0);
			uVar7 = 0;
			do {
				FUN_00474f00((ResourceData *)buffer->table_a[uVar7 - 2],0,(uint *)&blockSize,0,NULL,NULL,
										 NULL);
				buffer_00 = std::malloc((int)blockSize * 0x24);
				FUN_00474f80((ResourceData *)buffer->table_a[uVar7 - 2],0,0,(int)blockSize,(int)buffer_00);
				fVar4 = 0.0;
				if (blockSize != 0.0) {
					pfVar2 = (float *)((int)buffer_00 + 0x1c);
					do {
						if (uVar7 != 0) {
							pfVar2[-1] = 1.0 - pfVar2[-1];
							*pfVar2 = 1.0 - *pfVar2;
						}
						fVar4 = (float)((int)fVar4 + 1);
						pfVar2 = pfVar2 + 9;
					} while ((uint)fVar4 < (uint)blockSize);
				}
				FUN_00474ff0((int *)buffer->table_a[uVar7 - 2],0,0,(int)blockSize,(int)buffer_00);
				std::free(buffer_00);
				uVar7 += 1;
			} while (uVar7 < 2);
			return buffer;
		}
		std::free(buffer);
	}
	return NULL;
}



void __thiscall FUN_0040b700(void *this,int **param_1)
{
	ResourceData **ppRVar1;
	int iVar2;
	
	if (param_1 != NULL) {
		FUN_0040b740(this,(int)param_1);
		iVar2 = 2;
		ppRVar1 = (ResourceData **)param_1;
		do {
			lego::pool::ReservedPool_ResourceData___Release(*ppRVar1);
			ppRVar1 = ppRVar1 + 1;
			iVar2 += -1;
		} while (iVar2 != 0);
		std::free(param_1);
	}
	return;
}



void __thiscall FUN_0040b740(void *this,int param_1)
{
	int iVar1;
	ResourceData **ppRVar2;
	int iVar3;
	
	*(undefined4 *)(param_1 + 0x32c) = 0;
	ppRVar2 = (ResourceData **)(param_1 + 8);
	iVar1 = 2;
	do {
		iVar3 = 100;
		do {
			if (*ppRVar2 != NULL) {
				lego::pool::ReservedPool_ResourceData___Release(*ppRVar2);
				*ppRVar2 = NULL;
			}
			ppRVar2 = ppRVar2 + 1;
			iVar3 += -1;
		} while (iVar3 != 0);
		iVar1 += -1;
	} while (iVar1 != 0);
	return;
}



undefined4 __cdecl FUN_0040b780(int *param_1,uint param_2)
{
	if (param_1 != NULL) {
		return *(undefined4 *)(param_1[2] + ((param_2 & 0xf) * *param_1 + ((param_2 & 0xff) >> 4)) * 4);
	}
	return 0;
}



void __cdecl
FUN_0040b7b0(int param_1,int param_2,uint param_3,uint param_4,undefined4 param_5,undefined4 param_6
						)
{
	float fVar1;
	undefined **ppuVar2;
	ResourceData *pRVar3;
	ResourceData **ppRVar4;
	uint uVar5;
	uint uVar6;
	ResourceData *local_38 [2];
	int local_30 [4];
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	if (param_1 != 0) {
		fVar1 = *(float *)(param_1 + 0x328);
		local_30[2] = 2;
		local_14 = 2;
		local_c = 2;
		local_30[0] = 3;
		local_1c = 3;
		local_8 = 3;
		local_30[1] = 0;
		local_30[3] = 0;
		local_20 = 1;
		local_18 = 1;
		local_10 = 0;
		local_4 = 1;
		ppuVar2 = (undefined **)FUN_0040b780(*(int **)(param_1 + 0x33c),param_3);
		ppRVar4 = local_38;
		uVar5 = 0;
		do {
			pRVar3 = lego::res::Res_DuplicateResource
												 (*(ResourceData **)((param_1 - (int)local_38) + (int)ppRVar4));
			*(ResourceData **)(param_1 + 8 + (uVar5 + *(int *)(param_1 + 0x32c)) * 4) = pRVar3;
			uVar6 = uVar5 + 100;
			*ppRVar4 = *(ResourceData **)(param_1 + 8 + (uVar5 + *(int *)(param_1 + 0x32c)) * 4);
			ppRVar4 = ppRVar4 + 1;
			uVar5 = uVar6;
		} while (uVar6 < 200);
		uVar5 = param_4 & 0xff;
		FUN_0040b930(local_38[0],fVar1,(float *)(param_2 + local_30[uVar5 * 3] * 0xc),
								 (float *)(param_2 + local_30[uVar5 * 3 + 1] * 0xc),
								 (float *)(param_2 + local_30[uVar5 * 3 + 2] * 0xc),param_5,param_6,ppuVar2,0);
		uVar5 = uVar5 + 2 & 3;
		FUN_0040b930(local_38[1],fVar1,(float *)(param_2 + local_30[uVar5 * 3] * 0xc),
								 (float *)(param_2 + local_30[uVar5 * 3 + 1] * 0xc),
								 (float *)(param_2 + local_30[uVar5 * 3 + 2] * 0xc),param_5,param_6,ppuVar2,0);
		*(int *)(param_1 + 0x32c) = *(int *)(param_1 + 0x32c) + 1;
	}
	return;
}



void __cdecl
FUN_0040b930(ResourceData *resData,float param_2,float *param_3,float *param_4,float *param_5,
						float param_6,float param_7,undefined **param_8,byte param_9)
{
	int iVar1;
	uint uVar2;
	uint uVar3;
	
	FUN_0040bac0(resData,param_2,param_3,param_4,param_5);
	lego::res::Res_UnkSetup3DFrameTransform(resData,0);
	uVar3 = 0;
	iVar1 = lego::res::Res_GetMeshGroupCount(resData);
	if (iVar1 != 0) {
		do {
			FUN_00475060(resData,uVar3,param_8);
			uVar3 += 1;
			uVar2 = lego::res::Res_GetMeshGroupCount(resData);
		} while (uVar3 < uVar2);
	}
	lego::res::Res_AddTranslation(resData,D3DRMCOMBINE_BEFORE,-0.02,-0.02,0.0);
	lego::res::Res_AddScale(resData,D3DRMCOMBINE_BEFORE,1.015,1.015,param_6);
	lego::res::Res_SetLightColor(resData,param_7,param_7,param_7,1.0);
	if ((param_9 & 1) != 0) {
		lego::res::Res_AddRotation(resData,D3DRMCOMBINE_BEFORE,1.0,0.0,0.0,1.570796);
	}
	if ((param_9 & 2) != 0) {
		lego::res::Res_AddRotation(resData,D3DRMCOMBINE_BEFORE,1.0,0.0,0.0,-1.570796);
	}
	if ((param_9 & 4) != 0) {
		lego::res::Res_AddRotation(resData,D3DRMCOMBINE_BEFORE,0.0,1.0,0.0,1.570796);
	}
	if ((param_9 & 8) != 0) {
		lego::res::Res_AddRotation(resData,D3DRMCOMBINE_BEFORE,0.0,1.0,0.0,-1.570796);
	}
	if ((param_9 & 0x10) != 0) {
		lego::res::Res_AddRotation(resData,D3DRMCOMBINE_BEFORE,0.0,0.0,1.0,1.570796);
	}
	if ((param_9 & 0x20) != 0) {
		lego::res::Res_AddRotation(resData,D3DRMCOMBINE_BEFORE,0.0,0.0,1.0,-1.570796);
	}
	if ((param_9 & 0x80) != 0) {
		lego::res::Res_AddTranslation(resData,D3DRMCOMBINE_AFTER,0.0,-10.0,0.0);
	}
	if ((param_9 & 0x40) != 0) {
		lego::res::Res_AddTranslation(resData,D3DRMCOMBINE_AFTER,0.0,10.0,0.0);
	}
	return;
}



void __cdecl
FUN_0040bac0(ResourceData *resData,float param_2,float *param_3,float *param_4,float *param_5)
{
	float fVar1;
	float fVar2;
	float fVar3;
	undefined local_58 [4];
	float local_54;
	float local_50;
	float local_4c;
	float local_48;
	float local_44;
	Matrix4F local_40;
	
	fVar1 = *param_4 - *param_3;
	local_54 = param_4[1] - param_3[1];
	local_50 = param_4[2] - param_3[2];
	local_4c = (param_5[2] - param_4[2]) * local_54 - (param_5[1] - param_4[1]) * local_50;
	local_48 = (*param_5 - *param_4) * local_50 - (param_5[2] - param_4[2]) * fVar1;
	local_44 = (param_5[1] - param_4[1]) * fVar1 - (*param_5 - *param_4) * local_54;
	fVar3 = 1.0 / SQRT(local_50 * local_50 + local_54 * local_54 + fVar1 * fVar1);
	fVar2 = 1.0 / SQRT(local_44 * local_44 + local_48 * local_48 + local_4c * local_4c);
	lego::res::Res_SetFrameOrientation
						(resData,NULL,-(fVar2 * local_4c),-(fVar2 * local_48),-(fVar2 * local_44),fVar3 * fVar1,
						 fVar3 * local_54,fVar3 * local_50);
	lego::res::Res_SetFramePosition(resData,NULL,*param_3,param_3[1],param_3[2]);
	FUN_00475350((int **)resData,local_58,param_4);
	FUN_00475350((int **)resData,&local_4c,param_5);
	FUN_0040bc90((float *)&local_40,param_2,param_2,local_54,local_4c,local_48);
	lego::res::Res_AddTransform(resData,D3DRMCOMBINE_BEFORE,&local_40);
	return;
}



void __cdecl
FUN_0040bc90(float *param_1,float param_2,float param_3,float param_4,float param_5,float param_6)
{
	param_1[3] = 0.0;
	param_1[2] = 0.0;
	param_1[7] = 0.0;
	param_1[6] = 0.0;
	param_1[4] = 0.0;
	param_1[0xb] = 0.0;
	param_1[9] = 0.0;
	param_1[8] = 0.0;
	param_1[0xe] = 0.0;
	param_1[0xd] = 0.0;
	param_1[0xc] = 0.0;
	param_1[0xf] = 1.0;
	param_1[10] = 1.0;
	*param_1 = param_5 / param_2;
	param_1[5] = param_4 / param_3;
	param_1[1] = (param_6 / param_5) * (param_5 / param_2);
	return;
}



void __cdecl FUN_0040bcf0(void)
{
	undefined4 local_4;
	
	FUN_0040c2d0(10000.0,&local_4,&local_4);
	return;
}



void __cdecl FUN_0040bd10(LiveObject *liveObj)
{
	Vector3F local_c;
	
	lego::res::Res_GetPosition(liveObj->other,NULL,&local_c);
	FUN_0040bd40(&local_c);
	return;
}



void __cdecl FUN_0040bd40(Vector3F *position)
{
	ResourceData **ppRVar1;
	LevelData *pLVar2;
	ResourceData *pRVar3;
	int iVar4;
	
	iVar4 = 0;
	ppRVar1 = PTR_ARRAY_004c8bd8;
	do {
		if (*ppRVar1 == NULL) {
			pLVar2 = lego::game::GetLevel();
			pRVar3 = lego::globals::g_Game.RES_BoulderExplode;
			if (pLVar2->BoulderAnimation == TEXTURES_ICE) {
				pRVar3 = lego::globals::g_Game.RES_BoulderExplodeIce;
			}
			pRVar3 = lego::res::Res_DuplicateResource(pRVar3);
			PTR_ARRAY_004c8bd8[iVar4] = pRVar3;
			lego::res::Res_DoCallbacks(pRVar3,0.0);
			lego::res::Res_SetFramePosition
								(PTR_ARRAY_004c8bd8[iVar4],NULL,position->x,position->y,position->z);
			lego::res::Res_SetFrameOrientation(PTR_ARRAY_004c8bd8[iVar4],NULL,0.0,1.0,0.0,0.0,0.0,-1.0);
			return;
		}
		ppRVar1 = ppRVar1 + 1;
		iVar4 += 1;
	} while (ppRVar1 < &DAT_004c8be8);
	return;
}



void __cdecl FUN_0040bde0(LiveObject *liveObj,Vector3F *param_2)
{
	ResourceData *pRVar1;
	ResourceData **ppRVar2;
	Vector3F local_c;
	
	if (liveObj == NULL) {
		local_c.x = param_2->x;
		local_c.y = param_2->y;
		local_c.z = param_2->z;
	}
	else {
		pRVar1 = lego::game::LiveObject_GetResource(liveObj);
		lego::res::Res_GetPosition(pRVar1,NULL,&local_c);
	}
	ppRVar2 = (ResourceData **)&DAT_004c8be8;
	do {
		if (*ppRVar2 == NULL) {
			pRVar1 = lego::res::Res_DuplicateResource(lego::globals::g_Game.RES_SmashPath);
			*ppRVar2 = pRVar1;
			lego::res::Res_DoCallbacks(pRVar1,0.0);
			lego::res::Res_SetFramePosition(*ppRVar2,NULL,local_c.x,local_c.y,local_c.z);
			lego::res::Res_SetFrameOrientation(*ppRVar2,NULL,0.0,1.0,0.0,0.0,0.0,-1.0);
		}
		ppRVar2 = ppRVar2 + 1;
	} while (ppRVar2 < &DAT_004c8bf8);
	return;
}



BOOL __cdecl lego::game::Game_GetRockFallStyle(char *param_1,uint *out_index)
{
	int iVar1;
	uint uVar2;
	char **ppcVar3;
	
	uVar2 = 0;
	if (globals::g_RockFallStyles_COUNT == 0) {
		return 0;
	}
	ppcVar3 = globals::g_RockFallStyles_TABLE;
	do {
		iVar1 = std::_stricmp(*ppcVar3,param_1);
		if (iVar1 == 0) {
			*out_index = uVar2;
			return 1;
		}
		uVar2 += 1;
		ppcVar3 = ppcVar3 + 1;
	} while (uVar2 < globals::g_RockFallStyles_COUNT);
	return 0;
}



void __cdecl lego::game::Game_SetRockFallStyleIndex(int rockFallStyleIndex)
{
	globals::g_RockFallStyleIndex = rockFallStyleIndex;
	return;
}



void __cdecl
lego::main::Boot_Load_RockFallStyles(CFGProperty *root,char *keyBasePath,ResourceData *resData)
{
	char cVar1;
	char *pcVar2;
	CFGProperty *prop;
	uint uVar3;
	uint uVar4;
	uint uVar5;
	undefined4 *puVar6;
	char *pcVar7;
	undefined4 *puVar8;
	char *local_428 [10];
	char local_400 [1024];
	
	pcVar2 = cfg::CFG_JoinPath(keyBasePath,"RockFallStyles",0);
	prop = cfg::CFG_GetBlockFirstChild(root,pcVar2);
	do {
		if (prop == NULL) {
			return;
		}
		pcVar2 = std::_strdup(prop->key);
		globals::g_RockFallStyles_TABLE[globals::g_RockFallStyles_COUNT] = pcVar2;
		uVar4 = 0xffffffff;
		pcVar2 = prop->value;
		do {
			pcVar7 = pcVar2;
			if (uVar4 == 0) break;
			uVar4 -= 1;
			pcVar7 = pcVar2 + 1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar7;
		} while (cVar1 != '\0');
		uVar4 = ~uVar4;
		puVar6 = (undefined4 *)(pcVar7 + -uVar4);
		puVar8 = (undefined4 *)local_400;
		for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
			*puVar8 = *puVar6;
			puVar6 = puVar6 + 1;
			puVar8 = puVar8 + 1;
		}
		for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
			*(undefined *)puVar8 = *(undefined *)puVar6;
			puVar6 = (undefined4 *)((int)puVar6 + 1);
			puVar8 = (undefined4 *)((int)puVar8 + 1);
		}
		uVar4 = util::stringSplit(local_400,local_428,",");
		uVar5 = 1;
		if (1 < uVar4) {
			uVar3 = 1;
			do {
				FUN_0040c000(resData,local_428[uVar3],globals::g_RockFallStyles_COUNT,uVar3 - 1,local_428[0]
										);
				uVar5 += 1;
				uVar3 = uVar5 & 0xffff;
			} while (uVar3 < uVar4);
		}
		globals::g_RockFallStyles_COUNT += 1;
		prop = cfg::CFG_NextFlatProperty(prop);
	} while( true );
}



BOOL __cdecl FUN_0040c000(ResourceData *resData,char *param_2,int param_3,int param_4,char *param_5)
{
	int iVar1;
	ResourceData **ppRVar2;
	char *pcVar3;
	ResourceData *pRVar4;
	char *pcVar5;
	int iVar6;
	ResourceData **ppRVar7;
	
	iVar1 = (param_4 + param_3 * 3) * 0xa4;
	ppRVar2 = (ResourceData **)((int)lego::globals::g_MiscObjectDependencies_TABLE + iVar1 + 0xe598);
	pRVar4 = lego::res::Res_LoadResource(resData,param_2,"LWS",1);
	*ppRVar2 = pRVar4;
	if (pRVar4 == NULL) {
		pRVar4 = lego::res::Res_LoadResource(resData,param_2,"ANIM",1);
		*ppRVar2 = pRVar4;
	}
	if (*ppRVar2 != NULL) {
		lego::res::Res_UnkSetup3DFrameTransform(*ppRVar2,1);
		ppRVar7 = (ResourceData **)((int)lego::globals::g_MiscObjectDependencies_TABLE + iVar1 + 0xe59c)
		;
		iVar6 = 4;
		do {
			pRVar4 = lego::res::Res_DuplicateResource(*ppRVar2);
			*ppRVar7 = pRVar4;
			ppRVar7[0xc] = (ResourceData *)0x1;
			ppRVar7[0x24] = NULL;
			lego::res::Res_UnkSetup3DFrameTransform(*ppRVar7,1);
			pcVar3 = param_5;
			ppRVar7 = ppRVar7 + 1;
			iVar6 += -1;
		} while (iVar6 != 0);
		pcVar5 = lego::res::Res_GetNull(*ppRVar2,param_5,NULL);
		FUN_00473e80(*ppRVar2,pcVar5,1,&param_3);
		*(int *)(&DAT_004c8228 + iVar1) = param_3;
		*(char **)(&DAT_004c8224 + iVar1) = pcVar3;
		return 1;
	}
	return 0;
}



BOOL __cdecl FUN_0040c0e0(undefined4 *param_1,char *filename,int index)
{
	ResourceData *pRVar1;
	int iVar2;
	ResourceData **ppRVar3;
	
	pRVar1 = lego::res::Res_LoadResource((ResourceData *)param_1,filename,"LWS",1);
	*(ResourceData **)(&DAT_004c8bf8 + index * 0xf4) = pRVar1;
	if (pRVar1 != NULL) {
		lego::res::Res_UnkSetup3DFrameTransform(pRVar1,1);
		ppRVar3 = (ResourceData **)(&DAT_004c8bfc + index * 0x3d);
		iVar2 = 0x1e;
		do {
			pRVar1 = lego::res::Res_DuplicateResource(*(ResourceData **)(&DAT_004c8bf8 + index * 0xf4));
			*ppRVar3 = pRVar1;
			ppRVar3[0x1e] = (ResourceData *)0x1;
			lego::res::Res_UnkSetup3DFrameTransform(*ppRVar3,1);
			ppRVar3 = ppRVar3 + 1;
			iVar2 += -1;
		} while (iVar2 != 0);
		return 1;
	}
	return 0;
}



BOOL __cdecl
FUN_0040c160(int param_1,undefined4 param_2,undefined4 param_3,float param_4,float param_5,
						float param_6,float param_7,float param_8)
{
	int iVar1;
	int *piVar2;
	uint uVar3;
	
	uVar3 = 0;
	iVar1 = (param_1 + lego::globals::g_RockFallStyleIndex * 3) * 0xa4;
	piVar2 = (int *)(&DAT_004c8214 + iVar1);
	do {
		if (*piVar2 != 0) break;
		uVar3 += 1;
		piVar2 = piVar2 + 1;
	} while (uVar3 < 4);
	if (uVar3 < 4) {
		lego::res::Res_UnkSetup3DFrameTransform(*(ResourceData **)(iVar1 + 0x4c81e4 + uVar3 * 4),0);
		lego::res::Res_DoCallbacks(*(ResourceData **)(iVar1 + 0x4c81e4 + uVar3 * 4),0.0);
		lego::res::Res_SetFramePosition
							(*(ResourceData **)(iVar1 + 0x4c81e4 + uVar3 * 4),NULL,param_4,param_5,param_6);
		lego::res::Res_SetFrameOrientation
							(*(ResourceData **)(iVar1 + 0x4c81e4 + uVar3 * 4),NULL,param_7,param_8,0.0,0.0,0.0,
							 -1.0);
		*(undefined4 *)(iVar1 + 0x4c81f4 + uVar3 * 4) = param_2;
		*(undefined4 *)(&DAT_004c8204 + uVar3 * 4 + iVar1) = param_3;
		*(undefined4 *)(&DAT_004c8214 + uVar3 * 4 + iVar1) = 0;
		return 1;
	}
	return 0;
}



undefined4 __cdecl
FUN_0040c220(int param_1,float param_2,float param_3,float param_4,float param_5,float param_6,
						float param_7)
{
	int *piVar1;
	uint uVar2;
	
	uVar2 = 0;
	piVar1 = &DAT_004c8c74 + param_1 * 0x3d;
	do {
		if (*piVar1 != 0) break;
		uVar2 += 1;
		piVar1 = piVar1 + 1;
	} while (uVar2 < 0x1e);
	if (uVar2 < 0x1e) {
		lego::res::Res_UnkSetup3DFrameTransform
							((ResourceData *)(&DAT_004c8bfc)[param_1 * 0x3d + uVar2],0);
		lego::res::Res_DoCallbacks((ResourceData *)(&DAT_004c8bfc)[param_1 * 0x3d + uVar2],0.0);
		lego::res::Res_SetFramePosition
							((ResourceData *)(&DAT_004c8bfc)[param_1 * 0x3d + uVar2],NULL,param_2,param_3,param_4)
		;
		lego::res::Res_SetFrameOrientation
							((ResourceData *)(&DAT_004c8bfc)[param_1 * 0x3d + uVar2],NULL,param_5,param_6,param_7,
							 0.0,0.0,-1.0);
		(&DAT_004c8c74)[param_1 * 0x3d + uVar2] = 0;
		return 1;
	}
	return 0;
}



int __cdecl FUN_0040c2d0(float param_1,undefined4 *param_2,undefined4 *param_3)
{
	int iVar1;
	uint uVar2;
	int iVar3;
	int *piVar4;
	BlockObject **ppBVar5;
	uint uVar6;
	BlockObject **ppBVar7;
	float10 fVar8;
	
	iVar1 = 0;
	FUN_0040c760(param_1);
	FUN_0040c400(param_1);
	FUN_0040c450(param_1);
	FUN_0040cb70(param_1);
	uVar2 = 0;
	do {
		iVar3 = uVar2 + lego::globals::g_RockFallStyleIndex * 3;
		if (*(int *)((int)lego::globals::g_MiscObjectDependencies_TABLE + iVar3 * 0xa4 + 0xe598) != 0) {
			uVar6 = 0;
			piVar4 = (int *)(&DAT_004c8214 + iVar3 * 0xa4);
			do {
				if (*piVar4 == 0) {
					fVar8 = lego::res::Res_DoAnimElapsedCallbacks((ResourceData *)piVar4[-0xc],param_1);
					if ((ushort)((ushort)(fVar8 < (float10)0.0) << 8 | (ushort)(fVar8 == (float10)0.0) << 0xe)
							== 0) {
						lego::res::Res_UnkSetup3DFrameTransform((ResourceData *)piVar4[-0xc],1);
						*piVar4 = 1;
						piVar4[0x18] = 0;
						lego::globals::g_MiscObjectDependencies_TABLE[299].levels_field_44[iVar1 + 2] = uVar2;
						lego::globals::g_MiscObjectDependencies_TABLE[299].levels_field_44[iVar1 + 0xe] = uVar6;
						iVar1 += 1;
					}
				}
				uVar6 += 1;
				piVar4 = piVar4 + 1;
			} while (uVar6 < 4);
		}
		uVar2 += 1;
	} while (uVar2 < 3);
	ppBVar7 = (BlockObject **)&DAT_004c8c74;
	*param_2 = 0x4c8180;
	*param_3 = 0x4c81b0;
	do {
		iVar3 = 0x1e;
		ppBVar5 = ppBVar7;
		do {
			if (*ppBVar5 == NULL) {
				fVar8 = lego::res::Res_DoAnimElapsedCallbacks((ResourceData *)ppBVar5[-0x1e],param_1);
				if ((ushort)((ushort)(fVar8 < (float10)0.0) << 8 | (ushort)(fVar8 == (float10)0.0) << 0xe)
						== 0) {
					lego::res::Res_UnkSetup3DFrameTransform((ResourceData *)ppBVar5[-0x1e],1);
					*ppBVar5 = (BlockObject *)0x1;
				}
			}
			ppBVar5 = ppBVar5 + 1;
			iVar3 += -1;
		} while (iVar3 != 0);
		ppBVar7 = ppBVar7 + 0x3d;
	} while (ppBVar7 < lego::pool::globals::ReservedPool_BlockObject___g_TABLE + 0x17);
	return iVar1;
}



void __cdecl FUN_0040c400(float param_1)
{
	ResourceData **ppRVar1;
	float10 fVar2;
	
	ppRVar1 = PTR_ARRAY_004c8bd8;
	do {
		if (*ppRVar1 != NULL) {
			fVar2 = lego::res::Res_DoAnimElapsedCallbacks(*ppRVar1,param_1);
			if ((ushort)((ushort)(fVar2 < (float10)0.0) << 8 | (ushort)(fVar2 == (float10)0.0) << 0xe) ==
					0) {
				lego::pool::ReservedPool_ResourceData___Release(*ppRVar1);
				*ppRVar1 = NULL;
			}
		}
		ppRVar1 = ppRVar1 + 1;
	} while (ppRVar1 < &DAT_004c8be8);
	return;
}



void __cdecl FUN_0040c450(float param_1)
{
	ResourceData **ppRVar1;
	float10 fVar2;
	
	ppRVar1 = (ResourceData **)&DAT_004c8be8;
	do {
		if (*ppRVar1 != NULL) {
			fVar2 = lego::res::Res_DoAnimElapsedCallbacks(*ppRVar1,param_1);
			if ((ushort)((ushort)(fVar2 < (float10)0.0) << 8 | (ushort)(fVar2 == (float10)0.0) << 0xe) ==
					0) {
				lego::pool::ReservedPool_ResourceData___Release(*ppRVar1);
				*ppRVar1 = NULL;
			}
		}
		ppRVar1 = ppRVar1 + 1;
	} while (ppRVar1 < &DAT_004c8bf8);
	return;
}



void __cdecl FUN_0040c4a0(int param_1,int param_2,undefined4 *param_3,undefined4 *param_4)
{
	int iVar1;
	
	iVar1 = (param_1 + lego::globals::g_RockFallStyleIndex * 3) * 0xa4;
	*param_3 = *(undefined4 *)(iVar1 + 0x4c81f4 + param_2 * 4);
	*param_4 = *(undefined4 *)(&DAT_004c8204 + param_2 * 4 + iVar1);
	return;
}



int ** __cdecl FUN_0040c4e0(int param_1,uint param_2)
{
	int *piVar1;
	char *pcVar2;
	ResourceData *pRVar3;
	uint uVar4;
	uint uVar5;
	int *piVar6;
	
	uVar4 = 0;
	piVar6 = (int *)((int)lego::globals::g_MiscObjectDependencies_TABLE +
									lego::globals::g_RockFallStyleIndex * 0x1ec + 0xe598);
	do {
		if (*piVar6 != 0) {
			uVar5 = 0;
			piVar1 = piVar6 + 5;
			do {
				if (((piVar1[8] == 0) && (param_1 == *piVar1)) && (param_2 == piVar1[4])) {
					param_2 = 0;
					if (piVar6[0x12] != 0) goto LAB_0040c546;
					goto LAB_0040c564;
				}
				uVar5 += 1;
				piVar1 = piVar1 + 1;
			} while (uVar5 < 4);
		}
		uVar4 += 1;
		piVar6 = piVar6 + 0x29;
		if (2 < uVar4) {
			return (int **)NULL;
		}
	} while( true );
	while( true ) {
		param_2 += 1;
		if ((uint)piVar6[0x12] <= param_2) break;
LAB_0040c546:
		if ((piVar6[uVar5 + 0x25] & 1 << ((byte)param_2 & 0x1f)) == 0) break;
	}
LAB_0040c564:
	if (param_2 != piVar6[0x12]) {
		piVar6[uVar5 + 0x25] = piVar6[uVar5 + 0x25] | 1 << ((byte)param_2 & 0x1f);
		pcVar2 = lego::res::Res_GetNull
											 ((ResourceData *)piVar6[uVar5 + 1],(char *)piVar6[0x11],(int *)&param_2);
		pRVar3 = FUN_00473e80((ResourceData *)piVar6[uVar5 + 1],pcVar2,0,NULL);
		return (int **)pRVar3;
	}
	return (int **)NULL;
}



void __fastcall FUN_0040c5c0(void *param_1)
{
	ResourceData **ppRVar1;
	
	ppRVar1 = PTR_ARRAY_004c8bd8;
	do {
		if (*ppRVar1 != NULL) {
			lego::pool::ReservedPool_ResourceData___Release(*ppRVar1);
			*ppRVar1 = NULL;
		}
		ppRVar1 = ppRVar1 + 1;
	} while (ppRVar1 < &DAT_004c8be8);
	return;
}



void __cdecl FUN_0040c5f0(void)
{
	int iVar1;
	uint uVar2;
	ResourceData **ppRVar3;
	int iVar4;
	
	uVar2 = 0;
	iVar1 = lego::globals::g_RockFallStyleIndex;
	do {
		iVar4 = uVar2 + iVar1 * 3;
		if (*(int *)((int)lego::globals::g_MiscObjectDependencies_TABLE + iVar4 * 0xa4 + 0xe598) != 0) {
			ppRVar3 = (ResourceData **)
								((int)lego::globals::g_MiscObjectDependencies_TABLE + iVar4 * 0xa4 + 0xe59c);
			iVar4 = 4;
			do {
				lego::pool::ReservedPool_ResourceData___Release(*ppRVar3);
				*ppRVar3 = NULL;
				ppRVar3 = ppRVar3 + 1;
				iVar4 += -1;
				iVar1 = lego::globals::g_RockFallStyleIndex;
			} while (iVar4 != 0);
		}
		uVar2 += 1;
	} while (uVar2 < 3);
	return;
}



void __cdecl FUN_0040c650(ResourceData *resRoot,char *filename)
{
	DAT_004c8de0 = lego::res::Res_LoadResource(resRoot,filename,"LWS",1);
	lego::res::Res_UnkSetup3DFrameTransform(DAT_004c8de0,1);
	return;
}



void __cdecl FUN_0040c680(LiveObject *liveObj,Point2F *param_2)
{
	LevelSurfaceMap *surfMap;
	ResourceData *pRVar1;
	float10 fVar2;
	float x;
	float y;
	float local_c;
	float local_8;
	float local_4;
	
	if (liveObj == NULL) {
		local_c = param_2->x;
		local_8 = param_2->y;
	}
	else {
		lego::game::LiveObject_GetPosition(liveObj,&local_c,&local_8);
	}
	x = local_c;
	y = local_8;
	surfMap = lego::game::GetSurfaceMap();
	fVar2 = lego::game::SurfaceMap_UnkGetZ(surfMap,x,y);
	local_4 = (float)(fVar2 - (float10)1.0);
	if ((uint)INT_004c8df4 < 4) {
		pRVar1 = lego::res::Res_DuplicateResource(DAT_004c8de0);
		(&DAT_004c8de4)[INT_004c8df4] = pRVar1;
		pRVar1 = (ResourceData *)(&DAT_004c8de4)[INT_004c8df4];
		INT_004c8df4 += 1;
		lego::res::Res_UnkSetup3DFrameTransform(pRVar1,0);
		lego::res::Res_SetFramePosition(pRVar1,NULL,local_c,local_8,local_4);
		lego::res::Res_SetFrameOrientation(pRVar1,NULL,0.0,1.0,0.0,0.0,0.0,-1.0);
		lego::res::Res_DoCallbacks(pRVar1,0.0);
	}
	return;
}



void __cdecl FUN_0040c760(float param_1)
{
	ResourceData *resData;
	int iVar1;
	ResourceData **ppRVar2;
	ResourceData **ppRVar3;
	float10 fVar4;
	
	iVar1 = 0;
	if (0 < INT_004c8df4) {
		ppRVar2 = (ResourceData **)&DAT_004c8de4;
		do {
			resData = *ppRVar2;
			fVar4 = lego::res::Res_DoAnimElapsedCallbacks(resData,param_1);
			ppRVar3 = ppRVar2;
			if (fVar4 != (float10)0.0) {
				lego::pool::ReservedPool_ResourceData___Release(resData);
				INT_004c8df4 += -1;
				iVar1 += -1;
				ppRVar3 = ppRVar2 + -1;
				*ppRVar2 = (ResourceData *)(&DAT_004c8de4)[INT_004c8df4];
			}
			iVar1 += 1;
			ppRVar2 = ppRVar3 + 1;
		} while (iVar1 < INT_004c8df4);
	}
	return;
}



undefined * __cdecl FUN_0040c7d0(undefined4 param_1)
{
	switch(param_1) {
	case 0:
		return (undefined *)&lego::globals::g_MiscObject_LazerHit;
	case 1:
		return (undefined *)&lego::globals::g_MiscObject_PusherHit;
	case 2:
		return (undefined *)&lego::globals::g_MiscObject_FreezerHit;
	case 3:
		return (undefined *)&lego::globals::g_MiscObject_PathDust;
	case 4:
		return (undefined *)&lego::globals::g_MiscObject_LavaErosionSmoke1;
	case 5:
		return (undefined *)&lego::globals::g_MiscObject_LavaErosionSmoke2;
	case 6:
		return (undefined *)&lego::globals::g_MiscObject_LavaErosionSmoke3;
	case 7:
		return (undefined *)&lego::globals::g_MiscObject_LavaErosionSmoke4;
	case 8:
		return (undefined *)&lego::globals::g_MiscObject_BirdScarer;
	case 9:
		return (undefined *)&lego::globals::g_MiscObject_UpgradeEffect;
	default:
		return (undefined *)NULL;
	}
}



BOOL __cdecl
lego::res::Res_LoadMiscObject(MiscObjectData *miscObjData,ResourceData *resRoot,char *filename)
{
	ResourceData *pRVar1;
	
	if (filename == NULL) {
		return 0;
	}
	pRVar1 = Res_LoadResource(resRoot,filename,"LWS",1);
	miscObjData->resData = pRVar1;
	if (pRVar1 == NULL) {
		pRVar1 = Res_LoadResource(resRoot,filename,"LWO",1);
		miscObjData->resData = pRVar1;
		if (pRVar1 == NULL) {
			return 0;
		}
	}
	Res_UnkSetup3DFrameTransform(miscObjData->resData,1);
	return 1;
}



void __cdecl lego::res::Res_LoadMiscObjects(CFGProperty *root,char *keyRoot,ResourceData *resRoot)
{
	char *pcVar1;
	
	pcVar1 = cfg::CFG_JoinPath(keyRoot,"MiscObjects","LazerHit",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	Res_LoadMiscObject(&globals::g_MiscObject_LazerHit,resRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyRoot,"MiscObjects","PusherHit",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	Res_LoadMiscObject(&globals::g_MiscObject_PusherHit,resRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyRoot,"MiscObjects","FreezerHit",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	Res_LoadMiscObject(&globals::g_MiscObject_FreezerHit,resRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyRoot,"MiscObjects","PathDust",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	Res_LoadMiscObject(&globals::g_MiscObject_PathDust,resRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyRoot,"MiscObjects","LavaErosionSmoke1",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	Res_LoadMiscObject(&globals::g_MiscObject_LavaErosionSmoke1,resRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyRoot,"MiscObjects","LavaErosionSmoke2",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	Res_LoadMiscObject(&globals::g_MiscObject_LavaErosionSmoke2,resRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyRoot,"MiscObjects","LavaErosionSmoke3",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	Res_LoadMiscObject(&globals::g_MiscObject_LavaErosionSmoke3,resRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyRoot,"MiscObjects","LavaErosionSmoke4",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	Res_LoadMiscObject(&globals::g_MiscObject_LavaErosionSmoke4,resRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyRoot,"MiscObjects","BirdScarer",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	Res_LoadMiscObject(&globals::g_MiscObject_BirdScarer,resRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyRoot,"MiscObjects","UpgradeEffect",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	Res_LoadMiscObject(&globals::g_MiscObject_UpgradeEffect,resRoot,pcVar1);
	return;
}



void __cdecl FUN_0040caa0(int **param_1,float param_2)
{
	ResourceData *resData;
	int *piVar1;
	ResourceData **ppRVar2;
	int *piVar3;
	float10 fVar4;
	float local_14;
	float local_10;
	Vector3F local_c;
	
	piVar3 = NULL;
	ppRVar2 = (ResourceData **)param_1;
	if (param_1[10] != NULL) {
		do {
			resData = *ppRVar2;
			if (((MiscObjectData *)param_1 == &lego::globals::g_MiscObject_BirdScarer) &&
				 (lego::globals::g_MiscObject_BirdScarer._44_4_ =
							 param_2 + lego::globals::g_MiscObject_BirdScarer._44_4_,
				 (ushort)((ushort)(lego::globals::g_MiscObject_BirdScarer._44_4_ < 12.5) << 8 |
								 (ushort)(lego::globals::g_MiscObject_BirdScarer._44_4_ == 12.5) << 0xe) == 0)) {
				lego::res::Res_GetPosition(resData,NULL,&local_c);
				local_14 = local_c.x;
				local_10 = local_c.y;
				FUN_00440b80(NULL,&local_14,lego::globals::g_Game.BirdScarerRadius);
				lego::globals::g_MiscObject_BirdScarer._44_4_ = 0.0;
			}
			fVar4 = lego::res::Res_DoAnimElapsedCallbacks(resData,param_2);
			if (fVar4 != (float10)0.0) {
				lego::pool::ReservedPool_ResourceData___Release(resData);
				piVar1 = (int *)((int)param_1[10] - 1);
				param_1[10] = piVar1;
				if (piVar3 == piVar1) {
					*ppRVar2 = NULL;
				}
				else {
					*ppRVar2 = (ResourceData *)param_1[(int)piVar1];
				}
				piVar3 = (int *)((int)piVar3 - 1);
				ppRVar2 = ppRVar2 + -1;
			}
			piVar3 = (int *)((int)piVar3 + 1);
			ppRVar2 = ppRVar2 + 1;
		} while (piVar3 < param_1[10]);
	}
	return;
}



void __cdecl FUN_0040cb70(float param_1)
{
	FUN_0040caa0((int **)&lego::globals::g_MiscObject_LazerHit,param_1);
	FUN_0040caa0((int **)&lego::globals::g_MiscObject_PusherHit,param_1);
	FUN_0040caa0((int **)&lego::globals::g_MiscObject_FreezerHit,param_1);
	FUN_0040caa0((int **)&lego::globals::g_MiscObject_PathDust,param_1);
	FUN_0040caa0((int **)&lego::globals::g_MiscObject_LavaErosionSmoke1,param_1);
	FUN_0040caa0((int **)&lego::globals::g_MiscObject_LavaErosionSmoke2,param_1);
	FUN_0040caa0((int **)&lego::globals::g_MiscObject_LavaErosionSmoke3,param_1);
	FUN_0040caa0((int **)&lego::globals::g_MiscObject_LavaErosionSmoke4,param_1);
	FUN_0040caa0((int **)&lego::globals::g_MiscObject_BirdScarer,param_1);
	FUN_0040caa0((int **)&lego::globals::g_MiscObject_UpgradeEffect,param_1);
	return;
}



undefined4 __cdecl FUN_0040cc10(undefined4 param_1,undefined4 *param_2,undefined4 *param_3)
{
	undefined *puVar1;
	ResourceData *pRVar2;
	float x;
	float y;
	float z;
	
	puVar1 = FUN_0040c7d0(param_1);
	if (((*(uint *)(puVar1 + 0x28) < 10) && (puVar1 != NULL)) &&
		 (*(ResourceData **)(puVar1 + 0x30) != NULL)) {
		*(undefined4 *)(puVar1 + 0x2c) = 0;
		pRVar2 = lego::res::Res_DuplicateResource(*(ResourceData **)(puVar1 + 0x30));
		*(ResourceData **)(puVar1 + *(int *)(puVar1 + 0x28) * 4) = pRVar2;
		lego::res::Res_DoCallbacks(*(ResourceData **)(puVar1 + *(int *)(puVar1 + 0x28) * 4),0.0);
		lego::res::Res_SetFramePosition
							(*(ResourceData **)(puVar1 + *(int *)(puVar1 + 0x28) * 4),NULL,(float)*param_2,
							 (float)param_2[1],(float)param_2[2]);
		if (param_3 == NULL) {
			z = 0.0;
			y = 1.0;
			x = 0.0;
			pRVar2 = *(ResourceData **)(puVar1 + *(int *)(puVar1 + 0x28) * 4);
		}
		else {
			z = (float)param_3[2];
			y = (float)param_3[1];
			x = (float)*param_3;
			pRVar2 = *(ResourceData **)(puVar1 + *(int *)(puVar1 + 0x28) * 4);
		}
		lego::res::Res_SetFrameOrientation(pRVar2,NULL,x,y,z,0.0,0.0,-1.0);
		*(int *)(puVar1 + 0x28) = *(int *)(puVar1 + 0x28) + 1;
		return 1;
	}
	return 0;
}



void __cdecl lego::pool::ReservedPool_BlockObject___Init(LevelData *level)
{
	uint uVar1;
	int iVar2;
	BlockObject *pBVar3;
	BlockObject **ppBVar4;
	
	PTR_004c8df8 = (BlockObject *)
								 std::malloc((level->dimensions).width * (level->dimensions).height * 0x14);
	if (PTR_004c8df8 != NULL) {
		pBVar3 = PTR_004c8df8;
		for (uVar1 = (level->dimensions).width * (level->dimensions).height * 5 & 0x3fffffff; uVar1 != 0
				; uVar1 -= 1) {
			pBVar3->attachedObject = NULL;
			pBVar3 = (BlockObject *)&pBVar3->position;
		}
		for (iVar2 = 0; iVar2 != 0; iVar2 += -1) {
			*(undefined *)&pBVar3->attachedObject = 0;
			pBVar3 = (BlockObject *)((int)&pBVar3->attachedObject + 1);
		}
	}
	lego::globals::g_Level = level;
	ppBVar4 = globals::ReservedPool_BlockObject___g_TABLE;
	for (iVar2 = 0x20; iVar2 != 0; iVar2 += -1) {
		*ppBVar4 = NULL;
		ppBVar4 = ppBVar4 + 1;
	}
	globals::ReservedPool_BlockObject___g_NEXT = NULL;
	globals::ReservedPool_BlockObject___g_COUNT = 0;
	return;
}



void __cdecl lego::pool::ReservedPool_BlockObject___Cleanup(void)
{
	BlockObject **ppBVar1;
	
	ppBVar1 = globals::ReservedPool_BlockObject___g_TABLE;
	do {
		if (*ppBVar1 != NULL) {
			std::free(*ppBVar1);
		}
		ppBVar1 = ppBVar1 + 1;
	} while (ppBVar1 < &globals::ReservedPool_BlockObject___g_NEXT);
	globals::ReservedPool_BlockObject___g_NEXT = NULL;
	if (PTR_004c8df8 != NULL) {
		std::free(PTR_004c8df8);
		PTR_004c8df8 = NULL;
	}
	return;
}



void __cdecl FUN_0040cdb0(LevelData *level)
{
	lego::pool::ReservedPool_BlockObject___Cleanup();
	lego::pool::ReservedPool_BlockObject___Init(level);
	return;
}



void __cdecl FUN_0040cdd0(int x,int y)
{
	int iVar1;
	int iVar2;
	int iVar3;
	uint uVar4;
	int *piVar5;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	iVar3 = y;
	local_20[1] = 1;
	local_20[2] = 1;
	local_20[3] = 0;
	local_20[4] = 0;
	local_4 = 0;
	local_c = 0xffffffff;
	local_8 = 0xffffffff;
	lego::game::Level_UpdateBlockSurfaceUnk(lego::globals::g_Level,x,y);
	piVar5 = local_20 + 1;
	y = 4;
	do {
		iVar1 = piVar5[-1];
		iVar2 = *piVar5;
		uVar4 = FUN_00450580(lego::globals::g_Level->surfaceMap,iVar1 + x,iVar3 + iVar2);
		if (uVar4 != 0) {
			lego::game::Level_UpdateBlockSurfaceUnk(lego::globals::g_Level,iVar1 + x,iVar3 + iVar2);
		}
		piVar5 = piVar5 + 2;
		y += -1;
	} while (y != 0);
	return;
}



void __cdecl FUN_0040ce80(LiveObject *liveObj)
{
	LiveObject *liveObj_00;
	int local_4;
	
	liveObj_00 = liveObj;
	lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_4,(int *)&liveObj);
	lego::pool::ReservedPool_BlockObject___Next(liveObj_00,local_4,(int)liveObj);
	return;
}



BlockObject * __cdecl lego::pool::ReservedPool_BlockObject___Next(LiveObject *liveObj,int x,int y)
{
	LiveObject **ppLVar1;
	BlockObject *pBVar2;
	
	if (globals::ReservedPool_BlockObject___g_NEXT == NULL) {
		ReservedPool_BlockObject___Alloc();
	}
	pBVar2 = globals::ReservedPool_BlockObject___g_NEXT;
	ppLVar1 = &globals::ReservedPool_BlockObject___g_NEXT->attachedObject;
	globals::ReservedPool_BlockObject___g_NEXT =
			 globals::ReservedPool_BlockObject___g_NEXT->pool_m_next;
	*ppLVar1 = NULL;
	(pBVar2->position).x = 0;
	(pBVar2->position).y = 0;
	pBVar2->field_c = 0;
	pBVar2->pool_m_next = NULL;
	pBVar2->pool_m_next = pBVar2;
	pBVar2->attachedObject = liveObj;
	(pBVar2->position).x = x;
	(pBVar2->position).y = y;
	*(undefined4 *)
	 ((int)&PTR_004c8df8->position + ((lego::globals::g_Level->dimensions).width * y + x) * 0xc + 4) =
			 0;
	(&PTR_004c8df8->attachedObject)[((lego::globals::g_Level->dimensions).width * y + x) * 3] =
			 (LiveObject *)pBVar2;
	liveObj->flags2_3e4 = liveObj->flags2_3e4 | 0x2000000;
	FUN_0040cdd0(x,y);
	return pBVar2;
}



void __cdecl lego::pool::ReservedPool_BlockObject___Alloc(void)
{
	BlockObject *pBVar1;
	BlockObject *pBVar2;
	int iVar3;
	uint uVar4;
	
	uVar4 = 1 << ((byte)globals::ReservedPool_BlockObject___g_COUNT & 0x1f);
	pBVar2 = (BlockObject *)std::malloc(uVar4 * 0x14);
	globals::ReservedPool_BlockObject___g_TABLE[globals::ReservedPool_BlockObject___g_COUNT] = pBVar2;
	pBVar2 = globals::ReservedPool_BlockObject___g_TABLE[globals::ReservedPool_BlockObject___g_COUNT];
	if (pBVar2 != NULL) {
		globals::ReservedPool_BlockObject___g_COUNT += 1;
		if (1 < uVar4) {
			iVar3 = uVar4 - 1;
			pBVar1 = pBVar2;
			do {
				pBVar1->pool_m_next = pBVar1 + 1;
				iVar3 += -1;
				pBVar1 = pBVar1 + 1;
			} while (iVar3 != 0);
		}
		pBVar2[uVar4 - 1].pool_m_next = globals::ReservedPool_BlockObject___g_NEXT;
		globals::ReservedPool_BlockObject___g_NEXT = pBVar2;
	}
	return;
}



void __cdecl FUN_0040cfd0(LiveObject *liveObj)
{
	int local_4;
	
	if ((liveObj->flags2_3e4 & 0x2000000) != LIVEOBJ2_NONE) {
		lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_4,(int *)&liveObj);
		if ((&PTR_004c8df8->attachedObject)
				[((lego::globals::g_Level->dimensions).width * (int)liveObj + local_4) * 3] != NULL) {
			lego::pool::ReservedPool_BlockObject___Release
								((BlockObject *)
								 (&PTR_004c8df8->attachedObject)
								 [((lego::globals::g_Level->dimensions).width * (int)liveObj + local_4) * 3],local_4
								 ,(int)liveObj);
		}
	}
	return;
}



void __cdecl lego::pool::ReservedPool_BlockObject___Release(BlockObject *block,int x,int y)
{
	block->pool_m_next = globals::ReservedPool_BlockObject___g_NEXT;
	globals::ReservedPool_BlockObject___g_NEXT = block;
	*(undefined4 *)
	 ((int)&PTR_004c8df8->position + ((lego::globals::g_Level->dimensions).width * y + x) * 0xc + 4) =
			 0;
	(&PTR_004c8df8->attachedObject)[((lego::globals::g_Level->dimensions).width * y + x) * 3] = NULL;
	FUN_0040cdd0(x,y);
	return;
}



BOOL __cdecl FUN_0040d0a0(int x,int y)
{
	int iVar1;
	LiveObject *liveObj;
	Point2F local_8;
	
	iVar1 = FUN_0040d170(x,y);
	if (iVar1 != 0) {
		FUN_0044f900(lego::globals::g_Level->surfaceMap,x,y,(float *)&local_8,&local_8.y);
		liveObj = lego::game::Game_CreateLiveResourceObject
												(lego::globals::g_Game.RES_ElectricFence,OBJECT_ELECTRICFENCE,0,0,local_8.x,
												 local_8.y,0.0);
		lego::pool::ReservedPool_BlockObject___Next(liveObj,x,y);
		return 1;
	}
	return 0;
}



undefined4 __cdecl FUN_0040d120(int param_1,int param_2)
{
	LiveObject *liveObj;
	
	if ((&PTR_004c8df8->attachedObject)
			[((lego::globals::g_Level->dimensions).width * param_2 + param_1) * 3] != NULL) {
		liveObj = (LiveObject *)
							(&PTR_004c8df8->attachedObject)
							[((lego::globals::g_Level->dimensions).width * param_2 + param_1) * 3]->objType;
		FUN_0040cfd0(liveObj);
		lego::pool::ReservedPool_LiveObject___Release(liveObj);
		return 1;
	}
	return 0;
}



undefined4 __cdecl FUN_0040d170(int param_1,int param_2)
{
	TerrainType TVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	uint uVar5;
	uint uVar6;
	int local_40 [16];
	
	local_40[9] = 2;
	local_40[10] = 2;
	local_40[13] = 0xfffffffe;
	local_40[14] = 0xfffffffe;
	local_40[1] = 1;
	local_40[2] = 1;
	local_40[5] = 0xffffffff;
	local_40[6] = 0xffffffff;
	iVar2 = (lego::globals::g_Level->dimensions).width * param_2 + param_1;
	local_40[8] = 0;
	local_40[11] = 0;
	local_40[12] = 0;
	local_40[15] = 0;
	local_40[0] = 0;
	local_40[3] = 0;
	local_40[4] = 0;
	local_40[7] = 0;
	if (((((*(byte *)&lego::globals::g_Level->blocks[iVar2].flags1 & 8) == 0) ||
			 (TVar1 = lego::globals::g_Level->blocks[iVar2].terrain, TVar1 == TERRAIN_LAVA)) ||
			(TVar1 == TERRAIN_WATER_unused)) ||
		 (((&PTR_004c8df8->attachedObject)[iVar2 * 3] != NULL ||
			(iVar2 = FUN_0040d320(lego::globals::g_Level,param_1,param_2,0), iVar2 != 0)))) {
		return 0;
	}
	uVar4 = 0;
	do {
		uVar5 = *(int *)((int)local_40 + uVar4) + param_1;
		uVar6 = param_2 + *(int *)((int)local_40 + uVar4 + 4);
		uVar3 = FUN_00450580(lego::globals::g_Level->surfaceMap,uVar5,uVar6);
		if ((uVar3 != 0) &&
			 (((&PTR_004c8df8->attachedObject)
				 [((lego::globals::g_Level->dimensions).width * uVar6 + uVar5) * 3] != NULL ||
				(iVar2 = FUN_0040d320(lego::globals::g_Level,uVar5,uVar6,0), iVar2 != 0)))) {
			return 1;
		}
		uVar5 = *(int *)((int)local_40 + uVar4 + 0x20) + param_1;
		uVar6 = *(int *)((int)local_40 + uVar4 + 0x24) + param_2;
		uVar3 = FUN_00450580(lego::globals::g_Level->surfaceMap,uVar5,uVar6);
		if (uVar3 != 0) {
			if ((&PTR_004c8df8->attachedObject)
					[((lego::globals::g_Level->dimensions).width * uVar6 + uVar5) * 3] != NULL) {
				return 1;
			}
			iVar2 = FUN_0040d320(lego::globals::g_Level,uVar5,uVar6,0);
			if (iVar2 != 0) {
				return 1;
			}
		}
		uVar4 += 8;
		if (0x1f < uVar4) {
			return 0;
		}
	} while( true );
}



undefined4 __cdecl FUN_0040d320(undefined4 param_1,int param_2,int param_3,int param_4)
{
	BOOL BVar1;
	uint uVar2;
	int local_8;
	int local_4;
	
	local_8 = param_2;
	local_4 = param_3;
	BVar1 = FUN_004329d0(param_2,param_3,1);
	if (BVar1 != 0) {
		if (param_4 == 0) {
			return 1;
		}
		uVar2 = FUN_004320a0(&local_8);
		if (uVar2 != 0) {
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_0040d380(ObjectType param_1)
{
	FUN_0040d3c0(&LAB_0040d6a0,&param_1);
	FUN_00437a70((LiveObjectPredicate *)&LAB_0040d650,NULL);
	FUN_00437a70(FUN_0040d510,(LiveObject *)&param_1);
	return;
}



void __cdecl FUN_0040d3c0(undefined *param_1,undefined4 param_2)
{
	int iVar1;
	int iVar2;
	BlockObject **ppBVar3;
	uint uVar4;
	int iVar5;
	
	uVar4 = 0;
	if (lego::pool::globals::ReservedPool_BlockObject___g_COUNT != 0) {
		ppBVar3 = lego::pool::globals::ReservedPool_BlockObject___g_TABLE;
		do {
			if ((*ppBVar3 != NULL) && (iVar1 = 1 << ((byte)uVar4 & 0x1f), iVar1 != 0)) {
				iVar5 = 0;
				do {
					iVar2 = (int)&(*ppBVar3)->attachedObject + iVar5;
					if ((iVar2 != 0) && (*(int *)(iVar2 + 0x10) == iVar2)) {
						(*(code *)param_1)(iVar2,param_2);
					}
					iVar5 += 0x14;
					iVar1 += -1;
				} while (iVar1 != 0);
			}
			uVar4 += 1;
			ppBVar3 = ppBVar3 + 1;
		} while (uVar4 < lego::pool::globals::ReservedPool_BlockObject___g_COUNT);
	}
	return;
}



undefined4 __cdecl FUN_0040d420(undefined4 *param_1,uint param_2,uint param_3)
{
	ObjectStatsFlags2 OVar1;
	int iVar2;
	float local_8;
	float local_4;
	
	FUN_0040d3c0(&LAB_0040d6a0,0);
	FUN_00437a70((LiveObjectPredicate *)&LAB_0040d650,NULL);
	if (param_1 == NULL) {
		if (((&PTR_004c8df8->attachedObject)
				 [((lego::globals::g_Level->dimensions).width * param_3 + param_2) * 3] == NULL) &&
			 (iVar2 = FUN_0040d320(lego::globals::g_Level,param_2,param_3,0), iVar2 == 0)) {
			return 0;
		}
	}
	else {
		lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_8,&local_4);
		lego::game::SurfaceMap_ToBlockCoordinatesNoZ
							(lego::globals::g_Level->surfaceMap,local_8,local_4,(int *)&param_2,(int *)&param_3);
		OVar1 = lego::game::LiveObject_GetStatsFlags2((LiveObject *)param_1);
		if (((OVar1 & STATS2_SELFPOWERED) == STATS2_NONE) && ((param_1[0xfa] & 0x20000000) == 0)) {
			return 0;
		}
	}
	FUN_0040d780(param_2,param_3,1,0.0);
	return 1;
}



undefined4 __cdecl FUN_0040d510(LiveObject *param_1,float *param_2)
{
	float fVar1;
	uint *puVar2;
	int iVar3;
	int iVar4;
	uint *puVar5;
	float *pfVar6;
	uint *puVar7;
	float *pfVar8;
	Point2F local_10;
	int local_8;
	int local_4;
	
	fVar1 = *param_2;
	if (param_1->objType == OBJECT_BUILDING) {
		lego::game::LiveObject_GetBlockCoordinates(param_1,&local_8,&local_4);
		iVar3 = FUN_0040d320(lego::globals::g_Level,local_8,local_4,1);
		if (iVar3 != 0) {
			FUN_00442560(param_1,&local_10);
			if (ABS(local_10.x) <= ABS(local_10.y)) {
				if ((ushort)((ushort)(local_10.y < 0.0) << 8 | (ushort)(local_10.y == 0.0) << 0xe) == 0) {
					iVar3 = 0;
				}
				else {
					iVar3 = 2;
				}
			}
			else {
				if ((ushort)((ushort)(local_10.x < 0.0) << 8 | (ushort)(local_10.x == 0.0) << 0xe) == 0) {
					iVar3 = 1;
				}
				else {
					iVar3 = 3;
				}
			}
			iVar4 = FUN_00408290(param_1->building,&param_2);
			puVar5 = FUN_004643d0(&local_8,iVar4,(int)param_2,iVar3);
			pfVar8 = NULL;
			pfVar6 = param_2;
			puVar2 = puVar5;
			if (param_2 != NULL) {
				do {
					puVar7 = puVar2 + 2;
					if (((pfVar8 == (float *)((int)pfVar6 - 1U)) || (*puVar5 != *puVar7)) ||
						 (puVar5[1] != puVar2[3])) {
						FUN_0040d780(*puVar5,puVar5[1],0,fVar1);
						pfVar6 = param_2;
					}
					else {
						pfVar8 = (float *)((int)pfVar8 + 1);
						puVar7 = puVar2 + 4;
						puVar5 = puVar5 + 2;
					}
					pfVar8 = (float *)((int)pfVar8 + 1);
					puVar5 = puVar5 + 2;
					puVar2 = puVar7;
				} while (pfVar8 < pfVar6);
			}
		}
	}
	return 0;
}



void __cdecl FUN_0040d780(uint param_1,uint param_2,int param_3,float param_4)
{
	uint x;
	uint y;
	uint *puVar1;
	VehicleData *pVVar2;
	bool bVar3;
	short sVar4;
	uint uVar5;
	int iVar6;
	int iVar7;
	uint x_00;
	uint y_00;
	ulonglong uVar8;
	uint local_5c;
	float local_58;
	int *local_54;
	int local_50;
	uint local_48;
	uint local_44;
	int local_40;
	int local_3c [4];
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	int local_20 [4];
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_20[1] = 2;
	local_20[2] = 2;
	local_c = 0xfffffffe;
	local_8 = 0xfffffffe;
	local_3c[0] = 1;
	local_3c[1] = 1;
	local_2c = 0xffffffff;
	local_28 = 0xffffffff;
	local_20[0] = 0;
	local_20[3] = 0;
	local_10 = 0;
	local_4 = 0;
	local_40 = 0;
	local_3c[2] = 0;
	puVar1 = (uint *)((int)&PTR_004c8df8->position +
									 ((lego::globals::g_Level->dimensions).width * param_2 + param_1) * 0xc + 4);
	local_3c[3] = 0;
	local_24 = 0;
	local_5c = 0;
	*puVar1 = *puVar1 | 0x100;
	local_54 = &local_40;
	do {
		bVar3 = false;
		iVar7 = *local_54;
		x = param_1 + iVar7;
		y = local_3c[local_5c * 2] + param_2;
		uVar5 = FUN_00450580(lego::globals::g_Level->surfaceMap,x,y);
		if ((uVar5 != 0) &&
			 (((&PTR_004c8df8->attachedObject)[((lego::globals::g_Level->dimensions).width * y + x) * 3]
				 != NULL ||
				((iVar6 = FUN_0040d320(lego::globals::g_Level,x,y,1), iVar6 != 0 &&
				 (iVar6 = FUN_0040d320(lego::globals::g_Level,param_1,param_2,0), iVar6 == 0)))))) {
			bVar3 = true;
			local_50 = 1;
			local_48 = x;
			local_44 = y;
		}
		if (bVar3) {
LAB_0040d9a4:
			if (local_50 == 0) {
				iVar7 = (lego::globals::g_Level->dimensions).width * y + param_1 + iVar7;
				*(uint *)((int)&PTR_004c8df8->position + iVar7 * 0xc + 4) =
						 *(uint *)((int)&PTR_004c8df8->position + iVar7 * 0xc + 4) | 0x100;
			}
			iVar7 = (lego::globals::g_Level->dimensions).width;
			iVar6 = local_44 * iVar7 + local_48;
			if (((&PTR_004c8df8->attachedObject)[iVar6 * 3] == NULL) ||
				 (pVVar2 = (&PTR_004c8df8->attachedObject)[iVar6 * 3]->vehicle,
				 (ushort)((ushort)((float)pVVar2 < 0.0) << 8 | (ushort)((float)pVVar2 == 0.0) << 0xe) != 0))
			{
				if ((*(uint *)((int)&PTR_004c8df8->position + iVar6 * 0xc + 4) &
						1 << ((byte)local_5c & 0x1f)) == 0) {
					puVar1 = (uint *)((int)&PTR_004c8df8->position + (param_2 * iVar7 + param_1) * 0xc + 4);
					*puVar1 = *puVar1 | 1 << ((byte)local_5c - 2 & 3);
					local_58 = param_4;
					if ((ushort)((ushort)(param_4 < 200.0) << 8 | (ushort)(param_4 == 200.0) << 0xe) == 0) {
						local_58 = 200.0;
					}
					if (param_3 == 0) {
						if (local_58 != 0.0) {
							sVar4 = lego::util::randomInt16();
							uVar8 = __ftol((float10)200.0 / (float10)local_58);
							if ((int)((ulonglong)(uint)(int)sVar4 % (uVar8 & 0xffffffff)) == 0) goto LAB_0040dab9;
						}
					}
					else {
LAB_0040dab9:
						FUN_0040db50(param_1,param_2,local_48,local_44);
					}
				}
				iVar7 = FUN_0040d320(lego::globals::g_Level,local_48,local_44,0);
				if ((iVar7 == 0) &&
					 ((*(uint *)((int)&PTR_004c8df8->position +
											((lego::globals::g_Level->dimensions).width * local_44 + local_48) * 0xc + 4)
						& 0x100) == 0)) {
					FUN_0040d780(local_48,local_44,param_3,param_4);
				}
			}
		}
		else {
			y_00 = param_2 + local_20[local_5c * 2 + 1];
			x_00 = local_20[local_5c * 2] + param_1;
			uVar5 = FUN_00450580(lego::globals::g_Level->surfaceMap,x_00,y_00);
			if (((uVar5 != 0) &&
					((iVar6 = FUN_0040d320(lego::globals::g_Level,x,y,0), iVar6 == 0 ||
					 (iVar6 = FUN_0040d320(lego::globals::g_Level,param_1,param_2,0), iVar6 == 0)))) &&
				 (((&PTR_004c8df8->attachedObject)
					 [((lego::globals::g_Level->dimensions).width * y_00 + x_00) * 3] != NULL ||
					((iVar6 = FUN_0040d320(lego::globals::g_Level,x_00,y_00,1), iVar6 != 0 &&
					 (iVar6 = FUN_0040d320(lego::globals::g_Level,param_1,param_2,0), iVar6 == 0)))))) {
				bVar3 = true;
				local_50 = 0;
				local_48 = x_00;
				local_44 = y_00;
			}
			if (bVar3) goto LAB_0040d9a4;
		}
		local_5c += 1;
		local_54 = local_54 + 2;
		if (3 < local_5c) {
			return;
		}
	} while( true );
}



undefined4 __cdecl FUN_0040db50(uint param_1,uint param_2,uint param_3,uint param_4)
{
	bool bVar1;
	uint uVar2;
	uint uVar3;
	float10 fVar4;
	float local_58;
	float local_54;
	float local_50;
	float local_4c;
	undefined4 local_48;
	undefined4 local_44;
	int local_40 [16];
	
	local_40[9] = 2;
	local_40[10] = 2;
	local_40[13] = 0xfffffffe;
	local_40[14] = 0xfffffffe;
	local_40[1] = 1;
	local_40[2] = 1;
	local_40[5] = 0xffffffff;
	local_40[6] = 0xffffffff;
	local_40[8] = 0;
	local_40[11] = 0;
	local_40[12] = 0;
	local_40[15] = 0;
	local_40[0] = 0;
	local_40[3] = 0;
	local_40[4] = 0;
	local_40[7] = 0;
	bVar1 = false;
	uVar2 = 0;
	do {
		if ((param_3 == *(int *)((int)local_40 + uVar2) + param_1) &&
			 (param_4 == param_2 + *(int *)((int)local_40 + uVar2 + 4))) {
			bVar1 = true;
			uVar3 = 1;
			break;
		}
		if ((param_3 == *(int *)((int)local_40 + uVar2 + 0x20) + param_1) &&
			 (param_4 == *(int *)((int)local_40 + uVar2 + 0x24) + param_2)) {
			bVar1 = true;
			uVar3 = 0;
			break;
		}
		uVar2 += 8;
		uVar3 = param_4;
	} while (uVar2 < 0x20);
	if (!bVar1) {
		return 0;
	}
	FUN_0040dcc0(param_1,param_2,param_3,param_4,&local_4c);
	FUN_0044f900(lego::globals::g_Level->surfaceMap,param_1,param_2,&local_58,&local_54);
	fVar4 = lego::game::SurfaceMap_UnkGetZ(lego::globals::g_Level->surfaceMap,local_58,local_54);
	local_50 = (float)fVar4;
	if (uVar3 == 0) {
		FUN_0040c220(1,local_58,local_54,local_50,local_4c,local_48,local_44);
		return 1;
	}
	FUN_0040c220(0,local_58,local_54,local_50,local_4c,local_48,local_44);
	return 1;
}



void __cdecl FUN_0040dcc0(uint param_1,uint param_2,uint param_3,uint param_4,float *param_5)
{
	float10 fVar1;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8 [2];
	
	FUN_0044f900(lego::globals::g_Level->surfaceMap,param_1,param_2,&local_18,&local_14);
	fVar1 = lego::game::SurfaceMap_UnkGetZ(lego::globals::g_Level->surfaceMap,local_18,local_14);
	local_10 = (float)fVar1;
	FUN_0044f900(lego::globals::g_Level->surfaceMap,param_3,param_4,&local_c,local_8);
	fVar1 = lego::game::SurfaceMap_UnkGetZ(lego::globals::g_Level->surfaceMap,local_c,local_8[0]);
	*param_5 = local_c - local_18;
	param_5[1] = local_8[0] - local_14;
	param_5[2] = (float)(fVar1 - (float10)local_10);
	return;
}



undefined4 __cdecl FUN_0040dd70(int **param_1)
{
	VehicleData *pVVar1;
	float fVar2;
	bool bVar3;
	int iVar4;
	uint uVar5;
	int *piVar6;
	uint uVar7;
	uint uVar8;
	float10 fVar9;
	uint local_4c;
	uint local_48;
	float local_44;
	float local_40;
	uint local_3c;
	uint local_38;
	uint local_34;
	Point2F local_30;
	float local_28;
	float local_24;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_20[1] = 1;
	local_20[2] = 1;
	local_c = 0xffffffff;
	local_8 = 0xffffffff;
	local_20[0] = 0;
	local_20[3] = 0;
	local_20[4] = 0;
	local_4 = 0;
	local_44 = 0.0;
	bVar3 = false;
	lego::game::LiveObject_GetPosition((LiveObject *)param_1,(float *)&local_30,&local_30.y);
	lego::game::SurfaceMap_ToBlockCoordinatesNoZ
						(lego::globals::g_Level->surfaceMap,local_30.x,local_30.y,(int *)&local_48,
						 (int *)&local_4c);
	uVar8 = local_48;
	uVar7 = local_4c;
	local_3c = local_48;
	local_38 = local_4c;
	if (((*(byte *)((int)&PTR_004c8df8->position +
								 ((lego::globals::g_Level->dimensions).width * local_4c + local_48) * 0xc + 5) & 1)
			 != 0) && (iVar4 = FUN_0040d320(lego::globals::g_Level,local_48,local_4c,0), iVar4 == 0)) {
		if ((&PTR_004c8df8->attachedObject)
				[((lego::globals::g_Level->dimensions).width * local_4c + local_48) * 3] == NULL) {
			uVar7 = 0;
			piVar6 = local_20 + 1;
			do {
				if (((&PTR_004c8df8->attachedObject)
						 [((lego::globals::g_Level->dimensions).width * (local_4c + *piVar6) +
							piVar6[-1] + local_48) * 3] != NULL) &&
					 (pVVar1 = (&PTR_004c8df8->attachedObject)
										 [((lego::globals::g_Level->dimensions).width * (local_4c + *piVar6) +
											piVar6[-1] + local_48) * 3]->vehicle,
					 (ushort)((ushort)((float)pVVar1 < 0.0) << 8 | (ushort)((float)pVVar1 == 0.0) << 0xe) != 0
					 )) {
					FUN_0044f900(lego::globals::g_Level->surfaceMap,piVar6[-1] + local_48,local_4c + *piVar6,
											 &local_28,&local_24);
					local_40 = local_30.x - local_28;
					fVar2 = SQRT((local_30.y - local_24) * (local_30.y - local_24) + local_40 * local_40);
					if ((fVar2 < local_44) || (local_44 == 0.0)) {
						bVar3 = true;
						local_44 = fVar2;
						local_34 = uVar7;
					}
				}
				uVar7 += 1;
				piVar6 = piVar6 + 2;
			} while (uVar7 < 4);
			uVar7 = local_38;
			uVar8 = local_3c;
			if (bVar3) {
				uVar7 = local_38 + local_20[local_34 * 2 + 1];
				uVar8 = local_3c + local_20[local_34 * 2];
			}
		}
		else {
			pVVar1 = (&PTR_004c8df8->attachedObject)
							 [((lego::globals::g_Level->dimensions).width * local_4c + local_48) * 3]->vehicle;
			if ((ushort)((ushort)((float)pVVar1 < 0.0) << 8 | (ushort)((float)pVVar1 == 0.0) << 0xe) != 0)
			{
				bVar3 = true;
			}
		}
		if (bVar3) {
			FUN_0040dff0((LiveObject *)param_1,&local_30,local_48,local_4c);
			FUN_0040d420(NULL,uVar8,uVar7);
			uVar5 = lego::game::Game_GetWeaponType("FenceSpark");
			fVar9 = FUN_0046f3d0(uVar5);
			(&PTR_004c8df8->attachedObject)
			[((lego::globals::g_Level->dimensions).width * uVar7 + uVar8) * 3]->vehicle =
					 (VehicleData *)(float)fVar9;
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_0040dff0(LiveObject *liveObj,Point2F *param_2,uint param_3,uint param_4)
{
	uint weaponType;
	float10 fVar1;
	float10 fVar2;
	BOOL BVar3;
	float fVar4;
	float *pfVar5;
	float local_2c;
	float local_28;
	float local_24;
	float local_20;
	float local_1c;
	float local_18;
	float local_14;
	float local_c;
	float local_8;
	
	FUN_0044f900(lego::globals::g_Level->surfaceMap,param_3,param_4,&local_24,&local_20);
	fVar1 = lego::game::SurfaceMap_UnkGetZ(lego::globals::g_Level->surfaceMap,local_24,local_20);
	local_1c = (float)fVar1;
	local_c = param_2->x;
	local_8 = param_2->y;
	fVar1 = lego::game::SurfaceMap_UnkGetZ(lego::globals::g_Level->surfaceMap,local_c,local_8);
	fVar2 = lego::game::LiveObject_GetCollHeight(liveObj);
	local_18 = local_c - local_24;
	local_14 = local_8 - local_20;
	FUN_0040c220(0,local_24,local_20,local_1c,local_18,local_14,
							 (float)(((float10)(float)fVar1 - fVar2 * (float10)0.5) - (float10)local_1c));
	pfVar5 = &local_2c;
	local_2c = local_18;
	local_28 = local_14;
	fVar4 = 0.0;
	BVar3 = 1;
	weaponType = lego::game::Game_GetWeaponType("FenceSpark");
	FUN_0046f530(liveObj,weaponType,BVar3,fVar4,pfVar5);
	FUN_004424d0(liveObj);
	return;
}



undefined4 __cdecl FUN_0040e110(undefined4 param_1,int param_2,uint param_3)
{
	uint uVar1;
	int iVar2;
	int iVar3;
	uint uVar4;
	int *piVar5;
	int iVar6;
	int local_20 [4];
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	uVar1 = param_3;
	local_20[1] = 1;
	local_20[2] = 1;
	local_20[0] = 0;
	local_20[3] = 0;
	local_10 = 0;
	local_c = 0xffffffff;
	local_8 = 0xffffffff;
	local_4 = 0;
	if (((PTR_004c8df8 == NULL) ||
			((&PTR_004c8df8->attachedObject)
			 [((lego::globals::g_Level->dimensions).width * param_3 + param_2) * 3] != NULL)) ||
		 (iVar2 = FUN_0040d320(param_1,param_2,param_3,0), iVar2 != 0)) {
		return 0;
	}
	piVar5 = local_20 + 1;
	param_3 = 0;
	do {
		iVar2 = piVar5[-1] + param_2;
		iVar6 = uVar1 + *piVar5;
		if (((&PTR_004c8df8->attachedObject)
				 [((lego::globals::g_Level->dimensions).width * iVar6 + iVar2) * 3] != NULL) ||
			 (iVar3 = FUN_0040d320(param_1,iVar2,iVar6,0), iVar3 != 0)) {
			uVar4 = param_3 - 2 & 3;
			iVar3 = local_20[uVar4 * 2 + 1] + uVar1;
			if (((&PTR_004c8df8->attachedObject)
					 [((lego::globals::g_Level->dimensions).width * iVar3 + local_20[uVar4 * 2] + param_2) * 3
					 ] != NULL) ||
				 ((iVar3 = FUN_0040d320(param_1,local_20[uVar4 * 2] + param_2,iVar3,0), iVar3 != 0 &&
					(iVar2 = FUN_0040d320(param_1,iVar2,iVar6,0), iVar2 == 0)))) {
				return 1;
			}
		}
		piVar5 = piVar5 + 2;
		param_3 += 1;
		if (3 < param_3) {
			return 0;
		}
	} while( true );
}



void __cdecl FUN_0040e280(int param_1,uint param_2,uint param_3,int param_4)
{
	LiveObject *pLVar1;
	float local_8;
	float local_4;
	
	if (PTR_004c8df8 != NULL) {
		if (param_4 == 0) {
			pLVar1 = (LiveObject *)
							 ((Point2I *)
							 ((int)&PTR_004c8df8->position +
							 ((lego::globals::g_Level->dimensions).width * param_3 + param_2) * 0xc))->x;
			if (pLVar1 != NULL) {
				lego::pool::ReservedPool_LiveObject___Release(pLVar1);
				((Point2I *)
				((int)&PTR_004c8df8->position +
				((lego::globals::g_Level->dimensions).width * param_3 + param_2) * 0xc))->x = 0;
				*(undefined4 *)
				 ((int)&PTR_004c8df8->position +
				 ((lego::globals::g_Level->dimensions).width * param_3 + param_2) * 0xc + 4) = 0;
			}
		}
		else {
			if (((Point2I *)
					((int)&PTR_004c8df8->position +
					((lego::globals::g_Level->dimensions).width * param_3 + param_2) * 0xc))->x == 0) {
				FUN_0044f900(*(LevelSurfaceMap **)(param_1 + 4),param_2,param_3,&local_8,&local_4);
				pLVar1 = lego::game::Game_CreateLiveResourceObject
													 (lego::globals::g_Game.RES_ElectricFenceStud,OBJECT_ELECTRICFENCESTUD,0,0
														,local_8,local_4,0.0);
				((Point2I *)
				((int)&PTR_004c8df8->position +
				((lego::globals::g_Level->dimensions).width * param_3 + param_2) * 0xc))->x = (int)pLVar1;
				return;
			}
		}
	}
	return;
}



uint __cdecl FUN_0040e390(int param_1,int param_2)
{
	return (uint)((&PTR_004c8df8->attachedObject)
								[((lego::globals::g_Level->dimensions).width * param_2 + param_1) * 3] != NULL);
}



void __cdecl lego::main::Main_Load_Encyclopedia(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	FileStream *pFVar2;
	uint uVar3;
	FileStream **ppFVar4;
	
	globals::g_Encyclopedia_VehicleTypes_TABLE =
			 (FileStream **)std::malloc(globals::g_Game.VehicleTypes_COUNT * 4);
	ppFVar4 = globals::g_Encyclopedia_VehicleTypes_TABLE;
	for (uVar3 = globals::g_Game.VehicleTypes_COUNT; uVar3 != 0; uVar3 -= 1) {
		*ppFVar4 = NULL;
		ppFVar4 = ppFVar4 + 1;
	}
	uVar3 = 0;
	if (globals::g_Game.VehicleTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Encyclopedia",
																 globals::g_Game.VehicleTypes_TABLE[uVar3],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			if (pcVar1 != NULL) {
				pFVar2 = lego::file::File_Open(pcVar1,"r");
				globals::g_Encyclopedia_VehicleTypes_TABLE[uVar3] = pFVar2;
			}
			uVar3 += 1;
		} while (uVar3 < globals::g_Game.VehicleTypes_COUNT);
	}
	globals::g_Encyclopedia_MiniFigureTypes_TABLE =
			 (FileStream **)std::malloc(globals::g_Game.MiniFigureTypes_COUNT * 4);
	ppFVar4 = globals::g_Encyclopedia_MiniFigureTypes_TABLE;
	for (uVar3 = globals::g_Game.MiniFigureTypes_COUNT; uVar3 != 0; uVar3 -= 1) {
		*ppFVar4 = NULL;
		ppFVar4 = ppFVar4 + 1;
	}
	uVar3 = 0;
	if (globals::g_Game.MiniFigureTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Encyclopedia",
																 globals::g_Game.MiniFigureTypes_TABLE[uVar3],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			if (pcVar1 != NULL) {
				pFVar2 = lego::file::File_Open(pcVar1,"r");
				globals::g_Encyclopedia_MiniFigureTypes_TABLE[uVar3] = pFVar2;
			}
			uVar3 += 1;
		} while (uVar3 < globals::g_Game.MiniFigureTypes_COUNT);
	}
	globals::g_Encyclopedia_RockMonsterTypes_TABLE =
			 (FileStream **)std::malloc(globals::g_Game.RockMonsterTypes_COUNT * 4);
	ppFVar4 = globals::g_Encyclopedia_RockMonsterTypes_TABLE;
	for (uVar3 = globals::g_Game.RockMonsterTypes_COUNT; uVar3 != 0; uVar3 -= 1) {
		*ppFVar4 = NULL;
		ppFVar4 = ppFVar4 + 1;
	}
	uVar3 = 0;
	if (globals::g_Game.RockMonsterTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Encyclopedia",
																 globals::g_Game.RockMonsterTypes_TABLE[uVar3],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			if (pcVar1 != NULL) {
				pFVar2 = lego::file::File_Open(pcVar1,"r");
				globals::g_Encyclopedia_RockMonsterTypes_TABLE[uVar3] = pFVar2;
			}
			uVar3 += 1;
		} while (uVar3 < globals::g_Game.RockMonsterTypes_COUNT);
	}
	globals::g_Encyclopedia_BuildingTypes_TABLE =
			 (FileStream **)std::malloc(globals::g_Game.BuildingTypes_COUNT * 4);
	ppFVar4 = globals::g_Encyclopedia_BuildingTypes_TABLE;
	for (uVar3 = globals::g_Game.BuildingTypes_COUNT; uVar3 != 0; uVar3 -= 1) {
		*ppFVar4 = NULL;
		ppFVar4 = ppFVar4 + 1;
	}
	uVar3 = 0;
	if (globals::g_Game.BuildingTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Encyclopedia",
																 globals::g_Game.BuildingTypes_TABLE[uVar3],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			if (pcVar1 != NULL) {
				pFVar2 = lego::file::File_Open(pcVar1,"r");
				globals::g_Encyclopedia_BuildingTypes_TABLE[uVar3] = pFVar2;
			}
			uVar3 += 1;
		} while (uVar3 < globals::g_Game.BuildingTypes_COUNT);
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Encyclopedia","PowerCrystal",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Encyclopedia_PowerCrystal = lego::file::File_Open(pcVar1,"r");
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Encyclopedia","Ore",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Encyclopedia_Ore = lego::file::File_Open(pcVar1,"r");
	}
	return;
}



void __cdecl FUN_0040e630(undefined4 *param_1)
{
	undefined4 *puVar1;
	int local_4;
	
	puVar1 = param_1;
	lego::game::LiveObject_GetTypeIndex((LiveObject *)param_1,&local_4,(int *)&param_1);
	if (false) {
switchD_0040e655_caseD_5:
		DAT_004c8ea0 = NULL;
		DAT_004c8ea8 = DAT_004c8ea8 & 0xfffffffe;
		return;
	}
	switch(local_4) {
	case 1:
		DAT_004c8ea0 = lego::globals::g_Encyclopedia_VehicleTypes_TABLE[(int)param_1];
		break;
	case 2:
		DAT_004c8ea0 = lego::globals::g_Encyclopedia_MiniFigureTypes_TABLE[(int)param_1];
		break;
	case 3:
		DAT_004c8ea0 = lego::globals::g_Encyclopedia_RockMonsterTypes_TABLE[(int)param_1];
		break;
	case 4:
		DAT_004c8ea0 = lego::globals::g_Encyclopedia_BuildingTypes_TABLE[(int)param_1];
		break;
	default:
		goto switchD_0040e655_caseD_5;
	case 6:
		DAT_004c8ea0 = lego::globals::g_Encyclopedia_PowerCrystal;
		break;
	case 7:
		DAT_004c8ea0 = lego::globals::g_Encyclopedia_Ore;
	}
	DAT_004c8ea8 |= 3;
	PTR_004c8ea4 = (LiveObject *)puVar1;
	FUN_0045a8e0(DAT_005017dc);
	return;
}



void FUN_0040e710(void)
{
	DAT_004c8ea8 = DAT_004c8ea8 & 0xfffffffe;
	return;
}



void __cdecl FUN_0040e720(float param_1)
{
	int iVar1;
	char *pcVar2;
	char local_200 [512];
	
	if (((DAT_004c8ea8 & 1) != 0) && (iVar1 = FUN_0045adf0(0xb), iVar1 == 0)) {
		if ((DAT_004c8ea8 & 2) != 0) {
			if (DAT_004c8ea0 == NULL) {
				FUN_0045a850(DAT_005017dc,"Object has no encyclopedia file.");
			}
			else {
				lego::file::File_Seek(DAT_004c8ea0,0,0);
				pcVar2 = lego::file::File_GetS(local_200,0x200,DAT_004c8ea0);
				while (pcVar2 != NULL) {
					FUN_0045a850(DAT_005017dc,"%s",local_200);
					pcVar2 = lego::file::File_GetS(local_200,0x200,DAT_004c8ea0);
				}
			}
			DAT_004c8ea8 &= 0xfffffffd;
		}
		FUN_0045a870((int **)DAT_005017dc,0,param_1);
	}
	return;
}



void __cdecl FUN_0040e800(int param_1)
{
	if (((((byte)DAT_004c8ea8 & 1) != 0) && ((DAT_0050134c & 2) != 0)) && (PTR_004c8ea4 != NULL)) {
		FUN_004247e0(PTR_004c8ea4,param_1,0.0,1.0,0.0);
	}
	return;
}



void __cdecl FUN_0040e840(LiveObject *liveObj)
{
	if (PTR_004c8ea4 == liveObj) {
		PTR_004c8ea4 = NULL;
	}
	return;
}



void __cdecl lego::game::Game_SetErodeTimes(float triggerTime,float erodeTime,float lockTime)
{
	int iVar1;
	BOOL *pBVar2;
	
	globals::g_ErodeTriggerTime = triggerTime * 25.0;
	globals::g_ErodeErodeTime = erodeTime * 25.0 * 0.2;
	globals::g_ErodeLockTime = lockTime * 25.0;
	globals::g_ErodeUnk_COUNT = 0;
	pBVar2 = globals::g_ErodeUnkBools_TABLE;
	for (iVar1 = 2000; iVar1 != 0; iVar1 += -1) {
		*pBVar2 = 0;
		pBVar2 = pBVar2 + 1;
	}
	pBVar2 = globals::g_ErodeUnkBools2_TABLE;
	for (iVar1 = 1000; iVar1 != 0; iVar1 += -1) {
		*pBVar2 = 0;
		pBVar2 = pBVar2 + 1;
	}
	return;
}



BOOL __cdecl lego::game::Game_GetAvailableErosion__0040e8c0(int *out_index)
{
	BOOL *pBVar1;
	int iVar2;
	
	iVar2 = 0;
	pBVar1 = globals::g_ErodeUnkBools_TABLE;
	do {
		if ((float)*pBVar1 == 0.0) {
			*out_index = iVar2;
			return 1;
		}
		pBVar1 = (BOOL *)((float *)pBVar1 + 1);
		iVar2 += 1;
	} while (pBVar1 < globals::g_ErodeUnkFloats_TABLE);
	return 0;
}



float10 __cdecl FUN_0040e8f0(Point2I *param_1)
{
	return (float10)(6 - (uint)(lego::globals::g_Game.level)->blocks
														 [((lego::globals::g_Game.level)->dimensions).width * param_1->y +
															param_1->x].erodeSpeed) * (float10)lego::globals::g_ErodeErodeTime *
				 (float10)25.0;
}



void __cdecl FUN_0040e940(Point2I *position,int param_2)
{
	LevelData *pLVar1;
	BOOL BVar2;
	float10 fVar3;
	int erodeIndex;
	int local_8;
	undefined4 local_4;
	
	pLVar1 = lego::globals::g_Game.level;
	BVar2 = lego::game::Game_GetAvailableErosion__0040e8c0(&erodeIndex);
	if (BVar2 != 0) {
		pLVar1->blocks[position->y * (pLVar1->dimensions).width + position->x].field_7 = (byte)param_2;
		lego::globals::g_ErodeBlocks_TABLE[erodeIndex].x = position->x;
		lego::globals::g_ErodeBlocks_TABLE[erodeIndex].y = position->y;
		fVar3 = FUN_0040e8f0(position);
		local_8 = param_2 + 1;
		local_4 = 0;
		lego::globals::g_ErodeUnkFloats_TABLE[erodeIndex] = (float)(fVar3 / (float10)local_8);
		lego::globals::g_ErodeUnkBools_TABLE[erodeIndex] = 1;
		FUN_0040ed80(position,1);
	}
	return;
}



void __cdecl lego::game::Game_DoErosionUnk__0040e9e0(float param_1)
{
	float fVar1;
	LevelData *level;
	char cVar2;
	short sVar3;
	BOOL BVar4;
	int iVar5;
	BOOL *pBVar6;
	float *pfVar7;
	uint uVar8;
	Point2I *pPVar9;
	float10 fVar10;
	longlong lVar11;
	longlong lVar12;
	undefined4 uVar13;
	int local_24;
	ErodeState local_20;
	float local_18;
	float local_14;
	float local_10;
	Vector3F local_c;
	
	level = globals::g_Game.level;
	sVar3 = lego::util::randomInt16();
	globals::g_ErosionTimer_Unk = param_1 + globals::g_ErosionTimer_Unk;
	if ((ushort)((ushort)(globals::g_ErosionTimer_Unk < globals::g_ErodeTriggerTime) << 8 |
							(ushort)(globals::g_ErosionTimer_Unk == globals::g_ErodeTriggerTime) << 0xe) == 0) {
		BVar4 = Game_GetAvailableErosion__0040e8c0(&local_24);
		if ((BVar4 != 0) && (uVar8 = 0, globals::g_ErodeUnk_COUNT != 0)) {
			do {
				iVar5 = FUN_0040ef30((int *)(globals::g_ErodeUnkStates2_TABLE +
																		((int)sVar3 + uVar8) % globals::g_ErodeUnk_COUNT),
														 (int *)&local_20);
				if (iVar5 != 0) {
					BVar4 = Level_IsBlockPowerPath((Point2I *)&local_20);
					if ((BVar4 == 0) ||
						 ((*(byte *)&level->blocks
												 [local_20.field_4 * (level->dimensions).width + local_20.field_0].flags2 &
							0x10) != 0)) {
						iVar5 = local_20.field_4 * (level->dimensions).width + local_20.field_0;
						level->blocks[iVar5].flags2 = level->blocks[iVar5].flags2 & 0xffffffef;
						globals::g_ErodeBlocks_TABLE[local_24].x = local_20.field_0;
						globals::g_ErodeBlocks_TABLE[local_24].y = local_20.field_4;
						fVar10 = FUN_0040e8f0(globals::g_ErodeBlocks_TABLE + local_24);
						globals::g_ErodeUnkFloats_TABLE[local_24] = (float)fVar10;
						globals::g_ErodeUnkBools_TABLE[local_24] = 1;
						level->blocks[local_20.field_4 * (level->dimensions).width + local_20.field_0].field_7 =
								 0;
						FUN_0040ed80((Point2I *)&local_20,1);
						Info_FUN_00419ab0(INFO_LAVAERODE,NULL,NULL,(Point2I *)&local_20);
						break;
					}
					Game_ErodeUnk__0040ed30(&local_20);
					iVar5 = local_20.field_4 * (level->dimensions).width + local_20.field_0;
					level->blocks[iVar5].flags2 = level->blocks[iVar5].flags2 | 0x10;
				}
				uVar8 += 1;
			} while (uVar8 < globals::g_ErodeUnk_COUNT);
		}
		globals::g_ErosionTimer_Unk = 0.0;
	}
	pfVar7 = globals::g_ErodeUnkFloats_TABLE;
	pPVar9 = globals::g_ErodeBlocks_TABLE;
	do {
		if (pfVar7[-2000] != 0.0) {
			fVar10 = FUN_0040e8f0(pPVar9);
			lVar11 = __ftol(((float10)*pfVar7 / fVar10) * (float10)4.0);
			*pfVar7 = *pfVar7 - param_1;
			fVar10 = FUN_0040e8f0(pPVar9);
			lVar12 = __ftol(((float10)*pfVar7 / fVar10) * (float10)4.0);
			cVar2 = (char)lVar12;
			if (cVar2 == (char)lVar11) goto LAB_0040ecc3;
			level->blocks[pPVar9->y * (level->dimensions).width + pPVar9->x].field_7 = 4 - cVar2;
			FUN_0044f900(level->surfaceMap,pPVar9->x,pPVar9->y,&local_18,&local_14);
			fVar10 = SurfaceMap_UnkGetZ(level->surfaceMap,local_18,local_14);
			local_10 = (float)fVar10;
			math::Vector3_Random(&local_c);
			local_c.z = 0.0;
			switch(cVar2) {
			case '\0':
				pfVar7[-2000] = 0.0;
				level->blocks[pPVar9->y * (level->dimensions).width + pPVar9->x].terrain = TERRAIN_LAVA;
				uVar13 = 4;
				break;
			case '\x01':
				uVar13 = 5;
				break;
			case '\x02':
				uVar13 = 6;
				break;
			case '\x03':
				uVar13 = 7;
				break;
			default:
				goto switchD_0040ec49_caseD_4;
			}
			FUN_0040cc10(uVar13,&local_18,(undefined4 *)&local_c);
switchD_0040ec49_caseD_4:
			Level_UpdateBlockSurfaceUnk(level,pPVar9->x,pPVar9->y);
		}
LAB_0040ecc3:
		pPVar9 = pPVar9 + 1;
		pfVar7 = pfVar7 + 1;
		if (globals::g_ErodeUnkBools_TABLE <= pPVar9) {
			pBVar6 = globals::g_ErodeUnkBools2_TABLE;
			do {
				if (((float)*pBVar6 != 0.0) &&
					 (fVar1 = ((float *)pBVar6)[-1000], ((float *)pBVar6)[-1000] = fVar1 - param_1,
					 fVar1 - param_1 < 0.0)) {
					*pBVar6 = 0;
				}
				pBVar6 = (BOOL *)((float *)pBVar6 + 1);
			} while (pBVar6 < &globals::g_ErosionTimer_Unk);
			return;
		}
	} while( true );
}



void __cdecl lego::game::Game_ErodeUnk__0040ed30(ErodeState *param_1)
{
	BOOL *pBVar1;
	int iVar2;
	
	iVar2 = 0;
	pBVar1 = globals::g_ErodeUnkBools2_TABLE;
	do {
		if ((float)*pBVar1 == 0.0) {
			globals::g_ErodeUnkStates3_TABLE[iVar2].field_0 = param_1->field_0;
			globals::g_ErodeUnkStates3_TABLE[iVar2].field_4 = param_1->field_4;
			globals::g_ErodeLockTimes_TABLE[iVar2] = globals::g_ErodeLockTime;
			globals::g_ErodeUnkBools2_TABLE[iVar2] = 1;
			return;
		}
		pBVar1 = (BOOL *)((float *)pBVar1 + 1);
		iVar2 += 1;
	} while (pBVar1 < &globals::g_ErosionTimer_Unk);
	return;
}



void __cdecl FUN_0040ed80(Point2I *position,int param_2)
{
	LevelData *pLVar1;
	int iVar2;
	uint uVar3;
	Point2I *pPVar4;
	ErodeState *pEVar5;
	uint uVar6;
	
	pLVar1 = lego::globals::g_Game.level;
	if (param_2 == 0) {
		uVar3 = 0;
		if (lego::globals::g_ErodeUnk_COUNT != 0) {
			pEVar5 = lego::globals::g_ErodeUnkStates2_TABLE;
			do {
				if ((position->x == pEVar5->field_0) && (position->y == pEVar5->field_4)) {
					uVar6 = lego::globals::g_ErodeUnk_COUNT - 1;
					lego::globals::g_ErodeUnk_COUNT = uVar6;
					lego::globals::g_ErodeUnkStates2_TABLE[uVar3].field_0 =
							 lego::globals::g_ErodeUnkStates2_TABLE[uVar6].field_0;
					lego::globals::g_ErodeUnkStates2_TABLE[uVar3].field_4 =
							 lego::globals::g_ErodeUnkStates2_TABLE[uVar6].field_4;
					iVar2 = (pLVar1->dimensions).width * position->y + position->x;
					pLVar1->blocks[iVar2].flags1 = pLVar1->blocks[iVar2].flags1 & ~BLOCK1_UNK_80000000;
					break;
				}
				uVar3 += 1;
				pEVar5 = pEVar5 + 1;
			} while (uVar3 < lego::globals::g_ErodeUnk_COUNT);
		}
		iVar2 = 0;
		pPVar4 = lego::globals::g_ErodeBlocks_TABLE;
		do {
			if ((position->x == pPVar4->x) && (position->y == pPVar4->y)) {
				lego::globals::g_ErodeUnkBools_TABLE[iVar2] = 0;
				break;
			}
			pPVar4 = pPVar4 + 1;
			iVar2 += 1;
		} while (pPVar4 < lego::globals::g_ErodeUnkBools_TABLE);
		lego::game::Game_ErodeUnk__0040ed30((ErodeState *)position);
	}
	else {
		if ((((lego::globals::g_Game.level)->blocks
					[((lego::globals::g_Game.level)->dimensions).width * position->y + position->x].flags1 &
				 BLOCK1_UNK_80000000) == BLOCK1_NONE) && (lego::globals::g_ErodeUnk_COUNT < 2000)) {
			lego::globals::g_ErodeUnkStates2_TABLE[lego::globals::g_ErodeUnk_COUNT].field_0 = position->x;
			lego::globals::g_ErodeUnkStates2_TABLE[lego::globals::g_ErodeUnk_COUNT].field_4 = position->y;
			lego::globals::g_ErodeUnk_COUNT += 1;
			FUN_004301e0(position);
			iVar2 = (pLVar1->dimensions).width * position->y + position->x;
			pLVar1->blocks[iVar2].flags1 = pLVar1->blocks[iVar2].flags1 | BLOCK1_UNK_80000000;
			return;
		}
	}
	return;
}



undefined4 __cdecl FUN_0040eee0(int *param_1)
{
	BOOL *pBVar1;
	ErodeState *pEVar2;
	
	pEVar2 = lego::globals::g_ErodeUnkStates3_TABLE;
	pBVar1 = lego::globals::g_ErodeUnkBools2_TABLE;
	while (((*pBVar1 == 0 || (*param_1 != pEVar2->field_0)) || (param_1[1] != pEVar2->field_4))) {
		pBVar1 = pBVar1 + 1;
		pEVar2 = pEVar2 + 1;
		if ((int *)((int)lego::globals::g_ErodeUnkBools2_TABLE + 3999) < pBVar1) {
			return 0;
		}
	}
	return 1;
}



undefined4 __cdecl FUN_0040ef30(int *param_1,int *param_2)
{
	LevelBlock *pLVar1;
	LevelBlockFlags1 LVar2;
	LevelData *pLVar3;
	int *piVar4;
	int iVar5;
	int *piVar6;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	piVar4 = param_1;
	pLVar3 = lego::globals::g_Game.level;
	local_20[2] = 1;
	local_c = 1;
	local_20[1] = 0xffffffff;
	local_8 = 0xffffffff;
	local_20[3] = 0;
	local_20[4] = 0;
	local_4 = 0;
	if ((lego::globals::g_Game.level)->blocks
			[param_1[1] * ((lego::globals::g_Game.level)->dimensions).width + *param_1].terrain !=
			TERRAIN_LAVA) {
		return 0;
	}
	param_1 = NULL;
	piVar6 = local_20 + 1;
	do {
		iVar5 = *piVar6;
		*param_2 = piVar6[-1] + *piVar4;
		iVar5 = piVar4[1] + iVar5;
		param_2[1] = iVar5;
		pLVar1 = pLVar3->blocks + (pLVar3->dimensions).width * iVar5 + *param_2;
		LVar2 = pLVar1->flags1;
		if ((((LVar2 & BLOCK1_UNK_80000000) == BLOCK1_NONE) && ((LVar2 & BLOCK1_UNK_8) != BLOCK1_NONE))
			 && (pLVar1->erodeSpeed != ERODE_NONE)) {
			iVar5 = FUN_0040eee0(param_2);
			if (iVar5 == 0) {
				return 1;
			}
		}
		piVar6 = piVar6 + 2;
		param_1 = (int *)((int)param_1 + 1);
	} while (param_1 < &DAT_00000004);
	return 0;
}



uint __cdecl FUN_0040f010(float time)
{
	short sVar1;
	LevelSurfaceMap *pLVar2;
	BOOL BVar3;
	uint uVar4;
	uint uVar5;
	Point2I local_8;
	
	pLVar2 = lego::game::GetSurfaceMap();
	FLOAT_004d88c4 = FLOAT_004d88c4 - time;
	uVar5 = (uint)(ushort)((ushort)(FLOAT_004d88c4 < 0.0) << 8 |
												(ushort)(FLOAT_004d88c4 == 0.0) << 0xe);
	uVar4 = (uint)pLVar2 & 0xffff0000 | uVar5;
	if (uVar5 != 0) {
		uVar5 = 0;
		do {
			sVar1 = lego::util::randomInt16();
			local_8.x = (uint)(int)sVar1 % (uint)(pLVar2->smallDimensions).width;
			sVar1 = lego::util::randomInt16();
			local_8.y = (uint)(int)sVar1 % (uint)(pLVar2->smallDimensions).height;
			BVar3 = FUN_0040f0c0(&local_8,1);
			if (BVar3 != 0) {
				lego::game::Info_FUN_00419ab0(INFO_LANDSLIDE,NULL,NULL,&local_8);
				break;
			}
			uVar5 += 1;
		} while (uVar5 < 100);
		sVar1 = lego::util::randomInt16();
		uVar4 = (int)sVar1 / 0x32;
		FLOAT_004d88c4 = (float)((int)sVar1 % 0x32) - -750.0;
	}
	return uVar4;
}



BOOL __cdecl FUN_0040f0c0(Point2I *position,int param_2)
{
	bool bVar1;
	BOOL BVar2;
	uint uVar3;
	uint uVar4;
	int *piVar5;
	uint uVar6;
	int local_30;
	Point2I local_28;
	Point2I locations [4];
	
	uVar6 = 0;
	bVar1 = true;
	uVar4 = 0;
	local_30 = 0;
	lego::game::GetSurfaceMap();
	locations[0].x = 0;
	locations[0].y = -1;
	locations[1].x = 1;
	locations[1].y = 0;
	locations[2].x = 0;
	locations[2].y = 1;
	locations[3].x = -1;
	locations[3].y = 0;
	BVar2 = lego::game::Level_UpdateFallinsUnk1(position);
	if (BVar2 != 0) {
		piVar5 = &locations[0].y;
		do {
			local_28.x = piVar5[-1] + position->x;
			local_28.y = *piVar5 + position->y;
			BVar2 = lego::game::Level_GetBlockFlags1_10Not8(local_28.x,local_28.y);
			if (BVar2 != 0) {
				uVar3 = lego::game::Level_IsBlockSolid(&local_28);
				if (uVar3 == 0) {
					BVar2 = lego::game::Level_GetBlockFlags1_20(local_28.x,local_28.y);
					if (BVar2 != 0) goto LAB_0040f164;
				}
				else {
LAB_0040f164:
					bVar1 = false;
				}
				uVar4 |= 1 << ((byte)uVar6 & 0x1f);
				BVar2 = lego::game::Level_GetBlockFlags1_c0(local_28.x,local_28.y);
				if (BVar2 == 0) {
					local_30 += 1;
				}
			}
			uVar6 += 1;
			piVar5 = piVar5 + 2;
		} while (uVar6 < 4);
		if (((bVar1) && (uVar4 != 0)) && (local_30 != 0)) {
			FUN_0040f260(position,uVar4,param_2);
			return 1;
		}
	}
	return 0;
}



BOOL __cdecl lego::game::Level_UpdateFallinsUnk1(Point2I *position)
{
	TerrainType TVar1;
	BOOL BVar2;
	uint uVar3;
	LevelData *level;
	
	level = globals::g_Game.level;
	BVar2 = Level_GetBlockFlags1_8(position->x,position->y);
	if ((((BVar2 != 0) && (uVar3 = Level_GetBlockFlags1_8000000(position), uVar3 == 0)) &&
			(TVar1 = level->blocks[(level->dimensions).width * position->y + position->x].terrain,
			TVar1 != TERRAIN_LAVA)) && ((TVar1 != TERRAIN_LAKE && (TVar1 != TERRAIN_WATER_unused)))) {
		if ((level->SafeCaverns != BOOL3_FALSE) && (BVar2 = Level_IsBlockExposed(position), BVar2 != 0))
		{
			return 0;
		}
		return 1;
	}
	return 0;
}



void __cdecl FUN_0040f260(Point2I *param_1,undefined4 param_2,int param_3)
{
	Point2I *position;
	undefined4 uVar1;
	uint uVar2;
	Point2I *pPVar3;
	BOOL BVar4;
	int iVar5;
	Point2I *pPVar6;
	float10 fVar7;
	undefined4 uVar8;
	undefined4 uVar9;
	float local_30;
	Vector3F local_2c;
	undefined4 local_20 [4];
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	position = param_1;
	local_20[0] = 0;
	local_20[1] = 0x3f800000;
	local_20[2] = 0x3f800000;
	local_20[3] = 0;
	local_10 = 0;
	local_c = 0xbf800000;
	local_8 = 0xbf800000;
	local_4 = 0;
	uVar2 = FUN_00432bc0(param_1);
	while (uVar2 == 0) {
		uVar2 = FUN_00432bc0(position);
	}
	FUN_00430250(position,0x2f);
	uVar1 = param_2;
	pPVar3 = param_1;
	pPVar6 = param_1;
	switch(param_2) {
	case 1:
	case 0xe:
		pPVar3 = NULL;
		pPVar6 = NULL;
		break;
	case 2:
	case 10:
	case 0xd:
		pPVar3 = (Point2I *)0x1;
		pPVar6 = NULL;
		break;
	case 3:
		pPVar3 = (Point2I *)0x1;
		pPVar6 = (Point2I *)0x1;
		break;
	case 4:
	case 5:
	case 0xb:
		pPVar3 = (Point2I *)0x2;
		pPVar6 = NULL;
		break;
	case 6:
		pPVar3 = (Point2I *)0x2;
		pPVar6 = (Point2I *)0x1;
		break;
	case 7:
	case 8:
		pPVar3 = (Point2I *)0x3;
		pPVar6 = NULL;
		break;
	case 9:
		pPVar3 = NULL;
		pPVar6 = (Point2I *)0x1;
		break;
	case 0xc:
		pPVar3 = (Point2I *)0x3;
		pPVar6 = (Point2I *)0x1;
	}
	FUN_0044f900((lego::globals::g_Game.level)->surfaceMap,position->x,position->y,&local_30,
							 (float *)&param_1);
	uVar9 = local_20[(int)pPVar3 * 2 + 1];
	uVar8 = local_20[(int)pPVar3 * 2];
	fVar7 = lego::game::SurfaceMap_UnkGetZ
										((lego::globals::g_Game.level)->surfaceMap,local_30,(float)param_1);
	BVar4 = FUN_0040c160((int)pPVar6,position->x,position->y,local_30,param_1,(float)fVar7,uVar8,uVar9
											);
	if (BVar4 != 0) {
		local_2c.y = (float)param_1;
		local_2c.x = local_30;
		fVar7 = lego::game::SurfaceMap_UnkGetZ
											((lego::globals::g_Game.level)->surfaceMap,local_30,(float)param_1);
		local_2c.z = (float)fVar7;
		iVar5 = ((lego::globals::g_Game.level)->dimensions).width * position->y + position->x;
		(lego::globals::g_Game.level)->blocks[iVar5].flags1 =
				 (lego::globals::g_Game.level)->blocks[iVar5].flags1 | BLOCK1_UNK_800;
		iVar5 = ((lego::globals::g_Game.level)->dimensions).width * position->y + position->x;
		(lego::globals::g_Game.level)->blocks[iVar5].flags1 =
				 (lego::globals::g_Game.level)->blocks[iVar5].flags1 | BLOCK1_UNK_1000;
		lego::game::Level_SetBlockFlags1_8000000(position,1);
		lego::res::Res_PlayResourceSound(NULL,0x28,0,0,&local_2c);
	}
	if ((param_3 != 0) &&
		 (iVar5 = ((lego::globals::g_Game.level)->dimensions).width * position->y + position->x,
		 (lego::globals::g_Game.level)->blocks[iVar5].numLandSlides =
					(lego::globals::g_Game.level)->blocks[iVar5].numLandSlides + 1,
		 (uint)lego::globals::g_NumberOfLandSlidesTillCaveIn <=
		 (lego::globals::g_Game.level)->blocks
		 [((lego::globals::g_Game.level)->dimensions).width * position->y + position->x].numLandSlides))
	{
		lego::game::Game_LandSlideDoCavein(position,uVar1);
		lego::game::Info_FUN_00419ab0(INFO_LANDSLIDE,NULL,NULL,position);
	}
	lego::game::Level_UpdateBlockSurfaceUnk(lego::globals::g_Game.level,position->x,position->y);
	return;
}



void __cdecl lego::game::Game_SetNumberOfLandSlidesTillCaveIn(int numLandSlides)
{
	globals::g_NumberOfLandSlidesTillCaveIn = numLandSlides;
	return;
}



void __cdecl lego::game::Game_LandSlideDoCavein(Point2I *position,undefined4 param_2)
{
	uint uVar1;
	BOOL BVar2;
	int iVar3;
	int *piVar4;
	Point2I current;
	Point2I locations [8];
	
	locations[0].x = 0;
	locations[0].y = 1;
	locations[1].x = 1;
	locations[1].y = 1;
	locations[2].x = 1;
	locations[2].y = 0;
	locations[3].x = 1;
	locations[3].y = -1;
	locations[4].x = 0;
	locations[4].y = -1;
	locations[5].x = -1;
	locations[5].y = -1;
	locations[6].x = -1;
	locations[6].y = 0;
	locations[7].x = -1;
	locations[7].y = 1;
	piVar4 = &locations[0].y;
	iVar3 = 8;
	do {
		current.x = piVar4[-1] + position->x;
		current.y = position->y + *piVar4;
		uVar1 = FUN_00450580((globals::g_Game.level)->surfaceMap,current.x,current.y);
		if (uVar1 != 0) {
			BVar2 = FUN_0040f0c0(&current,0);
			if (BVar2 == 0) {
				BVar2 = Level_UpdateFallinsUnk1(&current);
				if (BVar2 != 0) {
					FUN_0040f260(&current,param_2,0);
				}
			}
		}
		piVar4 = piVar4 + 2;
		iVar3 += -1;
	} while (iVar3 != 0);
	return;
}



FlockSubdata * __cdecl
lego::game::LiveObject_FlocksAllocSubdata
					(Vector3F *vector_1,Vector3F *vector_2,float turn,float speed,float tightness,
					float goalUpdate,ResourceData *resData)
{
	FlockSubdata *pFVar1;
	
	pFVar1 = (FlockSubdata *)std::malloc(0xa0);
	if (pFVar1 == NULL) {
		return NULL;
	}
	pFVar1->float_30 = 0.0;
	pFVar1->float_2c = 0.0;
	pFVar1->float_28 = 0.0;
	pFVar1->float_24 = 0.0;
	(pFVar1->vector_18).y = 0.0;
	(pFVar1->vector_18).x = 0.0;
	(pFVar1->vector_18).z = 1.0;
	if (vector_2 == NULL) {
		(pFVar1->vector_0).x = 0.0;
		(pFVar1->vector_0).y = 0.0;
		(pFVar1->vector_0).z = 0.0;
	}
	else {
		(pFVar1->vector_0).x = vector_2->x;
		(pFVar1->vector_0).y = vector_2->y;
		(pFVar1->vector_0).z = vector_2->z;
	}
	if (vector_1 == NULL) {
		(pFVar1->vector_c).x = 0.0;
		(pFVar1->vector_c).y = 0.0;
		(pFVar1->vector_c).z = 0.0;
	}
	else {
		(pFVar1->vector_c).x = vector_1->x;
		(pFVar1->vector_c).y = vector_1->y;
		(pFVar1->vector_c).z = vector_1->z;
	}
	pFVar1->field_34 = 0;
	pFVar1->Turn2 = turn;
	pFVar1->Turn1 = turn;
	pFVar1->Speed2 = speed;
	pFVar1->Speed1 = speed;
	pFVar1->Tightness2 = tightness;
	pFVar1->Tightness1 = tightness;
	pFVar1->GoalUpdate2 = goalUpdate;
	pFVar1->GoalUpdate1 = goalUpdate;
	pFVar1->resData_98 = resData;
	return pFVar1;
}



void __cdecl lego::unk::Lego_UnkRecurseFreeItem__0040f6e0(undefined *param_1)
{
	if (param_1 != NULL) {
		std::free(param_1);
	}
	return;
}



FlockData * __cdecl
lego::game::LiveObject_FlocksAllocData
					(Vector3F *vector_1,Vector3F *vector_2,float turn,float speed,float tightness,
					ResourceData *resData)
{
	FlockData *pFVar1;
	FlockSubdata *pFVar2;
	
	pFVar1 = (FlockData *)std::malloc(0x28);
	if (pFVar1 == NULL) {
		return NULL;
	}
	pFVar2 = LiveObject_FlocksAllocSubdata(vector_1,vector_2,turn,speed,tightness,0.0,resData);
	pFVar1->flocksSubdata1 = pFVar2;
	if (vector_1 == NULL) {
		pFVar1->hasVector1 = 0;
	}
	else {
		pFVar1->hasVector1 = 1;
	}
	if (vector_2 != NULL) {
		pFVar1->hasVector2 = 1;
		pFVar1->flocksSubdata2 = NULL;
		pFVar1->numSubdata = 0;
		return pFVar1;
	}
	pFVar1->hasVector2 = 0;
	pFVar1->flocksSubdata2 = NULL;
	pFVar1->numSubdata = 0;
	return pFVar1;
}



void __cdecl lego::unk::Lego_UnkRecurseFree__0040f780(undefined4 *param_1)
{
	undefined4 *puVar1;
	
	puVar1 = Lego_UnkRecurseFreeDoSomething__0040fd90(param_1);
	while (puVar1 != NULL) {
		Lego_UnkRecurseFreeItem__0040f6e0((undefined *)puVar1);
		puVar1 = Lego_UnkRecurseFreeDoSomething__0040fd90(param_1);
	}
	Lego_UnkRecurseFreeItem__0040f6e0((undefined *)*param_1);
	std::free(param_1);
	return;
}



void __cdecl lego::game::Flocks_FUN_0040f7c0(FlockSubdata *flockSubdata,Vector3F *vector)
{
	float fVar1;
	
	if ((ushort)((ushort)(vector->y < 1.0) << 8 | (ushort)(vector->y == 1.0) << 0xe) == 0) {
		fVar1 = flockSubdata->Turn1 + flockSubdata->float_28;
		flockSubdata->float_28 = fVar1;
		if ((ushort)((ushort)(fVar1 < 0.8) << 8 | (ushort)(fVar1 == 0.8) << 0xe) == 0) {
			flockSubdata->float_28 = 0.8;
			return;
		}
	}
	else {
		if (-1.0 <= vector->y) {
			flockSubdata->float_28 = flockSubdata->float_28 * 0.95;
			return;
		}
		fVar1 = flockSubdata->float_28 - flockSubdata->Turn1;
		flockSubdata->float_28 = fVar1;
		if (fVar1 < -0.8) {
			flockSubdata->float_28 = -0.8;
			return;
		}
	}
	return;
}



void __cdecl lego::game::Flocks_FUN_0040f850(FlockSubdata *flockSubdata,Vector3F *ref_vector)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	float fVar6;
	float fVar7;
	float fVar8;
	float fVar9;
	float fVar10;
	
	ref_vector->y = 0.0;
	(flockSubdata->vector_18).y = 0.0;
	fVar1 = (flockSubdata->vector_18).x;
	fVar7 = (flockSubdata->vector_18).z;
	fVar1 = 1.0 / SQRT(fVar1 * fVar1 + fVar7 * fVar7 + 0.0);
	(flockSubdata->vector_18).x = fVar1 * (flockSubdata->vector_18).x;
	(flockSubdata->vector_18).y = fVar1 * (flockSubdata->vector_18).y;
	(flockSubdata->vector_18).z = fVar1 * (flockSubdata->vector_18).z;
	fVar8 = 1.0 / SQRT(ref_vector->x * ref_vector->x +
										 ref_vector->z * ref_vector->z + ref_vector->y * ref_vector->y);
	fVar10 = fVar8 * ref_vector->x;
	fVar9 = fVar8 * ref_vector->y;
	fVar8 = fVar8 * ref_vector->z;
	ref_vector->x = fVar10;
	ref_vector->y = fVar9;
	ref_vector->z = fVar8;
	fVar1 = (flockSubdata->vector_18).z;
	fVar7 = (flockSubdata->vector_18).y;
	fVar2 = (flockSubdata->vector_18).x;
	fVar3 = (flockSubdata->vector_18).x;
	fVar4 = (flockSubdata->vector_18).x;
	fVar5 = (flockSubdata->vector_18).z;
	fVar6 = (flockSubdata->vector_18).y;
	ref_vector->x = fVar9 * (flockSubdata->vector_18).z - fVar8 * (flockSubdata->vector_18).y;
	ref_vector->y = fVar3 * fVar8 - fVar10 * fVar5;
	ref_vector->z = fVar10 * fVar6 - fVar4 * fVar9;
	fVar1 = (1.0 - (fVar2 * fVar10 + fVar1 * fVar8 + fVar7 * fVar9)) * flockSubdata->Turn1 * 10.0 *
					0.5;
	if ((ushort)((ushort)(ref_vector->y < 0.01) << 8 | (ushort)(ref_vector->y == 0.01) << 0xe) == 0) {
		fVar1 = flockSubdata->float_30 * 9.0 + fVar1;
	}
	else {
		if (0.01 <= ref_vector->y) goto LAB_0040fa04;
		fVar1 = flockSubdata->float_30 * 9.0 - fVar1;
	}
	flockSubdata->float_30 = fVar1 * 0.1;
LAB_0040fa04:
	flockSubdata->float_24 = flockSubdata->float_24 + flockSubdata->float_30;
	flockSubdata->float_2c = -(flockSubdata->float_30 * 9.0);
	return;
}



void __cdecl lego::game::Flocks_FUN_0040fa30(FlockSubdata *flockSubdata)
{
	float local_100 [16];
	float local_c0 [16];
	float local_80 [16];
	float local_40 [16];
	
	math::FlocksMatrix_FUN_0047a010(local_80,flockSubdata->float_28);
	math::FlocksMatrix_FUN_0047a060(local_100,flockSubdata->float_24);
	math::FlocksMatrix_FUN_0047a0b0(local_c0,flockSubdata->float_2c);
	math::FlocksMatrix_FUN_00479fa0(local_40,local_100,local_80);
	math::FlocksMatrix_FUN_00479fa0(flockSubdata->matrix,local_40,local_c0);
	return;
}



void __cdecl
lego::game::Flocks_FUN_0040fac0(undefined4 param_1,FlockSubdata *flockSubdata,float *param_3)
{
	Vector3F *vector;
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	Vector3F vector_b;
	Vector3F vector_a;
	float matrix_b [16];
	float matrix_a [16];
	
	vector_b.x = (flockSubdata->vector_0).x - (flockSubdata->vector_c).x;
	vector_b.y = (flockSubdata->vector_0).y - (flockSubdata->vector_c).y;
	vector = &flockSubdata->vector_c;
	fVar2 = *param_3;
	vector_b.z = (flockSubdata->vector_0).z - (flockSubdata->vector_c).z;
	if (SQRT(vector_b.z * vector_b.z + vector_b.y * vector_b.y + vector_b.x * vector_b.x) < 1e-05) {
		math::Vector3_Random(&vector_b);
	}
	Flocks_FUN_0040f7c0(flockSubdata,&vector_b);
	Flocks_FUN_0040f850(flockSubdata,&vector_b);
	Flocks_FUN_0040fa30(flockSubdata);
	fVar1 = flockSubdata->Speed1;
	fVar3 = flockSubdata->matrix[9];
	fVar4 = flockSubdata->matrix[10];
	(flockSubdata->vector_18).x = flockSubdata->matrix[8];
	fVar1 = fVar1 * fVar2;
	(flockSubdata->vector_18).y = fVar3;
	(flockSubdata->vector_18).z = fVar4;
	fVar2 = (flockSubdata->vector_18).y;
	fVar3 = (flockSubdata->vector_18).z;
	vector->x = (flockSubdata->vector_18).x * fVar1 + vector->x;
	(flockSubdata->vector_c).y = (flockSubdata->vector_c).y + fVar2 * fVar1;
	(flockSubdata->vector_c).z = (flockSubdata->vector_c).z + fVar3 * fVar1;
	math::FlocksMatrix_FUN_0047a100(matrix_a,vector);
	math::FlocksMatrix_FUN_0047a170(matrix_b,flockSubdata->matrix);
	math::FlocksMatrix_FUN_00479fa0(flockSubdata->matrix,matrix_a,matrix_b);
	return;
}



// out_vector = random_vector() * { x, y, z }

void __cdecl lego::math::Vector3_RandomMultiply(Vector3F *out_vector,float x,float y,float z)
{
	if (out_vector != NULL) {
		Vector3_Random(out_vector);
		out_vector->x = x * out_vector->x;
		out_vector->y = y * out_vector->y;
		out_vector->z = z * out_vector->z;
	}
	return;
}



void __cdecl lego::game::Flocks_FUN_0040fc30(int *param_1,float *param_2,float *param_3)
{
	float fVar1;
	float x;
	int iVar2;
	float10 extraout_ST0;
	float10 fVar3;
	longlong lVar4;
	longlong lVar5;
	Vector3F local_c;
	
	fVar1 = param_2[0xd];
	lVar4 = __ftol((float10)param_2[0xd] / (float10)param_2[0xe]);
	fVar3 = extraout_ST0;
	if (extraout_ST0 == (float10)0.0) {
		fVar3 = (float10)0.001;
	}
	fVar1 = (float)((float10)1.0 / fVar3 + (float10)fVar1);
	lVar5 = __ftol((float10)fVar1 / (float10)param_2[0xe]);
	if ((int)lVar5 != (int)lVar4 && -1 < (int)lVar5 - (int)lVar4) {
		x = param_2[0x11];
		math::Vector3_RandomMultiply(&local_c,x,x,x);
		iVar2 = *param_1;
		*param_2 = *(float *)(iVar2 + 0xc) + local_c.x;
		param_2[1] = *(float *)(iVar2 + 0x10) + local_c.y;
		param_2[2] = *(float *)(iVar2 + 0x14) + local_c.z;
	}
	param_2[0xd] = fVar1;
	return;
}



void __cdecl FUN_0040fce0(int *param_1,undefined4 *param_2)
{
	undefined4 *puVar1;
	
	puVar1 = (undefined4 *)*param_1;
	*puVar1 = *param_2;
	puVar1[1] = param_2[1];
	puVar1[2] = param_2[2];
	param_1[4] = 1;
	return;
}



void __cdecl lego::game::Flocks_FUN_0040fd10(FlockSubdata *flockSubdata,float param_2)
{
	Flocks_FUN_0040fac0(0,flockSubdata,&param_2);
	return;
}



void __cdecl lego::game::Flocks_FUN_0040fd30(FlockData *flockData,undefined4 param_2)
{
	Flocks_FUN_0040fd10(flockData->flocksSubdata1,param_2);
	Flocks_CallbackForAllSubdata(flockData,Flocks_FUN_0040fac0,&param_2);
	Flocks_CallbackForAllSubdata(flockData,Flocks_FUN_0040fc30,&param_2);
	return;
}



void __cdecl
lego::game::LiveObject_FlocksAddSubdata(FlockData *flockData,FlockSubdata *flockSubdata)
{
	if ((flockData != NULL) && (flockSubdata != NULL)) {
		flockSubdata->subdataNext_9c = flockData->flocksSubdata2;
		flockData->flocksSubdata2 = flockSubdata;
		flockData->numSubdata = flockData->numSubdata + 1;
	}
	return;
}



undefined4 * __cdecl lego::unk::Lego_UnkRecurseFreeDoSomething__0040fd90(undefined4 *param_1)
{
	undefined4 *puVar1;
	undefined4 uVar2;
	
	if ((param_1 != NULL) && (param_1[2] != 0)) {
		puVar1 = (undefined4 *)param_1[1];
		uVar2 = puVar1[0x27];
		param_1[2] = param_1[2] + -1;
		param_1[1] = uVar2;
		return puVar1;
	}
	return NULL;
}



void __cdecl
lego::game::Flocks_CallbackForAllSubdata
					(FlockData *flockData,FlocksCallback *callback,void *context)
{
	FlockSubdata *subdata;
	
	for (subdata = flockData->flocksSubdata2; subdata != NULL; subdata = subdata->subdataNext_9c) {
		(*callback)(flockData,subdata,context);
	}
	return;
}



float10 __cdecl lego::game::Game_RandomFloat_0_1(void)
{
	float10 fVar1;
	
	fVar1 = Game_ChooseRandomRange(0.0,1.0);
	return fVar1;
}



void __cdecl FUN_0040fe00(undefined4 param_1,int param_2,float *param_3)
{
	float fVar1;
	float fVar2;
	float10 fVar3;
	
	fVar2 = *param_3;
	fVar3 = lego::game::Game_RandomFloat_0_1();
	fVar2 = 1.0 / fVar2;
	fVar1 = (float)((fVar3 + fVar3) - (float10)1.0);
	*(float *)(param_2 + 0x3c) =
			 fVar2 * fVar1 * *(float *)(param_2 + 0x4c) + *(float *)(param_2 + 0x4c);
	*(float *)(param_2 + 0x44) =
			 fVar2 * fVar1 * *(float *)(param_2 + 0x54) + *(float *)(param_2 + 0x54);
	*(float *)(param_2 + 0x38) =
			 fVar2 * fVar1 * *(float *)(param_2 + 0x48) + *(float *)(param_2 + 0x48);
	return;
}



void __cdecl FUN_0040fe80(int param_1,undefined4 param_2)
{
	lego::game::Flocks_CallbackForAllSubdata((FlockData *)param_1,FUN_0040fe00,&param_2);
	return;
}



void __cdecl
lego::game::Flocks_SetParameters1(FlockData *param_1,float turn,float speed,float tightness)
{
	param_1->flocksSubdata1->Turn1 = turn;
	param_1->flocksSubdata1->Speed1 = speed;
	param_1->flocksSubdata1->Tightness1 = tightness;
	return;
}



void __cdecl lego::game::Flocks_SetParametersFromGlobals(undefined4 param_1,FlockSubdata *param_2)
{
	param_2->Turn2 = globals::g_Flocks_Turn;
	param_2->Turn1 = globals::g_Flocks_Turn;
	param_2->Speed2 = globals::g_Flocks_Speed;
	param_2->Speed1 = globals::g_Flocks_Speed;
	param_2->Tightness2 = globals::g_Flocks_Tightness;
	param_2->Tightness1 = globals::g_Flocks_Tightness;
	param_2->GoalUpdate2 = globals::g_Flocks_GoalUpdate;
	param_2->GoalUpdate1 = globals::g_Flocks_GoalUpdate;
	return;
}



void __cdecl
FUN_0040ff10(FlockData *flockData,float param_2,float param_3,float param_4,float param_5)
{
	lego::globals::g_Flocks_Speed = param_3;
	lego::globals::g_Flocks_Turn = param_2;
	lego::globals::g_Flocks_Tightness = param_4;
	lego::globals::g_Flocks_GoalUpdate = param_5;
	lego::game::Flocks_CallbackForAllSubdata
						(flockData,lego::game::Flocks_SetParametersFromGlobals,NULL);
	return;
}



void __cdecl FUN_0040ff50(int *param_1,undefined4 *param_2)
{
	int iVar1;
	
	if ((param_1 != NULL) && (param_2 != NULL)) {
		param_1[3] = 1;
		iVar1 = *param_1;
		*(undefined4 *)(iVar1 + 0xc) = *param_2;
		*(undefined4 *)(iVar1 + 0x10) = param_2[1];
		*(undefined4 *)(iVar1 + 0x14) = param_2[2];
	}
	return;
}



void __cdecl FUN_0040ff80(undefined4 param_1,int param_2,undefined4 *param_3)
{
	*(undefined4 *)(param_2 + 0xc) = *param_3;
	*(undefined4 *)(param_2 + 0x10) = param_3[1];
	*(undefined4 *)(param_2 + 0x14) = param_3[2];
	return;
}



void __cdecl FUN_0040ffa0(int param_1,void *param_2)
{
	lego::game::Flocks_CallbackForAllSubdata((FlockData *)param_1,FUN_0040ff80,param_2);
	return;
}



void __cdecl FUN_0040ffc0(undefined4 param_1,undefined4 *param_2,undefined4 *param_3)
{
	*param_2 = *param_3;
	param_2[1] = param_3[1];
	param_2[2] = param_3[2];
	return;
}



void __cdecl FUN_0040ffe0(int param_1,void *param_2)
{
	lego::game::Flocks_CallbackForAllSubdata((FlockData *)param_1,FUN_0040ffc0,param_2);
	return;
}



void __cdecl FUN_00410000(undefined4 param_1,float *param_2,float *param_3)
{
	float *pfVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	float fVar6;
	float fVar7;
	float fVar8;
	float fVar9;
	float fVar10;
	float fVar11;
	float fVar12;
	
	fVar2 = *param_3;
	pfVar1 = param_2 + 3;
	fVar3 = *param_2;
	fVar4 = *pfVar1;
	fVar5 = param_2[1];
	fVar6 = param_2[4];
	fVar7 = param_2[5];
	fVar8 = param_2[2];
	lego::game::Flocks_FUN_0040fac0(param_1,(FlockSubdata *)param_2,param_3);
	fVar11 = fVar3 - fVar4;
	fVar9 = fVar5 - fVar6;
	fVar12 = fVar8 - fVar7;
	fVar2 = param_2[0x10] * fVar2;
	fVar10 = SQRT(fVar12 * fVar12 + fVar9 * fVar9 + fVar11 * fVar11);
	if (fVar2 <= fVar10) {
		fVar10 = 1.0 / fVar10;
		*pfVar1 = fVar10 * fVar11 * fVar2 + fVar4;
		param_2[4] = fVar10 * fVar9 * fVar2 + fVar6;
		param_2[5] = fVar10 * fVar12 * fVar2 + fVar7;
	}
	else {
		*pfVar1 = *param_2;
		param_2[4] = param_2[1];
		param_2[5] = param_2[2];
	}
	*param_2 = fVar3;
	param_2[0x22] = *pfVar1;
	param_2[0x24] = param_2[5];
	param_2[1] = fVar5;
	param_2[2] = fVar8;
	param_2[0x23] = param_2[4];
	return;
}



void __cdecl FUN_00410160(undefined4 param_1,float *param_2,undefined4 *param_3)
{
	if (((param_2[3] == *param_2) && (param_2[4] == param_2[1])) && (param_2[5] == param_2[2])) {
		lego::res::Res_UnkSetup3DFrameTransform((ResourceData *)param_2[0x26],1);
		return;
	}
	*param_3 = 0;
	return;
}



undefined4 __cdecl FUN_004101b0(int param_1)
{
	undefined4 local_4;
	
	local_4 = 1;
	lego::game::Flocks_CallbackForAllSubdata((FlockData *)param_1,FUN_00410160,&local_4);
	return local_4;
}



char * __cdecl lego::util::replaceTextSpaces(char *str)
{
	char cVar1;
	uint uVar2;
	uint uVar3;
	undefined4 *puVar4;
	char *pcVar5;
	undefined4 *puVar6;
	
	uVar2 = 0xffffffff;
	pcVar5 = str;
	do {
		if (uVar2 == 0) break;
		uVar2 -= 1;
		cVar1 = *pcVar5;
		pcVar5 = pcVar5 + 1;
	} while (cVar1 != '\0');
	if (0xff < ~uVar2 - 1) {
		return str;
	}
	uVar2 = 0xffffffff;
	do {
		pcVar5 = str;
		if (uVar2 == 0) break;
		uVar2 -= 1;
		pcVar5 = str + 1;
		cVar1 = *str;
		str = pcVar5;
	} while (cVar1 != '\0');
	uVar2 = ~uVar2;
	puVar4 = (undefined4 *)(pcVar5 + -uVar2);
	puVar6 = (undefined4 *)CHAR_ARRAY_004dc748;
	for (uVar3 = uVar2 >> 2; uVar3 != 0; uVar3 -= 1) {
		*puVar6 = *puVar4;
		puVar4 = puVar4 + 1;
		puVar6 = puVar6 + 1;
	}
	uVar3 = 0;
	for (uVar2 &= 3; uVar2 != 0; uVar2 -= 1) {
		*(undefined *)puVar6 = *(undefined *)puVar4;
		puVar4 = (undefined4 *)((int)puVar4 + 1);
		puVar6 = (undefined4 *)((int)puVar6 + 1);
	}
	do {
		if (CHAR_ARRAY_004dc748[uVar3] == '_') {
			CHAR_ARRAY_004dc748[uVar3] = ' ';
		}
		uVar3 += 1;
	} while (uVar3 < 0x100);
	return CHAR_ARRAY_004dc748;
}



void __cdecl
FUN_00410250(undefined4 param_1,undefined4 param_2,undefined4 param_3,byte *param_4,...)
{
	ImageFont **ppIVar1;
	uint uVar2;
	char *format;
	
	if (param_4 == NULL) {
		uVar2 = 0;
		if (DAT_004dc8d0 != 0) {
			ppIVar1 = (ImageFont **)&DAT_004d8b08;
			format = &DAT_004d8b48;
			do {
				FUN_0047a440(*ppIVar1,(&DAT_004d88c8)[uVar2],(&DAT_004dc850)[uVar2],format);
				uVar2 += 1;
				format = format + 0x400;
				ppIVar1 = ppIVar1 + 1;
			} while (uVar2 < DAT_004dc8d0);
		}
		DAT_004dc8d0 = 0;
		return;
	}
	if (DAT_004dc8d0 < 0xf) {
		std::vsprintf(&DAT_004d8b48 + DAT_004dc8d0 * 0x400,(char *)param_4,&stack0x00000014);
		(&DAT_004d88c8)[DAT_004dc8d0] = param_2;
		(&DAT_004dc850)[DAT_004dc8d0] = param_3;
		(&DAT_004d8b08)[DAT_004dc8d0] = param_1;
		DAT_004dc8d0 += 1;
	}
	return;
}



void __cdecl lego::main::Main_ShowCredits(void)
{
	Main_ShowCreditsFiles
						(globals::g_Game.CreditsTextFile,globals::g_Game.bmpRSFont,
						 globals::g_Game.CreditsBackAVI);
	return;
}



void __cdecl FUN_00410320(void)
{
	DWORD DVar1;
	
	if (lego::globals::g_MenuWipeResource != NULL) {
		FLOAT_005584f4 = 0.0;
		DAT_005584f0 = DAT_005584f0 & 0xffffff00 | DAT_005584f0 & 0xff | 1 | 2;
		DVar1 = timeGetTime();
		FLOAT_005584f8 = (float)(ulonglong)DVar1;
		lego::snd::Audio_AddToSoundQueue1(0x27,0);
	}
	return;
}



void __cdecl FUN_00410370(void)
{
	DAT_005584f0 = DAT_005584f0 & 0xfffffffc;
	return;
}



char ** __cdecl FUN_00410380(char *param_1)
{
	char **ppcVar1;
	int iVar2;
	char **ppcVar3;
	
	ppcVar3 = DAT_004dc8cc;
	if (DAT_004dc8cc == NULL) {
		return NULL;
	}
	do {
		iVar2 = std::_stricmp(param_1,*ppcVar3);
		if (iVar2 == 0) {
			return ppcVar3;
		}
		ppcVar1 = ppcVar3 + 3;
		ppcVar3 = (char **)*ppcVar1;
	} while ((char **)*ppcVar1 != NULL);
	return NULL;
}



char ** __cdecl FUN_004103c0(char *param_1)
{
	char cVar1;
	char **ppcVar2;
	undefined4 *puVar3;
	uint uVar4;
	uint uVar5;
	undefined4 *puVar6;
	char *pcVar7;
	
	if ((param_1 == NULL) || (*param_1 == '\0')) {
		ppcVar2 = NULL;
	}
	else {
		ppcVar2 = FUN_00410380(param_1);
		if (ppcVar2 == NULL) {
			ppcVar2 = (char **)std::malloc(0x10);
			uVar4 = 0xffffffff;
			pcVar7 = param_1;
			do {
				if (uVar4 == 0) break;
				uVar4 -= 1;
				cVar1 = *pcVar7;
				pcVar7 = pcVar7 + 1;
			} while (cVar1 != '\0');
			puVar3 = (undefined4 *)std::malloc(~uVar4);
			uVar4 = 0xffffffff;
			*ppcVar2 = (char *)puVar3;
			do {
				pcVar7 = param_1;
				if (uVar4 == 0) break;
				uVar4 -= 1;
				pcVar7 = param_1 + 1;
				cVar1 = *param_1;
				param_1 = pcVar7;
			} while (cVar1 != '\0');
			uVar4 = ~uVar4;
			puVar6 = (undefined4 *)(pcVar7 + -uVar4);
			for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
				*puVar3 = *puVar6;
				puVar6 = puVar6 + 1;
				puVar3 = puVar3 + 1;
			}
			for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
				*(undefined *)puVar3 = *(undefined *)puVar6;
				puVar6 = (undefined4 *)((int)puVar6 + 1);
				puVar3 = (undefined4 *)((int)puVar3 + 1);
			}
			ppcVar2[1] = NULL;
			ppcVar2[3] = (char *)DAT_004dc8cc;
			ppcVar2[2] = NULL;
			DAT_004dc8cc = ppcVar2;
			return ppcVar2;
		}
	}
	return ppcVar2;
}



char * __cdecl FUN_00410450(char *param_1)
{
	char **ppcVar1;
	ImageBMP *pIVar2;
	
	if ((param_1 != NULL) && (*param_1 != '\0')) {
		ppcVar1 = FUN_004103c0(param_1);
		if (ppcVar1[1] == NULL) {
			pIVar2 = lego::image::Image_LoadBMP(param_1,0,0);
			ppcVar1[1] = (char *)pIVar2;
		}
		return ppcVar1[1];
	}
	return NULL;
}



char * __cdecl FUN_00410490(char *param_1)
{
	char **ppcVar1;
	ImageFont *pIVar2;
	
	if ((param_1 != NULL) && (*param_1 != '\0')) {
		ppcVar1 = FUN_004103c0(param_1);
		if (ppcVar1[2] == NULL) {
			pIVar2 = lego::draw::Image_LoadFont(param_1);
			ppcVar1[2] = (char *)pIVar2;
		}
		return ppcVar1[2];
	}
	return NULL;
}



undefined4 * __cdecl FUN_004104d0(char *param_1)
{
	char cVar1;
	undefined4 *puVar2;
	uint uVar3;
	uint uVar4;
	undefined4 *puVar5;
	char *pcVar6;
	undefined4 *puVar7;
	
	if (param_1 == NULL) {
		return NULL;
	}
	uVar3 = 0xffffffff;
	pcVar6 = param_1;
	do {
		if (uVar3 == 0) break;
		uVar3 -= 1;
		cVar1 = *pcVar6;
		pcVar6 = pcVar6 + 1;
	} while (cVar1 != '\0');
	puVar2 = (undefined4 *)std::malloc(~uVar3);
	if (puVar2 == NULL) {
		return NULL;
	}
	uVar3 = 0xffffffff;
	do {
		pcVar6 = param_1;
		if (uVar3 == 0) break;
		uVar3 -= 1;
		pcVar6 = param_1 + 1;
		cVar1 = *param_1;
		param_1 = pcVar6;
	} while (cVar1 != '\0');
	uVar3 = ~uVar3;
	puVar5 = (undefined4 *)(pcVar6 + -uVar3);
	puVar7 = puVar2;
	for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
		*puVar7 = *puVar5;
		puVar5 = puVar5 + 1;
		puVar7 = puVar7 + 1;
	}
	for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
		*(undefined *)puVar7 = *(undefined *)puVar5;
		puVar5 = (undefined4 *)((int)puVar5 + 1);
		puVar7 = (undefined4 *)((int)puVar7 + 1);
	}
	return puVar2;
}



undefined4 * __cdecl
FUN_00410520(undefined4 param_1,char *param_2,char *param_3,undefined4 param_4,undefined4 param_5,
						undefined4 param_6,undefined4 param_7,undefined4 param_8,undefined4 param_9,
						undefined4 param_10,undefined4 param_11,undefined4 param_12,undefined4 param_13,
						undefined4 param_14)
{
	undefined4 *puVar1;
	undefined4 *puVar2;
	int iVar3;
	
	puVar1 = (undefined4 *)std::malloc(0x5c);
	puVar2 = puVar1;
	for (iVar3 = 0x17; iVar3 != 0; iVar3 += -1) {
		*puVar2 = 0;
		puVar2 = puVar2 + 1;
	}
	puVar2 = FUN_004104d0(param_2);
	puVar1[8] = puVar2;
	puVar2 = FUN_004104d0(param_3);
	puVar1[9] = puVar2;
	puVar1[0xb] = param_4;
	puVar1[10] = param_1;
	puVar1[0xc] = param_5;
	puVar1[0xe] = param_7;
	puVar1[0xd] = param_6;
	puVar1[0xf] = param_8;
	puVar1[0x11] = param_10;
	puVar1[0x10] = param_9;
	puVar1[0x12] = param_11;
	puVar1[0x15] = param_13;
	puVar1[0x14] = param_12;
	puVar1[0x13] = 0;
	puVar1[0x16] = param_14;
	return puVar1;
}



void __cdecl FUN_004105c0(int *param_1)
{
	int *piVar1;
	uint uVar2;
	int *buffer;
	int iVar3;
	int iVar4;
	int iVar5;
	
	buffer = param_1;
	iVar4 = 0;
	if (param_1 != NULL) {
		if ((void *)param_1[8] != NULL) {
			std::free((void *)param_1[8]);
		}
		if ((void *)param_1[9] != NULL) {
			std::free((void *)param_1[9]);
		}
		if (*param_1 != 0) {
			piVar1 = param_1 + 7;
			param_1 = NULL;
			if (0 < *piVar1) {
				do {
					uVar2 = *(uint *)(*buffer + iVar4);
					if ((uVar2 & 1) == 0) {
						if ((uVar2 & 2) != 0) {
							iVar5 = iVar4 + 8;
							iVar3 = 3;
							do {
								lego::pool::ReservedPool_ImageBMP___Release(*(ImageBMP **)(*buffer + iVar5));
								iVar5 += 4;
								iVar3 += -1;
							} while (iVar3 != 0);
						}
					}
					else {
						std::free(*(void **)(*buffer + iVar4 + 4));
					}
					param_1 = (int *)((int)param_1 + 1);
					iVar4 += 0x20;
				} while ((int)param_1 < buffer[7]);
			}
			std::free((void *)*buffer);
		}
		std::free(buffer);
	}
	return;
}



void __cdecl
FUN_00410670(int **param_1,byte *param_2,int param_3,undefined4 *param_4,int param_5,int param_6,
						int param_7)
{
	LwoFrame *pLVar1;
	ImageBMP *image;
	int **ppiVar2;
	int *piVar3;
	int *piVar4;
	int *piVar5;
	void *pvVar6;
	int iVar7;
	char *pcVar8;
	undefined4 *puVar9;
	ImageFont *pIVar10;
	int **ppiVar11;
	LwoFrame **ppLVar12;
	int **ppiVar13;
	int iVar14;
	int *apiStack24 [6];
	
	ppiVar2 = param_1;
	if ((LwoFrame *)*param_1 == NULL) {
		piVar3 = (int *)std::malloc(((int)param_1[7] + 1) * 0x20);
		iVar14 = 0;
		do {
			pvVar6 = std::malloc((int)param_1[7] * 4 + 4);
			piVar5 = param_1[7];
			*(void **)((int)apiStack24 + iVar14) = pvVar6;
			pvVar6 = std::malloc((int)piVar5 * 4 + 4);
			*(void **)((int)apiStack24 + iVar14 + 0xc) = pvVar6;
			iVar14 += 4;
		} while (iVar14 < 0xc);
	}
	else {
		piVar3 = FUN_0048df40((LwoFrame *)*param_1,((int)param_1[7] + 1) * 0x20);
		ppLVar12 = (LwoFrame **)(param_1 + 4);
		iVar14 = 0;
		do {
			piVar4 = FUN_0048df40(ppLVar12[-3],(int)param_1[7] * 4 + 4);
			piVar5 = param_1[7];
			pLVar1 = *ppLVar12;
			*(int **)((int)apiStack24 + iVar14) = piVar4;
			piVar5 = FUN_0048df40(pLVar1,(int)piVar5 * 4 + 4);
			*(int **)((int)apiStack24 + iVar14 + 0xc) = piVar5;
			iVar14 += 4;
			ppLVar12 = ppLVar12 + 1;
		} while (iVar14 < 0xc);
	}
	if (piVar3 != NULL) {
		*param_1 = piVar3;
		piVar3[(int)param_1[7] * 8 + 1] = 0;
		ppiVar13 = param_1 + 4;
		(*param_1)[(int)param_1[7] * 8] = -(uint)(param_3 != 0) & 4;
		iVar14 = 0;
		ppiVar11 = ppiVar13;
		do {
			iVar7 = iVar14 + 4;
			ppiVar11[-3] = *(int **)((int)apiStack24 + iVar14);
			*ppiVar11 = *(int **)((int)apiStack24 + iVar14 + 0xc);
			ppiVar11 = ppiVar11 + 1;
			iVar14 = iVar7;
		} while (iVar7 < 0xc);
		if ((param_2 != NULL) && (pcVar8 = lego::util::strstri((char *)param_2,".bmp"), pcVar8 != NULL))
		{
			lego::util::stringSplit((char *)param_2,(char **)(apiStack24 + 3),",");
			iVar14 = 0;
			(*param_1)[(int)param_1[7] * 8] = (*param_1)[(int)param_1[7] * 8] | 2;
			param_1 = apiStack24 + 3;
			do {
				pcVar8 = FUN_00410450((char *)*param_1);
				(*ppiVar2)[iVar14 + (int)ppiVar2[7] * 8 + 2] = (int)pcVar8;
				image = (ImageBMP *)(*ppiVar2)[iVar14 + (int)ppiVar2[7] * 8 + 2];
				if (image != NULL) {
					lego::image::Image_SetFirstColorAsKey(image);
				}
				iVar14 += 1;
				ppiVar13[-3][(int)ppiVar2[7]] = image->width;
				piVar3 = *ppiVar13;
				ppiVar13 = ppiVar13 + 1;
				piVar3[(int)ppiVar2[7]] = image->height;
				param_1 = param_1 + 1;
			} while (iVar14 < 3);
			(*ppiVar2)[(int)ppiVar2[7] * 8 + 5] = param_5;
			(*ppiVar2)[(int)ppiVar2[7] * 8 + 6] = param_6;
			(*ppiVar2)[(int)ppiVar2[7] * 8 + 7] = param_7;
			ppiVar2[7] = (int *)((int)ppiVar2[7] + 1);
			return;
		}
		(*param_1)[(int)param_1[7] * 8] = (*param_1)[(int)param_1[7] * 8] | 1;
		puVar9 = FUN_004104d0((char *)param_2);
		(*param_1)[(int)param_1[7] * 8 + 1] = (int)puVar9;
		(*param_1)[(int)param_1[7] * 8 + 5] = param_5;
		(*param_1)[(int)param_1[7] * 8 + 6] = param_6;
		(*param_1)[(int)param_1[7] * 8 + 7] = param_7;
		pIVar10 = FUN_00401b90((ImageFont *)param_4,(char *)param_2);
		param_1[3][(int)param_1[7]] = (int)pIVar10;
		param_1[2][(int)param_1[7]] = param_1[3][(int)param_1[7]];
		param_1[1][(int)param_1[7]] = param_1[2][(int)param_1[7]];
		iVar14 = lego::draw::Font_GetField_be4((ImageFont *)param_4);
		param_1[6][(int)param_1[7]] = iVar14;
		param_1[5][(int)param_1[7]] = param_1[6][(int)param_1[7]];
		(*ppiVar13)[(int)param_1[7]] = param_1[5][(int)param_1[7]];
		param_1[7] = (int *)((int)param_1[7] + 1);
	}
	return;
}



int * __cdecl FUN_00410940(uint param_1,int param_2,int param_3,int param_4,int param_5)
{
	int *piVar1;
	undefined4 *puVar2;
	uint uVar3;
	int iVar4;
	
	piVar1 = (int *)std::malloc(0x1c);
	if (piVar1 == NULL) {
		return NULL;
	}
	puVar2 = (undefined4 *)std::malloc(param_1 * 4);
	*piVar1 = (int)puVar2;
	if (puVar2 == NULL) {
		FUN_00410a10(piVar1);
		return NULL;
	}
	for (uVar3 = param_1 & 0x3fffffff; uVar3 != 0; uVar3 -= 1) {
		*puVar2 = 0;
		puVar2 = puVar2 + 1;
	}
	for (iVar4 = 0; iVar4 != 0; iVar4 += -1) {
		*(undefined *)puVar2 = 0;
		puVar2 = (undefined4 *)((int)puVar2 + 1);
	}
	piVar1[3] = param_2;
	piVar1[6] = param_5;
	piVar1[1] = param_1;
	piVar1[2] = 0;
	piVar1[4] = param_3;
	piVar1[5] = param_4;
	return piVar1;
}



void __cdecl FUN_004109d0(int *param_1,char *param_2)
{
	undefined4 *puVar1;
	
	if (((param_1 != NULL) && (*param_1 != 0)) && (param_1[2] < param_1[1])) {
		puVar1 = FUN_004104d0(param_2);
		*(undefined4 **)(*param_1 + param_1[2] * 4) = puVar1;
		if (*(int *)(*param_1 + param_1[2] * 4) != 0) {
			param_1[2] = param_1[2] + 1;
		}
	}
	return;
}



void __cdecl FUN_00410a10(int *param_1)
{
	void *buffer;
	int iVar1;
	
	if (param_1 != NULL) {
		if (*param_1 != 0) {
			iVar1 = 0;
			if (0 < param_1[2]) {
				do {
					buffer = *(void **)(*param_1 + iVar1 * 4);
					if (buffer != NULL) {
						std::free(buffer);
					}
					iVar1 += 1;
				} while (iVar1 < param_1[2]);
			}
			std::free((void *)*param_1);
		}
		std::free(param_1);
	}
	return;
}



int __cdecl lego::input::Input_GetMousePositionX(void)
{
	return globals::g_MousePosition.x;
}



int __cdecl lego::input::Input_GetMousePositionY(void)
{
	return globals::g_MousePosition.y;
}



BOOL __cdecl lego::input::Input_GetBool_0076bb3c(void)
{
	return globals::g_ButtonState_LeftDown;
}



void __cdecl FUN_00410a90(undefined4 param_1,undefined4 param_2,undefined4 param_3)
{
	undefined4 *puVar1;
	
	puVar1 = (undefined4 *)std::malloc(0xc);
	if (puVar1 == NULL) {
		return;
	}
	*puVar1 = param_1;
	puVar1[1] = param_2;
	puVar1[2] = param_3;
	return;
}



undefined4 * __cdecl
FUN_00410ac0(undefined4 param_1,float param_2,float param_3,undefined4 param_4,undefined4 param_5,
						undefined4 param_6,undefined4 param_7)
{
	undefined4 *puVar1;
	
	if ((ushort)((ushort)(param_3 < param_2) << 8 | (ushort)(param_3 == param_2) << 0xe) != 0) {
		return NULL;
	}
	puVar1 = (undefined4 *)std::malloc(0x1c);
	if (puVar1 == NULL) {
		return NULL;
	}
	*puVar1 = param_1;
	puVar1[1] = param_2;
	puVar1[2] = param_3;
	puVar1[3] = param_4;
	puVar1[4] = param_5;
	puVar1[5] = param_6;
	puVar1[6] = param_7;
	return puVar1;
}



undefined4 * __cdecl
FUN_00410b20(undefined4 param_1,int param_2,int param_3,undefined4 param_4,undefined4 param_5,
						undefined4 param_6,undefined4 param_7,undefined4 param_8,undefined4 param_9,
						undefined4 param_10,undefined4 param_11,undefined4 param_12,undefined4 param_13,
						undefined4 param_14)
{
	undefined4 *puVar1;
	
	if (param_3 <= param_2) {
		return NULL;
	}
	puVar1 = (undefined4 *)std::malloc(0x38);
	if (puVar1 == NULL) {
		return NULL;
	}
	*puVar1 = param_1;
	puVar1[3] = param_4;
	puVar1[4] = param_5;
	puVar1[5] = param_6;
	puVar1[6] = param_7;
	puVar1[7] = param_8;
	puVar1[8] = param_9;
	puVar1[9] = param_10;
	puVar1[10] = param_11;
	puVar1[0xb] = param_12;
	puVar1[1] = param_2;
	puVar1[2] = param_3;
	puVar1[0xc] = param_13;
	puVar1[0xd] = param_14;
	return puVar1;
}



void __cdecl FUN_00410ba0(undefined4 *param_1)
{
	if (param_1 != NULL) {
		if ((void *)*param_1 != NULL) {
			std::free((void *)*param_1);
		}
		if (true) {
			switch(param_1[5]) {
			case 0:
				FUN_00410a10((int *)param_1[4]);
				std::free(param_1);
				return;
			case 1:
				lego::unk::Lego_UnkRecurseFreeItem__0040f6e0((undefined *)param_1[4]);
				std::free(param_1);
				return;
			case 2:
				lego::unk::Lego_UnkRecurseFreeItem__0040f6e0((undefined *)param_1[4]);
				std::free(param_1);
				return;
			case 3:
				lego::unk::Lego_UnkRecurseFreeItem__0040f6e0((undefined *)param_1[4]);
				std::free(param_1);
				return;
			case 4:
				lego::unk::Lego_UnkRecurseFreeItem__0040f6e0((undefined *)param_1[4]);
				std::free(param_1);
				return;
			case 6:
				FUN_004105c0((int *)param_1[4]);
			}
		}
		std::free(param_1);
	}
	return;
}



undefined4 * __cdecl
FUN_00410c80(char *param_1,ImageFont *param_2,ImageFont *param_3,undefined4 param_4,
						undefined4 param_5,undefined4 param_6,int param_7,undefined4 param_8,undefined4 param_9)
{
	char cVar1;
	undefined4 *puVar2;
	undefined4 *puVar3;
	ImageFont *pIVar4;
	int iVar5;
	uint uVar6;
	char *pcVar7;
	
	if (param_1 == NULL) {
		return NULL;
	}
	puVar2 = (undefined4 *)std::malloc(0x3c);
	if (puVar2 == NULL) {
		return NULL;
	}
	puVar3 = puVar2;
	for (iVar5 = 0xf; iVar5 != 0; iVar5 += -1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	uVar6 = 0xffffffff;
	pcVar7 = param_1;
	do {
		if (uVar6 == 0) break;
		uVar6 -= 1;
		cVar1 = *pcVar7;
		pcVar7 = pcVar7 + 1;
	} while (cVar1 != '\0');
	puVar2[1] = ~uVar6 - 1;
	puVar3 = FUN_004104d0(param_1);
	puVar2[5] = param_6;
	*puVar2 = puVar3;
	puVar2[6] = param_4;
	puVar2[4] = param_8;
	puVar2[0xe] = param_9;
	puVar2[3] = param_2;
	puVar2[2] = param_3;
	puVar2[7] = param_5;
	if (((param_7 != 0) && (param_2 != NULL)) && (param_3 != NULL)) {
		pIVar4 = FUN_00401b90(param_2,param_1);
		puVar2[8] = -((uint)pIVar4 >> 1);
		pIVar4 = FUN_00401b90(param_3,param_1);
		puVar2[9] = -((uint)pIVar4 >> 1);
		return puVar2;
	}
	puVar2[8] = 0;
	puVar2[9] = 0;
	return puVar2;
}



undefined4 * __cdecl
FUN_00410d50(char *param_1,undefined4 param_2,undefined4 param_3,int param_4,int param_5,
						undefined4 param_6,undefined4 param_7,undefined4 param_8,int param_9,char *param_10,
						undefined4 param_11)
{
	char cVar1;
	undefined4 *puVar2;
	undefined4 *puVar3;
	ImageBMP *pIVar4;
	int iVar5;
	uint uVar6;
	char *pcVar7;
	
	if (param_1 != NULL) {
		puVar2 = (undefined4 *)std::malloc(0x3c);
		if (puVar2 != NULL) {
			puVar3 = puVar2;
			for (iVar5 = 0xf; iVar5 != 0; iVar5 += -1) {
				*puVar3 = 0;
				puVar3 = puVar3 + 1;
			}
			uVar6 = 0xffffffff;
			pcVar7 = param_1;
			do {
				if (uVar6 == 0) break;
				uVar6 -= 1;
				cVar1 = *pcVar7;
				pcVar7 = pcVar7 + 1;
			} while (cVar1 != '\0');
			puVar2[1] = ~uVar6 - 1;
			puVar3 = FUN_004104d0(param_1);
			*puVar2 = puVar3;
			puVar2[2] = param_3;
			puVar2[3] = param_2;
			pIVar4 = lego::image::Image_LoadBMP((char *)param_4,0,0);
			puVar2[0xb] = pIVar4;
			if (pIVar4 != NULL) {
				pIVar4 = lego::image::Image_LoadBMP((char *)param_5,0,0);
				puVar2[0xc] = pIVar4;
				if (pIVar4 != NULL) {
					puVar2[10] = 1;
				}
				puVar2[4] = param_11;
				puVar2[5] = param_8;
				puVar2[6] = param_6;
				puVar2[7] = param_7;
				iVar5 = FUN_0046b790(param_10,puVar2 + 0xd);
				if (iVar5 == 0) {
					puVar2[0xd] = 0;
				}
				if (((param_9 != 0) && (puVar2[0xb] != 0)) && (puVar2[0xc] != 0)) {
					puVar2[8] = -(*(uint *)(puVar2[0xb] + 4) >> 1);
					puVar2[9] = -(*(uint *)(puVar2[0xc] + 4) >> 1);
					return puVar2;
				}
				puVar2[8] = 0;
				puVar2[9] = 0;
				return puVar2;
			}
		}
	}
	return NULL;
}



void __cdecl FUN_00410e60(undefined4 *param_1)
{
	undefined4 *puVar1;
	int iVar2;
	
	if (param_1 != NULL) {
		if ((void *)*param_1 != NULL) {
			std::free((void *)*param_1);
		}
		if ((void *)param_1[1] != NULL) {
			std::free((void *)param_1[1]);
		}
		if ((void *)param_1[6] != NULL) {
			std::free((void *)param_1[6]);
		}
		iVar2 = 0;
		if (0 < (int)param_1[7]) {
			do {
				puVar1 = *(undefined4 **)(param_1[6] + iVar2 * 4);
				if (puVar1 != NULL) {
					FUN_00410ba0(puVar1);
				}
				iVar2 += 1;
			} while (iVar2 < (int)param_1[7]);
		}
		if ((ImageBMP *)param_1[4] != NULL) {
			lego::pool::ReservedPool_ImageBMP___Release((ImageBMP *)param_1[4]);
		}
		std::free(param_1);
	}
	return;
}



uint __cdecl FUN_00410ee0(int param_1,char *param_2,int param_3)
{
	char cVar1;
	char *pcVar2;
	int iVar3;
	uint uVar4;
	uint uVar5;
	undefined4 *puVar6;
	undefined4 *puVar7;
	float10 fVar8;
	char *local_410;
	char *local_40c;
	char *local_408;
	char *local_404;
	undefined4 local_400 [256];
	
	local_410 = NULL;
	local_40c = NULL;
	local_408 = NULL;
	local_404 = NULL;
	if (param_2 == NULL) {
		return 0;
	}
	uVar4 = 0xffffffff;
	do {
		pcVar2 = param_2;
		if (uVar4 == 0) break;
		uVar4 -= 1;
		pcVar2 = param_2 + 1;
		cVar1 = *param_2;
		param_2 = pcVar2;
	} while (cVar1 != '\0');
	uVar4 = ~uVar4;
	puVar6 = (undefined4 *)(pcVar2 + -uVar4);
	puVar7 = local_400;
	for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
		*puVar7 = *puVar6;
		puVar6 = puVar6 + 1;
		puVar7 = puVar7 + 1;
	}
	for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
		*(undefined *)puVar7 = *(undefined *)puVar6;
		puVar6 = (undefined4 *)((int)puVar6 + 1);
		puVar7 = (undefined4 *)((int)puVar7 + 1);
	}
	uVar4 = lego::util::stringSplit((char *)local_400,&local_410,":");
	if (2 < uVar4) {
		*(uint *)(param_1 + 0x34) = *(uint *)(param_1 + 0x34) | 1;
		fVar8 = std::atof(local_40c);
		*(float *)(param_1 + 0x38) = (float)fVar8;
		fVar8 = std::atof(local_408);
		*(float *)(param_1 + 0x3c) = (float)fVar8;
	}
	if (param_3 != 0) {
		pcVar2 = FUN_00410450(local_410);
		*(char **)(param_1 + 0x10) = pcVar2;
		if ((pcVar2 != NULL) && (uVar4 == 4)) {
			iVar3 = std::atoi(local_404);
			if (iVar3 == 1) {
				lego::image::Image_SetFirstColorAsKey(*(ImageBMP **)(param_1 + 0x10));
			}
		}
		return (uint)(*(int *)(param_1 + 0x10) != 0);
	}
	pcVar2 = FUN_00410450(local_410);
	*(char **)(param_1 + 0x14) = pcVar2;
	if ((pcVar2 != NULL) && (uVar4 == 4)) {
		iVar3 = std::atoi(local_404);
		if (iVar3 == 1) {
			lego::image::Image_unkFogFromFloat__0047deb0
								(*(ImageBMP **)(param_1 + 0x14),0.0,0.0,0.0,0.0,0.0,0.0);
		}
	}
	return (uint)(*(int *)(param_1 + 0x14) != 0);
}



int * __cdecl
FUN_00411030(char *param_1,char *param_2,int param_3,int param_4,int param_5,int param_6,int param_7
						,int param_8,int param_9,char *param_10)
{
	char cVar1;
	int *piVar2;
	undefined4 *puVar3;
	void *pvVar4;
	int iVar5;
	uint uVar6;
	int *piVar7;
	char *local_190;
	char *local_18c;
	
	piVar2 = (int *)std::malloc(0xa0);
	if (piVar2 == NULL) {
		return NULL;
	}
	piVar7 = piVar2;
	for (iVar5 = 0x28; iVar5 != 0; iVar5 += -1) {
		*piVar7 = 0;
		piVar7 = piVar7 + 1;
	}
	puVar3 = FUN_004104d0(param_1);
	*piVar2 = (int)puVar3;
	puVar3 = FUN_004104d0(param_2);
	piVar2[1] = (int)puVar3;
	if (*piVar2 == 0) {
		return NULL;
	}
	if (puVar3 == NULL) {
		return NULL;
	}
	uVar6 = 0xffffffff;
	do {
		if (uVar6 == 0) break;
		uVar6 -= 1;
		cVar1 = *param_1;
		param_1 = param_1 + 1;
	} while (cVar1 != '\0');
	piVar2[2] = ~uVar6 - 1;
	pvVar4 = std::malloc(0x3c);
	piVar2[6] = (int)pvVar4;
	if (pvVar4 == NULL) {
		FUN_00410e60(piVar2);
		return NULL;
	}
	piVar2[3] = param_3;
	piVar2[0xc] = param_5;
	piVar2[0x11] = param_6;
	piVar2[0x12] = param_7;
	piVar2[0xb] = param_4;
	piVar2[8] = 0xf;
	piVar2[7] = 0;
	piVar2[9] = 0;
	piVar2[10] = 0;
	piVar2[0x16] = param_8;
	piVar2[0xd] = -(uint)(param_9 != 0) & 2;
	if (param_10 != NULL) {
		piVar2[0x13] = 1;
		lego::util::stringSplit(param_10,&local_190,":");
		iVar5 = std::atoi(local_190);
		piVar2[0x14] = iVar5;
		iVar5 = std::atoi(local_18c);
		piVar2[0x15] = iVar5;
	}
	return piVar2;
}



undefined4 __cdecl FUN_00411190(int param_1,int param_2)
{
	int iVar1;
	int *piVar2;
	
	if ((param_2 == 0) || (param_1 == 0)) {
		return 0;
	}
	iVar1 = *(int *)(param_1 + 0x20);
	if (*(int *)(param_1 + 0x1c) == iVar1) {
		if (*(LwoFrame **)(param_1 + 0x18) == NULL) {
			piVar2 = (int *)std::malloc(iVar1 * 4 + 0x3c);
		}
		else {
			piVar2 = FUN_0048df40(*(LwoFrame **)(param_1 + 0x18),iVar1 * 4 + 0x3c);
		}
		if (piVar2 == NULL) {
			return 0;
		}
		*(int **)(param_1 + 0x18) = piVar2;
		*(int *)(param_1 + 0x20) = *(int *)(param_1 + 0x20) + 0xf;
	}
	*(int *)(*(int *)(param_1 + 0x18) + *(int *)(param_1 + 0x1c) * 4) = param_2;
	*(int *)(param_1 + 0x1c) = *(int *)(param_1 + 0x1c) + 1;
	return 1;
}



undefined4 __cdecl
FUN_00411210(int param_1,int param_2,int param_3,int param_4,int param_5,int param_6)
{
	if ((param_3 <= param_1) && (param_1 <= param_5 + param_3)) {
		if ((param_4 <= param_2) && (param_2 <= param_6 + param_4)) {
			return 1;
		}
	}
	return 0;
}



void __cdecl
FUN_00411250(int param_1,int param_2,int param_3,int param_4,int param_5,int param_6,int param_7)
{
	int iVar1;
	
	if (param_7 == 0) {
		iVar1 = 0;
	}
	else {
		iVar1 = -(param_5 / 2);
	}
	FUN_00411210(param_1,param_2,iVar1 + param_3,param_4,param_5,param_6);
	return;
}



int __cdecl FUN_00411290(int param_1,undefined4 *param_2,int *param_3)
{
	undefined4 *puVar1;
	ImageFont *pIVar2;
	int iVar3;
	byte *pbVar4;
	int iVar5;
	
	puVar1 = param_2;
	iVar5 = 0;
	if ((ImageFont *)param_2[2] == NULL) {
		param_2 = NULL;
	}
	else {
		pIVar2 = FUN_00401b90((ImageFont *)param_2[2],(char *)param_3[8]);
		iVar5 = lego::draw::Font_GetField_be4((ImageFont *)param_2[2]);
		param_2 = (undefined4 *)pIVar2;
	}
	iVar3 = FUN_00411250(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y,
											 param_3[0xf] + *(int *)(param_1 + 0x2c),
											 param_3[0x10] + *(int *)(param_1 + 0x30),(int)param_2,iVar5,0);
	if (iVar3 != 0) {
		return -2;
	}
	if ((ImageFont *)puVar1[2] == NULL) {
		pIVar2 = NULL;
	}
	else {
		pIVar2 = FUN_00401b90((ImageFont *)puVar1[2],(char *)param_3[9]);
	}
	iVar5 = FUN_00411250(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y,
											 param_3[0x11] + *(int *)(param_1 + 0x2c),
											 param_3[0x12] + *(int *)(param_1 + 0x30),(int)pIVar2,iVar5,0);
	if (iVar5 != 0) {
		return -3;
	}
	iVar5 = 0;
	if (0 < param_3[0xe]) {
		while (iVar3 = param_3[0x13] + iVar5, iVar3 < param_3[7]) {
			pbVar4 = (byte *)(*param_3 + iVar3 * 0x20);
			if ((*pbVar4 & 4) != 0) {
				iVar3 = FUN_00411250(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y,
														 puVar1[6] + param_3[0xb] + *(int *)(pbVar4 + 0x14) + DAT_005584dc +
														 *(int *)(param_1 + 0x2c),
														 param_3[0xd] * iVar5 + puVar1[7] + param_3[0xc] +
														 *(int *)(pbVar4 + 0x18) + DAT_005584e0 + *(int *)(param_1 + 0x30),
														 *(int *)(param_3[1] + iVar3 * 4),*(int *)(param_3[4] + iVar3 * 4),
														 *(int *)(param_1 + 0x44));
				if (iVar3 != 0) {
					return iVar5 + param_3[0x13];
				}
			}
			iVar5 += 1;
			if (param_3[0xe] <= iVar5) {
				return -1;
			}
		}
	}
	return -1;
}



uint __cdecl FUN_00411420(int param_1,int param_2)
{
	undefined4 *puVar1;
	int iVar2;
	
	if ((param_2 < *(int *)(param_1 + 0x1c)) &&
		 (puVar1 = *(undefined4 **)(*(int *)(param_1 + 0x18) + param_2 * 4), puVar1[5] == 6)) {
		iVar2 = FUN_00411290(param_1,puVar1,(int *)puVar1[4]);
		return (uint)(iVar2 != -1);
	}
	return 0;
}



BOOL __cdecl
FUN_00411460(int param_1,int param_2,byte **param_3,byte **param_4,byte **param_5,byte **param_6)
{
	char **ppcVar1;
	ImageFont *pIVar2;
	byte *pbVar3;
	ImageFont *font;
	int iVar4;
	char *pcVar5;
	byte *pbVar6;
	byte *pbVar7;
	byte *pbVar8;
	byte *pbVar9;
	int iVar10;
	int iVar11;
	
	if (*(int *)(param_1 + 0x1c) <= param_2) {
		return 0;
	}
	iVar4 = param_2 * 4;
	ppcVar1 = *(char ***)(iVar4 + *(int *)(param_1 + 0x18));
	if (ppcVar1[5] == (char *)0x3) {
		pbVar9 = (byte *)(ppcVar1[6] + (int)(ppcVar1[9] + *(int *)(param_1 + 0x2c)));
		pcVar5 = ppcVar1[4];
		pbVar3 = (byte *)(ppcVar1[7] + *(int *)(param_1 + 0x30));
		if (*(int *)(param_1 + 0x24) == param_2) {
			pIVar2 = (ImageFont *)ppcVar1[2];
		}
		else {
			pIVar2 = (ImageFont *)ppcVar1[3];
		}
		pIVar2 = FUN_00401b90(pIVar2,*ppcVar1);
		iVar4 = *(int *)(iVar4 + *(int *)(param_1 + 0x18));
		if (*(int *)(param_1 + 0x24) == param_2) {
			font = *(ImageFont **)(iVar4 + 8);
		}
		else {
			font = *(ImageFont **)(iVar4 + 0xc);
		}
		iVar4 = lego::draw::Font_GetField_be4(font);
		pbVar6 = (byte *)(ppcVar1[6] + *(int *)(param_1 + 0x2c) + *(int *)(pcVar5 + 0xc));
		pbVar8 = (byte *)(ppcVar1[7] + *(int *)(param_1 + 0x30) + *(int *)(pcVar5 + 0x10));
		if (*(int *)(pcVar5 + 0x24) == 0) {
			iVar10 = 0;
		}
		else {
			iVar10 = *(int *)(*(int *)(pcVar5 + 0x24) + 4);
		}
		if (*(int *)(pcVar5 + 0x28) == 0) {
			iVar11 = 0;
		}
		else {
			iVar11 = *(int *)(*(int *)(pcVar5 + 0x28) + 4);
		}
		pbVar7 = pbVar9;
		if ((int)pbVar6 <= (int)pbVar9) {
			pbVar7 = pbVar6;
		}
		*param_3 = pbVar7;
		pbVar7 = pbVar3;
		if ((int)pbVar8 <= (int)pbVar3) {
			pbVar7 = pbVar8;
		}
		*param_4 = pbVar7;
		pbVar7 = pbVar6 + iVar11 + 0x68 + iVar10;
		if ((int)(pbVar6 + iVar11 + 0x68 + iVar10) < (int)(pbVar9 + (int)pIVar2)) {
			pbVar7 = pbVar9 + (int)pIVar2;
		}
		*param_5 = pbVar7;
		pbVar9 = pbVar3 + iVar4;
		if ((int)(pbVar3 + iVar4) <= (int)(pbVar8 + 0x14)) {
			pbVar9 = pbVar8 + 0x14;
		}
		*param_6 = pbVar9;
		*param_5 = *param_5 + -(int)*param_3;
		*param_6 = *param_6 + -(int)*param_4;
		return 1;
	}
	if (ppcVar1[5] == (char *)0x6) {
		return 0;
	}
	*param_3 = (byte *)(ppcVar1[6] + (int)(ppcVar1[9] + *(int *)(param_1 + 0x2c)));
	*param_4 = (byte *)(*(int *)(*(int *)(iVar4 + *(int *)(param_1 + 0x18)) + 0x1c) +
										 *(int *)(param_1 + 0x30));
	ppcVar1 = *(char ***)(iVar4 + *(int *)(param_1 + 0x18));
	if (ppcVar1[10] != NULL) {
		if (*(int *)(param_1 + 0x24) == param_2) {
			pcVar5 = ppcVar1[0xc];
		}
		else {
			pcVar5 = ppcVar1[0xb];
		}
		*param_5 = *(byte **)(pcVar5 + 4);
		iVar4 = *(int *)(iVar4 + *(int *)(param_1 + 0x18));
		if (*(int *)(param_1 + 0x24) == param_2) {
			*param_6 = *(byte **)(*(int *)(iVar4 + 0x30) + 8);
			return 1;
		}
		*param_6 = *(byte **)(*(int *)(iVar4 + 0x2c) + 8);
		return 1;
	}
	if (*(int *)(param_1 + 0x24) == param_2) {
		pIVar2 = (ImageFont *)ppcVar1[2];
	}
	else {
		pIVar2 = (ImageFont *)ppcVar1[3];
	}
	pIVar2 = FUN_00401b90(pIVar2,*ppcVar1);
	*param_5 = (byte *)pIVar2;
	iVar4 = *(int *)(iVar4 + *(int *)(param_1 + 0x18));
	if (*(int *)(param_1 + 0x24) == param_2) {
		pbVar3 = (byte *)lego::draw::Font_GetField_be4(*(ImageFont **)(iVar4 + 8));
		*param_6 = pbVar3;
		return 1;
	}
	pbVar3 = (byte *)lego::draw::Font_GetField_be4(*(ImageFont **)(iVar4 + 0xc));
	*param_6 = pbVar3;
	return 1;
}



undefined4 __cdecl FUN_004116c0(int param_1,int *param_2)
{
	BOOL BVar1;
	int iVar2;
	uint uVar3;
	int iVar4;
	byte *local_10;
	byte *local_c;
	byte *local_8;
	byte *local_4;
	
	iVar4 = 0;
	local_4 = NULL;
	local_8 = NULL;
	local_c = NULL;
	local_10 = NULL;
	uVar3 = 0;
	while( true ) {
		BVar1 = FUN_00411460(param_1,iVar4,&local_4,&local_8,&local_c,&local_10);
		if (BVar1 == 0) {
			uVar3 = FUN_00411420(param_1,iVar4);
			if (uVar3 == 0) {
				return 0;
			}
		}
		if (uVar3 != 0) break;
		iVar2 = FUN_00411210(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y,
												 (int)local_4,(int)local_8,(int)local_c,(int)local_10);
		if (iVar2 != 0) break;
		iVar4 += 1;
	}
	if (param_2 != NULL) {
		*param_2 = iVar4;
	}
	return 1;
}



undefined4 __cdecl FUN_00411770(void)
{
	undefined4 uVar1;
	
	if ((lego::globals::g_ButtonState_LeftDown != 0) || (uVar1 = 1, DAT_004dc8d4 != 1)) {
		uVar1 = 0;
	}
	DAT_004dc8d4 = lego::globals::g_ButtonState_LeftDown;
	return uVar1;
}



undefined4 __cdecl FUN_004117a0(int param_1,int param_2,int **param_3)
{
	int *piVar1;
	int iVar2;
	int iVar3;
	int iVar4;
	float10 fVar5;
	longlong lVar6;
	
	iVar4 = (int)param_3[3] + *(int *)(param_2 + 0x18) + *(int *)(param_1 + 0x2c);
	iVar3 = *(int *)(param_1 + 0x30) + *(int *)(param_2 + 0x1c) + (int)param_3[4];
	iVar2 = FUN_00411210(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y,iVar4,iVar3
											 ,100,0x14);
	if (iVar2 != 0) {
		fVar5 = ((float10)lego::globals::g_MousePosition.x - (float10)iVar4) * (float10)0.01;
		if ((ushort)((ushort)(fVar5 < (float10)1.0) << 8 | (ushort)(fVar5 == (float10)1.0) << 0xe) == 0)
		{
			fVar5 = (float10)1.0;
		}
		if (fVar5 < (float10)0.0) {
			fVar5 = (float10)0.0;
		}
		lVar6 = __ftol((float10)(int)((int)param_3[2] - (int)param_3[1]) * fVar5);
		**param_3 = (int)lVar6;
		return 1;
	}
	piVar1 = param_3[0xb];
	if ((piVar1 != NULL) && (param_3[10] != NULL)) {
		iVar2 = FUN_00411210(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y,
												 (iVar4 - piVar1[1]) + -4,iVar3,piVar1[1],piVar1[2]);
		if (iVar2 == 0) {
			iVar2 = FUN_00411210(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y,
													 param_3[9][1] + 0x68 + iVar4,iVar3,param_3[10][1],param_3[10][2]);
			if (iVar2 == 0) {
				return 0;
			}
			iVar2 = **param_3;
			if (iVar2 < (int)param_3[2]) {
				**param_3 = iVar2 + 1;
			}
		}
		else {
			iVar2 = **param_3;
			if ((int)param_3[1] < iVar2) {
				**param_3 = iVar2 + -1;
				return 1;
			}
		}
		return 1;
	}
	return 0;
}



BOOL __cdecl FUN_00411900(int param_1)
{
	int iVar1;
	
	if ((param_1 != 0) && (*(int *)(param_1 + 0x38) != 0)) {
		iVar1 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
		if (iVar1 != 0) {
			return 1;
		}
	}
	return 0;
}



int __cdecl FUN_00411930(undefined4 param_1,int param_2)
{
	undefined *puVar1;
	float *pfVar2;
	int **ppiVar3;
	int **ppiVar4;
	float **ppfVar5;
	undefined4 *puVar6;
	int *piVar7;
	bool bVar8;
	bool bVar9;
	int iVar10;
	BOOL BVar11;
	int iVar12;
	int iVar13;
	undefined4 *puVar14;
	int local_4;
	
	local_4 = -1;
	iVar10 = *(int *)(param_2 + 0x24);
	bVar9 = false;
	if (iVar10 < 0) {
		puVar14 = NULL;
	}
	else {
		puVar14 = *(undefined4 **)(*(int *)(param_2 + 0x18) + iVar10 * 4);
	}
	if (((byte)DAT_005584f0 & 2) != 0) {
		return param_2;
	}
	bVar8 = true;
	if ((puVar14 == NULL) && (-1 < iVar10)) {
		*(undefined4 *)(param_2 + 0x28) = 1;
	}
	iVar10 = FUN_004116c0(param_2,&local_4);
	if (iVar10 != 0) {
		*(int *)(param_2 + 0x24) = local_4;
		puVar14 = *(undefined4 **)(*(int *)(param_2 + 0x18) + local_4 * 4);
	}
	BVar11 = FUN_00411900((int)puVar14);
	if (BVar11 != 0) {
		return param_2;
	}
	iVar10 = FUN_00411770();
	if ((iVar10 == 0) || (iVar10 = FUN_004116c0(param_2,&local_4), iVar10 == 0)) {
		bVar8 = false;
	}
	if ((puVar14 == NULL) && (*(int *)(param_2 + 0x24) < 0)) {
		return param_2;
	}
	if (((lego::globals::g_KeyboardState_Current_TABLE[205] != 0) &&
			(lego::globals::g_KeyboardState_Previous_TABLE[205] !=
			 lego::globals::g_KeyboardState_Current_TABLE[205])) || (bVar8)) {
		lego::snd::Snd_Play_FUN_00465260(0x13,0);
		if (true) {
			switch(puVar14[5]) {
			case 0:
				iVar10 = puVar14[4];
				**(int **)(iVar10 + 0xc) = (**(int **)(iVar10 + 0xc) + 1) % *(int *)(iVar10 + 8);
				bVar9 = bVar8;
				if (*(code **)(iVar10 + 0x18) != NULL) {
					(**(code **)(iVar10 + 0x18))(**(undefined4 **)(iVar10 + 0xc));
				}
				break;
			case 2:
				iVar10 = puVar14[4];
				iVar13 = *(int *)(iVar10 + 8) + 1;
				iVar12 = *(int *)(iVar10 + 4) + -1;
				*(int *)(iVar10 + 8) = iVar13;
				bVar9 = bVar8;
				if (iVar12 < iVar13) {
					*(int *)(iVar10 + 8) = iVar12;
				}
				break;
			case 3:
				ppiVar4 = (int **)puVar14[4];
				if (bVar8) {
					FUN_004117a0(param_2,(int)puVar14,ppiVar4);
					if (ppiVar4[5] != NULL) {
						(*(code *)ppiVar4[5])(**ppiVar4);
					}
				}
				else {
					**ppiVar4 = **ppiVar4 + 1;
					ppiVar3 = (int **)*ppiVar4;
					piVar7 = ppiVar4[2];
					if (*ppiVar3 != piVar7 && (int)piVar7 <= (int)*ppiVar3) {
						*ppiVar3 = piVar7;
					}
					bVar9 = false;
					if (ppiVar4[5] != NULL) {
						(*(code *)ppiVar4[5])(**ppiVar4);
					}
				}
				break;
			case 4:
				ppfVar5 = (float **)puVar14[4];
				**ppfVar5 = (float)ppfVar5[3] + **ppfVar5;
				pfVar2 = (float *)**ppfVar5;
				if ((ushort)((ushort)((float)pfVar2 < (float)ppfVar5[2]) << 8 |
										(ushort)((float)pfVar2 == (float)ppfVar5[2]) << 0xe) == 0) {
					**ppfVar5 = (float)ppfVar5[2];
				}
				bVar9 = bVar8;
				if (ppfVar5[6] != NULL) {
					(*(code *)ppfVar5[6])(**ppfVar5);
				}
				break;
			case 6:
				piVar7 = (int *)puVar14[4];
				iVar10 = FUN_00411290(param_2,puVar14,piVar7);
				if (bVar8) {
					if (iVar10 == -3) {
						if (piVar7[0x13] < 1) break;
						iVar10 = piVar7[0x13] + -1;
					}
					else {
						if (iVar10 != -2) {
							if (iVar10 != -1) {
								if (piVar7[0x16] != 0) {
									*(int *)piVar7[10] = iVar10;
									if ((code *)piVar7[0x15] != NULL) {
										(*(code *)piVar7[0x15])(param_1,iVar10);
									}
									if ((param_2 == *(int *)(*lego::globals::menu::g_MainMenuFull + 0xc)) ||
										 (param_2 == **lego::globals::menu::g_SaveMenu)) {
										INT_004a2f4c = iVar10;
										INT_004a2f5c = iVar10;
									}
									return piVar7[0x16];
								}
								*(int *)piVar7[10] = iVar10;
								if ((code *)piVar7[0x15] != NULL) {
									(*(code *)piVar7[0x15])(param_1,iVar10);
								}
								*(undefined4 *)(param_2 + 0x28) = 1;
								if ((param_2 == *(int *)(*lego::globals::menu::g_MainMenuFull + 0xc)) ||
									 (param_2 == **lego::globals::menu::g_SaveMenu)) {
									INT_004a2f4c = iVar10;
									INT_004a2f5c = iVar10;
								}
							}
							break;
						}
						if (piVar7[7] - piVar7[0xe] <= piVar7[0x13]) break;
						iVar10 = piVar7[0x13] + 1;
					}
					piVar7[0x13] = iVar10;
				}
			}
		}
	}
	if (((lego::globals::g_KeyboardState_Current_TABLE[203] != 0) &&
			(lego::globals::g_KeyboardState_Previous_TABLE[203] !=
			 lego::globals::g_KeyboardState_Current_TABLE[203])) && (true)) {
		switch(puVar14[5]) {
		case 0:
			iVar10 = puVar14[4];
			**(int **)(iVar10 + 0xc) = **(int **)(iVar10 + 0xc) + -1;
			if (**(int **)(iVar10 + 0xc) < 0) {
				**(int **)(iVar10 + 0xc) = *(int *)(iVar10 + 8) + -1;
			}
			break;
		case 2:
			iVar10 = puVar14[4];
			iVar12 = *(int *)(iVar10 + 8) + -1;
			*(int *)(iVar10 + 8) = iVar12;
			if (iVar12 < 0) {
				*(undefined4 *)(iVar10 + 8) = 0;
			}
			break;
		case 3:
			ppiVar4 = (int **)puVar14[4];
			**ppiVar4 = **ppiVar4 + -1;
			if ((int)**ppiVar4 < (int)ppiVar4[1]) {
				**ppiVar4 = (int)ppiVar4[1];
			}
			if (ppiVar4[5] != NULL) {
				(*(code *)ppiVar4[5])(**ppiVar4);
			}
			break;
		case 4:
			ppfVar5 = (float **)puVar14[4];
			**ppfVar5 = **ppfVar5 - (float)ppfVar5[3];
			if ((float)**ppfVar5 < (float)ppfVar5[1]) {
				**ppfVar5 = (float)ppfVar5[1];
			}
			if (ppfVar5[6] != NULL) {
				(*(code *)ppfVar5[6])(**ppfVar5);
			}
		}
	}
	if ((bVar8) && (!bVar9)) {
		iVar10 = puVar14[5];
		if (iVar10 == 0) {
			piVar7 = *(int **)(puVar14[4] + 0xc);
			*piVar7 = (*piVar7 + 1) % *(int *)(puVar14[4] + 8);
		}
		else {
			if (iVar10 == 1) {
				puVar6 = (undefined4 *)puVar14[4];
				if ((code *)puVar6[2] != NULL) {
					(*(code *)puVar6[2])();
				}
				if (puVar6[1] != 0) {
					*(undefined4 *)(param_2 + 0x28) = 1;
					*(undefined4 *)*puVar6 = 1;
				}
			}
			else {
				if (iVar10 == 5) {
					return puVar14[4];
				}
			}
		}
	}
	if (puVar14[5] == 2) {
		piVar7 = (int *)puVar14[4];
		iVar10 = 0;
		do {
			if ((lego::globals::g_KeyboardState_Current_TABLE[iVar10] != 0) &&
				 (lego::globals::g_KeyboardState_Previous_TABLE[iVar10] !=
					lego::globals::g_KeyboardState_Current_TABLE[iVar10])) {
				if ((iVar10 == 0xe) && (iVar12 = piVar7[2], 0 < iVar12)) {
					if (iVar12 < piVar7[1]) {
						do {
							puVar1 = (undefined *)(*piVar7 + iVar12);
							iVar12 += 1;
							puVar1[-1] = *puVar1;
						} while (iVar12 < piVar7[1]);
					}
					piVar7[2] = piVar7[2] + -1;
					piVar7[1] = piVar7[1] + -1;
				}
				if (((piVar7[1] != piVar7[3]) && (piVar7[2] < piVar7[3] + -1)) &&
					 (lego::globals::g_DIKey_CharCodes_TABLE[iVar10] != 0)) {
					iVar12 = piVar7[1] + -1;
					if (piVar7[2] <= iVar12) {
						do {
							puVar1 = (undefined *)(*piVar7 + iVar12);
							iVar12 += -1;
							puVar1[1] = *puVar1;
						} while (piVar7[2] <= iVar12);
					}
					*(undefined *)(*piVar7 + piVar7[2]) =
							 *(undefined *)(lego::globals::g_DIKey_CharCodes_TABLE + iVar10);
					if ((lego::globals::g_KeyboardState_Current_TABLE[42] != 0) ||
						 (lego::globals::g_KeyboardState_Current_TABLE[54] != 0)) {
						*(char *)(*piVar7 + piVar7[2]) = *(char *)(*piVar7 + piVar7[2]) + -0x20;
					}
					piVar7[2] = piVar7[2] + 1;
					piVar7[1] = piVar7[1] + 1;
				}
			}
			iVar10 += 1;
		} while (iVar10 < 0x100);
	}
	return param_2;
}



int __cdecl lego::input::Input_GetKeyCharacter(int diKey)
{
	return globals::g_DIKey_CharCodes_TABLE[diKey];
}



void __cdecl FUN_00411e40(int param_1,uint param_2,uint param_3,int param_4,uint param_5)
{
	float fVar1;
	float fVar2;
	float fVar3;
	ulonglong uVar4;
	int iVar5;
	int iVar6;
	longlong lVar7;
	ImageBMP *bitmap;
	int iVar8;
	float local_20;
	float fStack28;
	uint local_18;
	undefined4 uStack20;
	float local_10;
	undefined4 local_c;
	float local_8;
	undefined4 local_4;
	
	local_18 = param_3;
	uStack20 = 0;
	local_10 = 0.0;
	local_c = 0;
	local_4 = 0x41a00000;
	fVar1 = (float)(ulonglong)((uint)(param_4 * 100) / param_5);
	fVar2 = (float)(ulonglong)param_2;
	uVar4 = (ulonglong)param_3;
	fVar3 = (float)uVar4;
	local_20 = fVar2;
	fStack28 = fVar3;
	local_8 = fVar1;
	lego::image::Image_Blt__0047df70(*(ImageBMP **)(param_1 + 0x1c),&local_10,&local_20,NULL);
	local_8 = 100.0 - fVar1;
	local_20 = fVar2 + fVar1;
	local_c = 0;
	local_4 = 0x41a00000;
	fStack28 = fVar3;
	local_10 = fVar1;
	lego::image::Image_Blt__0047df70(*(ImageBMP **)(param_1 + 0x18),&local_10,&local_20,NULL);
	if (*(ImageBMP **)(param_1 + 0x20) != NULL) {
		local_20 = fVar2;
		fStack28 = fVar3;
		lego::image::Image_Blt__0047df70(*(ImageBMP **)(param_1 + 0x20),NULL,&local_20,NULL);
	}
	if (*(ImageBMP **)(param_1 + 0x24) != NULL) {
		local_20 = fVar2 - -100.0;
		fStack28 = fVar3;
		lego::image::Image_Blt__0047df70(*(ImageBMP **)(param_1 + 0x24),NULL,&local_20,NULL);
	}
	iVar6 = *(int *)(param_1 + 0x2c);
	if ((iVar6 != 0) && (*(int *)(param_1 + 0x34) != 0)) {
		local_20 = fVar2 - (float)(*(int *)(iVar6 + 4) + 4);
		iVar8 = *(int *)(iVar6 + 8);
		iVar6 = *(int *)(iVar6 + 4);
		fStack28 = fVar3;
		lVar7 = __ftol((float10)uVar4);
		iVar5 = (int)lVar7;
		lVar7 = __ftol((float10)local_20);
		iVar6 = FUN_00411210(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y,
												 (int)lVar7,iVar5,iVar6,iVar8);
		if (iVar6 == 0) {
			bitmap = *(ImageBMP **)(param_1 + 0x2c);
		}
		else {
			bitmap = *(ImageBMP **)(param_1 + 0x34);
		}
		lego::image::Image_Blt__0047df70(bitmap,NULL,&local_20,NULL);
	}
	iVar6 = *(int *)(param_1 + 0x28);
	if ((iVar6 != 0) && (*(int *)(param_1 + 0x30) != 0)) {
		local_20 = ((float)*(int *)(*(int *)(param_1 + 0x24) + 4) + fVar2) - -104.0;
		iVar8 = *(int *)(iVar6 + 8);
		iVar6 = *(int *)(iVar6 + 4);
		fStack28 = fVar3;
		lVar7 = __ftol((float10)uVar4);
		iVar5 = (int)lVar7;
		lVar7 = __ftol((float10)local_20);
		iVar6 = FUN_00411210(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y,
												 (int)lVar7,iVar5,iVar6,iVar8);
		if (iVar6 != 0) {
			lego::image::Image_Blt__0047df70(*(ImageBMP **)(param_1 + 0x30),NULL,&local_20,NULL);
			return;
		}
		lego::image::Image_Blt__0047df70(*(ImageBMP **)(param_1 + 0x28),NULL,&local_20,NULL);
	}
	return;
}



int __cdecl FUN_004120a0(int param_1)
{
	int iVar1;
	int iVar2;
	
	iVar2 = 0;
	for (iVar1 = *(int *)(param_1 + 0x40); iVar1 != 0; iVar1 = *(int *)(iVar1 + 0x18)) {
		iVar2 += 1;
	}
	return iVar2;
}



BOOL __cdecl lego::util::randomBool_1_In_400(void)
{
	short sVar1;
	short extraout_var;
	
	sVar1 = randomInt16();
	return (uint)((int)(CONCAT44((int)extraout_var >> 0xf,CONCAT22(extraout_var,sVar1)) % 400) == 0);
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_004120e0(int param_1)
{
	char **ppcVar1;
	short sVar2;
	uint uVar3;
	uint uVar4;
	DWORD DVar5;
	BOOL BVar6;
	undefined2 extraout_var;
	int iVar7;
	undefined4 unaff_EDI;
	ulonglong uVar8;
	ulonglong uVar9;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	if (DAT_0055806c == NULL) {
		ppcVar1 = *(char ***)(param_1 + 0x40);
		if (ppcVar1 != NULL) {
			if (*(int *)(param_1 + 0x9c) == 1) {
				BVar6 = lego::util::randomBool_1_In_400();
				if (BVar6 == 0) {
					uVar3 = 0;
				}
				else {
					uVar3 = FUN_004120a0(param_1);
				}
				if (uVar3 != 0) {
					sVar2 = lego::util::randomInt16();
					for (uVar3 = CONCAT22(extraout_var,sVar2) % uVar3; uVar3 != 0; uVar3 -= 1) {
						ppcVar1 = (char **)ppcVar1[6];
					}
					BVar6 = lego::unk::Lego_CrashesFunc_00483f40(*ppcVar1,(int *)&DAT_0055806c);
					if (BVar6 != 0) {
						lego::snd::Audio_AddToSoundQueue1((int)ppcVar1[5],0);
						_DAT_00558068 = ppcVar1[3];
						_DAT_00558064 = ppcVar1[4];
						TIMEUINT_00558070 = timeGetTime();
						TIMEUINT_00558074 = TIMEUINT_00558070;
						return;
					}
				}
			}
			else {
				if (-1 < INT_004a2f50) {
					for (iVar7 = 4 - INT_004a2f50; iVar7 != 0; iVar7 += -1) {
						ppcVar1 = (char **)ppcVar1[6];
					}
					BVar6 = lego::unk::Lego_CrashesFunc_00483f40(*ppcVar1,(int *)&DAT_0055806c);
					if (BVar6 != 0) {
						lego::snd::Audio_AddToSoundQueue1((int)ppcVar1[5],0);
						_DAT_00558068 = ppcVar1[3];
						_DAT_00558064 = ppcVar1[4];
						TIMEUINT_00558070 = timeGetTime();
						TIMEUINT_00558074 = TIMEUINT_00558070;
					}
					INT_004a2f4c = -1;
					INT_004a2f50 = -1;
					DAT_004dc8c0 = 1;
					return;
				}
				if (-1 < INT_004a2f4c) {
					INT_004a2f50 = INT_004a2f4c;
					DAT_004dc8c8 = 0;
				}
			}
		}
	}
	else {
		uVar3 = lego::res::Res_GetActFrameIsLWSFile(DAT_0055806c);
		uVar4 = FUN_004853a0((int)DAT_0055806c);
		local_10 = (float)(int)_DAT_00558068;
		local_c = (float)(int)_DAT_00558064;
		local_8 = (float)(ulonglong)uVar3;
		local_4 = (float)(ulonglong)uVar4;
		DVar5 = timeGetTime();
		uVar3 = TIMEUINT_00558070;
		uVar8 = __ftol((float10)(ulonglong)(TIMEUINT_00558074 - TIMEUINT_00558070) * (float10)0.025);
		uVar9 = __ftol((float10)(ulonglong)(DVar5 - uVar3) * (float10)0.025);
		if ((DAT_004dc8c0 != 0) &&
			 (uVar9 &= 0xffffffff,
			 (int)(uint)*(ushort *)((int)&DAT_0055806c[0x32].lwsStruct38 + 2) <=
			 (int)DAT_0055806c[0x31].lwsStruct38)) {
			uVar9 = uVar8 & 0xffffffff;
			INT_004a2f50 = -2;
		}
		TIMEUINT_00558074 = DVar5;
		uVar3 = FUN_00484330((uint *)DAT_0055806c,&local_10,(uint)((int)uVar9 != (int)uVar8),0,unaff_EDI
												);
		if (uVar3 == 0) {
			FUN_004841c0((undefined4 *)DAT_0055806c);
			std::free(DAT_0055806c);
			DAT_0055806c = NULL;
			TIMEUINT_00558070 = 0;
			TIMEUINT_00558074 = 0;
			lego::snd::AudioPlayback_Cleanup(0);
		}
		if ((DAT_004dc8c0 != 0) && (lego::globals::g_ButtonState_LeftDown != 0)) {
			INT_004a2f50 = -2;
			DAT_004dc8c0 = 0;
			return;
		}
	}
	return;
}



void __cdecl
FUN_00412380(int param_1,int param_2,undefined4 *param_3,int *param_4,int param_5,int param_6)
{
	ImageBMP *bitmap;
	byte *pbVar1;
	int iVar2;
	float local_8;
	float local_4;
	
	pbVar1 = (byte *)(param_5 * 0x20 + *param_4);
	if ((*pbVar1 & 1) != 0) {
		FUN_0047a440((ImageFont *)param_3,param_1,param_2,*(char **)(pbVar1 + 4));
		return;
	}
	local_4 = (float)param_2;
	local_8 = (float)param_1;
	bitmap = *(ImageBMP **)(*param_4 + 8 + (param_6 + param_5 * 8) * 4);
	if ((((bitmap != NULL) && (param_1 < 0x280)) &&
			(iVar2 = -bitmap->width,
			param_1 != iVar2 && SBORROW4(param_1,iVar2) == param_1 + bitmap->width < 0)) &&
		 ((iVar2 = -bitmap->height,
			param_2 != iVar2 && SBORROW4(param_2,iVar2) == param_2 + bitmap->height < 0 &&
			(param_2 < 0x1e0)))) {
		lego::image::Image_Blt__0047df70(bitmap,NULL,&local_8,NULL);
	}
	return;
}



void __cdecl FUN_00412420(int param_1,int param_2,undefined4 param_3,int param_4)
{
	ImageBMP *bitmap;
	char *pcVar1;
	int iVar2;
	char local_34 [8];
	float local_2c;
	float local_28;
	float local_24;
	float local_20;
	int local_1c;
	undefined4 uStack24;
	char *local_14;
	char *local_10;
	
	if ((param_1 == *(int *)(*lego::globals::menu::g_MainMenuFull + 0xc)) ||
		 (param_1 == **lego::globals::menu::g_SaveMenu)) {
		bitmap = lego::globals::g_SaveSlotImages_TABLE[param_2];
		if (bitmap != NULL) {
			std::sprintf(local_34,"pos%d",param_2 + 1);
			pcVar1 = lego::cfg::CFG_JoinPath
												 (lego::globals::g_Game.CfgRootName,"Menu::SaveImage",local_34,0);
			pcVar1 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar1);
			lego::util::stringSplit(pcVar1,&local_14,"|");
			iVar2 = std::atoi(local_14);
			local_24 = (float)iVar2;
			iVar2 = std::atoi(local_10);
			local_20 = (float)iVar2;
			pcVar1 = lego::cfg::CFG_JoinPath
												 (lego::globals::g_Game.CfgRootName,"Menu::SaveImage","Width",0);
			pcVar1 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar1);
			if (pcVar1 == NULL) {
				pcVar1 = ____EMPTYSTR__;
			}
			else {
				pcVar1 = lego::cfg::CFG_JoinPath
													 (lego::globals::g_Game.CfgRootName,"Menu::SaveImage","Width",0);
				pcVar1 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar1);
			}
			iVar2 = std::atoi(pcVar1);
			local_2c = (float)iVar2;
			pcVar1 = lego::cfg::CFG_JoinPath
												 (lego::globals::g_Game.CfgRootName,"Menu::SaveImage","Height",0);
			pcVar1 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar1);
			if (pcVar1 == NULL) {
				pcVar1 = ____EMPTYSTR__;
			}
			else {
				pcVar1 = lego::cfg::CFG_JoinPath
													 (lego::globals::g_Game.CfgRootName,"Menu::SaveImage","Height",0);
				pcVar1 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar1);
			}
			iVar2 = std::atoi(pcVar1);
			local_28 = (float)iVar2;
			if (param_4 != 0) {
				local_1c = lego::globals::g_Menu_SaveImage_BigSize.height;
				uStack24 = 0;
				local_24 = local_24 -
									 ((float)(ulonglong)(uint)lego::globals::g_Menu_SaveImage_BigSize.width - local_2c
									 ) * 0.25;
				local_20 = local_20 -
									 ((float)(ulonglong)(uint)lego::globals::g_Menu_SaveImage_BigSize.height -
									 local_28) * 0.25;
				local_2c = local_2c -
									 ((float)(ulonglong)(uint)lego::globals::g_Menu_SaveImage_BigSize.width - local_2c
									 ) * -0.5;
				local_28 = local_28 -
									 ((float)(ulonglong)(uint)lego::globals::g_Menu_SaveImage_BigSize.height -
									 local_28) * -0.5;
			}
			lego::image::Image_Blt__0047df70(bitmap,NULL,&local_24,&local_2c);
		}
	}
	return;
}



void __cdecl FUN_00412680(int *param_1,int *param_2,int *param_3)
{
	int *piVar1;
	int iVar2;
	char *pcVar3;
	int iVar4;
	int iVar5;
	longlong lVar6;
	
	iVar2 = *param_1;
	if ((iVar2 != *(int *)(*lego::globals::menu::g_MainMenuFull + 0xc)) &&
		 (iVar2 != **lego::globals::menu::g_SaveMenu)) goto LAB_0041287c;
	if ((iVar2 == **lego::globals::menu::g_SaveMenu) && (-1 < INT_004a2f4c)) {
		if (lego::globals::g_SaveSlotPtrs_TABLE[INT_004a2f4c] == NULL) {
			DAT_00558508 = 0;
			*(undefined4 *)(*param_1 + 0x28) = 1;
		}
		else {
			DAT_004dc8bc = 1;
		}
	}
										// WARNING: Load size is inaccurate
	FUN_00485c70(*lego::globals::g_UnkStruct728_Menu_SaveText);
										// WARNING: Load size is inaccurate
	lego::game::Game_DisplayInfoMessage(*lego::globals::g_UnkStruct728_Menu_SaveText,"\n");
	if (INT_004a2f50 == -2) {
		if (DAT_004dc8c8 != 0) {
			*param_2 = DAT_004dc8c8;
		}
		DAT_004dc8c8 = 0;
		INT_004a2f48 = -1;
		INT_004a2f54 = -1;
LAB_00412766:
		*param_3 = 0;
		INT_004a2f4c = -1;
		pcVar3 = (char *)((int)lego::globals::g_UnkStruct728_Menu_SaveText + 0x28);
		if (*param_1 != *(int *)(*lego::globals::menu::g_MainMenuFull + 0xc)) {
			pcVar3 = (char *)((int)lego::globals::g_UnkStruct728_Menu_SaveText + 0x128);
		}
										// WARNING: Load size is inaccurate
		lego::game::Game_DisplayInfoMessage(*lego::globals::g_UnkStruct728_Menu_SaveText,pcVar3);
	}
	else {
		if (INT_004a2f50 == -1) goto LAB_00412766;
		DAT_004dc8c8 = *param_2;
		*param_2 = *param_3;
		INT_004a2f54 = INT_004a2f50;
	}
	if (INT_004a2f54 < 0) {
		if (-1 < INT_004a2f48) {
			param_2 = (int *)(float)ZEXT48(lego::globals::g_SaveSlotPtrs_TABLE[INT_004a2f48]);
			if ((ushort)((ushort)((float)param_2 < 100.0) << 8 | (ushort)((float)param_2 == 100.0) << 0xe)
					== 0) {
				param_2 = (int *)&DAT_42c80000;
			}
										// WARNING: Load size is inaccurate
			lego::game::Game_DisplayInfoMessage(*lego::globals::g_UnkStruct728_Menu_SaveText,"\n");
			lVar6 = __ftol((float10)(float)param_2);
										// WARNING: Load size is inaccurate
			lego::game::Game_DisplayInfoMessage
								(*lego::globals::g_UnkStruct728_Menu_SaveText,
								 (char *)((int)lego::globals::g_UnkStruct728_Menu_SaveText + 0x228),(int)lVar6);
		}
	}
	else {
										// WARNING: Load size is inaccurate
		FUN_00485c70(*lego::globals::g_UnkStruct728_Menu_SaveText);
		if (*param_1 == *(int *)(*lego::globals::menu::g_MainMenuFull + 0xc)) {
										// WARNING: Load size is inaccurate
			lego::game::Game_DisplayInfoMessage
								(*lego::globals::g_UnkStruct728_Menu_SaveText,
								 (char *)((int)lego::globals::g_UnkStruct728_Menu_SaveText + 0x328),INT_004a2f54 + 1
								 ,0);
		}
	}
										// WARNING: Load size is inaccurate
	if (*lego::globals::g_UnkStruct728_Menu_SaveText != NULL) {
		FUN_00485650(*lego::globals::g_UnkStruct728_Menu_SaveText,0,1.0,NULL);
	}
LAB_0041287c:
	iVar2 = *param_1;
	if (((iVar2 == *(int *)(*lego::globals::menu::g_MainMenuFull + 0xc)) && (true)) &&
		 (iVar5 = 0, 0 < *(int *)(iVar2 + 0x1c))) {
		do {
			iVar2 = *(int *)(*(int *)(iVar2 + 0x18) + iVar5 * 4);
			if (*(int *)(iVar2 + 0x14) == 6) {
				piVar1 = *(int **)(iVar2 + 0x10);
				iVar2 = 0;
				if (0 < piVar1[7]) {
					iVar4 = 0;
					do {
						iVar2 += 1;
						std::sprintf(*(char **)(*piVar1 + 4 + iVar4),"%s %d",
												 lego::globals::menu::g_Menu_LoadGame_text,iVar2);
						iVar4 += 0x20;
					} while (iVar2 < piVar1[7]);
				}
			}
			iVar2 = *param_1;
			iVar5 += 1;
		} while (iVar5 < *(int *)(iVar2 + 0x1c));
	}
	return;
}



void __cdecl FUN_00412900(int *param_1)
{
	void *pvVar1;
	float local_10;
	undefined4 local_c;
	float local_8;
	undefined4 local_4;
	
	pvVar1 = lego::globals::g_UnkStruct728_Menu_LevelText;
	if ((*param_1 == *(int *)(*lego::globals::menu::g_MainMenuFull + 4)) ||
		 (*param_1 == *(int *)(*lego::globals::menu::g_MainMenuFull + 8))) {
		if (*(ImageBMP **)((int)lego::globals::g_UnkStruct728_Menu_LevelText + 4) != NULL) {
			local_8 = *(float *)((int)lego::globals::g_UnkStruct728_Menu_LevelText + 0x18);
			local_4 = *(undefined4 *)((int)lego::globals::g_UnkStruct728_Menu_LevelText + 0x1c);
			local_10 = *(float *)((int)lego::globals::g_UnkStruct728_Menu_LevelText + 0x20);
			local_c = *(undefined4 *)((int)lego::globals::g_UnkStruct728_Menu_LevelText + 0x24);
			lego::image::Image_Blt__0047df70
								(*(ImageBMP **)((int)lego::globals::g_UnkStruct728_Menu_LevelText + 4),NULL,&local_8
								 ,&local_10);
		}
										// WARNING: Load size is inaccurate
		if (*pvVar1 != NULL) {
			FUN_00485650(*pvVar1,0,1.0,NULL);
										// WARNING: Load size is inaccurate
			FUN_00485c70(*pvVar1);
										// WARNING: Load size is inaccurate
			lego::game::Game_DisplayInfoMessage(*pvVar1,"\n");
			if ((*param_1 == *(int *)(*lego::globals::menu::g_MainMenuFull + 4)) &&
				 ((char *)((int)pvVar1 + 0x528) != NULL)) {
										// WARNING: Load size is inaccurate
				lego::game::Game_DisplayInfoMessage(*pvVar1,(char *)((int)pvVar1 + 0x528));
										// WARNING: Load size is inaccurate
				lego::game::Game_DisplayInfoMessage(*pvVar1,"\n");
			}
			if ((*param_1 == *(int *)(*lego::globals::menu::g_MainMenuFull + 8)) &&
				 ((char *)((int)pvVar1 + 0x628) != NULL)) {
										// WARNING: Load size is inaccurate
				lego::game::Game_DisplayInfoMessage(*pvVar1,(char *)((int)pvVar1 + 0x628));
										// WARNING: Load size is inaccurate
				lego::game::Game_DisplayInfoMessage(*pvVar1,"\n");
			}
			BOOL_004dc8c4 = 1;
		}
	}
	return;
}



void __cdecl FUN_00412a20(int param_1,int param_2)
{
	ImageBMP *pIVar1;
	float local_18;
	undefined4 local_14;
	float local_10;
	float local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	if (param_2 == 0) {
		pIVar1 = *(ImageBMP **)(param_1 + 0x14);
		if (pIVar1 != NULL) {
			if ((*(byte *)(param_1 + 0x34) & 1) != 0) {
				lego::image::Image_Blt__0047df70(pIVar1,NULL,(float *)(param_1 + 0x38),NULL);
				return;
			}
			local_10 = -(float)DAT_005584dc;
			local_c = -(float)DAT_005584e0;
			local_8 = 0x44200000;
			local_4 = 0x43f00000;
			local_18 = 0.0;
			local_14 = 0;
			lego::image::Image_Blt__0047df70(pIVar1,&local_10,&local_18,NULL);
		}
	}
	else {
		pIVar1 = *(ImageBMP **)(param_1 + 0x10);
		if (pIVar1 != NULL) {
			if ((*(byte *)(param_1 + 0x34) & 1) != 0) {
				lego::image::Image_Blt__0047df70(pIVar1,NULL,(float *)(param_1 + 0x38),NULL);
				return;
			}
			local_10 = -(float)DAT_005584dc;
			local_c = -(float)DAT_005584e0;
			local_8 = 0x44200000;
			local_4 = 0x43f00000;
			local_18 = 0.0;
			local_14 = 0;
			lego::image::Image_Blt__0047df70(pIVar1,&local_10,&local_18,NULL);
			return;
		}
	}
	return;
}



int __cdecl FUN_00412b30(undefined4 param_1,int param_2,BOOL *out_bool)
{
	ImageFont **ppIVar1;
	char **ppcVar2;
	char *pcVar3;
	char **ppcVar4;
	undefined4 *puVar5;
	int **ppiVar6;
	float **ppfVar7;
	int *piVar8;
	ulonglong uVar9;
	float fVar10;
	void *pvVar11;
	ResourceData *pRVar12;
	char *pcVar13;
	ImageFont *pIVar14;
	BOOL BVar15;
	char *pcVar16;
	int iVar17;
	int iVar18;
	uint *puVar19;
	uint uVar20;
	int iVar21;
	int iVar22;
	int iVar23;
	char *pcVar24;
	int local_864;
	char *local_850;
	float local_84c;
	char local_845;
	int local_844;
	ResourceData *local_840;
	void *local_83c;
	undefined4 uStack2104;
	float local_834;
	float local_830;
	int local_82c;
	undefined4 local_828;
	Vector3F local_824;
	Vector3F local_818;
	Vector3F local_80c;
	byte local_800 [2048];
	
	FUN_00417da0();
	local_828 = FUN_0045cf20();
	pvVar11 = lego::globals::g_Game.ptr_1c;
	local_83c = lego::globals::g_Game.ptr_1c;
	local_840 = (ResourceData *)FUN_00477230((int)lego::globals::g_Game.ptr_1c);
	INT_004a2f4c = -1;
	*(undefined4 *)(param_2 + 0x24) = 0xffffffff;
	if (out_bool != NULL) {
		*out_bool = 0;
	}
	FUN_0045cee0(0);
	local_844 = param_2;
	local_82c = param_2;
	if ((DAT_004dc8bc == 0) && (DAT_004dc8c8 == 0)) {
		local_844 = FUN_00411930(param_1,param_2);
	}
	if (((param_2 == **lego::globals::menu::g_SaveMenu) && (-1 < INT_004a2f4c)) && (INT_004a2f58 < 0))
	{
		*(undefined4 *)(param_2 + 0x28) = 0;
		*(undefined4 *)(local_844 + 0x28) = 0;
	}
	if (-1 < INT_004a2f50) {
		local_844 = local_82c;
	}
	iVar18 = *(int *)(param_2 + 0x2c);
	iVar23 = *(int *)(param_2 + 0x30);
	if ((lego::globals::g_MenuWipeResource != NULL) && (((byte)DAT_005584f0 & 1) != 0)) {
		FUN_004772d0((int)pvVar11,1);
		FUN_004759d0((ResourceData *)lego::globals::g_MenuWipeResource,lego::globals::g_Game.resRoot);
		pRVar12 = (ResourceData *)FUN_00477230((int)pvVar11);
		local_840 = pRVar12;
		lego::res::Res_GetPosition(pRVar12,NULL,&local_80c);
		lego::res::Res_GetOrientation(pRVar12,NULL,&local_818,&local_824);
		lego::res::Res_SetFramePosition(pRVar12,NULL,0.0,0.0,5.0);
		lego::res::Res_SetFrameOrientation(pRVar12,NULL,0.0,0.0,1.0,0.0,1.0,0.0);
		lego::res::Res_DoCallbacks((ResourceData *)lego::globals::g_MenuWipeResource,FLOAT_005584f4);
	}
	FUN_00412a20(param_2,1);
	if (param_2 != **lego::globals::menu::g_SaveMenu) {
		FUN_004120e0(param_2);
	}
	FUN_00412680(&param_2,&local_844,&local_82c);
	if (*(int *)(param_2 + 0x48) != 0) {
		pcVar13 = lego::util::replaceTextSpaces(*(char **)(param_2 + 4));
		pIVar14 = FUN_00401b90(*(ImageFont **)(param_2 + 0xc),pcVar13);
		iVar22 = *(int *)(param_2 + 0x54);
		iVar21 = lego::globals::g_RESOLUTION.width / 2;
		pcVar13 = lego::util::replaceTextSpaces(*(char **)(param_2 + 4));
		FUN_0047a440(*(ImageFont **)(param_2 + 0xc),iVar21 - ((uint)pIVar14 >> 1),iVar22 + iVar23,
								 pcVar13);
	}
	INT_004a2f48 = -1;
	local_834 = 0.0;
	if (0 < *(int *)(param_2 + 0x1c)) {
		do {
			fVar10 = local_834;
			if ((*(float *)(param_2 + 0x24) != local_834) || (DAT_004dc8bc != 0)) {
LAB_004131e8:
				iVar22 = (int)fVar10 * 4;
				ppcVar2 = *(char ***)(*(int *)(param_2 + 0x18) + iVar22);
				pcVar13 = ppcVar2[6];
				pcVar24 = ppcVar2[7];
				pcVar3 = ppcVar2[8];
				ppIVar1 = (ImageFont **)(ppcVar2 + 3);
				if (ppcVar2[3] != NULL) {
					pcVar16 = lego::util::replaceTextSpaces(*ppcVar2);
					FUN_0047a440(*(ImageFont **)(*(int *)(*(int *)(param_2 + 0x18) + iVar22) + 0xc),
											 (int)pcVar3 + (int)pcVar13 + iVar18,(int)(pcVar24 + iVar23),"%s",pcVar16);
				}
				iVar22 = *(int *)(*(int *)(param_2 + 0x18) + iVar22);
				if (true) {
					switch(*(undefined4 *)(iVar22 + 0x14)) {
					case 0:
						piVar8 = *(int **)(iVar22 + 0x10);
						if (*ppIVar1 != NULL) {
							pcVar16 = lego::util::replaceTextSpaces(*(char **)(*piVar8 + *(int *)piVar8[3] * 4));
							pcVar24 = pcVar24 + iVar23 + piVar8[5];
							pIVar14 = *ppIVar1;
							pcVar13 = pcVar13 + (int)(pcVar3 + piVar8[4] + iVar18);
							goto LAB_004134b2;
						}
						break;
					case 2:
						ppcVar2 = *(char ***)(iVar22 + 0x10);
						if (*ppIVar1 != NULL) {
							pcVar16 = lego::util::replaceTextSpaces(*ppcVar2);
							FUN_0047a440(*ppIVar1,(int)(pcVar13 + (int)(ppcVar2[4] + (int)pcVar3 + iVar18)),
													 (int)ppcVar2[5] + (int)pcVar24 + iVar23,"%s",pcVar16);
						}
						break;
					case 3:
						ppiVar6 = *(int ***)(iVar22 + 0x10);
						FUN_00411e40((int)ppiVar6,(int)ppiVar6[3] + (int)pcVar13 + iVar18,
												 (int)ppiVar6[4] + (int)pcVar24 + iVar23,**ppiVar6 - (int)ppiVar6[1],
												 (uint)((int)ppiVar6[2] - (int)ppiVar6[1]));
						break;
					case 4:
						ppfVar7 = *(float ***)(iVar22 + 0x10);
						if (*ppIVar1 != NULL) {
							FUN_0047a440(*ppIVar1,(int)(pcVar13 + iVar18 + (int)ppfVar7[4] + (int)pcVar3),
													 (int)ppfVar7[5] + (int)pcVar24 + iVar23,"%.2f",(double)**ppfVar7);
						}
						break;
					case 6:
						piVar8 = *(int **)(iVar22 + 0x10);
						iVar22 = 0;
						if (0 < piVar8[0xe]) {
							do {
								local_850 = (char *)(iVar22 + piVar8[0x13]);
								if (piVar8[7] <= (int)local_850) break;
								iVar21 = -(*(int *)(piVar8[1] + (int)local_850 * 4) / 2);
								puVar19 = (uint *)((int)local_850 * 0x20 + *piVar8);
								uVar20 = ~*puVar19 >> 1 & 2;
								if (*(int *)(param_2 + 0x44) == 0) {
									iVar21 = 0;
								}
								if (uVar20 == 0) {
									uVar20 = 1;
								}
								FUN_00412380((int)(pcVar13 +
																	DAT_005584dc + iVar18 + piVar8[0xb] + puVar19[5] + iVar21),
														 (int)(pcVar24 +
																	DAT_005584e0 +
																	iVar23 + piVar8[0xd] * iVar22 + piVar8[0xc] + puVar19[6]),
														 (undefined4 *)*ppIVar1,piVar8,(int)local_850,uVar20);
								FUN_00412420(param_2,iVar22 + piVar8[0x13],piVar8,0);
								iVar22 += 1;
							} while (iVar22 < piVar8[0xe]);
						}
						if ((piVar8[0x13] < piVar8[7] - piVar8[0xe]) && (*ppIVar1 != NULL)) {
							FUN_0047a440(*ppIVar1,piVar8[0xf] + iVar18,piVar8[0x10] + iVar23,(char *)piVar8[8]);
						}
						if ((0 < piVar8[0x13]) && (pIVar14 = *ppIVar1, pIVar14 != NULL)) {
							pcVar16 = (char *)piVar8[9];
							pcVar24 = (char *)piVar8[0x12];
							pcVar13 = (char *)piVar8[0x11];
							goto LAB_004134b1;
						}
					}
				}
				goto switchD_00413263_caseD_1;
			}
			iVar22 = (int)local_834 * 4;
			BVar15 = FUN_00411900(*(int *)(*(int *)(param_2 + 0x18) + iVar22));
			if (BVar15 != 0) goto LAB_004131e8;
			ppcVar2 = *(char ***)(*(int *)(param_2 + 0x18) + iVar22);
			pcVar24 = ppcVar2[7];
			pcVar13 = ppcVar2[6];
			pcVar3 = ppcVar2[9];
			local_850 = pcVar13;
			if (ppcVar2[2] != NULL) {
				pcVar16 = lego::util::replaceTextSpaces(*ppcVar2);
				FUN_0047a440((ImageFont *)ppcVar2[2],(int)pcVar3 + (int)pcVar13 + iVar18,
										 (int)(pcVar24 + iVar23),"%s",pcVar16);
			}
			iVar21 = *(int *)(*(int *)(param_2 + 0x18) + *(int *)(param_2 + 0x24) * 4);
			if (false) goto switchD_00413263_caseD_1;
			switch(*(undefined4 *)(iVar21 + 0x14)) {
			case 0:
				piVar8 = *(int **)(iVar21 + 0x10);
				if (ppcVar2[2] == NULL) break;
				pcVar16 = lego::util::replaceTextSpaces(*(char **)(*piVar8 + *(int *)piVar8[3] * 4));
				pcVar24 = pcVar24 + piVar8[5];
				pIVar14 = (ImageFont *)ppcVar2[2];
				pcVar13 = local_850 + (int)(pcVar3 + piVar8[4]);
LAB_004134b1:
				pcVar24 = pcVar24 + iVar23;
				pcVar13 = pcVar13 + iVar18;
				goto LAB_004134b2;
			case 2:
				ppcVar4 = *(char ***)(iVar21 + 0x10);
				local_845 = (*ppcVar4)[(int)ppcVar4[2]];
				DAT_004dc8dc += 1;
				if ((DAT_004dc8dc != 0) &&
					 (uVar20 = DAT_004dc8dc / 2 >> 0x1f,
					 ((DAT_004dc8dc / 2 ^ uVar20) - uVar20 & 1 ^ uVar20) != uVar20)) {
					(*ppcVar4)[(int)ppcVar4[2]] = '_';
				}
				if (ppcVar2[2] != NULL) {
					pcVar13 = lego::util::replaceTextSpaces(*ppcVar4);
					FUN_0047a440((ImageFont *)ppcVar2[2],
											 (int)(local_850 + (int)(ppcVar4[4] + (int)pcVar3 + iVar18)),
											 (int)ppcVar4[5] + (int)pcVar24 + iVar23,"%s",pcVar13);
				}
				if ((DAT_004dc8dc != 0) &&
					 (uVar20 = DAT_004dc8dc / 2 >> 0x1f,
					 ((DAT_004dc8dc / 2 ^ uVar20) - uVar20 & 1 ^ uVar20) != uVar20)) {
					(*ppcVar4)[(int)ppcVar4[2]] = local_845;
				}
				break;
			case 3:
				ppiVar6 = *(int ***)(iVar21 + 0x10);
				FUN_00411e40((int)ppiVar6,(int)ppiVar6[3] + (int)pcVar13 + iVar18,
										 (int)ppiVar6[4] + (int)pcVar24 + iVar23,**ppiVar6 - (int)ppiVar6[1],
										 (uint)((int)ppiVar6[2] - (int)ppiVar6[1]));
				break;
			case 4:
				ppfVar7 = *(float ***)(iVar21 + 0x10);
				if ((ImageFont *)ppcVar2[2] != NULL) {
					FUN_0047a440((ImageFont *)ppcVar2[2],
											 (int)(pcVar13 + iVar18 + (int)ppfVar7[4] + (int)pcVar3),
											 (int)ppfVar7[5] + (int)pcVar24 + iVar23,"%.2f",(double)**ppfVar7);
				}
				break;
			case 6:
				puVar5 = *(undefined4 **)(*(int *)(param_2 + 0x18) + iVar22);
				piVar8 = (int *)puVar5[4];
				iVar22 = FUN_00411290(param_2,puVar5,piVar8);
				local_864 = 0;
				INT_004a2f48 = iVar22;
				if (0 < piVar8[0xe]) {
					do {
						iVar21 = piVar8[0x13] + local_864;
						if (piVar8[7] <= iVar21) break;
						puVar19 = (uint *)(iVar21 * 0x20 + *piVar8);
						iVar17 = -(*(int *)(piVar8[1] + iVar21 * 4) / 2);
						uVar20 = ~*puVar19 >> 1 & 2;
						if (*(int *)(param_2 + 0x44) == 0) {
							iVar17 = 0;
						}
						if (iVar22 == iVar21) {
							FUN_00412380((int)(local_850 +
																DAT_005584dc + iVar18 + piVar8[0xb] + puVar19[5] + iVar17),
													 (int)(pcVar24 +
																DAT_005584e0 +
																iVar23 + piVar8[0xd] * local_864 + piVar8[0xc] + puVar19[6]),
													 (undefined4 *)ppcVar2[2],piVar8,iVar21,uVar20);
							if ((code *)piVar8[0x15] != NULL) {
								(*(code *)piVar8[0x15])();
							}
							iVar21 = 1;
						}
						else {
							if (uVar20 == 0) {
								uVar20 = 1;
							}
							FUN_00412380((int)(local_850 +
																DAT_005584dc + iVar18 + piVar8[0xb] + puVar19[5] + iVar17),
													 (int)(pcVar24 +
																DAT_005584e0 +
																iVar23 + piVar8[0xd] * local_864 + piVar8[0xc] + puVar19[6]),
													 (undefined4 *)ppcVar2[3],piVar8,iVar21,uVar20);
							iVar21 = 0;
						}
						FUN_00412420(param_2,local_864 + piVar8[0x13],piVar8,iVar21);
						local_864 += 1;
					} while (local_864 < piVar8[0xe]);
				}
				if ((iVar22 == -2) && (piVar8[0x13] < piVar8[7] - piVar8[0xe])) {
					pIVar14 = (ImageFont *)ppcVar2[2];
joined_r0x00413184:
					if (pIVar14 != NULL) {
						FUN_0047a440(pIVar14,piVar8[0xf] + iVar18,piVar8[0x10] + iVar23,(char *)piVar8[8]);
					}
				}
				else {
					if (piVar8[0x13] < piVar8[7] - piVar8[0xe]) {
						pIVar14 = (ImageFont *)ppcVar2[3];
						goto joined_r0x00413184;
					}
				}
				if (iVar22 != -3) {
					if (0 < piVar8[0x13]) {
						pIVar14 = (ImageFont *)ppcVar2[3];
						goto LAB_004131c3;
					}
					break;
				}
				if (piVar8[0x13] < 1) break;
				pIVar14 = (ImageFont *)ppcVar2[2];
LAB_004131c3:
				if (pIVar14 == NULL) break;
				pcVar16 = (char *)piVar8[9];
				pcVar24 = (char *)(piVar8[0x12] + iVar23);
				pcVar13 = (char *)(piVar8[0x11] + iVar18);
LAB_004134b2:
				FUN_0047a440(pIVar14,(int)pcVar13,(int)pcVar24,pcVar16);
			}
switchD_00413263_caseD_1:
			local_834 = (float)((int)local_834 + 1);
		} while ((int)local_834 < *(int *)(param_2 + 0x1c));
	}
	FUN_00412900(&param_2);
	iVar23 = 0;
	iVar18 = param_2;
	if (0 < *(int *)(param_2 + 0x1c)) {
		do {
			iVar22 = *(int *)(*(int *)(iVar18 + 0x18) + iVar23 * 4);
			if (*(int *)(iVar22 + 0x28) != 0) {
				if (*(int *)(iVar18 + 0x24) == iVar23) {
					if (*(ImageBMP **)(iVar22 + 0x30) != NULL) {
						local_834 = (float)(*(int *)(iVar22 + 0x18) + *(int *)(iVar18 + 0x2c));
						local_830 = (float)(*(int *)(iVar22 + 0x1c) + *(int *)(iVar18 + 0x30));
						lego::image::Image_Blt__0047df70(*(ImageBMP **)(iVar22 + 0x30),NULL,&local_834,NULL);
					}
					FUN_0046ba30(*(int *)(iVar22 + 0x34));
					iVar18 = param_2;
				}
				else {
					if (*(ImageBMP **)(iVar22 + 0x2c) != NULL) {
						local_850 = (char *)(float)(*(int *)(iVar22 + 0x18) + *(int *)(iVar18 + 0x2c));
						local_84c = (float)(*(int *)(iVar22 + 0x1c) + *(int *)(iVar18 + 0x30));
						lego::image::Image_Blt__0047df70
											(*(ImageBMP **)(iVar22 + 0x2c),NULL,(float *)&local_850,NULL);
						iVar18 = param_2;
					}
				}
			}
			iVar23 += 1;
		} while (iVar23 < *(int *)(iVar18 + 0x1c));
	}
	if (((((lego::globals::g_CMDLINE_FLAGS & CMD_SHOWVERSION) != CMD_NONE) && (FONT_00558078 != NULL))
			&& (lego::globals::g_Main_Version != NULL)) &&
		 (lego::globals::g_PROGRAMMER_MODE == PROGRAMMER_OFF)) {
		FUN_0047a440(FONT_00558078,0x221,0x1c2,lego::globals::g_Main_Version);
	}
	FUN_00410250(0,0,0,NULL);
	if ((param_2 == **lego::globals::menu::g_SaveMenu) && (DAT_004dc8bc != 0)) {
		std::sprintf((char *)local_800,lego::globals::menu::g_MenuOverwrite_Text);
		INT_004a2f58 = FUN_004354f0((byte *)lego::globals::menu::g_MenuOverwrite_Title,local_800,
																(byte *)lego::globals::menu::g_MenuOverwrite_Ok,
																(byte *)lego::globals::menu::g_MenuOverwrite_Cancel);
		if (INT_004a2f58 == 0) {
			DAT_00558508 = 1;
			*(undefined4 *)(param_2 + 0x28) = 1;
			DAT_004dc8bc = 0;
			INT_004a2f5c = -1;
		}
		else {
			if (INT_004a2f58 == 1) {
				DAT_00558508 = 0;
				*(undefined4 *)(param_2 + 0x28) = 1;
				DAT_004dc8bc = 0;
			}
		}
	}
	if ((lego::globals::g_MenuWipeResource != NULL) && (((byte)DAT_005584f0 & 1) != 0)) {
		lego::res::Res_UnkSetup3DFrameTransform(PTR_005584fc,0);
		lego::view::Viewport_FUN_00477410((float)local_83c,lego::globals::g_Game.resRoot,0);
		lego::res::Res_UnkSetup3DFrameTransform(PTR_005584fc,1);
		pRVar12 = local_840;
		lego::res::Res_SetFramePosition(local_840,NULL,local_80c.x,local_80c.y,local_80c.z);
		lego::res::Res_SetFrameOrientation
							(pRVar12,NULL,local_818.x,local_818.y,local_818.z,local_824.x,local_824.y,local_824.z)
		;
		FUN_004759d0((ResourceData *)lego::globals::g_MenuWipeResource,NULL);
		local_83c = (void *)lego::res::Res_GetAnimAppData_Fieldc
																	((ResourceData *)lego::globals::g_MenuWipeResource);
		uStack2104 = 0;
		local_840 = (ResourceData *)(float)ZEXT48(local_83c);
		local_83c = (void *)timeGetTime();
		uStack2104 = 0;
		uVar9 = ZEXT48(local_83c);
		fVar10 = ((float)uVar9 - FLOAT_005584f8) * 0.001 * 25.0;
		local_850 = (char *)(fVar10 + fVar10);
		if ((ushort)((ushort)((float)local_850 < 3.0) << 8 | (ushort)((float)local_850 == 3.0) << 0xe)
				== 0) {
			local_850 = (char *)0x40400000;
		}
		fVar10 = (float)local_840 * 0.5;
		if (((ushort)((ushort)(FLOAT_005584f4 < fVar10) << 8 | (ushort)(FLOAT_005584f4 == fVar10) << 0xe
								 ) != 0) && (fVar10 <= (float)local_850 + FLOAT_005584f4)) {
			if (out_bool != NULL) {
				*out_bool = 1;
			}
			INT_004a2f50 = -1;
			INT_004a2f4c = -1;
			DAT_004dc8c8 = 0;
			DAT_004dc8c0 = 0;
			if (DAT_0055806c != 0) {
				TIMEUINT_00558070 = 0;
				TIMEUINT_00558074 = 0;
			}
		}
		if ((ushort)((ushort)(FLOAT_005584f4 < (float)local_840) << 8 |
								(ushort)(FLOAT_005584f4 == (float)local_840) << 0xe) == 0) {
			FUN_00410370();
		}
		FLOAT_005584f4 = (float)local_850 + FLOAT_005584f4;
		FLOAT_005584f8 = (float)uVar9;
	}
	FUN_0045cf30(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y);
	FUN_0045cee0(local_828);
	return local_844;
}



void __cdecl FUN_004138a0(int param_1)
{
	int iVar1;
	float fVar2;
	float10 fVar3;
	longlong lVar4;
	
	if ((*(int *)(param_1 + 0x10) == 0) || ((*(byte *)(param_1 + 0x34) & 2) == 0)) {
		DAT_005584dc = 0;
		DAT_005584e0 = 0;
	}
	else {
		fVar2 = (float)lego::globals::g_MousePosition.y;
		if (((ushort)((ushort)(fVar2 < 280.0) << 8 | (ushort)(fVar2 == 280.0) << 0xe) == 0) ||
			 (fVar2 < 200.0)) {
			iVar1 = *(int *)(*(int *)(param_1 + 0x10) + 8);
			if ((fVar2 < 480.0) &&
				 ((lego::globals::g_ButtonState_LeftDown == 0 &&
					(lego::globals::g_ButtonState_RightDown == 0)))) {
				fVar3 = (float10)lego::globals::g_MousePosition.y * (float10)0.2083333 - (float10)50.0;
				fVar3 = fVar3 * fVar3 * (float10)0.02;
				if (fVar2 < 240.0) {
					fVar3 = -fVar3;
				}
				lVar4 = __ftol(fVar3 * (float10)-0.25);
				DAT_005584e0 += (int)lVar4;
			}
			if (0 < DAT_005584e0) {
				DAT_005584e0 = 0;
			}
			if (SBORROW4(DAT_005584e0 + -0x1e0,-iVar1) != DAT_005584e0 + -0x1e0 + iVar1 < 0) {
				DAT_005584e0 = 0x1e0 - iVar1;
				return;
			}
		}
	}
	return;
}



void __cdecl FUN_00413990(void)
{
	char *pcVar1;
	ImageBMP *pIVar2;
	int iVar3;
	float *pfVar4;
	uint saveIndex;
	ImageBMP **ppIVar5;
	void **ppvVar6;
	int iVar7;
	undefined4 *puVar8;
	undefined4 local_b8;
	undefined4 local_b4 [5];
	uint local_a0;
	void *local_84;
	
	iVar7 = 0;
	ppIVar5 = lego::globals::g_SaveSlotImages_TABLE;
	do {
		pcVar1 = lego::cfg::CFG_JoinPath
											 (lego::globals::g_Game.CfgRootName,"Menu::SaveImage","Path",0,iVar7);
		pcVar1 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar1);
		std::sprintf((char *)&local_b8,"%s\\%d.dat",pcVar1);
		pIVar2 = lego::image::Image_LoadBMP((char *)&local_b8,0,0);
		*ppIVar5 = pIVar2;
		ppIVar5 = ppIVar5 + 1;
		iVar7 += 1;
	} while (ppIVar5 < &DAT_004dc8a4);
	saveIndex = 0;
	ppvVar6 = lego::globals::g_SaveSlotPtrs_TABLE;
	do {
		local_b8 = 0;
		puVar8 = local_b4;
		for (iVar7 = 0x2d; iVar7 != 0; iVar7 += -1) {
			*puVar8 = 0;
			puVar8 = puVar8 + 1;
		}
		lego::game::Game_UnkLoadSaveSlot__004179c0(saveIndex,&local_b8,1);
		*ppvVar6 = NULL;
		if (8 < local_a0) {
			pfVar4 = (float *)((int)local_84 + 0x1bc38);
			iVar7 = local_a0 - 8;
			do {
				if (*pfVar4 == 0.0) {
					iVar3 = 0;
				}
				else {
					iVar3 = 4;
				}
				*ppvVar6 = (void *)((int)*ppvVar6 + iVar3);
				pfVar4 = pfVar4 + 0xc64;
				iVar7 += -1;
			} while (iVar7 != 0);
		}
		std::free(local_84);
		ppvVar6 = ppvVar6 + 1;
		saveIndex += 1;
	} while (ppvVar6 < &DAT_004dc8bc);
	return;
}



void __cdecl FUN_00413a80(void)
{
	ImageBMP **ppIVar1;
	
	ppIVar1 = lego::globals::g_SaveSlotImages_TABLE;
	do {
		if (*ppIVar1 != NULL) {
			lego::pool::ReservedPool_ImageBMP___Release(*ppIVar1);
		}
		ppIVar1 = ppIVar1 + 1;
	} while (ppIVar1 < &DAT_004dc8a4);
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl lego::front::MenuLoop_FUN_00413ab0(int param_1)
{
	bool bVar1;
	float milliseconds;
	DWORD DVar2;
	int iVar3;
	char *pcVar4;
	BOOL local_98;
	int local_94;
	float local_90;
	DWORD local_8c;
	uint local_88;
	undefined4 uStack132;
	char local_80 [128];
	
	bVar1 = false;
	local_98 = 0;
	local_90 = 1.0;
	FUN_00413990();
	DAT_004dc8c8 = 0;
	INT_004a2f50 = -1;
	INT_004a2f4c = -1;
	INT_004a2f54 = -1;
	INT_004a2f58 = -1;
	INT_004a2f5c = -1;
	DAT_004dc8c0 = 0;
	DAT_004dc8bc = 0;
	BOOL_004dc8c4 = 0;
	_DAT_00558504 = 1;
	DAT_00558508 = 1;
	DAT_0055806c = NULL;
	local_8c = timeGetTime();
	iVar3 = *(int *)(param_1 + 0x28);
	milliseconds = local_90;
	while (local_90 = milliseconds, iVar3 == 0) {
		if (bVar1) {
			FUN_00412b30(milliseconds,param_1,&local_98);
		}
		else {
			local_94 = FUN_00412b30(milliseconds,param_1,NULL);
		}
		if ((param_1 == **globals::menu::g_MainMenuFull) && (local_94 != param_1)) {
			INT_00558028 = -1;
			FUN_00414fe0(milliseconds,-1);
		}
		FUN_004138a0(param_1);
		FUN_0046ba80(globals::g_MousePosition.x,globals::g_MousePosition.y,milliseconds);
		FUN_00465460(milliseconds);
		main::Main_UpdateAndRender__004781f0(0);
		DVar2 = timeGetTime();
		iVar3 = local_94;
		local_88 = DVar2 - local_8c;
		uStack132 = 0;
		local_90 = (float)(ulonglong)local_88 * 0.025;
		local_8c = DVar2;
		if ((!bVar1) && (local_94 != param_1)) {
			FUN_00410320();
			bVar1 = true;
			if (globals::g_MenuWipeResource == NULL) {
				local_98 = 1;
			}
		}
		if ((bVar1) && (local_98 != 0)) {
			if ((*(int *)(param_1 + 0x10) != *(int *)(iVar3 + 0x10)) && (DAT_0055806c != NULL)) {
				FUN_004841c0(DAT_0055806c);
				std::free(DAT_0055806c);
				snd::AudioPlayback_Cleanup(0);
				DAT_0055806c = NULL;
				TIMEUINT_00558070 = 0;
				TIMEUINT_00558074 = 0;
			}
			DAT_005584e0 = 0;
			DAT_005584dc = 0;
			bVar1 = false;
			local_98 = 0;
			param_1 = iVar3;
		}
		milliseconds = local_90;
		iVar3 = *(int *)(param_1 + 0x28);
	}
	FUN_00413a80();
	if ((((local_94 == **globals::menu::g_SaveMenu) && (-1 < INT_004a2f5c)) &&
			(iVar3 = local_94, FUN_004604c0(), iVar3 != 0)) && (FUN_004604c0(), *(int *)(iVar3 + 4) != 0))
	{
		pcVar4 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu::SaveImage","Path",0);
		pcVar4 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar4);
		std::sprintf(local_80,"%s\\%d.dat",pcVar4,INT_004a2f5c);
		FUN_0047e700((int **)(iVar3 + 8),local_80);
	}
	if (DAT_0055806c != NULL) {
		FUN_004841c0(DAT_0055806c);
		std::free(DAT_0055806c);
		snd::AudioPlayback_Cleanup(0);
		DAT_0055806c = NULL;
		TIMEUINT_00558070 = 0;
		TIMEUINT_00558074 = 0;
	}
	FUN_00410370();
	return;
}



void __cdecl lego::front::Menu_FUN_00413d50(int *param_1,int param_2)
{
	int iVar1;
	
	iVar1 = 0;
	if (0 < param_1[1]) {
		do {
			iVar1 += 1;
			*(undefined4 *)(*(int *)(*param_1 + -4 + iVar1 * 4) + 0x28) = 0;
		} while (iVar1 < param_1[1]);
	}
	MenuLoop_FUN_00413ab0(*(int *)(*param_1 + param_2 * 4));
	return;
}



MenuItemType __cdecl lego::menu::Menu_ParseMenuControlType(char *controlName)
{
	int iVar1;
	
	iVar1 = std::_stricmp(controlName,"cycle");
	if (iVar1 == 0) {
		return MENUITEM_CYCLE;
	}
	iVar1 = std::_stricmp(controlName,"trigger");
	if (iVar1 == 0) {
		return MENUITEM_TRIGGER;
	}
	iVar1 = std::_stricmp(controlName,"textinput");
	if (iVar1 == 0) {
		return MENUITEM_TEXTINPUT;
	}
	iVar1 = std::_stricmp(controlName,"slider");
	if (iVar1 == 0) {
		return MENUITEM_SLIDER;
	}
	iVar1 = std::_stricmp(controlName,"realslider");
	if (iVar1 == 0) {
		return MENUITEM_REALSLIDER;
	}
	iVar1 = std::_stricmp(controlName,"next");
	return (-(uint)(iVar1 != 0) & 0xfffffffa) + MENUITEM_NEXT;
}



char * __cdecl lego::util::stringReplaceChar(char *text,char origChar,char newChar)
{
	char *pcVar1;
	char *pcVar2;
	char c;
	
	c = *text;
	pcVar2 = text;
	while (c != '\0') {
		if (c == origChar) {
			*pcVar2 = newChar;
		}
		pcVar1 = pcVar2 + 1;
		pcVar2 = pcVar2 + 1;
		c = *pcVar1;
	}
	return text;
}



int __cdecl FUN_00413e60(char **param_1)
{
	char *pcVar1;
	char cVar2;
	int iVar3;
	char *_Str2;
	
	_Str2 = *param_1;
	cVar2 = *_Str2;
	while (cVar2 != '.') {
		pcVar1 = _Str2 + 1;
		_Str2 = _Str2 + 1;
		cVar2 = *pcVar1;
	}
	iVar3 = std::_stricmp(".avi",_Str2);
	if (iVar3 != 0) {
		iVar3 = std::_stricmp(".bmp",_Str2);
		if (iVar3 != 0) {
			iVar3 = std::_stricmp(".lws",_Str2);
			return (-(uint)(iVar3 != 0) & 0xfffffffd) + 3;
		}
		return 2;
	}
	return 1;
}



char ** __cdecl FUN_00413ec0(char *param_1,char **param_2,char *param_3,char *param_4,char *param_5)
{
	char **ppcVar1;
	undefined4 *puVar2;
	char *pcVar3;
	int iVar4;
	char **ppcVar5;
	
	ppcVar1 = (char **)std::malloc(0x20);
	ppcVar5 = ppcVar1;
	for (iVar4 = 8; iVar4 != 0; iVar4 += -1) {
		*ppcVar5 = NULL;
		ppcVar5 = ppcVar5 + 1;
	}
	iVar4 = std::_strnicmp(param_1,"Null",4);
	if (iVar4 != 0) {
		if (param_1 != NULL) {
			puVar2 = FUN_004104d0(param_1);
			*ppcVar1 = (char *)puVar2;
		}
		pcVar3 = (char *)FUN_00413e60(ppcVar1);
		ppcVar1[1] = pcVar3;
		ppcVar1[7] = NULL;
		pcVar3 = *param_2;
		ppcVar1[3] = param_3;
		ppcVar1[6] = pcVar3;
		ppcVar1[5] = param_5;
		ppcVar1[4] = param_4;
		*param_2 = (char *)ppcVar1;
	}
	return ppcVar1;
}



void __cdecl FUN_00413f40(int param_1,int param_2,int **param_3)
{
	ImageBMP *image;
	int iVar1;
	char **ppcVar2;
	
	if (param_1 == 0x10) {
		ppcVar2 = (char **)(param_2 + 0x20);
		iVar1 = 8;
		do {
			image = (ImageBMP *)FUN_00410450(*ppcVar2);
			*param_3 = (int *)image;
			if (image != NULL) {
				lego::image::Image_SetFirstColorAsKey(image);
			}
			ppcVar2 = ppcVar2 + 1;
			param_3 = (int **)((ImageBMP **)param_3 + 1);
			iVar1 += -1;
		} while (iVar1 != 0);
		return;
	}
	for (iVar1 = 8; iVar1 != 0; iVar1 += -1) {
		*param_3 = NULL;
		param_3 = param_3 + 1;
	}
	return;
}



undefined4 * __cdecl FUN_00413fa0(uint param_1)
{
	undefined4 *puVar1;
	undefined4 *puVar2;
	uint uVar3;
	int iVar4;
	
	puVar1 = (undefined4 *)std::malloc(8);
	*puVar1 = 0;
	puVar1[1] = 0;
	puVar2 = (undefined4 *)std::malloc(param_1 * 4);
	uVar3 = param_1 & 0x3fffffff;
	*puVar1 = puVar2;
	for (; uVar3 != 0; uVar3 -= 1) {
		*puVar2 = 0;
		puVar2 = puVar2 + 1;
	}
	for (iVar4 = 0; iVar4 != 0; iVar4 += -1) {
		*(undefined *)puVar2 = 0;
		puVar2 = (undefined4 *)((int)puVar2 + 1);
	}
	puVar1[1] = param_1;
	return puVar1;
}



int * __cdecl
lego::menu::Menu_ParseMenu(undefined param_1,char *menuName,void *dst,void *callback,...)
{
	char *pcVar1;
	uint uVar2;
	int *piVar3;
	char *pcVar4;
	char *pcVar5;
	int iVar6;
	int iVar7;
	ImageFont *pIVar8;
	uint uVar9;
	ImageFont *pIVar10;
	char *pcVar11;
	int *piVar12;
	MenuItemType MVar13;
	int *piVar14;
	int iVar15;
	int iVar16;
	int iVar17;
	undefined4 *puVar18;
	int iVar19;
	int iVar20;
	void **ppvVar21;
	void **ppvVar22;
	float10 fVar23;
	void *pvVar24;
	ImageFont *pIVar25;
	ImageFont *pIVar26;
	undefined4 uVar27;
	float fVar28;
	undefined4 uVar29;
	float fVar30;
	void *pvVar31;
	undefined4 uVar32;
	undefined4 uVar33;
	undefined4 uVar34;
	undefined4 uVar35;
	undefined4 uVar36;
	char *pcVar37;
	undefined4 uVar38;
	char **local_dd0;
	char *local_dcc;
	int local_dc8;
	char *local_dc4;
	char *local_dc0;
	uint local_dbc;
	int local_db8;
	int local_db4;
	int *local_db0;
	undefined4 local_dac;
	undefined4 local_da8;
	undefined4 local_da4;
	undefined4 local_da0;
	undefined4 local_d9c;
	undefined4 local_d98;
	undefined4 local_d94;
	char *local_d90;
	char *local_d8c;
	char *local_d88;
	char *local_d84;
	char *local_d80;
	char *local_d7c;
	char *local_d78;
	char *local_d74;
	char *local_d70;
	char local_c00 [1024];
	char local_800 [1024];
	char local_400 [1024];
	
	ppvVar21 = &dst;
	std::sprintf(local_400,"Menu::%s",menuName);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_400,"MenuCount",0);
	pcVar1 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
	if (pcVar1 == NULL) {
		pcVar1 = ____EMPTYSTR__;
	}
	else {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_400,"MenuCount",0);
		pcVar1 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
	}
	uVar2 = std::atoi(pcVar1);
	local_dbc = uVar2;
	piVar3 = FUN_00413fa0(uVar2);
	iVar20 = 0;
	if (0 < (int)uVar2) {
		do {
			local_db8 = iVar20 + 1;
			local_dc8 = 0;
			std::sprintf(local_c00,"%s::Menu%i",local_400,local_db8);
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"Title",0);
			pcVar1 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
			pcVar4 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"FullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar4);
			pcVar5 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"Position",0);
			pcVar5 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar5);
			util::stringSplit(pcVar5,&local_d90,":");
			iVar6 = std::atoi(local_d90);
			iVar7 = std::atoi(local_d8c);
			if (pcVar5 != NULL) {
				std::free(pcVar5);
			}
			pcVar5 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"MenuFont",0);
			pcVar5 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar5);
			pIVar8 = (ImageFont *)FUN_00410490(pcVar5);
			pcVar5 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"AutoCenter",0);
			uVar2 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,pcVar5);
			uVar2 = (uint)(uVar2 == 1);
			pcVar5 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"DisplayTitle",0);
			uVar9 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,pcVar5);
			local_dc4 = (char *)(uint)(uVar9 != 0);
			pcVar5 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"Anchored",0);
			local_dc0 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar5);
			if (((uVar2 != 0) && (pcVar1 != NULL)) && (*pcVar1 != '\0')) {
				pIVar10 = FUN_00401b90(pIVar8,pcVar1);
				local_dc8 = -((int)pIVar10 / 2);
			}
			iVar20 *= 4;
			pcVar37 = local_dc0;
			pcVar5 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"CanScroll",0);
			uVar9 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,pcVar5);
			uVar9 = (uint)(uVar9 == 1);
			pcVar5 = local_dc4;
			pcVar4 = util::stringReplaceChar(pcVar4,'_',' ');
			pcVar11 = util::stringReplaceChar(pcVar1,'_',' ');
			piVar12 = FUN_00411030(pcVar11,pcVar4,(int)pIVar8,iVar6,iVar7,uVar2,(int)pcVar5,local_dc8,
														 uVar9,pcVar37);
			iVar6 = 1;
			*(int **)(*piVar3 + iVar20) = piVar12;
			pcVar4 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"MenuImage",0);
			pcVar4 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar4);
			FUN_00410ee0(*(int *)(*piVar3 + iVar20),pcVar4,iVar6);
			iVar6 = 0;
			pcVar4 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"MenuImageDark",0);
			pcVar4 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar4);
			FUN_00410ee0(*(int *)(*piVar3 + iVar20),pcVar4,iVar6);
			std::sprintf((char *)(*(int *)(*piVar3 + iVar20) + 0x5c),"%s",local_c00);
			pcVar4 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,
																 (char *)(*(int *)(*piVar3 + iVar20) + 0x5c),"PlayRandom",0);
			uVar2 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,pcVar4);
			*(uint *)(*(int *)(*piVar3 + iVar20) + 0x9c) = uVar2;
			std::free(pcVar1);
			iVar20 = local_db8;
			uVar2 = local_dbc;
		} while (local_db8 < (int)local_dbc);
	}
	local_db8 = 0;
	if ((int)uVar2 < 1) {
		return piVar3;
	}
LAB_00414425:
	iVar20 = local_db8 * 4;
	local_db8 += 1;
	iVar6 = *(int *)(*(int *)(*piVar3 + iVar20) + 0x44);
	std::sprintf(local_c00,"%s::Menu%i",local_400,local_db8);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"LoFont",0);
	pcVar1 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
	pIVar8 = (ImageFont *)FUN_00410490(pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"HiFont",0);
	pcVar1 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
	pIVar10 = (ImageFont *)FUN_00410490(pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"ItemCount",0);
	pcVar1 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
	if (pcVar1 == NULL) {
		pcVar1 = ____EMPTYSTR__;
	}
	else {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,"ItemCount",0);
		pcVar1 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
	}
	local_dc0 = (char *)std::atoi(pcVar1);
	local_dd0 = (char **)0x1;
	do {
		std::sprintf(local_800,"Overlay%i",local_dd0);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,local_800,0);
		local_dcc = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
		if (local_dcc == NULL) {
			if ((globals::g_CMDLINE_FLAGS & CMD_REDUCEFLICS) != CMD_NONE) break;
			std::sprintf(local_800,"!Overlay%i",local_dd0);
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,local_800,0);
			local_dcc = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
			if (local_dcc == NULL) break;
		}
		util::stringSplit(local_dcc,&local_d90,":");
		pcVar1 = (char *)snd::Snd_GetSFX(local_d8c,(int *)&local_dc4);
		if (pcVar1 == NULL) {
			local_dc4 = pcVar1;
		}
		pcVar1 = local_dc4;
		pcVar4 = (char *)std::atoi(local_d84);
		pcVar5 = (char *)std::atoi(local_d88);
		FUN_00413ec0(local_d90,(char **)(*(int *)(*piVar3 + iVar20) + 0x40),pcVar5,pcVar4,pcVar1);
		if (local_dcc != NULL) {
			std::free(local_dcc);
		}
		local_dd0 = (char **)((int)local_dd0 + 1);
	} while( true );
	iVar7 = 0;
	ppvVar22 = ppvVar21;
	if (0 < (int)local_dc0) {
		do {
			local_db4 = iVar7 + 1;
			std::sprintf(local_800,"Item%i",local_db4);
			if (local_dcc != NULL) {
				std::free(local_dcc);
			}
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_c00,local_800,0);
			local_dcc = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
			iVar7 = util::stringSplit(local_dcc,&local_d90,":");
			MVar13 = Menu_ParseMenuControlType(local_d90);
			ppvVar21 = ppvVar22;
			if (false) goto switchD_00414714_caseD_2;
			iVar16 = iVar6;
			switch(MVar13) {
			case MENUITEM_CYCLE:
				pvVar31 = *ppvVar22;
				ppvVar21 = ppvVar22 + 2;
				pvVar24 = ppvVar22[1];
				iVar7 = std::atoi(local_d80);
				iVar16 = std::atoi(local_d84);
				uVar2 = std::atoi(local_d78);
				piVar14 = FUN_00410940(uVar2,(int)pvVar31,iVar16,iVar7,(int)pvVar24);
				uVar33 = 0;
				uVar38 = 0;
				iVar7 = iVar6;
				piVar12 = piVar14;
				iVar16 = std::atoi(local_d88);
				iVar17 = std::atoi(local_d8c);
				pIVar25 = pIVar8;
				pIVar26 = pIVar10;
				pcVar1 = util::stringReplaceChar(local_d7c,'_',' ');
				puVar18 = FUN_00410c80(pcVar1,pIVar25,pIVar26,iVar17,iVar16,uVar38,iVar7,piVar12,uVar33);
				FUN_00411190(*(int *)(*piVar3 + iVar20),(int)puVar18);
				local_dc8 = 0;
				iVar7 = std::atoi(local_d78);
				if (0 < iVar7) {
					local_dd0 = &local_d74;
					do {
						pcVar1 = util::stringReplaceChar(*local_dd0,'_',' ');
						FUN_004109d0(piVar14,pcVar1);
						local_dc8 += 1;
						local_dd0 = local_dd0 + 1;
						iVar7 = std::atoi(local_d78);
					} while (local_dc8 < iVar7);
				}
				break;
			case MENUITEM_TRIGGER:
				if (iVar7 == 8) {
					pvVar31 = *ppvVar22;
					ppvVar21 = ppvVar22 + 2;
					pvVar24 = ppvVar22[1];
					iVar7 = std::atoi(local_d74);
					uVar38 = FUN_00410a90(pvVar31,(uint)(iVar7 == 1),pvVar24);
					uVar33 = 1;
LAB_00414992:
					iVar7 = iVar6;
					pcVar1 = local_d78;
					iVar16 = std::atoi(local_d88);
					iVar17 = std::atoi(local_d8c);
					puVar18 = FUN_00410d50(____EMPTYSTR__,pIVar8,pIVar10,(int)local_d84,(int)local_d80,iVar17,
																 iVar16,uVar33,iVar7,pcVar1,uVar38);
					iVar7 = *(int *)(*piVar3 + iVar20);
					ppvVar22 = ppvVar21;
					goto LAB_00414b5a;
				}
				if (iVar7 != 5) break;
				pvVar31 = *ppvVar22;
				ppvVar21 = ppvVar22 + 2;
				uVar38 = 0;
				pvVar24 = ppvVar22[1];
				iVar7 = std::atoi(local_d80);
				puVar18 = (undefined4 *)FUN_00410a90(pvVar31,(uint)(iVar7 == 1),pvVar24);
				iVar7 = 1;
LAB_00414a6e:
				iVar17 = std::atoi(local_d88);
				iVar19 = std::atoi(local_d8c);
				pcVar1 = local_d84;
				ppvVar22 = ppvVar21;
				goto LAB_00414b41;
			case MENUITEM_SLIDER:
				pvVar31 = *ppvVar22;
				FUN_00413f40(iVar7,(int)&local_d90,&local_db0);
				uVar38 = 0;
				pvVar24 = ppvVar22[1];
				piVar12 = local_db0;
				uVar33 = local_dac;
				uVar34 = local_da8;
				uVar27 = local_da4;
				uVar29 = local_da0;
				uVar32 = local_d9c;
				uVar35 = local_d98;
				uVar36 = local_d94;
				iVar7 = std::atoi(local_d80);
				iVar17 = std::atoi(local_d84);
				iVar19 = std::atoi(local_d74);
				iVar15 = std::atoi(local_d78);
				puVar18 = FUN_00410b20(pvVar31,iVar15,iVar19,iVar17,iVar7,pvVar24,piVar12,uVar33,uVar34,
															 uVar27,uVar29,uVar32,uVar35,uVar36);
				iVar7 = 3;
				goto LAB_00414b10;
			case MENUITEM_REALSLIDER:
				pvVar31 = *ppvVar22;
				uVar38 = 0;
				pvVar24 = ppvVar22[1];
				iVar7 = std::atoi(local_d80);
				iVar17 = std::atoi(local_d84);
				fVar23 = std::atof(local_d70);
				fVar30 = (float)fVar23;
				fVar23 = std::atof(local_d74);
				fVar28 = (float)fVar23;
				fVar23 = std::atof(local_d78);
				puVar18 = FUN_00410ac0(pvVar31,(float)fVar23,fVar28,fVar30,iVar17,iVar7,pvVar24);
				iVar7 = 4;
LAB_00414b10:
				ppvVar22 = ppvVar22 + 2;
				iVar17 = std::atoi(local_d88);
				iVar19 = std::atoi(local_d8c);
				pcVar1 = local_d7c;
LAB_00414b41:
				pIVar25 = pIVar8;
				pIVar26 = pIVar10;
				pcVar1 = util::stringReplaceChar(pcVar1,'_',' ');
				puVar18 = FUN_00410c80(pcVar1,pIVar25,pIVar26,iVar19,iVar17,iVar7,iVar16,puVar18,uVar38);
				iVar7 = *(int *)(*piVar3 + iVar20);
LAB_00414b5a:
				FUN_00411190(iVar7,(int)puVar18);
				ppvVar21 = ppvVar22;
				break;
			case MENUITEM_NEXT:
				if (iVar7 == 8) {
					iVar7 = std::atoi(local_d74 + 4);
					uVar38 = *(undefined4 *)(*piVar3 + (iVar7 + -1) * 4);
					uVar33 = 5;
					goto LAB_00414992;
				}
				if (iVar7 == 6) {
					iVar7 = std::atoi(local_d80 + 4);
					uVar38 = 1;
				}
				else {
					if (*local_d80 == '\0') {
						uVar38 = 0;
						puVar18 = NULL;
						iVar7 = iVar6;
						iVar16 = 5;
						goto LAB_00414a6e;
					}
					iVar7 = std::atoi(local_d80 + 4);
					uVar38 = 0;
				}
				uVar33 = *(undefined4 *)(*piVar3 + (iVar7 + -1) * 4);
				uVar34 = 5;
				iVar7 = iVar6;
				iVar16 = std::atoi(local_d88);
				iVar17 = std::atoi(local_d8c);
				pIVar25 = pIVar8;
				pIVar26 = pIVar10;
				pcVar1 = util::stringReplaceChar(local_d84,'_',' ');
				puVar18 = FUN_00410c80(pcVar1,pIVar25,pIVar26,iVar17,iVar16,uVar34,iVar7,uVar33,uVar38);
				iVar7 = *(int *)(*piVar3 + iVar20);
				goto LAB_00414b5a;
			}
switchD_00414714_caseD_2:
			iVar7 = local_db4;
			ppvVar22 = ppvVar21;
		} while (local_db4 < (int)local_dc0);
	}
	if (local_dcc != NULL) {
		std::free(local_dcc);
	}
	if ((int)local_dbc <= local_db8) {
		return piVar3;
	}
	goto LAB_00414425;
}



int __cdecl FUN_00414bc0(int *param_1,char *param_2)
{
	char **ppcVar1;
	int iVar2;
	int iVar3;
	
	iVar3 = 0;
	if (param_1[1] < 1) {
		return -1;
	}
	while ((ppcVar1 = *(char ***)(*param_1 + iVar3 * 4), ppcVar1 == NULL ||
				 (iVar2 = std::_stricmp(*ppcVar1,param_2), iVar2 != 0))) {
		iVar3 += 1;
		if (param_1[1] <= iVar3) {
			return -1;
		}
	}
	return iVar3;
}



BOOL __cdecl lego::main::Config_IsIntrosEnabled(void)
{
	char *keyPath;
	uint uVar1;
	
	keyPath = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","DontPlayAvis",0);
	uVar1 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,keyPath);
	if ((uVar1 != 1) && (globals::g_PROGRAMMER_MODE < PROGRAMMER_MODE_3)) {
		return 1;
	}
	return 0;
}



void __cdecl FUN_00414c60(int param_1)
{
	float r;
	float r_00;
	
	r = (float)param_1 * 0.1;
	r_00 = r * 0.8 - -0.2;
	lego::res::Res_SetLightColor(lego::globals::g_Game.struct2c_30,r,r,r,1.0);
	lego::res::Res_SetLightColor(lego::globals::g_Game.struct2c_38,r_00,r_00,r_00,1.0);
	lego::res::Res_SetLightPenumbra(lego::globals::g_Game.struct2c_30,r * 1.5 - -0.5);
	lego::res::Res_SetLightUmbra(lego::globals::g_Game.struct2c_30,r * 0.8 - -0.2);
	return;
}



void __cdecl FUN_00414d10(int param_1)
{
	FUN_0047b7f0(param_1);
	return;
}



void __cdecl lego::snd::SFX_UNKCallsMixer2__00414d20(int param_1)
{
	undefined uVar1;
	
	uVar1 = SUB41((float)param_1 * 0.1111111,0);
	SFX_UNKCallsMixer__00478c40(uVar1,uVar1);
	return;
}



undefined4 __cdecl FUN_00414d40(void)
{
	int iVar1;
	undefined4 uVar2;
	longlong lVar3;
	float local_8;
	float local_4;
	
	uVar2 = 0;
	iVar1 = FUN_00478c60(&local_4,&local_8);
	if (iVar1 != 0) {
		lVar3 = __ftol(((float10)local_8 + (float10)local_4) * (float10)0.5 * (float10)9.0);
		uVar2 = (undefined4)lVar3;
	}
	return uVar2;
}



void __cdecl FUN_00414d80(BOOL param_1)
{
	if (param_1 == 0) {
		lego::globals::g_Game.flags1 |= GAME1_WALLPROMESHES;
	}
	else {
		if (param_1 == 1) {
			lego::globals::g_Game.flags1 = lego::globals::g_Game.flags1 & ~GAME1_WALLPROMESHES;
			return;
		}
	}
	return;
}



void __cdecl FUN_00414db0(int param_1)
{
	FUN_00419380((uint)(param_1 == 0));
	return;
}



void __cdecl lego::snd::Music_PlayNext_Not(BOOL isMusicOff)
{
	Music_PlayNext((uint)(isMusicOff == 0));
	return;
}



void __cdecl FUN_00414df0(BOOL param_1)
{
	lego::main::Config_SetSoundEnabled((uint)(param_1 == 0));
	return;
}



void __cdecl FUN_00414e10(int param_1)
{
	if (param_1 == 0) {
		FUN_00419130(0,1);
	}
	else {
		if (param_1 == 1) {
			FUN_00419130(0,0);
			return;
		}
	}
	return;
}



void __cdecl FUN_00414e40(void)
{
	lego::game::Level_SetCompleteStatus(LEVELSTATUS_NONE);
	return;
}



void __cdecl FUN_00414e50(int param_1)
{
	if (true) {
		switch(param_1) {
		case 0:
			lego::globals::g_Game.gameSpeed = 0.3333333;
			return;
		case 1:
			lego::globals::g_Game.gameSpeed = 0.6666667;
			return;
		case 3:
			lego::globals::g_Game.gameSpeed = 1.333333;
			return;
		case 4:
			lego::globals::g_Game.gameSpeed = 1.666667;
			return;
		case 5:
			lego::globals::g_Game.gameSpeed = 2.0;
			return;
		}
	}
	lego::globals::g_Game.gameSpeed = 1.0;
	return;
}



void __cdecl lego::front::FrontEnd_UpdateGameSpeedSlider(void)
{
	if (globals::g_Game.gameSpeed < 0.6666666) {
		globals::g_GameSpeed_SliderLevel = 0;
		return;
	}
	if (globals::g_Game.gameSpeed < 1.0) {
		globals::g_GameSpeed_SliderLevel = 1;
		return;
	}
	if (globals::g_Game.gameSpeed < 1.333333) {
		globals::g_GameSpeed_SliderLevel = 2;
		return;
	}
	if (globals::g_Game.gameSpeed < 1.666667) {
		globals::g_GameSpeed_SliderLevel = 3;
		return;
	}
	globals::g_GameSpeed_SliderLevel = 4;
	if (2.0 <= globals::g_Game.gameSpeed) {
		globals::g_GameSpeed_SliderLevel = 5;
	}
	return;
}



int __cdecl lego::front::FrontEnd_CalcGameSpeedSliderLevel(void)
{
	int iVar1;
	
	if (globals::g_Game.gameSpeed < 0.6666666) {
		return 0;
	}
	if (globals::g_Game.gameSpeed < 1.0) {
		return 1;
	}
	if (globals::g_Game.gameSpeed < 1.333333) {
		return 2;
	}
	if (globals::g_Game.gameSpeed < 1.666667) {
		return 3;
	}
	iVar1 = 4;
	if (2.0 <= globals::g_Game.gameSpeed) {
		iVar1 = 5;
	}
	return iVar1;
}



void __cdecl FUN_00414fe0(undefined4 param_1,int param_2)
{
	undefined *puVar1;
	int iVar2;
	LevelIdentifier *pLVar3;
	undefined4 uVar4;
	undefined4 uVar5;
	
	lego::save::Save_SetSaveNumber(param_2);
	puVar1 = FUN_00417da0();
	if (puVar1 == NULL) {
		uVar5 = 1;
		uVar4 = *(undefined4 *)
						 (*(int *)(*(int *)(*(int *)(*lego::globals::menu::g_MainMenuFull + 4) + 0x18) + 4) +
						 0x10);
		pLVar3 = &LevelIdentifier_00557fe4;
		iVar2 = 0;
	}
	else {
		uVar5 = 0;
		uVar4 = *(undefined4 *)
						 (*(int *)(*(int *)(*(int *)(*lego::globals::menu::g_MainMenuFull + 4) + 0x18) + 4) +
						 0x10);
		pLVar3 = &LevelIdentifier_00557fe4;
		puVar1 = FUN_00417da0();
		iVar2 = *(int *)(puVar1 + 0x34);
	}
	FUN_00417310(DAT_00557ff8,iVar2,pLVar3,uVar4,uVar5);
	FUN_00417310(DAT_00557ffc,0,&LevelIdentifier_00557fd0,
							 *(undefined4 *)
								(*(int *)(*(int *)(*(int *)(*lego::globals::menu::g_MainMenuFull + 8) + 0x18) + 4) +
								0x10),0);
	return;
}



void __cdecl FUN_00415080(void)
{
	int saveIndex;
	undefined *puVar1;
	
	saveIndex = lego::save::Save_GetSaveNumber();
	puVar1 = FUN_00417d80(saveIndex);
	if (puVar1 != NULL) {
		FUN_00414d10(*(int *)(puVar1 + 8));
		FUN_00414c60(*(int *)(puVar1 + 0x10));
		lego::snd::SFX_UNKCallsMixer2__00414d20(*(undefined4 *)(puVar1 + 4));
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_004150c0(void)
{
	undefined *puVar1;
	LevelIdentifier *pLVar2;
	undefined4 uVar3;
	undefined4 uVar4;
	
	_DAT_00558504 = 0;
	DAT_00558508 = 0;
	INT_004a2f4c = -1;
	puVar1 = FUN_00417da0();
	if (puVar1 != NULL) {
		uVar4 = 0;
		uVar3 = *(undefined4 *)
						 (*(int *)(*(int *)(*(int *)(*lego::globals::menu::g_MainMenuFull + 4) + 0x18) + 4) +
						 0x10);
		pLVar2 = &LevelIdentifier_00557fe4;
		puVar1 = FUN_00417da0();
		FUN_00417310(DAT_00557ff8,*(int *)(puVar1 + 0x34),pLVar2,uVar3,uVar4);
		return;
	}
	FUN_00417310(DAT_00557ff8,0,&LevelIdentifier_00557fe4,
							 *(undefined4 *)
								(*(int *)(*(int *)(*(int *)(*lego::globals::menu::g_MainMenuFull + 4) + 0x18) + 4) +
								0x10),1);
	return;
}



void __cdecl FUN_00415150(void)
{
	int iVar1;
	char *levelName;
	int iVar2;
	int *piVar3;
	char local_80 [128];
	
	std::sprintf(local_80,"%s",(lego::globals::g_Game.level)->levelName);
	FUN_00425b60(0,0);
	lego::game::Game_freeLevel__0042eff0();
	levelName = std::_strdup(local_80);
	lego::main::Main_loadLevelCFG(levelName);
	iVar2 = 0;
	piVar3 = lego::globals::menu::g_PausedMenu;
	if (0 < lego::globals::menu::g_PausedMenu[1]) {
		do {
			iVar1 = *(int *)(*piVar3 + iVar2 * 4);
			if (iVar1 != 0) {
				*(undefined4 *)(iVar1 + 0x28) = 1;
				piVar3 = lego::globals::menu::g_PausedMenu;
			}
			iVar2 += 1;
		} while (iVar2 < piVar3[1]);
	}
	DAT_0055804c = 0;
	lego::globals::g_Game.flags1 |= GAME1_PAUSED;
	FUN_00459620();
	return;
}



void __cdecl FUN_004151f0(int param_1,char *param_2)
{
	int iVar1;
	uint uVar2;
	int iVar3;
	int iVar4;
	uint uVar5;
	longlong lVar6;
	uint in_stack_0000000c;
	
	if (param_1 != 0) {
		iVar4 = 0;
		uVar5 = 0;
		uVar2 = 0;
		if (*(int *)(param_1 + 0x18) != 0) {
			iVar3 = 0;
			do {
				iVar1 = FUN_00417360(uVar5,param_1);
				iVar4 += iVar1;
				if ((*(byte *)(*(int *)(param_1 + 0x34) + iVar3) & 1) != 0) {
					in_stack_0000000c += 1;
				}
				uVar5 += 1;
				iVar3 += 0x3190;
				uVar2 = in_stack_0000000c;
			} while (uVar5 < *(uint *)(param_1 + 0x18));
		}
		if (uVar2 != 0) {
			lVar6 = __ftol(((float10)(ulonglong)uVar2 / (float10)*(int *)(param_1 + 0x18)) *
										 (float10)100.0);
			std::sprintf(param_2,"Game %i%% complete with %i points scored",(int)lVar6,iVar4);
		}
	}
	return;
}



void __cdecl lego::front::FrontEnd_UpdateGameSpeedSliderLevel(void)
{
	globals::g_GameSpeed_SliderLevel = FrontEnd_CalcGameSpeedSliderLevel();
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

BOOL __cdecl FUN_004152a0(undefined4 param_1,int param_2)
{
	int iVar1;
	BOOL BVar2;
	int **ppiVar3;
	uint uVar4;
	
	uVar4 = 1;
	lego::front::FrontEnd_UpdateGameSpeedSliderLevel();
	ppiVar3 = lego::globals::menu::g_PausedMenu;
	if ((param_2 != 0) && (ppiVar3 = lego::globals::menu::g_OptionsMenu, param_2 != 1)) {
		return 1;
	}
	if (((((DAT_004dc8e0 != 0) && (DAT_0055804c == 0)) && (DAT_00558048 == 0)) &&
			((DAT_00558044 == 0 && (_DAT_004dc8e4 == ppiVar3)))) &&
		 (BVar2 = lego::game::Level_IsObjectiveFinished(), BVar2 == 0)) {
LAB_0041535f:
		BVar2 = lego::game::Level_IsObjectiveFinished();
		if (BVar2 == 0) {
			DAT_004dc8e0 = FUN_00412b30(param_1,DAT_004dc8e0,NULL);
		}
		if (param_2 != 0) {
			if (param_2 == 1) {
				iVar1 = *(int *)(**ppiVar3 + 0x28);
				*(undefined4 *)(**ppiVar3 + 0x28) = 0;
				uVar4 = (uint)(iVar1 == 1);
			}
			return uVar4;
		}
		uVar4 = 1;
		iVar1 = **ppiVar3;
		if ((*(int *)(iVar1 + 0x28) != 1) && (*(int *)((*ppiVar3)[2] + 0x28) != 1)) {
			uVar4 = 0;
		}
		*(undefined4 *)(iVar1 + 0x28) = 0;
		*(undefined4 *)((*ppiVar3)[2] + 0x28) = 0;
		return uVar4;
	}
	DAT_00558048 = 0;
	DAT_004dc8e0 = **ppiVar3;
	_DAT_004dc8e4 = ppiVar3;
	if (DAT_00558044 == 0) {
		if (DAT_0055804c != 1) goto LAB_0041535f;
	}
	else {
		if (**ppiVar3 != 0) {
			*(undefined4 *)(**ppiVar3 + 0x28) = 1;
		}
		if ((*ppiVar3)[2] != 0) {
			*(undefined4 *)((*ppiVar3)[2] + 0x28) = 1;
		}
		if (param_2 == 0) {
			DAT_00558044 = 0;
			return 0;
		}
	}
	return 0;
}



BOOL __cdecl
lego::game::Game_UnkParseLevelIdentifier_004153e0
					(CFGProperty *root,uint *param_2,char *propertyName)
{
	uint length;
	char *pcVar1;
	void *pvVar2;
	undefined4 *puVar3;
	char *pcVar4;
	uint uVar5;
	int iVar6;
	uint uVar7;
	
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main",propertyName,0);
	pcVar1 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
	if (pcVar1 == NULL) {
		return 0;
	}
	uVar7 = 1;
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,pcVar1,"NextLevel",0);
	for (pcVar1 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1); pcVar1 != NULL;
			pcVar1 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1)) {
		uVar7 += 1;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,pcVar1,"NextLevel",0);
	}
	length = uVar7 * 4;
	*param_2 = uVar7;
	pvVar2 = std::malloc(length);
	param_2[1] = (uint)pvVar2;
	pvVar2 = std::malloc(length);
	param_2[2] = (uint)pvVar2;
	puVar3 = (undefined4 *)std::malloc(length);
	param_2[3] = (uint)puVar3;
	for (uVar5 = uVar7 & 0x3fffffff; uVar5 != 0; uVar5 -= 1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	for (iVar6 = 0; iVar6 != 0; iVar6 += -1) {
		*(undefined *)puVar3 = 0;
		puVar3 = (undefined4 *)((int)puVar3 + 1);
	}
	puVar3 = (undefined4 *)std::malloc(length);
	param_2[4] = (uint)puVar3;
	for (uVar7 &= 0x3fffffff; uVar7 != 0; uVar7 -= 1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	for (iVar6 = 0; iVar6 != 0; iVar6 += -1) {
		*(undefined *)puVar3 = 0;
		puVar3 = (undefined4 *)((int)puVar3 + 1);
	}
	if (param_2[1] != 0) {
		if (param_2[2] != 0) {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main",propertyName,0);
			pcVar1 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
			*(char **)param_2[1] = pcVar1;
			pcVar1 = *(char **)param_2[1];
			pcVar4 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,pcVar1,"FullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar4);
			*(char **)param_2[2] = pcVar4;
			if (*(char **)param_2[2] == NULL) {
				puVar3 = FUN_004104d0(*(char **)param_2[1]);
				*(undefined4 **)param_2[2] = puVar3;
			}
			else {
				lego::util::stringReplaceChar(*(char **)param_2[2],'_',' ');
			}
			iVar6 = 1;
			if (1 < (int)*param_2) {
				do {
					pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,pcVar1,"NextLevel",0);
					pcVar1 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
					*(char **)(param_2[1] + iVar6 * 4) = pcVar1;
					pcVar1 = *(char **)(param_2[1] + iVar6 * 4);
					pcVar4 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,pcVar1,"FullName",0);
					pcVar4 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar4);
					*(char **)(param_2[2] + iVar6 * 4) = pcVar4;
					pcVar4 = *(char **)(param_2[2] + iVar6 * 4);
					if (pcVar4 == NULL) {
						puVar3 = FUN_004104d0(*(char **)(param_2[1] + iVar6 * 4));
						*(undefined4 **)(param_2[2] + iVar6 * 4) = puVar3;
					}
					else {
						lego::util::stringReplaceChar(pcVar4,'_',' ');
					}
					iVar6 += 1;
				} while (iVar6 < (int)*param_2);
			}
			return 1;
		}
		return 0;
	}
	return 0;
}



void __cdecl lego::video::Avi_Play(int **param_1,BOOL isSkippable)
{
	BOOL BVar1;
	int iVar2;
	ulonglong uVar3;
	float local_1c;
	
	local_1c = 0.0;
	BVar1 = Avi_FUN_00472990(param_1);
	if (BVar1 != 0) {
		while( true ) {
			main::Main_UpdateAndRender__004781f0(0);
			local_1c = local_1c - -1.0;
			uVar3 = Avi_FUN_00472980(param_1);
			if ((float)(uVar3 & 0xffffffff) < local_1c) break;
			if (isSkippable != 0) {
				iVar2 = input::Input_GetNumKeysPressed();
				if (iVar2 != 0) {
					return;
				}
				if (globals::g_ButtonState_RightDown != 0) {
					return;
				}
				if (globals::g_ButtonState_LeftDown != 0) {
					return;
				}
			}
			BVar1 = Avi_FUN_00472990(param_1);
			if (BVar1 == 0) {
				return;
			}
		}
	}
	return;
}



void __cdecl lego::main::Boot_PlayIntroImage(char *imageKeyName,BOOL isSkippable,char *timeKeyName)
{
	char *pcVar1;
	DWORD DVar2;
	ImageBMP *bitmap;
	DWORD DVar3;
	int iVar4;
	float10 fVar5;
	longlong lVar6;
	
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main",timeKeyName,0);
	pcVar1 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
	if (pcVar1 == NULL) {
		pcVar1 = ____EMPTYSTR__;
	}
	else {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main",timeKeyName,0);
		pcVar1 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
	}
	fVar5 = std::atof(pcVar1);
	timeKeyName = (char *)(float)fVar5;
	if ((float)timeKeyName == 0.0) {
		timeKeyName = (char *)0x40400000;
	}
	DVar2 = timeGetTime();
	lVar6 = __ftol((float10)(float)timeKeyName * (float10)-1000.0);
	if (imageKeyName != NULL) {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main",imageKeyName,0);
		pcVar1 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
		if ((pcVar1 != NULL) && (bitmap = image::Image_LoadBMP(pcVar1,0,0), bitmap != NULL)) {
			while( true ) {
				image::Image_Blt__0047df70(bitmap,NULL,NULL,NULL);
				Main_UpdateAndRender__004781f0(0);
				Sleep(100);
				DVar3 = timeGetTime();
				if (DVar2 - (int)lVar6 <= DVar3) break;
				if ((isSkippable != 0) &&
					 (((iVar4 = input::Input_GetNumKeysPressed(), iVar4 != 0 ||
						 (globals::g_ButtonState_RightDown != 0)) || (globals::g_ButtonState_LeftDown != 0))))
				break;
			}
			pool::ReservedPool_ImageBMP___Release(bitmap);
		}
	}
	return;
}



void __cdecl lego::main::Boot_PlayIntroAVI(char *aviKeyName,BOOL isSkippable)
{
	char *pcVar1;
	BOOL BVar2;
	int **ppiVar3;
	
	if (aviKeyName != NULL) {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main",aviKeyName,0);
		pcVar1 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
		if (pcVar1 != NULL) {
			BVar2 = lego::file::File_Exist(pcVar1);
			if (BVar2 != 0) {
				ppiVar3 = video::Avi_Open(pcVar1);
				video::Avi_Play(ppiVar3,isSkippable);
				video::Avi_Close(ppiVar3);
				std::free(pcVar1);
			}
		}
	}
	return;
}



void __cdecl lego::game::Level_DoVideo__004158c0(char *levelName,int param_2)
{
	char *pcVar1;
	BOOL BVar2;
	int **ppiVar3;
	
	if (levelName != NULL) {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"Video",0);
		pcVar1 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
		if (pcVar1 != NULL) {
			BVar2 = lego::file::File_Exist(pcVar1);
			if (BVar2 != 0) {
				ppiVar3 = video::Avi_Open(pcVar1);
				video::Avi_Play(ppiVar3,param_2);
				video::Avi_Close(ppiVar3);
			}
			std::free(pcVar1);
		}
	}
	return;
}



void __cdecl FUN_00415940(undefined4 param_1)
{
	int iVar1;
	int iVar2;
	int iVar3;
	int **ppiVar4;
	undefined4 *puVar5;
	int **ppiVar6;
	char *pcVar7;
	undefined *puVar8;
	int iVar9;
	uint unaff_EDI;
	Struct_b8__00558080 *pSVar10;
	undefined4 uVar11;
	code *pcVar12;
	byte local_64 [100];
	
	DAT_00557ff8 = FUN_00416fc0((int *)&LevelIdentifier_00557fe4,*LevelIdentifier_00557fe4.field_4);
	DAT_00557ffc = FUN_00416fc0((int *)&LevelIdentifier_00557fd0,*LevelIdentifier_00557fd0.field_4);
	FUN_00416da0();
	iVar1 = FUN_00414bc0(lego::globals::menu::g_MainMenuFull,"Levels");
	iVar2 = FUN_00414bc0(lego::globals::menu::g_MainMenuFull,"Tutorials");
	iVar3 = FUN_00414bc0(lego::globals::menu::g_MainMenuFull,"Load Level Save");
	ppiVar4 = (int **)FUN_00410520(&INT_00558028,____EMPTYSTR__,____EMPTYSTR__,0xffffff38,0xffffff9c,
																 0x3c,5,0xffffffec,200,0xffffffec,0xffffffd8,0,FUN_00414fe0,
																 *(undefined4 *)(*lego::globals::menu::g_MainMenuFull + iVar1 * 4));
	iVar3 *= 4;
	iVar9 = **(int **)(*(int *)(*lego::globals::menu::g_MainMenuFull + iVar3) + 0x18);
	puVar5 = FUN_00410c80(____EMPTYSTR__,*(ImageFont **)(iVar9 + 0xc),*(ImageFont **)(iVar9 + 8),0,0,6
												,1,ppiVar4,0);
	FUN_00411190(*(int *)(*lego::globals::menu::g_MainMenuFull + iVar3),(int)puVar5);
	ppiVar6 = (int **)FUN_00410520(&INT_00558028,____EMPTYSTR__,____EMPTYSTR__,0xffffff38,0xffffff9c,
																 0x3c,5,0xffffffec,200,0xffffffec,0xffffffd8,0,FUN_00414fe0,0);
	iVar9 = **(int **)(*(int *)(*lego::globals::menu::g_MainMenuFull + iVar3) + 0x18);
	puVar5 = FUN_00410c80(____EMPTYSTR__,*(ImageFont **)(iVar9 + 0xc),*(ImageFont **)(iVar9 + 8),0,0,6
												,1,ppiVar6,0);
	FUN_00411190(**lego::globals::menu::g_SaveMenu,(int)puVar5);
	iVar9 = 0;
	pSVar10 = lego::globals::g_Struct_b8_TABLE__00558080;
	do {
		iVar9 += 1;
		pcVar7 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,"Menu","Save_Game",0,iVar9);
		pcVar7 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar7);
		std::sprintf((char *)local_64,"%s %i",pcVar7);
		lego::util::stringReplaceChar((char *)local_64,'_',' ');
		FUN_004151f0((int)pSVar10,(char *)local_64);
		FUN_00410670(ppiVar4,local_64,1,
								 *(undefined4 **)
									(**(int **)(*(int *)(*lego::globals::menu::g_MainMenuFull + iVar3) + 0x18) + 8),0,
								 0,0);
		FUN_00410670(ppiVar6,local_64,1,
								 *(undefined4 **)
									(**(int **)(*(int *)(*lego::globals::menu::g_MainMenuFull + iVar3) + 0x18) + 8),0,
								 0,0);
		pSVar10 = pSVar10 + 1;
	} while ((int)pSVar10 < 0x558418);
	FUN_00417d20(unaff_EDI);
	pcVar12 = lego::unk::lego_uses_testercall_FUN_00417390;
	uVar11 = 0;
	puVar8 = FUN_00417da0();
	FUN_004178e0(4,(int)DAT_00557ff8,&LevelIdentifier_00557fe4,
							 *(int *)(*lego::globals::menu::g_MainMenuFull + iVar1 * 4),puVar8,uVar11,pcVar12);
	pcVar12 = FUN_00417630;
	uVar11 = 0;
	puVar8 = FUN_00417da0();
	FUN_004178e0(5,(int)DAT_00557ffc,&LevelIdentifier_00557fd0,
							 *(int *)(*lego::globals::menu::g_MainMenuFull + iVar2 * 4),puVar8,uVar11,pcVar12);
	return;
}



void __cdecl lego::save::Save_ClearSaveNumber(void)
{
	globals::g_SaveNumber = -1;
	return;
}



void __cdecl FUN_00415c30(undefined4 param_1,char *param_2,undefined4 *param_3)
{
	char cVar1;
	char *pcVar2;
	int iVar3;
	Struct_830 *pSVar4;
	ImageBMP *pIVar5;
	uint uVar6;
	uint uVar7;
	undefined4 *puVar8;
	char *pcVar9;
	undefined4 *puVar10;
	Rect2F local_24;
	char *local_14;
	char *local_10;
	char *local_c;
	char *local_8;
	char *local_4;
	
	local_24.y = 0.0;
	local_24.width = 0.0;
	local_24.x = 0.0;
	local_24.height = 0.0;
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,param_2,"Load",0);
	pcVar2 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = lego::util::replaceTextSpaces(pcVar2);
		uVar6 = 0xffffffff;
		do {
			pcVar9 = pcVar2;
			if (uVar6 == 0) break;
			uVar6 -= 1;
			pcVar9 = pcVar2 + 1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar9;
		} while (cVar1 != '\0');
		uVar6 = ~uVar6;
		puVar8 = (undefined4 *)(pcVar9 + -uVar6);
		puVar10 = param_3 + 10;
		for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
			*puVar10 = *puVar8;
			puVar8 = puVar8 + 1;
			puVar10 = puVar10 + 1;
		}
		for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
			*(undefined *)puVar10 = *(undefined *)puVar8;
			puVar8 = (undefined4 *)((int)puVar8 + 1);
			puVar10 = (undefined4 *)((int)puVar10 + 1);
		}
	}
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,param_2,"Save",0);
	pcVar2 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = lego::util::replaceTextSpaces(pcVar2);
		uVar6 = 0xffffffff;
		do {
			pcVar9 = pcVar2;
			if (uVar6 == 0) break;
			uVar6 -= 1;
			pcVar9 = pcVar2 + 1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar9;
		} while (cVar1 != '\0');
		uVar6 = ~uVar6;
		puVar8 = (undefined4 *)(pcVar9 + -uVar6);
		puVar10 = param_3 + 0x4a;
		for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
			*puVar10 = *puVar8;
			puVar8 = puVar8 + 1;
			puVar10 = puVar10 + 1;
		}
		for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
			*(undefined *)puVar10 = *(undefined *)puVar8;
			puVar8 = (undefined4 *)((int)puVar8 + 1);
			puVar10 = (undefined4 *)((int)puVar10 + 1);
		}
	}
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,param_2,"Slot",0);
	pcVar2 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = lego::util::replaceTextSpaces(pcVar2);
		uVar6 = 0xffffffff;
		do {
			pcVar9 = pcVar2;
			if (uVar6 == 0) break;
			uVar6 -= 1;
			pcVar9 = pcVar2 + 1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar9;
		} while (cVar1 != '\0');
		uVar6 = ~uVar6;
		puVar8 = (undefined4 *)(pcVar9 + -uVar6);
		puVar10 = param_3 + 0x8a;
		for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
			*puVar10 = *puVar8;
			puVar8 = puVar8 + 1;
			puVar10 = puVar10 + 1;
		}
		for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
			*(undefined *)puVar10 = *(undefined *)puVar8;
			puVar8 = (undefined4 *)((int)puVar8 + 1);
			puVar10 = (undefined4 *)((int)puVar10 + 1);
		}
	}
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,param_2,"SaveSel",0);
	pcVar2 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = lego::util::replaceTextSpaces(pcVar2);
		uVar6 = 0xffffffff;
		do {
			pcVar9 = pcVar2;
			if (uVar6 == 0) break;
			uVar6 -= 1;
			pcVar9 = pcVar2 + 1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar9;
		} while (cVar1 != '\0');
		uVar6 = ~uVar6;
		puVar8 = (undefined4 *)(pcVar9 + -uVar6);
		puVar10 = param_3 + 0x10a;
		for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
			*puVar10 = *puVar8;
			puVar8 = puVar8 + 1;
			puVar10 = puVar10 + 1;
		}
		for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
			*(undefined *)puVar10 = *(undefined *)puVar8;
			puVar8 = (undefined4 *)((int)puVar8 + 1);
			puVar10 = (undefined4 *)((int)puVar10 + 1);
		}
	}
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,param_2,"LoadSel",0);
	pcVar2 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = lego::util::replaceTextSpaces(pcVar2);
		uVar6 = 0xffffffff;
		do {
			pcVar9 = pcVar2;
			if (uVar6 == 0) break;
			uVar6 -= 1;
			pcVar9 = pcVar2 + 1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar9;
		} while (cVar1 != '\0');
		uVar6 = ~uVar6;
		puVar8 = (undefined4 *)(pcVar9 + -uVar6);
		puVar10 = param_3 + 0xca;
		for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
			*puVar10 = *puVar8;
			puVar8 = puVar8 + 1;
			puVar10 = puVar10 + 1;
		}
		for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
			*(undefined *)puVar10 = *(undefined *)puVar8;
			puVar8 = (undefined4 *)((int)puVar8 + 1);
			puVar10 = (undefined4 *)((int)puVar10 + 1);
		}
	}
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,param_2,"Level",0);
	pcVar2 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = lego::util::replaceTextSpaces(pcVar2);
		uVar6 = 0xffffffff;
		do {
			pcVar9 = pcVar2;
			if (uVar6 == 0) break;
			uVar6 -= 1;
			pcVar9 = pcVar2 + 1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar9;
		} while (cVar1 != '\0');
		uVar6 = ~uVar6;
		puVar8 = (undefined4 *)(pcVar9 + -uVar6);
		puVar10 = param_3 + 0x14a;
		for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
			*puVar10 = *puVar8;
			puVar8 = puVar8 + 1;
			puVar10 = puVar10 + 1;
		}
		for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
			*(undefined *)puVar10 = *(undefined *)puVar8;
			puVar8 = (undefined4 *)((int)puVar8 + 1);
			puVar10 = (undefined4 *)((int)puVar10 + 1);
		}
	}
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,param_2,"Tutorial",0);
	pcVar2 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = lego::util::replaceTextSpaces(pcVar2);
		uVar6 = 0xffffffff;
		do {
			pcVar9 = pcVar2;
			if (uVar6 == 0) break;
			uVar6 -= 1;
			pcVar9 = pcVar2 + 1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar9;
		} while (cVar1 != '\0');
		uVar6 = ~uVar6;
		puVar8 = (undefined4 *)(pcVar9 + -uVar6);
		puVar10 = param_3 + 0x18a;
		for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
			*puVar10 = *puVar8;
			puVar8 = puVar8 + 1;
			puVar10 = puVar10 + 1;
		}
		for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
			*(undefined *)puVar10 = *(undefined *)puVar8;
			puVar8 = (undefined4 *)((int)puVar8 + 1);
			puVar10 = (undefined4 *)((int)puVar10 + 1);
		}
	}
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,param_2,"Window",0);
	pcVar2 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		iVar3 = lego::util::stringSplit(pcVar2,&local_14,"|");
		if (iVar3 == 4) {
			iVar3 = std::atoi(local_14);
			local_24.x = (float)iVar3;
			param_3[2] = local_24.x;
			iVar3 = std::atoi(local_10);
			local_24.y = (float)iVar3;
			param_3[3] = local_24.y;
			iVar3 = std::atoi(local_c);
			local_24.width = (float)iVar3;
			param_3[4] = local_24.width;
			iVar3 = std::atoi(local_8);
			local_24.height = (float)iVar3;
			param_3[5] = local_24.height;
			pSVar4 = lego::unk::Lego_unkMakeDrawRegion__004853b0
												 (lego::globals::g_Game.bmpFONT5_HI,&local_24,0x200);
			*param_3 = pSVar4;
		}
	}
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,param_2,"Panel",0);
	pcVar2 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		iVar3 = lego::util::stringSplit(pcVar2,&local_14,"|");
		if ((iVar3 == 5) && (local_14 != NULL)) {
			pIVar5 = lego::image::Image_LoadBMP(local_14,0,0);
			param_3[1] = pIVar5;
			if (pIVar5 != NULL) {
				iVar3 = std::atoi(local_10);
				param_3[6] = (float)iVar3;
				iVar3 = std::atoi(local_c);
				param_3[7] = (float)iVar3;
				iVar3 = std::atoi(local_8);
				param_3[8] = (float)iVar3;
				iVar3 = std::atoi(local_4);
				param_3[9] = (float)iVar3;
				lego::image::Image_unkFogFromFloat__0047deb0((ImageBMP *)param_3[1],0.0,0.0,0.0,0.0,0.0,0.0)
				;
			}
		}
	}
	return;
}



BOOL __cdecl FUN_00416080(int levelNumber)
{
	BOOL BVar1;
	int local_84;
	char local_80 [128];
	
	std::sprintf(local_80,"Stream_LevelName_Level%d",levelNumber);
	BVar1 = lego::snd::Snd_GetSFX(local_80,&local_84);
	if (BVar1 != 0) {
		BVar1 = lego::snd::Snd_FUN_004651b0(local_84,NULL);
	}
	return BVar1;
}



BOOL __cdecl FUN_004160d0(int levelNumber)
{
	BOOL BVar1;
	int local_84;
	char local_80 [128];
	
	std::sprintf(local_80,"Stream_LevelName_TLevel%d",levelNumber);
	BVar1 = lego::snd::Snd_GetSFX(local_80,&local_84);
	if (BVar1 != 0) {
		BVar1 = lego::snd::Snd_FUN_004651b0(local_84,NULL);
	}
	return BVar1;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl lego::main::Main_LoadMenus(CFGProperty *root)
{
	char cVar1;
	char *pcVar2;
	int iVar3;
	char *pcVar4;
	uint uVar5;
	uint uVar6;
	undefined4 *puVar7;
	char *pcVar8;
	undefined4 *puVar9;
	undefined uVar10;
	
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","MenuWipe",0);
	pcVar2 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 == NULL) {
		pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","!MenuWipe",0);
		pcVar2 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar2);
		if (pcVar2 == NULL) goto LAB_004161da;
		if ((globals::g_CMDLINE_FLAGS & CMD_REDUCEANIMATION) == CMD_NONE) {
			iVar3 = std::_strnicmp(pcVar2,"Null",4);
			goto joined_r0x004161b8;
		}
	}
	else {
		iVar3 = std::_strnicmp(pcVar2,"Null",4);
joined_r0x004161b8:
		if (iVar3 != 0) {
			globals::g_MenuWipeResource = res::Res_LoadResource(NULL,pcVar2,"LWS",1);
		}
	}
	std::free(pcVar2);
LAB_004161da:
	globals::g_UnkStruct728_Menu_SaveText = std::malloc(0x728);
	puVar7 = (undefined4 *)globals::g_UnkStruct728_Menu_SaveText;
	for (iVar3 = 0x1ca; iVar3 != 0; iVar3 += -1) {
		*puVar7 = 0;
		puVar7 = puVar7 + 1;
	}
	FUN_00415c30(root,"Menu::SaveText",(undefined4 *)globals::g_UnkStruct728_Menu_SaveText);
	globals::g_UnkStruct728_Menu_LevelText = std::malloc(0x728);
	puVar7 = (undefined4 *)globals::g_UnkStruct728_Menu_LevelText;
	for (iVar3 = 0x1ca; iVar3 != 0; iVar3 += -1) {
		*puVar7 = 0;
		puVar7 = puVar7 + 1;
	}
	FUN_00415c30(root,"Menu::LevelText",(undefined4 *)globals::g_UnkStruct728_Menu_LevelText);
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","Save_Game",0);
	pcVar2 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar4 = util::replaceTextSpaces(pcVar2);
		uVar5 = 0xffffffff;
		do {
			pcVar8 = pcVar4;
			if (uVar5 == 0) break;
			uVar5 -= 1;
			pcVar8 = pcVar4 + 1;
			cVar1 = *pcVar4;
			pcVar4 = pcVar8;
		} while (cVar1 != '\0');
		uVar5 = ~uVar5;
		puVar7 = (undefined4 *)(pcVar8 + -uVar5);
		puVar9 = (undefined4 *)globals::menu::g_Menu_SaveGame_text;
		for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
			*puVar9 = *puVar7;
			puVar7 = puVar7 + 1;
			puVar9 = puVar9 + 1;
		}
		for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
			*(undefined *)puVar9 = *(undefined *)puVar7;
			puVar7 = (undefined4 *)((int)puVar7 + 1);
			puVar9 = (undefined4 *)((int)puVar9 + 1);
		}
		std::free(pcVar2);
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","Load_Game",0);
	pcVar2 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar4 = util::replaceTextSpaces(pcVar2);
		uVar5 = 0xffffffff;
		do {
			pcVar8 = pcVar4;
			if (uVar5 == 0) break;
			uVar5 -= 1;
			pcVar8 = pcVar4 + 1;
			cVar1 = *pcVar4;
			pcVar4 = pcVar8;
		} while (cVar1 != '\0');
		uVar5 = ~uVar5;
		puVar7 = (undefined4 *)(pcVar8 + -uVar5);
		puVar9 = (undefined4 *)globals::menu::g_Menu_LoadGame_text;
		for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
			*puVar9 = *puVar7;
			puVar7 = puVar7 + 1;
			puVar9 = puVar9 + 1;
		}
		for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
			*(undefined *)puVar9 = *(undefined *)puVar7;
			puVar7 = (undefined4 *)((int)puVar7 + 1);
			puVar9 = (undefined4 *)((int)puVar9 + 1);
		}
		std::free(pcVar2);
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu::Overwrite","Title",0);
	pcVar2 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar4 = util::replaceTextSpaces(pcVar2);
		uVar5 = 0xffffffff;
		do {
			pcVar8 = pcVar4;
			if (uVar5 == 0) break;
			uVar5 -= 1;
			pcVar8 = pcVar4 + 1;
			cVar1 = *pcVar4;
			pcVar4 = pcVar8;
		} while (cVar1 != '\0');
		uVar5 = ~uVar5;
		puVar7 = (undefined4 *)(pcVar8 + -uVar5);
		puVar9 = (undefined4 *)globals::menu::g_MenuOverwrite_Title;
		for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
			*puVar9 = *puVar7;
			puVar7 = puVar7 + 1;
			puVar9 = puVar9 + 1;
		}
		for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
			*(undefined *)puVar9 = *(undefined *)puVar7;
			puVar7 = (undefined4 *)((int)puVar7 + 1);
			puVar9 = (undefined4 *)((int)puVar9 + 1);
		}
		std::free(pcVar2);
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu::Overwrite","Text",0);
	pcVar2 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar4 = util::replaceTextSpaces(pcVar2);
		uVar5 = 0xffffffff;
		do {
			pcVar8 = pcVar4;
			if (uVar5 == 0) break;
			uVar5 -= 1;
			pcVar8 = pcVar4 + 1;
			cVar1 = *pcVar4;
			pcVar4 = pcVar8;
		} while (cVar1 != '\0');
		uVar5 = ~uVar5;
		puVar7 = (undefined4 *)(pcVar8 + -uVar5);
		puVar9 = (undefined4 *)globals::menu::g_MenuOverwrite_Text;
		for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
			*puVar9 = *puVar7;
			puVar7 = puVar7 + 1;
			puVar9 = puVar9 + 1;
		}
		for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
			*(undefined *)puVar9 = *(undefined *)puVar7;
			puVar7 = (undefined4 *)((int)puVar7 + 1);
			puVar9 = (undefined4 *)((int)puVar9 + 1);
		}
		std::free(pcVar2);
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu::Overwrite","Ok",0);
	pcVar2 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = util::replaceTextSpaces(pcVar2);
		uVar5 = 0xffffffff;
		do {
			pcVar4 = pcVar2;
			if (uVar5 == 0) break;
			uVar5 -= 1;
			pcVar4 = pcVar2 + 1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar4;
		} while (cVar1 != '\0');
		uVar5 = ~uVar5;
		puVar7 = (undefined4 *)(pcVar4 + -uVar5);
		puVar9 = (undefined4 *)globals::menu::g_MenuOverwrite_Ok;
		for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
			*puVar9 = *puVar7;
			puVar7 = puVar7 + 1;
			puVar9 = puVar9 + 1;
		}
		for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
			*(undefined *)puVar9 = *(undefined *)puVar7;
			puVar7 = (undefined4 *)((int)puVar7 + 1);
			puVar9 = (undefined4 *)((int)puVar9 + 1);
		}
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu::Overwrite","Cancel",0);
	pcVar2 = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = util::replaceTextSpaces(pcVar2);
		uVar5 = 0xffffffff;
		do {
			pcVar4 = pcVar2;
			if (uVar5 == 0) break;
			uVar5 -= 1;
			pcVar4 = pcVar2 + 1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar4;
		} while (cVar1 != '\0');
		uVar5 = ~uVar5;
		puVar7 = (undefined4 *)(pcVar4 + -uVar5);
		puVar9 = (undefined4 *)globals::menu::g_MenuOverwrite_Cancel;
		for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
			*puVar9 = *puVar7;
			puVar7 = puVar7 + 1;
			puVar9 = puVar9 + 1;
		}
		for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
			*(undefined *)puVar9 = *(undefined *)puVar7;
			puVar7 = (undefined4 *)((int)puVar7 + 1);
			puVar9 = (undefined4 *)((int)puVar9 + 1);
		}
	}
	FONT_00558078 = globals::g_Game.bmpMbriefFONT2;
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","Version",0);
	globals::g_Main_Version = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar2);
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","DefaultLevelBMPS",0);
	globals::g_Menu_DefaultLevelBMPS = cfg::CFG_CopyPropertyValue(globals::g_Game.LegoCfgRoot,pcVar2);
	PTR_005584fc = res::Res_CreateLight(globals::g_Game.resRoot,D3DRMLIGHT_DIRECTIONAL,0.8,0.8,0.8);
	res::Res_UnkSetup3DFrameTransform(PTR_005584fc,1);
	uVar10 = SUB41(root,0);
	globals::menu::g_MainMenuFull =
			 menu::Menu_ParseMenu
								 (uVar10,"MainMenuFull",&DAT_00558010,Main_ShowCredits,&INT_0055801c,0,0xffffffff);
	globals::menu::g_SaveMenu =
			 menu::Menu_ParseMenu(uVar10,"SaveMenu",&DAT_00558060,FUN_004150c0,0xffffffff);
	game::Game_UnkParseLevelIdentifier_004153e0
						(globals::g_Game.LegoCfgRoot,(uint *)&LevelIdentifier_00557fe4,"StartLevel");
	game::Game_UnkParseLevelIdentifier_004153e0
						(globals::g_Game.LegoCfgRoot,(uint *)&LevelIdentifier_00557fd0,"TutorialStartLevel");
	FUN_00415940(globals::menu::g_MainMenuFull);
	globals::menu::g_PausedMenu =
			 menu::Menu_ParseMenu
								 (uVar10,"PausedMenu",&INT_0055802c,NULL,&globals::g_GameSpeed_SliderLevel,
									FUN_00414e50,&INT_00558034,FUN_00414d10,&DAT_00558038,
									snd::SFX_UNKCallsMixer2__00414d20,&INT_0055803c,FUN_00414c60,&INT_00558040,
									FUN_00414e10,&DAT_00558044,FUN_00414e40,&DAT_00558048,0,&DAT_0055804c,0,
									&DAT_00558050,FUN_00414d80,&DAT_00558054,snd::Music_PlayNext_Not,&DAT_00558058,
									FUN_00414df0,&DAT_0055805c,FUN_00414db0,0xffffffff);
	globals::menu::g_OptionsMenu =
			 menu::Menu_ParseMenu
								 (uVar10,"OptionsMenu",&globals::g_GameSpeed_SliderLevel,FUN_00414e50,&INT_00558034,
									FUN_00414d10,&DAT_00558038,snd::SFX_UNKCallsMixer2__00414d20,&INT_0055803c,
									FUN_00414c60,&INT_00558040,FUN_00414e10,&DAT_00558044,FUN_00414e40,&INT_0055802c,0
									,0xffffffff);
	INT_00558034 = 8;
	INT_0055802c = 0;
	INT_0055803c = 5;
	INT_00558040 = 1;
	DAT_00558044 = 0;
	globals::g_GameSpeed_SliderLevel = front::FrontEnd_CalcGameSpeedSliderLevel();
	_DAT_00558038 = FUN_00414d40();
	DAT_00558500 = 0;
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","MaxLevelScreens",0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 == NULL) {
		pcVar2 = ____EMPTYSTR__;
	}
	else {
		pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","MaxLevelScreens",0);
		pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	}
	globals::g_Menu_MaxLevelScreens = std::atoi(pcVar2);
	if (globals::g_Menu_MaxLevelScreens == 0) {
		globals::g_Menu_MaxLevelScreens = 1;
	}
	_DAT_00558824 = 0;
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","SaveImage","BigWidth",0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 == NULL) {
		pcVar2 = ____EMPTYSTR__;
	}
	else {
		pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","SaveImage","BigWidth",0);
		pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	}
	globals::g_Menu_SaveImage_BigSize.width = std::atoi(pcVar2);
	if (globals::g_Menu_SaveImage_BigSize.width == 0) {
		globals::g_Menu_SaveImage_BigSize.width = 0x50;
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","SaveImage","BigHeight",0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 == NULL) {
		pcVar2 = ____EMPTYSTR__;
	}
	else {
		pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","SaveImage","BigHeight",0);
		pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	}
	globals::g_Menu_SaveImage_BigSize.height = std::atoi(pcVar2);
	if (globals::g_Menu_SaveImage_BigSize.height == 0) {
		globals::g_Menu_SaveImage_BigSize.height = 0x3c;
	}
	FUN_00418040(1);
	return;
}



void __cdecl FUN_00416840(void)
{
	undefined *puVar1;
	
	puVar1 = FUN_00417da0();
	if (puVar1 != NULL) {
		*(int *)(puVar1 + 0xc) = lego::globals::g_GameSpeed_SliderLevel;
		*(int *)(puVar1 + 8) = INT_00558034;
		*(int *)(puVar1 + 0x10) = INT_0055803c;
	}
	return;
}



void __cdecl FUN_00416870(BOOL param_1,BOOL param_2)
{
	undefined *puVar1;
	
	if (param_2 != 0) {
		INT_0055801c = 0;
		INT_00558020 = -1;
		INT_00558024 = -1;
		INT_0055802c = 0;
	}
	if (param_1 != 0) {
		if (INT_00558028 != -1) {
			puVar1 = FUN_00417da0();
			if (puVar1 != NULL) {
				puVar1 = FUN_00417da0();
				lego::globals::g_GameSpeed_SliderLevel = *(int *)(puVar1 + 0xc);
				INT_00558034 = *(int *)(puVar1 + 8);
				INT_0055803c = *(int *)(puVar1 + 0x10);
				return;
			}
		}
		lego::globals::g_GameSpeed_SliderLevel = 1;
		INT_00558034 = 8;
		INT_0055803c = 5;
	}
	return;
}



void __cdecl lego::front::Menu_FUN_004168f0(int menuId)
{
	undefined *puVar1;
	int iVar2;
	LevelIdentifier *pLVar3;
	undefined4 uVar4;
	undefined4 uVar5;
	
	switch(menuId) {
	case 0:
		INT_00558028 = -1;
		FUN_00416870(1,1);
		puVar1 = FUN_00417da0();
		if (puVar1 == NULL) {
			if (DAT_0055881c != 0) {
				FUN_00417310(DAT_00557ff8,0,&LevelIdentifier_00557fe4,
										 *(undefined4 *)
											(*(int *)(*(int *)(*(int *)(*globals::menu::g_MainMenuFull + 4) + 0x18) + 4) +
											0x10),1);
			}
		}
		else {
LAB_00416af1:
			uVar5 = 0;
			uVar4 = *(undefined4 *)
							 (*(int *)(*(int *)(*(int *)(*globals::menu::g_MainMenuFull + 4) + 0x18) + 4) + 0x10);
			pLVar3 = &LevelIdentifier_00557fe4;
			puVar1 = FUN_00417da0();
			FUN_00417310(DAT_00557ff8,*(int *)(puVar1 + 0x34),pLVar3,uVar4,uVar5);
		}
		break;
	case 1:
		FUN_00416870(1,1);
		puVar1 = FUN_00417da0();
		if (puVar1 == NULL) {
			if (DAT_0055881c == 0) goto LAB_004169dd;
			uVar5 = 1;
			uVar4 = *(undefined4 *)
							 (*(int *)(*(int *)(*(int *)(*globals::menu::g_MainMenuFull + 4) + 0x18) + 4) + 0x10);
			pLVar3 = &LevelIdentifier_00557fe4;
			iVar2 = 0;
		}
		else {
			uVar5 = 0;
			uVar4 = *(undefined4 *)
							 (*(int *)(*(int *)(*(int *)(*globals::menu::g_MainMenuFull + 4) + 0x18) + 4) + 0x10);
			pLVar3 = &LevelIdentifier_00557fe4;
			puVar1 = FUN_00417da0();
			iVar2 = *(int *)(puVar1 + 0x34);
		}
		FUN_00417310(DAT_00557ff8,iVar2,pLVar3,uVar4,uVar5);
LAB_004169dd:
		FUN_00417310(DAT_00557ffc,0,&LevelIdentifier_00557fd0,
								 *(undefined4 *)
									(*(int *)(*(int *)(*(int *)(*globals::menu::g_MainMenuFull + 8) + 0x18) + 4) +
									0x10),0);
		FUN_00418040(1);
		return;
	case 2:
		FUN_00416870(1,1);
		puVar1 = FUN_00417da0();
		if (puVar1 == NULL) {
			if (DAT_0055881c == 0) goto LAB_00416a8d;
			uVar5 = 1;
			uVar4 = *(undefined4 *)
							 (*(int *)(*(int *)(*(int *)(*globals::menu::g_MainMenuFull + 4) + 0x18) + 4) + 0x10);
			pLVar3 = &LevelIdentifier_00557fe4;
			iVar2 = 0;
		}
		else {
			uVar5 = 0;
			uVar4 = *(undefined4 *)
							 (*(int *)(*(int *)(*(int *)(*globals::menu::g_MainMenuFull + 4) + 0x18) + 4) + 0x10);
			pLVar3 = &LevelIdentifier_00557fe4;
			puVar1 = FUN_00417da0();
			iVar2 = *(int *)(puVar1 + 0x34);
		}
		FUN_00417310(DAT_00557ff8,iVar2,pLVar3,uVar4,uVar5);
LAB_00416a8d:
		FUN_00417310(DAT_00557ffc,0,&LevelIdentifier_00557fd0,
								 *(undefined4 *)
									(*(int *)(*(int *)(*(int *)(*globals::menu::g_MainMenuFull + 8) + 0x18) + 4) +
									0x10),0);
		FUN_00418040(1);
		return;
	case 3:
		FUN_00416870(0,1);
		FUN_00418040(1);
		return;
	case 4:
		FUN_00416870(0,1);
		puVar1 = FUN_00417da0();
		if (puVar1 != NULL) goto LAB_00416af1;
		if (DAT_0055881c != 0) {
			FUN_00417310(DAT_00557ff8,0,&LevelIdentifier_00557fe4,
									 *(undefined4 *)
										(*(int *)(*(int *)(*(int *)(*globals::menu::g_MainMenuFull + 4) + 0x18) + 4) +
										0x10),1);
			DAT_00558500 = 1;
		}
		break;
	default:
		goto switchD_004168fd_caseD_5;
	}
	FUN_00417310(DAT_00557ffc,0,&LevelIdentifier_00557fd0,
							 *(undefined4 *)
								(*(int *)(*(int *)(*(int *)(*globals::menu::g_MainMenuFull + 8) + 0x18) + 4) + 0x10)
							 ,0);
switchD_004168fd_caseD_5:
	FUN_00418040(1);
	return;
}



undefined4 __cdecl lego::front::Menu_Open_FUN_00416bb0(int menuId)
{
	int *piVar1;
	int iVar2;
	
	piVar1 = globals::menu::g_MainMenuFull;
	Menu_FUN_004168f0(menuId);
	snd::Audio_AddToSoundQueue1(0x2c,1);
	if (true) {
		switch(menuId) {
		case 0:
			iVar2 = 0;
			break;
		case 1:
			iVar2 = 1;
			break;
		case 2:
			iVar2 = 2;
			break;
		default:
			goto switchD_00416bd6_caseD_3;
		case 4:
			iVar2 = 0;
			piVar1 = globals::menu::g_SaveMenu;
		}
		Menu_FUN_00413d50(piVar1,iVar2);
	}
switchD_00416bd6_caseD_3:
	snd::AudioPlayback_Cleanup(1);
	snd::AudioPlayback_Cleanup(0);
	return 0;
}



BOOL __cdecl lego::main::Config_IsFrontEndEnabled(void)
{
	char *keyPath;
	uint uVar1;
	
	keyPath = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","FrontEnd",0);
	uVar1 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,keyPath);
	if ((uVar1 == 1) && (globals::g_PROGRAMMER_MODE < PROGRAMMER_MODE_3)) {
		return 1;
	}
	return 0;
}



BOOL __cdecl lego::unk::Lego_GetIntNotM1__00558020(void)
{
	return (uint)(INT_00558020 != -1);
}



BOOL __cdecl lego::unk::Lego_GetIntNotM1__00558024(void)
{
	return (uint)(INT_00558024 != -1);
}



undefined4 __cdecl FUN_00416ca0(void)
{
	BOOL BVar1;
	int iVar2;
	
	BVar1 = lego::unk::Lego_GetIntNotM1__00558020();
	if (BVar1 == 0) {
		BVar1 = lego::unk::Lego_GetIntNotM1__00558024();
		if (BVar1 == 0) {
			return 0;
		}
		iVar2 = FUN_00417200(DAT_00557ffc,INT_00558024);
		if (iVar2 != -1) {
			return *(undefined4 *)(LevelIdentifier_00557fd0.field_4 + iVar2 * 4);
		}
	}
	else {
		iVar2 = FUN_00417200(DAT_00557ff8,INT_00558020);
		if (iVar2 != -1) {
			return *(undefined4 *)(LevelIdentifier_00557fe4.field_4 + iVar2 * 4);
		}
	}
	return 0;
}



int __cdecl lego::unk::Lego_GetInt_0055801c(void)
{
	return INT_0055801c;
}



BOOL __cdecl FUN_00416d10(void)
{
	return (uint)(DAT_00558048 != 0);
}



BOOL __cdecl FUN_00416d20(void)
{
	return (uint)(DAT_0055804c != 0);
}



undefined4 * __cdecl FUN_00416d30(void)
{
	BOOL BVar1;
	LevelIdentifier *pLVar2;
	
	BVar1 = lego::unk::Lego_GetIntNotM1__00558024();
	pLVar2 = &LevelIdentifier_00557fd0;
	if (BVar1 == 0) {
		pLVar2 = &LevelIdentifier_00557fe4;
	}
	return (undefined4 *)pLVar2;
}



int __cdecl FUN_00416d50(int *param_1,char *param_2)
{
	int iVar1;
	int iVar2;
	
	iVar2 = 0;
	if (*param_1 < 1) {
		return -1;
	}
	do {
		iVar1 = std::_stricmp(param_2,*(char **)(param_1[1] + iVar2 * 4));
		if (iVar1 == 0) {
			return iVar2;
		}
		iVar2 += 1;
	} while (iVar2 < *param_1);
	return -1;
}



void __cdecl FUN_00416da0(void)
{
	int iVar1;
	int iVar2;
	
	iVar2 = 0;
	if (0 < LevelIdentifier_00557fe4.field_0) {
		do {
			iVar1 = *(int *)(LevelIdentifier_00557fe4.field_c + iVar2 * 4);
			if (iVar1 != 0) {
				*(undefined4 *)(iVar1 + 0x10) = 0;
				*(undefined4 *)(LevelIdentifier_00557fe4.field_10 + iVar2 * 4) = 0;
			}
			iVar2 += 1;
		} while (iVar2 < LevelIdentifier_00557fe4.field_0);
	}
	iVar2 = 0;
	if (0 < LevelIdentifier_00557fd0.field_0) {
		do {
			iVar1 = *(int *)(LevelIdentifier_00557fd0.field_c + iVar2 * 4);
			if (iVar1 != 0) {
				*(undefined4 *)(iVar1 + 0x10) = 0;
				*(undefined4 *)(LevelIdentifier_00557fd0.field_10 + iVar2 * 4) = 0;
			}
			iVar2 += 1;
		} while (iVar2 < LevelIdentifier_00557fd0.field_0);
	}
	return;
}



void __cdecl FUN_00416e00(int *param_1,byte *param_2,undefined4 param_3)
{
	byte bVar1;
	byte *pbVar2;
	int iVar3;
	int iVar4;
	byte *pbVar5;
	byte **ppbVar6;
	bool bVar7;
	
	iVar4 = 0;
	if (*param_1 < 1) {
		return;
	}
	ppbVar6 = (byte **)param_1[1];
	do {
		pbVar2 = *ppbVar6;
		pbVar5 = param_2;
		do {
			bVar1 = *pbVar2;
			bVar7 = bVar1 < *pbVar5;
			if (bVar1 != *pbVar5) {
LAB_00416e3d:
				iVar3 = (1 - (uint)bVar7) - (uint)(bVar7 != 0);
				goto LAB_00416e42;
			}
			if (bVar1 == 0) break;
			bVar1 = pbVar2[1];
			bVar7 = bVar1 < pbVar5[1];
			if (bVar1 != pbVar5[1]) goto LAB_00416e3d;
			pbVar2 = pbVar2 + 2;
			pbVar5 = pbVar5 + 2;
		} while (bVar1 != 0);
		iVar3 = 0;
LAB_00416e42:
		if (iVar3 == 0) {
			*(undefined4 *)(param_1[4] + iVar4 * 4) = param_3;
			return;
		}
		iVar4 += 1;
		ppbVar6 = ppbVar6 + 1;
		if (*param_1 <= iVar4) {
			return;
		}
	} while( true );
}



undefined4 __cdecl FUN_00416e70(int *param_1,byte *param_2)
{
	byte bVar1;
	byte *pbVar2;
	int iVar3;
	int iVar4;
	byte *pbVar5;
	byte **ppbVar6;
	bool bVar7;
	
	iVar4 = 0;
	if (*param_1 < 1) {
		return 0;
	}
	ppbVar6 = (byte **)param_1[1];
	do {
		pbVar2 = *ppbVar6;
		pbVar5 = param_2;
		do {
			bVar1 = *pbVar2;
			bVar7 = bVar1 < *pbVar5;
			if (bVar1 != *pbVar5) {
LAB_00416ead:
				iVar3 = (1 - (uint)bVar7) - (uint)(bVar7 != 0);
				goto LAB_00416eb2;
			}
			if (bVar1 == 0) break;
			bVar1 = pbVar2[1];
			bVar7 = bVar1 < pbVar5[1];
			if (bVar1 != pbVar5[1]) goto LAB_00416ead;
			pbVar2 = pbVar2 + 2;
			pbVar5 = pbVar5 + 2;
		} while (bVar1 != 0);
		iVar3 = 0;
LAB_00416eb2:
		if (iVar3 == 0) {
			return *(undefined4 *)(param_1[4] + iVar4 * 4);
		}
		iVar4 += 1;
		ppbVar6 = ppbVar6 + 1;
		if (*param_1 <= iVar4) {
			return 0;
		}
	} while( true );
}



void __cdecl FUN_00416ee0(int *param_1,byte *param_2,undefined4 param_3)
{
	byte bVar1;
	byte *pbVar2;
	int iVar3;
	int iVar4;
	byte *pbVar5;
	byte **ppbVar6;
	bool bVar7;
	
	iVar4 = 0;
	if (*param_1 < 1) {
		return;
	}
	ppbVar6 = (byte **)param_1[1];
	do {
		pbVar2 = *ppbVar6;
		pbVar5 = param_2;
		do {
			bVar1 = *pbVar2;
			bVar7 = bVar1 < *pbVar5;
			if (bVar1 != *pbVar5) {
LAB_00416f1d:
				iVar3 = (1 - (uint)bVar7) - (uint)(bVar7 != 0);
				goto LAB_00416f22;
			}
			if (bVar1 == 0) break;
			bVar1 = pbVar2[1];
			bVar7 = bVar1 < pbVar5[1];
			if (bVar1 != pbVar5[1]) goto LAB_00416f1d;
			pbVar2 = pbVar2 + 2;
			pbVar5 = pbVar5 + 2;
		} while (bVar1 != 0);
		iVar3 = 0;
LAB_00416f22:
		if (iVar3 == 0) {
			*(undefined4 *)(param_1[3] + iVar4 * 4) = param_3;
			return;
		}
		iVar4 += 1;
		ppbVar6 = ppbVar6 + 1;
		if (*param_1 <= iVar4) {
			return;
		}
	} while( true );
}



undefined4 __cdecl FUN_00416f50(int *param_1,byte *param_2)
{
	byte bVar1;
	byte *pbVar2;
	int iVar3;
	int iVar4;
	byte *pbVar5;
	byte **ppbVar6;
	bool bVar7;
	
	iVar4 = 0;
	if (*param_1 < 1) {
		return 0;
	}
	ppbVar6 = (byte **)param_1[1];
	do {
		pbVar2 = *ppbVar6;
		pbVar5 = param_2;
		do {
			bVar1 = *pbVar2;
			bVar7 = bVar1 < *pbVar5;
			if (bVar1 != *pbVar5) {
LAB_00416f8d:
				iVar3 = (1 - (uint)bVar7) - (uint)(bVar7 != 0);
				goto LAB_00416f92;
			}
			if (bVar1 == 0) break;
			bVar1 = pbVar2[1];
			bVar7 = bVar1 < pbVar5[1];
			if (bVar1 != pbVar5[1]) goto LAB_00416f8d;
			pbVar2 = pbVar2 + 2;
			pbVar5 = pbVar5 + 2;
		} while (bVar1 != 0);
		iVar3 = 0;
LAB_00416f92:
		if (iVar3 == 0) {
			return *(undefined4 *)(param_1[3] + iVar4 * 4);
		}
		iVar4 += 1;
		ppbVar6 = ppbVar6 + 1;
		if (*param_1 <= iVar4) {
			return 0;
		}
	} while( true );
}



int * __cdecl FUN_00416fc0(int *param_1,byte *param_2)
{
	int iVar1;
	int *piVar2;
	char *pcVar3;
	uint uVar4;
	void *pvVar5;
	int *piVar6;
	uint uVar7;
	byte *local_3c [15];
	
	if (param_2 != NULL) {
		iVar1 = FUN_00416e70(param_1,param_2);
		if (iVar1 != 0) {
			piVar2 = (int *)FUN_00416f50(param_1,param_2);
			return piVar2;
		}
		piVar2 = (int *)std::malloc(0x14);
		FUN_00416e00(param_1,param_2,1);
		FUN_00416ee0(param_1,param_2,piVar2);
		if (piVar2 != NULL) {
			iVar1 = FUN_00416d50(param_1,(char *)param_2);
			if (iVar1 != -1) {
				pcVar3 = lego::cfg::CFG_JoinPath
													 (lego::globals::g_Game.CfgRootName,(char *)param_2,"LevelLinks",0);
				pcVar3 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar3);
				*piVar2 = iVar1;
				uVar7 = 0;
				if (pcVar3 == NULL) {
					piVar2[1] = 0;
				}
				else {
					uVar4 = lego::util::stringSplit(pcVar3,(char **)local_3c,",");
					if (uVar4 == 0) goto LAB_004170bd;
					pvVar5 = std::malloc(uVar4 * 4);
					piVar2[1] = (int)pvVar5;
					if (uVar4 != 0) {
						do {
							piVar6 = FUN_00416fc0(param_1,local_3c[uVar7]);
							*(int **)(piVar2[1] + uVar7 * 4) = piVar6;
							uVar7 += 1;
						} while (uVar7 < uVar4);
						piVar2[2] = uVar7;
						return piVar2;
					}
				}
				piVar2[2] = 0;
				return piVar2;
			}
LAB_004170bd:
			std::free(piVar2);
			return NULL;
		}
	}
	return NULL;
}



BOOL __cdecl FUN_004170f0(int param_1,undefined *param_2,undefined4 param_3)
{
	int iVar1;
	BOOL BVar2;
	uint uVar3;
	
	if ((param_1 != 0) && (*(int *)(param_1 + 0x10) == 0)) {
		*(undefined4 *)(param_1 + 0x10) = 1;
		iVar1 = (*(code *)param_2)(param_1,param_3);
		if (iVar1 != 0) {
			return 1;
		}
		if ((*(int *)(param_1 + 4) != 0) && (uVar3 = 0, *(int *)(param_1 + 8) != 0)) {
			do {
				BVar2 = FUN_004170f0(*(int *)(*(int *)(param_1 + 4) + uVar3 * 4),param_2,param_3);
				if (BVar2 != 0) {
					return 1;
				}
				uVar3 += 1;
			} while (uVar3 < *(uint *)(param_1 + 8));
			return 0;
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00417170(undefined4 param_1,int *param_2)
{
	*param_2 = *param_2 + 1;
	return 0;
}



BOOL __cdecl FUN_00417180(undefined4 param_1,undefined4 *param_2)
{
	int iVar1;
	
	iVar1 = param_2[2];
	if (param_2[1] == iVar1) {
		param_2[3] = iVar1;
		*param_2 = param_1;
		return 1;
	}
	param_2[2] = iVar1 + 1;
	return 0;
}



undefined4 __cdecl FUN_004171b0(int param_1,undefined4 param_2)
{
	BOOL BVar1;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_10 = 0;
	local_8 = 0;
	local_4 = 0;
	local_c = param_2;
	BVar1 = FUN_004170f0(param_1,FUN_00417180,&local_10);
	if (BVar1 != 0) {
		FUN_00416da0();
		return local_10;
	}
	FUN_00416da0();
	return 0;
}



undefined4 __cdecl FUN_00417200(int param_1,undefined4 param_2)
{
	undefined4 *puVar1;
	
	puVar1 = (undefined4 *)FUN_004171b0(param_1,param_2);
	if (puVar1 != NULL) {
		return *puVar1;
	}
	return 0xffffffff;
}



void __cdecl FUN_00417220(int *struct14_1,int *struct14_2,BOOL param_3)
{
	uint *puVar1;
	uint uVar2;
	uint uVar3;
	uint uVar4;
	
	uVar4 = 0;
	if ((struct14_1 != NULL) && (struct14_1[4] == 0)) {
		if ((PROGRAMMER_MODE_1 < lego::globals::g_PROGRAMMER_MODE) ||
			 ((lego::globals::g_CMDLINE_FLAGS & CMD_TESTLEVELS) != CMD_NONE)) {
			struct14_2[4] = 0;
		}
		struct14_1[4] = 1;
		if (((*struct14_2 == 0) || (PROGRAMMER_MODE_1 < lego::globals::g_PROGRAMMER_MODE)) ||
			 ((lego::globals::g_CMDLINE_FLAGS & CMD_TESTLEVELS) != CMD_NONE)) {
			uVar3 = (uint)(struct14_2[4] == 0);
		}
		else {
			uVar3 = *(uint *)(*struct14_1 * 0x3190 + *struct14_2) & 1;
		}
		if (((uVar3 == 0) && (param_3 == 0)) &&
			 (puVar1 = (uint *)(*(int *)struct14_2[2] + struct14_2[3] * 0x20),
			 *(int *)(*(int *)struct14_2[2] + 0x1c + struct14_2[3] * 0x20) == 0)) {
			uVar2 = *puVar1 & 0xfffffffb;
		}
		else {
			puVar1 = (uint *)(*(int *)struct14_2[2] + struct14_2[3] * 0x20);
			uVar2 = *(uint *)(*(int *)struct14_2[2] + struct14_2[3] * 0x20) | 4;
		}
		*puVar1 = uVar2;
		struct14_2[3] = struct14_2[3] + 1;
		if (struct14_1[2] != 0) {
			do {
				FUN_00417220(*(int **)(struct14_1[1] + uVar4 * 4),struct14_2,uVar3);
				uVar4 += 1;
			} while (uVar4 < (uint)struct14_1[2]);
		}
	}
	return;
}



void __cdecl
FUN_00417310(int *param_1,int param_2,undefined4 param_3,undefined4 param_4,undefined4 param_5)
{
	LevelIdentifier local_14;
	
	local_14.field_4 = param_3;
	local_14.field_8 = param_4;
	local_14.field_0 = param_2;
	local_14.field_c = 0;
	local_14.field_10 = param_5;
	FUN_00417220(param_1,(int *)&local_14,1);
	FUN_00416da0();
	return;
}



longlong FUN_00417360(int param_1,int param_2)
{
	longlong lVar1;
	
	lVar1 = __ftol((float10)*(float *)(param_1 * 0x3190 + 0x2fb8 + *(int *)(param_2 + 0x34)));
	return lVar1;
}



void __cdecl
lego::unk::lego_uses_testercall_FUN_00417390(undefined4 param_1,undefined4 param_2,float param_3)
{
	ImageFont *font;
	Struct_830 *pSVar1;
	uint uVar2;
	void *pvVar3;
	int *piVar4;
	undefined *puVar5;
	ImageFont *pIVar6;
	undefined4 uVar7;
	char *pcVar8;
	int iVar9;
	byte *format;
	undefined4 *puVar10;
	char local_16c;
	undefined local_16b [63];
	char local_12c [8];
	char acStack292 [292];
	
	pvVar3 = globals::g_UnkStruct728_Menu_LevelText;
	font = *(ImageFont **)(*(int *)(*globals::menu::g_MainMenuFull + 4) + 0xc);
	piVar4 = (int *)FUN_004171b0(DAT_00557ff8,param_2);
	format = *(byte **)(LevelIdentifier_00557fe4.field_8 + *piVar4 * 4);
	local_16c = '\0';
	puVar10 = (undefined4 *)local_16b;
	for (iVar9 = 0xf; iVar9 != 0; iVar9 += -1) {
		*puVar10 = 0;
		puVar10 = puVar10 + 1;
	}
	*(undefined2 *)puVar10 = 0;
	*(undefined *)((int)puVar10 + 2) = 0;
	puVar5 = FUN_00417da0();
	DAT_00558838 = DAT_00558834;
	DAT_00558834 = *piVar4 + 1;
	if ((globals::g_CMDLINE_FLAGS & CMD_TESTERCALL) != CMD_NONE) {
		std::sprintf(&local_16c," (Level %d)",*piVar4 + 1);
	}
	if ((format == NULL) || (*format == 0)) {
		format = *(byte **)(LevelIdentifier_00557fe4.field_4 + *piVar4 * 4);
	}
										// WARNING: Load size is inaccurate
	pSVar1 = *pvVar3;
	if (pSVar1 == NULL) {
		pIVar6 = FUN_00401b90(font,(char *)format);
		FUN_00410250(font,globals::g_RESOLUTION.width / 2 - (int)pIVar6 / 2,0x186,format);
	}
	else {
		if ((BOOL_004dc8c4 != 0) &&
			 (game::Game_DisplayInfoMessage(pSVar1,(char *)format),
			 (globals::g_CMDLINE_FLAGS & CMD_TESTERCALL) != CMD_NONE)) {
										// WARNING: Load size is inaccurate
			game::Game_DisplayInfoMessage(*pvVar3,&local_16c);
		}
	}
	if (puVar5 != NULL) {
		uVar2 = *(uint *)(*(int *)(puVar5 + 0x34) + *piVar4 * 0x3190);
		if (((uVar2 & 1) != 0) && ((uVar2 & 2) == 0)) {
			uVar7 = FUN_00417360(*piVar4,puVar5);
			pcVar8 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","Level_Completed",0,uVar7);
			pcVar8 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar8);
			std::sprintf(acStack292," %s (%i)",pcVar8);
			util::stringReplaceChar(acStack292,'_',' ');
			goto LAB_0041757a;
		}
	}
	pcVar8 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Menu","Level_Incomplete",0);
	pcVar8 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar8);
	std::sprintf(local_12c," %s",pcVar8);
	util::stringReplaceChar(local_12c,'_',' ');
LAB_0041757a:
	if ((*local_16b._3_4_ != NULL) && (BOOL_004dc8c4 != 0)) {
		game::Game_DisplayInfoMessage(*local_16b._3_4_,acStack292);
		if (DAT_00558834 != DAT_00558838) {
			BOOL_0055883c = 1;
			FLOAT_00558840 = 0.0;
		}
		if ((BOOL_0055883c != 0) &&
			 (FLOAT_00558840 = param_3 + FLOAT_00558840,
			 (ushort)((ushort)(FLOAT_00558840 * 25.0 < 500.0) << 8 |
							 (ushort)(FLOAT_00558840 * 25.0 == 500.0) << 0xe) == 0)) {
			if (DAT_00558834 < 9) {
				iVar9 = FUN_004160d0(DAT_00558834);
			}
			else {
				iVar9 = FUN_00416080(DAT_00558834 + -8);
			}
			if (iVar9 != 0) {
				BOOL_0055883c = 0;
			}
		}
	}
	BOOL_004dc8c4 = 0;
	return;
}



void __cdecl FUN_00417630(float param_1,undefined4 param_2)
{
	void *pvVar1;
	int *piVar2;
	BOOL BVar3;
	char *pcVar4;
	
	pvVar1 = lego::globals::g_UnkStruct728_Menu_LevelText;
	piVar2 = (int *)FUN_004171b0(DAT_00557ffc,param_2);
	pcVar4 = *(char **)(LevelIdentifier_00557fd0.field_8 + *piVar2 * 4);
	DAT_00558838 = DAT_00558834;
	DAT_00558834 = *piVar2 + 1;
	if ((pcVar4 == NULL) || (*pcVar4 == '\0')) {
		pcVar4 = *(char **)(LevelIdentifier_00557fd0.field_4 + *piVar2 * 4);
	}
										// WARNING: Load size is inaccurate
	if ((*pvVar1 != NULL) && (BOOL_004dc8c4 != 0)) {
		lego::game::Game_DisplayInfoMessage(*pvVar1,pcVar4);
		if (DAT_00558834 != DAT_00558838) {
			BOOL_0055883c = 1;
			FLOAT_00558840 = 0.0;
		}
		if ((BOOL_0055883c != 0) &&
			 (FLOAT_00558840 = param_1 + FLOAT_00558840,
			 (ushort)((ushort)(FLOAT_00558840 * 25.0 < 500.0) << 8 |
							 (ushort)(FLOAT_00558840 * 25.0 == 500.0) << 0xe) == 0)) {
			BVar3 = FUN_004160d0(DAT_00558834);
			if (BVar3 != 0) {
				BOOL_0055883c = 0;
			}
		}
	}
	BOOL_004dc8c4 = 0;
	return;
}



undefined4 __cdecl FUN_00417710(int *param_1,int *param_2)
{
	char cVar1;
	char *pcVar2;
	int iVar3;
	int iVar4;
	uint uVar5;
	char *pcVar6;
	byte *buffer;
	uint uVar7;
	uint uVar8;
	undefined4 *puVar9;
	undefined4 *puVar10;
	undefined4 local_400 [256];
	
	pcVar6 = *(char **)(*(int *)(*param_2 + 4) + *param_1 * 4);
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,pcVar6,"FrontEndX",0);
	pcVar2 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 == NULL) {
		pcVar2 = ____EMPTYSTR__;
	}
	else {
		pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,pcVar6,"FrontEndX",0);
		pcVar2 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	}
	iVar3 = std::atoi(pcVar2);
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,pcVar6,"FrontEndY",0);
	pcVar2 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (pcVar2 == NULL) {
		pcVar2 = ____EMPTYSTR__;
	}
	else {
		pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,pcVar6,"FrontEndY",0);
		pcVar2 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	}
	iVar4 = std::atoi(pcVar2);
	pcVar2 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,pcVar6,"FrontEndOpen",0);
	uVar5 = lego::cfg::CFG_GetPropertyBool(lego::globals::g_Game.LegoCfgRoot,pcVar2);
	if (uVar5 == 2) {
		uVar5 = 0;
	}
	pcVar6 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,pcVar6,"MenuBMP",0);
	buffer = (byte *)lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Game.LegoCfgRoot,pcVar6);
	if (buffer != NULL) {
		FUN_00410670((int **)param_2[2],buffer,0,NULL,iVar3,iVar4,uVar5);
		std::free(buffer);
		return 0;
	}
	uVar7 = 0xffffffff;
	pcVar6 = lego::globals::g_Menu_DefaultLevelBMPS;
	do {
		pcVar2 = pcVar6;
		if (uVar7 == 0) break;
		uVar7 -= 1;
		pcVar2 = pcVar6 + 1;
		cVar1 = *pcVar6;
		pcVar6 = pcVar2;
	} while (cVar1 != '\0');
	uVar7 = ~uVar7;
	puVar9 = (undefined4 *)(pcVar2 + -uVar7);
	puVar10 = local_400;
	for (uVar8 = uVar7 >> 2; uVar8 != 0; uVar8 -= 1) {
		*puVar10 = *puVar9;
		puVar9 = puVar9 + 1;
		puVar10 = puVar10 + 1;
	}
	for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
		*(undefined *)puVar10 = *(undefined *)puVar9;
		puVar9 = (undefined4 *)((int)puVar9 + 1);
		puVar10 = (undefined4 *)((int)puVar10 + 1);
	}
	FUN_00410670((int **)param_2[2],(byte *)local_400,0,NULL,iVar3,iVar4,uVar5);
	return 0;
}



void __cdecl
FUN_004178e0(int param_1,int param_2,undefined4 param_3,int param_4,undefined4 param_5,
						undefined4 param_6,undefined4 param_7)
{
	int iVar1;
	undefined4 *puVar2;
	undefined4 *puVar3;
	undefined4 local_10;
	int local_c;
	undefined4 *local_8;
	undefined4 local_4;
	
	iVar1 = param_4;
	local_10 = param_3;
	local_c = param_4;
	local_8 = NULL;
	local_4 = param_5;
	param_3 = 0;
	FUN_004170f0(param_2,FUN_00417170,&param_3);
	FUN_00416da0();
	puVar2 = FUN_00410520(&DAT_00558010 + param_1 * 4,____EMPTYSTR__,____EMPTYSTR__,0,0,0,param_3,0,0,
												0,0,0,param_7,param_6);
	puVar3 = FUN_00410c80("Levels!!!",NULL,NULL,0,0,6,1,puVar2,0);
	FUN_00411190(iVar1,(int)puVar3);
	local_8 = puVar2;
	FUN_004170f0(param_2,FUN_00417710,&local_10);
	FUN_00416da0();
	return;
}



BOOL __cdecl
lego::game::Game_UnkLoadSaveSlot__004179c0(uint saveIndex,undefined4 *param_2,BOOL param_3)
{
	uint saveNumber;
	FileStream *file;
	byte *out_buffer;
	int iVar1;
	undefined4 unaff_EBP;
	undefined4 unaff_ESI;
	undefined4 unaff_EDI;
	undefined4 *puVar2;
	undefined4 in_stack_ffffff98;
	undefined4 uVar3;
	uint in_stack_ffffff9c;
	
	saveNumber = saveIndex;
	if (saveIndex < 6) {
		std::sprintf(&stack0xffffff9c,"%s\\%i.sav","Saves",saveIndex);
		file = lego::file::File_Open(&stack0xffffff9c,"rb");
		puVar2 = param_2;
		if (file != NULL) {
			saveIndex = 0;
			uVar3 = 0;
			lego::file::File_Read((byte *)param_2,0xb0,1,file);
			FUN_004170f0(DAT_00557ff8,FUN_00417170,&saveIndex);
			FUN_00416da0();
			FUN_004170f0(DAT_00557ffc,FUN_00417170,&stack0xffffff98);
			FUN_00416da0();
			if ((puVar2[6] != saveIndex) && (param_3 == 0)) {
				save::Save_SPrintfFileUnkWrite__00417b00
									(saveNumber,0,unaff_EDI,unaff_ESI,unaff_EBP,uVar3,in_stack_ffffff9c);
				for (iVar1 = 0x2e; iVar1 != 0; iVar1 += -1) {
					*puVar2 = 0;
					puVar2 = puVar2 + 1;
				}
				return 0;
			}
			out_buffer = (byte *)std::malloc(puVar2[6] * 0x3190);
			puVar2[0xd] = out_buffer;
			lego::file::File_Read(out_buffer,0x3190,puVar2[6],file);
			lego::file::File_Close(file);
			return 1;
		}
		if (param_3 == 0) {
			save::Save_SPrintfFileUnkWrite__00417b00
								(saveNumber,0,unaff_EDI,unaff_ESI,unaff_EBP,in_stack_ffffff98,in_stack_ffffff9c);
		}
	}
	return 0;
}



// WARNING: Function: _alloca4k replaced with injection: alloca_probe

BOOL __cdecl
lego::save::Save_SPrintfFileUnkWrite__00417b00
					(uint saveNumber,byte *param_2,undefined4 param_3,undefined4 param_4,undefined4 param_5,
					undefined4 param_6,uint param_7)
{
	FileStream *pFVar1;
	int iVar2;
	undefined4 unaff_EBX;
	undefined4 unaff_EBP;
	undefined4 unaff_ESI;
	uint uVar3;
	undefined4 unaff_EDI;
	undefined4 *puVar4;
	undefined4 uStack12972;
	undefined4 auStack12968 [5];
	uint auStack12948 [40];
	char acStack12788 [100];
	undefined4 uStack12688;
	undefined4 auStack12684 [3170];
	undefined4 uStack4;
	
	uStack4 = 0x417b0a;
	if (saveNumber < 6) {
		std::sprintf(acStack12788,"%s\\%i.sav","Saves",saveNumber);
		uVar3 = 0;
		if (param_2 == NULL) {
			lego::file::Path_MakeDataSubdir("Saves");
			pFVar1 = lego::file::File_Open(acStack12788,"wb");
			if (pFVar1 != NULL) {
				uStack12972 = 0;
				puVar4 = auStack12968;
				for (iVar2 = 0x2d; iVar2 != 0; iVar2 += -1) {
					*puVar4 = 0;
					puVar4 = puVar4 + 1;
				}
				uStack12688 = 0;
				auStack12968[1] = 7;
				puVar4 = auStack12684;
				for (iVar2 = 0xc63; iVar2 != 0; iVar2 += -1) {
					*puVar4 = 0;
					puVar4 = puVar4 + 1;
				}
				auStack12968[0] = 5;
				auStack12968[3] = 5;
				auStack12968[2] = 1;
				auStack12948[0] = 0;
				FUN_004170f0(DAT_00557ff8,FUN_00417170,auStack12948);
				FUN_00416da0();
				lego::file::File_Write((byte *)&uStack12972,0xb4,1,pFVar1);
				if (auStack12948[0] != 0) {
					do {
						lego::file::File_Write((byte *)&uStack12688,0x3190,1,pFVar1);
						uVar3 += 1;
					} while (uVar3 < auStack12948[0]);
				}
				lego::file::File_Close(pFVar1);
				return 1;
			}
		}
		else {
			uVar3 = 0;
			FUN_004170f0(DAT_00557ff8,FUN_00417170,&stack0xffffcd50);
			FUN_00416da0();
			if (uVar3 != *(uint *)(param_2 + 0x18)) {
				Save_SPrintfFileUnkWrite__00417b00
									(saveNumber,NULL,unaff_EDI,unaff_ESI,unaff_EBP,unaff_EBX,uVar3);
				return 1;
			}
			pFVar1 = lego::file::File_Open(acStack12788,"wb");
			if (pFVar1 != NULL) {
				lego::file::File_Write(param_2,0xb0,1,pFVar1);
				if (*(int *)(param_2 + 0x18) != 0) {
					lego::file::File_Write(*(byte **)(param_2 + 0x34),0x3190,*(int *)(param_2 + 0x18),pFVar1);
				}
				lego::file::File_Close(pFVar1);
				std::sprintf(acStack12788,"%s\\%i.osf","Saves",saveNumber);
				unk::Lego_Write_SORRFile__004596a0(acStack12788);
				return 1;
			}
		}
	}
	return 0;
}



void __cdecl FUN_00417d20(uint param_1)
{
	BOOL BVar1;
	undefined4 unaff_EBX;
	undefined4 unaff_ESI;
	Struct_b8__00558080 *pSVar2;
	undefined4 unaff_EDI;
	uint saveIndex;
	undefined4 unaff_retaddr;
	
	saveIndex = 0;
	pSVar2 = lego::globals::g_Struct_b8_TABLE__00558080;
	do {
		if ((lego::globals::g_CMDLINE_FLAGS & CMD_CLEANSAVES) == CMD_NONE) {
			BVar1 = lego::game::Game_UnkLoadSaveSlot__004179c0(saveIndex,(undefined4 *)pSVar2,0);
			if (BVar1 == 0) goto LAB_00417d53;
		}
		else {
			lego::save::Save_SPrintfFileUnkWrite__00417b00
								(saveIndex,0,unaff_EDI,unaff_ESI,unaff_EBX,unaff_retaddr,param_1);
LAB_00417d53:
			lego::game::Game_UnkLoadSaveSlot__004179c0(saveIndex,(undefined4 *)pSVar2,0);
		}
		pSVar2 = pSVar2 + 1;
		saveIndex += 1;
		if ((Struct_b8__00558080 *)((int)&lego::globals::g_Struct_b8_TABLE__00558080[5].field_0xb4 + 3U)
				< pSVar2) {
			return;
		}
	} while( true );
}



undefined * __cdecl FUN_00417d80(int saveIndex)
{
	if ((saveIndex < 6) && (-1 < saveIndex)) {
		return (undefined *)(lego::globals::g_Struct_b8_TABLE__00558080 + saveIndex);
	}
	return (undefined *)NULL;
}



undefined * __cdecl FUN_00417da0(void)
{
	undefined *puVar1;
	
	if (lego::globals::g_SaveNumber != -1) {
		puVar1 = FUN_00417d80(lego::globals::g_SaveNumber);
		return puVar1;
	}
	return NULL;
}



int __cdecl lego::save::Save_GetSaveNumber(void)
{
	return globals::g_SaveNumber;
}



void __cdecl lego::save::Save_SetSaveNumber(int saveIndex)
{
	globals::g_SaveNumber = saveIndex;
	return;
}



void __cdecl FUN_00417de0(uint param_1)
{
	undefined *puVar1;
	BOOL BVar2;
	uint *puVar3;
	
	puVar1 = FUN_00417da0();
	if (puVar1 != NULL) {
		BVar2 = lego::unk::Lego_GetIntNotM1__00558024();
		if (BVar2 == 0) {
			if (7 < param_1) {
				if (*(uint *)(puVar1 + 0x18) <= param_1 && param_1 != *(uint *)(puVar1 + 0x18)) {
					return;
				}
				*(uint *)(param_1 * 0x3190 + *(int *)(puVar1 + 0x34)) =
						 *(uint *)(param_1 * 0x3190 + *(int *)(puVar1 + 0x34)) | 1;
				return;
			}
		}
		else {
			if (7 < param_1) {
				return;
			}
		}
		puVar3 = (uint *)(*(int *)(puVar1 + 0x34) + param_1 * 0x3190);
		*puVar3 = *puVar3 | 1;
		puVar3 = (uint *)(param_1 * 0x3190 + *(int *)(puVar1 + 0x34));
		*puVar3 = *puVar3 | 2;
	}
	return;
}



void __cdecl FUN_00417e50(undefined4 *param_1)
{
	undefined *puVar1;
	int iVar2;
	undefined4 *puVar3;
	
	puVar1 = FUN_00417da0();
	if (puVar1 != NULL) {
		puVar3 = (undefined4 *)(puVar1 + 0x1c);
		for (iVar2 = 6; iVar2 != 0; iVar2 += -1) {
			*puVar3 = *param_1;
			param_1 = param_1 + 1;
			puVar3 = puVar3 + 1;
		}
	}
	return;
}



BOOL __cdecl FUN_00417e70(int param_1,undefined4 *param_2)
{
	undefined *puVar1;
	int iVar2;
	undefined4 *puVar3;
	
	puVar1 = FUN_00417da0();
	if ((puVar1 != NULL) && (param_1 < *(int *)(puVar1 + 0x18))) {
		puVar3 = (undefined4 *)(param_1 * 0x3190 + 4 + *(int *)(puVar1 + 0x34));
		for (iVar2 = 0xc63; iVar2 != 0; iVar2 += -1) {
			*puVar3 = *param_2;
			param_2 = param_2 + 1;
			puVar3 = puVar3 + 1;
		}
		return 1;
	}
	return 0;
}



int __cdecl FUN_00417ec0(int param_1)
{
	undefined *puVar1;
	
	puVar1 = FUN_00417da0();
	if ((puVar1 != NULL) && (param_1 < *(int *)(puVar1 + 0x18))) {
		return param_1 * 0x3190 + 4 + *(int *)(puVar1 + 0x34);
	}
	return 0;
}



void __cdecl FUN_00417ef0(undefined4 param_1,undefined4 param_2,undefined4 param_3,uint param_4)
{
	undefined *puVar1;
	undefined4 unaff_retaddr;
	
	puVar1 = FUN_00417da0();
	lego::save::Save_SPrintfFileUnkWrite__00417b00
						(lego::globals::g_SaveNumber,puVar1,unaff_retaddr,param_1,param_2,param_3,param_4);
	return;
}



undefined4 __cdecl FUN_00417f10(void)
{
	return DAT_00558500;
}



void __cdecl FUN_00417f20(undefined4 param_1)
{
	DAT_00558500 = param_1;
	return;
}



void __cdecl FUN_00417f30(undefined4 param_1,undefined4 param_2,undefined4 param_3,uint param_4)
{
	int saveNumber;
	undefined4 unaff_retaddr;
	undefined4 uVar1;
	
	uVar1 = 0;
	saveNumber = lego::save::Save_GetSaveNumber();
	lego::save::Save_SPrintfFileUnkWrite__00417b00
						(saveNumber,uVar1,unaff_retaddr,param_1,param_2,param_3,param_4);
	FUN_00417310(DAT_00557ff8,0,&LevelIdentifier_00557fe4,
							 *(undefined4 *)
								(*(int *)(*(int *)(*(int *)(*lego::globals::menu::g_MainMenuFull + 4) + 0x18) + 4) +
								0x10),1);
	return;
}



void __cdecl FUN_00417f70(undefined4 *param_1)
{
	undefined *puVar1;
	undefined4 *puVar2;
	void *pvVar3;
	int iVar4;
	uint uVar5;
	undefined4 *puVar6;
	
	puVar1 = FUN_00417da0();
	if (puVar1 != NULL) {
		puVar2 = (undefined4 *)FUN_00417da0();
		puVar6 = param_1;
		for (iVar4 = 0x2e; iVar4 != 0; iVar4 += -1) {
			*puVar6 = *puVar2;
			puVar2 = puVar2 + 1;
			puVar6 = puVar6 + 1;
		}
		pvVar3 = std::malloc(param_1[6] * 0x3190);
		param_1[0xd] = pvVar3;
		if (pvVar3 != NULL) {
			iVar4 = param_1[6];
			puVar1 = FUN_00417da0();
			puVar2 = *(undefined4 **)(puVar1 + 0x34);
			puVar6 = (undefined4 *)param_1[0xd];
			for (uVar5 = (uint)(iVar4 * 0x3190) >> 2; uVar5 != 0; uVar5 -= 1) {
				*puVar6 = *puVar2;
				puVar2 = puVar2 + 1;
				puVar6 = puVar6 + 1;
			}
			for (iVar4 = 0; iVar4 != 0; iVar4 += -1) {
				*(undefined *)puVar6 = *(undefined *)puVar2;
				puVar2 = (undefined4 *)((int)puVar2 + 1);
				puVar6 = (undefined4 *)((int)puVar6 + 1);
			}
		}
	}
	return;
}



void __cdecl FUN_00417ff0(undefined4 *param_1)
{
	undefined *puVar1;
	undefined4 *puVar2;
	int iVar3;
	undefined4 *puVar4;
	
	puVar1 = FUN_00417da0();
	if (puVar1 != NULL) {
		puVar1 = FUN_00417da0();
		if (*(int *)(puVar1 + 0x34) != 0) {
			puVar1 = FUN_00417da0();
			std::free(*(void **)(puVar1 + 0x34));
		}
		puVar2 = (undefined4 *)FUN_00417da0();
		puVar4 = param_1;
		for (iVar3 = 0x2e; iVar3 != 0; iVar3 += -1) {
			*puVar2 = *puVar4;
			puVar4 = puVar4 + 1;
			puVar2 = puVar2 + 1;
		}
		puVar1 = FUN_00417da0();
		*(undefined4 *)(puVar1 + 0x34) = param_1[0xd];
	}
	return;
}



void __cdecl FUN_00418040(undefined4 param_1)
{
	DAT_0055881c = param_1;
	return;
}



BOOL __cdecl FUN_00418050(void)
{
	undefined *puVar1;
	uint uVar2;
	uint uVar3;
	int iVar4;
	longlong lVar5;
	
	puVar1 = FUN_00417da0();
	if (puVar1 != NULL) {
		uVar2 = 0;
		uVar3 = 8;
		puVar1 = FUN_00417da0();
		if (8 < *(uint *)(puVar1 + 0x18)) {
			iVar4 = 0x18c80;
			do {
				puVar1 = FUN_00417da0();
				lVar5 = __ftol((float10)*(float *)(*(int *)(puVar1 + 0x34) + 0x2fb8 + iVar4));
				uVar2 += (int)lVar5;
				uVar3 += 1;
				iVar4 += 0x3190;
				puVar1 = FUN_00417da0();
			} while (uVar3 < *(uint *)(puVar1 + 0x18));
		}
		puVar1 = FUN_00417da0();
		if (99 < uVar2 / (*(int *)(puVar1 + 0x18) - 8U)) {
			return 1;
		}
	}
	return 0;
}



void __cdecl lego::main::Main_Font_SetDefault(undefined4 font)
{
	globals::g_DefaultFont = font;
	return;
}



void __cdecl FUN_004180d0(void)
{
	FLAGS_004dd650 = FLAGS_004dd650 & 0xfffffffe;
	return;
}



void __cdecl lego::main::Main_Load_HelpWindow(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	char cVar2;
	char *pcVar3;
	int iVar4;
	Rect2F local_50;
	char *local_40;
	char *local_3c;
	char *local_38;
	char *local_34;
	
	Main_Load_HelpWindowInfo_Levels(root,keyBasePath);
	pcVar3 = cfg::CFG_JoinPath(keyBasePath,"HelpWindow","BackGroundImage",0);
	pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
	if (pcVar3 != NULL) {
		util::stringSplit(pcVar3,&local_40,",");
		globals::g_HelpWindow_BackgroundImage_bitmap = image::Image_LoadBMP(local_40,0,0);
		if (globals::g_HelpWindow_BackgroundImage_bitmap != NULL) {
			image::Image_unkFogFromFloat__0047deb0
								(globals::g_HelpWindow_BackgroundImage_bitmap,0.0,0.0,0.0,0.0,0.0,0.0);
		}
		iVar4 = std::atoi(local_3c);
		globals::g_HelpWindow_BackgroundImage_x = (float)iVar4;
		iVar4 = std::atoi(local_38);
		globals::g_HelpWindow_BackgroundImage_y = (float)iVar4;
		std::free(pcVar3);
	}
	Main_Load_HelpWindow_Buttons(root,keyBasePath);
	pcVar3 = cfg::CFG_JoinPath(keyBasePath,"HelpWindow","TextWindowArea",0);
	pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
	if (pcVar3 != NULL) {
		util::stringSplit(pcVar3,&local_40,",");
		iVar4 = std::atoi(local_40);
		local_50.x = (float)iVar4;
		iVar4 = std::atoi(local_3c);
		local_50.y = (float)iVar4;
		iVar4 = std::atoi(local_38);
		local_50.width = (float)iVar4;
		iVar4 = std::atoi(local_34);
		local_50.height = (float)iVar4;
		globals::g_HelpWindow_TextWindowArea_unkDrawRegion =
				 unk::Lego_unkMakeDrawRegion__004853b0(globals::g_DefaultFont,&local_50,0x400);
		globals::g_HelpWindow_TextWindowArea_y2 = local_50.y + local_50.height;
		globals::g_HelpWindow_TextWindowArea_x = local_50.x;
		globals::g_HelpWindow_TextWindowArea_y = local_50.y;
		std::free(pcVar3);
	}
	pcVar3 = cfg::CFG_JoinPath(keyBasePath,"HelpWindow","CanBuildMessage",0);
	globals::g_HelpWindow_CanBuildMessage = cfg::CFG_CopyPropertyValue(root,pcVar3);
	if (globals::g_HelpWindow_CanBuildMessage != NULL) {
		cVar2 = *globals::g_HelpWindow_CanBuildMessage;
		pcVar3 = globals::g_HelpWindow_CanBuildMessage;
		while (cVar2 != '\0') {
			if (cVar2 == '_') {
				*pcVar3 = ' ';
			}
			pcVar1 = pcVar3 + 1;
			pcVar3 = pcVar3 + 1;
			cVar2 = *pcVar1;
		}
	}
	pcVar3 = cfg::CFG_JoinPath(keyBasePath,"HelpWindow","CanTransportMessage",0);
	globals::g_HelpWindow_CanTransportMessage = cfg::CFG_CopyPropertyValue(root,pcVar3);
	if (globals::g_HelpWindow_CanTransportMessage != NULL) {
		cVar2 = *globals::g_HelpWindow_CanTransportMessage;
		pcVar3 = globals::g_HelpWindow_CanTransportMessage;
		while (cVar2 != '\0') {
			if (cVar2 == '_') {
				*pcVar3 = ' ';
			}
			pcVar1 = pcVar3 + 1;
			pcVar3 = pcVar3 + 1;
			cVar2 = *pcVar1;
		}
	}
	pcVar3 = cfg::CFG_JoinPath(keyBasePath,"HelpWindow","CanBuildAndTransportMessage",0);
	globals::g_HelpWindow_CanBuildAndTransportMessage = cfg::CFG_CopyPropertyValue(root,pcVar3);
	if (globals::g_HelpWindow_CanBuildAndTransportMessage != NULL) {
		cVar2 = *globals::g_HelpWindow_CanBuildAndTransportMessage;
		pcVar3 = globals::g_HelpWindow_CanBuildAndTransportMessage;
		while (cVar2 != '\0') {
			if (cVar2 == '_') {
				*pcVar3 = ' ';
			}
			pcVar1 = pcVar3 + 1;
			pcVar3 = pcVar3 + 1;
			cVar2 = *pcVar1;
		}
	}
	FLAGS_004dd650 = FLAGS_004dd650 & 0xffffff00 | FLAGS_004dd650 & 0xff | 4 | 2;
	FUN_00419130(0,0);
	return;
}



void __cdecl lego::main::Main_Load_HelpWindowInfo_Levels(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	char cVar2;
	char *pcVar3;
	uint uVar4;
	uint uVar5;
	HelpWindowInfoLevels *pHVar6;
	char local_400 [1024];
	
	uVar4 = 0;
	if (globals::g_Game.VehicleTypes_COUNT != 0) {
		pHVar6 = globals::g_HelpWindowInfo_VehicleTypes_Levels_TABLE;
		do {
			uVar5 = 0;
			do {
				std::sprintf(local_400,"HelpWindow::HelpWindowInfo::%sL%i",
										 globals::g_Game.VehicleTypes_TABLE[uVar4],uVar5);
				pcVar3 = cfg::CFG_JoinPath(keyBasePath,local_400,0);
				pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
				pHVar6->levels[0] = pcVar3;
				if (pcVar3 != NULL) {
					cVar2 = *pcVar3;
					while (cVar2 != '\0') {
						if (cVar2 == '_') {
							*pcVar3 = ' ';
						}
						pcVar1 = pcVar3 + 1;
						pcVar3 = pcVar3 + 1;
						cVar2 = *pcVar1;
					}
				}
				uVar5 += 1;
				pHVar6 = (HelpWindowInfoLevels *)(pHVar6->levels + 1);
			} while (uVar5 < 0x10);
			uVar4 += 1;
		} while (uVar4 < globals::g_Game.VehicleTypes_COUNT);
	}
	uVar4 = 0;
	if (globals::g_Game.MiniFigureTypes_COUNT != 0) {
		pHVar6 = globals::g_HelpWindowInfo_MiniFigureTypes_Levels_TABLE;
		do {
			uVar5 = 0;
			do {
				std::sprintf(local_400,"HelpWindow::HelpWindowInfo::%sL%i",
										 globals::g_Game.MiniFigureTypes_TABLE[uVar4],uVar5);
				pcVar3 = cfg::CFG_JoinPath(keyBasePath,local_400,0);
				pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
				pHVar6->levels[0] = pcVar3;
				if (pcVar3 != NULL) {
					cVar2 = *pcVar3;
					while (cVar2 != '\0') {
						if (cVar2 == '_') {
							*pcVar3 = ' ';
						}
						pcVar1 = pcVar3 + 1;
						pcVar3 = pcVar3 + 1;
						cVar2 = *pcVar1;
					}
				}
				uVar5 += 1;
				pHVar6 = (HelpWindowInfoLevels *)(pHVar6->levels + 1);
			} while (uVar5 < 0x10);
			uVar4 += 1;
		} while (uVar4 < globals::g_Game.MiniFigureTypes_COUNT);
	}
	uVar4 = 0;
	if (globals::g_Game.BuildingTypes_COUNT != 0) {
		pHVar6 = globals::g_HelpWindowInfo_BuildingTypes_Levels_TABLE;
		do {
			uVar5 = 0;
			do {
				std::sprintf(local_400,"HelpWindow::HelpWindowInfo::%sL%i",
										 globals::g_Game.BuildingTypes_TABLE[uVar4],uVar5);
				pcVar3 = cfg::CFG_JoinPath(keyBasePath,local_400,0);
				pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
				pHVar6->levels[0] = pcVar3;
				if (pcVar3 != NULL) {
					cVar2 = *pcVar3;
					while (cVar2 != '\0') {
						if (cVar2 == '_') {
							*pcVar3 = ' ';
						}
						pcVar1 = pcVar3 + 1;
						pcVar3 = pcVar3 + 1;
						cVar2 = *pcVar1;
					}
				}
				uVar5 += 1;
				pHVar6 = (HelpWindowInfoLevels *)(pHVar6->levels + 1);
			} while (uVar5 < 0x10);
			uVar4 += 1;
		} while (uVar4 < globals::g_Game.BuildingTypes_COUNT);
	}
	return;
}



void __cdecl lego::main::Main_Load_HelpWindow_Buttons(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	int iVar2;
	char *local_40;
	char *local_3c;
	char *local_38;
	char *local_34;
	char *local_30;
	char *local_2c;
	char *local_28;
	
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"HelpWindow","ContinueButton",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		util::stringSplit(pcVar1,&local_40,",");
		iVar2 = std::atoi(local_40);
		globals::g_HelpWindow_ContinueButton_x = (float)iVar2 + globals::g_HelpWindow_BackgroundImage_x;
		iVar2 = std::atoi(local_3c);
		globals::g_HelpWindow_ContinueButton_y = (float)iVar2 + globals::g_HelpWindow_BackgroundImage_y;
		iVar2 = std::atoi(local_38);
		globals::g_HelpWindow_ContinueButton_width = (float)iVar2;
		iVar2 = std::atoi(local_34);
		globals::g_HelpWindow_ContinueButton_height = (float)iVar2;
		globals::g_HelpWindow_ContinueButton_bmp = image::Image_LoadBMP(local_30,0,0);
		globals::g_HelpWindow_ContinueButton_bmp_push = image::Image_LoadBMP(local_2c,0,0);
		globals::g_HelpWindow_ContinueButton_text = util::formatText(local_28);
		unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(8,globals::g_HelpWindow_ContinueButton_text);
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"HelpWindow","CancelFutureButton",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		util::stringSplit(pcVar1,&local_40,",");
		iVar2 = std::atoi(local_40);
		globals::g_HelpWindow_CancelFutureButton_x =
				 (float)iVar2 + globals::g_HelpWindow_BackgroundImage_x;
		iVar2 = std::atoi(local_3c);
		globals::g_HelpWindow_CancelFutureButton_y =
				 (float)iVar2 + globals::g_HelpWindow_BackgroundImage_y;
		iVar2 = std::atoi(local_38);
		globals::g_HelpWindow_CancelFutureButton_width = (float)iVar2;
		iVar2 = std::atoi(local_34);
		globals::g_HelpWindow_CancelFutureButton_height = (float)iVar2;
		globals::g_HelpWindow_CancelFutureButton_bmp = image::Image_LoadBMP(local_30,0,0);
		globals::g_HelpWindow_CancelFutureButton_bmp_push = image::Image_LoadBMP(local_2c,0,0);
		globals::g_HelpWindow_CancelFutureButton_text = util::formatText(local_28);
		unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(9,globals::g_HelpWindow_CancelFutureButton_text);
	}
	return;
}



void __cdecl lego::game::Game_SetPlaceFlagsState_004dd650(BOOL param_1)
{
	if ((FLAGS_004dd650 & 4) != 0) {
		if (param_1 != 0) {
			FLAGS_004dd650 = FLAGS_004dd650 & 0xffffff00 | FLAGS_004dd650 & 0xfe | 2;
			return;
		}
		FLAGS_004dd650 &= 0xfffffffc;
	}
	return;
}



void __cdecl FUN_00418760(ObjectType objType,int objIndex,int objLevel,BOOL showHelpWindow)
{
	uint uVar1;
	
	lego::main::Main_Init_MiscObjectDependencies();
	uVar1 = lego::game::Object_GetDependencyLevelFlag_100(objType,objIndex,objLevel);
	if (uVar1 == 0) {
		lego::game::Object_SetDependencyLevelFlag_100(objType,objIndex,objLevel);
		if (showHelpWindow == 0) {
			lego::globals::g_HelpWindow_ObjectType = objType;
			lego::globals::g_HelpWindow_ObjectIndex = objIndex;
			lego::globals::g_HelpWindow_ObjectLevel = objLevel;
			if (objType == OBJECT_VEHICLE) {
				lego::globals::g_HelpWindow_ObjectName =
						 lego::globals::g_HelpWindowInfo_VehicleTypes_Levels_TABLE[objIndex].levels[objLevel];
			}
			else {
				if (objType == OBJECT_MINIFIGURE) {
					lego::globals::g_HelpWindow_ObjectName =
							 lego::globals::g_HelpWindowInfo_MiniFigureTypes_Levels_TABLE[objIndex].levels
							 [objLevel];
				}
				else {
					if (objType == OBJECT_BUILDING) {
						lego::globals::g_HelpWindow_ObjectName =
								 lego::globals::g_HelpWindowInfo_BuildingTypes_Levels_TABLE[objIndex].levels
								 [objLevel];
					}
				}
			}
			FUN_00485c70(lego::globals::g_HelpWindow_TextWindowArea_unkDrawRegion);
			FLAGS_004dd650 |= 8;
			FUN_00418850(objType,objIndex,objLevel);
			FLAGS_004dd650 |= 1;
			FLOAT_004dd640 = 0.0;
			FLOAT_004dd644 = 0.0;
		}
	}
	return;
}



void __cdecl FUN_00418850(ObjectType objType,int objIndex,int objLevel)
{
	int iVar1;
	int iVar2;
	uint uVar3;
	int *piVar4;
	uint uVar5;
	int local_204 [32];
	int local_184 [32];
	int local_104 [64];
	uint local_4;
	
	uVar5 = 0;
	DAT_004dd63c = 0;
	FUN_0040af30(objType,objIndex,objLevel,(int)local_204);
	if (local_4 != 0) {
		piVar4 = local_184;
		do {
			uVar3 = FUN_0040b180(piVar4[-0x20],*piVar4,piVar4[0x20]);
			if (uVar3 != 0) {
				iVar1 = *piVar4;
				(&DAT_004dd4d4)[DAT_004dd63c] = piVar4[-0x20];
				iVar2 = piVar4[0x20];
				(&DAT_004dd54c)[DAT_004dd63c] = iVar1;
				(&DAT_004dd5c4)[DAT_004dd63c] = iVar2;
				DAT_004dd63c += 1;
			}
			uVar5 += 1;
			piVar4 = piVar4 + 1;
		} while (uVar5 < local_4);
	}
	return;
}



void __cdecl FUN_00418900(void)
{
	if (((FLAGS_004dd650 & 2) != 0) && ((FLAGS_004dd650 & 1) != 0)) {
		FUN_00425b60(0,0);
		lego::game::Game_SetMenuNextPosition(NULL);
		FLAGS_004dd650 &= 0xfffffffe;
	}
	return;
}



void __cdecl FUN_00418930(void)
{
	uint uVar1;
	ImageBMP *bitmap;
	char *pcVar2;
	int *piVar3;
	int iVar4;
	ObjectType *pOVar5;
	int iVar6;
	float10 fVar7;
	longlong lVar8;
	char *format;
	undefined8 uVar9;
	float local_14;
	float local_10;
	float local_c;
	Point2F local_8;
	
	uVar1 = FUN_00419120();
	if (uVar1 == 0) {
		FUN_00418900();
	}
	uVar1 = FUN_00419120();
	if (uVar1 == 0) {
		return;
	}
	if ((FLAGS_004dd650 & 2) == 0) {
		return;
	}
	if ((FLAGS_004dd650 & 1) == 0) {
		return;
	}
	uVar1 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
	if ((uVar1 & 0x800) != 0) {
		return;
	}
	FUN_00425b60(0,1);
	if ((lego::globals::g_HelpWindow_ObjectName == NULL) && (DAT_004dd63c == 0)) {
		FUN_00418900();
		return;
	}
	if (lego::globals::g_HelpWindow_BackgroundImage_bitmap != NULL) {
		lego::image::Image_Blt__0047df70
							(lego::globals::g_HelpWindow_BackgroundImage_bitmap,NULL,
							 &lego::globals::g_HelpWindow_BackgroundImage_x,NULL);
	}
	if ((FLAGS_004dd650 & 8) != 0) {
		if (lego::globals::g_HelpWindow_ObjectName != NULL) {
			lego::game::Game_DisplayInfoMessage
								(lego::globals::g_HelpWindow_TextWindowArea_unkDrawRegion,"%s");
		}
		FLAGS_004dd650 &= 0xfffffff7;
	}
	if (lego::globals::g_HelpWindow_ObjectName == NULL) {
		lVar8 = __ftol((float10)lego::globals::g_HelpWindow_TextWindowArea_y);
		local_14 = (float)lVar8;
	}
	else {
		FUN_00485650((int *)lego::globals::g_HelpWindow_TextWindowArea_unkDrawRegion,0,0.0,
								 (int *)&local_14);
	}
	if (DAT_004dd63c == 0) goto LAB_00418cb8;
	local_8.x = local_14;
	local_8.y = 0.0;
	iVar6 = 0;
	iVar4 = 0;
	local_c = (float)(ulonglong)(uint)local_14 - -10.0;
	local_10 = lego::globals::g_HelpWindow_TextWindowArea_x;
	if (DAT_004dd63c != 0) {
		piVar3 = &DAT_004dd4d4;
		uVar1 = DAT_004dd63c;
		do {
			if (*piVar3 == 1) {
				iVar4 += 1;
			}
			else {
				if (*piVar3 == 4) {
					iVar6 += 1;
				}
			}
			piVar3 = piVar3 + 1;
			uVar1 -= 1;
		} while (uVar1 != 0);
	}
	if (iVar4 == 0) {
		if (lego::globals::g_HelpWindow_CanBuildMessage != NULL) {
			uVar9 = CONCAT44(lego::globals::g_HelpWindow_CanBuildMessage,0x4a2d60);
			lVar8 = __ftol((float10)local_c);
			iVar4 = (int)lVar8;
			lVar8 = __ftol((float10)local_10);
			iVar6 = (int)lVar8;
			goto override_prt_418b00_2c9bc250;
		}
	}
	else {
		if (iVar6 == 0) {
			if (lego::globals::g_HelpWindow_CanTransportMessage != NULL) {
				uVar9 = CONCAT44(lego::globals::g_HelpWindow_CanTransportMessage,0x4a2d60);
				lVar8 = __ftol((float10)local_c);
				iVar4 = (int)lVar8;
				lVar8 = __ftol((float10)local_10);
				iVar6 = (int)lVar8;
override_prt_418b00_2c9bc250:
				FUN_0047a440(lego::globals::g_DefaultFont,iVar6,iVar4,(char *)uVar9,
										 (char *)((ulonglong)uVar9 >> 0x20));
			}
		}
		else {
			if (lego::globals::g_HelpWindow_CanBuildAndTransportMessage != NULL) {
				uVar9 = CONCAT44(lego::globals::g_HelpWindow_CanBuildAndTransportMessage,0x4a2d60);
				lVar8 = __ftol((float10)local_c);
				iVar4 = (int)lVar8;
				lVar8 = __ftol((float10)local_10);
				iVar6 = (int)lVar8;
				goto override_prt_418b00_2c9bc250;
			}
		}
	}
	iVar4 = lego::draw::Font_GetField_be4(lego::globals::g_DefaultFont);
	local_8.x = (float)(iVar4 + 10);
	local_8.y = 0.0;
	local_c = (float)(ulonglong)(uint)local_8.x + local_c;
	fVar7 = FUN_0048e540(SUB84((double)FLOAT_004dd640,0),
											 (uint)((ulonglong)(double)FLOAT_004dd640 >> 0x20));
	local_c = (float)((float10)local_c - ((float10)FLOAT_004dd640 - fVar7) * (float10)45.0);
	fVar7 = FUN_0048e540(SUB84((double)FLOAT_004dd640,0),
											 (uint)((ulonglong)(double)FLOAT_004dd640 >> 0x20));
	lVar8 = __ftol(fVar7);
	uVar1 = (uint)lVar8;
	if (uVar1 < DAT_004dd63c) {
		pOVar5 = &DAT_004dd4d4 + uVar1;
		do {
			local_10 = lego::globals::g_HelpWindow_TextWindowArea_x;
			bitmap = (ImageBMP *)FUN_0041cac0(*pOVar5,pOVar5[0x1e],1);
			if (bitmap != NULL) {
				if (lego::globals::g_HelpWindow_TextWindowArea_y2 <= (float)bitmap->height + local_c) {
					if (FLOAT_004dd644 == 0.0) {
						local_8.y = 0.0;
						local_8.x = (float)((DAT_004dd63c - uVar1) - 1);
						FLOAT_004dd644 = (float)(ulonglong)(uint)local_8.x;
					}
					if (FLOAT_004dd640 < FLOAT_004dd644) {
						local_8.x = 345.0;
						local_8.y = 350.0;
						lego::game::Game_SetMenuNextPosition(&local_8);
					}
					break;
				}
				lego::image::Image_Blt__0047df70(bitmap,NULL,&local_10,NULL);
			}
			local_10 = local_10 - -50.0;
			local_c = local_c - -10.0;
			pcVar2 = lego::game::Object_GetTheName(*pOVar5,pOVar5[0x1e]);
			format = "%s";
			lVar8 = __ftol((float10)local_c);
			iVar4 = (int)lVar8;
			lVar8 = __ftol((float10)local_10);
			FUN_0047a440(lego::globals::g_DefaultFont,(int)lVar8,iVar4,format,pcVar2);
			local_c = local_c - -35.0;
			uVar1 += 1;
			pOVar5 = pOVar5 + 1;
			if (DAT_004dd63c <= uVar1) {
				FUN_00419030();
				return;
			}
		} while( true );
	}
LAB_00418cb8:
	FUN_00419030();
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

BOOL __cdecl
FUN_00418cd0(uint param_1,uint param_2,int param_3,int param_4,int param_5,float param_6)
{
	float fVar1;
	float fVar2;
	float fVar3;
	BOOL BVar4;
	float *pfVar5;
	int iVar6;
	
	if (((FLAGS_004dd650 & 2) != 0) && ((FLAGS_004dd650 & 1) != 0)) {
		FLAGS_004dd650 &= 0xffffffcf;
		fVar1 = (float)(ulonglong)param_1;
		if ((345.0 <= fVar1) &&
			 ((((fVar2 = (float)(lego::globals::g_Game.NextButton)->width - -345.0,
					(ushort)((ushort)(fVar1 < fVar2) << 8 | (ushort)(fVar1 == fVar2) << 0xe) != 0 &&
					(fVar2 = (float)(ulonglong)param_2, 350.0 <= fVar2)) &&
				 (fVar3 = (float)(lego::globals::g_Game.NextButton)->height - -350.0,
				 (ushort)((ushort)(fVar2 < fVar3) << 8 | (ushort)(fVar2 == fVar3) << 0xe) != 0)) &&
				(FUN_0046ba30(0x21), param_5 != 0)))) {
			FUN_00418f60(3,5.0);
			FUN_00428730(0);
		}
		iVar6 = 0;
		pfVar5 = &lego::globals::g_HelpWindow_ContinueButton_x;
		do {
			if (((*pfVar5 <= fVar1) &&
					(fVar2 = *pfVar5 + pfVar5[2],
					(ushort)((ushort)(fVar1 < fVar2) << 8 | (ushort)(fVar1 == fVar2) << 0xe) != 0)) &&
				 ((fVar2 = (float)(ulonglong)param_2, pfVar5[1] <= fVar2 &&
					(fVar3 = pfVar5[1] + pfVar5[3],
					(ushort)((ushort)(fVar2 < fVar3) << 8 | (ushort)(fVar2 == fVar3) << 0xe) != 0)))) {
				FLAGS_004dd650 |= 0x10;
				_DAT_004dd648 = iVar6;
				BVar4 = FUN_00418ef0(iVar6,param_3,param_4);
				if ((BVar4 != 0) && (param_5 != 0)) {
					FUN_00418f60(iVar6,param_6);
					FUN_00428730(0);
				}
				if ((param_3 == 0) && (param_5 == 0)) {
					FUN_00418eb0(iVar6);
				}
				return 1;
			}
			pfVar5 = pfVar5 + 7;
			iVar6 += 1;
		} while (pfVar5 < &DAT_004dc93c);
		FUN_00418ef0(4,param_3,param_4);
	}
	return 0;
}



void __cdecl FUN_00418eb0(int param_1)
{
	if (true) {
		switch(param_1) {
		case 0:
			FUN_0046ba30(8);
			return;
		case 1:
			FUN_0046ba30(9);
		}
	}
	return;
}



BOOL __cdecl FUN_00418ef0(int param_1,int param_2,int param_3)
{
	int iVar1;
	
	iVar1 = DAT_004dd64c;
	if (param_2 == 0) {
		DAT_004dd64c = 4;
	}
	else {
		if (DAT_004dd64c == 4) {
			if (param_3 == 0) {
				DAT_004dd64c = param_1;
				FLAGS_004dd650 = FLAGS_004dd650 | 0x20;
				return (uint)(param_1 == 4);
			}
		}
		else {
			if (DAT_004dd64c == param_1) {
				FLAGS_004dd650 = FLAGS_004dd650 | 0x20;
				return (uint)(DAT_004dd64c == param_1);
			}
		}
	}
	return (uint)(iVar1 == param_1);
}



void __cdecl FUN_00418f60(undefined4 param_1,float param_2)
{
	switch(param_1) {
	case 0:
		FUN_00418900();
		return;
	case 1:
		FUN_00419130(1,0);
		FUN_00418900();
		return;
	case 2:
		if (((ushort)((ushort)(FLOAT_004dd640 < 0.0) << 8 | (ushort)(FLOAT_004dd640 == 0.0) << 0xe) == 0
				) && (FLOAT_004dd640 = FLOAT_004dd640 - param_2 * 0.2, FLOAT_004dd640 < 0.0)) {
			FLOAT_004dd640 = 0.0;
			return;
		}
		break;
	case 3:
		if ((FLOAT_004dd640 < FLOAT_004dd644) &&
			 (FLOAT_004dd640 = FLOAT_004dd640 - param_2 * -0.2, FLOAT_004dd644 <= FLOAT_004dd640)) {
			FLOAT_004dd640 = FLOAT_004dd644;
			lego::game::Game_SetMenuNextPosition(NULL);
		}
	}
	return;
}



void __cdecl FUN_00419030(void)
{
	ImageBMP *bitmap;
	float *pfVar1;
	int iVar2;
	float local_8;
	float local_4;
	
	iVar2 = 0;
	pfVar1 = &lego::globals::g_HelpWindow_ContinueButton_y;
	do {
		local_8 = pfVar1[-1];
		local_4 = *pfVar1;
		bitmap = (ImageBMP *)FUN_00419080(iVar2);
		if (bitmap != NULL) {
			lego::image::Image_Blt__0047df70(bitmap,NULL,&local_8,NULL);
		}
		pfVar1 = pfVar1 + 7;
		iVar2 += 1;
	} while (pfVar1 < &DAT_004dc940);
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

undefined4 __cdecl FUN_00419080(int param_1)
{
	if ((param_1 == 1) && (((byte)FLAGS_004dd650 & 4) == 0)) {
		return lego::globals::g_HelpWindow_CancelFutureButton_bmp_push;
	}
	if ((((byte)FLAGS_004dd650 & 0x10) != 0) && (_DAT_004dd648 == param_1)) {
		if (((byte)FLAGS_004dd650 & 0x20) != 0) {
			return (&lego::globals::g_HelpWindow_ContinueButton_bmp_push)[param_1 * 7];
		}
		return (&lego::globals::g_HelpWindow_ContinueButton_bmp)[param_1 * 7];
	}
	return 0;
}



BOOL __cdecl FUN_004190d0(void)
{
	uint uVar1;
	uint uVar2;
	int iVar3;
	uint uVar4;
	
	uVar1 = FUN_00419120();
	uVar2 = FLAGS_004dd650 & 1;
	uVar4 = FLAGS_004dd650 & 2;
	iVar3 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
	if ((((uVar1 != 0) && (uVar4 != 0)) && (uVar2 != 0)) && (iVar3 == 0)) {
		return 1;
	}
	return 0;
}



uint __cdecl FUN_00419120(void)
{
	return FLAGS_004dd650 & 0x40;
}



void __cdecl FUN_00419130(BOOL param_1,BOOL param_2)
{
	if (param_1 != 0) {
		param_2 = FLAGS_004dd650 & 0x40;
	}
	if (param_2 == 0) {
		FLAGS_004dd650 = FLAGS_004dd650 | 0x40;
		return;
	}
	FLAGS_004dd650 = FLAGS_004dd650 & 0xffffffbf;
	return;
}



void __cdecl lego::main::Main_Init_Info(ImageFont *font)
{
	globals::g_Infos_TABLE[0] = "Info_CrystalFound";
	globals::g_Infos_TABLE[1] = "Info_OreSeamFound";
	globals::g_Infos_TABLE[2] = "Info_RockMonster";
	globals::g_Infos_TABLE[3] = "Info_LavaRockMonster";
	globals::g_Infos_TABLE[4] = "Info_IceRockMonster";
	globals::g_Infos_TABLE[5] = "Info_UnderAttack";
	globals::g_Infos_TABLE[6] = "Info_Landslide";
	globals::g_Infos_TABLE[7] = "Info_CaveIn";
	globals::g_Infos_TABLE[8] = "Info_Constructed";
	globals::g_Infos_TABLE[9] = "Info_CavernLocated";
	globals::g_Infos_TABLE[10] = "Info_LegoManDeath";
	globals::g_Infos_TABLE[11] = "Info_VehicleDeath";
	globals::g_Infos_TABLE[12] = "Info_BuildingDeath";
	globals::g_Infos_TABLE[13] = "Info_DynamitePlaced";
	globals::g_Infos_TABLE[14] = "Info_NoPower";
	globals::g_Infos_TABLE[15] = "Info_PowerDrain";
	globals::g_Infos_TABLE[16] = "Info_AirDepleting";
	globals::g_Infos_TABLE[17] = "Info_AirLow";
	globals::g_Infos_TABLE[18] = "Info_AirOut";
	globals::g_Infos_TABLE[19] = "Info_AirRestored";
	globals::g_Infos_TABLE[20] = "Info_TrainDriver";
	globals::g_Infos_TABLE[21] = "Info_TrainDynamite";
	globals::g_Infos_TABLE[22] = "Info_TrainRepair";
	globals::g_Infos_TABLE[23] = "Info_TrainPilot";
	globals::g_Infos_TABLE[24] = "Info_TrainSailor";
	globals::g_Infos_TABLE[25] = "Info_TrainScanner";
	globals::g_Infos_TABLE[26] = "Info_OreCollected";
	globals::g_Infos_TABLE[27] = "Info_WallDug";
	globals::g_Infos_TABLE[28] = "Info_WallReinforced";
	globals::g_Infos_TABLE[29] = "Info_CrystalPower";
	globals::g_Infos_TABLE[30] = "Info_LavaErode";
	globals::g_Infos_TABLE[31] = "Info_SlugEmerge";
	globals::g_Infos_TABLE[32] = "Info_PathCompleted";
	globals::g_Infos_TABLE[33] = "Info_FoundMinifigure";
	globals::g_Infos_TABLE[34] = "Info_CanUpgradeMinifigure";
	globals::g_Infos_TABLE[35] = "Info_CanTrainMinifigure";
	globals::g_Infos_TABLE[36] = "Info_CrystalSeamFound";
	globals::g_Infos_TABLE[37] = "Info_GenericSeamFound";
	globals::g_Infos_TABLE[38] = "Info_GenericDeath";
	globals::g_Infos_TABLE[39] = "Info_GenericMonster";
	globals::g_Info_Font = font;
	FLAGS_004ddd48 = FLAGS_004ddd48 | 0x18;
	return;
}



BOOL __cdecl FUN_00419310(char *param_1,int *param_2)
{
	int iVar1;
	char **ppcVar2;
	int iVar3;
	
	iVar3 = 0;
	ppcVar2 = lego::globals::g_Infos_TABLE;
	do {
		iVar1 = std::_stricmp(*ppcVar2,param_1);
		if (iVar1 == 0) {
			*param_2 = iVar3;
			return 1;
		}
		ppcVar2 = ppcVar2 + 1;
		iVar3 += 1;
	} while (ppcVar2 < &DAT_004dd6f8);
	return 0;
}



undefined4 __cdecl FUN_00419350(int param_1)
{
	return *(undefined4 *)(&DAT_004dd6fc + param_1 * 0x14);
}



void __cdecl lego::main::Main_LoadMessageTabs_InfoOverFlow(char *filename)
{
	globals::g_MessageTabs_InfoOverFlow_bmp = image::Image_LoadBMP(filename,0,0);
	image::Image_SetFirstColorAsKey(globals::g_MessageTabs_InfoOverFlow_bmp);
	return;
}



void __cdecl FUN_00419380(BOOL param_1)
{
	if (param_1 != 0) {
		FLAGS_004ddd48 = FLAGS_004ddd48 | 0x10;
		return;
	}
	FLAGS_004ddd48 = FLAGS_004ddd48 & 0xffffffef;
	return;
}



void __cdecl FUN_004193a0(int param_1,int param_2)
{
	if (param_2 != 0) {
		*(uint *)(&DAT_004dd708 + param_1 * 0x14) = *(uint *)(&DAT_004dd708 + param_1 * 0x14) | 0x10000;
		return;
	}
	*(uint *)(&DAT_004dd708 + param_1 * 0x14) = *(uint *)(&DAT_004dd708 + param_1 * 0x14) & 0xfffeffff
	;
	return;
}



void __cdecl FUN_004193e0(int param_1,char *param_2)
{
	if (*(void **)(&DAT_004dd6f8 + param_1 * 0x14) != NULL) {
		std::free(*(void **)(&DAT_004dd6f8 + param_1 * 0x14));
	}
	FUN_00419460(param_2,(char **)(&DAT_004dd6f8 + param_1 * 0x14));
	return;
}



void __cdecl FUN_00419420(int param_1,int param_2)
{
	if (param_2 != 0) {
		*(uint *)(&DAT_004dd708 + param_1 * 0x14) = *(uint *)(&DAT_004dd708 + param_1 * 0x14) | 0x20000;
		return;
	}
	*(uint *)(&DAT_004dd708 + param_1 * 0x14) = *(uint *)(&DAT_004dd708 + param_1 * 0x14) & 0xfffdffff
	;
	return;
}



void __cdecl FUN_00419460(char *param_1,char **param_2)
{
	char *pcVar1;
	char cVar2;
	char *pcVar3;
	BOOL BVar4;
	uint uVar5;
	int iVar6;
	int iVar7;
	char *pcVar8;
	char *pcVar9;
	uint local_30;
	int local_2c;
	char acStack40 [8];
	char local_20 [32];
	
	pcVar9 = param_1;
	uVar5 = 0xffffffff;
	local_30 = 0;
	pcVar3 = param_1;
	do {
		if (uVar5 == 0) break;
		uVar5 -= 1;
		cVar2 = *pcVar3;
		pcVar3 = pcVar3 + 1;
	} while (cVar2 != '\0');
	pcVar3 = (char *)std::malloc(~uVar5 + 0xb);
	*param_2 = pcVar3;
	cVar2 = *pcVar9;
	while (cVar2 != '\0') {
		cVar2 = *pcVar9;
		if (cVar2 == '_') {
			*pcVar3 = ' ';
		}
		else {
			if (cVar2 == '$') {
				pcVar8 = pcVar9 + 1;
				iVar6 = 0;
				iVar7 = 0;
				cVar2 = pcVar9[1];
				pcVar9 = pcVar8;
				while (cVar2 != '$') {
					local_20[iVar6] = cVar2;
					pcVar1 = pcVar8 + 1;
					iVar6 += 1;
					pcVar8 = pcVar8 + 1;
					pcVar9 = pcVar9 + 1;
					cVar2 = *pcVar1;
				}
				local_20[iVar6] = '\0';
				iVar6 = FUN_0045ce90(local_20,(int *)&param_1);
				if (iVar6 == 0) {
					BVar4 = FUN_00419310(local_20,&local_2c);
					if (BVar4 != 0) {
						iVar7 = FUN_00419350(local_2c);
					}
				}
				else {
					iVar7 = FUN_0045ced0((int)param_1);
				}
				if (iVar7 != 0) {
					*pcVar3 = '%';
					pcVar3 = pcVar3 + 1;
					acStack40[local_30] = (char)iVar7;
					local_30 += 1;
					*pcVar3 = 'b';
				}
			}
			else {
				if ((cVar2 == '\\') && (pcVar9[1] == 'n')) {
					*pcVar3 = '\n';
					pcVar9 = pcVar9 + 1;
				}
				else {
					*pcVar3 = cVar2;
				}
			}
		}
		pcVar8 = pcVar9 + 1;
		pcVar3 = pcVar3 + 1;
		pcVar9 = pcVar9 + 1;
		cVar2 = *pcVar8;
	}
	*pcVar3 = '\0';
	pcVar3 = pcVar3 + 1;
	uVar5 = 0;
	*pcVar3 = (char)local_30;
	do {
		pcVar3 = pcVar3 + 1;
		if (uVar5 < local_30) {
			*pcVar3 = acStack40[uVar5];
		}
		else {
			*pcVar3 = '\0';
		}
		uVar5 += 1;
	} while (uVar5 < 5);
	return;
}



void __cdecl FUN_00419580(int param_1,int param_2)
{
	ImageBMP *image;
	
	image = lego::image::Image_LoadBMP((char *)param_2,0,0);
	*(ImageBMP **)(&DAT_004dd6fc + param_1 * 0x14) = image;
	lego::image::Image_SetFirstColorAsKey(image);
	return;
}



void __cdecl FUN_004195b0(int param_1,undefined4 param_2)
{
	*(undefined4 *)(&DAT_004dd700 + param_1 * 0x14) = param_2;
	return;
}



BOOL __cdecl FUN_004195d0(int param_1,undefined *param_2,undefined4 param_3)
{
	int iVar1;
	int iVar2;
	
	iVar2 = (&DAT_004dda18)[param_1 * 5];
	if (iVar2 == 0) {
		return 0;
	}
	do {
		iVar1 = (*(code *)param_2)(iVar2,param_3);
		if (iVar1 != 0) {
			return 1;
		}
		iVar2 = *(int *)(iVar2 + 0x10);
	} while (iVar2 != 0);
	return 0;
}



void __cdecl FUN_00419620(int param_1,int param_2)
{
	int iVar1;
	int iVar2;
	int iVar3;
	
	iVar1 = (&DAT_004dda18)[param_1 * 5];
	if (iVar1 == 0) {
		(&DAT_004dda18)[param_1 * 5] = param_2;
		*(undefined4 *)(param_2 + 0x10) = 0;
		(&DAT_004dda1c)[param_1 * 5] = (&DAT_004dda1c)[param_1 * 5] + 1;
		return;
	}
	iVar3 = 1;
	iVar2 = *(int *)(iVar1 + 0x10);
	while (iVar2 != 0) {
		iVar3 += 1;
		if (iVar3 == 9) {
			FUN_004196e0(param_1,0);
		}
		iVar1 = *(int *)(iVar1 + 0x10);
		iVar2 = *(int *)(iVar1 + 0x10);
	}
	*(int *)(iVar1 + 0x10) = param_2;
	*(undefined4 *)(param_2 + 0x10) = 0;
	(&DAT_004dda1c)[param_1 * 5] = (&DAT_004dda1c)[param_1 * 5] + 1;
	return;
}



int __cdecl FUN_004196b0(int param_1,int param_2)
{
	int iVar1;
	
	iVar1 = (&DAT_004dda18)[param_1 * 5];
	if ((param_2 < 0) || ((int)(&DAT_004dda1c)[param_1 * 5] <= param_2)) {
		iVar1 = 0;
	}
	else {
		if (0 < param_2) {
			do {
				iVar1 = *(int *)(iVar1 + 0x10);
				param_2 += -1;
			} while (param_2 != 0);
			return iVar1;
		}
	}
	return iVar1;
}



int __cdecl FUN_004196e0(int param_1,int param_2)
{
	int iVar1;
	int iVar2;
	
	iVar1 = FUN_004196b0(param_1,param_2);
	if (iVar1 == 0) {
		return 0;
	}
	iVar2 = FUN_004196b0(param_1,param_2 + -1);
	if (param_2 == 0) {
		(&DAT_004dda18)[param_1 * 5] = *(undefined4 *)(iVar1 + 0x10);
	}
	else {
		*(undefined4 *)(iVar2 + 0x10) = *(undefined4 *)(iVar1 + 0x10);
	}
	(&DAT_004dda1c)[param_1 * 5] = (&DAT_004dda1c)[param_1 * 5] + -1;
	return iVar1;
}



BOOL __cdecl FUN_00419740(int param_1,int *param_2)
{
	if (*(int *)(param_1 + 8) == *param_2) {
		return 1;
	}
	param_2[1] = param_2[1] + 1;
	return 0;
}



void __cdecl FUN_00419760(LiveObject *liveObj)
{
	int iVar1;
	uint uVar2;
	uint uVar3;
	int *piVar4;
	LiveObject *local_8;
	int local_4;
	
	local_8 = liveObj;
	uVar2 = 0;
	if (INT_004ddd38 != 0) {
		piVar4 = &DAT_004dda1c;
		do {
			local_4 = 0;
			iVar1 = FUN_004195d0(uVar2,FUN_00419740,&local_8);
			while (iVar1 != 0) {
				FUN_004196e0(uVar2,local_4);
				local_4 = 0;
				iVar1 = FUN_004195d0(uVar2,FUN_00419740,&local_8);
			}
			uVar3 = uVar2;
			if (*piVar4 == 0) {
				uVar3 = uVar2 - 1;
				piVar4 = piVar4 + -5;
				FUN_00419db0(uVar2);
			}
			uVar2 = uVar3 + 1;
			piVar4 = piVar4 + 5;
		} while (uVar2 < (uint)INT_004ddd38);
	}
	return;
}



BOOL __cdecl FUN_004197f0(int *param_1,int **param_2)
{
	if ((*param_1 == **param_2) && (param_1[1] == (*param_2)[1])) {
		return 1;
	}
	param_2[1] = (int *)((int)param_2[1] + 1);
	return 0;
}



void __cdecl FUN_00419820(undefined4 param_1)
{
	int iVar1;
	int *piVar2;
	uint uVar3;
	uint uVar4;
	int *piVar5;
	undefined4 local_8;
	int local_4;
	
	local_8 = param_1;
	uVar3 = 0;
	if (INT_004ddd38 != 0) {
		piVar2 = &DAT_004dda1c;
		piVar5 = &DAT_004dda20;
		do {
			uVar4 = uVar3;
			if ((*piVar5 == 6) || (*piVar5 == 7)) {
				local_4 = 0;
				iVar1 = FUN_004195d0(uVar3,FUN_004197f0,&local_8);
				while (iVar1 != 0) {
					FUN_004196e0(uVar3,local_4);
					local_4 = 0;
					iVar1 = FUN_004195d0(uVar3,FUN_004197f0,&local_8);
				}
				if (*piVar2 == 0) {
					uVar4 = uVar3 - 1;
					piVar5 = piVar5 + -5;
					piVar2 = piVar2 + -5;
					FUN_00419db0(uVar3);
				}
			}
			uVar3 = uVar4 + 1;
			piVar5 = piVar5 + 5;
			piVar2 = piVar2 + 5;
		} while (uVar3 < (uint)INT_004ddd38);
	}
	return;
}



BOOL __cdecl FUN_004198d0(int *param_1,int *param_2)
{
	int iVar1;
	int *piVar2;
	
	iVar1 = *param_2;
	if ((((iVar1 != 0) || (param_2[1] != 0)) && ((iVar1 == 0 || (param_1[2] != iVar1)))) &&
		 (((piVar2 = (int *)param_2[1], piVar2 == NULL || (*param_1 != *piVar2)) ||
			(param_1[1] != piVar2[1])))) {
		return 0;
	}
	return 1;
}



BOOL __cdecl FUN_00419920(int param_1,undefined4 param_2,undefined4 param_3)
{
	BOOL BVar1;
	uint uVar2;
	int *piVar3;
	undefined4 local_8;
	undefined4 local_4;
	
	if ((((param_1 != 10) && (param_1 != 0xc)) && (param_1 != 0xb)) && (param_1 != 0x26)) {
		local_4 = param_3;
		uVar2 = 0;
		local_8 = param_2;
		if (INT_004ddd38 != 0) {
			piVar3 = &DAT_004dda20;
			do {
				if (param_1 == *piVar3) {
					BVar1 = FUN_004195d0(uVar2,FUN_004198d0,&local_8);
					if (BVar1 != 0) {
						return 1;
					}
				}
				uVar2 += 1;
				piVar3 = piVar3 + 5;
			} while (uVar2 < (uint)INT_004ddd38);
			return 0;
		}
	}
	return 0;
}



undefined4 * __cdecl FUN_004199b0(undefined4 *param_1,undefined4 param_2,char *param_3)
{
	undefined4 *puVar1;
	
	puVar1 = (undefined4 *)std::malloc(0x14);
	if (puVar1 == NULL) {
		return NULL;
	}
	if (param_1 == NULL) {
		puVar1[1] = 0xffffffff;
		*puVar1 = 0xffffffff;
	}
	else {
		*puVar1 = *param_1;
		puVar1[1] = param_1[1];
	}
	puVar1[2] = param_2;
	if (param_3 != NULL) {
		FUN_00419460(param_3,(char **)(puVar1 + 3));
		return puVar1;
	}
	puVar1[3] = 0;
	return puVar1;
}



void __cdecl lego::unk::Lego_SetFlag4_004ddd48(BOOL state)
{
	if (state != 0) {
		FLAGS_004ddd48 = FLAGS_004ddd48 | 4;
		return;
	}
	FLAGS_004ddd48 = FLAGS_004ddd48 & 0xfffffffb;
	return;
}



uint __cdecl FUN_00419a30(int param_1)
{
	return (uint)(*(int *)(&DAT_004dd6f8 + param_1 * 0x14) != 0);
}



int __cdecl FUN_00419a50(int param_1)
{
	int iVar1;
	int *piVar2;
	
	iVar1 = 0;
	if (0 < INT_004ddd38) {
		piVar2 = &DAT_004dda20;
		do {
			if (*piVar2 == param_1) {
				return iVar1;
			}
			iVar1 += 1;
			piVar2 = piVar2 + 5;
		} while (iVar1 < INT_004ddd38);
	}
	return -1;
}



float10 __cdecl FUN_00419a80(void)
{
	int iVar1;
	int *piVar2;
	int iVar3;
	float10 fVar4;
	
	fVar4 = (float10)333.0;
	if (INT_004ddd38 != 0) {
		piVar2 = &DAT_004dda20;
		iVar3 = INT_004ddd38;
		do {
			iVar1 = *piVar2;
			piVar2 = piVar2 + 5;
			iVar3 += -1;
			fVar4 = fVar4 - (float10)*(int *)(*(int *)(&DAT_004dd6fc + iVar1 * 0x14) + 8);
		} while (iVar3 != 0);
	}
	return fVar4;
}



void __cdecl
lego::game::Info_FUN_00419ab0(InfoType infoType,char *param_2,LiveObject *param_3,Point2I *param_4)
{
	int iVar1;
	int iVar2;
	uint uVar3;
	BOOL BVar4;
	int iVar5;
	undefined4 *puVar6;
	ProgrammerMode PVar7;
	int iVar8;
	float10 fVar9;
	
	if (((byte)FLAGS_004ddd48 & 4) != 0) {
		uVar3 = nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
		if ((uVar3 & 0x100) == 0) {
			if (((((byte)FLAGS_004ddd48 & 8) != 0) &&
					((*(uint *)(&DAT_004dd708 + infoType * 0x14) & 0x20000) != 0)) &&
				 ((ushort)((ushort)((float)(&DAT_004dd704)[infoType * 5] < 0.0) << 8 |
									(ushort)((float)(&DAT_004dd704)[infoType * 5] == 0.0) << 0xe) != 0)) {
				(&DAT_004dd704)[infoType * 5] = 0x41c80000;
				if (((infoType == INFO_LEGOMANDEATH) || (infoType == INFO_VEHICLEDEATH)) ||
					 (infoType == INFO_BUILDINGDEATH)) {
					FLOAT_004dd7cc = 25.0;
					FLOAT_004dd7e0 = 25.0;
					FLOAT_004dd7f4 = 25.0;
					FLOAT_004dd9fc = 25.0;
				}
				lego::snd::Snd_FUN_004651b0(*(int *)(&DAT_004dd700 + infoType * 0x14),NULL);
			}
			BVar4 = FUN_00419920(infoType,param_3,param_4);
			if (BVar4 == 0) {
				uVar3 = FUN_00419a30(infoType);
				if (uVar3 != 0) {
					iVar8 = infoType * 0x14;
					iVar1 = *(int *)(&DAT_004dd6fc + iVar8);
					if (((((byte)FLAGS_004ddd48 & 8) != 0) &&
							((*(uint *)(&DAT_004dd708 + iVar8) & 0x20000) == 0)) &&
						 ((ushort)((ushort)((float)(&DAT_004dd704)[infoType * 5] < 0.0) << 8 |
											(ushort)((float)(&DAT_004dd704)[infoType * 5] == 0.0) << 0xe) != 0)) {
						(&DAT_004dd704)[infoType * 5] = 0x41c80000;
						if ((((infoType == INFO_LEGOMANDEATH) || (infoType == INFO_VEHICLEDEATH)) ||
								(infoType == INFO_BUILDINGDEATH)) || (infoType == INFO_GENERICDEATH)) {
							FLOAT_004dd7cc = 25.0;
							FLOAT_004dd7e0 = 25.0;
							FLOAT_004dd7f4 = 25.0;
							FLOAT_004dd9fc = 25.0;
						}
						lego::snd::Snd_FUN_004651b0(*(int *)(&DAT_004dd700 + iVar8),NULL);
					}
					if (INT_004ddd38 != 0x28) {
						iVar5 = FUN_00419a50(infoType);
						iVar2 = INT_004ddd38;
						if (iVar5 == -1) {
							iVar5 = INT_004ddd38 * 5;
							INT_004ddd38 = INT_004ddd38 + 1;
							(&DAT_004dda24)[iVar5] = -(float)*(int *)(iVar1 + 4);
							fVar9 = FUN_00419a80();
							(&DAT_004dda28)[iVar2 * 5] = (float)fVar9;
							iVar5 = iVar2;
						}
						(&DAT_004dda20)[iVar5 * 5] = infoType;
						puVar6 = FUN_004199b0((undefined4 *)param_4,param_3,param_2);
						FUN_00419620(iVar5,(int)puVar6);
						PVar7 = main::Config_GetProgrammerMode();
						if (((PVar7 < 5) && (((byte)FLAGS_004ddd48 & 0x10) != 0)) &&
							 ((*(uint *)(&DAT_004dd708 + iVar8) & 0x10000) != 0)) {
							fVar9 = Game_GetGameSpeed();
							if ((ushort)((ushort)(fVar9 < (float10)1.0) << 8 |
													(ushort)(fVar9 == (float10)1.0) << 0xe) == 0) {
								Game_SetGameSpeed(1.0);
							}
						}
					}
				}
			}
		}
	}
	return;
}



void __cdecl FUN_00419cd0(void)
{
	if ((INT_004ddd38 != 0) && (DAT_004dda1c != 0)) {
		if (((LiveObject *)DAT_004dda18[2] != NULL) ||
			 ((0 < (int)*DAT_004dda18 && (0 < (int)DAT_004dda18[1])))) {
			FUN_0042dd70((LiveObject *)DAT_004dda18[2],DAT_004dda18,0);
		}
	}
	return;
}



void __cdecl FUN_00419d10(uint param_1)
{
	undefined4 *puVar1;
	int iVar2;
	undefined4 *puVar3;
	undefined4 *puVar4;
	undefined4 local_14 [5];
	
	if (param_1 < (uint)INT_004ddd38) {
		if (param_1 != 0) {
			puVar3 = &DAT_004dda18 + param_1 * 5;
			puVar4 = local_14;
			for (iVar2 = 5; puVar1 = &DAT_004dda18 + param_1 * 5, iVar2 != 0; iVar2 += -1) {
				*puVar4 = *puVar3;
				puVar3 = puVar3 + 1;
				puVar4 = puVar4 + 1;
			}
			do {
				param_1 -= 1;
				puVar3 = puVar1 + -5;
				puVar4 = puVar1;
				for (iVar2 = 5; iVar2 != 0; iVar2 += -1) {
					*puVar4 = *puVar3;
					puVar3 = puVar3 + 1;
					puVar4 = puVar4 + 1;
				}
				puVar1 = puVar1 + -5;
			} while (param_1 != 0);
			puVar3 = local_14;
			puVar4 = &DAT_004dda18;
			for (iVar2 = 5; iVar2 != 0; iVar2 += -1) {
				*puVar4 = *puVar3;
				puVar3 = puVar3 + 1;
				puVar4 = puVar4 + 1;
			}
		}
		FLAGS_004ddd48 |= 3;
	}
	return;
}



void __cdecl FUN_00419d90(void)
{
	if (INT_004ddd38 != 0) {
		FUN_00419db0(0);
	}
	return;
}



void __cdecl FUN_00419db0(uint param_1)
{
	int iVar1;
	undefined4 *puVar2;
	uint uVar3;
	undefined4 *puVar4;
	undefined4 *puVar5;
	
	if (param_1 < (uint)INT_004ddd38) {
		iVar1 = FUN_004196e0(param_1,0);
		if ((iVar1 != 0) && (*(void **)(iVar1 + 0xc) != NULL)) {
			std::free(*(void **)(iVar1 + 0xc));
		}
		if ((&DAT_004dda1c)[param_1 * 5] == 0) {
			if (param_1 < (uint)INT_004ddd38) {
				puVar2 = &DAT_004dda18 + param_1 * 5;
				uVar3 = param_1;
				do {
					uVar3 += 1;
					puVar4 = puVar2 + 5;
					puVar5 = puVar2;
					for (iVar1 = 5; iVar1 != 0; iVar1 += -1) {
						*puVar5 = *puVar4;
						puVar4 = puVar4 + 1;
						puVar5 = puVar5 + 1;
					}
					puVar2 = puVar2 + 5;
				} while (uVar3 < (uint)INT_004ddd38);
			}
			INT_004ddd38 += -1;
		}
		if (param_1 == 0) {
			FLAGS_004ddd48 &= 0xfffffffe;
		}
	}
	return;
}



void __cdecl FUN_00419e40(void)
{
	if (INT_004ddd38 != 0) {
		do {
			FUN_00419db0(0);
		} while (INT_004ddd38 != 0);
	}
	return;
}



void __cdecl FUN_00419e60(float param_1)
{
	ImageBMP *bitmap;
	int iVar1;
	int iVar2;
	ImageFont *font;
	uint uVar3;
	float *pfVar4;
	longlong lVar5;
	char *format;
	float fVar6;
	float local_8;
	float local_4;
	
	local_4 = 333.0;
	uVar3 = 0;
	if (INT_004ddd38 == 0) {
		return;
	}
	pfVar4 = (float *)&DAT_004dda28;
	while( true ) {
		bitmap = *(ImageBMP **)(&DAT_004dd6fc + (int)pfVar4[-2] * 0x14);
		if ((ushort)((ushort)(local_4 < *pfVar4) << 8 | (ushort)(local_4 == *pfVar4) << 0xe) == 0) {
			*pfVar4 = *pfVar4 - param_1 * -8.0;
		}
		if (local_4 < *pfVar4) {
			*pfVar4 = local_4;
		}
		if (pfVar4[-1] < 0.0) {
			pfVar4[-1] = pfVar4[-1] - param_1 * -3.0;
		}
		if ((ushort)((ushort)(pfVar4[-1] < 0.0) << 8 | (ushort)(pfVar4[-1] == 0.0) << 0xe) == 0) {
			pfVar4[-1] = 0.0;
		}
		local_4 = *pfVar4;
		local_8 = pfVar4[-1];
		lego::image::Image_Blt__0047df70(bitmap,NULL,&local_8,NULL);
		if (local_4 < 0.0) break;
		fVar6 = pfVar4[-3];
		format = "%i";
		lVar5 = __ftol((float10)local_4);
		iVar1 = (int)lVar5 + 10;
		lVar5 = __ftol((float10)local_8);
		iVar2 = (int)lVar5 + 2;
		font = (ImageFont *)FUN_0041a220();
		FUN_0047a440(font,iVar2,iVar1,format,fVar6);
		uVar3 += 1;
		pfVar4 = pfVar4 + 5;
		local_4 = local_4 - (float)bitmap->height;
		if ((uint)INT_004ddd38 <= uVar3) {
			return;
		}
	}
	local_4 = 0.0;
	lego::image::Image_Blt__0047df70(lego::globals::g_MessageTabs_InfoOverFlow_bmp,NULL,&local_8,NULL)
	;
	return;
}



void __cdecl FUN_00419fb0(float param_1)
{
	char cVar1;
	uint uVar2;
	char *pcVar3;
	char *pcVar4;
	
	if (((FLAGS_004ddd48 & 1) == 0) || (INT_004ddd38 == 0)) {
		if (((byte)FLAGS_0050128c & 4) == 0) {
			FUN_0045adc0(7);
		}
	}
	else {
		if (((byte)FLAGS_0050128c & 2) == 0) {
			FUN_0045adc0(7);
		}
		if ((FLAGS_004ddd48 & 2) != 0) {
			FUN_0045a8e0((int *)DAT_005017d8);
			pcVar3 = *(char **)(DAT_004dda18 + 0xc);
			if (pcVar3 == NULL) {
				pcVar3 = *(char **)(&DAT_004dd6f8 + DAT_004dda20 * 0x14);
			}
			uVar2 = 0xffffffff;
			pcVar4 = pcVar3;
			do {
				if (uVar2 == 0) break;
				uVar2 -= 1;
				cVar1 = *pcVar4;
				pcVar4 = pcVar4 + 1;
			} while (cVar1 != '\0');
			uVar2 = ~uVar2;
			if (pcVar3[uVar2] == '\0') {
				FUN_0045a850(DAT_005017d8,pcVar3);
			}
			else {
				FUN_0045a850(DAT_005017d8,pcVar3,(uint)(byte)pcVar3[uVar2 + 1],(uint)(byte)pcVar3[uVar2 + 2]
										 ,(uint)(byte)pcVar3[uVar2 + 3],(uint)(byte)pcVar3[uVar2 + 4],
										 (uint)(byte)pcVar3[uVar2 + 5]);
			}
			FUN_0045a870((int **)DAT_005017d8,INT_004ddd44,param_1);
			FUN_0041a180();
			FLAGS_004ddd48 &= 0xfffffffd;
		}
	}
	FUN_0045a870((int **)DAT_005017d8,INT_004ddd44,param_1);
	return;
}



undefined4 __cdecl FUN_0041a0d0(int param_1,int param_2,int param_3)
{
	int iVar1;
	uint uVar2;
	float *pfVar3;
	longlong lVar4;
	
	uVar2 = 0;
	if (INT_004ddd38 == 0) {
		return 0;
	}
	pfVar3 = (float *)&DAT_004dda28;
	do {
		iVar1 = *(int *)(*(int *)(&DAT_004dd6fc + (int)pfVar3[-2] * 0x14) + 8);
		if ((-1 < param_1) &&
			 (param_1 <= *(int *)(*(int *)(&DAT_004dd6fc + (int)pfVar3[-2] * 0x14) + 4))) {
			lVar4 = __ftol((float10)*pfVar3);
			if (((int)lVar4 <= param_2) && (param_2 <= iVar1 + (int)lVar4)) {
				if (param_3 != 0) {
					if (((FLAGS_004ddd48 & 1) != 0) && (uVar2 == 0)) {
						FUN_0045adc0(7);
						FLAGS_004ddd48 = FLAGS_004ddd48 & 0xfffffffe;
						return 1;
					}
					FUN_00419d10(uVar2);
				}
				return 1;
			}
		}
		uVar2 += 1;
		pfVar3 = pfVar3 + 5;
		if ((uint)INT_004ddd38 <= uVar2) {
			return 0;
		}
	} while( true );
}



void __cdecl FUN_0041a180(void)
{
	int local_8;
	int local_4;
	
	FUN_0045a8f0(DAT_005017d8,&local_8,&local_4);
	local_8 -= local_4;
	if (local_8 < 0) {
		local_8 = 0;
	}
	FUN_00464190(0,local_8,0);
	FUN_0041a1c0();
	return;
}



void __cdecl FUN_0041a1c0(void)
{
	int local_8;
	int local_4;
	
	lego::draw::Draw_UnkFuncOfInterestTable__00464160(0,&local_8,&local_4);
	INT_004ddd44 = local_8 - local_4;
	return;
}



void __cdecl FUN_0041a1f0(float param_1)
{
	float *pfVar1;
	
	pfVar1 = (float *)&DAT_004dd704;
	do {
		if ((ushort)((ushort)(*pfVar1 < 0.0) << 8 | (ushort)(*pfVar1 == 0.0) << 0xe) == 0) {
			*pfVar1 = *pfVar1 - param_1;
		}
		pfVar1 = pfVar1 + 5;
	} while (pfVar1 < &DAT_004dda24);
	return;
}



undefined4 FUN_0041a220(void)
{
	return DAT_004ddd58;
}



void __cdecl lego::main::Main_InitInterfaceMenuItems(uint param_1,uint param_2,ImageFont *font)
{
	FUN_0046b9f0(4,1);
	FLOAT_004decd0 = (float)(ulonglong)param_1;
	globals::g_InterfaceMenuItemNames_TABLE[0] = "Interface_MenuItem_BackToDefault";
	FLOAT_004decd4 = (float)(ulonglong)param_2;
	DAT_004ddd58 = font;
	globals::g_InterfaceMenuItemNames_TABLE[1] = "Interface_MenuItem_TeleportMan";
	globals::g_InterfaceMenuItemNames_TABLE[2] = "Interface_MenuItem_BuildBuilding";
	globals::g_InterfaceMenuItemNames_TABLE[3] = "Interface_MenuItem_BuildSmallVehicle";
	globals::g_InterfaceMenuItemNames_TABLE[4] = "Interface_MenuItem_BuildLargeVehicle";
	globals::g_InterfaceMenuItemNames_TABLE[5] = "Interface_MenuItem_LayPath";
	globals::g_InterfaceMenuItemNames_TABLE[7] = "Interface_MenuItem_RepairLava";
	globals::g_InterfaceMenuItemNames_TABLE[8] = "Interface_MenuItem_GeologistTest";
	globals::g_InterfaceMenuItemNames_TABLE[9] = "Interface_MenuItem_ClearRubble";
	globals::g_InterfaceMenuItemNames_TABLE[10] = "Interface_MenuItem_Dam";
	globals::g_InterfaceMenuItemNames_TABLE[17] = "Interface_MenuItem_SelectMan";
	globals::g_InterfaceMenuItemNames_TABLE[32] = "Interface_MenuItem_DeleteMan";
	globals::g_InterfaceMenuItemNames_TABLE[41] = "Interface_MenuItem_DeleteVehicle";
	globals::g_InterfaceMenuItemNames_TABLE[40] = "Interface_MenuItem_DeleteBuilding";
	globals::g_InterfaceMenuItemNames_TABLE[43] = "Interface_MenuItem_Attack";
	globals::g_InterfaceMenuItemNames_TABLE[18] = "Interface_MenuItem_SelectVehicle";
	globals::g_InterfaceMenuItemNames_TABLE[22] = "Interface_MenuItem_UnLoadVehicle";
	globals::g_InterfaceMenuItemNames_TABLE[23] = "Interface_MenuItem_UnLoadMinifigure";
	globals::g_InterfaceMenuItemNames_TABLE[20] = "Interface_MenuItem_VehiclePickUp";
	globals::g_InterfaceMenuItemNames_TABLE[21] = "Interface_MenuItem_MinifigurePickUp";
	globals::g_InterfaceMenuItemNames_TABLE[25] = "Interface_MenuItem_GetOut";
	globals::g_InterfaceMenuItemNames_TABLE[24] = "Interface_MenuItem_GetIn";
	globals::g_InterfaceMenuItemNames_TABLE[26] = "Interface_MenuItem_GotoDock";
	globals::g_InterfaceMenuItemNames_TABLE[11] = "Interface_MenuItem_Dig";
	globals::g_InterfaceMenuItemNames_TABLE[12] = "Interface_MenuItem_Reinforce";
	globals::g_InterfaceMenuItemNames_TABLE[13] = "Interface_MenuItem_Dynamite";
	globals::g_InterfaceMenuItemNames_TABLE[64] = "Interface_MenuItem_UpgradeMan";
	globals::g_InterfaceMenuItemNames_TABLE[31] = "Interface_MenuItem_GoFeed";
	globals::g_InterfaceMenuItemNames_TABLE[45] = "Interface_MenuItem_GotoFirstPerson";
	globals::g_InterfaceMenuItemNames_TABLE[46] = "Interface_MenuItem_GotoSecondPerson";
	globals::g_InterfaceMenuItemNames_TABLE[57] = "Interface_MenuItem_TrainSkill";
	globals::g_InterfaceMenuItemNames_TABLE[34] = "Interface_MenuItem_PowerOn";
	globals::g_InterfaceMenuItemNames_TABLE[35] = "Interface_MenuItem_PowerOff";
	globals::g_InterfaceMenuItemNames_TABLE[65] = "Interface_MenuItem_UpgradeBuilding";
	globals::g_InterfaceMenuItemNames_TABLE[36] = "Interface_MenuItem_Repair";
	globals::g_InterfaceMenuItemNames_TABLE[19] = "Interface_MenuItem_SelectBuilding";
	globals::g_InterfaceMenuItemNames_TABLE[44] = "Interface_MenuItem_GotoTopView";
	globals::g_InterfaceMenuItemNames_TABLE[48] = "Interface_MenuItem_GetTool";
	globals::g_InterfaceMenuItemNames_TABLE[49] = "Interface_MenuItem_GetDrill";
	globals::g_InterfaceMenuItemNames_TABLE[50] = "Interface_MenuItem_GetSpade";
	globals::g_InterfaceMenuItemNames_TABLE[51] = "Interface_MenuItem_GetHammer";
	globals::g_InterfaceMenuItemNames_TABLE[52] = "Interface_MenuItem_GetSpanner";
	globals::g_InterfaceMenuItemNames_TABLE[58] = "Interface_MenuItem_TrainDriver";
	globals::g_InterfaceMenuItemNames_TABLE[59] = "Interface_MenuItem_TrainEngineer";
	globals::g_InterfaceMenuItemNames_TABLE[60] = "Interface_MenuItem_TrainGeologist";
	globals::g_InterfaceMenuItemNames_TABLE[61] = "Interface_MenuItem_TrainPilot";
	globals::g_InterfaceMenuItemNames_TABLE[62] = "Interface_MenuItem_TrainSailor";
	globals::g_InterfaceMenuItemNames_TABLE[63] = "Interface_MenuItem_TrainDynamite";
	globals::g_InterfaceMenuItemNames_TABLE[73] = "Interface_MenuItem_Build";
	globals::g_InterfaceMenuItemNames_TABLE[14] = "Interface_MenuItem_PlaceFence";
	globals::g_InterfaceMenuItemNames_TABLE[37] = "Interface_MenuItem_MakeTeleporterPrimary";
	globals::g_InterfaceMenuItemNames_TABLE[15] = "Interface_MenuItem_DeselectDig";
	globals::g_InterfaceMenuItemNames_TABLE[72] = "Interface_MenuItem_ClearSelection";
	globals::g_InterfaceMenuItemNames_TABLE[71] = "Interface_MenuItem_Encyclopedia";
	globals::g_InterfaceMenuItemNames_TABLE[38] = "Interface_MenuItem_EjectCrystal";
	globals::g_InterfaceMenuItemNames_TABLE[39] = "Interface_MenuItem_EjectOre";
	globals::g_InterfaceMenuItemNames_TABLE[47] = "Interface_MenuItem_TrackObject";
	globals::g_InterfaceMenuItemNames_TABLE[27] = "Interface_MenuItem_LegoManGoto";
	globals::g_InterfaceMenuItemNames_TABLE[30] = "Interface_MenuItem_LegoManDig";
	globals::g_InterfaceMenuItemNames_TABLE[28] = "Interface_MenuItem_VehicleGoto";
	globals::g_InterfaceMenuItemNames_TABLE[29] = "Interface_MenuItem_VehicleDig";
	globals::g_InterfaceMenuItemNames_TABLE[6] = "Interface_MenuItem_RemovePath";
	globals::g_InterfaceMenuItemNames_TABLE[66] = "Interface_MenuItem_UpgradeVehicle";
	globals::g_InterfaceMenuItemNames_TABLE[67] = "Interface_MenuItem_UpgradeEngine";
	globals::g_InterfaceMenuItemNames_TABLE[68] = "Interface_MenuItem_UpgardeDrill";
	globals::g_InterfaceMenuItemNames_TABLE[69] = "Interface_MenuItem_UpgardeScan";
	globals::g_InterfaceMenuItemNames_TABLE[70] = "Interface_MenuItem_UpgardeCarry";
	globals::g_InterfaceMenuItemNames_TABLE[42] = "Interface_MenuItem_DeleteElectricFence";
	globals::g_InterfaceMenuItemNames_TABLE[53] = "Interface_MenuItem_GetLaser";
	globals::g_InterfaceMenuItemNames_TABLE[54] = "Interface_MenuItem_GetPusherGun";
	globals::g_InterfaceMenuItemNames_TABLE[55] = "Interface_MenuItem_GetFreezerGun";
	globals::g_InterfaceMenuItemNames_TABLE[56] = "Interface_MenuItem_GetBirdScarer";
	globals::g_InterfaceMenuItemNames_TABLE[33] = "Interface_MenuItem_DropBirdScarer";
	globals::g_InterfaceMenuItemNames_TABLE[16] = "Interface_MenuItem_CancelConstruction";
	Main_InterfaceAddItems();
	FUN_0041e900(param_1,param_2,globals::g_RESOLUTION.width + 10,param_2,750.0);
	FUN_0041a8c0();
	return;
}



void __cdecl lego::main::Main_InterfaceAddItems(void)
{
	Main_InterfaceAddItem(0,4,1,2,3,4);
	Main_InterfaceAddItem(1,3,5,6,0xe);
	Main_InterfaceAddItem(2,1,7);
	Main_InterfaceAddItem(3,1,0xe);
	Main_InterfaceAddItem(4,1,0x10);
	Main_InterfaceAddItem(5,2,9,0xe);
	Main_InterfaceAddItem(7,4,0xb,0xc,0xd,0xf);
	Main_InterfaceAddItem(8,2,0x2b,0x2f);
	Main_InterfaceAddItem(10,7,0x16,0x14,0x42,0x19,0x2d,0x2e,0x29);
	Main_InterfaceAddItem(0xb,6,0x16,0x14,0x19,0x2d,0x2e,0x1a);
	Main_InterfaceAddItem(0xc,2,0x18,0x29);
	Main_InterfaceAddItem(9,10,0x1f,0x17,0x15,0x30,0x21,0x40,0x39,0x2d,0x2e,0x20);
	Main_InterfaceAddItem(0xd,4,0x24,0x22,0x41,0x28);
	Main_InterfaceAddItem(0xe,1,0x2a);
	Main_InterfaceAddItem(0xf,3,0x2c,0x2e,0x2d);
	Main_InterfaceAddItem(0x10,8,0x31,0x32,0x33,0x34,0x35,0x36,0x37,0x38);
	Main_InterfaceAddItem(0x11,6,0x3a,0x3b,0x3c,0x3d,0x3e,0x3f);
	Main_InterfaceAddItem(0x12,4,0x43,0x44,0x45,0x46);
	return;
}



void __cdecl lego::main::Main_InterfaceAddItem(int itemIndex,int numParams,...)
{
	int *piVar1;
	int *piVar2;
	uint uVar3;
	int iVar4;
	int *piVar5;
	int local_78 [30];
	
	globals::g_InterfaceMenuItemDefines_TABLE[itemIndex].numParams = numParams;
	piVar1 = (int *)std::malloc(numParams * 4);
	globals::g_InterfaceMenuItemDefines_TABLE[itemIndex].parameters = piVar1;
	piVar2 = (int *)&stack0x0000000c;
	if (numParams != 0) {
		piVar5 = local_78;
		do {
			iVar4 = *piVar2;
			piVar2 = piVar2 + 1;
			*piVar5 = iVar4;
			piVar5 = piVar5 + 1;
			numParams += -1;
		} while (numParams != 0);
	}
	piVar2 = local_78;
	for (uVar3 = globals::g_InterfaceMenuItemDefines_TABLE[itemIndex].numParams & 0x3fffffff;
			uVar3 != 0; uVar3 -= 1) {
		*piVar1 = *piVar2;
		piVar2 = piVar2 + 1;
		piVar1 = piVar1 + 1;
	}
	for (iVar4 = 0; iVar4 != 0; iVar4 += -1) {
		*(undefined *)piVar1 = *(undefined *)piVar2;
		piVar2 = (int *)((int)piVar2 + 1);
		piVar1 = (int *)((int)piVar1 + 1);
	}
	return;
}



void __cdecl lego::main::Main_CleanupUnkInteraces(void)
{
	InterfaceMenuItem *pIVar1;
	
	pIVar1 = globals::g_InterfaceMenuItemDefines_TABLE;
	do {
		if (pIVar1->parameters != NULL) {
			std::free(pIVar1->parameters);
		}
		pIVar1 = pIVar1 + 1;
	} while (pIVar1 < &Point2I_004decc4);
	std::free(globals::g_InterfaceBuildImages_Vehicles_normal_TABLE);
	std::free(globals::g_InterfaceBuildImages_Vehicles_pressed_TABLE);
	std::free(globals::g_InterfaceBuildImages_Vehicles_disabled_TABLE);
	std::free(globals::g_SubmenuIcons_VehicleTypes_TABLE);
	std::free(globals::g_InterfaceBuildKeys_Vehicles_TABLE);
	std::free(globals::g_SubmenuIcons_VehicleTypes2_TABLE);
	std::free(globals::g_InterfaceBuildImages_Buildings_normal_TABLE);
	std::free(globals::g_InterfaceBuildImages_Buildings_pressed_TABLE);
	std::free(globals::g_InterfaceBuildImages_Buildings_disabled_TABLE);
	std::free(globals::g_SubmenuIcons_BuildingTypes_TABLE);
	std::free(globals::g_InterfaceBuildKeys_Buildings_TABLE);
	std::free(globals::g_SubmenuIcons_BuildingTypes2_TABLE);
	return;
}



void __cdecl FUN_0041a850(void)
{
	int iVar1;
	uint uVar2;
	uint uVar3;
	uint *puVar4;
	undefined4 *puVar5;
	undefined4 *puVar6;
	
	FLAGS_004df1f8 = 0;
	puVar4 = UINT_ARRAY_004de9ac;
	for (iVar1 = 0x4a; iVar1 != 0; iVar1 += -1) {
		*puVar4 = 0;
		puVar4 = puVar4 + 1;
	}
	puVar4 = UINT_ARRAY_004de60c;
	for (iVar1 = 0x4a; uVar2 = lego::globals::g_Game.VehicleTypes_COUNT,
			puVar6 = (undefined4 *)lego::globals::g_SubmenuIcons_VehicleTypes_TABLE, iVar1 != 0;
			iVar1 += -1) {
		*puVar4 = 0;
		puVar4 = puVar4 + 1;
	}
	for (; uVar3 = lego::globals::g_Game.VehicleTypes_COUNT,
			puVar5 = (undefined4 *)lego::globals::g_SubmenuIcons_VehicleTypes2_TABLE, uVar2 != 0;
			uVar2 = uVar2 - 1) {
		*puVar6 = 0;
		puVar6 = puVar6 + 1;
	}
	for (; uVar2 = lego::globals::g_Game.BuildingTypes_COUNT,
			puVar6 = (undefined4 *)lego::globals::g_SubmenuIcons_BuildingTypes_TABLE, uVar3 != 0;
			uVar3 = uVar3 - 1) {
		*puVar5 = 0;
		puVar5 = puVar5 + 1;
	}
	for (; uVar3 = lego::globals::g_Game.BuildingTypes_COUNT,
			puVar5 = (undefined4 *)lego::globals::g_SubmenuIcons_BuildingTypes2_TABLE, uVar2 != 0;
			uVar2 = uVar2 - 1) {
		*puVar6 = 0;
		puVar6 = puVar6 + 1;
	}
	for (; uVar3 != 0; uVar3 = uVar3 - 1) {
		*puVar5 = 0;
		puVar5 = puVar5 + 1;
	}
	puVar6 = &DAT_004ded34;
	for (iVar1 = 300; iVar1 != 0; iVar1 += -1) {
		*puVar6 = 0;
		puVar6 = puVar6 + 1;
	}
	FUN_0041a8c0();
	return;
}



void __cdecl FUN_0041a8c0(void)
{
	INT_004deccc = 0;
	FLOAT_004decd0 = FLOAT_004dece8;
	FLAGS_004df1f8 = FLAGS_004df1f8 | 0x84;
	return;
}



undefined4 __cdecl FUN_0041a8f0(char *param_1,int *param_2)
{
	int iVar1;
	char **ppcVar2;
	int iVar3;
	
	iVar3 = 0;
	ppcVar2 = lego::globals::g_InterfaceMenuItemNames_TABLE;
	do {
		iVar1 = std::_stricmp(*ppcVar2,param_1);
		if (iVar1 == 0) {
			*param_2 = iVar3;
			return 1;
		}
		ppcVar2 = ppcVar2 + 1;
		iVar3 += 1;
	} while (ppcVar2 < &DAT_004ddff8);
	return 0;
}



void __cdecl lego::main::Main_InitSubmenuIconTables(void)
{
	uint uVar1;
	uint uVar2;
	undefined4 *puVar3;
	
	globals::g_SubmenuIcons_VehicleTypes_TABLE = std::malloc(globals::g_Game.VehicleTypes_COUNT * 4);
	puVar3 = (undefined4 *)globals::g_SubmenuIcons_VehicleTypes_TABLE;
	for (uVar1 = globals::g_Game.VehicleTypes_COUNT; uVar1 != 0; uVar1 -= 1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	globals::g_InterfaceBuildKeys_Vehicles_TABLE =
			 (byte *)std::malloc(globals::g_Game.VehicleTypes_COUNT);
	uVar1 = globals::g_Game.VehicleTypes_COUNT;
	puVar3 = (undefined4 *)globals::g_InterfaceBuildKeys_Vehicles_TABLE;
	for (uVar2 = globals::g_Game.VehicleTypes_COUNT >> 2; uVar2 != 0; uVar2 -= 1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	for (uVar1 &= 3; uVar1 != 0; uVar1 -= 1) {
		*(undefined *)puVar3 = 0;
		puVar3 = (undefined4 *)((int)puVar3 + 1);
	}
	globals::g_SubmenuIcons_VehicleTypes2_TABLE = std::malloc(globals::g_Game.VehicleTypes_COUNT * 4);
	puVar3 = (undefined4 *)globals::g_SubmenuIcons_VehicleTypes2_TABLE;
	for (uVar1 = globals::g_Game.VehicleTypes_COUNT; uVar1 != 0; uVar1 -= 1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	globals::g_SubmenuIcons_BuildingTypes_TABLE = std::malloc(globals::g_Game.BuildingTypes_COUNT * 4)
	;
	puVar3 = (undefined4 *)globals::g_SubmenuIcons_BuildingTypes_TABLE;
	for (uVar1 = globals::g_Game.BuildingTypes_COUNT; uVar1 != 0; uVar1 -= 1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	globals::g_InterfaceBuildKeys_Buildings_TABLE =
			 (byte *)std::malloc(globals::g_Game.BuildingTypes_COUNT);
	uVar1 = globals::g_Game.BuildingTypes_COUNT;
	puVar3 = (undefined4 *)globals::g_InterfaceBuildKeys_Buildings_TABLE;
	for (uVar2 = globals::g_Game.BuildingTypes_COUNT >> 2; uVar2 != 0; uVar2 -= 1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	for (uVar1 &= 3; uVar1 != 0; uVar1 -= 1) {
		*(undefined *)puVar3 = 0;
		puVar3 = (undefined4 *)((int)puVar3 + 1);
	}
	globals::g_SubmenuIcons_BuildingTypes2_TABLE =
			 std::malloc(globals::g_Game.BuildingTypes_COUNT * 4);
	puVar3 = (undefined4 *)globals::g_SubmenuIcons_BuildingTypes2_TABLE;
	for (uVar1 = globals::g_Game.BuildingTypes_COUNT; uVar1 != 0; uVar1 -= 1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	return;
}



void __cdecl lego::main::Main_LoadInterfaceBuildImages(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	ImageBMP *pIVar2;
	BOOL BVar3;
	uint uVar4;
	byte local_51;
	char *local_50;
	char *local_4c;
	char *local_48;
	char *local_44;
	
	globals::g_InterfaceBuildImages_Vehicles_normal_TABLE =
			 (ImageBMP **)std::malloc(globals::g_Game.VehicleTypes_COUNT * 4);
	globals::g_InterfaceBuildImages_Vehicles_pressed_TABLE =
			 (ImageBMP **)std::malloc(globals::g_Game.VehicleTypes_COUNT * 4);
	globals::g_InterfaceBuildImages_Vehicles_disabled_TABLE =
			 (ImageBMP **)std::malloc(globals::g_Game.VehicleTypes_COUNT * 4);
	uVar4 = 0;
	if (globals::g_Game.VehicleTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"InterfaceBuildImages",
																 globals::g_Game.VehicleTypes_TABLE[uVar4],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			if (pcVar1 == NULL) {
				globals::g_InterfaceBuildImages_Vehicles_normal_TABLE[uVar4] = NULL;
				globals::g_InterfaceBuildImages_Vehicles_pressed_TABLE[uVar4] = NULL;
				globals::g_InterfaceBuildImages_Vehicles_disabled_TABLE[uVar4] = NULL;
			}
			else {
				util::stringSplit(pcVar1,&local_50,":");
				pIVar2 = image::Image_LoadBMP(local_50,0,0);
				globals::g_InterfaceBuildImages_Vehicles_normal_TABLE[uVar4] = pIVar2;
				pIVar2 = image::Image_LoadBMP(local_4c,0,0);
				globals::g_InterfaceBuildImages_Vehicles_pressed_TABLE[uVar4] = pIVar2;
				pIVar2 = image::Image_LoadBMP(local_48,0,0);
				globals::g_InterfaceBuildImages_Vehicles_disabled_TABLE[uVar4] = pIVar2;
				BVar3 = input::Input_ParseKey(local_44,&local_51);
				if (BVar3 != 0) {
					globals::g_InterfaceBuildKeys_Vehicles_TABLE[uVar4] = local_51;
				}
			}
			uVar4 += 1;
		} while (uVar4 < globals::g_Game.VehicleTypes_COUNT);
	}
	globals::g_InterfaceBuildImages_Buildings_normal_TABLE =
			 (ImageBMP **)std::malloc(globals::g_Game.BuildingTypes_COUNT * 4);
	globals::g_InterfaceBuildImages_Buildings_pressed_TABLE =
			 (ImageBMP **)std::malloc(globals::g_Game.BuildingTypes_COUNT * 4);
	globals::g_InterfaceBuildImages_Buildings_disabled_TABLE =
			 (ImageBMP **)std::malloc(globals::g_Game.BuildingTypes_COUNT * 4);
	uVar4 = 0;
	if (globals::g_Game.BuildingTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"InterfaceBuildImages",
																 globals::g_Game.BuildingTypes_TABLE[uVar4],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			if (pcVar1 == NULL) {
				globals::g_InterfaceBuildImages_Buildings_normal_TABLE[uVar4] = NULL;
				globals::g_InterfaceBuildImages_Buildings_pressed_TABLE[uVar4] = NULL;
				globals::g_InterfaceBuildImages_Buildings_disabled_TABLE[uVar4] = NULL;
			}
			else {
				util::stringSplit(pcVar1,&local_50,":");
				pIVar2 = image::Image_LoadBMP(local_50,0,0);
				globals::g_InterfaceBuildImages_Buildings_normal_TABLE[uVar4] = pIVar2;
				pIVar2 = image::Image_LoadBMP(local_4c,0,0);
				globals::g_InterfaceBuildImages_Buildings_pressed_TABLE[uVar4] = pIVar2;
				pIVar2 = image::Image_LoadBMP(local_48,0,0);
				globals::g_InterfaceBuildImages_Buildings_disabled_TABLE[uVar4] = pIVar2;
				BVar3 = input::Input_ParseKey(local_44,&local_51);
				if (BVar3 != 0) {
					globals::g_InterfaceBuildKeys_Buildings_TABLE[uVar4] = local_51;
				}
			}
			uVar4 += 1;
		} while (uVar4 < globals::g_Game.BuildingTypes_COUNT);
	}
	return;
}



void __cdecl lego::main::Main_LoadInterfaceImages(CFGProperty *root,char *keyBasePath)
{
	char cVar1;
	char *pcVar2;
	CFGProperty *prop;
	int iVar3;
	ImageBMP *pIVar4;
	int iVar5;
	BOOL BVar6;
	uint uVar7;
	uint uVar8;
	uint uVar9;
	undefined4 *puVar10;
	char *pcVar11;
	undefined4 *puVar12;
	KeysByte local_47d;
	int local_47c;
	char *local_478;
	char *local_474;
	char *local_450;
	char *local_44c;
	char *local_448;
	char *local_444;
	char *local_440;
	char *local_43c;
	char *local_438;
	undefined4 local_400 [256];
	
	pcVar2 = cfg::CFG_JoinPath(keyBasePath,"InterfaceImages",0);
	prop = cfg::CFG_GetBlockFirstChild(root,pcVar2);
	do {
		if (prop == NULL) {
			Main_LoadInterfaceBuildImages(root,keyBasePath);
			Main_LoadInterfaceBackButton(root,keyBasePath);
			return;
		}
		iVar3 = FUN_0041a8f0(prop->key,&local_47c);
		if (iVar3 != 0) {
			uVar7 = 0xffffffff;
			uVar9 = 0;
			pcVar2 = prop->value;
			do {
				pcVar11 = pcVar2;
				if (uVar7 == 0) break;
				uVar7 -= 1;
				pcVar11 = pcVar2 + 1;
				cVar1 = *pcVar2;
				pcVar2 = pcVar11;
			} while (cVar1 != '\0');
			uVar7 = ~uVar7;
			puVar10 = (undefined4 *)(pcVar11 + -uVar7);
			puVar12 = local_400;
			for (uVar8 = uVar7 >> 2; uVar8 != 0; uVar8 -= 1) {
				*puVar12 = *puVar10;
				puVar10 = puVar10 + 1;
				puVar12 = puVar12 + 1;
			}
			for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
				*(undefined *)puVar12 = *(undefined *)puVar10;
				puVar10 = (undefined4 *)((int)puVar10 + 1);
				puVar12 = (undefined4 *)((int)puVar12 + 1);
			}
			iVar3 = util::stringSplit((char *)local_400,&local_450,":");
			if ((iVar3 == 7) && (uVar7 = util::parseBoolLiteral(local_438), uVar7 != 2)) {
				uVar9 = util::parseBoolLiteral(local_438);
				uVar9 = (uint)(uVar9 == 1);
			}
			*(uint *)(&DAT_004deadc + local_47c * 4) = uVar9;
			pIVar4 = image::Image_LoadBMP(local_450,0,0);
			*(ImageBMP **)(&DAT_004ddff8 + local_47c * 4) = pIVar4;
			pIVar4 = image::Image_LoadBMP(local_44c,0,0);
			*(ImageBMP **)(&DAT_004de120 + local_47c * 4) = pIVar4;
			pIVar4 = image::Image_LoadBMP(local_448,0,0);
			*(ImageBMP **)(&DAT_004de248 + local_47c * 4) = pIVar4;
			iVar5 = util::stringSplit(local_444,&local_478,"|");
			iVar3 = local_47c * 4;
			pcVar2 = std::_strdup(local_478);
			*(char **)(&DAT_004de370 + iVar3) = pcVar2;
			if (iVar5 == 2) {
				snd::Snd_GetSFX(local_474,(int *)(&DAT_004de498 + iVar3));
			}
			iVar5 = util::stringSplit(local_440,&local_478,"|");
			iVar3 = local_47c * 4;
			pcVar2 = std::_strdup(local_478);
			*(char **)(&DAT_004de74c + iVar3) = pcVar2;
			if (iVar5 == 2) {
				snd::Snd_GetSFX(local_474,(int *)(&DAT_004de874 + iVar3));
			}
			BVar6 = input::Input_ParseKey(local_43c,&local_47d);
			if (BVar6 != 0) {
				globals::g_InterfaceIcon_Keys_TABLE[local_47c] = local_47d;
			}
		}
		prop = cfg::CFG_NextFlatProperty(prop);
	} while( true );
}



void __cdecl lego::main::Main_LoadInterfaceSurroundImages(CFGProperty *root,char *keyBasePath)
{
	int value;
	char *pcVar1;
	int iVar2;
	ImageBMP *pIVar3;
	ImageBMP **ppIVar4;
	float *pfVar5;
	char local_64 [20];
	char *local_50;
	char *local_4c;
	char *local_48;
	char *local_44;
	char *local_40;
	char *local_3c;
	char *local_38;
	char *local_34;
	
	value = 0;
	ppIVar4 = (ImageBMP **)&DAT_004ddd5c;
	pfVar5 = (float *)&DAT_004ddd8c;
	do {
		value += 1;
		std::itoa(value,local_64,10);
		pcVar1 = cfg::CFG_JoinPath(keyBasePath,"InterfaceSurroundImages",local_64,0);
		pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
		if (pcVar1 == NULL) {
			*ppIVar4 = NULL;
		}
		else {
			util::stringSplit(pcVar1,&local_50,":");
			iVar2 = std::_stricmp(local_50,"NULL");
			if (iVar2 != 0) {
				pIVar3 = image::Image_LoadBMP(local_50,0,0);
				*ppIVar4 = pIVar3;
				if (pIVar3 != NULL) {
					image::Image_unkFogFromFloat__0047deb0(pIVar3,0.0,0.0,0.0,0.0,0.0,0.0);
				}
				iVar2 = std::atoi(local_4c);
				pfVar5[-1] = (float)iVar2;
				iVar2 = std::atoi(local_48);
				*pfVar5 = (float)iVar2;
				iVar2 = std::atoi(local_44);
				pfVar5[0x38] = (float)iVar2;
				iVar2 = std::atoi(local_40);
				pfVar5[0x39] = (float)iVar2;
			}
			iVar2 = std::_stricmp(local_3c,"NULL");
			if (iVar2 != 0) {
				pIVar3 = image::Image_LoadBMP(local_3c,0,0);
				ppIVar4[0x21] = pIVar3;
				if (pIVar3 != NULL) {
					image::Image_unkFogFromFloat__0047deb0(pIVar3,0.0,0.0,0.0,0.0,0.0,0.0);
				}
				iVar2 = std::atoi(local_38);
				pfVar5[0x20] = (float)iVar2;
				iVar2 = std::atoi(local_34);
				pfVar5[0x21] = (float)iVar2;
			}
		}
		pfVar5 = pfVar5 + 2;
		ppIVar4 = ppIVar4 + 1;
	} while (pfVar5 < &DAT_004ddde4);
	return;
}



void __cdecl lego::main::Main_LoadInterfaceBackButton(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	char *local_50;
	char *local_4c;
	char *local_48;
	char *local_44;
	char *local_40;
	
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"InterfaceBackButton",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		util::stringSplit(pcVar1,&local_50,":");
		globals::g_InterfaceBackButton_size.width = std::atoi(local_50);
		globals::g_InterfaceBackButton_size.height = std::atoi(local_4c);
		globals::g_InterfaceBackButton_bmp = image::Image_LoadBMP(local_48,0,0);
		globals::g_InterfaceBackButton_bmp_pressed = image::Image_LoadBMP(local_44,0,0);
		globals::g_InterfaceBackButton_text = util::formatText(local_40);
		unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(5,globals::g_InterfaceBackButton_text);
	}
	return;
}



void __cdecl lego::main::Main_LoadInterfaceDependencies_PlusMinus(char *plus,char *minus)
{
	globals::g_InterfaceDependencies_Plus_bmp = image::Image_LoadBMP(plus,0,0);
	if (globals::g_InterfaceDependencies_Plus_bmp != NULL) {
		image::Image_unkFogFromFloat__0047deb0
							(globals::g_InterfaceDependencies_Plus_bmp,0.0,0.0,0.0,0.0,0.0,0.0);
	}
	globals::g_InterfaceDependencies_Minus_bmp = image::Image_LoadBMP(minus,0,0);
	if (globals::g_InterfaceDependencies_Minus_bmp != NULL) {
		image::Image_unkFogFromFloat__0047deb0
							(globals::g_InterfaceDependencies_Minus_bmp,0.0,0.0,0.0,0.0,0.0,0.0);
	}
	return;
}



void __cdecl FUN_0041b200(int param_1,Point2I *position)
{
	FUN_00435950();
	FUN_0041b230(param_1,position);
	FUN_0041e980_internal(param_1,position);
	return;
}



void __cdecl FUN_0041b230(int param_1,Point2I *position)
{
	LevelSurfaceMap *pLVar1;
	uint uVar2;
	int iVar3;
	int iVar4;
	int iVar5;
	
	if ((((DAT_004decfc == 1) || (DAT_004decfc == 2)) || (DAT_004decfc == 7)) ||
		 (((DAT_004decfc == 5 || (DAT_004decfc == 3)) || (DAT_004decfc == 4)))) {
		iVar3 = Point2I_004decf4.x;
		iVar4 = Point2I_004decf4.y;
		pLVar1 = lego::game::GetSurfaceMap();
		uVar2 = FUN_0044f800(pLVar1,iVar3,iVar4);
		if (uVar2 == 0) {
			INT_004df1f0 = 0;
		}
		else {
			iVar3 = Point2I_004decf4.x;
			iVar4 = Point2I_004decf4.y;
			iVar5 = INT_004df1f0;
			pLVar1 = lego::game::GetSurfaceMap();
			FUN_0044f7a0(pLVar1,iVar3,iVar4,iVar5);
		}
	}
	if (((param_1 == 1) || (param_1 == 2)) ||
		 ((param_1 == 7 || (((param_1 == 5 || (param_1 == 3)) || (param_1 == 4)))))) {
		iVar5 = 4;
		iVar3 = position->y;
		iVar4 = position->x;
		pLVar1 = lego::game::GetSurfaceMap();
		uVar2 = FUN_0044f7a0(pLVar1,iVar4,iVar3,iVar5);
		if (uVar2 != 4) {
			INT_004df1f0 = uVar2;
		}
	}
	return;
}



int __cdecl FUN_0041b2f0(int param_1)
{
	ObjectStatsFlags2 OVar1;
	ObjectStatsFlags3 OVar2;
	uint uVar3;
	uint uVar4;
	
	if (param_1 == 0x13) {
		return lego::globals::g_Game.BuildingTypes_COUNT;
	}
	if (param_1 == 0x14) {
		uVar4 = 0;
		uVar3 = 0;
		if (lego::globals::g_Game.VehicleTypes_COUNT != 0) {
			do {
				OVar1 = lego::game::Object_GetStatsFlags2(OBJECT_VEHICLE,uVar3);
				if ((OVar1 & STATS2_USESMALLTELEPORTER) == STATS2_NONE) {
					OVar1 = lego::game::Object_GetStatsFlags2(OBJECT_VEHICLE,uVar3);
					if ((OVar1 & STATS2_USEWATERTELEPORTER) != STATS2_NONE) goto LAB_0041b335;
				}
				else {
LAB_0041b335:
					OVar2 = lego::game::Object_GetStatsFlags3(OBJECT_VEHICLE,uVar3);
					if ((OVar2 & STATS3_CLASSASLARGE) == STATS3_NONE) {
						uVar4 += 1;
					}
				}
				uVar3 += 1;
				if (lego::globals::g_Game.VehicleTypes_COUNT <= uVar3) {
					return uVar4;
				}
			} while( true );
		}
	}
	else {
		if (param_1 != 0x15) {
			return lego::globals::g_InterfaceMenuItemDefines_TABLE[param_1].numParams;
		}
		uVar4 = 0;
		uVar3 = 0;
		if (lego::globals::g_Game.VehicleTypes_COUNT != 0) {
			do {
				OVar1 = lego::game::Object_GetStatsFlags2(OBJECT_VEHICLE,uVar3);
				if ((OVar1 & STATS2_USEBIGTELEPORTER) == STATS2_NONE) {
					OVar2 = lego::game::Object_GetStatsFlags3(OBJECT_VEHICLE,uVar3);
					if ((OVar2 & STATS3_CLASSASLARGE) != STATS3_NONE) goto LAB_0041b385;
				}
				else {
LAB_0041b385:
					uVar4 += 1;
				}
				uVar3 += 1;
			} while (uVar3 < lego::globals::g_Game.VehicleTypes_COUNT);
		}
	}
	return uVar4;
}



undefined4 __cdecl FUN_0041b3a0(int param_1)
{
	if ((param_1 != 0) && (param_1 != 0xf)) {
		return 1;
	}
	return 0;
}



void __cdecl FUN_0041b3c0(void)
{
	int iVar1;
	int iVar2;
	uint uVar3;
	ImageBMP *pIVar4;
	uint uVar5;
	float local_8;
	float local_4;
	
	if ((FLAGS_004df1f8 & 4) == 0) {
		return;
	}
	iVar1 = FUN_0041b2f0(INT_004deccc);
	iVar2 = FUN_0041b3a0(INT_004deccc);
	if (iVar2 == 0) {
		if (*(ImageBMP **)(&DAT_004ddddc + iVar1 * 4) != NULL) {
			local_8 = *(float *)(&DAT_004dde04 + iVar1 * 8) + FLOAT_004decd0;
			local_4 = *(float *)(&DAT_004dde08 + iVar1 * 8) + FLOAT_004decd4;
			lego::image::Image_Blt__0047df70(*(ImageBMP **)(&DAT_004ddddc + iVar1 * 4),NULL,&local_8,NULL)
			;
		}
		goto LAB_0041b52f;
	}
	if ((ImageBMP *)(&DAT_004ddd58)[iVar1] != NULL) {
		local_8 = *(float *)(&DAT_004ddd80 + iVar1 * 8) + FLOAT_004decd0;
		local_4 = *(float *)(&DAT_004ddd84 + iVar1 * 8) + FLOAT_004decd4;
		lego::image::Image_Blt__0047df70((ImageBMP *)(&DAT_004ddd58)[iVar1],NULL,&local_8,NULL);
	}
	uVar5 = UINT_ARRAY_004de60c[0] & 4;
	uVar3 = FUN_0041c990(0);
	pIVar4 = lego::globals::g_InterfaceBackButton_bmp;
	if (uVar3 == 0) {
		if ((FLAGS_004df1f8 & 0x4000) == 0) {
			if (uVar5 != 0) goto LAB_0041b47e;
LAB_0041b48e:
			pIVar4 = NULL;
		}
		else {
			if (uVar5 != 0) {
LAB_0041b47e:
				if (DAT_004ded1c == 0) goto LAB_0041b48e;
			}
		}
	}
	else {
		pIVar4 = lego::globals::g_InterfaceBackButton_bmp_pressed;
		if ((uVar5 != 0) && (DAT_004ded1c != 0)) {
			pIVar4 = lego::globals::g_InterfaceBackButton_bmp;
		}
	}
	if (pIVar4 != NULL) {
		local_8 = (float)(&lego::globals::g_InterfaceBackButton_bmp)[iVar1 * 2] + FLOAT_004decd0;
		local_4 = (float)(&lego::globals::g_InterfaceBackButton_bmp_pressed)[iVar1 * 2] + FLOAT_004decd4
		;
		lego::image::Image_Blt__0047df70(pIVar4,NULL,&local_8,NULL);
	}
	FUN_0041c420(0,0,0,NULL);
	FUN_0041c920(0,0);
	FUN_0041c6e0(0);
LAB_0041b52f:
	local_8 = FLOAT_004decd0;
	local_4 = FLOAT_004decd4;
	FUN_0041b5b0(INT_004deccc,FUN_0041b730,&local_8);
	if ((FLAGS_004df1f8 & 0x1200) != 0) {
		FUN_0041cc60(&DAT_004ded0c);
	}
	if ((FLAGS_004df1f8 & 0x3000) != 0) {
		FUN_0041ebd0(DAT_004ded0c,DAT_004ded10);
		return;
	}
	FUN_0041ed90();
	return;
}



BOOL __cdecl FUN_0041b5b0(int menuIcon,undefined *callback,void *context)
{
	int iVar1;
	ObjectStatsFlags2 OVar2;
	ObjectStatsFlags3 OVar3;
	uint uVar4;
	
	uVar4 = 0;
	if (menuIcon == 0x13) {
		if (lego::globals::g_Game.BuildingTypes_COUNT != 0) {
			do {
				iVar1 = (*(code *)callback)(0x49,4,uVar4,context);
				if (iVar1 != 0) {
					return 1;
				}
				uVar4 += 1;
			} while (uVar4 < lego::globals::g_Game.BuildingTypes_COUNT);
			return 0;
		}
	}
	else {
		if (menuIcon == 0x14) {
			uVar4 = 0;
			if (lego::globals::g_Game.VehicleTypes_COUNT != 0) {
				while (((OVar2 = lego::game::Object_GetStatsFlags2(OBJECT_VEHICLE,uVar4),
								(OVar2 & STATS2_USESMALLTELEPORTER) == STATS2_NONE &&
								(OVar2 = lego::game::Object_GetStatsFlags2(OBJECT_VEHICLE,uVar4),
								(OVar2 & STATS2_USEWATERTELEPORTER) == STATS2_NONE)) ||
							 ((OVar3 = lego::game::Object_GetStatsFlags3(OBJECT_VEHICLE,uVar4),
								(OVar3 & STATS3_CLASSASLARGE) != STATS3_NONE ||
								(iVar1 = (*(code *)callback)(0x49,1,uVar4,context), iVar1 == 0))))) {
					uVar4 += 1;
					if (lego::globals::g_Game.VehicleTypes_COUNT <= uVar4) {
						return 0;
					}
				}
				return 1;
			}
		}
		else {
			if (menuIcon == 0x15) {
				uVar4 = 0;
				if (lego::globals::g_Game.VehicleTypes_COUNT != 0) {
					while (((OVar2 = lego::game::Object_GetStatsFlags2(OBJECT_VEHICLE,uVar4),
									(OVar2 & STATS2_USEBIGTELEPORTER) == STATS2_NONE &&
									(OVar3 = lego::game::Object_GetStatsFlags3(OBJECT_VEHICLE,uVar4),
									(OVar3 & STATS3_CLASSASLARGE) == STATS3_NONE)) ||
								 (iVar1 = (*(code *)callback)(0x49,1,uVar4,context), iVar1 == 0))) {
						uVar4 += 1;
						if (lego::globals::g_Game.VehicleTypes_COUNT <= uVar4) {
							return 0;
						}
					}
					return 1;
				}
			}
			else {
				if (lego::globals::g_InterfaceMenuItemDefines_TABLE[menuIcon].numParams != 0) {
					while( true ) {
						iVar1 = lego::globals::g_InterfaceMenuItemDefines_TABLE[menuIcon].parameters[uVar4];
						if ((iVar1 == 0x22) || (iVar1 == 0x23)) {
							iVar1 = FUN_0041b8f0(lego::globals::g_InterfaceMenuItemDefines_TABLE[menuIcon].
																	 parameters + uVar4);
						}
						iVar1 = (*(code *)callback)(iVar1,0,0,context);
						if (iVar1 != 0) break;
						uVar4 += 1;
						if (lego::globals::g_InterfaceMenuItemDefines_TABLE[menuIcon].numParams <= uVar4) {
							return 0;
						}
					}
					return 1;
				}
			}
		}
	}
	return 0;
}



undefined4 __cdecl FUN_0041b730(uint param_1,uint param_2,int param_3,float *param_4)
{
	uint uVar1;
	ImageBMP *bitmap;
	uint uVar2;
	
	uVar1 = param_1;
	if (param_1 == 0x49) {
		FUN_0041c730(param_2,param_3);
		bitmap = (ImageBMP *)FUN_0041ca20(param_2,param_3);
		if (param_2 == 1) {
			uVar2 = *(uint *)((int)lego::globals::g_SubmenuIcons_VehicleTypes2_TABLE + param_3 * 4) & 4;
		}
		else {
			uVar2 = param_2;
			if (param_2 == 4) {
				uVar2 = *(uint *)((int)lego::globals::g_SubmenuIcons_BuildingTypes2_TABLE + param_3 * 4) & 4
				;
			}
		}
		FUN_0041c950(param_2,param_3,0);
	}
	else {
		FUN_0041c6e0(param_1);
		bitmap = (ImageBMP *)FUN_0041c9e0(param_1);
		uVar2 = UINT_ARRAY_004de60c[param_1] & 4;
		FUN_0041c920(param_1,0);
	}
	FUN_0041c420(param_1,param_2,param_3,param_4);
	if (bitmap == NULL) {
		param_1 = 0x28;
	}
	else {
		param_1 = bitmap->height;
		if ((uVar2 == 0) || (DAT_004ded1c != 0)) {
			lego::image::Image_Blt__0047df70(bitmap,NULL,param_4,NULL);
		}
	}
	if (uVar1 == 1) {
		param_3 = 0;
		param_2 = 2;
	}
	else {
		if (uVar1 != 0x49) goto LAB_0041b82e;
	}
	FUN_0041eb60(param_2,param_3);
LAB_0041b82e:
	param_4[1] = (float)(ulonglong)param_1 + param_4[1];
	return 0;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_0041b860(float param_1)
{
	_DAT_004ded20 = _DAT_004ded20 - param_1;
	if (_DAT_004ded20 < 0.0) {
		DAT_004ded1c = (uint)(DAT_004ded1c == 0);
		_DAT_004ded20 = 15.0;
	}
	FUN_0041e9f0(param_1);
	if ((ushort)((ushort)(_DAT_004df1ec < 0.0) << 8 | (ushort)(_DAT_004df1ec == 0.0) << 0xe) == 0) {
		_DAT_004df1ec = _DAT_004df1ec - param_1;
		return;
	}
	FLAGS_004df1f8 = FLAGS_004df1f8 | 0x800;
	return;
}



undefined4 __cdecl lego::unk::Lego_GetDat_004ded1c(void)
{
	return DAT_004ded1c;
}



undefined4 __cdecl FUN_0041b8f0(undefined4 *param_1)
{
	LiveObject *pLVar1;
	
	pLVar1 = lego::game::Game_GetPrimarySelectedObject();
	if (((FLAGS_004df1f8 & 0x80) == 0) && ((FLAGS_004df1f8 & 0x100) != 0)) {
		return *param_1;
	}
	if ((pLVar1->flags3_3e8 & 0x80000000) != LIVEOBJ3_NONE) {
		*param_1 = 0x22;
		return 0x22;
	}
	*param_1 = 0x23;
	return 0x23;
}



void __cdecl FUN_0041b940(float param_1)
{
	int iVar1;
	
	iVar1 = DAT_004df1f4;
	if (DAT_004df1f4 != DAT_004df1fc) {
		FLOAT_004a3b58 = 25.0;
		DAT_004df1f4 = 0;
		DAT_004df1fc = iVar1;
		DAT_004df200 = 0;
		return;
	}
	FLOAT_004a3b58 = FLOAT_004a3b58 - param_1;
	if (((ushort)((ushort)(FLOAT_004a3b58 < 0.0) << 8 | (ushort)(FLOAT_004a3b58 == 0.0) << 0xe) != 0)
		 && (DAT_004df200 == 0)) {
		DAT_004df200 = lego::snd::Snd_FUN_004651b0(DAT_004df1f4,NULL);
	}
	DAT_004df1f4 = 0;
	return;
}



void __cdecl FUN_0041b9c0(undefined4 param_1)
{
	DAT_004df1f4 = param_1;
	return;
}



uint __cdecl
lego::game::GameUnk_DoSomethingWithRenameReplace
					(uint param_1,uint param_2,int param_3,int param_4,int param_5)
{
	float fVar1;
	char cVar2;
	int iVar3;
	char *pcVar4;
	LiveObject *pLVar5;
	uint uVar6;
	undefined4 *puVar7;
	BOOL BVar8;
	int iVar9;
	uint uVar10;
	uint uVar11;
	char *pcVar12;
	char **ppcVar13;
	ImageBMP *image;
	undefined4 *puVar14;
	char *pcVar15;
	undefined4 *puVar16;
	longlong lVar17;
	undefined4 uVar18;
	int local_a78;
	int local_a74;
	uint local_a70;
	ObjectType local_a6c;
	int local_a68;
	ObjectType local_a64;
	int local_a60;
	int local_a5c;
	int local_a58;
	uint local_a54;
	char *local_a50 [20];
	char local_a00 [512];
	undefined4 local_800;
	undefined4 local_600 [128];
	char local_400 [1024];
	
	pcVar12 = NULL;
	local_a70 = 0;
	local_a60 = 0;
	if (((FLAGS_004df1f8 & 4) == 0) || ((FLAGS_004df1f8 & 0x80) == 0)) {
		FLAGS_004df1f8 = FLAGS_004df1f8 & 0xffff89ff;
		return 0;
	}
	FLAGS_004df1f8 = FLAGS_004df1f8 & 0xffff89ff;
	iVar3 = FUN_0041edb0(param_1,param_2,DAT_004ded0c,DAT_004ded10,&local_a64,&local_a68,&local_a5c);
	if (iVar3 != 0) {
		FLAGS_004df1f8 |= 0x1000;
		if (((param_3 == 0) && (param_5 == 0)) && (local_a64 != 0x14)) {
			pcVar12 = globals::g_Game.UpgradeNames_TABLE[local_a5c];
			if (pcVar12 == NULL) {
				pcVar12 = Object_GetName(local_a64,local_a68);
				std::sprintf((char *)&local_800,"%s",pcVar12);
			}
			else {
				pcVar4 = Object_GetName(local_a64,local_a68);
				std::sprintf((char *)&local_800,"%s (%s)",pcVar4,pcVar12);
			}
			unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(4,(char *)&local_800);
			FUN_0046ba30(4);
			FUN_0046ba60(4);
			if ((globals::g_Game.flags2 & GAME2_DISABLETOOLTIPSOUND) == GAME2_NONE) {
				FUN_0041b9c0(globals::g_ObjTtSFX_TABLE[local_a64][local_a68]);
			}
		}
		FUN_0041c610(0,0,0,param_3,param_4);
		return 1;
	}
	iVar3 = FUN_0041c0f0(param_1,param_2,&local_a78,&local_a6c,&local_a74);
	if (iVar3 == 0) {
		iVar3 = FUN_0041b2f0(INT_004deccc);
		iVar9 = FUN_0041b3a0(INT_004deccc);
		if (iVar9 == 0) {
			image = *(ImageBMP **)(&DAT_004ddddc + iVar3 * 4);
			lVar17 = __ftol((float10)*(float *)(&DAT_004dde04 + iVar3 * 8) + (float10)FLOAT_004decd0);
			iVar9 = (int)lVar17;
			fVar1 = *(float *)(&DAT_004dde08 + iVar3 * 8);
		}
		else {
			image = (ImageBMP *)(&DAT_004ddd58)[iVar3];
			lVar17 = __ftol((float10)*(float *)(&DAT_004ddd80 + iVar3 * 8) + (float10)FLOAT_004decd0);
			iVar9 = (int)lVar17;
			fVar1 = *(float *)(&DAT_004ddd84 + iVar3 * 8);
		}
		lVar17 = __ftol((float10)fVar1 + (float10)FLOAT_004decd4);
		if (image == NULL) {
			return local_a70;
		}
		BVar8 = lego::image::Image_FUN_0047e260(image,param_1 - iVar9,param_2 - (int)lVar17);
		if (BVar8 == 0) {
			return local_a70;
		}
		if (local_a58 == 0) {
			return local_a70;
		}
		if (param_5 != 0) {
			FUN_00428730(1);
		}
		return 1;
	}
	if (local_a78 == 0) {
		FLAGS_004df1f8 |= 0x4000;
		FUN_0046ba30(5);
		goto LAB_0041bf5c;
	}
	if (local_a78 == 0x49) {
		FLAGS_004df1f8 =
				 FLAGS_004df1f8 & 0xffff0000 |
				 (uint)(ushort)(CONCAT11((char)((FLAGS_004df1f8 | 0x200) >> 8),(char)FLAGS_004df1f8) | 0x400
											 ) | 0x2000;
		pcVar12 = Object_GetName(local_a6c,local_a74);
		std::sprintf(local_a00,"%s",pcVar12);
		if ((globals::g_Game.flags2 & GAME2_DISABLETOOLTIPSOUND) == GAME2_NONE) {
			FUN_0041b9c0(globals::g_ObjTtSFX_TABLE[local_a6c][local_a74]);
			pcVar4 = local_a00;
		}
		else {
LAB_0041bec2:
			pcVar4 = local_a00;
		}
	}
	else {
		if ((local_a78 == 5) || (uVar6 = FLAGS_004df1f8 | 0x200, local_a78 == 0xe)) {
			uVar6 = FLAGS_004df1f8 | 0x2200;
		}
		FLAGS_004df1f8 = uVar6;
		BVar8 = FUN_0041c820(local_a78,0);
		if (BVar8 == 0) {
			pcVar4 = *(char **)(&DAT_004de370 + local_a78 * 4);
			if ((pcVar4 != NULL) &&
				 (pcVar12 = pcVar4, (globals::g_Game.flags2 & GAME2_DISABLETOOLTIPSOUND) == GAME2_NONE)) {
				uVar18 = *(undefined4 *)(&DAT_004de498 + local_a78 * 4);
LAB_0041bd3e:
				FUN_0041b9c0(uVar18);
				pcVar12 = pcVar4;
			}
		}
		else {
			if (*(int *)(&DAT_004de74c + local_a78 * 4) != 0) {
				pLVar5 = Game_GetPrimarySelectedObject();
				if (((((pLVar5 == NULL) || (local_a78 != 0x41)) ||
						 (uVar6 = Object_GetLevels(pLVar5->objType,pLVar5->objIndex),
						 uVar6 <= pLVar5->objLevel + 1)) ||
						((uVar6 = Level_GetOreCount(0), (uint)globals::g_Game.BuildingUpgradeCostOre <= uVar6 ||
						 (uVar6 = Level_GetOreCount(1), (uint)globals::g_Game.BuildingUpgradeCostStuds <= uVar6)
						 ))) || (globals::g_ToolTipIcon_Ore == NULL)) {
					pcVar12 = *(char **)(&DAT_004de74c + local_a78 * 4);
				}
				else {
					if (globals::g_Game.OreRequiredText != NULL) {
						std::sprintf(local_400,"%s",globals::g_Game.OreRequiredText);
						pcVar12 = local_400;
					}
					local_a60 = Level_GetOreCount(0);
					local_a60 = globals::g_Game.BuildingUpgradeCostOre - local_a60;
				}
				if ((globals::g_Game.flags2 & GAME2_DISABLETOOLTIPSOUND) == GAME2_NONE) {
					uVar18 = *(undefined4 *)(&DAT_004de874 + local_a78 * 4);
					pcVar4 = pcVar12;
					goto LAB_0041bd3e;
				}
			}
		}
		pcVar4 = NULL;
		if (((pcVar12 != NULL) && (pcVar4 = pcVar12, *(int *)(&DAT_004deadc + local_a78 * 4) != 0)) &&
			 ((uVar6 = Game_GetNumSelectedUnits(), uVar6 == 1 &&
				(((pLVar5 = Game_GetPrimarySelectedObject(), pLVar5 != NULL &&
					(pLVar5 = Game_GetPrimarySelectedObject(), pLVar5->customName != NULL)) &&
				 (pLVar5 = Game_GetPrimarySelectedObject(), *pLVar5->customName != '\0')))))) {
			uVar6 = 0xffffffff;
			pcVar4 = globals::g_Game.RenameReplace;
			do {
				pcVar15 = pcVar4;
				if (uVar6 == 0) break;
				uVar6 -= 1;
				pcVar15 = pcVar4 + 1;
				cVar2 = *pcVar4;
				pcVar4 = pcVar15;
			} while (cVar2 != '\0');
			uVar6 = ~uVar6;
			puVar14 = (undefined4 *)(pcVar15 + -uVar6);
			puVar16 = &local_800;
			for (uVar10 = uVar6 >> 2; uVar10 != 0; uVar10 -= 1) {
				*puVar16 = *puVar14;
				puVar14 = puVar14 + 1;
				puVar16 = puVar16 + 1;
			}
			for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
				*(undefined *)puVar16 = *(undefined *)puVar14;
				puVar14 = (undefined4 *)((int)puVar14 + 1);
				puVar16 = (undefined4 *)((int)puVar16 + 1);
			}
			uVar6 = 0xffffffff;
			do {
				pcVar4 = pcVar12;
				if (uVar6 == 0) break;
				uVar6 -= 1;
				pcVar4 = pcVar12 + 1;
				cVar2 = *pcVar12;
				pcVar12 = pcVar4;
			} while (cVar2 != '\0');
			uVar6 = ~uVar6;
			puVar14 = (undefined4 *)(pcVar4 + -uVar6);
			puVar16 = local_600;
			for (uVar10 = uVar6 >> 2; uVar10 != 0; uVar10 -= 1) {
				*puVar16 = *puVar14;
				puVar14 = puVar14 + 1;
				puVar16 = puVar16 + 1;
			}
			puVar7 = &local_800;
			for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
				*(undefined *)puVar16 = *(undefined *)puVar14;
				puVar14 = (undefined4 *)((int)puVar14 + 1);
				puVar16 = (undefined4 *)((int)puVar16 + 1);
			}
			while ((char)local_800 != '\0') {
				if (*(char *)puVar7 == ' ') {
					*(char *)puVar7 = '_';
				}
				pcVar12 = (char *)((int)puVar7 + 1);
				puVar7 = (undefined4 *)((int)puVar7 + 1);
				local_800._0_1_ = *pcVar12;
			}
			local_a54 = lego::util::stringSplit((char *)local_600,local_a50,(char *)&local_800);
			uVar6 = 0;
			local_a00[0] = '\0';
			if (local_a54 != 0) {
				local_a70 = local_a54 - 1;
				ppcVar13 = local_a50;
				do {
					uVar10 = 0xffffffff;
					pcVar12 = *ppcVar13;
					do {
						pcVar4 = pcVar12;
						if (uVar10 == 0) break;
						uVar10 -= 1;
						pcVar4 = pcVar12 + 1;
						cVar2 = *pcVar12;
						pcVar12 = pcVar4;
					} while (cVar2 != '\0');
					uVar10 = ~uVar10;
					iVar3 = -1;
					pcVar12 = local_a00;
					do {
						pcVar15 = pcVar12;
						if (iVar3 == 0) break;
						iVar3 += -1;
						pcVar15 = pcVar12 + 1;
						cVar2 = *pcVar12;
						pcVar12 = pcVar15;
					} while (cVar2 != '\0');
					puVar14 = (undefined4 *)(pcVar4 + -uVar10);
					puVar16 = (undefined4 *)(pcVar15 + -1);
					for (uVar11 = uVar10 >> 2; uVar11 != 0; uVar11 -= 1) {
						*puVar16 = *puVar14;
						puVar14 = puVar14 + 1;
						puVar16 = puVar16 + 1;
					}
					for (uVar10 &= 3; uVar10 != 0; uVar10 -= 1) {
						*(undefined *)puVar16 = *(undefined *)puVar14;
						puVar14 = (undefined4 *)((int)puVar14 + 1);
						puVar16 = (undefined4 *)((int)puVar16 + 1);
					}
					if (uVar6 < local_a70) {
						pLVar5 = Game_GetPrimarySelectedObject();
						uVar10 = 0xffffffff;
						pcVar12 = pLVar5->customName;
						do {
							pcVar4 = pcVar12;
							if (uVar10 == 0) break;
							uVar10 -= 1;
							pcVar4 = pcVar12 + 1;
							cVar2 = *pcVar12;
							pcVar12 = pcVar4;
						} while (cVar2 != '\0');
						uVar10 = ~uVar10;
						iVar3 = -1;
						pcVar12 = local_a00;
						do {
							pcVar15 = pcVar12;
							if (iVar3 == 0) break;
							iVar3 += -1;
							pcVar15 = pcVar12 + 1;
							cVar2 = *pcVar12;
							pcVar12 = pcVar15;
						} while (cVar2 != '\0');
						puVar14 = (undefined4 *)(pcVar4 + -uVar10);
						puVar16 = (undefined4 *)(pcVar15 + -1);
						for (uVar11 = uVar10 >> 2; uVar11 != 0; uVar11 -= 1) {
							*puVar16 = *puVar14;
							puVar14 = puVar14 + 1;
							puVar16 = puVar16 + 1;
						}
						for (uVar10 &= 3; uVar10 != 0; uVar10 -= 1) {
							*(undefined *)puVar16 = *(undefined *)puVar14;
							puVar14 = (undefined4 *)((int)puVar14 + 1);
							puVar16 = (undefined4 *)((int)puVar16 + 1);
						}
					}
					uVar6 += 1;
					ppcVar13 = ppcVar13 + 1;
				} while (uVar6 < local_a54);
			}
			goto LAB_0041bec2;
		}
	}
	if ((param_3 == 0) && (param_5 == 0)) {
		if (pcVar4 == NULL) {
			std::sprintf(local_a00,"Missing config for\n\'%s\'",
									 globals::g_InterfaceMenuItemNames_TABLE[local_a78]);
			unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(4,local_a00);
		}
		else {
			unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(4,pcVar4);
			for (iVar3 = local_a60; iVar3 != 0; iVar3 += -1) {
				FUN_0046b920(4,(int)globals::g_ToolTipIcon_Ore);
			}
		}
		FUN_0046ba30(4);
		FUN_0046ba60(4);
	}
	else {
		FUN_0041b9c0(0);
	}
LAB_0041bf5c:
	iVar3 = FUN_0041c610(local_a78,local_a6c,local_a74,param_3,param_4);
	if ((iVar3 != 0) && (param_5 != 0)) {
		if (local_a78 == 0x49) {
			if ((INT_004deccc == 0x14) || (INT_004deccc == 0x15)) {
				*(int *)((int)globals::g_SubmenuIcons_VehicleTypes_TABLE + local_a74 * 4) =
						 *(int *)((int)globals::g_SubmenuIcons_VehicleTypes_TABLE + local_a74 * 4) + 1;
			}
			else {
				if (INT_004deccc == 0x13) {
					*(int *)((int)globals::g_SubmenuIcons_BuildingTypes_TABLE + local_a74 * 4) =
							 *(int *)((int)globals::g_SubmenuIcons_BuildingTypes_TABLE + local_a74 * 4) + 1;
				}
			}
		}
		else {
			UINT_ARRAY_004de9ac[local_a78] = UINT_ARRAY_004de9ac[local_a78] + 1;
		}
		BVar8 = Game_DoAction__0041dbd0(local_a78);
		FUN_00428730((uint)(BVar8 == 0));
	}
	return 1;
}



undefined4 __cdecl
FUN_0041c0f0(uint param_1,uint param_2,undefined4 *param_3,undefined4 *param_4,undefined4 *param_5)
{
	float fVar1;
	float fVar2;
	int iVar3;
	int iVar4;
	BOOL BVar5;
	uint local_1c;
	uint local_18;
	float local_14;
	float local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	iVar3 = FUN_0041b2f0(INT_004deccc);
	iVar4 = FUN_0041b3a0(INT_004deccc);
	if (iVar4 != 0) {
		fVar1 = (float)(ulonglong)param_1;
		if (((((float)(&lego::globals::g_InterfaceBackButton_bmp)[iVar3 * 2] + FLOAT_004decd0 <= fVar1)
				 && (fVar2 = (float)(ulonglong)(uint)lego::globals::g_InterfaceBackButton_size.width +
										 (float)(&lego::globals::g_InterfaceBackButton_bmp)[iVar3 * 2] + FLOAT_004decd0,
						(ushort)((ushort)(fVar1 < fVar2) << 8 | (ushort)(fVar1 == fVar2) << 0xe) != 0)) &&
				(fVar1 = (float)(ulonglong)param_2,
				(float)(&lego::globals::g_InterfaceBackButton_bmp_pressed)[iVar3 * 2] + FLOAT_004decd4 <=
				fVar1)) &&
			 (fVar2 = (float)(ulonglong)(uint)lego::globals::g_InterfaceBackButton_size.height +
								(float)(&lego::globals::g_InterfaceBackButton_bmp_pressed)[iVar3 * 2] +
								FLOAT_004decd4,
			 (ushort)((ushort)(fVar1 < fVar2) << 8 | (ushort)(fVar1 == fVar2) << 0xe) != 0)) {
			*param_3 = 0;
			return 1;
		}
	}
	local_14 = FLOAT_004decd0;
	local_1c = param_1;
	local_18 = param_2;
	local_10 = FLOAT_004decd4;
	BVar5 = FUN_0041b5b0(INT_004deccc,&LAB_0041c240,&local_1c);
	if (BVar5 == 0) {
		return 0;
	}
	*param_3 = local_c;
	*param_4 = local_8;
	*param_5 = local_4;
	return 1;
}



void __cdecl lego::front::Front_DoF2InterfaceKeyAction(void)
{
	if (((((byte)FLAGS_004df1f8 & 4) != 0) && (((byte)FLAGS_004df1f8 & 0x80) != 0)) &&
		 (globals::g_KeyboardState_Current_TABLE[60] != 0)) {
		FUN_0041b5b0(INT_004deccc,Front_DoMenuIconKey_Action,NULL);
	}
	return;
}



undefined4 __cdecl
lego::front::Front_DoMenuIconKey_Action(uint menuIcon,ObjectType objType,int objIndex)
{
	uint uVar1;
	
	uVar1 = menuIcon;
	if (menuIcon == 0x49) {
		if (objType == OBJECT_VEHICLE) {
			menuIcon = (uint)globals::g_InterfaceBuildKeys_Vehicles_TABLE[objIndex];
		}
		else {
			if (objType == OBJECT_BUILDING) {
				menuIcon = (uint)globals::g_InterfaceBuildKeys_Buildings_TABLE[objIndex];
			}
		}
	}
	else {
		menuIcon = (uint)globals::g_InterfaceIcon_Keys_TABLE[menuIcon];
	}
	if ((globals::g_KeyboardState_Current_TABLE[menuIcon & 0xff] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[menuIcon & 0xff] !=
			globals::g_KeyboardState_Current_TABLE[menuIcon & 0xff])) {
		FUN_0041cbb0(uVar1,objType,objIndex);
		game::Game_DoAction__0041dbd0(uVar1);
	}
	return 0;
}



void __cdecl FUN_0041c420(int param_1,int param_2,int param_3,float *param_4)
{
	bool bVar1;
	bool bVar2;
	uint uVar3;
	int iVar4;
	float local_18;
	float fStack20;
	float local_10;
	float local_c;
	uint local_8;
	undefined4 uStack4;
	
	bVar2 = false;
	if (((FLAGS_004df1f8 & 0x20) != 0) && (uVar3 = lego::unk::Lego_GetFlag1__004b41bc(), uVar3 == 0))
	{
		bVar1 = false;
		if (DAT_004ded28 == 0x49) {
			if ((DAT_004ded2c == param_2) && (DAT_004ded30 == param_3)) {
				param_2 = FUN_0041ca20(param_2,param_3);
				bVar1 = true;
			}
		}
		else {
			if (param_1 == DAT_004ded28) {
				if (param_1 == 0) {
					bVar2 = true;
					bVar1 = true;
				}
				else {
					param_2 = FUN_0041c9e0(param_1);
					bVar1 = true;
				}
			}
		}
		if (bVar1) {
			if (bVar2) {
				iVar4 = FUN_0041b2f0(INT_004deccc);
				if ((FLAGS_004df1f8 & 0x80) == 0) {
					local_18 = (float)(&lego::globals::g_InterfaceBackButton_bmp)[iVar4 * 2] + FLOAT_004dece8;
				}
				else {
					local_18 = (float)(&lego::globals::g_InterfaceBackButton_bmp)[iVar4 * 2] + FLOAT_004decd0;
				}
				local_18 = local_18 -
									 (float)(ulonglong)(uint)lego::globals::g_InterfaceBackButton_size.width * -0.5;
				fStack20 = ((float)(&lego::globals::g_InterfaceBackButton_bmp_pressed)[iVar4 * 2] +
									 FLOAT_004decd4) -
									 (float)(ulonglong)(uint)lego::globals::g_InterfaceBackButton_size.height * -0.5;
			}
			else {
				if (param_2 == 0) {
					local_8 = 0x28;
				}
				else {
					local_8 = *(uint *)(param_2 + 8);
				}
				local_18 = *param_4;
				if ((FLAGS_004df1f8 & 0x80) == 0) {
					local_18 = FLOAT_004dece8;
				}
				uStack4 = 0;
				fStack20 = (float)(ulonglong)local_8 * 0.5 + param_4[1];
			}
			FUN_004017d0(DAT_004ded24,&local_10,&local_c);
			FUN_00401780(DAT_004ded24,0xc,local_10 + local_18,local_c + fStack20);
			FUN_00401800(DAT_004ded24,FLAGS_004df1f8 & 0x40);
			FLAGS_004df1f8 &= 0xffffffdf;
		}
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

undefined4 __cdecl FUN_0041c610(int param_1,int param_2,int param_3,int param_4,int param_5)
{
	int iVar1;
	
	iVar1 = DAT_004ded00;
	if (param_4 == 0) {
		DAT_004ded00 = 0x4a;
	}
	else {
		if ((FLAGS_004df1f8 & 0x1000) == 0) {
			if (DAT_004ded00 == 0x4a) {
				if (param_5 != 0) goto LAB_0041c6aa;
				DAT_004ded00 = param_1;
				_DAT_004ded04 = param_2;
				_DAT_004ded08 = param_3;
				if (param_1 == 0x49) {
					FUN_0041c950(param_2,param_3,1);
					goto LAB_0041c6aa;
				}
			}
			else {
				if (DAT_004ded00 != param_1) goto LAB_0041c6aa;
				if (param_1 == 0x49) {
					if ((_DAT_004ded04 == param_2) && (_DAT_004ded08 == param_3)) {
						FUN_0041c950(param_2,param_3,1);
					}
					goto LAB_0041c6aa;
				}
			}
			FUN_0041c920(param_1,1);
		}
	}
LAB_0041c6aa:
	if (iVar1 == param_1) {
		if (param_1 != 0x49) {
			return 1;
		}
		if ((_DAT_004ded04 == param_2) && (_DAT_004ded08 == param_3)) {
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_0041c6e0(uint menuIcon)
{
	BOOL BVar1;
	uint uVar2;
	
	uVar2 = UINT_ARRAY_004de60c[menuIcon];
	if (((uVar2 & 2) == 0) && (((byte)FLAGS_004df1f8 & 0x80) != 0)) {
		BVar1 = FUN_0041cf70(menuIcon);
		uVar2 = UINT_ARRAY_004de60c[menuIcon];
		if (BVar1 != 0) {
			UINT_ARRAY_004de60c[menuIcon] = uVar2 & 0xfffffffe;
			return;
		}
	}
	UINT_ARRAY_004de60c[menuIcon] = uVar2 | 1;
	return;
}



void __cdecl FUN_0041c730(int param_1,int param_2)
{
	uint *puVar1;
	BOOL BVar2;
	int iVar3;
	int iVar4;
	uint uVar5;
	void *pvVar6;
	
	if (param_1 == 1) {
		uVar5 = *(uint *)((int)lego::globals::g_SubmenuIcons_VehicleTypes2_TABLE + param_2 * 4);
		pvVar6 = lego::globals::g_SubmenuIcons_VehicleTypes2_TABLE;
		if (((uVar5 & 2) == 0) && (((byte)FLAGS_004df1f8 & 0x80) != 0)) {
			BVar2 = FUN_0041f030(OBJECT_VEHICLE,param_2);
			if ((BVar2 != 0) && (BVar2 = FUN_0040add0(OBJECT_VEHICLE,param_2,0), BVar2 != 0)) {
				iVar3 = lego::game::Object_GetCostCrystal(OBJECT_VEHICLE,param_2,0);
				iVar4 = lego::game::Level_GetCrystalCount(1);
				if (iVar3 <= iVar4) {
					puVar1 = (uint *)((int)lego::globals::g_SubmenuIcons_VehicleTypes2_TABLE + param_2 * 4);
					*puVar1 = *puVar1 & 0xfffffffe;
					return;
				}
			}
			puVar1 = (uint *)((int)lego::globals::g_SubmenuIcons_VehicleTypes2_TABLE + param_2 * 4);
			*puVar1 = *puVar1 | 1;
			return;
		}
	}
	else {
		if (param_1 != 4) {
			return;
		}
		uVar5 = *(uint *)((int)lego::globals::g_SubmenuIcons_BuildingTypes2_TABLE + param_2 * 4);
		pvVar6 = lego::globals::g_SubmenuIcons_BuildingTypes2_TABLE;
		if (((uVar5 & 2) == 0) && (((byte)FLAGS_004df1f8 & 0x80) != 0)) {
			BVar2 = FUN_0041f030(OBJECT_BUILDING,param_2);
			if ((BVar2 != 0) && (BVar2 = FUN_0040add0(OBJECT_BUILDING,param_2,0), BVar2 != 0)) {
				puVar1 = (uint *)((int)lego::globals::g_SubmenuIcons_BuildingTypes2_TABLE + param_2 * 4);
				*puVar1 = *puVar1 & 0xfffffffe;
				return;
			}
			puVar1 = (uint *)((int)lego::globals::g_SubmenuIcons_BuildingTypes2_TABLE + param_2 * 4);
			*puVar1 = *puVar1 | 1;
			return;
		}
	}
	*(uint *)((int)pvVar6 + param_2 * 4) = uVar5 | 1;
	return;
}



BOOL __cdecl FUN_0041c820(int param_1,BOOL param_2)
{
	uint uVar1;
	
	if (param_1 == 0x49) {
		return 0;
	}
	if ((lego::globals::g_Game.flags1 & GAME1_LASERTRACKER) != GAME1_NONE) {
		return 1;
	}
	if (param_2 != 0) {
		uVar1 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
		if ((uVar1 & 1) != 0) {
			return ~UINT_ARRAY_004de60c[param_1] >> 2 & 1;
		}
	}
	return UINT_ARRAY_004de60c[param_1] & 1;
}



uint __cdecl FUN_0041c880(int param_1,int param_2,int param_3)
{
	uint uVar1;
	
	if ((lego::globals::g_Game.flags1 & GAME1_LASERTRACKER) != GAME1_NONE) {
		return 1;
	}
	if (param_3 != 0) {
		uVar1 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
		if ((uVar1 & 1) != 0) {
			if (param_1 == 1) {
				return ~*(uint *)((int)lego::globals::g_SubmenuIcons_VehicleTypes2_TABLE + param_2 * 4) >> 2
							 & 1;
			}
			if (param_1 == 4) {
				return ~*(uint *)((int)lego::globals::g_SubmenuIcons_BuildingTypes2_TABLE + param_2 * 4) >>
							 2 & 1;
			}
		}
	}
	if (param_1 == 1) {
		return *(uint *)((int)lego::globals::g_SubmenuIcons_VehicleTypes2_TABLE + param_2 * 4) & 1;
	}
	if (param_1 == 4) {
		return *(uint *)((int)lego::globals::g_SubmenuIcons_BuildingTypes2_TABLE + param_2 * 4) & 1;
	}
	return 0;
}



void __cdecl FUN_0041c920(int param_1,int param_2)
{
	if (param_2 != 0) {
		UINT_ARRAY_004de60c[param_1] = UINT_ARRAY_004de60c[param_1] | 8;
		return;
	}
	UINT_ARRAY_004de60c[param_1] = UINT_ARRAY_004de60c[param_1] & 0xfffffff7;
	return;
}



void __cdecl FUN_0041c950(int param_1,int param_2,int param_3)
{
	uint uVar1;
	void *pvVar2;
	
	pvVar2 = lego::globals::g_SubmenuIcons_VehicleTypes2_TABLE;
	if ((param_1 == 1) || (pvVar2 = lego::globals::g_SubmenuIcons_BuildingTypes2_TABLE, param_1 == 4))
	{
		uVar1 = *(uint *)((int)pvVar2 + param_2 * 4);
		if (param_3 != 0) {
			*(uint *)((int)pvVar2 + param_2 * 4) = uVar1 | 8;
			return;
		}
		*(uint *)((int)pvVar2 + param_2 * 4) = uVar1 & 0xfffffff7;
	}
	return;
}



uint __cdecl FUN_0041c990(int param_1)
{
	return UINT_ARRAY_004de60c[param_1] & 8;
}



uint __cdecl FUN_0041c9a0(int param_1,int param_2)
{
	if (param_1 == 1) {
		return *(uint *)((int)lego::globals::g_SubmenuIcons_VehicleTypes2_TABLE + param_2 * 4) & 8;
	}
	if (param_1 == 4) {
		return *(uint *)((int)lego::globals::g_SubmenuIcons_BuildingTypes2_TABLE + param_2 * 4) & 8;
	}
	return 0;
}



undefined4 __cdecl FUN_0041c9e0(int param_1)
{
	BOOL BVar1;
	uint uVar2;
	
	BVar1 = FUN_0041c820(param_1,0);
	if (BVar1 != 0) {
		return *(undefined4 *)(&DAT_004de120 + param_1 * 4);
	}
	uVar2 = FUN_0041c990(param_1);
	if (uVar2 != 0) {
		return *(undefined4 *)(&DAT_004de248 + param_1 * 4);
	}
	return *(undefined4 *)(&DAT_004ddff8 + param_1 * 4);
}



ImageBMP * __cdecl FUN_0041ca20(int param_1,int param_2)
{
	uint uVar1;
	
	uVar1 = FUN_0041c880(param_1,param_2,0);
	if (uVar1 == 0) {
		uVar1 = FUN_0041c9a0(param_1,param_2);
		if (uVar1 == 0) {
			if (param_1 == 1) {
				return lego::globals::g_InterfaceBuildImages_Vehicles_normal_TABLE[param_2];
			}
			if (param_1 == 4) {
				return lego::globals::g_InterfaceBuildImages_Buildings_normal_TABLE[param_2];
			}
		}
		else {
			if (param_1 == 1) {
				return lego::globals::g_InterfaceBuildImages_Vehicles_disabled_TABLE[param_2];
			}
			if (param_1 == 4) {
				return lego::globals::g_InterfaceBuildImages_Buildings_disabled_TABLE[param_2];
			}
		}
	}
	else {
		if (param_1 == 1) {
			return lego::globals::g_InterfaceBuildImages_Vehicles_pressed_TABLE[param_2];
		}
		if (param_1 == 4) {
			return lego::globals::g_InterfaceBuildImages_Buildings_pressed_TABLE[param_2];
		}
	}
	return NULL;
}



ImageBMP * __cdecl FUN_0041cac0(undefined4 param_1,int param_2,int param_3)
{
	if (param_3 == 0) {
		if (true) {
			switch(param_1) {
			case 1:
				return lego::globals::g_InterfaceBuildImages_Vehicles_pressed_TABLE[param_2];
			case 2:
				return DAT_004de124;
			case 4:
				return lego::globals::g_InterfaceBuildImages_Buildings_pressed_TABLE[param_2];
			case 0xb:
				return DAT_004de158;
			case 0xf:
				return DAT_004de134;
			}
		}
	}
	else {
		if (true) {
			switch(param_1) {
			case 1:
				return lego::globals::g_InterfaceBuildImages_Vehicles_normal_TABLE[param_2];
			case 2:
				return DAT_004ddffc;
			case 4:
				return lego::globals::g_InterfaceBuildImages_Buildings_normal_TABLE[param_2];
			case 0xb:
				return DAT_004de030;
			case 0xf:
				return DAT_004de00c;
			}
		}
	}
	return NULL;
}



void __cdecl FUN_0041cbb0(int param_1,undefined4 param_2,undefined4 param_3)
{
	if (param_1 == 0x49) {
		DAT_004decd8 = param_2;
		DAT_004decdc = param_3;
		return;
	}
	if (param_1 == 5) {
		DAT_004decd8 = 0xf;
		DAT_004decdc = 0;
		return;
	}
	if (param_1 == 0xe) {
		DAT_004decd8 = 0xb;
		DAT_004decdc = 0;
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_0041cc10(undefined4 *param_1,uint param_2,uint param_3)
{
	DAT_004ded0c = *param_1;
	DAT_004ded10 = param_1[1];
	_DAT_004ded14 = (float)(ulonglong)param_2;
	_DAT_004ded18 = (float)(ulonglong)param_3;
	return;
}



void __cdecl FUN_0041cc60(float *param_1)
{
	float local_28;
	float local_24;
	float local_20;
	float local_1c;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	if ((lego::globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE) {
		local_28 = *param_1 - 1.0;
		local_24 = param_1[1] - 1.0;
		local_14 = (param_1[3] + param_1[1]) - -1.0;
		local_20 = (*param_1 + param_1[2]) - -1.0;
		local_1c = local_24;
		local_18 = local_20;
		local_10 = local_28;
		local_c = local_14;
		local_8 = local_28;
		local_4 = local_24;
		lego::draw::Draw_SurfaceLock_FUN_004862b0(&local_28,&local_20,4,0.0,1.0,0.0,0);
		local_28 = *param_1 - 2.0;
		local_24 = param_1[1] - 2.0;
		local_20 = (*param_1 + param_1[2]) - -2.0;
		local_14 = (param_1[3] + param_1[1]) - -2.0;
		local_1c = local_24;
		local_18 = local_20;
		local_10 = local_28;
		local_c = local_14;
		local_8 = local_28;
		local_4 = local_24;
		lego::draw::Draw_SurfaceLock_FUN_004862b0(&local_28,&local_20,4,0.0,1.0,0.0,0);
	}
	return;
}



void __cdecl FUN_0041cdd0(int param_1)
{
	uint uVar1;
	LiveObject **ppLVar2;
	ObjectStatsFlags1 OVar3;
	uint uVar4;
	
	if (INT_004deccc == 0xc) {
		uVar1 = lego::game::Game_GetNumSelectedUnits();
		ppLVar2 = lego::game::Game_GetSelectedUnits();
		for (uVar4 = uVar1; uVar4 != 0; uVar4 -= 1) {
			if ((LiveObject *)param_1 == *ppLVar2) {
				if (uVar1 == 1) {
					OVar3 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1);
					if (((OVar3 & STATS1_CROSSLAND) == STATS1_NONE) &&
						 ((*(byte *)(param_1 + 0x3ec) & 0x40) == 0)) {
						FUN_0041b200(0xb,NULL);
					}
					else {
						FUN_0041b200(10,NULL);
					}
				}
				else {
					FUN_0041e680();
				}
			}
			ppLVar2 = ppLVar2 + 1;
		}
	}
	return;
}



void __cdecl FUN_0041ce50(LiveObject *liveObj)
{
	uint uVar1;
	LiveObject **ppLVar2;
	uint uVar3;
	
	if (((INT_004deccc == 10) || (INT_004deccc == 0x12)) || (INT_004deccc == 0xb)) {
		uVar1 = lego::game::Game_GetNumSelectedUnits();
		ppLVar2 = lego::game::Game_GetSelectedUnits();
		for (uVar3 = uVar1; uVar3 != 0; uVar3 -= 1) {
			if (liveObj->drivenObject == *ppLVar2) {
				if (uVar1 == 1) {
					FUN_0041b200(0xc,NULL);
				}
				else {
					FUN_0041e680();
				}
			}
			ppLVar2 = ppLVar2 + 1;
		}
	}
	return;
}



void __cdecl FUN_0041ceb0(int *param_1)
{
	if (((INT_004deccc == 7) && (Point2I_004decc4.x == *param_1)) &&
		 (Point2I_004decc4.y == param_1[1])) {
		FUN_0041e680();
		return;
	}
	return;
}



void __cdecl FUN_0041cee0(Point2I *position)
{
	if ((((INT_004deccc == 1) || (INT_004deccc == 4)) && (Point2I_004decc4.x == position->x)) &&
		 (Point2I_004decc4.y == position->y)) {
		FUN_0041e680();
		return;
	}
	return;
}



void __cdecl FUN_0041cf10(Point2I *param_1)
{
	if (((INT_004deccc == 5) && (Point2I_004decc4.x == param_1->x)) &&
		 (Point2I_004decc4.y == param_1->y)) {
		FUN_0041e680();
		return;
	}
	return;
}



void __cdecl FUN_0041cf40(LiveObject *liveObj)
{
	BOOL BVar1;
	
	if (lego::globals::g_Game.unkbool_308 != 0) {
		BVar1 = FUN_004528d0(liveObj,NULL);
		if (BVar1 != 0) {
			FUN_0041e680();
			return;
		}
	}
	return;
}



BOOL __cdecl FUN_0041cf70(uint menuIcon)
{
	TerrainType TVar1;
	LiveFlags5 LVar2;
	uint uVar3;
	LiveObject *liveObj;
	ObjectStatsFlags3 OVar4;
	ObjectStatsFlags1 OVar5;
	int iVar6;
	uint uVar7;
	int iVar8;
	BOOL BVar9;
	ObjectStatsFlags2 OVar10;
	float10 fVar11;
	ObjectType objType;
	code *pcVar12;
	undefined4 uVar13;
	ObjectType local_8;
	int local_4;
	
	liveObj = lego::game::Game_GetPrimarySelectedObject();
	uVar3 = menuIcon;
	if (false) goto switchD_0041cf8b_caseD_2;
	switch(menuIcon) {
	case 0:
		if (DAT_004decfc == 0xf) {
			return 0;
		}
		break;
	case 1:
		lego::game::Game_GetObjectByName("Barracks",&local_8,(int *)&menuIcon,NULL);
		BVar9 = FUN_0041f030(OBJECT_MINIFIGURE,0);
		if (BVar9 == 0) {
			return 0;
		}
		BVar9 = FUN_0040add0(OBJECT_MINIFIGURE,0,0);
		if (BVar9 == 0) {
			return 0;
		}
		BVar9 = FUN_0043c4c0(OBJECT_MINIFIGURE,0,local_8,menuIcon);
		if (BVar9 == 0) {
			return 0;
		}
		break;
	case 5:
		BVar9 = FUN_00408fd0(&Point2I_004decc4);
		if (BVar9 != 0) {
			return 0;
		}
		BVar9 = lego::game::Level_IsBlockPowerPath(&Point2I_004decc4);
		if (BVar9 != 0) {
			return 0;
		}
		objType = OBJECT_PATH;
		goto LAB_0041d8d5;
	case 6:
		BVar9 = lego::game::Level_IsBlockPowerPath(&Point2I_004decc4);
		if (BVar9 == 0) {
			return 0;
		}
		break;
	case 7:
		BVar9 = FUN_00408fd0(&Point2I_004decc4);
		if (BVar9 != 0) {
			return 0;
		}
		if ((lego::globals::g_Game.level)->blocks
				[((lego::globals::g_Game.level)->dimensions).width * Point2I_004decc4.y + Point2I_004decc4.x
				].terrain == TERRAIN_LAVA) {
			return 0;
		}
		break;
	case 9:
		BVar9 = lego::game::Game_IsAnyUnitsSelected();
		if (BVar9 == 0) break;
		iVar8 = 1;
		goto LAB_0041d17f;
	case 0xb:
		iVar8 = FUN_0041f670((int *)&Point2I_004decc4);
		if (iVar8 == 0) {
			return 0;
		}
		BVar9 = lego::game::Game_IsAnyUnitsSelected();
		if (BVar9 == 0) {
			iVar8 = FUN_0041f2f0(&Point2I_004decc4);
			if (iVar8 == 0) {
				return 0;
			}
		}
		else {
			iVar8 = FUN_00403110(0);
			if ((iVar8 == 0) && (iVar8 = FUN_0041f1e0(), iVar8 == 0)) {
				return 0;
			}
			iVar8 = FUN_00431960(Point2I_004decc4.x,Point2I_004decc4.y,0);
			if (iVar8 == 0) {
				return 0;
			}
		}
		break;
	case 0xc:
		iVar8 = FUN_0041f670((int *)&Point2I_004decc4);
		if (iVar8 == 0) {
			return 0;
		}
		BVar9 = lego::game::Level_GetBlockFlags1_20(Point2I_004decc4.x,Point2I_004decc4.y);
		if (BVar9 != 0) {
			return 0;
		}
		BVar9 = lego::game::Level_GetBlockFlags1_c0(Point2I_004decc4.x,Point2I_004decc4.y);
		if (BVar9 != 0) {
			return 0;
		}
		BVar9 = FUN_00432950(NULL,Point2I_004decc4.x,Point2I_004decc4.y);
		if (BVar9 == 0) {
			return 0;
		}
		BVar9 = lego::game::Game_IsAnyUnitsSelected();
		if (BVar9 == 0) {
			iVar8 = FUN_0041f330(&Point2I_004decc4);
			if (iVar8 == 0) {
				return 0;
			}
		}
		else {
			iVar8 = FUN_00403110(2);
			if ((iVar8 == 0) && (iVar8 = FUN_0041f1e0(), iVar8 == 0)) {
				return 0;
			}
			iVar8 = FUN_004319e0(Point2I_004decc4.x,Point2I_004decc4.y);
			if (iVar8 == 0) {
				return 0;
			}
		}
		break;
	case 0xd:
		iVar8 = FUN_0041f670((int *)&Point2I_004decc4);
		if (iVar8 == 0) {
			return 0;
		}
		TVar1 = (lego::globals::g_Game.level)->blocks
						[((lego::globals::g_Game.level)->dimensions).width * Point2I_004decc4.y +
						 Point2I_004decc4.x].terrain;
		if (TVar1 == TERRAIN_IMMOVABLE) {
			return 0;
		}
		if (TVar1 == TERRAIN_RECHARGESEAM) {
			return 0;
		}
		BVar9 = lego::game::Level_GetBlockFlags1_10Not8(Point2I_004decc4.x,Point2I_004decc4.y);
		if (BVar9 == 0) {
			return 0;
		}
		uVar7 = lego::game::Level_GetBlockFlags1_8000000(&Point2I_004decc4);
		if (uVar7 != 0) {
			return 0;
		}
		iVar8 = FUN_0041f1e0();
		if (iVar8 == 0) {
			return 0;
		}
		iVar8 = FUN_0041f270(8);
		if (iVar8 != 0) break;
		iVar8 = FUN_0041f220(2,0);
		if (iVar8 == 0) {
			return 0;
		}
		uVar13 = 0x20;
		goto LAB_0041d599;
	case 0xe:
		uVar7 = FUN_00432450(Point2I_004decc4.x,Point2I_004decc4.y);
		if (uVar7 != 0) {
			return 0;
		}
		iVar8 = FUN_0040d170(Point2I_004decc4.x,Point2I_004decc4.y);
		if (iVar8 == 0) {
			return 0;
		}
		BVar9 = 0;
		objType = OBJECT_ELECTRICFENCE;
LAB_0041d8d5:
		BVar9 = FUN_0040add0(objType,BVar9,BVar9);
		if (BVar9 == 0) {
			return 0;
		}
		break;
	case 0x10:
		if (((lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * Point2I_004decc4.y +
					Point2I_004decc4.x].flags1 & (BLOCK1_UNK_100000|BLOCK1_UNK_40000000)) == BLOCK1_NONE) {
			return 0;
		}
		uVar7 = FUN_00432f60((int *)&Point2I_004decc4);
		if (uVar7 != 0) {
			return 0;
		}
		BVar9 = lego::game::Level_IsBlockPowerPath(&Point2I_004decc4);
		if (BVar9 != 0) {
			return 0;
		}
		BVar9 = FUN_004329d0(Point2I_004decc4.x,Point2I_004decc4.y,1);
		if (BVar9 != 0) {
			return 0;
		}
		break;
	case 0x14:
	case 0x15:
		uVar13 = 0;
		pcVar12 = (code *)&LAB_0041f400;
		goto LAB_0041d969;
	case 0x16:
	case 0x17:
		if (((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) &&
			 (liveObj->carriedObjects[0]->objType == OBJECT_BARRIER)) {
			return 0;
		}
		OVar4 = lego::game::LiveObject_GetStatsFlags3(liveObj);
		if (((OVar4 & STATS3_CARRYVEHICLES) != STATS3_NONE) &&
			 (iVar8 = FUN_00440080((int *)liveObj), iVar8 == 0)) {
			return 0;
		}
		uVar13 = 0;
		pcVar12 = (code *)&LAB_0041f3a0;
		goto LAB_0041d969;
	case 0x18:
		iVar8 = 2;
		uVar13 = 8;
		OVar4 = lego::game::LiveObject_GetStatsFlags3(liveObj);
		if ((OVar4 & STATS3_NEEDSPILOT) == STATS3_NONE) {
			OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj);
			if ((OVar5 & STATS1_CROSSLAND) != STATS1_NONE) {
				OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj);
				if ((OVar5 & STATS1_CROSSWATER) == STATS1_NONE) {
					iVar8 = 4;
					uVar13 = 0x10;
				}
				else {
					iVar8 = 1;
					uVar13 = 4;
				}
			}
		}
		else {
			iVar8 = 1;
			uVar13 = 4;
		}
		OVar4 = lego::game::LiveObject_GetStatsFlags3(liveObj);
		if (((OVar4 & STATS3_GETINATLAND) == STATS3_NONE) ||
			 ((*(byte *)&liveObj->flags4_3ec & 0x40) != 0)) {
			if ((iVar8 == 2) && ((*(byte *)&liveObj->flags4_3ec & 0x40) == 0)) {
				return 0;
			}
		}
		else {
			iVar6 = FUN_0043a100((undefined4 *)liveObj,NULL);
			if (iVar6 == 0) {
				return 0;
			}
		}
		if ((*(byte *)&liveObj->flags2_3e4 & 0x10) != 0) {
			return 0;
		}
		iVar8 = FUN_0041f270(iVar8);
		if (iVar8 != 0) break;
		iVar8 = FUN_0041f220(2,0);
		if (iVar8 == 0) {
			return 0;
		}
		goto LAB_0041d599;
	case 0x19:
		if ((*(byte *)&liveObj->flags1_3e0 & 1) != 0) {
			return 0;
		}
		OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		if ((OVar5 & STATS1_CANBEDRIVEN) == STATS1_NONE) {
			return 0;
		}
		OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		if ((((OVar5 & STATS1_CROSSLAND) == STATS1_NONE) &&
				(iVar8 = FUN_0043a0d0(liveObj,NULL), iVar8 == 0)) &&
			 ((*(byte *)&liveObj->flags4_3ec & 0x40) == 0)) {
			return 0;
		}
		break;
	case 0x1a:
		if ((*(byte *)&liveObj->flags1_3e0 & 1) != 0) {
			return 0;
		}
		OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		if ((OVar5 & STATS1_CANBEDRIVEN) == STATS1_NONE) {
			return 0;
		}
		if ((*(byte *)&liveObj->flags4_3ec & 0x40) != 0) {
			return 0;
		}
		iVar8 = FUN_00438ca0(liveObj,1);
		if (iVar8 == 0) {
			return 0;
		}
		break;
	case 0x1d:
		if ((*(byte *)&liveObj->flags3_3e8 & 2) == 0) {
			return 0;
		}
		if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) {
			return 0;
		}
		break;
	case 0x1e:
		iVar8 = 0;
LAB_0041d17f:
		iVar8 = FUN_00403110(iVar8);
		if ((iVar8 == 0) && (iVar8 = FUN_0041f1e0(), iVar8 == 0)) {
			return 0;
		}
		break;
	case 0x1f:
		uVar13 = 0;
		pcVar12 = (code *)&LAB_0041f3c0;
		goto LAB_0041d969;
	case 0x21:
		uVar13 = 6;
		pcVar12 = FUN_0041f750;
LAB_0041d969:
		iVar8 = FUN_0041f350(pcVar12,uVar13);
		if (iVar8 == 0) {
			return 0;
		}
		break;
	case 0x22:
	case 0x23:
		OVar10 = lego::game::LiveObject_GetStatsFlags2(liveObj);
		if ((OVar10 & STATS2_SELFPOWERED) != STATS2_NONE) {
			return 0;
		}
		if ((liveObj->flags3_3e8 & 0x20000000) == LIVEOBJ3_NONE) {
			return 0;
		}
		break;
	case 0x24:
		iVar8 = FUN_0041f350(&LAB_0041f3e0,0);
		if (iVar8 == 0) {
			return 0;
		}
		iVar8 = FUN_0041f270(0x10);
		if (iVar8 != 0) break;
		iVar8 = FUN_0041f220(2,0);
		if (iVar8 == 0) {
			return 0;
		}
		uVar13 = 0x40;
LAB_0041d599:
		iVar8 = FUN_0041f1a0(uVar13);
		if (iVar8 == 0) {
			return 0;
		}
		break;
	case 0x25:
		BVar9 = lego::game::LiveObject_IsSmallTeleporter(liveObj);
		if (((BVar9 == 0) && (BVar9 = lego::game::LiveObject_IsBigTeleporter(liveObj), BVar9 == 0)) &&
			 (BVar9 = lego::game::LiveObject_IsWaterTeleporter(liveObj), BVar9 == 0)) {
			return 0;
		}
		break;
	case 0x26:
		BVar9 = lego::game::LiveObject_CanSpawnCarryableObject(liveObj,OBJECT_POWERCRYSTAL,0);
		if (BVar9 == 0) {
			return 0;
		}
	case 0x27:
		BVar9 = lego::game::LiveObject_CanSpawnCarryableObject(liveObj,OBJECT_ORE,0);
		if (BVar9 == 0) {
			return 0;
		}
		break;
	case 0x29:
		lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_8,&local_4);
		if ((liveObj->drivenObject != NULL) &&
			 (iVar8 = FUN_00431cd0(liveObj->drivenObject,local_8,local_4,local_8,local_4,1), iVar8 == 0))
		{
			return 0;
		}
		OVar4 = lego::game::LiveObject_GetStatsFlags3(liveObj);
		if (((((OVar4 & STATS3_CARRYVEHICLES) != STATS3_NONE) &&
				 ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE)) &&
				(liveObj->carriedObjects[0] != NULL)) &&
			 (iVar8 = FUN_00431cd0(liveObj->carriedObjects[0],local_8,local_4,local_8,local_4,1),
			 iVar8 == 0)) {
			return 0;
		}
		OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		if (((OVar5 & STATS1_CROSSLAND) == STATS1_NONE) && ((*(byte *)&liveObj->flags4_3ec & 0x40) == 0)
			 ) {
			return 0;
		}
		break;
	case 0x2d:
		if ((liveObj == lego::globals::g_Game.object_a0) &&
			 ((lego::globals::g_Game.structbc_2c)->field_14 == 0)) {
			return 0;
		}
		break;
	case 0x2e:
		if ((liveObj == lego::globals::g_Game.object_a0) &&
			 ((lego::globals::g_Game.structbc_2c)->field_14 == 1)) {
			return 0;
		}
		break;
	case 0x30:
		goto switchD_0041cf8b_caseD_30;
	case 0x31:
		uVar13 = 0;
		goto LAB_0041d741;
	case 0x32:
		uVar13 = 1;
		goto LAB_0041d741;
	case 0x33:
		uVar13 = 2;
		goto LAB_0041d741;
	case 0x34:
		uVar13 = 3;
		goto LAB_0041d741;
	case 0x35:
		uVar13 = 4;
		goto LAB_0041d741;
	case 0x36:
		uVar13 = 5;
		goto LAB_0041d741;
	case 0x37:
		uVar13 = 7;
		goto LAB_0041d741;
	case 0x38:
		uVar13 = 6;
LAB_0041d741:
		iVar8 = FUN_0041f350(&LAB_0041f5a0,uVar13);
		if (iVar8 == 0) {
			return 0;
		}
switchD_0041cf8b_caseD_30:
		iVar8 = FUN_0041f1e0();
		if (iVar8 == 0) {
			return 0;
		}
		break;
	case 0x39:
		iVar8 = FUN_0041f1a0(0xfc);
		if (iVar8 == 0) {
			return 0;
		}
		LVar2 = liveObj->flags5_3f0;
		if (((((LVar2 & 1) != 0) && ((LVar2 & 2) != 0)) &&
				(((LVar2 & 4) != 0 && (((LVar2 & 8) != 0 && ((LVar2 & 0x10) != 0)))))) &&
			 ((LVar2 & 0x20) != 0)) {
			return 0;
		}
		break;
	case 0x3a:
		uVar7 = FUN_0041f650(4);
		if (uVar7 != 0) {
			return 0;
		}
		uVar13 = 0x10;
		goto LAB_0041d829;
	case 0x3b:
		uVar7 = FUN_0041f650(0x10);
		if (uVar7 != 0) {
			return 0;
		}
		uVar13 = 0x40;
		goto LAB_0041d829;
	case 0x3c:
		uVar7 = FUN_0041f650(0x20);
		if (uVar7 != 0) {
			return 0;
		}
		uVar13 = 0x80;
		goto LAB_0041d829;
	case 0x3d:
		uVar7 = FUN_0041f650(1);
		if (uVar7 != 0) {
			return 0;
		}
		uVar13 = 4;
LAB_0041d829:
		iVar8 = FUN_0041f1a0(uVar13);
joined_r0x0041d86f:
		if (iVar8 == 0) {
			return 0;
		}
		fVar11 = lego::game::Level_GetTrainTime();
		if ((ushort)((ushort)(fVar11 < (float10)liveObj->elapsedTime1) << 8 |
								(ushort)(fVar11 == (float10)liveObj->elapsedTime1) << 0xe) == 0) {
			return 0;
		}
		break;
	case 0x3e:
		uVar7 = FUN_0041f650(2);
		if (uVar7 != 0) {
			return 0;
		}
		uVar13 = 8;
		goto LAB_0041d865;
	case 0x3f:
		uVar7 = FUN_0041f650(8);
		if (uVar7 != 0) {
			return 0;
		}
		uVar13 = 0x20;
LAB_0041d865:
		iVar8 = FUN_0041f1a0(uVar13);
		goto joined_r0x0041d86f;
	case 0x40:
		uVar7 = lego::game::Object_GetLevels(liveObj->objType,liveObj->objIndex);
		if (uVar7 <= liveObj->objLevel + 1) {
			return 0;
		}
		if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) {
			return 0;
		}
		goto switchD_0041cf8b_caseD_30;
	case 0x41:
		BVar9 = lego::game::LiveObject_GetBuildingUpgradeCost(liveObj,NULL);
		if (BVar9 == 0) {
			return 0;
		}
		break;
	case 0x42:
		iVar8 = FUN_0041f160();
		if (iVar8 == 0) {
			return 0;
		}
		BVar9 = FUN_00438b70(liveObj,1);
		if (((BVar9 != 0) || (BVar9 = FUN_00438b70(liveObj,0), BVar9 != 0)) ||
			 (BVar9 = FUN_00438b70(liveObj,2), BVar9 != 0)) break;
		goto LAB_0041da08;
	case 0x43:
		iVar8 = FUN_0041f160();
		if (iVar8 == 0) {
			return 0;
		}
		iVar8 = 1;
		goto LAB_0041da0a;
	case 0x44:
		iVar8 = FUN_0041f160();
		if (iVar8 == 0) {
			return 0;
		}
		iVar8 = 0;
		goto LAB_0041da0a;
	case 0x45:
		iVar8 = FUN_0041f160();
		if (iVar8 == 0) {
			return 0;
		}
		iVar8 = 2;
		goto LAB_0041da0a;
	case 0x46:
		iVar8 = FUN_0041f160();
		if (iVar8 == 0) {
			return 0;
		}
LAB_0041da08:
		iVar8 = 3;
LAB_0041da0a:
		BVar9 = FUN_00438b70(liveObj,iVar8);
		if (BVar9 == 0) {
			return 0;
		}
	}
switchD_0041cf8b_caseD_2:
	if (((byte)lego::globals::g_Game.flags3 & 6) == 0) {
		if (((byte)lego::globals::g_Game.flags3 & 0x18) == 0) {
			if ((((byte)lego::globals::g_Game.flags3 & 0x60) != 0) && (uVar3 != 0)) {
				if ((int)uVar3 < 0x1d) {
					return 0;
				}
				if (0x1e < (int)uVar3) {
					return 0;
				}
			}
		}
		else {
			if (uVar3 != 0) {
				if ((int)uVar3 < 0x14) {
					return 0;
				}
				if (0x15 < (int)uVar3) {
					return 0;
				}
			}
		}
	}
	else {
		if ((uVar3 != 0) && (((int)uVar3 < 0x1b || (0x1c < (int)uVar3)))) {
			return 0;
		}
	}
	return 1;
}



BOOL __cdecl lego::game::Game_DoAction__0041dbd0(int param_1)
{
	ObjectType OVar1;
	LiveObject *pLVar2;
	BOOL BVar3;
	LevelSurfaceMap *pLVar4;
	ObjectStatsFlags1 OVar5;
	LevelData *pLVar6;
	int iVar7;
	uint uVar8;
	ObjectStatsFlags3 OVar9;
	GameFlags3 GVar10;
	int iVar11;
	int index;
	undefined4 uVar12;
	
	pLVar2 = Game_GetPrimarySelectedObject();
	BVar3 = FUN_0041c820(param_1,1);
	if (BVar3 != 0) {
		return 0;
	}
	if (false) goto switchD_0041dbfa_caseD_8;
	switch(param_1) {
	case 0:
		if (0xf < INT_004deccc) {
			if (INT_004deccc < 0x12) {
				FUN_0041b200(9,NULL);
				return 1;
			}
			if (INT_004deccc == 0x12) {
				OVar5 = LiveObject_GetStatsFlags1(pLVar2);
				if (((OVar5 & STATS1_CROSSLAND) == STATS1_NONE) &&
					 ((*(byte *)&pLVar2->flags4_3ec & 0x40) == 0)) {
					FUN_0041b200(0xb,NULL);
					return 1;
				}
				FUN_0041b200(10,NULL);
				return 1;
			}
		}
		break;
	case 1:
		Game_TryPlaceObject(OBJECT_MINIFIGURE,0);
		FUN_0041e680();
		return 1;
	case 2:
		FUN_0041b200(0x13,NULL);
		return 1;
	case 3:
		FUN_0041b200(0x14,NULL);
		return 1;
	case 4:
		FUN_0041b200(0x15,NULL);
		return 1;
	case 5:
	case 7:
		FUN_00409230(&Point2I_004decc4);
		FUN_0041e680();
		return 1;
	case 6:
		FUN_00430250(&Point2I_004decc4,0x3f);
		pLVar6 = GetLevel();
		iVar7 = (pLVar6->dimensions).width * Point2I_004decc4.y + Point2I_004decc4.x;
		pLVar6 = GetLevel();
		pLVar6->blocks[iVar7].flags1 = pLVar6->blocks[iVar7].flags1 & ~BLOCK1_POWERPATH;
		Level_UpdateBlockSurfaceUnk(globals::g_Game.level,Point2I_004decc4.x,Point2I_004decc4.y);
		FUN_0041e680();
		return 1;
	case 9:
		FUN_00401f40(0xc,0,&Point2I_004decc4);
		FUN_0041e680();
		return 1;
	case 0xb:
		FUN_00402440(&Point2I_004decc4,0,1);
		goto LAB_0041de87;
	case 0xc:
		FUN_00402f60(&Point2I_004decc4);
		goto LAB_0041de87;
	case 0xd:
		FUN_00402c80(&Point2I_004decc4,0);
LAB_0041de87:
		iVar7 = Point2I_004decc4.x;
		iVar11 = Point2I_004decc4.y;
		pLVar4 = GetSurfaceMap();
		INT_004df1f0 = FUN_0044f800(pLVar4,iVar7,iVar11);
		FUN_0041e680();
		return 1;
	case 0xe:
		FUN_00402ee0(&Point2I_004decc4);
		FUN_0041e680();
		return 1;
	case 0xf:
		FUN_00402a10(&Point2I_004decc4,0);
		INT_004df1f0 = 0;
		index = 4;
		iVar7 = Point2I_004decc4.x;
		iVar11 = Point2I_004decc4.y;
		pLVar4 = GetSurfaceMap();
		FUN_0044f7a0(pLVar4,iVar7,iVar11,index);
		FUN_0041e680();
		return 1;
	case 0x10:
		if (((globals::g_Game.level)->blocks
				 [((globals::g_Game.level)->dimensions).width * Point2I_004decc4.y + Point2I_004decc4.x].
				 flags1 & BLOCK1_UNK_40000000) == BLOCK1_NONE) {
			FUN_00409530(&Point2I_004decc4);
			FUN_0041e680();
			return 1;
		}
		FUN_00409080(&Point2I_004decc4);
		FUN_0041e680();
		return 1;
	case 0x11:
		Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
		Level_AddMessageAction(MESSAGE_SELECT,pLVar2,0,NULL);
		FUN_0041b200(9,NULL);
		return 1;
	case 0x12:
		Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
		Level_AddMessageAction(MESSAGE_SELECT,pLVar2,0,NULL);
		OVar5 = LiveObject_GetStatsFlags1(pLVar2);
		if (((OVar5 & STATS1_CROSSLAND) == STATS1_NONE) && ((*(byte *)&pLVar2->flags4_3ec & 0x40) == 0))
		{
			FUN_0041b200(0xb,NULL);
			return 1;
		}
LAB_0041df4c:
		FUN_0041b200(10,NULL);
		return 1;
	case 0x13:
		Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
		Level_AddMessageAction(MESSAGE_SELECT,pLVar2,0,NULL);
		FUN_0041b200(0xd,NULL);
		return 1;
	case 0x14:
		OVar9 = LiveObject_GetStatsFlags3(pLVar2);
		if ((OVar9 & STATS3_CARRYVEHICLES) != STATS3_NONE) {
			FUN_00402df0(pLVar2);
			return 1;
		}
		GVar10 = GAME3_LOADVEHICLE;
		if ((globals::g_Game.flags3 & GAME3_LOADVEHICLE) != GAME3_NONE) {
			FUN_00435950();
			return 1;
		}
		goto LAB_0041e4b7;
	case 0x15:
		GVar10 = GAME3_PICKUPOBJECT;
		if ((globals::g_Game.flags3 & GAME3_PICKUPOBJECT) != GAME3_NONE) {
			FUN_00435950();
			return 1;
		}
		goto LAB_0041e4b7;
	case 0x16:
	case 0x17:
		FUN_0041f350(FUN_0041f5f0,0);
		return 1;
	case 0x18:
		Game_UnselectAllUnits();
		FUN_00402890(pLVar2);
		FUN_0041e680();
		return 1;
	case 0x19:
		FUN_00440470(pLVar2,0);
		FUN_0041e680();
		return 1;
	case 0x1a:
		FUN_00440470(pLVar2,1);
		FUN_0041e680();
		return 1;
	case 0x1b:
		GVar10 = GAME3_UNK_2;
		if ((globals::g_Game.flags3 & GAME3_UNK_2) != GAME3_NONE) {
			FUN_00435950();
			return 1;
		}
		goto LAB_0041e4b7;
	case 0x1c:
		GVar10 = GAME3_UNK_4;
		if ((globals::g_Game.flags3 & GAME3_UNK_4) != GAME3_NONE) {
			FUN_00435950();
			return 1;
		}
		goto LAB_0041e4b7;
	case 0x1d:
		GVar10 = GAME3_UNK_40;
		goto LAB_0041e4a1;
	case 0x1e:
		GVar10 = GAME3_UNK_20;
LAB_0041e4a1:
		if (((byte)globals::g_Game.flags3 & (byte)GVar10) != 0) {
			FUN_00435950();
			return 1;
		}
LAB_0041e4b7:
		FUN_00435950();
		globals::g_Game.flags3 = globals::g_Game.flags3 | GVar10;
		return 1;
	case 0x1f:
		FUN_0041f350(FUN_0041f540,0);
		FUN_0041e680();
		return 1;
	case 0x20:
	case 0x28:
	case 0x29:
	case 0x2a:
		FUN_0041f350(FUN_0041f520,0);
		FUN_0041e680();
		return 1;
	case 0x21:
		FUN_0041f350(FUN_0041f770,0);
		FUN_0041e680();
		return 1;
	case 0x22:
		BVar3 = 1;
		goto LAB_0041e51b;
	case 0x23:
		BVar3 = 0;
LAB_0041e51b:
		LiveObject_SetFlag3_80000000(pLVar2,BVar3);
		break;
	case 0x24:
		FUN_0041f350(FUN_0041f570,0);
		FUN_0041e680();
		return 1;
	case 0x25:
		BVar3 = LiveObject_IsSmallTeleporter(pLVar2);
		if (BVar3 != 0) {
			globals::g_Game.placeDestSmallTeleporter = pLVar2;
			FUN_0041e680();
			return 1;
		}
		BVar3 = LiveObject_IsBigTeleporter(pLVar2);
		if (BVar3 != 0) {
			globals::g_Game.placeDestBigTeleporter = pLVar2;
			FUN_0041e680();
			return 1;
		}
		BVar3 = LiveObject_IsWaterTeleporter(pLVar2);
		if (BVar3 != 0) {
			globals::g_Game.placeDestWaterTeleporter = pLVar2;
			FUN_0041e680();
			return 1;
		}
		break;
	case 0x26:
		FUN_0043a910(pLVar2,OBJECT_POWERCRYSTAL,0,0);
		FUN_0041e680();
		return 1;
	case 0x27:
		FUN_0043a910(pLVar2,OBJECT_ORE,0,0);
		FUN_0041e680();
		return 1;
	case 0x2c:
		Level_AddMessageAction(MESSAGE_TOPVIEW,0,0,NULL);
		OVar1 = pLVar2->objType;
		if (OVar1 == OBJECT_VEHICLE) {
			OVar5 = LiveObject_GetStatsFlags1(pLVar2);
			if (((OVar5 & STATS1_CROSSLAND) == STATS1_NONE) &&
				 ((*(byte *)&pLVar2->flags4_3ec & 0x40) == 0)) {
				FUN_0041b200(0xb,NULL);
				return 1;
			}
			goto LAB_0041df4c;
		}
		if (OVar1 == OBJECT_MINIFIGURE) {
			FUN_0041b200(9,NULL);
			return 1;
		}
		if (OVar1 == OBJECT_BUILDING) {
			FUN_0041b200(0xd,NULL);
			return 1;
		}
		break;
	case 0x2d:
		BVar3 = 0;
		goto LAB_0041deb2;
	case 0x2e:
		BVar3 = 1;
LAB_0041deb2:
		Level_AddMessageAction(MESSAGE_FIRSTPERSON,0,BVar3,NULL);
		FUN_0041b200(0xf,NULL);
		return 1;
	case 0x2f:
		FUN_00425c80(pLVar2);
		FUN_0041e680();
		return 1;
	case 0x30:
		FUN_0041b200(0x10,NULL);
		return 1;
	case 0x31:
		FUN_0041f350(FUN_0041f5c0,0);
		FUN_0041e680();
		return 1;
	case 0x32:
		FUN_0041f350(FUN_0041f5c0,1);
		FUN_0041e680();
		return 1;
	case 0x33:
		FUN_0041f350(FUN_0041f5c0,2);
		FUN_0041e680();
		return 1;
	case 0x34:
		FUN_0041f350(FUN_0041f5c0,3);
		FUN_0041e680();
		return 1;
	case 0x35:
		FUN_0041f350(FUN_0041f5c0,4);
		FUN_0041e680();
		return 1;
	case 0x36:
		FUN_0041f350(FUN_0041f5c0,5);
		FUN_0041e680();
		return 1;
	case 0x37:
		FUN_0041f350(FUN_0041f5c0,7);
		FUN_0041e680();
		return 1;
	case 0x38:
		FUN_0041f350(FUN_0041f5c0,6);
		FUN_0041e680();
		return 1;
	case 0x39:
		FUN_0041b200(0x11,NULL);
		return 1;
	case 0x3a:
	case 0x3b:
	case 0x3c:
	case 0x3d:
	case 0x3e:
	case 0x3f:
		switch(param_1) {
		case 0x3a:
			param_1 = TRAINED_DRIVER;
			break;
		case 0x3b:
			param_1 = TRAINED_REPAIR;
			break;
		case 0x3c:
			param_1 = TRAINED_SCANNER;
			break;
		case 0x3d:
			param_1 = TRAINED_PILOT;
			break;
		case 0x3e:
			param_1 = TRAINED_SAILOR;
			break;
		case 0x3f:
			param_1 = TRAINED_DYNAMITE;
		}
		pLVar2 = (LiveObject *)FUN_00439110(pLVar2,NULL,param_1);
		if (pLVar2 == NULL) {
			return 0;
		}
		FUN_004027c0(pLVar2,param_1,1);
		FUN_0041e680();
		return 1;
	case 0x40:
		FUN_00403250(pLVar2,0);
		FUN_0041e680();
		return 1;
	case 0x41:
		FUN_00438ab0(pLVar2);
		FUN_0041e680();
		return 1;
	case 0x42:
		FUN_0041b200(0x12,NULL);
		return 1;
	case 0x43:
		uVar12 = 1;
		goto LAB_0041e4f4;
	case 0x44:
		uVar12 = 0;
		goto LAB_0041e4f4;
	case 0x45:
		uVar12 = 2;
		goto LAB_0041e4f4;
	case 0x46:
		uVar12 = 3;
LAB_0041e4f4:
		FUN_00403250(pLVar2,uVar12);
		pLVar2->elapsedTime2 = 0.0;
		FUN_0041e680();
		return 1;
	case 0x47:
		if ((globals::g_Game.flags3 & GAME3_UNK_1) == GAME3_NONE) {
			FUN_00435950();
			globals::g_Game.flags3 |= GAME3_UNK_1;
			FUN_0040e710();
			FUN_0041e680();
			return 1;
		}
		FUN_00435950();
		FUN_0041e680();
		return 1;
	case 0x48:
		Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
		FUN_0041e680();
		return 1;
	case 0x49:
		uVar8 = FUN_0041c880(DAT_004decd8,DAT_004decdc,1);
		if (uVar8 != 0) {
			return 0;
		}
		Game_TryPlaceObject(DAT_004decd8,DAT_004decdc);
		if (DAT_004decd8 == OBJECT_BUILDING) {
			return 1;
		}
	}
switchD_0041dbfa_caseD_8:
	FUN_0041e680();
	return 1;
}



void __cdecl FUN_0041e680(void)
{
	lego::game::Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
	FUN_0041b200(0,NULL);
	return;
}



void __cdecl lego::nerps::NERPs_SetIconFlag4__0041e6a0(int param_1,BOOL state)
{
	if (state != 0) {
		UINT_ARRAY_004de60c[param_1] = UINT_ARRAY_004de60c[param_1] | 4;
		return;
	}
	UINT_ARRAY_004de60c[param_1] = UINT_ARRAY_004de60c[param_1] & 0xfffffffb;
	return;
}



void __cdecl
lego::nerps::NERPs_FlashSubmenuIcon_internal___0041e6d0(ObjectType objType,int objIndex,BOOL state)
{
	uint uVar1;
	void *pvVar2;
	
	pvVar2 = globals::g_SubmenuIcons_VehicleTypes2_TABLE;
	if ((objType == OBJECT_VEHICLE) ||
		 (pvVar2 = globals::g_SubmenuIcons_BuildingTypes2_TABLE, objType == OBJECT_BUILDING)) {
		uVar1 = *(uint *)((int)pvVar2 + objIndex * 4);
		if (state != 0) {
			*(uint *)((int)pvVar2 + objIndex * 4) = uVar1 | 4;
			return;
		}
		*(uint *)((int)pvVar2 + objIndex * 4) = uVar1 & 0xfffffffb;
	}
	return;
}



LiveObject * __cdecl lego::game::Game_GetFirstSelectedObject(void)
{
	return (LiveObject *)
				 (-(uint)(globals::g_SelectedUnits_COUNT != 0) & (uint)globals::g_SelectedUnits_TABLE[0]);
}



uint __cdecl FUN_0041e720(int param_1,uint param_2)
{
	uint uVar1;
	
	uVar1 = UINT_ARRAY_004de9ac[param_1];
	UINT_ARRAY_004de9ac[param_1] = param_2;
	return uVar1;
}



uint __cdecl FUN_0041e740(int param_1)
{
	return UINT_ARRAY_004de9ac[param_1];
}



undefined4 __cdecl
lego::nerps::NERPs_SetSubmenuIconClicked_internal___0041e750
					(ObjectType objType,int objIndex,BOOL state)
{
	undefined4 uVar1;
	
	uVar1 = 0;
	if (objType == OBJECT_VEHICLE) {
		uVar1 = *(undefined4 *)((int)globals::g_SubmenuIcons_VehicleTypes_TABLE + objIndex * 4);
		*(BOOL *)((int)globals::g_SubmenuIcons_VehicleTypes_TABLE + objIndex * 4) = state;
		return uVar1;
	}
	if (objType == OBJECT_BUILDING) {
		uVar1 = *(undefined4 *)((int)globals::g_SubmenuIcons_BuildingTypes_TABLE + objIndex * 4);
		*(BOOL *)((int)globals::g_SubmenuIcons_BuildingTypes_TABLE + objIndex * 4) = state;
	}
	return uVar1;
}



undefined4 __cdecl FUN_0041e790(int param_1,int param_2)
{
	if (param_1 == 1) {
		return *(undefined4 *)((int)lego::globals::g_SubmenuIcons_VehicleTypes_TABLE + param_2 * 4);
	}
	if (param_1 == 4) {
		return *(undefined4 *)((int)lego::globals::g_SubmenuIcons_BuildingTypes_TABLE + param_2 * 4);
	}
	return 0;
}



undefined4 __cdecl FUN_0041e7c0(undefined4 param_1,int param_2)
{
	uint uVar1;
	
	uVar1 = FLAGS_004df1f8 | 0x20;
	if (param_2 != 0) {
		uVar1 = FLAGS_004df1f8 | 0x60;
	}
	FLAGS_004df1f8 = uVar1;
	DAT_004ded24 = FUN_0041e800(param_1);
	DAT_004ded28 = param_1;
	return 1;
}



undefined4 __cdecl FUN_0041e800(undefined4 param_1)
{
	if (true) {
		switch(param_1) {
		case 0:
			return 4;
		case 1:
		case 2:
		case 5:
		case 6:
		case 9:
		case 0xb:
		case 0xc:
		case 0xe:
		case 0x14:
		case 0x16:
		case 0x17:
		case 0x18:
		case 0x1f:
		case 0x22:
		case 0x24:
		case 0x29:
		case 0x2a:
		case 0x2b:
		case 0x2c:
		case 0x2e:
		case 0x2f:
		case 0x31:
		case 0x32:
		case 0x3a:
		case 0x3b:
		case 0x43:
		case 0x44:
			return 5;
		}
	}
	return 3;
}



undefined4 __cdecl FUN_0041e8c0(int param_1,int param_2)
{
	uint uVar1;
	
	uVar1 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
	if ((uVar1 & 4) != 0) {
		return (&DAT_004ded34)[param_2 + param_1 * 0xf];
	}
	return 1;
}



void __cdecl FUN_0041e900(uint param_1,uint param_2,uint param_3,uint param_4,float param_5)
{
	FLOAT_004dece0 = (float)(ulonglong)param_3;
	FLOAT_004dece4 = (float)(ulonglong)param_4;
	FLOAT_004dece8 = (float)(ulonglong)param_1;
	FLOAT_004decec = (float)(ulonglong)param_2;
	FLOAT_004decf0 = param_5 * 0.04;
	return;
}



void __cdecl FUN_0041e980_internal(int param_1,Point2I *position)
{
	if (((FLAGS_004df1f8 & 0x80) == 0) || (INT_004deccc != param_1)) {
		FLAGS_004df1f8 = FLAGS_004df1f8 & 0xffffff7f | 0x100;
		lego::snd::Snd_Play_FUN_00465260(0x16,0);
	}
	else {
		INT_004deccc = param_1;
		if (position == NULL) {
			DAT_004decfc = param_1;
			return;
		}
		Point2I_004decc4.x = position->x;
		Point2I_004decc4.y = position->y;
	}
	if (position != NULL) {
		Point2I_004decf4.x = position->x;
		Point2I_004decf4.y = position->y;
	}
	DAT_004decfc = param_1;
	return;
}



void __cdecl FUN_0041e9f0(float param_1)
{
	if ((FLAGS_004df1f8 & 0x80) == 0) {
		if ((FLAGS_004df1f8 & 0x100) == 0) {
			if ((FLAGS_004df1f8 & 4) != 0) {
				FLOAT_004decd0 = FLOAT_004decd0 - param_1 * FLOAT_004decf0;
				if ((ushort)((ushort)(FLOAT_004decd0 < FLOAT_004dece8) << 8 |
										(ushort)(FLOAT_004decd0 == FLOAT_004dece8) << 0xe) != 0) {
					FLAGS_004df1f8 |= 0x80;
					FLOAT_004decd0 = FLOAT_004dece8;
				}
			}
		}
		else {
			FLOAT_004decd0 = param_1 * FLOAT_004decf0 + FLOAT_004decd0;
			if ((INT_004deccc == 0x16) && ((DAT_005012bc & 2) != 0)) {
				FUN_0045adc0(8);
				FUN_0045aeb0(6,1,0);
				FLOAT_004decd0 = FLOAT_004dece0;
			}
			if (FLOAT_004dece0 <= FLOAT_004decd0) {
				FLAGS_004df1f8 &= 0xfffffeff;
				FLOAT_004decd0 = FLOAT_004dece0;
				lego::snd::Snd_Play_FUN_00465260(0x15,0);
				if (DAT_004decfc == 0x16) {
					FLAGS_004df1f8 = FLAGS_004df1f8 & 0xfffffffb | 0x80;
					FUN_0045adc0(8);
					FUN_0045b8d0();
					DAT_00501860 |= 2;
				}
				else {
					if (DAT_004decfc == 0x17) {
						FLAGS_004df1f8 = FLAGS_004df1f8 & 0xfffffffb | 0x80;
						FUN_0045adc0(0xb);
						lego::globals::g_Game.flags3 |= GAME3_UNK_1;
						FUN_0040e710();
					}
					else {
						FLAGS_004df1f8 |= 4;
					}
				}
				Point2I_004decc4.x = Point2I_004decf4.x;
				Point2I_004decc4.y = Point2I_004decf4.y;
				INT_004deccc = DAT_004decfc;
				return;
			}
		}
	}
	return;
}



void __cdecl FUN_0041eb60(int param_1,int param_2)
{
	ObjectType *pOVar1;
	int iVar2;
	uint uVar3;
	int iVar4;
	longlong lVar5;
	float *in_stack_0000000c;
	char *format;
	
	iVar4 = 0;
	if (lego::globals::g_Game.objTeleportQueue_COUNT != 0) {
		pOVar1 = lego::globals::g_Game.objTeleportQueueTypes_TABLE;
		uVar3 = lego::globals::g_Game.objTeleportQueue_COUNT;
		do {
			if ((*pOVar1 == param_1) && (pOVar1[0x14] == param_2)) {
				iVar4 += 1;
			}
			pOVar1 = pOVar1 + 1;
			uVar3 -= 1;
		} while (uVar3 != 0);
	}
	if (iVar4 != 0) {
		format = "%i";
		lVar5 = __ftol((float10)in_stack_0000000c[1]);
		iVar2 = (int)lVar5 + 3;
		lVar5 = __ftol((float10)*in_stack_0000000c);
		FUN_0047a440(DAT_004ddd58,(int)lVar5 + 3,iVar2,format,iVar4);
	}
	return;
}



void __cdecl FUN_0041ebd0(float param_1,float param_2)
{
	BOOL BVar1;
	ImageBMP *bitmap;
	int iVar2;
	uint uVar3;
	longlong lVar4;
	char *format;
	char *pcVar5;
	int local_10;
	uint local_c;
	float local_8;
	float local_4;
	
	if ((UINT_004a3b5c != DAT_004decd8) || (DAT_004ddd50 != DAT_004decdc)) {
		FUN_0041ed90();
		UINT_004a3b5c = DAT_004decd8;
		DAT_004ddd50 = DAT_004decdc;
	}
	if (((FLAGS_004df1f8 & 0x800) != 0) &&
		 (FUN_0040aec0(DAT_004decd8,DAT_004decdc,0,&local_10,&local_c), local_c != 0)) {
		local_8 = param_1 - 15.0;
		uVar3 = 0;
		local_4 = param_2;
		if (local_c != 0) {
			do {
				if (uVar3 == 0) {
					if (lego::globals::g_InterfaceDependencies_Minus_bmp == NULL) {
LAB_0041ecb4:
						local_8 = local_8 - 20.0;
					}
					else {
						local_8 = local_8 - (float)lego::globals::g_InterfaceDependencies_Minus_bmp->width;
						lego::image::Image_Blt__0047df70
											(lego::globals::g_InterfaceDependencies_Minus_bmp,NULL,&local_8,NULL);
					}
				}
				else {
					if (lego::globals::g_InterfaceDependencies_Plus_bmp == NULL) goto LAB_0041ecb4;
					local_8 = local_8 - (float)lego::globals::g_InterfaceDependencies_Plus_bmp->width;
					lego::image::Image_Blt__0047df70
										(lego::globals::g_InterfaceDependencies_Plus_bmp,NULL,&local_8,NULL);
				}
				iVar2 = uVar3 * 0x10;
				BVar1 = FUN_00437a70(FUN_0040ae70,(LiveObject *)(local_10 + iVar2));
				bitmap = (ImageBMP *)
								 FUN_0041cac0(*(undefined4 *)(local_10 + iVar2),*(int *)(local_10 + 4 + iVar2),
															(uint)(BVar1 != 0));
				if (bitmap == NULL) {
					local_8 = local_8 - 40.0;
				}
				else {
					local_8 = local_8 - (float)bitmap->width;
					lego::image::Image_Blt__0047df70(bitmap,NULL,&local_8,NULL);
					if ((*(int *)(local_10 + 0xc + iVar2) != 0) &&
						 (iVar2 = *(int *)(local_10 + 8 + iVar2), iVar2 != 0)) {
						pcVar5 = lego::globals::g_Game.UpgradeNames_TABLE[iVar2];
						format = "%s";
						lVar4 = __ftol((float10)local_4);
						iVar2 = (int)lVar4 + 3;
						lVar4 = __ftol((float10)local_8);
						FUN_0047a440(DAT_004ddd58,(int)lVar4 + 3,iVar2,format,pcVar5);
					}
				}
				uVar3 += 1;
			} while (uVar3 < local_c);
		}
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void FUN_0041ed90(void)
{
	_DAT_004df1ec = 0x41c80000;
	FLAGS_004df1f8 = FLAGS_004df1f8 & 0xfffff7ff;
	return;
}



undefined4 __cdecl
FUN_0041edb0(uint param_1,uint param_2,float param_3,float param_4,undefined4 *param_5,
						undefined4 *param_6,undefined4 *param_7)
{
	float fVar1;
	float fVar2;
	ImageBMP *pIVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	uint local_40;
	int local_3c;
	float local_38;
	undefined4 uStack52;
	uint local_30;
	undefined4 uStack44;
	uint local_28;
	undefined4 uStack36;
	uint local_20;
	undefined4 uStack28;
	uint local_18;
	undefined4 uStack20;
	uint local_10;
	undefined4 uStack12;
	uint local_8;
	undefined4 uStack4;
	
	if (((FLAGS_004df1f8 & 0x800) != 0) &&
		 (FUN_0040aec0(DAT_004decd8,DAT_004decdc,0,&local_3c,&local_40), local_40 != 0)) {
		local_38 = param_3 - 15.0;
		fVar2 = (float)(ulonglong)param_1;
		if ((local_38 <= fVar2) &&
			 ((((ushort)((ushort)(fVar2 < local_38 - -15.0) << 8 |
									(ushort)(fVar2 == local_38 - -15.0) << 0xe) != 0 &&
				 (fVar1 = (float)(ulonglong)param_2, param_4 <= fVar1)) &&
				((ushort)((ushort)(fVar1 < param_4 - -40.0) << 8 | (ushort)(fVar1 == param_4 - -40.0) << 0xe
								 ) != 0)))) {
			*param_5 = 0x14;
			return 1;
		}
		uStack52 = 0;
		uVar6 = 0;
		if (local_40 != 0) {
			do {
				pIVar3 = lego::globals::g_InterfaceDependencies_Minus_bmp;
				if (uVar6 != 0) {
					pIVar3 = lego::globals::g_InterfaceDependencies_Plus_bmp;
				}
				if (pIVar3 == NULL) {
					local_30 = 0x14;
					uVar5 = 0x28;
				}
				else {
					local_30 = pIVar3->width;
					uVar5 = pIVar3->height;
				}
				uStack44 = 0;
				local_38 = local_38 - (float)(ulonglong)local_30;
				if ((local_38 <= fVar2) &&
					 (fVar1 = local_38 + (float)(ulonglong)local_30,
					 (ushort)((ushort)(fVar2 < fVar1) << 8 | (ushort)(fVar2 == fVar1) << 0xe) != 0)) {
					local_28 = param_2;
					uStack36 = 0;
					fVar1 = (float)(ulonglong)param_2;
					if ((param_4 <= fVar1) &&
						 (uStack28 = 0, local_20 = uVar5,
						 (ushort)((ushort)(fVar1 < (float)(ulonglong)uVar5 + param_4) << 8 |
										 (ushort)(fVar1 == (float)(ulonglong)uVar5 + param_4) << 0xe) != 0)) {
						*param_5 = 0x14;
						return 1;
					}
				}
				iVar4 = FUN_0041cac0(*(undefined4 *)(uVar6 * 0x10 + local_3c),
														 *(int *)(uVar6 * 0x10 + 4 + local_3c),0);
				if (iVar4 == 0) {
					local_18 = 0x28;
					uVar5 = 0x28;
				}
				else {
					local_18 = *(uint *)(iVar4 + 4);
					uVar5 = *(uint *)(iVar4 + 8);
				}
				uStack20 = 0;
				local_38 = local_38 - (float)(ulonglong)local_18;
				if ((local_38 <= fVar2) &&
					 (fVar1 = local_38 + (float)(ulonglong)local_18,
					 (ushort)((ushort)(fVar2 < fVar1) << 8 | (ushort)(fVar2 == fVar1) << 0xe) != 0)) {
					local_10 = param_2;
					uStack12 = 0;
					fVar1 = (float)(ulonglong)param_2;
					if ((param_4 <= fVar1) &&
						 (uStack4 = 0, local_8 = uVar5,
						 (ushort)((ushort)(fVar1 < (float)(ulonglong)uVar5 + param_4) << 8 |
										 (ushort)(fVar1 == (float)(ulonglong)uVar5 + param_4) << 0xe) != 0)) {
						iVar4 = uVar6 * 0x10 + local_3c;
						*param_5 = *(undefined4 *)(uVar6 * 0x10 + local_3c);
						*param_6 = *(undefined4 *)(iVar4 + 4);
						*param_7 = *(undefined4 *)(iVar4 + 8);
						return 1;
					}
				}
				uVar6 += 1;
				if (local_40 <= uVar6) {
					return 0;
				}
			} while( true );
		}
	}
	return 0;
}



BOOL __cdecl FUN_0041f030(ObjectType objType,int objIndex)
{
	ObjectStatsFlags2 OVar1;
	BOOL BVar2;
	ObjectType local_18;
	int local_14;
	char *local_10;
	VehicleData *local_c;
	CreatureData *local_8;
	CreatureData *local_4;
	
	local_14 = 0;
	local_10 = NULL;
	local_18 = OBJECT_NONE;
	local_c = NULL;
	local_8 = NULL;
	local_4 = NULL;
	OVar1 = lego::game::Object_GetStatsFlags2(objType,objIndex);
	if ((OVar1 & STATS2_USESMALLTELEPORTER) == STATS2_NONE) {
		if ((OVar1 & STATS2_USEBIGTELEPORTER) == STATS2_NONE) {
			if ((OVar1 & STATS2_USEWATERTELEPORTER) == STATS2_NONE) {
				if ((OVar1 & STATS2_USELEGOMANTELEPORTER) == STATS2_NONE) {
					return 1;
				}
				local_10 = (char *)0x80000000;
			}
			else {
				local_10 = (char *)0x40;
			}
		}
		else {
			local_10 = &DAT_00000020;
		}
	}
	else {
		local_10 = &DAT_00000010;
	}
	BVar2 = FUN_00437a70(FUN_0041f0c0,(LiveObject *)&local_18);
	return BVar2;
}



BOOL __cdecl FUN_0041f0c0(LiveObject *param_1,ObjectType *param_2)
{
	BOOL BVar1;
	ObjectStatsFlags1 OVar2;
	ObjectStatsFlags2 OVar3;
	
	if ((param_1->objType == OBJECT_BUILDING) && (BVar1 = FUN_00438870(param_1,0), BVar1 == 0)) {
		return 0;
	}
	if ((param_2[5] & 1) != 0) {
		if (param_1->objType != *param_2) {
			return 0;
		}
		if (param_1->objIndex != param_2[1]) {
			return 0;
		}
	}
	if (((param_2[5] & 2) != 0) && ((param_2[4] & param_1->flags5_3f0) == 0)) {
		return 0;
	}
	if ((param_2[2] != OBJECT_NONE) &&
		 (OVar2 = lego::game::LiveObject_GetStatsFlags1(param_1), (param_2[2] & OVar2) == STATS1_NONE))
	{
		return 0;
	}
	if ((param_2[3] != OBJECT_NONE) &&
		 (OVar3 = lego::game::LiveObject_GetStatsFlags2(param_1), (param_2[3] & OVar3) == STATS2_NONE))
	{
		return 0;
	}
	return 1;
}



void FUN_0041f160(void)
{
	ObjectType local_18;
	int local_14;
	char *local_10;
	VehicleData *local_c;
	CreatureData *local_8;
	CreatureData *local_4;
	
	local_14 = 0;
	local_10 = NULL;
	local_18 = OBJECT_NONE;
	local_8 = NULL;
	local_c = (VehicleData *)0x2;
	local_4 = NULL;
	FUN_00437a70(FUN_0041f0c0,(LiveObject *)&local_18);
	return;
}



void __cdecl FUN_0041f1a0(VehicleData *param_1)
{
	ObjectType local_18;
	int local_14;
	char *local_10;
	VehicleData *local_c;
	CreatureData *local_8;
	CreatureData *local_4;
	
	local_14 = 0;
	local_10 = NULL;
	local_8 = NULL;
	local_18 = OBJECT_NONE;
	local_4 = NULL;
	local_c = param_1;
	FUN_00437a70(FUN_0041f0c0,(LiveObject *)&local_18);
	return;
}



void FUN_0041f1e0(void)
{
	ObjectType local_18;
	int local_14;
	char *local_10;
	VehicleData *local_c;
	CreatureData *local_8;
	CreatureData *local_4;
	
	local_14 = 0;
	local_c = NULL;
	local_18 = OBJECT_NONE;
	local_8 = NULL;
	local_10 = (char *)0x100000;
	local_4 = NULL;
	FUN_00437a70(FUN_0041f0c0,(LiveObject *)&local_18);
	return;
}



void __cdecl FUN_0041f220(ObjectType param_1,int param_2)
{
	ObjectType local_18;
	int local_14;
	char *local_10;
	VehicleData *local_c;
	CreatureData *local_8;
	CreatureData *local_4;
	
	local_10 = NULL;
	local_c = NULL;
	local_8 = NULL;
	local_4 = (CreatureData *)0x1;
	local_18 = param_1;
	local_14 = param_2;
	FUN_00437a70(FUN_0041f0c0,(LiveObject *)&local_18);
	return;
}



void __cdecl FUN_0041f270(CreatureData *param_1)
{
	ObjectType local_18;
	int local_14;
	char *local_10;
	VehicleData *local_c;
	CreatureData *local_8;
	CreatureData *local_4;
	
	local_14 = 0;
	local_10 = NULL;
	local_c = NULL;
	local_4 = (CreatureData *)0x2;
	local_18 = OBJECT_NONE;
	local_8 = param_1;
	FUN_00437a70(FUN_0041f0c0,(LiveObject *)&local_18);
	return;
}



void __cdecl FUN_0041f2f0(LiveObject *param_1)
{
	FUN_00437a70((LiveObjectPredicate *)&LAB_0041f2c0,param_1);
	return;
}



void __cdecl FUN_0041f330(LiveObject *param_1)
{
	FUN_00437a70((LiveObjectPredicate *)&LAB_0041f310,param_1);
	return;
}



undefined4 __cdecl FUN_0041f350(undefined *param_1,undefined4 param_2)
{
	uint uVar1;
	LiveObject **ppLVar2;
	int iVar3;
	uint uVar4;
	
	uVar1 = lego::game::Game_GetNumSelectedUnits();
	ppLVar2 = lego::game::Game_GetSelectedUnits();
	uVar4 = 0;
	if (uVar1 == 0) {
		return 0;
	}
	do {
		iVar3 = (*(code *)param_1)(*ppLVar2,param_2);
		if (iVar3 != 0) {
			return 1;
		}
		uVar4 += 1;
		ppLVar2 = ppLVar2 + 1;
	} while (uVar4 < uVar1);
	return 0;
}



undefined4 __cdecl FUN_0041f520(int param_1)
{
	*(undefined4 *)(param_1 + 0x340) = 0xbf800000;
	*(uint *)(param_1 + 0x3ec) = *(uint *)(param_1 + 0x3ec) | 8;
	return 0;
}



undefined4 __cdecl FUN_0041f540(uint *param_1)
{
	if ((float)param_1[0xd1] < 100.0) {
		FUN_00449d30((LiveObject *)param_1);
	}
	return 0;
}



undefined4 __cdecl FUN_0041f570(int param_1)
{
	if (*(float *)(param_1 + 0x340) < 100.0) {
		FUN_00402e60((LiveObject *)param_1,0);
	}
	return 0;
}



undefined4 __cdecl FUN_0041f5c0(int param_1,int param_2)
{
	BOOL BVar1;
	
	BVar1 = lego::game::LiveObject_HasToolEquipped((LiveObject *)param_1,param_2);
	if (BVar1 == 0) {
		FUN_004030c0(param_2);
	}
	return 0;
}



undefined4 __cdecl FUN_0041f5f0(int *param_1)
{
	ObjectStatsFlags3 OVar1;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags3((LiveObject *)param_1);
	if ((OVar1 & STATS3_CARRYVEHICLES) == STATS3_NONE) {
		if (((param_1[0xf8] & 0x400U) == 0) || (*(int *)param_1[0xc2] != 9)) {
			FUN_0043a130((LiveObject *)param_1,0);
		}
	}
	else {
		if (((param_1[0xf8] & 0x400U) != 0) && ((uint *)param_1[0xc2] != NULL)) {
			FUN_0043fee0((uint *)param_1[0xc2]);
			return 0;
		}
	}
	return 0;
}



uint __cdecl FUN_0041f650(uint param_1)
{
	LiveObject *pLVar1;
	
	pLVar1 = lego::game::Game_GetPrimarySelectedObject();
	return (uint)((pLVar1->flags5_3f0 & param_1) != 0);
}



undefined4 __cdecl FUN_0041f670(int *param_1)
{
	BOOL BVar1;
	uint uVar2;
	int iVar3;
	int *piVar4;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_20[4] = 0xffffffff;
	local_4 = 0xffffffff;
	uVar2 = 0;
	local_20[0] = 1;
	local_20[1] = 0;
	local_20[2] = 0;
	local_20[3] = 1;
	local_c = 0;
	local_8 = 0;
	BVar1 = lego::game::Level_GetBlockFlags1_c0(*param_1,param_1[1]);
	if (BVar1 == 0) {
		piVar4 = local_20;
		do {
			BVar1 = FUN_004329d0(*param_1 + *piVar4,piVar4[1] + param_1[1],1);
			if (BVar1 != 0) {
				return 0;
			}
			uVar2 += 1;
			piVar4 = piVar4 + 2;
		} while (uVar2 < 4);
		return 1;
	}
	uVar2 = 0;
	piVar4 = local_20;
	iVar3 = 4;
	do {
		BVar1 = FUN_004329d0(*param_1 + *piVar4,piVar4[1] + param_1[1],1);
		if (BVar1 != 0) {
			uVar2 += 1;
		}
		piVar4 = piVar4 + 2;
		iVar3 += -1;
	} while (iVar3 != 0);
	if (1 < uVar2) {
		return 0;
	}
	return 1;
}



bool __cdecl FUN_0041f750(int param_1,int param_2)
{
	BOOL BVar1;
	
	BVar1 = lego::game::LiveObject_HasToolEquipped((LiveObject *)param_1,param_2);
	return BVar1 != 0;
}



undefined4 __cdecl FUN_0041f770(undefined4 *param_1)
{
	BOOL BVar1;
	
	BVar1 = lego::game::LiveObject_HasToolEquipped((LiveObject *)param_1,TOOL_SONICBLASTER);
	if (BVar1 != 0) {
		FUN_00448c60(param_1);
	}
	return 0;
}



void __cdecl lego::game::Level_IncField8c(void)
{
	if (globals::g_Game.level != NULL) {
		(globals::g_Game.level)->numCrystals = (globals::g_Game.level)->numCrystals + 1;
	}
	return;
}



void __cdecl lego::game::Level_SubtractCrystals(int crystalCount)
{
	if (globals::g_Game.level != NULL) {
		(globals::g_Game.level)->numCrystals = (globals::g_Game.level)->numCrystals - crystalCount;
	}
	return;
}



void __cdecl FUN_0041f7d0(int param_1)
{
	if (lego::globals::g_Game.level != NULL) {
		(lego::globals::g_Game.level)->numDrainedCrystals =
				 (lego::globals::g_Game.level)->numDrainedCrystals + param_1;
	}
	return;
}



int __cdecl lego::game::Level_GetCrystalCount(BOOL includeDrained)
{
	int in_EAX;
	
	if ((globals::g_Game.level != NULL) &&
		 (in_EAX = (globals::g_Game.level)->numCrystals, includeDrained == 0)) {
		in_EAX -= (globals::g_Game.level)->numDrainedCrystals;
	}
	return in_EAX;
}



int __cdecl lego::game::Level_GetOreCount(BOOL isProcessed)
{
	LevelData *pLVar1;
	
	pLVar1 = globals::g_Game.level;
	if (globals::g_Game.level != NULL) {
		if (isProcessed != 0) {
			return (int)(LevelData *)(globals::g_Game.level)->numProcessedOre;
		}
		pLVar1 = (LevelData *)(globals::g_Game.level)->numOre;
	}
	return (int)pLVar1;
}



void __cdecl FUN_0041f850(int param_1)
{
	if (lego::globals::g_Game.level != NULL) {
		(lego::globals::g_Game.level)->field_9c = (lego::globals::g_Game.level)->field_9c + param_1;
	}
	return;
}



void __cdecl lego::game::Game_SetFlag1_20000(BOOL state)
{
	if (state != 0) {
		globals::g_Game.flags1 = globals::g_Game.flags1 | GAME1_UNK_20000;
		return;
	}
	globals::g_Game.flags1 = globals::g_Game.flags1 & ~GAME1_UNK_20000;
	return;
}



BOOL __cdecl lego::game::Game_IsNoclipOn(void)
{
	return globals::g_Game.flags1 & GAME1_DEBUG_NOCLIP_FPS;
}



void __cdecl FUN_0041f8b0(void)
{
	if (lego::globals::g_Game.level != NULL) {
		(lego::globals::g_Game.level)->field_94 = (lego::globals::g_Game.level)->field_94 + 1;
	}
	return;
}



void __cdecl FUN_0041f8c0(void)
{
	if (lego::globals::g_Game.level != NULL) {
		(lego::globals::g_Game.level)->field_a8 = (lego::globals::g_Game.level)->field_a8 + 1;
	}
	return;
}



void __cdecl FUN_0041f8d0(BOOL param_1)
{
	if (lego::globals::g_Game.level != NULL) {
		if (param_1 == 0) {
			(lego::globals::g_Game.level)->numOre = (lego::globals::g_Game.level)->numOre + 1;
		}
		else {
			(lego::globals::g_Game.level)->numProcessedOre =
					 (lego::globals::g_Game.level)->numProcessedOre + 1;
		}
	}
	if (param_1 != 0) {
		FUN_0045c840(1,5);
		return;
	}
	FUN_0045c840(1,1);
	return;
}



void __cdecl lego::game::Level_SubtractOre(BOOL isProcessed,int oreCount)
{
	if (globals::g_Game.level != NULL) {
		if (isProcessed == 0) {
			(globals::g_Game.level)->numOre = (globals::g_Game.level)->numOre - oreCount;
		}
		else {
			(globals::g_Game.level)->numProcessedOre = (globals::g_Game.level)->numProcessedOre - oreCount
			;
		}
	}
	if (isProcessed != 0) {
		FUN_0045c840(0,5);
		return;
	}
	FUN_0045c840(0,oreCount);
	return;
}



BOOL __cdecl lego::main::Main_InitGameFunctions(LPCSTR gameName)
{
	BOOL BVar1;
	int iVar2;
	GameManager *pGVar3;
	GameFunctions gameFuncs;
	
	pGVar3 = &globals::g_Game;
	for (iVar2 = 0x3be; iVar2 != 0; iVar2 += -1) {
		pGVar3->LegoCfgRoot = NULL;
		pGVar3 = (GameManager *)&pGVar3->CfgRootName;
	}
	globals::g_Game.CfgRootName = gameName;
	wnd::Win_SetMainWindowTitle(gameName);
	gameFuncs.Init = Main_loadLegoCFG;
	gameFuncs.Update = Main_GameUpdate;
	gameFuncs.Cleanup = Main_GameCleanup;
	if (globals::g_PROGRAMMER_MODE != PROGRAMMER_MODE_10) {
		gameFuncs.Cleanup = Game_Exit;
	}
	BVar1 = Main_SetGameFunctions(&gameFuncs);
	return BVar1;
}



void __cdecl FUN_0041f9b0(void)
{
	lego::game::GetLevel();
	if ((lego::globals::g_Game.flags1 & GAME1_UNK_8000000) == GAME1_NONE) {
		UINT_00556118 = lego::game::Game_GetPilotPreviousLevel("Pilot",0);
		lego::globals::g_Game.flags1 |= GAME1_UNK_8000000;
		lego::unk::Lego_SetBool_004b9a54(1);
		FUN_0044b080(1);
		FUN_0046a7d0(1,1,1);
		FUN_0046a7d0(2,1,1);
		FUN_0046a7d0(8,1,1);
		FUN_0046a7d0(0x400,1,1);
		FUN_00425b60(0,0);
		FUN_0041e680();
		if (((byte)DAT_0050113c & 2) != 0) {
			FUN_0045adc0(0);
			FUN_0045adc0(1);
		}
	}
	return;
}



float10 __cdecl lego::game::Game_GetGameSpeed(void)
{
	return (float10)globals::g_Game.gameSpeed;
}



/// WATCHOUT:!! This function cannot be exported by Ghidra "automatically"..., see for yourself below:
/*
Unable to decompile 'Main_loadLegoCFG'
Cause: Exception while decompiling 0041fa80: process: timeout
*/
/// NOW: let's manually place the function in after decompiling for 2+ minutes :D

/* WARNING: Type propagation algorithm not settling */

BOOL __cdecl lego::main::Main_loadLegoCFG(void)
{
	char *pcVar1;
	BOOL BVar2;
	int iVar3;
	int iVar4;
	char *pcVar5;
	ProgrammerMode PVar6;
	char *pcVar7;
	byte *input;
	uint uVar8;
	CFGProperty *prop;
	uint screenWidth;
	float10 fVar9;
	float10 fVar10;
	float10 fVar11;
	int iVar12;
	float *out_r;
	float fVar13;
	ColourRGBF *pCVar14;
	float *pfVar15;
	float fVar16;
	float *pfVar17;
	float fVar18;
	char *MinEnergyForEat_str;
	char *HighPolyRange_str;
	char *MedPolyRange_str;
	char *ReinforceHits_str;
	char *DrainTime_str;
	char *MiniFigureRunAway_str;
	char *HPBlocks_str;
	char *CDTracks_str;
	char *CDStartTrack_str;
	char *BirdScarerRadius_str;
	char *DynamiteWakeRadius_str;
	char *DynamiteMaxDamage_str;
	char *DynamiteDamageRadius_str;
	char *tvclipdist_str;
	char *maxdist_str;
	char *mindist_str;
	char *MouseScrollBorder_str;
	char *MaxReturnedCrystals_str;
	char *RollOffFor3DSounds_str;
	char *MaxDistFor3DSounds_str;
	char *MinDistFor3DSoundsOnTopView_str;
	char *MouseScrollIndent_str;
	char *CameraAcceleration_str;
	char *CameraDropOff_str;
	char *CameraSpeed_str;
	char *LoaderProfile_filename;
	char *TextPauseTime_str;
	char *TextureUsage_str;
	char *BuildingUpgradeCostStuds_str;
	char *BuildingUpgradeCostOre_str;
	char *startLevelName;
	Point2F Dialog_center;
	char *Window_stringParts [4];
	int Window_numParts;
	Rect2F Window_rect;
	CFGProperty *Pointers_cfgProp;
	float CameraDropOff;
	float CameraSpeed;
	float MaxDistFor3DSounds;
	float RollOffFor3DSounds;
	int MouseScrollIndent;
	float CameraAcceleration;
	float MinDistFor3DSoundsOnTopView;
	char *Button_lpstr;
	char *Button_stringParts [10];
	char Button_buffer [128];
	char *Button_filename;
	char *SharedSizes_str;
	char *LoadScreen;
	char *ProgressBar;
	char *ProgressWindow;
	char *LoadingText;
	char *ShutdownScreen;
	Direction ProgressBar_direction;
	Rect2F ProgressWindow_rect;
	char *ProgressWindow_stringParts [10];
	char *StartMessage;
	char *Version;
	Rect2F MsgPanel_rect1;
	Rect2F MsgPanel_rect2;
	float local_5c;
	Rect2F fontRender84_rect;
	Rect2F fontRender80_rect;
	uint TextureUsage;
	uint videoMemFree;
	uint videoMemTotal;
	char *RenameReplace_ptr;
	float ToolTipRGB_g;
	float ToolTipRGB_r;
	float ToolTipRGB_b;
	float maxdist;
	float mindist;
	CFGProperty *legoCfgRoot;
	uint surfaceIdx_unused;
	float maxtilt;
	float mintilt;
	
	globals::g_Game.DragBoxRGB.red = 0.2;
	globals::g_Game.DragBoxRGB.green = 0.7;
	globals::g_Game.DragBoxRGB.blue = 1.0;
	globals::g_Game.SurfaceTypes_TABLE[0] = "Lego_SurfaceType_Tunnel";
	globals::g_Game.SurfaceTypes_TABLE[1] = "Lego_SurfaceType_Immovable";
	globals::g_Game.SurfaceTypes_TABLE[2] = "Lego_SurfaceType_Hard";
	globals::g_Game.SurfaceTypes_TABLE[3] = "Lego_SurfaceType_Medium";
	globals::g_Game.SurfaceTypes_TABLE[4] = "Lego_SurfaceType_Loose";
	globals::g_Game.SurfaceTypes_TABLE[5] = "Lego_SurfaceType_Soil";
	globals::g_Game.SurfaceTypes_TABLE[6] = "Lego_SurfaceType_Lava";
	globals::g_Game.SurfaceTypes_TABLE[7] = "Lego_SurfaceType_Water";
	globals::g_Game.SurfaceTypes_TABLE[8] = "Lego_SurfaceType_OreSeam";
	globals::g_Game.SurfaceTypes_TABLE[9] = "Lego_SurfaceType_Lake";
	globals::g_Game.SurfaceTypes_TABLE[10] = "Lego_SurfaceType_CrystalSeam";
	globals::g_Game.SurfaceTypes_TABLE[11] = "Lego_SurfaceType_RechargeSeam";
	globals::g_Game.SurfaceTypes_TABLE[12] = "Lego_SurfaceType_Rubble";
	globals::g_Game.SurfaceTypes_TABLE[13] = "Lego_SurfaceType_Reinforcement";
	globals::g_Game.SurfaceTypes_TABLE[14] = "Lego_SurfaceType_Path";
	globals::g_Game.SurfaceTypes_TABLE[15] = "Lego_SurfaceType_SlugHole";
	globals::g_Game.SurfaceTypes_TABLE[16] = "Lego_SurfaceType_Undiscovered";
	globals::g_Game.SurfaceTypes_TABLE[17] = "Lego_SurfaceType_Cavern";
	for (surfaceIdx_unused = 0; surfaceIdx_unused < 0x12; surfaceIdx_unused += 1) {
	}
	game::Game_SetGameSpeed(1.0);
	lego::input::Input_Init_KeyNames();
	pool::ReservedPool<Struct_20>__Init();
	pool::ReservedPool<LiveObject>__Init();
	pool::ReservedPool<ImageBMP>__Init();
										/* No argument actually passed, just problem with variadic functions not
											 allowing zero args */
	other::logf_removed();
	Main_InitUnkVectorTables();
	Main_InitPanelButtons();
	pool::ReservedPool<AITask>__Init();
	Boot_InitTable_Message();
	Main_InitSmokeAnim_empty();
	Main_InitPointers();
	Main_Init_Bubble();
	globals::g_Game.bmpFONT5_HI = draw::Image_LoadFont("Interface\\Fonts\\FONT5_HI.bmp");
	globals::g_Game.bmpToolTipFont = draw::Image_LoadFont("Interface\\Fonts\\ToolTipFont.bmp");
	globals::g_Game.bmpDeskTopFont = draw::Image_LoadFont("Interface\\Fonts\\DeskTopFont.bmp");
	globals::g_Game.bmpfont5_HI = draw::Image_LoadFont("Interface\\Fonts\\font5_HI.bmp");
	globals::g_Game.bmpMbriefFONT = draw::Image_LoadFont("Interface\\Fonts\\MBriefFONT.bmp");
	globals::g_Game.bmpMbriefFONT2 = draw::Image_LoadFont("Interface\\Fonts\\MBriefFONT2.bmp");
	globals::g_Game.bmpRSFont = draw::Image_LoadFont("Interface\\Fonts\\RSFont.bmp");
	Main_Init_Info(globals::g_Game.bmpFONT5_HI);
	Main_InitInterfaceMenuItems(0x235,0x12,globals::g_Game.bmpToolTipFont);
	globals::g_Game.resRoot = pool::ReservedPool<ResourceData>__Init(globals::g_Game.CfgRootName);
	if (globals::g_Game.resRoot == NULL) {
		return 0;
	}
	res::Res_SetDrawCallback(res::Res_ResourceDrawCallback,NULL);
	globals::g_Game.LegoCfgRoot = cfg::CFG_Open("Lego.cfg");
	legoCfgRoot = globals::g_Game.LegoCfgRoot;
	if (globals::g_Game.LegoCfgRoot == NULL) goto LAB_0042274b;
	pfVar17 = &ToolTipRGB_b;
	pfVar15 = &ToolTipRGB_g;
	out_r = &ToolTipRGB_r;
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","ToolTipRGB",0);
	BVar2 = cfg::CFG_GetPropertyRGBF(legoCfgRoot,pcVar1,out_r,pfVar15,pfVar17);
	if (BVar2 == 0) {
		ToolTipRGB_b = 0.3254902;
		ToolTipRGB_g = 0.3254902;
		ToolTipRGB_r = 0.3254902;
	}
	iVar12 = 0x20;
	fVar13 = ToolTipRGB_r;
	fVar16 = ToolTipRGB_g;
	fVar18 = ToolTipRGB_b;
	iVar3 = Config_GetResolutionHeight();
	iVar4 = Config_GetResolutionWidth();
	Main_InitToolTips_AndBigStruct
						(globals::g_Game.bmpToolTipFont,2,1,1.0,iVar4,iVar3,iVar12,fVar13,fVar16,fVar18);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CreditsTextFile",0);
	globals::g_Game.CreditsTextFile = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CreditsBackAVI",0);
	globals::g_Game.CreditsBackAVI = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","BuildingUpgradeCostOre",0);
	pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	if (pcVar1 == NULL) {
		BuildingUpgradeCostOre_str = ""/*EMPTYSTR*/;
	}
	else {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","BuildingUpgradeCostOre",0);
		BuildingUpgradeCostOre_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	}
	globals::g_Game.BuildingUpgradeCostOre = std::atoi(BuildingUpgradeCostOre_str);
	if (globals::g_Game.BuildingUpgradeCostOre == 0) {
		globals::g_Game.BuildingUpgradeCostOre = 5;
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","BuildingUpgradeCostStuds",0);
	pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	if (pcVar1 == NULL) {
		BuildingUpgradeCostStuds_str = ""/*EMPTYSTR*/;
	}
	else {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","BuildingUpgradeCostStuds",0);
		BuildingUpgradeCostStuds_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	}
	globals::g_Game.BuildingUpgradeCostStuds = std::atoi(BuildingUpgradeCostStuds_str);
	if (globals::g_Game.BuildingUpgradeCostStuds == 0) {
		globals::g_Game.BuildingUpgradeCostStuds = 1;
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","RenameReplace",0);
	globals::g_Game.RenameReplace = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
	pcVar1 = globals::g_Game.RenameReplace;
	if (globals::g_Game.RenameReplace != NULL) {
		while (RenameReplace_ptr = pcVar1, *RenameReplace_ptr != '\0') {
			if (*RenameReplace_ptr == '_') {
				*RenameReplace_ptr = ' ';
			}
			pcVar1 = RenameReplace_ptr + 1;
		}
	}
	BVar2 = draw::Draw_GetAvailableVideoMemory(&videoMemTotal,&videoMemFree);
	if (BVar2 != 0) {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","TextureUsage",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			TextureUsage_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","TextureUsage",0);
			TextureUsage_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		TextureUsage = std::atoi(TextureUsage_str);
		if ((TextureUsage != 0) &&
			 (Main_CalculateTextureUsage(&TextureUsage), TextureUsage <= videoMemFree)) {
			Main_DisableTextureManagement_NonVoodoo2();
		}
	}
	fontRender80_rect.x = 55.0;
	fontRender80_rect.y = 435.0;
	fontRender80_rect.width = 325.0;
	fontRender80_rect.height = 42.0;
	globals::g_Game.struct830_80 =
			 unk::Lego_unkMakeDrawRegion__004853b0(globals::g_Game.bmpfont5_HI,&fontRender80_rect,0x400);
	fontRender84_rect.x = 55.0;
	fontRender84_rect.y = 435.0;
	fontRender84_rect.width = 260.0;
	fontRender84_rect.height = 42.0;
	globals::g_Game.struct830_84 =
			 unk::Lego_unkMakeDrawRegion__004853b0(globals::g_Game.bmpfont5_HI,&fontRender84_rect,0x400);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","TextPauseTime",0);
	pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	if (pcVar1 == NULL) {
		TextPauseTime_str = ""/*EMPTYSTR*/;
	}
	else {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","TextPauseTime",0);
		TextPauseTime_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	}
	fVar9 = std::atof(TextPauseTime_str);
	Main_InitTexts(globals::g_Game.struct830_80,globals::g_Game.struct830_84,0x13c,0x1a9,
								 (float)(fVar9 * (float10)25.0));
	MsgPanel_rect1.x = 55.0;
	MsgPanel_rect1.y = 435.0;
	MsgPanel_rect1.width = 325.0;
	MsgPanel_rect1.height = 42.0;
	MsgPanel_rect2.x = 55.0;
	MsgPanel_rect2.y = 363.0;
	MsgPanel_rect2.width = 325.0;
	MsgPanel_rect2.height = 140.0;
	Main_LoadMsgPanel("Interface\\MessagePanel\\MsgPanel.bmp",0x2a,0x199,0x152,&MsgPanel_rect1,
										&MsgPanel_rect2,20.0);
	if ((globals::g_CMDLINE_FLAGS & CMD_SHOWVERSION) != CMD_NONE) {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","StartMessage",0);
		pcVar1 = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
		pcVar5 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","Version",0);
		pcVar5 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar5);
		if (pcVar1 != NULL) {
			pcVar1 = util::stringReplaceChar(pcVar1,'_',' ');
			if (pcVar5 == NULL) {
				game::Game_DisplayInfoMessage(globals::g_Game.struct830_80,"\n%s",pcVar1);
			}
			else {
				game::Game_DisplayInfoMessage(globals::g_Game.struct830_80,"\n%s (%s)",pcVar1,pcVar5);
			}
			util::free2(pcVar1);
		}
	}
	BVar2 = Config_IsFrontEndEnabled();
	if ((BVar2 != 0) && (BVar2 = Config_IsIntrosEnabled(), BVar2 != 0)) {
		PVar6 = Config_GetProgrammerMode();
		Boot_PlayIntroAVI("LegoAvi",(uint)(PVar6 != PROGRAMMER_OFF));
		Boot_PlayIntroImage("DDILogo",TRUE,"DDILogoTime");
		Boot_PlayIntroAVI("DDIAvi",TRUE);
		Boot_PlayIntroAVI("RRAvi",TRUE);
		pcVar1 = "LMILogoTime";
		PVar6 = Config_GetProgrammerMode();
		Boot_PlayIntroImage("LMILogo",(uint)(PVar6 != PROGRAMMER_OFF),pcVar1);
	}
	Main_Alloc_SFXNames_HashTable();
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","ProgressBar",0);
	ProgressBar = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","LoadScreen",0);
	pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	pcVar5 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","ShutdownScreen",0);
	pcVar5 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar5);
	pcVar7 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","ProgressWindow",0);
	input = (byte *)cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar7);
	pcVar7 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","LoadingText",0);
	pcVar7 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar7);
	if (input == NULL) {
		ProgressBar = NULL;
	}
	else {
		iVar3 = std::toupper((uint)*input);
		*input = (byte)iVar3;
		if (false) {
LAB_004203f0:
			ProgressBar_direction = 4;
		}
		else {
			switch(*input) {
			case 0x44:
				ProgressBar_direction = DIRECTION_DOWN;
				break;
			default:
				goto LAB_004203f0;
			case 0x4c:
				ProgressBar_direction = DIRECTION_LEFT;
				break;
			case 0x52:
				ProgressBar_direction = DIRECTION_RIGHT;
				break;
			case 0x55:
				ProgressBar_direction = DIRECTION_UP;
			}
		}
		iVar3 = util::stringSplit((char *)input,ProgressWindow_stringParts,",");
		if (((iVar3 == 4) && (input[1] == 0x3a)) && (ProgressBar_direction != 4)) {
			iVar3 = std::atoi(ProgressWindow_stringParts[0] + 2);
			ProgressWindow_rect.x = (float)iVar3;
			iVar3 = std::atoi(ProgressWindow_stringParts[1]);
			ProgressWindow_rect.y = (float)iVar3;
			iVar3 = std::atoi(ProgressWindow_stringParts[2]);
			ProgressWindow_rect.width = (float)iVar3;
			iVar3 = std::atoi(ProgressWindow_stringParts[3]);
			ProgressWindow_rect.height = (float)iVar3;
		}
	}
	util::free2(input);
	BVar2 = Main_IsSoundEnabled();
	if (BVar2 == 0) {
		LoaderProfile_filename = "LoaderProfileNoSound.txt";
	}
	else {
		LoaderProfile_filename = "LoaderProfile.txt";
	}
	Main_LoadLoadScreen(pcVar1,pcVar5,globals::g_Game.bmpFONT5_HI,LoaderProfile_filename,
											ProgressBar_direction,ProgressBar,&ProgressWindow_rect,pcVar7);
	LoaderProfile_Lookup("Game Data");
	globals::g_Game.structbc_24 = unk::Lego_AllocStruct_bc__00435a50(globals::g_Game.resRoot,1);
	if (((globals::g_Game.structbc_24 == NULL) ||
			(globals::g_Game.structbc_2c = unk::Lego_AllocStruct_bc__00435a50(globals::g_Game.resRoot,3),
			globals::g_Game.structbc_2c == NULL)) ||
		 ((globals::g_Game.structbc_28 = unk::Lego_AllocStruct_bc__00435a50(globals::g_Game.resRoot,2),
			globals::g_Game.structbc_28 == NULL ||
			((globals::g_Game.ptr_1c =
						 unk::Lego_AllocStruct20_ptr1c
											 (0.0,0.0,1.0,1.0,(globals::g_Game.structbc_24)->resData_24),
			 globals::g_Game.ptr_1c == NULL ||
			 (globals::g_Game.field_20 =
						 pool::ReservedPool<Struct_20>__Next
											 (0x10,0xd,0x97,0x97,(globals::g_Game.structbc_28)->resData_24),
			 globals::g_Game.field_20 == NULL)))))) goto LAB_0042274b;
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","StreamNERPSSpeach",0);
	uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
	if (uVar8 == 1) {
		globals::g_Game.flags1 |= GAME1_STREAMNERPSSPEACH;
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","ShowDebugToolTips",0);
	uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
	if ((uVar8 == 1) || (PVar6 = Config_GetProgrammerMode(), PVar6 != PROGRAMMER_OFF)) {
		globals::g_Game.flags2 |= GAME2_SHOWDEBUGTOOLTIPS;
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","AllowDebugKeys",0);
	uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
	if ((uVar8 == 1) || (PVar6 = Config_GetProgrammerMode(), PVar6 != PROGRAMMER_OFF)) {
		globals::g_Game.flags2 |= GAME2_ALLOWDEBUGKEYS;
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","AllowEditMode",0);
	uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
	if ((uVar8 == 1) || (PVar6 = Config_GetProgrammerMode(), PVar6 != PROGRAMMER_OFF)) {
		globals::g_Game.flags2 |= GAME2_ALLOWEDITMODE;
	}
	pfVar15 = &globals::g_Game.PowerCrystalRGB.blue;
	pfVar17 = &globals::g_Game.PowerCrystalRGB.green;
	pCVar14 = &globals::g_Game.PowerCrystalRGB;
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","PowerCrystalRGB",0);
	cfg::CFG_GetPropertyRGBF(legoCfgRoot,pcVar1,(float *)pCVar14,pfVar17,pfVar15);
	pfVar15 = &globals::g_Game.UnpoweredCrystalRGB.blue;
	pfVar17 = &globals::g_Game.UnpoweredCrystalRGB.green;
	pCVar14 = &globals::g_Game.UnpoweredCrystalRGB;
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","UnpoweredCrystalRGB",0);
	cfg::CFG_GetPropertyRGBF(legoCfgRoot,pcVar1,(float *)pCVar14,pfVar17,pfVar15);
	Boot_Load_Samples(legoCfgRoot,(uint)((globals::g_CMDLINE_FLAGS & CMD_REDUCESAMPLES) == CMD_NONE));
	Main_LoadSurfaceTypeDescriptions_sound(legoCfgRoot,globals::g_Game.CfgRootName);
	Main_LoadPrioritiesImagePositions(legoCfgRoot,globals::g_Game.CfgRootName);
	Main_LoadPriorityImages(legoCfgRoot,globals::g_Game.CfgRootName);
	Main_Load_ToolTipInfo(legoCfgRoot,globals::g_Game.CfgRootName);
	Main_LoadToolNames(legoCfgRoot,globals::g_Game.CfgRootName);
	Main_LoadPanelRotationControl(legoCfgRoot,globals::g_Game.CfgRootName);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","SharedObjects",0);
	pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	Main_SetSharedObjects(pcVar1,snd::Snd_GetSFX,snd::Snd_PlayOrInitSoundUnk,snd::Audio_GetFlag1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","SharedTextures",0);
	pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	if (pcVar1 != NULL) {
		res::Res_SetSharedTextures(pcVar1);
	}
	pool::ReservedPool<Struct_34>__Init(pcVar1);
	iVar3 = Config_GetResolutionHeight();
	iVar4 = Config_GetResolutionWidth();
	std::sprintf(Button_buffer,"NextButton%ix%i",iVar4,iVar3);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main",Button_buffer,0);
	pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	if ((pcVar1 != NULL) &&
		 (globals::g_Game.NextButton = image::Image_LoadBMP(pcVar1,0,0),
		 globals::g_Game.NextButton != NULL)) {
		image::Image_unkFogFromFloat__0047deb0(globals::g_Game.NextButton,0.0,0.0,0.0,0.0,0.0,0.0);
		iVar3 = Config_GetResolutionHeight();
		iVar4 = Config_GetResolutionWidth();
		std::sprintf(Button_buffer,"NextButtonPos%ix%i",iVar4,iVar3);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main",Button_buffer,0);
		pcVar1 = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 != NULL) {
			iVar3 = util::stringSplit(pcVar1,Button_stringParts,",");
			if (iVar3 == 2) {
				fVar9 = std::atof(Button_stringParts[0]);
				globals::g_Game.NextButtonPos.x = (float)fVar9;
				fVar9 = std::atof(Button_stringParts[1]);
				globals::g_Game.NextButtonPos.y = (float)fVar9;
			}
			util::free2(pcVar1);
		}
	}
	iVar3 = Config_GetResolutionHeight();
	iVar4 = Config_GetResolutionWidth();
	std::sprintf(Button_buffer,"BackButton%ix%i",iVar4,iVar3);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main",Button_buffer,0);
	pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	if ((pcVar1 != NULL) &&
		 (globals::g_Game.BackButton = image::Image_LoadBMP(pcVar1,0,0),
		 globals::g_Game.BackButton != NULL)) {
		image::Image_unkFogFromFloat__0047deb0(globals::g_Game.BackButton,0.0,0.0,0.0,0.0,0.0,0.0);
		iVar3 = Config_GetResolutionHeight();
		iVar4 = Config_GetResolutionWidth();
		std::sprintf(Button_buffer,"BackButtonPos%ix%i",iVar4,iVar3);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main",Button_buffer,0);
		pcVar1 = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 != NULL) {
			iVar3 = util::stringSplit(pcVar1,Button_stringParts,",");
			if (iVar3 == 2) {
				fVar9 = std::atof(Button_stringParts[0]);
				globals::g_Game.BackButtonPos.x = (float)fVar9;
				fVar9 = std::atof(Button_stringParts[1]);
				globals::g_Game.BackButtonPos.y = (float)fVar9;
			}
			util::free2(pcVar1);
		}
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","BackArrow",0);
	pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
	if ((pcVar1 != NULL) &&
		 (globals::g_Game.BackArrow = image::Image_LoadBMP(pcVar1,0,0),
		 globals::g_Game.BackArrow != NULL)) {
		image::Image_unkFogFromFloat__0047deb0(globals::g_Game.BackArrow,0.0,0.0,0.0,0.0,0.0,0.0);
	}
	unk::Lego_SetDatTo_004a773c___00453bc0((uint)(globals::g_Game.NextButton != NULL));
	BVar2 = Main_LoadLighting();
	if (((((BVar2 != 0) && (BVar2 = Main_Load_GraphicsSettings(), BVar2 != 0)) &&
			 (BVar2 = Boot_Load_UpgradeTypes(), BVar2 != 0)) &&
			((BVar2 = Boot_Load_VehicleTypes(), BVar2 != 0 &&
			 (BVar2 = Boot_Load_MiniFigureTypes(), BVar2 != 0)))) &&
		 ((BVar2 = Boot_Load_RockMonsterTypes(), BVar2 != 0 &&
			(BVar2 = Boot_Load_BuildingTypes(), BVar2 != 0)))) {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CameraSpeed",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			CameraSpeed_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CameraSpeed",0);
			CameraSpeed_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(CameraSpeed_str);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CameraDropOff",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			CameraDropOff_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CameraDropOff",0);
			CameraDropOff_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar10 = std::atof(CameraDropOff_str);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CameraAcceleration",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			CameraAcceleration_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CameraAcceleration",0);
			CameraAcceleration_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar11 = std::atof(CameraAcceleration_str);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MouseScrollIndent",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			MouseScrollIndent_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MouseScrollIndent",0);
			MouseScrollIndent_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		iVar3 = std::atoi(MouseScrollIndent_str);
		Main_SetCameraMovements((float)fVar9,(float)fVar10,(float)fVar11,iVar3);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MinDistFor3DSoundsOnTopView",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			MinDistFor3DSoundsOnTopView_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MinDistFor3DSoundsOnTopView",0)
			;
			MinDistFor3DSoundsOnTopView_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(MinDistFor3DSoundsOnTopView_str);
		globals::g_Game.MinDistFor3DSoundsOnTopView = (float)fVar9;
		if (fVar9 == (float10)0.0) {
			globals::g_Game.MinDistFor3DSoundsOnTopView = 150.0;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MaxDistFor3DSounds",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			MaxDistFor3DSounds_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MaxDistFor3DSounds",0);
			MaxDistFor3DSounds_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(MaxDistFor3DSounds_str);
		if (fVar9 != (float10)0.0) {
			Main_SetMaxDistFor3DSounds((float)fVar9);
		}
		Main_SetRollOffFor3DSounds(1.0);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","RollOffFor3DSounds",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			RollOffFor3DSounds_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","RollOffFor3DSounds",0);
			RollOffFor3DSounds_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(RollOffFor3DSounds_str);
		if (fVar9 != (float10)0.0) {
			Main_SetRollOffFor3DSounds((float)fVar9);
		}
		globals::g_Game.RES_2f4_TABLEUNK = (ResourceData **)FUN_004641c0(globals::g_Game.resRoot,5.0);
		FUN_004649e0(globals::g_Game.RES_2f4_TABLEUNK,1);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MaxReturnedCrystals",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			MaxReturnedCrystals_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MaxReturnedCrystals",0);
			MaxReturnedCrystals_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		globals::g_Game.MaxReturnedCrystals = std::atoi(MaxReturnedCrystals_str);
		if (globals::g_Game.MaxReturnedCrystals == 0) {
			globals::g_Game.MaxReturnedCrystals = 10;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MouseScrollBorder",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			MouseScrollBorder_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MouseScrollBorder",0);
			MouseScrollBorder_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		globals::g_Game.MouseScrollBorder = std::atoi(MouseScrollBorder_str);
		if (globals::g_Game.MouseScrollBorder == 0) {
			globals::g_Game.MouseScrollBorder = 5;
		}
		Main_Load_ObjectNames(legoCfgRoot);
		Main_Load_ObjectTheNames(legoCfgRoot);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","HelpWindowOn",0);
		uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
		if (uVar8 == 1) {
			Main_Font_SetDefault(globals::g_Game.bmpMbriefFONT2);
			Main_Load_HelpWindow(legoCfgRoot,globals::g_Game.CfgRootName);
		}
		Main_Load_ObjInfo(legoCfgRoot,globals::g_Game.CfgRootName);
		Main_Load_LightEffects(legoCfgRoot,globals::g_Game.CfgRootName);
		game::Game_ParseStats(legoCfgRoot,globals::g_Game.CfgRootName);
		Main_Load_Dependencies(legoCfgRoot,globals::g_Game.CfgRootName);
		Main_Load_Bubbles(legoCfgRoot);
		Main_Load_Encyclopedia(legoCfgRoot,globals::g_Game.CfgRootName);
		Main_LoadObjTtSFXs(legoCfgRoot,globals::g_Game.CfgRootName);
		Boot_Load_WeaponTypes(legoCfgRoot,globals::g_Game.CfgRootName);
		globals::g_Game.unkbool_308 = 1;
		snd::Snd_SetListener3DRootFrame
							((IDirect3DRMFrame3 *)
							 ((IDirect3DRMFrame3 *)(globals::g_Game.structbc_24)->tableunk_34)->lpVtbl);
		snd::Audio_SetMinDistFor3DSoundsOnTopView(globals::g_Game.MinDistFor3DSoundsOnTopView);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","mindist",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			mindist_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","mindist",0);
			mindist_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(mindist_str);
		mindist = (float)fVar9;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","maxdist",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			maxdist_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","maxdist",0);
			maxdist_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(maxdist_str);
		maxdist = (float)fVar9;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","mintilt",0);
		fVar9 = cfg::CFG_GetPropertyRadians(legoCfgRoot,pcVar1);
		mintilt = (float)fVar9;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","maxtilt",0);
		fVar9 = cfg::CFG_GetPropertyRadians(legoCfgRoot,pcVar1);
		maxtilt = (float)fVar9;
		FUN_00436c3a(globals::g_Game.structbc_24,mindist,maxdist);
		FUN_00436a53(globals::g_Game.structbc_24,mintilt,maxtilt);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","tvclipdist",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			tvclipdist_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","tvclipdist",0);
			tvclipdist_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(tvclipdist_str);
		globals::g_Game.TVClipDist = (float)fVar9;
		Main_SetTVClipDist_InStruct((int)globals::g_Game.ptr_1c,globals::g_Game.TVClipDist);
		Main_SetTVClipDist_InStruct((int)globals::g_Game.field_20,globals::g_Game.TVClipDist);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","DynamiteDamageRadius",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			DynamiteDamageRadius_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","DynamiteDamageRadius",0);
			DynamiteDamageRadius_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(DynamiteDamageRadius_str);
		globals::g_Game.DynamiteDamageRadius = (float)fVar9;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","DynamiteMaxDamage",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			DynamiteMaxDamage_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","DynamiteMaxDamage",0);
			DynamiteMaxDamage_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(DynamiteMaxDamage_str);
		globals::g_Game.DynamiteMaxDamage = (float)fVar9;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","DynamiteWakeRadius",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			DynamiteWakeRadius_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","DynamiteWakeRadius",0);
			DynamiteWakeRadius_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(DynamiteWakeRadius_str);
		globals::g_Game.DynamiteWakeRadius = (float)fVar9;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","BirdScarerRadius",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			BirdScarerRadius_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","BirdScarerRadius",0);
			BirdScarerRadius_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(BirdScarerRadius_str);
		globals::g_Game.BirdScarerRadius = (float)fVar9;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MusicOn",0);
		uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
		if (uVar8 == 1) {
			globals::g_Game.flags2 |= GAME2_MUSICON;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CDStartTrack",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			CDStartTrack_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CDStartTrack",0);
			CDStartTrack_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		globals::g_Game.CDStartTrack = std::atoi(CDStartTrack_str);
		if (globals::g_Game.CDStartTrack == 0) {
			globals::g_Game.CDStartTrack = 2;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CDTracks",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			CDTracks_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","CDTracks",0);
			CDTracks_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		globals::g_Game.CDTracks = std::atoi(CDTracks_str);
		if (globals::g_Game.CDTracks == 0) {
			globals::g_Game.flags2 &= ~GAME2_MUSICON;
			globals::g_Game.CDTracks = 1;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","SoundOn",0);
		uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
		if (uVar8 == 1) {
			globals::g_Game.flags1 |= GAME1_SOUNDON;
		}
		globals::g_Game.flags1 |= GAME1_WALLPROMESHES|GAME1_CLEAR|GAME1_PANELS|GAME1_DYNAMICPM;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","Clear",0);
		uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
		if (uVar8 == 0) {
			globals::g_Game.flags1 &= ~GAME1_CLEAR;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","Panels",0);
		uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
		if (uVar8 == 0) {
			globals::g_Game.flags1 &= ~GAME1_PANELS;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","WallProMeshes",0);
		uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
		if (uVar8 == 0) {
			globals::g_Game.flags1 &= ~GAME1_WALLPROMESHES;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","DynamicPM",0);
		uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
		if (uVar8 == 0) {
			globals::g_Game.flags1 &= ~GAME1_DYNAMICPM;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","HPBlocks",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			HPBlocks_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","HPBlocks",0);
			HPBlocks_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		globals::g_Game.HPBlocks = std::atoi(HPBlocks_str);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","OnlyBuildOnPaths",0);
		uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
		if (uVar8 == 1) {
			globals::g_Game.flags1 |= GAME1_ONLYBUILDONPATHS;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","AlwaysRockFall",0);
		uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
		if (uVar8 == 1) {
			globals::g_Game.flags1 |= GAME1_ALWAYSROCKFALL;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MiniFigureRunAway",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			MiniFigureRunAway_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MiniFigureRunAway",0);
			MiniFigureRunAway_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(MiniFigureRunAway_str);
		globals::g_Game.MiniFigureRunAway = (float)fVar9;
		if (fVar9 == (float10)0.0) {
			globals::g_Game.MiniFigureRunAway = 10.0;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","DrainTime",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			DrainTime_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","DrainTime",0);
			DrainTime_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(DrainTime_str);
		globals::g_Game.DrainTime = (float)fVar9;
		if (fVar9 == (float10)0.0) {
			globals::g_Game.DrainTime = 10.0;
		}
		globals::g_Game.DrainTime = globals::g_Game.DrainTime * 25.0;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","ReinforceHits",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			ReinforceHits_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","ReinforceHits",0);
			ReinforceHits_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		globals::g_Game.ReinforceHits = std::atoi(ReinforceHits_str);
		if (globals::g_Game.ReinforceHits == 0) {
			globals::g_Game.ReinforceHits = 4;
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MedPolyRange",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			MedPolyRange_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MedPolyRange",0);
			MedPolyRange_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(MedPolyRange_str);
		globals::g_Game.MedPolyRange = (float)fVar9;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","HighPolyRange",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			HighPolyRange_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","HighPolyRange",0);
			HighPolyRange_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(HighPolyRange_str);
		globals::g_Game.HighPolyRange = (float)fVar9;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MinEnergyForEat",0);
		pcVar1 = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		if (pcVar1 == NULL) {
			MinEnergyForEat_str = ""/*EMPTYSTR*/;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MinEnergyForEat",0);
			MinEnergyForEat_str = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
		}
		fVar9 = std::atof(MinEnergyForEat_str);
		globals::g_Game.MinEnergyForEat = (float)fVar9;
		Main_LoadMiscObjects(legoCfgRoot);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Pointers",0);
		prop = cfg::CFG_GetBlockFirstChild(legoCfgRoot,pcVar1);
		FUN_0045cd30(prop);
		FUN_0045cee0(0);
		if ((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) != GAME2_NONE) {
			game::Debug_RegisterSelectedUnitHotkey(2,9,0,0,NULL);
			game::Debug_RegisterSelectedUnitHotkey(3,9,0,1,NULL);
			game::Debug_RegisterSelectedUnitHotkey(5,10,0,0,NULL);
			game::Debug_RegisterSelectedUnitHotkey(4,0xb,0,0,NULL);
		}
		Main_LoadSmokeAnim("MiscAnims\\Smoke","Smoke",3);
		Main_LoadHealthFont("Interface\\FONTS\\HealthFont","a000_");
		Dialog_center.x = 0.0;
		Dialog_center.y = 0.0;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Dialog","Image",0);
		pcVar1 = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
		if ((pcVar1 != NULL) &&
			 (globals::g_Game.DialogImage = image::Image_LoadBMP(pcVar1,0,0),
			 globals::g_Game.DialogImage != NULL)) {
			image::Image_unkFogFromFloat__0047deb0(globals::g_Game.DialogImage,0.0,0.0,0.0,0.0,0.0,0.0);
			iVar3 = Config_GetResolutionWidth();
			Dialog_center.x =
					 (float)(iVar3 / 2) - (float)((uint)(globals::g_Game.DialogImage)->width >> 1);
			iVar3 = Config_GetResolutionHeight();
			Dialog_center.y =
					 (float)(iVar3 / 2) - (float)((uint)(globals::g_Game.DialogImage)->height >> 1);
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Dialog","TitleWindow",0);
		pcVar1 = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
		if ((pcVar1 != NULL) && (iVar3 = util::stringSplit(pcVar1,Window_stringParts,"|"), iVar3 == 4))
		{
			iVar3 = std::atoi(Window_stringParts[0]);
			Window_rect.x = (float)iVar3 + Dialog_center.x;
			iVar3 = std::atoi(Window_stringParts[1]);
			Window_rect.y = (float)iVar3 + Dialog_center.y;
			iVar3 = std::atoi(Window_stringParts[2]);
			Window_rect.width = (float)iVar3;
			iVar3 = std::atoi(Window_stringParts[3]);
			Window_rect.height = (float)iVar3;
			globals::g_Game.drawregion_e80 =
					 unk::Lego_unkMakeDrawRegion__004853b0(globals::g_Game.bmpMbriefFONT2,&Window_rect,0x400);
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Dialog","TextWindow",0);
		pcVar1 = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
		if ((pcVar1 != NULL) && (iVar3 = util::stringSplit(pcVar1,Window_stringParts,"|"), iVar3 == 4))
		{
			iVar3 = std::atoi(Window_stringParts[0]);
			Window_rect.x = (float)iVar3 + Dialog_center.x;
			iVar3 = std::atoi(Window_stringParts[1]);
			Window_rect.y = (float)iVar3 + Dialog_center.y;
			iVar3 = std::atoi(Window_stringParts[2]);
			Window_rect.width = (float)iVar3;
			iVar3 = std::atoi(Window_stringParts[3]);
			Window_rect.height = (float)iVar3;
			globals::g_Game.drawregion_e84 =
					 unk::Lego_unkMakeDrawRegion__004853b0(globals::g_Game.bmpMbriefFONT,&Window_rect,0x400);
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Dialog","OkWindow",0);
		pcVar1 = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
		if ((pcVar1 != NULL) && (iVar3 = util::stringSplit(pcVar1,Window_stringParts,"|"), iVar3 == 4))
		{
			iVar3 = std::atoi(Window_stringParts[0]);
			Window_rect.x = (float)iVar3 + Dialog_center.x;
			iVar3 = std::atoi(Window_stringParts[1]);
			Window_rect.y = (float)iVar3 + Dialog_center.y;
			iVar3 = std::atoi(Window_stringParts[2]);
			Window_rect.width = (float)iVar3;
			iVar3 = std::atoi(Window_stringParts[3]);
			Window_rect.height = (float)iVar3;
			globals::g_Game.drawregion_e88 =
					 unk::Lego_unkMakeDrawRegion__004853b0(globals::g_Game.bmpMbriefFONT,&Window_rect,0x400);
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Dialog","CancelWindow",0);
		pcVar1 = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
		if ((pcVar1 != NULL) && (iVar3 = util::stringSplit(pcVar1,Window_stringParts,"|"), iVar3 == 4))
		{
			iVar3 = std::atoi(Window_stringParts[0]);
			Window_rect.x = (float)iVar3 + Dialog_center.x;
			iVar3 = std::atoi(Window_stringParts[1]);
			Window_rect.y = (float)iVar3 + Dialog_center.y;
			iVar3 = std::atoi(Window_stringParts[2]);
			Window_rect.width = (float)iVar3;
			iVar3 = std::atoi(Window_stringParts[3]);
			Window_rect.height = (float)iVar3;
			globals::g_Game.drawregion_e8c =
					 unk::Lego_unkMakeDrawRegion__004853b0(globals::g_Game.bmpMbriefFONT,&Window_rect,0x400);
		}
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Dialog","ContrastOverlay",0);
		pcVar1 = cfg::CFG_CopyPropertyValue(legoCfgRoot,pcVar1);
		if ((pcVar1 != NULL) &&
			 (globals::g_Game.DialogContrastOverlay = image::Image_LoadBMP(pcVar1,0,0),
			 globals::g_Game.DialogContrastOverlay != NULL)) {
			image::Image_unkFogFromFloat__0047deb0
								(globals::g_Game.DialogContrastOverlay,0.0,0.0,0.0,0.0,0.0,0.0);
		}
		globals::g_Game.flags1 |= GAME1_RADARON|GAME1_RADAR_TRACKOBJECTVIEW;
		other::logf_removed((char *)globals::g_Game.resRoot,"animtex\\dirt");
		globals::g_Game.tvTiltOrZoom_334 = 15.0;
		globals::g_Game.float_324 = 16.0;
		globals::g_Game.float_328 = 13.0;
		globals::g_Game.float_32c = 151.0;
		globals::g_Game.float_330 = 151.0;
		Boot_Load_RockFallStyles(legoCfgRoot,globals::g_Game.CfgRootName,globals::g_Game.resRoot);
		Main_LoadToolTips(legoCfgRoot);
		Main_LoadToolTipIcons(legoCfgRoot);
		Main_LoadUpgradeNames(legoCfgRoot);
		Main_LoadInfoMessages(legoCfgRoot);
		Main_LoadMessageTabs_InfoOverFlow("Interface\\MessageTabs\\infoOverFlow.bmp");
		Main_LoadTextMessages(legoCfgRoot);
		uVar8 = Config_GetResolutionHeight();
		screenWidth = Config_GetResolutionWidth();
		Main_LoadPanels(legoCfgRoot,screenWidth,uVar8);
		Main_LoadRightPanelCrystals
							("Interface\\RightPanel\\SmallCrystal.bmp","Interface\\RightPanel\\UsedCrystal.bmp",
							 "Interface\\RightPanel\\NoSmallCrystal.bmp");
		Main_LoadAirMeter("Interface\\AirMeter\\msgpanel_air_juice.bmp",0x55,6,0xec,
											"Interface\\AirMeter\\msgpanel_noair.bmp",0x15,0);
		Main_LoadRightPanel_CryOreSidebar
							("Interface\\RightPanel\\crystalsidebar_ore.bmp",0x267,0x1b2,0x1a7);
		uVar8 = Config_GetResolutionHeight();
		iVar3 = Config_GetResolutionWidth();
		Main_LoadButtons(legoCfgRoot,iVar3,uVar8);
		Main_LoadTutorialIcon(legoCfgRoot);
		Main_InitSubmenuIconTables();
		Main_LoadInterfaceImages(legoCfgRoot,globals::g_Game.CfgRootName);
		Main_LoadInterfaceSurroundImages(legoCfgRoot,globals::g_Game.CfgRootName);
		Main_LoadInterfaceDependencies_PlusMinus
							("Interface\\Dependencies\\+.bmp","Interface\\Dependencies\\=.bmp");
		Main_LoadRewardGraphics(legoCfgRoot,globals::g_Game.CfgRootName);
		unk::Lego_TODORewardLoading();
		Main_LoadInterfaceButtons_ScrollInfo();
		FUN_0045ad80(0,2,1);
		FUN_0045ad80(0,3,1);
		save::Save_ClearSaveNumber();
		BVar2 = Config_IsFrontEndEnabled();
		if (BVar2 != 0) {
			Main_LoadMenus(globals::g_Game.LegoCfgRoot);
		}
		Main_InitAdvisors(globals::g_Game.CfgRootName,globals::g_Game.structbc_24,globals::g_Game.ptr_1c
										 );
		FUN_00401210(200.0);
		Main_LoadAdvisorAnims(legoCfgRoot,globals::g_Game.CfgRootName);
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","DisplayAdvisor",0);
		uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
		if (uVar8 == 1) {
			iVar3 = Config_GetResolutionHeight();
			iVar4 = Config_GetResolutionWidth();
			Main_LoadAdvisorPositions(legoCfgRoot,globals::g_Game.CfgRootName,iVar4,iVar3);
		}
		if ((globals::g_Game.flags1 & GAME1_SOUNDON) != GAME1_NONE) {
			Config_SetSoundEnabled(1);
		}
		PVar6 = Config_GetProgrammerMode();
		if (PVar6 < PROGRAMMER_MODE_3) {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","FrontEnd",0);
			uVar8 = cfg::CFG_GetPropertyBool(legoCfgRoot,pcVar1);
			if (uVar8 != 1) goto LAB_004226cc;
			LoaderProfile_Lookup(NULL);
			front::Menu_Open_FUN_00416bb0(0);
			iVar3 = unk::Lego_GetInt_0055801c();
			if (iVar3 != 0) {
				return 0;
			}
			startLevelName = (char *)FUN_00416ca0();
		}
		else {
LAB_004226cc:
			startLevelName = game::Game_GetStartLevel();
			if (startLevelName == NULL) {
				pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","startlevel",0);
				startLevelName = cfg::CFG_GetPropertyValue(legoCfgRoot,pcVar1);
			}
		}
		FUN_00416870(1,0);
		BVar2 = Main_loadLevelCFG(startLevelName);
		if (BVar2 != 0) {
			snd::Snd_Play_FUN_00465260(7,1);
			return 1;
		}
	}
	cfg::CFG_Close(legoCfgRoot);
LAB_0042274b:
	pool::ReservedPool<ResourceData>__Cleanup();
	return 0;
}

/// wew... it's finally over. Going anywhere near this function within Ghidra is just miserable,
/// since the decompiler cache is flushed after EVERY insignificant change. :D ....  ;_;



void __cdecl lego::main::Main_LoadMiscObjects(CFGProperty *root)
{
	char *pcVar1;
	
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","Boulder",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_Boulder = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWO",1);
	if (globals::g_Game.RES_Boulder == NULL) {
		globals::g_Game.RES_Boulder = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"MESH",1);
	}
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_Boulder,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","BoulderExplodeIce",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_BoulderExplodeIce =
			 res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWS",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_BoulderExplodeIce,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","BoulderExplode",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_BoulderExplode = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWS",1)
	;
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_BoulderExplode,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","SmashPath",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_SmashPath = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWS",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_SmashPath,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","Explosion",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	FUN_0040c650(globals::g_Game.resRoot,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","Crystal",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_Crystal = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWO",1);
	if (globals::g_Game.RES_Crystal == NULL) {
		globals::g_Game.RES_Crystal = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"MESH",1);
	}
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_Crystal,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","Dynamite",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_Dynamite = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"ACT",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_Dynamite,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","OohScary",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_OohScary = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"ACT",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_OohScary,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","Barrier",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_Barrier = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"ACT",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_Barrier,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","Ore",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_Ores_TABLE[0] = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWO",1);
	if (globals::g_Game.RES_Ores_TABLE[0] == NULL) {
		globals::g_Game.RES_Ores_TABLE[0] =
				 res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"MESH",1);
	}
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_Ores_TABLE[0],1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","ProcessedOre",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_Ores_TABLE[1] = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWO",1);
	if (globals::g_Game.RES_Ores_TABLE[1] == NULL) {
		globals::g_Game.RES_Ores_TABLE[1] =
				 res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"MESH",1);
	}
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_Ores_TABLE[1],1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","ElectricFence",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_ElectricFence = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWO",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_ElectricFence,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","ElectricFenceStud",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_ElectricFenceStud =
			 res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWS",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_ElectricFenceStud,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","ShortElectricFenceBeam",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	FUN_0040c0e0((undefined4 *)globals::g_Game.resRoot,pcVar1,0);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","LongElectricFenceBeam",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	FUN_0040c0e0((undefined4 *)globals::g_Game.resRoot,pcVar1,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","SpiderWeb",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_SpiderWeb = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"ACT",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_SpiderWeb,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","RechargeSparkle",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_RechargeSparkle =
			 res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWS",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_RechargeSparkle,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","MiniTeleportUp",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_MiniTeleportUp = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWS",0)
	;
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_MiniTeleportUp,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","IceCube",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_IceCube = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"ACT",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_IceCube,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","Pusher",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_Pusher = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWS",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_Pusher,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","Freezer",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_Freezer = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWS",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_Freezer,1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiscObjects","LaserShot",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Game.RES_LaserShot = res::Res_LoadResource(globals::g_Game.resRoot,pcVar1,"LWS",1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.RES_LaserShot,1);
	res::Res_LoadMiscObjects(root,globals::g_Game.CfgRootName,globals::g_Game.resRoot);
	return;
}



int __cdecl FUN_00422fb0(void)
{
	ResourceData *pRVar1;
	
	if (lego::globals::g_Game.unkbool_308 == 1) {
		return (int)(lego::globals::g_Game.structbc_24)->resData_24;
	}
	pRVar1 = (ResourceData *)lego::globals::g_Game.unkbool_308;
	if (lego::globals::g_Game.unkbool_308 == 0) {
		pRVar1 = (lego::globals::g_Game.structbc_2c)->resData_24;
	}
	return (int)pRVar1;
}



float10 __cdecl lego::game::Game_GetFloatFPS_e40(void)
{
	return (float10)globals::g_Game.floatfps_e40;
}



void __cdecl lego::game::Game_RenameInputUnk(float param_1)
{
	uint uVar1;
	uint uVar2;
	LiveObject *pLVar3;
	char *pcVar4;
	ImageFont *pIVar5;
	char *pcVar6;
	char *pcVar7;
	int iVar8;
	longlong lVar9;
	
	FLOAT_004a4558 = FLOAT_004a4558 - param_1;
	if ((ushort)((ushort)(FLOAT_004a4558 < 0.0) << 8 | (ushort)(FLOAT_004a4558 == 0.0) << 0xe) != 0) {
		FLOAT_004a4558 = FLOAT_004a4558 - -12.5;
		globals::g_UseQuotes_Unk = ZEXT14(globals::g_UseQuotes_Unk == 0);
	}
	if (globals::g_Game.renameInput != NULL) {
		lVar9 = __ftol((float10)globals::g_Game.float_ee4);
		iVar8 = (int)lVar9;
		uVar1 = draw::Font_GetField_be4(globals::g_Game.bmpToolTipFont);
		lVar9 = __ftol((float10)globals::g_Game.float_ee8);
		uVar2 = draw::Font_MeasureCharWidth(globals::g_Game.bmpToolTipFont,'\"');
		pcVar4 = globals::g_Game.renameInput;
		if ((*globals::g_Game.renameInput == '\0') &&
			 (pLVar3 = Game_GetPrimarySelectedObject(), pcVar4 = globals::g_Game.renameInput,
			 pLVar3 != NULL)) {
			pLVar3 = Game_GetPrimarySelectedObject();
			pcVar4 = LiveObject_GetName(pLVar3);
		}
		pIVar5 = FUN_00401b90(globals::g_Game.bmpToolTipFont,"\"%s\"",pcVar4);
		if (globals::g_RESOLUTION.width - 0x28U < (uint)((int)&pIVar5->bitmap + iVar8)) {
			iVar8 -= (int)pIVar5;
		}
		pcVar7 = "\"";
		if (globals::g_UseQuotes_Unk == 0) {
			pcVar7 = ____EMPTYSTR__;
		}
		pcVar6 = "\"";
		if (globals::g_UseQuotes_Unk == 0) {
			pcVar6 = ____EMPTYSTR__;
		}
		FUN_0047a440(globals::g_Game.bmpToolTipFont,
								 (~-(uint)(globals::g_UseQuotes_Unk != 0) & uVar2) + iVar8,(int)lVar9 - (uVar1 >> 1)
								 ,"%s%s%s",pcVar6,pcVar4,pcVar7);
	}
	return;
}



void __cdecl lego::input::Input_UpdateTyping(void)
{
	char cVar1;
	uint uVar2;
	uint uVar3;
	int iVar4;
	undefined4 *puVar5;
	char *pcVar6;
	undefined4 *puVar7;
	
	if (globals::g_Game.renameInput != NULL) {
		uVar2 = 0xffffffff;
		pcVar6 = globals::g_Game.renameInput;
		do {
			if (uVar2 == 0) break;
			uVar2 -= 1;
			cVar1 = *pcVar6;
			pcVar6 = pcVar6 + 1;
		} while (cVar1 != '\0');
		uVar3 = ~uVar2 - 1;
										// 1 = DIK_ESCAPE, 14 = DIK_BACK (backspace), 28 = DIK_RETURN (enter)
		if ((globals::g_KeyboardState_Current_TABLE[14] == 0) ||
			 (globals::g_KeyboardState_Typing_TABLE[14] == globals::g_KeyboardState_Current_TABLE[14])) {
			if (((globals::g_KeyboardState_Current_TABLE[28] == 0) &&
					(globals::g_KeyboardState_Typing_TABLE[28] != 0)) ||
				 ((globals::g_KeyboardState_Current_TABLE[1] == 0 &&
					(globals::g_KeyboardState_Typing_TABLE[1] != 0)))) {
				globals::g_Game.renameInput = NULL;
				FUN_00425b60(0,0);
			}
			else {
				uVar2 = 0;
				do {
					if ((((uVar3 < 0xb) && (globals::g_KeyboardState_Current_TABLE[uVar2] != 0)) &&
							(globals::g_KeyboardState_Typing_TABLE[uVar2] !=
							 globals::g_KeyboardState_Current_TABLE[uVar2])) &&
						 (iVar4 = Input_GetKeyCharacter(uVar2), iVar4 != 0)) {
						iVar4 = std::toupper(iVar4);
						globals::g_Game.renameInput[uVar3] = (char)iVar4;
						uVar3 += 1;
						globals::g_Game.renameInput[uVar3] = '\0';
					}
					uVar2 += 1;
				} while (uVar2 < 0x100);
			}
		}
		else {
			if (uVar3 != 0) {
				globals::g_Game.renameInput[~uVar2 - 2] = '\0';
			}
		}
		puVar5 = (undefined4 *)globals::g_KeyboardState_Current_TABLE;
		puVar7 = (undefined4 *)globals::g_KeyboardState_Typing_TABLE;
		for (iVar4 = 0x40; iVar4 != 0; iVar4 += -1) {
			*puVar7 = *puVar5;
			puVar5 = puVar5 + 1;
			puVar7 = puVar7 + 1;
		}
		puVar5 = (undefined4 *)globals::g_KeyboardState_Current_TABLE;
		for (iVar4 = 0x40; iVar4 != 0; iVar4 += -1) {
			*puVar5 = 0;
			puVar5 = puVar5 + 1;
		}
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

BOOL __cdecl lego::main::Main_GameUpdate(float elapsed)
{
	float fVar1;
	int *piVar2;
	BOOL BVar3;
	LevelData *pLVar4;
	int iVar5;
	uint uVar6;
	char *pcVar7;
	LiveObject *pLVar8;
	float fVar9;
	float time;
	uint uVar10;
	int iVar11;
	float10 fVar12;
	longlong lVar13;
	TextType textType;
	float fVar15;
	ulonglong uVar14;
	undefined4 uVar16;
	float local_34;
	int local_30;
	float local_2c;
	float local_28;
	float local_24;
	float local_1c;
	int local_18;
	BOOL local_14;
	BOOL local_10;
	Vector3F local_c;
	
	fVar1 = elapsed;
	local_30 = 0;
	if ((globals::g_PROGRAMMER_MODE == PROGRAMMER_MODE_10) && (BVar3 = FUN_00435870(), BVar3 == 0)) {
		return 0;
	}
	if ((globals::g_Game.flags1 & GAME1_CAMERADISABLED) != GAME1_NONE) {
		elapsed = 0.0;
	}
	input::Input_UpdateTyping();
	globals::g_Game.floatfps_e40 = elapsed;
	if ((globals::g_Game.unkbool_308 == 0) && (globals::g_PROGRAMMER_MODE < PROGRAMMER_MODE_2)) {
		local_2c = elapsed;
	}
	else {
		fVar12 = game::Game_GetGameSpeed();
		local_2c = (float)(fVar12 * (float10)elapsed);
	}
	time = local_2c;
	FUN_0046a9f0(local_2c);
	FUN_00435980();
	fVar15 = elapsed;
	pLVar4 = game::GetLevel();
	FUN_0042c370((int)pLVar4,fVar15);
	game::Game_UpdateFallins(time);
	unk::Lego_unkSlug__004260f0(time);
	if ((globals::g_Game.flags2 & GAME2_CALLTOARMS) == GAME2_NONE) {
		if (((globals::g_Game.structbc_2c != NULL) &&
				((globals::g_Game.structbc_2c)->resData_24 != NULL)) &&
			 (globals::g_Game.struct2c_4c != NULL)) {
			res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_4c,1);
		}
	}
	else {
		if (((globals::g_Game.structbc_2c != NULL) &&
				((globals::g_Game.structbc_2c)->resData_24 != NULL)) &&
			 ((globals::g_Game.struct2c_4c != NULL &&
				((globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE)))) {
			res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_4c,0);
			res::Res_AddRotation(globals::g_Game.struct2c_4c,D3DRMCOMBINE_AFTER,0.0,1.0,0.0,elapsed * 0.1)
			;
		}
	}
	if (((globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE) &&
		 (((globals::g_Game.flags1 & GAME1_UNK_200000) != GAME1_NONE || (globals::g_Game.bool_98 != 0)))
		 ) {
		if (globals::g_Game.bool_98 != 0) {
			local_28 = (1.0 / elapsed) * 5.0;
			res::Res_GetPosition((globals::g_Game.structbc_24)->resData_2c,NULL,&local_c);
			globals::g_Game.float_88 =
					 (local_28 * local_c.x + globals::g_Game.float_90) / (local_28 - -1.0);
			globals::g_Game.float_8c =
					 (local_28 * local_c.y + globals::g_Game.float_94) / (local_28 - -1.0);
			local_28 = globals::g_Game.float_88 - local_c.x;
			local_24 = globals::g_Game.float_8c - local_c.y;
			if (SQRT(local_24 * local_24 + local_28 * local_28) < 2.0) {
				globals::g_Game.bool_98 = 0;
			}
		}
		FUN_00436d2d(globals::g_Game.structbc_24,globals::g_Game.float_88,globals::g_Game.float_8c);
		globals::g_Game.flags1 &= ~GAME1_UNK_200000;
	}
	if ((globals::g_Game.flags1 & GAME1_UNK_4) != GAME1_NONE) {
		local_2c = 1.0;
		globals::g_Game.flags1 &= ~GAME1_UNK_4;
		time = 1.0;
	}
	BVar3 = game::Game_DoHotkeyChecks(time,elapsed,&local_10,&local_14,&local_18);
	if (BVar3 == 0) {
		return 0;
	}
	if ((globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE) {
		FUN_00425cc0();
	}
	FUN_00402150(SUB41(time,0));
	FUN_00424530(globals::g_Game.level,time);
	FUN_0040a940(elapsed);
	FUN_0043b530(time);
	FUN_0046f810(time);
	game::Game_DoErosionUnk__0040e9e0(time);
	FUN_004312e0(globals::g_Game.level,time);
	game::Game_PTL_UNKInit__00452390();
	FUN_00435e8c(globals::g_Game.structbc_24,globals::g_Game.level,elapsed,time);
	FUN_00435e8c(globals::g_Game.structbc_28,globals::g_Game.level,elapsed,time);
	FUN_00435e8c(globals::g_Game.structbc_2c,globals::g_Game.level,elapsed,time);
	FUN_00409110(time);
	FUN_0041b940(fVar1);
	FUN_004290d0(elapsed,0);
	FUN_00449ec0();
	FUN_0040d380(time);
	game::Game_unkGameLoop_FUN_00426450((char *)fVar1,elapsed,local_10,local_14,local_18);
	FUN_0044f2b0((uint *)(globals::g_Game.level)->surfaceMap,time);
	FUN_0046e650(globals::g_Game.level,time);
	snd::Snd_UpdateListener3D();
	FUN_00465dc0(time);
	FUN_00466880(SUB41(time,0));
	FUN_0044d260(time);
	FUN_0041a1f0(fVar1);
	if (globals::g_Game.IsFallinsEnabled != 0) {
		FUN_0040f010(time);
	}
	if ((((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) != GAME2_NONE) &&
			(globals::g_KeyboardState_Current_TABLE[64] != 0)) &&
		 (globals::g_KeyboardState_Previous_TABLE[64] != globals::g_KeyboardState_Current_TABLE[64])) {
		globals::g_Game.IsFallinsEnabled = ZEXT14(globals::g_Game.IsFallinsEnabled == 0);
		game::Game_DisplayInfoMessage(globals::g_Game.struct830_80,"\nFallin Mode %s");
	}
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_40,0);
	if (globals::g_Game.unkbool_308 == 1) {
		if ((globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE) {
			res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_44,0);
		}
		res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_30,0);
		FUN_004772d0((int)globals::g_Game.ptr_1c,1);
		view::Viewport_FUN_00477410((float)globals::g_Game.ptr_1c,globals::g_Game.resRoot,elapsed);
		res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_30,1);
		res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_44,1);
	}
	else {
		if (globals::g_Game.unkbool_308 == 0) {
			FUN_00463770(0);
			FUN_004634f0();
			FUN_0043bb10(globals::g_Game.object_a0,(globals::g_Game.structbc_2c)->resData_24,
									 globals::g_Game.MedPolyRange,globals::g_Game.HighPolyRange,1);
			iVar11 = 1;
			iVar5 = FUN_00435e3b(globals::g_Game.structbc_2c);
			FUN_0043bae0(globals::g_Game.object_a0,iVar5,iVar11);
			FUN_00424660(1,time);
			if (((globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE) &&
				 (res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_38,0),
				 globals::g_Game.struct2c_3c != NULL)) {
				res::Res_AddRotation
									(globals::g_Game.struct2c_3c,D3DRMCOMBINE_AFTER,0.0,1.0,0.0,elapsed * 0.01);
				res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_3c,0);
			}
			FUN_004772d0((int)globals::g_Game.ptr_1c,1);
			view::Viewport_FUN_00477410((float)globals::g_Game.ptr_1c,globals::g_Game.resRoot,elapsed);
			res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_38,1);
			if (globals::g_Game.struct2c_3c != NULL) {
				res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_3c,1);
			}
			FUN_00424660(0,time);
			iVar11 = 0;
			iVar5 = FUN_00435e3b(globals::g_Game.structbc_2c);
			FUN_0043bae0(globals::g_Game.object_a0,iVar5,iVar11);
			FUN_0043bb10(globals::g_Game.object_a0,NULL,0,0,0);
			FUN_00463800();
			FUN_00463770(1);
			FUN_00434460();
		}
	}
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_40,1);
	iVar5 = FUN_0045ae20(0);
	if (iVar5 == 0) {
		globals::g_Game.flags1 &= ~GAME1_RADARON;
	}
	else {
		globals::g_Game.flags1 |= GAME1_RADARON;
	}
	if (globals::g_Game.unkbool_308 == 1) {
		FUN_00424760((int)globals::g_Game.ptr_1c);
		FUN_00424740(globals::g_Game.ptr_1c);
		FUN_0040e800((int)globals::g_Game.ptr_1c);
	}
	FUN_004292e0(globals::g_Game.level);
	if ((globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE) {
		FUN_004074d0(elapsed);
	}
	if ((((globals::g_Game.flags1 & GAME1_RADARON) != GAME1_NONE) &&
			((globals::g_Game.flags1 & GAME1_RADAR_TRACKOBJECTVIEW) != GAME1_NONE)) &&
		 (FUN_004772d0((int)globals::g_Game.field_20,1),
		 (globals::g_Game.flags1 & GAME1_UNK_20000) == GAME1_NONE)) {
		FUN_004290d0(time,1);
		FUN_00449ec0();
		res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_34,0);
		if (((globals::g_Game.structbc_2c != NULL) &&
				((globals::g_Game.structbc_2c)->resData_24 != NULL)) &&
			 (globals::g_Game.struct2c_4c != NULL)) {
			res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_4c,1);
		}
		view::Viewport_FUN_00477410(globals::g_Game.field_20,globals::g_Game.resRoot,elapsed);
		res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_34,1);
		FUN_00450a40((globals::g_Game.level)->surfaceMap);
	}
	Main_DoDirect3DRMUpdate();
	FUN_00465d50(1);
	FUN_00465460(fVar1);
	if ((globals::g_Game.unkbool_308 == 1) &&
		 ((globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE)) {
		FUN_00435230(globals::g_Game.level,(int)globals::g_Game.ptr_1c,time,elapsed);
		FUN_004548c0(globals::g_Game.level,(int)globals::g_Game.ptr_1c,time,(undefined4 *)elapsed);
	}
	FUN_00450a40((globals::g_Game.level)->surfaceMap);
	if (((globals::g_Game.flags1 & GAME1_RADARON) == GAME1_NONE) ||
		 ((globals::g_Game.flags1 & GAME1_RADAR_MAPVIEW) == GAME1_NONE)) {
		iVar5 = 0;
	}
	else {
		iVar5 = 1;
	}
	if (iVar5 != 0) {
		FUN_00426180();
	}
	FUN_0043c570(time,iVar5);
	if ((globals::g_Game.flags1 & GAME1_PANELS) != GAME1_NONE) {
		if ((globals::g_Game.flags1 & GAME1_RADARON) == GAME1_NONE) {
			FUN_0045a9f0(1,elapsed);
		}
		FUN_0045a9f0(0,elapsed);
		if ((((globals::g_Game.flags1 & GAME1_RADARON) != GAME1_NONE) &&
				((globals::g_Game.flags1 & GAME1_RADAR_TRACKOBJECTVIEW) != GAME1_NONE)) &&
			 ((globals::g_Game.flags1 & GAME1_UNK_20000) == GAME1_NONE)) {
			FUN_0045a9f0(2,elapsed);
		}
		FUN_0045a9f0(4,elapsed);
		FUN_0045a9f0(9,elapsed);
		FUN_0045a9f0(6,elapsed);
		FUN_0045a9f0(8,elapsed);
		FUN_0045d990();
		FUN_0045a9f0(0xb,elapsed);
		FUN_0040e720(elapsed);
		if ((globals::g_Game.flags2 & GAME2_INMENU) == GAME2_NONE) {
			FUN_0041b3c0();
		}
		FUN_0041b860(elapsed);
		FUN_0045a9f0(5,elapsed);
		fVar9 = elapsed;
		fVar15 = elapsed;
		if (globals::g_Game.level != NULL) {
			fVar9 = (float)(globals::g_Game.level)->numCrystals;
			fVar15 = (float)((globals::g_Game.level)->numCrystals -
											(globals::g_Game.level)->numDrainedCrystals);
		}
		FUN_0045c390((uint)fVar9,(uint)fVar15,time);
		FUN_0045c8b0();
		FUN_0045a720(5,(undefined4 *)globals::g_Game.bmpToolTipFont,0x10,0x1d5,1,"%i");
		FUN_0045a9f0(7,elapsed);
		FUN_00463fe0(0);
		FUN_00419fb0(elapsed);
		FUN_0045a9f0(10,elapsed);
		FUN_00419e60(elapsed);
	}
	FUN_00418930();
	BVar3 = game::Level_IsObjectiveFinished();
	fVar15 = elapsed;
	if (BVar3 != 0) {
		fVar15 = fVar1;
	}
	FUN_004018d0(fVar15);
	snd::Music_Update(globals::g_Game.flags1 & GAME1_MUSICON);
	if ((globals::g_Game.flags1 & GAME1_DEBUG_NONERPS) == GAME1_NONE) {
		nerps::NERPs_Exec__004535e0(elapsed);
	}
	FUN_00458ea0(globals::g_Game.struct830_80,globals::g_Game.level,time,fVar1);
	if (globals::g_PROGRAMMER_MODE < PROGRAMMER_MODE_2) {
		if (((globals::g_Game.level)->MaxStolen != 0.0) &&
			 ((uint)(globals::g_Game.level)->MaxStolen <= (uint)(globals::g_Game.level)->field_9c)) {
			game::Level_SetCompleteStatus(LEVELSTATUS_FAILED_CRYSTALS);
		}
		iVar5 = game::LiveObject_GetOrSubLevelsTable(OBJECT_PATH,0,0,1);
		if (iVar5 == 0) {
			uVar10 = 0;
			iVar11 = 0;
			iVar5 = game::Object_GetLevels(OBJECT_MINIFIGURE,0);
			if (iVar5 != 0) {
				do {
					iVar5 = game::LiveObject_GetOrSubLevelsTable(OBJECT_MINIFIGURE,0,uVar10,1);
					iVar11 += iVar5;
					uVar10 += 1;
					uVar6 = game::Object_GetLevels(OBJECT_MINIFIGURE,0);
				} while (uVar10 < uVar6);
			}
			if ((iVar11 == 0) && (pLVar4 = game::GetLevel(), pLVar4->status == LEVELSTATUS_NONE)) {
				game::Level_SetCompleteStatus(LEVELSTATUS_FAILED);
			}
		}
	}
	FUN_0046afc0(elapsed);
	if (((globals::g_Game.flags2 & GAME2_MENU_HASNEXT) != GAME2_NONE) &&
		 (globals::g_Game.NextButton != NULL)) {
		image::Image_Blt__0047df70
							(globals::g_Game.NextButton,NULL,(float *)&globals::g_Game.menuNextPoint,NULL);
	}
	if (((globals::g_Game.flags2 & GAME2_MENU_HASPREVIOUS) != GAME2_NONE) &&
		 (globals::g_Game.BackArrow != NULL)) {
		image::Image_Blt__0047df70
							(globals::g_Game.BackArrow,NULL,(float *)&globals::g_Game.menuPrevPoint,NULL);
	}
	if ((((globals::g_Game.flags2 & GAME2_UNK_40) != GAME2_NONE) &&
			(globals::g_Game.NextButton != NULL)) &&
		 (((globals::g_Game.flags2 & GAME2_CAMERAMOVING) == GAME2_NONE ||
			(iVar5 = unk::Lego_GetDat_004ded1c(), iVar5 != 0)))) {
		image::Image_Blt__0047df70
							(globals::g_Game.NextButton,NULL,(float *)&globals::g_Game.NextButtonPos,NULL);
	}
	if (((globals::g_Game.flags2 & GAME2_UNK_80) != GAME2_NONE) &&
		 (globals::g_Game.BackButton != NULL)) {
		image::Image_Blt__0047df70
							(globals::g_Game.BackButton,NULL,(float *)&globals::g_Game.BackButtonPos,NULL);
	}
	if ((((globals::g_Game.flags2 & GAME2_INOPTIONSMENU) != GAME2_NONE) &&
			(BVar3 = Config_IsFrontEndEnabled(), BVar3 != 0)) &&
		 (BVar3 = FUN_004152a0(elapsed,1), BVar3 != 0)) {
		globals::g_Game.flags2 &= ~GAME2_INOPTIONSMENU;
		BVar3 = game::Level_IsObjectiveFinished();
		if (BVar3 == 0) {
			FUN_00425b60(0,0);
		}
		else {
			globals::g_Game.flags1 |= GAME1_PAUSED;
		}
	}
	game::Game_RenameInputUnk(fVar1);
	if ((globals::g_Game.flags1 & GAME1_PAUSED) == GAME1_NONE) {
		FUN_0045d050(fVar1);
		if (globals::g_Game.renameInput == NULL) goto LAB_00423e04;
	}
	else {
		BVar3 = Config_IsFrontEndEnabled();
		if ((BVar3 == 0) || (BVar3 = FUN_004152a0(elapsed,0), BVar3 == 0)) {
			FUN_0045d050(fVar1);
LAB_00423e04:
			FUN_0045cf30(globals::g_MousePosition.x,globals::g_MousePosition.y);
		}
		else {
			globals::g_Game.flags1 ^= GAME1_PAUSED;
			BVar3 = FUN_00416d10();
			if (BVar3 == 0) {
				BVar3 = game::Level_IsObjectiveFinished();
				if (BVar3 == 0) {
					FUN_00425b60(0,0);
				}
			}
			else {
				FUN_0041f9b0();
				pLVar4 = game::GetLevel();
				pLVar4->status = LEVELSTATUS_FAILED_CRYSTALS;
				unk::Lego_UnkLevelImportantPilot___004604e0();
				if ((globals::g_Game.flags1 & GAME1_MUSICON) != GAME1_NONE) {
					globals::g_Game.flags2 |= GAME2_MUSICON;
					snd::Music_PlayNext(0);
				}
			}
		}
	}
	BVar3 = FUN_00416d20();
	if ((BVar3 == 1) || (globals::g_PROGRAMMER_MODE == PROGRAMMER_MODE_11)) {
		FUN_00415150();
	}
	if ((globals::g_Game.flags1 & GAME1_UNK_20000000) != GAME1_NONE) {
		pcVar7 = "Vertex";
		if ((globals::g_Game.flags1 & GAME1_UNK_40000) == GAME1_NONE) {
			pcVar7 = "Block";
		}
		FUN_0047a440(globals::g_Game.bmpDeskTopFont,10,10,"%s mode",pcVar7);
	}
	if (((globals::g_Game.flags1 & GAME1_UNK_40000) != GAME1_NONE) && (globals::g_Game.bool_c8 != 0))
	{
		FUN_00450320((globals::g_Game.level)->surfaceMap,globals::g_Game.field_c0,
								 globals::g_Game.field_c4,(undefined4 *)&local_c);
		FUN_00477570((int)globals::g_Game.ptr_1c,&local_28,&local_c);
		local_28 = local_28 / local_1c;
		local_24 = local_24 / local_1c;
		FUN_0045cee0(3);
		lVar13 = __ftol((float10)local_24);
		uVar10 = (uint)lVar13;
		lVar13 = __ftol((float10)local_28);
		FUN_0045cf30((uint)lVar13,uVar10);
		globals::g_Game.flags1 &= ~GAME1_UNK_80000000;
	}
	FUN_0046ba80(globals::g_MousePosition.x,globals::g_MousePosition.y,fVar1);
	if ((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) != GAME2_NONE) {
		if (((((globals::g_KeyboardState_Current_TABLE[6] != 0) &&
					(globals::g_KeyboardState_Previous_TABLE[6] != globals::g_KeyboardState_Current_TABLE[6]))
				 || ((globals::g_KeyboardState_Current_TABLE[7] != 0 &&
						 (globals::g_KeyboardState_Previous_TABLE[7] !=
							globals::g_KeyboardState_Current_TABLE[7])))) ||
				((globals::g_KeyboardState_Current_TABLE[8] != 0 &&
				 (globals::g_KeyboardState_Previous_TABLE[8] != globals::g_KeyboardState_Current_TABLE[8])))
				) || ((globals::g_KeyboardState_Current_TABLE[9] != 0 &&
							(globals::g_KeyboardState_Previous_TABLE[9] !=
							 globals::g_KeyboardState_Current_TABLE[9])))) {
			FLOAT_004df530 = 1.0;
		}
		if ((ushort)((ushort)(FLOAT_004df530 < 0.0) << 8 | (ushort)(FLOAT_004df530 == 0.0) << 0xe) == 0)
		{
			pLVar8 = game::Game_GetSelectedUnits((int *)&local_28);
			if (local_28 != 0.0) {
				piVar2 = (int *)pLVar8->objType;
				if (*piVar2 == 4) {
					iVar5 = piVar2[6] + 0x8c;
				}
				else {
					if (*piVar2 == 1) {
						iVar5 = piVar2[3] + 0x124;
					}
					else {
						iVar5 = 0;
					}
				}
				if (iVar5 != 0) {
					uVar10 = *(uint *)(iVar5 + 8);
					uVar14 = CONCAT44(uVar10,uVar10 >> 1) & 0x100000001;
					FUN_0047a440(globals::g_Game.bmpFONT5_HI,0,0,"Upgrade - (%i%i%i%i)",uVar10 >> 3 & 1,
											 uVar10 >> 2 & 1,(uint)uVar14,(uint)(uVar14 >> 0x20));
				}
			}
			FLOAT_004df530 = FLOAT_004df530 - 0.1;
		}
	}
	if (FLOAT_004a455c < 0.0) {
		snd::Snd_Play_FUN_00465260(5,0);
		fVar12 = game::Game_ChooseRandomRange(75.0,125.0);
		FLOAT_004a455c = (float)fVar12;
	}
	if (FLOAT_004a4560 < 0.0) {
		snd::Snd_Play_FUN_00465260(6,0);
		fVar12 = game::Game_ChooseRandomRange(250.0,750.0);
		FLOAT_004a4560 = (float)fVar12;
	}
	FLOAT_004a455c = FLOAT_004a455c - elapsed;
	FLOAT_004a4560 = FLOAT_004a4560 - elapsed;
	if ((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) != GAME2_NONE) {
		if (globals::g_KeyboardState_Current_TABLE[73] == 0) {
			local_34 = -1.0;
			if (globals::g_KeyboardState_Current_TABLE[72] == 0) {
				local_34 = 0.0;
			}
		}
		else {
			local_34 = 1.0;
		}
		if (local_34 != 0.0) {
			_DAT_004df534 = 25.0;
			fVar12 = game::Game_GetGameSpeed();
			game::Game_SetGameSpeed
								((float)((float10)local_34 * (float10)elapsed * (float10)0.01 + fVar12));
			fVar12 = game::Game_GetGameSpeed();
			if ((ushort)((ushort)(fVar12 < (float10)3.0) << 8 | (ushort)(fVar12 == (float10)3.0) << 0xe)
					== 0) {
				game::Game_SetGameSpeed(3.0);
			}
			fVar12 = game::Game_GetGameSpeed();
			if (fVar12 < (float10)0.0) {
				game::Game_SetGameSpeed(0.0);
			}
		}
		if ((ushort)((ushort)(_DAT_004df534 < 0.0) << 8 | (ushort)(_DAT_004df534 == 0.0) << 0xe) == 0) {
			fVar12 = game::Game_GetGameSpeed();
			FUN_0047a440(globals::g_Game.bmpFONT5_HI,10,0x50,"Game Speed %0.0f%%",
									 (double)(fVar12 * (float10)100.0));
		}
		_DAT_004df534 = _DAT_004df534 - elapsed;
	}
	if ((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) == GAME2_NONE) goto LAB_0042427c;
	if (FLOAT_004a4564 == -1.0) {
		fVar12 = Main_SetRollOffFor3DSounds(-1.0);
		FLOAT_004a4564 = (float)fVar12;
	}
	if (globals::g_KeyboardState_Current_TABLE[10] == 0) {
		if (globals::g_KeyboardState_Current_TABLE[11] != 0) {
			FLOAT_004a4564 = FLOAT_004a4564 - -0.05;
			goto LAB_0042421e;
		}
	}
	else {
		FLOAT_004a4564 = FLOAT_004a4564 - 0.05;
LAB_0042421e:
		fVar12 = Main_SetRollOffFor3DSounds(FLOAT_004a4564);
		FLOAT_004a4564 = (float)fVar12;
		_DAT_004df538 = 25.0;
	}
	if ((ushort)((ushort)(_DAT_004df538 < 0.0) << 8 | (ushort)(_DAT_004df538 == 0.0) << 0xe) == 0) {
		FUN_0047a440(globals::g_Game.bmpFONT5_HI,10,0x50,"3D sound fall off: %f",(double)FLOAT_004a4564)
		;
	}
	_DAT_004df538 = _DAT_004df538 - elapsed;
LAB_0042427c:
	if ((globals::g_Game.flags1 & GAME1_DEBUG_NONERPS) == GAME1_NONE) {
		FUN_00453e70(elapsed);
	}
	else {
		FUN_0047a440(globals::g_Game.bmpFONT5_HI,0,0,"NoNERPS");
	}
	if ((ushort)((ushort)((globals::g_Game.level)->oxygenLevel < 0.0) << 8 |
							(ushort)((globals::g_Game.level)->oxygenLevel == 0.0) << 0xe) == 0) {
		fVar1 = (globals::g_Game.level)->oxygenLevel;
		if ((globals::g_Game.level)->float_204 - 5.0 <= (globals::g_Game.level)->oxygenLevel) {
			if ((ushort)((ushort)(fVar1 < (globals::g_Game.level)->float_204) << 8 |
									(ushort)(fVar1 == (globals::g_Game.level)->float_204) << 0xe) == 0) {
				if ((undefined *)(globals::g_Game.level)->oxygenLevel == &DAT_42c80000) {
					game::Info_FUN_00419ab0(INFO_AIRRESTORED,NULL,NULL,NULL);
				}
				(globals::g_Game.level)->float_204 = (globals::g_Game.level)->oxygenLevel;
			}
		}
		else {
			if ((ushort)((ushort)(fVar1 < 10.0) << 8 | (ushort)(fVar1 == 10.0) << 0xe) == 0) {
				game::Info_FUN_00419ab0(INFO_AIRDEPLETING,NULL,NULL,NULL);
				textType = TEXT_AIRSUPPLYRUNNINGOUT;
			}
			else {
				game::Info_FUN_00419ab0(INFO_AIRLOW,NULL,NULL,NULL);
				textType = TEXT_AIRSUPPLYLOW;
			}
			front::Text_DisplayType(textType,1,0);
			(globals::g_Game.level)->float_204 = (globals::g_Game.level)->oxygenLevel;
		}
	}
	else {
		game::Info_FUN_00419ab0(INFO_AIROUT,NULL,NULL,NULL);
	}
	if ((ushort)((ushort)((globals::g_Game.level)->oxygenLevel < 10.0) << 8 |
							(ushort)((globals::g_Game.level)->oxygenLevel == 10.0) << 0xe) == 0) {
		if ((DAT_0050180c != 0) && (BVar3 = snd::Snd_GetSFX("SND_AirBeat",&local_30), BVar3 != 0)) {
			iVar5 = snd::Sample_ChooseRandomSound(local_30);
			snd::Sample_StopSoundBufferInstance(iVar5);
		}
		uVar16 = 0;
	}
	else {
		if ((DAT_0050180c == 0) && (BVar3 = snd::Snd_GetSFX("SND_AirBeat",&local_30), BVar3 != 0)) {
			snd::Snd_Play_FUN_00465260(local_30,1);
		}
		BVar3 = snd::Snd_GetSFX("SND_AirBeat",&local_30);
		if (BVar3 != 0) {
			uVar10 = game::Game_GetUnkMask__0047c420();
			lVar13 = __ftol((float10)(globals::g_Game.level)->oxygenLevel * (float10)0.1 *
											(float10)uVar10 * (float10)0.1);
			iVar5 = snd::Sample_GetRandomVolume(local_30);
			if ((int)lVar13 != iVar5) {
				snd::Sample_PlayRandomAtVolume(local_30,(int)lVar13);
			}
		}
		uVar16 = 1;
	}
	FUN_0045c760(uVar16);
	globals::g_Game.float_e3c = globals::g_Game.float_e3c - local_2c;
	return 1;
}



void __cdecl lego::game::Game_ConsumeOxygen(LiveObject *liveObj,float elapsed)
{
	LevelData *pLVar1;
	float10 fVar2;
	
	pLVar1 = globals::g_Game.level;
	fVar2 = LiveObject_GetOxygenCoef(liveObj);
	if ((liveObj->objType != OBJECT_BUILDING) || ((liveObj->flags3_3e8 & 0x20000000) != LIVEOBJ3_NONE)
		 ) {
		fVar2 = (float10)elapsed * (float10)0.04 * (float10)pLVar1->OxygenRate * fVar2 +
						(float10)pLVar1->oxygenLevel;
		pLVar1->oxygenLevel = (float)fVar2;
		if ((ushort)((ushort)(fVar2 < (float10)100.0) << 8 | (ushort)(fVar2 == (float10)100.0) << 0xe)
				== 0) {
			pLVar1->oxygenLevel = (float)&DAT_42c80000;
		}
		if (((ushort)((ushort)(pLVar1->oxygenLevel < 0.0) << 8 |
								 (ushort)(pLVar1->oxygenLevel == 0.0) << 0xe) != 0) &&
			 (pLVar1->oxygenLevel = 0.0, (globals::g_Game.flags1 & GAME1_UNK_8000000) == GAME1_NONE)) {
			Level_SetCompleteStatus(LEVELSTATUS_FAILED);
			return;
		}
	}
	return;
}



void __cdecl FUN_00424530(undefined4 param_1,float param_2)
{
	LevelBlockFlags1 *pLVar1;
	uint uVar2;
	int iVar3;
	uint uVar4;
	int local_14;
	int local_10;
	int local_c;
	int local_8;
	float local_4;
	
	uVar2 = FUN_0040c2d0(param_2,&local_c,&local_10);
	uVar4 = 0;
	if (uVar2 != 0) {
		do {
			FUN_0040c4a0(*(int *)(local_c + uVar4 * 4),*(int *)(local_10 + uVar4 * 4),&local_14,&param_2);
			local_8 = local_14;
			local_4 = param_2;
			iVar3 = ((lego::globals::g_Game.level)->dimensions).width * (int)param_2 + local_14;
			(lego::globals::g_Game.level)->blocks[iVar3].flags1 =
					 (lego::globals::g_Game.level)->blocks[iVar3].flags1 & ~BLOCK1_UNK_800;
			if (((lego::globals::g_Game.level)->blocks
					 [((lego::globals::g_Game.level)->dimensions).width * (int)param_2 + local_14].flags1 &
					BLOCK1_UNK_1000) == BLOCK1_NONE) {
				lego::game::Level_AddMessageAction(MESSAGE_ROCKFALL_COMPLETE,0,0,&local_8);
			}
			iVar3 = ((lego::globals::g_Game.level)->dimensions).width * (int)param_2 + local_14;
			(lego::globals::g_Game.level)->blocks[iVar3].flags1 =
					 (lego::globals::g_Game.level)->blocks[iVar3].flags1 & ~BLOCK1_UNK_1000;
			pLVar1 = &(lego::globals::g_Game.level)->blocks
								[((lego::globals::g_Game.level)->dimensions).width * (int)local_4 + local_8].flags1;
			uVar4 += 1;
			*pLVar1 = *pLVar1 & ~BLOCK1_UNK_8000000;
		} while (uVar4 < uVar2);
	}
	return;
}



void __cdecl FUN_00424660(BOOL isFogEnabled,float elapsed)
{
	uint uVar1;
	uint uVar2;
	float10 fVar3;
	float10 fVar4;
	ColourRGBF local_c;
	
	if ((lego::globals::g_Game.flags1 & GAME1_FOGCOLOURRGB) != GAME1_NONE) {
		lego::res::Res_SetRootSceneFogEnable(isFogEnabled);
		if ((isFogEnabled != 0) &&
			 ((lego::globals::g_Game.flags1 & GAME1_HIGHFOGCOLOURRGB) != GAME1_NONE)) {
			fVar3 = ((float10)6.283185 / (float10)lego::globals::g_Game.FogRate) * (float10)elapsed +
							(float10)FLOAT_004df53c;
			FLOAT_004df53c = (float)fVar3;
			fVar3 = (float10)fsin(fVar3);
			uVar1 = 0;
			do {
				uVar2 = uVar1 + 4;
				fVar4 = ((float10)*(float *)((int)lego::globals::g_Game.objTeleportQueueTypes_TABLE +
																		(uVar1 - 0x5c)) -
								(float10)*(float *)((int)lego::globals::g_Game.table10_2f8 + uVar1 + 0x54)) *
								(float10)0.5;
				*(float *)((int)&local_c.red + uVar1) =
						 (float)(fVar4 + (float10)*(float *)((int)lego::globals::g_Game.table10_2f8 +
																								uVar1 + 0x54) + fVar4 * fVar3);
				uVar1 = uVar2;
			} while (uVar2 < 0xc);
			lego::res::Res_SetRootSceneFogColor(local_c.red,local_c.green,local_c.blue);
		}
	}
	return;
}



undefined4 __cdecl FUN_00424700(LiveObject *liveObj,int param_2)
{
	if ((liveObj->flags4_3ec & 1) != 0) {
		FUN_004247e0(liveObj,param_2,1.0,0.0,0.0);
	}
	return 0;
}



void __cdecl FUN_00424740(LiveObject *liveObj)
{
	FUN_00437a70(FUN_00424700,liveObj);
	return;
}



void __cdecl FUN_00424760(int param_1)
{
	uint uVar1;
	LiveObject **ppLVar2;
	uint local_c;
	
	uVar1 = lego::game::Game_GetNumSelectedUnits();
	ppLVar2 = lego::game::Game_GetSelectedUnits();
	for (local_c = 0; local_c < uVar1; local_c += 1) {
		if (local_c == 0) {
			FUN_004247e0(*ppLVar2,param_1,0.0,1.0,0.0);
		}
		else {
			FUN_004247e0(ppLVar2[local_c],param_1,1.0,1.0,0.0);
		}
	}
	return;
}



void __cdecl FUN_004247e0(LiveObject *liveObj,int param_2,float r,float g,float b)
{
	BOOL BVar1;
	LevelSurfaceMap *surfMap;
	int iVar2;
	float10 fVar3;
	longlong lVar4;
	char *format;
	float local_e8;
	float local_e4;
	float local_e0;
	float local_dc;
	float local_d8;
	float local_d4;
	float local_d0;
	float local_cc;
	float local_c8;
	float local_c4;
	float local_c0;
	float local_bc;
	float local_b8;
	float local_b4;
	float local_b0;
	float local_ac;
	Vector3F local_a8;
	Vector3F local_9c;
	float local_90;
	float local_8c;
	float local_88;
	float local_84;
	float local_80;
	float local_7c;
	float local_78;
	float local_74;
	float local_70;
	float local_6c;
	float local_68;
	float local_64;
	float local_60;
	float local_5c;
	float local_58;
	float local_54;
	float local_50;
	Vector3F local_4c;
	Point2F local_40 [2];
	Point2F local_30;
	undefined4 local_28;
	undefined4 local_24;
	Vector3F local_20;
	Vector3F local_14;
	float local_8;
	
	local_4c.x = 0.0;
	local_4c.y = 1.0;
	local_4c.z = 0.0;
	BVar1 = FUN_0044a2b0(liveObj);
	if (BVar1 == 0) {
		if ((lego::globals::g_Game.flags1 & GAME1_CAMERADISABLED) != GAME1_NONE) {
			r = r * 0.3;
			g = g * 0.3;
			b = b * 0.3;
		}
		lego::game::LiveObject_GetPosition(liveObj,(float *)&local_a8,&local_a8.y);
		surfMap = lego::game::GetSurfaceMap();
		fVar3 = lego::game::SurfaceMap_UnkGetZ(surfMap,local_a8.x,local_a8.y);
		local_a8.z = (float)fVar3;
		fVar3 = lego::game::LiveObject_GetCollHeight(liveObj);
		local_a8.z = (float)((float10)local_a8.z - fVar3 / (float10)2.0);
		FUN_00477590(param_2,&local_30,&local_a8);
		if ((0.0 <= local_30.x) && (0.0 <= local_30.y)) {
			iVar2 = lego::main::Config_GetResolutionWidth();
			if (local_30.x <= (float)iVar2) {
				iVar2 = lego::main::Config_GetResolutionHeight();
				if (local_30.y <= (float)iVar2) {
					local_28 = 0;
					local_24 = 0x3f800000;
					FUN_00477550(param_2,&local_9c,&local_30);
					lego::math::Vector3_Subtract(&local_14,&local_a8,&local_9c);
					lego::math::Vector3_Normalize(&local_14);
					lego::math::Vector3_CrossProduct(&local_20,&local_14,&local_4c);
					lego::math::Vector3_Normalize(&local_20);
					fVar3 = lego::game::LiveObject_GetPickSphere(liveObj);
					lego::math::Vector3_Scale(&local_20,&local_20,(float)fVar3);
					lego::math::Vector3_Add(&local_a8,&local_a8,&local_20);
					FUN_00477590(param_2,local_40,&local_a8);
					fVar3 = lego::math::Vector2_Distance(&local_30,local_40);
					local_50 = (float)(fVar3 / (float10)2.5);
					local_8 = (float)((fVar3 / (float10)2.5) / (float10)5.0 + (float10)3.0);
					local_e8 = local_30.x - local_50;
					local_e4 = (local_30.y - local_50) + local_8;
					local_90 = local_30.x - local_50;
					local_8c = local_30.y - local_50;
					local_e0 = (local_30.x - local_50) + 1.0;
					local_dc = local_30.y - local_50;
					local_88 = (local_30.x - local_50) + local_8;
					local_84 = local_30.y - local_50;
					local_d8 = (local_30.x + local_50) - local_8;
					local_d4 = local_30.y - local_50;
					local_80 = local_30.x + local_50;
					local_7c = local_30.y - local_50;
					local_d0 = local_30.x + local_50;
					local_cc = (local_30.y - local_50) + 1.0;
					local_78 = local_30.x + local_50;
					local_74 = (local_30.y - local_50) + local_8;
					local_c8 = local_30.x + local_50;
					local_c4 = (local_30.y + local_50) - local_8;
					local_70 = local_30.x + local_50;
					local_6c = local_30.y + local_50;
					local_c0 = (local_30.x + local_50) - 1.0;
					local_bc = local_30.y + local_50;
					local_68 = (local_30.x + local_50) - local_8;
					local_64 = local_30.y + local_50;
					local_b8 = (local_30.x - local_50) + local_8;
					local_b4 = local_30.y + local_50;
					local_60 = local_30.x - local_50;
					local_5c = local_30.y + local_50;
					local_b0 = local_30.x - local_50;
					local_ac = (local_30.y + local_50) - 1.0;
					local_58 = local_30.x - local_50;
					local_54 = (local_30.y + local_50) - local_8;
					lego::draw::Draw_SurfaceLock_FUN_004862b0(&local_e8,&local_90,8,r,g,b,0);
					if ((((lego::globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE) &&
							(liveObj->customName != NULL)) && (*liveObj->customName != '\0')) {
						format = liveObj->customName;
						lVar4 = __ftol((float10)local_30.y - (float10)local_50);
						iVar2 = lego::draw::Font_GetField_be4(lego::globals::g_Game.bmpToolTipFont);
						iVar2 = (int)lVar4 - iVar2;
						lVar4 = __ftol((float10)local_30.x - (float10)local_50);
						FUN_0047a440(lego::globals::g_Game.bmpToolTipFont,(int)lVar4,iVar2,format);
					}
				}
			}
		}
	}
	return;
}



void __cdecl lego::main::Game_Exit(void)
{
	Game_Exit();
	return;
}



void __cdecl lego::main::Main_GameCleanup(void)
{
	BOOL BVar1;
	char *filename;
	uint uVar2;
	char *unaff_EDI;
	int iVar3;
	
	Main_ShowShutdownScreen();
	FUN_0045fa10();
	snd::Music_PlayNext(0);
	Config_SetSoundEnabled(0);
	game::Game_freeLevel__0042eff0();
	Main_CleanupUnkInteraces();
	cfg::CFG_Close(globals::g_Game.LegoCfgRoot);
	pool::ReservedPool_Struct_20___Release(globals::g_Game.ptr_1c);
	pool::ReservedPool_ResourceData___Release(globals::g_Game.resRoot);
	FUN_00435cf8((int *)globals::g_Game.structbc_24);
	FUN_00435cf8((int *)globals::g_Game.structbc_28);
	FUN_00435cf8((int *)globals::g_Game.structbc_2c);
	uVar2 = 0;
	if (globals::g_Game.VehicleTypes_COUNT != 0) {
		iVar3 = 0;
		do {
			FUN_0046d0d0((int)(globals::g_Game.VehicleData_TABLE)->WheelMeshes + iVar3 + -0x10);
			std::free(globals::g_Game.VehicleTypes_TABLE[uVar2]);
			uVar2 += 1;
			iVar3 += 0x1ec;
		} while (uVar2 < globals::g_Game.VehicleTypes_COUNT);
	}
	std::free(globals::g_Game.VehicleTypes_TABLE);
	std::free(globals::g_Game.ObjectNames_VehicleTypes_TABLE);
	std::free(globals::g_Game.VehicleData_TABLE);
	uVar2 = 0;
	if (globals::g_Game.MiniFigureTypes_COUNT != 0) {
		iVar3 = 0;
		do {
			res::Creature_Destroy
								((CreatureData *)
								 ((int)(globals::g_Game.MiniFigureData_TABLE)->cameraFramesTable_54 + iVar3 + -0x54)
								);
			std::free(globals::g_Game.MiniFigureTypes_TABLE[uVar2]);
			uVar2 += 1;
			iVar3 += 0x74;
		} while (uVar2 < globals::g_Game.MiniFigureTypes_COUNT);
	}
	std::free(globals::g_Game.MiniFigureTypes_TABLE);
	std::free(globals::g_Game.ObjectNames_MiniFigureTypes_TABLE);
	std::free(globals::g_Game.MiniFigureData_TABLE);
	uVar2 = 0;
	if (globals::g_Game.RockMonsterTypes_COUNT != 0) {
		iVar3 = 0;
		do {
			res::Creature_Destroy
								((CreatureData *)
								 ((int)(globals::g_Game.RockMonsterData_TABLE)->cameraFramesTable_54 + iVar3 + -0x54
								 ));
			std::free(globals::g_Game.RockMonsterTypes_TABLE[uVar2]);
			uVar2 += 1;
			iVar3 += 0x74;
		} while (uVar2 < globals::g_Game.RockMonsterTypes_COUNT);
	}
	std::free(globals::g_Game.RockMonsterTypes_TABLE);
	std::free(globals::g_Game.ObjectNames_RockMonsterTypes_TABLE);
	std::free(globals::g_Game.RockMonsterData_TABLE);
	uVar2 = 0;
	if (globals::g_Game.UpgradeTypes_COUNT != 0) {
		iVar3 = 0;
		do {
			FUN_0046c3b0((int)&(globals::g_Game.UpgradeData_TABLE)->objectIndex + iVar3);
			std::free(globals::g_Game.UpgradeTypes_TABLE[uVar2]);
			uVar2 += 1;
			iVar3 += 0x10;
		} while (uVar2 < globals::g_Game.UpgradeTypes_COUNT);
	}
	std::free(globals::g_Game.UpgradeTypes_TABLE);
	std::free(globals::g_Game.ObjectNames_UpgradeTypes_TABLE);
	std::free(globals::g_Game.UpgradeData_TABLE);
	uVar2 = 0;
	if (globals::g_Game.BuildingTypes_COUNT != 0) {
		iVar3 = 0;
		do {
			game::LiveObject_ReleaseBuilding
								((BuildingData *)
								 ((int)(globals::g_Game.BuildingData_TABLE)->carryFramesTable_28 + iVar3 + -0x28));
			std::free(globals::g_Game.BuildingTypes_TABLE[uVar2]);
			uVar2 += 1;
			iVar3 += 0x14c;
		} while (uVar2 < globals::g_Game.BuildingTypes_COUNT);
	}
	std::free(globals::g_Game.BuildingTypes_TABLE);
	std::free(globals::g_Game.ObjectNames_BuildingTypes_TABLE);
	std::free(globals::g_Game.BuildingData_TABLE);
	std::free(globals::g_Game.ObjectNames_PowerCrystal);
	std::free(globals::g_Game.ObjectNames_Ore);
	std::free(globals::g_Game.ObjectNames_ProcessedOre);
	std::free(globals::g_Game.ObjectNames_Dynamite);
	std::free(globals::g_Game.ObjectNames_Barrier);
	std::free(globals::g_Game.ObjectNames_ElectricFence);
	std::free(globals::g_Game.ObjectNames_SpiderWeb);
	std::free(globals::g_Game.ObjectNames_OohScary);
	std::free(globals::g_Game.ObjectNames_Path);
	FUN_00485450((undefined *)globals::g_Game.struct830_80);
	pool::ReservedPool_ImageFont___Release(globals::g_Game.bmpFONT5_HI);
	pool::ReservedPool_ImageFont___Release(globals::g_Game.bmpToolTipFont);
	FUN_0040c5f0();
	pool::ReservedPool_AITask___Cleanup();
	pool::ReservedPool_LiveObject___Cleanup();
	pool::ReservedPool_ResourceData___Cleanup();
	pool::ReservedPool_Struct_20___Cleanup();
	if (globals::g_PROGRAMMER_MODE == PROGRAMMER_MODE_10) {
		BVar1 = Main_IsSoundEnabled();
		filename = "LoaderProfile.txt";
		if (BVar1 == 0) {
			filename = "LoaderProfileNoSound.txt";
		}
	}
	else {
		filename = NULL;
	}
	lego::file::Log_LoaderProfile(filename);
	other::logf_removed(unaff_EDI);
	pool::ReservedPool_ImageBMP___Cleanup();
	res::Res_CleanupSharedObjects();
	Main_DirectSoundCleanup();
	draw::Draw_FillSurface(NULL,0);
	return;
}



void __cdecl lego::main::Game_Exit(void)
{
	snd::Music_PlayNext(0);
	std::exit(0);
	return;
}



BOOL __cdecl
lego::game::Game_DoHotkeyChecks
					(undefined4 param_1,float param_2,BOOL *out_t,BOOL *put_r,BOOL *out_shift)
{
	BOOL *pBVar1;
	BOOL *pBVar2;
	BOOL *pBVar3;
	LiveObject *pLVar4;
	ResourceData *resData;
	BOOL BVar5;
	uint uVar6;
	char *pcVar7;
	int iVar8;
	int iVar9;
	bool bVar10;
	float10 fVar11;
	ActivityType actType;
	undefined4 actData;
	float local_14;
	float local_10;
	Vector3F local_c;
	
										// 28 = DIK_RETURN (is enter released?)
	if ((((((globals::g_Game.flags2 & GAME2_ALLOWRENAME) != GAME2_NONE) &&
				(globals::g_KeyboardState_Current_TABLE[28] == 0)) &&
			 (globals::g_KeyboardState_Previous_TABLE[28] != 0)) &&
			(((globals::g_Game.unkbool_308 == 1 &&
				((globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE)) &&
			 ((pLVar4 = Game_GetPrimarySelectedObject(), pLVar4 != NULL &&
				(pLVar4->objType == OBJECT_MINIFIGURE)))))) &&
		 ((pLVar4->flags5_3f0 != LIVEOBJ5_NONE || (pLVar4->objLevel != 0)))) {
		resData = LiveObject_GetResource(pLVar4);
		res::Res_GetPosition(resData,NULL,&local_c);
		fVar11 = LiveObject_GetCollHeight(pLVar4);
		local_c.z = (float)((float10)local_c.z - fVar11 * (float10)0.5);
		FUN_00477590((int)globals::g_Game.ptr_1c,&local_14,&local_c);
		if ((40.0 <= local_14) &&
			 (((40.0 <= local_10 &&
				 ((ushort)((ushort)(local_14 < (float)globals::g_RESOLUTION.width - 40.0) << 8 |
									(ushort)(local_14 == (float)globals::g_RESOLUTION.width - 40.0) << 0xe) != 0)) &&
				((ushort)((ushort)(local_10 < (float)globals::g_RESOLUTION.height - 80.0) << 8 |
								 (ushort)(local_10 == (float)globals::g_RESOLUTION.height - 80.0) << 0xe) != 0)))) {
			FUN_00425b60(0,1);
			if (pLVar4->customName == NULL) {
				LiveObject_SetCustomName(pLVar4,"Object");
				*pLVar4->customName = '\0';
			}
			globals::g_Game.renameInput = pLVar4->customName;
			globals::g_Game.float_ee4 = local_14;
			globals::g_Game.float_ee8 = local_10;
		}
	}
	if (globals::g_KeyboardState_Current_TABLE[1] != 0) {
		if ((((globals::g_Game.flags2 & GAME2_INOPTIONSMENU) == GAME2_NONE) &&
				(BVar5 = FUN_004190d0(), BVar5 == 0)) &&
			 ((BVar5 = Level_IsObjectiveFinished(), BVar5 == 0 &&
				((globals::g_Game.flags1 & GAME1_UNK_8000000) == GAME1_NONE)))) {
			if ((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) != GAME2_NONE) {
				if (globals::g_KeyboardState_Current_TABLE[57] == 0) {
					if (globals::g_KeyboardState_Current_TABLE[28] != 0) {
						return 0;
					}
				}
				else {
					main::Main_DirectSoundCleanup();
					main::Game_Exit();
				}
			}
			FUN_00425b60(0,1);
			globals::g_Game.flags1 |= GAME1_PAUSED;
		}
		else {
			if (((globals::g_KeyboardState_Current_TABLE[1] != 0) &&
					((globals::g_Game.flags2 & GAME2_INOPTIONSMENU) == GAME2_NONE)) &&
				 ((BVar5 = FUN_004190d0(), BVar5 == 0 &&
					((BVar5 = Level_IsObjectiveFinished(), BVar5 == 0 &&
					 ((globals::g_Game.flags1 & GAME1_UNK_8000000) == GAME1_NONE)))))) {
				main::Main_DirectSoundCleanup();
				main::Game_Exit();
			}
		}
	}
	if ((globals::g_Game.flags2 & 2) != GAME2_NONE) {
		BVar5 = main::Config_IsFrontEndEnabled();
		if ((BVar5 == 0) || (globals::g_KeyboardState_Current_TABLE[57] != 0)) {
			main::Main_DirectSoundCleanup();
			main::Game_Exit();
		}
		else {
			if (globals::g_KeyboardState_Current_TABLE[28] != 0) {
				return 0;
			}
			BVar5 = FUN_00435870();
			if (BVar5 == 0) {
				return 0;
			}
		}
	}
	pBVar3 = out_shift;
	pBVar2 = put_r;
	pBVar1 = out_t;
	*out_t = 0;
	*put_r = 0;
	*out_shift = 0;
	if ((globals::g_Game.flags1 & (GAME1_CAMERADISABLED|GAME1_UNK_8000000)) == GAME1_NONE) {
		front::Front_DoF2InterfaceKeyAction();
		if ((globals::g_KeyboardState_Current_TABLE[57] != 0) &&
			 (globals::g_KeyboardState_Previous_TABLE[57] != globals::g_KeyboardState_Current_TABLE[57]))
		{
			Game_ToggleObjectUIsAlwaysVisible();
		}
		if ((globals::g_KeyboardState_Current_TABLE[42] != 0) ||
			 (globals::g_KeyboardState_Current_TABLE[54] != 0)) {
			*pBVar3 = 1;
		}
		if ((globals::g_Game.unkbool_308 == 1) &&
			 (uVar6 = nerps::funcs::NERPFunc__GetTutorialFlags(NULL), (uVar6 & 0x1000) == 0)) {
			if (globals::g_KeyboardState_Current_TABLE[208] != 0) {
				FUN_00436b22(globals::g_Game.structbc_24,param_2 * 0.02);
			}
			if (globals::g_KeyboardState_Current_TABLE[200] != 0) {
				FUN_00436b22(globals::g_Game.structbc_24,param_2 * -0.02);
			}
			if (globals::g_KeyboardState_Current_TABLE[203] != 0) {
				FUN_00436c16(globals::g_Game.structbc_24,param_2 * 0.02);
			}
			if (globals::g_KeyboardState_Current_TABLE[205] != 0) {
				FUN_00436c16(globals::g_Game.structbc_24,param_2 * -0.02);
			}
			if (globals::g_KeyboardState_Current_TABLE[12] != 0) {
				FUN_00436cc7(globals::g_Game.structbc_24,param_2 * 3.0);
			}
			if (globals::g_KeyboardState_Current_TABLE[13] != 0) {
				FUN_00436cc7(globals::g_Game.structbc_24,param_2 * -3.0);
			}
		}
		if ((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) != GAME2_NONE) {
			if (globals::g_KeyboardState_Current_TABLE[71] != 0) {
				Game_SetGameSpeed(3.0);
			}
			if (globals::g_KeyboardState_Current_TABLE[20] != 0) {
				*pBVar1 = 1;
			}
			if (globals::g_KeyboardState_Current_TABLE[19] != 0) {
				*pBVar2 = 1;
			}
			if (((globals::g_KeyboardState_Current_TABLE[38] != 0) &&
					(globals::g_KeyboardState_Previous_TABLE[38] != globals::g_KeyboardState_Current_TABLE[38]
					)) && (BVar5 = FUN_00435870(), BVar5 == 0)) {
				return 0;
			}
			if (((globals::g_KeyboardState_Current_TABLE[29] != 0) &&
					(globals::g_KeyboardState_Current_TABLE[33] != 0)) &&
				 (globals::g_KeyboardState_Previous_TABLE[33] != globals::g_KeyboardState_Current_TABLE[33])
				 ) {
				if ((globals::g_Game.flags1 & GAME1_FRAMERATEMONITOR) == GAME1_NONE) {
					globals::g_Game.flags1 |= GAME1_FRAMERATEMONITOR;
				}
				else {
					globals::g_Game.flags1 &= ~GAME1_FRAMERATEMONITOR;
				}
				pcVar7 = "ON";
				if ((globals::g_Game.flags1 & GAME1_FRAMERATEMONITOR) == GAME1_NONE) {
					pcVar7 = "OFF";
				}
				Game_DisplayInfoMessage(globals::g_Game.struct830_80,"\nFrame Rate Monitor: %s",pcVar7);
			}
			if ((((globals::g_Game.flags1 & GAME1_RADARON) != GAME1_NONE) &&
					(globals::g_KeyboardState_Current_TABLE[15] != 0)) &&
				 (globals::g_KeyboardState_Previous_TABLE[15] != globals::g_KeyboardState_Current_TABLE[15])
				 ) {
				bVar10 = (globals::g_Game.flags1 & GAME1_RADAR_TRACKOBJECTVIEW) == GAME1_NONE;
				if (bVar10) {
					globals::g_Game.flags1 =
							 globals::g_Game.flags1 &
							 (GAME1_HIGHFOGCOLOURRGB|GAME1_UNK_20000|GAME1_UNK_40000|GAME1_DYNAMICPM|
								GAME1_CAMERADISABLED|GAME1_UNK_200000|GAME1_ONLYBUILDONPATHS|GAME1_ALWAYSROCKFALL|
								GAME1_DEBUG_NONERPS|GAME1_PAUSED|GAME1_STREAMNERPSSPEACH|GAME1_UNK_8000000|
								GAME1_LASERTRACKER|GAME1_UNK_20000000|GAME1_DEBUG_NOCLIP_FPS|GAME1_UNK_80000000) |
							 (ushort)((ushort)globals::g_Game.flags1 | 0x2000) & ~GAME1_RADAR_MAPVIEW;
					FUN_0045ad80(0,2,1);
				}
				else {
					globals::g_Game.flags1 =
							 globals::g_Game.flags1 & ~GAME1_RADAR_TRACKOBJECTVIEW | GAME1_RADAR_MAPVIEW;
					FUN_0045ad80(0,2,0);
				}
				FUN_0045ad80(0,3,(uint)bVar10);
			}
			if (globals::g_KeyboardState_Current_TABLE[29] != 0) {
				if ((globals::g_KeyboardState_Current_TABLE[34] != 0) &&
					 (globals::g_KeyboardState_Previous_TABLE[34] !=
						globals::g_KeyboardState_Current_TABLE[34])) {
					if ((globals::g_Game.flags1 & GAME1_MEMORYMONITOR) == GAME1_NONE) {
						globals::g_Game.flags1 |= GAME1_MEMORYMONITOR;
					}
					else {
						globals::g_Game.flags1 &= ~GAME1_MEMORYMONITOR;
					}
					pcVar7 = "ON";
					if ((globals::g_Game.flags1 & GAME1_MEMORYMONITOR) == GAME1_NONE) {
						pcVar7 = "OFF";
					}
					Game_DisplayInfoMessage(globals::g_Game.struct830_80,"\nMemory Monitor: %s",pcVar7);
				}
				if (((globals::g_KeyboardState_Current_TABLE[29] != 0) &&
						(globals::g_KeyboardState_Current_TABLE[28] != 0)) &&
					 (globals::g_KeyboardState_Previous_TABLE[28] !=
						globals::g_KeyboardState_Current_TABLE[28])) {
					if ((globals::g_Game.flags1 & GAME1_DEBUG_NOCLIP_FPS) == GAME1_NONE) {
						globals::g_Game.flags1 |= GAME1_DEBUG_NOCLIP_FPS;
					}
					else {
						globals::g_Game.flags1 &= ~GAME1_DEBUG_NOCLIP_FPS;
					}
				}
			}
		}
		if ((globals::g_Game.unkbool_308 == 0) &&
			 ((*(byte *)&(globals::g_Game.object_a0)->flags2_3e4 & 1) == 0)) {
										// First person controls?
			if (globals::g_KeyboardState_Current_TABLE[200] != 0) {
				FUN_0044a5d0((int *)globals::g_Game.object_a0,1,0,0.0);
			}
			if (globals::g_KeyboardState_Current_TABLE[208] != 0) {
				FUN_0044a5d0((int *)globals::g_Game.object_a0,-1,0,0.0);
			}
			if (globals::g_KeyboardState_Current_TABLE[203] != 0) {
				FUN_0044a5d0((int *)globals::g_Game.object_a0,0,0,-0.05);
			}
			if (globals::g_KeyboardState_Current_TABLE[205] != 0) {
				FUN_0044a5d0((int *)globals::g_Game.object_a0,0,0,0.05);
			}
			if (globals::g_KeyboardState_Current_TABLE[44] != 0) {
				FUN_0044a5d0((int *)globals::g_Game.object_a0,0,-1,0.0);
			}
			if (globals::g_KeyboardState_Current_TABLE[45] != 0) {
				FUN_0044a5d0((int *)globals::g_Game.object_a0,0,1,0.0);
			}
		}
		if ((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) != GAME2_NONE) {
			if ((globals::g_KeyboardState_Current_TABLE[31] != 0) &&
				 (globals::g_KeyboardState_Previous_TABLE[31] != globals::g_KeyboardState_Current_TABLE[31])
				 ) {
				if ((globals::g_Game.flags1 & GAME1_SOUNDON) == GAME1_NONE) {
					main::Config_SetSoundEnabled(1);
					lego::snd::Snd_Play_FUN_00465260(7,1);
				}
				else {
					main::Config_SetSoundEnabled(0);
				}
				pcVar7 = "ON";
				if ((globals::g_Game.flags1 & GAME1_SOUNDON) == GAME1_NONE) {
					pcVar7 = "OFF";
				}
				Game_DisplayInfoMessage(globals::g_Game.struct830_80,"\nSound Effects: %s",pcVar7);
			}
			if ((globals::g_KeyboardState_Current_TABLE[50] != 0) &&
				 (globals::g_KeyboardState_Previous_TABLE[50] != globals::g_KeyboardState_Current_TABLE[50])
				 ) {
				lego::snd::Music_PlayNext((uint)((globals::g_Game.flags1 & GAME1_MUSICON) == GAME1_NONE));
				pcVar7 = "ON";
				if ((globals::g_Game.flags1 & GAME1_MUSICON) == GAME1_NONE) {
					pcVar7 = "OFF";
				}
				Game_DisplayInfoMessage(globals::g_Game.struct830_80,"\nMusic: %s",pcVar7);
			}
		}
		if ((((globals::g_Game.flags2 & GAME2_ALLOWEDITMODE) != GAME2_NONE) &&
				(globals::g_KeyboardState_Current_TABLE[82] != 0)) &&
			 (globals::g_KeyboardState_Previous_TABLE[82] != globals::g_KeyboardState_Current_TABLE[82]))
		{
			debug::Debug_AllowEditModeFunc1(globals::g_Game.structbc_24,0);
			FUN_004649e0(globals::g_Game.RES_2f4_TABLEUNK,1);
		}
		if ((((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) != GAME2_NONE) &&
				(globals::g_KeyboardState_Current_TABLE[44] != 0)) &&
			 (globals::g_KeyboardState_Previous_TABLE[44] != globals::g_KeyboardState_Current_TABLE[44]))
		{
			FUN_00435e62(globals::g_Game.structbc_24,5.0,25.0);
			pLVar4 = Game_GetPrimarySelectedObject();
			if (pLVar4 != NULL) {
				pLVar4 = Game_GetPrimarySelectedObject();
				actData = 0;
				actType = ACTIVITY_EAT;
				pLVar4->flags1_3e0 = pLVar4->flags1_3e0 | LIVEOBJ1_EATING;
				pLVar4 = Game_GetPrimarySelectedObject();
				LiveObject_SetActivityUnk(pLVar4,actType,actData);
				pLVar4 = Game_GetPrimarySelectedObject();
				Game_UpdateSomeAITasks(pLVar4);
				pLVar4 = Game_GetPrimarySelectedObject();
				FUN_00403e60(pLVar4);
			}
		}
	}
	iVar9 = 0;
	param_2 = 0.0;
	if ((DAT_004df540 != 0) && (globals::g_ButtonState_LeftDown == 0)) {
		iVar9 = 1;
	}
	if ((globals::g_KeyboardState_Current_TABLE[57] == 0) ||
		 (globals::g_KeyboardState_Previous_TABLE[57] == globals::g_KeyboardState_Current_TABLE[57])) {
		iVar8 = 0;
	}
	else {
		iVar8 = 1;
	}
	iVar9 = FUN_00458c80(iVar8,iVar9,(uint *)&param_2);
	if ((((iVar9 == 0) && (BVar5 = FUN_004190d0(), BVar5 == 0)) &&
			(BVar5 = Level_IsObjectiveFinished(), BVar5 == 0)) &&
		 (((globals::g_Game.flags1 & GAME1_UNK_8000000) == GAME1_NONE &&
			((globals::g_Game.flags2 & GAME2_INOPTIONSMENU) == GAME2_NONE)))) {
		if ((globals::g_KeyboardState_Current_TABLE[25] != 0) &&
			 (globals::g_KeyboardState_Previous_TABLE[25] != globals::g_KeyboardState_Current_TABLE[25]))
		{
			FUN_00425b60(1,0);
			globals::g_Game.flags1 ^= GAME1_PAUSED;
		}
		if (globals::wnd::g_IsFocused == 0) {
			pcVar7 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","LoseFocusAndPause",0);
			uVar6 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,pcVar7);
			if (((uVar6 == 1) && ((globals::g_Game.flags1 & GAME1_UNK_8000000) == GAME1_NONE)) &&
				 (FUN_00425b60(0,1), (globals::g_Game.flags1 & GAME1_PAUSED) == GAME1_NONE)) {
				globals::g_Game.flags1 |= GAME1_PAUSED;
			}
		}
	}
	DAT_004df540 = globals::g_ButtonState_LeftDown;
	if (param_2 != 0.0) {
		return 0;
	}
	if ((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) != GAME2_NONE) {
		if (globals::g_KeyboardState_Current_TABLE[42] == 0) {
			if (globals::g_KeyboardState_Current_TABLE[6] != 0) {
				globals::g_CursorLightLevel_Base = globals::g_CursorLightLevel_Base - 0.02;
				res::Res_SetLightPenumbra(globals::g_Game.struct2c_44,globals::g_CursorLightLevel_Base);
			}
			if (globals::g_KeyboardState_Current_TABLE[7] != 0) {
				globals::g_CursorLightLevel_Current = globals::g_CursorLightLevel_Current - 0.02;
				goto LAB_004259b9;
			}
		}
		else {
			if (globals::g_KeyboardState_Current_TABLE[6] != 0) {
				globals::g_CursorLightLevel_Base = globals::g_CursorLightLevel_Base - -0.02;
				res::Res_SetLightPenumbra(globals::g_Game.struct2c_44,globals::g_CursorLightLevel_Base);
			}
			if (globals::g_KeyboardState_Current_TABLE[7] != 0) {
				globals::g_CursorLightLevel_Current = globals::g_CursorLightLevel_Current - -0.02;
LAB_004259b9:
				res::Res_SetLightUmbra(globals::g_Game.struct2c_44,globals::g_CursorLightLevel_Current);
			}
		}
		if ((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) != GAME2_NONE) goto LAB_004259d8;
	}
	if ((globals::g_CMDLINE_FLAGS & CMD_DEBUGCOMPLETE) == CMD_NONE) {
		return 1;
	}
LAB_004259d8:
	if (globals::g_KeyboardState_Current_TABLE[29] != 0) {
		if ((globals::g_KeyboardState_Current_TABLE[32] != 0) &&
			 (globals::g_KeyboardState_Previous_TABLE[32] != globals::g_KeyboardState_Current_TABLE[32]))
		{
			nerps::funcs::NERPFunc__SetLevelFail(NULL);
		}
		if ((globals::g_KeyboardState_Current_TABLE[31] != 0) &&
			 (globals::g_KeyboardState_Previous_TABLE[31] != globals::g_KeyboardState_Current_TABLE[31]))
		{
			nerps::funcs::NERPFunc__SetLevelCompleted(NULL);
		}
	}
	if (((globals::g_KeyboardState_Current_TABLE[157] != 0) &&
			(globals::g_KeyboardState_Current_TABLE[31] != 0)) &&
		 (globals::g_KeyboardState_Previous_TABLE[31] != globals::g_KeyboardState_Current_TABLE[31])) {
		Level_SetCompleteStatus(LEVELSTATUS_FAILED_CRYSTALS);
	}
	if (globals::g_KeyboardState_Current_TABLE[24] != 0) {
		(globals::g_Game.level)->oxygenLevel = (globals::g_Game.level)->oxygenLevel - 1.0;
	}
	return 1;
}



void FUN_00425a70(undefined param_1)
{
	FUN_00437a70(FUN_00425a90,(LiveObject *)&param_1);
	return;
}



undefined4 __cdecl FUN_00425a90(LiveObject *liveObj,int *param_2)
{
	ResourceData *resData;
	int iVar1;
	BOOL flag2;
	BOOL flag4;
	Vector3F *opt_position;
	
	resData = lego::game::LiveObject_GetResource(liveObj);
	if (resData != NULL) {
		if ((liveObj->flags4_3ec & 0x20000) == 0) {
			if (*param_2 != 0) {
				lego::snd::Sample_StopSoundBufferInstance(liveObj->field_350);
			}
			if ((*(byte *)&liveObj->flags1_3e0 & 8) != 0) {
				opt_position = NULL;
				flag4 = 1;
				flag2 = 1;
				iVar1 = lego::game::LiveObject_GetDrillSoundType(liveObj,0);
				lego::res::Res_PlayResourceSound(resData,iVar1,flag2,flag4,opt_position);
				liveObj->field_350 = iVar1;
				liveObj->flags4_3ec = liveObj->flags4_3ec | 0x100000;
			}
		}
		if (*param_2 != 0) {
			lego::snd::Sample_StopSoundBufferInstance(liveObj->field_354);
		}
		iVar1 = lego::game::LiveObject_GetEngineSound(liveObj);
		if (iVar1 != 0) {
			lego::res::Res_PlayResourceSound(resData,iVar1,1,1,NULL);
			liveObj->field_354 = iVar1;
			liveObj->flags4_3ec = liveObj->flags4_3ec | 0x80000;
		}
	}
	return 0;
}



void __cdecl FUN_00425b60(int param_1,uint param_2)
{
	if ((lego::globals::g_Game.flags2 & 2) == GAME2_NONE) {
		if (param_1 != 0) {
			param_2 = ~lego::globals::g_Game.flags1 >> 0x14 & 1;
		}
		if (param_2 != 0) {
			if ((lego::globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE) {
				FUN_0047b420();
			}
			lego::globals::g_Game.flags1 = lego::globals::g_Game.flags1 | GAME1_CAMERADISABLED;
			lego::globals::g_Game.flags2 = lego::globals::g_Game.flags2 | GAME2_INMENU;
			return;
		}
		FUN_00425a70(0);
		lego::snd::Snd_Play_FUN_00465260(7,1);
		lego::globals::g_Game.flags1 &= ~GAME1_CAMERADISABLED;
		lego::globals::g_Game.flags2 &= ~GAME2_INMENU;
	}
	return;
}



void __cdecl lego::game::Game_UnkSetGameSpeed_UnkBool(BOOL param_1)
{
	globals::g_GameSpeed_UnkBool = param_1;
	return;
}



void __cdecl lego::game::Game_SetGameSpeed(float newGameSpeed)
{
	if ((globals::g_Game.gameSpeed <= newGameSpeed) || (globals::g_GameSpeed_UnkBool == 0)) {
		front::FrontEnd_UpdateGameSpeedSlider();
		globals::g_Game.gameSpeed = newGameSpeed;
		if (newGameSpeed < 0.0) {
			globals::g_Game.gameSpeed = 0.0;
		}
										// Debug mode allows game speeds up to 300%
		if ((ushort)((ushort)(globals::g_Game.gameSpeed < 3.0) << 8 |
								(ushort)(globals::g_Game.gameSpeed == 3.0) << 0xe) == 0) {
			globals::g_Game.gameSpeed = 3.0;
		}
	}
	return;
}



void __cdecl FUN_00425c80(LiveObject *liveObj)
{
	float10 fVar1;
	float fVar2;
	float fVar3;
	
	fVar3 = 0.01;
	fVar2 = 0.7;
	fVar1 = lego::game::LiveObject_GetTrackDist(liveObj);
	FUN_00435deb((int)lego::globals::g_Game.structbc_28,liveObj,2.0,(float)fVar1,fVar2,fVar3);
	return;
}



BOOL __cdecl lego::unk::Game_IsNotBool308__00425cb0(void)
{
	return (uint)(globals::g_Game.unkbool_308 == 0);
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_00425cc0(void)
{
	LevelData *pLVar1;
	uint uVar2;
	int iVar3;
	float fVar4;
	char *pcVar5;
	LevelBlockFlags1 LVar6;
	float10 fVar7;
	float fVar8;
	LiveObject *local_30;
	float local_2c;
	uint local_28;
	int local_24;
	int local_20;
	float local_1c;
	float local_18;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	pLVar1 = lego::globals::g_Game.level;
	if ((lego::globals::g_Game.flags1 & GAME1_RADARON) == GAME1_NONE) {
		return;
	}
	if ((lego::globals::g_Game.flags1 & GAME1_RADAR_MAPVIEW) == GAME1_NONE) {
		return;
	}
	if ((lego::globals::g_Game.flags1 & GAME1_UNK_100) != GAME1_NONE) {
		return;
	}
	local_1c = (float)lego::globals::g_MousePosition.x - (float)DAT_004df414;
	local_10 = DAT_004df410;
	local_c = 0.0;
	local_18 = (float)lego::globals::g_MousePosition.y - (float)(int)DAT_004df410;
	FUN_0045cee0(0);
	uVar2 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
	if ((uVar2 & 0x1000) == 0) {
		_DAT_004df54c = SQRT(local_18 * local_18 + local_1c * local_1c) + _DAT_004df54c;
	}
	if ((((DAT_004df55c != 0) && (lego::globals::g_ButtonState_LeftDown != 0)) &&
			(4.0 <= _DAT_004df54c)) &&
		 (iVar3 = FUN_0045e990((int **)pLVar1->struct3c_84,lego::globals::g_MousePosition.x,
													 lego::globals::g_MousePosition.y,&local_10,(int *)&local_2c,
													 (int *)&local_28), iVar3 != 0)) {
		FUN_00436d0b((int *)lego::globals::g_Game.structbc_24,&local_1c);
		fVar4 = (float)lego::main::Main_GetMouseScrollIndent();
		if (((uint)local_2c < (uint)fVar4) ||
			 (iVar3 = lego::main::Main_GetMouseScrollIndent(),
			 (uint)((pLVar1->surfaceMap->smallDimensions).width - iVar3) <= (uint)local_2c)) {
			local_10 = local_1c;
		}
		uVar2 = lego::main::Main_GetMouseScrollIndent();
		if ((local_28 < uVar2) ||
			 (iVar3 = lego::main::Main_GetMouseScrollIndent(),
			 (uint)((pLVar1->surfaceMap->smallDimensions).height - iVar3) <= local_28)) {
			local_c = local_18;
		}
		if (lego::globals::g_Game.unkbool_308 == 1) {
			FUN_00436d2d(lego::globals::g_Game.structbc_24,local_10,local_c);
		}
		FUN_0045cee0(0xc);
		lego::globals::g_Game.flags1 |= GAME1_UNK_200;
	}
	iVar3 = FUN_0045e920((int)pLVar1->struct3c_84,lego::globals::g_MousePosition.x,
											 lego::globals::g_MousePosition.y);
	if (((iVar3 != 0) && (lego::globals::g_ButtonState_LeftDown != 0)) && (DAT_004df550 == 0)) {
		DAT_004df55c = 1;
	}
	if (4.0 <= _DAT_004df54c) goto LAB_004260b6;
	iVar3 = FUN_0045eae0((int **)pLVar1->struct3c_84,lego::globals::g_MousePosition.x,
											 lego::globals::g_MousePosition.y,&local_30,&local_8);
	if (iVar3 == 0) {
		if (lego::globals::g_ButtonState_LeftDown != 0) goto LAB_004260b6;
		if (DAT_004df550 != 0) {
			iVar3 = FUN_0045e990((int **)pLVar1->struct3c_84,lego::globals::g_MousePosition.x,
													 lego::globals::g_MousePosition.y,
													 (float *)&lego::globals::g_Game.tvFaceDirection_338,&local_20,&local_24);
			if (iVar3 != 0) {
				lego::globals::g_Game.flags1 |= GAME1_UNK_4000;
			}
			goto LAB_004260b6;
		}
		if ((false) ||
			 (iVar3 = FUN_0045e990((int **)pLVar1->struct3c_84,lego::globals::g_MousePosition.x,
														 lego::globals::g_MousePosition.y,NULL,(int *)&local_2c,(int *)&local_28
														), iVar3 == 0)) goto LAB_004260b6;
		if ((DAT_004df554 == local_2c) && (_DAT_004df558 == local_28)) {
			iVar3 = ((lego::globals::g_Game.level)->dimensions).width;
			if (((uint)local_2c < iVar3 - 1U) &&
				 (local_28 < ((lego::globals::g_Game.level)->dimensions).height - 1U)) {
				LVar6 = (lego::globals::g_Game.level)->blocks[local_28 * iVar3 + (int)local_2c].flags1 & 4;
			}
			else {
				LVar6 = BLOCK1_NONE;
			}
			if (LVar6 != BLOCK1_NONE) {
				local_1c = local_2c;
				local_18 = (float)local_28;
				FUN_00428260((int *)&local_1c,0,1,1);
			}
			goto LAB_004260b6;
		}
		DAT_004df554 = local_2c;
		_DAT_004df558 = local_28;
		iVar3 = 0;
	}
	else {
		if (lego::globals::g_ButtonState_LeftDown != 0) goto LAB_004260b6;
		if (DAT_004df550 != 0) {
			if (lego::globals::g_Game.unkbool_308 == 1) {
				FUN_00436d2d(lego::globals::g_Game.structbc_24,local_8,local_4);
			}
			fVar8 = 0.01;
			fVar4 = 0.7;
			fVar7 = lego::game::LiveObject_GetTrackDist(local_30);
			FUN_00435deb((int)lego::globals::g_Game.structbc_28,local_30,2.0,(float)fVar7,fVar4,fVar8);
			lego::globals::g_Game.flags1 &= ~GAME1_UNK_4000;
			goto LAB_004260b6;
		}
		FUN_0045cee0(0xd);
		pcVar5 = lego::game::LiveObject_GetName(local_30);
		lego::unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(2,"%s",pcVar5);
		iVar3 = lego::game::LiveObject_GetObjTtSFX(local_30);
		FUN_0046b9c0(2,iVar3);
		iVar3 = 2;
	}
	FUN_0046ba30(iVar3);
LAB_004260b6:
	if (lego::globals::g_ButtonState_LeftDown == 0) {
		_DAT_004df54c = (float)lego::globals::g_ButtonState_LeftDown;
		DAT_004df55c = lego::globals::g_ButtonState_LeftDown;
	}
	DAT_004df410 = (float)lego::globals::g_MousePosition.y;
	DAT_004df414 = lego::globals::g_MousePosition.x;
	DAT_004df550 = lego::globals::g_ButtonState_LeftDown;
	return;
}



void __cdecl lego::unk::Lego_unkSlug__004260f0(float param_1)
{
	int iVar1;
	
	if (((globals::g_Game.level)->Slug != 0x14) &&
		 (globals::g_Game.InitialSlugTime = globals::g_Game.InitialSlugTime - param_1,
		 globals::g_Game.InitialSlugTime < 0.0)) {
		iVar1 = FUN_00438c20(NULL,0);
		if (iVar1 != 0) {
			FUN_0043b010(NULL,(globals::g_Game.level)->Slug);
		}
		globals::g_Game.InitialSlugTime = (globals::g_Game.level)->SlugTime;
	}
	return;
}



void __cdecl lego::game::Game_GetVector_45c(Vector3F *param_1)
{
	param_1->x = globals::g_Game.vector_45c.x;
	param_1->y = globals::g_Game.vector_45c.y;
	param_1->z = globals::g_Game.vector_45c.z;
	return;
}



void __cdecl FUN_00426180(void)
{
	float local_8;
	float local_4;
	
	if ((lego::globals::g_Game.structbc_28)->object_4 == NULL) {
		lego::globals::g_Game.flags1 |= GAME1_UNK_4000;
	}
	if ((lego::globals::g_Game.flags1 & GAME1_UNK_4000) == GAME1_NONE) {
		lego::game::LiveObject_GetPosition
							((lego::globals::g_Game.structbc_28)->object_4,&local_8,&local_4);
	}
	else {
		local_8 = lego::globals::g_Game.tvFaceDirection_338.x;
		local_4 = lego::globals::g_Game.tvFaceDirection_338.y;
	}
	FUN_0045db60((int)(lego::globals::g_Game.level)->struct3c_84,
							 lego::globals::g_Game.tvTiltOrZoom_334);
	FUN_0045de80((lego::globals::g_Game.level)->struct3c_84,&local_8);
	return;
}



void __cdecl lego::game::Game_SetMenuNextPosition(Point2F *position)
{
	if (position != NULL) {
		globals::g_Game.flags2 = globals::g_Game.flags2 | GAME2_MENU_HASNEXT;
		globals::g_Game.menuNextPoint.x = position->x;
		globals::g_Game.menuNextPoint.y = position->y;
		return;
	}
	globals::g_Game.flags2 = globals::g_Game.flags2 & ~GAME2_MENU_HASNEXT;
	return;
}



void __cdecl lego::game::Game_SetMenuPreviousPosition(Point2F *position)
{
	if (position != NULL) {
		globals::g_Game.flags2 = globals::g_Game.flags2 | GAME2_MENU_HASPREVIOUS;
		globals::g_Game.menuPrevPoint.x = position->x;
		globals::g_Game.menuPrevPoint.y = position->y;
		return;
	}
	globals::g_Game.flags2 = globals::g_Game.flags2 & ~GAME2_MENU_HASPREVIOUS;
	return;
}



void __cdecl FUN_00426290(BOOL param_1,BOOL param_2)
{
	GameFlags2 GVar1;
	
	if (param_1 == 0) {
		GVar1 = lego::globals::g_Game.flags2 & ~GAME2_UNK_40;
	}
	else {
		GVar1 = lego::globals::g_Game.flags2 | GAME2_UNK_40;
	}
	if (param_2 != 0) {
		lego::globals::g_Game.flags2 = GVar1 | GAME2_CAMERAMOVING;
		return;
	}
	lego::globals::g_Game.flags2 = GVar1 & ~GAME2_CAMERAMOVING;
	return;
}



void __cdecl FUN_004262d0(BOOL state)
{
	if (state != 0) {
		lego::globals::g_Game.flags2 = lego::globals::g_Game.flags2 | GAME2_UNK_80;
		return;
	}
	lego::globals::g_Game.flags2 = lego::globals::g_Game.flags2 & ~GAME2_UNK_80;
	return;
}



void __cdecl FUN_004262f0(void)
{
	int local_4;
	
	local_4 = 1;
	FLAGS_00504610 = 0;
	lego::nerps::funcs::NERPFunc__SetMessagePermit(&local_4);
	FLOAT_00504618 = 0.0;
	FUN_00485c70(lego::globals::g_Game.struct830_80);
	FUN_00426290(0,0);
	FUN_004262d0(0);
	return;
}



void __cdecl FUN_00426350(float param_1)
{
	uint uVar1;
	float local_24;
	float local_20;
	undefined4 local_1c;
	float local_18;
	float local_14;
	undefined4 local_10;
	float local_c;
	float local_8;
	undefined4 local_4;
	
	if (lego::globals::g_Game.unkbool_308 == 1) {
		uVar1 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
		if ((uVar1 & 0x1000) == 0) {
			if (((((int)lego::globals::g_Game.MouseScrollBorder <= lego::globals::g_MousePosition.x) &&
					 ((int)lego::globals::g_Game.MouseScrollBorder <= lego::globals::g_MousePosition.y)) &&
					(lego::globals::g_MousePosition.x <=
					 (int)(lego::globals::g_RESOLUTION.width - lego::globals::g_Game.MouseScrollBorder))) &&
				 (lego::globals::g_MousePosition.y <=
					(int)(lego::globals::g_RESOLUTION.height - lego::globals::g_Game.MouseScrollBorder))) {
				FUN_00435e46((int)lego::globals::g_Game.structbc_24);
				return;
			}
			FUN_00436d55((int *)lego::globals::g_Game.structbc_24,
									 (uint *)(lego::globals::g_Game.level)->surfaceMap,&local_18);
			FUN_004293a0(lego::globals::g_MousePosition.x,(float)lego::globals::g_MousePosition.y,
									 &local_24,&local_20);
			local_c = local_24 - local_18;
			local_8 = local_20 - local_14;
			local_10 = 0;
			local_1c = 0;
			local_4 = 0;
			FUN_00436da9((int)lego::globals::g_Game.structbc_24,&local_c,param_1);
		}
	}
	return;
}



void __cdecl
lego::game::Game_unkGameLoop_FUN_00426450
					(char *param_1,float param_2,undefined4 param_3,undefined4 param_4,int param_5)
{
	char cVar1;
	ObjectType OVar2;
	LevelData *pLVar3;
	BOOL BVar4;
	undefined4 uVar5;
	uint uVar6;
	LiveObject *pLVar7;
	ObjectStatsFlags3 OVar8;
	ObjectStatsFlags1 OVar9;
	LiveObject *pLVar10;
	LevelBlockFlags1 LVar11;
	float fVar12;
	int iVar13;
	bool bVar14;
	float fVar15;
	uint uVar16;
	float fVar17;
	undefined4 uVar18;
	uint *puVar19;
	float fVar20;
	int local_40;
	LiveObject *local_3c;
	float local_38;
	uint local_34;
	BOOL local_30;
	int local_2c;
	int local_28;
	float local_24;
	float fStack32;
	Point2F local_1c;
	float local_14 [2];
	float local_c;
	float local_8;
	float local_4;
	
	pLVar3 = globals::g_Game.level;
	globals::g_Game.flags2 &= ~GAME2_MOUSE_INSIDEGAMEVIEW;
	iVar13 = 0;
	local_3c = NULL;
	local_28 = 0;
	local_2c = 0;
	local_40 = 0;
	local_30 = 0;
	FUN_004649e0(globals::g_Game.RES_2f4_TABLEUNK,1);
	if ((globals::g_ButtonState_LeftDown == 0) && (globals::g_ButtonState_RightDown == 0)) {
		FLOAT_004df56c = FLOAT_004df56c + (float)param_1;
	}
	else {
		FLOAT_004df56c = 0.0;
	}
	if (BOOL_004df564 != 0) {
		if (globals::g_ButtonState_LeftDown == 0) {
			if ((globals::g_Game.flags1 & GAME1_UNK_100) == GAME1_NONE) {
				iVar13 = 1;
				local_40 = 1;
			}
		}
		else {
			BOOL_004df560 = 1;
		}
	}
	if (globals::g_ButtonState_LeftDown == 0) {
		BOOL_004df560 = 0;
	}
	if ((BOOL_004df568 != 0) && (globals::g_ButtonState_RightDown == 0)) {
		local_30 = 1;
	}
	if (BOOL_004df560 == 0) {
		FLOAT_004df41c = 0.0;
		FLOAT_004df418 = 0.0;
	}
	else {
		FLOAT_004df418 =
				 (float)((globals::g_MouseDeltaPosition.x ^ globals::g_MouseDeltaPosition.x >> 0x1f) -
								(globals::g_MouseDeltaPosition.x >> 0x1f)) + FLOAT_004df418;
		local_24 = (float)((globals::g_MouseDeltaPosition.y ^ globals::g_MouseDeltaPosition.y >> 0x1f) -
											(globals::g_MouseDeltaPosition.y >> 0x1f));
		FLOAT_004df41c = (float)(int)local_24 + FLOAT_004df41c;
	}
	FUN_00418cd0(globals::g_MousePosition.x,globals::g_MousePosition.y,globals::g_ButtonState_LeftDown
							 ,BOOL_004df564,iVar13,(float)param_1);
	if ((globals::g_Game.flags1 & GAME1_CAMERADISABLED) != GAME1_NONE) {
		FUN_0045cee0(0);
		BOOL_004df564 = globals::g_ButtonState_LeftDown;
		BOOL_004df568 = globals::g_ButtonState_RightDown;
		BOOL_004df570 = 1;
		globals::g_Game.flags1 = globals::g_Game.flags1 & ~(GAME1_UNK_100|GAME1_UNK_200);
		return;
	}
	if (BOOL_004df570 != 0) {
		BOOL_004df564 = 0;
		BOOL_004df568 = 0;
		BOOL_004df560 = 0;
		local_40 = 0;
		local_30 = 0;
		BOOL_004df570 = 0;
	}
	BVar4 = FUN_004505a0((globals::g_Game.level)->surfaceMap,(int)globals::g_Game.ptr_1c,
											 globals::g_MousePosition.x,globals::g_MousePosition.y,&local_34,
											 (uint *)&local_38,&local_c);
	bVar14 = BVar4 == 0;
	if (!bVar14) {
		param_1 = (char *)(pLVar3->blocks + (pLVar3->dimensions).width * (int)local_38 + local_34);
		res::Res_SetFramePosition(globals::g_Game.struct2c_48,NULL,local_c,local_8,local_4 - 250.0);
	}
	FUN_0044dce0((uint)bVar14);
	if ((globals::g_Game.flags1 & GAME1_UNK_8000000) != GAME1_NONE) {
		FUN_00426350(param_2);
		FUN_0045cee0(0);
		globals::g_Game.flags1 = globals::g_Game.flags1 & ~(GAME1_UNK_100|GAME1_UNK_200);
		return;
	}
	uVar5 = FUN_0045cf20();
	if (((globals::g_Game.flags1 & GAME1_UNK_100) == GAME1_NONE) &&
		 (BVar4 = Game_IsAnyUnitsSelected(), BVar4 != 0)) {
		uVar18 = 2;
	}
	else {
		uVar18 = 0;
	}
	FUN_0045cee0(uVar18);
	if (((globals::g_Game.flags1 & GAME1_UNK_100) == GAME1_NONE) &&
		 (BVar4 = FUN_0045b070(param_2,globals::g_MousePosition.x,globals::g_MousePosition.y,
													 globals::g_ButtonState_LeftDown,BOOL_004df564,&local_2c), BVar4 != 0)) {
		FUN_00426350(param_2);
		globals::g_Game.flags1 |= GAME1_UNK_200;
		goto LAB_00427c9c;
	}
	FUN_00426350(param_2);
	if ((globals::g_Game.flags1 & GAME1_UNK_100) == GAME1_NONE) {
		iVar13 = FUN_0045d3d0(globals::g_MousePosition.x,globals::g_MousePosition.y,
													globals::g_ButtonState_LeftDown,BOOL_004df564,local_40);
		if (iVar13 != 0) {
			globals::g_Game.flags1 |= GAME1_UNK_200;
			goto LAB_00427c9c;
		}
		if ((((globals::g_Game.flags1 & GAME1_UNK_100) == GAME1_NONE) &&
				((globals::g_Game.flags2 & GAME2_INMENU) == GAME2_NONE)) &&
			 (uVar6 = GameUnk_DoSomethingWithRenameReplace
													(globals::g_MousePosition.x,globals::g_MousePosition.y,
													 globals::g_ButtonState_LeftDown,BOOL_004df564,local_40), uVar6 != 0)) {
			globals::g_Game.flags1 |= GAME1_UNK_200;
			goto LAB_00427c9c;
		}
		if (((globals::g_Game.flags1 & GAME1_UNK_100) != GAME1_NONE) ||
			 (iVar13 = FUN_0041a0d0(globals::g_MousePosition.x,globals::g_MousePosition.y,local_40),
			 iVar13 == 0)) goto LAB_0042682b;
		globals::g_Game.flags1 |= GAME1_UNK_200;
		if (local_40 == 0) goto LAB_00427c9c;
		iVar13 = 0;
LAB_00427c94:
		FUN_00428730(iVar13);
		goto LAB_00427c9c;
	}
LAB_0042682b:
	if (globals::g_Game.unkbool_308 == 0) {
		globals::g_Game.flags1 |= GAME1_UNK_200;
		goto LAB_00427c9c;
	}
	if ((((globals::g_Game.flags1 & GAME1_UNK_100) == GAME1_NONE) &&
			((globals::g_Game.flags1 & GAME1_RADARON) != GAME1_NONE)) &&
		 (iVar13 = FUN_0045e920((int)pLVar3->struct3c_84,globals::g_MousePosition.x,
														globals::g_MousePosition.y), iVar13 != 0)) {
		if (local_40 != 0) {
			FUN_00428730(0);
		}
		if ((globals::g_Game.flags1 & GAME1_RADAR_TRACKOBJECTVIEW) == GAME1_NONE) {
			FUN_0045cee0(uVar5);
		}
		goto LAB_00427c9c;
	}
	if (local_2c != 0) {
		bVar14 = false;
		if ((globals::g_Game.NextButton != NULL) &&
			 ((globals::g_Game.flags2 & GAME2_UNK_40) != GAME2_NONE)) {
			fVar15 = (float)globals::g_MousePosition.x;
			fVar12 = (float)(globals::g_Game.NextButton)->height;
			if ((((ushort)((ushort)(fVar15 < globals::g_Game.NextButtonPos.x) << 8 |
										(ushort)(fVar15 == globals::g_Game.NextButtonPos.x) << 0xe) == 0) &&
					(((fVar17 = (float)globals::g_MousePosition.y,
						(ushort)((ushort)(fVar17 < globals::g_Game.NextButtonPos.y) << 8 |
										(ushort)(fVar17 == globals::g_Game.NextButtonPos.y) << 0xe) == 0 &&
						(fStack32 = 0.0, local_24 = (float)(globals::g_Game.NextButton)->width,
						fVar15 < (float)(ulonglong)(uint)(globals::g_Game.NextButton)->width +
										 globals::g_Game.NextButtonPos.x)) &&
					 (fStack32 = 0.0, local_24 = fVar12,
					 fVar17 < (float)(ulonglong)(uint)fVar12 + globals::g_Game.NextButtonPos.y)))) &&
				 (FUN_0046ba30(0x20), local_40 != 0)) {
				FUN_00453be0();
				bVar14 = true;
			}
		}
		if ((globals::g_Game.BackButton != NULL) &&
			 ((globals::g_Game.flags2 & GAME2_UNK_80) != GAME2_NONE)) {
			fVar15 = (float)globals::g_MousePosition.x;
			fVar12 = (float)(globals::g_Game.BackButton)->height;
			if ((((ushort)((ushort)(fVar15 < globals::g_Game.BackButtonPos.x) << 8 |
										(ushort)(fVar15 == globals::g_Game.BackButtonPos.x) << 0xe) == 0) &&
					((fVar17 = (float)globals::g_MousePosition.y,
					 (ushort)((ushort)(fVar17 < globals::g_Game.BackButtonPos.y) << 8 |
									 (ushort)(fVar17 == globals::g_Game.BackButtonPos.y) << 0xe) == 0 &&
					 (fStack32 = 0.0, local_24 = (float)(globals::g_Game.BackButton)->width,
					 fVar15 < (float)(ulonglong)(uint)(globals::g_Game.BackButton)->width +
										globals::g_Game.BackButtonPos.x)))) &&
				 (fStack32 = 0.0, local_24 = fVar12,
				 fVar17 < (float)(ulonglong)(uint)fVar12 + globals::g_Game.BackButtonPos.y)) {
				FUN_0046ba30(0x1f);
				if (local_40 == 0) goto LAB_00427c9c;
				FUN_00453bd0();
				bVar14 = true;
			}
		}
		if ((local_40 == 0) || (bVar14)) goto LAB_00427c9c;
		iVar13 = 1;
		goto LAB_00427c94;
	}
	if (bVar14) goto LAB_00427c9c;
	globals::g_Game.vector_45c.y = local_8;
	globals::g_Game.vector_45c.x = local_c;
	globals::g_Game.vector_45c.z = local_4;
	globals::g_Game.flags2 |= GAME2_MOUSE_INSIDEGAMEVIEW;
	UINT_00557fb8 = local_34;
	UINT_00557fbc = (uint)local_38;
	if (((globals::g_Game.flags1 & GAME1_UNK_100) == GAME1_NONE) ||
		 ((globals::g_Game.flags3 & (GAME3_UNK_1|GAME3_PLACEBUILDING)) != GAME3_NONE)) {
		if ((globals::g_Game.flags3 & GAME3_PLACEBUILDING) == GAME3_NONE) {
			iVar13 = FUN_0043b620(globals::g_MousePosition.x,globals::g_MousePosition.y,&local_3c);
			if (iVar13 == 0) {
				if ((globals::g_Game.flags1 & GAME1_LASERTRACKER) != GAME1_NONE) {
					iVar13 = ((globals::g_Game.level)->dimensions).width;
					if (((local_34 < iVar13 - 1U) &&
							((uint)local_38 < ((globals::g_Game.level)->dimensions).height - 1U)) &&
						 ((LVar11 = (globals::g_Game.level)->blocks[(int)local_38 * iVar13 + local_34].flags1,
							(LVar11 & BLOCK1_UNK_10) != BLOCK1_NONE && ((LVar11 & BLOCK1_UNK_8) == BLOCK1_NONE))))
					{
						bVar14 = true;
					}
					else {
						bVar14 = false;
					}
					if (bVar14) {
						FUN_004350d0((uint)(byte)param_1[2]);
					}
					goto LAB_0042797a;
				}
				if (local_40 != 0) {
					*(int *)(param_1 + 0x28) = *(int *)(param_1 + 0x28) + 1;
				}
				if (((globals::g_Game.flags3 & GAME3_PICKUPOBJECT) != GAME3_NONE) ||
					 ((globals::g_Game.flags3 & GAME3_LOADVEHICLE) != GAME3_NONE)) {
					if ((globals::g_Game.flags3 & GAME3_PICKUPOBJECT) == GAME3_NONE) {
						uVar5 = 0x22;
					}
					else {
						uVar5 = 0x21;
					}
					goto LAB_00427972;
				}
				if (((globals::g_Game.flags3 & GAME3_UNK_20) == GAME3_NONE) &&
					 ((globals::g_Game.flags3 & GAME3_UNK_40) == GAME3_NONE)) {
					if (((globals::g_Game.flags3 & GAME3_UNK_2) == GAME3_NONE) &&
						 ((globals::g_Game.flags3 & GAME3_UNK_4) == GAME3_NONE)) {
						if ((globals::g_Game.flags3 & GAME3_UNK_1) == GAME3_NONE) {
							iVar13 = ((globals::g_Game.level)->dimensions).width;
							if ((local_34 < iVar13 - 1U) &&
								 ((uint)local_38 < ((globals::g_Game.level)->dimensions).height - 1U)) {
								LVar11 = (globals::g_Game.level)->blocks[(int)local_38 * iVar13 + local_34].flags1 &
												 4;
							}
							else {
								LVar11 = BLOCK1_NONE;
							}
							if (LVar11 != BLOCK1_NONE) {
								iVar13 = ((globals::g_Game.level)->dimensions).width;
								if ((((local_34 < iVar13 - 1U) &&
										 ((uint)local_38 < ((globals::g_Game.level)->dimensions).height - 1U)) &&
										(LVar11 = (globals::g_Game.level)->blocks[(int)local_38 * iVar13 + local_34].
															flags1, (LVar11 & BLOCK1_UNK_10) != BLOCK1_NONE)) &&
									 ((LVar11 & BLOCK1_UNK_8) == BLOCK1_NONE)) {
									bVar14 = true;
								}
								else {
									bVar14 = false;
								}
								if ((bVar14) &&
									 (((globals::g_Game.level)->blocks
										 [((globals::g_Game.level)->dimensions).width * UINT_00557fbc + UINT_00557fb8].
										 terrain == TERRAIN_IMMOVABLE ||
										((globals::g_Game.level)->blocks
										 [((globals::g_Game.level)->dimensions).width * UINT_00557fbc + UINT_00557fb8].
										 terrain == TERRAIN_RECHARGESEAM)))) {
									if ((param_1[8] & 8U) == 0) {
										FUN_004350d0((uint)(byte)param_1[2]);
									}
									if (BOOL_004df560 == 0) {
										FUN_00428260((int *)&UINT_00557fb8,1,1,0);
									}
									if (local_40 != 0) {
										FUN_00428730(2);
									}
								}
								else {
									fVar12 = 0.0;
									param_2 = 0.0;
									if ((param_1[8] & 8U) == 0) {
										FUN_004350d0((uint)(byte)param_1[2]);
									}
									if (BOOL_004df560 == 0) {
										FUN_00428260((int *)&UINT_00557fb8,1,1,0);
									}
									BVar4 = Game_IsAnyUnitsSelected();
									if (BVar4 != 0) {
										if ((globals::g_Game.flags1 & GAME1_UNK_40000) == GAME1_NONE) {
											if (((param_1[8] & 8U) == 0) &&
												 (iVar13 = FUN_00431960(local_34,(uint)local_38,0), iVar13 != 0)) {
												pLVar10 = Game_GetPrimarySelectedObject();
												if (pLVar10->objType == OBJECT_MINIFIGURE) {
													uVar5 = 0x1d;
												}
												else {
													uVar5 = 0x1e;
												}
												FUN_0045cee0(uVar5);
												front::Text_DisplayType(TEXT_NODRILL,0,0);
												cVar1 = param_1[2];
												if ((((cVar1 != '\x01') && (cVar1 != '\t')) && (cVar1 != '\v')) &&
													 ((param_1[8] & 0x40U) == 0)) {
													fVar12 = 1.401298e-45;
													param_2 = 1.401298e-45;
													pLVar10 = Game_GetPrimarySelectedObject();
													if (pLVar10->objType == OBJECT_MINIFIGURE) {
														uVar5 = 0x1f;
													}
													else {
														uVar5 = 0x20;
													}
													FUN_0045cee0(uVar5);
													front::Text_DisplayType(TEXT_DRILL,0,0);
													if ((local_40 != 0) &&
														 (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 == 0)) {
														FUN_00402440((Point2I *)&UINT_00557fb8,0,1);
														FUN_00401f40(8,0,(Point2I *)&UINT_00557fb8);
														goto LAB_004271d4;
													}
												}
											}
										}
										else {
											if ((*param_1 == '\x01') ||
												 (iVar13 = FUN_00431960(local_34,(uint)local_38,1), iVar13 == 0)) {
												globals::g_Game.bool_c8 = 0;
											}
											else {
												globals::g_Game.field_c4 = local_38;
												fVar12 = 1.401298e-45;
												globals::g_Game.field_c0 = local_34;
												param_2 = 1.401298e-45;
												globals::g_Game.bool_c8 = 1;
												if ((local_40 != 0) &&
													 (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 == 0)) {
													FUN_00402440((Point2I *)&UINT_00557fb8,1,1);
LAB_004271d4:
													param_2 = 1.401298e-45;
													fVar12 = 1.401298e-45;
													FUN_00428730(0);
													FUN_0041e680();
												}
											}
										}
										if ((fVar12 == 0.0) && ((*(uint *)(param_1 + 8) & 8) != 0)) {
											if ((((globals::g_Game.level)->blocks
														[((globals::g_Game.level)->dimensions).width * (int)local_38 + local_34]
														.flags1 & BLOCK1_UNK_400) == BLOCK1_NONE) &&
												 ((*(byte *)&(globals::g_Game.level)->blocks
																		 [((globals::g_Game.level)->dimensions).width * (int)local_38 +
																			local_34].flags2 & 4) == 0)) {
												bVar14 = false;
											}
											else {
												bVar14 = true;
											}
											if ((!bVar14) && ((param_1[0xc] & 0x20U) == 0)) {
												if ((*(uint *)(param_1 + 8) & 0x200000) == 0) {
													pLVar10 = Game_GetPrimarySelectedObject();
													OVar9 = LiveObject_GetStatsFlags1(pLVar10);
													if ((OVar9 & STATS1_CANCLEARRUBBLE) != STATS1_NONE) {
														BVar4 = 0;
														uVar6 = local_34;
														fVar15 = local_38;
														uVar16 = local_34;
														fVar17 = local_38;
														pLVar10 = Game_GetPrimarySelectedObject();
														iVar13 = FUN_00431cd0(pLVar10,uVar6,(int)fVar15,uVar16,(int)fVar17,BVar4
																								 );
														if (iVar13 != 0) {
															fVar12 = 1.401298e-45;
															param_2 = 1.401298e-45;
															pLVar10 = Game_GetPrimarySelectedObject();
															if (pLVar10->objType == OBJECT_MINIFIGURE) {
																uVar5 = 0x29;
															}
															else {
																uVar5 = 0x2a;
															}
															FUN_0045cee0(uVar5);
															if ((local_40 != 0) &&
																 (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 == 0)) {
																Level_AddMessageAction(MESSAGE_USERGOTO,0,0,&UINT_00557fb8);
																FUN_00401f40(0xc,0,(Point2I *)&UINT_00557fb8);
																FUN_00428730(0);
																FUN_0041e680();
															}
														}
													}
												}
												if (fVar12 != 0.0) goto LAB_0042797a;
												uVar6 = local_34;
												fVar15 = local_38;
												uVar16 = local_34;
												fVar17 = local_38;
												fVar20 = fVar12;
												pLVar10 = Game_GetPrimarySelectedObject();
												iVar13 = FUN_00431cd0(pLVar10,uVar6,(int)fVar15,uVar16,(int)fVar17,
																							(BOOL)fVar20);
												if (iVar13 != 0) {
													fVar12 = 1.401298e-45;
													param_2 = 1.401298e-45;
													pLVar10 = Game_GetPrimarySelectedObject();
													if (pLVar10->objType == OBJECT_MINIFIGURE) {
														uVar5 = 0x27;
													}
													else {
														uVar5 = 0x28;
													}
													FUN_0045cee0(uVar5);
													front::Text_DisplayType(TEXT_WALK,0,0);
													if ((local_40 != 0) &&
														 (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 == 0)) {
														Level_AddMessageAction(MESSAGE_USERGOTO,0,0,&UINT_00557fb8);
														FUN_00428730(0);
														FUN_0041e680();
													}
												}
											}
										}
									}
									if (fVar12 == 0.0) {
										if ((((globals::g_Game.level)->blocks
													[((globals::g_Game.level)->dimensions).width * (int)local_38 + local_34].
													flags1 & BLOCK1_UNK_400) == BLOCK1_NONE) &&
											 ((*(byte *)&(globals::g_Game.level)->blocks
																	 [((globals::g_Game.level)->dimensions).width * (int)local_38 +
																		local_34].flags2 & 4) == 0)) {
											bVar14 = false;
										}
										else {
											bVar14 = true;
										}
										if ((((!bVar14) && (cVar1 = param_1[2], cVar1 != '\x06')) && (cVar1 != '\t')) &&
											 ((param_1[0xc] & 0x20U) == 0)) {
											if ((*(uint *)(param_1 + 8) & 8) != 0) {
												if (((globals::g_Game.level)->blocks
														 [((globals::g_Game.level)->dimensions).width * UINT_00557fbc +
															UINT_00557fb8].flags1 & BLOCK1_UNK_80000000) != BLOCK1_NONE) {
													fVar12 = 1.401298e-45;
													param_2 = 1.401298e-45;
													if ((local_40 != 0) &&
														 (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 == 0)) {
														Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
														FUN_00428730(5);
														FUN_0041b200(2,(Point2I *)&UINT_00557fb8);
													}
												}
												if (((fVar12 == 0.0) && ((*(uint *)(param_1 + 8) & 0x8000) != 0)) &&
													 (param_2 = 1.401298e-45, local_40 != 0)) {
													FUN_00428730(1);
												}
												if ((((*(uint *)(param_1 + 8) & 0x100000) != 0) ||
														(((globals::g_Game.level)->blocks
															[((globals::g_Game.level)->dimensions).width * UINT_00557fbc +
															 UINT_00557fb8].flags1 & BLOCK1_UNK_40000000) != BLOCK1_NONE)) &&
													 (((globals::g_Game.level)->blocks
														 [((globals::g_Game.level)->dimensions).width * UINT_00557fbc +
															UINT_00557fb8].flags1 & BLOCK1_UNK_8000) == BLOCK1_NONE)) {
													if ((((int)UINT_00557fb8 < 0) || ((int)UINT_00557fbc < 0)) ||
														 ((iVar13 = ((globals::g_Game.level)->dimensions).width,
															iVar13 <= (int)UINT_00557fb8 ||
															(((globals::g_Game.level)->dimensions).height <= (int)UINT_00557fbc)))
														 ) {
														LVar11 = BLOCK1_NONE;
													}
													else {
														LVar11 = (globals::g_Game.level)->blocks
																		 [UINT_00557fbc * iVar13 + UINT_00557fb8].flags1 &
																		 BLOCK1_POWERPATH;
													}
													if (((LVar11 == BLOCK1_NONE) && (param_2 = 1.401298e-45, local_40 != 0))
														 && (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 == 0)) {
														FUN_00428730(5);
														FUN_0041b200(4,(Point2I *)&UINT_00557fb8);
													}
												}
												if (param_2 != 0.0) goto LAB_0042797a;
												if (((globals::g_Game.level)->blocks
														 [((globals::g_Game.level)->dimensions).width * UINT_00557fbc +
															UINT_00557fb8].flags1 & BLOCK1_UNK_40000000) == BLOCK1_NONE) {
													if ((((int)UINT_00557fb8 < 0) || ((int)UINT_00557fbc < 0)) ||
														 ((iVar13 = ((globals::g_Game.level)->dimensions).width,
															iVar13 <= (int)UINT_00557fb8 ||
															(((globals::g_Game.level)->dimensions).height <= (int)UINT_00557fbc)))
														 ) {
														LVar11 = BLOCK1_NONE;
													}
													else {
														LVar11 = (globals::g_Game.level)->blocks
																		 [UINT_00557fbc * iVar13 + UINT_00557fb8].flags1 &
																		 BLOCK1_POWERPATH;
													}
													fVar12 = param_2;
													if (LVar11 != BLOCK1_NONE) goto LAB_004275d9;
												}
												else {
LAB_004275d9:
													fVar12 = 1.401298e-45;
													if ((local_40 != 0) &&
														 (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 == 0)) {
														Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
														FUN_00428730(5);
														FUN_0041b200(1,(Point2I *)&UINT_00557fb8);
													}
												}
												if (fVar12 == 0.0) {
													if ((((*(uint *)(param_1 + 8) & 0x200000) != 0) &&
															(fVar12 = 1.401298e-45, local_40 != 0)) &&
														 (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 == 0)) {
														Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
														FUN_00428730(5);
														FUN_0041b200(1,(Point2I *)&UINT_00557fb8);
													}
													if (fVar12 == 0.0) {
														if ((((*(uint *)(param_1 + 8) & 0x200000) != 0) ||
																(fVar12 = 1.401298e-45, local_40 == 0)) ||
															 (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 != 0))
														goto LAB_00427713;
														Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
														FUN_00428730(5);
														iVar13 = 5;
														goto LAB_0042770b;
													}
												}
												goto LAB_0042797a;
											}
											if (((cVar1 == '\x01') || ((*(uint *)(param_1 + 8) & 0x40) != 0)) ||
												 ((fVar12 = 1.401298e-45, local_40 == 0 ||
													(iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 != 0))))
											goto LAB_00427713;
											Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
											FUN_00428730(4);
											iVar13 = 7;
LAB_0042770b:
											fVar12 = 1.401298e-45;
											FUN_0041b200(iVar13,(Point2I *)&UINT_00557fb8);
										}
LAB_00427713:
										if (fVar12 == 0.0) goto LAB_0042771b;
									}
								}
								goto LAB_0042797a;
							}
						}
						else {
							globals::g_Game.flags1 |= GAME1_UNK_200;
							FUN_0045cee0(0xf);
							front::Text_DisplayType(TEXT_ENCYCLOPEDIA,0,0);
						}
LAB_0042771b:
						if (local_40 != 0) {
LAB_00427727:
							FUN_00428730(1);
						}
					}
					else {
						if ((globals::g_Game.flags3 & GAME3_UNK_2) == GAME3_NONE) {
							uVar5 = 0x26;
						}
						else {
							uVar5 = 0x25;
						}
						FUN_0045cee0(uVar5);
						if (((param_1[8] & 8U) != 0) && (BVar4 = Game_IsAnyUnitsSelected(), BVar4 != 0)) {
							BVar4 = 0;
							uVar6 = local_34;
							fVar12 = local_38;
							uVar16 = local_34;
							fVar15 = local_38;
							pLVar10 = Game_GetPrimarySelectedObject();
							iVar13 = FUN_00431cd0(pLVar10,uVar6,(int)fVar12,uVar16,(int)fVar15,BVar4);
							if (iVar13 != 0) {
								if ((globals::g_Game.flags3 & GAME3_UNK_2) == GAME3_NONE) {
									uVar5 = 0x28;
								}
								else {
									uVar5 = 0x27;
								}
								FUN_0045cee0(uVar5);
								front::Text_DisplayType(TEXT_WALK,0,0);
								if ((local_40 != 0) && (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 == 0))
								{
									Level_AddMessageAction(MESSAGE_USERGOTO,0,0,&UINT_00557fb8);
									FUN_00428730(0);
									FUN_0041e680();
								}
							}
						}
					}
				}
				else {
					if ((globals::g_Game.flags3 & GAME3_UNK_20) == GAME3_NONE) {
						uVar5 = 0x1e;
					}
					else {
						uVar5 = 0x1d;
					}
					FUN_0045cee0(uVar5);
					front::Text_DisplayType(TEXT_NODRILL,0,0);
					if ((globals::g_Game.flags1 & GAME1_UNK_40000) == GAME1_NONE) {
						if ((((((*(uint *)(param_1 + 8) & 8) == 0) && (cVar1 = param_1[2], cVar1 != '\x01')) &&
								 (cVar1 != '\t')) && ((cVar1 != '\v' && ((*(uint *)(param_1 + 8) & 0x40) == 0)))) &&
							 ((BVar4 = Game_IsAnyUnitsSelected(), BVar4 == 0 ||
								(iVar13 = FUN_00431960(local_34,(uint)local_38,0), iVar13 != 0)))) {
							if ((globals::g_Game.flags3 & GAME3_UNK_20) == GAME3_NONE) {
								uVar5 = 0x20;
							}
							else {
								uVar5 = 0x1f;
							}
							FUN_0045cee0(uVar5);
							front::Text_DisplayType(TEXT_DRILL,0,0);
							if ((local_40 != 0) && (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 == 0)) {
								FUN_00402440((Point2I *)&UINT_00557fb8,0,1);
								goto LAB_00427954;
							}
						}
					}
					else {
						if ((*param_1 == '\x01') ||
							 ((BVar4 = Game_IsAnyUnitsSelected(), BVar4 != 0 &&
								(iVar13 = FUN_00431960(local_34,(uint)local_38,1), iVar13 == 0)))) {
							globals::g_Game.bool_c8 = 0;
						}
						else {
							globals::g_Game.field_c4 = local_38;
							globals::g_Game.field_c0 = local_34;
							globals::g_Game.bool_c8 = 1;
							if ((local_40 != 0) && (iVar13 = FUN_004286b0((int *)&UINT_00557fb8), iVar13 == 0)) {
								FUN_00402440((Point2I *)&UINT_00557fb8,1,1);
								FUN_00428730(0);
								FUN_0041e680();
							}
						}
					}
				}
			}
			else {
				if ((local_3c->objType == OBJECT_MINIFIGURE) && (local_3c->drivenObject != NULL)) {
					local_3c = local_3c->drivenObject;
				}
				if (local_3c->carryingThisObject != NULL) {
					local_3c = local_3c->carryingThisObject;
				}
				if (((local_3c->objType == OBJECT_VEHICLE) &&
						(BVar4 = Game_IsAnyUnitsSelected(), BVar4 != 0)) &&
					 (pLVar7 = Game_GetPrimarySelectedObject(), pLVar10 = local_3c,
					 pLVar7->objType == OBJECT_MINIFIGURE)) {
					pLVar7 = Game_GetPrimarySelectedObject();
					uVar6 = 2;
					OVar8 = LiveObject_GetStatsFlags3(pLVar10);
					if ((OVar8 & STATS3_NEEDSPILOT) == STATS3_NONE) {
						OVar9 = LiveObject_GetStatsFlags1(pLVar10);
						if ((OVar9 & STATS1_CROSSLAND) != STATS1_NONE) {
							OVar9 = LiveObject_GetStatsFlags1(pLVar10);
							uVar6 = (-(uint)((OVar9 & STATS1_CROSSWATER) != STATS1_NONE) & 0xfffffffd) + 4;
						}
					}
					else {
						uVar6 = 1;
					}
					if ((pLVar7->flags5_3f0 & uVar6) != 0) {
						if (local_40 == 0) {
							uVar5 = 0x11;
							goto LAB_00427972;
						}
						FUN_00402890(pLVar10);
						FUN_00428730(0);
						FUN_0041e680();
					}
				}
				else {
					if (((globals::g_Game.flags3 & GAME3_UNK_20) == GAME3_NONE) &&
						 ((globals::g_Game.flags3 & GAME3_UNK_40) == GAME3_NONE)) {
						if (((globals::g_Game.flags3 & GAME3_PICKUPOBJECT) == GAME3_NONE) &&
							 ((globals::g_Game.flags3 & GAME3_LOADVEHICLE) == GAME3_NONE)) {
							if (((globals::g_Game.flags3 & GAME3_UNK_2) != GAME3_NONE) ||
								 ((globals::g_Game.flags3 & GAME3_UNK_4) != GAME3_NONE)) {
								if ((globals::g_Game.flags3 & GAME3_UNK_2) == GAME3_NONE) {
									uVar5 = 0x26;
								}
								else {
									uVar5 = 0x25;
								}
								goto LAB_00427972;
							}
							if ((globals::g_Game.flags3 & GAME3_UNK_1) == GAME3_NONE) {
								BVar4 = FUN_00438870(local_3c,1);
								if (BVar4 != 0) {
									FUN_0045cee0(2);
									if (BOOL_004df560 == 0) {
										LiveObject_ShowToolTip(local_3c);
									}
									if (local_40 == 0) {
										pLVar10 = Game_GetPrimarySelectedObject();
										if ((pLVar10 != NULL) &&
											 ((local_3c->objType == OBJECT_POWERCRYSTAL ||
												(local_3c->objType == OBJECT_ORE)))) {
											LiveObject_GetBlockCoordinates(local_3c,(int *)&local_24,(int *)&fStack32);
											iVar13 = FUN_00431cd0(pLVar10,(int)local_24,(int)fStack32,(int)local_24,
																						(int)fStack32,0);
											if (iVar13 != 0) {
												if (local_3c->objType == OBJECT_ORE) {
													uVar5 = 0x1c;
												}
												else {
													if (pLVar10->objType == OBJECT_MINIFIGURE) {
														uVar5 = 0x23;
													}
													else {
														if (pLVar10->objType != OBJECT_VEHICLE) goto LAB_0042797a;
														uVar5 = 0x24;
													}
												}
LAB_00427972:
												FUN_0045cee0(uVar5);
											}
										}
									}
									else {
										uVar6 = nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
										if (((uVar6 & 8) != 0) ||
											 ((iVar13 = nerps::funcs::NERPFunc__GetTutorialFlags(NULL), iVar13 != 0 &&
												(local_3c->field_3f8 == 0)))) goto LAB_00427727;
										iVar13 = FUN_0041e8c0(local_3c->objType,local_3c->objIndex);
										if (((iVar13 != 0) &&
												(((local_3c->flags2_3e4 & 2) == LIVEOBJ2_NONE &&
												 ((OVar2 = local_3c->objType, OVar2 != OBJECT_VEHICLE ||
													((local_3c->flags1_3e0 & LIVEOBJ1_CLEARING) == LIVEOBJ1_NONE)))))) &&
											 (((globals::g_Game.flags1 & GAME1_LASERTRACKER) == GAME1_NONE ||
												((*(byte *)&local_3c->flags4_3ec & 1) != 0)))) {
											if ((((OVar2 == OBJECT_VEHICLE) || (OVar2 == OBJECT_BUILDING)) ||
													(OVar2 == OBJECT_MINIFIGURE)) ||
												 ((OVar2 == OBJECT_ELECTRICFENCE &&
													((local_3c->flags2_3e4 & 0x2000000) != LIVEOBJ2_NONE)))) {
												FUN_00428730(0);
												if (((param_5 == 0) &&
														(Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL), true)) ||
													 (BVar4 = FUN_004528d0(local_3c,NULL), BVar4 == 0)) {
													Level_AddMessageAction(MESSAGE_SELECT,local_3c,0,NULL);
													Level_AddMessageAction(MESSAGE_REDUCESELECTION,0,0,NULL);
												}
											}
											else {
												if ((OVar2 == OBJECT_POWERCRYSTAL) || (OVar2 == OBJECT_ORE)) {
													pLVar10 = Game_GetPrimarySelectedObject();
													if (pLVar10 != NULL) {
														LiveObject_GetBlockCoordinates
																			(local_3c,(int *)&local_24,(int *)&fStack32);
														iVar13 = FUN_00431cd0(pLVar10,(int)local_24,(int)fStack32,(int)local_24,
																									(int)fStack32,0);
														if (iVar13 != 0) {
															puVar19 = (uint *)&local_24;
															goto LAB_00426def;
														}
													}
												}
												else {
													FUN_00428730(1);
												}
											}
										}
									}
								}
							}
							else {
								globals::g_Game.flags1 |= GAME1_UNK_200;
								FUN_0045cee0(0xe);
								front::Text_DisplayType(TEXT_ENCYCLOPEDIA,0,0);
								if (local_40 != 0) {
									FUN_00428730(0);
									FUN_0040e630((undefined4 *)local_3c);
								}
							}
						}
						else {
							if ((globals::g_Game.flags3 & GAME3_PICKUPOBJECT) == GAME3_NONE) {
								uVar5 = 0x22;
							}
							else {
								uVar5 = 0x21;
							}
							FUN_0045cee0(uVar5);
							OVar2 = local_3c->objType;
							if ((((OVar2 == OBJECT_ORE) || (OVar2 == OBJECT_POWERCRYSTAL)) ||
									((OVar2 == OBJECT_ELECTRICFENCE &&
									 ((local_3c->flags2_3e4 & 0x2000000) == LIVEOBJ2_NONE)))) ||
								 ((OVar2 == OBJECT_DYNAMITE && ((local_3c->flags3_3e8 & 0x10000) == LIVEOBJ3_NONE)))
								 ) {
								BVar4 = 0;
								uVar6 = local_34;
								fVar12 = local_38;
								uVar16 = local_34;
								fVar15 = local_38;
								pLVar10 = Game_GetPrimarySelectedObject();
								iVar13 = FUN_00431cd0(pLVar10,uVar6,(int)fVar12,uVar16,(int)fVar15,BVar4);
								if (iVar13 != 0) {
									if (local_3c->objType == OBJECT_ORE) {
										uVar5 = 0x1c;
									}
									else {
										if ((globals::g_Game.flags3 & GAME3_PICKUPOBJECT) == GAME3_NONE) {
											uVar5 = 0x24;
										}
										else {
											uVar5 = 0x23;
										}
									}
									FUN_0045cee0(uVar5);
									if (local_40 != 0) {
										puVar19 = &UINT_00557fb8;
LAB_00426def:
										Level_AddMessageAction(MESSAGE_USERGOTO,0,0,puVar19);
										FUN_004025f0(local_3c);
										FUN_00401f40(3,(int)local_3c,NULL);
LAB_00427954:
										FUN_00428730(0);
										FUN_0041e680();
									}
								}
							}
						}
					}
					else {
						if ((globals::g_Game.flags3 & GAME3_UNK_20) == GAME3_NONE) {
							uVar5 = 0x1e;
						}
						else {
							uVar5 = 0x1d;
						}
						FUN_0045cee0(uVar5);
						front::Text_DisplayType(TEXT_NODRILL,0,0);
					}
				}
			}
		}
		else {
			local_1c.x = local_c;
			local_1c.y = local_8;
			local_28 = 1;
			BVar4 = FUN_0044abd0(globals::g_Game.placeObjType,globals::g_Game.placeObjIndex,local_40,0,
													 &local_1c,local_34,(uint)local_38,1,
													 (int **)globals::g_Game.RES_2f4_TABLEUNK);
			if (BVar4 == 0) {
				globals::g_Game.flags3 &= ~GAME3_PLACEBUILDING;
			}
			if (local_40 != 0) {
				*(int *)(param_1 + 0x28) = *(int *)(param_1 + 0x28) + 1;
			}
		}
	}
LAB_0042797a:
	if ((((globals::g_Game.flags3 & GAME3_PLACEBUILDING) == GAME3_NONE) &&
			((globals::g_Game.flags1 & GAME1_LASERTRACKER) == GAME1_NONE)) &&
		 (uVar6 = nerps::funcs::NERPFunc__GetTutorialFlags(NULL), (uVar6 & 0x200) == 0)) {
		if (globals::g_ButtonState_LeftDown == 0) {
			if ((globals::g_Game.flags1 & GAME1_UNK_100) == GAME1_NONE) {
				globals::g_Game.float_a4 = local_c;
				globals::g_Game.float_a8 = local_8;
				globals::g_Game.float_ac = local_4;
			}
			else {
				local_24 = (float)globals::g_MousePosition.x;
				fStack32 = (float)globals::g_MousePosition.y;
				uVar6 = nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
				if ((uVar6 & 8) == 0) {
					if (param_5 == 0) {
						Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
					}
					FUN_00477590((int)globals::g_Game.ptr_1c,local_14,0x557164);
					FUN_0043b980(globals::g_Game.ptr_1c,local_14,&local_24);
					FUN_00428730(0);
				}
			}
			globals::g_Game.float_b0 = (float)(ulonglong)local_34;
			local_24 = local_38;
			fStack32 = 0.0;
			globals::g_Game.float_b4 = (float)(ulonglong)(uint)local_38;
		}
		if (((BOOL_004df560 != 0) && ((globals::g_Game.flags2 & GAME2_NOMULTISELECT) == GAME2_NONE)) &&
			 ((globals::g_Game.flags1 & GAME1_UNK_200) == GAME1_NONE)) {
			if (((globals::g_Game.flags1 & GAME1_UNK_100) == GAME1_NONE) &&
				 (fVar12 = SQRT(FLOAT_004df41c * FLOAT_004df41c + FLOAT_004df418 * FLOAT_004df418),
				 (ushort)((ushort)(fVar12 < 10.0) << 8 | (ushort)(fVar12 == 10.0) << 0xe) == 0)) {
				globals::g_Game.flags1 |= GAME1_UNK_100;
			}
			globals::g_Game.float_b8 = (float)(ulonglong)local_34;
			local_24 = local_38;
			fStack32 = 0.0;
			globals::g_Game.float_bc = (float)(ulonglong)(uint)local_38;
		}
	}
	if ((globals::g_Game.flags2 & GAME2_ALLOWDEBUGKEYS) != GAME2_NONE) {
		Game_unkDebugKeysInput__00428810(local_34,(int)local_38,(int **)local_3c);
	}
LAB_00427c9c:
	if (((local_28 == 0) && ((globals::g_Game.flags3 & GAME3_PLACEBUILDING) != GAME3_NONE)) &&
		 (BVar4 = FUN_0044abd0(globals::g_Game.placeObjType,globals::g_Game.placeObjIndex,local_40,
													 local_30,NULL,local_34,(uint)local_38,0,
													 (int **)globals::g_Game.RES_2f4_TABLEUNK), BVar4 == 0)) {
		globals::g_Game.flags3 &= ~GAME3_PLACEBUILDING;
	}
	if (BOOL_004df560 == 0) {
		globals::g_Game.flags1 &= ~(GAME1_UNK_100|GAME1_UNK_200);
	}
	BOOL_004df564 = globals::g_ButtonState_LeftDown;
	BOOL_004df568 = globals::g_ButtonState_RightDown;
	return;
}



void __cdecl lego::main::Main_Load_ToolTipInfo(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTipInfo","HealthText",0);
	globals::g_Game.HealthText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTipInfo","EnergyText",0);
	globals::g_Game.EnergyText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTipInfo","CrystalsText",0);
	globals::g_Game.CrystalsText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTipInfo","OreText",0);
	globals::g_Game.OreText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTipInfo","StudsText",0);
	globals::g_Game.StudsText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTipInfo","ToolsText",0);
	globals::g_Game.ToolsText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTipInfo","CarryObjectText",0);
	globals::g_Game.CarryObjectText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTipInfo","DrivenByText",0);
	globals::g_Game.DrivenByText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTipInfo","OreRequiredText",0);
	globals::g_Game.OreRequiredText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	return;
}



void __cdecl lego::main::Main_LoadUpgradeNames(CFGProperty *root)
{
	char cVar1;
	char *pcVar2;
	CFGProperty *prop;
	int iVar3;
	uint uVar4;
	
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"UpgradeNames",0);
	prop = cfg::CFG_GetBlockFirstChild(root,pcVar2);
	do {
		if (prop == NULL) {
			return;
		}
		uVar4 = 0xffffffff;
		pcVar2 = "Level";
		do {
			if (uVar4 == 0) break;
			uVar4 -= 1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar2 + 1;
		} while (cVar1 != '\0');
		iVar3 = std::_strnicmp("Level",prop->key,~uVar4 - 1);
		if (iVar3 == 0) {
			uVar4 = 0xffffffff;
			pcVar2 = "Level";
			do {
				if (uVar4 == 0) break;
				uVar4 -= 1;
				cVar1 = *pcVar2;
				pcVar2 = pcVar2 + 1;
			} while (cVar1 != '\0');
			uVar4 = std::atoi(prop->key + (~uVar4 - 1));
			if (uVar4 < 0x10) {
				pcVar2 = std::_strdup(prop->value);
				globals::g_Game.UpgradeNames_TABLE[uVar4] = pcVar2;
			}
		}
		prop = cfg::CFG_NextFlatProperty(prop);
	} while( true );
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl lego::game::LiveObject_ShowToolTip(LiveObject *liveObj)
{
	char cVar1;
	ObjectType OVar2;
	ImageBMP *pIVar3;
	char *pcVar4;
	BOOL BVar5;
	undefined4 uVar6;
	int iVar7;
	uint uVar8;
	uint uVar9;
	undefined4 *puVar10;
	ImageBMP **ppIVar11;
	byte bVar12;
	char *pcVar13;
	char *pcVar14;
	undefined4 *puVar15;
	ToolType *pTVar16;
	longlong lVar17;
	char local_180 [128];
	char local_100 [256];
	
	pcVar4 = LiveObject_GetName(liveObj);
	if (pcVar4 != NULL) {
		pcVar4 = LiveObject_GetName(liveObj);
		iVar7 = -1;
		do {
			if (iVar7 == 0) break;
			iVar7 += -1;
			cVar1 = *pcVar4;
			pcVar4 = pcVar4 + 1;
		} while (cVar1 != '\0');
		if (iVar7 != -2) {
			if (_DAT_004df574 != liveObj) {
				_DAT_004df574 = liveObj;
				return;
			}
			if ((liveObj->customName != NULL) && (*liveObj->customName == '\0')) {
				LiveObject_SetCustomName(liveObj,NULL);
			}
			pcVar4 = liveObj->customName;
			if (pcVar4 == NULL) {
				pcVar4 = LiveObject_GetName(liveObj);
			}
			uVar8 = 0xffffffff;
			do {
				pcVar13 = pcVar4;
				if (uVar8 == 0) break;
				uVar8 -= 1;
				pcVar13 = pcVar4 + 1;
				cVar1 = *pcVar4;
				pcVar4 = pcVar13;
			} while (cVar1 != '\0');
			uVar8 = ~uVar8;
			puVar10 = (undefined4 *)(pcVar13 + -uVar8);
			puVar15 = (undefined4 *)local_100;
			for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
				*puVar15 = *puVar10;
				puVar10 = puVar10 + 1;
				puVar15 = puVar15 + 1;
			}
			OVar2 = liveObj->objType;
			for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
				*(undefined *)puVar15 = *(undefined *)puVar10;
				puVar10 = (undefined4 *)((int)puVar10 + 1);
				puVar15 = (undefined4 *)((int)puVar15 + 1);
			}
			if ((OVar2 == OBJECT_BUILDING) &&
				 (globals::g_Game.UpgradeNames_TABLE[liveObj->objLevel] != NULL)) {
				std::sprintf(local_180," (%s)",globals::g_Game.UpgradeNames_TABLE[liveObj->objLevel]);
				uVar8 = 0xffffffff;
				pcVar4 = local_180;
				do {
					pcVar13 = pcVar4;
					if (uVar8 == 0) break;
					uVar8 -= 1;
					pcVar13 = pcVar4 + 1;
					cVar1 = *pcVar4;
					pcVar4 = pcVar13;
				} while (cVar1 != '\0');
				uVar8 = ~uVar8;
				iVar7 = -1;
				pcVar4 = local_100;
				do {
					pcVar14 = pcVar4;
					if (iVar7 == 0) break;
					iVar7 += -1;
					pcVar14 = pcVar4 + 1;
					cVar1 = *pcVar4;
					pcVar4 = pcVar14;
				} while (cVar1 != '\0');
				puVar10 = (undefined4 *)(pcVar13 + -uVar8);
				puVar15 = (undefined4 *)(pcVar14 + -1);
				for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
					*puVar15 = *puVar10;
					puVar10 = puVar10 + 1;
					puVar15 = puVar15 + 1;
				}
				for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
					*(undefined *)puVar15 = *(undefined *)puVar10;
					puVar10 = (undefined4 *)((int)puVar10 + 1);
					puVar15 = (undefined4 *)((int)puVar15 + 1);
				}
			}
			if (((((liveObj->flags3_3e8 & 0x40000) != LIVEOBJ3_NONE) &&
					 (BVar5 = FUN_0040aa10(liveObj), BVar5 != 0)) && (liveObj->objType != OBJECT_MINIFIGURE))
				 && (liveObj->objType != OBJECT_ROCKMONSTER)) {
				if (0.0 <= liveObj->health) {
					lVar17 = __ftol((float10)liveObj->health);
					uVar6 = (undefined4)lVar17;
				}
				else {
					uVar6 = 0;
				}
				std::sprintf(local_180,"\n%s: %i",globals::g_Game.EnergyText,uVar6);
				uVar8 = 0xffffffff;
				pcVar4 = local_180;
				do {
					pcVar13 = pcVar4;
					if (uVar8 == 0) break;
					uVar8 -= 1;
					pcVar13 = pcVar4 + 1;
					cVar1 = *pcVar4;
					pcVar4 = pcVar13;
				} while (cVar1 != '\0');
				uVar8 = ~uVar8;
				iVar7 = -1;
				pcVar4 = local_100;
				do {
					pcVar14 = pcVar4;
					if (iVar7 == 0) break;
					iVar7 += -1;
					pcVar14 = pcVar4 + 1;
					cVar1 = *pcVar4;
					pcVar4 = pcVar14;
				} while (cVar1 != '\0');
				puVar10 = (undefined4 *)(pcVar13 + -uVar8);
				puVar15 = (undefined4 *)(pcVar14 + -1);
				for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
					*puVar15 = *puVar10;
					puVar10 = puVar10 + 1;
					puVar15 = puVar15 + 1;
				}
				for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
					*(undefined *)puVar15 = *(undefined *)puVar10;
					puVar10 = (undefined4 *)((int)puVar10 + 1);
					puVar15 = (undefined4 *)((int)puVar15 + 1);
				}
			}
			if (((liveObj->objType == OBJECT_VEHICLE) && (liveObj->drivenObject != NULL)) &&
				 ((pcVar4 = liveObj->drivenObject->customName, pcVar4 != NULL &&
					((*pcVar4 != '\0' && (globals::g_Game.DrivenByText != NULL)))))) {
				std::sprintf(local_180,"\n%s: %s",globals::g_Game.DrivenByText,pcVar4);
				uVar8 = 0xffffffff;
				pcVar4 = local_180;
				do {
					pcVar13 = pcVar4;
					if (uVar8 == 0) break;
					uVar8 -= 1;
					pcVar13 = pcVar4 + 1;
					cVar1 = *pcVar4;
					pcVar4 = pcVar13;
				} while (cVar1 != '\0');
				uVar8 = ~uVar8;
				iVar7 = -1;
				pcVar4 = local_100;
				do {
					pcVar14 = pcVar4;
					if (iVar7 == 0) break;
					iVar7 += -1;
					pcVar14 = pcVar4 + 1;
					cVar1 = *pcVar4;
					pcVar4 = pcVar14;
				} while (cVar1 != '\0');
				puVar10 = (undefined4 *)(pcVar13 + -uVar8);
				puVar15 = (undefined4 *)(pcVar14 + -1);
				for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
					*puVar15 = *puVar10;
					puVar10 = puVar10 + 1;
					puVar15 = puVar15 + 1;
				}
				for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
					*(undefined *)puVar15 = *(undefined *)puVar10;
					puVar10 = (undefined4 *)((int)puVar10 + 1);
					puVar15 = (undefined4 *)((int)puVar15 + 1);
				}
			}
			unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(2,local_100);
			iVar7 = LiveObject_GetObjTtSFX(liveObj);
			FUN_0046b9c0(2,iVar7);
			if (liveObj->objType == OBJECT_MINIFIGURE) {
				uVar8 = 0;
				if (liveObj->numCarriedTools != 0) {
					pTVar16 = liveObj->carriedTools;
					do {
						if (globals::g_ToolTipIcons_Tools_TABLE[*pTVar16] != NULL) {
							FUN_0046b920(2,(int)globals::g_ToolTipIcons_Tools_TABLE[*pTVar16]);
						}
						uVar8 += 1;
						pTVar16 = pTVar16 + 1;
					} while (uVar8 < liveObj->numCarriedTools);
				}
				uVar9 = LiveObject_GetNumOfToolsCanCarry(liveObj);
				if (uVar8 < uVar9) {
					do {
						if (globals::g_ToolTipIcon_Blank != NULL) {
							FUN_0046b920(2,(int)globals::g_ToolTipIcon_Blank);
						}
						uVar8 += 1;
						uVar9 = LiveObject_GetNumOfToolsCanCarry(liveObj);
					} while (uVar8 < uVar9);
				}
				if (liveObj->flags5_3f0 != LIVEOBJ5_NONE) {
					FUN_0046b920(2,0);
					bVar12 = 0;
					ppIVar11 = globals::g_ToolTipIcons_Abilities_TABLE;
					do {
						pIVar3 = globals::g_ToolTipIcon_Blank;
						if ((liveObj->flags5_3f0 & 1 << (bVar12 & 0x1f)) != 0) {
							pIVar3 = *ppIVar11;
						}
						if (pIVar3 != NULL) {
							FUN_0046b920(2,(int)pIVar3);
						}
						ppIVar11 = ppIVar11 + 1;
						bVar12 += 1;
					} while (ppIVar11 < globals::g_ToolTipIcons_Tools_TABLE);
				}
			}
			FUN_0046ba30(2);
		}
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_00428260(int *param_1,int param_2,int param_3,int param_4)
{
	LevelBlock *pLVar1;
	char cVar2;
	LevelBlockFlags1 LVar3;
	int *piVar4;
	bool bVar5;
	char *pcVar6;
	int iVar7;
	int iVar8;
	int iVar9;
	int iVar10;
	int iVar11;
	int iVar12;
	char *pcVar13;
	LevelBlockFlags1 LVar14;
	uint uVar15;
	uint uVar16;
	uint uVar17;
	undefined4 *puVar18;
	undefined4 *puVar19;
	char local_100 [128];
	undefined4 local_80 [32];
	
	iVar9 = param_1[1];
	iVar10 = *param_1;
	pLVar1 = (lego::globals::g_Game.level)->blocks +
					 ((lego::globals::g_Game.level)->dimensions).width * iVar9 + iVar10;
	if ((DAT_004df208 != iVar10) || (_DAT_004df20c != iVar9)) {
		DAT_004df208 = *param_1;
		_DAT_004df20c = param_1[1];
		return;
	}
	LVar3 = pLVar1->flags1;
	pcVar6 = (char *)(LVar3 & BLOCK1_UNK_100000);
	if ((((pcVar6 != NULL) &&
			 (((lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * iVar9 + iVar10].flags1 &
				BLOCK1_UNK_400) == BLOCK1_NONE)) &&
			((*(byte *)&(lego::globals::g_Game.level)->blocks
									[((lego::globals::g_Game.level)->dimensions).width * iVar9 + iVar10].flags2 & 4)
			 == 0)) && ((LVar3 & BLOCK1_UNK_8000) == BLOCK1_NONE)) {
		piVar4 = (int *)pLVar1->field_10;
		uVar17 = piVar4[0x34];
		pcVar6 = lego::game::Object_GetName(OBJECT_BUILDING,*piVar4);
		uVar15 = 0xffffffff;
		do {
			pcVar13 = pcVar6;
			if (uVar15 == 0) break;
			uVar15 -= 1;
			pcVar13 = pcVar6 + 1;
			cVar2 = *pcVar6;
			pcVar6 = pcVar13;
		} while (cVar2 != '\0');
		uVar15 = ~uVar15;
		puVar18 = (undefined4 *)(pcVar13 + -uVar15);
		puVar19 = local_80;
		for (uVar16 = uVar15 >> 2; uVar16 != 0; uVar16 -= 1) {
			*puVar19 = *puVar18;
			puVar18 = puVar18 + 1;
			puVar19 = puVar19 + 1;
		}
		for (uVar15 &= 3; uVar15 != 0; uVar15 -= 1) {
			*(undefined *)puVar19 = *(undefined *)puVar18;
			puVar18 = (undefined4 *)((int)puVar18 + 1);
			puVar19 = (undefined4 *)((int)puVar19 + 1);
		}
		if (param_2 != 0) {
			iVar7 = FUN_00408d40((int)piVar4,6,0);
			iVar8 = lego::game::Object_GetCostCrystal(OBJECT_BUILDING,*piVar4,0);
			iVar9 = FUN_00408d40((int)piVar4,7,0);
			iVar10 = lego::game::Object_GetCostOre(OBJECT_BUILDING,*piVar4,0);
			iVar11 = FUN_00408d40((int)piVar4,7,1);
			iVar12 = lego::game::Object_GetCostRefinedOre(OBJECT_BUILDING,*piVar4,0);
			if (iVar8 != 0) {
				std::sprintf(local_100,"\n%s: %i/%i",lego::globals::g_Game.CrystalsText,iVar7,iVar8);
				uVar15 = 0xffffffff;
				pcVar6 = local_100;
				do {
					pcVar13 = pcVar6;
					if (uVar15 == 0) break;
					uVar15 -= 1;
					pcVar13 = pcVar6 + 1;
					cVar2 = *pcVar6;
					pcVar6 = pcVar13;
				} while (cVar2 != '\0');
				uVar15 = ~uVar15;
				iVar7 = -1;
				puVar18 = local_80;
				do {
					puVar19 = puVar18;
					if (iVar7 == 0) break;
					iVar7 += -1;
					puVar19 = (undefined4 *)((int)puVar18 + 1);
					cVar2 = *(char *)puVar18;
					puVar18 = puVar19;
				} while (cVar2 != '\0');
				puVar18 = (undefined4 *)(pcVar13 + -uVar15);
				puVar19 = (undefined4 *)((int)puVar19 + -1);
				for (uVar16 = uVar15 >> 2; uVar16 != 0; uVar16 -= 1) {
					*puVar19 = *puVar18;
					puVar18 = puVar18 + 1;
					puVar19 = puVar19 + 1;
				}
				for (uVar15 &= 3; uVar15 != 0; uVar15 -= 1) {
					*(undefined *)puVar19 = *(undefined *)puVar18;
					puVar18 = (undefined4 *)((int)puVar18 + 1);
					puVar19 = (undefined4 *)((int)puVar19 + 1);
				}
			}
			pcVar6 = lego::globals::g_Game.OreText;
			if ((uVar17 & 8) != 0) {
				iVar9 = iVar11;
				iVar10 = iVar12;
				pcVar6 = lego::globals::g_Game.StudsText;
			}
			if (iVar10 != 0) {
				std::sprintf(local_100,"\n%s: %i/%i",pcVar6,iVar9,iVar10);
				uVar17 = 0xffffffff;
				pcVar6 = local_100;
				do {
					pcVar13 = pcVar6;
					if (uVar17 == 0) break;
					uVar17 -= 1;
					pcVar13 = pcVar6 + 1;
					cVar2 = *pcVar6;
					pcVar6 = pcVar13;
				} while (cVar2 != '\0');
				uVar17 = ~uVar17;
				iVar9 = -1;
				puVar18 = local_80;
				do {
					puVar19 = puVar18;
					if (iVar9 == 0) break;
					iVar9 += -1;
					puVar19 = (undefined4 *)((int)puVar18 + 1);
					cVar2 = *(char *)puVar18;
					puVar18 = puVar19;
				} while (cVar2 != '\0');
				puVar18 = (undefined4 *)(pcVar13 + -uVar17);
				puVar19 = (undefined4 *)((int)puVar19 + -1);
				for (uVar15 = uVar17 >> 2; uVar15 != 0; uVar15 -= 1) {
					*puVar19 = *puVar18;
					puVar18 = puVar18 + 1;
					puVar19 = puVar19 + 1;
				}
				for (uVar17 &= 3; uVar17 != 0; uVar17 -= 1) {
					*(undefined *)puVar19 = *(undefined *)puVar18;
					puVar18 = (undefined4 *)((int)puVar18 + 1);
					puVar19 = (undefined4 *)((int)puVar19 + 1);
				}
			}
		}
		lego::unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(3,(char *)local_80);
		FUN_0046b9c0(3,0);
		FUN_0046ba30(3);
		return;
	}
	bVar5 = false;
	if ((LVar3 & BLOCK1_UNK_8) == BLOCK1_NONE) {
		if (((LVar3 & BLOCK1_UNK_10) == BLOCK1_NONE) && ((LVar3 & BLOCK1_HIDDEN) != BLOCK1_NONE)) {
			pcVar6 = FUN_004350a0(0x10);
			uVar17 = 0x10;
		}
		else {
			if ((LVar3 & BLOCK1_REINFORCED) == BLOCK1_NONE) {
				uVar17 = (uint)pLVar1->terrain;
				goto LAB_00428649;
			}
			pcVar6 = FUN_004350a0(0xd);
			uVar17 = 0xd;
		}
	}
	else {
		if ((LVar3 & BLOCK1_UNK_80000000) == BLOCK1_NONE) {
			if ((LVar3 & BLOCK1_UNK_200000) == BLOCK1_NONE) {
				pcVar6 = FUN_004350a0(0xc);
				pcVar13 = (char *)FUN_004350c0(0xc);
				bVar5 = true;
			}
			else {
				if ((*(byte *)&pLVar1->flags2 & 0x20) == 0) {
					if (((iVar10 < 0) || (iVar9 < 0)) ||
						 ((iVar7 = ((lego::globals::g_Game.level)->dimensions).width, iVar7 <= iVar10 ||
							(((lego::globals::g_Game.level)->dimensions).height <= iVar9)))) {
						LVar14 = BLOCK1_NONE;
					}
					else {
						LVar14 = (lego::globals::g_Game.level)->blocks[iVar7 * iVar9 + iVar10].flags1 &
										 BLOCK1_POWERPATH;
					}
					if ((LVar14 == BLOCK1_NONE) && ((LVar3 & BLOCK1_UNK_8000) == BLOCK1_NONE)) {
						pcVar13 = pcVar6;
						if (((((lego::globals::g_Game.level)->blocks
									 [((lego::globals::g_Game.level)->dimensions).width * iVar9 + iVar10].flags1 &
									BLOCK1_UNK_400) == BLOCK1_NONE) &&
								((*(byte *)&(lego::globals::g_Game.level)->blocks
														[((lego::globals::g_Game.level)->dimensions).width * iVar9 + iVar10].
														flags2 & 4) == 0)) && (pcVar6 == NULL)) {
							if (param_4 == 0) goto LAB_004285a8;
							pcVar6 = FUN_004350a0(0x11);
							pcVar13 = (char *)FUN_004350c0(0x11);
							bVar5 = true;
						}
					}
					else {
						pcVar6 = FUN_004350a0(0xe);
						pcVar13 = (char *)FUN_004350c0(0xe);
						bVar5 = true;
					}
				}
				else {
					pcVar6 = FUN_004350a0(0xf);
					pcVar13 = (char *)FUN_004350c0(0xf);
					bVar5 = true;
				}
			}
		}
		else {
LAB_004285a8:
			pcVar6 = FUN_004350a0(0);
			pcVar13 = (char *)FUN_004350c0(0);
			bVar5 = true;
		}
		if (pLVar1->terrain == TERRAIN_LAKE) {
			uVar17 = 9;
LAB_00428649:
			pcVar6 = FUN_004350a0(uVar17);
			uVar17 = (uint)pLVar1->terrain;
		}
		else {
			if (pLVar1->terrain != TERRAIN_LAVA) goto LAB_00428668;
			pcVar6 = FUN_004350a0(6);
			uVar17 = (uint)pLVar1->terrain;
		}
	}
	pcVar13 = (char *)FUN_004350c0(uVar17);
	bVar5 = true;
LAB_00428668:
	if (bVar5) {
		lego::unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(6,"%s",pcVar6);
		if (param_3 == 0) {
			pcVar13 = NULL;
		}
		FUN_0046b9c0(6,pcVar13);
		FUN_0046ba30(6);
	}
	return;
}



undefined4 __cdecl FUN_004286b0(int *param_1)
{
	int iVar1;
	int iVar2;
	int iVar3;
	uint uVar4;
	LevelData *pLVar5;
	
	iVar3 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
	if (iVar3 != 0) {
		uVar4 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
		if ((uVar4 & 8) == 0) {
			uVar4 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
			if ((uVar4 & 4) == 0) {
				return 1;
			}
		}
	}
	uVar4 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
	if ((uVar4 & 2) != 0) {
		pLVar5 = lego::game::GetLevel();
		iVar3 = (pLVar5->dimensions).width;
		iVar1 = param_1[1];
		iVar2 = *param_1;
		pLVar5 = lego::game::GetLevel();
		if (pLVar5->blocks[iVar3 * iVar1 + iVar2].blockpointer == 0) {
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_00428730(int param_1)
{
	BOOL setFlag8;
	int in_sampleIndex;
	
	setFlag8 = lego::snd::Audio_GetFlag8();
	lego::snd::Audio_FUN_00465590(0,0);
	switch(param_1) {
	case 0:
		FUN_0045cf00(0x14,12.5);
		in_sampleIndex = 0x13;
		break;
	case 1:
		FUN_0045cf00(0x15,12.5);
		in_sampleIndex = 0x14;
		break;
	case 2:
		FUN_0045cf00(0x15,12.5);
		in_sampleIndex = 0x1f;
		break;
	case 3:
		FUN_0045cf00(0x14,12.5);
		in_sampleIndex = 0x1e;
		break;
	case 4:
		FUN_0045cf00(0x14,12.5);
		in_sampleIndex = 0x20;
		break;
	case 5:
		FUN_0045cf00(0x14,12.5);
		in_sampleIndex = 0x21;
		break;
	default:
		goto switchD_00428751_caseD_6;
	}
	lego::snd::Snd_Play_FUN_00465260(in_sampleIndex,0);
switchD_00428751_caseD_6:
	lego::snd::Audio_FUN_00465590(setFlag8,0);
	return;
}



void __cdecl lego::game::Game_unkDebugKeysInput__00428810(int param_1,int param_2,int **param_3)
{
	int *piVar1;
	LevelData *pLVar2;
	BOOL BVar3;
	LiveObject *pLVar4;
	BOOL BVar5;
	BOOL BVar6;
	BOOL BVar7;
	LiveObject *liveObj;
	undefined **ppuVar8;
	LiveObject **ppLVar9;
	int iVar10;
	uint uVar11;
	float in_stack_00000010;
	float z;
	int iVar12;
	float *pfVar13;
	uint local_18;
	LiveObject *local_14;
	Point2I local_10;
	Point2I local_8;
	
	local_8.x = param_1;
	local_8.y = param_2;
	if (((globals::g_KeyboardState_Current_TABLE[30] != 0) &&
			(globals::g_KeyboardState_Previous_TABLE[30] != globals::g_KeyboardState_Current_TABLE[30]))
		 && (FUN_0040f260(&local_8,1,1), param_3 != NULL)) {
		FUN_004448e0((LiveObject *)param_3);
	}
	if (((globals::g_KeyboardState_Current_TABLE[207] != 0) &&
			(globals::g_KeyboardState_Previous_TABLE[207] != globals::g_KeyboardState_Current_TABLE[207]))
		 && (BVar3 = Game_IsAnyUnitsSelected(), BVar3 != 0)) {
		pLVar4 = Game_GetPrimarySelectedObject();
		LiveObject_SetUnkFlags2(pLVar4);
	}
	if ((globals::g_KeyboardState_Current_TABLE[18] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[18] != globals::g_KeyboardState_Current_TABLE[18])) {
		FUN_0043b1f0((int **)(globals::g_Game.RockMonsterData_TABLE +
												 (globals::g_Game.level)->EmergeCreature),4.203895e-45,
								 (globals::g_Game.level)->EmergeCreature,param_1,param_2);
	}
	if (globals::g_KeyboardState_Current_TABLE[17] != 0) {
		FUN_004303a0((int)globals::g_Game.level,0,(int *)param_1,(int *)param_2);
	}
	if (globals::g_KeyboardState_Current_TABLE[46] != 0) {
		if ((globals::g_KeyboardState_Previous_TABLE[46] != globals::g_KeyboardState_Current_TABLE[46])
			 && (BVar3 = Game_IsAnyUnitsSelected(), BVar3 != 0)) {
			pLVar4 = Game_GetPrimarySelectedObject();
			FUN_00448a80((int *)pLVar4);
		}
		if (((globals::g_KeyboardState_Current_TABLE[46] != 0) &&
				(globals::g_KeyboardState_Previous_TABLE[46] != globals::g_KeyboardState_Current_TABLE[46]))
			 && (BVar3 = Game_IsAnyUnitsSelected(), BVar3 != 0)) {
			pLVar4 = Game_GetPrimarySelectedObject();
			FUN_00448a80((int *)pLVar4);
		}
	}
	if ((globals::g_KeyboardState_Current_TABLE[88] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[88] != globals::g_KeyboardState_Current_TABLE[88])) {
		if ((globals::g_Game.flags1 & GAME1_DEBUG_NONERPS) == GAME1_NONE) {
			local_14 = NULL;
			globals::g_Game.flags1 |= GAME1_DEBUG_NONERPS;
			nerps::funcs::NERPFunc__SetTutorialFlags((int *)&local_14);
		}
		else {
			globals::g_Game.flags1 &= ~GAME1_DEBUG_NONERPS;
		}
	}
	if ((globals::g_KeyboardState_Current_TABLE[87] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[87] != globals::g_KeyboardState_Current_TABLE[87])) {
		FUN_0040aa40(0);
	}
	if ((globals::g_KeyboardState_Current_TABLE[68] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[68] != globals::g_KeyboardState_Current_TABLE[68])) {
		DAT_004df578 = (uint)(DAT_004df578 == 0);
		if (DAT_004df578 == 0) {
			res::Res_SetFramePosition
								(globals::g_Game.struct2c_30,(globals::g_Game.structbc_24)->resData_2c,200.0,140.0,
								 -130.0);
			z = 0.75;
		}
		else {
			res::Res_SetFramePosition
								(globals::g_Game.struct2c_30,(globals::g_Game.structbc_24)->resData_2c,250.0,190.0,
								 20.0);
			z = 0.0;
		}
		res::Res_SetFrameOrientation
							(globals::g_Game.struct2c_30,(globals::g_Game.structbc_24)->resData_2c,-1.0,-0.8,z,0.0
							 ,1.0,0.0);
		FUN_0044d230();
	}
	if ((globals::g_KeyboardState_Current_TABLE[67] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[67] != globals::g_KeyboardState_Current_TABLE[67])) {
		BOOL_004df57c = ZEXT14(BOOL_004df57c == 0);
		FUN_0044ca50(BOOL_004df57c);
	}
	BVar3 = Game_IsAnyUnitsSelected();
	if ((BVar3 != 0) &&
		 ((((((globals::g_KeyboardState_Current_TABLE[6] != 0 &&
					(globals::g_KeyboardState_Previous_TABLE[6] != globals::g_KeyboardState_Current_TABLE[6]))
				 || ((globals::g_KeyboardState_Current_TABLE[7] != 0 &&
						 (globals::g_KeyboardState_Previous_TABLE[7] !=
							globals::g_KeyboardState_Current_TABLE[7])))) ||
				((globals::g_KeyboardState_Current_TABLE[8] != 0 &&
				 (globals::g_KeyboardState_Previous_TABLE[8] != globals::g_KeyboardState_Current_TABLE[8])))
				) || ((globals::g_KeyboardState_Current_TABLE[9] != 0 &&
							(globals::g_KeyboardState_Previous_TABLE[9] !=
							 globals::g_KeyboardState_Current_TABLE[9])))) &&
			(local_14 = Game_GetSelectedUnits((int *)&local_10), local_10.x != 0)))) {
		piVar1 = (int *)local_14->objType;
		if (*piVar1 == 4) {
			BVar3 = 0;
			iVar12 = 0;
			iVar10 = piVar1[6] + 0x8c;
			pLVar4 = Game_GetPrimarySelectedObject();
			BVar5 = FUN_004088a0(pLVar4->building,iVar12,BVar3);
			BVar3 = 0;
			iVar12 = 1;
			pLVar4 = Game_GetPrimarySelectedObject();
			BVar6 = FUN_004088a0(pLVar4->building,iVar12,BVar3);
			BVar3 = 0;
			iVar12 = 2;
			pLVar4 = Game_GetPrimarySelectedObject();
			BVar7 = FUN_004088a0(pLVar4->building,iVar12,BVar3);
			BVar3 = 0;
			iVar12 = 3;
			pLVar4 = Game_GetPrimarySelectedObject();
			BVar3 = FUN_004088a0(pLVar4->building,iVar12,BVar3);
		}
		else {
			if (*piVar1 == 1) {
				BVar3 = 0;
				iVar12 = 0;
				iVar10 = piVar1[3] + 0x124;
				pLVar4 = Game_GetPrimarySelectedObject();
				BVar5 = FUN_0046d200(pLVar4->vehicle,iVar12,BVar3);
				BVar3 = 0;
				iVar12 = 1;
				pLVar4 = Game_GetPrimarySelectedObject();
				BVar6 = FUN_0046d200(pLVar4->vehicle,iVar12,BVar3);
				BVar3 = 0;
				iVar12 = 2;
				pLVar4 = Game_GetPrimarySelectedObject();
				BVar7 = FUN_0046d200(pLVar4->vehicle,iVar12,BVar3);
				BVar3 = 0;
				iVar12 = 3;
				pLVar4 = Game_GetPrimarySelectedObject();
				BVar3 = FUN_0046d200(pLVar4->vehicle,iVar12,BVar3);
			}
			else {
				iVar10 = 0;
				BVar3 = param_1;
				BVar6 = param_1;
				BVar7 = param_1;
				BVar5 = param_1;
			}
		}
		if (iVar10 != 0) {
			local_18 = *(uint *)(iVar10 + 8);
			uVar11 = local_18;
			if (((globals::g_KeyboardState_Current_TABLE[6] != 0) &&
					(globals::g_KeyboardState_Previous_TABLE[6] != globals::g_KeyboardState_Current_TABLE[6]))
				 && (BVar5 != 0)) {
				uVar11 = local_18 ^ 8;
			}
			if (((globals::g_KeyboardState_Current_TABLE[7] != 0) &&
					(globals::g_KeyboardState_Previous_TABLE[7] != globals::g_KeyboardState_Current_TABLE[7]))
				 && (BVar6 != 0)) {
				uVar11 ^= 4;
			}
			if (((globals::g_KeyboardState_Current_TABLE[8] != 0) &&
					(globals::g_KeyboardState_Previous_TABLE[8] != globals::g_KeyboardState_Current_TABLE[8]))
				 && (BVar7 != 0)) {
				uVar11 ^= 2;
			}
			if (((globals::g_KeyboardState_Current_TABLE[9] != 0) &&
					(globals::g_KeyboardState_Previous_TABLE[9] != globals::g_KeyboardState_Current_TABLE[9]))
				 && (BVar3 != 0)) {
				uVar11 ^= 1;
			}
			if (uVar11 != local_18) {
				if (*(int *)local_14->objType == 4) {
					pLVar4 = Game_GetPrimarySelectedObject();
					LiveObject_BuildingChangeUpgradeParts(pLVar4->building,uVar11);
				}
				else {
					if (*(int *)local_14->objType == 1) {
						pLVar4 = Game_GetPrimarySelectedObject();
						LiveObject_VehicleChangeUpgradeParts(pLVar4->vehicle,uVar11);
					}
				}
			}
		}
	}
	if ((globals::g_KeyboardState_Current_TABLE[14] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[14] != globals::g_KeyboardState_Current_TABLE[14])) {
		FUN_00402730(5);
	}
	if ((globals::g_KeyboardState_Current_TABLE[83] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[83] != globals::g_KeyboardState_Current_TABLE[83])) {
		FUN_00430460(globals::g_Game.level,param_1,param_2,0);
	}
	if (globals::g_KeyboardState_Current_TABLE[81] != 0) {
		FUN_00430e10((int)globals::g_Game.level,(uint *)param_1,(int *)param_2);
	}
	if ((((globals::g_KeyboardState_Current_TABLE[17] != 0) &&
			 (globals::g_KeyboardState_Previous_TABLE[17] != globals::g_KeyboardState_Current_TABLE[17]))
			&& (BVar3 = Game_IsAnyUnitsSelected(), BVar3 != 0)) &&
		 (pLVar4 = Game_GetPrimarySelectedObject(), pLVar2 = globals::g_Game.level,
		 pLVar4->objType == OBJECT_ROCKMONSTER)) {
		FUN_0044a890(pLVar4,(int *)&local_18,(int *)&local_14,1,0,0);
		liveObj = LiveObject__Create((int **)globals::g_Game.RES_Boulder,OBJECT_BOULDER,0);
		LiveObject_FUN_0044a210(liveObj,1);
		FUN_00447470(pLVar4,local_18,(uint)local_14,liveObj);
		uVar11 = (pLVar2->dimensions).width * (int)local_14 + local_18;
		ppuVar8 = (undefined **)
							FUN_0040b780((int *)pLVar2->surfTextGrid,
													 uVar11 & 0xffffff00 | (uint)pLVar2->blocks[uVar11].texture);
		FUN_00440eb0(liveObj,ppuVar8);
	}
	if (((globals::g_KeyboardState_Current_TABLE[49] != 0) &&
			(globals::g_KeyboardState_Previous_TABLE[49] != globals::g_KeyboardState_Current_TABLE[49]))
		 && (BVar3 = Game_IsAnyUnitsSelected(), BVar3 != 0)) {
		BVar3 = 0;
		pLVar4 = Game_GetPrimarySelectedObject();
		LiveObject_UnkDoRouting_FUN_00441c00(pLVar4,BVar3);
	}
	if (((globals::g_KeyboardState_Current_TABLE[42] != 0) &&
			(globals::g_KeyboardState_Current_TABLE[30] != 0)) &&
		 (globals::g_KeyboardState_Previous_TABLE[30] != globals::g_KeyboardState_Current_TABLE[30])) {
		FUN_00402d70(&local_8);
	}
	if ((globals::g_KeyboardState_Current_TABLE[48] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[48] != globals::g_KeyboardState_Current_TABLE[48])) {
		local_10.x = 0x40000000;
		local_10.y = 0x3f800000;
		if (param_3 != NULL) {
			FUN_0044c410(param_3,(int **)&local_10,(int *)0x42200000);
		}
	}
	if ((globals::g_KeyboardState_Current_TABLE[35] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[35] != globals::g_KeyboardState_Current_TABLE[35])) {
		Level_DoSomethingBlockStruct_c__00466510(param_1,param_2);
	}
	if ((((globals::g_KeyboardState_Current_TABLE[33] != 0) &&
			 (globals::g_KeyboardState_Previous_TABLE[33] != globals::g_KeyboardState_Current_TABLE[33]))
			&& (BVar3 = Game_IsAnyUnitsSelected(), BVar3 != 0)) &&
		 (uVar11 = Game_GetNumSelectedUnits(), uVar11 != 0)) {
		ppLVar9 = Game_GetSelectedUnits();
		for (; uVar11 != 0; uVar11 -= 1) {
			FUN_0043f960(*ppLVar9,40.0,1,in_stack_00000010);
			ppLVar9 = ppLVar9 + 1;
		}
	}
	if (((globals::g_KeyboardState_Current_TABLE[35] != 0) &&
			(globals::g_KeyboardState_Previous_TABLE[35] != globals::g_KeyboardState_Current_TABLE[35]))
		 && ((BVar3 = Game_IsAnyUnitsSelected(), BVar3 != 0 &&
				 (pLVar4 = Game_GetPrimarySelectedObject(), pLVar4->objType == OBJECT_BUILDING)))) {
		FUN_0040d420((undefined4 *)pLVar4,0,0);
	}
	if ((globals::g_KeyboardState_Current_TABLE[36] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[36] != globals::g_KeyboardState_Current_TABLE[36])) {
		uVar11 = FUN_0040e390(param_1,param_2);
		if (uVar11 == 0) {
			FUN_0040d0a0(param_1,param_2);
		}
		else {
			FUN_0040d120(param_1,param_2);
		}
	}
	if ((globals::g_KeyboardState_Current_TABLE[21] != 0) &&
		 (globals::g_KeyboardState_Previous_TABLE[21] != globals::g_KeyboardState_Current_TABLE[21])) {
		local_10.x = 1;
		local_10.y = 1;
		Info_FUN_00419ab0(INFO_CRYSTALFOUND,NULL,NULL,&local_10);
	}
	if (globals::g_KeyboardState_Current_TABLE[42] == 0) {
		if ((globals::g_KeyboardState_Current_TABLE[22] != 0) &&
			 (globals::g_KeyboardState_Previous_TABLE[22] != globals::g_KeyboardState_Current_TABLE[22]))
		{
			unk::Lego_ClearFlag2__004b41bc();
		}
	}
	else {
		if ((globals::g_KeyboardState_Current_TABLE[22] != 0) &&
			 (globals::g_KeyboardState_Previous_TABLE[22] != globals::g_KeyboardState_Current_TABLE[22]))
		{
			FUN_0045c930(0,0,1);
		}
	}
	if (((globals::g_KeyboardState_Current_TABLE[37] != 0) &&
			(globals::g_KeyboardState_Previous_TABLE[37] != globals::g_KeyboardState_Current_TABLE[37]))
		 && (BVar3 = Game_IsAnyUnitsSelected(), BVar3 != 0)) {
		pLVar4 = Game_GetPrimarySelectedObject();
		if (pLVar4->objType == OBJECT_VEHICLE) {
			DAT_004df584 = Game_GetPrimarySelectedObject();
			return;
		}
		pLVar4 = Game_GetPrimarySelectedObject();
		if ((pLVar4->objType == OBJECT_MINIFIGURE) && (DAT_004df584 != NULL)) {
			pfVar13 = (float *)DAT_004df584;
			pLVar4 = Game_GetPrimarySelectedObject();
			FUN_00440690((int *)pLVar4,pfVar13);
		}
	}
	return;
}



void __cdecl FUN_00429090(Point2I *position)
{
	int iVar1;
	
	iVar1 = ((lego::globals::g_Game.level)->dimensions).width * position->y + position->x;
	FUN_0040b780((int *)(lego::globals::g_Game.level)->surfTextGrid,
							 iVar1 * 9 & 0xffffff00U | (uint)(lego::globals::g_Game.level)->blocks[iVar1].texture)
	;
	return;
}



void __cdecl FUN_004290d0(float param_1,float param_2)
{
	LevelSurfaceMap *surfMap;
	float fVar1;
	float10 fVar2;
	longlong lVar3;
	float unaff_retaddr;
	float in_stack_0000000c;
	float in_stack_00000010;
	float in_stack_00000014;
	float in_stack_00000018;
	int in_stack_0000001c;
	float in_stack_00000020;
	float in_stack_00000024;
	float in_stack_00000028;
	int in_stack_0000002c;
	uint in_stack_00000030;
	undefined4 in_stack_00000034;
	float in_stack_00000038;
	undefined4 in_stack_0000003c;
	float in_stack_00000040;
	float in_stack_00000044;
	float in_stack_00000048;
	float in_stack_0000004c;
	float in_stack_00000050;
	float in_stack_ffffffe8;
	float in_stack_ffffffec;
	float in_stack_fffffff0;
	float in_stack_fffffff4;
	float in_stack_fffffff8;
	float in_stack_fffffffc;
	
	if (param_2 == 0.0) {
		if (lego::globals::g_Game.unkbool_308 == 1) {
			lego::res::Res_GetPosition
								((lego::globals::g_Game.structbc_24)->resData_28,NULL,(Vector3F *)&stack0xffffffe8);
			lego::game::SurfaceMap_ToBlockCoordinatesNoZ
								((lego::globals::g_Game.level)->surfaceMap,in_stack_ffffffe8,in_stack_ffffffec,
								 (int *)&param_2,(int *)&param_1);
			lego::res::Res_GetOrientation
								((lego::globals::g_Game.structbc_24)->resData_24,NULL,(Vector3F *)&stack0xfffffff4,
								 NULL);
			surfMap = lego::game::GetSurfaceMap();
			fVar2 = lego::game::SurfaceMap_GetFloat10(surfMap);
			lego::game::SurfaceMap_ToBlockCoordinatesNoZ
								((lego::globals::g_Game.level)->surfaceMap,
								 (float)(fVar2 * (float10)3.0 * (float10)in_stack_fffffff4) + in_stack_ffffffe8,
								 (float)(fVar2 * (float10)3.0 * (float10)in_stack_fffffff8) + in_stack_ffffffec,
								 (int *)&param_2,(int *)&param_1);
			FUN_004508c0((lego::globals::g_Game.level)->surfaceMap,(int)param_2,(int)param_1,8,
									 &LAB_00429040);
			return;
		}
		if (lego::globals::g_Game.unkbool_308 == 0) {
			param_2 = (lego::globals::g_Game.level)->surfaceMap->BlockSize *
								lego::globals::g_Game.FPClipBlocks;
			fVar1 = (float)lego::globals::g_Game.HPBlocks;
			if (((lego::globals::g_Game.flags1 & GAME1_DYNAMICPM) != GAME1_NONE) && (param_1 != 0.0)) {
				in_stack_ffffffec = 0.0;
				in_stack_ffffffe8 = (float)lego::globals::g_Game.HPBlocks;
				lVar3 = __ftol((float10)(ulonglong)(uint)lego::globals::g_Game.HPBlocks / (float10)param_1);
				fVar1 = (float)lVar3;
			}
			FUN_00433db0((lego::globals::g_Game.structbc_2c)->resData_24,
									 (uint *)lego::globals::g_Game.ptr_1c,(uint)param_2,fVar1,in_stack_ffffffe8,
									 in_stack_ffffffec,in_stack_fffffff0,in_stack_fffffff4,(int)in_stack_fffffff8,
									 in_stack_fffffffc,unaff_retaddr,param_1,param_2,in_stack_0000000c,
									 in_stack_00000010,in_stack_00000014,in_stack_00000018,in_stack_0000001c,
									 in_stack_00000020,in_stack_00000024,in_stack_00000028,in_stack_0000002c,
									 in_stack_00000030,in_stack_00000034,in_stack_00000038,in_stack_0000003c,
									 in_stack_00000040,in_stack_00000044,in_stack_00000048,in_stack_0000004c,
									 in_stack_00000050);
			return;
		}
	}
	else {
		if (((lego::globals::g_Game.flags1 & GAME1_RADARON) != GAME1_NONE) &&
			 ((lego::globals::g_Game.flags1 & GAME1_RADAR_TRACKOBJECTVIEW) != GAME1_NONE)) {
			lego::res::Res_GetPosition
								((lego::globals::g_Game.structbc_28)->resData_28,NULL,(Vector3F *)&stack0xfffffff4);
			lego::game::SurfaceMap_ToBlockCoordinatesNoZ
								((lego::globals::g_Game.level)->surfaceMap,in_stack_fffffff4,in_stack_fffffff8,
								 (int *)&param_2,(int *)&param_1);
			FUN_004508c0((lego::globals::g_Game.level)->surfaceMap,(int)param_2,(int)param_1,2,NULL);
		}
	}
	return;
}



void __cdecl FUN_004292e0(undefined4 param_1)
{
	undefined4 local_38;
	undefined4 local_34;
	float local_30;
	float local_2c;
	undefined4 local_28;
	undefined4 local_24;
	float local_20;
	undefined4 local_1c;
	float local_18;
	float local_14;
	undefined4 local_10;
	float local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	if ((lego::globals::g_Game.flags1 & GAME1_UNK_100) != GAME1_NONE) {
		local_2c = (float)lego::globals::g_MousePosition.y;
		local_30 = (float)lego::globals::g_MousePosition.x;
		FUN_00477590((int)lego::globals::g_Game.ptr_1c,&local_38,0x557164);
		local_28 = local_38;
		local_24 = local_34;
		local_20 = local_30;
		local_1c = local_34;
		local_18 = local_30;
		local_14 = local_2c;
		local_10 = local_38;
		local_c = local_2c;
		local_8 = local_38;
		local_4 = local_34;
		lego::draw::Draw_SurfaceLock_FUN_004862b0
							(&local_28,&local_20,4,lego::globals::g_Game.DragBoxRGB.red,
							 lego::globals::g_Game.DragBoxRGB.green,lego::globals::g_Game.DragBoxRGB.blue,2);
	}
	return;
}



void __cdecl FUN_004293a0(uint param_1,float param_2,float *out_x,float *out_y)
{
	BOOL BVar1;
	Vector3F local_4c;
	Vector3F local_40;
	Vector3F local_34;
	Vector3F local_28;
	Vector3F local_1c;
	float local_10;
	float local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_28.x = 0.0;
	local_4c.x = param_2;
	local_4c.y = 0.0;
	local_28.y = 0.0;
	local_28.z = 0.0;
	local_34.x = 0.0;
	local_34.y = 0.0;
	local_34.z = -1.0;
	local_8 = 0;
	local_4 = 0x3f800000;
	local_10 = (float)(ulonglong)param_1;
	local_c = (float)(ulonglong)(uint)param_2;
	FUN_00477550((int)lego::globals::g_Game.ptr_1c,&local_40,&local_10);
	local_8 = 0x3f800000;
	local_4 = 0x3f800000;
	local_10 = (float)(ulonglong)param_1;
	local_c = (float)(ulonglong)(uint)param_2;
	FUN_00477550((int)lego::globals::g_Game.ptr_1c,&local_4c,&local_10);
	local_4c.x = local_4c.x - local_40.x;
	local_4c.y = local_4c.y - local_40.y;
	local_4c.z = local_4c.z - local_40.z;
	BVar1 = lego::math::Vector3_Unk_FUN_00479ba0(&local_1c,&local_40,&local_4c,&local_28,&local_34);
	if (BVar1 != 0) {
		*out_x = local_1c.x;
		*out_y = local_1c.y;
	}
	return;
}



ResourceData * FUN_004294d0(void)
{
	ResourceData *pRVar1;
	
	pRVar1 = lego::globals::g_Game.struct2c_38;
	if (lego::globals::g_Game.unkbool_308 != 0) {
		pRVar1 = lego::globals::g_Game.struct2c_44;
	}
	return pRVar1;
}



BOOL __cdecl FUN_004294f0(LiveObject *liveObj)
{
	if (((lego::globals::g_Game.unkbool_308 != 0) || (liveObj != lego::globals::g_Game.object_a0)) &&
		 ((liveObj->drivenObject == NULL || (liveObj->drivenObject != lego::globals::g_Game.object_a0)))
		 ) {
		return 0;
	}
	return 1;
}



// WARNING: Type propagation algorithm not settling

void __cdecl FUN_00429520(BOOL param_1,LiveObject *liveObj,int param_3)
{
	BOOL BVar1;
	
	BVar1 = param_1;
	if (param_1 == 0) {
		param_1 = 0x3f666666;
		if (param_3 != 0) {
			param_1 = 0x3f19999a;
		}
		lego::unk::StructBC_SetObject4_Field14(lego::globals::g_Game.structbc_2c,liveObj,param_3);
		FUN_0046e480(1);
		FUN_00450d40((lego::globals::g_Game.level)->surfaceMap,1);
		lego::globals::g_Game.object_a0 = liveObj;
		if (liveObj->objType == OBJECT_MINIFIGURE) {
			FUN_0043a130(liveObj,0);
		}
		FUN_00477210((int)lego::globals::g_Game.ptr_1c,(lego::globals::g_Game.structbc_2c)->resData_24);
		lego::snd::Snd_SetListener3DRootFrame((lego::globals::g_Game.structbc_2c)->resData_24->frame1);
		lego::snd::Audio_SetMinDistFor3DSoundsOnTopView(50.0);
		FUN_00477500((int)lego::globals::g_Game.ptr_1c,(float)param_1);
		lego::main::Main_SetTVClipDist_InStruct
							((int)lego::globals::g_Game.ptr_1c,
							 (lego::globals::g_Game.level)->BlockSize * lego::globals::g_Game.FPClipBlocks);
		lego::globals::g_Game.unkbool_308 = BVar1;
		return;
	}
	if (param_1 == 1) {
		if (lego::globals::g_Game.object_a0 != NULL) {
			FUN_0042dd70(lego::globals::g_Game.object_a0,NULL,0);
		}
		(lego::globals::g_Game.structbc_2c)->object_4 = NULL;
		lego::globals::g_Game.object_a0 = NULL;
		FUN_0046e480(0);
		FUN_00450d40((lego::globals::g_Game.level)->surfaceMap,0);
		FUN_00477210((int)lego::globals::g_Game.ptr_1c,(lego::globals::g_Game.structbc_24)->resData_24);
		lego::snd::Snd_SetListener3DRootFrame
							((IDirect3DRMFrame3 *)
							 ((IDirect3DRMFrame3 *)(lego::globals::g_Game.structbc_24)->tableunk_34)->lpVtbl);
		lego::snd::Audio_SetMinDistFor3DSoundsOnTopView
							(lego::globals::g_Game.MinDistFor3DSoundsOnTopView);
		FUN_00477510((int)lego::globals::g_Game.ptr_1c,0.5);
		lego::main::Main_SetTVClipDist_InStruct
							((int)lego::globals::g_Game.ptr_1c,lego::globals::g_Game.TVClipDist);
	}
	lego::globals::g_Game.unkbool_308 = param_1;
	return;
}



void __cdecl lego::snd::Music_CDAudio_PlayNextCallback(void)
{
	Music_CDAudio_Close();
	Music_PlayNext(1);
	return;
}



void __cdecl lego::snd::Music_PlayNext(BOOL isMusicOn)
{
	short sVar1;
	
	if (isMusicOn != 0) {
		sVar1 = util::randomInt16();
		globals::g_Game.flags1 |= GAME1_MUSICON;
		Music_PlayTrack(((uint)(int)sVar1 % globals::g_Game.CDTracks - 1) + globals::g_Game.CDStartTrack
										,0,Music_CDAudio_PlayNextCallback);
		return;
	}
	globals::g_Game.flags1 &= ~GAME1_MUSICON;
	Music_CDAudio_Close();
	Music_Update(0);
	return;
}



void __cdecl lego::main::Config_SetSoundEnabled(BOOL isSoundOn)
{
	if (isSoundOn != 0) {
		globals::g_Game.flags1 |= GAME1_SOUNDON;
		snd::Audio_SetFlag1_AndOtherFunc_true(isSoundOn);
		return;
	}
	globals::g_Game.flags1 &= ~GAME1_SOUNDON;
	snd::Audio_SetFlag1_AndOtherFunc_true(0);
	return;
}



int __cdecl lego::game::Level_GetEmergeCreature(void)
{
	return (globals::g_Game.level)->EmergeCreature;
}



float10 __cdecl lego::game::Level_GetObjectUpgradeTime(ObjectType objType)
{
	return (float10)(globals::g_Game.level)->UpgradeTimes[objType];
}



float10 __cdecl lego::game::Level_GetTrainTime(void)
{
	return (float10)(globals::g_Game.level)->TrainTime;
}



// WARNING: Could not reconcile some variable overlaps

BOOL __cdecl lego::main::Main_loadLevelCFG(char *levelName)
{
	float fVar1;
	CFGProperty *root;
	char cVar2;
	undefined *puVar3;
	undefined4 *puVar4;
	int iVar5;
	LevelData *level;
	char *pcVar6;
	uint uVar7;
	BOOL3 BVar8;
	float fVar9;
	BOOL BVar10;
	LiveObject *pLVar11;
	LiveObject **ppLVar12;
	LevelData *pLVar13;
	float *pfVar14;
	uint uVar15;
	float10 fVar16;
	ColourRGBF *pCVar17;
	float *pfVar18;
	float local_1c0;
	float local_1bc;
	float local_1b8;
	char *nameEmergeCreature;
	ObjectType local_1b0;
	char *local_1ac;
	char *local_1a8;
	char *local_1a4;
	char *local_1a0;
	char *local_19c;
	char *local_198;
	char *local_194;
	char *local_190;
	char *local_18c;
	char *local_188;
	char *local_184;
	Size2F filenameObjectList;
	char *local_178;
	char *filenameIntroAVI;
	char *filenameNERPMessage;
	char *filenameNERP;
	char *filenamePTL;
	uint local_164;
	char *local_160;
	char *local_15c;
	int local_134;
	char *local_130;
	LiveObject *local_12c [10];
	char local_104 [260];
	
	root = globals::g_Game.LegoCfgRoot;
	game::Level_DoVideo__004158c0(levelName,1);
	unk::Lego_CleanupLinkedStruct20();
	FUN_00415080();
	game::Game_SetPlaceFlagsState_004dd650(0);
	unk::Lego_SetBool_004b9a54(0);
	FUN_0044b080(0);
	puVar3 = FUN_00417da0();
	if (puVar3 == NULL) {
		puVar4 = NULL;
	}
	else {
		puVar4 = (undefined4 *)(puVar3 + 0x1c);
	}
	FUN_00437390(puVar4);
	iVar5 = unk::Lego_GetDat_00500e64();
	if ((iVar5 == 0) && (iVar5 = save::Save_GetSaveNumber(), iVar5 != -1)) {
		std::sprintf(local_104,"%s\\%i.osf","Saves",iVar5);
		unk::Lego_Read_SORRFile__00459730(local_104);
	}
	level = (LevelData *)std::malloc(0x284);
	if (level == NULL) goto LAB_0042b198;
	pLVar13 = level;
	for (iVar5 = 0xa1; iVar5 != 0; iVar5 += -1) {
		pLVar13->levelName = NULL;
		pLVar13 = (LevelData *)&pLVar13->surfaceMap;
	}
	globals::g_Game.flags1 |= GAME1_UNK_4;
	globals::g_Game.level = level;
	LoaderProfile_Lookup(levelName);
	game::Level_LoadPriorities(root,globals::g_Game.CfgRootName,levelName);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"Seed",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"Seed",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	uVar7 = std::atoi(pcVar6);
	if (uVar7 != 0) {
		util::randomSeed(uVar7);
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"BoulderAnimation",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if ((pcVar6 == NULL) || (iVar5 = std::_stricmp(pcVar6,"Rock"), iVar5 == 0)) {
LAB_00429989:
		level->BoulderAnimation = TEXTURES_ROCK;
	}
	else {
		iVar5 = std::_stricmp(pcVar6,"Lava");
		if (iVar5 == 0) {
			level->BoulderAnimation = TEXTURES_LAVA;
		}
		else {
			iVar5 = std::_stricmp(pcVar6,"Ice");
			if (iVar5 != 0) goto LAB_00429989;
			level->BoulderAnimation = TEXTURES_ICE;
		}
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"FallinMultiplier",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"FallinMultiplier",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	globals::g_Game.FallinMultiplier = std::atoi(pcVar6);
	if (globals::g_Game.FallinMultiplier == 0) {
		globals::g_Game.FallinMultiplier = 1;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"blocksize",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"blocksize",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	level->BlockSize = (float)fVar16;
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"digdepth",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"digdepth",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	level->DigDepth = (float)fVar16;
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"useroof",0);
	BVar8 = cfg::CFG_GetPropertyBool(root,pcVar6);
	level->UseRoof = BVar8;
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"roofheight",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"roofheight",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	level->RoofHeight = (float)fVar16;
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"roughlevel",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"roughlevel",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	level->RoughLevel = (float)fVar16;
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"surfacemap",0);
	local_1a0 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"predugmap",0);
	local_1a8 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"terrainmap",0);
	local_194 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"blockPointersMap",0);
	local_198 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"CryOreMap",0);
	local_1ac = cfg::CFG_CopyPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"ErodeMap",0);
	local_18c = cfg::CFG_CopyPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"EmergeMap",0);
	local_184 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"AIMap",0);
	local_188 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"PathMap",0);
	local_1a4 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"FallinMap",0);
	local_190 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"textureset",0);
	local_178 = cfg::CFG_GetPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"EmergeTimeOut",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"EmergeTimeOut",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	level->EmergeTimeOut = (float)fVar16;
	if (fVar16 == (float10)0.0) {
		level->EmergeTimeOut = 1500.0;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"olistfile",0);
	filenameObjectList.width = (float)cfg::CFG_GetPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"elistfile",0);
	cfg::CFG_GetPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"selboxheight",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"selboxheight",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	level->SelBoxHeight = (float)fVar16;
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"PTLFile",0);
	filenamePTL = cfg::CFG_GetPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"NERPFile",0);
	filenameNERP = cfg::CFG_GetPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"NERPMessageFile",0);
	filenameNERPMessage = cfg::CFG_GetPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"EmergeCreature",0);
	nameEmergeCreature = cfg::CFG_GetPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"SafeCaverns",0);
	BVar8 = cfg::CFG_GetPropertyBool(root,pcVar6);
	level->SafeCaverns = BVar8;
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"IntroAVI",0);
	filenameIntroAVI = cfg::CFG_GetPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"StartFP",0);
	uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
	level->StartFP = (uint)(uVar7 == 1);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"NoDrain",0);
	uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
	level->NoDrain = (uint)(uVar7 == 1);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"OxygenRate",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"OxygenRate",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	level->OxygenRate = (float)(fVar16 * (float10)0.001);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"UpgradeTime",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"UpgradeTime",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	fVar9 = (float)(fVar16 * (float10)25.0);
	pfVar14 = level->UpgradeTimes;
	for (iVar5 = 0x14; iVar5 != 0; iVar5 += -1) {
		*pfVar14 = fVar9;
		pfVar14 = pfVar14 + 1;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"MinifigureUpgradeTime",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"MinifigureUpgradeTime",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	fVar1 = (float)fVar16;
	level->UpgradeTimes[2] = fVar1;
	if (fVar1 == 0.0) {
		level->UpgradeTimes[2] = fVar9;
	}
	else {
		level->UpgradeTimes[2] = fVar1 * 25.0;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"VehicleUpgradeTime",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"VehicleUpgradeTime",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	fVar1 = (float)fVar16;
	level->UpgradeTimes[1] = fVar1;
	if (fVar1 == 0.0) {
		level->UpgradeTimes[1] = fVar9;
	}
	else {
		level->UpgradeTimes[1] = fVar1 * 25.0;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"BuildingUpgradeTime",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"BuildingUpgradeTime",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	fVar1 = (float)fVar16;
	level->UpgradeTimes[4] = fVar1;
	if (fVar1 == 0.0) {
		level->UpgradeTimes[4] = fVar9;
	}
	else {
		level->UpgradeTimes[4] = fVar1 * 25.0;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"TrainTime",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"TrainTime",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	level->TrainTime = (float)(fVar16 * (float10)25.0);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"NoMultiSelect",0);
	uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
	if (uVar7 == 1) {
		globals::g_Game.flags2 |= GAME2_NOMULTISELECT;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"NoAutoEat",0);
	uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
	if (uVar7 == 1) {
		globals::g_Game.flags2 |= GAME2_NOAUTOEAT;
	}
	else {
		globals::g_Game.flags2 &= ~GAME2_NOAUTOEAT;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"EndGameAVI1",0);
	globals::g_Game.EndGameAVI1 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"EndGameAVI2",0);
	globals::g_Game.EndGameAVI2 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	if (globals::g_Game.RenameReplace != NULL) {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"AllowRename",0);
		uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
		if (uVar7 == 1) {
			globals::g_Game.flags2 |= GAME2_ALLOWRENAME;
		}
		else {
			globals::g_Game.flags2 &= ~GAME2_ALLOWRENAME;
		}
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"RecallOLObjects",0);
	uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
	if (uVar7 == 1) {
		globals::g_Game.flags2 |= GAME2_RECALLOLOBJECTS;
	}
	else {
		globals::g_Game.flags2 &= ~GAME2_RECALLOLOBJECTS;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"GenerateSpiders",0);
	uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
	if (uVar7 == 1) {
		globals::g_Game.flags2 |= GAME2_GENERATESPIDERS;
	}
	else {
		globals::g_Game.flags2 &= ~GAME2_GENERATESPIDERS;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"DisableToolTipSound",0);
	uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
	if (uVar7 == 1) {
		globals::g_Game.flags2 |= GAME2_DISABLETOOLTIPSOUND;
	}
	else {
		globals::g_Game.flags2 &= ~GAME2_DISABLETOOLTIPSOUND;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"DisableEndTeleport",0);
	uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
	game::Game_SetEndTeleportEnabled((uint)(uVar7 != 1));
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"DragBoxRGB",0);
	pcVar6 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	local_19c = pcVar6;
	if (pcVar6 != NULL) {
		iVar5 = util::stringSplit(pcVar6,(char **)local_12c,":");
		if (iVar5 == 3) {
			uVar7 = 0;
			do {
				local_1b0 = std::atoi(*(char **)((int)local_12c + uVar7));
				uVar15 = uVar7 + 4;
				*(float *)((int)globals::g_Game.UpgradeNames_TABLE + (uVar7 - 0x2c)) =
						 (float)local_1b0 * 0.003921569;
				pcVar6 = local_19c;
				uVar7 = uVar15;
			} while (uVar15 < 0xc);
		}
		std::free(pcVar6);
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"BuildingTolerance",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"BuildingTolerance",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	level->BuildingTolerance = (float)fVar16;
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"BuildingMaxVariation",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"BuildingMaxVariation",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	level->BuildingMaxVariation = (float)fVar16;
	if (level->BuildingTolerance == 0.0) {
		level->BuildingTolerance = 4.0;
	}
	if ((float10)0.0 == fVar16) {
		level->BuildingMaxVariation = 6.0;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"MaxStolen",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"MaxStolen",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar9 = (float)std::atoi(pcVar6);
	level->MaxStolen = fVar9;
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"Slug",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		level->Slug = 0x14;
	}
	else {
		BVar10 = game::Game_GetObjectByName(pcVar6,&local_1b0,&level->Slug,NULL);
		if (BVar10 != 0) {
			pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"SlugTime",0);
			pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
			if (pcVar6 == NULL) {
				pcVar6 = ____EMPTYSTR__;
			}
			else {
				pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"SlugTime",0);
				pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
			}
			fVar16 = std::atof(pcVar6);
			level->SlugTime = (float)fVar16;
			if ((float)fVar16 == 0.0) {
				level->SlugTime = 60.0;
			}
			level->SlugTime = level->SlugTime * 25.0;
			pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"InitialSlugTime",0);
			pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
			if (pcVar6 == NULL) {
				pcVar6 = ____EMPTYSTR__;
			}
			else {
				pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"InitialSlugTime",0);
				pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
			}
			fVar16 = std::atof(pcVar6);
			if ((float10)0.0 == fVar16) {
				fVar16 = (float10)60.0;
			}
			globals::g_Game.InitialSlugTime = (float)(fVar16 * (float10)25.0);
		}
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"RockFallStyle",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	game::Game_GetRockFallStyle(pcVar6,&local_164);
	game::Game_SetRockFallStyleIndex(local_164);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"noFallins",0);
	uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
	globals::g_Game.IsFallinsEnabled = ZEXT14(uVar7 != 1);
	game::Level_LoadRewardQuotaCrystals(root,globals::g_Game.CfgRootName,levelName);
	game::Game_GetObjectByName
						(nameEmergeCreature,(ObjectType *)&nameEmergeCreature,&level->EmergeCreature,NULL);
	pfVar18 = &globals::g_Game.FogColourRGB.blue;
	pfVar14 = &globals::g_Game.FogColourRGB.green;
	pCVar17 = &globals::g_Game.FogColourRGB;
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"FogColourRGB",0);
	BVar10 = cfg::CFG_GetPropertyRGBF
										 (globals::g_Game.LegoCfgRoot,pcVar6,(float *)pCVar17,pfVar14,pfVar18);
	if (BVar10 == 0) {
		globals::g_Game.flags1 &= ~GAME1_FOGCOLOURRGB;
	}
	else {
		pfVar18 = &globals::g_Game.HighFogColourRGB.blue;
		pfVar14 = &globals::g_Game.HighFogColourRGB.green;
		pCVar17 = &globals::g_Game.HighFogColourRGB;
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"HighFogColourRGB",0);
		BVar10 = cfg::CFG_GetPropertyRGBF
											 (globals::g_Game.LegoCfgRoot,pcVar6,(float *)pCVar17,pfVar14,pfVar18);
		if (BVar10 == 0) {
			globals::g_Game.flags1 &= ~GAME1_HIGHFOGCOLOURRGB;
		}
		else {
			globals::g_Game.flags1 |= GAME1_HIGHFOGCOLOURRGB;
			globals::g_Game.float_364 = 1.0;
			pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"FogRate",0);
			pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
			if (pcVar6 == NULL) {
				pcVar6 = ____EMPTYSTR__;
			}
			else {
				pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"FogRate",0);
				pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
			}
			fVar16 = std::atof(pcVar6);
			if ((float10)0.0 == fVar16) {
				globals::g_Game.FogRate = 1500.0;
			}
			else {
				globals::g_Game.FogRate = (float)fVar16 * 25.0;
			}
		}
		res::Res_SetRootSceneFogColor
							(globals::g_Game.FogColourRGB.red,globals::g_Game.FogColourRGB.green,
							 globals::g_Game.FogColourRGB.blue);
		res::Res_SetRootSceneFogMethod(D3DRMFOGMETHOD_TABLE);
		res::Res_SetRootSceneFogParams
							(0.0,(globals::g_Game.level)->BlockSize * globals::g_Game.FPClipBlocks,0.0032);
		globals::g_Game.flags1 |= GAME1_FOGCOLOURRGB;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"nextlevel",0);
	pcVar6 = cfg::CFG_CopyPropertyValue(root,pcVar6);
	level->NextLevel = pcVar6;
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"FullName",0);
	nameEmergeCreature = cfg::CFG_CopyPropertyValue(root,pcVar6);
	level->FullName = nameEmergeCreature;
	if (nameEmergeCreature == NULL) {
		level->FullName = NULL;
	}
	else {
		iVar5 = -1;
		uVar7 = 0;
		pcVar6 = nameEmergeCreature;
		do {
			if (iVar5 == 0) break;
			iVar5 += -1;
			cVar2 = *pcVar6;
			pcVar6 = pcVar6 + 1;
		} while (cVar2 != '\0');
		if (iVar5 != -2) {
			do {
				cVar2 = nameEmergeCreature[uVar7];
				if (cVar2 == '_') {
					cVar2 = ' ';
				}
				nameEmergeCreature[uVar7] = cVar2;
				nameEmergeCreature = level->FullName;
				uVar15 = 0xffffffff;
				uVar7 += 1;
				pcVar6 = nameEmergeCreature;
				do {
					if (uVar15 == 0) break;
					uVar15 -= 1;
					cVar2 = *pcVar6;
					pcVar6 = pcVar6 + 1;
				} while (cVar2 != '\0');
			} while (uVar7 < ~uVar15 - 1);
		}
	}
	game::Level_LoadObjectiveInfo
						(root,globals::g_Game.CfgRootName,levelName,level,globals::g_RESOLUTION.width,
						 globals::g_RESOLUTION.height);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"ErodeTriggerTime",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"ErodeTriggerTime",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	local_1bc = (float)fVar16;
	if ((float10)0.0 == fVar16) {
		local_1bc = 10.0;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"ErodeErodeTime",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"ErodeErodeTime",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	local_1b8 = (float)fVar16;
	if ((float10)0.0 == fVar16) {
		local_1b8 = 5.0;
	}
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"ErodeLockTime",0);
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"ErodeLockTime",0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	fVar16 = std::atof(pcVar6);
	local_1c0 = (float)fVar16;
	if ((float10)0.0 == fVar16) {
		local_1c0 = 60.0;
	}
	game::Game_SetErodeTimes(local_1bc,local_1b8,local_1c0);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"NumberOfLandSlidesTillCaveIn",0)
	;
	pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	if (pcVar6 == NULL) {
		pcVar6 = ____EMPTYSTR__;
	}
	else {
		pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"NumberOfLandSlidesTillCaveIn",
															 0);
		pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
	}
	iVar5 = std::atoi(pcVar6);
	if (iVar5 == 0) {
		iVar5 = 3;
	}
	game::Game_SetNumberOfLandSlidesTillCaveIn(iVar5);
	pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"DisableStartTeleport",0);
	uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
	level->levelName = levelName;
	level->IsStartTeleportEnabled = (uint)(uVar7 != 1);
	level->float_204 = (float)&DAT_42c80000;
	level->oxygenLevel = (float)&DAT_42c80000;
	level->numCrystals = 0;
	level->numOre = 0;
	level->field_90 = 0;
	level->field_a4 = 0;
	level->field_94 = 0;
	level->field_a8 = 0;
	level->status = LEVELSTATUS_NONE;
	globals::g_Game.placeDestSmallTeleporter = NULL;
	globals::g_Game.placeDestBigTeleporter = NULL;
	game::Level_LoadNERPsFile(filenameNERP);
	game::Level_LoadNERPMessageFile(filenameNERPMessage);
	BVar10 = Main_loadPTLCFG__0045daa0(filenamePTL,globals::g_Game.CfgRootName);
	if (BVar10 != 0) {
		local_1bc = 0.0;
		local_1c0._0_1_ = '\0';
		local_1b8 = 0.0;
		local_19c = NULL;
		local_1b0 = OBJECT_NONE;
		if ((local_1a0 != NULL) && (iVar5 = util::stringSplit(local_1a0,&local_160,":"), iVar5 == 2)) {
			std::atoi(local_15c);
		}
		if ((local_1a8 != NULL) && (iVar5 = util::stringSplit(local_1a8,&local_160,":"), iVar5 == 2)) {
			local_1b0 = std::atoi(local_15c);
		}
		if ((local_194 != NULL) && (iVar5 = util::stringSplit(local_194,&local_160,":"), iVar5 == 2)) {
			local_19c = (char *)std::atoi(local_15c);
		}
		if ((local_198 != NULL) && (iVar5 = util::stringSplit(local_198,&local_160,":"), iVar5 == 2)) {
			local_1b8 = (float)std::atoi(local_15c);
		}
		if ((local_1ac != NULL) && (iVar5 = util::stringSplit(local_1ac,&local_160,":"), iVar5 == 2)) {
			iVar5 = std::atoi(local_15c);
			local_1c0._0_1_ = (char)iVar5;
		}
		if ((local_1a4 != NULL) && (iVar5 = util::stringSplit(local_1a4,&local_160,":"), iVar5 == 2)) {
			local_1bc = (float)std::atoi(local_15c);
		}
		if ((local_190 != NULL) && (iVar5 = util::stringSplit(local_190,&local_160,":"), iVar5 == 2)) {
			std::atoi(local_15c);
		}
		pcVar6 = local_184;
		if ((local_184 != NULL) && (iVar5 = util::stringSplit(local_184,&local_160,":"), iVar5 == 2)) {
			local_1bc = (float)std::atoi(local_15c);
		}
		BVar10 = game::Level_LoadMapFiles
											 (level,local_1a0,local_1a8,local_1b0,local_194,(int)local_19c,local_198,
												local_1b8,local_1ac,local_1c0._0_1_,local_18c,local_1a4,(int)local_1bc,
												local_178,pcVar6,local_188,local_190);
		if (BVar10 != 0) {
			std::free(local_1a0);
			std::free(local_1a8);
			std::free(local_194);
			std::free(local_198);
			std::free(local_1ac);
			std::free(local_18c);
			std::free(pcVar6);
			std::free(local_188);
			std::free(local_190);
			if (local_1a4 != NULL) {
				std::free(local_1a4);
			}
			FUN_0040cdb0(level);
			game::Level_Start(level);
			game::Level_SetCompleteStatus(LEVELSTATUS_NONE);
			FUN_00458ea0(globals::g_Game.struct830_80,globals::g_Game.level,1.0,1.0);
			BVar10 = Main_loadObjectListCFG(level,(char *)filenameObjectList.width);
			if (BVar10 != 0) {
				pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"InitialCrystals",0);
				pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
				if (pcVar6 == NULL) {
					pcVar6 = ____EMPTYSTR__;
				}
				else {
					pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"InitialCrystals",0);
					pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
				}
				local_134 = std::atoi(pcVar6);
				pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"InitialOre",0);
				pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
				if (pcVar6 == NULL) {
					pcVar6 = ____EMPTYSTR__;
				}
				else {
					pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"InitialOre",0);
					pcVar6 = cfg::CFG_GetPropertyValue(root,pcVar6);
				}
				local_130 = (char *)std::atoi(pcVar6);
				FUN_00437a70(FUN_0042b220,(LiveObject *)&stack0xfffffec8);
				LoaderProfile_Lookup(NULL);
				filenameObjectList.width = 350.0;
				filenameObjectList.height = 70.0;
				FUN_0042eef0(filenameIntroAVI,&filenameObjectList);
				pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"NoGather",0);
				uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
				game::Level_SetNoGather((uint)(uVar7 == 1));
				unk::Lego_SetFlag4_004ddd48(1);
				if ((level->StartFP == 0) || (MINIFIGOBJ_004e9448 == NULL)) {
					FUN_00429520(1,NULL,0);
				}
				else {
					FUN_00429520(0,MINIFIGOBJ_004e9448,1);
					game::Level_AddMessageAction(MESSAGE_SELECT,MINIFIGOBJ_004e9448,0,NULL);
					FUN_0041b200(0xf,NULL);
				}
				game::Level_InitBlockPointersTable(level);
				pcVar6 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,levelName,"Precreate",0);
				uVar7 = cfg::CFG_GetPropertyBool(root,pcVar6);
				if (uVar7 == 1) {
					ppLVar12 = local_12c;
					iVar5 = 10;
					do {
						pLVar11 = game::LiveObject__Create
																((int **)globals::g_Game.MiniFigureData_TABLE,OBJECT_MINIFIGURE,0);
						*ppLVar12 = pLVar11;
						ppLVar12 = ppLVar12 + 1;
						iVar5 += -1;
					} while (iVar5 != 0);
					ppLVar12 = local_12c;
					iVar5 = 10;
					do {
						pool::ReservedPool_LiveObject___Release(*ppLVar12);
						ppLVar12 = ppLVar12 + 1;
						iVar5 += -1;
					} while (iVar5 != 0);
				}
				return 1;
			}
		}
	}
	std::free(level);
LAB_0042b198:
	std::free(local_1a0);
	std::free(local_1a8);
	std::free(local_194);
	std::free(local_198);
	std::free(local_1ac);
	std::free(local_18c);
	std::free(local_184);
	LoaderProfile_Lookup(NULL);
	globals::g_Game.level = NULL;
	return 0;
}



undefined4 __cdecl FUN_0042b220(int param_1,int param_2)
{
	ObjectStatsFlags1 OVar1;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1);
	if ((OVar1 & STATS1_STOREOBJECTS) != STATS1_NONE) {
		FUN_0043abb0(param_1,*(int *)(param_2 + 4));
		FUN_0043abd0(param_1,*(int *)(param_2 + 8));
	}
	return 0;
}



BOOL __cdecl FUN_0042b260(LevelData *level,char *meshBaseName)
{
	uint uVar1;
	undefined4 *puVar2;
	ProMeshData *pPVar3;
	uint uVar4;
	int iVar5;
	uint uVar6;
	uint uVar7;
	int local_20c;
	char meshName_a [256];
	char meshName_b [256];
	
	uVar4 = (level->surfTextSize).height;
	uVar1 = (level->surfTextSize).width;
	puVar2 = (undefined4 *)std::malloc(uVar4 * uVar1 * 4);
	level->field_0x80 = puVar2;
	if (puVar2 == NULL) {
		return 0;
	}
	if ((lego::globals::g_CMDLINE_FLAGS & CMD_REDUCEPROMESHES) == CMD_NONE) {
		uVar7 = 0;
		if (uVar4 != 0) {
			local_20c = 0;
			do {
				uVar6 = 0;
				iVar5 = local_20c;
				if (uVar1 != 0) {
					do {
						std::sprintf(meshName_a,"%s%0.1x%0.1xa",meshBaseName,uVar6,uVar7);
						std::sprintf(meshName_b,"%s%0.1x%0.1xb",meshBaseName,uVar6,uVar7);
						pPVar3 = FUN_0040b520(lego::globals::g_Game.resRoot,meshName_a,meshName_b,
																	level->BlockSize,level->surfTextGrid);
						uVar6 += 1;
						*(ProMeshData **)(level->field_0x80 + iVar5) = pPVar3;
						iVar5 = iVar5 + 4;
					} while (uVar6 < uVar1);
				}
				uVar7 += 1;
				local_20c += uVar1 * 4;
			} while (uVar7 < uVar4);
			return 1;
		}
	}
	else {
		for (uVar4 = uVar4 * uVar1 & 0x3fffffff; uVar4 != 0; uVar4 -= 1) {
			*puVar2 = 0;
			puVar2 = puVar2 + 1;
		}
		for (iVar5 = 0; iVar5 != 0; iVar5 += -1) {
			*(undefined *)puVar2 = 0;
			puVar2 = (undefined4 *)((int)puVar2 + 1);
		}
	}
	return 1;
}



void __cdecl FUN_0042b3b0(int param_1)
{
	void *pvVar1;
	int iVar2;
	int iVar3;
	void *this;
	int iVar4;
	void *extraout_ECX;
	int iVar5;
	int iVar6;
	
	iVar4 = param_1;
	iVar2 = *(int *)(param_1 + 0x74);
	if (*(int *)(param_1 + 0x78) != 0) {
		pvVar1 = (void *)(iVar2 * 4);
		iVar5 = 0;
		iVar3 = iVar2;
		this = pvVar1;
		param_1 = *(int *)(param_1 + 0x78);
		iVar6 = iVar5;
		do {
			for (; iVar3 != 0; iVar3 = iVar3 + -1) {
				FUN_0040b700(this,*(int ***)(*(int *)(iVar4 + 0x80) + iVar5));
				iVar5 += 4;
				this = extraout_ECX;
			}
			iVar5 = iVar6 + (int)pvVar1;
			param_1 += -1;
			iVar3 = iVar2;
			this = pvVar1;
			iVar6 = iVar5;
		} while (param_1 != 0);
	}
	std::free(*(void **)(iVar4 + 0x80));
	*(undefined4 *)(iVar4 + 0x80) = 0;
	return;
}



LevelStruct_3c * __cdecl FUN_0042b430(void)
{
	return (lego::globals::g_Game.level)->struct3c_84;
}



BOOL __cdecl
lego::game::Level_LoadMapFiles
					(LevelData *level,char *surfaceMap,char *predugMap,int predugParam,char *terrainMap,
					int terrainParam,char *blockPointersMap,int blockPointersParam,char *cryOreMap,
					char cryOreParam,char *erodeMap,char *pathMap,int pathParam,char *textureSet,
					char *emergeMap,char *aiMap,char *fallinMap)
{
	short sVar1;
	LevelSurfaceMap *pLVar2;
	LevelStruct_3c *pLVar3;
	BOOL BVar4;
	uint uVar5;
	int iVar6;
	uint uVar7;
	uint uVar8;
	
	pLVar2 = Level_CreatureSurfaceMap
										 (globals::g_Game.resRoot,surfaceMap,level->BlockSize,level->RoughLevel);
	level->surfaceMap = pLVar2;
	if (pLVar2 != NULL) {
		pLVar3 = (LevelStruct_3c *)
						 FUN_0045dd50(pLVar2,(int *)&globals::g_Game.float_324,
													(int)globals::g_Game.tvTiltOrZoom_334);
		level->struct3c_84 = pLVar3;
		FUN_0044f750(level->surfaceMap,1);
		FUN_0044e970(level->surfaceMap,0x70);
		FUN_0044e970(level->surfaceMap,0x70);
		FUN_0044e970(level->surfaceMap,0x70);
		FUN_0044e970(level->surfaceMap,0x70);
		FUN_0044e970(level->surfaceMap,0x70);
		FUN_0044e970(level->surfaceMap,0x70);
		pLVar2 = level->surfaceMap;
		(level->dimensions).width = (pLVar2->dimensions).width;
		(level->dimensions).height = (pLVar2->dimensions).height;
		FUN_0040cdb0(level);
		Level_Start(level);
		if (level->UseRoof != BOOL3_FALSE) {
			FUN_00463060(globals::g_Game.resRoot,(level->dimensions).width,(level->dimensions).height);
			FUN_00463770(1);
		}
		pLVar2 = (LevelSurfaceMap *)main::Main_LoadTextureType(level,textureSet);
		if (pLVar2 != NULL) {
			pLVar2 = (LevelSurfaceMap *)
							 std::malloc((level->dimensions).height * (level->dimensions).width * 0x48);
			level->blocks = (LevelBlock *)pLVar2;
			if (pLVar2 != NULL) {
				uVar7 = 0;
				for (uVar5 = (uint)((level->dimensions).height * (level->dimensions).width * 0x48) >> 2;
						uVar5 != 0; uVar5 -= 1) {
					(pLVar2->smallDimensions).width = 0;
					pLVar2 = (LevelSurfaceMap *)&(pLVar2->smallDimensions).height;
				}
				for (iVar6 = 0; iVar6 != 0; iVar6 += -1) {
					*(undefined *)&(pLVar2->smallDimensions).width = 0;
					pLVar2 = (LevelSurfaceMap *)((int)&(pLVar2->smallDimensions).width + 1);
				}
				if ((level->dimensions).height != 0) {
					do {
						uVar5 = (level->dimensions).width;
						uVar8 = 0;
						if (uVar5 != 0) {
							do {
								level->blocks[uVar7 * uVar5 + uVar8].predug = PREDUG_WALL;
								level->blocks[uVar7 * (level->dimensions).width + uVar8].texture = TEXTURE_GROUND;
								level->blocks[uVar7 * (level->dimensions).width + uVar8].terrain = TERRAIN_TUNNEL;
								level->blocks[uVar7 * (level->dimensions).width + uVar8].flags1 = BLOCK1_NONE;
								level->blocks[uVar7 * (level->dimensions).width + uVar8].field_3 = 0;
								level->blocks[uVar7 * (level->dimensions).width + uVar8].struct1c_18 = NULL;
								level->blocks[uVar7 * (level->dimensions).width + uVar8].float_14 = 0.0;
								sVar1 = lego::util::randomInt16();
								iVar6 = uVar7 * (level->dimensions).width + uVar8;
								uVar8 += 1;
								level->blocks[iVar6].randomness = sVar1;
								uVar5 = (level->dimensions).width;
							} while (uVar8 < uVar5);
						}
						uVar7 += 1;
					} while (uVar7 < (uint)(level->dimensions).height);
				}
				pLVar2 = (LevelSurfaceMap *)Level_LoadPredugMap(level,predugMap,predugParam);
				if (pLVar2 != NULL) {
					pLVar2 = (LevelSurfaceMap *)Level_LoadTerrainMap(level,terrainMap,terrainParam);
					if (pLVar2 != NULL) {
						Level_LoadCryOreMap(level,cryOreMap,cryOreParam);
						Level_LoadErodeMap(level,erodeMap);
						Level_LoadPathMap(level,pathMap,pathParam);
						Level_LoadEmergeMap(level,emergeMap);
						Level_LoadAIMap(level,aiMap);
						Level_LoadFallinMap(level,fallinMap);
						BVar4 = Level_LoadBlockPointersMap(level,blockPointersMap,blockPointersParam);
						if (BVar4 != 0) {
							level->hasBlockPointers = 1;
						}
						uVar5 = 0;
						if ((level->dimensions).height != 0) {
							do {
								uVar7 = 0;
								if ((level->dimensions).width != 0) {
									do {
										Level_UpdateBlockSurfaceUnk(level,uVar7,uVar5);
										uVar7 += 1;
									} while (uVar7 < (uint)(level->dimensions).width);
								}
								uVar5 += 1;
							} while (uVar5 < (uint)(level->dimensions).height);
						}
						FUN_0044eb40(level->surfaceMap);
						Level_Load_FUN_0046de50(globals::g_Game.resRoot,level);
						pLVar2 = (LevelSurfaceMap *)0x1;
					}
				}
			}
		}
	}
	return (BOOL)pLVar2;
}



void __cdecl FUN_0042b780(LevelSurfaceMap *param_1)
{
	byte bVar1;
	uint uVar2;
	uint uVar3;
	byte local_68 [8];
	byte local_60 [8];
	byte local_58 [8];
	byte local_50 [8];
	byte local_48 [8];
	byte local_40 [8];
	byte local_38 [8];
	byte local_30 [16];
	byte local_20 [32];
	
	local_38[0] = 0x70;
	local_38[1] = 0x70;
	local_38[2] = 0x70;
	local_38[3] = 0x70;
	local_38[4] = 0x70;
	local_38[5] = 0x70;
	local_30[4] = 1;
	local_30[5] = 0x40;
	local_30[6] = 0x20;
	local_30[7] = 0x67;
	local_30[12] = 1;
	local_30[13] = 0x40;
	local_30[14] = 0x20;
	local_30[15] = 0x67;
	local_20[0] = 0;
	local_20[1] = 0;
	local_20[2] = 0;
	local_20[3] = 0;
	local_20[4] = 0x46;
	local_20[5] = 0x47;
	local_20[6] = 0x45;
	local_20[7] = 0;
	local_20[8] = 0x76;
	local_20[9] = 0x66;
	local_20[10] = 0x10;
	local_20[11] = 0x11;
	local_20[12] = 0x12;
	local_20[13] = 0x13;
	local_20[14] = 6;
	local_20[15] = 0x16;
	local_20[16] = 0x26;
	local_20[17] = 0x36;
	local_20[18] = 7;
	local_20[19] = 0x61;
	local_20[20] = 0x60;
	local_20[21] = 0x62;
	local_20[22] = 99;
	local_20[23] = 100;
	local_20[24] = 0x65;
	local_20[25] = 0x71;
	local_20[26] = 0x72;
	local_20[27] = 0x73;
	local_20[28] = 0x74;
	local_20[29] = 0x75;
	local_20[30] = 0x30;
	local_30[0] = 5;
	local_30[1] = 4;
	local_30[2] = 3;
	local_30[3] = 2;
	local_30[8] = 5;
	local_30[9] = 4;
	local_30[10] = 3;
	local_30[11] = 2;
	local_68[0] = 0x25;
	local_68[1] = 0x24;
	local_68[2] = 0x23;
	local_68[3] = 0x22;
	local_68[4] = 0x21;
	local_60[0] = 0x35;
	local_60[1] = 0x34;
	local_60[2] = 0x33;
	local_60[3] = 0x32;
	local_60[4] = 0x31;
	local_58[0] = 0x35;
	local_58[1] = 0x34;
	local_58[2] = 0x33;
	local_58[3] = 0x32;
	local_58[4] = 0x31;
	local_50[4] = 0x51;
	local_48[4] = 0x51;
	local_50[0] = 0x55;
	local_50[1] = 0x54;
	local_50[2] = 0x53;
	local_50[3] = 0x52;
	local_48[0] = 0x55;
	local_48[1] = 0x54;
	local_48[2] = 0x53;
	local_48[3] = 0x52;
	local_40[0] = 0x77;
	local_40[1] = 0x77;
	local_40[2] = 0x77;
	local_40[3] = 0x77;
	local_40[4] = 0x77;
	uVar2 = 0;
	do {
		bVar1 = local_20[uVar2];
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_30[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 0x10);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_68[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_60[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_58[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_50[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_48[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_40[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar2 += 1;
	} while (uVar2 < 0x1f);
	uVar2 = 0;
	do {
		bVar1 = local_38[uVar2];
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_30[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 0x10);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_68[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_60[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_58[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_50[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_48[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar3 = 0;
		do {
			FUN_0044f460(param_1,bVar1,local_40[uVar3]);
			uVar3 += 1;
		} while (uVar3 < 5);
		uVar2 += 1;
	} while (uVar2 < 6);
	return;
}



BOOL __cdecl lego::main::Main_LoadTextureType(LevelData *level,char *keyTexturePath)
{
	LevelSurfaceMap *pLVar1;
	CFGProperty *root;
	char *pcVar2;
	int iVar3;
	int iVar4;
	char *pcVar5;
	SurfaceTextureGrid *pSVar6;
	BOOL BVar7;
	BOOL result;
	
	root = globals::g_Game.LegoCfgRoot;
	result = 0;
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,keyTexturePath,"surftextwidth",0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 == NULL) {
		pcVar2 = ____EMPTYSTR__;
	}
	else {
		pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,keyTexturePath,"surftextwidth",0);
		pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	}
	iVar3 = std::atoi(pcVar2);
	if (iVar3 != 0) {
		pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,keyTexturePath,"surftextheight",0);
		pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
		if (pcVar2 == NULL) {
			pcVar2 = ____EMPTYSTR__;
		}
		else {
			pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,keyTexturePath,"surftextheight",0);
			pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
		}
		iVar4 = std::atoi(pcVar2);
		if (iVar4 != 0) {
			pLVar1 = level->surfaceMap;
			(level->surfTextSize).width = iVar3;
			(level->surfTextSize).height = iVar4;
			FUN_0042b780(pLVar1);
			FUN_0044eb40(level->surfaceMap);
			pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,keyTexturePath,"meshbasename",0);
			pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
			if (pcVar2 != NULL) {
				pcVar5 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,keyTexturePath,"texturebasename",0);
				pcVar5 = cfg::CFG_GetPropertyValue(root,pcVar5);
				if (pcVar5 != NULL) {
					pSVar6 = game::Level_LoadTextureBaseName
														 (pcVar5,(level->surfTextSize).width,(level->surfTextSize).height);
					level->surfTextGrid = pSVar6;
					if (pSVar6 != NULL) {
						FUN_0044f4e0(level->surfaceMap,pSVar6);
						BVar7 = FUN_0042b260(level,pcVar2);
						if (BVar7 != 0) {
							pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,keyTexturePath,"rooftexture",0)
							;
							pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
							if (pcVar2 != NULL) {
								BVar7 = Main_LoadRoofTexture(pcVar2);
								if (BVar7 != 0) {
									result = 1;
								}
							}
						}
					}
				}
			}
		}
	}
	return result;
}



BOOL __cdecl lego::game::Level_LoadPredugMap(LevelData *level,char *filename,int modifier)
{
	int *piVar1;
	LevelBlockFlags1 *pLVar2;
	int iVar3;
	uint uVar4;
	char *pcVar5;
	int *piVar6;
	int iVar7;
	uint y;
	int iVar8;
	char *x;
	int local_58;
	uint local_54;
	Point2I local_50;
	int local_48 [5];
	undefined4 local_34;
	undefined4 local_30;
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	if ((filename != NULL) &&
		 (uVar4 = lego::file::File_SharedOpen(filename,NULL), uVar4 != 0xffffffff)) {
		local_54 = uVar4;
		Map_GetDimensions(uVar4,(int *)&filename,&local_58);
		if ((filename == (char *)(level->dimensions).width) && (local_58 == (level->dimensions).height))
		{
			y = 1;
			pcVar5 = filename;
			iVar8 = local_58;
			if (local_58 != 1 && local_58 != 2) {
				do {
					x = (char *)0x1;
					if (pcVar5 != (char *)0x1 && pcVar5 != (char *)0x2) {
						do {
							uVar4 = Map_GetCoordinate(local_54,(int)x,y);
							iVar8 = uVar4 - modifier;
							if ((iVar8 == 1) || (iVar8 == 3)) {
								FUN_00430460(level,(int)x,y,1);
								local_48[0] = -1;
								local_48[1] = 0xffffffff;
								local_48[3] = 0xffffffff;
								local_34 = 0xffffffff;
								local_18 = 0xffffffff;
								local_10 = 0xffffffff;
								local_8 = 0;
								local_48[2] = 0;
								local_48[4] = 1;
								local_30 = 1;
								local_2c = 0;
								local_28 = 1;
								local_24 = 1;
								local_20 = 0;
								local_1c = 1;
								local_14 = 1;
								local_c = 0;
								local_4 = 0;
								piVar6 = local_48;
								iVar7 = 9;
								do {
									piVar1 = piVar6 + 1;
									iVar3 = *piVar6;
									piVar6 = piVar6 + 2;
									pLVar2 = &level->blocks
														[(int)(x + iVar3 + (*piVar1 + y) * (level->dimensions).width)].flags1;
									iVar7 += -1;
									*pLVar2 = *pLVar2 | BLOCK1_EXPOSED;
								} while (iVar7 != 0);
							}
							else {
								if ((iVar8 == 2) || (iVar8 == 4)) {
									level->blocks[(int)(x + y * (level->dimensions).width)].flags1 =
											 level->blocks[(int)(x + y * (level->dimensions).width)].flags1 |
											 BLOCK1_HIDDEN;
								}
							}
							if (iVar8 == 3) {
								level->blocks[(int)(x + y * (level->dimensions).width)].flags2 =
										 level->blocks[(int)(x + y * (level->dimensions).width)].flags2 |
										 BLOCK2_SLUGHOLE_EXPOSED;
								local_50.x = (int)x;
								local_50.y = y;
								Level_RegisterSlimySlugHole(&local_50);
							}
							if (iVar8 == 4) {
								level->blocks[(int)(x + y * (level->dimensions).width)].flags2 =
										 level->blocks[(int)(x + y * (level->dimensions).width)].flags2 |
										 BLOCK2_SLUGHOLE_HIDDEN;
							}
							x = x + 1;
							pcVar5 = filename;
							iVar8 = local_58;
						} while (x < filename + -1);
					}
					y += 1;
					uVar4 = local_54;
				} while (y < iVar8 - 1U);
			}
			lego::file::File_SharedClose(uVar4);
			return 1;
		}
		lego::file::File_SharedClose(uVar4);
	}
	return 0;
}



BOOL __cdecl lego::game::Level_LoadErodeMap(LevelData *level,char *filename)
{
	bool bVar1;
	short sVar2;
	uint uVar3;
	char *pcVar4;
	uint uVar5;
	char *x;
	uint y;
	uint local_10;
	uint local_c;
	Point2I local_8;
	
	if ((filename != NULL) &&
		 (uVar3 = lego::file::File_SharedOpen(filename,NULL), uVar3 != 0xffffffff)) {
		local_c = uVar3;
		Map_GetDimensions(uVar3,(int *)&filename,(int *)&local_10);
		if ((filename == (char *)(level->dimensions).width) && (local_10 == (level->dimensions).height))
		{
			y = 0;
			pcVar4 = filename;
			uVar5 = local_10;
			if (local_10 != 0) {
				do {
					x = NULL;
					if (pcVar4 != NULL) {
						do {
							local_8.x = (int)x;
							local_8.y = y;
							uVar3 = Map_GetCoordinate(local_c,(int)x,y);
							bVar1 = false;
							if ((uVar3 == 0) || ((uVar3 & 1) != 0)) {
								uVar3 += 1;
							}
							else {
								bVar1 = true;
							}
							level->blocks[(int)(x + y * (level->dimensions).width)].erodeSpeed =
									 (ErodeType)(uVar3 >> 1);
							if (bVar1) {
								sVar2 = lego::util::randomInt16();
								uVar3 = (int)sVar2 >> 0x1f;
								FUN_0040e940(&local_8,(((int)sVar2 ^ uVar3) - uVar3 & 3 ^ uVar3) - uVar3);
							}
							x = x + 1;
							pcVar4 = filename;
							uVar5 = local_10;
						} while (x < filename);
					}
					y += 1;
					uVar3 = local_c;
				} while (y < uVar5);
			}
			lego::file::File_SharedClose(uVar3);
			return 1;
		}
		lego::file::File_SharedClose(uVar3);
	}
	return 0;
}



BOOL __cdecl lego::game::Level_LoadAIMap(LevelData *level,char *filename)
{
	uint sharedIndex;
	uint uVar1;
	char *pcVar2;
	char *x;
	uint y;
	uint local_4;
	
	if ((filename != NULL) &&
		 (sharedIndex = lego::file::File_SharedOpen(filename,NULL), sharedIndex != 0xffffffff)) {
		Map_GetDimensions(sharedIndex,(int *)&filename,(int *)&local_4);
		if ((filename == (char *)(level->dimensions).width) && (local_4 == (level->dimensions).height))
		{
			y = 0;
			pcVar2 = filename;
			uVar1 = local_4;
			if (local_4 != 0) {
				do {
					x = NULL;
					if (pcVar2 != NULL) {
						do {
							uVar1 = Map_GetCoordinate(sharedIndex,(int)x,y);
							pcVar2 = x + y * (level->dimensions).width;
							x = x + 1;
							level->blocks[(int)pcVar2].aiNode = (byte)uVar1;
							pcVar2 = filename;
							uVar1 = local_4;
						} while (x < filename);
					}
					y += 1;
				} while (y < uVar1);
			}
			lego::file::File_SharedClose(sharedIndex);
			return 1;
		}
		lego::file::File_SharedClose(sharedIndex);
	}
	return 0;
}



BOOL __cdecl lego::game::Level_LoadEmergeMap(LevelData *level,char *filename)
{
	LevelBlockFlags2 *pLVar1;
	uint uVar2;
	uint uVar3;
	int *piVar4;
	int iVar5;
	char *pcVar6;
	uint uVar7;
	uint uVar8;
	undefined4 *puVar9;
	uint local_c;
	char *local_8;
	uint local_4;
	
	if (filename != NULL) {
		uVar2 = lego::file::File_SharedOpen(filename,NULL);
		local_4 = uVar2;
		if (((uVar2 != 0xffffffff) &&
				(Map_GetDimensions(uVar2,(int *)&local_c,(int *)&local_8),
				local_c == (level->dimensions).width)) && (local_8 == (char *)(level->dimensions).height)) {
			filename = NULL;
			uVar3 = local_c;
			pcVar6 = local_8;
			if (local_8 != NULL) {
				do {
					uVar2 = 0;
					if (uVar3 != 0) {
						do {
							uVar3 = Map_GetCoordinate(local_4,uVar2,(int)filename);
							if (uVar3 != 0) {
								uVar7 = (uVar3 - 1) % 6;
								uVar8 = (uVar3 - 1) / 6;
								uVar3 = uVar8 + 1;
								if ((uint)level->field_c < uVar3) {
									if ((LwoFrame *)level->field_8 == NULL) {
										piVar4 = (int *)std::malloc(uVar3 * 0x4c);
									}
									else {
										piVar4 = FUN_0048df40((LwoFrame *)level->field_8,uVar3 * 0x4c);
									}
									level->field_8 = piVar4;
									puVar9 = (undefined4 *)(level->field_8 + level->field_c * 0x4c);
									for (uVar3 = ((uVar8 - level->field_c) + 1) * 0x13 & 0x3fffffff; uVar3 != 0;
											uVar3 -= 1) {
										*puVar9 = 0;
										puVar9 = puVar9 + 1;
									}
									for (iVar5 = 0; iVar5 != 0; iVar5 += -1) {
										*(undefined *)puVar9 = 0;
										puVar9 = (undefined4 *)((int)puVar9 + 1);
									}
									level->field_c = uVar8 + 1;
								}
								if (uVar7 == 0) {
									iVar5 = (int)filename * (level->dimensions).width + uVar2;
									level->blocks[iVar5].flags2 = level->blocks[iVar5].flags2 | BLOCK2_EMERGE_TRIGGER;
									*(uint *)(uVar8 * 0x4c + 4 + level->field_8) = uVar2;
									*(char **)(uVar8 * 0x4c + 8 + level->field_8) = filename;
								}
								else {
									pLVar1 = &level->blocks[(int)filename * (level->dimensions).width + uVar2].flags2;
									*pLVar1 = *pLVar1 | BLOCK2_EMERGE_POINT;
									iVar5 = uVar8 * 0x4c;
									*(uint *)(iVar5 + uVar7 * 0xc + 4 + level->field_8) = uVar2;
									*(char **)(uVar7 * 0xc + iVar5 + 8 + level->field_8) = filename;
									*(undefined4 *)(iVar5 + (uVar7 + 1) * 0xc + level->field_8) = 1;
								}
							}
							uVar2 += 1;
							uVar3 = local_c;
							pcVar6 = local_8;
						} while (uVar2 < local_c);
					}
					filename = filename + 1;
					uVar2 = local_4;
				} while (filename < pcVar6);
			}
			lego::file::File_SharedClose(uVar2);
			return 1;
		}
		lego::file::File_SharedClose(uVar2);
	}
	return 0;
}



undefined4 __cdecl FUN_0042c260(int param_1,int *param_2,undefined4 *param_3)
{
	int iVar1;
	uint *puVar2;
	int iVar3;
	int iVar4;
	uint uVar5;
	uint local_4;
	
	iVar4 = 0;
	local_4 = 0;
	if (*(int *)(param_1 + 0xc) == 0) {
		return 0;
	}
	do {
		iVar1 = *(int *)(param_1 + 8) + iVar4;
		if (((*param_2 == *(int *)(iVar1 + 4)) && (param_2[1] == *(int *)(iVar1 + 8))) &&
			 ((ushort)((ushort)(*(float *)(iVar1 + 0xc) < 0.0) << 8 |
								(ushort)(*(float *)(iVar1 + 0xc) == 0.0) << 0xe) != 0)) {
			iVar1 = 0;
			uVar5 = 0;
			do {
				if (*(int *)(iVar4 + uVar5 + 0x18 + *(int *)(param_1 + 8)) != 0) {
					iVar3 = iVar4 + uVar5 + *(int *)(param_1 + 8);
					puVar2 = FUN_0043b1f0((int **)(lego::globals::g_Game.RockMonsterData_TABLE +
																				*(uint *)(param_1 + 0xb0)),4.203895e-45,
																*(uint *)(param_1 + 0xb0),*(uint *)(iVar3 + 0x10),
																*(uint *)(iVar3 + 0x14));
					if (puVar2 != NULL) {
						iVar4 = local_4 * 0x4c;
						*(undefined4 *)(iVar4 + 0xc + *(int *)(param_1 + 8)) = *(undefined4 *)(param_1 + 0x264);
						if (param_3 != NULL) {
							*param_3 = *(undefined4 *)(iVar1 * 0xc + iVar4 + 0x10 + *(int *)(param_1 + 8));
							param_3[1] = *(undefined4 *)(iVar1 * 0xc + iVar4 + 0x14 + *(int *)(param_1 + 8));
						}
						return 1;
					}
				}
				uVar5 += 0xc;
				iVar1 += 1;
			} while (uVar5 < 0x3c);
		}
		local_4 += 1;
		iVar4 += 0x4c;
	} while (local_4 < *(uint *)(param_1 + 0xc));
	return 0;
}



void __cdecl FUN_0042c370(int param_1,float param_2)
{
	float *pfVar1;
	float fVar2;
	int iVar3;
	uint uVar4;
	
	uVar4 = 0;
	if (*(int *)(param_1 + 0xc) != 0) {
		iVar3 = 0;
		do {
			fVar2 = *(float *)(*(int *)(param_1 + 8) + 0xc + iVar3);
			pfVar1 = (float *)(*(int *)(param_1 + 8) + 0xc + iVar3);
			if ((ushort)((ushort)(fVar2 < 0.0) << 8 | (ushort)(fVar2 == 0.0) << 0xe) == 0) {
				*pfVar1 = *pfVar1 - param_2;
			}
			uVar4 += 1;
			iVar3 += 0x4c;
		} while (uVar4 < *(uint *)(param_1 + 0xc));
	}
	return;
}



BOOL __cdecl lego::game::Level_LoadTerrainMap(LevelData *level,char *filename,int modifier)
{
	TerrainType TVar1;
	uint sharedIndex;
	uint uVar2;
	int iVar3;
	char *pcVar4;
	uint y;
	char *x;
	uint local_c;
	Point2I local_8;
	
	sharedIndex = lego::file::File_SharedOpen(filename,NULL);
	if (sharedIndex != 0xffffffff) {
		Map_GetDimensions(sharedIndex,(int *)&filename,(int *)&local_c);
		if ((filename == (char *)(level->dimensions).width) && (local_c == (level->dimensions).height))
		{
			y = 0;
			pcVar4 = filename;
			uVar2 = local_c;
			if (local_c != 0) {
				do {
					x = NULL;
					if (pcVar4 != NULL) {
						do {
							uVar2 = Map_GetCoordinate(sharedIndex,(int)x,y);
							iVar3 = uVar2 - modifier;
										// Soil SurfaceType was removed, change to Dirt
							if (iVar3 == 5) {
								iVar3 = 4;
							}
							level->blocks[(int)(x + y * (level->dimensions).width)].terrain = (TerrainType)iVar3;
							TVar1 = level->blocks[(int)(x + y * (level->dimensions).width)].terrain;
							if (TVar1 == TERRAIN_LAVA) {
								level->blocks[(int)(x + y * (level->dimensions).width)].field_7 = 4;
							}
							else {
								if (TVar1 == TERRAIN_RECHARGESEAM) {
									local_8.x = (int)x;
									local_8.y = y;
									Level_RegisterRechargeSeam(&local_8);
									res::Res_Unk_RechargeSparkle(level,&local_8,1);
								}
							}
							x = x + 1;
							pcVar4 = filename;
							uVar2 = local_c;
						} while (x < filename);
					}
					y += 1;
				} while (y < uVar2);
			}
			lego::file::File_SharedClose(sharedIndex);
			return 1;
		}
		lego::file::File_SharedClose(sharedIndex);
	}
	return 0;
}



BOOL __cdecl
lego::game::Level_GetBlockCryOre
					(Point2I *position,int *out_crystal,int *out_ore,int *out_crystalAlt,int *out_oreAlt)
{
	int iVar1;
	uint uVar2;
	uint uVar3;
	int CRYORE_COUNTS [5];
	
	uVar3 = (uint)(globals::g_Game.level)->blocks
								[position->y * ((globals::g_Game.level)->dimensions).width + position->x].cryOre;
	CRYORE_COUNTS[0] = 1;
	uVar2 = uVar3 - 1;
	*out_oreAlt = 0;
	*out_crystalAlt = 0;
	*out_ore = 0;
	CRYORE_COUNTS[1] = 3;
	CRYORE_COUNTS[2] = 5;
	CRYORE_COUNTS[3] = 10;
	CRYORE_COUNTS[4] = 0x19;
	*out_crystal = 0;
	if (uVar3 != 0) {
		iVar1 = *(int *)((int)CRYORE_COUNTS + (uVar2 & 0xfffffffc));
		switch(uVar2 & 3) {
		case 0:
			*out_crystal = iVar1;
			return 1;
		case 1:
			*out_crystalAlt = iVar1;
			return 1;
		case 2:
			*out_ore = iVar1;
			return 1;
		case 3:
			*out_oreAlt = iVar1;
		}
		return 1;
	}
	return 0;
}



BOOL __cdecl lego::game::Level_LoadCryOreMap(LevelData *level,char *filename,char modifier)
{
	uint sharedIndex;
	uint uVar1;
	char *pcVar2;
	char *x;
	uint y;
	uint local_4;
	
	sharedIndex = lego::file::File_SharedOpen(filename,NULL);
	if (sharedIndex != 0xffffffff) {
		Map_GetDimensions(sharedIndex,(int *)&filename,(int *)&local_4);
		if ((filename == (char *)(level->dimensions).width) && (local_4 == (level->dimensions).height))
		{
			y = 0;
			pcVar2 = filename;
			uVar1 = local_4;
			if (local_4 != 0) {
				do {
					x = NULL;
					if (pcVar2 != NULL) {
						do {
							uVar1 = Map_GetCoordinate(sharedIndex,(int)x,y);
							pcVar2 = x + y * (level->dimensions).width;
							x = x + 1;
							level->blocks[(int)pcVar2].cryOre = (char)uVar1 - modifier;
							pcVar2 = filename;
							uVar1 = local_4;
						} while (x < filename);
					}
					y += 1;
				} while (y < uVar1);
			}
			lego::file::File_SharedClose(sharedIndex);
			return 1;
		}
		lego::file::File_SharedClose(sharedIndex);
	}
	return 0;
}



BOOL __cdecl lego::game::Level_LoadPathMap(LevelData *level,char *filename,int modifier)
{
	LevelBlockFlags1 *pLVar1;
	LevelBlockFlags1 LVar2;
	uint uVar3;
	BOOL BVar4;
	char *pcVar5;
	uint uVar6;
	uint y;
	int iVar7;
	char *x;
	uint local_10;
	uint local_c;
	Point2I local_8;
	
	if ((filename != NULL) &&
		 (uVar3 = lego::file::File_SharedOpen(filename,NULL), uVar3 != 0xffffffff)) {
		local_c = uVar3;
		Map_GetDimensions(uVar3,(int *)&filename,(int *)&local_10);
		if ((filename == (char *)(level->dimensions).width) && (local_10 == (level->dimensions).height))
		{
			y = 0;
			pcVar5 = filename;
			uVar6 = local_10;
			if (local_10 != 0) {
				do {
					x = NULL;
					if (pcVar5 != NULL) {
						do {
							local_8.x = (int)x;
							local_8.y = y;
							uVar3 = Map_GetCoordinate(local_c,(int)x,y);
							pLVar1 = &level->blocks[(int)(x + y * (level->dimensions).width)].flags1;
							LVar2 = *pLVar1;
							if ((LVar2 & BLOCK1_UNK_8) != BLOCK1_NONE) {
								if (uVar3 - modifier == 2) {
									*pLVar1 = LVar2 | BLOCK1_POWERPATH;
								}
								else {
									if ((((uVar3 - modifier == 1) &&
											 (((globals::g_Game.level)->blocks
												 [(int)(local_8.x + ((globals::g_Game.level)->dimensions).width * local_8.y)
												 ].flags1 & BLOCK1_UNK_400) == BLOCK1_NONE)) &&
											((*(byte *)&(globals::g_Game.level)->blocks
																	[(int)(local_8.x +
																				((globals::g_Game.level)->dimensions).width * local_8.y)].
																	flags2 & 4) == 0)) &&
										 ((((globals::g_Game.level)->blocks
												[(int)(local_8.x + ((globals::g_Game.level)->dimensions).width * local_8.y)]
												.flags1 & BLOCK1_UNK_8000) == BLOCK1_NONE &&
											(BVar4 = FUN_00408fd0(&local_8), BVar4 == 0)))) {
										(globals::g_Game.level)->blocks
										[(int)(char *)(local_8.x +
																	((globals::g_Game.level)->dimensions).width * local_8.y)].flags1 =
												 (globals::g_Game.level)->blocks
												 [(int)(char *)(local_8.x +
																			 ((globals::g_Game.level)->dimensions).width * local_8.y)].
												 flags1 & ~BLOCK1_UNK_200000;
										(globals::g_Game.level)->blocks
										[(int)(char *)(local_8.x +
																	((globals::g_Game.level)->dimensions).width * local_8.y)].flags1 =
												 (globals::g_Game.level)->blocks
												 [(int)(char *)(local_8.x +
																			 ((globals::g_Game.level)->dimensions).width * local_8.y)].
												 flags1 & ~BLOCK1_POWERPATH;
										(globals::g_Game.level)->blocks
										[(int)(char *)(local_8.x +
																	((globals::g_Game.level)->dimensions).width * local_8.y)].flags1 =
												 (globals::g_Game.level)->blocks
												 [(int)(char *)(local_8.x +
																			 ((globals::g_Game.level)->dimensions).width * local_8.y)].
												 flags1 & ~BLOCK1_UNK_40000000;
										FUN_00439c50();
										FUN_00402970(&local_8);
										other::logf_removed((char *)&local_8);
										iVar7 = 4;
										do {
											FUN_00402fe0(&local_8,0x3d);
											iVar7 += -1;
										} while (iVar7 != 0);
										(globals::g_Game.level)->blocks
										[(int)(char *)(local_8.x +
																	((globals::g_Game.level)->dimensions).width * local_8.y)].flags1 =
												 (globals::g_Game.level)->blocks
												 [(int)(char *)(local_8.x +
																			 ((globals::g_Game.level)->dimensions).width * local_8.y)].
												 flags1 | BLOCK1_RUBBLE_FULL;
									}
								}
							}
							x = x + 1;
							pcVar5 = filename;
							uVar6 = local_10;
						} while (x < filename);
					}
					y += 1;
					uVar3 = local_c;
				} while (y < uVar6);
			}
			lego::file::File_SharedClose(uVar3);
			return 1;
		}
		lego::file::File_SharedClose(uVar3);
	}
	return 0;
}



BOOL __cdecl lego::game::Level_LoadFallinMap(LevelData *level,char *filename)
{
	uint sharedIndex_00;
	float fVar1;
	char *pcVar2;
	uint uVar3;
	uint y;
	char *x;
	uint local_10;
	uint sharedIndex;
	uint local_8;
	undefined4 uStack4;
	
	globals::g_Game.hasFallins = 0;
	if ((filename != NULL) &&
		 (sharedIndex_00 = lego::file::File_SharedOpen(filename,NULL), sharedIndex_00 != 0xffffffff)) {
		sharedIndex = sharedIndex_00;
		Map_GetDimensions(sharedIndex_00,(int *)&filename,(int *)&local_10);
		if ((filename == (char *)(level->dimensions).width) && (local_10 == (level->dimensions).height))
		{
			y = 0;
			pcVar2 = filename;
			uVar3 = local_10;
			if (local_10 != 0) {
				do {
					x = NULL;
					if (pcVar2 != NULL) {
						do {
							fVar1 = (float)Map_GetCoordinate(sharedIndex,(int)x,y);
							level->blocks[(int)(x + y * (level->dimensions).width)].fallinIntensity = 0.0;
							if (fVar1 != 0.0) {
								level->blocks[(int)(x + y * (level->dimensions).width)].fallinIntensity = fVar1;
								local_8 = (uint)(int)level->blocks[(int)(x + y * (level->dimensions).width)].
																		 randomness %
													((int)fVar1 * globals::g_Game.FallinMultiplier * 0x19);
								uStack4 = 0;
								level->blocks[(int)(x + y * (level->dimensions).width)].fallinTimer =
										 (float)(ulonglong)local_8;
								level->blocks[(int)(x + y * (level->dimensions).width)].fallinUpper = 0;
								if (4 < (uint)fVar1) {
									level->blocks[(int)(x + y * (level->dimensions).width)].fallinIntensity =
											 (float)((int)fVar1 - 4);
									level->blocks[(int)(x + y * (level->dimensions).width)].fallinUpper = 1;
								}
							}
							x = x + 1;
							pcVar2 = filename;
							uVar3 = local_10;
						} while (x < filename);
					}
					y += 1;
					sharedIndex_00 = sharedIndex;
				} while (y < uVar3);
			}
			globals::g_Game.hasFallins = 1;
			lego::file::File_SharedClose(sharedIndex_00);
			return 1;
		}
		lego::file::File_SharedClose(sharedIndex_00);
	}
	return 0;
}



void __cdecl lego::game::Game_UpdateFallins(float time)
{
	uint uVar1;
	uint uVar2;
	LevelData *level;
	int iVar3;
	BOOL BVar4;
	uint uVar5;
	uint uVar6;
	Point2I position;
	LevelBlock *block;
	
	level = GetLevel();
	if ((((globals::g_Game.hasFallins != 0) && (uVar1 = (level->dimensions).width, uVar1 != 0)) &&
			(uVar2 = (level->dimensions).height, uVar2 != 0)) && (uVar5 = 0, uVar2 != 0)) {
		do {
			uVar6 = 0;
			if (uVar1 != 0) {
				do {
					block = level->blocks + uVar5 * (level->dimensions).width + uVar6;
					if (block->fallinIntensity != 0.0) {
						block->fallinTimer = time + block->fallinTimer;
						iVar3 = uVar5 * (level->dimensions).width + uVar6;
						block = level->blocks + iVar3;
						if ((float)(ulonglong)
											 ((int)level->blocks[iVar3].fallinIntensity * globals::g_Game.FallinMultiplier
											 * 0x19) < block->fallinTimer) {
							block->fallinTimer = 0.0;
							position.x = uVar6;
							position.y = uVar5;
							BVar4 = FUN_0040f0c0(&position,
																	 level->blocks[uVar5 * (level->dimensions).width + uVar6].
																	 fallinUpper);
							if (BVar4 != 0) {
								Info_FUN_00419ab0(INFO_LANDSLIDE,NULL,NULL,&position);
							}
						}
					}
					uVar6 += 1;
				} while (uVar6 < uVar1);
			}
			uVar5 += 1;
		} while (uVar5 < uVar2);
	}
	return;
}



BOOL __cdecl lego::game::Level_LoadBlockPointersMap(LevelData *level,char *filename,int modifier)
{
	uint sharedIndex;
	uint uVar1;
	char *pcVar2;
	char *x;
	uint y;
	uint local_4;
	
	if ((filename != NULL) &&
		 (sharedIndex = lego::file::File_SharedOpen(filename,NULL), sharedIndex != 0xffffffff)) {
		Map_GetDimensions(sharedIndex,(int *)&filename,(int *)&local_4);
		if ((filename == (char *)(level->dimensions).width) && (local_4 == (level->dimensions).height))
		{
			y = 0;
			pcVar2 = filename;
			uVar1 = local_4;
			if (local_4 != 0) {
				do {
					x = NULL;
					if (pcVar2 != NULL) {
						do {
							uVar1 = Map_GetCoordinate(sharedIndex,(int)x,y);
							pcVar2 = x + y * (level->dimensions).width;
							x = x + 1;
							level->blocks[(int)pcVar2].blockpointer = (char)uVar1 - (char)modifier;
							pcVar2 = filename;
							uVar1 = local_4;
						} while (x < filename);
					}
					y += 1;
				} while (y < uVar1);
			}
			lego::file::File_SharedClose(sharedIndex);
			return 1;
		}
		lego::file::File_SharedClose(sharedIndex);
	}
	return 0;
}



UpgradeData * __cdecl lego::game::Game_GetUpgradeData(char *upgradeName)
{
	int iVar1;
	uint uVar2;
	
	uVar2 = 0;
	if (globals::g_Game.UpgradeTypes_COUNT == 0) {
		return NULL;
	}
	do {
		iVar1 = std::_stricmp(upgradeName,globals::g_Game.UpgradeTypes_TABLE[uVar2]);
		if (iVar1 == 0) {
			return globals::g_Game.UpgradeData_TABLE + uVar2;
		}
		uVar2 += 1;
	} while (uVar2 < globals::g_Game.UpgradeTypes_COUNT);
	return NULL;
}



BOOL __cdecl lego::main::Boot_Load_VehicleTypes(void)
{
	char cVar1;
	char *pcVar2;
	CFGProperty *pCVar3;
	BOOL BVar4;
	uint uVar5;
	uint uVar6;
	int iVar7;
	undefined4 *puVar8;
	undefined4 *puVar9;
	int local_4;
	
	iVar7 = 0;
	globals::g_Game.VehicleTypes_COUNT = 0;
	local_4 = 0;
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"VehicleTypes",0);
	for (pCVar3 = cfg::CFG_GetBlockFirstChild(globals::g_Game.LegoCfgRoot,pcVar2); pCVar3 != NULL;
			pCVar3 = cfg::CFG_NextFlatProperty(pCVar3)) {
		globals::g_Game.VehicleTypes_COUNT += 1;
	}
	if ((globals::g_Game.VehicleTypes_COUNT != 0) &&
		 (globals::g_Game.VehicleData_TABLE =
					 (VehicleData *)std::malloc(globals::g_Game.VehicleTypes_COUNT * 0x1ec),
		 globals::g_Game.VehicleData_TABLE != NULL)) {
		globals::g_Game.VehicleTypes_TABLE =
				 (char **)std::malloc(globals::g_Game.VehicleTypes_COUNT * 4);
		if (globals::g_Game.VehicleTypes_TABLE != NULL) {
			pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"VehicleTypes",0);
			pCVar3 = cfg::CFG_GetBlockFirstChild(globals::g_Game.LegoCfgRoot,pcVar2);
			while ((pCVar3 != NULL &&
						 (BVar4 = res::Res_LoadAEFileVehicle
																((VehicleData *)
																 ((int)(globals::g_Game.VehicleData_TABLE)->WheelMeshes +
																 iVar7 + -0x10),local_4,globals::g_Game.resRoot,pCVar3->value,
																 globals::g_Game.CfgRootName), BVar4 != 0))) {
				FUN_0046d580((VehicleData *)
										 ((int)(globals::g_Game.VehicleData_TABLE)->WheelMeshes + iVar7 + -0x10),1);
				uVar5 = 0xffffffff;
				pcVar2 = pCVar3->key;
				do {
					if (uVar5 == 0) break;
					uVar5 -= 1;
					cVar1 = *pcVar2;
					pcVar2 = pcVar2 + 1;
				} while (cVar1 != '\0');
				pcVar2 = (char *)std::malloc(~uVar5);
				iVar7 += 0x1ec;
				globals::g_Game.VehicleTypes_TABLE[local_4] = pcVar2;
				uVar5 = 0xffffffff;
				puVar8 = (undefined4 *)pCVar3->key;
				do {
					if (uVar5 == 0) break;
					uVar5 -= 1;
					cVar1 = *(char *)puVar8;
					puVar8 = (undefined4 *)((int)puVar8 + 1);
				} while (cVar1 != '\0');
				puVar8 = (undefined4 *)pCVar3->key;
				puVar9 = (undefined4 *)globals::g_Game.VehicleTypes_TABLE[local_4];
				for (uVar6 = ~uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
					*puVar9 = *puVar8;
					puVar8 = puVar8 + 1;
					puVar9 = puVar9 + 1;
				}
				local_4 += 1;
				for (uVar5 = ~uVar5 & 3; uVar5 != 0; uVar5 -= 1) {
					*(undefined *)puVar9 = *(undefined *)puVar8;
					puVar8 = (undefined4 *)((int)puVar8 + 1);
					puVar9 = (undefined4 *)((int)puVar9 + 1);
				}
				pCVar3 = cfg::CFG_NextFlatProperty(pCVar3);
			}
			if (pCVar3 == NULL) {
				return 1;
			}
			std::free(globals::g_Game.VehicleTypes_TABLE);
		}
		std::free(globals::g_Game.VehicleData_TABLE);
	}
	return 0;
}



BOOL __cdecl lego::main::Boot_Load_MiniFigureTypes(void)
{
	char cVar1;
	char *pcVar2;
	CFGProperty *pCVar3;
	BOOL BVar4;
	uint uVar5;
	uint uVar6;
	int iVar7;
	undefined4 *puVar8;
	undefined4 *puVar9;
	int local_4;
	
	iVar7 = 0;
	globals::g_Game.MiniFigureTypes_COUNT = 0;
	local_4 = 0;
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiniFigureTypes",0);
	for (pCVar3 = cfg::CFG_GetBlockFirstChild(globals::g_Game.LegoCfgRoot,pcVar2); pCVar3 != NULL;
			pCVar3 = cfg::CFG_NextFlatProperty(pCVar3)) {
		globals::g_Game.MiniFigureTypes_COUNT += 1;
	}
	if ((globals::g_Game.MiniFigureTypes_COUNT != 0) &&
		 (globals::g_Game.MiniFigureData_TABLE =
					 (CreatureData *)std::malloc(globals::g_Game.MiniFigureTypes_COUNT * 0x74),
		 globals::g_Game.MiniFigureData_TABLE != NULL)) {
		globals::g_Game.MiniFigureTypes_TABLE =
				 (char **)std::malloc(globals::g_Game.MiniFigureTypes_COUNT * 4);
		if (globals::g_Game.MiniFigureTypes_TABLE != NULL) {
			pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"MiniFigureTypes",0);
			pCVar3 = cfg::CFG_GetBlockFirstChild(globals::g_Game.LegoCfgRoot,pcVar2);
			while ((pCVar3 != NULL &&
						 (BVar4 = res::Res_LoadAEFileCreature
																((CreatureData *)
																 ((int)(globals::g_Game.MiniFigureData_TABLE)->cameraFramesTable_54
																 + iVar7 + -0x54),local_4,globals::g_Game.resRoot,pCVar3->value,
																 globals::g_Game.CfgRootName), BVar4 != 0))) {
				FUN_00406bc0((BasicObjectData *)
										 ((int)(globals::g_Game.MiniFigureData_TABLE)->cameraFramesTable_54 +
										 iVar7 + -0x54),1);
				uVar5 = 0xffffffff;
				pcVar2 = pCVar3->key;
				do {
					if (uVar5 == 0) break;
					uVar5 -= 1;
					cVar1 = *pcVar2;
					pcVar2 = pcVar2 + 1;
				} while (cVar1 != '\0');
				pcVar2 = (char *)std::malloc(~uVar5);
				iVar7 += 0x74;
				globals::g_Game.MiniFigureTypes_TABLE[local_4] = pcVar2;
				uVar5 = 0xffffffff;
				puVar8 = (undefined4 *)pCVar3->key;
				do {
					if (uVar5 == 0) break;
					uVar5 -= 1;
					cVar1 = *(char *)puVar8;
					puVar8 = (undefined4 *)((int)puVar8 + 1);
				} while (cVar1 != '\0');
				puVar8 = (undefined4 *)pCVar3->key;
				puVar9 = (undefined4 *)globals::g_Game.MiniFigureTypes_TABLE[local_4];
				for (uVar6 = ~uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
					*puVar9 = *puVar8;
					puVar8 = puVar8 + 1;
					puVar9 = puVar9 + 1;
				}
				local_4 += 1;
				for (uVar5 = ~uVar5 & 3; uVar5 != 0; uVar5 -= 1) {
					*(undefined *)puVar9 = *(undefined *)puVar8;
					puVar8 = (undefined4 *)((int)puVar8 + 1);
					puVar9 = (undefined4 *)((int)puVar9 + 1);
				}
				pCVar3 = cfg::CFG_NextFlatProperty(pCVar3);
			}
			if (pCVar3 == NULL) {
				return 1;
			}
			std::free(globals::g_Game.MiniFigureTypes_TABLE);
		}
		std::free(globals::g_Game.MiniFigureData_TABLE);
	}
	return 0;
}



BOOL __cdecl lego::main::Boot_Load_RockMonsterTypes(void)
{
	char cVar1;
	char *pcVar2;
	CFGProperty *pCVar3;
	BOOL BVar4;
	uint uVar5;
	uint uVar6;
	int iVar7;
	undefined4 *puVar8;
	undefined4 *puVar9;
	int local_4;
	
	iVar7 = 0;
	globals::g_Game.RockMonsterTypes_COUNT = 0;
	local_4 = 0;
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"RockMonsterTypes",0);
	for (pCVar3 = cfg::CFG_GetBlockFirstChild(globals::g_Game.LegoCfgRoot,pcVar2); pCVar3 != NULL;
			pCVar3 = cfg::CFG_NextFlatProperty(pCVar3)) {
		globals::g_Game.RockMonsterTypes_COUNT += 1;
	}
	if ((globals::g_Game.RockMonsterTypes_COUNT != 0) &&
		 (globals::g_Game.RockMonsterData_TABLE =
					 (CreatureData *)std::malloc(globals::g_Game.RockMonsterTypes_COUNT * 0x74),
		 globals::g_Game.RockMonsterData_TABLE != NULL)) {
		globals::g_Game.RockMonsterTypes_TABLE =
				 (char **)std::malloc(globals::g_Game.RockMonsterTypes_COUNT * 4);
		if (globals::g_Game.RockMonsterTypes_TABLE != NULL) {
			pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"RockMonsterTypes",0);
			pCVar3 = cfg::CFG_GetBlockFirstChild(globals::g_Game.LegoCfgRoot,pcVar2);
			while ((pCVar3 != NULL &&
						 (BVar4 = res::Res_LoadAEFileCreature
																((CreatureData *)
																 ((int)(globals::g_Game.RockMonsterData_TABLE)->cameraFramesTable_54
																 + iVar7 + -0x54),local_4,globals::g_Game.resRoot,pCVar3->value,
																 globals::g_Game.CfgRootName), BVar4 != 0))) {
				FUN_00406bc0((BasicObjectData *)
										 ((int)(globals::g_Game.RockMonsterData_TABLE)->cameraFramesTable_54 +
										 iVar7 + -0x54),1);
				uVar5 = 0xffffffff;
				pcVar2 = pCVar3->key;
				do {
					if (uVar5 == 0) break;
					uVar5 -= 1;
					cVar1 = *pcVar2;
					pcVar2 = pcVar2 + 1;
				} while (cVar1 != '\0');
				pcVar2 = (char *)std::malloc(~uVar5);
				iVar7 += 0x74;
				globals::g_Game.RockMonsterTypes_TABLE[local_4] = pcVar2;
				uVar5 = 0xffffffff;
				puVar8 = (undefined4 *)pCVar3->key;
				do {
					if (uVar5 == 0) break;
					uVar5 -= 1;
					cVar1 = *(char *)puVar8;
					puVar8 = (undefined4 *)((int)puVar8 + 1);
				} while (cVar1 != '\0');
				puVar8 = (undefined4 *)pCVar3->key;
				puVar9 = (undefined4 *)globals::g_Game.RockMonsterTypes_TABLE[local_4];
				for (uVar6 = ~uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
					*puVar9 = *puVar8;
					puVar8 = puVar8 + 1;
					puVar9 = puVar9 + 1;
				}
				local_4 += 1;
				for (uVar5 = ~uVar5 & 3; uVar5 != 0; uVar5 -= 1) {
					*(undefined *)puVar9 = *(undefined *)puVar8;
					puVar8 = (undefined4 *)((int)puVar8 + 1);
					puVar9 = (undefined4 *)((int)puVar9 + 1);
				}
				pCVar3 = cfg::CFG_NextFlatProperty(pCVar3);
			}
			if (pCVar3 == NULL) {
				return 1;
			}
			std::free(globals::g_Game.RockMonsterTypes_TABLE);
		}
		std::free(globals::g_Game.RockMonsterData_TABLE);
	}
	return 0;
}



BOOL __cdecl lego::main::Boot_Load_BuildingTypes(void)
{
	char cVar1;
	char *pcVar2;
	CFGProperty *pCVar3;
	BOOL BVar4;
	uint uVar5;
	uint uVar6;
	int iVar7;
	undefined4 *puVar8;
	undefined4 *puVar9;
	int local_4;
	
	iVar7 = 0;
	globals::g_Game.BuildingTypes_COUNT = 0;
	local_4 = 0;
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"BuildingTypes",0);
	for (pCVar3 = cfg::CFG_GetBlockFirstChild(globals::g_Game.LegoCfgRoot,pcVar2); pCVar3 != NULL;
			pCVar3 = cfg::CFG_NextFlatProperty(pCVar3)) {
		globals::g_Game.BuildingTypes_COUNT += 1;
	}
	if ((globals::g_Game.BuildingTypes_COUNT != 0) &&
		 (globals::g_Game.BuildingData_TABLE =
					 (BuildingData *)std::malloc(globals::g_Game.BuildingTypes_COUNT * 0x14c),
		 globals::g_Game.BuildingData_TABLE != NULL)) {
		globals::g_Game.BuildingTypes_TABLE =
				 (char **)std::malloc(globals::g_Game.BuildingTypes_COUNT * 4);
		if (globals::g_Game.BuildingTypes_TABLE != NULL) {
			pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"BuildingTypes",0);
			pCVar3 = cfg::CFG_GetBlockFirstChild(globals::g_Game.LegoCfgRoot,pcVar2);
			while ((pCVar3 != NULL &&
						 (BVar4 = res::Res_LoadAEFileBuilding
																((BuildingData *)
																 ((int)(globals::g_Game.BuildingData_TABLE)->carryFramesTable_28 +
																 iVar7 + -0x28),local_4,globals::g_Game.resRoot,pCVar3->value,
																 globals::g_Game.CfgRootName), BVar4 != 0))) {
				FUN_004085a0((BuildingData *)
										 ((int)(globals::g_Game.BuildingData_TABLE)->carryFramesTable_28 + iVar7 + -0x28
										 ),1);
				uVar5 = 0xffffffff;
				pcVar2 = pCVar3->key;
				do {
					if (uVar5 == 0) break;
					uVar5 -= 1;
					cVar1 = *pcVar2;
					pcVar2 = pcVar2 + 1;
				} while (cVar1 != '\0');
				pcVar2 = (char *)std::malloc(~uVar5);
				iVar7 += 0x14c;
				globals::g_Game.BuildingTypes_TABLE[local_4] = pcVar2;
				uVar5 = 0xffffffff;
				puVar8 = (undefined4 *)pCVar3->key;
				do {
					if (uVar5 == 0) break;
					uVar5 -= 1;
					cVar1 = *(char *)puVar8;
					puVar8 = (undefined4 *)((int)puVar8 + 1);
				} while (cVar1 != '\0');
				puVar8 = (undefined4 *)pCVar3->key;
				puVar9 = (undefined4 *)globals::g_Game.BuildingTypes_TABLE[local_4];
				for (uVar6 = ~uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
					*puVar9 = *puVar8;
					puVar8 = puVar8 + 1;
					puVar9 = puVar9 + 1;
				}
				local_4 += 1;
				for (uVar5 = ~uVar5 & 3; uVar5 != 0; uVar5 -= 1) {
					*(undefined *)puVar9 = *(undefined *)puVar8;
					puVar8 = (undefined4 *)((int)puVar8 + 1);
					puVar9 = (undefined4 *)((int)puVar9 + 1);
				}
				pCVar3 = cfg::CFG_NextFlatProperty(pCVar3);
			}
			if (pCVar3 == NULL) {
				return 1;
			}
			std::free(globals::g_Game.BuildingTypes_TABLE);
		}
		std::free(globals::g_Game.BuildingData_TABLE);
	}
	return 0;
}



BOOL __cdecl lego::main::Boot_Load_UpgradeTypes(void)
{
	char cVar1;
	char *pcVar2;
	CFGProperty *pCVar3;
	uint uVar4;
	uint uVar5;
	int iVar6;
	undefined4 *puVar7;
	undefined4 *puVar8;
	int local_4;
	
	iVar6 = 0;
	globals::g_Game.UpgradeTypes_COUNT = 0;
	local_4 = 0;
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"UpgradeTypes",0);
	for (pCVar3 = cfg::CFG_GetBlockFirstChild(globals::g_Game.LegoCfgRoot,pcVar2); pCVar3 != NULL;
			pCVar3 = cfg::CFG_NextFlatProperty(pCVar3)) {
		globals::g_Game.UpgradeTypes_COUNT += 1;
	}
	if ((globals::g_Game.UpgradeTypes_COUNT != 0) &&
		 (globals::g_Game.UpgradeData_TABLE =
					 (UpgradeData *)std::malloc(globals::g_Game.UpgradeTypes_COUNT << 4),
		 globals::g_Game.UpgradeData_TABLE != NULL)) {
		globals::g_Game.UpgradeTypes_TABLE =
				 (char **)std::malloc(globals::g_Game.UpgradeTypes_COUNT * 4);
		if (globals::g_Game.UpgradeTypes_TABLE != NULL) {
			pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"UpgradeTypes",0);
			for (pCVar3 = cfg::CFG_GetBlockFirstChild(globals::g_Game.LegoCfgRoot,pcVar2); pCVar3 != NULL;
					pCVar3 = cfg::CFG_NextFlatProperty(pCVar3)) {
				FUN_0046c2f0((undefined4 *)((int)&(globals::g_Game.UpgradeData_TABLE)->objectIndex + iVar6),
										 local_4,(undefined4 *)globals::g_Game.resRoot,pCVar3->value);
				FUN_00406bc0((BasicObjectData *)
										 ((int)&(globals::g_Game.UpgradeData_TABLE)->objectIndex + iVar6),1);
				uVar4 = 0xffffffff;
				pcVar2 = pCVar3->key;
				do {
					if (uVar4 == 0) break;
					uVar4 -= 1;
					cVar1 = *pcVar2;
					pcVar2 = pcVar2 + 1;
				} while (cVar1 != '\0');
				pcVar2 = (char *)std::malloc(~uVar4);
				iVar6 += 0x10;
				globals::g_Game.UpgradeTypes_TABLE[local_4] = pcVar2;
				uVar4 = 0xffffffff;
				puVar7 = (undefined4 *)pCVar3->key;
				do {
					if (uVar4 == 0) break;
					uVar4 -= 1;
					cVar1 = *(char *)puVar7;
					puVar7 = (undefined4 *)((int)puVar7 + 1);
				} while (cVar1 != '\0');
				puVar7 = (undefined4 *)pCVar3->key;
				puVar8 = (undefined4 *)globals::g_Game.UpgradeTypes_TABLE[local_4];
				for (uVar5 = ~uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
					*puVar8 = *puVar7;
					puVar7 = puVar7 + 1;
					puVar8 = puVar8 + 1;
				}
				local_4 += 1;
				for (uVar4 = ~uVar4 & 3; uVar4 != 0; uVar4 -= 1) {
					*(undefined *)puVar8 = *(undefined *)puVar7;
					puVar7 = (undefined4 *)((int)puVar7 + 1);
					puVar8 = (undefined4 *)((int)puVar8 + 1);
				}
			}
			if (true) {
				return 1;
			}
			std::free(globals::g_Game.UpgradeTypes_TABLE);
		}
		std::free(globals::g_Game.UpgradeData_TABLE);
	}
	return 0;
}



void __cdecl lego::main::Main_Load_ObjectNames(CFGProperty *root)
{
	char *pcVar1;
	uint uVar2;
	uint uVar3;
	
	globals::g_Game.ObjectNames_VehicleTypes_TABLE =
			 (char **)std::malloc(globals::g_Game.VehicleTypes_COUNT * 4);
	uVar2 = 0;
	if (globals::g_Game.VehicleTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames",
																 globals::g_Game.VehicleTypes_TABLE[uVar2],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			pcVar1 = util::formatText(pcVar1);
			globals::g_Game.ObjectNames_VehicleTypes_TABLE[uVar2] = pcVar1;
			uVar2 += 1;
		} while (uVar2 < globals::g_Game.VehicleTypes_COUNT);
	}
	globals::g_Game.ObjectNames_MiniFigureTypes_TABLE =
			 (char **)std::malloc(globals::g_Game.MiniFigureTypes_COUNT * 4);
	uVar2 = 0;
	if (globals::g_Game.MiniFigureTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames",
																 globals::g_Game.MiniFigureTypes_TABLE[uVar2],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			pcVar1 = util::formatText(pcVar1);
			globals::g_Game.ObjectNames_MiniFigureTypes_TABLE[uVar2] = pcVar1;
			uVar2 += 1;
		} while (uVar2 < globals::g_Game.MiniFigureTypes_COUNT);
	}
	globals::g_Game.ObjectNames_RockMonsterTypes_TABLE =
			 (char **)std::malloc(globals::g_Game.RockMonsterTypes_COUNT * 4);
	uVar2 = 0;
	if (globals::g_Game.RockMonsterTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames",
																 globals::g_Game.RockMonsterTypes_TABLE[uVar2],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			pcVar1 = util::formatText(pcVar1);
			globals::g_Game.ObjectNames_RockMonsterTypes_TABLE[uVar2] = pcVar1;
			uVar2 += 1;
		} while (uVar2 < globals::g_Game.RockMonsterTypes_COUNT);
	}
	globals::g_Game.ObjectNames_BuildingTypes_TABLE =
			 (char **)std::malloc(globals::g_Game.BuildingTypes_COUNT * 4);
	uVar2 = 0;
	if (globals::g_Game.BuildingTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames",
																 globals::g_Game.BuildingTypes_TABLE[uVar2],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			pcVar1 = util::formatText(pcVar1);
			globals::g_Game.ObjectNames_BuildingTypes_TABLE[uVar2] = pcVar1;
			uVar2 += 1;
		} while (uVar2 < globals::g_Game.BuildingTypes_COUNT);
	}
	globals::g_Game.ObjectNames_UpgradeTypes_TABLE =
			 (char **)std::malloc(globals::g_Game.UpgradeTypes_COUNT * 4);
	uVar2 = 0;
	if (globals::g_Game.UpgradeTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames",
																 globals::g_Game.UpgradeTypes_TABLE[uVar2],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			if (pcVar1 != NULL) {
				pcVar1 = util::formatText(pcVar1);
				globals::g_Game.ObjectNames_UpgradeTypes_TABLE[uVar2] = pcVar1;
			}
			uVar3 = uVar2 + 1;
			globals::g_Game.ObjectNames_UpgradeTypes_TABLE[uVar2] = NULL;
			uVar2 = uVar3;
		} while (uVar3 < globals::g_Game.UpgradeTypes_COUNT);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames","PowerCrystal",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectNames_PowerCrystal = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames","Ore",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectNames_Ore = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames","ProcessedOre",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectNames_ProcessedOre = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames","Dynamite",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectNames_Dynamite = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames","Barrier",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectNames_Barrier = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames","ElectricFence",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectNames_ElectricFence = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames","SpiderWeb",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectNames_SpiderWeb = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames","OohScary",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectNames_OohScary = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectNames","Path",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectNames_Path = util::formatText(pcVar1);
	}
	return;
}



void __cdecl lego::main::Main_Load_ObjectTheNames(CFGProperty *root)
{
	char *pcVar1;
	uint uVar2;
	uint uVar3;
	
	globals::g_Game.ObjectTheNames_VehicleTypes_TABLE =
			 (char **)std::malloc(globals::g_Game.VehicleTypes_COUNT * 4);
	uVar2 = 0;
	if (globals::g_Game.VehicleTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames",
																 globals::g_Game.VehicleTypes_TABLE[uVar2],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			pcVar1 = util::formatText(pcVar1);
			globals::g_Game.ObjectTheNames_VehicleTypes_TABLE[uVar2] = pcVar1;
			uVar2 += 1;
		} while (uVar2 < globals::g_Game.VehicleTypes_COUNT);
	}
	globals::g_Game.ObjectTheNames_MiniFigureTypes_TABLE =
			 (char **)std::malloc(globals::g_Game.MiniFigureTypes_COUNT * 4);
	uVar2 = 0;
	if (globals::g_Game.MiniFigureTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames",
																 globals::g_Game.MiniFigureTypes_TABLE[uVar2],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			pcVar1 = util::formatText(pcVar1);
			globals::g_Game.ObjectTheNames_MiniFigureTypes_TABLE[uVar2] = pcVar1;
			uVar2 += 1;
		} while (uVar2 < globals::g_Game.MiniFigureTypes_COUNT);
	}
	globals::g_Game.ObjectTheNames_RockMonsterTypes_TABLE =
			 (char **)std::malloc(globals::g_Game.RockMonsterTypes_COUNT * 4);
	uVar2 = 0;
	if (globals::g_Game.RockMonsterTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames",
																 globals::g_Game.RockMonsterTypes_TABLE[uVar2],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			pcVar1 = util::formatText(pcVar1);
			globals::g_Game.ObjectTheNames_RockMonsterTypes_TABLE[uVar2] = pcVar1;
			uVar2 += 1;
		} while (uVar2 < globals::g_Game.RockMonsterTypes_COUNT);
	}
	globals::g_Game.ObjectTheNames_BuildingTypes_TABLE =
			 (char **)std::malloc(globals::g_Game.BuildingTypes_COUNT * 4);
	uVar2 = 0;
	if (globals::g_Game.BuildingTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames",
																 globals::g_Game.BuildingTypes_TABLE[uVar2],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			pcVar1 = util::formatText(pcVar1);
			globals::g_Game.ObjectTheNames_BuildingTypes_TABLE[uVar2] = pcVar1;
			uVar2 += 1;
		} while (uVar2 < globals::g_Game.BuildingTypes_COUNT);
	}
	globals::g_Game.ObjectTheNames_UpgradeTypes_TABLE =
			 (char **)std::malloc(globals::g_Game.UpgradeTypes_COUNT * 4);
	uVar2 = 0;
	if (globals::g_Game.UpgradeTypes_COUNT != 0) {
		do {
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames",
																 globals::g_Game.UpgradeTypes_TABLE[uVar2],0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			if (pcVar1 != NULL) {
				pcVar1 = util::formatText(pcVar1);
				globals::g_Game.ObjectTheNames_UpgradeTypes_TABLE[uVar2] = pcVar1;
			}
			uVar3 = uVar2 + 1;
			globals::g_Game.ObjectTheNames_UpgradeTypes_TABLE[uVar2] = NULL;
			uVar2 = uVar3;
		} while (uVar3 < globals::g_Game.UpgradeTypes_COUNT);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames","PowerCrystal",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectTheNames_PowerCrystal = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames","Ore",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectTheNames_Ore = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames","ProcessedOre",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectTheNames_ProcessedOre = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames","Dynamite",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectTheNames_Dynamite = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames","Barrier",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectTheNames_Barrier = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames","ElectricFence",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectTheNames_ElectricFence = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames","SpiderWeb",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectTheNames_SpiderWeb = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames","OohScary",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectTheNames_OohScary = util::formatText(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ObjectTheNames","Path",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.ObjectTheNames_Path = util::formatText(pcVar1);
	}
	return;
}



void __cdecl FUN_0042dd70(LiveObject *liveObj,uint *param_2,BOOL param_3)
{
	LevelData *pLVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	LevelSurfaceMap *pLVar5;
	float *pfVar6;
	float *pfVar7;
	uint local_8;
	uint local_4;
	
	pLVar1 = lego::globals::g_Game.level;
	lego::globals::g_Game.bool_98 = param_3;
	if (liveObj == NULL) {
		if (param_3 == 0) {
			pLVar5 = (lego::globals::g_Game.level)->surfaceMap;
			pfVar7 = &lego::globals::g_Game.float_8c;
			pfVar6 = &lego::globals::g_Game.float_88;
			uVar3 = param_2[1];
			uVar4 = *param_2;
		}
		else {
			pfVar7 = &lego::globals::g_Game.float_94;
			pfVar6 = &lego::globals::g_Game.float_90;
			uVar3 = param_2[1];
			uVar4 = *param_2;
			pLVar5 = (lego::globals::g_Game.level)->surfaceMap;
		}
		FUN_0044f900(pLVar5,uVar4,uVar3,pfVar6,pfVar7);
		local_8 = *param_2;
		local_4 = param_2[1];
	}
	else {
		if (param_3 == 0) {
			pfVar7 = &lego::globals::g_Game.float_8c;
			pfVar6 = &lego::globals::g_Game.float_88;
		}
		else {
			pfVar7 = &lego::globals::g_Game.float_94;
			pfVar6 = &lego::globals::g_Game.float_90;
		}
		lego::game::LiveObject_GetPosition(liveObj,pfVar6,pfVar7);
		lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_8,(int *)&local_4);
	}
	uVar4 = local_4;
	uVar3 = local_8;
	iVar2 = lego::main::Main_GetMouseScrollIndent();
	if ((int)local_8 < iVar2) {
		uVar3 = lego::main::Main_GetMouseScrollIndent();
	}
	iVar2 = lego::main::Main_GetMouseScrollIndent();
	if ((pLVar1->surfaceMap->smallDimensions).width - iVar2 <= (int)local_8) {
		iVar2 = lego::main::Main_GetMouseScrollIndent();
		uVar3 = ((pLVar1->surfaceMap->smallDimensions).width - iVar2) - 1;
	}
	iVar2 = lego::main::Main_GetMouseScrollIndent();
	if ((int)local_4 < iVar2) {
		uVar4 = lego::main::Main_GetMouseScrollIndent();
	}
	iVar2 = lego::main::Main_GetMouseScrollIndent();
	if ((pLVar1->surfaceMap->smallDimensions).height - iVar2 <= (int)local_4) {
		iVar2 = lego::main::Main_GetMouseScrollIndent();
		uVar4 = ((pLVar1->surfaceMap->smallDimensions).height - iVar2) - 1;
	}
	if ((local_8 != uVar3) || (local_4 != uVar4)) {
		if (param_3 == 0) {
			pfVar7 = &lego::globals::g_Game.float_8c;
			pfVar6 = &lego::globals::g_Game.float_88;
			pLVar5 = (lego::globals::g_Game.level)->surfaceMap;
		}
		else {
			pfVar7 = &lego::globals::g_Game.float_94;
			pfVar6 = &lego::globals::g_Game.float_90;
			pLVar5 = (lego::globals::g_Game.level)->surfaceMap;
		}
		FUN_0044f900(pLVar5,uVar3,uVar4,pfVar6,pfVar7);
	}
	lego::globals::g_Game.flags1 = lego::globals::g_Game.flags1 | GAME1_UNK_200000;
	return;
}



void __cdecl FUN_0042def0(LiveObject *liveObj)
{
	LiveObject **ppLVar1;
	uint uVar2;
	
	uVar2 = 0;
	if (lego::globals::g_Game.count10_2fc != 0) {
		ppLVar1 = (LiveObject **)lego::globals::g_Game.table10_2f8;
		do {
			if (liveObj == *ppLVar1) {
				*ppLVar1 = NULL;
			}
			uVar2 += 1;
			ppLVar1 = ppLVar1 + 1;
		} while (uVar2 < lego::globals::g_Game.count10_2fc);
	}
	return;
}



BOOL __cdecl FUN_0042df20(uint param_1,int *param_2)
{
	int iVar1;
	
	if ((param_1 < lego::globals::g_Game.count10_2fc) &&
		 (iVar1 = lego::globals::g_Game.table10_2f8[param_1], *param_2 = iVar1, iVar1 != 0)) {
		return 1;
	}
	return 0;
}



BOOL __cdecl lego::main::Main_loadObjectListCFG(LevelData *level,char *filename)
{
	LiveObject *liveObj;
	CFGProperty *root;
	char *pcVar1;
	CFGProperty *prop;
	CFGProperty *pCVar2;
	uint y;
	BOOL BVar3;
	LevelBlockFlags1 LVar4;
	uint *puVar5;
	ObjectStatsFlags3 OVar6;
	ObjectStatsFlags1 OVar7;
	int iVar8;
	char **ppcVar9;
	LiveObject *pLVar10;
	uint uVar11;
	uint uVar12;
	undefined4 *puVar13;
	float10 fVar14;
	ulonglong uVar15;
	ulonglong uVar16;
	longlong lVar17;
	float fVar18;
	float fVar19;
	TrainedFlags trainFlags;
	uint local_9c8;
	ObjectType local_9c4;
	float local_9c0;
	float local_9bc;
	float objYpos;
	float objHeading;
	uint local_9b0;
	float objXpos;
	uint local_9a8;
	float objHealth;
	LiveObject **local_9a0;
	char *objDrivenByName;
	int local_998;
	CFGProperty *local_994;
	ResourceData *local_990;
	char *objTypeName;
	uint local_988;
	uint local_984;
	uint local_980;
	char *objDrivingName;
	float local_978;
	float local_974;
	uint local_970;
	undefined4 uStack2412;
	uint local_968;
	undefined4 uStack2404;
	LiveObject *local_960 [200];
	char *local_640 [200];
	char *apcStack800 [200];
	
	local_9b0 = 0;
	local_998 = 1;
	local_9c8 = 0;
	root = cfg::CFG_Open(filename);
	local_994 = root;
	if (root != NULL) {
		puVar13 = globals::g_Game.table10_2f8;
		for (iVar8 = 10; iVar8 != 0; iVar8 += -1) {
			*puVar13 = 0;
			puVar13 = puVar13 + 1;
		}
		globals::g_Game.count10_2fc = 0;
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,NULL);
		prop = cfg::CFG_GetBlockFirstChild(root,pcVar1);
		if (prop != NULL) {
			local_9a0 = local_960;
			do {
				pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"type",0);
				objTypeName = cfg::CFG_CopyPropertyValue(root,pcVar1);
				if (objTypeName == NULL) break;
				pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"xpos",0);
				pCVar2 = cfg::CFG_GetProperty(root,pcVar1);
				if (pCVar2 == NULL) break;
				pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"ypos",0);
				pCVar2 = cfg::CFG_GetProperty(root,pcVar1);
				if (pCVar2 == NULL) break;
				pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"heading",0);
				pCVar2 = cfg::CFG_GetProperty(root,pcVar1);
				if (pCVar2 == NULL) break;
				pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"xpos",0);
				pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
				if (pcVar1 == NULL) {
					pcVar1 = ____EMPTYSTR__;
				}
				else {
					pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"xpos",0);
					pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
				}
				fVar14 = std::atof(pcVar1);
				objXpos = (float)fVar14;
				pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"ypos",0);
				pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
				if (pcVar1 == NULL) {
					pcVar1 = ____EMPTYSTR__;
				}
				else {
					pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"ypos",0);
					pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
				}
				fVar14 = std::atof(pcVar1);
				objYpos = (float)fVar14;
				pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"heading",0);
				pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
				if (pcVar1 == NULL) {
					pcVar1 = ____EMPTYSTR__;
				}
				else {
					pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"heading",0);
					pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
				}
				fVar14 = std::atof(pcVar1);
				objHeading = (float)fVar14;
				pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"health",0);
				pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
				if (pcVar1 == NULL) {
					pcVar1 = ____EMPTYSTR__;
				}
				else {
					pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"health",0);
					pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
				}
				fVar14 = std::atof(pcVar1);
				objHealth = (float)fVar14;
				if ((float10)0.0 == fVar14) {
					objHealth = (float)&DAT_42c80000;
				}
				pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,prop->key,"driving",0);
				objDrivingName = cfg::CFG_CopyPropertyValue(root,pcVar1);
				apcStack800[local_9c8] = objDrivingName;
				objDrivenByName = std::_strdup(prop->key);
				objXpos = objXpos - 1.0;
				local_640[local_9c8] = objDrivenByName;
				objYpos = objYpos - 1.0;
				uVar15 = __ftol((float10)objXpos);
				uVar12 = (uint)uVar15;
				uVar16 = __ftol((float10)objYpos);
				y = (uint)uVar16;
				FUN_0044f900(level->surfaceMap,uVar12,y,&local_9c0,&local_9bc);
				uStack2404 = 0;
				uStack2412 = 0;
				objYpos = (objYpos - ((float)(uVar16 & 0xffffffff) - -0.5)) * level->BlockSize;
				local_9c0 = local_9c0 + (objXpos - ((float)(uVar15 & 0xffffffff) - -0.5)) * level->BlockSize
				;
				local_9bc = local_9bc - objYpos;
				objHeading = objHeading * 0.005555556 * 3.141593;
				local_970 = y;
				local_968 = uVar12;
				BVar3 = game::Game_GetObjectByName(objTypeName,&local_9c4,(int *)&local_9a8,&local_990);
				if (BVar3 == 0) break;
				pLVar10 = NULL;
				if (local_9c4 == OBJECT_TVCAMERA) {
					FUN_00436d2d(globals::g_Game.structbc_24,local_9c0,local_9bc);
					FUN_00436b75(globals::g_Game.structbc_24,objHeading);
					FUN_00436a82(globals::g_Game.structbc_24,0.8);
					globals::g_Game.tvFaceDirection_338.x = local_9c0;
					globals::g_Game.tvFaceDirection_338.y = local_9bc;
					globals::g_Game.tvTiltOrZoom_334 = 15.0;
				}
				else {
					iVar8 = ((globals::g_Game.level)->dimensions).width;
					if ((uVar12 < iVar8 - 1U) && (y < ((globals::g_Game.level)->dimensions).height - 1U)) {
						LVar4 = (globals::g_Game.level)->blocks[y * iVar8 + uVar12].flags1 & BLOCK1_UNK_8;
					}
					else {
						LVar4 = BLOCK1_NONE;
					}
					if (LVar4 == BLOCK1_NONE) {
						local_978 = local_9c0;
						local_974 = local_9bc;
						FUN_00437ee0(local_990,local_9c4,local_9a8,&local_978,objHeading,objHealth,
												 objDrivenByName,objDrivingName);
					}
					else {
						if (local_9c4 == OBJECT_BUILDING) {
							local_984 = uVar12;
							local_980 = y;
							objDrivenByName =
									 (char *)FUN_00408290(globals::g_Game.BuildingData_TABLE + local_9a8,&local_988);
							lVar17 = __ftol((float10)objHeading * (float10)0.1591549 * (float10)8.0);
							uVar11 = ((uint)lVar17 & 1) + (uint)lVar17 >> 1;
							puVar5 = FUN_004643d0((int *)&local_984,(int)objDrivenByName,local_988,uVar11);
							pLVar10 = (LiveObject *)
												FUN_004099c0(local_9a8,(int *)&local_984,uVar11,puVar5,local_988,
																		 level->IsStartTeleportEnabled);
							if (pLVar10 != NULL) {
								FUN_00438720(pLVar10);
							}
						}
						else {
							pLVar10 = game::LiveObject__Create((int **)local_990,local_9c4,local_9a8);
						}
					}
				}
				*local_9a0 = pLVar10;
				if (pLVar10 != NULL) {
					if (local_998 != 0) {
						fVar19 = 0.01;
						fVar18 = 0.7;
						fVar14 = game::LiveObject_GetTrackDist(pLVar10);
						FUN_00435deb((int)globals::g_Game.structbc_28,pLVar10,2.0,(float)fVar14,fVar18,fVar19);
					}
					local_998 = 0;
					if (local_9c4 != OBJECT_BUILDING) {
						FUN_00442b60(pLVar10,local_9c0,local_9bc,objHeading,1);
					}
					if ((((local_9c4 == OBJECT_POWERCRYSTAL) || (local_9c4 == OBJECT_ORE)) ||
							(local_9c4 == OBJECT_DYNAMITE)) || (local_9c4 == OBJECT_BARRIER)) {
						FUN_00402650(pLVar10,0.0);
					}
					if ((MINIFIGOBJ_004e9448 == NULL) && (pLVar10->objType == OBJECT_MINIFIGURE)) {
						MINIFIGOBJ_004e9448 = pLVar10;
					}
					if (globals::g_Game.count10_2fc < 10) {
						globals::g_Game.table10_2f8[globals::g_Game.count10_2fc] = pLVar10;
						globals::g_Game.count10_2fc += 1;
					}
					pLVar10->flags4_3ec = pLVar10->flags4_3ec | 0x200;
					pLVar10->health = objHealth;
					FUN_00418760(pLVar10->objType,pLVar10->objIndex,0,1);
					if ((globals::g_Game.flags2 & GAME2_RECALLOLOBJECTS) != GAME2_NONE) {
						game::LiveObject_RecallMiniFigure(pLVar10);
					}
					FUN_0043aca0(pLVar10);
					if (local_9c4 == OBJECT_SPIDERWEB) {
						pLVar10->flags3_3e8 = pLVar10->flags3_3e8 | 0x10000;
						res::Res_ResourceShortNormal_FUN_00473630(pLVar10->other,"FlapInWind");
						res::Res_DoCallbacks(pLVar10->other,0.0);
						game::Level_SetBlockStruct_c_Value(uVar12,y,pLVar10);
					}
					else {
						if (local_9c4 == OBJECT_ELECTRICFENCE) {
							FUN_0040ce80(pLVar10);
						}
					}
				}
				std::free(objTypeName);
				local_9c8 += 1;
				local_9a0 = local_9a0 + 1;
				prop = cfg::CFG_NextFlatProperty(prop);
				root = local_994;
			} while (prop != NULL);
			if (prop == NULL) {
				local_9b0 = 1;
			}
		}
		cfg::CFG_Close(root);
	}
	if (local_9b0 == 0) {
		return 0;
	}
	local_9b0 = 0;
	if (local_9c8 != 0) {
		do {
			pLVar10 = local_960[local_9b0];
			if ((pLVar10 != NULL) && (pcVar1 = apcStack800[local_9b0], pcVar1 != NULL)) {
				uVar12 = 0;
				ppcVar9 = local_640;
				do {
					iVar8 = std::_stricmp(pcVar1,*ppcVar9);
					if (iVar8 == 0) {
						liveObj = local_960[uVar12];
						if (liveObj != NULL) {
							pLVar10->object_2fc = liveObj;
							pLVar10->flags2_3e4 = pLVar10->flags2_3e4 | 4;
							OVar6 = game::LiveObject_GetStatsFlags3(liveObj);
							if ((OVar6 & STATS3_NEEDSPILOT) == STATS3_NONE) {
								OVar7 = game::LiveObject_GetStatsFlags1(liveObj);
								if ((OVar7 & STATS1_CROSSWATER) == STATS1_NONE) {
									trainFlags = TRAINED_DRIVER;
								}
								else {
									OVar7 = game::LiveObject_GetStatsFlags1(liveObj);
									if ((OVar7 & STATS1_CROSSLAND) == STATS1_NONE) {
										trainFlags = TRAINED_SAILOR;
									}
									else {
										trainFlags = TRAINED_PILOT;
									}
								}
							}
							else {
								trainFlags = TRAINED_PILOT;
							}
							game::LiveObject_TrainMiniFigure_instantunk(pLVar10,trainFlags);
							FUN_0043f3c0(pLVar10,(int)liveObj);
						}
						break;
					}
					uVar12 += 1;
					ppcVar9 = ppcVar9 + 1;
				} while (uVar12 < local_9c8);
			}
			local_9b0 += 1;
		} while (local_9b0 < local_9c8);
	}
	uVar12 = 0;
	if (local_9c8 != 0) {
		do {
			if (local_640[uVar12] != NULL) {
				std::free(local_640[uVar12]);
			}
			if (apcStack800[uVar12] != NULL) {
				std::free(apcStack800[uVar12]);
			}
			uVar12 += 1;
		} while (uVar12 < local_9c8);
	}
	return 1;
}



BOOL __cdecl
lego::game::Game_GetObjectByName
					(char *objName,ObjectType *out_objType,int *out_objIndex,ResourceData **opt_resData)
{
	int iVar1;
	uint index;
	
	index = 0;
	*out_objIndex = 0;
	if (globals::g_Game.RockMonsterTypes_COUNT != 0) {
		do {
			iVar1 = std::_stricmp(globals::g_Game.RockMonsterTypes_TABLE[index],objName);
			if (iVar1 == 0) {
				*out_objType = OBJECT_ROCKMONSTER;
				*out_objIndex = index;
				if (opt_resData == NULL) {
					return 1;
				}
				*opt_resData = (ResourceData *)(globals::g_Game.RockMonsterData_TABLE + index);
				return 1;
			}
			index += 1;
		} while (index < globals::g_Game.RockMonsterTypes_COUNT);
	}
	iVar1 = std::_stricmp("tvcamera",objName);
	if (iVar1 == 0) {
		*out_objType = OBJECT_TVCAMERA;
		if (opt_resData != NULL) {
			*opt_resData = NULL;
			return 1;
		}
	}
	else {
		iVar1 = std::_stricmp("PowerCrystal",objName);
		if (iVar1 == 0) {
			*out_objType = OBJECT_POWERCRYSTAL;
			if (opt_resData != NULL) {
				*opt_resData = globals::g_Game.RES_Crystal;
				return 1;
			}
		}
		else {
			iVar1 = std::_stricmp("Ore",objName);
			if (iVar1 == 0) {
				*out_objType = OBJECT_ORE;
				*out_objIndex = 0;
				if (opt_resData != NULL) {
					*opt_resData = globals::g_Game.RES_Ores_TABLE[0];
					return 1;
				}
			}
			else {
				iVar1 = std::_stricmp("ProcessedOre",objName);
				if (iVar1 == 0) {
					*out_objType = OBJECT_ORE;
					*out_objIndex = 1;
					if (opt_resData != NULL) {
						*opt_resData = globals::g_Game.RES_Ores_TABLE[1];
						return 1;
					}
				}
				else {
					iVar1 = std::_stricmp("Boulder",objName);
					if (iVar1 == 0) {
						*out_objType = OBJECT_BOULDER;
						if (opt_resData != NULL) {
							*opt_resData = globals::g_Game.RES_Boulder;
							return 1;
						}
					}
					else {
						iVar1 = std::_stricmp("Pusher",objName);
						if (iVar1 == 0) {
							*out_objType = OBJECT_PUSHER;
							if (opt_resData != NULL) {
								*opt_resData = globals::g_Game.RES_Pusher;
								return 1;
							}
						}
						else {
							iVar1 = std::_stricmp("LaserShot",objName);
							if (iVar1 == 0) {
								*out_objType = OBJECT_LASERSHOT;
								if (opt_resData != NULL) {
									*opt_resData = globals::g_Game.RES_LaserShot;
									return 1;
								}
							}
							else {
								iVar1 = std::_stricmp("Freezer",objName);
								if (iVar1 == 0) {
									*out_objType = OBJECT_FREEZER;
									if (opt_resData != NULL) {
										*opt_resData = globals::g_Game.RES_Freezer;
										return 1;
									}
								}
								else {
									iVar1 = std::_stricmp("Dynamite",objName);
									if (iVar1 == 0) {
										*out_objType = OBJECT_DYNAMITE;
										if (opt_resData != NULL) {
											*opt_resData = globals::g_Game.RES_Dynamite;
											return 1;
										}
									}
									else {
										iVar1 = std::_stricmp("ElectricFence",objName);
										if (iVar1 == 0) {
											*out_objType = OBJECT_ELECTRICFENCE;
											if (opt_resData != NULL) {
												*opt_resData = globals::g_Game.RES_ElectricFence;
												return 1;
											}
										}
										else {
											iVar1 = std::_stricmp("SpiderWeb",objName);
											if (iVar1 == 0) {
												*out_objType = OBJECT_SPIDERWEB;
												if (opt_resData != NULL) {
													*opt_resData = globals::g_Game.RES_SpiderWeb;
													return 1;
												}
											}
											else {
												iVar1 = std::_stricmp("Barrier",objName);
												if (iVar1 == 0) {
													*out_objType = OBJECT_BARRIER;
													if (opt_resData != NULL) {
														*opt_resData = globals::g_Game.RES_Barrier;
														return 1;
													}
												}
												else {
													iVar1 = std::_stricmp("OohScary",objName);
													if (iVar1 == 0) {
														*out_objType = OBJECT_SONICBLASTER;
														if (opt_resData != NULL) {
															*opt_resData = globals::g_Game.RES_OohScary;
															return 1;
														}
													}
													else {
														iVar1 = std::_stricmp("Path",objName);
														if (iVar1 == 0) {
															*out_objType = OBJECT_PATH;
															if (opt_resData != NULL) {
																*opt_resData = NULL;
																return 1;
															}
														}
														else {
															index = 0;
															if (globals::g_Game.VehicleTypes_COUNT != 0) {
																do {
																	iVar1 = std::_stricmp(globals::g_Game.VehicleTypes_TABLE[index],
																												objName);
																	if (iVar1 == 0) {
																		*out_objType = OBJECT_VEHICLE;
																		*out_objIndex = index;
																		if (opt_resData == NULL) {
																			return 1;
																		}
																		*opt_resData = (ResourceData *)
																									 (globals::g_Game.VehicleData_TABLE + index);
																		return 1;
																	}
																	index += 1;
																} while (index < globals::g_Game.VehicleTypes_COUNT);
															}
															index = 0;
															if (globals::g_Game.MiniFigureTypes_COUNT != 0) {
																do {
																	iVar1 = std::_stricmp(globals::g_Game.MiniFigureTypes_TABLE[index]
																												,objName);
																	if (iVar1 == 0) {
																		*out_objType = OBJECT_MINIFIGURE;
																		*out_objIndex = index;
																		if (opt_resData == NULL) {
																			return 1;
																		}
																		*opt_resData = (ResourceData *)
																									 (globals::g_Game.MiniFigureData_TABLE + index);
																		return 1;
																	}
																	index += 1;
																} while (index < globals::g_Game.MiniFigureTypes_COUNT);
															}
															index = 0;
															if (globals::g_Game.BuildingTypes_COUNT == 0) {
																return 0;
															}
															while (iVar1 = std::_stricmp(globals::g_Game.BuildingTypes_TABLE
																													 [index],objName), iVar1 != 0) {
																index += 1;
																if (globals::g_Game.BuildingTypes_COUNT <= index) {
																	return 0;
																}
															}
															*out_objType = OBJECT_BUILDING;
															*out_objIndex = index;
															if (opt_resData != NULL) {
																*opt_resData = (ResourceData *)
																							 (globals::g_Game.BuildingData_TABLE + index);
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	return 1;
}



undefined4 __cdecl
lego::game::game_getResourceCount_FUN_0042eca0(int param_1,int param_2,int *param_3)
{
	if (param_1 == -1) {
		*param_3 = 0;
		return 1;
	}
	if (param_1 == 6) {
		*param_3 = (int)globals::g_Game.RES_Crystal;
		return 1;
	}
	if (param_1 == 7) {
		*param_3 = (int)globals::g_Game.RES_Ores_TABLE[param_2];
		return 1;
	}
	if (param_1 == 8) {
		*param_3 = (int)globals::g_Game.RES_Dynamite;
		return 1;
	}
	if (param_1 == 9) {
		*param_3 = (int)globals::g_Game.RES_Barrier;
		return 1;
	}
	if (param_1 == 0xb) {
		*param_3 = (int)globals::g_Game.RES_ElectricFence;
		return 1;
	}
	if (param_1 == 0xc) {
		*param_3 = (int)globals::g_Game.RES_SpiderWeb;
		return 1;
	}
	if (param_1 == 0xd) {
		*param_3 = (int)globals::g_Game.RES_OohScary;
		return 1;
	}
	if (param_1 == 0xf) {
		*param_3 = 0;
		return 1;
	}
	if (param_1 == 5) {
		*param_3 = (int)globals::g_Game.RES_Boulder;
		return 1;
	}
	if (param_1 == 1) {
		*param_3 = (int)(globals::g_Game.VehicleData_TABLE + param_2);
		return 1;
	}
	if (param_1 == 2) {
		*param_3 = (int)(globals::g_Game.MiniFigureData_TABLE + param_2);
		return 1;
	}
	if (param_1 == 3) {
		*param_3 = (int)(globals::g_Game.RockMonsterData_TABLE + param_2);
		return 1;
	}
	if (param_1 == 4) {
		*param_3 = (int)(globals::g_Game.BuildingData_TABLE + param_2);
		return 1;
	}
	if (param_1 == 0x10) {
		*param_3 = (int)globals::g_Game.RES_Pusher;
		return 1;
	}
	if (param_1 == 0x13) {
		*param_3 = (int)globals::g_Game.RES_LaserShot;
		return 1;
	}
	if (param_1 == 0x11) {
		*param_3 = (int)globals::g_Game.RES_Freezer;
		return 1;
	}
	return 0;
}



int __cdecl FUN_0042ee70(int param_1)
{
	uint uVar1;
	
	uVar1 = param_1 - 1;
	switch(param_1) {
	case 1:
		return lego::globals::g_Game.VehicleTypes_COUNT;
	case 2:
		return lego::globals::g_Game.MiniFigureTypes_COUNT;
	case 3:
		return lego::globals::g_Game.RockMonsterTypes_COUNT;
	case 4:
		return lego::globals::g_Game.BuildingTypes_COUNT;
	case 5:
	case 6:
	case 8:
	case 9:
	case 0xb:
	case 0xc:
	case 0xd:
	case 0xe:
	case 0xf:
	case 0x10:
	case 0x11:
	case 0x12:
	case 0x13:
		uVar1 = 1;
		break;
	case 7:
		return 2;
	case 10:
		return lego::globals::g_Game.UpgradeTypes_COUNT;
	}
	return uVar1;
}



void __cdecl FUN_0042eef0(char *param_1,Size2F *param_2)
{
	int **ppiVar1;
	int iVar2;
	BOOL doFillSurface;
	
	if (param_1 == NULL) {
		return;
	}
	ppiVar1 = lego::video::Avi_Open(param_1);
	if (ppiVar1 == NULL) {
		return;
	}
	if (param_2 == NULL) {
		doFillSurface = 1;
		if (true) goto LAB_0042ef98;
	}
	else {
		FUN_00472930(ppiVar1);
		__ftol((float10)param_2->width);
		__ftol((float10)param_2->height);
		__ftol((float10)ZEXT48(param_1) + (float10)param_2->width);
		__ftol((float10)ZEXT48(param_2) + (float10)param_2->height);
		doFillSurface = 0;
	}
	lego::draw::Draw_CopyToDrawTarget();
LAB_0042ef98:
	iVar2 = lego::video::Avi_FUN_00472990(ppiVar1);
	while (iVar2 != 0) {
		lego::main::Main_UpdateAndRender__004781f0(doFillSurface);
		iVar2 = lego::video::Avi_FUN_00472990(ppiVar1);
	}
	lego::video::Avi_Close(ppiVar1);
	return;
}



char * lego::game::Game_freeLevel__0042eff0(void)
{
	LevelData *buffer;
	void *extraout_ECX;
	void *extraout_ECX_00;
	char *pcVar1;
	
	buffer = globals::g_Game.level;
	pcVar1 = NULL;
	if (globals::g_Game.level != NULL) {
		std::free((void *)(globals::g_Game.level)->field_8);
		if (globals::g_Game.EndGameAVI1 != NULL) {
			std::free(globals::g_Game.EndGameAVI1);
		}
		if (globals::g_Game.EndGameAVI2 != NULL) {
			std::free(globals::g_Game.EndGameAVI2);
		}
		std::free(buffer->FullName);
		globals::g_Game.flags1 &= ~(GAME1_UNK_200000|GAME1_UNK_8000000);
		pool::globals::ReservedPool_LiveObject___g_INITFLAGS &= 0xffffffbf;
		globals::g_Game.flags2 &= 0xffffdffd;
		globals::g_Game.bool_98 = 0;
		globals::g_Game.objTeleportQueue_COUNT = 0;
		MINIFIGOBJ_004e9448 = NULL;
		DAT_004ebbc4 = 0;
		DAT_004ebbc8 = 0;
		Game_SetCallToArmsOn(0);
		globals::g_Game.flags1 &= ~GAME1_LASERTRACKER;
		globals::g_Game.flags2 &= ~(GAME2_UNK_4|GAME2_UNK_40|GAME2_UNK_80|GAME2_MENU_HASNEXT);
		globals::g_Game.count_dcc = 0;
		globals::g_Game.count_dd0 = 0;
		FUN_00435e62(globals::g_Game.structbc_24,0.0,0.0);
		FUN_00436c6c(globals::g_Game.structbc_24,200.0);
		FUN_00465c30();
		FUN_00435950();
		pcVar1 = buffer->NextLevel;
		FUN_0046ad50();
		FUN_004180d0();
		FUN_0040aa60();
		FUN_00456f20();
		FUN_00402040(0);
		FUN_00437560();
		FUN_00409900();
		FUN_0040bcf0();
		FUN_00402040(1);
		unk::Lego_SetFlag4_004ddd48(0);
		FUN_00463190(extraout_ECX);
		FUN_00435deb((int)globals::g_Game.structbc_28,0,0.0,0,0.0,0.0);
		unk::StructBC_SetObject4_Field14(globals::g_Game.structbc_2c,NULL,0);
		Game_CleanupSelectedUnitsCount();
		FUN_004534e0();
		FUN_0045ddb0((undefined *)buffer->struct3c_84);
		FUN_0044e930(buffer->surfaceMap,(undefined *)buffer->surfaceMap);
		FUN_0042b3b0((int)buffer);
		FUN_0040b340((uint *)buffer->surfTextGrid);
		FUN_00431460((int)buffer);
		FUN_0040c5c0(extraout_ECX_00);
		std::free(buffer->blocks);
		std::free(buffer);
		FUN_00419e40();
		FUN_0041a850();
		Game_SetGameSpeed(1.0);
		FUN_0045a530();
		FUN_004011c0();
		FUN_0047b420();
		FUN_0040a300();
	}
	globals::g_Game.level = NULL;
	return pcVar1;
}



void __cdecl FUN_0042f210(LevelData *level,int *param_2,int *param_3,int param_4)
{
	LevelBlockFlags1 *pLVar1;
	int iVar2;
	
	iVar2 = (level->dimensions).width;
	if (param_4 != 0) {
		pLVar1 = &level->blocks[(int)(iVar2 * (int)param_3 + (int)param_2)].flags1;
		*pLVar1 = *pLVar1 | BLOCK1_UNK_200;
		lego::game::Level_UpdateBlockSurfaceUnk(level,(int)param_2,(int)param_3);
		return;
	}
	pLVar1 = &level->blocks[(int)(iVar2 * (int)param_3 + (int)param_2)].flags1;
	*pLVar1 = *pLVar1 & ~BLOCK1_UNK_200;
	lego::game::Level_UpdateBlockSurfaceUnk(level,(int)param_2,(int)param_3);
	return;
}



uint __cdecl FUN_0042f280(int param_1,int param_2,undefined *param_3,int param_4)
{
	int iVar1;
	LevelBlockFlags1 LVar2;
	undefined3 uVar3;
	uint uVar5;
	int iVar6;
	int *piVar7;
	int iVar8;
	uint local_24;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	undefined3 uVar4;
	
	local_20[2] = 1;
	local_c = 1;
	local_20[1] = 0xffffffff;
	local_20[3] = 0;
	local_20[4] = 0;
	local_8 = 0xffffffff;
	local_4 = 0;
	local_24 = 0;
	uVar5 = 0;
	piVar7 = local_20 + 1;
	do {
		iVar6 = piVar7[-1] + param_1;
		iVar8 = param_2 + *piVar7;
		if ((((iVar6 < 0) || (iVar8 < 0)) ||
				(iVar1 = ((lego::globals::g_Game.level)->dimensions).width, iVar1 <= iVar6)) ||
			 (((lego::globals::g_Game.level)->dimensions).height <= iVar8)) {
			LVar2 = BLOCK1_NONE;
		}
		else {
			LVar2 = (lego::globals::g_Game.level)->blocks[iVar8 * iVar1 + iVar6].flags1 & BLOCK1_POWERPATH
			;
		}
		if ((LVar2 != BLOCK1_NONE) ||
			 (((lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * iVar8 + iVar6].flags1 & BLOCK1_UNK_400
				) != BLOCK1_NONE)) {
			local_24 |= 1 << ((byte)uVar5 & 0x1f);
		}
		uVar5 += 1;
		piVar7 = piVar7 + 2;
	} while (uVar5 < 4);
	uVar3 = (undefined3)(local_24 >> 8);
	uVar4 = (undefined3)((uint)param_3 >> 8);
	if (param_4 == 0) {
		switch(local_24) {
		case 0:
			*param_3 = 0;
			return CONCAT31(uVar3,0x65);
		case 1:
			*param_3 = 2;
			return CONCAT31(uVar4,0x65);
		case 2:
			*param_3 = 3;
			return CONCAT31(uVar3,0x65);
		case 3:
			*param_3 = 3;
			return CONCAT31(uVar3,99);
		case 4:
			*param_3 = 0;
			return CONCAT31(uVar3,0x65);
		case 5:
			*param_3 = 0;
			return CONCAT31(uVar3,0x62);
		case 6:
			*param_3 = 0;
			return CONCAT31(uVar3,99);
		case 7:
			*param_3 = 0;
			return CONCAT31(uVar3,100);
		case 8:
			*param_3 = 1;
			return CONCAT31(uVar4,0x65);
		case 9:
			*param_3 = 2;
			return CONCAT31(uVar4,99);
		case 10:
			*param_3 = 1;
			return CONCAT31(uVar4,0x62);
		case 0xb:
			*param_3 = 3;
			return CONCAT31(uVar3,100);
		case 0xc:
			*param_3 = 1;
			return CONCAT31(uVar3,99);
		case 0xd:
			*param_3 = 2;
			return CONCAT31(uVar3,100);
		case 0xe:
			*param_3 = 1;
			return CONCAT31(uVar4,100);
		case 0xf:
			*param_3 = 0;
			return CONCAT31(uVar3,0x60);
		}
	}
	else {
		switch(local_24) {
		case 0:
			*param_3 = 0;
			return CONCAT31(uVar4,0x75);
		case 1:
			*param_3 = 2;
			return CONCAT31(uVar3,0x75);
		case 2:
			*param_3 = 3;
			return CONCAT31(uVar4,0x75);
		case 3:
			*param_3 = 3;
			return CONCAT31(uVar4,0x73);
		case 4:
			*param_3 = 0;
			return CONCAT31(uVar3,0x75);
		case 5:
			*param_3 = 0;
			return CONCAT31(uVar3,0x72);
		case 6:
			*param_3 = 0;
			return CONCAT31(uVar4,0x73);
		case 7:
			*param_3 = 0;
			return CONCAT31(uVar3,0x74);
		case 8:
			*param_3 = 1;
			return CONCAT31(uVar3,0x75);
		case 9:
			*param_3 = 2;
			return CONCAT31(uVar3,0x73);
		case 10:
			*param_3 = 1;
			return CONCAT31(uVar3,0x72);
		case 0xb:
			*param_3 = 3;
			return CONCAT31(uVar3,0x74);
		case 0xc:
			*param_3 = 1;
			return CONCAT31(uVar3,0x73);
		case 0xd:
			*param_3 = 2;
			return CONCAT31(uVar4,0x74);
		case 0xe:
			*param_3 = 1;
			return CONCAT31(uVar3,0x74);
		case 0xf:
			*param_3 = 0;
			return CONCAT31(uVar4,0x71);
		}
	}
	return local_24 & 0xffffff00 | (uint)param_3 & 0xff;
}



// WARNING: Switch with 1 destination removed at 0x0042fd79 : 5 cases all go to same destination
// WARNING: Switch with 1 destination removed at 0x0042fdd8 : 5 cases all go to same destination

void __cdecl lego::game::Level_UpdateBlockSurfaceUnk(LevelData *level,int x,int y)
{
	LevelBlock *pLVar1;
	LevelBlock *pLVar2;
	LevelSurfaceMap *pLVar3;
	int iVar4;
	LevelBlockFlags1 LVar5;
	LevelBlockFlags2 LVar6;
	LevelBlockFlags1 LVar7;
	BOOL BVar8;
	int *piVar9;
	DebugFlags DVar10;
	uint *puVar11;
	uint extraout_ECX;
	uint uVar12;
	uint extraout_EDX;
	uint uVar13;
	float local_60;
	int local_5c;
	float local_58;
	float local_54;
	Point2I *local_50;
	LevelSurfaceMap *local_4c;
	Point2I local_48;
	undefined4 local_40;
	int local_3c;
	Point2I local_38;
	uint local_30 [5];
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	iVar4 = (level->dimensions).width;
	if (iVar4 - 1U <= (uint)x) {
		return;
	}
	if ((level->dimensions).height - 1U <= (uint)y) {
		return;
	}
	local_4c = level->surfaceMap;
	iVar4 = y * iVar4 + x;
	local_5c = 0;
	local_30[0] = 0;
	LVar5 = level->blocks[iVar4].flags1 & BLOCK1_POWERPATH;
	local_30[1] = 0;
	pLVar1 = level->blocks + iVar4;
	local_30[2] = 1;
	local_30[3] = 0;
	local_30[4] = 1;
	local_1c = 1;
	local_18 = 0;
	local_14 = 1;
	local_3c = 1;
	if ((LVar5 == BLOCK1_NONE) || ((pLVar1->flags2 & 0x400) != BLOCK2_NONE)) {
		if ((LVar5 == BLOCK1_NONE) && ((pLVar1->flags2 & 0x400) != BLOCK2_NONE)) {
			unk::Lego_PathLiveLevelsIncrementConditional(0);
			LVar6 = pLVar1->flags2 & 0xfffffbff;
			goto LAB_0042f6d5;
		}
	}
	else {
		unk::Lego_PathLiveLevelsIncrementConditional(1);
		LVar6 = pLVar1->flags2 | 0x400;
LAB_0042f6d5:
		pLVar1->flags2 = LVar6;
	}
	iVar4 = (level->dimensions).width;
	pLVar2 = level->blocks;
	local_50 = &local_38;
	uVar12 = 0;
										// Get surrounding blocks for orientation?
	puVar11 = local_30;
	do {
		if (pLVar2[(puVar11[1] + y) * iVar4 + x + *puVar11].predug == PREDUG_EXPOSED) {
			local_48.x = local_48.x & 0xffffff00U | uVar12 & 0xff;
			local_5c += 1;
		}
		else {
			*(char *)&local_50->x = (char)uVar12;
			local_50 = (Point2I *)((int)&local_50->x + 1);
		}
		uVar12 += 1;
		puVar11 = puVar11 + 2;
	} while (uVar12 < 4);
	LVar5 = pLVar1->flags1;
	LVar7 = LVar5 & 0xffffdf27;
	pLVar1->flags1 = LVar7;
	if (local_5c == 4) {
		local_38.x = x;
		local_38.y = y;
		pLVar1->flags1 = LVar5 & 0xffffdf07 | 0xc;
		pLVar1->field_3 = 0;
		if ((LVar5 & BLOCK1_UNK_8) == BLOCK1_NONE) {
			local_48.x = x;
			local_48.y = y;
			FUN_00402a10(&local_38,0);
			FUN_00431380(level,&local_48,1);
			if ((globals::g_Game.flags1 & GAME1_ALWAYSROCKFALL) != GAME1_NONE) {
				Level_AddMessageAction
									(MESSAGE_DIG_COMPLETE,0,
									 (uint)(globals::g_Game.level)->blocks
												 [((globals::g_Game.level)->dimensions).width * y + x].field_3,
									 (undefined4 *)&local_48);
			}
		}
		if ((pLVar1->flags1 & BLOCK1_UNK_400000) == BLOCK1_NONE) {
			if ((((((globals::g_Game.level)->blocks
							[((globals::g_Game.level)->dimensions).width * local_38.y + local_38.x].flags1 &
						 BLOCK1_UNK_400) == BLOCK1_NONE) &&
					 ((*(byte *)&(globals::g_Game.level)->blocks
											 [((globals::g_Game.level)->dimensions).width * local_38.y + local_38.x].
											 flags2 & 4) == 0)) &&
					((*(byte *)((int)&(globals::g_Game.level)->blocks
														[((globals::g_Game.level)->dimensions).width * local_38.y + local_38.x].
														flags1 + 1) & 0x80) == 0)) &&
				 (BVar8 = FUN_00408fd0(&local_38), BVar8 == 0)) {
				iVar4 = ((globals::g_Game.level)->dimensions).width * local_38.y + local_38.x;
				(globals::g_Game.level)->blocks[iVar4].flags1 =
						 (globals::g_Game.level)->blocks[iVar4].flags1 & ~BLOCK1_UNK_200000;
				iVar4 = ((globals::g_Game.level)->dimensions).width * local_38.y + local_38.x;
				(globals::g_Game.level)->blocks[iVar4].flags1 =
						 (globals::g_Game.level)->blocks[iVar4].flags1 & ~BLOCK1_POWERPATH;
				iVar4 = ((globals::g_Game.level)->dimensions).width * local_38.y + local_38.x;
				(globals::g_Game.level)->blocks[iVar4].flags1 =
						 (globals::g_Game.level)->blocks[iVar4].flags1 & ~BLOCK1_UNK_40000000;
				FUN_00439c50();
				FUN_00402970(&local_38);
				other::logf_removed((char *)&local_38);
				iVar4 = 4;
				do {
					FUN_00402fe0(&local_38,0x28);
					iVar4 += -1;
				} while (iVar4 != 0);
				iVar4 = ((globals::g_Game.level)->dimensions).width * local_38.y + local_38.x;
				(globals::g_Game.level)->blocks[iVar4].flags1 =
						 (globals::g_Game.level)->blocks[iVar4].flags1 | BLOCK1_RUBBLE_FULL;
			}
			iVar4 = ((globals::g_Game.level)->dimensions).width * local_38.y + local_38.x;
			(globals::g_Game.level)->blocks[iVar4].flags1 =
					 (globals::g_Game.level)->blocks[iVar4].flags1 | BLOCK1_UNK_400000;
			FUN_0041ceb0((int *)&local_38);
		}
		iVar4 = FUN_0040e110(level,x,y);
		FUN_0040e280((int)level,x,y,(uint)(iVar4 != 0));
		if ((pLVar1->terrain == TERRAIN_LAVA) ||
			 (LVar5 = pLVar1->flags1, (LVar5 & BLOCK1_UNK_80000000) != BLOCK1_NONE)) {
			FUN_0040ed80(&local_38,1);
			if ((pLVar1->flags1 & BLOCK1_UNK_200) == BLOCK1_NONE) {
				if (pLVar1->field_7 == 4) {
					pLVar1->texture = TEXTURE_LAVA;
					FUN_00450c20(level->surfaceMap,x,y,1);
					if ((pLVar1->flags1 & BLOCK1_UNK_4000) == BLOCK1_NONE) {
						if ((int)pLVar1->randomness % 3 == 0) {
							local_48.x = 0x3dcccccd;
							local_48.y = 0x3dcccccd;
							local_40 = 0xbf800000;
							piVar9 = FUN_004656f0(0,x,y,(int *)&local_48,0.6,0.4,0.0,1.0,0x3e99999a,0,
																		(int)pLVar1->randomness,0x26);
							pLVar1->field_1c = piVar9;
							pLVar1->flags1 = pLVar1->flags1 | BLOCK1_UNK_4000;
						}
					}
					else {
						FUN_00465d80(pLVar1->field_1c,0);
					}
				}
				else {
					FUN_00450c20(level->surfaceMap,x,y,0);
					switch(pLVar1->field_7) {
					case 0:
						pLVar1->texture = TEXTURE_ERODE_LOW;
						break;
					case 1:
						pLVar1->texture = TEXTURE_ERODE_MEDIUM;
						break;
					case 2:
						pLVar1->texture = TEXTURE_ERODE_HIGH;
						break;
					case 3:
						pLVar1->texture = TEXTURE_ERODE_FULL;
					}
				}
			}
			else {
				FUN_00450c20(level->surfaceMap,x,y,0);
				pLVar1->texture = TEXTURE_LAVA_NOTHOT;
				if ((pLVar1->flags1 & BLOCK1_UNK_4000) != BLOCK1_NONE) {
					FUN_00465d80(pLVar1->field_1c,1);
				}
			}
		}
		else {
			if (pLVar1->terrain == TERRAIN_LAKE) {
				pLVar1->texture = TEXTURE_WATER;
				FUN_00450c20(level->surfaceMap,x,y,1);
			}
			else {
				if ((LVar5 & BLOCK1_UNK_100000) == BLOCK1_NONE) {
					if ((LVar5 & BLOCK1_POWERPATH) == BLOCK1_NONE) {
						if ((*(byte *)&pLVar1->flags2 & 0x20) == 0) {
							if ((LVar5 & BLOCK1_UNK_200000) == BLOCK1_NONE) {
								switch(LVar5 & BLOCK1_RUBBLE_FULL) {
								case BLOCK1_NONE:
									pLVar1->texture = TEXTURE_RUBBLE_LOW;
									break;
								case BLOCK1_RUBBLE_LOW:
									pLVar1->texture = TEXTURE_RUBBLE_MEDIUM;
									break;
								case BLOCK1_RUBBLE_MEDIUM:
									pLVar1->texture = TEXTURE_RUBBLE_HIGH;
									break;
								case BLOCK1_RUBBLE_FULL:
									pLVar1->texture = TEXTURE_RUBBLE_FULL;
								}
							}
							else {
								if ((LVar5 & BLOCK1_UNK_40000000) == BLOCK1_NONE) {
									pLVar1->texture = TEXTURE_GROUND;
								}
								else {
									pLVar1->texture = TEXTURE_PATH_BUILD;
								}
							}
						}
						else {
							pLVar1->texture = TEXTURE_SLUGHOLE;
						}
					}
					else {
						uVar12 = FUN_0042f280(x,y,&pLVar1->field_3,pLVar1->flags2 & 0x100);
						pLVar1->texture = (SurfaceTexture)uVar12;
					}
				}
				else {
					if ((pLVar1->flags2 & 0x100) == BLOCK2_NONE) {
						pLVar1->texture = TEXTURE_PATH_BASE;
					}
					else {
						pLVar1->texture = TEXTURE_PATH_BASE_POWERED;
					}
				}
			}
		}
		goto switchD_0042fb8d_caseD_4;
	}
	if (local_5c != 2) {
		if ((local_5c != 1) && (local_5c != 3)) {
			if (((LVar5 & 4) == BLOCK1_NONE) || (pLVar1->terrain - 1 < 5)) {
				pLVar1->texture = TEXTURE_TUNNEL;
			}
			pLVar1->field_3 = 0;
			goto switchD_0042fb8d_caseD_4;
		}
		pLVar1->flags1 = LVar5 & 0xffffdf07 | 0x14;
		if (local_5c == 1) {
			if (true) {
				if (true) {
					switch(pLVar1->terrain) {
					case TERRAIN_IMMOVABLE:
					case TERRAIN_WATER_unused:
						goto switchD_0042fe25_caseD_1;
					case TERRAIN_HARD:
						goto switchD_0042fe25_caseD_2;
					case TERRAIN_MEDIUM:
						goto switchD_0042fe25_caseD_3;
					case TERRAIN_LOOSE:
						goto switchD_0042fe25_caseD_4;
					case TERRAIN_SOIL:
						goto switchD_0042fe25_caseD_5;
					}
				}
			}
			else {
				if (true) {
					switch(pLVar1->terrain) {
					case TERRAIN_IMMOVABLE:
					case TERRAIN_WATER_unused:
switchD_0042fe25_caseD_1:
						pLVar1->texture = TEXTURE_WALL_C_IMMOVABLE;
						break;
					case TERRAIN_HARD:
switchD_0042fe25_caseD_2:
						pLVar1->texture = TEXTURE_WALL_C_HARD;
						break;
					case TERRAIN_MEDIUM:
switchD_0042fe25_caseD_3:
						pLVar1->texture = TEXTURE_WALL_C_MEDIUM;
						break;
					case TERRAIN_LOOSE:
switchD_0042fe25_caseD_4:
						pLVar1->texture = TEXTURE_WALL_C_LOOSE;
						break;
					case TERRAIN_SOIL:
switchD_0042fe25_caseD_5:
						pLVar1->texture = TEXTURE_WALL_C_SOIL;
					}
				}
			}
			pLVar1->flags1 = LVar5 & 0xffffdf07 | 0x54;
			local_38.y = y;
			pLVar1->field_3 = (char)local_48.x + 2U & 3;
			local_38.x = x;
			FUN_00431380(level,&local_38,1);
		}
		else {
			if (local_5c == 3) {
				if (true) {
					if (true) {
						switch(pLVar1->terrain) {
						case TERRAIN_IMMOVABLE:
						case TERRAIN_WATER_unused:
							goto switchD_0042febf_caseD_1;
						case TERRAIN_HARD:
							goto switchD_0042febf_caseD_2;
						case TERRAIN_MEDIUM:
							goto switchD_0042febf_caseD_3;
						case TERRAIN_LOOSE:
							goto switchD_0042febf_caseD_4;
						case TERRAIN_SOIL:
							goto switchD_0042febf_caseD_5;
						}
					}
				}
				else {
					if (true) {
						switch(pLVar1->terrain) {
						case TERRAIN_IMMOVABLE:
						case TERRAIN_WATER_unused:
switchD_0042febf_caseD_1:
							pLVar1->texture = TEXTURE_WALL_O_IMMOVABLE;
							break;
						case TERRAIN_HARD:
switchD_0042febf_caseD_2:
							pLVar1->texture = TEXTURE_WALL_O_HARD;
							break;
						case TERRAIN_MEDIUM:
switchD_0042febf_caseD_3:
							pLVar1->texture = TEXTURE_WALL_O_MEDIUM;
							break;
						case TERRAIN_LOOSE:
switchD_0042febf_caseD_4:
							pLVar1->texture = TEXTURE_WALL_O_LOOSE;
							break;
						case TERRAIN_SOIL:
switchD_0042febf_caseD_5:
							pLVar1->texture = TEXTURE_WALL_O_SOIL;
						}
					}
				}
				local_48.x = x;
				local_48.y = y;
				FUN_00431380(level,&local_48,1);
				FUN_00402a60(&local_48);
				pLVar1->field_3 = (byte)local_38.x;
				pLVar1->flags1 = pLVar1->flags1 | BLOCK1_UNK_80;
			}
		}
		pLVar3 = local_4c;
		FUN_00450a90((uint *)local_4c,x,y,&local_60,&local_60,&local_58);
		FUN_00450a90((uint *)pLVar3,x + 1U,y + 1U,&local_60,&local_60,&local_54);
		local_48.x = (int)(local_58 - local_54);
		FUN_00450a90((uint *)pLVar3,x + 1U,y,&local_60,&local_60,&local_58);
		FUN_00450a90((uint *)pLVar3,x,y + 1U,&local_60,&local_60,&local_54);
		FUN_0044f0b0((uint *)pLVar3,x,y,
								 (uint)((ushort)((ushort)(ABS((float)local_48.x) < ABS(local_58 - local_54)) << 8 |
																(ushort)(ABS((float)local_48.x) == ABS(local_58 - local_54)) << 0xe)
											 == 0));
		local_38.x = x;
		local_38.y = y;
		FUN_00431380(level,&local_38,1);
		goto switchD_0042fb8d_caseD_4;
	}
	local_30[1] = 1;
	local_30[2] = 1;
	local_8 = 1;
	local_30[0] = 0;
	local_18 = 0;
	local_10 = 0;
	local_1c = 3;
	local_14 = 3;
	local_4 = 3;
	uVar12 = 0;
	local_30[3] = 2;
	local_30[4] = 2;
	local_c = 2;
	pLVar1->flags1 = LVar7 | 0x14;
	puVar11 = local_30 + 1;
	do {
		if ((puVar11[-1] == (local_38.x & 0xffU)) && (*puVar11 == ((uint)local_38.x >> 8 & 0xff))) {
			x._0_1_ = (byte)uVar12;
			goto LAB_0042fc43;
		}
		uVar12 += 1;
		puVar11 = puVar11 + 2;
	} while (uVar12 < 6);
LAB_0042fc43:
	if (3 < (byte)x) {
		if (pLVar1->terrain - 1 < 5) {
			pLVar1->texture = TEXTURE_WALL_GAP;
		}
		pLVar1->flags1 =
				 LVar5 & 0xffff0000 | (uint)CONCAT11((char)(LVar7 >> 8),(char)(LVar7 | 0x14)) | 0x2000;
		pLVar1->field_3 = (byte)x - 4;
		FUN_0044f0b0((uint *)local_4c,x,y,(byte)((byte)x - 4) & 1);
		goto switchD_0042fb8d_caseD_4;
	}
	if ((LVar5 & BLOCK1_REINFORCED) == BLOCK1_NONE) {
		if ((int)pLVar1->randomness % 10 == 0) {
			if (true) {
				switch(pLVar1->terrain) {
				case TERRAIN_IMMOVABLE:
				case TERRAIN_WATER_unused:
					goto switchD_0042fce8_caseD_1;
				case TERRAIN_HARD:
					goto switchD_0042fce8_caseD_2;
				case TERRAIN_MEDIUM:
					goto switchD_0042fce8_caseD_3;
				case TERRAIN_LOOSE:
					goto switchD_0042fce8_caseD_4;
				case TERRAIN_SOIL:
					goto switchD_0042fce8_caseD_5;
				case TERRAIN_ORESEAM:
					goto switchD_0042fce8_caseD_8;
				case TERRAIN_CRYSTALSEAM:
					goto switchD_0042fce8_caseD_a;
				case TERRAIN_RECHARGESEAM:
					goto switchD_0042fce8_caseD_b;
				}
			}
		}
		else {
			if (true) {
				switch(pLVar1->terrain) {
				case TERRAIN_IMMOVABLE:
				case TERRAIN_WATER_unused:
switchD_0042fce8_caseD_1:
					pLVar1->texture = TEXTURE_WALL_F_IMMOVABLE;
					pLVar1->field_3 = (byte)x;
					goto switchD_0042fb8d_caseD_4;
				case TERRAIN_HARD:
switchD_0042fce8_caseD_2:
					pLVar1->texture = TEXTURE_WALL_F_HARD;
					pLVar1->field_3 = (byte)x;
					goto switchD_0042fb8d_caseD_4;
				case TERRAIN_MEDIUM:
switchD_0042fce8_caseD_3:
					pLVar1->texture = TEXTURE_WALL_F_MEDIUM;
					pLVar1->field_3 = (byte)x;
					goto switchD_0042fb8d_caseD_4;
				case TERRAIN_LOOSE:
switchD_0042fce8_caseD_4:
					pLVar1->texture = TEXTURE_WALL_F_LOOSE;
					pLVar1->field_3 = (byte)x;
					goto switchD_0042fb8d_caseD_4;
				case TERRAIN_SOIL:
switchD_0042fce8_caseD_5:
					pLVar1->texture = TEXTURE_WALL_F_SOIL;
					pLVar1->field_3 = (byte)x;
					goto switchD_0042fb8d_caseD_4;
				case TERRAIN_ORESEAM:
switchD_0042fce8_caseD_8:
					pLVar1->texture = TEXTURE_WALL_F_ORESEAM;
					pLVar1->field_3 = (byte)x;
					goto switchD_0042fb8d_caseD_4;
				case TERRAIN_CRYSTALSEAM:
switchD_0042fce8_caseD_a:
					pLVar1->texture = TEXTURE_WALL_F_CRYSTALSEAM;
					pLVar1->field_3 = (byte)x;
					goto switchD_0042fb8d_caseD_4;
				case TERRAIN_RECHARGESEAM:
switchD_0042fce8_caseD_b:
					pLVar1->texture = TEXTURE_WALL_F_RECHARGESEAM;
				}
			}
		}
	}
	else {
		if (true) {
			switch(pLVar1->terrain) {
			case TERRAIN_IMMOVABLE:
			case TERRAIN_WATER_unused:
				pLVar1->texture = TEXTURE_WALL_R_IMMOVABLE;
				pLVar1->field_3 = (byte)x;
				break;
			case TERRAIN_HARD:
				pLVar1->texture = TEXTURE_WALL_R_HARD;
				pLVar1->field_3 = (byte)x;
				break;
			case TERRAIN_MEDIUM:
				pLVar1->texture = TEXTURE_WALL_R_MEDIUM;
				pLVar1->field_3 = (byte)x;
				break;
			case TERRAIN_LOOSE:
				pLVar1->texture = TEXTURE_WALL_R_LOOSE;
				pLVar1->field_3 = (byte)x;
				break;
			case TERRAIN_SOIL:
				pLVar1->texture = TEXTURE_WALL_R_SOIL;
				pLVar1->field_3 = (byte)x;
				break;
			default:
				goto switchD_0042fce8_caseD_6;
			}
			goto switchD_0042fb8d_caseD_4;
		}
	}
switchD_0042fce8_caseD_6:
	pLVar1->field_3 = (byte)x;
switchD_0042fb8d_caseD_4:
	LVar5 = pLVar1->flags1;
	if ((((LVar5 & 4) != BLOCK1_NONE) && ((LVar5 & 0x800000) != BLOCK1_NONE)) &&
		 ((pLVar1->terrain == TERRAIN_IMMOVABLE ||
			((pLVar1->terrain == TERRAIN_WATER_unused || ((LVar5 & BLOCK1_UNK_8) != BLOCK1_NONE)))))) {
		pLVar1->flags1 = LVar5 & 0xff7fffff;
		FUN_0044f830(level->surfaceMap,x,y);
	}
	DVar10 = main::Config_GetDebugFlags();
	iVar4 = local_3c;
	if ((DVar10 & DEBUGFLAG_BLOCKFADEIN) == DEBUGFLAG_NONE) {
		iVar4 = 0;
	}
	uVar12 = extraout_ECX & 0xffffff00 | (uint)pLVar1->field_3;
	uVar13 = extraout_EDX & 0xffffff00 | (uint)pLVar1->texture;
	if (iVar4 == 0) {
		FUN_0044f4f0(level->surfaceMap,x,y,uVar13,uVar12);
	}
	else {
		Level_FadeInBlock(level->surfaceMap,(int *)x,(int *)y,uVar13,uVar12);
	}
	if (level->UseRoof != BOOL3_FALSE) {
		FUN_004332b0(level,x,y);
	}
	return;
}



void __cdecl FUN_004301e0(Point2I *param_1)
{
	LevelBlockFlags1 *pLVar1;
	int iVar2;
	
	pLVar1 = &(lego::globals::g_Game.level)->blocks
						[((lego::globals::g_Game.level)->dimensions).width * param_1->y + param_1->x].flags1;
	*pLVar1 = *pLVar1 & ~BLOCK1_POWERPATH;
	iVar2 = ((lego::globals::g_Game.level)->dimensions).width * param_1->y + param_1->x;
	(lego::globals::g_Game.level)->blocks[iVar2].flags1 =
			 (lego::globals::g_Game.level)->blocks[iVar2].flags1 & ~BLOCK1_UNK_40000000;
	FUN_00439c50();
	FUN_00402970(param_1);
	lego::other::logf_removed((char *)param_1);
	return;
}



void __cdecl FUN_00430250(Point2I *param_1,undefined4 param_2)
{
	BOOL BVar1;
	int iVar2;
	
	if (((((lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * param_1->y + param_1->x].flags1 &
				BLOCK1_UNK_400) == BLOCK1_NONE) &&
			((*(byte *)&(lego::globals::g_Game.level)->blocks
									[((lego::globals::g_Game.level)->dimensions).width * param_1->y + param_1->x].
									flags2 & 4) == 0)) &&
		 (((lego::globals::g_Game.level)->blocks
			 [((lego::globals::g_Game.level)->dimensions).width * param_1->y + param_1->x].flags1 &
			BLOCK1_UNK_8000) == BLOCK1_NONE)) {
		BVar1 = FUN_00408fd0(param_1);
		if (BVar1 == 0) {
			iVar2 = ((lego::globals::g_Game.level)->dimensions).width * param_1->y + param_1->x;
			(lego::globals::g_Game.level)->blocks[iVar2].flags1 =
					 (lego::globals::g_Game.level)->blocks[iVar2].flags1 & ~BLOCK1_UNK_200000;
			iVar2 = ((lego::globals::g_Game.level)->dimensions).width * param_1->y + param_1->x;
			(lego::globals::g_Game.level)->blocks[iVar2].flags1 =
					 (lego::globals::g_Game.level)->blocks[iVar2].flags1 & ~BLOCK1_POWERPATH;
			iVar2 = ((lego::globals::g_Game.level)->dimensions).width * param_1->y + param_1->x;
			(lego::globals::g_Game.level)->blocks[iVar2].flags1 =
					 (lego::globals::g_Game.level)->blocks[iVar2].flags1 & ~BLOCK1_UNK_40000000;
			FUN_00439c50();
			FUN_00402970(param_1);
			lego::other::logf_removed((char *)param_1);
			iVar2 = 4;
			do {
				FUN_00402fe0(param_1,param_2);
				iVar2 += -1;
			} while (iVar2 != 0);
			iVar2 = ((lego::globals::g_Game.level)->dimensions).width * param_1->y + param_1->x;
			(lego::globals::g_Game.level)->blocks[iVar2].flags1 =
					 (lego::globals::g_Game.level)->blocks[iVar2].flags1 | BLOCK1_RUBBLE_FULL;
		}
	}
	return;
}



void __cdecl FUN_004303a0(int param_1,undefined4 param_2,int *param_3,int *param_4)
{
	undefined4 *puVar1;
	int *piVar2;
	
	if ((param_3 != NULL) && (param_4 != NULL)) {
		if ((param_3 < (int *)(*(int *)(param_1 + 0x14) - 2U)) &&
			 ((param_4 < (int *)(*(int *)(param_1 + 0x18) - 2U) &&
				((*(byte *)(*(int *)(param_1 + 0xb8) + 8 +
									 (int)((int)param_4 * *(int *)(param_1 + 0x14) + (int)param_3) * 0x48) & 8) != 0))
			 )) {
			puVar1 = FUN_0046eb60((int)param_3,(int)param_4,NULL);
			if (puVar1 != NULL) {
				piVar2 = (int *)((int)param_4 * *(int *)(param_1 + 0x14) + (int)param_3);
				*(uint *)(*(int *)(param_1 + 0xb8) + 8 + (int)piVar2 * 0x48) =
						 *(uint *)(*(int *)(param_1 + 0xb8) + 8 + (int)piVar2 * 0x48) & 0xfffffff7;
				piVar2 = (int *)((int)param_4 * *(int *)(param_1 + 0x14) + (int)param_3);
				*(uint *)(*(int *)(param_1 + 0xb8) + 8 + (int)piVar2 * 0x48) =
						 *(uint *)(*(int *)(param_1 + 0xb8) + 8 + (int)piVar2 * 0x48) | 0x10;
				lego::game::Level_UpdateBlockSurfaceUnk((LevelData *)param_1,(int)param_3,(int)param_4);
				FUN_0046e5f0((int)param_3,(uint)param_4);
			}
		}
	}
	return;
}



BOOL __cdecl FUN_00430460(LevelData *level,int in_x,int in_y,int param_4)
{
	int *piVar1;
	LevelBlock *pLVar2;
	LevelBlockFlags1 *pLVar3;
	LevelBlockFlags2 *pLVar4;
	short *psVar5;
	TerrainType TVar6;
	PredugType PVar7;
	LevelSurfaceMap *pLVar8;
	LevelBlockFlags1 LVar9;
	LevelBlockFlags2 LVar10;
	int x;
	int *piVar11;
	int iVar12;
	BOOL BVar13;
	uint uVar14;
	int iVar15;
	uint *puVar16;
	uint uVar17;
	InfoType infoType;
	Point2I local_50;
	Point2I local_48;
	int local_40 [5];
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	x = in_x;
	pLVar8 = level->surfaceMap;
	local_40[0] = 0;
	local_40[1] = 0;
	local_40[2] = 1;
	local_40[3] = 0;
	local_40[4] = 1;
	local_2c = 1;
	local_28 = 0;
	local_24 = 1;
	if ((((in_x == 0) || (in_y == 0)) ||
			(iVar12 = (level->dimensions).width, iVar12 - 2U <= (uint)in_x)) ||
		 (((level->dimensions).height - 2U <= (uint)in_y ||
			(pLVar2 = level->blocks + in_y * iVar12 + in_x, (*(byte *)&pLVar2->flags1 & 8) != 0)))) {
		return 0;
	}
	if ((pLVar2->terrain == TERRAIN_ORESEAM) || (pLVar2->terrain == TERRAIN_CRYSTALSEAM)) {
		local_48.x = in_x;
		local_48.y = in_y;
		pLVar2->float_14 = 0.0;
		piVar11 = local_40;
		in_x = 4;
		do {
			uVar14 = piVar11[1] + in_y;
			iVar12 = *piVar11;
			iVar15 = uVar14 * (level->dimensions).width + x + iVar12;
			if (level->blocks[iVar15].predug == PREDUG_WALL) {
				local_50.x = x;
				local_50.y = in_y;
				level->blocks[iVar15].predug = PREDUG_EXPOSED|PREDUG_HIDDEN_SLUGHOLE;
				TVar6 = level->blocks[in_y * (level->dimensions).width + x].terrain;
				if ((TVar6 == TERRAIN_ORESEAM) || (TVar6 == TERRAIN_CRYSTALSEAM)) {
					lego::game::Info_FUN_00419ab0(INFO_GENERICSEAMFOUND,NULL,NULL,&local_50);
				}
				TVar6 = level->blocks[in_y * (level->dimensions).width + x].terrain;
				if (TVar6 == TERRAIN_ORESEAM) {
					infoType = INFO_ORESEAMFOUND;
				}
				else {
					if (TVar6 != TERRAIN_CRYSTALSEAM) goto LAB_00430c0d;
					infoType = INFO_CRYSTALSEAMFOUND;
				}
				lego::game::Info_FUN_00419ab0(infoType,NULL,NULL,&local_50);
			}
LAB_00430c0d:
			PVar7 = level->blocks[uVar14 * (level->dimensions).width + x + iVar12].predug;
			if (PVar7 != PREDUG_EXPOSED) {
				level->blocks[uVar14 * (level->dimensions).width + x + iVar12].predug = PVar7 + ~PREDUG_WALL
				;
				FUN_0044f640((uint *)pLVar8,iVar12 + x,uVar14,level->DigDepth * 0.25);
			}
			piVar11 = piVar11 + 2;
			in_x += -1;
		} while (in_x != 0);
		FUN_00430d20((int *)&local_48);
		psVar5 = (short *)&level->blocks[in_y * (level->dimensions).width + x].field_0x22;
		*psVar5 = *psVar5 + 1;
		iVar12 = 4;
		if (*(short *)&level->blocks[in_y * (level->dimensions).width + x].field_0x22 != 4) {
			FUN_004332b0(lego::globals::g_Game.level,x,in_y);
			FUN_00409870(&local_48);
			return 0;
		}
		level->blocks[in_y * (level->dimensions).width + x].terrain = TERRAIN_SOIL;
		piVar11 = local_40;
		do {
			piVar1 = piVar11 + 1;
			iVar15 = *piVar11;
			piVar11 = piVar11 + 2;
			iVar12 += -1;
			level->blocks[(*piVar1 + in_y) * (level->dimensions).width + x + iVar15].predug =
					 PREDUG_EXPOSED;
		} while (iVar12 != 0);
		FUN_00430460(level,x,in_y,param_4);
	}
	else {
		if (pLVar2->predug == PREDUG_WALL) {
			FUN_0044f640((uint *)pLVar8,in_x,in_y,level->DigDepth);
			level->blocks[in_y * (level->dimensions).width + in_x].predug = PREDUG_EXPOSED;
		}
		if (level->blocks[in_y * (level->dimensions).width + 1 + in_x].predug == PREDUG_WALL) {
			FUN_0044f640((uint *)pLVar8,in_x + 1,in_y,level->DigDepth);
			level->blocks[in_y * (level->dimensions).width + 1 + in_x].predug = PREDUG_EXPOSED;
		}
		uVar14 = in_y + 1;
		if (level->blocks[uVar14 * (level->dimensions).width + 1 + in_x].predug == PREDUG_WALL) {
			FUN_0044f640((uint *)pLVar8,in_x + 1,uVar14,level->DigDepth);
			level->blocks[uVar14 * (level->dimensions).width + 1 + in_x].predug = PREDUG_EXPOSED;
		}
		if (level->blocks[uVar14 * (level->dimensions).width + in_x].predug == PREDUG_WALL) {
			FUN_0044f640((uint *)pLVar8,in_x,uVar14,level->DigDepth);
			level->blocks[uVar14 * (level->dimensions).width + in_x].predug = PREDUG_EXPOSED;
		}
		local_40[0] = -1;
		local_40[1] = 0xffffffff;
		local_40[3] = 0xffffffff;
		local_2c = 0xffffffff;
		local_28 = 0xffffffff;
		local_18 = 0xffffffff;
		piVar11 = local_40;
		local_40[2] = 0;
		local_40[4] = 1;
		local_24 = 0;
		local_20 = 1;
		local_1c = 0;
		local_14 = 1;
		local_10 = 0;
		local_c = 1;
		local_8 = 1;
		local_4 = 1;
		in_x = 8;
		do {
			iVar12 = piVar11[1];
			iVar15 = *piVar11;
			pLVar3 = &level->blocks[(iVar12 + in_y) * (level->dimensions).width + x + iVar15].flags1;
			LVar9 = *pLVar3;
			if ((LVar9 & BLOCK1_UNK_8) == BLOCK1_NONE) {
				*pLVar3 = LVar9 | BLOCK1_UNK_10;
				iVar15 = (iVar12 + in_y) * (level->dimensions).width + x + iVar15;
				level->blocks[iVar15].flags1 = level->blocks[iVar15].flags1 & 0xfffbffff;
			}
			piVar11 = piVar11 + 2;
			in_x += -1;
		} while (in_x != 0);
		local_48.x = x;
		local_48.y = in_y;
		pLVar3 = &level->blocks[in_y * (level->dimensions).width + x].flags1;
		*pLVar3 = *pLVar3 | BLOCK1_UNK_8;
		FUN_00431380(level,&local_48,1);
		iVar12 = in_y * (level->dimensions).width + x;
		level->blocks[iVar12].flags1 = level->blocks[iVar12].flags1 & ~BLOCK1_REINFORCED;
		iVar12 = in_y * (level->dimensions).width + x;
		level->blocks[iVar12].flags1 = level->blocks[iVar12].flags1 | BLOCK1_UNK_400000;
		LVar9 = level->blocks[in_y * (level->dimensions).width + x].flags1;
		if ((((LVar9 & BLOCK1_EXPOSED) == BLOCK1_NONE) || ((LVar9 & BLOCK1_HIDDEN) != BLOCK1_NONE)) &&
			 ((LVar9 & 0x800000) != BLOCK1_NONE)) {
			lego::unk::Lego_DecFloat_00555adc();
		}
		if (param_4 == 0) {
			uVar14 = in_y - 1;
			local_48.x = x;
			local_48.y = in_y;
			if (uVar14 <= in_y + 1U) {
				do {
					puVar16 = (uint *)(x - 1);
					if (puVar16 <= (uint *)(x + 1U)) {
						do {
							if ((*(byte *)((int)&level->blocks
																	 [(int)(uVar14 * (level->dimensions).width + (int)puVar16)].flags1
														+ 2) & 2) != 0) {
								FUN_004314b0(puVar16,uVar14);
								iVar12 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
								if (iVar12 == 0) {
									lego::game::Info_FUN_00419ab0(INFO_CAVERNLOCATED,NULL,NULL,&local_48);
									lego::front::Text_DisplayType(TEXT_CAVERNDISCOVERED,1,0);
									lego::unk::Lego_DecFloat_00555efc();
								}
							}
							puVar16 = (uint *)((int)puVar16 + 1);
						} while (puVar16 <= (uint *)(x + 1U));
					}
					uVar14 += 1;
				} while (uVar14 <= in_y + 1U);
			}
			iVar12 = ((lego::globals::g_Game.level)->dimensions).width * in_y + x;
			(lego::globals::g_Game.level)->blocks[iVar12].flags1 =
					 (lego::globals::g_Game.level)->blocks[iVar12].flags1 | BLOCK1_UNK_800;
			lego::game::Level_AddMessageAction
								(MESSAGE_DIG_COMPLETE,0,
								 (uint)(lego::globals::g_Game.level)->blocks
											 [((lego::globals::g_Game.level)->dimensions).width * in_y + x].field_3,
								 (undefined4 *)&local_48);
			FUN_0046e4e0(level,x,in_y);
			local_50.x = x;
			local_50.y = in_y;
			if (((((lego::globals::g_Game.level)->blocks
						 [((lego::globals::g_Game.level)->dimensions).width * in_y + x].flags1 & BLOCK1_UNK_400)
						== BLOCK1_NONE) &&
					((*(byte *)&(lego::globals::g_Game.level)->blocks
											[((lego::globals::g_Game.level)->dimensions).width * in_y + x].flags2 & 4) ==
					 0)) && ((((lego::globals::g_Game.level)->blocks
										 [((lego::globals::g_Game.level)->dimensions).width * in_y + x].flags1 &
										BLOCK1_UNK_8000) == BLOCK1_NONE &&
									 (BVar13 = FUN_00408fd0(&local_50), BVar13 == 0)))) {
				iVar12 = ((lego::globals::g_Game.level)->dimensions).width * local_50.y + local_50.x;
				(lego::globals::g_Game.level)->blocks[iVar12].flags1 =
						 (lego::globals::g_Game.level)->blocks[iVar12].flags1 & ~BLOCK1_UNK_200000;
				iVar12 = ((lego::globals::g_Game.level)->dimensions).width * local_50.y + local_50.x;
				(lego::globals::g_Game.level)->blocks[iVar12].flags1 =
						 (lego::globals::g_Game.level)->blocks[iVar12].flags1 & ~BLOCK1_POWERPATH;
				iVar12 = ((lego::globals::g_Game.level)->dimensions).width * local_50.y + local_50.x;
				(lego::globals::g_Game.level)->blocks[iVar12].flags1 =
						 (lego::globals::g_Game.level)->blocks[iVar12].flags1 & ~BLOCK1_UNK_40000000;
				FUN_00439c50();
				FUN_00402970(&local_50);
				lego::other::logf_removed((char *)&local_50);
				iVar12 = 4;
				do {
					FUN_00402fe0(&local_50,0x28);
					iVar12 += -1;
				} while (iVar12 != 0);
				iVar12 = ((lego::globals::g_Game.level)->dimensions).width * local_50.y + local_50.x;
				(lego::globals::g_Game.level)->blocks[iVar12].flags1 =
						 (lego::globals::g_Game.level)->blocks[iVar12].flags1 | BLOCK1_RUBBLE_FULL;
			}
			FUN_0041ceb0((int *)&local_50);
		}
		else {
			pLVar3 = &level->blocks[in_y * (level->dimensions).width + x].flags1;
			*pLVar3 = *pLVar3 | BLOCK1_UNK_200000;
		}
		local_48.x = x;
		local_48.y = in_y;
		FUN_00402a10(&local_48,0);
		uVar14 = in_y - 1;
		if (uVar14 < in_y + 2U) {
			do {
				uVar17 = x - 1;
				if (uVar17 < x + 2U) {
					do {
						lego::game::Level_UpdateBlockSurfaceUnk(level,uVar17,uVar14);
						uVar17 += 1;
					} while (uVar17 < x + 2U);
				}
				uVar14 += 1;
			} while (uVar14 < in_y + 2U);
		}
		iVar12 = in_y * (level->dimensions).width + x;
		level->blocks[iVar12].flags1 = level->blocks[iVar12].flags1 & 0xff7fffff;
		uVar14 = in_y - 1;
		if (uVar14 <= in_y + 2U) {
			do {
				uVar17 = x - 1;
				if (uVar17 <= x + 2U) {
					do {
						FUN_0044f270((int)pLVar8,uVar17,uVar14);
						uVar17 += 1;
					} while (uVar17 <= x + 2U);
				}
				uVar14 += 1;
			} while (uVar14 <= in_y + 2U);
		}
		if ((param_4 == 0) && ((lego::globals::g_Game.flags2 & GAME2_GENERATESPIDERS) != GAME2_NONE)) {
			uVar14 = SEXT24(level->blocks[in_y * (level->dimensions).width + x].randomness);
			uVar17 = (int)uVar14 >> 0x1f;
			if (((uVar14 ^ uVar17) - uVar17 & 3 ^ uVar17) == uVar17) {
				FUN_0044b400(x,in_y,(int)uVar14 % 0x549);
			}
		}
		local_50.x = x;
		local_50.y = in_y;
		FUN_00437c00(&local_50);
		pLVar4 = &level->blocks[in_y * (level->dimensions).width + x].flags2;
		LVar10 = *pLVar4;
		if ((LVar10 & BLOCK2_SLUGHOLE_HIDDEN) != BLOCK2_NONE) {
			*pLVar4 = LVar10 & ~BLOCK2_SLUGHOLE_HIDDEN;
			iVar12 = in_y * (level->dimensions).width + x;
			level->blocks[iVar12].flags2 = level->blocks[iVar12].flags2 | BLOCK2_SLUGHOLE_EXPOSED;
			lego::game::Level_RegisterSlimySlugHole(&local_50);
			lego::game::Level_UpdateBlockSurfaceUnk(level,x,in_y);
		}
		if (param_4 == 0) {
			lego::game::Info_FUN_00419ab0(INFO_WALLDUG,NULL,NULL,&local_50);
			return 1;
		}
	}
	return 1;
}



void __cdecl FUN_00430d20(int *param_1)
{
	TerrainType TVar1;
	int iVar2;
	int iVar3;
	int iVar4;
	int *piVar5;
	uint uVar6;
	Point2I local_28;
	int local_20 [8];
	
	uVar6 = 0;
	local_20[1] = 0xffffffff;
	local_20[6] = 0xffffffff;
	local_20[2] = 1;
	local_20[5] = 1;
	iVar2 = param_1[1];
	iVar3 = *param_1;
	local_20[0] = 0;
	local_20[3] = 0;
	local_20[4] = 0;
	local_20[7] = 0;
	piVar5 = local_20;
	do {
		iVar4 = (piVar5[1] + iVar2) * ((lego::globals::g_Game.level)->dimensions).width + iVar3 +
						*piVar5;
		if ((((*(byte *)&(lego::globals::g_Game.level)->blocks[iVar4].flags1 & 8) != 0) &&
				(TVar1 = (lego::globals::g_Game.level)->blocks[iVar4].terrain, TVar1 != TERRAIN_LAKE)) &&
			 (TVar1 != TERRAIN_LAVA)) break;
		uVar6 += 1;
		piVar5 = piVar5 + 2;
	} while (uVar6 < 4);
	if (uVar6 != 4) {
		local_28.y = local_20[uVar6 * 2 + 1] + iVar2;
		local_28.x = local_20[uVar6 * 2] + iVar3;
		TVar1 = (lego::globals::g_Game.level)->blocks
						[iVar2 * ((lego::globals::g_Game.level)->dimensions).width + iVar3].terrain;
		if (TVar1 == TERRAIN_ORESEAM) {
			lego::game::Level_GenerateOre(&local_28,0,NULL,1);
			return;
		}
		if (TVar1 == TERRAIN_CRYSTALSEAM) {
			lego::game::Level_GenerateCrystal(&local_28,0,NULL,1);
		}
	}
	return;
}



undefined4 __cdecl FUN_00430e10(int param_1,uint *param_2,int *param_3)
{
	int *piVar1;
	int iVar2;
	uint *puVar3;
	int *piVar4;
	uint uVar5;
	int *piVar6;
	int iVar7;
	uint *puVar8;
	uint uVar9;
	Point2I local_28;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	puVar3 = param_2;
	local_28.x = *(int *)(param_1 + 4);
	local_20[0] = -1;
	local_20[1] = 0xffffffff;
	local_20[2] = 0;
	local_20[3] = 0xffffffff;
	local_20[4] = 0;
	local_c = 0;
	local_8 = 0xffffffff;
	local_4 = 0;
	if ((((param_2 != NULL) && (param_3 != NULL)) &&
			(param_2 < (uint *)(*(int *)(param_1 + 0x14) - 2U))) &&
		 (param_3 < (int *)(*(int *)(param_1 + 0x18) - 2U))) {
		if (*(char *)(*(int *)(param_1 + 0xb8) +
								 (int)((int)param_3 * *(int *)(param_1 + 0x14) + (int)param_2) * 0x48) == '\0') {
			FUN_0044f640((uint *)local_28.x,(uint)param_2,(uint)param_3,*(undefined4 *)(param_1 + 0x20));
			iVar7 = 4;
			*(undefined *)
			 (*(int *)(param_1 + 0xb8) +
			 (int)((int)param_3 * *(int *)(param_1 + 0x14) + (int)param_2) * 0x48) = 1;
			piVar4 = local_20 + 1;
			do {
				piVar1 = piVar4 + -1;
				iVar2 = *piVar4;
				piVar4 = piVar4 + 2;
				puVar8 = (uint *)(*(int *)(param_1 + 0xb8) + 8 +
												 ((int)param_2 + ((int)param_3 + iVar2) * *(int *)(param_1 + 0x14) + *piVar1
												 ) * 0x48);
				iVar7 += -1;
				*puVar8 = *puVar8 | 0x40000;
			} while (iVar7 != 0);
			for (piVar4 = (int *)((int)param_3 - 1); piVar4 <= param_3; piVar4 = (int *)((int)piVar4 + 1))
			{
				for (puVar8 = (uint *)((int)param_2 - 1); puVar8 <= param_2;
						puVar8 = (uint *)((int)puVar8 + 1)) {
					lego::game::Level_UpdateBlockSurfaceUnk((LevelData *)param_1,(int)puVar8,(int)piVar4);
				}
			}
			uVar5 = (int)param_3 - 1;
			if (uVar5 <= (int)param_3 + 1U) {
				do {
					uVar9 = (int)param_2 - 1;
					if (uVar9 <= (int)param_2 + 1U) {
						do {
							FUN_0044f270(local_28.x,uVar9,uVar5);
							uVar9 += 1;
						} while (uVar9 <= (int)param_2 + 1U);
					}
					uVar5 += 1;
				} while (uVar5 <= (int)param_3 + 1U);
			}
			piVar4 = (int *)(param_1 + 0x14);
			piVar1 = (int *)(param_1 + 0xb8);
			puVar8 = NULL;
			local_20[2] = 1;
			local_c = 1;
			local_28.x = (int)param_2;
			local_28.y = (int)param_3;
			param_1 = 0;
			local_20[0] = 0;
			local_20[1] = 0xffffffff;
			local_20[3] = 0;
			local_20[4] = 0;
			local_8 = 0xffffffff;
			local_4 = 0;
			piVar6 = local_20;
			do {
				if (*(char *)(*piVar1 +
										 ((int)puVar3 + *piVar6 + (piVar6[1] + (int)param_3) * *piVar4) * 0x48) ==
						'\x01') {
					param_1 += 1;
					param_2 = puVar8;
				}
				puVar8 = (uint *)((int)puVar8 + 1);
				piVar6 = piVar6 + 2;
			} while (puVar8 < &DAT_00000004);
			if (param_1 == 1) {
				lego::game::Level_AddMessageAction
									(MESSAGE_DIG_COMPLETE,0,(int)param_2 - 2U & 3 | 0x10000,(undefined4 *)&local_28);
			}
			FUN_00402a10(&local_28,1);
		}
		return 1;
	}
	return 0;
}



void __cdecl FUN_00431020(int **param_1)
{
	LevelData *level;
	int *piVar1;
	
	level = lego::globals::g_Game.level;
	FUN_00431380(lego::globals::g_Game.level,(Point2I *)param_1,0);
	piVar1 = (int *)((level->dimensions).width * (int)param_1[1] + (int)*param_1);
	level->blocks[(int)piVar1].flags1 = level->blocks[(int)piVar1].flags1 & ~BLOCK1_REINFORCED;
	lego::game::Level_UpdateBlockSurfaceUnk(level,(int)*param_1,(int)param_1[1]);
	return;
}



void __cdecl FUN_00431070(int x,int y)
{
	LevelBlockFlags1 *pLVar1;
	LevelBlockFlags1 LVar2;
	LevelData *level;
	Point2I point;
	
	level = lego::globals::g_Game.level;
	pLVar1 = &(lego::globals::g_Game.level)->blocks
						[((lego::globals::g_Game.level)->dimensions).width * y + x].flags1;
	LVar2 = *pLVar1;
	if (((LVar2 & BLOCK1_UNK_10) != BLOCK1_NONE) &&
		 ((LVar2 & (BLOCK1_REINFORCED|BLOCK1_UNK_40|BLOCK1_UNK_80)) == BLOCK1_NONE)) {
		*pLVar1 = LVar2 | BLOCK1_REINFORCED;
		lego::game::Level_UpdateBlockSurfaceUnk(level,x,y);
		point.x = x;
		point.y = y;
		lego::res::Res_Unk_RechargeSparkle(level,&point,0);
		FUN_00402a60(&point);
		lego::game::Info_FUN_00419ab0(INFO_WALLREINFORCED,NULL,NULL,&point);
	}
	return;
}



void __cdecl lego::res::Res_Unk_RechargeSparkle(LevelData *level,Point2I *position,BOOL param_3)
{
	int iVar1;
	LevelStruct_1c *pLVar2;
	ResourceData *pRVar3;
	uint uVar4;
	LevelStruct_1c *pLVar5;
	float10 fVar6;
	float local_3c;
	float local_38;
	float local_34;
	float local_30 [4];
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	pRVar3 = globals::g_Game.RES_RechargeSparkle;
	iVar1 = position->y * (level->dimensions).width + position->x;
	local_30[0] = 0.0;
	local_30[1] = 1.0;
	local_30[2] = 0.0;
	uVar4 = (uint)level->blocks[iVar1].field_3;
	local_30[3] = 1.0;
	local_20 = 0;
	local_1c = 0;
	local_18 = 0;
	local_14 = 0xbf800000;
	local_10 = 0;
	local_c = 0xbf800000;
	local_8 = 0;
	local_4 = 0;
	if (param_3 != 0) {
		pLVar2 = level->blocks[iVar1].struct1c_18;
		if (pLVar2 == NULL) {
			pLVar2 = (LevelStruct_1c *)std::malloc(0x1c);
			pLVar5 = pLVar2;
			for (iVar1 = 7; iVar1 != 0; iVar1 += -1) {
				pLVar5->resData = NULL;
				pLVar5 = (LevelStruct_1c *)&pLVar5->position;
			}
			pLVar2->bool_18 = param_3;
			pRVar3 = Res_DuplicateResource(pRVar3);
			pLVar2->resData = pRVar3;
			if (pLVar2->bool_18 == 0) {
				Res_ResourceShortNormal_FUN_00473630(pRVar3,"Activity_Build");
			}
			Res_DoCallbacks(pLVar2->resData,0.0);
			(pLVar2->position).x = position->x;
			*(int *)&pLVar2->position = position->y;
			pLVar2->next = NULL;
			pLVar5 = level->terrain1c_88;
			pLVar2->previous = pLVar5;
			if (pLVar5 != NULL) {
				pLVar5->next = pLVar2;
			}
			level->terrain1c_88 = pLVar2;
			level->blocks[position->y * (level->dimensions).width + position->x].struct1c_18 = pLVar2;
		}
		FUN_0044f900(level->surfaceMap,position->x,position->y,&local_3c,&local_38);
		fVar6 = game::SurfaceMap_UnkGetZ(level->surfaceMap,local_3c,local_38);
		local_34 = (float)fVar6;
		Res_SetFramePosition(pLVar2->resData,NULL,local_3c,local_38,local_34);
		Res_SetFrameOrientation
							(pLVar2->resData,NULL,local_30[uVar4 * 3],local_30[uVar4 * 3 + 1],
							 local_30[uVar4 * 3 + 2],0.0,0.0,-1.0);
	}
	return;
}



void __cdecl FUN_004312e0(LevelData *level,float param_2)
{
	byte bVar1;
	LevelStruct_1c *pLVar2;
	LevelStruct_1c *pLVar3;
	float10 fVar4;
	
	pLVar2 = level->terrain1c_88;
	while (pLVar3 = pLVar2, pLVar3 != NULL) {
		pLVar2 = pLVar3->previous;
		fVar4 = lego::res::Res_DoAnimElapsedCallbacks(pLVar3->resData,param_2);
		if (pLVar3->bool_18 == 0) {
			bVar1 = *(byte *)&pLVar3->field_c;
			if (((bVar1 & 1) == 0) && ((float)fVar4 != 0.0)) {
				*(byte *)&pLVar3->field_c = bVar1 | 1;
				lego::res::Res_ResourceShortNormal_FUN_00473630(pLVar3->resData,"Activity_Stand");
			}
			else {
				if ((bVar1 & 2) == 0) {
					if (((bVar1 & 4) != 0) && ((float)fVar4 != 0.0)) {
						*(byte *)&pLVar3->field_c = bVar1 | 2;
					}
				}
				else {
					FUN_004313f0((int **)pLVar3);
				}
			}
		}
	}
	return;
}



void __cdecl FUN_00431380(LevelData *level,Point2I *position,BOOL param_3)
{
	LevelStruct_1c *pLVar1;
	
	pLVar1 = level->blocks[(level->dimensions).width * position->y + position->x].struct1c_18;
	if (pLVar1 != NULL) {
		if ((param_3 == 0) && (pLVar1->bool_18 == 0)) {
			lego::res::Res_ResourceShortNormal_FUN_00473630(pLVar1->resData,"Activity_Destroy");
			lego::res::Res_DoCallbacks(pLVar1->resData,0.0);
			*(byte *)&pLVar1->field_c = *(byte *)&pLVar1->field_c | 4;
			return;
		}
		*(byte *)&pLVar1->field_c = *(byte *)&pLVar1->field_c | 2;
	}
	return;
}



void __cdecl FUN_004313f0(int **param_1)
{
	LevelData *pLVar1;
	
	pLVar1 = lego::globals::g_Game.level;
	lego::pool::ReservedPool_ResourceData___Release((ResourceData *)*param_1);
	pLVar1->blocks[(int)((int)param_1[2] * (pLVar1->dimensions).width + (int)param_1[1])].struct1c_18
			 = NULL;
	if (param_1[4] == NULL) {
		pLVar1->terrain1c_88 = (LevelStruct_1c *)param_1[5];
	}
	else {
		param_1[4][5] = (int)param_1[5];
	}
	if (param_1[5] != NULL) {
		param_1[5][4] = (int)param_1[4];
	}
	std::free(param_1);
	return;
}



void __cdecl FUN_00431460(int param_1)
{
	int **ppiVar1;
	int **ppiVar2;
	
	ppiVar2 = *(int ***)(param_1 + 0x88);
	while (ppiVar2 != NULL) {
		ppiVar1 = (int **)ppiVar2[5];
		FUN_004313f0(ppiVar2);
		ppiVar2 = ppiVar1;
	}
	return;
}



LevelData * __cdecl lego::game::GetLevel(void)
{
	return globals::g_Game.level;
}



LevelSurfaceMap * __cdecl lego::game::GetSurfaceMap(void)
{
	LevelData *pLVar1;
	
	pLVar1 = GetLevel();
	return pLVar1->surfaceMap;
}



void __cdecl FUN_004314b0(uint *param_1,uint param_2)
{
	int iVar1;
	float fVar2;
	float fVar3;
	uint uVar4;
	int in_x;
	LevelData *level;
	float *pfVar5;
	int iVar6;
	int iVar7;
	uint uVar8;
	uint uVar9;
	int iVar10;
	float *pfVar11;
	longlong lVar12;
	uint local_2c;
	uint local_10 [2];
	float *local_8 [2];
	
	level = lego::globals::g_Game.level;
	iVar10 = ((lego::globals::g_Game.level)->dimensions).height +
					 ((lego::globals::g_Game.level)->dimensions).width;
	local_10[0] = 0;
	local_10[1] = 0;
	uVar9 = 0;
	pfVar5 = (float *)std::malloc(iVar10 * 0x20);
	local_8[0] = pfVar5;
	if (pfVar5 != NULL) {
		local_8[1] = pfVar5 + iVar10 * 4;
		*pfVar5 = (float)ZEXT48(param_1);
		param_1 = local_10;
		local_10[0] = 1;
		iVar10 = 0;
		pfVar5[1] = (float)(ulonglong)param_2;
		do {
			local_2c = 0;
			if (*param_1 != 0) {
				pfVar11 = *(float **)((int)local_8 + iVar10);
				do {
					fVar2 = pfVar11[1];
					fVar3 = *pfVar11;
					lVar12 = __ftol((float10)fVar2);
					iVar10 = (int)lVar12 + -1;
					iVar6 = (int)lVar12 + 1;
					if (iVar10 <= iVar6) {
						lVar12 = __ftol((float10)fVar3);
						iVar1 = (int)lVar12 + -1;
						in_x = iVar1;
						do {
							for (; in_x <= (int)lVar12 + 1; in_x = in_x + 1) {
								if ((level->blocks[iVar10 * (level->dimensions).width + in_x].flags1 & BLOCK1_HIDDEN
										) != BLOCK1_NONE) {
									FUN_00430460(level,in_x,iVar10,1);
									iVar7 = iVar10 * (level->dimensions).width + in_x;
									level->blocks[iVar7].flags1 = level->blocks[iVar7].flags1 & ~BLOCK1_HIDDEN;
									if ((fVar3 != (float)in_x) || ((float)iVar10 != fVar2)) {
										uVar8 = (uint)(uVar9 == 0);
										uVar4 = local_10[uVar8];
										pfVar5 = local_8[uVar8];
										pfVar5[uVar4 * 2] = (float)in_x;
										local_10[uVar8] = uVar4 + 1;
										pfVar5[uVar4 * 2 + 1] = (float)iVar10;
									}
								}
							}
							iVar10 += 1;
							in_x = iVar1;
						} while (iVar10 <= iVar6);
					}
					local_2c += 1;
					pfVar11 = pfVar11 + 2;
					pfVar5 = local_8[0];
				} while (local_2c < *param_1);
			}
			uVar9 = (uint)(uVar9 == 0);
			*param_1 = 0;
			iVar10 = uVar9 * 4;
			param_1 = local_10 + uVar9;
		} while (local_10[uVar9] != 0);
		std::free(pfVar5);
	}
	return;
}



void __cdecl FUN_004316b0(uint param_1,uint param_2,int param_3,float param_4)
{
	LevelBlockFlags1 *pLVar1;
	LevelBlock *pLVar2;
	int iVar3;
	BOOL BVar4;
	float *pfVar5;
	bool bVar6;
	float10 fVar7;
	float10 extraout_ST0;
	longlong lVar8;
	longlong lVar9;
	float fVar10;
	float fVar11;
	float local_40;
	undefined4 uStack60;
	uint local_38;
	float local_34;
	undefined4 uStack48;
	Vector3F local_2c;
	float local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	uStack60 = 0;
	fVar7 = (float10)(ulonglong)param_2;
	uStack48 = 0;
	local_38 = 0;
	local_34 = (float)(ulonglong)param_1;
	pLVar2 = (lego::globals::g_Game.level)->blocks;
	iVar3 = ((lego::globals::g_Game.level)->dimensions).width;
	local_20[0] = 1.0;
	local_20[1] = 0.0;
	local_20[2] = 0.0;
	local_20[3] = 1.0;
	local_20[4] = -1.0;
	local_c = 0;
	local_8 = 0;
	local_4 = 0xbf800000;
	pfVar5 = local_20;
	local_40 = 5.605194e-45;
	do {
		*pfVar5 = local_34 + *pfVar5;
		fVar11 = pfVar5[1];
		pfVar5[1] = (float)(fVar7 + (float10)fVar11);
		lVar8 = __ftol(fVar7 + (float10)fVar11);
		lVar9 = __ftol((float10)*pfVar5);
		if ((*(byte *)&pLVar2[iVar3 * (int)lVar8 + (int)lVar9].flags1 & 8) != 0) {
			local_38 += 1;
		}
		pfVar5 = pfVar5 + 2;
		local_40 = (float)((int)local_40 + -1);
		fVar7 = extraout_ST0;
	} while (local_40 != 0.0);
	if (param_4 == 0.0) {
		FUN_0044f900((lego::globals::g_Game.level)->surfaceMap,param_1,param_2,&local_40,&param_4);
	}
	else {
		FUN_00450a90((uint *)(lego::globals::g_Game.level)->surfaceMap,param_1,param_2,&local_40,
								 &param_4,&local_34);
	}
	local_2c.y = param_4;
	local_2c.x = local_40;
	fVar7 = lego::game::SurfaceMap_UnkGetZ((lego::globals::g_Game.level)->surfaceMap,local_40,param_4)
	;
	local_2c.z = (float)fVar7;
	lego::res::Res_PlayResourceSound(NULL,4,0,0,&local_2c);
	bVar6 = 1 < local_38;
	local_20[0] = 0.0;
	local_20[1] = 1.0;
	local_20[2] = 1.0;
	local_20[3] = 0.0;
	local_20[4] = 0.0;
	local_c = 0xbf800000;
	local_8 = 0xbf800000;
	local_4 = 0;
	fVar11 = local_20[param_3 * 2 + 1];
	fVar10 = local_20[param_3 * 2];
	fVar7 = lego::game::SurfaceMap_UnkGetZ((lego::globals::g_Game.level)->surfaceMap,local_40,param_4)
	;
	BVar4 = FUN_0040c160((uint)bVar6,param_1,param_2,local_40,param_4,(float)fVar7,fVar10,fVar11);
	if (BVar4 != 0) {
		pLVar1 = &(lego::globals::g_Game.level)->blocks
							[((lego::globals::g_Game.level)->dimensions).width * param_2 + param_1].flags1;
		*pLVar1 = *pLVar1 | BLOCK1_UNK_800;
	}
	return;
}



uint __cdecl FUN_004318e0(int param_1,int param_2)
{
	return (uint)(lego::globals::g_Game.level)->blocks
							 [((lego::globals::g_Game.level)->dimensions).width * param_2 + param_1].terrain;
}



uint __cdecl lego::game::Map_GetCoordinate(uint in_sharedIndex,int x,int y)
{
	uint sharedIndex;
	void *pvVar1;
	int local_4;
	
	sharedIndex = in_sharedIndex;
	pvVar1 = lego::file::File_SharedGetData(in_sharedIndex);
	Map_GetDimensions(sharedIndex,(int *)&in_sharedIndex,&local_4);
	return (uint)*(ushort *)((int)pvVar1 + (in_sharedIndex * y + x) * 2 + 0x10);
}



undefined4 __cdecl FUN_00431960(uint param_1,uint param_2,int param_3)
{
	LiveObject *pLVar1;
	BOOL BVar2;
	uint local_8;
	uint local_4;
	
	pLVar1 = lego::game::Game_GetSelectedUnits((int *)&local_4);
	if ((pLVar1 != NULL) && (local_8 = 0, local_4 != 0)) {
		do {
			BVar2 = FUN_004326a0((LiveObject *)pLVar1->objType,param_1,param_2,param_3,1);
			if (BVar2 != 0) {
				return 1;
			}
			local_8 += 1;
			pLVar1 = (LiveObject *)&pLVar1->objIndex;
		} while (local_8 < local_4);
		return 0;
	}
	return 0;
}



undefined4 __cdecl FUN_004319e0(uint param_1,uint param_2)
{
	LiveObject *pLVar1;
	BOOL BVar2;
	uint uVar3;
	uint local_4;
	
	pLVar1 = lego::game::Game_GetSelectedUnits((int *)&local_4);
	if ((pLVar1 != NULL) && (uVar3 = 0, local_4 != 0)) {
		do {
			BVar2 = FUN_00432950((LiveObject *)pLVar1->objType,param_1,param_2);
			if (BVar2 != 0) {
				return 1;
			}
			uVar3 += 1;
			pLVar1 = (LiveObject *)&pLVar1->objIndex;
		} while (uVar3 < local_4);
		return 0;
	}
	return 0;
}



undefined4 __cdecl FUN_00431a50(int param_1,int param_2,int param_3,int param_4)
{
	LevelBlock *pLVar1;
	LevelBlockFlags1 LVar2;
	int iVar3;
	BOOL BVar4;
	uint uVar5;
	int *piVar6;
	uint uVar7;
	Point2I local_28;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_28.y = param_2;
	iVar3 = ((lego::globals::g_Game.level)->dimensions).width * param_2 + param_1;
	local_28.x = param_1;
	pLVar1 = (lego::globals::g_Game.level)->blocks + iVar3;
	if ((*(byte *)&(lego::globals::g_Game.level)->blocks[iVar3].flags2 & 0x20) == 0) {
		BVar4 = FUN_00408fd0(&local_28);
		if ((BVar4 == 0) && (LVar2 = pLVar1->flags1, (LVar2 & BLOCK1_POWERPATH) == BLOCK1_NONE)) {
			uVar7 = 0;
			if (((param_3 == 0) || ((param_4 == 0 || (pLVar1->terrain == TERRAIN_LAKE)))) &&
				 (((param_3 == 0 || ((LVar2 & BLOCK1_UNK_8000) == BLOCK1_NONE)) &&
					((((param_4 != 0 || (pLVar1->terrain != TERRAIN_LAKE)) &&
						(pLVar1->terrain != TERRAIN_LAVA)) &&
					 ((((LVar2 & BLOCK1_UNK_8) != BLOCK1_NONE && ((LVar2 & BLOCK1_UNK_200000) != BLOCK1_NONE))
						&& ((LVar2 & (BLOCK1_UNK_400|BLOCK1_UNK_8000|BLOCK1_UNK_100000)) == BLOCK1_NONE))))))))
			{
				uVar5 = FUN_0040e390(param_1,param_2);
				if (uVar5 == 0) {
					local_20[1] = 0xffffffff;
					local_8 = 0xffffffff;
					local_20[0] = 0;
					local_20[2] = 1;
					local_20[3] = 0;
					local_20[4] = 0;
					local_c = 1;
					local_4 = 0;
					piVar6 = local_20;
					while ((lego::globals::g_Game.level)->blocks
								 [(piVar6[1] + param_2) * ((lego::globals::g_Game.level)->dimensions).width +
									param_1 + *piVar6].terrain != TERRAIN_RECHARGESEAM) {
						uVar7 += 1;
						piVar6 = piVar6 + 2;
						if (3 < uVar7) {
							return 1;
						}
					}
				}
			}
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00431ba0(int *param_1,int *param_2,int *param_3,int param_4)
{
	LevelBlockFlags1 LVar1;
	bool bVar2;
	int iVar3;
	LevelData *pLVar4;
	uint uVar5;
	uint local_24;
	int local_20 [4];
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_20[1] = 0xffffffff;
	local_8 = 0xffffffff;
	DAT_004df588 += 1;
	local_20[0] = 0;
	local_20[2] = 1;
	local_20[3] = 0;
	local_10 = 0;
	local_c = 1;
	local_4 = 0;
	local_24 = 0;
	pLVar4 = lego::globals::g_Game.level;
	do {
		uVar5 = DAT_004df588 + local_24 & 3;
		if (param_4 == 0) {
LAB_00431c58:
			iVar3 = FUN_00431cd0((LiveObject *)param_1,local_20[uVar5 * 2] + *param_2,
													 local_20[uVar5 * 2 + 1] + param_2[1],local_20[uVar5 * 2] + *param_2,
													 local_20[uVar5 * 2 + 1] + param_2[1],0);
			pLVar4 = lego::globals::g_Game.level;
			if (iVar3 != 0) {
				iVar3 = local_20[uVar5 * 2 + 1];
				*param_3 = local_20[uVar5 * 2] + *param_2;
				param_3[1] = iVar3 + param_2[1];
				return 1;
			}
		}
		else {
			iVar3 = (pLVar4->dimensions).width;
			if (((((uint)(local_20[uVar5 * 2] + *param_2) < iVar3 - 1U) &&
					 ((uint)(local_20[uVar5 * 2 + 1] + param_2[1]) < (pLVar4->dimensions).height - 1U)) &&
					(LVar1 = pLVar4->blocks
									 [(local_20[uVar5 * 2 + 1] + param_2[1]) * iVar3 + local_20[uVar5 * 2] + *param_2]
									 .flags1, (LVar1 & BLOCK1_UNK_10) != BLOCK1_NONE)) &&
				 ((LVar1 & BLOCK1_UNK_8) == BLOCK1_NONE)) {
				bVar2 = true;
			}
			else {
				bVar2 = false;
			}
			if (!bVar2) goto LAB_00431c58;
		}
		local_24 += 1;
		if (3 < local_24) {
			return 0;
		}
	} while( true );
}



int __cdecl
FUN_00431cd0(LiveObject *in_liveObj,int param_2,int param_3,int param_4,int param_5,BOOL param_6)
{
	int iVar1;
	LevelBlockFlags1 LVar2;
	LevelBlock *pLVar3;
	LevelData *pLVar4;
	LiveObject *liveObj;
	int iVar5;
	ObjectStatsFlags1 OVar6;
	int *piVar7;
	BOOL BVar8;
	int iVar9;
	ObjectStatsFlags1 OVar10;
	LevelBlockFlags1 LVar11;
	ObjectStatsFlags2 local_40;
	ObjectStatsFlags1 local_3c;
	ObjectStatsFlags3 local_38;
	ObjectStatsFlags1 local_34;
	int local_30;
	int local_2c;
	LevelBlock *local_28;
	LevelBlock *local_24;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	iVar5 = param_3;
	liveObj = in_liveObj;
	pLVar4 = lego::globals::g_Game.level;
	iVar1 = ((lego::globals::g_Game.level)->dimensions).width;
	OVar10 = STATS1_NONE;
	local_3c = STATS1_SINGLEWIDTHDIG;
	local_40 = STATS2_NONE;
	local_38 = STATS3_NONE;
	local_28 = (lego::globals::g_Game.level)->blocks + param_3 * iVar1 + param_2;
	local_20[0] = 0;
	local_20[3] = 0;
	local_24 = (lego::globals::g_Game.level)->blocks + param_5 * iVar1 + param_4;
	param_3 = 1;
	local_20[1] = 0xffffffff;
	local_20[2] = 1;
	local_20[4] = 0;
	local_c = 1;
	local_8 = 0xffffffff;
	local_4 = 0;
	if (((in_liveObj != NULL) &&
			(OVar6 = lego::game::LiveObject_GetStatsFlags1(in_liveObj),
			(OVar6 & STATS1_CANBEDRIVEN) != STATS1_NONE)) && (in_liveObj->drivenObject == NULL)) {
		return 0;
	}
	in_liveObj = NULL;
	piVar7 = local_20 + 1;
	do {
		if ((piVar7[-1] + param_4 == param_2) && (param_5 + *piVar7 == iVar5)) break;
		piVar7 = piVar7 + 2;
		in_liveObj = (LiveObject *)((int)&in_liveObj->objType + 1);
	} while (in_liveObj < (LiveObject *)&DAT_00000004);
	if (liveObj == NULL) {
		local_34 = STATS1_NONE;
	}
	else {
		if (liveObj->objType == OBJECT_ELECTRICFENCE) {
			return 0;
		}
		local_38 = lego::game::LiveObject_GetStatsFlags3(liveObj);
		local_38 &= STATS3_ENTERTOOLSTORE;
		local_34 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		local_34 &= STATS1_SINGLEWIDTHDIG;
		OVar10 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		OVar10 &= STATS1_CROSSWATER;
		local_3c = lego::game::LiveObject_GetStatsFlags1(liveObj);
		local_3c &= STATS1_CROSSLAND;
		local_40 = lego::game::LiveObject_GetStatsFlags2(liveObj);
		local_40 &= STATS2_CROSSLAVA;
		if (((param_6 == 0) &&
				(BVar8 = lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_30,&local_2c), BVar8 != 0
				)) && ((param_2 == local_30 && (iVar5 == local_2c)))) {
			return 1;
		}
	}
	if (local_28->terrain == TERRAIN_LAKE) {
		if (OVar10 == STATS1_NONE) {
			return 0;
		}
		if (true) goto LAB_00431ea3;
	}
	if (local_3c == STATS1_NONE) {
		return 0;
	}
LAB_00431ea3:
	if (((local_28->terrain == TERRAIN_LAVA) && (local_40 == STATS2_NONE)) &&
		 ((local_28->flags1 & BLOCK1_UNK_200) == BLOCK1_NONE)) {
		return 0;
	}
	LVar2 = local_28->flags1;
	if ((LVar2 & BLOCK1_UNK_400) != BLOCK1_NONE) {
		return 0;
	}
	if ((param_6 != 0) && ((LVar2 & BLOCK1_UNK_40) != BLOCK1_NONE)) {
		return 0;
	}
	if ((local_38 == STATS3_NONE) && ((*(byte *)&local_28->flags2 & 4) != 0)) {
		return 0;
	}
	if (local_34 == STATS1_NONE) {
		if ((LVar2 & BLOCK1_UNK_8) == BLOCK1_NONE) {
			return 0;
		}
	}
	else {
		if ((LVar2 & BLOCK1_UNK_10) != BLOCK1_NONE) {
			param_3 = 3;
		}
		if (local_28->predug == PREDUG_WALL) {
			return 0;
		}
		iVar1 = (pLVar4->dimensions).width;
		pLVar3 = pLVar4->blocks;
		iVar9 = iVar5 * iVar1 + param_2;
		LVar11 = pLVar3[iVar9].flags1 & BLOCK1_UNK_10;
		if (LVar11 != BLOCK1_NONE) {
			if ((pLVar3 + iVar9)[-1].terrain == TERRAIN_LAVA) {
				return 0;
			}
			if (pLVar3[(iVar5 + -1) * iVar1 + param_2].terrain == TERRAIN_LAVA) {
				return 0;
			}
		}
		if (LVar11 != BLOCK1_NONE) {
			if ((pLVar3 + iVar9)[-1].terrain == TERRAIN_WATER_unused) {
				return 0;
			}
			if (pLVar3[(iVar5 + -1) * iVar1 + param_2].terrain == TERRAIN_WATER_unused) {
				return 0;
			}
		}
		if (in_liveObj == NULL) {
			if ((LVar2 & 0x2000) != BLOCK1_NONE) {
				param_3 = 2;
			}
			if ((local_24->flags1 & 0x2000) != BLOCK1_NONE) {
				param_3 = 2;
			}
		}
	}
	if ((param_4 != param_2) && (param_5 != iVar5)) {
		iVar1 = (pLVar4->dimensions).width;
		if (((*(byte *)&pLVar4->blocks[param_5 * iVar1 + param_2].flags1 & 8) != 0) &&
			 ((*(byte *)&pLVar4->blocks[iVar5 * iVar1 + param_4].flags1 & 8) != 0)) {
			return 2;
		}
	}
	return param_3;
}



void __cdecl FUN_00432030(int *param_1)
{
	LevelBlockFlags2 *pLVar1;
	LevelData *level;
	
	level = lego::globals::g_Game.level;
	pLVar1 = &(lego::globals::g_Game.level)->blocks
						[((lego::globals::g_Game.level)->dimensions).width * param_1[1] + *param_1].flags2;
	*pLVar1 = *pLVar1 | 0x100;
	lego::globals::g_Game.table200_78c[lego::globals::g_Game.count_dcc * 2] = *param_1;
	lego::globals::g_Game.table200_78c[lego::globals::g_Game.count_dcc * 2 + 1] = param_1[1];
	lego::globals::g_Game.count_dcc += 1;
	lego::game::Level_UpdateBlockSurfaceUnk(level,*param_1,param_1[1]);
	return;
}



uint __cdecl FUN_004320a0(int *param_1)
{
	return (lego::globals::g_Game.level)->blocks
				 [param_1[1] * ((lego::globals::g_Game.level)->dimensions).width + *param_1].flags2 & 0x100;
}



void FUN_004320d0(void)
{
	LevelData *level;
	uint uVar1;
	int *piVar2;
	
	level = lego::globals::g_Game.level;
	uVar1 = 0;
	if (lego::globals::g_Game.count_dd0 != 0) {
		piVar2 = lego::globals::g_Game.table200_aac;
		do {
			if ((*(byte *)((int)&level->blocks[(level->dimensions).width * piVar2[1] + *piVar2].flags2 + 1
										) & 1) == 0) {
				lego::game::Level_UpdateBlockSurfaceUnk(level,*piVar2,piVar2[1]);
			}
			uVar1 += 1;
			piVar2 = piVar2 + 2;
		} while (uVar1 < lego::globals::g_Game.count_dd0);
	}
	lego::globals::g_Game.count_dd0 = 0;
	return;
}



void FUN_00432130(void)
{
	int *piVar1;
	LevelBlockFlags2 *pLVar2;
	int iVar3;
	LevelData *pLVar4;
	int *piVar5;
	uint uVar6;
	
	pLVar4 = lego::globals::g_Game.level;
	uVar6 = 0;
	lego::globals::g_Game.count_dd0 = lego::globals::g_Game.count_dcc;
	if (lego::globals::g_Game.count_dcc != 0) {
		piVar5 = lego::globals::g_Game.table200_78c;
		do {
			piVar5[200] = *piVar5;
			piVar5[0xc9] = piVar5[1];
			piVar1 = piVar5 + 1;
			iVar3 = *piVar5;
			piVar5 = piVar5 + 2;
			pLVar2 = &pLVar4->blocks[*piVar1 * (pLVar4->dimensions).width + iVar3].flags2;
			uVar6 += 1;
			*pLVar2 = *pLVar2 & 0xfffffeff;
			lego::globals::g_Game.count_dd0 = lego::globals::g_Game.count_dcc;
		} while (uVar6 < lego::globals::g_Game.count_dcc);
	}
	lego::globals::g_Game.count_dcc = 0;
	return;
}



void __cdecl FUN_004321a0(int *param_1)
{
	LevelBlockFlags2 *pLVar1;
	
	pLVar1 = &(lego::globals::g_Game.level)->blocks
						[((lego::globals::g_Game.level)->dimensions).width * param_1[1] + *param_1].flags2;
	*pLVar1 = *pLVar1 | 2;
	lego::globals::g_Game.table200_468[lego::globals::g_Game.count_788 * 2] = *param_1;
	lego::globals::g_Game.table200_468[lego::globals::g_Game.count_788 * 2 + 1] = param_1[1];
	lego::globals::g_Game.count_788 = lego::globals::g_Game.count_788 + 1;
	return;
}



uint __cdecl FUN_00432200(int *param_1)
{
	return (lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * param_1[1] + *param_1].flags2 & 2;
}



void FUN_00432230(void)
{
	int *piVar1;
	LevelBlockFlags2 *pLVar2;
	int iVar3;
	LevelData *pLVar4;
	int *piVar5;
	uint uVar6;
	
	pLVar4 = lego::globals::g_Game.level;
	uVar6 = 0;
	if (lego::globals::g_Game.count_788 != 0) {
		piVar5 = lego::globals::g_Game.table200_468;
		do {
			piVar1 = piVar5 + 1;
			iVar3 = *piVar5;
			piVar5 = piVar5 + 2;
			pLVar2 = &pLVar4->blocks[*piVar1 * (pLVar4->dimensions).width + iVar3].flags2;
			uVar6 += 1;
			*pLVar2 = *pLVar2 & 0xfffffffd;
		} while (uVar6 < lego::globals::g_Game.count_788);
	}
	lego::globals::g_Game.count_788 = 0;
	return;
}



void __cdecl FUN_00432290(int **param_1)
{
	LevelBlockFlags1 *pLVar1;
	LevelBlockFlags2 *pLVar2;
	LevelData *level;
	
	level = lego::globals::g_Game.level;
	pLVar1 = &(lego::globals::g_Game.level)->blocks
						[(int)(((lego::globals::g_Game.level)->dimensions).width * (int)param_1[1] +
									(int)*param_1)].flags1;
	*pLVar1 = *pLVar1 & ~(BLOCK1_UNK_400|BLOCK1_UNK_8000|BLOCK1_UNK_100000|BLOCK1_POWERPATH);
	pLVar2 = &level->blocks[(int)((level->dimensions).width * (int)param_1[1] + (int)*param_1)].flags2
	;
	*pLVar2 = *pLVar2 & 0xfffffffb;
	lego::game::Level_UpdateBlockSurfaceUnk(level,(int)*param_1,(int)param_1[1]);
	return;
}



void __cdecl FUN_004322f0(int *param_1)
{
	LevelBlockFlags2 *pLVar1;
	
	pLVar1 = &(lego::globals::g_Game.level)->blocks
						[param_1[1] * ((lego::globals::g_Game.level)->dimensions).width + *param_1].flags2;
	*pLVar1 = *pLVar1 & 0xfffffffe;
	return;
}



void __cdecl FUN_00432320(int **param_1)
{
	LevelBlockFlags1 *pLVar1;
	LevelBlockFlags2 *pLVar2;
	LevelData *level;
	
	level = lego::globals::g_Game.level;
	pLVar1 = &(lego::globals::g_Game.level)->blocks
						[(int)(((lego::globals::g_Game.level)->dimensions).width * (int)param_1[1] +
									(int)*param_1)].flags1;
	*pLVar1 = *pLVar1 | (BLOCK1_UNK_8000|BLOCK1_UNK_100000);
	pLVar2 = &level->blocks[(int)((level->dimensions).width * (int)param_1[1] + (int)*param_1)].flags2
	;
	*pLVar2 = *pLVar2 | 4;
	lego::game::Level_UpdateBlockSurfaceUnk(level,(int)*param_1,(int)param_1[1]);
	return;
}



void __cdecl FUN_00432380(int *param_1,int *param_2)
{
	LevelBlockFlags1 *pLVar1;
	LevelData *level;
	
	level = lego::globals::g_Game.level;
	pLVar1 = &(lego::globals::g_Game.level)->blocks
						[(int)(((lego::globals::g_Game.level)->dimensions).width * (int)param_2 + (int)param_1)]
						.flags1;
	*pLVar1 = *pLVar1 | (BLOCK1_UNK_400|BLOCK1_UNK_100000);
	lego::game::Level_UpdateBlockSurfaceUnk(level,(int)param_1,(int)param_2);
	return;
}



void __cdecl FUN_004323c0(int *param_1,int *param_2)
{
	LevelBlockFlags1 *pLVar1;
	LevelData *level;
	
	level = lego::globals::g_Game.level;
	pLVar1 = &(lego::globals::g_Game.level)->blocks
						[(int)(((lego::globals::g_Game.level)->dimensions).width * (int)param_2 + (int)param_1)]
						.flags1;
	*pLVar1 = *pLVar1 | (BLOCK1_UNK_8000|BLOCK1_UNK_100000|BLOCK1_POWERPATH);
	lego::game::Level_UpdateBlockSurfaceUnk(level,(int)param_1,(int)param_2);
	return;
}



void __cdecl FUN_00432400(int x,int y,BOOL param_3)
{
	LevelBlockFlags2 *pLVar1;
	int iVar2;
	
	iVar2 = ((lego::globals::g_Game.level)->dimensions).width;
	if (param_3 != 0) {
		pLVar1 = &(lego::globals::g_Game.level)->blocks[iVar2 * y + x].flags2;
		*pLVar1 = *pLVar1 | 8;
		return;
	}
	iVar2 = iVar2 * y + x;
	(lego::globals::g_Game.level)->blocks[iVar2].flags2 =
			 (lego::globals::g_Game.level)->blocks[iVar2].flags2 & 0xfffffff7;
	return;
}



uint __cdecl FUN_00432450(int param_1,int param_2)
{
	return (lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * param_2 + param_1].flags2 & 8;
}



undefined4 __cdecl lego::util::return_1(undefined4 param_1)
{
	return 1;
}



void __cdecl FUN_00432490(Point2I *position,int param_2)
{
	int iVar1;
	LevelData *level;
	LevelBlockFlags1 *pLVar2;
	LevelBlockFlags1 LVar3;
	
	level = lego::globals::g_Game.level;
	iVar1 = ((lego::globals::g_Game.level)->dimensions).width;
	if (param_2 == 0) {
		pLVar2 = &(lego::globals::g_Game.level)->blocks[iVar1 * position->y + position->x].flags1;
		LVar3 = *pLVar2 & ~BLOCK1_UNK_40000000;
	}
	else {
		pLVar2 = &(lego::globals::g_Game.level)->blocks[iVar1 * position->y + position->x].flags1;
		LVar3 = *pLVar2 | BLOCK1_UNK_40000000;
	}
	*pLVar2 = LVar3;
	lego::game::Level_UpdateBlockSurfaceUnk(level,position->x,position->y);
	return;
}



void __cdecl FUN_00432500(int *param_1)
{
	LevelBlockFlags2 *pLVar1;
	
	pLVar1 = &(lego::globals::g_Game.level)->blocks
						[param_1[1] * ((lego::globals::g_Game.level)->dimensions).width + *param_1].flags2;
	*pLVar1 = *pLVar1 | 1;
	return;
}



undefined4 __cdecl FUN_00432530(Point2I *param_1)
{
	LevelBlock *pLVar1;
	LevelBlockFlags1 LVar2;
	LevelData *level;
	int iVar3;
	int iVar4;
	int *piVar5;
	int local_28 [5];
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	level = lego::globals::g_Game.level;
	iVar3 = ((lego::globals::g_Game.level)->dimensions).width * param_1->y + param_1->x;
	pLVar1 = (lego::globals::g_Game.level)->blocks + iVar3;
	LVar2 = (lego::globals::g_Game.level)->blocks[iVar3].flags1;
	if (((LVar2 & BLOCK1_UNK_200000) != BLOCK1_NONE) && (pLVar1->terrain != TERRAIN_LAVA)) {
		local_28[0] = 0;
		local_28[1] = 0;
		local_28[2] = 0;
		local_28[3] = 0xffffffff;
		local_28[4] = 1;
		local_14 = 0;
		local_10 = 0;
		local_c = 1;
		local_8 = 0xffffffff;
		local_4 = 0;
		if ((LVar2 & BLOCK1_UNK_80000000) == BLOCK1_NONE) {
			pLVar1->flags1 = LVar2 | BLOCK1_POWERPATH;
		}
		else {
			FUN_0040ed80(param_1,0);
			level->blocks[(level->dimensions).width * param_1->y + param_1->x].field_7 = 0;
		}
		iVar3 = (level->dimensions).width * param_1->y + param_1->x;
		piVar5 = local_28;
		iVar4 = 5;
		level->blocks[iVar3].flags1 = level->blocks[iVar3].flags1 & ~BLOCK1_UNK_40000000;
		do {
			lego::game::Level_UpdateBlockSurfaceUnk(level,param_1->x + *piVar5,piVar5[1] + param_1->y);
			piVar5 = piVar5 + 2;
			iVar4 += -1;
		} while (iVar4 != 0);
		FUN_00439c50();
		return 1;
	}
	return 0;
}



void __cdecl FUN_00432640(int *param_1,int param_2)
{
	LevelBlockFlags1 *pLVar1;
	int iVar2;
	
	iVar2 = ((lego::globals::g_Game.level)->dimensions).width;
	if (param_2 != 0) {
		pLVar1 = &(lego::globals::g_Game.level)->blocks[iVar2 * param_1[1] + *param_1].flags1;
		*pLVar1 = *pLVar1 | BLOCK1_UNK_80000;
		return;
	}
	iVar2 = iVar2 * param_1[1] + *param_1;
	(lego::globals::g_Game.level)->blocks[iVar2].flags1 =
			 (lego::globals::g_Game.level)->blocks[iVar2].flags1 & ~BLOCK1_UNK_80000;
	return;
}



BOOL __cdecl FUN_004326a0(LiveObject *liveObj,uint x,uint y,BOOL param_4,BOOL param_5)
{
	LevelBlock *pLVar1;
	TerrainType TVar2;
	int iVar3;
	LevelData *pLVar4;
	ObjectStatsFlags1 OVar5;
	int *piVar6;
	uint uVar7;
	float10 fVar8;
	int local_40 [5];
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	pLVar4 = lego::globals::g_Game.level;
	pLVar1 = (lego::globals::g_Game.level)->blocks +
					 y * ((lego::globals::g_Game.level)->dimensions).width + x;
	OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if (((OVar5 & STATS1_CANBEDRIVEN) == STATS1_NONE) || (liveObj->drivenObject != NULL)) {
		if ((param_4 != 0) &&
			 (OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj),
			 (OVar5 & STATS1_SINGLEWIDTHDIG) == STATS1_NONE)) {
			return 0;
		}
		if (((((param_5 == 0) || ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE)) &&
				 ((*(byte *)&liveObj->flags3_3e8 & 2) != 0)) &&
				((fVar8 = lego::game::LiveObject_GetDrillTimeType(liveObj,(uint)pLVar1->terrain),
				 fVar8 != (float10)0.0 && (iVar3 = (pLVar4->dimensions).width, x < iVar3 - 2U)))) &&
			 (y < (pLVar4->dimensions).height - 2U)) {
			uVar7 = 0;
			if (param_4 == 0) {
				if ((((pLVar1->flags1 & BLOCK1_UNK_10) != BLOCK1_NONE) &&
						((pLVar1->flags1 & BLOCK1_UNK_40) == BLOCK1_NONE)) &&
					 ((TVar2 = pLVar1->terrain, TVar2 != TERRAIN_IMMOVABLE &&
						((TVar2 != TERRAIN_WATER_unused && (TVar2 != TERRAIN_RECHARGESEAM)))))) {
					return 1;
				}
			}
			else {
				if (pLVar1->predug == PREDUG_WALL) {
					local_40[2] = 1;
					local_2c = 1;
					local_20[0] = -1;
					local_20[1] = 0xffffffff;
					local_20[2] = 0;
					local_20[3] = 0xffffffff;
					local_20[4] = 0;
					local_c = 0;
					local_8 = 0xffffffff;
					local_4 = 0;
					local_40[0] = 0;
					local_40[1] = 0xffffffff;
					local_40[3] = 0;
					local_40[4] = 0;
					local_28 = 0xffffffff;
					local_24 = 0;
					piVar6 = local_40;
					do {
						if (pLVar4->blocks[(piVar6[1] + y) * iVar3 + x + *piVar6].predug != PREDUG_WALL) break;
						uVar7 += 1;
						piVar6 = piVar6 + 2;
					} while (uVar7 < 4);
					if (uVar7 < 4) {
						uVar7 = 0;
						piVar6 = local_20;
						do {
							TVar2 = pLVar4->blocks[(piVar6[1] + y) * iVar3 + x + *piVar6].terrain;
							if ((TVar2 != TERRAIN_IMMOVABLE) && (TVar2 != TERRAIN_WATER_unused)) break;
							uVar7 += 1;
							piVar6 = piVar6 + 2;
						} while (uVar7 < 4);
						if (uVar7 < 4) {
							return 1;
						}
					}
				}
			}
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00432880(int param_1,uint param_2,uint param_3)
{
	TerrainType TVar1;
	LevelBlockFlags1 LVar2;
	int iVar3;
	
	if (((((*(uint *)(param_1 + 1000) & 0x8000) != 0) && (param_2 != 0)) && (param_3 != 0)) &&
		 ((iVar3 = ((lego::globals::g_Game.level)->dimensions).width, param_2 < iVar3 - 2U &&
			(param_3 < ((lego::globals::g_Game.level)->dimensions).height - 2U)))) {
		iVar3 = param_3 * iVar3 + param_2;
		LVar2 = (lego::globals::g_Game.level)->blocks[iVar3].flags1;
		if (((((LVar2 & BLOCK1_UNK_10) != BLOCK1_NONE) &&
				 (((LVar2 & BLOCK1_UNK_40) == BLOCK1_NONE &&
					(TVar1 = (lego::globals::g_Game.level)->blocks[iVar3].terrain, TVar1 != TERRAIN_IMMOVABLE)
					))) && (TVar1 != TERRAIN_RECHARGESEAM)) && (TVar1 != TERRAIN_WATER_unused)) {
			return 1;
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00432900(undefined4 param_1,uint param_2,uint param_3)
{
	LevelData *pLVar1;
	uint uVar2;
	
	pLVar1 = lego::globals::g_Game.level;
	uVar2 = FUN_00450580((lego::globals::g_Game.level)->surfaceMap,param_2,param_3);
	if ((uVar2 != 0) &&
		 ((*(byte *)&pLVar1->blocks[(pLVar1->dimensions).width * param_3 + param_2].flags1 & 8) != 0)) {
		return 1;
	}
	return 0;
}



BOOL __cdecl FUN_00432950(LiveObject *liveObj,uint x,uint y)
{
	TerrainType TVar1;
	int iVar2;
	LevelBlockFlags1 LVar3;
	
	if (((((liveObj == NULL) || ((*(byte *)&liveObj->flags3_3e8 & 4) != 0)) && (x != 0)) &&
			((y != 0 && (iVar2 = ((lego::globals::g_Game.level)->dimensions).width, x < iVar2 - 2U)))) &&
		 (y < ((lego::globals::g_Game.level)->dimensions).height - 2U)) {
		LVar3 = (lego::globals::g_Game.level)->blocks[y * iVar2 + x].flags1;
		if ((((LVar3 & BLOCK1_UNK_10) != BLOCK1_NONE) && ((LVar3 & BLOCK1_REINFORCED) == BLOCK1_NONE))
			 && ((TVar1 = (lego::globals::g_Game.level)->blocks[y * iVar2 + x].terrain,
					 TVar1 != TERRAIN_RECHARGESEAM &&
					 ((TVar1 != TERRAIN_ORESEAM && (TVar1 != TERRAIN_CRYSTALSEAM)))))) {
			return 1;
		}
	}
	return 0;
}



BOOL __cdecl FUN_004329d0(int x,int y,BOOL param_3)
{
	int iVar1;
	
	iVar1 = ((lego::globals::g_Game.level)->dimensions).width;
	if (param_3 == 0) {
		return (lego::globals::g_Game.level)->blocks[iVar1 * y + x].flags1 & BLOCK1_UNK_400;
	}
	if ((((lego::globals::g_Game.level)->blocks[iVar1 * y + x].flags1 & BLOCK1_UNK_400) == BLOCK1_NONE
			) && ((*(byte *)&(lego::globals::g_Game.level)->blocks[iVar1 * y + x].flags2 & 4) == 0)) {
		return BLOCK1_NONE;
	}
	return BLOCK1_RUBBLE_LOW;
}



uint __cdecl FUN_00432a30(uint param_1,uint param_2)
{
	int iVar1;
	
	iVar1 = ((lego::globals::g_Game.level)->dimensions).width;
	if ((param_1 < iVar1 - 1U) && (param_2 < ((lego::globals::g_Game.level)->dimensions).height - 1U))
	{
		return (lego::globals::g_Game.level)->blocks[param_2 * iVar1 + param_1].flags1 & BLOCK1_UNK_800;
	}
	return BLOCK1_NONE;
}



BOOL __cdecl lego::game::Level_GetBlockFlags1_8(uint x,uint y)
{
	int iVar1;
	
	iVar1 = ((globals::g_Game.level)->dimensions).width;
	if ((x < iVar1 - 1U) && (y < ((globals::g_Game.level)->dimensions).height - 1U)) {
		return (globals::g_Game.level)->blocks[y * iVar1 + x].flags1 & BLOCK1_UNK_8;
	}
	return BLOCK1_NONE;
}



undefined4 __cdecl FUN_00432ac0(int param_1,int param_2)
{
	TerrainType TVar1;
	
	TVar1 = (lego::globals::g_Game.level)->blocks
					[((lego::globals::g_Game.level)->dimensions).width * param_2 + param_1].terrain;
	if (((TVar1 != TERRAIN_ORESEAM) && (TVar1 != TERRAIN_CRYSTALSEAM)) &&
		 (TVar1 != TERRAIN_RECHARGESEAM)) {
		return 0;
	}
	return 1;
}



BOOL __cdecl lego::game::Level_GetBlockFlags1_10Not8(uint x,uint y)
{
	int iVar1;
	LevelBlockFlags1 LVar2;
	
	iVar1 = ((globals::g_Game.level)->dimensions).width;
	if ((((x < iVar1 - 1U) && (y < ((globals::g_Game.level)->dimensions).height - 1U)) &&
			(LVar2 = (globals::g_Game.level)->blocks[y * iVar1 + x].flags1,
			(LVar2 & BLOCK1_UNK_10) != BLOCK1_NONE)) && ((LVar2 & BLOCK1_UNK_8) == BLOCK1_NONE)) {
		return 1;
	}
	return 0;
}



uint __cdecl FUN_00432b50(int param_1,int param_2)
{
	return (lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * param_2 + param_1].flags1 & 0x40000;
}



int __cdecl lego::game::Level_GetBlockRubbleLevel_OrFlag200000(Point2I *position)
{
	LevelBlockFlags1 LVar1;
	
	LVar1 = (globals::g_Game.level)->blocks
					[((globals::g_Game.level)->dimensions).width * position->y + position->x].flags1;
	if ((LVar1 & BLOCK1_UNK_200000) != BLOCK1_NONE) {
		return 0;
	}
	return (LVar1 & BLOCK1_RUBBLE_FULL) + BLOCK1_RUBBLE_LOW;
}



uint __cdecl FUN_00432bc0(Point2I *param_1)
{
	LevelBlock *pLVar1;
	LevelBlockFlags1 LVar2;
	LevelData *level;
	int iVar3;
	LevelBlockFlags1 LVar4;
	uint uVar5;
	float10 fVar6;
	float local_18;
	float local_14;
	float local_10;
	Vector3F local_c;
	
	level = lego::globals::g_Game.level;
	uVar5 = 1;
	iVar3 = ((lego::globals::g_Game.level)->dimensions).width * param_1->y + param_1->x;
	pLVar1 = (lego::globals::g_Game.level)->blocks + iVar3;
	LVar2 = (lego::globals::g_Game.level)->blocks[iVar3].flags1;
	LVar4 = LVar2 & BLOCK1_RUBBLE_FULL;
	if ((LVar2 & BLOCK1_UNK_200000) == BLOCK1_NONE) {
		if (LVar4 != BLOCK1_NONE) {
			pLVar1->flags1 = (LVar4 + ~BLOCK1_NONE ^ LVar2) & BLOCK1_RUBBLE_FULL ^ LVar2;
		}
		else {
			pLVar1->flags1 = LVar2 | BLOCK1_UNK_200000;
			FUN_00419820(param_1);
			FUN_0041cf10(param_1);
			FUN_00402a90(param_1,0);
			FUN_0044f900(level->surfaceMap,param_1->x,param_1->y,&local_18,&local_14);
			fVar6 = lego::game::SurfaceMap_UnkGetZ(level->surfaceMap,local_18,local_14);
			local_10 = (float)fVar6;
			lego::math::Vector3_Random(&local_c);
			local_c.z = 0.0;
			FUN_0040cc10(3,&local_18,(undefined4 *)&local_c);
		}
		uVar5 = (uint)(LVar4 == BLOCK1_NONE);
		lego::game::Level_UpdateBlockSurfaceUnk(level,param_1->x,param_1->y);
	}
	return uVar5;
}



BOOL __cdecl lego::game::Level_GetBlockFlags1_20(uint x,uint y)
{
	int iVar1;
	
	iVar1 = ((globals::g_Game.level)->dimensions).width;
	if ((x < iVar1 - 1U) && (y < ((globals::g_Game.level)->dimensions).height - 1U)) {
		return (globals::g_Game.level)->blocks[y * iVar1 + x].flags1 & BLOCK1_REINFORCED;
	}
	return BLOCK1_NONE;
}



uint __cdecl lego::game::Level_GetBlockFlags1_8000000(Point2I *position)
{
	return (globals::g_Game.level)->blocks
				 [position->y * ((globals::g_Game.level)->dimensions).width + position->x].flags1 &
				 BLOCK1_UNK_8000000;
}



void __cdecl lego::game::Level_SetBlockFlags1_8000000(Point2I *position,BOOL state)
{
	LevelBlockFlags1 *pLVar1;
	int iVar2;
	
	iVar2 = ((globals::g_Game.level)->dimensions).width;
	if (state != 0) {
		pLVar1 = &(globals::g_Game.level)->blocks[iVar2 * position->y + position->x].flags1;
		*pLVar1 = *pLVar1 | BLOCK1_UNK_8000000;
		return;
	}
	iVar2 = iVar2 * position->y + position->x;
	(globals::g_Game.level)->blocks[iVar2].flags1 =
			 (globals::g_Game.level)->blocks[iVar2].flags1 & ~BLOCK1_UNK_8000000;
	return;
}



BOOL __cdecl lego::game::Level_GetBlockFlags1_c0(int x,int y)
{
	if ((*(byte *)&(globals::g_Game.level)->blocks
								 [((globals::g_Game.level)->dimensions).width * y + x].flags1 & 0xc0) == 0) {
		return 0;
	}
	return 1;
}



BOOL __cdecl lego::game::Level_IsBlockExposed(Point2I *position)
{
	return (globals::g_Game.level)->blocks
				 [((globals::g_Game.level)->dimensions).width * position->y + position->x].flags1 &
				 BLOCK1_EXPOSED;
}



uint __cdecl lego::game::Level_IsBlockSolid(Point2I *position)
{
	return (uint)((globals::g_Game.level)->blocks
								[((globals::g_Game.level)->dimensions).width * position->y + position->x].terrain ==
							 TERRAIN_IMMOVABLE);
}



uint __cdecl lego::game::Level_IsBlockLava(Point2I *position)
{
	return (uint)((globals::g_Game.level)->blocks
								[position->y * ((globals::g_Game.level)->dimensions).width + position->x].terrain ==
							 TERRAIN_LAVA);
}



BOOL __cdecl FUN_00432e70(uint x,uint y)
{
	int iVar1;
	
	iVar1 = ((lego::globals::g_Game.level)->dimensions).width;
	if ((x < iVar1 - 1U) && (y < ((lego::globals::g_Game.level)->dimensions).height - 1U)) {
		return (uint)(((lego::globals::g_Game.level)->blocks[y * iVar1 + x].flags1 &
									(BLOCK1_UNK_8|BLOCK1_UNK_10)) == BLOCK1_NONE);
	}
	return 1;
}



BOOL __cdecl FUN_00432ec0(uint x,uint y)
{
	int iVar1;
	
	iVar1 = ((lego::globals::g_Game.level)->dimensions).width;
	if ((x < iVar1 - 1U) && (y < ((lego::globals::g_Game.level)->dimensions).height - 1U)) {
		return (lego::globals::g_Game.level)->blocks[y * iVar1 + x].flags1 & 4;
	}
	return BLOCK1_NONE;
}



uint __cdecl FUN_00432f00(int param_1,int param_2)
{
	return (lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * param_2 + param_1].flags1 & 0x2000;
}



uint __cdecl FUN_00432f30(int param_1,int param_2)
{
	return (lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * param_2 + param_1].flags1 &
				 BLOCK1_UNK_80;
}



uint __cdecl FUN_00432f60(int *param_1)
{
	return (lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * param_1[1] + *param_1].flags1 &
				 BLOCK1_UNK_8000;
}



uint __cdecl FUN_00432f90(int *param_1)
{
	return (lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * param_1[1] + *param_1].flags2 & 1;
}



BOOL __cdecl lego::game::Level_IsBlockPowerPath(Point2I *position)
{
	int iVar1;
	int iVar2;
	int iVar3;
	
	iVar1 = position->x;
	if ((((-1 < iVar1) && (iVar2 = position->y, -1 < iVar2)) &&
			(iVar3 = ((globals::g_Game.level)->dimensions).width, iVar1 < iVar3)) &&
		 (iVar2 < ((globals::g_Game.level)->dimensions).height)) {
		return (globals::g_Game.level)->blocks[iVar3 * iVar2 + iVar1].flags1 & BLOCK1_POWERPATH;
	}
	return BLOCK1_NONE;
}



BOOL __cdecl lego::game::Level_GetBlockFlags1_180000(Point2I *position)
{
	if (((globals::g_Game.level)->blocks
			 [position->y * ((globals::g_Game.level)->dimensions).width + position->x].flags1 &
			(BLOCK1_UNK_80000|BLOCK1_UNK_100000)) == BLOCK1_NONE) {
		return 0;
	}
	return 1;
}



void __cdecl FUN_00433050(int *param_1,int param_2)
{
	LevelBlockFlags1 *pLVar1;
	int iVar2;
	
	if (param_2 != 0) {
		pLVar1 = &(lego::globals::g_Game.level)->blocks
							[param_1[1] * ((lego::globals::g_Game.level)->dimensions).width + *param_1].flags1;
		*pLVar1 = *pLVar1 | 0x10000000;
		return;
	}
	iVar2 = param_1[1] * ((lego::globals::g_Game.level)->dimensions).width + *param_1;
	(lego::globals::g_Game.level)->blocks[iVar2].flags1 =
			 (lego::globals::g_Game.level)->blocks[iVar2].flags1 & 0xefffffff;
	return;
}



BOOL __cdecl FUN_004330b0(LiveObject *liveObj,int x,int y,float param_4,float *optout_value)
{
	ObjectType OVar1;
	LevelData *pLVar2;
	ObjectStatsFlags1 OVar3;
	ObjectStatsFlags2 OVar4;
	uint weaponType;
	float10 fVar5;
	
	pLVar2 = lego::globals::g_Game.level;
	OVar1 = liveObj->objType;
	if ((((((OVar1 != OBJECT_POWERCRYSTAL) && (OVar1 != OBJECT_ORE)) && (OVar1 != OBJECT_BOULDER)) &&
			 ((OVar1 != OBJECT_DYNAMITE && (OVar1 != OBJECT_ELECTRICFENCE)))) &&
			(((OVar1 != OBJECT_SONICBLASTER &&
				((OVar1 != OBJECT_ELECTRICFENCESTUD && (OVar1 != OBJECT_PATH)))) && (OVar1 != OBJECT_PUSHER)
			 ))) && (((OVar1 != OBJECT_FREEZER && (OVar1 != OBJECT_ICECUBE)) &&
							 (OVar1 != OBJECT_LASERSHOT)))) {
		if ((liveObj->drivenObject != NULL) &&
			 (OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj),
			 (OVar3 & STATS1_CANBEDRIVEN) == STATS1_NONE)) {
			return 0;
		}
		if (((pLVar2->blocks[y * (pLVar2->dimensions).width + x].terrain == TERRAIN_LAVA) &&
				((pLVar2->blocks[y * (pLVar2->dimensions).width + x].flags1 & BLOCK1_UNK_200) == BLOCK1_NONE
				)) && (OVar4 = lego::game::LiveObject_GetStatsFlags2(liveObj),
							(OVar4 & STATS2_CROSSLAVA) == STATS2_NONE)) {
			if (optout_value == NULL) {
				return 1;
			}
			*optout_value = param_4;
			return 1;
		}
		if ((pLVar2->blocks[y * (pLVar2->dimensions).width + x].flags1 & BLOCK1_UNK_1000) != BLOCK1_NONE
			 ) {
			if (optout_value != NULL) {
				weaponType = lego::game::Game_GetWeaponType("RockFallIn");
				fVar5 = lego::game::Weapon_GetWeaponFloat12c4(weaponType,liveObj);
				*optout_value = (float)(fVar5 * (float10)param_4);
			}
			return 1;
		}
	}
	return 0;
}



uint __cdecl FUN_004331f0(int param_1,int param_2)
{
	return (uint)(lego::globals::g_Game.level)->blocks
							 [((lego::globals::g_Game.level)->dimensions).width * param_2 + param_1].field_3;
}



void __cdecl FUN_00433220(uint param_1,uint param_2)
{
	int iVar1;
	
	iVar1 = ((lego::globals::g_Game.level)->dimensions).width;
	if ((param_1 < iVar1 - 1U) && (param_2 < ((lego::globals::g_Game.level)->dimensions).height - 1U))
	{
		iVar1 = param_2 * iVar1 + param_1;
		(lego::globals::g_Game.level)->blocks[iVar1].flags1 =
				 (lego::globals::g_Game.level)->blocks[iVar1].flags1 | 4;
	}
	return;
}



undefined4 __cdecl FUN_00433260(uint param_1,uint param_2,uint *param_3)
{
	int iVar1;
	
	iVar1 = ((lego::globals::g_Game.level)->dimensions).width;
	if ((param_1 < iVar1 - 1U) && (param_2 < ((lego::globals::g_Game.level)->dimensions).height - 1U))
	{
		*param_3 = (uint)(lego::globals::g_Game.level)->blocks[param_2 * iVar1 + param_1].terrain;
		return 1;
	}
	return 0;
}



void __cdecl FUN_004332b0(LevelData *level,uint x,uint y)
{
	int iVar1;
	LevelBlock *pLVar2;
	LevelBlockFlags1 LVar3;
	float fVar4;
	int iVar5;
	undefined4 local_30 [2];
	float local_28;
	undefined4 local_24 [2];
	float local_1c;
	undefined4 local_18 [2];
	float local_10;
	undefined4 local_c [2];
	float local_4;
	
	if ((x < (level->dimensions).width - 1U) && (y < (level->dimensions).height - 1U)) {
		FUN_00450390(level->surfaceMap,x,y,local_30);
		iVar1 = (level->dimensions).width;
		pLVar2 = level->blocks;
		iVar5 = y * iVar1 + x;
		LVar3 = pLVar2[iVar5].flags1;
		if ((LVar3 & BLOCK1_UNK_8) == BLOCK1_NONE) {
			if ((LVar3 & BLOCK1_UNK_10) == BLOCK1_NONE) {
				return;
			}
			if (pLVar2[iVar5].predug == PREDUG_EXPOSED) {
				local_28 = local_28 - (level->DigDepth + level->RoofHeight);
			}
			if (pLVar2[iVar5 + 1].predug == PREDUG_EXPOSED) {
				local_1c = local_1c - (level->DigDepth + level->RoofHeight);
			}
			iVar1 = (y + 1) * iVar1 + x;
			if (pLVar2[iVar1 + 1].predug == PREDUG_EXPOSED) {
				local_10 = local_10 - (level->DigDepth + level->RoofHeight);
			}
			if (pLVar2[iVar1].predug == PREDUG_EXPOSED) {
				local_4 = local_4 - (level->DigDepth + level->RoofHeight);
			}
		}
		else {
			fVar4 = level->DigDepth + level->RoofHeight;
			local_28 = local_28 - fVar4;
			local_1c = local_1c - fVar4;
			local_10 = local_10 - fVar4;
			local_4 = local_4 - fVar4;
		}
		FUN_004631e0(x,y,local_30,local_24,local_18,local_c);
	}
	return;
}



void __cdecl lego::game::Map_GetDimensions(uint sharedIndex,int *out_width,int *out_height)
{
	void *pvVar1;
	
	pvVar1 = lego::file::File_SharedGetData(sharedIndex);
	*out_width = *(int *)((int)pvVar1 + 8);
	*out_height = *(int *)((int)pvVar1 + 0xc);
	return;
}



BOOL __cdecl lego::main::Main_Load_GraphicsSettings(void)
{
	char *pcVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	uint uVar5;
	uint uVar6;
	uint uVar7;
	uint uVar8;
	GraphicsQuality quality;
	float10 fVar9;
	
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","fpclipblocks",0);
	pcVar1 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
	if (pcVar1 == NULL) {
		pcVar1 = ____EMPTYSTR__;
	}
	else {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","fpclipblocks",0);
		pcVar1 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
	}
	fVar9 = std::atof(pcVar1);
	globals::g_Game.FPClipBlocks = (float)fVar9;
	if ((float10)0.0 != fVar9) {
		pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","quality",0);
		pcVar1 = cfg::CFG_GetPropertyValue(globals::g_Game.LegoCfgRoot,pcVar1);
		if (pcVar1 != NULL) {
			iVar2 = std::_stricmp("gouraud",pcVar1);
			if (iVar2 == 0) {
				quality = QUALITY_GOURAUD;
			}
			else {
				iVar2 = std::_stricmp("flat",pcVar1);
				if (iVar2 == 0) {
					quality = QUALITY_FLAT;
				}
				else {
					iVar2 = std::_stricmp("wireframe",pcVar1);
					if (iVar2 != 0) {
						return 0;
					}
					quality = QUALITY_WIREFRAME;
				}
			}
			globals::g_Game.Quality = quality;
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","dither",0);
			uVar3 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,pcVar1);
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","filter",0);
			uVar4 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,pcVar1);
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","blend",0);
			uVar5 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,pcVar1);
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","sort",0);
			uVar6 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,pcVar1);
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","mipmap",0);
			uVar7 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,pcVar1);
			pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","linearmipmap",0);
			uVar8 = cfg::CFG_GetPropertyBool(globals::g_Game.LegoCfgRoot,pcVar1);
			draw::Draw_SetDirectXGraphicsQuality
								(quality,(uint)(uVar3 == 1),(uint)(uVar4 == 1),(uint)(uVar7 == 1),(uint)(uVar8 == 1)
								 ,(uint)(uVar5 == 1),(uint)(uVar6 == 1));
			return 1;
		}
	}
	return 0;
}



BOOL __cdecl lego::main::Main_LoadLighting(void)
{
	char *pcVar1;
	BOOL BVar2;
	ResourceData *pRVar3;
	float *pfVar4;
	float *pfVar5;
	float *pfVar6;
	float local_c;
	float local_8;
	float local_4;
	
	pfVar5 = &local_c;
	pfVar6 = &local_8;
	pfVar4 = &local_4;
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","topspotrgb",0);
	BVar2 = cfg::CFG_GetPropertyRGBF(globals::g_Game.LegoCfgRoot,pcVar1,pfVar4,pfVar6,pfVar5);
	if (BVar2 == 0) {
		return 0;
	}
	globals::g_Game.struct2c_30 =
			 res::Res_CreateLight
								 ((globals::g_Game.structbc_24)->resData_2c,D3DRMLIGHT_SPOT,local_4,local_8,local_c)
	;
	if (globals::g_Game.struct2c_30 == NULL) {
		return 0;
	}
	res::Res_SetLightPenumbra(globals::g_Game.struct2c_30,0.85);
	res::Res_SetLightUmbra(globals::g_Game.struct2c_30,0.4);
	res::Res_SetFramePosition
						(globals::g_Game.struct2c_30,(globals::g_Game.structbc_24)->resData_2c,200.0,140.0,
						 -130.0);
	res::Res_SetFrameOrientation
						(globals::g_Game.struct2c_30,(globals::g_Game.structbc_24)->resData_2c,-1.0,-0.8,0.75,
						 0.0,1.0,0.0);
	pfVar5 = &local_c;
	pfVar6 = &local_8;
	pfVar4 = &local_4;
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","trackspotrgb",0);
	BVar2 = cfg::CFG_GetPropertyRGBF(globals::g_Game.LegoCfgRoot,pcVar1,pfVar4,pfVar6,pfVar5);
	if (BVar2 == 0) {
		return 0;
	}
	globals::g_Game.struct2c_34 =
			 res::Res_CreateLight
								 ((globals::g_Game.structbc_28)->resData_28,D3DRMLIGHT_SPOT,local_4,local_8,local_c)
	;
	if (globals::g_Game.struct2c_34 == NULL) {
		return 0;
	}
	res::Res_SetFramePosition(globals::g_Game.struct2c_34,NULL,0.0,0.0,-150.0);
	res::Res_SetFrameOrientation(globals::g_Game.struct2c_34,NULL,0.0,0.0,1.0,0.0,1.0,0.0);
	pfVar5 = &local_c;
	pfVar6 = &local_8;
	pfVar4 = &local_4;
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","ambientrgb",0);
	BVar2 = cfg::CFG_GetPropertyRGBF(globals::g_Game.LegoCfgRoot,pcVar1,pfVar4,pfVar6,pfVar5);
	if (BVar2 == 0) {
		return 0;
	}
	globals::g_Game.struct2c_40 =
			 res::Res_CreateLight(globals::g_Game.resRoot,D3DRMLIGHT_AMBIENT,local_4,local_8,local_c);
	pfVar6 = &local_c;
	if (globals::g_Game.struct2c_40 == NULL) {
		return 0;
	}
	pfVar4 = &local_8;
	pfVar5 = &local_4;
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","fplightrgb",0);
	BVar2 = cfg::CFG_GetPropertyRGBF(globals::g_Game.LegoCfgRoot,pcVar1,pfVar5,pfVar4,pfVar6);
	if (BVar2 == 0) {
		return 0;
	}
	globals::g_Game.struct2c_38 =
			 res::Res_CreateLight
								 ((globals::g_Game.structbc_2c)->resData_24,D3DRMLIGHT_POINT,local_4,local_8,local_c
								 );
	pfVar6 = &local_c;
	if (globals::g_Game.struct2c_38 == NULL) {
		return 0;
	}
	pfVar4 = &local_8;
	pfVar5 = &local_4;
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","fprotlightrgb",0);
	BVar2 = cfg::CFG_GetPropertyRGBF(globals::g_Game.LegoCfgRoot,pcVar1,pfVar5,pfVar4,pfVar6);
	if (BVar2 == 0) {
		globals::g_Game.struct2c_3c = NULL;
	}
	else {
		globals::g_Game.struct2c_3c =
				 res::Res_CreateLight
									 ((globals::g_Game.structbc_2c)->resData_24,D3DRMLIGHT_DIRECTIONAL,local_4,local_8
										,local_c);
	}
	globals::g_Game.struct2c_4c =
			 res::Res_CreateLight
								 ((globals::g_Game.structbc_2c)->resData_24,D3DRMLIGHT_DIRECTIONAL,1.0,0.0,0.0);
	if (globals::g_Game.struct2c_4c == NULL) {
		return 0;
	}
	pRVar3 = res::GetRoot();
	globals::g_Game.struct2c_48 = pool::ReservedPool_ResourceData___Next(pRVar3);
	globals::g_Game.struct2c_44 =
			 res::Res_CreateLight(globals::g_Game.struct2c_48,D3DRMLIGHT_SPOT,1.0,1.0,1.0);
	if (globals::g_Game.struct2c_44 == NULL) {
		return 0;
	}
	FUN_0044c9d0(globals::g_Game.struct2c_44,globals::g_Game.struct2c_48,0.8,0.8,0.8);
	res::Res_SetFrameOrientation(globals::g_Game.struct2c_44,NULL,0.0,0.0,1.0,0.0,1.0,0.0);
	res::Res_SetLightPenumbra(globals::g_Game.struct2c_44,0.85);
	res::Res_SetLightUmbra(globals::g_Game.struct2c_44,0.0);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_38,1);
	if (globals::g_Game.struct2c_3c != NULL) {
		res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_3c,1);
	}
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_30,1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_34,1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_40,1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_44,1);
	res::Res_UnkSetup3DFrameTransform(globals::g_Game.struct2c_4c,1);
	res::Res_SetLightRange(globals::g_Game.struct2c_30,2000.0);
	res::Res_SetLightRange(globals::g_Game.struct2c_34,2000.0);
	res::Res_SetLightRange(globals::g_Game.struct2c_44,2000.0);
	return 1;
}



void __cdecl FUN_00433b10(float param_1,float param_2,int *param_3,int *param_4)
{
	lego::game::SurfaceMap_ToBlockCoordinatesNoZ
						((lego::globals::g_Game.level)->surfaceMap,param_1,param_2,param_3,param_4);
	return;
}



BOOL __cdecl FUN_00433b40(int *param_1,float param_2,int param_3)
{
	int iVar1;
	LevelBlockFlags1 LVar2;
	float fVar3;
	bool bVar4;
	short sVar5;
	ObjectStatsFlags1 OVar6;
	BOOL BVar7;
	int *piVar8;
	uint uVar9;
	ulonglong uVar10;
	float local_2c;
	int local_28;
	int local_24;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	uVar9 = 0;
	local_20[0] = -1;
	local_20[1] = 0;
	local_20[2] = 1;
	local_20[3] = 0;
	local_20[4] = 0;
	local_c = 0xffffffff;
	local_8 = 0;
	local_4 = 1;
	OVar6 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1);
	if (((((OVar6 & STATS1_RANDOMENTERWALL) != STATS1_NONE) && ((*(byte *)(param_1 + 0xf8) & 1) == 0))
			&& (BVar7 = FUN_0043bdb0((LiveObject *)param_1), BVar7 == 0)) && (param_2 != 0.0)) {
		local_2c = param_2;
		if ((ushort)((ushort)(param_2 < 300.0) << 8 | (ushort)(param_2 == 300.0) << 0xe) == 0) {
			local_2c = 300.0;
		}
		sVar5 = lego::util::randomInt16();
		uVar10 = __ftol((float10)300.0 / (float10)local_2c);
		if ((int)((ulonglong)(uint)(int)sVar5 % (uVar10 & 0xffffffff)) == 0) {
			lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_1,&local_24,&local_28);
			piVar8 = local_20;
			iVar1 = ((lego::globals::g_Game.level)->dimensions).width;
			do {
				if ((((uint)(local_24 + *piVar8) < iVar1 - 1U) &&
						((uint)(piVar8[1] + local_28) < ((lego::globals::g_Game.level)->dimensions).height - 1U)
						) && ((LVar2 = (lego::globals::g_Game.level)->blocks
													 [(piVar8[1] + local_28) * iVar1 + local_24 + *piVar8].flags1,
									(LVar2 & BLOCK1_UNK_10) != BLOCK1_NONE && ((LVar2 & BLOCK1_UNK_8) == BLOCK1_NONE))
								 )) {
					bVar4 = true;
				}
				else {
					bVar4 = false;
				}
				if (bVar4) {
					param_1[0xd0] = -0x40800000;
					FUN_004499c0((LiveObject *)param_1);
					return 1;
				}
				uVar9 += 1;
				piVar8 = piVar8 + 2;
			} while (uVar9 < 4);
		}
	}
	if (((param_3 != 0) ||
			(OVar6 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1),
			(OVar6 & STATS1_RANDOMMOVE) != STATS1_NONE)) &&
		 (((*(byte *)(param_1 + 0xf8) & 1) == 0 &&
			((BVar7 = FUN_0043bdb0((LiveObject *)param_1), BVar7 == 0 &&
			 (fVar3 = *(float *)(param_1[0xcd] + 0x140), param_2 != 0.0)))))) {
		local_2c = param_2;
		if ((ushort)((ushort)(param_2 < fVar3) << 8 | (ushort)(param_2 == fVar3) << 0xe) == 0) {
			local_2c = fVar3;
		}
		if (param_3 == 0) {
			sVar5 = lego::util::randomInt16();
			uVar10 = __ftol((float10)fVar3 / (float10)local_2c);
			if ((int)((ulonglong)(uint)(int)sVar5 % (uVar10 & 0xffffffff)) != 0) {
				return 0;
			}
		}
		FUN_00444520((LiveObject *)param_1);
		return 1;
	}
	return 0;
}



BOOL __cdecl FUN_00433d60(int x,int y)
{
	LevelSurfaceMap *surfMap;
	int iVar1;
	
	if (((lego::globals::g_Game.level)->blocks
			 [((lego::globals::g_Game.level)->dimensions).width * y + x].flags1 & 0x100) == BLOCK1_NONE) {
		surfMap = lego::game::GetSurfaceMap();
		iVar1 = FUN_0044eb20(surfMap,x,y);
		if (iVar1 != 0) {
			return 1;
		}
	}
	return 0;
}



// WARNING: Function: _alloca4k replaced with injection: alloca_probe

void __cdecl
FUN_00433db0(ResourceData *resData,uint *param_2,uint param_3,float param_4,float param_5,
						float param_6,undefined4 param_7,float param_8,int param_9,float param_10,float param_11
						,float param_12,float param_13,float param_14,float param_15,float param_16,
						float param_17,int param_18,float param_19,float param_20,float param_21,int param_22,
						uint param_23,undefined4 param_24,float param_25,undefined4 param_26,float param_27,
						float param_28,float param_29,float param_30,float param_31)
{
	LevelBlockFlags1 *pLVar1;
	bool bVar2;
	LevelData *level;
	float fVar3;
	BOOL BVar4;
	uint uVar5;
	uint *puVar6;
	float *pfVar7;
	LevelSurfaceMap *pLVar8;
	uint uVar9;
	int iVar10;
	float10 fVar11;
	longlong lVar12;
	float fStack7376;
	uint uStack7372;
	LevelSurfaceMap *pLStack7368;
	uint uStack7364;
	float fStack7360;
	float fStack7356;
	float fStack7352;
	undefined4 uStack7348;
	float fStack7344;
	int iStack7340;
	float fStack7336;
	float fStack7332;
	float fStack7328;
	float fStack7324;
	float fStack7320;
	float fStack7316;
	float fStack7312;
	float fStack7308;
	int iStack7304;
	Vector3F VStack7300;
	int iStack7288;
	uint uStack7284;
	undefined4 uStack7280;
	float fStack7276;
	undefined4 uStack7272;
	float fStack7268;
	float fStack7264;
	Vector3F VStack7260;
	undefined4 auStack7248 [12];
	uint auStack7200 [600];
	float afStack4800 [1199];
	undefined4 uStack4;
	
	level = lego::globals::g_Game.level;
	uStack4 = 0x433dba;
	pLVar8 = (lego::globals::g_Game.level)->surfaceMap;
	fStack7332 = 0.0;
	pLStack7368 = pLVar8;
	fVar11 = lego::game::SurfaceMap_GetFloat10(pLVar8);
	fStack7356 = (float)fVar11;
	lVar12 = __ftol((float10)(float)param_3 / (float10)fStack7356);
	iVar10 = (int)lVar12;
	iStack7340 = 0;
	lego::res::Res_GetPosition(resData,NULL,&VStack7300);
	lego::game::SurfaceMap_ToBlockCoordinatesNoZ
						(pLVar8,VStack7300.x,VStack7300.y,&iStack7304,&iStack7288);
	lego::res::Res_GetOrientation(resData,NULL,&VStack7260,NULL);
	fVar11 = (float10)FUN_00477530((int)lego::globals::g_Game.ptr_1c);
	fVar11 = (float10)fcos(fVar11 * (float10)1.4);
	fStack7344 = (float)fVar11;
	FUN_004771d0((int)lego::globals::g_Game.ptr_1c,&fStack7376,&uStack7372);
	fStack7268 = (float)(ulonglong)(uint)fStack7376;
	uStack7348 = 0;
	fStack7264 = (float)(ulonglong)uStack7372;
	fStack7352 = (float)(iStack7304 - iVar10);
	uVar5 = iStack7288 - iVar10;
	fStack7360 = (float)(iStack7304 + iVar10);
	uStack7364 = iVar10 + iStack7288;
	if ((int)fStack7352 < 0) {
		fStack7352 = 0.0;
	}
	if ((int)uVar5 < 0) {
		uVar5 = 0;
	}
	if ((int)fStack7360 < 0) {
		fStack7360 = 0.0;
	}
	if ((int)uStack7364 < 0) {
		uStack7364 = 0;
	}
	iVar10 = (level->dimensions).width;
	if (iVar10 <= (int)fStack7360) {
		fStack7360 = (float)(iVar10 + -1);
	}
	iVar10 = (level->dimensions).height;
	if (iVar10 <= (int)uStack7364) {
		uStack7364 = iVar10 - 1;
	}
	fVar3 = fStack7352;
	uVar9 = uStack7364;
	uStack7372 = uVar5;
	if (uVar5 < uStack7364) {
		do {
			fStack7376 = fVar3;
			fVar3 = fStack7376;
			if ((uint)fStack7376 < (uint)fStack7360) {
				puVar6 = auStack7200 + iStack7340 * 2 + 1;
				pfVar7 = afStack4800 + (int)fStack7332 * 4 + 1;
				uStack7372 = uVar5;
				do {
					pLVar8 = pLStack7368;
					if ((*(byte *)&level->blocks[uVar5 * (level->dimensions).width + (int)fStack7376].flags1 &
							0x18) != 0) {
						FUN_0044f900(pLStack7368,(uint)fStack7376,uVar5,&fStack7316,&fStack7312);
						fVar11 = lego::game::SurfaceMap_UnkGetZ(pLVar8,fStack7316,fStack7312);
						fStack7308 = (float)fVar11;
						fStack7328 = (float)((float10)fStack7316 - (float10)VStack7300.x);
						fStack7324 = (float)((float10)fStack7312 - (float10)VStack7300.y);
						fStack7320 = (float)(fVar11 - (float10)VStack7300.z);
						fVar11 = SQRT((fVar11 - (float10)VStack7300.z) * (float10)fStack7320 +
													((float10)fStack7312 - (float10)VStack7300.y) * (float10)fStack7324 +
													((float10)fStack7316 - (float10)VStack7300.x) * (float10)fStack7328);
						fStack7336 = (float)fVar11;
						uVar5 = uStack7372;
						if (fVar11 < (float10)(float)param_3) {
							fVar3 = 1.0 / fStack7336;
							fVar3 = fVar3 * fStack7320 * VStack7260.z +
											fVar3 * fStack7324 * VStack7260.y + fVar3 * fStack7328 * VStack7260.x;
							bVar2 = fStack7336 < (fVar3 - -2.0) * fStack7356;
							if (bVar2) {
								fVar3 = fStack7344 - -1.0;
							}
							if ((ushort)((ushort)(fVar3 < fStack7344) << 8 | (ushort)(fVar3 == fStack7344) << 0xe)
									== 0) {
								FUN_00450390(pLStack7368,(uint)fStack7376,uStack7372,auStack7248);
								fStack7276 = fStack7376;
								uStack7272 = 0;
								uStack7284 = uStack7372;
								uStack7280 = 0;
								pfVar7[-1] = (float)(ulonglong)(uint)fStack7376;
								*pfVar7 = (float)(ulonglong)uStack7372;
								pfVar7[1] = fStack7336;
								fVar11 = FUN_0040b3a0((int)auStack7248,(int)param_2,&fStack7268,(uint)bVar2);
								pfVar7[2] = (float)fVar11;
								uVar5 = uStack7372;
								if ((ushort)((ushort)(fVar11 < (float10)0.0) << 8 |
														(ushort)(fVar11 == (float10)0.0) << 0xe) == 0) {
									fStack7332 = (float)((int)fStack7332 + 1);
									pfVar7 = pfVar7 + 4;
								}
								else {
									puVar6[-1] = (uint)fStack7376;
									iStack7340 += 1;
									*puVar6 = uStack7372;
									puVar6 = puVar6 + 2;
								}
							}
						}
					}
					fStack7376 = (float)((int)fStack7376 + 1);
					fVar3 = fStack7352;
					pLVar8 = pLStack7368;
					uVar9 = uStack7364;
				} while ((uint)fStack7376 < (uint)fStack7360);
			}
			uVar5 += 1;
			uStack7372 = uVar5;
		} while (uVar5 < uVar9);
	}
	fVar3 = fStack7332;
	std::qsort(afStack4800,(uint)fStack7332,0x10,FUN_00434380);
	pLStack7368 = NULL;
	if (fVar3 != 0.0) {
		pfVar7 = afStack4800 + 2;
		fStack7356 = fVar3;
		do {
			lVar12 = __ftol((float10)pfVar7[-2]);
			fVar3 = (float)lVar12;
			fStack7376 = fVar3;
			lVar12 = __ftol((float10)pfVar7[-1]);
			uStack7372 = (uint)lVar12;
			if (((uint)param_4 <= pLStack7368) || ((float)param_3 * 0.6666667 <= *pfVar7)) {
				pLVar1 = &level->blocks[uStack7372 * (level->dimensions).width + (int)fVar3].flags1;
				*pLVar1 = *pLVar1 & 0xfffffeff;
				FUN_004509f0((int *)pLVar8,(int)fStack7376,uStack7372);
				FUN_004637b0((int)fStack7376,uStack7372);
				if ((level->blocks[uStack7372 * (level->dimensions).width + (int)fStack7376].flags1 &
						BLOCK1_UNK_4000) != BLOCK1_NONE) {
					FUN_00465d80(level->blocks[uStack7372 * (level->dimensions).width + (int)fStack7376].
											 field_1c,0);
				}
			}
			else {
				fStack7344 = 1.0 - *pfVar7 / ((float)param_3 * 0.6666667);
				fStack7352 = fStack7344 * 0.7 - -0.3;
				if ((((byte)lego::globals::g_Game.flags1 & 0x20) == 0) ||
					 (BVar4 = FUN_004343b0(level,(uint)fVar3,uStack7372,fStack7344,(uint)fStack7352),
					 fVar3 = fStack7376, BVar4 == 0)) {
					FUN_004509f0((int *)pLVar8,(int)fVar3,uStack7372);
					FUN_004637b0((int)fStack7376,uStack7372);
					if ((level->blocks[uStack7372 * (level->dimensions).width + (int)fStack7376].flags1 &
							BLOCK1_UNK_4000) != BLOCK1_NONE) {
						FUN_00465d80(level->blocks[uStack7372 * (level->dimensions).width + (int)fStack7376].
												 field_1c,0);
					}
					iVar10 = uStack7372 * (level->dimensions).width + (int)fStack7376;
					level->blocks[iVar10].flags1 = level->blocks[iVar10].flags1 & 0xfffffeff;
				}
				else {
					pLVar1 = &level->blocks[uStack7372 * (level->dimensions).width + (int)fStack7376].flags1;
					*pLVar1 = *pLVar1 | 0x100;
					FUN_004637b0((int)fStack7376,uStack7372);
					pLStack7368 = (LevelSurfaceMap *)((int)pLStack7368 + 1);
				}
			}
			pfVar7 = pfVar7 + 4;
			fStack7356 = (float)((int)fStack7356 + -1);
		} while (fStack7356 != 0.0);
	}
	if (iStack7340 != 0) {
		puVar6 = auStack7200;
		iVar10 = iStack7340;
		do {
			FUN_004637b0(*puVar6,puVar6[1]);
			puVar6 = puVar6 + 2;
			iVar10 += -1;
		} while (iVar10 != 0);
	}
	return;
}



BOOL __cdecl FUN_00434380(int param_1,int param_2)
{
	if (*(float *)(param_1 + 0xc) < *(float *)(param_2 + 0xc)) {
		return 1;
	}
	if ((ushort)((ushort)(*(float *)(param_1 + 0xc) < *(float *)(param_2 + 0xc)) << 8 |
							(ushort)(*(float *)(param_1 + 0xc) == *(float *)(param_2 + 0xc)) << 0xe) == 0) {
		return -1;
	}
	return 0;
}



BOOL __cdecl
FUN_004343b0(LevelData *level,uint param_2,uint param_3,undefined4 param_4,uint param_5)
{
	LevelBlock *pLVar1;
	SurfaceTexture SVar2;
	int iVar3;
	int iVar4;
	undefined4 local_30 [12];
	
	if (((*(byte *)&level->blocks[param_3 * (level->dimensions).width + param_2].flags1 & 0x18) != 0)
		 && (SVar2 = level->blocks[param_3 * (level->dimensions).width + param_2].texture,
				iVar3 = *(int *)(level->field_0x80 +
												((level->surfTextSize).width * (SVar2 & 0xf) + (uint)(SVar2 >> 4)) * 4),
				iVar3 != 0)) {
		FUN_00450390(level->surfaceMap,param_2,param_3,local_30);
		iVar4 = param_3 * (level->dimensions).width + param_2;
		pLVar1 = level->blocks + iVar4;
		FUN_0040b7b0(iVar3,(int)local_30,(uint)pLVar1 & 0xffffff00 | (uint)pLVar1->texture,
								 param_5 & 0xffffff00 | (uint)level->blocks[iVar4].field_3,param_4,param_5);
		return 1;
	}
	return 0;
}



void __cdecl FUN_00434460(void)
{
	int iVar1;
	LevelData *pLVar2;
	uint uVar3;
	
	pLVar2 = lego::globals::g_Game.level;
	uVar3 = 0;
	if (((lego::globals::g_Game.level)->surfTextSize).height *
			((lego::globals::g_Game.level)->surfTextSize).width != 0) {
		do {
			iVar1 = *(int *)((int)(void *)pLVar2->field_0x80 + uVar3 * 4);
			if (iVar1 != 0) {
				FUN_0040b740((void *)pLVar2->field_0x80,iVar1);
			}
			uVar3 += 1;
		} while (uVar3 < (uint)((pLVar2->surfTextSize).height * (pLVar2->surfTextSize).width));
	}
	return;
}



BOOL __cdecl lego::game::Level_GetBlockUnkField14Test(int x,int y,float param_3,float param_4)
{
	float fVar1;
	LevelData *pLVar2;
	int iVar3;
	
	pLVar2 = globals::g_Game.level;
	if ((param_3 != 0.0) &&
		 (iVar3 = y * ((globals::g_Game.level)->dimensions).width + x,
		 (globals::g_Game.level)->blocks[iVar3].float_14 =
					param_4 / param_3 + (globals::g_Game.level)->blocks[iVar3].float_14,
		 fVar1 = pLVar2->blocks[y * (pLVar2->dimensions).width + x].float_14,
		 (ushort)((ushort)(fVar1 < 1.0) << 8 | (ushort)(fVar1 == 1.0) << 0xe) == 0)) {
		return 1;
	}
	return 0;
}



void __cdecl lego::main::Main_LoadPanels(CFGProperty *root,uint screenWidth,uint screenHeight)
{
	char cVar1;
	char *pcVar2;
	CFGProperty *prop;
	BOOL BVar3;
	int iVar4;
	int iVar5;
	int iVar6;
	int iVar7;
	uint uVar8;
	uint uVar9;
	undefined4 *puVar10;
	char *pcVar11;
	undefined4 *puVar12;
	int local_12c;
	char *local_128;
	char *local_124;
	char *local_120;
	char *local_11c;
	char *local_118;
	char local_100 [256];
	
	std::sprintf(local_100,"Panels%ix%i",screenWidth,screenHeight);
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,local_100,0);
	prop = cfg::CFG_GetBlockFirstChild(root,pcVar2);
	do {
		if (prop == NULL) {
			return;
		}
		BVar3 = game::Game_GetPanel(prop->key,&local_12c);
		if (BVar3 != 0) {
			uVar8 = 0xffffffff;
			pcVar2 = prop->value;
			do {
				pcVar11 = pcVar2;
				if (uVar8 == 0) break;
				uVar8 -= 1;
				pcVar11 = pcVar2 + 1;
				cVar1 = *pcVar2;
				pcVar2 = pcVar11;
			} while (cVar1 != '\0');
			uVar8 = ~uVar8;
			puVar10 = (undefined4 *)(pcVar11 + -uVar8);
			puVar12 = (undefined4 *)local_100;
			for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
				*puVar12 = *puVar10;
				puVar10 = puVar10 + 1;
				puVar12 = puVar12 + 1;
			}
			for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
				*(undefined *)puVar12 = *(undefined *)puVar10;
				puVar10 = (undefined4 *)((int)puVar10 + 1);
				puVar12 = (undefined4 *)((int)puVar12 + 1);
			}
			util::stringSplit(local_100,&local_128,",");
			FUN_0045a5a0((byte *)local_128,local_12c,4);
			iVar4 = std::atoi(local_118);
			iVar5 = std::atoi(local_11c);
			iVar6 = std::atoi(local_120);
			iVar7 = std::atoi(local_124);
			FUN_0045a910(local_12c,iVar7,iVar6,iVar5,iVar4);
		}
		prop = cfg::CFG_NextFlatProperty(prop);
	} while( true );
}



// WARNING: Function: _alloca4k replaced with injection: alloca_probe

void __cdecl lego::main::Main_LoadButtons(CFGProperty *root,int screenWidth,uint screenHeight)
{
	char *pcVar1;
	CFGProperty *prop;
	BOOL BVar2;
	int iVar3;
	int iVar4;
	int iVar5;
	char **ppcVar6;
	uint uVar7;
	int *piVar8;
	char **ppcVar9;
	CFGProperty *pCStack11756;
	int iStack11752;
	int iStack11748;
	uint uStack11744;
	int iStack11740;
	int aiStack11736 [12];
	char *pcStack11688;
	char *apcStack11684 [4];
	char *pcStack11668;
	char *pcStack11664;
	char *pcStack11660;
	char *pcStack11656;
	char acStack11648 [128];
	int aiStack11520 [288];
	uint auStack10368 [288];
	char *apcStack9216 [288];
	undefined auStack8064 [1152];
	undefined auStack6912 [1152];
	char *apcStack5760 [288];
	float afStack4608 [1151];
	undefined4 uStack4;
	
	uStack4 = 0x43464a;
	piVar8 = aiStack11736;
	aiStack11736[0] = 0;
	for (iVar5 = 0xb; piVar8 = piVar8 + 1, iVar5 != 0; iVar5 += -1) {
		*piVar8 = 0;
	}
	iStack11748 = 0;
	std::sprintf(acStack11648,"Buttons%ix%i",screenWidth,screenHeight);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,acStack11648,0);
	prop = cfg::CFG_GetBlockFirstChild(root,pcVar1);
	if (prop != NULL) {
		ppcVar6 = apcStack5760;
		do {
			BVar2 = game::Game_GetPanel(prop->key,(int *)&pCStack11756);
			if (BVar2 != 0) {
				pcVar1 = std::_strdup(prop->value);
				*ppcVar6 = pcVar1;
				util::stringSplit(pcVar1,&pcStack11688,",");
				iVar5 = FUN_0045a6d0((int)pCStack11756,pcStack11688,&uStack11744);
				if (iVar5 != 0) {
					uVar7 = 0;
					ppcVar9 = apcStack11684;
					auStack10368[aiStack11736[(int)pCStack11756] + (int)pCStack11756 * 0x18] = uStack11744;
					do {
						iVar3 = std::_stricmp("NULL",*ppcVar9);
						iVar5 = aiStack11736[(int)pCStack11756] + ((int)&pCStack11756->fileText + uVar7) * 0x18;
						if (iVar3 == 0) {
							apcStack9216[iVar5] = NULL;
						}
						else {
							apcStack9216[iVar5] = *ppcVar9;
						}
						uVar7 += 0xc;
						ppcVar9 = ppcVar9 + 1;
					} while (uVar7 < 0x24);
					iStack11752 = std::atoi(apcStack11684[3]);
					afStack4608[(aiStack11736[(int)pCStack11756] + (int)pCStack11756 * 0x18) * 4] =
							 (float)iStack11752;
					iStack11752 = std::atoi(pcStack11668);
					afStack4608[(aiStack11736[(int)pCStack11756] + (int)pCStack11756 * 0x18) * 4 + 1] =
							 (float)iStack11752;
					iStack11752 = std::atoi(pcStack11664);
					afStack4608[(aiStack11736[(int)pCStack11756] + (int)pCStack11756 * 0x18) * 4 + 2] =
							 (float)iStack11752;
					iStack11752 = std::atoi(pcStack11660);
					afStack4608[(aiStack11736[(int)pCStack11756] + (int)pCStack11756 * 0x18) * 4 + 3] =
							 (float)iStack11752;
					iVar4 = FUN_0046b790(pcStack11656,&iStack11740);
					iVar3 = aiStack11736[(int)pCStack11756];
					iVar5 = iVar3 + (int)pCStack11756 * 0x18;
					if (iVar4 == 0) {
						aiStack11520[iVar5] = 0;
					}
					else {
						aiStack11520[iVar5] = iStack11740;
					}
					aiStack11736[(int)pCStack11756] = iVar3 + 1;
					iStack11748 += 1;
					ppcVar6 = ppcVar6 + 1;
				}
			}
			prop = cfg::CFG_NextFlatProperty(prop);
		} while (prop != NULL);
		do {
			pCStack11756 = prop;
			FUN_0045aef0((int)prop,aiStack11736[(int)prop],(int)(auStack10368 + (int)prop * 0x18),
									 (int)(afStack4608 + (int)prop * 0x60),(int *)(apcStack9216 + (int)prop * 0x18),
									 (int)(auStack8064 + (int)prop * 0x60),(int)(auStack6912 + (int)prop * 0x60),
									 (int)(aiStack11520 + (int)prop * 0x18));
			prop = (CFGProperty *)((int)&pCStack11756->fileText + 1);
		} while (prop < (CFGProperty *)&DAT_0000000c);
		if (iStack11748 != 0) {
			ppcVar6 = apcStack5760;
			iVar5 = iStack11748;
			pCStack11756 = prop;
			do {
				std::free(*ppcVar6);
				ppcVar6 = ppcVar6 + 1;
				iVar5 += -1;
			} while (iVar5 != 0);
		}
	}
	return;
}



void __cdecl lego::main::Main_LoadTutorialIcon(CFGProperty *root)
{
	char *pcVar1;
	
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","TutorialIcon",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		globals::g_Game.TutorialIcon = image::Image_LoadBMP(pcVar1,0,0);
		if (globals::g_Game.TutorialIcon != NULL) {
			image::Image_SetFirstColorAsKey(globals::g_Game.TutorialIcon);
		}
	}
	return;
}



void __cdecl lego::main::Boot_Load_Samples(CFGProperty *root,BOOL noReduceSamples)
{
	bool bVar1;
	char *pcVar2;
	CFGProperty *prop;
	BOOL BVar3;
	int local_4;
	
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Samples",0);
	prop = cfg::CFG_GetBlockFirstChild(root,pcVar2);
	if (prop != NULL) {
		snd::Audio_SetAudioFlag2(1);
		do {
			pcVar2 = prop->key;
			bVar1 = false;
			if ((*pcVar2 == '!') && (pcVar2 = pcVar2 + 1, noReduceSamples == 0)) {
				bVar1 = true;
			}
			if (!bVar1) {
				BVar3 = snd::Snd_GetSFX(pcVar2,&local_4);
				if (BVar3 != 0) {
					snd::Sample_LoadProperty(prop->value,local_4);
				}
			}
			prop = cfg::CFG_NextFlatProperty(prop);
		} while (prop != NULL);
		snd::Audio_SetAudioFlag2(0);
	}
	return;
}



void __cdecl lego::main::Main_LoadTextMessages(CFGProperty *root)
{
	char cVar1;
	char *pcVar2;
	CFGProperty *pCVar3;
	BOOL BVar4;
	uint uVar5;
	uint uVar6;
	undefined4 *puVar7;
	char *pcVar8;
	undefined4 *puVar9;
	int local_22c;
	char *local_228;
	int local_224;
	undefined4 local_200 [128];
	
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"TextMessages",0);
	for (pCVar3 = cfg::CFG_GetBlockFirstChild(root,pcVar2); pCVar3 != NULL;
			pCVar3 = cfg::CFG_NextFlatProperty(pCVar3)) {
		BVar4 = unk::Lego_GetTexts(pCVar3->key,&local_22c);
		if (BVar4 != 0) {
			FUN_0046add0(local_22c,pCVar3->value);
		}
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"TextMessagesWithImages",0);
	pCVar3 = cfg::CFG_GetBlockFirstChild(root,pcVar2);
	do {
		if (pCVar3 == NULL) {
			return;
		}
		BVar4 = unk::Lego_GetTexts(pCVar3->key,&local_22c);
		if (BVar4 != 0) {
			uVar5 = 0xffffffff;
			pcVar2 = pCVar3->value;
			do {
				pcVar8 = pcVar2;
				if (uVar5 == 0) break;
				uVar5 -= 1;
				pcVar8 = pcVar2 + 1;
				cVar1 = *pcVar2;
				pcVar2 = pcVar8;
			} while (cVar1 != '\0');
			uVar5 = ~uVar5;
			puVar7 = (undefined4 *)(pcVar8 + -uVar5);
			puVar9 = local_200;
			for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
				*puVar9 = *puVar7;
				puVar7 = puVar7 + 1;
				puVar9 = puVar9 + 1;
			}
			for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
				*(undefined *)puVar9 = *(undefined *)puVar7;
				puVar7 = (undefined4 *)((int)puVar7 + 1);
				puVar9 = (undefined4 *)((int)puVar9 + 1);
			}
			util::stringSplit((char *)local_200,&local_228,":");
			FUN_0046ae70(local_22c,local_228,local_224);
		}
		pCVar3 = cfg::CFG_NextFlatProperty(pCVar3);
	} while( true );
}



void __cdecl lego::main::Main_LoadInfoMessages(CFGProperty *root)
{
	char cVar1;
	char *pcVar2;
	CFGProperty *prop;
	BOOL BVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	undefined4 *puVar7;
	char *pcVar8;
	undefined4 *puVar9;
	int local_430;
	int local_42c;
	char *local_428;
	int local_424;
	char *local_420;
	char *local_41c;
	char *local_418;
	undefined4 local_400 [256];
	
	pcVar2 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"InfoMessages",0);
	prop = cfg::CFG_GetBlockFirstChild(root,pcVar2);
	do {
		if (prop == NULL) {
			return;
		}
		BVar3 = FUN_00419310(prop->key,&local_430);
		if (BVar3 != 0) {
			uVar5 = 0xffffffff;
			pcVar2 = prop->value;
			do {
				pcVar8 = pcVar2;
				if (uVar5 == 0) break;
				uVar5 -= 1;
				pcVar8 = pcVar2 + 1;
				cVar1 = *pcVar2;
				pcVar2 = pcVar8;
			} while (cVar1 != '\0');
			uVar5 = ~uVar5;
			puVar7 = (undefined4 *)(pcVar8 + -uVar5);
			puVar9 = local_400;
			for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
				*puVar9 = *puVar7;
				puVar7 = puVar7 + 1;
				puVar9 = puVar9 + 1;
			}
			for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
				*(undefined *)puVar9 = *(undefined *)puVar7;
				puVar7 = (undefined4 *)((int)puVar7 + 1);
				puVar9 = (undefined4 *)((int)puVar9 + 1);
			}
			uVar5 = util::stringSplit((char *)local_400,&local_428,":");
			FUN_004193e0(local_430,local_428);
			FUN_00419580(local_430,local_424);
			BVar3 = snd::Snd_GetSFX(local_420,&local_42c);
			if (BVar3 != 0) {
				FUN_004195b0(local_430,local_42c);
			}
			if (uVar5 < 4) {
				FUN_004193a0(local_430,1);
				iVar4 = 0;
			}
			else {
				iVar4 = std::_stricmp(local_41c,"SLOW");
				FUN_004193a0(local_430,(uint)(iVar4 == 0));
				iVar4 = std::_stricmp(local_41c,"ALWAYSPLAYSFX");
				if (iVar4 == 0) {
					iVar4 = 1;
				}
				else {
					if ((uVar5 < 5) || (iVar4 = std::_stricmp(local_418,"ALWAYSPLAYSFX"), iVar4 != 0)) {
						iVar4 = 0;
					}
					else {
						iVar4 = 1;
					}
				}
			}
			FUN_00419420(local_430,iVar4);
		}
		prop = cfg::CFG_NextFlatProperty(prop);
	} while( true );
}



void __cdecl lego::main::Main_LoadToolTips(CFGProperty *root)
{
	char *pcVar1;
	CFGProperty *pCVar2;
	int iVar3;
	BOOL BVar4;
	int local_8;
	int local_4;
	
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTips",0);
	for (pCVar2 = cfg::CFG_GetBlockFirstChild(root,pcVar1); pCVar2 != NULL;
			pCVar2 = cfg::CFG_NextFlatProperty(pCVar2)) {
		iVar3 = FUN_0046b790(pCVar2->key,&local_8);
		if (iVar3 != 0) {
			unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(local_8,pCVar2->value);
		}
	}
	pcVar1 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTipsSFXs",0);
	for (pCVar2 = cfg::CFG_GetBlockFirstChild(root,pcVar1); pCVar2 != NULL;
			pCVar2 = cfg::CFG_NextFlatProperty(pCVar2)) {
		iVar3 = FUN_0046b790(pCVar2->key,&local_8);
		if ((iVar3 != 0) && (BVar4 = snd::Snd_GetSFX(pCVar2->value,&local_4), BVar4 != 0)) {
			FUN_0046b9c0(local_8,local_4);
		}
	}
	return;
}



BOOL __cdecl lego::game::Game_TryPlaceObject(ObjectType objType,int objIndex)
{
	ObjectStatsFlags2 OVar1;
	BOOL BVar2;
	Vector3F local_c;
	
	globals::g_Game.flags3 &= ~GAME3_PLACEBUILDING;
	Game_SetPlaceFlagsState_004dd650(1);
	if ((objType == OBJECT_BUILDING) || (objType == OBJECT_ELECTRICFENCE)) {
		globals::g_Game.flags3 |= GAME3_PLACEBUILDING;
		globals::g_Game.placeObjType = objType;
		globals::g_Game.placeObjIndex = objIndex;
		res::Res_GetOrientation((globals::g_Game.structbc_24)->resData_24,NULL,&local_c,NULL);
		if (ABS(local_c.x) <= ABS(local_c.y)) {
			if ((ushort)((ushort)(local_c.y < 0.0) << 8 | (ushort)(local_c.y == 0.0) << 0xe) == 0) {
				globals::g_Game.placeObjDirection = DIRECTION_DOWN;
				return 1;
			}
			globals::g_Game.placeObjDirection = DIRECTION_UP;
			return 1;
		}
		if ((ushort)((ushort)(local_c.x < 0.0) << 8 | (ushort)(local_c.x == 0.0) << 0xe) == 0) {
			globals::g_Game.placeObjDirection = DIRECTION_LEFT;
			return 1;
		}
		globals::g_Game.placeObjDirection = DIRECTION_RIGHT;
		return 1;
	}
	OVar1 = Object_GetStatsFlags2(objType,objIndex);
	if ((OVar1 & STATS2_USESMALLTELEPORTER) != STATS2_NONE) {
		BVar2 = LiveObject_QueueTeleport(globals::g_Game.placeDestSmallTeleporter,objType,objIndex);
		return BVar2;
	}
	OVar1 = Object_GetStatsFlags2(objType,objIndex);
	if ((OVar1 & STATS2_USEBIGTELEPORTER) != STATS2_NONE) {
		BVar2 = LiveObject_QueueTeleport(globals::g_Game.placeDestBigTeleporter,objType,objIndex);
		return BVar2;
	}
	OVar1 = Object_GetStatsFlags2(objType,objIndex);
	if ((OVar1 & STATS2_USEWATERTELEPORTER) != STATS2_NONE) {
		BVar2 = LiveObject_QueueTeleport(globals::g_Game.placeDestWaterTeleporter,objType,objIndex);
		return BVar2;
	}
	OVar1 = Object_GetStatsFlags2(objType,objIndex);
	if ((OVar1 & STATS2_USELEGOMANTELEPORTER) != STATS2_NONE) {
		BVar2 = LiveObject_QueueTeleport(NULL,objType,objIndex);
		return BVar2;
	}
	return 0;
}



void __cdecl FUN_00434f40(int *param_1,int param_2)
{
	uint uVar1;
	LevelData *pLVar2;
	uint uVar3;
	int iVar4;
	int iVar5;
	int iVar6;
	
	pLVar2 = lego::globals::g_Game.level;
	iVar4 = -param_2;
	iVar6 = iVar4;
	if (-param_2 == param_2 || SBORROW4(iVar4,param_2) != param_2 * -2 < 0) {
		do {
			for (iVar5 = iVar4; iVar5 <= param_2; iVar5 += 1) {
				if ((((iVar5 * iVar5 + iVar6 * iVar6 <= param_2 * param_2) &&
						 (uVar1 = iVar5 + *param_1, -1 < (int)uVar1)) &&
						((int)uVar1 < (pLVar2->dimensions).width)) &&
					 ((uVar3 = param_1[1] + iVar6, -1 < (int)uVar3 &&
						((int)uVar3 < (pLVar2->dimensions).height)))) {
					FUN_00433220(uVar1,uVar3);
				}
			}
			iVar6 += 1;
		} while (iVar6 <= param_2);
	}
	return;
}



void __cdecl lego::main::Main_LoadSurfaceTypeDescriptions_sound(CFGProperty *root,char *keyBasePath)
{
	char cVar1;
	char *pcVar2;
	BOOL BVar3;
	uint uVar4;
	uint uVar5;
	void **ppvVar6;
	undefined4 *puVar7;
	char *pcVar8;
	char *pcVar9;
	undefined4 *puVar10;
	uint local_430;
	undefined4 *local_42c;
	char *local_428;
	char *local_424;
	undefined4 local_400 [256];
	
	ppvVar6 = globals::g_Game.SurfaceTypeDescriptions_sound_TABLE;
	do {
		pcVar2 = cfg::CFG_JoinPath(keyBasePath,"SurfaceTypeDescriptions",ppvVar6[-0x24],0);
		pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
		if (pcVar2 != NULL) {
			uVar4 = 0xffffffff;
			local_42c = local_400;
			pcVar8 = pcVar2;
			do {
				pcVar9 = pcVar8;
				if (uVar4 == 0) break;
				uVar4 -= 1;
				pcVar9 = pcVar8 + 1;
				cVar1 = *pcVar8;
				pcVar8 = pcVar9;
			} while (cVar1 != '\0');
			uVar4 = ~uVar4;
			puVar7 = (undefined4 *)(pcVar9 + -uVar4);
			puVar10 = local_42c;
			for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
				*puVar10 = *puVar7;
				puVar7 = puVar7 + 1;
				puVar10 = puVar10 + 1;
			}
			for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
				*(undefined *)puVar10 = *(undefined *)puVar7;
				puVar7 = (undefined4 *)((int)puVar7 + 1);
				puVar10 = (undefined4 *)((int)puVar10 + 1);
			}
			util::stringSplit(pcVar2,&local_428,",");
			pcVar2 = util::formatText(local_428);
			ppvVar6[-0x12] = pcVar2;
			BVar3 = snd::Snd_GetSFX(local_424,(int *)&local_430);
			*ppvVar6 = (void *)(-(uint)(BVar3 != 0) & local_430);
		}
		ppvVar6 = ppvVar6 + 1;
		if ((void **)((int)globals::g_Game.SurfaceTypeDescriptions_sound_TABLE + 0x47) < ppvVar6) {
			return;
		}
	} while( true );
}



char * __cdecl FUN_004350a0(int param_1)
{
	char *pcVar1;
	
	pcVar1 = lego::globals::g_Game.SurfaceTypeDescriptions_name_TABLE[param_1];
	if (pcVar1 == NULL) {
		pcVar1 = "Need config for surface type.";
	}
	return pcVar1;
}



void * __cdecl FUN_004350c0(int param_1)
{
	return lego::globals::g_Game.SurfaceTypeDescriptions_sound_TABLE[param_1];
}



void __cdecl FUN_004350d0(int param_1)
{
	if (param_1 == 1) {
		FUN_0045cee0(0x2b);
		return;
	}
	if (param_1 == 2) {
		FUN_0045cee0(0x2c);
		return;
	}
	if (param_1 == 3) {
		FUN_0045cee0(0x2d);
		return;
	}
	if (param_1 == 4) {
		FUN_0045cee0(0x2e);
		return;
	}
	if (param_1 == 5) {
		FUN_0045cee0(0x2f);
		return;
	}
	if (param_1 == 8) {
		FUN_0045cee0(0x32);
		return;
	}
	if (param_1 == 10) {
		FUN_0045cee0(0x34);
		return;
	}
	if (param_1 == 0xb) {
		FUN_0045cee0(0x35);
	}
	return;
}



void __cdecl FUN_00435160(Point2I *param_1,int param_2,int param_3)
{
	uint uVar1;
	short sVar2;
	short sVar3;
	uint uVar4;
	BOOL BVar5;
	int iVar6;
	int *piVar7;
	uint local_19c;
	Point2I local_198;
	int local_190 [100];
	
	piVar7 = local_190;
	for (iVar6 = 100; iVar6 != 0; iVar6 += -1) {
		*piVar7 = 0;
		piVar7 = piVar7 + 1;
	}
	uVar1 = param_2 * 2;
	local_19c = 0;
	while( true ) {
		if (param_3 == 0) {
			uVar4 = uVar1 * uVar1 >> 2;
		}
		else {
			uVar4 = uVar1 * uVar1;
		}
		if (uVar4 <= local_19c) break;
		sVar2 = lego::util::randomInt16();
		sVar3 = lego::util::randomInt16();
		local_198.x = ((uint)(int)sVar2 % uVar1 + param_1->x) - param_2;
		local_198.y = (param_1->y + (uint)(int)sVar3 % uVar1) - param_2;
		iVar6 = (uint)(int)sVar3 % uVar1 + ((uint)(int)sVar2 % uVar1) * 10;
		if (local_190[iVar6] == 0) {
			BVar5 = FUN_0040f0c0(&local_198,1);
			if ((BVar5 != 0) && (param_3 != 0)) {
				return;
			}
			local_190[iVar6] = 1;
		}
		local_19c += 1;
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_00435230(LevelData *level,int param_2,undefined4 param_3,float param_4)
{
	LevelBlock *pLVar1;
	int iVar2;
	LevelSurfaceMap *pLVar3;
	BOOL BVar4;
	uint uVar5;
	uint y;
	uint x;
	float10 fVar6;
	float10 fVar7;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	fVar6 = (float10)fsin((float10)_DAT_004df58c);
	_DAT_004df58c = _DAT_004df58c - param_4 * 25.0 * -0.01333333;
	iVar2 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
	if (iVar2 != 0) {
		y = 0;
		pLVar3 = level->surfaceMap;
		if ((pLVar3->smallDimensions).height != 0) {
			do {
				x = 0;
				if ((pLVar3->smallDimensions).width != 0) {
					do {
						BVar4 = FUN_00433d60(x,y);
						if (BVar4 == 0) {
							pLVar1 = level->blocks + y * (level->dimensions).width + x;
							if (pLVar1->blockpointer == 0) {
								if (pLVar1->field_44 == 1) {
									pLVar1->field_44 = 0;
									uVar5 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
									if ((((uVar5 & 2) == 0) &&
											(level->blocks[y * (level->dimensions).width + x].clickCount != 0)) &&
										 (INT_004deccc == 0)) {
										FUN_0044f7a0((lego::globals::g_Game.level)->surfaceMap,x,y,4);
									}
									else {
										pLVar3 = (lego::globals::g_Game.level)->surfaceMap;
LAB_0043544b:
										FUN_0044f830(pLVar3,x,y);
									}
								}
								else {
									if ((pLVar1->field_44 == 0) &&
										 (uVar5 = FUN_0044f800((lego::globals::g_Game.level)->surfaceMap,x,y),
										 uVar5 == 5)) {
										pLVar3 = (lego::globals::g_Game.level)->surfaceMap;
										goto LAB_0043544b;
									}
								}
							}
							else {
								FUN_0044f900(level->surfaceMap,x,y,&local_c,&local_8);
								fVar7 = lego::game::SurfaceMap_UnkGetZ(level->surfaceMap,local_c,local_8);
								local_4 = (float)fVar7;
								FUN_00477590(param_2,&local_14,&local_c);
								local_14 = local_14 - (float)((lego::globals::g_Game.TutorialIcon)->width / 2);
								local_10 = local_10 -
													 ((float)fVar6 * 20.0 +
													 (float)((lego::globals::g_Game.TutorialIcon)->height << 1));
								lego::image::Image_Blt__0047df70
													(lego::globals::g_Game.TutorialIcon,NULL,&local_14,NULL);
								if (DAT_004ded1c == 0) {
									FUN_0044f830((lego::globals::g_Game.level)->surfaceMap,x,y);
									level->blocks[y * (level->dimensions).width + x].field_44 = 1;
								}
								else {
									FUN_0044f7a0((lego::globals::g_Game.level)->surfaceMap,x,y,5);
									level->blocks[y * (level->dimensions).width + x].field_44 = 1;
								}
							}
						}
						x += 1;
					} while (x < (uint)(level->surfaceMap->smallDimensions).width);
				}
				pLVar3 = level->surfaceMap;
				y += 1;
			} while (y < (uint)(pLVar3->smallDimensions).height);
		}
	}
	return;
}



undefined4 FUN_00435480(void)
{
	if ((lego::globals::g_ButtonState_LeftDown == 0) && (DAT_004df424 != 0)) {
		DAT_004df424 = lego::globals::g_ButtonState_LeftDown;
		return 1;
	}
	DAT_004df424 = lego::globals::g_ButtonState_LeftDown;
	return 0;
}



undefined4 FUN_004354b0(void)
{
	float local_8;
	undefined4 local_4;
	
	local_8 = 0.0;
	local_4 = 0;
	if (lego::globals::g_Game.DialogContrastOverlay == NULL) {
		return 0;
	}
	lego::image::Image_Blt__0047df70(lego::globals::g_Game.DialogContrastOverlay,NULL,&local_8,NULL);
	return 1;
}



undefined4 __cdecl FUN_004354f0(byte *param_1,byte *param_2,byte *param_3,byte *param_4)
{
	float fVar1;
	float fVar2;
	ImageFont *pIVar3;
	uint uVar4;
	int iVar5;
	undefined4 uVar6;
	float local_18;
	float local_14;
	float local_c;
	undefined4 local_8;
	float local_4;
	
	uVar6 = 0xffffffff;
	if (((lego::globals::g_Game.DialogImage != NULL) && (lego::globals::g_Game.drawregion_e80 != NULL)
			) && (lego::globals::g_Game.drawregion_e84 != NULL)) {
		FUN_004354b0();
		local_18 = (float)(lego::globals::g_RESOLUTION.width / 2) -
							 (float)((uint)(lego::globals::g_Game.DialogImage)->width >> 1);
		local_14 = (float)(lego::globals::g_RESOLUTION.height / 2) -
							 (float)((uint)(lego::globals::g_Game.DialogImage)->height >> 1);
		lego::image::Image_Blt__0047df70(lego::globals::g_Game.DialogImage,NULL,&local_18,NULL);
		FUN_00485c70((Struct_830 *)lego::globals::g_Game.drawregion_e80);
		FUN_00485c70((Struct_830 *)lego::globals::g_Game.drawregion_e84);
		FUN_00485c70((Struct_830 *)lego::globals::g_Game.drawregion_e88);
		FUN_00485c70((Struct_830 *)lego::globals::g_Game.drawregion_e8c);
		if (param_3 != NULL) {
			local_c = 0.0;
			local_8 = 0;
			local_4 = 0.0;
			pIVar3 = FUN_00401b90(lego::globals::g_Game.bmpMbriefFONT,(char *)param_3);
			uVar4 = lego::draw::Font_GetField_be4(lego::globals::g_Game.bmpMbriefFONT);
			fVar1 = (*(float *)((int)lego::globals::g_Game.drawregion_e88 + 4) -
							*(float *)((int)lego::globals::g_Game.drawregion_e88 + 0xc) * -0.5) -
							(float)((uint)pIVar3 >> 1);
			local_c = *(float *)((int)lego::globals::g_Game.drawregion_e88 + 8);
			local_4 = (float)(ulonglong)uVar4;
			fVar2 = (float)lego::globals::g_MousePosition.x;
			if ((((ushort)((ushort)(fVar2 < fVar1) << 8 | (ushort)(fVar2 == fVar1) << 0xe) != 0) ||
					(fVar1 + (float)ZEXT48(pIVar3) <= fVar2)) ||
				 ((fVar1 = (float)lego::globals::g_MousePosition.y,
					(ushort)((ushort)(fVar1 < local_c) << 8 | (ushort)(fVar1 == local_c) << 0xe) != 0 ||
					(local_c + local_4 <= fVar1)))) {
				*(ImageFont **)lego::globals::g_Game.drawregion_e88 = lego::globals::g_Game.bmpMbriefFONT;
				lego::game::Game_DisplayInfoMessage
									((Struct_830 *)lego::globals::g_Game.drawregion_e88,(char *)param_3);
			}
			else {
				*(ImageFont **)lego::globals::g_Game.drawregion_e88 = lego::globals::g_Game.bmpMbriefFONT2;
				lego::game::Game_DisplayInfoMessage
									((Struct_830 *)lego::globals::g_Game.drawregion_e88,(char *)param_3);
				iVar5 = FUN_00435480();
				if (iVar5 != 0) {
					uVar6 = 1;
				}
			}
		}
		if (param_4 != NULL) {
			local_c = 0.0;
			local_8 = 0;
			local_4 = 0.0;
			pIVar3 = FUN_00401b90(lego::globals::g_Game.bmpMbriefFONT,(char *)param_4);
			uVar4 = lego::draw::Font_GetField_be4(lego::globals::g_Game.bmpMbriefFONT);
			fVar1 = (*(float *)((int)lego::globals::g_Game.drawregion_e8c + 4) -
							*(float *)((int)lego::globals::g_Game.drawregion_e8c + 0xc) * -0.5) -
							(float)((uint)pIVar3 >> 1);
			local_c = *(float *)((int)lego::globals::g_Game.drawregion_e8c + 8);
			local_4 = (float)(ulonglong)uVar4;
			fVar2 = (float)lego::globals::g_MousePosition.x;
			if ((((ushort)((ushort)(fVar2 < fVar1) << 8 | (ushort)(fVar2 == fVar1) << 0xe) != 0) ||
					(fVar1 + (float)ZEXT48(pIVar3) <= fVar2)) ||
				 ((fVar1 = (float)lego::globals::g_MousePosition.y,
					(ushort)((ushort)(fVar1 < local_c) << 8 | (ushort)(fVar1 == local_c) << 0xe) != 0 ||
					(local_c + local_4 <= fVar1)))) {
				*(ImageFont **)lego::globals::g_Game.drawregion_e8c = lego::globals::g_Game.bmpMbriefFONT;
				lego::game::Game_DisplayInfoMessage
									((Struct_830 *)lego::globals::g_Game.drawregion_e8c,(char *)param_4);
			}
			else {
				*(ImageFont **)lego::globals::g_Game.drawregion_e8c = lego::globals::g_Game.bmpMbriefFONT2;
				lego::game::Game_DisplayInfoMessage
									((Struct_830 *)lego::globals::g_Game.drawregion_e8c,(char *)param_4);
				iVar5 = FUN_00435480();
				if (iVar5 != 0) {
					uVar6 = 0;
				}
			}
		}
		lego::game::Game_DisplayInfoMessage
							((Struct_830 *)lego::globals::g_Game.drawregion_e80,(char *)param_1);
		lego::game::Game_DisplayInfoMessage
							((Struct_830 *)lego::globals::g_Game.drawregion_e84,(char *)param_2);
		FUN_00485650((int *)lego::globals::g_Game.drawregion_e80,0,1.0,NULL);
		FUN_00485650((int *)lego::globals::g_Game.drawregion_e84,0,1.0,NULL);
		FUN_00485650((int *)lego::globals::g_Game.drawregion_e88,0,1.0,NULL);
		FUN_00485650((int *)lego::globals::g_Game.drawregion_e8c,0,1.0,NULL);
		return uVar6;
	}
	return 0xffffffff;
}



BOOL __cdecl FUN_00435870(void)
{
	BOOL BVar1;
	BOOL BVar2;
	BOOL BVar3;
	char *levelName;
	int iVar4;
	
	lego::game::GetLevel();
	BVar1 = lego::unk::Lego_GetIntNotM1__00558020();
	BVar2 = lego::unk::Lego_GetIntNotM1__00558024();
	FUN_0047b420();
	BVar3 = lego::main::Config_IsFrontEndEnabled();
	if (BVar3 != 0) {
		lego::main::Main_initFrontEndReward__00460060();
		FUN_00460620();
		lego::main::Main_waitFrontEndRewards__004616d0();
		lego::unk::lego_freeStructSize_318c__004604a0();
	}
	FUN_00429520(1,NULL,0);
	FUN_00485c70(lego::globals::g_Game.struct830_80);
	levelName = (char *)lego::game::Game_freeLevel__0042eff0();
	BVar3 = lego::main::Config_IsFrontEndEnabled();
	if (BVar3 != 0) {
		if (BVar1 == 0) {
			if (BVar2 == 0) goto LAB_00435915;
			lego::front::Menu_Open_FUN_00416bb0(2);
			iVar4 = lego::unk::Lego_GetInt_0055801c();
			if (iVar4 != 0) {
				return 0;
			}
		}
		else {
			lego::front::Menu_Open_FUN_00416bb0(1);
			iVar4 = lego::unk::Lego_GetInt_0055801c();
			if (iVar4 != 0) {
				return 0;
			}
		}
		levelName = (char *)FUN_00416ca0();
	}
LAB_00435915:
	FUN_00416870(1,0);
	if (levelName == NULL) {
		return 0;
	}
	BVar1 = lego::main::Main_loadLevelCFG(levelName);
	if (BVar1 == 0) {
		return 0;
	}
	std::free(levelName);
	return 1;
}



void __cdecl FUN_00435950(void)
{
	lego::globals::g_Game.flags3 &=
			 ~(GAME3_UNK_1|GAME3_UNK_2|GAME3_UNK_4|GAME3_PICKUPOBJECT|GAME3_LOADVEHICLE|GAME3_UNK_20|
				 GAME3_UNK_40|GAME3_PLACEBUILDING);
	FUN_004649e0(lego::globals::g_Game.RES_2f4_TABLEUNK,1);
	return;
}



void FUN_00435980(void)
{
	int iVar1;
	
	if ((lego::globals::g_Game.flags1 & GAME1_UNK_8000000) != GAME1_NONE) {
		iVar1 = FUN_0046a780(0x40b);
		if (iVar1 != 0) {
			lego::globals::g_Game.flags2 |= 2;
		}
	}
	return;
}



void __cdecl FUN_004359b0(int param_1)
{
	if (param_1 != 0) {
		lego::globals::g_Game.flags2 = lego::globals::g_Game.flags2 | GAME2_UNK_4;
		return;
	}
	lego::globals::g_Game.flags2 = lego::globals::g_Game.flags2 & ~GAME2_UNK_4;
	return;
}



void __cdecl lego::game::Game_SetCallToArmsOn(BOOL enableCallToArms)
{
	if (enableCallToArms != 0) {
		globals::g_Game.flags2 |= GAME2_CALLTOARMS;
		if ((ushort)((ushort)(globals::g_Game.float_e3c < 0.0) << 8 |
								(ushort)(globals::g_Game.float_e3c == 0.0) << 0xe) != 0) {
			lego::snd::Snd_Play_FUN_00465260(0x19,0);
			globals::g_Game.float_e3c = 250.0;
		}
		FUN_0045aeb0(6,2,1);
		return;
	}
	globals::g_Game.flags2 &= ~GAME2_CALLTOARMS;
	globals::g_Game.float_e3c = 0.0;
	FUN_0045aeb0(6,2,0);
	return;
}



Struct_bc * __cdecl lego::unk::Lego_AllocStruct_bc__00435a50(ResourceData *resData,int mode)
{
	Struct_bc *buffer;
	ResourceData *pRVar1;
	
	buffer = (Struct_bc *)std::malloc(0xbc);
	if (buffer != NULL) {
		buffer->mode_0 = mode;
		buffer->object_4 = NULL;
		buffer->float_c = 0.0;
		buffer->float_8 = 0.0;
		*(undefined *)&buffer->flags = 0;
		*(undefined4 *)&buffer->field_0x84 = 0;
		*(undefined4 *)&buffer->field_0x78 = 0;
		buffer->float_90 = 200.0;
		buffer->field_14 = 0;
		(buffer->vector_18).x = 0.0;
		(buffer->vector_18).y = 0.0;
		(buffer->vector_18).z = 0.0;
		*(undefined4 *)&buffer->field_0x9c = 0;
		(buffer->vector_a0).z = 0.0;
		(buffer->vector_a0).y = 0.0;
		(buffer->vector_a0).x = 0.0;
		(buffer->vector_ac).z = 0.0;
		(buffer->vector_ac).y = 0.0;
		(buffer->vector_ac).x = 0.0;
		pRVar1 = pool::ReservedPool_ResourceData___Next(NULL);
		buffer->resData_24 = pRVar1;
		if (buffer->resData_24 != NULL) {
			res::Res_SetFramePosition(buffer->resData_24,NULL,0.0,0.0,-buffer->float_90);
			res::Res_SetFrameOrientation(buffer->resData_24,NULL,0.0,0.0,1.0,0.0,1.0,0.0);
			if (mode == 3) {
				FUN_004759d0(buffer->resData_24,resData);
				return buffer;
			}
			pRVar1 = pool::ReservedPool_ResourceData___Next(resData);
			buffer->resData_28 = pRVar1;
			if (buffer->resData_28 != NULL) {
				pRVar1 = pool::ReservedPool_ResourceData___Next(resData);
				buffer->resData_2c = pRVar1;
				if (buffer->resData_2c != NULL) {
					pRVar1 = pool::ReservedPool_ResourceData___Next(buffer->resData_28);
					buffer->resData_30 = pRVar1;
					if (buffer->resData_30 != NULL) {
						if (mode == 1) {
							pRVar1 = pool::ReservedPool_ResourceData___Next(buffer->resData_30);
							buffer->tableunk_34 = pRVar1;
							if (buffer->tableunk_34 != 0) {
								res::Res_SetFramePosition((ResourceData *)buffer->tableunk_34,NULL,0.0,0.0,-80.0);
							}
						}
						FUN_004759d0(buffer->resData_24,buffer->resData_30);
						return buffer;
					}
					pool::ReservedPool_ResourceData___Release(buffer->resData_2c);
				}
				pool::ReservedPool_ResourceData___Release(buffer->resData_28);
			}
			pool::ReservedPool_ResourceData___Release(buffer->resData_24);
		}
		std::free(buffer);
	}
	return NULL;
}



void __cdecl lego::debug::Debug_AllowEditModeFunc1(Struct_bc *structbc,BOOL modeDisableUnk)
{
	if (modeDisableUnk == 0) {
		*(byte *)&structbc->flags = *(byte *)&structbc->flags & 0xf7;
	}
	else {
		*(byte *)&structbc->flags = *(byte *)&structbc->flags | 8;
	}
	return;
}



void __cdecl FUN_00435cf8(int *param_1)
{
	lego::pool::ReservedPool_ResourceData___Release((ResourceData *)param_1[9]);
	if (*param_1 != 3) {
		lego::pool::ReservedPool_ResourceData___Release((ResourceData *)param_1[10]);
		lego::pool::ReservedPool_ResourceData___Release((ResourceData *)param_1[0xc]);
	}
	std::free(param_1);
	return;
}



void __cdecl
lego::main::Main_SetCameraMovements
					(float cameraSpeed,float cameraDropOff,float cameraAcceleration,int mouseScrollIndent)
{
	globals::g_CameraSpeed = cameraSpeed;
	globals::g_CameraDropOff = cameraDropOff;
	globals::g_CameraAcceleration = cameraAcceleration;
	globals::g_MouseScrollIndent = mouseScrollIndent;
	return;
}



void __cdecl FUN_00435d65(int *param_1,int param_2)
{
	Vector3F local_28;
	Vector3F local_1c;
	Vector3F local_10;
	
	if (*param_1 == 3) {
		lego::res::Res_GetPosition(*(ResourceData **)(param_2 + 0x24),NULL,&local_28);
		lego::res::Res_GetOrientation(*(ResourceData **)(param_2 + 0x24),NULL,&local_1c,&local_10);
		lego::res::Res_SetFramePosition
							((ResourceData *)param_1[9],NULL,local_28.x,local_28.y,local_28.z);
		lego::res::Res_SetFrameOrientation
							((ResourceData *)param_1[9],NULL,local_1c.x,local_1c.y,local_1c.z,local_10.x,
							 local_10.y,local_10.z);
	}
	return;
}



void __cdecl
FUN_00435deb(int param_1,undefined4 param_2,float param_3,undefined4 param_4,float param_5,
						float param_6)
{
	*(undefined4 *)(param_1 + 4) = param_2;
	*(float *)(param_1 + 8) = param_3;
	*(undefined4 *)(param_1 + 0xc) = param_4;
	FUN_00436a82((void *)param_1,param_5);
	*(float *)(param_1 + 0x10) = param_6;
	return;
}



void __cdecl
lego::unk::StructBC_SetObject4_Field14(Struct_bc *param_1,LiveObject *liveObj,undefined4 param_3)
{
	param_1->object_4 = liveObj;
	param_1->field_14 = param_3;
	return;
}



undefined4 __cdecl FUN_00435e3b(Struct_bc *param_1)
{
	return param_1->field_14;
}



void __cdecl FUN_00435e46(int param_1)
{
	*(undefined4 *)(param_1 + 0x9c) = 0;
	return;
}



int __cdecl lego::main::Main_GetMouseScrollIndent(void)
{
	return globals::g_MouseScrollIndent;
}



void __cdecl FUN_00435e62(void *param_1,float param_2,float param_3)
{
	*(float *)((int)param_1 + 0xa0) = param_2;
	*(float *)((int)param_1 + 0xa4) = param_3;
	*(undefined4 *)((int)param_1 + 0xa8) = 0;
	return;
}



void __cdecl FUN_00435e8c(Struct_bc *param_1,LevelData *level,float param_3,float param_4)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	double dVar5;
	BOOL BVar6;
	LevelSurfaceMap *pLVar7;
	float10 fVar8;
	Vector3F local_e0;
	float local_d4;
	float local_d0;
	float local_cc;
	float local_c8;
	float local_c4;
	float local_c0;
	float local_bc;
	Vector3F local_b8;
	Vector3F local_ac;
	Vector3F local_a0;
	float local_94;
	float local_90;
	float local_8c;
	float local_88;
	Vector3F local_84;
	ResourceData *local_78;
	float local_74;
	float local_70;
	float local_6c;
	Vector3F local_68;
	float local_5c;
	Vector3F local_58;
	Vector3F local_4c;
	float local_40;
	float local_3c;
	float local_38;
	float local_34;
	Vector3F local_30;
	Vector3F local_24;
	Vector3F local_18;
	uint local_c;
	uint local_8;
	
	lego::res::Res_AddTranslation
						(param_1->resData_24,D3DRMCOMBINE_BEFORE,-(param_1->vector_ac).x,-(param_1->vector_ac).y
						 ,-(param_1->vector_ac).z);
	fVar1 = lego::globals::g_CameraDropOff;
	if (param_1->mode_0 == 1) {
		(param_1->vector_18).x = (param_1->vector_18).x * lego::globals::g_CameraDropOff;
		(param_1->vector_18).y = (param_1->vector_18).y * fVar1;
		(param_1->vector_18).z = (param_1->vector_18).z * fVar1;
		lego::res::Res_AddTranslation
							(param_1->resData_28,D3DRMCOMBINE_AFTER,(param_1->vector_18).x,(param_1->vector_18).y,
							 (param_1->vector_18).z);
		lego::res::Res_GetPosition(param_1->resData_28,NULL,&local_30);
		lego::res::Res_GetOrientation(param_1->resData_28,NULL,&local_24,&local_18);
		BVar6 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
											(level->surfaceMap,local_30.x,local_30.y,(int *)&local_8,(int *)&local_c);
		if (BVar6 == 0) {
			lego::res::Res_AddTranslation
								(param_1->resData_28,D3DRMCOMBINE_AFTER,-(param_1->vector_18).x,
								 -(param_1->vector_18).y,-(param_1->vector_18).z);
		}
		else {
			if ((local_8 < (uint)lego::globals::g_MouseScrollIndent) ||
				 ((uint)((level->surfaceMap->smallDimensions).width - lego::globals::g_MouseScrollIndent) <=
					local_8)) {
				lego::res::Res_AddTranslation
									(param_1->resData_28,D3DRMCOMBINE_AFTER,-(param_1->vector_18).x,0.0,0.0);
			}
			if ((local_c < (uint)lego::globals::g_MouseScrollIndent) ||
				 ((uint)((level->surfaceMap->smallDimensions).height - lego::globals::g_MouseScrollIndent)
					<= local_c)) {
				lego::res::Res_AddTranslation
									(param_1->resData_28,D3DRMCOMBINE_AFTER,0.0,-(param_1->vector_18).y,0.0);
			}
			fVar8 = lego::game::SurfaceMap_UnkGetZ(level->surfaceMap,local_30.x,local_30.y);
			lego::res::Res_SetFramePosition(param_1->resData_2c,NULL,local_30.x,local_30.y,(float)fVar8);
			lego::res::Res_SetFrameOrientation
								(param_1->resData_2c,NULL,local_18.x,local_18.y,0.0,0.0,0.0,-1.0);
			pLVar7 = lego::game::GetSurfaceMap();
			fVar8 = FUN_00450130((int *)pLVar7,local_30.x,local_30.y);
			local_34 = (float)-fVar8;
			local_38 = param_1->float_90 + local_34;
			lego::res::Res_SetFramePosition(param_1->resData_24,param_1->resData_30,0.0,0.0,-local_38);
		}
		goto LAB_004368f0;
	}
	if (param_1->mode_0 != 3) {
		if (param_1->mode_0 == 2) {
			if (param_1->object_4 == NULL) {
				lego::game::Game_SetFlag1_20000(1);
			}
			else {
				local_78 = lego::game::LiveObject_GetResource(param_1->object_4);
				if (local_78 != NULL) {
					local_88 = param_1->float_8 * param_4;
					lego::game::Game_SetFlag1_20000(0);
					lego::res::Res_GetPosition(param_1->resData_24,NULL,&local_a0);
					lego::res::Res_GetPosition(local_78,NULL,&local_84);
					local_84.z = local_84.z - param_1->float_c / 10.0;
					fVar1 = param_1->float_90;
					param_1->float_90 = param_1->float_c;
					lego::res::Res_SetFramePosition
										(param_1->resData_24,param_1->resData_30,0.0,0.0,-param_1->float_90);
					lego::res::Res_GetPosition(param_1->resData_28,NULL,&local_b8);
					lego::res::Res_SetFramePosition(param_1->resData_28,NULL,local_84.x,local_84.y,local_84.z)
					;
					lego::res::Res_GetPosition(param_1->resData_24,NULL,&local_e0);
					local_c8 = local_e0.x - local_a0.x;
					local_c4 = local_e0.y - local_a0.y;
					local_c0 = local_e0.z - local_a0.z;
					fVar8 = (float10)FUN_0048e894();
					local_8c = (float)fVar8;
					if (((ushort)((ushort)(fVar8 < (float10)local_88) << 8 |
											 (ushort)(fVar8 == (float10)local_88) << 0xe) == 0) && (local_8c < 120.0)) {
						local_90 = local_8c / local_88;
						lego::res::Res_GetOrientation(local_78,NULL,&local_ac,NULL);
						local_d4 = local_ac.x * local_90;
						local_d0 = local_ac.y * local_90;
						local_cc = local_ac.z * local_90;
						local_84.x = local_84.x + local_d4;
						local_84.y = local_84.y + local_d0;
						local_84.z = local_84.z + local_cc;
						local_c8 = local_84.x - local_b8.x;
						local_c4 = local_84.y - local_b8.y;
						local_c0 = local_84.z - local_b8.z;
						fVar8 = (float10)FUN_0048e894((double)(local_c0 * local_c0 +
																									local_c4 * local_c4 + local_c8 * local_c8));
						local_94 = (float)fVar8;
						dVar5 = (double)(param_1->float_c - fVar1);
						fVar8 = FUN_0048e940(SUB84(dVar5,0),(uint)((ulonglong)dVar5 >> 0x20));
						local_bc = (float)fVar8;
						fVar2 = local_94 + local_bc;
						fVar8 = (float10)FUN_0048e894();
						fVar3 = 1.0 / (float)fVar8;
						fVar4 = (local_94 / fVar2) * local_88;
						local_c8 = local_c8 * fVar3 * fVar4;
						local_c4 = local_c4 * fVar3 * fVar4;
						local_c0 = local_c0 * fVar3 * fVar4;
						local_b8.x = local_b8.x + local_c8;
						local_b8.y = local_b8.y + local_c4;
						local_b8.z = local_b8.z + local_c0;
						lego::res::Res_SetFramePosition
											(param_1->resData_28,NULL,local_b8.x,local_b8.y,local_b8.z);
						if ((ushort)((ushort)(fVar1 < param_1->float_c) << 8 |
												(ushort)(fVar1 == param_1->float_c) << 0xe) == 0) {
							param_1->float_90 = fVar1 - (local_bc / fVar2) * local_88;
						}
						else {
							if (fVar1 != param_1->float_c) {
								param_1->float_90 = (local_bc / fVar2) * local_88 + fVar1;
							}
						}
						lego::res::Res_SetFramePosition
											(param_1->resData_24,param_1->resData_30,0.0,0.0,-param_1->float_90);
					}
					FUN_00436c16(param_1,param_1->float_10 * param_3);
				}
			}
		}
		goto LAB_004368f0;
	}
	if ((param_1->object_4 == NULL) || (param_3 == 0.0)) goto LAB_004368f0;
	lego::res::Res_GetPosition(param_1->resData_24,NULL,&local_58);
	lego::res::Res_GetOrientation(param_1->resData_24,NULL,&local_4c,&local_68);
	FUN_0044a330(param_1->object_4,param_1->field_14,&local_74,&local_68);
	if ((*(byte *)&param_1->flags & 0x10) == 0) {
LAB_0043621d:
		local_58.x = local_74;
		local_58.y = local_70;
		local_58.z = local_6c;
		local_4c.x = local_68.x;
		local_4c.y = local_68.y;
		local_4c.z = local_68.z;
	}
	else {
		fVar8 = (float10)FUN_0048e894((double)((local_6c - local_58.z) * (local_6c - local_58.z) +
																					(local_70 - local_58.y) * (local_70 - local_58.y) +
																					(local_74 - local_58.x) * (local_74 - local_58.x)));
		local_40 = (float)fVar8;
		if (((ushort)((ushort)(fVar8 < (float10)100.0) << 8 | (ushort)(fVar8 == (float10)100.0) << 0xe)
				 == 0) ||
			 (local_5c = local_68.x * local_4c.x + local_68.y * local_4c.y + local_68.z * local_4c.z,
			 local_5c < 0.0)) goto LAB_0043621d;
	}
	local_3c = (1.0 / param_3) * 4.0;
	fVar8 = (float10)FUN_0048e894((double)(local_4c.z * local_4c.z +
																				local_4c.y * local_4c.y + local_4c.x * local_4c.x));
	fVar1 = 1.0 / (float)fVar8;
	local_4c.x = local_4c.x * fVar1;
	local_4c.y = local_4c.y * fVar1;
	local_4c.z = local_4c.z * fVar1;
	fVar8 = (float10)FUN_0048e894();
	fVar1 = 1.0 / (float)fVar8;
	local_4c.x = local_4c.x * local_3c;
	local_4c.y = local_4c.y * local_3c;
	local_4c.z = local_4c.z * local_3c;
	local_68.x = local_68.x * fVar1 + local_4c.x;
	local_68.y = local_68.y * fVar1 + local_4c.y;
	local_68.z = local_68.z * fVar1 + local_4c.z;
	local_58.x = local_58.x * local_3c;
	local_58.y = local_58.y * local_3c;
	local_58.z = local_58.z * local_3c;
	fVar1 = 1.0 / (local_3c + 1.0);
	local_74 = (local_74 + local_58.x) * fVar1;
	local_70 = (local_70 + local_58.y) * fVar1;
	local_6c = (local_6c + local_58.z) * fVar1;
	if ((ushort)((ushort)(local_40 < 0.01) << 8 | (ushort)(local_40 == 0.01) << 0xe) == 0) {
		lego::res::Res_SetFramePosition(param_1->resData_24,NULL,local_74,local_70,local_6c);
	}
	if (local_5c < 0.99999) {
		lego::res::Res_SetFrameOrientation
							(param_1->resData_24,NULL,local_68.x,local_68.y,local_68.z,0.0,0.0,-1.0);
	}
	*(byte *)&param_1->flags = *(byte *)&param_1->flags | 0x10;
LAB_004368f0:
	if ((param_1->vector_a0).y <= (param_1->vector_a0).z) {
		(param_1->vector_ac).z = 0.0;
		(param_1->vector_ac).y = 0.0;
		(param_1->vector_ac).x = 0.0;
	}
	else {
		fVar1 = (param_1->vector_a0).y;
		fVar2 = (param_1->vector_a0).z;
		fVar3 = (param_1->vector_a0).y;
		fVar4 = (param_1->vector_a0).x;
		fVar8 = lego::game::Game_ChooseRandomRange(0.0,1.0);
		lego::math::Vector3_Random(&param_1->vector_ac);
		fVar1 = ((fVar1 - fVar2) / fVar3) * fVar4 * (float)fVar8;
		(param_1->vector_ac).x = (param_1->vector_ac).x * fVar1;
		(param_1->vector_ac).y = (param_1->vector_ac).y * fVar1;
		(param_1->vector_ac).z = (param_1->vector_ac).z * fVar1;
		(param_1->vector_a0).z = (param_1->vector_a0).z + param_4;
		lego::res::Res_AddTranslation
							(param_1->resData_24,D3DRMCOMBINE_BEFORE,-(param_1->vector_ac).x,
							 -(param_1->vector_ac).y,-(param_1->vector_ac).z);
	}
	return;
}



void __cdecl FUN_00436a53(Struct_bc *param_1,undefined4 param_2,undefined4 param_3)
{
	*(byte *)&param_1->flags = *(byte *)&param_1->flags | 1;
	*(undefined4 *)&param_1->field_0x7c = param_2;
	*(undefined4 *)&param_1->field_0x80 = param_3;
	return;
}



void __cdecl FUN_00436a82(void *param_1,float param_2)
{
	if ((((*(byte *)((int)param_1 + 0xb8) & 1) == 0) || ((*(byte *)((int)param_1 + 0xb8) & 8) != 0))
		 || ((*(float *)((int)param_1 + 0x7c) <= param_2 &&
				 ((ushort)((ushort)(param_2 < *(float *)((int)param_1 + 0x80)) << 8 |
									(ushort)(param_2 == *(float *)((int)param_1 + 0x80)) << 0xe) != 0)))) {
		*(float *)((int)param_1 + 0x78) = param_2;
		lego::res::Res_SetFrameOrientation
							(*(ResourceData **)((int)param_1 + 0x30),*(ResourceData **)((int)param_1 + 0x28),0.0,
							 0.0,1.0,0.0,1.0,0.0);
		lego::res::Res_AddRotation
							(*(ResourceData **)((int)param_1 + 0x30),D3DRMCOMBINE_BEFORE,1.0,0.0,0.0,-param_2);
	}
	return;
}



void __cdecl FUN_00436b22(void *param_1,float param_2)
{
	FUN_00436a82(param_1,param_2 + *(float *)((int)param_1 + 0x78));
	return;
}



void __cdecl FUN_00436b43(int param_1,undefined4 param_2,undefined4 param_3)
{
	*(byte *)(param_1 + 0xb8) = *(byte *)(param_1 + 0xb8) | 2;
	*(undefined4 *)(param_1 + 0x88) = param_2;
	*(undefined4 *)(param_1 + 0x8c) = param_3;
	return;
}



void __cdecl FUN_00436b75(void *param_1,float param_2)
{
	if ((((*(byte *)((int)param_1 + 0xb8) & 2) == 0) || ((*(byte *)((int)param_1 + 0xb8) & 8) != 0))
		 || ((*(float *)((int)param_1 + 0x88) <= param_2 &&
				 ((ushort)((ushort)(param_2 < *(float *)((int)param_1 + 0x8c)) << 8 |
									(ushort)(param_2 == *(float *)((int)param_1 + 0x8c)) << 0xe) != 0)))) {
		*(float *)((int)param_1 + 0x84) = param_2;
		lego::res::Res_SetFrameOrientation
							(*(ResourceData **)((int)param_1 + 0x28),NULL,0.0,0.0,1.0,0.0,1.0,0.0);
		lego::res::Res_AddRotation
							(*(ResourceData **)((int)param_1 + 0x28),D3DRMCOMBINE_BEFORE,0.0,0.0,1.0,-param_2);
	}
	return;
}



void __cdecl FUN_00436c16(void *param_1,float param_2)
{
	FUN_00436b75(param_1,param_2 + *(float *)((int)param_1 + 0x84));
	return;
}



void __cdecl FUN_00436c3a(Struct_bc *param_1,undefined4 param_2,undefined4 param_3)
{
	*(byte *)&param_1->flags = *(byte *)&param_1->flags | 4;
	*(undefined4 *)&param_1->field_0x94 = param_2;
	*(undefined4 *)&param_1->field_0x98 = param_3;
	return;
}



void __cdecl FUN_00436c6c(void *param_1,float param_2)
{
	if ((((*(byte *)((int)param_1 + 0xb8) & 4) == 0) || ((*(byte *)((int)param_1 + 0xb8) & 8) != 0))
		 || ((*(float *)((int)param_1 + 0x94) <= param_2 &&
				 ((ushort)((ushort)(param_2 < *(float *)((int)param_1 + 0x98)) << 8 |
									(ushort)(param_2 == *(float *)((int)param_1 + 0x98)) << 0xe) != 0)))) {
		*(float *)((int)param_1 + 0x90) = param_2;
	}
	return;
}



void __cdecl FUN_00436cc7(void *param_1,float param_2)
{
	FUN_00436c6c(param_1,param_2 + *(float *)((int)param_1 + 0x90));
	return;
}



void __cdecl FUN_00436ceb(int param_1,float param_2,float param_3)
{
	lego::res::Res_AddTranslation
						(*(ResourceData **)(param_1 + 0x28),D3DRMCOMBINE_BEFORE,param_2,param_3,0.0);
	return;
}



void __cdecl FUN_00436d0b(int *param_1,Vector3F *param_2)
{
	if (*param_1 == 1) {
		lego::res::Res_GetPosition((ResourceData *)param_1[10],NULL,param_2);
	}
	return;
}



void __cdecl FUN_00436d2d(Struct_bc *param_1,float param_2,float param_3)
{
	if (param_1->mode_0 == 1) {
		lego::res::Res_SetFramePosition(param_1->resData_28,NULL,param_2,param_3,0.0);
	}
	return;
}



undefined4 __cdecl FUN_00436d55(int *param_1,uint *param_2,float *param_3)
{
	float10 fVar1;
	
	if (*param_1 == 1) {
		lego::res::Res_GetPosition((ResourceData *)param_1[10],NULL,(Vector3F *)param_3);
		fVar1 = lego::game::SurfaceMap_UnkGetZ((LevelSurfaceMap *)param_2,*param_3,param_3[1]);
		param_3[2] = (float)fVar1;
	}
	return 1;
}



float10 __cdecl FUN_00436d9b(int param_1)
{
	return (float10)*(float *)(param_1 + 0x84);
}



void __cdecl FUN_00436da9(int param_1,float *param_2,float param_3)
{
	float fVar1;
	float10 fVar2;
	
	fVar2 = (float10)FUN_0048e894((double)(param_2[2] * param_2[2] +
																				param_2[1] * param_2[1] + *param_2 * *param_2));
	fVar1 = 1.0 / (float)fVar2;
	*param_2 = *param_2 * fVar1;
	param_2[1] = param_2[1] * fVar1;
	param_2[2] = param_2[2] * fVar1;
	*(float *)(param_1 + 0x9c) =
			 param_3 * lego::globals::g_CameraAcceleration + *(float *)(param_1 + 0x9c);
	if ((ushort)((ushort)(*(float *)(param_1 + 0x9c) < lego::globals::g_CameraSpeed) << 8 |
							(ushort)(*(float *)(param_1 + 0x9c) == lego::globals::g_CameraSpeed) << 0xe) == 0) {
		*(float *)(param_1 + 0x9c) = lego::globals::g_CameraSpeed;
	}
	fVar1 = *(float *)(param_1 + 0x9c) * param_3;
	*param_2 = *param_2 * fVar1;
	param_2[1] = param_2[1] * fVar1;
	param_2[2] = param_2[2] * fVar1;
	*(float *)(param_1 + 0x18) = *(float *)(param_1 + 0x18) + *param_2;
	*(float *)(param_1 + 0x1c) = *(float *)(param_1 + 0x1c) + param_2[1];
	*(float *)(param_1 + 0x20) = *(float *)(param_1 + 0x20) + param_2[2];
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl lego::pool::ReservedPool_LiveObject___Init(void)
{
	int iVar1;
	LiveObject **ppLVar2;
	
	ppLVar2 = globals::ReservedPool_LiveObject___g_TABLE;
	for (iVar1 = 0x318f; iVar1 != 0; iVar1 += -1) {
		*ppLVar2 = NULL;
		ppLVar2 = ppLVar2 + 1;
	}
	lego::globals::g_Activities_TABLE[0] = "Activity_Stand";
	lego::globals::g_Activities_TABLE[1] = "Activity_Route";
	lego::globals::g_Activities_TABLE[2] = "Activity_RouteRubble";
	lego::globals::g_Activities_TABLE[3] = "Activity_RunPanic";
	lego::globals::g_Activities_TABLE[4] = "Activity_Drill";
	lego::globals::g_Activities_TABLE[5] = "Activity_Teleport";
	lego::globals::g_Activities_TABLE[6] = "Activity_Walk";
	lego::globals::g_Activities_TABLE[7] = "Activity_Reinforce";
	lego::globals::g_Activities_TABLE[8] = "Activity_Reverse";
	lego::globals::g_Activities_TABLE[9] = "Activity_TurnLeft";
	lego::globals::g_Activities_TABLE[10] = "Activity_TurnRight";
	lego::globals::g_Activities_TABLE[11] = "Activity_CantDo";
	lego::globals::g_Activities_TABLE[12] = "Activity_Emerge";
	lego::globals::g_Activities_TABLE[13] = "Activity_Enter";
	lego::globals::g_Activities_TABLE[14] = "Activity_EnterRein";
	lego::globals::g_Activities_TABLE[15] = "Activity_Collect";
	lego::globals::g_Activities_TABLE[16] = "Activity_Gather";
	lego::globals::g_Activities_TABLE[17] = "Activity_Carry";
	lego::globals::g_Activities_TABLE[18] = "Activity_CarryRubble";
	lego::globals::g_Activities_TABLE[19] = "Activity_Throw";
	lego::globals::g_Activities_TABLE[20] = "Activity_CarryTurnLeft";
	lego::globals::g_Activities_TABLE[21] = "Activity_CarryTurnRight";
	lego::globals::g_Activities_TABLE[22] = "Activity_CarryStand";
	lego::globals::g_Activities_TABLE[23] = "Activity_HitLeft";
	lego::globals::g_Activities_TABLE[24] = "Activity_HitRight";
	lego::globals::g_Activities_TABLE[25] = "Activity_HitFront";
	lego::globals::g_Activities_TABLE[26] = "Activity_HitBack";
	lego::globals::g_Activities_TABLE[27] = "Activity_HitHard";
	lego::globals::g_Activities_TABLE[28] = "Activity_Dynamite";
	lego::globals::g_Activities_TABLE[29] = "Activity_Deposit";
	lego::globals::g_Activities_TABLE[30] = "Activity_Clear";
	lego::globals::g_Activities_TABLE[31] = "Activity_Place";
	lego::globals::g_Activities_TABLE[32] = "Activity_Repair";
	lego::globals::g_Activities_TABLE[33] = "Activity_Slip";
	lego::globals::g_Activities_TABLE[34] = "Activity_Rest";
	lego::globals::g_Activities_TABLE[35] = "Activity_Eat";
	lego::globals::g_Activities_TABLE[36] = "Activity_Stamp";
	lego::globals::g_Activities_TABLE[37] = "Activity_ThrowMan";
	lego::globals::g_Activities_TABLE[38] = "Activity_ThrownByRockMonster";
	lego::globals::g_Activities_TABLE[39] = "Activity_GetUp";
	lego::globals::g_Activities_TABLE[40] = "Activity_BuildPath";
	lego::globals::g_Activities_TABLE[41] = "Activity_Upgrade";
	lego::globals::g_Activities_TABLE[42] = "Activity_Explode";
	lego::globals::g_Activities_TABLE[43] = "Activity_Unpowered";
	lego::globals::g_Activities_TABLE[44] = "Activity_FireLaser";
	lego::globals::g_Activities_TABLE[45] = "Activity_Freezed";
	lego::globals::g_Activities_TABLE[46] = "Activity_FreezeStart";
	lego::globals::g_Activities_TABLE[47] = "Activity_FreezeMelt";
	lego::globals::g_Activities_TABLE[48] = "Activity_Recharge";
	lego::globals::g_Activities_TABLE[49] = "Activity_WakeUp";
	lego::globals::g_Activities_TABLE[50] = "Activity_Train";
	lego::globals::g_Activities_TABLE[51] = "Activity_FloatOn";
	lego::globals::g_Activities_TABLE[52] = "Activity_FloatOff";
	lego::globals::g_Activities_TABLE[53] = "Activity_Opening";
	lego::globals::g_Activities_TABLE[54] = "Activity_Closing";
	lego::globals::g_Activities_TABLE[55] = "Activity_Open";
	lego::globals::g_Activities_TABLE[56] = "Activity_Waiting1";
	lego::globals::g_Activities_TABLE[57] = "Activity_Waiting2";
	lego::globals::g_Activities_TABLE[58] = "Activity_Waiting3";
	lego::globals::g_Activities_TABLE[59] = "Activity_Waiting4";
	lego::globals::g_Activities_TABLE[60] = "Activity_Waiting5";
	lego::globals::g_Activities_TABLE[61] = "Activity_Waiting6";
	lego::globals::g_Activities_TABLE[62] = "Activity_Waiting7";
	lego::globals::g_Activities_TABLE[63] = "Activity_Waiting8";
	lego::globals::g_Activities_TABLE[64] = "Activity_Waiting9";
	lego::globals::g_Activities_TABLE[65] = "Activity_Waiting10";
	lego::globals::g_Activities_TABLE[66] = "Activity_Waiting11";
	lego::globals::g_Activities_TABLE[67] = "Activity_Waiting12";
	lego::globals::g_Activities_TABLE[68] = "Activity_Waiting13";
	lego::globals::g_Activities_TABLE[69] = "Activity_Waiting14";
	lego::globals::g_Activities_TABLE[70] = "Activity_Waiting15";
	lego::globals::g_Activities_TABLE[71] = "Activity_Waiting16";
	lego::globals::g_Activities_TABLE[72] = "Activity_Waiting17";
	lego::globals::g_Activities_TABLE[73] = "Activity_Waiting18";
	lego::globals::g_Activities_TABLE[74] = "Activity_Waiting19";
	lego::globals::g_Activities_TABLE[75] = "Activity_Waiting20";
	lego::globals::g_Activities_TABLE[76] = "Activity_Waiting21";
	lego::globals::g_Activities_TABLE[77] = "Activity_Crumble";
	lego::globals::g_Activities_TABLE[78] = "Activity_TeleportIn";
	lego::globals::g_AbilityTypes_TABLE[0] = "LegoObject_AbilityType_Pilot";
	lego::globals::g_AbilityTypes_TABLE[1] = "LegoObject_AbilityType_Sailor";
	lego::globals::g_AbilityTypes_TABLE[2] = "LegoObject_AbilityType_Driver";
	lego::globals::g_AbilityTypes_TABLE[3] = "LegoObject_AbilityType_Dynamite";
	lego::globals::g_AbilityTypes_TABLE[4] = "LegoObject_AbilityType_Repair";
	lego::globals::g_AbilityTypes_TABLE[5] = "LegoObject_AbilityType_Scanner";
	ppLVar2 = globals::ReservedPool_LiveObject___g_TABLE;
	for (iVar1 = 0x20; iVar1 != 0; iVar1 += -1) {
		*ppLVar2 = NULL;
		ppLVar2 = ppLVar2 + 1;
	}
	globals::ReservedPool_LiveObject___g_NEXT = NULL;
	globals::ReservedPool_LiveObject___g_COUNT = 0;
	globals::ReservedPool_LiveObject___g_INITFLAGS = 1;
	DAT_004dfe18 = 0;
	_DAT_004dfe1c = 0;
	_DAT_004dfe20 = 1;
	_DAT_004dfe24 = 1;
	_DAT_004dfe28 = 4;
	_DAT_004dfe2c = 4;
	_DAT_004dfe30 = 4;
	_DAT_004dfe34 = 4;
	DAT_004dfe38 = 3;
	DAT_004dfe3c = 2;
	DAT_004dfe40 = 4;
	lego::globals::g_Game.ToolTypes_TABLE[0] = "LegoObject_ToolType_Drill";
	lego::globals::g_Game.ToolTypes_TABLE[1] = "LegoObject_ToolType_Spade";
	lego::globals::g_Game.ToolTypes_TABLE[2] = "LegoObject_ToolType_Hammer";
	lego::globals::g_Game.ToolTypes_TABLE[3] = "LegoObject_ToolType_Spanner";
	lego::globals::g_Game.ToolTypes_TABLE[4] = "LegoObject_ToolType_Laser";
	lego::globals::g_Game.ToolTypes_TABLE[5] = "LegoObject_ToolType_PusherGun";
	lego::globals::g_Game.ToolTypes_TABLE[6] = "LegoObject_ToolType_BirdScarer";
	lego::globals::g_Game.ToolTypes_TABLE[7] = "LegoObject_ToolType_FreezerGun";
	return;
}



void __cdecl lego::pool::ReservedPool_LiveObject___Cleanup(void)
{
	LiveObject **ppLVar1;
	
	FUN_0043b5e0();
	ppLVar1 = globals::ReservedPool_LiveObject___g_TABLE;
	do {
		if (*ppLVar1 != NULL) {
			std::free(*ppLVar1);
		}
		ppLVar1 = ppLVar1 + 1;
	} while (ppLVar1 < &globals::ReservedPool_LiveObject___g_NEXT);
	globals::ReservedPool_LiveObject___g_NEXT = NULL;
	globals::ReservedPool_LiveObject___g_INITFLAGS = 0;
	if (lego::globals::g_UnkSurfaceGrid_1_TABLE != NULL) {
		std::free(lego::globals::g_UnkSurfaceGrid_1_TABLE);
	}
	globals::ReservedPool_LiveObject___g_INITFLAGS =
			 globals::ReservedPool_LiveObject___g_INITFLAGS & 0xfffffffe;
	return;
}



void __cdecl FUN_00437370(undefined4 *param_1)
{
	int iVar1;
	undefined4 *puVar2;
	
	puVar2 = &DAT_004eb7ac;
	for (iVar1 = 6; iVar1 != 0; iVar1 += -1) {
		*param_1 = *puVar2;
		puVar2 = puVar2 + 1;
		param_1 = param_1 + 1;
	}
	return;
}



void __cdecl FUN_00437390(undefined4 *param_1)
{
	int iVar1;
	undefined4 *puVar2;
	
	iVar1 = 6;
	if (param_1 != NULL) {
		puVar2 = &DAT_004eb7ac;
		for (; iVar1 != 0; iVar1 += -1) {
			*puVar2 = *param_1;
			param_1 = param_1 + 1;
			puVar2 = puVar2 + 1;
		}
		return;
	}
	puVar2 = &DAT_004eb7ac;
	for (; iVar1 != 0; iVar1 += -1) {
		*puVar2 = 0;
		puVar2 = puVar2 + 1;
	}
	return;
}



int __cdecl FUN_004373c0(int param_1,int param_2)
{
	ObjectStatsFlags1 OVar1;
	int iVar2;
	int iVar3;
	uint objIndex;
	uint objLevel;
	
	iVar3 = 0;
	objIndex = 0;
	do {
		objLevel = 0;
		do {
			if (param_2 == 0) {
LAB_004373e4:
				iVar2 = lego::game::LiveObject_GetOrSubLevelsTable(param_1,objIndex,objLevel,1);
				iVar3 += iVar2;
			}
			else {
				OVar1 = lego::game::Object_GetStatsFlags1(param_1,objIndex);
				if ((OVar1 & STATS1_STOREOBJECTS) == STATS1_NONE) goto LAB_004373e4;
			}
			objLevel += 1;
		} while (objLevel < 0x10);
		objIndex += 1;
		if (0xe < objIndex) {
			return iVar3;
		}
	} while( true );
}



void __cdecl lego::main::Main_LoadToolTipIcons(CFGProperty *root)
{
	char *keyPath;
	CFGProperty *prop;
	int iVar1;
	ImageBMP *pIVar2;
	int iVar3;
	char **ppcVar4;
	
	keyPath = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"ToolTipIcons",0);
	prop = cfg::CFG_GetBlockFirstChild(root,keyPath);
	do {
		if (prop == NULL) {
			if (globals::g_ToolTipIcon_Ore != NULL) {
				image::Image_unkFogFromFloat__0047deb0(globals::g_ToolTipIcon_Ore,0.0,0.0,0.0,0.0,0.0,0.0);
			}
			return;
		}
		iVar3 = 0;
		ppcVar4 = globals::g_Game.ToolTypes_TABLE;
		do {
			if ((*ppcVar4 != NULL) && (iVar1 = std::_stricmp(prop->key,*ppcVar4), iVar1 == 0)) {
				pIVar2 = image::Image_LoadBMP(prop->value,0,0);
				globals::g_ToolTipIcons_Tools_TABLE[iVar3] = pIVar2;
				break;
			}
			ppcVar4 = ppcVar4 + 1;
			iVar3 += 1;
		} while (ppcVar4 < globals::g_Game.ToolNames_TABLE);
		if (iVar3 == 0xb) {
			iVar3 = 0;
			ppcVar4 = globals::g_AbilityTypes_TABLE;
			do {
				if (((ImageBMP *)*ppcVar4 != NULL) &&
					 (iVar1 = std::_stricmp(prop->key,(char *)(ImageBMP *)*ppcVar4), iVar1 == 0)) {
					pIVar2 = image::Image_LoadBMP(prop->value,0,0);
					globals::g_ToolTipIcons_Abilities_TABLE[iVar3] = pIVar2;
					break;
				}
				ppcVar4 = (char **)((ImageBMP **)ppcVar4 + 1);
				iVar3 += 1;
			} while (ppcVar4 < globals::g_ToolTipIcons_Abilities_TABLE);
		}
		if (iVar3 == 6) {
			iVar3 = std::_stricmp(prop->key,"Blank");
			if (iVar3 == 0) {
				globals::g_ToolTipIcon_Blank = image::Image_LoadBMP(prop->value,0,0);
			}
			else {
				iVar3 = std::_stricmp(prop->key,"Ore");
				if (iVar3 == 0) {
					globals::g_ToolTipIcon_Ore = image::Image_LoadBMP(prop->value,0,0);
				}
			}
		}
		prop = cfg::CFG_NextFlatProperty(prop);
	} while( true );
}



void __cdecl FUN_00437560(void)
{
	int iVar1;
	Point2I *pPVar2;
	LiveObject **ppLVar3;
	
	FUN_0043b5e0();
	FUN_00437700();
	FUN_00437ba0();
	pPVar2 = lego::globals::g_SlimySlugHoles_TABLE;
	for (iVar1 = 0x28; iVar1 != 0; iVar1 += -1) {
		pPVar2->x = 0;
		pPVar2 = (Point2I *)&pPVar2->y;
	}
	pPVar2 = lego::globals::g_RechargeSeams_TABLE;
	for (iVar1 = 0x14; iVar1 != 0; iVar1 += -1) {
		pPVar2->x = 0;
		pPVar2 = (Point2I *)&pPVar2->y;
	}
	lego::globals::g_SlimySlugHoles_COUNT = 0;
	lego::globals::g_RechargeSeams_COUNT = 0;
	FLOAT_004eb7a8 = 0.0;
	ppLVar3 = PTR_ARRAY_004ebbcc;
	for (iVar1 = 100; iVar1 != 0; iVar1 += -1) {
		*ppLVar3 = NULL;
		ppLVar3 = ppLVar3 + 1;
	}
	UINT_004ebd5c = 0;
	lego::game::Game_SetNumBuildingsTeleported(0);
	return;
}



void __cdecl FUN_004375c0(LiveObject *in_liveObj,int param_2,float param_3)
{
	LiveObject *pLVar1;
	float10 fVar2;
	Point2I local_8;
	
	if (param_2 == -1) {
		fVar2 = (float10)param_3;
	}
	else {
		fVar2 = FUN_0046f400(param_2);
		fVar2 = fVar2 * (float10)param_3;
	}
	FLOAT_004eb7a8 = (float)(fVar2 + (float10)FLOAT_004eb7a8);
	lego::game::LiveObject_GetBlockCoordinates(in_liveObj,(int *)&local_8,&local_8.y);
	while (((1.0 <= FLOAT_004eb7a8 &&
					(pLVar1 = FUN_00438d20(&local_8,OBJECT_POWERCRYSTAL,0,0), pLVar1 != NULL)) &&
				 (pLVar1 = (LiveObject *)FUN_0043a910(pLVar1,OBJECT_POWERCRYSTAL,0,0), pLVar1 != NULL))) {
		pLVar1->flags3_3e8 = pLVar1->flags3_3e8 | 0x80000000;
		lego::game::LiveObject_SetCrystalPoweredColor(pLVar1,0);
		FLOAT_004eb7a8 = FLOAT_004eb7a8 - 1.0;
	}
	return;
}



void __cdecl FUN_00437690(uint *param_1,int param_2)
{
	if ((param_2 == 0) && ((param_1[0xfb] & 0x2000) != 0)) {
		param_1[0xfb] = param_1[0xfb] & 0xffffdfff | 0x4000;
		lego::game::LiveObject_SetActivityUnk((LiveObject *)param_1,ACTIVITY_CLOSING,0);
		lego::game::Game_UpdateSomeAITasks((LiveObject *)param_1);
		return;
	}
	if ((param_2 != 0) && ((param_1[0xfb] & 0x2000) == 0)) {
		param_1[0xfb] = param_1[0xfb] | 0x1000;
		lego::game::LiveObject_SetActivityUnk((LiveObject *)param_1,ACTIVITY_OPENING,0);
	}
	lego::game::Game_UpdateSomeAITasks((LiveObject *)param_1);
	return;
}



void __cdecl FUN_00437700(void)
{
	int iVar1;
	uint (*paauVar2) [15] [16];
	
	paauVar2 = lego::globals::g_LiveObjectLevels_Previous_TABLE;
	for (iVar1 = 0x12c0; iVar1 != 0; iVar1 += -1) {
		(*paauVar2)[0] = 0;
		paauVar2 = (uint (*) [15] [16])(*paauVar2 + 1);
	}
	paauVar2 = lego::globals::g_LiveObjectLevels_Current_TABLE;
	for (iVar1 = 0x12c0; iVar1 != 0; iVar1 += -1) {
		(*paauVar2)[0] = 0;
		paauVar2 = (uint (*) [15] [16])(*paauVar2 + 1);
	}
	return;
}



int __cdecl
lego::game::LiveObject_GetOrSubLevelsTable
					(ObjectType objType,int objIndex,int objLevel,BOOL doSubtract)
{
	uint uVar1;
	
	uVar1 = globals::g_LiveObjectLevels_Current_TABLE[objType][objIndex][objLevel];
	if (doSubtract != 0) {
		uVar1 -= globals::g_LiveObjectLevels_Previous_TABLE[objType][objIndex][objLevel];
	}
	return uVar1;
}



uint __cdecl lego::game::LiveObject_GetPreviousLevel(ObjectType objType,int objIndex,int objLevel)
{
	return globals::g_LiveObjectLevels_Previous_TABLE[objType][objIndex][objLevel];
}



void __cdecl lego::unk::Lego_PathLiveLevelsIncrementConditional(BOOL param_1)
{
	if (param_1 != 0) {
		globals::g_LiveObjectLevels_Current_TABLE[15][0][0] += 1;
		return;
	}
	globals::g_LiveObjectLevels_Previous_TABLE[15][0][0] += 1;
	return;
}



void __cdecl FUN_004377b0(LiveObject *liveObj)
{
	if (liveObj->objType != OBJECT_BOULDER) {
		FUN_00437a70(FUN_004377d0,liveObj);
	}
	return;
}



undefined4 __cdecl FUN_004377d0(LiveObject *liveObj1,LiveObject *liveObj2)
{
	if (liveObj1->object_2fc == liveObj2) {
		lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj1,0);
		liveObj1->object_2fc = NULL;
	}
	return 0;
}



undefined4 __cdecl lego::pool::ReservedPool_LiveObject___Release(LiveObject *liveObj)
{
	LiveFlags4 *pLVar1;
	LiveObject *pLVar2;
	ObjectType OVar3;
	ObjectStatsFlags1 OVar4;
	VehicleData *buffer;
	
	lego::globals::g_LiveObjectLevels_Previous_TABLE[liveObj->objType][liveObj->objIndex]
	[liveObj->objLevel] =
			 lego::globals::g_LiveObjectLevels_Previous_TABLE[liveObj->objType][liveObj->objIndex]
			 [liveObj->objLevel] + 1;
	if ((liveObj->flags4_3ec & 0x100000) != 0) {
		snd::Sample_StopSoundBufferInstance(liveObj->field_350);
	}
	if ((liveObj->flags4_3ec & 0x80000) != 0) {
		snd::Sample_StopSoundBufferInstance(liveObj->field_354);
	}
	FUN_00437a70(FUN_00472320,liveObj);
	if (liveObj->objType == OBJECT_ROCKMONSTER) {
		FUN_004029d0(liveObj);
	}
	if (liveObj->resData_2e4 != NULL) {
		ReservedPool_ResourceData___Release(liveObj->resData_2e4);
	}
	if (liveObj->carryingThisObject != NULL) {
		FUN_0043a130(liveObj->carryingThisObject,0);
	}
	if ((liveObj->flags4_3ec & 0x40) != 0) {
		liveObj->flags4_3ec = liveObj->flags4_3ec & 0xffffffbf;
		if (liveObj->object_2fc != NULL) {
			pLVar1 = &liveObj->object_2fc->flags4_3ec;
			*pLVar1 = *pLVar1 & 0xffffffbf;
		}
	}
	FUN_0043abf0(liveObj);
	if ((*(byte *)&liveObj->flags4_3ec & 1) != 0) {
		lego::globals::g_Game.flags1 &= ~GAME1_LASERTRACKER;
	}
	if ((*(byte *)&liveObj->flags4_3ec & 0x80) != 0) {
		pLVar2 = liveObj->object_2fc;
		if (pLVar2 != NULL) {
			pLVar2->flags4_3ec = pLVar2->flags4_3ec & 0xffffff7f;
		}
		liveObj->object_2fc = NULL;
	}
	game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,0);
	FUN_00447bc0(liveObj);
	FUN_0043a130(liveObj,0);
	FUN_00403980(liveObj);
	FUN_0043f820(liveObj);
	FUN_0040e840(liveObj);
	OVar4 = game::LiveObject_GetStatsFlags1(liveObj);
	if (((OVar4 & STATS1_PROCESSCRYSTAL) != STATS1_NONE) ||
		 (OVar4 = game::LiveObject_GetStatsFlags1(liveObj), (OVar4 & STATS1_PROCESSORE) != STATS1_NONE))
	{
		FUN_00403940(liveObj);
	}
	FUN_00452770(liveObj);
	FUN_00419760(liveObj);
	FUN_004072d0(liveObj);
	FUN_004377b0(liveObj);
	FUN_0042def0(liveObj);
	OVar3 = liveObj->objType;
	if (OVar3 == OBJECT_VEHICLE) {
		FUN_0046d0d0((int)liveObj->vehicle);
		buffer = liveObj->vehicle;
	}
	else {
		if (OVar3 == OBJECT_MINIFIGURE) {
			res::Creature_Destroy(liveObj->miniFigure);
			buffer = (VehicleData *)liveObj->miniFigure;
		}
		else {
			if (OVar3 == OBJECT_ROCKMONSTER) {
				OVar4 = game::LiveObject_GetStatsFlags1(liveObj);
				if ((OVar4 & STATS1_FLOCKS) != STATS1_NONE) {
					FUN_0044c0f0(liveObj);
				}
				res::Creature_Destroy(liveObj->rockMonster);
				buffer = (VehicleData *)liveObj->rockMonster;
			}
			else {
				if (OVar3 == OBJECT_BUILDING) {
					game::LiveObject_ReleaseBuilding(liveObj->building);
					buffer = (VehicleData *)liveObj->building;
				}
				else {
					if ((liveObj->flags3_3e8 & LIVEOBJ3_SIMPLEOBJECT) != LIVEOBJ3_NONE) {
						ReservedPool_ResourceData___Release(liveObj->other);
						goto LAB_00437a4d;
					}
					if (OVar3 != OBJECT_UPGRADEPART) goto LAB_00437a4d;
					FUN_0046c3b0((int)liveObj->upgrade);
					buffer = (VehicleData *)liveObj->upgrade;
				}
			}
		}
	}
	std::free(buffer);
LAB_00437a4d:
	liveObj->pool_m_next = globals::ReservedPool_LiveObject___g_NEXT;
	globals::ReservedPool_LiveObject___g_NEXT = liveObj;
	return 0;
}



BOOL __cdecl FUN_00437a70(LiveObjectPredicate *predicateFunc,LiveObject *liveObj)
{
	BOOL BVar1;
	
	BVar1 = FUN_00437a90(predicateFunc,liveObj,1);
	return BVar1;
}



BOOL __cdecl FUN_00437a90(LiveObjectPredicate *predicateFunc,void *context,BOOL param_3)
{
	LiveObject *liveObj;
	BOOL BVar1;
	int iVar2;
	LiveObject **ppLVar3;
	uint uVar4;
	uint uVar5;
	uint tblIndex;
	
	tblIndex = 0;
	if (lego::pool::globals::ReservedPool_LiveObject___g_COUNT == 0) {
		return 0;
	}
	ppLVar3 = lego::pool::globals::ReservedPool_LiveObject___g_TABLE;
	do {
		if (*ppLVar3 != NULL) {
			uVar5 = 0;
			uVar4 = 1 << ((byte)tblIndex & 0x1f);
			if (uVar4 != 0) {
				iVar2 = 0;
				do {
					liveObj = (LiveObject *)((int)(*ppLVar3)->floats_34 + iVar2 + -0x34);
					if ((((liveObj != NULL) && (liveObj->pool_m_next == liveObj)) &&
							((param_3 == 0 || ((liveObj->flags3_3e8 & LIVEOBJ3_UNK_80000) == LIVEOBJ3_NONE)))) &&
						 (BVar1 = (*predicateFunc)(liveObj,context), BVar1 != 0)) {
						return 1;
					}
					uVar5 += 1;
					iVar2 += 0x40c;
				} while (uVar5 < uVar4);
			}
		}
		tblIndex += 1;
		ppLVar3 = ppLVar3 + 1;
		if (lego::pool::globals::ReservedPool_LiveObject___g_COUNT <= tblIndex) {
			return 0;
		}
	} while( true );
}



void __cdecl lego::game::LiveObject_SetCustomName(LiveObject *liveObj,char *customName)
{
	char *pcVar1;
	
	if ((customName != NULL) && (*customName != '\0')) {
										// There is no regard for memory bounds here,
										// allocates 11 bytes, assigns bytes[11]...
										// why......
		if (liveObj->customName == NULL) {
			pcVar1 = (char *)std::malloc(0xb);
			liveObj->customName = pcVar1;
		}
		std::_strncpy(liveObj->customName,customName,0xb);
		liveObj->customName[0xb] = '\0';
		return;
	}
	if (liveObj->customName != NULL) {
		std::free(liveObj->customName);
	}
	liveObj->customName = NULL;
	return;
}



void __cdecl FUN_00437ba0(void)
{
	int iVar1;
	void **ppvVar2;
	uint uVar3;
	undefined4 *puVar4;
	
	uVar3 = 0;
	if (DAT_004eb7a4 != 0) {
		ppvVar2 = (void **)&DAT_004e9568;
		do {
			if (ppvVar2[1] != NULL) {
				std::free(ppvVar2[1]);
			}
			if (*ppvVar2 != NULL) {
				std::free(*ppvVar2);
			}
			uVar3 += 1;
			ppvVar2 = ppvVar2 + 0xb;
		} while (uVar3 < DAT_004eb7a4);
	}
	DAT_004eb7a4 = 0;
	puVar4 = &DAT_004e9544;
	for (iVar1 = 200; iVar1 != 0; iVar1 += -1) {
		*puVar4 = 0;
		puVar4 = puVar4 + 1;
	}
	FUN_00454b50();
	return;
}



void __cdecl FUN_00437c00(Point2I *param_1)
{
	char *pcVar1;
	char *pcVar2;
	LiveObject *liveObj;
	int iVar3;
	uint *puVar4;
	LiveObject *pLVar5;
	ObjectStatsFlags3 OVar6;
	ObjectStatsFlags1 OVar7;
	int *piVar8;
	int *piVar9;
	uint uVar10;
	int *piVar11;
	uint uVar12;
	longlong lVar13;
	TrainedFlags trainFlags;
	char **local_96c;
	uint local_968;
	uint local_964;
	LiveObject *apLStack2400 [200];
	char *local_640 [200];
	char *apcStack800 [200];
	
	uVar12 = 0;
	uVar10 = 0;
	local_968 = 0;
	if (DAT_004eb7a4 != 0) {
		local_96c = local_640;
		piVar8 = &DAT_004e9544;
		do {
			piVar9 = piVar8;
			if ((*piVar8 == param_1->x) && (piVar8[1] == param_1->y)) {
				if (piVar8[6] == OBJECT_BUILDING) {
					iVar3 = FUN_00408290(lego::globals::g_Game.BuildingData_TABLE + piVar8[7],&local_964);
					lVar13 = __ftol((float10)(float)piVar8[4] * (float10)0.1591549 * (float10)8.0);
					uVar12 = ((uint)lVar13 & 1) + (uint)lVar13 >> 1;
					puVar4 = FUN_004643d0(piVar8,iVar3,local_964,uVar12);
					pLVar5 = (LiveObject *)FUN_004099c0(piVar8[7],piVar8,uVar12,puVar4,local_964,0);
					uVar12 = local_968;
				}
				else {
					pLVar5 = lego::game::LiveObject__Create((int **)piVar8[5],piVar8[6],piVar8[7]);
				}
				if (pLVar5 != NULL) {
					if (piVar8[6] != 4) {
						FUN_00442b60(pLVar5,(float)piVar8[2],(float)piVar8[3],piVar8[4],1);
					}
					iVar3 = piVar8[6];
					if ((((iVar3 == 6) || (iVar3 == 7)) || (iVar3 == 8)) || (iVar3 == 9)) {
						FUN_00402650(pLVar5,0.0);
					}
					pLVar5->health = (float)piVar8[8];
					if (pLVar5->objType == OBJECT_MINIFIGURE) {
						FUN_00454b40();
						lego::game::Info_FUN_00419ab0(INFO_FOUNDMINIFIGURE,NULL,pLVar5,NULL);
					}
					pLVar5->flags4_3ec = pLVar5->flags4_3ec | 0x200;
					FUN_00438720(pLVar5);
					if (pLVar5->objType == OBJECT_ELECTRICFENCE) {
						FUN_0040ce80(pLVar5);
					}
					pcVar1 = (char *)piVar8[9];
					pcVar2 = (char *)piVar8[10];
					apLStack2400[uVar12] = pLVar5;
					apcStack800[uVar12] = pcVar1;
					*local_96c = pcVar2;
					local_968 = uVar12 + 1;
					local_96c = local_96c + 1;
					piVar8[9] = 0;
				}
				DAT_004eb7a4 -= 1;
				uVar10 -= 1;
				piVar9 = piVar8 + -0xb;
				piVar11 = &DAT_004e9544 + DAT_004eb7a4 * 0xb;
				for (iVar3 = 0xb; uVar12 = local_968, iVar3 != 0; iVar3 += -1) {
					*piVar8 = *piVar11;
					piVar11 = piVar11 + 1;
					piVar8 = piVar8 + 1;
				}
			}
			uVar10 += 1;
			piVar8 = piVar9 + 0xb;
		} while (uVar10 < DAT_004eb7a4);
	}
	local_96c = NULL;
	if (uVar12 != 0) {
		do {
			pcVar1 = local_640[(int)local_96c];
			if (pcVar1 != NULL) {
				uVar10 = 0;
				do {
					if ((local_96c != (char **)uVar10) &&
						 (iVar3 = std::_stricmp(apcStack800[uVar10],pcVar1), iVar3 == 0)) {
						pLVar5 = apLStack2400[(int)local_96c];
						liveObj = apLStack2400[uVar10];
						pLVar5->object_2fc = liveObj;
						pLVar5->flags2_3e4 = pLVar5->flags2_3e4 | 4;
						OVar6 = lego::game::LiveObject_GetStatsFlags3(liveObj);
						if ((OVar6 & STATS3_NEEDSPILOT) == STATS3_NONE) {
							OVar7 = lego::game::LiveObject_GetStatsFlags1(liveObj);
							if ((OVar7 & STATS1_CROSSWATER) == STATS1_NONE) {
								trainFlags = TRAINED_DRIVER;
							}
							else {
								OVar7 = lego::game::LiveObject_GetStatsFlags1(liveObj);
								if ((OVar7 & STATS1_CROSSLAND) == STATS1_NONE) {
									trainFlags = TRAINED_SAILOR;
								}
								else {
									trainFlags = TRAINED_PILOT;
								}
							}
						}
						else {
							trainFlags = TRAINED_PILOT;
						}
						lego::game::LiveObject_TrainMiniFigure_instantunk(pLVar5,trainFlags);
						FUN_0043f3c0(pLVar5,(int)liveObj);
						uVar12 = local_968;
					}
					uVar10 += 1;
				} while (uVar10 < uVar12);
			}
			local_96c = (char **)((int)local_96c + 1);
		} while (local_96c < uVar12);
	}
	uVar10 = 0;
	if (uVar12 != 0) {
		do {
			if (local_640[uVar10] != NULL) {
				std::free(local_640[uVar10]);
			}
			if (apcStack800[uVar10] != NULL) {
				std::free(apcStack800[uVar10]);
			}
			uVar10 += 1;
		} while (uVar10 < uVar12);
	}
	return;
}



void __cdecl
FUN_00437ee0(undefined4 param_1,undefined4 param_2,undefined4 param_3,float *param_4,
						undefined4 param_5,undefined4 param_6,char *param_7,char *param_8)
{
	int iVar1;
	int iVar2;
	char *pcVar3;
	LevelSurfaceMap *surfaceMap;
	float in_x;
	float fVar4;
	int *out_x;
	int *out_y;
	
	iVar2 = DAT_004eb7a4;
	out_x = &DAT_004e9544 + DAT_004eb7a4 * 0xb;
	iVar1 = DAT_004eb7a4 * 0xb;
	DAT_004eb7a4 = DAT_004eb7a4 + 1;
	(&DAT_004e954c)[iVar1] = *param_4;
	fVar4 = param_4[1];
	(&DAT_004e9558)[iVar2 * 0xb] = param_1;
	(&DAT_004e9550)[iVar2 * 0xb] = fVar4;
	(&DAT_004e9564)[iVar2 * 0xb] = param_6;
	(&DAT_004e9554)[iVar2 * 0xb] = param_5;
	(&DAT_004e955c)[iVar2 * 0xb] = param_2;
	(&DAT_004e9560)[iVar2 * 0xb] = param_3;
	if (param_7 != NULL) {
		pcVar3 = std::_strdup(param_7);
		(&DAT_004e9568)[iVar2 * 0xb] = pcVar3;
	}
	if (param_8 != NULL) {
		pcVar3 = std::_strdup(param_8);
		(&DAT_004e956c)[iVar2 * 0xb] = pcVar3;
	}
	fVar4 = param_4[1];
	in_x = *param_4;
	out_y = &DAT_004e9548 + iVar2 * 0xb;
	surfaceMap = lego::game::GetSurfaceMap();
	lego::game::SurfaceMap_ToBlockCoordinatesNoZ(surfaceMap,in_x,fVar4,out_x,out_y);
	return;
}



BOOL __cdecl lego::game::LiveObject_CanShootObject(LiveObject *liveObj)
{
	ObjectStatsFlags2 OVar1;
	float10 fVar2;
	
	OVar1 = LiveObject_GetStatsFlags2(liveObj);
	if ((OVar1 & STATS2_CANBESHOTAT) != STATS2_NONE) {
		fVar2 = LiveObject_GetPainThreshold(liveObj);
		if (fVar2 < (float10)liveObj->health) {
			return 1;
		}
	}
	return 0;
}



LiveObject * __cdecl lego::game::LiveObject__Create(int **srcData,ObjectType objType,int objIndex)
{
	ObjectType OVar1;
	LiveObject *liveObj;
	BOOL BVar2;
	VehicleData *out_vehicle;
	uint uVar3;
	ObjectStatsFlags1 OVar4;
	CreatureData *pCVar5;
	BOOL BVar6;
	BuildingData *out_building;
	UpgradeData *out_upgrade;
	ResourceData *resData;
	LiveFlags3 LVar7;
	ObjectStatsFlags2 OVar8;
	
	liveObj = pool::ReservedPool_LiveObject___Next();
	if (liveObj == NULL) {
		return NULL;
	}
	liveObj->objType = objType;
	liveObj->objIndex = objIndex;
	liveObj->flags3_3e8 = LIVEOBJ3_NONE;
	liveObj->health = (float)&DAT_42c80000;
	liveObj->energy = (float)&DAT_42c80000;
	res::Res_ToggleSoundCallback(0);
	BVar2 = lego::snd::Audio_GetFlag1();
	lego::snd::Audio_SetFlag1_AndOtherFunc(0,0);
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_VEHICLE) {
		out_vehicle = (VehicleData *)std::malloc(0x1ec);
		liveObj->vehicle = out_vehicle;
		res::Vehicle_Duplicate((VehicleData *)srcData,out_vehicle);
		res::Vehicle_SetOwnerObject(liveObj->vehicle,liveObj);
		uVar3 = res::Vehicle_GetCarryNullFrames(liveObj->vehicle);
		liveObj->field_328 = uVar3;
		LiveObject_VehicleChangeUpgradeParts(liveObj->vehicle,0);
		liveObj->flags5_3f0 = 0x20;
		liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x441190;
		LiveObject_SetLevel(liveObj,0);
		if (srcData[0x2d] != NULL) {
			liveObj->flags3_3e8 = liveObj->flags3_3e8 | 2;
		}
		if (srcData[0x37] != NULL) {
			liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x20;
			OVar4 = LiveObject_GetStatsFlags1(liveObj);
			if ((OVar4 & STATS1_CROSSLAND) != STATS1_NONE) {
				liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x40;
			}
		}
		goto LAB_00438452;
	}
	if (OVar1 == OBJECT_MINIFIGURE) {
		pCVar5 = (CreatureData *)std::malloc(0x74);
		liveObj->miniFigure = pCVar5;
		res::Creature_Duplicate((CreatureData *)srcData,pCVar5);
		res::Object_SetOwnerObject((BasicObjectData *)liveObj->miniFigure,liveObj);
		uVar3 = nerps::funcs::NERPFunc__True((int *)liveObj->miniFigure);
		LVar7 = liveObj->flags3_3e8;
		liveObj->field_328 = uVar3;
		liveObj->flags3_3e8 = LVar7 | 0x4401f5;
		if (srcData[0xb] != NULL) {
			liveObj->flags3_3e8 = LVar7 | 0x4401f7;
		}
		LiveObject_SetLevel(liveObj,0);
		liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x8000;
		MiniFigure_EquipTool(liveObj,TOOL_DRILL);
		goto LAB_00438452;
	}
	if (OVar1 == OBJECT_ROCKMONSTER) {
		pCVar5 = (CreatureData *)std::malloc(0x74);
		liveObj->rockMonster = pCVar5;
		res::Creature_Duplicate((CreatureData *)srcData,pCVar5);
		res::Object_SetOwnerObject((BasicObjectData *)liveObj->rockMonster,liveObj);
		uVar3 = nerps::funcs::NERPFunc__True((int *)liveObj->rockMonster);
		LVar7 = liveObj->flags3_3e8;
		liveObj->field_328 = uVar3;
		liveObj->flags3_3e8 = LVar7 | 0x8440200;
		if (srcData[0xb] != NULL) {
			liveObj->flags3_3e8 = LVar7 | 0x8440202;
		}
		LiveObject_SetLevel(liveObj,0);
		OVar4 = LiveObject_GetStatsFlags1(liveObj);
		if ((OVar4 & STATS1_FLOCKS) == STATS1_NONE) {
			liveObj->flocksData_32c = NULL;
		}
		else {
			LiveObject_FlocksInit(liveObj);
			OVar4 = LiveObject_GetStatsFlags1(liveObj);
			if ((OVar4 & STATS1_FLOCKS_DEBUG) == STATS1_NONE) {
				LiveObject_FUN_0044a210(liveObj,1);
				liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xfffffeff;
			}
		}
		BVar6 = LiveObject_CanShootObject(liveObj);
		if (BVar6 != 0) {
			LiveObject_Create_InitCanShoot(liveObj);
		}
		liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x80000000;
		goto LAB_00438452;
	}
	if (OVar1 == OBJECT_BUILDING) {
		out_building = (BuildingData *)std::malloc(0x14c);
		liveObj->building = out_building;
		res::Building_Duplicate((BuildingData *)srcData,out_building);
		res::Object_SetOwnerObject((BasicObjectData *)liveObj->building,liveObj);
		uVar3 = res::Res_GetBuildingCarryNullFrames(liveObj->building);
		liveObj->field_328 = uVar3;
		liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x40100;
		LiveObject_BuildingChangeUpgradeParts(liveObj->building,0);
		LiveObject_SetLevel(liveObj,0);
		OVar4 = LiveObject_GetStatsFlags1(liveObj);
		if ((OVar4 & STATS1_SMALLTELEPORTER) != STATS1_NONE) {
			globals::g_Game.placeDestSmallTeleporter = liveObj;
		}
		OVar4 = LiveObject_GetStatsFlags1(liveObj);
		if ((OVar4 & STATS1_BIGTELEPORTER) != STATS1_NONE) {
			globals::g_Game.placeDestBigTeleporter = liveObj;
		}
		OVar4 = LiveObject_GetStatsFlags1(liveObj);
		if ((OVar4 & STATS1_WATERTELEPORTER) != STATS1_NONE) {
			globals::g_Game.placeDestWaterTeleporter = liveObj;
		}
		LiveObject_GetStatsFlags1(liveObj);
		OVar4 = LiveObject_GetStatsFlags1(liveObj);
		if ((OVar4 & STATS1_SNAXULIKE) != STATS1_NONE) {
			FUN_00403900(liveObj);
		}
		FUN_00403450(liveObj);
		liveObj->flags5_3f0 = 0x20;
		FUN_00439c50();
		goto LAB_00438452;
	}
	if (OVar1 == OBJECT_UPGRADEPART) {
		out_upgrade = (UpgradeData *)std::malloc(0x10);
		liveObj->upgrade = out_upgrade;
		res::Upgrade_Duplicate((UpgradeData *)srcData,out_upgrade);
		liveObj->stats = &globals::const::c_ObjectStats_Upgrade;
		liveObj->flags3_3e8 = liveObj->flags3_3e8 | LIVEOBJ3_UNK_80000;
		goto LAB_00438452;
	}
	resData = res::Res_DuplicateResource((ResourceData *)srcData);
	liveObj->other = resData;
	res::Res_SetOwnerObject(resData,liveObj);
	LVar7 = liveObj->flags3_3e8;
	OVar1 = liveObj->objType;
	liveObj->flags3_3e8 = LVar7 | LIVEOBJ3_SIMPLEOBJECT;
	if (OVar1 == OBJECT_ELECTRICFENCE) {
		liveObj->flags3_3e8 = LVar7 | 0x60100;
	}
	if ((OVar1 == OBJECT_ORE) || (OVar1 == OBJECT_POWERCRYSTAL)) {
		LVar7 = liveObj->flags3_3e8 | 0x100100;
LAB_004383f9:
		liveObj->flags3_3e8 = LVar7;
	}
	else {
		if ((OVar1 == OBJECT_DYNAMITE) || (OVar1 == OBJECT_SONICBLASTER)) {
			LVar7 = liveObj->flags3_3e8 | 0x40000;
			goto LAB_004383f9;
		}
	}
	LiveObject_SetCrystalPoweredColor(liveObj,1);
	if (true) {
		switch(liveObj->objType) {
		case OBJECT_DYNAMITE:
			liveObj->stats = &globals::const::c_ObjectStats_Dynamite;
			break;
		case OBJECT_BARRIER:
			liveObj->stats = &globals::const::c_ObjectStats_Barrier;
			break;
		default:
			goto switchD_0043841c_caseD_a;
		case OBJECT_SPIDERWEB:
		case OBJECT_SONICBLASTER:
		case OBJECT_ELECTRICFENCESTUD:
		case OBJECT_PUSHER:
		case OBJECT_FREEZER:
		case OBJECT_ICECUBE:
		case OBJECT_LASERSHOT:
			liveObj->stats = &globals::const::c_ObjectStats_Enemy;
		}
	}
	else {
switchD_0043841c_caseD_a:
		LiveObject_SetLevel(liveObj,0);
	}
LAB_00438452:
	liveObj->aitaskName2 = globals::g_Activities_TABLE[0];
	liveObj->aitaskName1 = globals::g_Activities_TABLE[9];
	uVar3 = Game_UpdateSomeAITasks(liveObj);
	if (uVar3 != 0) {
		liveObj->flags3_3e8 = liveObj->flags3_3e8 | 8;
	}
	liveObj->aitaskName1 = globals::g_Activities_TABLE[16];
	uVar3 = Game_UpdateSomeAITasks(liveObj);
	if (uVar3 != 0) {
		liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x4000000;
	}
	liveObj->aitaskName1 = globals::g_Activities_TABLE[2];
	uVar3 = Game_UpdateSomeAITasks(liveObj);
	if (uVar3 != 0) {
		liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x10000000;
	}
	liveObj->aitaskName1 = globals::g_Activities_TABLE[0];
	Game_UpdateSomeAITasks(liveObj);
	FUN_00403e90(liveObj);
	res::Res_ToggleSoundCallback(1);
	if (BVar2 != 0) {
		lego::snd::Audio_SetFlag1_AndOtherFunc(1,0);
	}
	FUN_0043c830(liveObj);
	globals::g_LiveObjectLevels_Current_TABLE[liveObj->objType][liveObj->objIndex][0] =
			 globals::g_LiveObjectLevels_Current_TABLE[liveObj->objType][liveObj->objIndex][0] + 1;
	OVar8 = LiveObject_GetStatsFlags2(liveObj);
	if ((OVar8 & STATS2_UNSELECTABLE) != STATS2_NONE) {
		liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xfffffeff;
	}
	return liveObj;
}



LiveObject * __cdecl lego::pool::ReservedPool_LiveObject___Next(void)
{
	int iVar1;
	LiveObject *pLVar2;
	LiveObject *liveObj;
	
	if (globals::ReservedPool_LiveObject___g_NEXT == NULL) {
		ReservedPool_LiveObject___Alloc();
	}
	liveObj = globals::ReservedPool_LiveObject___g_NEXT;
	pLVar2 = globals::ReservedPool_LiveObject___g_NEXT;
	globals::ReservedPool_LiveObject___g_NEXT = globals::ReservedPool_LiveObject___g_NEXT->pool_m_next
	;
	for (iVar1 = 0x103; iVar1 != 0; iVar1 += -1) {
		pLVar2->objType = OBJECT_NONE;
		pLVar2 = (LiveObject *)&pLVar2->objIndex;
	}
	liveObj->pool_m_next = liveObj;
	(liveObj->point_2f4).y = -1.0;
	(liveObj->point_2f4).x = -1.0;
	return liveObj;
}



void __cdecl lego::pool::ReservedPool_LiveObject___Alloc(void)
{
	LiveObject *pLVar1;
	LiveObject *pLVar2;
	int iVar3;
	uint uVar4;
	
	uVar4 = 1 << ((byte)globals::ReservedPool_LiveObject___g_COUNT & 0x1f);
	pLVar2 = (LiveObject *)std::malloc(uVar4 * 0x40c);
	globals::ReservedPool_LiveObject___g_TABLE[globals::ReservedPool_LiveObject___g_COUNT] = pLVar2;
	pLVar2 = globals::ReservedPool_LiveObject___g_TABLE[globals::ReservedPool_LiveObject___g_COUNT];
	if (pLVar2 != NULL) {
		globals::ReservedPool_LiveObject___g_COUNT += 1;
		if (1 < uVar4) {
			iVar3 = uVar4 - 1;
			pLVar1 = pLVar2;
			do {
				pLVar1->pool_m_next = pLVar1 + 1;
				iVar3 += -1;
				pLVar1 = pLVar1 + 1;
			} while (iVar3 != 0);
		}
		pLVar2[uVar4 - 1].pool_m_next = globals::ReservedPool_LiveObject___g_NEXT;
		globals::ReservedPool_LiveObject___g_NEXT = pLVar2;
	}
	return;
}



int __cdecl lego::game::Game_GetNumBuildingsTeleported(int *stack)
{
	return globals::g_BuildingsTeleported;
}



void __cdecl lego::game::Game_SetNumBuildingsTeleported(uint numTeleported)
{
	globals::g_BuildingsTeleported = numTeleported;
	return;
}



void __cdecl lego::game::LiveObject_SetCrystalPoweredColor(LiveObject *liveObj,BOOL isPowered)
{
	int iVar1;
	uint uVar2;
	float b;
	uint index;
	float local_4;
	
	if (liveObj->objType == OBJECT_POWERCRYSTAL) {
		if (isPowered == 0) {
			isPowered = (BOOL)globals::g_Game.UnpoweredCrystalRGB.red;
			local_4 = globals::g_Game.UnpoweredCrystalRGB.green;
			b = globals::g_Game.UnpoweredCrystalRGB.blue;
		}
		else {
			isPowered = (BOOL)globals::g_Game.PowerCrystalRGB.red;
			local_4 = globals::g_Game.PowerCrystalRGB.green;
			b = globals::g_Game.PowerCrystalRGB.blue;
		}
		index = 0;
		iVar1 = res::Res_GetMeshGroupCount(liveObj->other);
		if (iVar1 != 0) {
			do {
				res::Res_SetMeshColorMultiplier(liveObj->other,index,(float)isPowered,local_4,b,1.0);
				res::Res_SetMeshColorUnk(liveObj->other,index,(float)isPowered,local_4,b);
				index += 1;
				uVar2 = res::Res_GetMeshGroupCount(liveObj->other);
			} while (index < uVar2);
		}
	}
	return;
}



void __cdecl FUN_00438720(LiveObject *liveObj)
{
	ObjectStatsFlags1 OVar1;
	
	if (liveObj->objType == OBJECT_BUILDING) {
		lego::game::Game_UpdateSomeAITasks(liveObj);
		liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x20;
		OVar1 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		if ((OVar1 & STATS1_STOREOBJECTS) == STATS1_NONE) {
			OVar1 = lego::game::LiveObject_GetStatsFlags1(liveObj);
			if ((OVar1 & STATS1_PROCESSORE) == STATS1_NONE) {
				OVar1 = lego::game::LiveObject_GetStatsFlags1(liveObj);
				if ((OVar1 & STATS1_PROCESSCRYSTAL) == STATS1_NONE) {
					liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xffffffdf;
				}
				else {
					FUN_004037f0(liveObj,OBJECT_POWERCRYSTAL,0,0);
				}
			}
			else {
				FUN_004037f0(liveObj,OBJECT_ORE,0,0);
			}
		}
		else {
			FUN_004038d0(liveObj);
		}
		FUN_00439c50();
		liveObj->flags4_3ec = liveObj->flags4_3ec | 0x200000;
	}
	else {
		if (liveObj->objType == OBJECT_VEHICLE) {
			FUN_0046d280(liveObj->vehicle,0);
		}
	}
	if ((liveObj->objType == OBJECT_MINIFIGURE) || (liveObj->objType == OBJECT_VEHICLE)) {
		FUN_0043f820(liveObj);
	}
	FUN_00418760(liveObj->objType,liveObj->objIndex,0,liveObj->flags4_3ec & 0x200);
	if (liveObj->objType == OBJECT_BUILDING) {
		lego::globals::g_BuildingsTeleported += 1;
	}
	if ((liveObj->objType == OBJECT_MINIFIGURE) || (liveObj->objType == OBJECT_VEHICLE)) {
		FUN_004033d0(liveObj);
	}
	if ((liveObj->objType == OBJECT_VEHICLE) || (liveObj->objType == OBJECT_BUILDING)) {
		liveObj->flags4_3ec = liveObj->flags4_3ec | 0x40000;
	}
	return;
}



void __cdecl lego::game::LiveObject_SetFlag3_80000000(LiveObject *liveObj,BOOL state)
{
	LiveFlags3 LVar1;
	
	if (state == 0) {
		LVar1 = liveObj->flags3_3e8 | 0x80000000;
	}
	else {
		LVar1 = liveObj->flags3_3e8 & 0x7fffffff;
	}
	liveObj->flags3_3e8 = LVar1;
	FUN_00439c50();
	return;
}



BOOL __cdecl FUN_00438870(LiveObject *liveObj,BOOL state)
{
	if ((((((liveObj->flags1_3e0 & 0x700100) == LIVEOBJ1_NONE) &&
				((liveObj->flags2_3e4 & 0x100000) == LIVEOBJ2_NONE)) && (0.0 <= liveObj->health)) &&
			((liveObj->flags1_3e0 & 0x20000) == LIVEOBJ1_NONE)) &&
		 ((state != 0 ||
			(((liveObj->flags3_3e8 & 0x20000000) != LIVEOBJ3_NONE &&
			 ((liveObj->flags3_3e8 & 0x80000000) == LIVEOBJ3_NONE)))))) {
		return 1;
	}
	return 0;
}



LiveObject * __cdecl
lego::game::Game_CreateLiveResourceObject
					(ResourceData *resData,ObjectType objType,int objIndex,int objLevel,float x,float y,
					float theta)
{
	LiveObject *liveObj;
	
	liveObj = LiveObject__Create((int **)resData,objType,objIndex);
	if (liveObj != NULL) {
		FUN_00442b60(liveObj,x,y,theta,1);
		if ((liveObj->objType == OBJECT_POWERCRYSTAL) || (liveObj->objType == OBJECT_ORE)) {
			LiveObject_SetLevel_thunk(liveObj,objLevel);
		}
		return liveObj;
	}
	return NULL;
}



ObjectType __cdecl FUN_00438930(undefined4 *param_1)
{
	ObjectType local_c;
	int local_8;
	char *local_4;
	
	local_c = OBJECT_NONE;
	local_8 = *param_1;
	local_4 = (char *)param_1[1];
	FUN_00437a70(FUN_00438970,(LiveObject *)&local_c);
	return local_c;
}



BOOL __cdecl FUN_00438970(LiveObject *liveObj,LiveObject **param_2)
{
	ObjectStatsFlags2 OVar1;
	BOOL BVar2;
	LiveObject *local_8;
	LiveObject *local_4;
	
	if (liveObj->objType == OBJECT_BUILDING) {
		OVar1 = lego::game::LiveObject_GetStatsFlags2(liveObj);
		if ((OVar1 & STATS2_GENERATEPOWER) != STATS2_NONE) {
			BVar2 = FUN_00438870(liveObj,0);
			if (BVar2 != 0) {
				lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_8,(int *)&local_4);
				if ((local_8 == param_2[1]) && (local_4 == param_2[2])) {
					*param_2 = liveObj;
					return 1;
				}
			}
		}
	}
	return 0;
}



BOOL __cdecl FUN_004389e0(LiveObject *liveObj,int param_2)
{
	int iVar1;
	
	if ((lego::globals::g_Game.level)->NoDrain != 0) {
		param_2 = 0;
	}
	iVar1 = lego::game::Level_GetCrystalCount(0);
	if (iVar1 < param_2) {
		lego::game::Info_FUN_00419ab0(INFO_NOPOWER,NULL,liveObj,NULL);
		return 0;
	}
	FUN_0041f7d0(param_2);
	return 1;
}



BOOL __cdecl lego::game::LiveObject_GetBuildingUpgradeCost(LiveObject *liveObj,uint *out_oreCost)
{
	uint uVar1;
	
	uVar1 = Object_GetLevels(liveObj->objType,liveObj->objIndex);
	if (uVar1 <= liveObj->objLevel + 1) {
		return 0;
	}
	uVar1 = Level_GetOreCount(0);
	if (uVar1 < (uint)globals::g_Game.BuildingUpgradeCostOre) {
		uVar1 = Level_GetOreCount(1);
		if (uVar1 < (uint)globals::g_Game.BuildingUpgradeCostStuds) {
			return 0;
		}
		if (out_oreCost != NULL) {
			*out_oreCost = globals::g_Game.BuildingUpgradeCostStuds;
		}
	}
	else {
		if (out_oreCost != NULL) {
			*out_oreCost = 0;
			return 1;
		}
	}
	return 1;
}



void __cdecl FUN_00438ab0(LiveObject *in_liveObj)
{
	LiveObject *liveObj;
	BOOL BVar1;
	ResourceData *resData;
	LiveObject *oreCount;
	ResourceData *opt_refResData;
	Vector3F *out_position;
	Vector3F local_c;
	
	liveObj = in_liveObj;
	if (in_liveObj->objType == OBJECT_BUILDING) {
		BVar1 = lego::game::LiveObject_GetBuildingUpgradeCost(in_liveObj,(uint *)&in_liveObj);
		if (BVar1 != 0) {
			oreCount = in_liveObj;
			if (in_liveObj == NULL) {
				oreCount = (LiveObject *)lego::globals::g_Game.BuildingUpgradeCostOre;
			}
			lego::game::Level_SubtractOre((uint)(in_liveObj != NULL),(int)oreCount);
			liveObj->elapsedTime2 = 0.0;
			lego::game::LiveObject_BuildingChangeUpgradeParts(liveObj->building,liveObj->objLevel + 1);
			lego::game::LiveObject_SetLevel(liveObj,liveObj->objLevel + 1);
			out_position = &local_c;
			opt_refResData = NULL;
			resData = lego::game::LiveObject_GetResource(liveObj);
			lego::res::Res_GetPosition(resData,opt_refResData,out_position);
			FUN_0040cc10(9,(undefined4 *)&local_c,NULL);
			FUN_00418760(liveObj->objType,liveObj->objIndex,liveObj->objLevel,0);
		}
	}
	return;
}



BOOL __cdecl FUN_00438b70(LiveObject *liveObj,int objLevel)
{
	BOOL BVar1;
	uint uVar2;
	uint uVar3;
	uint uVar4;
	uint uVar5;
	
	if ((liveObj->objType != OBJECT_VEHICLE) ||
		 (BVar1 = FUN_0046d200(liveObj->vehicle,objLevel,1), BVar1 == 0)) {
		return 0;
	}
	uVar2 = lego::game::Object_GetUpgradeCostOre(liveObj->objType,liveObj->objIndex,objLevel);
	uVar3 = lego::game::Object_GetUpgradeCostOre(liveObj->objType,liveObj->objIndex,objLevel);
	uVar4 = lego::game::Object_GetUpgradeCostOre(liveObj->objType,liveObj->objIndex,objLevel);
	uVar5 = lego::game::Level_GetOreCount(0);
	if ((uVar5 < uVar4) &&
		 (uVar4 = lego::game::Level_GetOreCount(1), uVar4 < (uint)(uVar2 % 5 != 0) + uVar3 / 5)) {
		return 0;
	}
	return 1;
}



ObjectType __cdecl FUN_00438c20(LiveObject *opt_liveObj,BOOL param_2)
{
	ObjectType local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_24 = OBJECT_NONE;
	local_20 = 0.0;
	local_1c = NULL;
	local_18 = (VehicleData *)0x461c4000;
	local_14 = (CreatureData *)0x2000;
	local_10 = NULL;
	local_c = NULL;
	local_8 = NULL;
	local_4 = NULL;
	if (param_2 != 0) {
		local_14 = (CreatureData *)0x6000;
	}
	if (opt_liveObj != NULL) {
		lego::game::LiveObject_GetPosition(opt_liveObj,&local_20,(float *)&local_1c);
	}
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



ObjectType __cdecl FUN_00438ca0(LiveObject *liveObj,BOOL param_2)
{
	ObjectType local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_24 = OBJECT_NONE;
	local_20 = 0.0;
	local_1c = NULL;
	local_18 = (VehicleData *)0x461c4000;
	local_14 = (CreatureData *)0x1000;
	local_10 = NULL;
	local_c = NULL;
	local_8 = NULL;
	local_4 = NULL;
	lego::game::LiveObject_GetPosition(liveObj,&local_20,(float *)&local_1c);
	if (param_2 != 0) {
		local_14 = (CreatureData *)((uint)local_14 | 0x400);
	}
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



LiveObject * __cdecl FUN_00438d20(Point2I *position,ObjectType objType,int objIndex,int objLevel)
{
	LevelSurfaceMap *surfMap;
	uint x;
	uint y;
	float *out_x;
	char **out_y;
	LiveObject *local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_c = (BuildingData *)objIndex;
	local_24 = NULL;
	local_20 = 0.0;
	local_1c = NULL;
	local_4 = NULL;
	out_y = &local_1c;
	out_x = &local_20;
	local_10 = (CreatureData *)objType;
	local_8 = (ResourceData *)objLevel;
	local_18 = (VehicleData *)0x461c4000;
	local_14 = (CreatureData *)0x1;
	y = position->y;
	x = position->x;
	surfMap = lego::game::GetSurfaceMap();
	FUN_0044f900(surfMap,x,y,out_x,(float *)out_y);
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



LiveObject * __cdecl
FUN_00438da0(LiveObject *liveObj,Point2I *position,ObjectType objType,int objLevel)
{
	LevelSurfaceMap *surfMap;
	uint x;
	uint y;
	float *out_x;
	char **out_y;
	LiveObject *local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_10 = (CreatureData *)objType;
	local_18 = (VehicleData *)0x461c4000;
	local_24 = NULL;
	local_20 = 0.0;
	local_1c = NULL;
	local_14 = (CreatureData *)0x2;
	local_c = NULL;
	local_8 = (ResourceData *)objLevel;
	local_4 = NULL;
	if (liveObj == NULL) {
		out_y = &local_1c;
		out_x = &local_20;
		y = position->y;
		x = position->x;
		surfMap = lego::game::GetSurfaceMap();
		FUN_0044f900(surfMap,x,y,out_x,(float *)out_y);
	}
	else {
		lego::game::LiveObject_GetPosition(liveObj,&local_20,(float *)&local_1c);
	}
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



ObjectType __cdecl FUN_00438e40(LiveObject *liveObj,CreatureData *param_2)
{
	ObjectType local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_24 = OBJECT_NONE;
	local_20 = 0.0;
	local_1c = NULL;
	local_10 = NULL;
	local_c = NULL;
	local_8 = NULL;
	local_4 = NULL;
	local_14 = param_2;
	local_18 = (VehicleData *)0x461c4000;
	lego::game::LiveObject_GetPosition(liveObj,&local_20,(float *)&local_1c);
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



ObjectType __cdecl FUN_00438eb0(LiveObject *liveObj)
{
	ObjectType local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_24 = OBJECT_NONE;
	local_20 = 0.0;
	local_1c = NULL;
	local_10 = NULL;
	local_c = NULL;
	local_8 = NULL;
	local_4 = NULL;
	local_18 = (VehicleData *)0x461c4000;
	local_14 = (CreatureData *)0x80;
	lego::game::LiveObject_GetPosition(liveObj,&local_20,(float *)&local_1c);
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



ObjectType __cdecl FUN_00438f20(LiveObject *liveObj)
{
	ObjectType local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_24 = OBJECT_NONE;
	local_20 = 0.0;
	local_1c = NULL;
	local_10 = NULL;
	local_c = NULL;
	local_8 = NULL;
	local_4 = NULL;
	local_18 = (VehicleData *)0x461c4000;
	local_14 = (CreatureData *)&DAT_00000004;
	lego::game::LiveObject_GetPosition(liveObj,&local_20,(float *)&local_1c);
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



ObjectType __cdecl FUN_00438f90(Point2F *point)
{
	ObjectType local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_24 = OBJECT_NONE;
	local_18 = (VehicleData *)0x461c4000;
	local_20 = point->x;
	local_1c = (char *)point->y;
	local_14 = (CreatureData *)&DAT_00000020;
	local_10 = NULL;
	local_c = NULL;
	local_8 = NULL;
	local_4 = NULL;
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



ObjectType __cdecl FUN_00438ff0(Point2F *point)
{
	ObjectType local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_24 = OBJECT_NONE;
	local_18 = (VehicleData *)0x461c4000;
	local_20 = point->x;
	local_1c = (char *)point->y;
	local_14 = (CreatureData *)&DAT_00000010;
	local_10 = NULL;
	local_c = NULL;
	local_8 = NULL;
	local_4 = NULL;
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



ObjectType __cdecl FUN_00439050(Point2F *point)
{
	ObjectType local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_24 = OBJECT_NONE;
	local_18 = (VehicleData *)0x461c4000;
	local_20 = point->x;
	local_1c = (char *)point->y;
	local_14 = (CreatureData *)0x200;
	local_10 = NULL;
	local_c = NULL;
	local_8 = NULL;
	local_4 = NULL;
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



ObjectType __cdecl FUN_004390b0(Point2F *point)
{
	ObjectType local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_24 = OBJECT_NONE;
	local_18 = (VehicleData *)0x461c4000;
	local_20 = point->x;
	local_1c = (char *)point->y;
	local_14 = (CreatureData *)&DAT_00000008;
	local_10 = NULL;
	local_c = NULL;
	local_8 = NULL;
	local_4 = NULL;
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



ObjectType __cdecl FUN_00439110(LiveObject *liveObj,Point2F *param_2,UpgradeData *param_3)
{
	ObjectType local_24;
	float local_20;
	char *local_1c;
	VehicleData *local_18;
	CreatureData *local_14;
	CreatureData *local_10;
	BuildingData *local_c;
	ResourceData *local_8;
	UpgradeData *local_4;
	
	local_4 = param_3;
	local_24 = OBJECT_NONE;
	local_20 = 0.0;
	local_1c = NULL;
	local_18 = (VehicleData *)0x461c4000;
	local_14 = (CreatureData *)0x100;
	local_10 = NULL;
	local_c = NULL;
	local_8 = NULL;
	if (param_2 != NULL) {
		local_20 = param_2->x;
		local_1c = (char *)param_2->y;
	}
	if (liveObj != NULL) {
		lego::game::LiveObject_GetPosition(liveObj,&local_20,(float *)&local_1c);
	}
	FUN_00437a70(FUN_00439270,(LiveObject *)&local_24);
	return local_24;
}



BOOL __cdecl lego::game::LiveObject_HasTraining(LiveObject *liveObj,TrainedFlags training)
{
	ObjectStatsFlags2 OVar1;
	
	OVar1 = LiveObject_GetStatsFlags2(liveObj);
	if (((OVar1 & STATS2_TRAINPILOT) == STATS2_NONE) || (training != TRAINED_PILOT)) {
		OVar1 = LiveObject_GetStatsFlags2(liveObj);
		if (((OVar1 & STATS2_TRAINSAILOR) == STATS2_NONE) || (training != TRAINED_SAILOR)) {
			OVar1 = LiveObject_GetStatsFlags2(liveObj);
			if (((OVar1 & STATS2_TRAINDRIVER) == STATS2_NONE) || (training != TRAINED_DRIVER)) {
				OVar1 = LiveObject_GetStatsFlags2(liveObj);
				if (((OVar1 & STATS2_TRAINDYNAMITE) == STATS2_NONE) || (training != TRAINED_DYNAMITE)) {
					OVar1 = LiveObject_GetStatsFlags2(liveObj);
					if (((OVar1 & STATS2_TRAINREPAIR) == STATS2_NONE) || (training != TRAINED_REPAIR)) {
						OVar1 = LiveObject_GetStatsFlags2(liveObj);
						if (((OVar1 & STATS2_TRAINSCANNER) == STATS2_NONE) || (training != TRAINED_SCANNER)) {
							return 0;
						}
					}
				}
			}
		}
	}
	return 1;
}



BOOL __cdecl lego::game::LiveObject_IsDocksBuilding_Unk(LiveObject *liveObj)
{
	BOOL BVar1;
	ObjectType local_8;
	int local_4;
	
	BVar1 = Game_GetObjectByName("Docks",&local_8,&local_4,NULL);
	if (((BVar1 != 0) && (liveObj->objType == local_8)) && (liveObj->objIndex == local_4)) {
		return 1;
	}
	return 0;
}



BOOL __cdecl FUN_00439270(LiveObject *liveObj,int **param_2)
{
	int *piVar1;
	bool bVar2;
	BOOL BVar3;
	ObjectStatsFlags1 OVar4;
	ObjectStatsFlags2 OVar5;
	float local_8;
	float local_4;
	
	piVar1 = param_2[4];
	bVar2 = false;
	BVar3 = FUN_00438870(liveObj,(uint)piVar1 & 0x400);
	if (BVar3 == 0) {
		return 0;
	}
	if ((((uint)piVar1 & 0x4000) != 0) && ((*(byte *)&liveObj->flags4_3ec & 0x10) != 0)) {
		return 0;
	}
	if (((uint)piVar1 & 0xfffffbff) == 0) {
		if (liveObj->objType != OBJECT_BUILDING) goto LAB_00439459;
	}
	else {
		if (((((uint)piVar1 & 1) != 0) &&
				(OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj),
				(OVar4 & STATS1_STOREOBJECTS) != STATS1_NONE)) &&
			 (BVar3 = lego::game::LiveObject_CanSpawnCarryableObject
													(liveObj,(ObjectType)param_2[5],(int)param_2[6]), BVar3 != 0)) {
			bVar2 = true;
		}
		if ((((uint)piVar1 & 0x1000) != 0) &&
			 (BVar3 = lego::game::LiveObject_IsDocksBuilding_Unk(liveObj), BVar3 != 0)) {
			bVar2 = true;
		}
		if (((((uint)piVar1 & 0x2000) != 0) &&
				(OVar5 = lego::game::LiveObject_GetStatsFlags2(liveObj),
				(OVar5 & STATS2_SELFPOWERED) == STATS2_NONE)) &&
			 ((OVar5 = lego::game::LiveObject_GetStatsFlags2(liveObj),
				(OVar5 & STATS2_GENERATEPOWER) == STATS2_NONE &&
				(BVar3 = FUN_00438870(liveObj,0), BVar3 != 0)))) {
			bVar2 = true;
		}
		if ((((uint)piVar1 & 0x100) != 0) &&
			 (BVar3 = lego::game::LiveObject_HasTraining(liveObj,(TrainedFlags)param_2[8]), BVar3 != 0)) {
			bVar2 = true;
		}
		if (((((uint)piVar1 & 0x40) != 0) &&
				(OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj),
				(OVar4 & STATS1_STOREOBJECTS) == STATS1_NONE)) && (liveObj->objType == OBJECT_BUILDING)) {
			bVar2 = true;
		}
		if (((((uint)piVar1 & 0x80) != 0) &&
				(OVar5 = lego::game::LiveObject_GetStatsFlags2(liveObj),
				(OVar5 & STATS2_UPGRADEBUILDING) != STATS2_NONE)) && (liveObj->object_300 == NULL)) {
			bVar2 = true;
		}
		if ((((uint)piVar1 & 0x800) != 0) &&
			 (OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj),
			 (OVar4 & STATS1_MANTELEPORTER) != STATS1_NONE)) {
			bVar2 = true;
		}
		if ((((uint)piVar1 & 0x10) != 0) &&
			 (OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj),
			 (OVar4 & STATS1_SMALLTELEPORTER) != STATS1_NONE)) {
			bVar2 = true;
		}
		if ((((uint)piVar1 & 0x20) != 0) &&
			 (OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj),
			 (OVar4 & STATS1_BIGTELEPORTER) != STATS1_NONE)) {
			bVar2 = true;
		}
		if ((((uint)piVar1 & 0x200) != 0) &&
			 (OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj),
			 (OVar4 & STATS1_WATERTELEPORTER) != STATS1_NONE)) {
			bVar2 = true;
		}
		if ((((uint)piVar1 & 2) != 0) &&
			 (((OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj),
				 (OVar4 & STATS1_PROCESSORE) != STATS1_NONE && (param_2[5] == (int *)&DAT_00000007)) ||
				((OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj),
				 (OVar4 & STATS1_PROCESSCRYSTAL) != STATS1_NONE && (param_2[5] == (int *)0x6)))))) {
			bVar2 = true;
		}
		if ((((uint)piVar1 & 4) != 0) &&
			 (OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj),
			 (OVar4 & STATS1_SNAXULIKE) != STATS1_NONE)) {
			bVar2 = true;
		}
		if ((((uint)piVar1 & 8) == 0) ||
			 (OVar4 = lego::game::LiveObject_GetStatsFlags1(liveObj),
			 (OVar4 & STATS1_TOOLSTORE) == STATS1_NONE)) goto LAB_00439459;
	}
	bVar2 = true;
LAB_00439459:
	if (bVar2) {
		lego::game::LiveObject_GetPosition(liveObj,&local_8,&local_4);
		piVar1 = (int *)SQRT(((float)param_2[2] - local_4) * ((float)param_2[2] - local_4) +
												 ((float)param_2[1] - local_8) * ((float)param_2[1] - local_8));
		if ((float)piVar1 < (float)param_2[3]) {
			param_2[3] = piVar1;
			*param_2 = (int *)liveObj;
			return 0;
		}
	}
	return 0;
}



BOOL __cdecl FUN_004394c0(ObjectType objType)
{
	BOOL BVar1;
	
	if (((objType != OBJECT_VEHICLE) && (objType != OBJECT_MINIFIGURE)) &&
		 (objType != OBJECT_BUILDING)) {
		BVar1 = FUN_00437a70(FUN_00439500,(LiveObject *)&objType);
		if (BVar1 != 0) {
			return 1;
		}
	}
	return 0;
}



BOOL __cdecl FUN_00439500(LiveObject *liveObj1,LiveObject *liveObj2)
{
	ObjectStatsFlags1 OVar1;
	BOOL BVar2;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags1(liveObj1);
	if ((OVar1 & STATS1_STOREOBJECTS) != STATS1_NONE) {
		BVar2 = lego::game::LiveObject_CanSpawnCarryableObject(liveObj1,liveObj2->objType,0);
		if (BVar2 != 0) {
			return 1;
		}
	}
	return 0;
}



void __cdecl lego::game::Level_GenerateCryOreAt(Point2I *position)
{
	Point2I *position_00;
	BOOL BVar1;
	Point2I *pPVar2;
	uint uVar3;
	uint local_c;
	uint local_8;
	uint local_4;
	
	position_00 = position;
	BVar1 = Level_GetBlockCryOre
										(position,(int *)&position,(int *)&local_c,(int *)&local_8,(int *)&local_4);
	if (BVar1 != 0) {
		pPVar2 = NULL;
		if (position != NULL) {
			do {
				Level_GenerateCrystal(position_00,0,NULL,1);
				pPVar2 = (Point2I *)((int)&pPVar2->x + 1);
			} while (pPVar2 < position);
		}
		uVar3 = 0;
		if (local_c != 0) {
			do {
				Level_GenerateCrystal(position_00,1,NULL,1);
				uVar3 += 1;
			} while (uVar3 < local_c);
		}
		uVar3 = 0;
		if (local_8 != 0) {
			do {
				Level_GenerateOre(position_00,0,NULL,1);
				uVar3 += 1;
			} while (uVar3 < local_8);
		}
		uVar3 = 0;
		if (local_4 != 0) {
			do {
				Level_GenerateOre(position_00,1,NULL,1);
				uVar3 += 1;
			} while (uVar3 < local_4);
		}
	}
	return;
}



void __cdecl FUN_00439600(uint *param_1,uint param_2)
{
	lego::game::Level_GenerateCrystal((Point2I *)param_1,param_2,NULL,1);
	lego::game::Level_GenerateOre((Point2I *)param_1,param_2,NULL,1);
	return;
}



void __cdecl
lego::game::Level_GenerateCrystal
					(Point2I *position,uint objLevel,Point2F *opt_point,BOOL showInfoMessage)
{
	LevelSurfaceMap *pLVar1;
	float fVar2;
	LiveObject *liveObj;
	LevelData *pLVar3;
	int iVar4;
	float x;
	float10 fVar5;
	float10 fVar6;
	uint x_00;
	uint y;
	float *pfVar7;
	float local_30;
	float local_2c;
	float local_18;
	float local_14;
	
	pLVar1 = GetSurfaceMap();
	fVar5 = SurfaceMap_GetFloat10(pLVar1);
	pLVar1 = GetSurfaceMap();
	fVar6 = SurfaceMap_GetFloat10(pLVar1);
	fVar2 = (float)((float10)(float)(fVar5 * (float10)0.5) - fVar6 * (float10)0.25);
	if (opt_point == NULL) {
		y = position->y;
		x_00 = position->x;
		pfVar7 = &local_30;
		pLVar1 = GetSurfaceMap();
		FUN_00450390(pLVar1,x_00,y,pfVar7);
		fVar5 = Game_ChooseRandomRange(local_30 + fVar2,local_18 - fVar2);
		x = (float)fVar5;
		fVar5 = Game_ChooseRandomRange(local_2c - fVar2,local_14 + fVar2);
		fVar2 = (float)fVar5;
	}
	else {
		x = opt_point->x;
		fVar2 = opt_point->y;
	}
	liveObj = Game_CreateLiveResourceObject
											(globals::g_Game.RES_Crystal,OBJECT_POWERCRYSTAL,0,objLevel,x,fVar2,0.0);
	Level_AddMessageAction(MESSAGE_GENERATECRYSTAL_COMPLETE,liveObj,0,NULL);
	if (showInfoMessage != 0) {
		Info_FUN_00419ab0(INFO_CRYSTALFOUND,NULL,NULL,position);
		front::Text_DisplayType(TEXT_CRYSTALFOUND,1,0);
		pLVar3 = GetLevel();
		iVar4 = (pLVar3->dimensions).width * position->y + position->x;
		pLVar3 = GetLevel();
		pLVar3->blocks[iVar4].field_2c = pLVar3->blocks[iVar4].field_2c + 1;
	}
	return;
}



void __cdecl
lego::game::Level_GenerateOre
					(Point2I *position,uint objLevel,Point2F *opt_point,BOOL showInfoMessage)
{
	LevelSurfaceMap *pLVar1;
	float fVar2;
	LiveObject *liveObj;
	LevelData *pLVar3;
	int iVar4;
	float x;
	float10 fVar5;
	float10 fVar6;
	uint x_00;
	uint y;
	float *pfVar7;
	float local_30;
	float local_2c;
	float local_18;
	float local_14;
	
	pLVar1 = GetSurfaceMap();
	fVar5 = SurfaceMap_GetFloat10(pLVar1);
	pLVar1 = GetSurfaceMap();
	fVar6 = SurfaceMap_GetFloat10(pLVar1);
	fVar2 = (float)((float10)(float)(fVar5 * (float10)0.5) - fVar6 * (float10)0.25);
	if (opt_point == NULL) {
		y = position->y;
		x_00 = position->x;
		pfVar7 = &local_30;
		pLVar1 = GetSurfaceMap();
		FUN_00450390(pLVar1,x_00,y,pfVar7);
		fVar5 = Game_ChooseRandomRange(local_30 + fVar2,local_18 - fVar2);
		x = (float)fVar5;
		fVar5 = Game_ChooseRandomRange(local_2c - fVar2,local_14 + fVar2);
		fVar2 = (float)fVar5;
	}
	else {
		x = opt_point->x;
		fVar2 = opt_point->y;
	}
	liveObj = Game_CreateLiveResourceObject
											(globals::g_Game.RES_Ores_TABLE[0],OBJECT_ORE,0,objLevel,x,fVar2,0.0);
	Level_AddMessageAction(MESSAGE_GENERATEORE_COMPLETE,liveObj,0,NULL);
	front::Text_DisplayType(TEXT_OREFOUND,1,0);
	if (showInfoMessage != 0) {
		pLVar3 = GetLevel();
		iVar4 = (pLVar3->dimensions).width * position->y + position->x;
		pLVar3 = GetLevel();
		pLVar3->blocks[iVar4].field_30 = pLVar3->blocks[iVar4].field_30 + 1;
	}
	return;
}



char * __cdecl lego::game::LiveObject_GetName(LiveObject *liveObj)
{
	if (true) {
		switch(liveObj->objType) {
		case OBJECT_VEHICLE:
			return globals::g_Game.ObjectNames_VehicleTypes_TABLE[liveObj->vehicle->objIndex];
		case OBJECT_MINIFIGURE:
			return globals::g_Game.ObjectNames_MiniFigureTypes_TABLE[liveObj->miniFigure->objIndex];
		case OBJECT_ROCKMONSTER:
			return globals::g_Game.ObjectNames_RockMonsterTypes_TABLE[liveObj->rockMonster->objIndex];
		case OBJECT_BUILDING:
			return globals::g_Game.ObjectNames_BuildingTypes_TABLE[liveObj->building->objIndex];
		case OBJECT_POWERCRYSTAL:
			return globals::g_Game.ObjectNames_PowerCrystal;
		case OBJECT_ORE:
			return globals::g_Game.ToolTypes_TABLE[liveObj->objIndex + -0x1b];
		case OBJECT_DYNAMITE:
			return globals::g_Game.ObjectNames_Dynamite;
		case OBJECT_BARRIER:
			return globals::g_Game.ObjectNames_Barrier;
		case OBJECT_UPGRADEPART:
			return globals::g_Game.ObjectNames_UpgradeTypes_TABLE[liveObj->upgrade->objectIndex];
		case OBJECT_ELECTRICFENCE:
			return globals::g_Game.ObjectNames_ElectricFence;
		case OBJECT_SPIDERWEB:
			return globals::g_Game.ObjectNames_SpiderWeb;
		case OBJECT_SONICBLASTER:
			return globals::g_Game.ObjectNames_OohScary;
		case OBJECT_PATH:
			return globals::g_Game.ObjectNames_Path;
		}
	}
	return NULL;
}



char * __cdecl lego::game::Object_GetTypeName(ObjectType objType,int objIndex)
{
	if (objType < OBJECT_BARRIER) {
		if (objType == OBJECT_DYNAMITE) {
			return "Dynamite";
		}
		if (true) {
			switch(objType) {
			case OBJECT_VEHICLE:
				return globals::g_Game.VehicleTypes_TABLE[objIndex];
			case OBJECT_MINIFIGURE:
				return globals::g_Game.MiniFigureTypes_TABLE[objIndex];
			case OBJECT_ROCKMONSTER:
				return globals::g_Game.RockMonsterTypes_TABLE[objIndex];
			case OBJECT_BUILDING:
				return globals::g_Game.BuildingTypes_TABLE[objIndex];
			case OBJECT_POWERCRYSTAL:
				return "PowerCrystal";
			case OBJECT_ORE:
				if (objIndex == 0) {
					return "Ore";
				}
				return "ProcessedOre";
			}
		}
	}
	else {
		if (objType < OBJECT_SONICBLASTER) {
			if (objType == OBJECT_SPIDERWEB) {
				return "SpiderWeb";
			}
			if (objType == OBJECT_BARRIER) {
				return "Barrier";
			}
			if (objType == OBJECT_ELECTRICFENCE) {
				return "ElectricFence";
			}
		}
		else {
			if (objType == OBJECT_SONICBLASTER) {
				return "OohScary";
			}
			if (objType == OBJECT_TVCAMERA) {
				return "tvcamera";
			}
		}
	}
	return NULL;
}



char * __cdecl lego::game::Object_GetTheName(ObjectType objType,int objIndex)
{
	if (true) {
		switch(objType) {
		case OBJECT_VEHICLE:
			return globals::g_Game.ObjectTheNames_VehicleTypes_TABLE[objIndex];
		case OBJECT_MINIFIGURE:
			return globals::g_Game.ObjectTheNames_MiniFigureTypes_TABLE[objIndex];
		case OBJECT_ROCKMONSTER:
			return globals::g_Game.ObjectTheNames_RockMonsterTypes_TABLE[objIndex];
		case OBJECT_BUILDING:
			return globals::g_Game.ObjectTheNames_BuildingTypes_TABLE[objIndex];
		case OBJECT_POWERCRYSTAL:
			return globals::g_Game.ObjectTheNames_PowerCrystal;
		case OBJECT_ORE:
			return globals::g_Game.ToolTypes_TABLE[objIndex + -0x12];
		case OBJECT_DYNAMITE:
			return globals::g_Game.ObjectTheNames_Dynamite;
		case OBJECT_BARRIER:
			return globals::g_Game.ObjectTheNames_Barrier;
		case OBJECT_UPGRADEPART:
			return globals::g_Game.ObjectTheNames_UpgradeTypes_TABLE[objIndex];
		case OBJECT_ELECTRICFENCE:
			return globals::g_Game.ObjectTheNames_ElectricFence;
		case OBJECT_SPIDERWEB:
			return globals::g_Game.ObjectTheNames_SpiderWeb;
		case OBJECT_SONICBLASTER:
			return globals::g_Game.ObjectTheNames_OohScary;
		case OBJECT_PATH:
			return globals::g_Game.ObjectTheNames_Path;
		}
	}
	return NULL;
}



char * __cdecl lego::game::Object_GetName(ObjectType objType,int objIndex)
{
	if (true) {
		switch(objType) {
		case OBJECT_VEHICLE:
			return globals::g_Game.ObjectNames_VehicleTypes_TABLE[objIndex];
		case OBJECT_MINIFIGURE:
			return globals::g_Game.ObjectNames_MiniFigureTypes_TABLE[objIndex];
		case OBJECT_ROCKMONSTER:
			return globals::g_Game.ObjectNames_RockMonsterTypes_TABLE[objIndex];
		case OBJECT_BUILDING:
			return globals::g_Game.ObjectNames_BuildingTypes_TABLE[objIndex];
		case OBJECT_POWERCRYSTAL:
			return globals::g_Game.ObjectNames_PowerCrystal;
		case OBJECT_ORE:
			return globals::g_Game.ToolTypes_TABLE[objIndex + -0x1b];
		case OBJECT_DYNAMITE:
			return globals::g_Game.ObjectNames_Dynamite;
		case OBJECT_BARRIER:
			return globals::g_Game.ObjectNames_Barrier;
		case OBJECT_UPGRADEPART:
			return globals::g_Game.ObjectNames_UpgradeTypes_TABLE[objIndex];
		case OBJECT_ELECTRICFENCE:
			return globals::g_Game.ObjectNames_ElectricFence;
		case OBJECT_SPIDERWEB:
			return globals::g_Game.ObjectNames_SpiderWeb;
		case OBJECT_SONICBLASTER:
			return globals::g_Game.ObjectNames_OohScary;
		case OBJECT_PATH:
			return globals::g_Game.ObjectNames_Path;
		}
	}
	return NULL;
}



void __cdecl
lego::game::LiveObject_GetTypeIndex(LiveObject *param_1,int *out_objType,int *out_objIndex)
{
	*out_objType = param_1->objType;
	*out_objIndex = param_1->objIndex;
	return;
}



void __cdecl lego::main::Main_LoadToolNames(CFGProperty *root,char *keyBasePath)
{
	char *keyPath;
	char **ppcVar1;
	char ***pppcVar2;
	
	pppcVar2 = (char ***)globals::g_Game.ToolNames_TABLE;
	do {
		keyPath = cfg::CFG_JoinPath(keyBasePath,"ToolNames",pppcVar2[-0xb],0);
		ppcVar1 = (char **)cfg::CFG_CopyPropertyValue(root,keyPath);
		*pppcVar2 = ppcVar1;
		pppcVar2 = pppcVar2 + 1;
	} while (pppcVar2 < &globals::g_Game.ObjectNames_VehicleTypes_TABLE);
	return;
}



void __cdecl FUN_00439c50(void)
{
	if ((lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS & 0x10) != 0) {
		lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS =
				 lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS | 8;
		return;
	}
	lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS |= 4;
	if (lego::globals::g_Game.level != NULL) {
		(lego::globals::g_Game.level)->numDrainedCrystals = 0;
	}
	return;
}



BOOL __cdecl FUN_00439c80(LiveObject *liveObj)
{
	uint uVar1;
	uint uVar2;
	
	if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE) {
		return 0;
	}
	if (liveObj->objType == OBJECT_VEHICLE) {
		uVar2 = liveObj->field_328;
		uVar1 = lego::game::LiveObject_GetMaxCarry(liveObj);
		if (uVar1 <= uVar2) {
			uVar2 = lego::game::LiveObject_GetMaxCarry(liveObj);
		}
		if ((liveObj->numCarriedObjects < uVar2) && (liveObj->elapsedTime1 < 75.0)) {
			return 0;
		}
	}
	return 1;
}



BOOL __cdecl FUN_00439ce0(LiveObject *liveObj1,LiveObject *liveObj2)
{
	LiveObject *liveObj1_00;
	LiveObject *liveObj;
	BOOL BVar1;
	LevelSurfaceMap *pLVar2;
	LiveObject **ppLVar3;
	LiveObject **ppLVar4;
	float *local_24;
	float *local_20;
	LiveObject *local_1c;
	LiveObject *local_18;
	uint local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	liveObj1_00 = liveObj1;
	BVar1 = FUN_00439c80(liveObj1);
	liveObj = liveObj2;
	if ((BVar1 == 0) && (BVar1 = FUN_00439e90(liveObj1_00,liveObj2,1), BVar1 != 0)) {
		lego::game::LiveObject_GetPosition(liveObj,&local_10,&local_c);
		ppLVar4 = &liveObj1;
		ppLVar3 = &liveObj2;
		pLVar2 = lego::game::GetSurfaceMap();
		lego::game::SurfaceMap_ToBlockCoordinatesNoZ
							(pLVar2,local_10,local_c,(int *)ppLVar3,(int *)ppLVar4);
		lego::game::LiveObject_GetPosition(liveObj1_00,&local_8,&local_4);
		ppLVar4 = &local_18;
		ppLVar3 = &local_1c;
		pLVar2 = lego::game::GetSurfaceMap();
		lego::game::SurfaceMap_ToBlockCoordinatesNoZ
							(pLVar2,local_8,local_4,(int *)ppLVar3,(int *)ppLVar4);
		if ((local_1c == liveObj2) && (local_18 == liveObj1)) {
			FUN_004419c0(liveObj1_00,1,(float *)&liveObj2,(float *)&liveObj1,&local_10);
		}
		else {
			BVar1 = FUN_004413b0(liveObj1_00,local_1c,local_18,liveObj2,liveObj1,&local_24,&local_20,
													 &local_14,0,0);
			if (BVar1 == 0) {
				return 0;
			}
			FUN_004419c0(liveObj1_00,local_14,local_24,local_20,&local_10);
			std::free(local_24);
			std::free(local_20);
		}
		*(undefined *)((int)liveObj1_00->routeptr_24 + liveObj1_00->routingBlocksTotal * 0x14 + -3) = 3;
		liveObj1_00->object_2fc = liveObj;
		return 1;
	}
	return 0;
}



BOOL __cdecl FUN_00439e40(LiveObject *liveObj,undefined4 *param_2)
{
	ObjectStatsFlags3 OVar1;
	LiveObject *pLVar2;
	
	if (liveObj->objType == OBJECT_VEHICLE) {
		if (param_2[1] != 0) {
			return 0;
		}
		OVar1 = lego::game::LiveObject_GetStatsFlags3(liveObj);
		if ((OVar1 & STATS3_ENTERTOOLSTORE) == STATS3_NONE) {
			pLVar2 = FUN_00438da0(liveObj,NULL,*param_2,param_2[0xcc]);
			return (uint)(pLVar2 != NULL);
		}
	}
	return 1;
}



BOOL __cdecl FUN_00439e90(LiveObject *liveObj1,LiveObject *liveObj2,BOOL param_3)
{
	BOOL BVar1;
	ObjectStatsFlags1 OVar2;
	
	if (liveObj1->objType == OBJECT_ROCKMONSTER) {
		if ((liveObj1->flags3_3e8 & 0x8000000) == LIVEOBJ3_NONE) {
			return 0;
		}
	}
	else {
		if ((*(byte *)&liveObj1->flags3_3e8 & 0x20) == 0) {
			return 0;
		}
	}
	if ((*(byte *)&liveObj1->flags1_3e0 & 1) != 0) {
		return 0;
	}
	if (param_3 != 0) {
		BVar1 = FUN_0043bdb0(liveObj1);
		if (BVar1 != 0) {
			return 0;
		}
	}
	OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj1);
	if (((OVar2 & STATS1_PROCESSCRYSTAL) != STATS1_NONE) && (liveObj2->objType != OBJECT_POWERCRYSTAL)
		 ) {
		return 0;
	}
	OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj1);
	if (((OVar2 & STATS1_PROCESSORE) != STATS1_NONE) && (liveObj2->objType != OBJECT_ORE)) {
		return 0;
	}
	if ((liveObj1->numCarriedObjects != 0) &&
		 (liveObj1->carriedObjects[0]->objType != liveObj2->objType)) {
		return 0;
	}
	return 1;
}



void __cdecl lego::game::LiveObject_CompleteVehicleUpgrade(LiveObject *liveObj)
{
	uint uVar1;
	
	if (liveObj->objType == OBJECT_VEHICLE) {
		uVar1 = LiveObject_GetVehicle_UpgradesField8(liveObj->vehicle);
		uVar1 |= 1 << ((byte)liveObj->field_404 & 0x1f);
		LiveObject_VehicleChangeUpgradeParts(liveObj->vehicle,uVar1);
		LiveObject_SetLevel(liveObj,uVar1);
		front::Text_DisplayType(TEXT_UNITUPGRADED,1,0);
	}
	return;
}



BOOL __cdecl lego::game::LiveObject_SetLevel_thunk(LiveObject *liveObj,int objLevel)
{
	BOOL BVar1;
	
	BVar1 = LiveObject_SetLevel(liveObj,objLevel);
	return BVar1;
}



BOOL __cdecl lego::game::LiveObject_IsSmallTeleporter(LiveObject *liveObj)
{
	ObjectStatsFlags1 OVar1;
	
	OVar1 = LiveObject_GetStatsFlags1(liveObj);
	return OVar1 & STATS1_SMALLTELEPORTER;
}



BOOL __cdecl lego::game::LiveObject_IsBigTeleporter(LiveObject *liveObj)
{
	ObjectStatsFlags1 OVar1;
	
	OVar1 = LiveObject_GetStatsFlags1(liveObj);
	return OVar1 & STATS1_BIGTELEPORTER;
}



BOOL __cdecl lego::game::LiveObject_IsWaterTeleporter(LiveObject *liveObj)
{
	ObjectStatsFlags1 OVar1;
	
	OVar1 = LiveObject_GetStatsFlags1(liveObj);
	return OVar1 & STATS1_WATERTELEPORTER;
}



BOOL __cdecl FUN_0043a010(LiveObject *liveObj,Point2I *out_position)
{
	uint x;
	BOOL BVar1;
	int iVar2;
	uint y;
	uint uVar3;
	Point2I *pPVar4;
	Point2I local_28;
	Point2I DIRECTIONS [4];
	
	DIRECTIONS[0].y = -1;
	DIRECTIONS[3].x = -1;
	DIRECTIONS[1].x = 1;
	DIRECTIONS[2].y = 1;
	DIRECTIONS[0].x = 0;
	DIRECTIONS[1].y = 0;
	DIRECTIONS[2].x = 0;
	DIRECTIONS[3].y = 0;
	lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_28,&local_28.y);
	uVar3 = 0;
	pPVar4 = DIRECTIONS;
	do {
		pPVar4->x = pPVar4->x + local_28.x;
		y = pPVar4->y + local_28.y;
		pPVar4->y = y;
		x = pPVar4->x;
		BVar1 = lego::game::Level_GetBlockFlags1_8(x,y);
		if (BVar1 != 0) {
			iVar2 = FUN_00431cd0(NULL,x,pPVar4->y,x,pPVar4->y,0);
			if (iVar2 != 0) {
				if (out_position != NULL) {
					iVar2 = DIRECTIONS[uVar3].y;
					out_position->x = DIRECTIONS[uVar3].x;
					out_position->y = iVar2;
				}
				return 1;
			}
		}
		uVar3 += 1;
		pPVar4 = pPVar4 + 1;
	} while (uVar3 < 4);
	return 0;
}



BOOL __cdecl FUN_0043a0d0(LiveObject *liveObj,uint *param_2)
{
	ObjectStatsFlags3 OVar1;
	BOOL BVar2;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags3(liveObj);
	if ((OVar1 & STATS3_GETOUTATLAND) != STATS3_NONE) {
		BVar2 = FUN_0043a010(liveObj,(Point2I *)param_2);
		return BVar2;
	}
	return 0;
}



BOOL __cdecl FUN_0043a100(undefined4 *param_1,uint *param_2)
{
	ObjectStatsFlags3 OVar1;
	BOOL BVar2;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags3((LiveObject *)param_1);
	if ((OVar1 & STATS3_GETINATLAND) != STATS3_NONE) {
		BVar2 = FUN_0043a010((LiveObject *)param_1,(Point2I *)param_2);
		return BVar2;
	}
	return 0;
}



void __cdecl FUN_0043a130(LiveObject *in_liveObj,BOOL param_2)
{
	char cVar1;
	LiveFlags1 LVar2;
	LiveObject *liveObj;
	LiveObject *liveObj_00;
	LiveObject *liveObj1;
	ObjectStatsFlags1 OVar3;
	BOOL BVar4;
	uint uVar5;
	ResourceData *resData;
	int iVar6;
	uint uVar7;
	LiveObject **ppLVar8;
	AITaskType taskType;
	Point2I local_20;
	float local_18;
	float local_14 [2];
	Vector3F local_c;
	
	liveObj1 = in_liveObj;
	LVar2 = in_liveObj->flags1_3e0;
	if (((LVar2 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) &&
		 (((LVar2 & 0x2000) == LIVEOBJ1_NONE || (param_2 != 0)))) {
		liveObj = in_liveObj->object_2fc;
		uVar7 = 0;
		in_liveObj = NULL;
		if (liveObj != NULL) {
			OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj);
			in_liveObj = (LiveObject *)(OVar3 & STATS1_STOREOBJECTS);
		}
		if ((in_liveObj == NULL) && (param_2 != 0)) {
			FUN_00403c40(liveObj1,6,NULL,1);
			FUN_00403c40(liveObj1,9,NULL,1);
			FUN_00403c40(liveObj1,0xf,NULL,1);
			FUN_00403c40(liveObj1,0x14,NULL,1);
		}
		if (liveObj1->numCarriedObjects != 0) {
			ppLVar8 = liveObj1->carriedObjects;
			do {
				liveObj_00 = *ppLVar8;
				*ppLVar8 = NULL;
				liveObj_00->carryingThisObject = NULL;
				liveObj_00->object_300 = NULL;
				if ((in_liveObj == NULL) || (param_2 == 0)) {
					lego::game::LiveObject_GetBlockCoordinates(liveObj_00,(int *)&local_20,&local_20.y);
					BVar4 = lego::game::Level_GetBlockFlags1_8(local_20.x,local_20.y);
					if (BVar4 == 0) {
LAB_0043a27e:
						resData = lego::game::LiveObject_GetResource(liveObj_00);
						lego::game::LiveObject_GetPosition(liveObj1,&local_18,local_14);
						lego::res::Res_GetPosition(resData,NULL,&local_c);
						lego::res::Res_SetFramePosition(resData,NULL,local_18,local_14[0],local_c.z);
					}
					else {
						uVar5 = lego::game::Level_IsBlockLava(&local_20);
						if (uVar5 != 0) goto LAB_0043a27e;
						BVar4 = FUN_004329d0(local_20.x,local_20.y,0);
						if (BVar4 != 0) goto LAB_0043a27e;
					}
					if (param_2 == 0) {
						if ((LVar2 & 0x200) == LIVEOBJ1_NONE) {
							FUN_00403b30(liveObj1,AITASK_DEPOSITE,liveObj_00);
							FUN_00403b30(liveObj1,AITASK_DUMP,liveObj_00);
							FUN_00403b30(liveObj1,AITASK_DYNAMITE,liveObj_00);
							FUN_00403b30(liveObj1,AITASK_ELECFENCE,liveObj_00);
							FUN_00403b30(liveObj1,AITASK_REQUEST,liveObj_00);
							FUN_00403b30(liveObj1,AITASK_GATHER,NULL);
							taskType = AITASK_SONICBLASTER;
						}
						else {
							taskType = AITASK_COLLECT;
						}
						FUN_00403b30(liveObj1,taskType,liveObj_00);
					}
					else {
						FUN_00403c40(liveObj1,7,liveObj_00,(uint)(uVar7 == liveObj1->numCarriedObjects - 1));
						if ((liveObj_00->objType != OBJECT_ORE) && (liveObj_00->objType != OBJECT_POWERCRYSTAL))
						{
							liveObj_00->flags1_3e0 = liveObj_00->flags1_3e0 | LIVEOBJ1_PLACING;
						}
					}
					if (liveObj_00->objType == OBJECT_BOULDER) {
						lego::game::LiveObject_ReleaseBoulderUnk(liveObj_00);
					}
				}
				else {
					FUN_00403c40(liveObj1,5,liveObj_00,1);
					FUN_0043ab10(liveObj,liveObj_00);
					FUN_00439c50();
				}
				uVar7 += 1;
				ppLVar8 = ppLVar8 + 1;
			} while (uVar7 < liveObj1->numCarriedObjects);
		}
		uVar7 = 0;
		liveObj1->numCarriedObjects = 0;
		liveObj1->flags1_3e0 = liveObj1->flags1_3e0 & ~LIVEOBJ1_CARRYING;
		if (liveObj1->routingBlocksTotal != 0) {
			iVar6 = 0;
			do {
				cVar1 = *(char *)(iVar6 + 0x11 + (int)liveObj1->routeptr_24);
				if ((cVar1 == '\a') || (cVar1 == '\x05')) {
					*(undefined *)(iVar6 + 0x11 + (int)liveObj1->routeptr_24) = 0;
				}
				uVar7 += 1;
				iVar6 += 0x14;
			} while (uVar7 < liveObj1->routingBlocksTotal);
		}
	}
	return;
}



int __cdecl FUN_0043a3e0(int *param_1,float *param_2,float *param_3,int param_4,int param_5)
{
	float fVar1;
	int iVar2;
	int iVar3;
	short sVar4;
	BOOL BVar5;
	uint uVar6;
	BOOL BVar7;
	float10 fVar8;
	float *local_1c;
	float *local_18;
	float local_14;
	float local_10;
	uint local_c;
	float local_8;
	float local_4;
	
	BVar7 = 0;
	if ((param_1[0xf8] & 0x400U) != 0) {
		lego::game::LiveObject_GetBlockCoordinates
							((LiveObject *)param_1,(int *)&local_14,(int *)&local_10);
		if ((local_14 == *param_2) && (local_10 == param_2[1])) {
			BVar7 = FUN_004419c0((LiveObject *)param_1,1,param_2,param_2 + 1,NULL);
		}
		else {
			BVar5 = FUN_004413b0(param_1,local_14,local_10,*param_2,param_2[1],&local_1c,&local_18,
													 &local_c,0,0);
			if (BVar5 != 0) {
				BVar7 = FUN_004419c0((LiveObject *)param_1,local_c,local_1c,local_18,NULL);
				std::free(local_1c);
				std::free(local_18);
			}
		}
		if (BVar7 != 0) {
			if (*param_1 == 1) {
				fVar8 = lego::game::Game_ChooseRandomRange(0.55,0.75);
				fVar1 = (float)fVar8;
				sVar4 = lego::util::randomInt16();
				uVar6 = (int)sVar4 >> 0x1f;
				param_5 = 1;
				switch((((int)sVar4 ^ uVar6) - uVar6 & 3 ^ uVar6) - uVar6) {
				case 0:
					local_8 = 0.5;
					local_4 = fVar1;
					break;
				case 1:
					local_4 = 0.5;
					local_8 = fVar1;
					break;
				case 2:
					local_8 = 0.5;
					local_4 = 1.0 - fVar1;
					break;
				case 3:
					local_4 = 0.5;
					local_8 = 1.0 - fVar1;
				}
			}
			else {
				local_8 = *param_3;
				local_4 = param_3[1];
			}
			if (param_4 == 0) {
				*(undefined *)(param_1[9] + -3 + param_1[10] * 0x14) = 8;
			}
			else {
				*(undefined *)(param_1[9] + -3 + param_1[10] * 0x14) = 9;
			}
			if (param_3 != NULL) {
				iVar2 = param_1[10];
				iVar3 = param_1[9];
				*(float *)(iVar3 + -0xc + iVar2 * 0x14) = local_8;
				*(float *)(iVar3 + -8 + iVar2 * 0x14) = local_4;
			}
			if (param_5 != 0) {
				*(byte *)(param_1[9] + -4 + param_1[10] * 0x14) =
						 *(byte *)(param_1[9] + -4 + param_1[10] * 0x14) | 8;
			}
		}
	}
	return BVar7;
}



BOOL __cdecl FUN_0043a5c0(LiveObject *liveObj1,LiveObject *liveObj2)
{
	byte *pbVar1;
	LiveObject *liveObj;
	LiveObject *liveObj_00;
	ObjectStatsFlags1 OVar2;
	BOOL BVar3;
	LevelSurfaceMap *pLVar4;
	ResourceData *resData;
	float in_x;
	float in_y;
	LiveObject **ppLVar5;
	LiveObject **ppLVar6;
	LiveObject *local_3c;
	float *local_38;
	float *local_34;
	LiveObject *local_30;
	uint local_2c;
	float local_28;
	float local_24;
	float local_20;
	float local_1c;
	Vector3F local_18;
	Vector3F local_c;
	
	liveObj = liveObj1;
	if ((liveObj1->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) {
		OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj1);
		if (((OVar2 & STATS1_PROCESSCRYSTAL) != STATS1_NONE) ||
			 (OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj), liveObj_00 = liveObj2,
			 (OVar2 & STATS1_PROCESSORE) != STATS1_NONE)) {
			liveObj->flags1_3e0 = liveObj->flags1_3e0 | 0x2000;
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_DESPOSITE,1);
			lego::game::Game_UpdateSomeAITasks(liveObj);
			FUN_00447df0(liveObj,1.0);
			return 1;
		}
		BVar3 = FUN_00439e90(liveObj2,liveObj->carriedObjects[0],0);
		if ((BVar3 != 0) ||
			 (OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj_00),
			 (OVar2 & STATS1_STOREOBJECTS) != STATS1_NONE)) {
			resData = NULL;
			OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj_00);
			if ((OVar2 & STATS1_STOREOBJECTS) == STATS1_NONE) {
				if (liveObj_00->objType == OBJECT_BUILDING) {
					resData = lego::res::Building_GetDepositNull(liveObj_00->building);
				}
			}
			else {
				resData = lego::res::Building_GetToolNull(liveObj_00->building,DAT_004dfe40);
			}
			if (resData == NULL) {
				lego::game::LiveObject_GetPosition(liveObj_00,&local_28,&local_24);
			}
			else {
				lego::res::Res_GetPosition(resData,NULL,&local_c);
				lego::res::Res_GetOrientation(resData,NULL,&local_18,NULL);
				local_28 = local_c.x;
				local_24 = local_c.y;
				if (ABS(local_18.x) <= ABS(local_18.y)) {
					if ((ushort)((ushort)(local_18.y < 0.0) << 8 | (ushort)(local_18.y == 0.0) << 0xe) == 0) {
						liveObj1._0_1_ = 2;
					}
					else {
						liveObj1._0_1_ = 0;
					}
				}
				else {
					if ((ushort)((ushort)(local_18.x < 0.0) << 8 | (ushort)(local_18.x == 0.0) << 0xe) == 0) {
						liveObj1._0_1_ = 3;
					}
					else {
						liveObj1._0_1_ = 1;
					}
				}
			}
			ppLVar6 = &liveObj1;
			ppLVar5 = &liveObj2;
			in_x = local_28;
			in_y = local_24;
			pLVar4 = lego::game::GetSurfaceMap();
			lego::game::SurfaceMap_ToBlockCoordinatesNoZ(pLVar4,in_x,in_y,(int *)ppLVar5,(int *)ppLVar6);
			lego::game::LiveObject_GetPosition(liveObj,&local_20,&local_1c);
			ppLVar6 = &local_3c;
			ppLVar5 = &local_30;
			pLVar4 = lego::game::GetSurfaceMap();
			lego::game::SurfaceMap_ToBlockCoordinatesNoZ
								(pLVar4,local_20,local_1c,(int *)ppLVar5,(int *)ppLVar6);
			if ((local_30 == liveObj2) && (local_3c == liveObj1)) {
				BVar3 = FUN_004419c0(liveObj,1,(float *)&liveObj2,(float *)&liveObj1,&local_28);
			}
			else {
				BVar3 = FUN_004413b0(liveObj,local_30,local_3c,liveObj2,liveObj1,&local_38,&local_34,
														 &local_2c,0,0);
				if (BVar3 == 0) {
					return 0;
				}
				BVar3 = FUN_004419c0(liveObj,local_2c,local_38,local_34,&local_28);
				std::free(local_38);
				std::free(local_34);
			}
			if (BVar3 != 0) {
				liveObj->object_2fc = liveObj_00;
				OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj_00);
				if ((OVar2 & STATS1_STOREOBJECTS) != STATS1_NONE) {
					*(undefined *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -3) = 9;
					liveObj->object_2fc = liveObj_00;
					return 1;
				}
				*(undefined *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -3) = 7;
				*(byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -4) =
						 *(byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -4) | 4;
				pbVar1 = (byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -4);
				*pbVar1 = *pbVar1 | (byte)liveObj1 & 3;
			}
			return 1;
		}
	}
	return 0;
}



ResourceData * __cdecl lego::game::LiveObject_GetDepositNull(LiveObject *liveObj)
{
	ObjectType OVar1;
	ResourceData *pRVar2;
	
	pRVar2 = NULL;
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_BUILDING) {
		pRVar2 = res::Building_GetDepositNull(liveObj->building);
	}
	else {
		if (OVar1 == OBJECT_ROCKMONSTER) {
			pRVar2 = res::Creature_GetDepositNull(liveObj->rockMonster);
		}
		else {
			if (OVar1 == OBJECT_MINIFIGURE) {
				pRVar2 = res::Creature_GetDepositNull(liveObj->miniFigure);
			}
			else {
				if (OVar1 == OBJECT_VEHICLE) {
					pRVar2 = res::Vehicle_GetDepositNull(liveObj->vehicle);
				}
			}
		}
	}
	if (pRVar2 == NULL) {
		pRVar2 = LiveObject_GetResource(liveObj);
	}
	return pRVar2;
}



int __cdecl FUN_0043a910(LiveObject *liveObj,ObjectType objType,int objIndex,int objLevel)
{
	BOOL BVar1;
	int iVar2;
	ResourceData *pRVar3;
	LiveObject *liveObj_00;
	MessageType msgType;
	Vector3F local_c;
	
	BVar1 = lego::game::LiveObject_CanSpawnCarryableObject(liveObj,objType,objIndex);
	if (BVar1 == 0) {
		return (int)NULL;
	}
	switch(objType) {
	case OBJECT_POWERCRYSTAL:
	case OBJECT_ORE:
		iVar2 = 10;
		break;
	case OBJECT_DYNAMITE:
		iVar2 = 9;
		break;
	case OBJECT_BARRIER:
		iVar2 = 8;
		break;
	default:
		iVar2 = 0;
	}
	pRVar3 = lego::res::Building_GetToolNull(liveObj->building,(&DAT_004dfe18)[iVar2]);
	lego::res::Res_GetPosition(pRVar3,NULL,&local_c);
	pRVar3 = lego::globals::g_Game.RES_Crystal;
	if (objType == OBJECT_POWERCRYSTAL) {
		FUN_00439c50();
		lego::game::Level_SubtractCrystals(1);
	}
	else {
		if (objType == OBJECT_ORE) {
			pRVar3 = lego::globals::g_Game.RES_Ores_TABLE[objIndex];
			lego::game::Level_SubtractOre(objIndex,1);
		}
		else {
			pRVar3 = lego::globals::g_Game.RES_Barrier;
			if ((((objType != OBJECT_BARRIER) &&
					 (pRVar3 = lego::globals::g_Game.RES_Dynamite, objType != OBJECT_DYNAMITE)) &&
					(pRVar3 = lego::globals::g_Game.RES_ElectricFence, objType != OBJECT_ELECTRICFENCE)) &&
				 (pRVar3 = lego::globals::g_Game.RES_OohScary, objType != OBJECT_SONICBLASTER)) {
				return (int)NULL;
			}
		}
	}
	liveObj_00 = lego::game::Game_CreateLiveResourceObject
												 (pRVar3,objType,objIndex,objLevel,local_c.x,local_c.y,0.0);
	if (objType == OBJECT_ORE) {
		msgType = MESSAGE_GENERATEORE_COMPLETE;
	}
	else {
		msgType = MESSAGE_GENERATECRYSTAL_COMPLETE;
	}
	lego::game::Level_AddMessageAction(msgType,liveObj_00,0,NULL);
	if (objType != OBJECT_BARRIER) {
		if (objType == OBJECT_DYNAMITE) {
			lego::res::Res_ResourceShortNormal_FUN_00473630(liveObj_00->other,"Normal");
		}
		return (int)liveObj_00;
	}
	lego::res::Res_ResourceShortNormal_FUN_00473630(liveObj_00->other,"Short");
	return (int)liveObj_00;
}



BOOL __cdecl
lego::game::LiveObject_CanSpawnCarryableObject(LiveObject *liveObj,ObjectType objType,int objIndex)
{
	ObjectStatsFlags1 OVar1;
	int iVar2;
	
	OVar1 = LiveObject_GetStatsFlags1(liveObj);
	if ((OVar1 & STATS1_STOREOBJECTS) != STATS1_NONE) {
		if (objType == OBJECT_POWERCRYSTAL) {
			iVar2 = Level_GetCrystalCount(1);
			if (iVar2 != 0) {
				return 1;
			}
		}
		if (objType == OBJECT_ORE) {
			iVar2 = Level_GetOreCount(objIndex);
			if (iVar2 != 0) {
				return 1;
			}
		}
		if (objType == OBJECT_BARRIER) {
			return 1;
		}
		if (objType == OBJECT_DYNAMITE) {
			return 1;
		}
		if (objType == OBJECT_ELECTRICFENCE) {
			return 1;
		}
		if (objType == OBJECT_SONICBLASTER) {
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_0043ab10(LiveObject *liveObj,LiveObject *liveObj2)
{
	int *piVar1;
	int iVar2;
	
	if ((liveObj->objType == OBJECT_ROCKMONSTER) && (liveObj->tableptr_348 == NULL)) {
		piVar1 = (int *)std::malloc(0x18);
		liveObj->tableptr_348 = piVar1;
		for (iVar2 = 6; iVar2 != 0; iVar2 += -1) {
			*piVar1 = 0;
			piVar1 = piVar1 + 1;
		}
	}
	if (liveObj2->objType == OBJECT_POWERCRYSTAL) {
		if (liveObj->objType == OBJECT_ROCKMONSTER) {
			liveObj->tableptr_348[liveObj2->objLevel] = liveObj->tableptr_348[liveObj2->objLevel] + 1;
		}
		else {
			lego::game::Level_IncField8c();
		}
	}
	else {
		if ((liveObj2->objType == OBJECT_ORE) && (liveObj->objType != OBJECT_ROCKMONSTER)) {
			FUN_0041f8d0(liveObj2->objIndex);
		}
	}
	liveObj2->carryingThisObject = NULL;
	lego::pool::ReservedPool_LiveObject___Release(liveObj2);
	if (liveObj->objType != OBJECT_ROCKMONSTER) {
		FUN_00403840(liveObj);
	}
	return;
}



void __cdecl FUN_0043abb0(undefined4 param_1,int param_2)
{
	if (param_2 != 0) {
		do {
			lego::game::Level_IncField8c();
			param_2 += -1;
		} while (param_2 != 0);
	}
	FUN_00439c50();
	return;
}



void __cdecl FUN_0043abd0(undefined4 param_1,int param_2)
{
	if (param_2 != 0) {
		do {
			FUN_0041f8d0(0);
			param_2 += -1;
		} while (param_2 != 0);
	}
	return;
}



void __cdecl FUN_0043abf0(LiveObject *liveObj)
{
	LiveObject **ppLVar1;
	uint uVar2;
	
	uVar2 = 0;
	if (UINT_004ebd5c != 0) {
		ppLVar1 = PTR_ARRAY_004ebbcc;
		do {
			if (liveObj == *ppLVar1) {
				*ppLVar1 = NULL;
			}
			uVar2 += 1;
			ppLVar1 = ppLVar1 + 1;
		} while (uVar2 < UINT_004ebd5c);
	}
	return;
}



void __cdecl FUN_0043ac20(LiveObject *liveObj)
{
	ObjectStatsFlags1 OVar1;
	int local_8;
	int local_4;
	
	if (liveObj->objType == OBJECT_VEHICLE) {
		OVar1 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		if ((OVar1 & STATS1_CROSSLAND) == STATS1_NONE) {
			lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_8,&local_4);
			if (((lego::globals::g_Game.level)->blocks
					 [((lego::globals::g_Game.level)->dimensions).width * local_4 + local_8].terrain ==
					 TERRAIN_LAKE) && (UINT_004ebd5c < 100)) {
				PTR_ARRAY_004ebbcc[UINT_004ebd5c] = liveObj;
				UINT_004ebd5c += 1;
			}
		}
	}
	return;
}



void __cdecl FUN_0043aca0(LiveObject *liveObj)
{
	FUN_0043ac20(liveObj);
	return;
}



void __cdecl FUN_0043acb0(uint *param_1,undefined4 *param_2)
{
	int local_10;
	int local_c;
	int local_8;
	int local_4;
	
	if (((((param_1[0xf8] & 0x400) == 0) && ((*(byte *)(param_1 + 0xf9) & 1) == 0)) &&
			((param_1[0xf8] & 0x1000100) == 0)) &&
		 ((((ushort)((ushort)((float)param_1[0xd0] < 0.0) << 8 |
								(ushort)((float)param_1[0xd0] == 0.0) << 0xe) == 0 && ((param_2[0xf8] & 0x400) != 0)
			 ) && (*(int *)param_2[0xc2] == 6)))) {
		lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_1,&local_10,&local_c);
		lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_2,&local_8,&local_4);
		if (lego::globals::g_Activities_TABLE[36] != (char *)param_1[0xba]) {
			lego::game::LiveObject_SetActivityUnk((LiveObject *)param_1,ACTIVITY_STAMP,0);
			lego::game::Game_UpdateSomeAITasks((LiveObject *)param_1);
			param_1[0xf9] = param_1[0xf9] | 0x200000;
		}
	}
	return;
}



void __cdecl FUN_0043ad70(uint *param_1)
{
	ObjectStatsFlags2 OVar1;
	BOOL BVar2;
	uint uVar3;
	LevelSurfaceMap *pLVar4;
	float10 fVar5;
	float10 fVar6;
	float *out_x;
	float *out_y;
	Point2I local_18;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	if (*param_1 == 3) {
		OVar1 = lego::game::LiveObject_GetStatsFlags2((LiveObject *)param_1);
		if ((OVar1 & STATS2_ATTACKPATHS) != STATS2_NONE) {
			fVar5 = lego::game::LiveObject_GetPainThreshold((LiveObject *)param_1);
			if (((fVar5 < (float10)(float)param_1[0xd0]) &&
					(lego::globals::g_Activities_TABLE[36] != (char *)param_1[0xba])) &&
				 ((param_1[0xf8] & 0x400) == 0)) {
				lego::game::LiveObject_GetBlockCoordinates
									((LiveObject *)param_1,(int *)&local_18,&local_18.y);
				BVar2 = lego::game::Level_IsBlockPowerPath(&local_18);
				if (BVar2 != 0) {
					uVar3 = FUN_00432f60((int *)&local_18);
					if (uVar3 == 0) {
						lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_10,&local_c);
						out_y = &local_4;
						out_x = &local_8;
						pLVar4 = lego::game::GetSurfaceMap();
						FUN_0044f900(pLVar4,local_18.x,local_18.y,out_x,out_y);
						pLVar4 = lego::game::GetSurfaceMap();
						fVar6 = lego::game::SurfaceMap_GetFloat10(pLVar4);
						fVar5 = (float10)SQRT((local_c - local_4) * (local_c - local_4) +
																	(local_10 - local_8) * (local_10 - local_8));
						if ((ushort)((ushort)(fVar6 * (float10)0.3333333 < fVar5) << 8 |
												(ushort)(fVar6 * (float10)0.3333333 == fVar5) << 0xe) == 0) {
							lego::game::LiveObject_SetActivityUnk((LiveObject *)param_1,ACTIVITY_STAMP,0);
							lego::game::Game_UpdateSomeAITasks((LiveObject *)param_1);
							param_1[0xf9] = param_1[0xf9] | 0x200000;
						}
					}
				}
			}
		}
	}
	return;
}



void __cdecl FUN_0043aeb0(LiveObject *liveObj)
{
	short sVar1;
	BOOL BVar2;
	Point2I local_8;
	
	lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_8,&local_8.y);
	sVar1 = lego::util::randomInt16();
	if ((int)sVar1 % 5 == 0) {
		FUN_00435160(&local_8,3,1);
	}
	BVar2 = lego::game::Level_IsBlockPowerPath(&local_8);
	if (BVar2 != 0) {
		FUN_0040bde0(liveObj,NULL);
		FUN_00430250(&local_8,0x3f);
		lego::game::Level_UpdateBlockSurfaceUnk(lego::globals::g_Game.level,local_8.x,local_8.y);
	}
	FUN_00437a70(FUN_0043af50,liveObj);
	return;
}



undefined4 __cdecl FUN_0043af50(int *param_1,undefined4 *param_2)
{
	float10 fVar1;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	if (((*param_1 == 2) && ((param_1[0xf8] & 0x400U) != 0)) && (*(int *)param_1[0xc2] == 6)) {
		lego::game::LiveObject_GetPosition((LiveObject *)param_2,&local_8,&local_4);
		lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_10,&local_c);
		fVar1 = lego::game::LiveObject_GetStampRadius((LiveObject *)param_2);
		if ((float10)SQRT((local_c - local_4) * (local_c - local_4) +
											(local_10 - local_8) * (local_10 - local_8)) < fVar1) {
			FUN_0043a130((LiveObject *)param_1,0);
			lego::game::LiveObject_UnkDoRouting_FUN_00441c00((LiveObject *)param_1,0);
		}
	}
	return 0;
}



uint * __cdecl FUN_0043b010(undefined4 *param_1,uint param_2)
{
	short sVar1;
	LevelSurfaceMap *surfMap;
	LiveObject *liveObj;
	float10 fVar2;
	float10 fVar3;
	uint x;
	uint y;
	float *out_x;
	float *out_y;
	float local_18;
	float local_14;
	uint local_10;
	uint local_c;
	float local_8;
	float local_4;
	
	liveObj = NULL;
	if (lego::globals::g_SlimySlugHoles_COUNT != 0) {
		fVar2 = lego::game::Game_ChooseRandomRange(0.0,6.283185);
		fVar3 = (float10)fsin(fVar2);
		local_8 = (float)fVar3;
		fVar3 = (float10)fcos((float10)(float)fVar2);
		local_4 = (float)fVar3;
		if (param_1 == NULL) {
			sVar1 = lego::util::randomInt16();
			local_10 = lego::globals::g_SlimySlugHoles_TABLE
								 [(uint)(int)sVar1 % lego::globals::g_SlimySlugHoles_COUNT].x;
			local_c = lego::globals::g_SlimySlugHoles_TABLE
								[(uint)(int)sVar1 % lego::globals::g_SlimySlugHoles_COUNT].y;
		}
		else {
			FUN_0044a7b0(param_1,&local_10);
		}
		out_y = &local_14;
		out_x = &local_18;
		x = local_10;
		y = local_c;
		surfMap = lego::game::GetSurfaceMap();
		FUN_0044f900(surfMap,x,y,out_x,out_y);
		local_18 = local_8 * 12.75 + local_18;
		local_14 = local_4 * 12.75 + local_14;
		liveObj = lego::game::Game_CreateLiveResourceObject
												((ResourceData *)(lego::globals::g_Game.RockMonsterData_TABLE + param_2),
												 OBJECT_ROCKMONSTER,param_2,0,local_18,local_14,(float)fVar2);
		if (liveObj != NULL) {
			liveObj->flags1_3e0 = liveObj->flags1_3e0 | 0x100;
			liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0x7fffffff;
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_EMERGE,0);
			lego::game::Game_UpdateSomeAITasks(liveObj);
			FUN_00403e60(liveObj);
			lego::game::Info_FUN_00419ab0(INFO_SLUGEMERGE,NULL,liveObj,NULL);
		}
	}
	return (uint *)liveObj;
}



uint * __cdecl FUN_0043b160(void)
{
	int iVar1;
	int iVar2;
	short sVar3;
	short sVar4;
	uint uVar5;
	LevelSurfaceMap *pLVar6;
	uint *puVar7;
	uint local_c;
	
	uVar5 = lego::game::Level_GetEmergeCreature();
	pLVar6 = lego::game::GetSurfaceMap();
	iVar1 = (pLVar6->smallDimensions).width;
	pLVar6 = lego::game::GetSurfaceMap();
	iVar2 = (pLVar6->smallDimensions).height;
	local_c = 0;
	do {
		sVar3 = lego::util::randomInt16();
		sVar4 = lego::util::randomInt16();
		puVar7 = FUN_0043b1f0((int **)(lego::globals::g_Game.RockMonsterData_TABLE + uVar5),4.203895e-45
													,uVar5,(int)sVar3 % iVar1,(int)sVar4 % iVar2);
		if (puVar7 != NULL) {
			return puVar7;
		}
		local_c += 1;
	} while (local_c < 1000);
	return NULL;
}



uint * __cdecl FUN_0043b1f0(int **param_1,float param_2,uint param_3,uint param_4,uint param_5)
{
	BOOL BVar1;
	uint uVar2;
	int iVar3;
	LevelSurfaceMap *pLVar4;
	LiveObject *liveObj;
	ResourceData *resData;
	uint uVar5;
	Point2I *position;
	bool bVar6;
	ObjectType x;
	uint uVar7;
	float *pfVar8;
	float *pfVar9;
	float local_44;
	float local_40;
	float local_3c;
	Point2I local_38;
	float local_30 [4];
	Point2I local_20;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	uVar7 = param_5;
	x = param_4;
	local_38.x = param_4;
	local_38.y = param_5;
	if (param_2 != 4.203895e-45) {
		return (uint *)NULL;
	}
	BVar1 = lego::game::Level_GetBlockFlags1_10Not8(param_4,param_5);
	if (BVar1 == 0) {
		return (uint *)NULL;
	}
	BVar1 = lego::game::Level_GetBlockFlags1_20(x,uVar7);
	if (BVar1 != 0) {
		return (uint *)NULL;
	}
	BVar1 = lego::game::Level_GetBlockFlags1_c0(x,uVar7);
	if (BVar1 != 0) {
		return (uint *)NULL;
	}
	uVar2 = lego::game::Level_IsBlockSolid(&local_38);
	if (uVar2 != 0) {
		return (uint *)NULL;
	}
	uVar2 = lego::game::Level_GetBlockFlags1_8000000(&local_38);
	if (uVar2 != 0) {
		return (uint *)NULL;
	}
	uVar2 = 0;
	local_20.x = 0;
	local_20.y = -1;
	local_18 = 1;
	local_14 = 0;
	local_10 = 0;
	local_c = 1;
	local_8 = 0xffffffff;
	local_4 = 0;
	local_30[0] = 0.0;
	local_30[1] = 1.570796;
	local_30[2] = 3.141593;
	local_30[3] = 4.712389;
	position = &local_20;
	do {
		position->x = position->x + x;
		uVar5 = position->y + uVar7;
		position->y = uVar5;
		BVar1 = lego::game::Level_GetBlockFlags1_8(position->x,uVar5);
		if (((BVar1 != 0) && (BVar1 = lego::game::Level_GetBlockFlags1_180000(position), BVar1 == 0)) &&
			 (iVar3 = FUN_00431cd0(NULL,position->x,position->y,position->x,position->y,0), iVar3 != 0))
		break;
		uVar2 += 1;
		position = position + 1;
	} while (uVar2 < 4);
	if (3 < uVar2) {
		return (uint *)NULL;
	}
	pfVar9 = &local_3c;
	pfVar8 = &local_40;
	pLVar4 = lego::game::GetSurfaceMap();
	FUN_0044f900(pLVar4,x,uVar7,pfVar8,pfVar9);
	uVar7 = (&local_20)[uVar2].y;
	pfVar9 = &param_2;
	pfVar8 = &local_44;
	uVar5 = (&local_20)[uVar2].x;
	pLVar4 = lego::game::GetSurfaceMap();
	FUN_0044f900(pLVar4,uVar5,uVar7,pfVar8,pfVar9);
	local_44 = (local_40 * 9.0 + local_44 * 10.0) * 0.05263158;
	param_2 = (local_3c * 9.0 + param_2 * 10.0) * 0.05263158;
	liveObj = lego::game::Game_CreateLiveResourceObject
											((ResourceData *)param_1,OBJECT_ROCKMONSTER,param_3,0,local_44,param_2,
											 local_30[uVar2]);
	liveObj->flags1_3e0 = liveObj->flags1_3e0 | 0x100;
	FUN_00443ab0(liveObj);
	lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_EMERGE,0);
	lego::game::Game_UpdateSomeAITasks(liveObj);
	FUN_00403e60(liveObj);
	resData = lego::game::LiveObject_GetResource(liveObj);
	lego::res::Res_PlayResourceSound(resData,10,0,1,NULL);
	lego::game::Level_SetBlockFlags1_8000000(&local_38,1);
	bVar6 = false;
	(liveObj->point_2f4).x = (float)local_38.x;
	(liveObj->point_2f4).y = (float)local_38.y;
	BVar1 = lego::game::Game_GetObjectByName("RockMonster",&param_4,(int *)&param_5,NULL);
	if (((BVar1 != 0) && (param_4 == liveObj->objType)) && (param_5 == liveObj->objIndex)) {
		lego::game::Info_FUN_00419ab0(INFO_ROCKMONSTER,NULL,liveObj,NULL);
		bVar6 = true;
	}
	if (!bVar6) {
		BVar1 = lego::game::Game_GetObjectByName("Lavamonster",&param_4,(int *)&param_5,NULL);
		if (((BVar1 != 0) && (param_4 == liveObj->objType)) && (param_5 == liveObj->objIndex)) {
			lego::game::Info_FUN_00419ab0(INFO_LAVAROCKMONSTER,NULL,liveObj,NULL);
			bVar6 = true;
		}
		if (!bVar6) {
			BVar1 = lego::game::Game_GetObjectByName("Icemonster",&param_4,(int *)&param_5,NULL);
			if (((BVar1 != 0) && (param_4 == liveObj->objType)) && (param_5 == liveObj->objIndex)) {
				lego::game::Info_FUN_00419ab0(INFO_ICEROCKMONSTER,NULL,liveObj,NULL);
				bVar6 = true;
			}
			if (!bVar6) goto LAB_0043b517;
		}
	}
	lego::game::Info_FUN_00419ab0(INFO_GENERICMONSTER,NULL,liveObj,NULL);
LAB_0043b517:
	lego::nerps::NERPs_IncDat_00556324();
	return (uint *)liveObj;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_0043b530(float param_1)
{
	uint uVar1;
	uint uVar2;
	
	if ((lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS & 4) != 0) {
		FUN_00432130();
	}
	lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS |= 0x10;
	FUN_00437a90(FUN_0043cad0,&param_1,0);
	uVar2 = lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS & 0xffffffef;
	uVar1 = lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS & 4;
	lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS = uVar2;
	if (uVar1 != 0) {
		FUN_004320d0();
	}
	if ((lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS & 8) == 0) {
		lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS &= 0xfffffffb;
	}
	else {
		FUN_00439c50();
		lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS &= 0xfffffff7;
	}
	FUN_0044c1c0(&param_1);
	_DAT_004ebdc8 = _DAT_004ebdc8 - param_1;
	if ((ushort)((ushort)(_DAT_004ebdc8 < 0.0) << 8 | (ushort)(_DAT_004ebdc8 == 0.0) << 0xe) != 0) {
		_DAT_004ebdc8 = 125.0;
		FUN_00425a70(1);
	}
	return;
}



void __cdecl FUN_0043b5e0(void)
{
	lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS |= 2;
	FUN_00437a70(FUN_0043b610,NULL);
	lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS =
			 lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS & 0xfffffffd;
	return;
}



void __cdecl FUN_0043b610(int *param_1)
{
	lego::pool::ReservedPool_LiveObject___Release((LiveObject *)param_1);
	return;
}



void __cdecl FUN_0043b620(uint param_1,uint param_2,undefined4 *param_3)
{
	undefined4 *local_c;
	float local_8;
	char *local_4;
	
	local_c = param_3;
	*param_3 = 0;
	local_8 = (float)(ulonglong)param_1;
	local_4 = (char *)(float)(ulonglong)param_2;
	FUN_00437a70(FUN_0043b670,(LiveObject *)&local_c);
	return;
}



BOOL __cdecl FUN_0043b670(LiveObject *liveObj,int **param_2)
{
	BOOL BVar1;
	LevelSurfaceMap *pLVar2;
	ResourceData *resData;
	int iVar3;
	uint *puVar4;
	uint uVar5;
	uint uVar6;
	int iVar7;
	Vector3F *pVVar8;
	void *pvVar9;
	float10 fVar10;
	uint x;
	Vector3F *pVVar11;
	float x_00;
	Vector3F *b;
	float *out_y;
	float y;
	uint local_d0;
	uint local_cc;
	uint *local_c8;
	void *local_c4;
	int *local_c0;
	int *local_bc;
	undefined4 local_b8;
	undefined4 local_b4;
	Vector3F local_b0;
	Vector3F local_a4;
	int local_98;
	int local_94;
	Vector3F local_90;
	float local_84;
	float local_80;
	float local_7c;
	Vector3F local_78 [10];
	
	pvVar9 = lego::globals::g_Game.ptr_1c;
	local_c0 = param_2[1];
	local_bc = param_2[2];
	iVar7 = 1;
	local_c4 = lego::globals::g_Game.ptr_1c;
	local_b8 = 0;
	local_b4 = 0x3f800000;
	BVar1 = FUN_00438870(liveObj,1);
	if (BVar1 != 0) {
		lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_98,&local_94);
		lego::game::LiveObject_GetPosition(liveObj,(float *)local_78,&local_78[0].y);
		pLVar2 = lego::game::GetSurfaceMap();
		fVar10 = lego::game::SurfaceMap_UnkGetZ(pLVar2,local_78[0].x,local_78[0].y);
		local_78[0].z = (float)fVar10;
		fVar10 = lego::game::LiveObject_GetCollHeight(liveObj);
		local_78[0].z = (float)((float10)local_78[0].z - fVar10 * (float10)0.5);
		if (liveObj->objType == OBJECT_BUILDING) {
			resData = lego::game::LiveObject_GetResource(liveObj);
			uVar6 = 0;
			lego::res::Res_GetOrientation(resData,NULL,&local_b0,NULL);
			if (ABS(local_b0.x) <= ABS(local_b0.y)) {
				if ((ushort)((ushort)(local_b0.y < 0.0) << 8 | (ushort)(local_b0.y == 0.0) << 0xe) == 0) {
					iVar7 = 0;
				}
				else {
					iVar7 = 2;
				}
			}
			else {
				if ((ushort)((ushort)(local_b0.x < 0.0) << 8 | (ushort)(local_b0.x == 0.0) << 0xe) != 0) {
					iVar7 = 3;
				}
			}
			iVar3 = FUN_00408290(lego::globals::g_Game.BuildingData_TABLE + liveObj->objIndex,&local_cc);
			puVar4 = FUN_004643d0(&local_98,iVar3,local_cc,iVar7);
			local_d0 = 0;
			if (local_cc != 0) {
				local_c8 = puVar4 + 2;
				pVVar8 = local_78;
				uVar5 = local_cc;
				do {
					if (((uVar6 == uVar5 - 1) || (*puVar4 != *local_c8)) || (puVar4[1] != local_c8[1])) {
						uVar5 = puVar4[1];
						x = *puVar4;
						pVVar11 = pVVar8;
						out_y = &pVVar8->y;
						pLVar2 = lego::game::GetSurfaceMap();
						FUN_0044f900(pLVar2,x,uVar5,(float *)pVVar11,out_y);
						y = pVVar8->y;
						x_00 = pVVar8->x;
						pLVar2 = lego::game::GetSurfaceMap();
						fVar10 = lego::game::SurfaceMap_UnkGetZ(pLVar2,x_00,y);
						pVVar8->z = (float)fVar10;
						fVar10 = lego::game::LiveObject_GetCollHeight(liveObj);
						local_d0 += 1;
						pVVar8->z = (float)((float10)pVVar8->z - fVar10 * (float10)0.5);
						uVar5 = local_cc;
						pVVar8 = pVVar8 + 1;
					}
					else {
						uVar6 += 1;
						local_c8 = local_c8 + 2;
						puVar4 = puVar4 + 2;
					}
					uVar6 += 1;
					local_c8 = local_c8 + 2;
					puVar4 = puVar4 + 2;
					pvVar9 = local_c4;
				} while (uVar6 < uVar5);
			}
		}
		else {
			local_d0 = 1;
		}
		FUN_00477550((int)pvVar9,&local_a4,&local_c0);
		local_b8 = 0x3f800000;
		FUN_00477550((int)pvVar9,&local_84,&local_c0);
		local_90.x = local_84 - local_a4.x;
		local_80 = local_80 - local_a4.y;
		local_7c = local_7c - local_a4.z;
		uVar6 = 0;
		local_90.z = 1.0 / SQRT(local_7c * local_7c + local_80 * local_80 + local_90.x * local_90.x);
		local_90.x = local_90.z * local_90.x;
		local_90.y = local_90.z * local_80;
		local_90.z = local_90.z * local_7c;
		if (local_d0 != 0) {
			pVVar8 = local_78;
			do {
				pVVar11 = &local_90;
				b = &local_a4;
				fVar10 = lego::game::LiveObject_GetPickSphere(liveObj);
				BVar1 = lego::math::Vector3_CompareUnk1(pVVar8,(float)fVar10,b,pVVar11);
				if (BVar1 != 0) {
					**param_2 = (int)liveObj;
					return 1;
				}
				uVar6 += 1;
				pVVar8 = pVVar8 + 1;
			} while (uVar6 < local_d0);
			return 0;
		}
	}
	return 0;
}



void __cdecl FUN_0043b980(ObjectType param_1,float *param_2,float *param_3)
{
	uint uVar1;
	ObjectType local_14;
	float local_10;
	char *local_c;
	VehicleData *local_8;
	CreatureData *local_4;
	
	uVar1 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
	if ((uVar1 & 8) == 0) {
		local_14 = param_1;
		if (*param_3 <= *param_2) {
			local_10 = *param_3;
		}
		else {
			local_10 = *param_2;
		}
		if ((ushort)((ushort)(param_3[1] < param_2[1]) << 8 | (ushort)(param_3[1] == param_2[1]) << 0xe)
				== 0) {
			local_c = (char *)param_2[1];
		}
		else {
			local_c = (char *)param_3[1];
		}
		if ((ushort)((ushort)(*param_2 < *param_3) << 8 | (ushort)(*param_2 == *param_3) << 0xe) == 0) {
			local_8 = (VehicleData *)*param_2;
		}
		else {
			local_8 = (VehicleData *)*param_3;
		}
		if (param_2[1] <= param_3[1]) {
			local_4 = (CreatureData *)param_3[1];
		}
		else {
			local_4 = (CreatureData *)param_2[1];
		}
		FUN_00437a70(FUN_0043ba30,(LiveObject *)&local_14);
		lego::game::Level_AddMessageAction(MESSAGE_REDUCESELECTION,0,0,NULL);
	}
	return;
}



undefined4 __cdecl FUN_0043ba30(undefined4 *param_1,int *param_2)
{
	ResourceData *resData;
	Vector3F local_1c;
	float local_10;
	float local_c;
	float local_4;
	
	resData = lego::game::LiveObject_GetResource((LiveObject *)param_1);
	lego::res::Res_GetPosition(resData,NULL,&local_1c);
	FUN_00477570(*param_2,&local_10,&local_1c);
	local_10 = local_10 / local_4;
	local_c = local_c / local_4;
	if (((((float)param_2[1] <= local_10) && ((float)param_2[2] <= local_c)) &&
			((ushort)((ushort)(local_10 < (float)param_2[3]) << 8 |
							 (ushort)(local_10 == (float)param_2[3]) << 0xe) != 0)) &&
		 ((ushort)((ushort)(local_c < (float)param_2[4]) << 8 |
							(ushort)(local_c == (float)param_2[4]) << 0xe) != 0)) {
		lego::game::Level_AddMessageAction(MESSAGE_SELECT,param_1,1,NULL);
	}
	return 0;
}



void __cdecl FUN_0043bae0(LiveObject *liveObj,int param_2,int param_3)
{
	if ((liveObj->objType == OBJECT_MINIFIGURE) ||
		 ((liveObj = liveObj->drivenObject, liveObj != NULL && (liveObj->objType == OBJECT_MINIFIGURE)))
		 ) {
		FUN_00406b90(liveObj->miniFigure,param_3,param_2);
	}
	return;
}



void __cdecl
FUN_0043bb10(LiveObject *liveObj,ResourceData *resData,char *param_3,VehicleData *param_4,
						int param_5)
{
	LiveObject *pLVar1;
	LiveObjectInfo liveInfo;
	
	liveInfo.point_8.x = (float)param_3;
	liveInfo.point_8.y = (float)param_4;
	liveInfo.liveObj = liveObj;
	liveInfo.vector_10.x = 0.0;
	liveInfo.intbool_4 = param_5;
	liveInfo.vector_10.y = 0.0;
	liveInfo.vector_10.z = 0.0;
	if (((liveObj->objType != OBJECT_MINIFIGURE) && (pLVar1 = liveObj->drivenObject, pLVar1 != NULL))
		 && (pLVar1->objType == OBJECT_MINIFIGURE)) {
		liveInfo.liveObj = pLVar1;
	}
	if (param_5 != 0) {
		lego::res::Res_GetPosition(resData,NULL,&liveInfo.vector_10);
	}
	FUN_00437a70(FUN_0043bb90,(LiveObject *)&liveInfo);
	return;
}



BOOL __cdecl FUN_0043bb90(LiveObject *liveObj,LiveObjectInfo *liveInfo)
{
	float fVar1;
	int iVar2;
	ObjectType OVar3;
	float fVar4;
	float fVar5;
	ResourceData *resData;
	Vector3F vector;
	
	if (liveObj != liveInfo->liveObj) {
		iVar2 = liveObj->mode_34c;
		if (liveInfo->intbool_4 == 0) {
			if (iVar2 == 1) {
				OVar3 = liveObj->objType;
				if (OVar3 == OBJECT_MINIFIGURE) {
					FUN_00406b30(liveObj->miniFigure,0);
				}
				else {
					if (OVar3 == OBJECT_ROCKMONSTER) {
						FUN_00406b30(liveObj->rockMonster,0);
					}
					else {
						if (OVar3 == OBJECT_VEHICLE) {
							FUN_0046d190(liveObj->vehicle,0);
						}
					}
				}
			}
			else {
				if (iVar2 == 2) {
					OVar3 = liveObj->objType;
					if (OVar3 == OBJECT_MINIFIGURE) {
						FUN_00406b60(liveObj->miniFigure,0);
					}
					else {
						if (OVar3 == OBJECT_ROCKMONSTER) {
							FUN_00406b60(liveObj->rockMonster,0);
						}
						else {
							if (OVar3 == OBJECT_VEHICLE) {
								FUN_0046d1e0(liveObj->vehicle,0);
							}
						}
					}
				}
			}
			liveObj->mode_34c = 0;
		}
		else {
			if (iVar2 == 0) {
				resData = lego::game::LiveObject_GetResource(liveObj);
				lego::res::Res_GetPosition(resData,NULL,&vector);
				fVar5 = (liveInfo->vector_10).x - vector.x;
				fVar1 = (liveInfo->vector_10).y - vector.y;
				fVar4 = (liveInfo->vector_10).z - vector.z;
				fVar4 = SQRT(fVar4 * fVar4 + fVar1 * fVar1 + fVar5 * fVar5);
				fVar1 = (liveInfo->point_8).y;
				if ((ushort)((ushort)(fVar4 < fVar1) << 8 | (ushort)(fVar4 == fVar1) << 0xe) != 0) {
					OVar3 = liveObj->objType;
					if (OVar3 == OBJECT_MINIFIGURE) {
						FUN_00406b60(liveObj->miniFigure,1);
						liveObj->mode_34c = 2;
						return 0;
					}
					if (OVar3 != OBJECT_ROCKMONSTER) {
						if (OVar3 == OBJECT_VEHICLE) {
							FUN_0046d1e0(liveObj->vehicle,1);
						}
						liveObj->mode_34c = 2;
						return 0;
					}
					FUN_00406b60(liveObj->rockMonster,1);
					liveObj->mode_34c = 2;
					return 0;
				}
				fVar1 = (liveInfo->point_8).x;
				if ((ushort)((ushort)(fVar4 < fVar1) << 8 | (ushort)(fVar4 == fVar1) << 0xe) != 0) {
					OVar3 = liveObj->objType;
					if (OVar3 == OBJECT_MINIFIGURE) {
						FUN_00406b30(liveObj->miniFigure,1);
						liveObj->mode_34c = 1;
						return 0;
					}
					if (OVar3 != OBJECT_ROCKMONSTER) {
						if (OVar3 == OBJECT_VEHICLE) {
							FUN_0046d190(liveObj->vehicle,1);
						}
						liveObj->mode_34c = 1;
						return 0;
					}
					FUN_00406b30(liveObj->rockMonster,1);
					liveObj->mode_34c = 1;
					return 0;
				}
			}
		}
	}
	return 0;
}



BOOL __cdecl FUN_0043bdb0(LiveObject *liveObj)
{
	if ((liveObj->flags1_3e0 & 0x107c33de) != LIVEOBJ1_NONE) {
		return 1;
	}
	return (uint)((liveObj->flags2_3e4 & 0x1c00203) != LIVEOBJ2_NONE);
}



void __cdecl FUN_0043bde0(uint *param_1)
{
	ObjectStatsFlags1 OVar1;
	uint uVar2;
	uint uVar3;
	
	if (*param_1 == 4) {
		OVar1 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1);
		if ((OVar1 & STATS1_PROCESSORE) == STATS1_NONE) {
			uVar3 = param_1[0xc9];
		}
		else {
			uVar3 = param_1[0xca];
			uVar2 = lego::game::LiveObject_GetMaxCarry((LiveObject *)param_1);
			if (uVar2 <= uVar3) {
				uVar3 = lego::game::LiveObject_GetMaxCarry((LiveObject *)param_1);
			}
		}
		if (((param_1[0xc9] < uVar3) || ((param_1[0xf8] & 0x2000) != 0)) ||
			 ((param_1[0xfa] & 0x1000000) != 0)) {
			param_1[0xfa] = param_1[0xfa] & 0xfeffffff;
		}
		else {
			OVar1 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1);
			if (((OVar1 & STATS1_PROCESSCRYSTAL) != STATS1_NONE) ||
				 (OVar1 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1),
				 (OVar1 & STATS1_PROCESSORE) != STATS1_NONE)) {
				FUN_0043a5c0((LiveObject *)param_1,NULL);
				return;
			}
		}
	}
	return;
}



void __cdecl FUN_0043be80(int *param_1)
{
	int *piVar1;
	
	if (*param_1 == 3) {
		piVar1 = (int *)param_1[0xc2];
		if ((piVar1 != NULL) && (*piVar1 == 6)) {
			param_1[0xc2] = 0;
			param_1[0xc9] = 0;
			piVar1[0xc1] = 0;
			param_1[0xf8] = param_1[0xf8] & 0xfffffbff;
			piVar1[0xd0] = -0x40800000;
		}
		if ((int *)param_1[0xd2] != NULL) {
			FUN_0041f850(*(int *)param_1[0xd2]);
		}
		param_1[0xd0] = -0x40800000;
		param_1[0xfa] = param_1[0xfa] | 0x800000;
	}
	return;
}



void __cdecl FUN_0043bf00(LiveObject *liveObj)
{
	LiveFlags1 *pLVar1;
	LiveObject *pLVar2;
	LiveFlags3 LVar3;
	ObjectType OVar4;
	char *activityName;
	ObjectStatsFlags1 OVar5;
	ObjectStatsFlags2 OVar6;
	ResourceData *pRVar7;
	ObjectStatsFlags3 OVar8;
	int iVar9;
	float10 fVar10;
	InfoType infoType;
	float x;
	float y;
	float z;
	int local_10;
	int local_c;
	Point2I local_8;
	
	if (liveObj->objType != OBJECT_BUILDING) {
		if ((liveObj->flags2_3e4 & 0x8000000) != LIVEOBJ2_NONE) {
			return;
		}
		if ((liveObj->flags1_3e0 & 0x200000) != LIVEOBJ1_NONE) {
			return;
		}
	}
	if ((ushort)((ushort)(liveObj->health < 0.0) << 8 | (ushort)(liveObj->health == 0.0) << 0xe) == 0)
	{
		return;
	}
	OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if ((((OVar5 & (STATS1_SMALLTELEPORTER|STATS1_BIGTELEPORTER|STATS1_WATERTELEPORTER|
								 STATS1_MANTELEPORTER)) != STATS1_NONE) &&
			(pLVar2 = liveObj->object_3cc, pLVar2 != NULL)) &&
		 ((pLVar2->flags1_3e0 & 0x200000) != LIVEOBJ1_NONE)) {
		pLVar2->health = -1.0;
		pLVar1 = &liveObj->object_3cc->flags1_3e0;
		*pLVar1 = *pLVar1 & 0xffdfffff;
		FUN_00438720(liveObj);
		lego::game::LiveObject_SetActivityUnk(liveObj->object_3cc,ACTIVITY_STAND,1);
		lego::game::Game_UpdateSomeAITasks(liveObj->object_3cc);
	}
	LVar3 = liveObj->flags3_3e8;
	if ((LVar3 & 0x800000) != LIVEOBJ3_NONE) {
		if (liveObj->drivenObject != NULL) {
			FUN_0041ce50(liveObj);
			liveObj->drivenObject->flags2_3e4 = liveObj->drivenObject->flags2_3e4 & ~LIVEOBJ2_DRIVING;
			liveObj->drivenObject->drivenObject = NULL;
			liveObj->drivenObject = NULL;
		}
		if ((liveObj->objType == OBJECT_MINIFIGURE) && ((*(byte *)&liveObj->flags4_3ec & 8) != 0)) {
			lego::game::LiveObject_UnkRecallMiniFigureName(liveObj);
		}
		if (liveObj->objType == OBJECT_VEHICLE) {
			lego::game::LiveObject_VehicleChangeUpgradeParts(liveObj->vehicle,0);
		}
		FUN_0044b0a0(liveObj);
		if (liveObj->objType == OBJECT_BOULDER) {
			lego::game::LiveObject_ReleaseBoulderUnk(liveObj);
			return;
		}
		if (liveObj->objType == OBJECT_BUILDING) {
			FUN_00409f20(liveObj);
			return;
		}
		lego::pool::ReservedPool_LiveObject___Release(liveObj);
		return;
	}
	OVar4 = liveObj->objType;
	if (OVar4 == OBJECT_ROCKMONSTER) {
		OVar6 = lego::game::LiveObject_GetStatsFlags2(liveObj);
		if ((OVar6 & STATS2_SPLITONZEROHEALTH) == STATS2_NONE) {
			OVar6 = lego::game::LiveObject_GetStatsFlags2(liveObj);
			if ((OVar6 & STATS2_USEHOLES) == STATS2_NONE) {
				return;
			}
			FUN_00441df0(liveObj,0,1);
			liveObj->flags1_3e0 = liveObj->flags1_3e0 | 0x20000;
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_ENTER,0);
			lego::game::Game_UpdateSomeAITasks(liveObj);
			return;
		}
		if ((liveObj->flags1_3e0 & 0x100000) != LIVEOBJ1_NONE) {
			return;
		}
		FUN_004424d0(liveObj);
		return;
	}
	if (((OVar4 != OBJECT_MINIFIGURE) && (OVar4 != OBJECT_VEHICLE)) && (OVar4 != OBJECT_ELECTRICFENCE)
		 ) {
		if (OVar4 != OBJECT_BUILDING) {
LAB_0043c168:
			if (OVar4 != OBJECT_POWERCRYSTAL) {
				return;
			}
			liveObj->flags3_3e8 = LVar3 | 0x800000;
			return;
		}
		if (((*(byte *)&liveObj->field_390 & 4) == 0) && ((*(byte *)&liveObj->flags4_3ec & 8) == 0)) {
			if (false) goto LAB_0043c168;
			if ((liveObj->flags2_3e4 & 0x100000) != LIVEOBJ2_NONE) {
				return;
			}
			liveObj->flags2_3e4 = liveObj->flags2_3e4 | 0x100000;
			FUN_00409c80(liveObj);
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_EXPLODE,0);
			lego::game::Game_UpdateSomeAITasks(liveObj);
			FUN_00403490(liveObj);
			goto LAB_0043c4a7;
		}
	}
	if ((LVar3 & 0x40000) == LIVEOBJ3_NONE) {
		return;
	}
	if ((liveObj->flags1_3e0 & 0x400000) != LIVEOBJ1_NONE) {
		return;
	}
	activityName = liveObj->aitaskName1;
	pRVar7 = lego::game::LiveObject_GetResource(liveObj);
	if ((*(byte *)&liveObj->flags4_3ec & 8) != 0) {
		FUN_0044b0a0(liveObj);
	}
	if (liveObj->objType == OBJECT_BUILDING) {
		FUN_00409c80(liveObj);
	}
	if ((*(byte *)&liveObj->flags4_3ec & 0x80) != 0) {
		pLVar2 = liveObj->object_2fc;
		if (pLVar2 != NULL) {
			pLVar2->flags4_3ec = pLVar2->flags4_3ec & 0xffffff7f;
		}
		liveObj->object_2fc = NULL;
	}
	if (liveObj->drivenObject != NULL) {
		lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_10,&local_c);
		OVar8 = lego::game::LiveObject_GetStatsFlags3(liveObj);
		if (((((OVar8 & STATS3_CARRYVEHICLES) != STATS3_NONE) &&
				 ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE)) &&
				(liveObj->carriedObjects[0] != NULL)) &&
			 (iVar9 = FUN_00431cd0(liveObj->carriedObjects[0],local_10,local_c,local_10,local_c,1),
			 iVar9 == 0)) {
			liveObj->carriedObjects[0]->health = -1.0;
		}
		OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		if (((OVar5 & STATS1_CANBEDRIVEN) == STATS1_NONE) ||
			 (iVar9 = FUN_00431cd0(liveObj->drivenObject,local_10,local_c,local_10,local_c,1), iVar9 != 0)
			 ) {
			FUN_0041ce50(liveObj);
			liveObj->drivenObject->flags2_3e4 = liveObj->drivenObject->flags2_3e4 & ~LIVEOBJ2_DRIVING;
			if (liveObj->drivenObject->objType == OBJECT_MINIFIGURE) {
				FUN_00406d70(liveObj->drivenObject->miniFigure,lego::globals::g_Activities_TABLE[0],0.0);
			}
			liveObj->drivenObject->drivenObject = NULL;
			liveObj->drivenObject = NULL;
		}
		else {
			liveObj->drivenObject->health = -1.0;
		}
	}
	if (liveObj->objType == OBJECT_ELECTRICFENCE) {
		FUN_0040cfd0(liveObj);
	}
	lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_8,&local_8.y);
	OVar4 = liveObj->objType;
	if (((OVar4 == OBJECT_MINIFIGURE) || (OVar4 == OBJECT_VEHICLE)) || (OVar4 == OBJECT_BUILDING)) {
		lego::game::Info_FUN_00419ab0(INFO_GENERICDEATH,NULL,NULL,&local_8);
	}
	OVar4 = liveObj->objType;
	if (OVar4 == OBJECT_MINIFIGURE) {
		infoType = INFO_LEGOMANDEATH;
LAB_0043c382:
		lego::game::Info_FUN_00419ab0(infoType,NULL,NULL,&local_8);
	}
	else {
		if (OVar4 == OBJECT_VEHICLE) {
			infoType = INFO_VEHICLEDEATH;
			goto LAB_0043c382;
		}
		if (OVar4 == OBJECT_BUILDING) {
			infoType = INFO_BUILDINGDEATH;
			goto LAB_0043c382;
		}
	}
	if ((*(byte *)&liveObj->flags2_3e4 & 2) == 0) {
		FUN_00441df0(liveObj,0,1);
		lego::res::Res_ResourceShortNormal_FUN_00473630(pRVar7,activityName);
		liveObj->aitaskName2 = liveObj->aitaskName1;
	}
	else {
		FUN_00441df0(liveObj,1,1);
	}
	liveObj->flags1_3e0 = liveObj->flags1_3e0 | 0x400000;
	pRVar7 = lego::res::Res_DuplicateResource(lego::globals::g_Game.RES_MiniTeleportUp);
	liveObj->resData_2e4 = pRVar7;
	lego::res::Res_DoCallbacks(pRVar7,0.0);
	lego::res::Res_UnkSetup3DFrameTransform(liveObj->resData_2e4,0);
	z = 0.0;
	y = 0.0;
	x = 0.0;
	pRVar7 = lego::game::LiveObject_GetResource(liveObj);
	lego::res::Res_SetFramePosition(liveObj->resData_2e4,pRVar7,x,y,z);
	lego::res::Res_SetFrameOrientation(liveObj->resData_2e4,NULL,0.0,1.0,0.0,0.0,0.0,-1.0);
	if (liveObj->objType == OBJECT_BUILDING) {
		fVar10 = lego::game::LiveObject_GetCollRadius(liveObj);
		if ((ushort)((ushort)(fVar10 < (float10)0.0) << 8 | (ushort)(fVar10 == (float10)0.0) << 0xe) !=
				0) {
			fVar10 = (float10)4.0;
		}
		if ((ushort)((ushort)(fVar10 < (float10)0.0) << 8 | (ushort)(fVar10 == (float10)0.0) << 0xe) ==
				0) {
			lego::res::Res_AddScale
								(liveObj->resData_2e4,D3DRMCOMBINE_BEFORE,(float)(fVar10 * (float10)0.25),1.0,
								 (float)(fVar10 * (float10)0.25));
		}
	}
LAB_0043c4a7:
	FUN_00452f10(liveObj);
	FUN_00452770(liveObj);
	return;
}



BOOL __cdecl FUN_0043c4c0(ObjectType objType1,int objIndex1,ObjectType objType2,int objIndex2)
{
	int objIndex;
	float10 fVar1;
	float10 fVar2;
	
	objIndex = objIndex1;
	fVar1 = lego::game::ObjectStats_GetOxygenCoef(objType1,objIndex1);
	if (fVar1 != (float10)0.0) {
		objIndex1 = OBJECT_NONE;
		FUN_00437a70(FUN_0043c540,(LiveObject *)&objIndex1);
		fVar1 = lego::game::ObjectStats_GetOxygenCoef(objType2,objIndex2);
		fVar2 = lego::game::ObjectStats_GetOxygenCoef(objType1,objIndex);
		fVar1 = fVar2 + (float10)(float)fVar1 + (float10)(float)objIndex1;
		if ((ushort)((ushort)(fVar1 < (float10)0.0) << 8 | (ushort)(fVar1 == (float10)0.0) << 0xe) != 0)
		{
			return 0;
		}
	}
	return 1;
}



undefined4 __cdecl FUN_0043c540(LiveObject *liveObj,float *param_2)
{
	BOOL BVar1;
	float10 fVar2;
	
	if ((liveObj->objType == OBJECT_BUILDING) && (BVar1 = FUN_00438870(liveObj,0), BVar1 == 0)) {
		return 0;
	}
	fVar2 = lego::game::LiveObject_GetOxygenCoef(liveObj);
	*param_2 = (float)(fVar2 + (float10)*param_2);
	return 0;
}



void __cdecl FUN_0043c570(float param_1,ObjectType param_2)
{
	FLOAT_004dfe0c = param_1 + FLOAT_004dfe0c;
	if ((ushort)((ushort)(FLOAT_004dfe0c < 25.0) << 8 | (ushort)(FLOAT_004dfe0c == 25.0) << 0xe) == 0)
	{
		FLOAT_004dfe0c = 0.0;
	}
	FUN_00437a70(FUN_0043c5b0,(LiveObject *)&param_2);
	return;
}



undefined4 __cdecl FUN_0043c5b0(LiveObject *liveObj,int *param_2)
{
	int iVar1;
	BOOL BVar2;
	LevelSurfaceMap *surfMap;
	float10 fVar3;
	float *pfVar4;
	float fVar5;
	float fVar6;
	int local_10;
	int local_c;
	float local_8;
	float local_4;
	
	fVar5 = FLOAT_004dfe0c * 0.04;
	if (((*(byte *)&liveObj->flags5_3f0 & 0x20) != 0) &&
		 (iVar1 = lego::game::LiveObject_GetSurveyRadius(liveObj), iVar1 != 0)) {
		local_10 = iVar1;
		if ((liveObj->objType == OBJECT_BUILDING) && (BVar2 = FUN_00438870(liveObj,0), BVar2 == 0)) {
			return 0;
		}
		if (FLOAT_004dfe0c == 0.0) {
			lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_10,&local_c);
			FUN_00434f40(&local_10,iVar1);
			return 0;
		}
		if (*param_2 != 0) {
			lego::game::LiveObject_GetPosition(liveObj,&local_8,&local_4);
			fVar6 = 1.0 - fVar5;
			surfMap = lego::game::GetSurfaceMap();
			fVar3 = lego::game::SurfaceMap_GetFloat10(surfMap);
			pfVar4 = &local_8;
			fVar5 = (float)(fVar3 * (float10)fVar5 * (float10)local_10);
			iVar1 = FUN_0042b430();
			FUN_0045ddc0(iVar1,pfVar4,fVar5,fVar6);
		}
	}
	return 0;
}



undefined4 __cdecl FUN_0043c6a0(int *param_1)
{
	int *piVar1;
	int iVar2;
	
	if ((((param_1 != NULL) && (*param_1 == 2)) && (piVar1 = (int *)param_1[0xbc], piVar1 != NULL)) &&
		 (*piVar1 == 0x1a)) {
		iVar2 = FUN_00472340(param_1,(undefined4 *)piVar1[4]);
		if (iVar2 != 0) {
			iVar2 = FUN_00471b90(param_1,*(undefined4 **)(param_1[0xbc] + 0x10));
			if (iVar2 == 0) {
				return 1;
			}
		}
	}
	return 0;
}



uint __cdecl lego::game::LiveObject_GetEquippedBeam(LiveObject *liveObj)
{
	BOOL BVar1;
	
	BVar1 = LiveObject_HasToolEquipped(liveObj,TOOL_LASERBEAM);
	if (BVar1 != 0) {
		return 1;
	}
	BVar1 = LiveObject_HasToolEquipped(liveObj,TOOL_PUSHERBEAM);
	if (BVar1 != 0) {
		return 2;
	}
	BVar1 = LiveObject_HasToolEquipped(liveObj,TOOL_FREEZERBEAM);
	return -(uint)(BVar1 != 0) & 3;
}



undefined4 __cdecl FUN_0043c750(undefined4 param_1,int param_2,int param_3)
{
	BOOL BVar1;
	
	BVar1 = FUN_00438870((LiveObject *)param_2,1);
	if ((BVar1 != 0) && (param_3 != 0)) {
		return 1;
	}
	return 0;
}



void __cdecl FUN_0043c780(uint *param_1)
{
	uint uVar1;
	int iVar2;
	
	if (param_1[0xbf] != 0) {
		uVar1 = lego::game::LiveObject_GetEquippedBeam((LiveObject *)param_1);
		iVar2 = FUN_0043c750(param_1,param_1[0xbf],uVar1);
		if (iVar2 != 0) {
			FUN_00442190((LiveObject *)param_1,(int *)param_1[0xbf],uVar1);
		}
	}
	param_1[0xf9] = param_1[0xf9] & 0xfbffffff;
	FUN_00403c40((LiveObject *)param_1,0x1a,NULL,1);
	return;
}



void __cdecl FUN_0043c7f0(uint *param_1)
{
	if ((((param_1 != NULL) && (*param_1 == 2)) && ((int *)param_1[0xbc] != NULL)) &&
		 (*(int *)param_1[0xbc] == 0x1a)) {
		param_1[0xf9] = param_1[0xf9] | 0x4000000;
		FUN_0043c780(param_1);
	}
	return;
}



void __cdecl FUN_0043c830(LiveObject *liveObj)
{
	int iVar1;
	ObjectStatsFlags2 OVar2;
	BOOL BVar3;
	int local_8;
	int local_4;
	
	if ((liveObj->objType == OBJECT_BUILDING) && ((liveObj->flags3_3e8 & 0x80000000) == LIVEOBJ3_NONE)
		 ) {
		iVar1 = lego::game::LiveObject_GetCrystalDrain(liveObj);
		lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_8,&local_4);
		OVar2 = lego::game::LiveObject_GetStatsFlags2(liveObj);
		if ((OVar2 & STATS2_GENERATEPOWER) == STATS2_NONE) {
			OVar2 = lego::game::LiveObject_GetStatsFlags2(liveObj);
			if ((OVar2 & STATS2_SELFPOWERED) == STATS2_NONE) {
				iVar1 = FUN_00409380(&local_8,iVar1);
				if (iVar1 == 0) {
					liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xdfffffff;
					FUN_00407340(liveObj);
					return;
				}
			}
		}
		liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x20000000;
		OVar2 = lego::game::LiveObject_GetStatsFlags2(liveObj);
		if ((OVar2 & STATS2_GENERATEPOWER) != STATS2_NONE) {
			BVar3 = FUN_00438870(liveObj,0);
			if (BVar3 != 0) {
				iVar1 = lego::game::Level_GetCrystalCount(1);
				if (iVar1 != 0) {
					FUN_004092e0(&local_8);
				}
			}
		}
	}
	return;
}



BOOL __cdecl FUN_0043c910(LiveObject *liveObj)
{
	ObjectStatsFlags1 OVar1;
	int iVar2;
	uint uVar3;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if ((OVar1 & STATS1_CANSTEAL) != STATS1_NONE) {
		iVar2 = lego::game::LiveObject_GetCapacity(liveObj);
		if (((iVar2 != 0) && (liveObj->tableptr_348 != NULL)) &&
			 (uVar3 = lego::game::LiveObject_GetCapacity(liveObj), uVar3 <= (uint)*liveObj->tableptr_348))
		{
			return 0;
		}
		if ((liveObj->flags3_3e8 & 0x80000000) == LIVEOBJ3_NONE) {
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_0043c970(int *param_1,float param_2)
{
	float fVar1;
	float fVar2;
	float fVar3;
	int iVar4;
	float10 fVar5;
	float10 fVar6;
	
	fVar1 = (float)param_1[0xf6];
	fVar2 = (float)param_1[0xf6];
	fVar3 = (float)param_1[0xf5];
	param_1[0xf6] = (int)(param_2 + fVar1);
	iVar4 = *param_1;
	param_1[0xf5] = (int)(param_2 + (float)param_1[0xf5]);
	param_1[0xf7] = (int)(param_2 + (float)param_1[0xf7]);
	if (iVar4 == 2) {
		fVar5 = lego::game::Level_GetObjectUpgradeTime(OBJECT_MINIFIGURE);
		if (fVar5 != (float10)0.0) {
			fVar5 = lego::game::Level_GetObjectUpgradeTime(*param_1);
			if ((ushort)((ushort)(fVar5 < (float10)(float)param_1[0xf6]) << 8 |
									(ushort)(fVar5 == (float10)(float)param_1[0xf6]) << 0xe) != 0) {
				fVar6 = lego::game::Level_GetObjectUpgradeTime(*param_1);
				fVar5 = (float10)fVar2;
				if ((ushort)((ushort)(fVar6 < fVar5) << 8 | (ushort)(fVar6 == fVar5) << 0xe) == 0) {
					lego::game::Info_FUN_00419ab0(INFO_CANUPGRADEMINIFIGURE,NULL,(LiveObject *)param_1,NULL);
				}
			}
		}
		fVar5 = lego::game::Level_GetTrainTime();
		if (fVar5 != (float10)0.0) {
			fVar5 = lego::game::Level_GetTrainTime();
			if ((ushort)((ushort)(fVar5 < (float10)(float)param_1[0xf5]) << 8 |
									(ushort)(fVar5 == (float10)(float)param_1[0xf5]) << 0xe) != 0) {
				fVar5 = lego::game::Level_GetTrainTime();
				if ((ushort)((ushort)(fVar5 < (float10)fVar3) << 8 |
										(ushort)(fVar5 == (float10)fVar3) << 0xe) == 0) {
					lego::game::Info_FUN_00419ab0(INFO_CANTRAINMINIFIGURE,NULL,(LiveObject *)param_1,NULL);
					return;
				}
			}
		}
	}
	else {
		if (((((iVar4 == 6) || (iVar4 == 7)) || (iVar4 == 9)) ||
				((iVar4 == 0xb && ((param_1[0xf9] & 0x2000000U) == 0)))) &&
			 ((750.0 <= param_2 + fVar1 && (fVar2 < 750.0)))) {
			param_1[0xf6] = 0;
			FUN_004025f0((LiveObject *)param_1);
		}
	}
	return;
}



BOOL __cdecl FUN_0043cad0(LiveObject *param_1,float *param_2)
{
	LiveFlags3 *pLVar1;
	LiveFlags4 *pLVar2;
	float elapsed;
	void *pvVar3;
	LiveFlags2 LVar4;
	ObjectType OVar5;
	ushort uVar6;
	ushort uVar7;
	bool bVar8;
	LiveObject *liveObj;
	short sVar9;
	ResourceData *pRVar10;
	int iVar11;
	LiveFlags4 LVar12;
	LevelData *pLVar13;
	ObjectStatsFlags1 OVar14;
	BOOL BVar15;
	LiveFlags3 LVar16;
	SurfaceType SVar17;
	uint *puVar18;
	int *piVar19;
	LevelSurfaceMap *pLVar20;
	ObjectStatsFlags2 OVar21;
	uint uVar22;
	LiveFlags1 LVar23;
	uint uVar24;
	float10 fVar25;
	longlong lVar26;
	float fVar27;
	ResourceData *pRVar28;
	float fVar29;
	LiveObject *pLVar30;
	BOOL BVar31;
	float uy;
	ActivityType AVar32;
	Vector3F *pVVar33;
	undefined4 uVar34;
	float fVar35;
	float uz;
	float *out_y;
	float local_34;
	Vector3F local_30;
	float local_24;
	Vector3F local_20;
	int local_14;
	float local_10;
	Vector3F local_c;
	
	liveObj = param_1;
	elapsed = *param_2;
	bVar8 = true;
	DAT_00557090 = param_1;
	FUN_0043c970((int *)param_1,elapsed);
	if ((liveObj->flags4_3ec & 0x200000) != 0) {
		liveObj->aitaskName1 = NULL;
		lego::game::Game_UpdateSomeAITasks(liveObj);
		liveObj->flags4_3ec = liveObj->flags4_3ec & 0xffdfffff;
	}
	if ((liveObj->flags2_3e4 & 0x8000000) != LIVEOBJ2_NONE) {
		if ((ushort)((ushort)((float)liveObj->field_368 < 0.0) << 8 |
								(ushort)((float)liveObj->field_368 == 0.0) << 0xe) != 0) {
			FUN_0044c3d0((int)liveObj);
		}
		liveObj->field_368 = (float)liveObj->field_368 - elapsed;
		return 0;
	}
	if ((liveObj->flags4_3ec & 0x40000) != 0) {
		pRVar10 = lego::game::LiveObject_GetResource(liveObj);
		if ((pRVar10 != NULL) && (iVar11 = lego::game::LiveObject_GetEngineSound(liveObj), iVar11 != 0))
		{
			lego::res::Res_PlayResourceSound(pRVar10,iVar11,1,1,NULL);
			liveObj->field_354 = iVar11;
			liveObj->flags4_3ec = liveObj->flags4_3ec | 0x80000;
		}
		liveObj->flags4_3ec = liveObj->flags4_3ec & 0xfffbffff;
	}
	if ((((byte)lego::globals::g_Game.flags2 & 1) == 0) ||
		 (iVar11 = FUN_0044c7f0((int *)liveObj), iVar11 == 0)) {
		FUN_00407440((int *)liveObj,0);
		LVar12 = liveObj->flags4_3ec & 0xffffffdf;
	}
	else {
		FUN_004073e0((int *)liveObj);
		LVar12 = liveObj->flags4_3ec | 0x20;
	}
	liveObj->flags4_3ec = LVar12;
	if ((((liveObj->objType == OBJECT_VEHICLE) && ((liveObj->flags4_3ec & 0x40) != 0)) &&
			(liveObj->object_2fc == NULL)) && (liveObj->drivenObject == NULL)) {
		liveObj->flags4_3ec = liveObj->flags4_3ec & 0xffffffbf;
		FUN_0043ac20(liveObj);
	}
	if ((liveObj->objType == OBJECT_MINIFIGURE) || (liveObj->objType == OBJECT_VEHICLE)) {
		pLVar13 = lego::game::GetLevel();
		lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_20,(int *)&local_20.y);
		if ((*(byte *)&pLVar13->blocks[(pLVar13->dimensions).width * (int)local_20.y + (int)local_20.x].
									 flags2 & 0x80) != 0) {
			FUN_0042c260((int)pLVar13,(int *)&local_20,NULL);
		}
	}
	FUN_0043bde0((uint *)liveObj);
	if (((liveObj->objType == OBJECT_MINIFIGURE) && ((*(byte *)&liveObj->flags2_3e4 & 8) != 0)) &&
		 ((pLVar30 = liveObj->drivenObject, pLVar30 != NULL && (pLVar30->objType == OBJECT_VEHICLE)))) {
		fVar25 = lego::res::Vehicle_GetAnimFloat10(pLVar30->vehicle);
		lego::res::Creature_DoCallbacks(liveObj->miniFigure,(float)fVar25);
	}
	else {
		fVar25 = FUN_00447df0(liveObj,elapsed);
		local_10 = (float)fVar25;
	}
	OVar14 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if ((OVar14 & (STATS1_SMALLTELEPORTER|STATS1_BIGTELEPORTER|STATS1_WATERTELEPORTER|
								STATS1_MANTELEPORTER)) != STATS1_NONE) {
		FUN_0043f450(liveObj);
	}
	if ((liveObj->objType != OBJECT_BUILDING) || (BVar15 = FUN_00438870(liveObj,0), BVar15 != 0)) {
		lego::game::Game_ConsumeOxygen(liveObj,elapsed);
	}
	if (((byte)lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS & 4) == 0) {
		liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xbfffffff;
	}
	else {
		FUN_0043c830(liveObj);
	}
	LVar23 = liveObj->flags1_3e0;
	if ((LVar23 & 0x400000) != LIVEOBJ1_NONE) {
		if (liveObj->resData_2e4 == NULL) {
			liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x800000;
			return 0;
		}
		pRVar10 = lego::game::LiveObject_GetResource(liveObj);
		lego::res::Res_AddTranslation(pRVar10,D3DRMCOMBINE_AFTER,0.0,0.0,-elapsed);
		fVar25 = lego::res::Res_DoAnimElapsedCallbacks(liveObj->resData_2e4,elapsed);
		if ((ushort)((ushort)(fVar25 < (float10)0.0) << 8 | (ushort)(fVar25 == (float10)0.0) << 0xe) !=
				0) {
			return 0;
		}
		liveObj->health = -1.0;
		liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x800000;
		liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xffbfffff;
		lego::pool::ReservedPool_ResourceData___Release(liveObj->resData_2e4);
		return 0;
	}
	if ((LVar23 & 8) == LIVEOBJ1_NONE) goto LAB_0043d12f;
	if ((LVar23 & 0x10) != LIVEOBJ1_NONE) {
		pRVar10 = lego::game::LiveObject_GetResource(liveObj);
		pVVar33 = NULL;
		BVar31 = 1;
		BVar15 = 1;
		iVar11 = lego::game::LiveObject_GetDrillSoundType(liveObj,0);
		lego::res::Res_PlayResourceSound(pRVar10,iVar11,BVar15,BVar31,pVVar33);
		liveObj->field_350 = iVar11;
		liveObj->flags4_3ec = liveObj->flags4_3ec | 0x100000;
		liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xffffffef;
	}
	pvVar3 = liveObj->routeptr_24;
	if (pvVar3 == NULL) {
LAB_0043d0aa:
		liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xfffffff7;
		liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xfdffffff;
		pRVar10 = lego::game::LiveObject_GetResource(liveObj);
		iVar11 = liveObj->field_350;
LAB_0043d0dd:
		lego::snd::Sample_StopSoundBufferInstance(iVar11);
		pVVar33 = NULL;
		BVar31 = 1;
		BVar15 = 0;
		liveObj->flags4_3ec = liveObj->flags4_3ec & 0xffefffff;
		iVar11 = lego::game::LiveObject_GetDrillSoundType(liveObj,1);
		lego::res::Res_PlayResourceSound(pRVar10,iVar11,BVar15,BVar31,pVVar33);
		lego::other::logf_removed(NULL,0,0);
		LVar16 = liveObj->flags3_3e8 & 0xffffbfff;
LAB_0043d129:
		liveObj->flags3_3e8 = LVar16;
	}
	else {
		fVar35 = *(float *)((int)pvVar3 + liveObj->routingBlocksCurrent * 0x14);
		fVar27 = *(float *)((int)pvVar3 + liveObj->routingBlocksCurrent * 0x14 + 4);
		BVar15 = 1;
		LVar16 = liveObj->flags3_3e8 & 0x2000000;
		lVar26 = __ftol((float10)(liveObj->point_2f4).y);
		uVar22 = (uint)lVar26;
		lVar26 = __ftol((float10)(liveObj->point_2f4).x);
		BVar15 = FUN_004326a0(liveObj,(uint)lVar26,uVar22,LVar16,BVar15);
		if (BVar15 == 0) goto LAB_0043d0aa;
		BVar15 = lego::game::LiveObject_GetDrillNullPosition(liveObj,(float *)&local_30,&local_34);
		if (BVar15 == 0) goto LAB_0043d12f;
		if (liveObj->objType == OBJECT_MINIFIGURE) {
			uVar34 = 0;
			iVar11 = FUN_00422fb0();
			pRVar10 = lego::res::Creature_GetDrillNull(liveObj->miniFigure);
			lego::other::logf_removed((char *)pRVar10,iVar11,uVar34);
		}
		lVar26 = __ftol((float10)(liveObj->point_2f4).y);
		iVar11 = (int)lVar26;
		lVar26 = __ftol((float10)(liveObj->point_2f4).x);
		SVar17 = FUN_004318e0((int)lVar26,iVar11);
		fVar25 = lego::game::LiveObject_GetDrillTimeType(liveObj,SVar17);
		param_1 = (LiveObject *)(float)fVar25;
		OVar14 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		if (((OVar14 & STATS1_SINGLEWIDTHDIG) != STATS1_NONE) &&
			 ((liveObj->flags3_3e8 & 0x2000000) != LIVEOBJ3_NONE)) {
			param_1 = (LiveObject *)((float)param_1 * 0.5);
		}
		pLVar30 = param_1;
		fVar29 = elapsed;
		lVar26 = __ftol((float10)(liveObj->point_2f4).y);
		iVar11 = (int)lVar26;
		lVar26 = __ftol((float10)(liveObj->point_2f4).x);
		BVar15 = lego::game::Level_GetBlockUnkField14Test((int)lVar26,iVar11,(float)pLVar30,fVar29);
		if (BVar15 == 0) {
			iVar11 = FUN_00433b10(local_30.x,local_34,(int *)&local_24,(int *)&local_20);
			if (((iVar11 == 0) || (local_24 != fVar35)) || (local_20.x != fVar27)) goto LAB_0043d12f;
			LVar16 = liveObj->flags3_3e8 | 0x4000;
			goto LAB_0043d129;
		}
		BVar15 = 1;
		LVar16 = liveObj->flags3_3e8 & 0x2000000;
		lVar26 = __ftol((float10)(liveObj->point_2f4).y);
		uVar22 = (uint)lVar26;
		lVar26 = __ftol((float10)(liveObj->point_2f4).x);
		BVar15 = FUN_004326a0(liveObj,(uint)lVar26,uVar22,LVar16,BVar15);
		if (BVar15 != 0) {
			lVar26 = __ftol((float10)(liveObj->point_2f4).x);
			puVar18 = (uint *)lVar26;
			local_c.x = (float)puVar18;
			lVar26 = __ftol((float10)(liveObj->point_2f4).y);
			piVar19 = (int *)lVar26;
			local_c.y = (float)piVar19;
			if ((liveObj->flags3_3e8 & 0x2000000) == LIVEOBJ3_NONE) {
				iVar11 = 0;
				pLVar13 = lego::game::GetLevel();
				iVar11 = FUN_00430460(pLVar13,(int)fVar35,(int)fVar27,iVar11);
			}
			else {
				pLVar13 = lego::game::GetLevel();
				iVar11 = FUN_00430e10((int)pLVar13,puVar18,piVar19);
			}
			if (iVar11 == 0) goto LAB_0043d12f;
			FUN_00403c40(liveObj,8,NULL,1);
			liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xfffffff7;
			lego::game::Level_SetBlockFlags1_8000000((Point2I *)&local_c,0);
			if (*(char *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -3) == '\x01')
			{
				*(undefined *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -3) = 0;
			}
			pRVar10 = lego::game::LiveObject_GetResource(liveObj);
			iVar11 = liveObj->field_350;
			goto LAB_0043d0dd;
		}
	}
LAB_0043d12f:
	if ((liveObj->flags2_3e4 & 0x4000) != LIVEOBJ2_NONE) {
		FUN_0044c470((int *)liveObj,elapsed);
	}
	if ((((liveObj->flags2_3e4 & 0x40000000) != LIVEOBJ2_NONE) &&
			((ushort)((ushort)(elapsed < 0.0) << 8 | (ushort)(elapsed == 0.0) << 0xe) == 0)) &&
		 (pRVar10 = lego::game::LiveObject_GetResource(liveObj), pRVar10 != NULL)) {
		lego::res::Res_GetOrientation(pRVar10,NULL,&local_20,&local_c);
		local_c.x = local_c.x * 10.0;
		local_c.y = local_c.y * 10.0;
		local_c.z = local_c.z * 10.0;
		lego::math::Vector3_Random(&local_30);
		local_c.y = FLOAT_004a58b0 * 0.1 * (local_30.y + local_c.y);
		local_c.x = FLOAT_004a58b0 * 0.1 * (local_30.x + local_c.x);
		local_c.z = -1.0;
		lego::res::Res_SetFrameOrientation
							(pRVar10,NULL,local_20.x,local_20.y,local_20.z,local_c.x,local_c.y,-1.0);
		FLOAT_004a58b0 = FLOAT_004a58b0 - elapsed * 0.16;
		if (FLOAT_004a58b0 < 0.0) {
			FLOAT_004a58b0 = 1.0;
			liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xbfffffff;
		}
	}
	LVar23 = liveObj->flags1_3e0;
	if ((LVar23 & 0x100000) != LIVEOBJ1_NONE) {
		FUN_0044c290((uint *)liveObj);
		goto LAB_0043f040;
	}
	if ((LVar23 & 0x4000000) != LIVEOBJ1_NONE) {
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			liveObj->flags1_3e0 = LVar23 & 0xfbffffff;
		}
		goto LAB_0043f040;
	}
	LVar12 = liveObj->flags4_3ec;
	if ((LVar12 & 0x1000) != 0) {
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			liveObj->flags4_3ec = LVar12 & 0xffffefff | 0x2000;
		}
		goto LAB_0043f040;
	}
	if ((LVar12 & 0x4000) != 0) {
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			liveObj->flags4_3ec = LVar12 & 0xffffbfff;
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
		}
		goto LAB_0043f040;
	}
	if ((LVar12 & 0x2000) != 0) {
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_OPEN,0);
		goto LAB_0043f040;
	}
	LVar4 = liveObj->flags2_3e4;
	if ((LVar4 & 0x4000) != LIVEOBJ2_NONE) goto LAB_0043f040;
	if ((LVar23 & LIVEOBJ1_TURNING) != LIVEOBJ1_NONE) {
		uVar6 = (ushort)(liveObj->float_2d4 < 0.0) << 8;
		uVar7 = (ushort)(liveObj->float_2d4 == 0.0) << 0xe;
		if ((LVar23 & LIVEOBJ1_TURNRIGHT) != LIVEOBJ1_NONE) {
			if ((uVar6 | uVar7) == 0) {
				pRVar10 = lego::game::LiveObject_GetResource(liveObj);
				lego::res::Res_AddRotation(pRVar10,D3DRMCOMBINE_BEFORE,0.0,1.0,0.0,1.570796);
				lego::res::Res_DoCallbacks(pRVar10,0.0);
				liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_TURNRIGHT;
			}
			goto LAB_0043f040;
		}
		if ((uVar6 | uVar7) != 0) goto LAB_0043f040;
		pRVar10 = lego::game::LiveObject_GetResource(liveObj);
		if ((lego::globals::g_Activities_TABLE[9] == liveObj->aitaskName1) ||
			 (lego::globals::g_Activities_TABLE[20] == liveObj->aitaskName1)) {
			fVar35 = -1.570796;
		}
		else {
			fVar35 = 1.570796;
		}
		lego::res::Res_AddRotation(pRVar10,D3DRMCOMBINE_BEFORE,0.0,1.0,0.0,fVar35);
		LVar23 = liveObj->flags1_3e0;
		liveObj->flags1_3e0 = LVar23 & ~LIVEOBJ1_TURNING | LIVEOBJ1_MOVING;
		if (liveObj->routingBlocksTotal != 0) {
			if (((LVar23 & 0x800000) != LIVEOBJ1_NONE) && (liveObj->objType == OBJECT_MINIFIGURE)) {
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_RUNPANIC,0);
				goto LAB_0043f040;
			}
LAB_0043e732:
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_ROUTE,0);
			goto LAB_0043f040;
		}
LAB_0043ecae:
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
		goto LAB_0043f040;
	}
	if ((LVar4 & 0x20) != LIVEOBJ2_NONE) {
		FUN_004499c0(liveObj);
		goto LAB_0043f040;
	}
	if ((LVar23 & 0x80000000) != LIVEOBJ1_NONE) {
LAB_0043eb11:
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			liveObj->flags1_3e0 = LVar23 & 0x7fffffff;
		}
		goto LAB_0043f040;
	}
	if ((LVar23 & 0x10000000) != LIVEOBJ1_NONE) {
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			pRVar10 = lego::game::LiveObject_GetResource(liveObj);
			liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xefffffff;
			lego::res::Res_SetFrameOrientation
								(pRVar10,NULL,(float)liveObj->field_2c8,(float)liveObj->field_2cc,0.0,0.0,0.0,-1.0);
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
		}
		goto LAB_0043f040;
	}
	if ((LVar4 & 0x400000) != LIVEOBJ2_NONE) {
		if ((LVar4 & 0x10000) != LIVEOBJ2_NONE) {
			lego::game::Game_GetWeaponUnk(liveObj,1);
		}
		if (((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								 (ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) &&
			 (LVar4 = liveObj->flags2_3e4, liveObj->flags2_3e4 = LVar4 & 0xffbfffff,
			 (LVar4 & 0x20000) == LIVEOBJ2_NONE)) {
			lego::game::Game_GetWeaponUnk(liveObj,1);
		}
		goto LAB_0043f040;
	}
	if ((LVar12 & 0x8000) != 0) {
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) != 0) goto LAB_0043f040;
		liveObj->flags4_3ec = LVar12 & 0xffff7fff;
		if (liveObj->object_2fc != NULL) {
			pRVar10 = lego::game::LiveObject_GetDepositNull(liveObj->object_2fc);
			if (pRVar10 != NULL) {
				lego::res::Res_GetPosition(pRVar10,NULL,&local_c);
				lego::res::Res_GetOrientation(pRVar10,NULL,&local_20,NULL);
				puVar18 = (uint *)local_c.x;
				piVar19 = (int *)local_c.y;
				pLVar20 = lego::game::GetSurfaceMap();
				fVar25 = lego::game::SurfaceMap_UnkGetZ(pLVar20,(float)puVar18,(float)piVar19);
				fVar35 = (float)fVar25;
				pRVar28 = NULL;
				puVar18 = (uint *)local_c.x;
				piVar19 = (int *)local_c.y;
				pRVar10 = lego::game::LiveObject_GetResource(liveObj);
				lego::res::Res_SetFramePosition(pRVar10,pRVar28,(float)puVar18,(float)piVar19,fVar35);
				uz = -1.0;
				uy = 0.0;
				fVar29 = 0.0;
				pRVar28 = NULL;
				fVar35 = local_20.x;
				fVar27 = local_20.y;
				pRVar10 = lego::game::LiveObject_GetResource(liveObj);
				lego::res::Res_SetFrameOrientation(pRVar10,pRVar28,fVar35,fVar27,local_20.z,fVar29,uy,uz);
			}
			FUN_00437690((uint *)liveObj->object_2fc,0);
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
			goto LAB_0043f040;
		}
		goto LAB_0043ecae;
	}
	if ((LVar4 & 0x80000000) != LIVEOBJ2_NONE) {
		if (liveObj->object_2fc == NULL) {
			liveObj->flags2_3e4 = LVar4 & 0x7fffffff;
		}
		else {
			pRVar10 = lego::game::LiveObject_GetResource(liveObj);
			pRVar28 = lego::game::LiveObject_GetResource(liveObj->object_2fc);
			pLVar30 = liveObj->object_2fc;
			lego::res::Res_GetPosition(pRVar28,NULL,&local_c);
			lego::res::Res_GetOrientation(pRVar28,NULL,&local_30,&local_20);
			lego::res::Res_SetFramePosition(pRVar10,NULL,local_c.x,local_c.y,local_c.z);
			lego::res::Res_SetFrameOrientation
								(pRVar10,NULL,local_30.x,local_30.y,local_30.z,local_20.x,local_20.y,local_20.z);
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
				pLVar30->carriedObjects[pLVar30->numCarriedObjects] = liveObj;
				pLVar30->carriedObjects[pLVar30->numCarriedObjects]->carryingThisObject = pLVar30;
				pLVar30->carriedObjects[(int)(LiveObject *)pLVar30->numCarriedObjects]->carriedObjects[6] =
						 (LiveObject *)pLVar30->numCarriedObjects;
				pLVar30->flags1_3e0 = pLVar30->flags1_3e0 | LIVEOBJ1_CARRYING;
				FUN_00437690((uint *)pLVar30,0);
				pLVar30->numCarriedObjects = pLVar30->numCarriedObjects + 1;
				liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0x7fffffff;
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
				FUN_00403c40(liveObj,0x1e,NULL,1);
				pLVar30->flags4_3ec = pLVar30->flags4_3ec & 0xfffeffff;
			}
		}
		goto LAB_0043f040;
	}
	if ((LVar4 & 0x10000000) != LIVEOBJ2_NONE) {
		if (((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								 (ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) &&
			 (liveObj->flags2_3e4 = LVar4 & 0xefffffff, (LVar23 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE)) {
			pVVar33 = &local_c;
			pRVar28 = NULL;
			liveObj->carriedObjects[0]->flags3_3e8 = liveObj->carriedObjects[0]->flags3_3e8 & 0x7fffffff;
			pRVar10 = lego::game::LiveObject_GetResource(liveObj->carriedObjects[0]);
			lego::res::Res_GetPosition(pRVar10,pRVar28,pVVar33);
			lego::res::Res_PlayResourceSound(NULL,0x1a,0,0,&local_c);
			lego::game::LiveObject_SetCrystalPoweredColor(liveObj->carriedObjects[0],1);
		}
		goto LAB_0043f040;
	}
	if ((LVar4 & 0x800000) != LIVEOBJ2_NONE) {
		if ((LVar4 & 0x10000) != LIVEOBJ2_NONE) {
			lego::game::Game_GetWeaponUnk(liveObj,2);
		}
		if (((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								 (ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) &&
			 (LVar4 = liveObj->flags2_3e4, liveObj->flags2_3e4 = LVar4 & 0xff7fffff,
			 (LVar4 & 0x20000) == LIVEOBJ2_NONE)) {
			lego::game::Game_GetWeaponUnk(liveObj,2);
		}
		goto LAB_0043f040;
	}
	if ((LVar4 & 0x1000000) != LIVEOBJ2_NONE) {
		if ((LVar4 & 0x10000) != LIVEOBJ2_NONE) {
			lego::game::Game_GetWeaponUnk(liveObj,3);
		}
		if (((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								 (ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) &&
			 (LVar4 = liveObj->flags2_3e4, liveObj->flags2_3e4 = LVar4 & 0xfeffffff,
			 (LVar4 & 0x20000) == LIVEOBJ2_NONE)) {
			lego::game::Game_GetWeaponUnk(liveObj,3);
		}
		goto LAB_0043f040;
	}
	if ((LVar23 & 0x800) != LIVEOBJ1_NONE) {
		if ((liveObj->objType == OBJECT_ROCKMONSTER) &&
			 (BVar15 = FUN_00406f70(liveObj->rockMonster), BVar15 != 0)) {
			FUN_00447a40(liveObj);
		}
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xfffff7ff;
		}
		goto LAB_0043f040;
	}
	if ((LVar23 & 0x4000) != LIVEOBJ1_NONE) {
		pLVar30 = liveObj->object_2fc;
		if ((((pLVar30 != NULL) && ((pLVar30->flags1_3e0 & 0x2000) == LIVEOBJ1_NONE)) &&
				((pLVar30->flags3_3e8 & 0x1000000) == LIVEOBJ3_NONE)) &&
			 (pLVar30->numCarriedObjects != pLVar30->field_328)) {
			liveObj->flags1_3e0 = LVar23 & 0xffffbfff | 0x2000;
		}
		goto LAB_0043f040;
	}
	if ((LVar23 & 0x2000) != LIVEOBJ1_NONE) {
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			liveObj->flags1_3e0 = LVar23 & 0xffffdfff;
			FUN_00403c40(liveObj,5,liveObj,1);
			FUN_0043f160(liveObj);
		}
		else {
			if (liveObj->object_2fc != NULL) {
				pLVar1 = &liveObj->object_2fc->flags3_3e8;
				*pLVar1 = *pLVar1 | 0x1000000;
			}
		}
		goto LAB_0043f040;
	}
	if ((LVar23 & LIVEOBJ1_REST) != LIVEOBJ1_NONE) {
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			liveObj->flags1_3e0 = LVar23 & ~LIVEOBJ1_REST;
			liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xffffbfff;
		}
		goto LAB_0043f040;
	}
	if ((LVar4 & 0x200000) != LIVEOBJ2_NONE) {
		if ((LVar4 & 0x10000) != LIVEOBJ2_NONE) {
			FUN_0043aeb0(liveObj);
		}
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xffdfffff;
			FUN_00403c40(liveObj,0x19,NULL,1);
			if ((liveObj->flags2_3e4 & 0x20000) == LIVEOBJ2_NONE) {
				FUN_0043aeb0(liveObj);
			}
		}
		goto LAB_0043f040;
	}
	if ((LVar4 & 0x40000) != LIVEOBJ2_NONE) {
		if ((LVar4 & 0x10000) != LIVEOBJ2_NONE) {
			FUN_004477b0(liveObj);
		}
		if (((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								 (ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) &&
			 (LVar4 = liveObj->flags2_3e4, liveObj->flags2_3e4 = LVar4 & 0xfffbffff,
			 (LVar4 & 0x20000) == LIVEOBJ2_NONE)) {
			FUN_004477b0(liveObj);
		}
		goto LAB_0043f040;
	}
	if ((LVar4 & 0x20000000) != LIVEOBJ2_NONE) {
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			liveObj->flags2_3e4 = LVar4 & 0xdfffffff;
			liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0x7fffffff;
		}
		goto LAB_0043f040;
	}
	if ((LVar23 & 0x1000000) != LIVEOBJ1_NONE) {
		OVar21 = lego::game::LiveObject_GetStatsFlags2(liveObj);
		if ((((OVar21 & STATS2_DRAINPOWER) != STATS2_NONE) &&
				(pLVar30 = liveObj->object_2fc, pLVar30 != NULL)) &&
			 ((*(byte *)&pLVar30->flags4_3ec & 0x10) == 0)) {
			BVar15 = FUN_00438870(pLVar30,0);
			if (BVar15 != 0) {
				lego::game::Info_FUN_00419ab0(INFO_POWERDRAIN,NULL,liveObj->object_2fc,NULL);
				lego::game::Game_SetCallToArmsOn(1);
			}
			pLVar2 = &liveObj->object_2fc->flags4_3ec;
			*pLVar2 = *pLVar2 | 0x10;
			FUN_00439c50();
		}
		if (((liveObj->flags2_3e4 & 0x10000) != LIVEOBJ2_NONE) &&
			 (iVar11 = FUN_00447880(liveObj), iVar11 != 0)) {
			liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfff7ffff;
		}
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			if (((liveObj->flags2_3e4 & 0x20000) == LIVEOBJ2_NONE) &&
				 (iVar11 = FUN_00447880(liveObj), iVar11 != 0)) {
				liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfff7ffff;
				FUN_00403c40(liveObj,10,NULL,1);
			}
			if ((liveObj->flags2_3e4 & 0x80000) == LIVEOBJ2_NONE) {
				liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xfeffffff;
				if (liveObj->object_2fc != NULL) {
					pLVar2 = &liveObj->object_2fc->flags4_3ec;
					*pLVar2 = *pLVar2 & 0xffffffef;
					FUN_00439c50();
					liveObj->object_2fc = NULL;
				}
				FUN_00403c40(liveObj,10,NULL,1);
			}
			else {
				pRVar10 = lego::game::LiveObject_GetResource(liveObj);
				lego::res::Res_DoCallbacks(pRVar10,liveObj->float_2d4);
			}
		}
		goto LAB_0043f040;
	}
	if ((LVar23 & LIVEOBJ1_EATING) != LIVEOBJ1_NONE) {
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			iVar11 = FUN_004479f0((int)liveObj);
			if (iVar11 == 0) {
				pRVar10 = lego::game::LiveObject_GetResource(liveObj);
				lego::res::Res_DoCallbacks(pRVar10,liveObj->float_2d4);
			}
			else {
				liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_EATING;
				FUN_00403c40(liveObj,0x10,NULL,1);
				FUN_00403c40(liveObj,0x11,NULL,1);
			}
		}
		goto LAB_0043f040;
	}
	if ((LVar4 & 0x40) != LIVEOBJ2_NONE) {
		liveObj->flags2_3e4 = LVar4 & 0xffffffbf;
		if (liveObj->aitask_2f0 != NULL) {
			lego::game::MiniFigure_EquipTool(liveObj,*(ToolType *)&liveObj->aitask_2f0->field_0x38);
			FUN_00403c40(liveObj,0x13,NULL,1);
		}
		goto LAB_0043f040;
	}
	if ((LVar4 & LIVEOBJ2_TRAINING) != LIVEOBJ2_NONE) {
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
			liveObj->flags2_3e4 = LVar4 & ~LIVEOBJ2_TRAINING;
			FUN_00403c40(liveObj,0x17,NULL,1);
		}
		goto LAB_0043f040;
	}
	if ((LVar4 & LIVEOBJ2_UPGRADING) == LIVEOBJ2_NONE) {
		if ((LVar23 & LIVEOBJ1_PLACING) != LIVEOBJ1_NONE) {
			pRVar10 = lego::game::LiveObject_GetResource(liveObj);
			lego::res::Res_UpdateAnimTime(pRVar10);
			if ((((liveObj->flags2_3e4 & 0x10000) != LIVEOBJ2_NONE) &&
					((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE)) &&
				 (liveObj->carriedObjects[0] != NULL)) {
				pVVar33 = &local_c;
				pRVar28 = NULL;
				pRVar10 = lego::game::LiveObject_GetResource(liveObj->carriedObjects[0]);
				lego::res::Res_GetPosition(pRVar10,pRVar28,pVVar33);
				OVar5 = liveObj->carriedObjects[0]->objType;
				if (OVar5 == OBJECT_ORE) {
					iVar11 = 0x24;
				}
				else {
					if (OVar5 == OBJECT_POWERCRYSTAL) {
						iVar11 = 0x25;
					}
					else {
						iVar11 = 0x23;
					}
				}
				lego::res::Res_PlayResourceSound(NULL,iVar11,0,0,&local_c);
			}
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
				liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_PLACING;
				FUN_0043a130(liveObj,1);
			}
			goto LAB_0043f040;
		}
		if ((LVar23 & 0x1000) != LIVEOBJ1_NONE) {
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
				liveObj->flags1_3e0 = LVar23 & 0xffffefff;
			}
			goto LAB_0043f040;
		}
		if (liveObj->carryingThisObject != NULL) goto LAB_0043f040;
		if (((LVar23 & LIVEOBJ1_MOVING) != LIVEOBJ1_NONE) &&
			 (iVar11 = FUN_0043c6a0((int *)liveObj), iVar11 != 0)) {
			lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,1);
			FUN_0043c7f0((uint *)liveObj);
			goto LAB_0043f040;
		}
		LVar23 = liveObj->flags1_3e0;
		if ((LVar23 & LIVEOBJ1_MOVING) != LIVEOBJ1_NONE) {
			FUN_00443b70(liveObj,elapsed);
			FUN_004443b0(liveObj,elapsed);
			FUN_0043ad70((uint *)liveObj);
			LVar4 = liveObj->flags2_3e4;
			if ((LVar4 & 0x4000000) != LIVEOBJ2_NONE) {
				iVar11 = FUN_00472340((undefined4 *)liveObj,(undefined4 *)liveObj->aitask_2f0->object_10);
				if ((iVar11 == 0) ||
					 (iVar11 = FUN_00471b90((undefined4 *)liveObj,(undefined4 *)liveObj->aitask_2f0->object_10
																 ), iVar11 != 0)) {
					liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfbffffff;
				}
				else {
					FUN_0043c780((uint *)liveObj);
				}
				goto LAB_0043f040;
			}
			LVar23 = liveObj->flags1_3e0;
			if ((LVar23 & 8) != LIVEOBJ1_NONE) {
				lVar26 = __ftol((float10)(liveObj->point_2f4).x);
				local_c.x = (float)(uint *)lVar26;
				lVar26 = __ftol((float10)(liveObj->point_2f4).y);
				local_c.y = (float)(int *)lVar26;
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_DRILL,0);
				lego::game::Level_SetBlockFlags1_8000000((Point2I *)&local_c,1);
				goto LAB_0043f040;
			}
			if ((LVar23 & LIVEOBJ1_UNK_2_LEFTING) != LIVEOBJ1_NONE) {
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_REVERSE,0);
				goto LAB_0043f040;
			}
			if ((LVar4 & LIVEOBJ2_TRAINING) != LIVEOBJ2_NONE) {
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_TRAIN,0);
				goto LAB_0043f040;
			}
			if ((LVar4 & 0x10000000) != LIVEOBJ2_NONE) {
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_RECHARGE,0);
				goto LAB_0043f040;
			}
			if ((LVar23 & LIVEOBJ1_CLEARING) != LIVEOBJ1_NONE) {
				lego::game::LiveObject_SetActivityUnk
									(liveObj,ACTIVITY_CLEAR,(liveObj->objType != OBJECT_MINIFIGURE) - 1 & 2);
				goto LAB_0043f040;
			}
			if ((LVar4 & 0x80000000) != LIVEOBJ2_NONE) {
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_FLOATON,0);
				goto LAB_0043f040;
			}
			if ((LVar4 & 4) != LIVEOBJ2_NONE) {
				if (liveObj->object_2fc != NULL) {
					FUN_0043f3c0(liveObj,(int)liveObj->object_2fc);
				}
				goto LAB_0043f040;
			}
			if ((LVar23 & LIVEOBJ1_REINFORCING) != LIVEOBJ1_NONE) {
				lVar26 = __ftol((float10)(liveObj->point_2f4).x);
				local_c.x = (float)(uint *)lVar26;
				lVar26 = __ftol((float10)(liveObj->point_2f4).y);
				local_c.y = (float)(int *)lVar26;
				lego::game::Level_SetBlockFlags1_8000000((Point2I *)&local_c,1);
				lego::game::LiveObject_SetActivityUnk
									(liveObj,ACTIVITY_REINFORCE,lego::globals::g_Game.ReinforceHits);
				goto LAB_0043f040;
			}
			if ((LVar23 & LIVEOBJ1_PLACING) != LIVEOBJ1_NONE) {
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_PLACE,0);
				goto LAB_0043f040;
			}
			if ((LVar23 & 0x20000) != LIVEOBJ1_NONE) {
				lVar26 = __ftol((float10)(liveObj->point_2f4).x);
				local_20.x = (float)lVar26;
				lVar26 = __ftol((float10)(liveObj->point_2f4).y);
				local_20.y = (float)lVar26;
				OVar21 = lego::game::LiveObject_GetStatsFlags2(liveObj);
				if (((OVar21 & STATS2_USEHOLES) == STATS2_NONE) &&
					 (BVar15 = lego::game::Level_GetBlockFlags1_10Not8((uint)local_20.x,(uint)local_20.y),
					 BVar15 == 0)) {
					liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xfffdffff;
					liveObj->flags2_3e4 = liveObj->flags2_3e4 | 0x20;
				}
				else {
					BVar15 = lego::game::Level_GetBlockFlags1_20((uint)local_20.x,(uint)local_20.y);
					if (BVar15 == 0) {
						lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_ENTER,0);
					}
					else {
						lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_ENTERREIN,0);
						uVar22 = lego::game::Game_UpdateSomeAITasks(liveObj);
						if (uVar22 == 0) {
							lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_ENTER,0);
							lego::game::Game_UpdateSomeAITasks(liveObj);
						}
						OVar21 = lego::game::LiveObject_GetStatsFlags2(liveObj);
						if ((OVar21 & STATS2_REMOVEREINFORCEMENT) != STATS2_NONE) {
							FUN_00431020((int **)&local_20);
						}
					}
				}
				goto LAB_0043f040;
			}
			if ((LVar23 & 0x1000000) != LIVEOBJ1_NONE) {
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_REPAIR,0);
				goto LAB_0043f040;
			}
			if ((LVar4 & 0x200000) != LIVEOBJ2_NONE) {
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAMP,0);
				goto LAB_0043f040;
			}
			if ((LVar4 & LIVEOBJ2_UPGRADING) != LIVEOBJ2_NONE) {
				if (liveObj->objType == OBJECT_MINIFIGURE) {
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_TRAIN,100);
				}
				else {
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_UPGRADE,0);
					lego::game::LiveObject_SetActivityUnk(liveObj->object_2fc,ACTIVITY_UPGRADE,0);
					lego::game::Game_UpdateSomeAITasks(liveObj->object_2fc);
					liveObj->object_2fc->flags2_3e4 = liveObj->object_2fc->flags2_3e4 | LIVEOBJ2_UPGRADING;
				}
				goto LAB_0043f040;
			}
			if ((LVar23 & LIVEOBJ1_EATING) != LIVEOBJ1_NONE) {
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_EAT,0);
				goto LAB_0043f040;
			}
			if ((LVar23 & 0x200) == LIVEOBJ1_NONE) {
				if ((LVar23 & 0x2000) != LIVEOBJ1_NONE) {
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_DESPOSITE,0);
					pLVar30 = liveObj->object_2fc;
					if ((pLVar30 != NULL) &&
						 ((OVar14 = lego::game::LiveObject_GetStatsFlags1(pLVar30),
							(OVar14 & STATS1_PROCESSCRYSTAL) != STATS1_NONE ||
							(OVar14 = lego::game::LiveObject_GetStatsFlags1(pLVar30),
							(OVar14 & STATS1_PROCESSORE) != STATS1_NONE)))) {
						pLVar30 = liveObj->object_2fc;
						if (((pLVar30->flags1_3e0 & 0x2000) == LIVEOBJ1_NONE) &&
							 (((pLVar30->flags3_3e8 & 0x1000000) == LIVEOBJ3_NONE &&
								(pLVar30->numCarriedObjects != pLVar30->field_328)))) {
							pLVar30->flags3_3e8 = pLVar30->flags3_3e8 | 0x1000000;
						}
						else {
							liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xffffdfff | 0x4000;
						}
					}
					goto LAB_0043f040;
				}
				if ((LVar23 & 0x800) != LIVEOBJ1_NONE) {
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_THROW,0);
					goto LAB_0043f040;
				}
				if (((LVar23 & LIVEOBJ1_TURNING) != LIVEOBJ1_NONE) ||
					 ((LVar23 & LIVEOBJ1_REST) != LIVEOBJ1_NONE)) goto LAB_0043f040;
				if ((LVar23 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) {
					lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_20,(int *)&local_20.y);
					uVar22 = lego::game::Level_GetBlockRubbleLevel_OrFlag200000((Point2I *)&local_20);
					if (((uVar22 < 3) &&
							((lego::globals::g_Game.level)->blocks
							 [((lego::globals::g_Game.level)->dimensions).width * (int)local_20.y +
								(int)local_20.x].terrain != TERRAIN_LAKE)) ||
						 ((liveObj->flags3_3e8 & 0x10000000) == LIVEOBJ3_NONE)) {
						lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_CARRY,0);
					}
					else {
						lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_CARRYRUBBLE,0);
					}
					goto LAB_0043f040;
				}
				if ((LVar23 & 0x80000000) != LIVEOBJ1_NONE) {
					lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,0);
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_CANTDO,1);
					goto LAB_0043f040;
				}
				if ((LVar23 & LIVEOBJ1_MOVING) == LIVEOBJ1_NONE) goto LAB_0043f040;
				lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_20,(int *)&local_20.y);
				if (((liveObj->flags1_3e0 & 0x800000) != LIVEOBJ1_NONE) &&
					 (liveObj->objType == OBJECT_MINIFIGURE)) {
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_RUNPANIC,0);
					goto LAB_0043f040;
				}
				uVar22 = lego::game::Level_GetBlockRubbleLevel_OrFlag200000((Point2I *)&local_20);
				if (((2 < uVar22) ||
						((lego::globals::g_Game.level)->blocks
						 [((lego::globals::g_Game.level)->dimensions).width * (int)local_20.y + (int)local_20.x]
						 .terrain == TERRAIN_LAKE)) && ((liveObj->flags3_3e8 & 0x10000000) != LIVEOBJ3_NONE)) {
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_ROUTERUBBLE,0);
					goto LAB_0043f040;
				}
				goto LAB_0043e732;
			}
			if ((liveObj->object_2fc == NULL) || (liveObj->object_2fc->carryingThisObject != NULL)) {
				liveObj->flags1_3e0 = LVar23 & 0xfffffdff;
				goto LAB_0043f040;
			}
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_COLLECT,0);
			if (liveObj->objType == OBJECT_ROCKMONSTER) {
				OVar5 = liveObj->object_2fc->objType;
				if (OVar5 == OBJECT_BOULDER) {
					AVar32 = ACTIVITY_GATHER;
				}
				else {
					if (OVar5 != OBJECT_POWERCRYSTAL) goto LAB_0043e4b7;
					AVar32 = ACTIVITY_EAT;
				}
				lego::game::LiveObject_SetActivityUnk(liveObj,AVar32,0);
			}
LAB_0043e4b7:
			liveObj->carriedObjects[liveObj->numCarriedObjects] = liveObj->object_2fc;
			liveObj->object_2fc = NULL;
			liveObj->carriedObjects[liveObj->numCarriedObjects]->carryingThisObject = liveObj;
			liveObj->carriedObjects[(int)(LiveObject *)liveObj->numCarriedObjects]->carriedObjects[6] =
					 (LiveObject *)liveObj->numCarriedObjects;
			liveObj->flags1_3e0 = liveObj->flags1_3e0 | LIVEOBJ1_CARRYING;
			FUN_00403c40(liveObj,3,liveObj->carriedObjects[liveObj->numCarriedObjects],1);
			FUN_00403e60(liveObj);
			liveObj->numCarriedObjects = liveObj->numCarriedObjects + 1;
			goto LAB_0043f040;
		}
		if ((LVar23 & 0x200000) != LIVEOBJ1_NONE) {
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
				liveObj->flags1_3e0 = LVar23 & 0xffdfffff;
				if (liveObj->objType == OBJECT_VEHICLE) {
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_ROUTE,0);
					lego::game::Game_UpdateSomeAITasks(liveObj);
				}
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
				FUN_00438720(liveObj);
			}
			FUN_00443240(liveObj,elapsed);
			pRVar10 = lego::game::LiveObject_GetResource(liveObj);
			if (pRVar10 != NULL) {
				lego::res::Res_GetOrientation(pRVar10,NULL,&local_c,NULL);
				lego::res::Res_SetFrameOrientation(pRVar10,NULL,local_c.x,local_c.y,local_c.z,0.0,0.0,-1.0);
			}
			goto LAB_0043f040;
		}
		BVar15 = FUN_00449c40(liveObj,elapsed,&local_14);
		if (BVar15 != 0) {
			if (local_14 != 0) {
				FUN_00403c40(liveObj,0xb,NULL,1);
			}
			goto LAB_0043f040;
		}
		LVar23 = liveObj->flags1_3e0;
		if ((LVar23 & 0x100) != LIVEOBJ1_NONE) {
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
				liveObj->flags1_3e0 = LVar23 & 0xfffffeff;
				BVar15 = FUN_004439b0(liveObj);
				if (BVar15 != 0) {
					lVar26 = __ftol((float10)(liveObj->point_2f4).x);
					local_c.x = (float)(uint *)lVar26;
					lVar26 = __ftol((float10)(liveObj->point_2f4).y);
					local_c.y = (float)(int *)lVar26;
					lego::game::Level_AddMessageAction(MESSAGE_GENERATEROCKMONSTER_COMPLETE,liveObj,0,NULL);
					lego::game::Level_SetBlockFlags1_8000000((Point2I *)&local_c,0);
				}
			}
			goto LAB_0043f040;
		}
		LVar4 = liveObj->flags2_3e4;
		if ((LVar4 & 0x100000) != LIVEOBJ2_NONE) {
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
				liveObj->flags2_3e4 = LVar4 & 0xffefffff;
				liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x800000;
			}
			goto LAB_0043f040;
		}
		if ((LVar4 & 4) != LIVEOBJ2_NONE) {
			pLVar30 = liveObj->object_2fc;
			liveObj->flags2_3e4 = LVar4 & 0xfffffffb;
			FUN_00403c40(liveObj,0x12,NULL,1);
			liveObj->flags2_3e4 = liveObj->flags2_3e4 | LIVEOBJ2_DRIVING;
			pLVar30->flags4_3ec = pLVar30->flags4_3ec & 0xffffff7f;
			if (pLVar30->object_2fc != NULL) {
				pLVar2 = &pLVar30->object_2fc->flags4_3ec;
				*pLVar2 = *pLVar2 & 0xffffff7f;
			}
			pLVar30->object_2fc = NULL;
			pLVar30->flags2_3e4 = pLVar30->flags2_3e4 & 0xffffffef;
			liveObj->drivenObject = pLVar30;
			pLVar30->drivenObject = liveObj;
			liveObj->object_2fc = NULL;
			FUN_0041cdd0((int)liveObj->drivenObject);
			FUN_00443240(liveObj,elapsed);
			pLVar30->aitaskName2 = NULL;
			lego::game::Game_UpdateSomeAITasks(pLVar30);
			goto LAB_0043f040;
		}
		if ((LVar4 & LIVEOBJ2_DRIVING) != LIVEOBJ2_NONE) goto LAB_0043f040;
		if ((LVar23 & 0x20000) != LIVEOBJ1_NONE) {
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
				liveObj->flags1_3e0 = LVar23 & 0xfffdffff;
				liveObj->flags2_3e4 = LVar4 & 0xffffffdf;
				FUN_0043be80((int *)liveObj);
			}
			goto LAB_0043f040;
		}
		if ((LVar4 & 0x200) != LIVEOBJ2_NONE) {
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
				lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_20,(int *)&local_20.y);
				iVar11 = FUN_00408ff0((Point2I *)&local_20,NULL);
				if ((iVar11 != 0) && ((*(byte *)(iVar11 + 0xd0) & 2) != 0)) {
					FUN_00432530((Point2I *)&local_20);
					FUN_00409040((int *)&local_20);
					lego::game::Info_FUN_00419ab0(INFO_PATHCOMPLETED,NULL,NULL,(Point2I *)&local_20);
					FUN_00403410((undefined4 *)&local_20);
				}
				liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfffffdff;
				FUN_00403c40(liveObj,0x16,NULL,1);
			}
			goto LAB_0043f040;
		}
		if ((LVar23 & LIVEOBJ1_CLEARING) != LIVEOBJ1_NONE) {
			if (liveObj->objType == OBJECT_VEHICLE) {
				FUN_00443240(liveObj,elapsed);
			}
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
				liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_CLEARING;
				FUN_00403c40(liveObj,0xc,NULL,1);
				if (liveObj->objType == OBJECT_VEHICLE) {
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
				}
			}
			goto LAB_0043f040;
		}
		if ((LVar23 & 0x80000000) != LIVEOBJ1_NONE) goto LAB_0043eb11;
		if ((LVar4 & 0x100) != LIVEOBJ2_NONE) {
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
				liveObj->flags2_3e4 = LVar4 & 0xfffffeff;
			}
			goto LAB_0043f040;
		}
		if ((LVar23 & 0x10000) != LIVEOBJ1_NONE) {
			sVar9 = lego::util::randomInt16();
			if ((int)sVar9 % 10 != 0) {
				FUN_00444520(liveObj);
			}
			liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xfffeffff;
			goto LAB_0043f040;
		}
		if ((LVar4 & 2) != LIVEOBJ2_NONE) {
			if (((*(byte *)&liveObj->object_3c0->flags2_3e4 & 1) == 0) ||
				 ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0)) {
				liveObj->flags2_3e4 = LVar4 & 0xfffffffd;
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_GETUP,0);
				lego::game::Game_UpdateSomeAITasks(liveObj);
				liveObj->flags2_3e4 = liveObj->flags2_3e4 | 0x100;
			}
			goto LAB_0043f040;
		}
		if ((LVar4 & 1) != LIVEOBJ2_NONE) {
			if ((LVar4 & 0x10000) != LIVEOBJ2_NONE) {
				lego::game::LiveObject_GetPosition(liveObj,(float *)&local_c,&local_c.y);
				BVar15 = 1;
				fVar25 = FUN_00442740(liveObj);
				FUN_00442b60(liveObj->object_3c0,local_c.x,local_c.y,(float)fVar25,BVar15);
			}
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) != 0) goto LAB_0043f040;
			pRVar10 = lego::game::LiveObject_GetDepositNull(liveObj);
			lego::res::Res_GetPosition(pRVar10,NULL,&local_c);
			FUN_00442b60(liveObj,local_c.x,local_c.y,0,0);
			liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfffffffe;
			FUN_0043f960(liveObj->object_3c0,10.0,1,elapsed);
			goto LAB_0043ecae;
		}
		BVar15 = FUN_00433b40((int *)liveObj,elapsed,0);
		if (BVar15 != 0) goto LAB_0043f040;
		iVar11 = FUN_00442dd0(liveObj,elapsed,&local_10);
		if (iVar11 != 0) {
			if (iVar11 == 1) {
				if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE) {
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_ROUTE,0);
				}
				else {
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_CARRY,0);
				}
			}
			else {
				if (iVar11 == 4) {
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
				}
				else {
					if (iVar11 == 2) {
						lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_WALK,0);
					}
					else {
						if ((iVar11 == 3) &&
							 (BVar15 = lego::game::LiveObject_GetDrillNullPosition
																	 (liveObj,(float *)&local_20,(float *)&param_1), BVar15 != 0)) {
							out_y = &local_30.y;
							pVVar33 = &local_30;
							fVar35 = local_20.x;
							pLVar30 = param_1;
							pLVar20 = lego::game::GetSurfaceMap();
							BVar15 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
																 (pLVar20,fVar35,(float)pLVar30,(int *)pVVar33,(int *)out_y);
							if ((BVar15 != 0) &&
								 (BVar15 = lego::game::Level_GetBlockFlags1_10Not8
																		 ((uint)local_30.x,(uint)local_30.y), BVar15 != 0)) {
								SVar17 = FUN_004318e0((int)local_30.x,(int)local_30.y);
								fVar25 = lego::game::LiveObject_GetDrillTimeType(liveObj,SVar17);
								local_24 = (float)fVar25;
								if ((liveObj->flags4_3ec & 0x20000) == 0) {
									lego::game::LiveObject_GetResource(liveObj);
									BVar15 = 1;
									iVar11 = lego::game::LiveObject_GetDrillSoundType(liveObj,0);
									lego::snd::Snd_Play_FUN_00465260(iVar11,BVar15);
									liveObj->field_350 = iVar11;
									liveObj->flags4_3ec = liveObj->flags4_3ec | 0x120000;
								}
								bVar8 = false;
								lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_DRILL,0);
								BVar15 = lego::game::Level_GetBlockUnkField14Test
																	 ((int)local_30.x,(int)local_30.y,local_24,elapsed);
								if ((BVar15 != 0) &&
									 (BVar15 = FUN_004326a0(liveObj,(uint)local_30.x,(uint)local_30.y,0,1),
									 BVar15 != 0)) {
									iVar11 = 0;
									pLVar13 = lego::game::GetLevel();
									FUN_00430460(pLVar13,(int)local_30.x,(int)local_30.y,iVar11);
								}
							}
						}
					}
				}
			}
			if (liveObj->objType == OBJECT_MINIFIGURE) {
				if ((DAT_004ebdcc & 3) == 0) {
					lego::snd::Snd_Play_FUN_00465260(8,0);
				}
				DAT_004ebdcc += 1;
			}
			goto LAB_0043f040;
		}
		LVar23 = liveObj->flags1_3e0;
		if ((LVar23 & 0x200) != LIVEOBJ1_NONE) {
			if (((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									 (ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) &&
				 (liveObj->flags1_3e0 = LVar23 & 0xfffffdff, (LVar23 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE))
			{
				if (liveObj->objType == OBJECT_ROCKMONSTER) {
					pLVar30 = liveObj->carriedObjects[0];
					if (pLVar30->objType == OBJECT_BOULDER) {
						BVar15 = FUN_00438e40(liveObj,0x400);
						lego::game::Level_AddMessageAction(MESSAGE_GATHERROCK_COMPLETE,liveObj,BVar15,NULL);
					}
					else {
						liveObj->carriedObjects[0] = NULL;
						liveObj->numCarriedObjects = 0;
						pLVar30->carryingThisObject = NULL;
						pLVar30->object_300 = NULL;
						FUN_00403c40(liveObj,3,pLVar30,1);
						FUN_0043ab10(liveObj,pLVar30);
						liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_CARRYING;
					}
				}
				else {
					OVar5 = liveObj->carriedObjects[liveObj->numCarriedObjects - 1]->objType;
					if (OVar5 == OBJECT_POWERCRYSTAL) {
						FUN_0041f8b0();
					}
					else {
						if (OVar5 == OBJECT_ORE) {
							FUN_0041f8c0();
							lego::game::Info_FUN_00419ab0(INFO_ORECOLLECTED,NULL,liveObj,NULL);
						}
					}
				}
			}
			goto LAB_0043f040;
		}
		if ((LVar23 & 0x8000) != LIVEOBJ1_NONE) {
			if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
									(ushort)(liveObj->float_2d4 == 0.0) << 0xe) == 0) {
				liveObj->flags1_3e0 = LVar23 & 0xffff7fff;
			}
			goto LAB_0043f040;
		}
		if ((LVar23 & LIVEOBJ1_TURNING) != LIVEOBJ1_NONE) goto LAB_0043f040;
		if ((LVar23 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE) {
			OVar5 = liveObj->objType;
			if (OVar5 == OBJECT_BUILDING) {
				if ((liveObj->flags3_3e8 & 0x20000000) != LIVEOBJ3_NONE) {
					if ((liveObj->flags3_3e8 & 0x80000000) != LIVEOBJ3_NONE) {
						AVar32 = ACTIVITY_UNPOWERED;
						goto LAB_0043f029;
					}
					goto LAB_0043eff8;
				}
			}
			else {
LAB_0043eff8:
				if ((OVar5 != OBJECT_ROCKMONSTER) || ((liveObj->flags3_3e8 & 0x80000000) == LIVEOBJ3_NONE))
				{
					if ((OVar5 == OBJECT_VEHICLE) && ((liveObj->flags4_3ec & 0x2000) != 0)) {
						AVar32 = ACTIVITY_OPEN;
					}
					else {
						AVar32 = ACTIVITY_STAND;
					}
					goto LAB_0043f029;
				}
			}
			AVar32 = ACTIVITY_UNPOWERED;
		}
		else {
			AVar32 = ACTIVITY_CARRYSTAND;
		}
LAB_0043f029:
		lego::game::LiveObject_SetActivityUnk(liveObj,AVar32,0);
		FUN_00443240(liveObj,elapsed);
		goto LAB_0043f040;
	}
	if (liveObj->objType == OBJECT_MINIFIGURE) {
		if (liveObj->object_2fc == NULL) {
			liveObj->flags2_3e4 = LVar4 & ~LIVEOBJ2_UPGRADING;
		}
		else {
			fVar25 = lego::res::Creature_GetAnimFloat10(liveObj->miniFigure);
			local_20.x = (float)fVar25;
			fVar25 = lego::game::LiveObject_GetUpgradeTime(liveObj);
			param_1 = (LiveObject *)(float)fVar25;
			fVar25 = lego::game::LiveObject_GetFunctionCoef(liveObj->object_2fc);
			if (fVar25 * (float10)(float)param_1 <= (float10)local_20.x) {
				FUN_00403c40(liveObj,0x15,NULL,1);
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
				lego::game::Game_UpdateSomeAITasks(liveObj);
				uVar24 = liveObj->objLevel + 1;
				uVar22 = lego::game::Object_GetLevels(liveObj->objType,liveObj->objIndex);
				if (uVar24 < uVar22) {
					lego::game::LiveObject_SetLevel(liveObj,uVar24);
					FUN_00418760(liveObj->objType,liveObj->objIndex,liveObj->objLevel,0);
				}
				liveObj->object_2fc = NULL;
				liveObj->flags2_3e4 = liveObj->flags2_3e4 & ~LIVEOBJ2_UPGRADING;
			}
		}
		goto LAB_0043f040;
	}
	if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 | (ushort)(liveObj->float_2d4 == 0.0) << 0xe)
			!= 0) goto LAB_0043f040;
	if ((liveObj->object_2fc == NULL) ||
		 (OVar21 = lego::game::LiveObject_GetStatsFlags2(liveObj->object_2fc),
		 (OVar21 & STATS2_UPGRADEBUILDING) == STATS2_NONE)) {
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & ~LIVEOBJ2_UPGRADING;
		goto LAB_0043f040;
	}
	if ((liveObj->object_2fc->flags2_3e4 & LIVEOBJ2_UPGRADING) != LIVEOBJ2_NONE) goto LAB_0043f040;
	FUN_00403c40(liveObj,0x15,NULL,1);
	uVar22 = lego::game::Object_GetUpgradeCostOre
										 (liveObj->objType,liveObj->objIndex,liveObj->field_404);
	uVar24 = lego::game::Level_GetOreCount(0);
	if (uVar24 < uVar22) {
		uVar22 = lego::game::Object_GetUpgradeCostStuds
											 (liveObj->objType,liveObj->objIndex,liveObj->field_404);
		uVar24 = lego::game::Level_GetOreCount(1);
		if (uVar22 <= uVar24) {
			lego::game::LiveObject_CompleteVehicleUpgrade(liveObj);
			iVar11 = lego::game::Object_GetUpgradeCostStuds
												 (liveObj->objType,liveObj->objIndex,liveObj->field_404);
			BVar15 = 1;
			goto LAB_0043df73;
		}
	}
	else {
		lego::game::LiveObject_CompleteVehicleUpgrade(liveObj);
		iVar11 = lego::game::Object_GetUpgradeCostOre
											 (liveObj->objType,liveObj->objIndex,liveObj->field_404);
		BVar15 = 0;
LAB_0043df73:
		lego::game::Level_SubtractOre(BVar15,iVar11);
	}
	liveObj->object_2fc->object_300 = NULL;
	liveObj->object_2fc = NULL;
	liveObj->flags2_3e4 = liveObj->flags2_3e4 & ~LIVEOBJ2_UPGRADING;
LAB_0043f040:
	if ((bVar8) && ((liveObj->flags4_3ec & 0x20000) != 0)) {
		lego::game::LiveObject_GetResource(liveObj);
		lego::snd::Sample_StopSoundBufferInstance(liveObj->field_350);
		BVar15 = 0;
		liveObj->flags4_3ec = liveObj->flags4_3ec & 0xffefffff;
		iVar11 = lego::game::LiveObject_GetDrillSoundType(liveObj,1);
		lego::snd::Snd_Play_FUN_00465260(iVar11,BVar15);
		liveObj->flags4_3ec = liveObj->flags4_3ec & 0xfffdffff;
	}
	lego::game::Game_UpdateSomeAITasks(liveObj);
	if ((liveObj->drivenObject != NULL) && (liveObj->objType != OBJECT_MINIFIGURE)) {
		FUN_004437d0(liveObj);
	}
	if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) {
		lego::game::LiveObject_UpdateCarrying(liveObj);
	}
	iVar11 = FUN_00471fa0((int *)liveObj);
	if (iVar11 != 0) {
		FUN_00472280((int *)liveObj,elapsed);
	}
	FUN_004459a0(liveObj);
	FUN_0044bef0(liveObj,*param_2);
	FUN_0043fa90(liveObj,elapsed);
	if ((liveObj->flags2_3e4 & 0x10000) != LIVEOBJ2_NONE) {
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfffeffff | 0x20000;
	}
	liveObj->flags4_3ec = liveObj->flags4_3ec & 0xfffffffd;
	FUN_0043bf00(liveObj);
	return 0;
}



void __cdecl FUN_0043f160(LiveObject *in_liveObj)
{
	LiveObject *pLVar1;
	LiveObject *liveObj2;
	bool bVar2;
	LiveObject *liveObj;
	ObjectStatsFlags1 OVar3;
	uint uVar4;
	ResourceData *resData;
	LiveObject *liveObj_00;
	int iVar5;
	int iVar6;
	LiveObject **ppLVar7;
	uint uVar8;
	Vector3F local_c;
	
	liveObj = in_liveObj;
	pLVar1 = in_liveObj->object_2fc;
	OVar3 = lego::game::LiveObject_GetStatsFlags1(in_liveObj);
	if (((OVar3 & STATS1_PROCESSCRYSTAL) == STATS1_NONE) &&
		 (OVar3 = lego::game::LiveObject_GetStatsFlags1(in_liveObj),
		 (OVar3 & STATS1_PROCESSORE) == STATS1_NONE)) {
		bVar2 = false;
	}
	else {
		bVar2 = true;
	}
	uVar8 = 0;
	if (in_liveObj->numCarriedObjects != 0) {
		in_liveObj = (LiveObject *)in_liveObj->carriedObjects;
		do {
			liveObj2 = (LiveObject *)in_liveObj->objType;
			liveObj2->object_2fc = NULL;
			if (bVar2) {
				liveObj2->carryingThisObject = NULL;
				liveObj2->object_300 = NULL;
				if (liveObj2->objType == OBJECT_ORE) {
					if ((uVar8 == 0) || (uVar4 = lego::game::LiveObject_GetMaxCarry(liveObj), uVar4 <= uVar8))
					{
						resData = lego::res::Building_GetDepositNull(liveObj->building);
						if (uVar8 == 0) {
							lego::res::Res_GetPosition(resData,NULL,&local_c);
							liveObj_00 = lego::game::Game_CreateLiveResourceObject
																		 (lego::globals::g_Game.RES_Ores_TABLE[1],OBJECT_ORE,1,0,
																			local_c.x,local_c.y,0.0);
							lego::game::Level_AddMessageAction(MESSAGE_GENERATEORE_COMPLETE,liveObj_00,0,NULL);
							lego::pool::ReservedPool_LiveObject___Release(liveObj2);
							goto LAB_0043f315;
						}
						FUN_0041f8d0(0);
					}
					lego::pool::ReservedPool_LiveObject___Release(liveObj2);
				}
				else {
					FUN_0043ab10(liveObj,liveObj2);
					if (liveObj->objType == OBJECT_BUILDING) {
						FUN_00408210((int)liveObj->building,1);
					}
					FUN_00439c50();
				}
			}
			else {
				if (pLVar1->numCarriedObjects == pLVar1->field_328) {
					if (uVar8 < liveObj->numCarriedObjects) {
						iVar6 = uVar8 * 4;
						ppLVar7 = liveObj->carriedObjects + uVar8;
						uVar4 = uVar8;
						do {
							pLVar1 = *ppLVar7;
							iVar5 = iVar6 + uVar8 * -4;
							uVar4 += 1;
							iVar6 += 4;
							ppLVar7 = ppLVar7 + 1;
							*(LiveObject **)((int)liveObj + iVar5 + 0x308) = pLVar1;
						} while (uVar4 < liveObj->numCarriedObjects);
					}
					liveObj->numCarriedObjects = liveObj->numCarriedObjects - uVar8;
					return;
				}
				pLVar1->carriedObjects[pLVar1->numCarriedObjects] = liveObj2;
				liveObj2->carryingThisObject = pLVar1;
				liveObj2->carriedObjects[6] = (LiveObject *)pLVar1->numCarriedObjects;
				pLVar1->numCarriedObjects = pLVar1->numCarriedObjects + 1;
				pLVar1->flags1_3e0 = pLVar1->flags1_3e0 | LIVEOBJ1_CARRYING;
				lego::game::Level_AddMessageAction(MESSAGE_CRYSTALTOREFINERY_COMPLETE,0,0,NULL);
				OVar3 = lego::game::LiveObject_GetStatsFlags1(pLVar1);
				if ((OVar3 & STATS1_PROCESSCRYSTAL) != STATS1_NONE) {
					lego::game::Info_FUN_00419ab0(INFO_CRYSTALPOWER,NULL,pLVar1,NULL);
				}
			}
LAB_0043f315:
			uVar8 += 1;
			in_liveObj->objType = OBJECT_NONE;
			in_liveObj = (LiveObject *)&in_liveObj->objIndex;
		} while (uVar8 < liveObj->numCarriedObjects);
	}
	liveObj->numCarriedObjects = 0;
	liveObj->object_2fc = NULL;
	liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_CARRYING;
	return;
}



void __cdecl FUN_0043f3c0(undefined4 param_1,int param_2)
{
	uint *puVar1;
	
	*(uint *)(param_2 + 0x3ec) = *(uint *)(param_2 + 0x3ec) & 0xffffffbf;
	if (*(int *)(param_2 + 0x2fc) != 0) {
		puVar1 = (uint *)(*(int *)(param_2 + 0x2fc) + 0x3ec);
		*puVar1 = *puVar1 & 0xffffffbf;
	}
	return;
}



void __cdecl lego::res::Res_ResourceDrawCallback(ResourceData *resData,void *lpValue)
{
	LiveObject *pLVar1;
	
	pLVar1 = Res_GetOwnerObject(resData);
	if (pLVar1 != NULL) {
		pLVar1->flags2_3e4 = pLVar1->flags2_3e4 | 0x10000;
	}
	return;
}



BOOL __cdecl
lego::game::LiveObject_QueueTeleport(LiveObject *liveObj,ObjectType objType,int objIndex)
{
	if (globals::g_Game.objTeleportQueue_COUNT < 9) {
		globals::g_Game.objTeleportQueueTypes_TABLE[globals::g_Game.objTeleportQueue_COUNT] = objType;
		globals::g_Game.objTeleportQueueIndexes_TABLE[globals::g_Game.objTeleportQueue_COUNT] = objIndex
		;
		globals::g_Game.objTeleportQueue_COUNT = globals::g_Game.objTeleportQueue_COUNT + 1;
		return 1;
	}
	return 0;
}



void __cdecl FUN_0043f450(LiveObject *in_liveObj)
{
	LiveObject *liveObj;
	BOOL BVar1;
	ObjectStatsFlags2 OVar2;
	ObjectStatsFlags1 OVar3;
	int iVar4;
	int iVar5;
	LiveObject *pLVar6;
	ResourceData *resData;
	LevelSurfaceMap *pLVar7;
	int *piVar8;
	uint uVar9;
	ObjectType *pOVar10;
	float in_x;
	float in_y;
	uint *out_x;
	Vector3F *out_x_00;
	uint *out_y;
	float *out_y_00;
	ObjectType local_2c;
	int local_28;
	ResourceData *local_24;
	uint local_20;
	uint local_1c;
	Vector3F local_18;
	Vector3F local_c;
	
	liveObj = in_liveObj;
	local_28 = 0;
	BVar1 = FUN_00438870(in_liveObj,0);
	if ((((BVar1 != 0) && (lego::globals::g_Game.objTeleportQueue_COUNT != 0)) &&
			((liveObj->object_3cc == NULL ||
			 ((liveObj->object_3cc->flags1_3e0 & 0x200000) == LIVEOBJ1_NONE)))) &&
		 ((*(byte *)&liveObj->flags4_3ec & 0xc0) == 0)) {
		uVar9 = 0;
		iVar4 = 0;
		if (lego::globals::g_Game.objTeleportQueue_COUNT != 0) {
			pOVar10 = lego::globals::g_Game.objTeleportQueueTypes_TABLE;
			do {
				OVar2 = lego::game::Object_GetStatsFlags2(*pOVar10,pOVar10[0x14]);
				if (((((OVar2 & STATS2_USESMALLTELEPORTER) != STATS2_NONE) &&
						 (OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj),
						 (OVar3 & STATS1_SMALLTELEPORTER) != STATS1_NONE)) ||
						(((OVar2 = lego::game::Object_GetStatsFlags2(*pOVar10,pOVar10[0x14]),
							(OVar2 & STATS2_USEBIGTELEPORTER) != STATS2_NONE &&
							(OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj),
							(OVar3 & STATS1_BIGTELEPORTER) != STATS1_NONE)) ||
						 ((OVar2 = lego::game::Object_GetStatsFlags2(*pOVar10,pOVar10[0x14]),
							(OVar2 & STATS2_USEWATERTELEPORTER) != STATS2_NONE &&
							(OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj),
							(OVar3 & STATS1_WATERTELEPORTER) != STATS1_NONE)))))) ||
					 ((OVar2 = lego::game::Object_GetStatsFlags2(*pOVar10,pOVar10[0x14]),
						(OVar2 & STATS2_USELEGOMANTELEPORTER) != STATS2_NONE &&
						(OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj),
						(OVar3 & STATS1_MANTELEPORTER) != STATS1_NONE)))) {
					iVar4 = lego::game::Object_GetCostCrystal(*pOVar10,pOVar10[0x14],0);
					iVar5 = lego::game::Level_GetCrystalCount(0);
					if (iVar4 <= iVar5) {
						lego::game::Game_GetObjectByName("Barracks",&local_2c,(int *)&in_liveObj,NULL);
						BVar1 = FUN_0043c4c0(*pOVar10,pOVar10[0x14],local_2c,(int)in_liveObj);
						if (BVar1 != 0) {
							iVar4 = 1;
							break;
						}
					}
				}
				uVar9 += 1;
				pOVar10 = pOVar10 + 1;
				iVar4 = local_28;
			} while (uVar9 < lego::globals::g_Game.objTeleportQueue_COUNT);
		}
		if (iVar4 != 0) {
			lego::game::game_getResourceCount_FUN_0042eca0
								(lego::globals::g_Game.objTeleportQueueTypes_TABLE[uVar9],
								 lego::globals::g_Game.objTeleportQueueIndexes_TABLE[uVar9],(int *)&local_24);
			pLVar6 = lego::game::Game_CreateLiveResourceObject
												 (local_24,lego::globals::g_Game.objTeleportQueueTypes_TABLE[uVar9],
													lego::globals::g_Game.objTeleportQueueIndexes_TABLE[uVar9],0,0.0,0.0,0.0);
			liveObj->object_3cc = pLVar6;
			iVar4 = lego::game::Object_GetCostCrystal
												(lego::globals::g_Game.objTeleportQueueTypes_TABLE[uVar9],
												 lego::globals::g_Game.objTeleportQueueIndexes_TABLE[uVar9],0);
			lego::game::Level_SubtractCrystals(iVar4);
			FUN_00439c50();
			OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj);
			if ((OVar3 & STATS1_WATERTELEPORTER) == STATS1_NONE) {
				OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj->object_3cc);
				if ((OVar3 & STATS1_CANBEDRIVEN) != STATS1_NONE) {
					liveObj->object_3cc->flags4_3ec = liveObj->object_3cc->flags4_3ec | 0x80;
					liveObj->flags4_3ec = liveObj->flags4_3ec | 0x80;
					liveObj->object_3cc->object_2fc = liveObj;
				}
			}
			else {
				liveObj->object_3cc->flags4_3ec = liveObj->object_3cc->flags4_3ec | 0x40;
				liveObj->flags4_3ec = liveObj->flags4_3ec | 0x40;
				liveObj->object_3cc->object_2fc = liveObj;
			}
			resData = lego::res::Building_GetDepositNull(liveObj->building);
			lego::res::Res_GetPosition(resData,NULL,&local_18);
			lego::res::Res_GetOrientation(resData,NULL,&local_c,NULL);
			if ((lego::globals::g_Game.objTeleportQueueTypes_TABLE[uVar9] == OBJECT_VEHICLE) &&
				 (OVar2 = lego::game::Object_GetStatsFlags2
														(OBJECT_VEHICLE,
														 lego::globals::g_Game.objTeleportQueueIndexes_TABLE[uVar9]),
				 (OVar2 & STATS2_USESMALLTELEPORTER) != STATS2_NONE)) {
				out_y = &local_1c;
				out_x = &local_20;
				in_x = local_18.x;
				in_y = local_18.y;
				pLVar7 = lego::game::GetSurfaceMap();
				lego::game::SurfaceMap_ToBlockCoordinatesNoZ(pLVar7,in_x,in_y,(int *)out_x,(int *)out_y);
				out_y_00 = &local_18.y;
				out_x_00 = &local_18;
				pLVar7 = lego::game::GetSurfaceMap();
				FUN_0044f900(pLVar7,local_20,local_1c,(float *)out_x_00,out_y_00);
			}
			FUN_00442b60(liveObj->object_3cc,local_18.x,local_18.y,0,0);
			FUN_004425c0(liveObj->object_3cc,0,&local_c);
			lego::game::LiveObject_RecallMiniFigure(liveObj->object_3cc);
			liveObj->object_3cc->flags1_3e0 = liveObj->object_3cc->flags1_3e0 | 0x200000;
			lego::game::LiveObject_SetActivityUnk(liveObj->object_3cc,ACTIVITY_TELEPORTIN,1);
			lego::game::Game_UpdateSomeAITasks(liveObj->object_3cc);
			if (liveObj->object_3cc->objType == OBJECT_VEHICLE) {
				FUN_0046d280(liveObj->object_3cc->vehicle,1);
			}
			lego::globals::g_Game.objTeleportQueue_COUNT -= 1;
			if (uVar9 < lego::globals::g_Game.objTeleportQueue_COUNT) {
				piVar8 = lego::globals::g_Game.objTeleportQueueIndexes_TABLE + uVar9 + 1;
				do {
					uVar9 += 1;
					piVar8[-0x15] = piVar8[-0x14];
					piVar8[-1] = *piVar8;
					piVar8 = piVar8 + 1;
				} while (uVar9 < lego::globals::g_Game.objTeleportQueue_COUNT);
			}
		}
	}
	return;
}



void __cdecl FUN_0043f820(LiveObject *liveObj)
{
	FUN_00437a70(FUN_0043f840,liveObj);
	return;
}



BOOL __cdecl FUN_0043f840(int param_1,LiveObject *param_2)
{
	if (*(LiveObject **)(param_1 + 0x3cc) == param_2) {
		*(undefined4 *)(param_1 + 0x3cc) = 0;
		return 1;
	}
	return 0;
}



void __cdecl
lego::game::LiveObject_TrainMiniFigure_instantunk(LiveObject *liveObj,TrainedFlags trainFlags)
{
	if (liveObj->objType == OBJECT_MINIFIGURE) {
		liveObj->flags5_3f0 = liveObj->flags5_3f0 | trainFlags;
		globals::nerps::g_NERPs_TrainFlags |= trainFlags;
		if ((trainFlags & TRAINED_PILOT) != TRAINED_NONE) {
			Info_FUN_00419ab0(INFO_TRAINPILOT,NULL,liveObj,NULL);
			liveObj->elapsedTime1 = 0.0;
			return;
		}
		if ((trainFlags & TRAINED_SAILOR) != TRAINED_NONE) {
			Info_FUN_00419ab0(INFO_TRAINSAILOR,NULL,liveObj,NULL);
			liveObj->elapsedTime1 = 0.0;
			return;
		}
		if ((trainFlags & TRAINED_DRIVER) != TRAINED_NONE) {
			Info_FUN_00419ab0(INFO_TRAINDRIVER,NULL,liveObj,NULL);
			liveObj->elapsedTime1 = 0.0;
			return;
		}
		if ((trainFlags & TRAINED_DYNAMITE) != TRAINED_NONE) {
			Info_FUN_00419ab0(INFO_TRAINDYNAMITE,NULL,liveObj,NULL);
			liveObj->elapsedTime1 = 0.0;
			return;
		}
		if ((trainFlags & TRAINED_REPAIR) != TRAINED_NONE) {
			Info_FUN_00419ab0(INFO_TRAINREPAIR,NULL,liveObj,NULL);
			liveObj->elapsedTime1 = 0.0;
			return;
		}
		if ((trainFlags & TRAINED_SCANNER) != TRAINED_NONE) {
			Info_FUN_00419ab0(INFO_TRAINSCANNER,NULL,liveObj,NULL);
		}
		liveObj->elapsedTime1 = 0.0;
	}
	return;
}



void __cdecl FUN_0043f960(LiveObject *liveObj,float param_2,BOOL param_3,float param_4)
{
	BOOL BVar1;
	ObjectStatsFlags2 OVar2;
	float10 fVar3;
	longlong lVar4;
	longlong lVar5;
	
	BVar1 = FUN_00438870(liveObj,1);
	if ((BVar1 != 0) && (liveObj->carryingThisObject == NULL)) {
		if ((liveObj->objType == OBJECT_BUILDING) &&
			 ((param_2 != 0.0 && ((undefined *)liveObj->health == &DAT_42c80000)))) {
			FUN_00402e60(liveObj,0);
		}
		BVar1 = FUN_004439b0(liveObj);
		if (BVar1 != 0) {
			fVar3 = lego::game::LiveObject_GetHealthDecayRate(liveObj);
			lVar4 = __ftol(fVar3 * (float10)0.04 * (float10)param_4 * (float10)10010.0);
			lVar5 = __ftol((float10)param_2 * (float10)10000.0);
			if ((uint)lVar4 < (uint)lVar5) {
				lego::nerps::NERPs_AddToFloat_00556330(param_2);
			}
		}
		if (liveObj->objType == OBJECT_MINIFIGURE) {
			lego::nerps::NERPs_AddToFloat_00556120(param_2);
		}
		liveObj->health = liveObj->health - param_2;
		if ((param_3 != 0) &&
			 ((ushort)((ushort)(param_2 < 0.0) << 8 | (ushort)(param_2 == 0.0) << 0xe) == 0)) {
			liveObj->flags2_3e4 = liveObj->flags2_3e4 | 0x3000;
			liveObj->field_3d0 = param_2 + (float)liveObj->field_3d0;
			FUN_00407470(liveObj);
		}
		OVar2 = lego::game::LiveObject_GetStatsFlags2(liveObj);
		if (((OVar2 & STATS2_DAMAGECAUSESCALLTOARMS) != STATS2_NONE) &&
			 ((ushort)((ushort)(param_2 < 0.0) << 8 | (ushort)(param_2 == 0.0) << 0xe) == 0)) {
			lego::game::Game_SetCallToArmsOn(1);
		}
	}
	return;
}



void __cdecl FUN_0043fa90(LiveObject *in_liveObj,float param_2)
{
	LiveObject *liveObj;
	ObjectStatsFlags2 OVar1;
	LiveObject *liveObj_00;
	uint uVar2;
	int *piVar3;
	float10 fVar4;
	longlong lVar5;
	BOOL BVar6;
	float fVar7;
	float local_44;
	void *local_40;
	undefined local_3c [4];
	int local_38;
	int local_34;
	int local_30;
	int local_2c;
	int local_28;
	int local_24;
	int local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	liveObj = in_liveObj;
	local_44 = 0.0;
	if ((in_liveObj->objType != OBJECT_UPGRADEPART) && (in_liveObj->objType != OBJECT_BOULDER)) {
		if ((ushort)((ushort)(in_liveObj->health < 0.0) << 8 |
								(ushort)(in_liveObj->health == 0.0) << 0xe) == 0) {
			if ((in_liveObj->flags3_3e8 & 0x80000000) == LIVEOBJ3_NONE) {
				BVar6 = 0;
				fVar7 = param_2;
				fVar4 = lego::game::LiveObject_GetHealthDecayRate(in_liveObj);
				FUN_0043f960(liveObj,(float)(fVar4 * (float10)0.04 * (float10)param_2),BVar6,fVar7);
			}
		}
		else {
			in_liveObj->health = 0.0;
		}
		uVar2 = 0;
		if ((ushort)((ushort)(liveObj->energy < 0.0) << 8 | (ushort)(liveObj->energy == 0.0) << 0xe) ==
				0) {
			if ((liveObj->flags3_3e8 & 0x80000000) == LIVEOBJ3_NONE) {
				fVar4 = lego::game::LiveObject_GetEnergyDecayRate(liveObj);
				liveObj->energy =
						 (float)((float10)liveObj->energy - fVar4 * (float10)0.04 * (float10)param_2);
			}
		}
		else {
			liveObj->energy = 0.0;
		}
		lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_38,&local_34);
		if (((liveObj->carryingThisObject == NULL) &&
				((lego::globals::g_Game.level)->blocks
				 [((lego::globals::g_Game.level)->dimensions).width * local_34 + local_38].terrain ==
				 TERRAIN_LAVA)) &&
			 ((liveObj->objType == OBJECT_ORE || (liveObj->objType == OBJECT_POWERCRYSTAL)))) {
			FUN_0041f850(1);
			liveObj->health = -1.0;
			liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x800000;
		}
		fVar7 = param_2;
		BVar6 = FUN_004330b0(liveObj,local_38,local_34,param_2,&local_44);
		if (BVar6 != 0) {
			FUN_0043f960(liveObj,local_44,1,fVar7);
		}
		OVar1 = lego::game::LiveObject_GetStatsFlags2(liveObj);
		if ((((OVar1 & STATS2_CANBEHITBYFENCE) != STATS2_NONE) &&
				((liveObj->flags1_3e0 & 0x100100) == LIVEOBJ1_NONE)) &&
			 ((liveObj->flags2_3e4 & 0x8000000) == LIVEOBJ2_NONE)) {
			FUN_0040dd70((int **)liveObj);
		}
		if (((((lego::globals::g_Game.flags2 & GAME2_NOAUTOEAT) == GAME2_NONE) &&
				 (liveObj->objType == OBJECT_MINIFIGURE)) &&
				(((liveObj->energy < liveObj->health * 0.01 * lego::globals::g_Game.MinEnergyForEat &&
					(((ushort)((ushort)(liveObj->activityElapsedTime < 125.0) << 8 |
										(ushort)(liveObj->activityElapsedTime == 125.0) << 0xe) == 0 &&
					 (liveObj->activityElapsedTime = 0.0, liveObj->drivenObject == NULL)))) &&
				 (BVar6 = lego::game::LiveObject_IsCurrentTaskType(liveObj,AITASK_GOTOEAT), BVar6 == 0))))
			 && (liveObj_00 = (LiveObject *)FUN_00438f20(liveObj), liveObj_00 != NULL)) {
			local_20[1] = 0xffffffff;
			local_8 = 0xffffffff;
			local_20[0] = 0;
			local_20[2] = 1;
			local_20[3] = 0;
			local_20[4] = 0;
			local_c = 1;
			local_4 = 0;
			lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_28,&local_24);
			lego::game::LiveObject_GetBlockCoordinates(liveObj_00,&local_30,&local_2c);
			piVar3 = local_20;
			do {
				BVar6 = FUN_004413b0(liveObj,local_28,local_24,local_30 + *piVar3,piVar3[1] + local_2c,
														 &in_liveObj,&local_40,local_3c,0,0);
				if (BVar6 != 0) {
					std::free(in_liveObj);
					std::free(local_40);
					FUN_00402ea0(liveObj,liveObj_00);
					break;
				}
				uVar2 += 1;
				piVar3 = piVar3 + 2;
			} while (uVar2 < 4);
		}
		if ((ushort)((ushort)(liveObj->energy < liveObj->health) << 8 |
								(ushort)(liveObj->energy == liveObj->health) << 0xe) == 0) {
			liveObj->energy = liveObj->health;
		}
		FUN_0043fe00((int *)liveObj,param_2,local_44);
		if (((liveObj->flags2_3e4 & 0x2000) != LIVEOBJ2_NONE) &&
			 ((liveObj->flags2_3e4 & 0x1000) == LIVEOBJ2_NONE)) {
			lVar5 = __ftol((float10)(float)liveObj->field_3d0);
			FUN_0040a3e0((int *)liveObj,(uint)lVar5);
			liveObj->field_3d0 = 0;
			liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xffffdfff;
		}
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xffffefff;
	}
	return;
}



undefined4 __cdecl FUN_0043fe00(int *param_1,float param_2,float param_3)
{
	float fVar1;
	float fVar2;
	int *liveObj;
	BOOL BVar3;
	ResourceData *resData;
	float10 fVar4;
	int *sampleIndex;
	BOOL flag4;
	Vector3F *opt_position;
	
	liveObj = param_1;
	if ((*param_1 == 2) && (param_3 != 0.0)) {
		BVar3 = lego::snd::Snd_GetSFX("SND_Hurt",(int *)&param_1);
		if (BVar3 != 0) {
			if ((float)liveObj[0xff] == 0.0) {
				opt_position = NULL;
				flag4 = 1;
				BVar3 = 0;
				sampleIndex = param_1;
				resData = lego::game::LiveObject_GetResource((LiveObject *)liveObj);
				lego::res::Res_PlayResourceSound(resData,(int)sampleIndex,BVar3,flag4,opt_position);
				liveObj[0xff] = (int)(param_2 + (float)liveObj[0xff]);
				fVar4 = lego::snd::Sample_GetRandomDuration((int)param_1);
				liveObj[0x100] = (int)(float)fVar4;
			}
			else {
				fVar1 = (float)liveObj[0xff] - param_2 * -0.04;
				fVar2 = (float)liveObj[0x100] + (float)liveObj[0x100];
				liveObj[0xff] = (int)fVar1;
				if ((ushort)((ushort)(fVar1 < fVar2) << 8 | (ushort)(fVar1 == fVar2) << 0xe) == 0) {
					liveObj[0xff] = 0;
					liveObj[0x100] = 0;
					return 1;
				}
			}
		}
	}
	return 1;
}



undefined4 __cdecl FUN_0043fee0(uint *param_1)
{
	LiveObject *liveObj;
	ResourceData *pRVar1;
	LevelSurfaceMap *surfaceMap;
	BOOL BVar2;
	int iVar3;
	ResourceData *resData;
	float in_x;
	float in_y;
	int *out_x;
	int *out_y;
	int local_2c;
	int local_28;
	Vector3F local_24;
	Vector3F local_18;
	Vector3F local_c;
	
	liveObj = (LiveObject *)param_1[0xc1];
	if (liveObj != NULL) {
		pRVar1 = lego::game::LiveObject_GetDepositNull(liveObj);
		if (pRVar1 != NULL) {
			lego::res::Res_GetPosition(pRVar1,NULL,&local_24);
			out_y = &local_28;
			out_x = &local_2c;
			in_x = local_24.x;
			in_y = local_24.y;
			surfaceMap = lego::game::GetSurfaceMap();
			BVar2 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ(surfaceMap,in_x,in_y,out_x,out_y);
			if (BVar2 != 0) {
				iVar3 = FUN_00431cd0((LiveObject *)param_1,local_2c,local_28,local_2c,local_28,0);
				if (iVar3 != 0) {
					pRVar1 = lego::game::LiveObject_GetResource((LiveObject *)param_1);
					if (pRVar1 != NULL) {
						resData = lego::game::LiveObject_GetResource(liveObj);
						if (resData != NULL) {
							param_1[0xc1] = 0;
							liveObj->carriedObjects[0] = NULL;
							liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_CARRYING;
							liveObj->numCarriedObjects = 0;
							lego::res::Res_GetPosition(resData,NULL,&local_24);
							lego::res::Res_GetOrientation(resData,NULL,&local_c,&local_18);
							lego::res::Res_SetFramePosition(pRVar1,NULL,local_24.x,local_24.y,local_24.z);
							lego::res::Res_SetFrameOrientation
												(pRVar1,NULL,local_c.x,local_c.y,local_c.z,local_18.x,local_18.y,local_18.z)
							;
							FUN_00437690((uint *)liveObj,1);
							FUN_00403e60(liveObj);
							lego::game::LiveObject_SetActivityUnk((LiveObject *)param_1,ACTIVITY_FLOATOFF,0);
							lego::game::Game_UpdateSomeAITasks((LiveObject *)param_1);
							FUN_00403e60((LiveObject *)param_1);
							param_1[0xbf] = (uint)liveObj;
							param_1[0xfb] = param_1[0xfb] | 0x8000;
							return 1;
						}
					}
				}
			}
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00440080(int *param_1)
{
	ObjectStatsFlags3 OVar1;
	ResourceData *resData;
	LevelSurfaceMap *surfaceMap;
	BOOL BVar2;
	int iVar3;
	int *out_x;
	int *out_y;
	int local_14;
	int local_10;
	Vector3F local_c;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags3((LiveObject *)param_1);
	if (((((OVar1 & STATS3_CARRYVEHICLES) != STATS3_NONE) && ((param_1[0xf8] & 0x400U) != 0)) &&
			((int *)param_1[0xc2] != NULL)) && (*(int *)param_1[0xc2] == 1)) {
		resData = lego::game::LiveObject_GetDepositNull((LiveObject *)param_1);
		if (resData != NULL) {
			lego::res::Res_GetPosition(resData,NULL,&local_c);
			out_y = &local_10;
			out_x = &local_14;
			surfaceMap = lego::game::GetSurfaceMap();
			BVar2 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
												(surfaceMap,local_c.x,local_c.y,out_x,out_y);
			if (BVar2 != 0) {
				iVar3 = FUN_00431cd0((LiveObject *)param_1[0xc2],local_14,local_10,local_14,local_10,1);
				if (iVar3 != 0) {
					return 1;
				}
			}
		}
	}
	return 0;
}



int __cdecl FUN_00440130(int *param_1,float *param_2)
{
	int *liveObj;
	float *liveObj_00;
	ObjectStatsFlags3 OVar1;
	ResourceData *resData;
	LevelSurfaceMap *surfaceMap;
	BOOL BVar2;
	BOOL BVar3;
	float *out_x;
	float *out_y;
	uint local_20;
	float local_1c;
	float local_18;
	float local_14;
	float local_10;
	Vector3F local_c;
	
	liveObj = param_1;
	BVar3 = 0;
	OVar1 = lego::game::LiveObject_GetStatsFlags3((LiveObject *)param_1);
	liveObj_00 = param_2;
	if ((OVar1 & STATS3_VEHICLECANBECARRIED) != STATS3_NONE) {
		OVar1 = lego::game::LiveObject_GetStatsFlags3((LiveObject *)param_2);
		if (((OVar1 & STATS3_CARRYVEHICLES) != STATS3_NONE) && (liveObj[0xc1] == 0)) {
			lego::game::LiveObject_GetBlockCoordinates
								((LiveObject *)liveObj,(int *)&local_14,(int *)&local_10);
			resData = lego::game::LiveObject_GetDepositNull((LiveObject *)liveObj_00);
			if (resData != NULL) {
				lego::res::Res_GetPosition(resData,NULL,&local_c);
				out_y = &local_18;
				out_x = &local_1c;
				surfaceMap = lego::game::GetSurfaceMap();
				BVar2 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
													(surfaceMap,local_c.x,local_c.y,(int *)out_x,(int *)out_y);
				if (BVar2 != 0) {
					if ((local_1c == local_14) && (local_18 == local_10)) {
						BVar3 = FUN_004419c0((LiveObject *)liveObj,1,&local_1c,&local_18,(float *)&local_c);
					}
					else {
						BVar3 = FUN_004413b0(liveObj,local_14,local_10,local_1c,local_18,&param_1,&param_2,
																 &local_20,0,0);
						if (BVar3 == 0) {
							return 0;
						}
						BVar3 = FUN_004419c0((LiveObject *)liveObj,local_20,(float *)param_1,param_2,
																 (float *)&local_c);
						std::free(param_1);
						std::free(param_2);
					}
					if (BVar3 != 0) {
						liveObj[0xbf] = (int)liveObj_00;
						*(undefined *)(liveObj[9] + -3 + liveObj[10] * 0x14) = 0x15;
						FUN_00437690((uint *)liveObj_00,1);
						return 1;
					}
				}
			}
		}
	}
	return BVar3;
}



undefined4 __cdecl FUN_004402b0(int *param_1)
{
	int *liveObj;
	LiveObject *liveObj_00;
	ResourceData *resData;
	LevelSurfaceMap *surfaceMap;
	BOOL BVar1;
	float *out_x;
	float *out_y;
	float *local_24;
	uint local_20;
	float local_1c;
	float local_18;
	float local_14;
	float local_10;
	Vector3F local_c;
	
	liveObj = param_1;
	lego::game::LiveObject_GetBlockCoordinates
						((LiveObject *)param_1,(int *)&local_14,(int *)&local_10);
	liveObj_00 = (LiveObject *)FUN_00438ca0((LiveObject *)liveObj,1);
	if ((liveObj_00 != NULL) &&
		 (resData = lego::game::LiveObject_GetDepositNull(liveObj_00), resData != NULL)) {
		lego::res::Res_GetPosition(resData,NULL,&local_c);
		out_y = &local_18;
		out_x = &local_1c;
		surfaceMap = lego::game::GetSurfaceMap();
		BVar1 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
											(surfaceMap,local_c.x,local_c.y,(int *)out_x,(int *)out_y);
		if (BVar1 != 0) {
			if ((local_1c == local_14) && (local_18 == local_10)) {
				BVar1 = FUN_004419c0((LiveObject *)liveObj,1,&local_1c,&local_18,(float *)&local_c);
			}
			else {
				BVar1 = FUN_004413b0(liveObj,local_14,local_10,local_1c,local_18,&param_1,&local_24,
														 &local_20,0,0);
				if (BVar1 == 0) {
					return 0;
				}
				BVar1 = FUN_004419c0((LiveObject *)liveObj,local_20,(float *)param_1,local_24,
														 (float *)&local_c);
				std::free(param_1);
				std::free(local_24);
			}
			if (BVar1 != 0) {
				liveObj[0xbf] = (int)liveObj_00;
				*(undefined *)(liveObj[9] + -3 + liveObj[10] * 0x14) = 0x13;
				return 1;
			}
		}
	}
	return 0;
}



void __cdecl FUN_004403f0(int param_1,int *param_2)
{
	LiveObject *liveObj;
	uint uVar1;
	LiveObject **ppLVar2;
	int local_8;
	int local_4;
	
	uVar1 = 0;
	if (UINT_004ebd5c != 0) {
		ppLVar2 = PTR_ARRAY_004ebbcc;
		do {
			liveObj = *ppLVar2;
			if (((liveObj != NULL) &&
					(lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_8,&local_4),
					local_8 == *param_2)) && (local_4 == param_2[1])) {
				liveObj->object_2fc = (LiveObject *)param_1;
				FUN_00444360(liveObj);
				*ppLVar2 = NULL;
			}
			uVar1 += 1;
			ppLVar2 = ppLVar2 + 1;
		} while (uVar1 < UINT_004ebd5c);
	}
	return;
}



BOOL __cdecl FUN_00440470(LiveObject *in_liveObj,int param_2)
{
	LiveObject *liveObj;
	LiveObject *pLVar1;
	ObjectStatsFlags1 OVar2;
	ResourceData *pRVar3;
	ResourceData *resData1;
	LevelSurfaceMap *pLVar4;
	BOOL BVar5;
	int iVar6;
	float10 fVar7;
	float fVar8;
	float fVar9;
	int *out_x;
	Vector3F *out_x_00;
	int *out_y;
	float *out_y_00;
	int local_28;
	int local_24;
	uint local_20;
	uint local_1c;
	Vector3F local_18;
	Vector3F local_c;
	
	liveObj = in_liveObj->drivenObject;
	OVar2 = lego::game::LiveObject_GetStatsFlags1(in_liveObj);
	if ((OVar2 & STATS1_CANBEDRIVEN) == STATS1_NONE) {
		return 0;
	}
	if (liveObj == NULL) {
		return 0;
	}
	if ((*(byte *)&liveObj->flags1_3e0 & 1) != 0) {
		return 0;
	}
	pRVar3 = lego::game::LiveObject_GetDepositNull(in_liveObj);
	resData1 = lego::game::LiveObject_GetResource(liveObj);
	lego::res::Res_GetPosition(pRVar3,NULL,&local_18);
	out_y = &local_24;
	out_x = &local_28;
	fVar8 = local_18.x;
	fVar9 = local_18.y;
	pLVar4 = lego::game::GetSurfaceMap();
	BVar5 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ(pLVar4,fVar8,fVar9,out_x,out_y);
	if (BVar5 == 0) {
		return 0;
	}
	OVar2 = lego::game::LiveObject_GetStatsFlags1(in_liveObj);
	if (((OVar2 & STATS1_CROSSLAND) != STATS1_NONE) &&
		 (iVar6 = FUN_00431cd0(liveObj,local_28,local_24,local_28,local_24,1), iVar6 != 0)) {
LAB_004405c7:
		in_liveObj->drivenObject = NULL;
		liveObj->drivenObject = NULL;
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & ~LIVEOBJ2_DRIVING;
		fVar8 = local_18.x;
		fVar9 = local_18.y;
		pLVar4 = lego::game::GetSurfaceMap();
		fVar7 = lego::game::SurfaceMap_UnkGetZ(pLVar4,fVar8,fVar9);
		lego::res::Res_SetFramePosition(resData1,NULL,local_18.x,local_18.y,(float)fVar7);
		lego::res::Res_SetFrameOrientation(resData1,NULL,local_c.x,local_c.y,0.0,0.0,0.0,-1.0);
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
		liveObj->aitaskName2 = NULL;
		lego::game::Game_UpdateSomeAITasks(liveObj);
		FUN_00452f10(in_liveObj);
		return 1;
	}
	if ((*(byte *)&in_liveObj->flags4_3ec & 0x40) == 0) {
		if ((param_2 == 0) && (iVar6 = FUN_0043a0d0(in_liveObj,&local_20), iVar6 != 0)) {
			out_y_00 = &local_18.y;
			out_x_00 = &local_18;
			pLVar4 = lego::game::GetSurfaceMap();
			FUN_0044f900(pLVar4,local_20,local_1c,(float *)out_x_00,out_y_00);
			goto LAB_004405c7;
		}
		OVar2 = lego::game::LiveObject_GetStatsFlags1(in_liveObj);
		if ((OVar2 & STATS1_CROSSLAND) == STATS1_NONE) {
			FUN_004032f0(in_liveObj);
		}
	}
	else {
		pLVar1 = in_liveObj->object_2fc;
		if (((pLVar1 != NULL) && (pLVar1->objType == OBJECT_BUILDING)) &&
			 (pRVar3 = lego::res::Building_GetEntranceNull(pLVar1->building), pRVar3 != NULL)) {
			lego::res::Res_GetPosition(pRVar3,NULL,&local_18);
			lego::res::Res_GetOrientation(pRVar3,NULL,&local_c,NULL);
			goto LAB_004405c7;
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00440690(int *param_1,float *param_2)
{
	byte *pbVar1;
	int *piVar2;
	int *liveObj;
	float *liveObj_00;
	ObjectStatsFlags1 OVar3;
	LevelSurfaceMap *pLVar4;
	BOOL BVar5;
	int iVar6;
	byte bVar7;
	ResourceData *resData;
	float *pfVar8;
	float *pfVar9;
	uint local_44;
	uint local_40;
	uint local_3c;
	uint local_38;
	float local_34;
	float local_30;
	float local_2c;
	float local_28;
	Vector3F local_24;
	Vector3F local_18;
	float local_c;
	float local_8 [2];
	
	liveObj_00 = param_2;
	liveObj = param_1;
	resData = NULL;
	piVar2 = (int *)param_1[0xbc];
	if (piVar2 != NULL) {
		if (*piVar2 != 0x12) {
			return 0;
		}
		if (piVar2[0x18] != 0) {
			return 0;
		}
	}
	if (param_1[0xdb] != 0) {
		return 0;
	}
	if (param_2[0xdb] != 0.0) {
		return 0;
	}
	if (*param_1 != 2) {
		return 0;
	}
	if (((((param_1[0xfc] & 5U) == 0) ||
			 (OVar3 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_2),
			 (OVar3 & STATS1_CROSSLAND) == STATS1_NONE)) ||
			(OVar3 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)liveObj_00),
			(OVar3 & STATS1_CANBEDRIVEN) == STATS1_NONE)) || ((*(byte *)(liveObj_00 + 0xfb) & 0x40) != 0))
	{
		if ((*(byte *)(liveObj + 0xfc) & 2) != 0) {
			OVar3 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)liveObj_00);
			if ((((OVar3 & STATS1_CANBEDRIVEN) == STATS1_NONE) ||
					((*(byte *)(liveObj_00 + 0xfb) & 0x40) == 0)) ||
				 ((piVar2 = (int *)liveObj_00[0xbf], piVar2 == NULL || (*piVar2 != 4)))) {
				if ((((*(byte *)(liveObj + 0xfc) & 2) != 0) &&
						(OVar3 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)liveObj_00),
						(OVar3 & STATS1_CANBEDRIVEN) != STATS1_NONE)) &&
					 (iVar6 = FUN_0043a100(liveObj_00,NULL), iVar6 != 0)) {
					lego::game::LiveObject_GetBlockCoordinates
										((LiveObject *)liveObj_00,(int *)&local_40,(int *)&local_44);
					BVar5 = FUN_00446c80((LiveObject *)liveObj,local_40,local_44,0,&local_3c,1);
					if (BVar5 != 0) {
						*(undefined4 *)(liveObj[9] + -8 + liveObj[10] * 0x14) = 0x3f000000;
						*(undefined4 *)(liveObj[9] + -0xc + liveObj[10] * 0x14) = 0x3f000000;
						switch(local_3c) {
						case 0:
							*(undefined4 *)(liveObj[9] + -8 + liveObj[10] * 0x14) = 0x3dcccccd;
							break;
						case 1:
							*(undefined4 *)(liveObj[9] + -0xc + liveObj[10] * 0x14) = 0x3dcccccd;
							break;
						case 2:
							*(undefined4 *)(liveObj[9] + -8 + liveObj[10] * 0x14) = 0x3f666666;
							break;
						case 3:
							*(undefined4 *)(liveObj[9] + -0xc + liveObj[10] * 0x14) = 0x3f666666;
						}
						*(byte *)(liveObj[9] + -4 + liveObj[10] * 0x14) =
								 *(byte *)(liveObj[9] + -4 + liveObj[10] * 0x14) | 8;
						*(undefined *)(liveObj[9] + -3 + liveObj[10] * 0x14) = 0xc;
						liveObj[0xbf] = (int)liveObj_00;
						return 1;
					}
				}
			}
			else {
				resData = lego::res::Building_GetEntranceNull((BuildingData *)piVar2[6]);
			}
		}
	}
	else {
		resData = lego::game::LiveObject_GetResource((LiveObject *)liveObj_00);
	}
	if (resData != NULL) {
		lego::res::Res_GetPosition(resData,NULL,&local_18);
		lego::res::Res_GetOrientation(resData,NULL,&local_24,NULL);
		if (ABS(local_24.x) <= ABS(local_24.y)) {
			if ((ushort)((ushort)(local_24.y < 0.0) << 8 | (ushort)(local_24.y == 0.0) << 0xe) == 0) {
				bVar7 = 0;
			}
			else {
				bVar7 = 2;
			}
		}
		else {
			if ((ushort)((ushort)(local_24.x < 0.0) << 8 | (ushort)(local_24.x == 0.0) << 0xe) == 0) {
				bVar7 = 1;
			}
			else {
				bVar7 = 3;
			}
		}
		pfVar9 = &local_30;
		pfVar8 = &local_34;
		pLVar4 = lego::game::GetSurfaceMap();
		lego::game::SurfaceMap_ToBlockCoordinatesNoZ
							(pLVar4,local_18.x,local_18.y,(int *)pfVar8,(int *)pfVar9);
		lego::game::LiveObject_GetPosition((LiveObject *)liveObj,&local_c,local_8);
		pfVar9 = &local_28;
		pfVar8 = &local_2c;
		pLVar4 = lego::game::GetSurfaceMap();
		lego::game::SurfaceMap_ToBlockCoordinatesNoZ
							(pLVar4,local_c,local_8[0],(int *)pfVar8,(int *)pfVar9);
		if ((local_2c == local_34) && (local_28 == local_30)) {
			BVar5 = FUN_004419c0((LiveObject *)liveObj,1,&local_34,&local_30,(float *)&local_18);
		}
		else {
			BVar5 = FUN_004413b0(liveObj,local_2c,local_28,local_34,local_30,&param_1,&param_2,&local_38,0
													 ,0);
			if (BVar5 == 0) {
				return 0;
			}
			BVar5 = FUN_004419c0((LiveObject *)liveObj,local_38,(float *)param_1,param_2,
													 (float *)&local_18);
			std::free(param_1);
			std::free(param_2);
		}
		if (BVar5 != 0) {
			liveObj[0xbf] = (int)liveObj_00;
			*(undefined *)(liveObj[9] + -3 + liveObj[10] * 0x14) = 0xc;
			*(byte *)(liveObj[9] + -4 + liveObj[10] * 0x14) =
					 *(byte *)(liveObj[9] + -4 + liveObj[10] * 0x14) | 4;
			pbVar1 = (byte *)(liveObj[9] + -4 + liveObj[10] * 0x14);
			*pbVar1 = *pbVar1 | bVar7;
			return 1;
		}
	}
	return 0;
}



void __cdecl
FUN_00440a70(undefined4 *param_1,VehicleData *param_2,CreatureData *param_3,CreatureData *param_4)
{
	undefined4 *local_18;
	float local_14;
	float local_10;
	VehicleData *local_c;
	CreatureData *local_8;
	CreatureData *local_4;
	
	local_18 = param_1;
	lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_14,&local_10);
	local_c = param_2;
	local_8 = param_3;
	local_4 = param_4;
	FUN_00437a70(FUN_00440ac0,(LiveObject *)&local_18);
	return;
}



undefined4 __cdecl FUN_00440ac0(LiveObject *param_1,LiveObject **param_2)
{
	float fVar1;
	float local_8;
	float local_4;
	
	if ((param_1 != *param_2) && ((param_1->flags3_3e8 & 0x40000) != LIVEOBJ3_NONE)) {
		lego::game::LiveObject_GetPosition(param_1,&local_8,&local_4);
		fVar1 = SQRT((local_8 - (float)param_2[1]) * (local_8 - (float)param_2[1]) +
								 (local_4 - (float)param_2[2]) * (local_4 - (float)param_2[2]));
		if (fVar1 < (float)param_2[3]) {
			FUN_0043f960(param_1,(1.0 - fVar1 / (float)param_2[3]) * (float)param_2[4],1,1.0);
		}
		if ((param_1->objType == OBJECT_ROCKMONSTER) && (fVar1 < (float)param_2[5])) {
			FUN_00443ab0(param_1);
		}
	}
	return 0;
}



void __cdecl FUN_00440b80(undefined4 *param_1,undefined4 *param_2,VehicleData *param_3)
{
	undefined4 *local_18;
	float local_14;
	char *local_10;
	VehicleData *local_c;
	
	local_18 = param_1;
	if (param_2 == NULL) {
		lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_14,(float *)&local_10);
	}
	else {
		local_14 = (float)*param_2;
		local_10 = (char *)param_2[1];
	}
	local_c = param_3;
	FUN_00437a70(FUN_00440be0,(LiveObject *)&local_18);
	return;
}



undefined4 __cdecl FUN_00440be0(LiveObject *param_1,LiveObject **param_2)
{
	float fVar1;
	ObjectStatsFlags2 OVar2;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	if (param_1 != *param_2) {
		OVar2 = lego::game::LiveObject_GetStatsFlags2(param_1);
		if ((OVar2 & STATS2_SCAREDBYBIGBANGS) != STATS2_NONE) {
			lego::game::LiveObject_GetPosition(param_1,&local_8,&local_4);
			local_10 = local_8 - (float)param_2[1];
			local_c = local_4 - (float)param_2[2];
			fVar1 = SQRT(local_c * local_c + local_10 * local_10);
			if (fVar1 < (float)param_2[3]) {
				if (param_1->objType == OBJECT_ROCKMONSTER) {
					FUN_00443ab0(param_1);
				}
				fVar1 = 1.0 / fVar1;
				local_10 = fVar1 * local_10;
				local_c = fVar1 * local_c;
				FUN_00444720(param_1,&local_10);
			}
		}
	}
	return 0;
}



void __cdecl
lego::game::LiveObject_SetActivityUnk(LiveObject *liveObj,ActivityType actType,BOOL actData)
{
	liveObj->aitaskName1 = globals::g_Activities_TABLE[actType];
	liveObj->unkbool_2d8 = actData;
	liveObj->float_2d4 = 0.0;
	return;
}



void __cdecl lego::game::LiveObject_UpdateCarrying(LiveObject *in_liveObj)
{
	LiveObject *liveObj;
	ObjectType OVar1;
	float fVar2;
	float fVar3;
	LiveObject *pLVar4;
	int iVar5;
	ResourceData *resData;
	VehicleData *vehicle;
	LiveObject **local_14;
	uint local_10;
	Vector3F local_c;
	
	local_10 = 0;
	if (in_liveObj->numCarriedObjects != 0) {
		local_14 = in_liveObj->carriedObjects;
		pLVar4 = in_liveObj;
		do {
			liveObj = *local_14;
			if ((liveObj->flags3_3e8 & 0x2000) == LIVEOBJ3_NONE) {
				OVar1 = in_liveObj->objType;
				if (OVar1 == OBJECT_ROCKMONSTER) {
					pLVar4 = (LiveObject *)res::Creature_GetCarryNull(in_liveObj->rockMonster);
				}
				else {
					if (OVar1 == OBJECT_MINIFIGURE) {
						pLVar4 = in_liveObj->drivenObject;
						if ((pLVar4 == NULL) || (pLVar4->objType != OBJECT_VEHICLE)) {
							pLVar4 = (LiveObject *)res::Creature_GetCarryNull(in_liveObj->miniFigure);
						}
						else {
							iVar5 = LiveObject_GetCarryStart(pLVar4);
							vehicle = in_liveObj->drivenObject->vehicle;
LAB_00440d93:
							pLVar4 = (LiveObject *)res::Vehicle_GetCarryNull(vehicle,iVar5);
						}
					}
					else {
						if (OVar1 == OBJECT_BUILDING) {
							pLVar4 = (LiveObject *)
											 res::Building_GetCarryNull
																 (in_liveObj->building,(int)liveObj->carriedObjects[6]);
						}
						else {
							if (OVar1 == OBJECT_VEHICLE) {
								iVar5 = LiveObject_GetCarryStart(in_liveObj);
								vehicle = in_liveObj->vehicle;
								iVar5 = (int)liveObj->carriedObjects[6]->floats_34 + iVar5 + -0x34;
								goto LAB_00440d93;
							}
						}
					}
				}
				if (pLVar4 != NULL) {
					resData = LiveObject_GetResource(liveObj);
					res::Res_GetPosition(resData,NULL,&liveObj->vector_2a0);
					res::Res_SetFramePosition(resData,(ResourceData *)pLVar4,0.0,0.0,0.0);
					res::Res_SetFrameOrientation(resData,(ResourceData *)pLVar4,0.0,0.0,1.0,0.0,1.0,0.0);
					res::Res_GetPosition(resData,NULL,&local_c);
					local_c.x = local_c.x - (liveObj->vector_2a0).x;
					local_c.y = local_c.y - (liveObj->vector_2a0).y;
					local_c.z = local_c.z - (liveObj->vector_2a0).z;
					fVar2 = SQRT(local_c.z * local_c.z + local_c.y * local_c.y + local_c.x * local_c.x);
					fVar3 = 1.0 / fVar2;
					liveObj->float_2b8 = fVar2;
					(liveObj->faceDirection).x = fVar3 * local_c.x;
					(liveObj->faceDirection).y = fVar3 * local_c.y;
					(liveObj->faceDirection).z = fVar3 * local_c.z;
				}
			}
			local_10 += 1;
			local_14 = local_14 + 1;
		} while (local_10 < in_liveObj->numCarriedObjects);
	}
	return;
}



void __cdecl FUN_00440eb0(LiveObject *liveObj,undefined **param_2)
{
	uint uVar1;
	uint uVar2;
	
	if (liveObj->objType == OBJECT_BOULDER) {
		uVar1 = lego::res::Res_GetMeshGroupCount(liveObj->other);
		uVar2 = 0;
		if (uVar1 != 0) {
			do {
				FUN_00475060(liveObj->other,uVar2,param_2);
				uVar2 += 1;
			} while (uVar2 < uVar1);
		}
	}
	return;
}



void FUN_00440ef0(undefined4 param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
								 undefined4 param_5,undefined4 param_6,undefined4 param_7,undefined4 param_8)
{
	FUN_004413b0(param_1,param_2,param_3,param_4,param_5,param_6,param_7,param_8,0,0);
	return;
}



BOOL __cdecl
FUN_00440f30(int *param_1,uint param_2,uint param_3,uint param_4,uint param_5,uint **param_6,
						uint **param_7,uint *param_8,undefined *param_9,undefined4 param_10)
{
	uint uVar1;
	uint uVar2;
	uint uVar3;
	LevelSurfaceMap *pLVar4;
	int iVar5;
	int iVar6;
	uint uVar7;
	uint *puVar8;
	uint *puVar9;
	int iVar10;
	void *pvVar11;
	uint uVar12;
	uint uVar13;
	undefined4 *puVar14;
	uint uVar15;
	uint *local_ff0;
	uint local_fec;
	uint *local_fe8;
	uint local_fe4;
	uint local_fe0;
	uint local_fdc;
	uint local_fd0 [4];
	uint local_fc0 [9];
	uint local_f9c;
	
	local_fc0[0] = 0;
	local_fc0[1] = 0xffffffff;
	local_fc0[2] = 1;
	local_fc0[3] = 0;
	local_fc0[4] = 0;
	local_fc0[5] = 1;
	local_fc0[6] = 0xffffffff;
	local_fc0[7] = 0;
	local_fec = 0;
	pLVar4 = lego::game::GetSurfaceMap();
	uVar1 = (pLVar4->smallDimensions).width;
	uVar2 = (pLVar4->smallDimensions).height;
	if (uVar1 <= param_2) {
		return 0;
	}
	if (uVar2 <= param_3) {
		return 0;
	}
	if (param_9 == NULL) {
		if (uVar1 <= param_4) {
			return 0;
		}
		if (uVar2 <= param_5) {
			return 0;
		}
		iVar5 = FUN_00431cd0((LiveObject *)param_1,param_4,param_5,param_4,param_5,0);
		if (iVar5 == 0) {
			return 0;
		}
	}
	if (lego::globals::g_UnkSurfaceGrid_2_TABLE != NULL) {
		if (lego::globals::g_UnkSurfaceGrid_COUNT == uVar2 * uVar1) goto LAB_00441021;
		if (lego::globals::g_UnkSurfaceGrid_2_TABLE != NULL) {
			std::free(lego::globals::g_UnkSurfaceGrid_2_TABLE);
		}
	}
	lego::globals::g_UnkSurfaceGrid_COUNT = uVar2 * uVar1;
	lego::globals::g_UnkSurfaceGrid_2_TABLE = std::malloc(lego::globals::g_UnkSurfaceGrid_COUNT * 4);
LAB_00441021:
	iVar5 = uVar2 * uVar1;
	puVar14 = (undefined4 *)lego::globals::g_UnkSurfaceGrid_2_TABLE;
	if (lego::globals::g_UnkSurfaceGrid_2_TABLE != NULL) {
		for (; iVar5 != 0; iVar5 += -1) {
			*puVar14 = 0;
			puVar14 = puVar14 + 1;
		}
		local_fe4 = 0;
		local_f9c = param_3;
		*(undefined4 *)((int)lego::globals::g_UnkSurfaceGrid_2_TABLE + (uVar1 * param_3 + param_2) * 4)
				 = 1;
		local_ff0 = local_fd0;
		local_fc0[8] = param_2;
		local_fd0[0] = 1;
		local_fd0[1] = 0;
		uVar12 = 1;
		do {
			local_fe0 = uVar12;
			uVar12 = local_fe0 + 1;
			local_fdc = 0;
			if (*local_ff0 != 0) {
				iVar5 = 0;
				local_fe8 = local_fc0 + local_fe4 * 500 + 9;
				while( true ) {
					do {
						uVar13 = local_fe8[-1];
						uVar15 = *local_fe8;
						if (iVar5 == 0) {
							uVar15 -= 1;
						}
						else {
							if (iVar5 == 1) {
								uVar13 += 1;
							}
							else {
								if (iVar5 == 2) {
									uVar15 += 1;
								}
								else {
									if (iVar5 == 3) {
										uVar13 -= 1;
									}
								}
							}
						}
						if ((uVar13 < uVar1) && (uVar15 < uVar2)) {
							iVar6 = FUN_00431cd0((LiveObject *)param_1,uVar13,uVar15,local_fc0[iVar5 * 2] + uVar13
																	 ,local_fc0[iVar5 * 2 + 1] + uVar15,0);
							iVar10 = uVar15 * uVar1 + uVar13;
							if ((*(int *)((int)lego::globals::g_UnkSurfaceGrid_2_TABLE + iVar10 * 4) == 0) &&
								 (iVar6 != 0)) {
								uVar7 = (uint)(local_fe4 == 0);
								uVar3 = local_fd0[uVar7];
								iVar6 = uVar3 + uVar7 * 100;
								local_fc0[iVar6 * 5 + 8] = uVar13;
								local_fc0[iVar6 * 5 + 9] = uVar15;
								local_fd0[uVar7] = uVar3 + 1;
								*(uint *)((int)lego::globals::g_UnkSurfaceGrid_2_TABLE + iVar10 * 4) = uVar12;
								if (param_9 == NULL) {
									if ((uVar13 == param_4) && (uVar15 == param_5)) {
										local_fec = 1;
									}
								}
								else {
									local_fd0[2] = uVar13;
									local_fd0[3] = uVar15;
									iVar6 = (*(code *)param_9)(param_1,local_fd0 + 2,param_10);
									if (iVar6 != 0) {
										local_fec = 1;
										param_4 = uVar13;
										param_5 = uVar15;
									}
								}
							}
						}
						iVar5 += 1;
					} while (iVar5 < 4);
					local_fdc += 1;
					local_fe8 = local_fe8 + 5;
					if (*local_ff0 <= local_fdc) break;
					iVar5 = 0;
				}
			}
			iVar5 = 0;
			*local_ff0 = 0;
			local_fe4 = (uint)(local_fe4 == 0);
			local_ff0 = local_fd0 + local_fe4;
			if (local_fd0[local_fe4] == 0) {
				local_fec = -1;
			}
		} while (local_fec == 0);
		if (local_fec == -1) {
			return 0;
		}
		local_fd0[0] = uVar12;
		puVar8 = (uint *)std::malloc(uVar12 * 4);
		if ((puVar8 != NULL) && (puVar9 = (uint *)std::malloc(uVar12 * 4), puVar9 != NULL)) {
			local_fec = param_5;
			local_ff0 = puVar9 + local_fe0;
			puVar8[local_fe0] = param_4;
			*local_ff0 = param_5;
			*puVar8 = param_2;
			*puVar9 = param_3;
			if (local_fe0 != 1) {
				pvVar11 = lego::globals::g_UnkSurfaceGrid_2_TABLE;
				do {
					local_fdc = 0;
					uVar12 = param_5;
					do {
						uVar13 = param_4;
						if (iVar5 == 0) {
							param_5 = uVar12 - 1;
						}
						else {
							param_5 = uVar12;
							if (iVar5 == 1) {
								uVar13 = param_4 + 1;
							}
							else {
								if (iVar5 == 2) {
									param_5 = uVar12 + 1;
								}
								else {
									if (iVar5 == 3) {
										uVar13 = param_4 - 1;
									}
								}
							}
						}
						if (((uVar13 < uVar1) && (param_5 < uVar2)) &&
							 (uVar12 = local_fec,
							 *(uint *)((int)pvVar11 + (param_5 * uVar1 + uVar13) * 4) == local_fe0)) {
							*(uint *)((int)puVar8 + (-4 - (int)puVar9) + (int)local_ff0) = uVar13;
							local_ff0[-1] = param_5;
							pvVar11 = lego::globals::g_UnkSurfaceGrid_2_TABLE;
							param_4 = uVar13;
							local_fec = param_5;
							break;
						}
						param_5 = uVar12;
						iVar5 += 1;
						if (3 < iVar5) {
							iVar5 = 0;
						}
						local_fdc += 1;
						uVar12 = param_5;
					} while ((int)local_fdc < 4);
					local_fe0 -= 1;
					local_ff0 = local_ff0 + -1;
				} while (local_fe0 != 1);
			}
			*param_6 = puVar8;
			*param_7 = puVar9;
			*param_8 = local_fd0[0];
		}
	}
	return 1;
}



// WARNING: Function: _alloca4k replaced with injection: alloca_probe

BOOL FUN_004413b0(LiveObject *param_1,uint param_2,uint param_3,uint param_4,uint param_5,
								 uint **param_6,uint **param_7,float *param_8,code *param_9,undefined4 param_10)
{
	float *pfVar1;
	float fVar2;
	float fVar3;
	int iVar4;
	float fVar5;
	bool bVar6;
	LevelSurfaceMap *pLVar7;
	int iVar8;
	BOOL BVar9;
	uint uVar10;
	uint *puVar11;
	uint *buffer;
	uint uVar12;
	uint uVar13;
	uint uVar14;
	uint uVar15;
	undefined4 *puVar16;
	uint uVar17;
	int iStack4108;
	uint *puStack4104;
	uint uStack4096;
	float fStack4092;
	float fStack4088;
	uint *puStack4080;
	int iStack4076;
	uint uStack4068;
	uint auStack4060 [2];
	float fStack4052;
	Point2I PStack4048;
	Point2I PStack4040;
	int aiStack4032 [4];
	undefined4 uStack4016;
	undefined4 uStack4012;
	undefined4 uStack4008;
	undefined4 uStack4004;
	uint auStack4000 [999];
	undefined4 uStack4;
	
	uStack4 = 0x4413ba;
	aiStack4032[0] = 0;
	aiStack4032[1] = 0xffffffff;
	aiStack4032[2] = 1;
	aiStack4032[3] = 0;
	uStack4016 = 0;
	uStack4012 = 1;
	uStack4008 = 0xffffffff;
	uStack4004 = 0;
	iStack4076 = 0;
	bVar6 = false;
	pLVar7 = lego::game::GetSurfaceMap();
	uVar12 = (pLVar7->smallDimensions).width;
	uVar13 = (pLVar7->smallDimensions).height;
	if (uVar12 <= param_2) {
		return 0;
	}
	if (uVar13 <= param_3) {
		return 0;
	}
	if (param_9 == NULL) {
		if (uVar12 <= param_4) {
			return 0;
		}
		if (uVar13 <= param_5) {
			return 0;
		}
		iVar8 = FUN_00431cd0(param_1,param_4,param_5,param_4,param_5,0);
		if (iVar8 == 0) {
			return 0;
		}
	}
	if (lego::globals::g_UnkSurfaceGrid_1_TABLE != NULL) {
		if (lego::globals::g_UnkSurfaceGrid_COUNT == uVar13 * uVar12) goto LAB_004414be;
		if (lego::globals::g_UnkSurfaceGrid_1_TABLE != NULL) {
			std::free(lego::globals::g_UnkSurfaceGrid_1_TABLE);
		}
	}
	lego::globals::g_UnkSurfaceGrid_COUNT = uVar13 * uVar12;
	lego::globals::g_UnkSurfaceGrid_1_TABLE = std::malloc(lego::globals::g_UnkSurfaceGrid_COUNT * 4);
LAB_004414be:
	iVar8 = uVar13 * uVar12;
	puVar16 = (undefined4 *)lego::globals::g_UnkSurfaceGrid_1_TABLE;
	if (lego::globals::g_UnkSurfaceGrid_1_TABLE != NULL) {
		for (; iVar8 != 0; iVar8 += -1) {
			*puVar16 = 0;
			puVar16 = puVar16 + 1;
		}
		fStack4092 = 1.401298e-45;
		auStack4060[0] = 1;
		puStack4104 = auStack4060;
		uStack4096 = 0;
		*(undefined4 *)((int)lego::globals::g_UnkSurfaceGrid_1_TABLE + (uVar12 * param_3 + param_2) * 4)
				 = 0x3f800000;
		auStack4000[0] = param_2;
		auStack4000[1] = param_3;
		auStack4060[1] = 0;
		do {
			fStack4092 = (float)((int)fStack4092 + 1);
			uStack4068 = 0;
			if (*puStack4104 != 0) {
				puVar11 = auStack4000 + uStack4096 * 500 + 1;
				do {
					fVar2 = *(float *)((int)lego::globals::g_UnkSurfaceGrid_1_TABLE +
														(uVar12 * *puVar11 + puVar11[-1]) * 4);
					iStack4108 = 0;
					do {
						uVar14 = puVar11[-1];
						uVar17 = *puVar11;
						if (iStack4108 == 0) {
							uVar17 -= 1;
						}
						else {
							if (iStack4108 == 1) {
								uVar14 += 1;
							}
							else {
								if (iStack4108 == 2) {
									uVar17 += 1;
								}
								else {
									if (iStack4108 == 3) {
										uVar14 -= 1;
									}
								}
							}
						}
						if ((uVar14 < uVar12) && (uVar17 < uVar13)) {
							fStack4088 = 1.0;
							iVar8 = aiStack4032[iStack4108 * 2];
							iVar4 = aiStack4032[iStack4108 * 2 + 1];
							PStack4040.x = iVar8 + uVar14;
							PStack4040.y = iVar4 + uVar17;
							BVar9 = lego::game::Level_IsBlockPowerPath(&PStack4040);
							if (BVar9 != 0) {
								fStack4088 = 0.5;
							}
							iVar8 = FUN_00431cd0(param_1,uVar14,uVar17,iVar8 + uVar14,iVar4 + uVar17,0);
							if ((iVar8 != 0) &&
								 ((iVar8 = uVar17 * uVar12 + uVar14,
									pfVar1 = (float *)((int)lego::globals::g_UnkSurfaceGrid_1_TABLE + iVar8 * 4),
									*(float *)((int)lego::globals::g_UnkSurfaceGrid_1_TABLE + iVar8 * 4) == 0.0 ||
									(fVar5 = fStack4088 + fVar2, fVar3 = *pfVar1,
									(ushort)((ushort)(fVar3 < fVar5) << 8 | (ushort)(fVar3 == fVar5) << 0xe) == 0))))
							{
								uVar10 = (uint)(uStack4096 == 0);
								uVar15 = auStack4060[uVar10];
								iVar8 = uVar15 + uVar10 * 100;
								*pfVar1 = fStack4088 + fVar2;
								auStack4000[iVar8 * 5] = uVar14;
								auStack4000[iVar8 * 5 + 1] = uVar17;
								auStack4060[uVar10] = uVar15 + 1;
								if (param_9 == NULL) {
									if ((uVar14 == param_4) && (uVar17 == param_5)) {
										bVar6 = true;
										fStack4052 = fStack4092;
									}
								}
								else {
									PStack4048.x = uVar14;
									PStack4048.y = uVar17;
									iVar8 = (*param_9)(param_1,&PStack4048,param_10);
									if (iVar8 != 0) {
										iStack4076 = 1;
										param_4 = uVar14;
										param_5 = uVar17;
									}
								}
							}
						}
						iStack4108 += 1;
					} while (iStack4108 < 4);
					uStack4068 += 1;
					puVar11 = puVar11 + 5;
				} while (uStack4068 < *puStack4104);
			}
			*puStack4104 = 0;
			uStack4096 = (uint)(uStack4096 == 0);
			puStack4104 = auStack4060 + uStack4096;
			if (auStack4060[uStack4096] == 0) {
				iStack4076 = -1;
			}
		} while (iStack4076 == 0);
		if (bVar6) {
			iStack4076 = 1;
			fStack4092 = fStack4052;
		}
		if (iStack4076 == -1) {
			return 0;
		}
		puVar11 = (uint *)std::malloc((int)fStack4092 * 4);
		if ((puVar11 != NULL) && (buffer = (uint *)std::malloc((int)fStack4092 * 4), buffer != NULL)) {
			iVar8 = (int)fStack4092 + -1;
			puVar11[iVar8] = param_4;
			puStack4080 = buffer + iVar8;
			*puStack4080 = param_5;
			*puVar11 = param_2;
			*buffer = param_3;
			if (iVar8 != 1) {
				uStack4068 = (int)fStack4092 + -2;
				uVar14 = param_4;
				uVar17 = param_5;
				do {
					puStack4104 = (uint *)0x461c4000;
					iStack4108 = 0;
					do {
						uVar15 = uVar14;
						if (iStack4108 == 0) {
							uVar10 = uVar17 - 1;
						}
						else {
							uVar10 = uVar17;
							if (iStack4108 == 1) {
								uVar15 = uVar14 + 1;
							}
							else {
								if (iStack4108 == 2) {
									uVar10 = uVar17 + 1;
								}
								else {
									if (iStack4108 == 3) {
										uVar15 = uVar14 - 1;
									}
								}
							}
						}
						PStack4048.x = uVar15;
						PStack4048.y = uVar10;
						if (((uVar15 < uVar12) && (uVar10 < uVar13)) &&
							 (((fStack4052 = *(float *)((int)lego::globals::g_UnkSurfaceGrid_1_TABLE +
																				 (uVar17 * uVar12 + uVar14) * 4) -
															 *(float *)((int)lego::globals::g_UnkSurfaceGrid_1_TABLE +
																				 (uVar10 * uVar12 + uVar15) * 4),
								 (ushort)((ushort)(fStack4052 < 0.0) << 8 | (ushort)(fStack4052 == 0.0) << 0xe) == 0
								 && (fStack4052 < (float)puStack4104)) ||
								((fStack4052 == (float)puStack4104 &&
								 (BVar9 = lego::game::Level_IsBlockPowerPath(&PStack4048), BVar9 != 0)))))) {
							puStack4104 = (uint *)fStack4052;
							auStack4060[0] = uVar15;
							auStack4060[1] = uVar10;
						}
						iStack4108 += 1;
					} while (iStack4108 < 4);
					puStack4080 = puStack4080 + -1;
					*(uint *)((int)((int)puVar11 - (int)buffer) + (int)puStack4080) = auStack4060[0];
					*puStack4080 = auStack4060[1];
					uStack4068 += -1;
					uVar14 = auStack4060[0];
					uVar17 = auStack4060[1];
				} while (uStack4068 != 0);
			}
			*param_6 = puVar11;
			*param_7 = buffer;
			*param_8 = fStack4092;
			if (((*puVar11 != puVar11[1]) ||
					(uVar12 = (int)(*buffer - buffer[1]) >> 0x1f, (*buffer - buffer[1] ^ uVar12) - uVar12 != 1
					)) && ((*buffer != buffer[1] ||
								 (uVar12 = *puVar11 - puVar11[1], uVar13 = (int)uVar12 >> 0x1f,
								 (uVar12 ^ uVar13) - uVar13 != 1)))) {
				std::free(puVar11);
				std::free(buffer);
				BVar9 = FUN_00440f30((int *)param_1,param_2,param_3,param_4,param_5,param_6,param_7,
														 (uint *)param_8,param_9,param_10);
				return BVar9;
			}
		}
	}
	return 1;
}



BOOL __cdecl
FUN_004419c0(LiveObject *liveObj,uint param_2,float *param_3,float *param_4,float *param_5)
{
	bool bVar1;
	BOOL BVar2;
	void *buffer;
	LevelSurfaceMap *surfaceMap;
	ObjectStatsFlags1 OVar3;
	int iVar4;
	int iVar5;
	float *pfVar6;
	float *pfVar7;
	float *pfVar8;
	float10 fVar9;
	Point2F *pPVar10;
	Point2F *pPVar11;
	Point2F *pPVar12;
	uint local_1c;
	int local_14;
	Point2F local_8;
	
	BVar2 = FUN_0043bdb0(liveObj);
	if (BVar2 == 0) {
		local_14 = -1;
		bVar1 = false;
		local_8.x = 0.5;
		local_8.y = 0.5;
		if ((liveObj->flags4_3ec & 0x40) != 0) {
			liveObj->object_2fc = NULL;
			liveObj->flags4_3ec = liveObj->flags4_3ec & 0xffffffbf;
		}
		buffer = std::malloc(param_2 * 0x14);
		if ((buffer != NULL) && (local_1c = 0, param_2 != 0)) {
			pfVar7 = (float *)((int)buffer + 8);
			pfVar6 = (float *)((int)param_4 - (int)param_3);
			do {
				pfVar8 = param_3 + 1;
				pfVar7[-2] = *param_3;
				pfVar7[-1] = *param_4;
				if ((param_5 == NULL) || (local_1c != param_2 - 1)) {
					if (((liveObj->flags3_3e8 & 0x1000) == LIVEOBJ3_NONE) &&
						 (OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj),
						 (OVar3 & STATS1_ROUTEAVOIDANCE) != STATS1_NONE)) {
						fVar9 = lego::game::Game_ChooseRandomRange(0.3,0.7);
						*pfVar7 = (float)fVar9;
						fVar9 = lego::game::Game_ChooseRandomRange(0.3,0.7);
						pfVar7[1] = (float)fVar9;
					}
					else {
						pfVar7[1] = 0.5;
						*pfVar7 = 0.5;
					}
				}
				else {
					pPVar12 = &local_8;
					pPVar11 = NULL;
					pPVar10 = (Point2F *)param_5;
					surfaceMap = lego::game::GetSurfaceMap();
					FUN_0044fb30(surfaceMap,pPVar10,pPVar11,pPVar12);
					*pfVar7 = local_8.x;
					pfVar7[1] = local_8.y;
				}
				*(undefined *)(pfVar7 + 2) = 0;
				*(undefined *)((int)pfVar7 + 9) = 0;
				iVar4 = local_14;
				if (local_1c < param_2 - 1) {
					iVar4 = FUN_00450b60((int)*pfVar8,*(int *)((int)pfVar6 + (int)pfVar8),(int)*param_3,
															 (int)*param_4);
					if (iVar4 == -1) {
						bVar1 = true;
						break;
					}
					if (((local_1c != 0) && (local_14 != iVar4)) &&
						 (iVar5 = FUN_00431cd0(liveObj,(int)*pfVar8,*(int *)((int)pfVar6 + (int)pfVar8),
																	 (int)param_3[-1],(int)param_4[-1],0), iVar5 == 2)) {
						*(byte *)(pfVar7 + 2) = *(byte *)(pfVar7 + 2) | 0x10;
					}
				}
				local_14 = iVar4;
				local_1c += 1;
				param_4 = param_4 + 1;
				pfVar7 = pfVar7 + 5;
				param_3 = pfVar8;
			} while (local_1c < param_2);
		}
		if (!bVar1) {
			lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,0);
			liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xfffffbff;
			liveObj->flags1_3e0 = liveObj->flags1_3e0 | LIVEOBJ1_MOVING;
			liveObj->routeptr_24 = buffer;
			liveObj->routingBlocksTotal = param_2;
			liveObj->routingBlocksCurrent = 0;
			(liveObj->vector_28c).y = 0.0;
			(liveObj->vector_28c).x = 0.0;
			return 1;
		}
		std::free(buffer);
	}
	return 0;
}



void __cdecl lego::game::LiveObject_UnkDoRouting_FUN_00441c00(LiveObject *in_liveObj,BOOL param_2)
{
	LiveFlags4 *pLVar1;
	float fVar2;
	LiveFlags1 LVar3;
	LiveFlags3 LVar4;
	LiveObject *pLVar5;
	uint uVar6;
	char *pcVar7;
	longlong lVar8;
	Point2I point;
	
	if (in_liveObj->routeptr_24 != NULL) {
		if (param_2 == 0) {
			uVar6 = in_liveObj->routingBlocksCurrent;
			if (uVar6 < in_liveObj->routingBlocksTotal) {
				pcVar7 = (char *)((int)in_liveObj->routeptr_24 + uVar6 * 0x14 + 0x11);
				do {
					if (*pcVar7 == '\x03') {
						pLVar5 = in_liveObj->object_2fc;
						if (pLVar5 != NULL) {
							if (pLVar5->objType == OBJECT_BOULDER) {
								LiveObject_ReleaseBoulderUnk(pLVar5);
							}
							else {
								pLVar5->object_300 = NULL;
							}
LAB_00441ca7:
							in_liveObj->object_2fc = NULL;
						}
						break;
					}
					if (*pcVar7 == '\a') goto LAB_00441ca7;
					uVar6 += 1;
					pcVar7 = pcVar7 + 0x14;
				} while (uVar6 < in_liveObj->routingBlocksTotal);
			}
			if (in_liveObj->objType == OBJECT_ROCKMONSTER) {
				if (((in_liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) &&
					 (in_liveObj->carriedObjects[0]->objType == OBJECT_BOULDER)) {
					FUN_0043a130(in_liveObj,0);
				}
				FUN_00403b30(in_liveObj,AITASK_GATHER,NULL);
				FUN_00403b30(in_liveObj,AITASK_REPAIR,NULL);
			}
			if ((*(byte *)&in_liveObj->flags1_3e0 & 8) != 0) {
				lVar8 = __ftol((float10)(in_liveObj->point_2f4).x);
				point.x = (int)lVar8;
				lVar8 = __ftol((float10)(in_liveObj->point_2f4).y);
				point.y = (int)lVar8;
				Level_SetBlockFlags1_8000000(&point,0);
			}
			Game_UnkLiveObjectHandleDynamite(in_liveObj);
		}
		else {
			if (in_liveObj->objType == OBJECT_MINIFIGURE) {
				res::Creature_SetOrientation
									(in_liveObj->miniFigure,(in_liveObj->point_298).x,(in_liveObj->point_298).y);
				fVar2 = (in_liveObj->point_298).y;
				(in_liveObj->faceDirection).x = (in_liveObj->point_298).x;
				(in_liveObj->faceDirection).y = fVar2;
			}
		}
		std::free(in_liveObj->routeptr_24);
		in_liveObj->routeptr_24 = NULL;
		FUN_00403a20(in_liveObj,param_2);
	}
	LVar3 = in_liveObj->flags1_3e0;
	LVar4 = in_liveObj->flags3_3e8;
	pLVar5 = in_liveObj->object_2fc;
	in_liveObj->routingBlocksTotal = 0;
	in_liveObj->routingBlocksCurrent = 0;
	(in_liveObj->vector_28c).y = 0.0;
	(in_liveObj->vector_28c).x = 0.0;
	(in_liveObj->vector_28c).z = 0.0;
	in_liveObj->flags1_3e0 = LVar3 & 0xff7ffffe;
	in_liveObj->flags3_3e8 = LVar4 & 0xffffbbff;
	if (pLVar5 != NULL) {
		pLVar1 = &pLVar5->flags4_3ec;
		*pLVar1 = *pLVar1 & 0xffffffef;
	}
	if ((*(byte *)&in_liveObj->flags1_3e0 & 2) != 0) {
		(in_liveObj->faceDirection).x = (in_liveObj->faceDirection).x * -1.0;
		(in_liveObj->faceDirection).y = (in_liveObj->faceDirection).y * -1.0;
		(in_liveObj->faceDirection).z = (in_liveObj->faceDirection).z * -1.0;
		in_liveObj->flags1_3e0 = in_liveObj->flags1_3e0 & ~LIVEOBJ1_UNK_2_LEFTING;
	}
	LiveObject_SetActivityUnk(in_liveObj,ACTIVITY_STAND,0);
	return;
}



void __cdecl FUN_00441df0(LiveObject *liveObj,BOOL param_2,BOOL param_3)
{
	LiveFlags2 *pLVar1;
	LiveFlags3 *pLVar2;
	LiveFlags2 LVar3;
	LiveFlags1 LVar4;
	ObjectStatsFlags2 OVar5;
	longlong lVar6;
	Point2I local_8;
	
	lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,0);
	if (param_3 != 0) {
		FUN_0043a130(liveObj,0);
	}
	if ((liveObj->flags2_3e4 & 2) != LIVEOBJ2_NONE) {
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfffffffd;
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_GETUP,0);
		lego::game::Game_UpdateSomeAITasks(liveObj);
		liveObj->flags2_3e4 = liveObj->flags2_3e4 | 0x100;
		LVar3 = liveObj->object_3c0->flags2_3e4;
		if ((LVar3 & 1) != LIVEOBJ2_NONE) {
			liveObj->object_3c0->flags2_3e4 = LVar3 & 0xfffffffe;
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
		}
	}
	if ((liveObj->flags2_3e4 & 1) != LIVEOBJ2_NONE) {
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfffffffe;
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
		LVar3 = liveObj->object_3c0->flags2_3e4;
		if ((LVar3 & 2) != LIVEOBJ2_NONE) {
			liveObj->object_3c0->flags2_3e4 = LVar3 & 0xfffffffd;
			lego::game::LiveObject_SetActivityUnk(liveObj->object_3c0,ACTIVITY_GETUP,0);
			lego::game::Game_UpdateSomeAITasks(liveObj->object_3c0);
			pLVar1 = &liveObj->object_3c0->flags2_3e4;
			*pLVar1 = *pLVar1 | 0x100;
		}
	}
	LVar4 = liveObj->flags1_3e0;
	liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfe3fbfdf;
	liveObj->flags1_3e0 = LVar4 & 0x6ffff7ff;
	if ((LVar4 & 0x2000) != LIVEOBJ1_NONE) {
		liveObj->flags1_3e0 = LVar4 & 0x6fffd7ff;
		FUN_00403c40(liveObj,5,liveObj,1);
		FUN_0043f160(liveObj);
		if (liveObj->object_2fc != NULL) {
			pLVar2 = &liveObj->object_2fc->flags3_3e8;
			*pLVar2 = *pLVar2 & 0xfeffffff;
		}
	}
	LVar4 = liveObj->flags1_3e0;
	liveObj->flags1_3e0 = LVar4 & 0xdffffdff;
	liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xffffbfff;
	if ((liveObj->flags2_3e4 & 0x200000) != LIVEOBJ2_NONE) {
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xffdfffff;
	}
	LVar3 = liveObj->flags2_3e4;
	liveObj->flags2_3e4 = LVar3 & 0xfffbffff;
	if ((LVar4 & 0x1000000) != LIVEOBJ1_NONE) {
		liveObj->flags2_3e4 = LVar3 & 0xfff3ffff;
		FUN_00403c40(liveObj,10,NULL,1);
		liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xfeffffff;
	}
	if ((liveObj->flags1_3e0 & LIVEOBJ1_EATING) != LIVEOBJ1_NONE) {
		liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_EATING;
	}
	if ((liveObj->flags2_3e4 & 0x40) != LIVEOBJ2_NONE) {
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xffffffbf;
	}
	if ((liveObj->flags2_3e4 & LIVEOBJ2_TRAINING) != LIVEOBJ2_NONE) {
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & ~LIVEOBJ2_TRAINING;
	}
	if ((liveObj->flags2_3e4 & LIVEOBJ2_UPGRADING) != LIVEOBJ2_NONE) {
		if (liveObj->object_2fc != NULL) {
			OVar5 = lego::game::LiveObject_GetStatsFlags2(liveObj->object_2fc);
			if ((OVar5 & STATS2_UPGRADEBUILDING) != STATS2_NONE) {
				if ((liveObj->object_2fc->flags2_3e4 & LIVEOBJ2_UPGRADING) != LIVEOBJ2_NONE)
				goto LAB_00442065;
				FUN_00403c40(liveObj,0x15,NULL,1);
				liveObj->object_2fc->object_300 = NULL;
				liveObj->object_2fc = NULL;
			}
		}
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & ~LIVEOBJ2_UPGRADING;
	}
LAB_00442065:
	if ((liveObj->flags1_3e0 & LIVEOBJ1_PLACING) != LIVEOBJ1_NONE) {
		liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_PLACING;
		FUN_0043a130(liveObj,1);
	}
	LVar4 = liveObj->flags1_3e0;
	liveObj->flags1_3e0 = LVar4 & 0xffffefff;
	if ((LVar4 & LIVEOBJ1_REINFORCING) != LIVEOBJ1_NONE) {
		lVar6 = __ftol((float10)(liveObj->point_2f4).x);
		local_8.x = (int)lVar6;
		lVar6 = __ftol((float10)(liveObj->point_2f4).y);
		local_8.y = (int)lVar6;
		liveObj->flags1_3e0 = LVar4 & 0xffffefbf | 0x80000000;
		lego::game::Level_SetBlockFlags1_8000000(&local_8,0);
	}
	LVar4 = liveObj->flags1_3e0;
	liveObj->flags1_3e0 = LVar4 & 0xfbffffff;
	if ((liveObj->flags2_3e4 & 4) != LIVEOBJ2_NONE) {
		liveObj->object_2fc = NULL;
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfffffffb;
	}
	liveObj->flags1_3e0 = LVar4 & 0x7bfa7fff;
	liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfffcfcff;
	if (param_2 != 0) {
		FUN_00403e90(liveObj);
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,1);
		lego::game::Game_UpdateSomeAITasks(liveObj);
	}
	return;
}



void __cdecl lego::game::LiveObject_ReleaseBoulderUnk(LiveObject *liveObj)
{
	if ((((byte)pool::globals::ReservedPool_LiveObject___g_INITFLAGS & 2) == 0) &&
		 (liveObj->objType == OBJECT_BOULDER)) {
		FUN_0040bd10(liveObj);
		pool::ReservedPool_LiveObject___Release(liveObj);
	}
	return;
}



undefined4 __cdecl FUN_00442190(LiveObject *liveObj,int *param_2,int param_3)
{
	float fVar1;
	float fVar2;
	float fVar3;
	BOOL BVar4;
	ResourceData *pRVar5;
	LiveFlags2 LVar6;
	float10 fVar7;
	ResourceData *pRVar8;
	Vector3F *pVVar9;
	Vector3F local_24;
	Vector3F local_18;
	Vector3F local_c;
	
	if ((((ushort)((ushort)((float)liveObj->field_360 < 0.0) << 8 |
								(ushort)((float)liveObj->field_360 == 0.0) << 0xe) == 0) ||
			(((byte)lego::globals::g_Game.flags2 & 4) != 0)) || (*param_2 != 3)) {
		return 0;
	}
	BVar4 = FUN_0043bdb0(liveObj);
	if (BVar4 != 0) {
		return 0;
	}
	lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,0);
	pVVar9 = &local_18;
	pRVar8 = NULL;
	pRVar5 = lego::game::LiveObject_GetResource((LiveObject *)param_2);
	lego::res::Res_GetPosition(pRVar5,pRVar8,pVVar9);
	pVVar9 = &local_c;
	pRVar8 = NULL;
	pRVar5 = lego::game::LiveObject_GetResource(liveObj);
	lego::res::Res_GetPosition(pRVar5,pRVar8,pVVar9);
	fVar7 = lego::game::LiveObject_GetCollHeight(liveObj);
	local_c.z = (float)((float10)local_c.z - fVar7 * (float10)0.5);
	fVar7 = lego::game::LiveObject_GetCollHeight((LiveObject *)param_2);
	fVar7 = (float10)local_18.z - fVar7 * (float10)0.5;
	local_18.z = (float)fVar7;
	fVar7 = fVar7 - (float10)local_c.z;
	fVar1 = (float)((float10)local_18.x - (float10)local_c.x);
	fVar2 = (float)((float10)local_18.y - (float10)local_c.y);
	fVar3 = (float)fVar7;
	fVar7 = (float10)1.0 /
					SQRT(fVar7 * (float10)fVar3 +
							 ((float10)local_18.y - (float10)local_c.y) * (float10)fVar2 +
							 ((float10)local_18.x - (float10)local_c.x) * (float10)fVar1);
	local_24.x = (float)(fVar7 * (float10)fVar1);
	local_24.y = (float)(fVar7 * (float10)fVar2);
	local_24.z = (float)(fVar7 * (float10)fVar3);
	FUN_004425c0(liveObj,0,&local_24);
	if (param_3 == 1) {
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_FIRELASER,1);
		lego::game::Game_UpdateSomeAITasks(liveObj);
		LVar6 = liveObj->flags2_3e4 | 0x400000;
	}
	else {
		if (param_3 == 2) {
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_FIRELASER,1);
			lego::game::Game_UpdateSomeAITasks(liveObj);
			LVar6 = liveObj->flags2_3e4 | 0x800000;
		}
		else {
			if (param_3 != 3) goto LAB_0044233f;
			lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_FIRELASER,1);
			lego::game::Game_UpdateSomeAITasks(liveObj);
			LVar6 = liveObj->flags2_3e4 | 0x1000000;
		}
	}
	liveObj->flags2_3e4 = LVar6;
LAB_0044233f:
	liveObj->field_3a8 = local_18.x;
	liveObj->field_3ac = local_18.y;
	liveObj->field_39c = local_24.x;
	liveObj->field_3b0 = local_18.z;
	liveObj->field_3a0 = local_24.y;
	liveObj->field_3a4 = local_24.z;
	return 1;
}



void __cdecl lego::game::Game_GetWeaponUnk(LiveObject *liveObj,int weaponType)
{
	LevelSurfaceMap *surfMap;
	float fVar1;
	float10 fVar2;
	float local_c;
	float local_8;
	float local_4;
	
	LiveObject_GetPosition(liveObj,&local_c,&local_8);
	surfMap = GetSurfaceMap();
	fVar2 = SurfaceMap_UnkGetZ(surfMap,local_c,local_8);
	fVar1 = (float)fVar2;
	fVar2 = LiveObject_GetCollHeight(liveObj);
	local_4 = (float)((float10)fVar1 - fVar2 * (float10)0.5);
	switch(weaponType) {
	case 1:
		fVar1 = (float)Game_GetWeaponType("Lazer");
		FUN_0046fdb0(liveObj,&local_c,(float *)&liveObj->field_39c,(uint)fVar1,1);
		break;
	case 2:
		fVar1 = (float)Game_GetWeaponType("Pusher");
		FUN_0046fdb0(liveObj,&local_c,(float *)&liveObj->field_39c,(uint)fVar1,2);
		break;
	case 3:
		fVar1 = (float)Game_GetWeaponType("Freezer");
		FUN_0046fdb0(liveObj,&local_c,(float *)&liveObj->field_39c,(uint)fVar1,3);
		break;
	case 4:
		fVar1 = (float)Game_GetWeaponType("Lazer");
		FUN_0046ff30(liveObj,&local_c,(float *)&liveObj->field_3a8,fVar1,4);
	}
	fVar2 = FUN_0046f3d0((int)fVar1);
	liveObj->field_360 = (float)fVar2;
	return;
}



void __cdecl FUN_004424d0(LiveObject *liveObj)
{
	uint uVar1;
	
	FUN_00441df0(liveObj,0,1);
	lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_CRUMBLE,1);
	uVar1 = lego::game::Game_UpdateSomeAITasks(liveObj);
	if (uVar1 != 0) {
		liveObj->flags1_3e0 = liveObj->flags1_3e0 | 0x100000;
	}
	liveObj->health = -1.0;
	return;
}



void __cdecl lego::game::LiveObject_GetPosition(LiveObject *liveObj,float *out_x,float *out_y)
{
	ResourceData *resData;
	Vector3F vector;
	
	resData = LiveObject_GetResource(liveObj);
	res::Res_GetPosition(resData,NULL,&vector);
	*out_x = vector.x;
	*out_y = vector.y;
	return;
}



void __cdecl FUN_00442560(LiveObject *liveObj,Point2F *out_point)
{
	float fVar1;
	ResourceData *resData;
	Vector3F local_c;
	
	resData = lego::game::LiveObject_GetResource(liveObj);
	lego::res::Res_GetOrientation(resData,NULL,&local_c,NULL);
	fVar1 = 1.0 / SQRT(local_c.x * local_c.x + local_c.y * local_c.y);
	out_point->x = fVar1 * local_c.x;
	out_point->y = fVar1 * local_c.y;
	return;
}



void __cdecl FUN_004425c0(LiveObject *liveObj,float theta,Vector3F *param_3)
{
	ObjectType OVar1;
	Vector3F local_18;
	Vector3F local_c;
	
	if (param_3 == NULL) {
		local_18.z = 0.0;
		local_18.x = 0.0;
		local_18.y = 1.0;
		local_c.y = 0.0;
		local_c.x = 0.0;
		local_c.z = -1.0;
		lego::math::Vector3_Rotate(&local_18,&local_18,&local_c,theta);
	}
	else {
		local_18.x = param_3->x;
		local_18.y = param_3->y;
		local_18.z = param_3->z;
	}
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_VEHICLE) {
		lego::res::Vehicle_SetOrientation(liveObj->vehicle,local_18.x,local_18.y,local_18.z);
	}
	else {
		if (OVar1 == OBJECT_MINIFIGURE) {
			lego::res::Creature_SetOrientation(liveObj->miniFigure,local_18.x,local_18.y);
		}
		else {
			if (OVar1 == OBJECT_ROCKMONSTER) {
				lego::res::Creature_SetOrientation(liveObj->rockMonster,local_18.x,local_18.y);
			}
			else {
				if (OVar1 == OBJECT_BUILDING) {
					lego::res::Building_SetOrientation(liveObj->building,local_18.x,local_18.y);
				}
				else {
					if ((liveObj->flags3_3e8 & LIVEOBJ3_SIMPLEOBJECT) != LIVEOBJ3_NONE) {
						lego::res::Res_SetFrameOrientation
											(liveObj->other,NULL,local_18.x,local_18.y,local_18.z,0.0,0.0,-1.0);
					}
				}
			}
		}
	}
	liveObj->float_2b8 = 0.01;
	(liveObj->faceDirection).x = local_18.x;
	(liveObj->faceDirection).y = local_18.y;
	(liveObj->faceDirection).z = local_18.z;
	(liveObj->vector_2a0).x = (liveObj->faceDirection).x * -0.01;
	(liveObj->vector_2a0).y = (liveObj->faceDirection).y * -0.01;
	(liveObj->vector_2a0).z = (liveObj->faceDirection).z * -0.01;
	return;
}



float10 __cdecl FUN_00442740(LiveObject *liveObj)
{
	float10 fVar1;
	Point2F local_8;
	
	FUN_00442560(liveObj,&local_8);
	fVar1 = (float10)FUN_0048e350();
	if (local_8.x < 0.0) {
		fVar1 = (float10)6.283185 - fVar1;
	}
	return fVar1;
}



BOOL __cdecl lego::game::LiveObject_GetBlockCoordinates(LiveObject *liveObj,int *out_x,int *out_y)
{
	ResourceData *resData;
	LevelSurfaceMap *surfaceMap;
	BOOL BVar1;
	Vector3F local_c;
	
	resData = LiveObject_GetResource(liveObj);
	res::Res_GetPosition(resData,NULL,&local_c);
	surfaceMap = GetSurfaceMap();
	BVar1 = SurfaceMap_ToBlockCoordinatesNoZ(surfaceMap,local_c.x,local_c.y,out_x,out_y);
	return BVar1;
}



float10 __cdecl lego::res::Res_GetSurfaceMapZ_Callback(float x,float y,LevelSurfaceMap *surfMap)
{
	float10 fVar1;
	
	fVar1 = game::SurfaceMap_UnkGetZ(surfMap,x,y);
	return fVar1;
}



float10 __cdecl FUN_00442820(float param_1,float param_2,LevelSurfaceMap *param_3)
{
	BOOL BVar1;
	float10 fVar2;
	float local_c;
	int local_8;
	int local_4;
	
	local_c = 0.0;
	BVar1 = lego::game::SurfaceMap_ToBlockCoordinates
										(param_3,param_1,param_2,&local_8,&local_4,&local_c);
	if (BVar1 != 0) {
		if ((lego::globals::g_Game.level)->blocks
				[((lego::globals::g_Game.level)->dimensions).width * local_4 + local_8].terrain ==
				TERRAIN_LAKE) {
			local_c = local_c * 8.0;
		}
		else {
			local_c = 0.0;
		}
	}
	fVar2 = lego::game::SurfaceMap_UnkGetZ(param_3,param_1,param_2);
	return fVar2 + (float10)local_c;
}



void __cdecl FUN_004428b0(LiveObject *liveObj,float x,float y)
{
	ObjectType OVar1;
	ResourceData *resData;
	LevelSurfaceMap *pLVar2;
	VehicleData *vehicle;
	float fVar3;
	float fVar4;
	float fVar5;
	Vector3F local_c;
	
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_VEHICLE) {
		resData = lego::res::Vehicle_GetAEResource(liveObj->vehicle);
	}
	else {
		if (OVar1 == OBJECT_MINIFIGURE) {
			resData = lego::game::LiveObject_GetAEResource((BasicObjectData *)liveObj->miniFigure);
		}
		else {
			resData = (ResourceData *)y;
			if (OVar1 == OBJECT_ROCKMONSTER) {
				resData = lego::game::LiveObject_GetAEResource((BasicObjectData *)liveObj->rockMonster);
			}
		}
	}
	lego::res::Res_GetPosition(resData,NULL,&local_c);
	if ((x != local_c.x) || (y != local_c.y)) {
		(liveObj->faceDirection).z = 0.0;
		(liveObj->faceDirection).x = x;
		(liveObj->faceDirection).y = y;
		(liveObj->vector_2a0).x = local_c.x;
		(liveObj->vector_2a0).y = local_c.y;
		(liveObj->vector_2a0).z = local_c.z;
		(liveObj->faceDirection).x = (liveObj->faceDirection).x - (liveObj->vector_2a0).x;
		(liveObj->faceDirection).y = (liveObj->faceDirection).y - (liveObj->vector_2a0).y;
		(liveObj->faceDirection).z = (liveObj->faceDirection).z - (liveObj->vector_2a0).z;
		(liveObj->faceDirection).z = 0.0;
		fVar4 = (liveObj->faceDirection).z;
		fVar3 = (liveObj->faceDirection).y;
		fVar5 = (liveObj->faceDirection).x;
		fVar4 = SQRT(fVar5 * fVar5 + fVar4 * fVar4 + fVar3 * fVar3);
		fVar5 = 1.0 / fVar4;
		liveObj->float_2b8 = fVar4;
		(liveObj->faceDirection).x = fVar5 * (liveObj->faceDirection).x;
		(liveObj->faceDirection).y = (liveObj->faceDirection).y * fVar5;
		(liveObj->faceDirection).z = (liveObj->faceDirection).z * fVar5;
	}
	OVar1 = liveObj->objType;
	if (OVar1 != OBJECT_VEHICLE) {
		if (OVar1 != OBJECT_MINIFIGURE) {
			if (OVar1 == OBJECT_ROCKMONSTER) {
				lego::res::Creature_SetOrientation
									(liveObj->rockMonster,(liveObj->faceDirection).x,(liveObj->faceDirection).y);
				pLVar2 = lego::game::GetSurfaceMap();
				lego::res::Creature_SetPosition
									(liveObj->rockMonster,x,y,lego::res::Res_GetSurfaceMapZ_Callback,pLVar2);
			}
			return;
		}
		if ((*(byte *)&liveObj->flags1_3e0 & 2) == 0) {
			fVar5 = (liveObj->faceDirection).y;
			fVar4 = (liveObj->faceDirection).x;
		}
		else {
			fVar5 = -(liveObj->faceDirection).y;
			fVar4 = -(liveObj->faceDirection).x;
		}
		lego::res::Creature_SetOrientation(liveObj->miniFigure,fVar4,fVar5);
		pLVar2 = lego::game::GetSurfaceMap();
		lego::res::Creature_SetPosition(liveObj->miniFigure,x,y,FUN_00442820,pLVar2);
		return;
	}
	if ((*(byte *)&liveObj->flags1_3e0 & 2) == 0) {
		fVar5 = (liveObj->faceDirection).z;
		fVar4 = (liveObj->faceDirection).y;
		fVar3 = (liveObj->faceDirection).x;
		vehicle = liveObj->vehicle;
	}
	else {
		vehicle = liveObj->vehicle;
		fVar5 = -(liveObj->faceDirection).z;
		fVar4 = -(liveObj->faceDirection).y;
		fVar3 = -(liveObj->faceDirection).x;
	}
	lego::res::Vehicle_SetOrientation(vehicle,fVar3,fVar4,fVar5);
	pLVar2 = lego::game::GetSurfaceMap();
	lego::res::Vehicle_SetPosition(liveObj->vehicle,x,y,lego::res::Res_GetSurfaceMapZ_Callback,pLVar2)
	;
	return;
}



void __cdecl FUN_00442b60(LiveObject *liveObj,float x,float y,float theta,BOOL param_5)
{
	ObjectType OVar1;
	LevelSurfaceMap *pLVar2;
	float10 fVar3;
	float x_00;
	float y_00;
	Vector3F local_18;
	Vector3F local_c;
	
	if (param_5 != 0) {
		local_18.z = 0.0;
		local_18.x = 0.0;
		local_18.y = 1.0;
		local_c.y = 0.0;
		local_c.x = 0.0;
		local_c.z = -1.0;
		lego::math::Vector3_Rotate(&local_18,&local_18,&local_c,theta);
	}
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_VEHICLE) {
		if (param_5 != 0) {
			lego::res::Vehicle_SetOrientation(liveObj->vehicle,local_18.x,local_18.y,local_18.z);
		}
		pLVar2 = lego::game::GetSurfaceMap();
		lego::res::Vehicle_SetPosition
							(liveObj->vehicle,x,y,lego::res::Res_GetSurfaceMapZ_Callback,pLVar2);
	}
	else {
		if (OVar1 == OBJECT_MINIFIGURE) {
			if (param_5 != 0) {
				lego::res::Creature_SetOrientation(liveObj->miniFigure,local_18.x,local_18.y);
			}
			pLVar2 = lego::game::GetSurfaceMap();
			lego::res::Creature_SetPosition(liveObj->miniFigure,x,y,FUN_00442820,pLVar2);
		}
		else {
			if (OVar1 == OBJECT_ROCKMONSTER) {
				if (param_5 != 0) {
					lego::res::Creature_SetOrientation(liveObj->rockMonster,local_18.x,local_18.y);
				}
				pLVar2 = lego::game::GetSurfaceMap();
				lego::res::Creature_SetPosition
									(liveObj->rockMonster,x,y,lego::res::Res_GetSurfaceMapZ_Callback,pLVar2);
			}
			else {
				if (OVar1 == OBJECT_BUILDING) {
					if (param_5 != 0) {
						lego::res::Building_SetOrientation(liveObj->building,local_18.x,local_18.y);
					}
					pLVar2 = lego::game::GetSurfaceMap();
					lego::res::Building_SetPosition
										(liveObj->building,x,y,lego::res::Res_GetSurfaceMapZ_Callback,pLVar2);
				}
				else {
					if ((liveObj->flags3_3e8 & LIVEOBJ3_SIMPLEOBJECT) != LIVEOBJ3_NONE) {
						if (param_5 != 0) {
							lego::res::Res_SetFrameOrientation
												(liveObj->other,NULL,local_18.x,local_18.y,local_18.z,0.0,0.0,-1.0);
						}
						x_00 = x;
						y_00 = y;
						pLVar2 = lego::game::GetSurfaceMap();
						fVar3 = lego::game::SurfaceMap_UnkGetZ(pLVar2,x_00,y_00);
						lego::res::Res_SetFramePosition(liveObj->other,NULL,x,y,(float)fVar3);
					}
				}
			}
		}
	}
	if (param_5 != 0) {
		(liveObj->faceDirection).x = local_18.x;
		(liveObj->faceDirection).y = local_18.y;
		(liveObj->faceDirection).z = local_18.z;
	}
	liveObj->float_2b8 = 0.01;
	(liveObj->vector_2a0).x = (liveObj->faceDirection).x * -0.01;
	(liveObj->vector_2a0).y = (liveObj->faceDirection).y * -0.01;
	(liveObj->vector_2a0).z = (liveObj->faceDirection).z * -0.01;
	(liveObj->vector_2a0).x = (liveObj->vector_2a0).x + x;
	(liveObj->vector_2a0).y = (liveObj->vector_2a0).y + y;
	(liveObj->vector_2a0).z = (liveObj->vector_2a0).z;
	return;
}



int __cdecl FUN_00442dd0(LiveObject *in_liveObj,float param_2,float *param_3)
{
	ObjectType OVar1;
	bool bVar2;
	LiveObject *in_liveObj_00;
	ResourceData *resData;
	LiveObject *liveObj;
	BOOL BVar3;
	int iVar4;
	uint uVar5;
	LevelSurfaceMap *pLVar6;
	ObjectStatsFlags1 OVar7;
	CreatureData *creature;
	int iVar8;
	float fVar9;
	float fVar10;
	float fVar11;
	float *pfVar12;
	code *getZcallback;
	float *pfVar13;
	uint local_50;
	float local_4c;
	uint local_48;
	float local_44;
	float local_40;
	float local_3c;
	float local_38;
	float local_34;
	float local_30;
	float local_2c;
	float local_28;
	Vector3F local_24;
	Vector3F local_18;
	Vector3F local_c;
	
	in_liveObj_00 = in_liveObj;
	resData = lego::game::LiveObject_GetResource(in_liveObj);
	iVar8 = 0;
	uVar5 = (uint)((int)in_liveObj_00->field_2c0 < 0);
	local_48 = uVar5;
	FUN_004468d0(in_liveObj_00,param_2,&local_4c,&local_44);
	lego::res::Res_GetOrientation(resData,NULL,&local_24,&local_c);
	lego::res::Res_GetPosition(resData,NULL,&local_18);
	local_38 = local_18.x;
	local_34 = local_18.y;
	if ((float)in_liveObj_00->field_2c4 != 0.0) {
		fVar9 = 1.0;
		if (in_liveObj_00->objType == OBJECT_VEHICLE) {
			if (uVar5 == 0) {
				fVar9 = 1.0;
			}
			else {
				fVar9 = -1.0;
			}
		}
		lego::res::Res_AddRotation
							(resData,D3DRMCOMBINE_BEFORE,0.0,1.0,0.0,
							 fVar9 * param_2 * (float)in_liveObj_00->field_2c4);
		iVar8 = 1;
		(in_liveObj_00->faceDirection).x = local_24.x;
		(in_liveObj_00->faceDirection).y = local_24.y;
		(in_liveObj_00->faceDirection).z = local_24.z;
	}
	param_2 = (float)in_liveObj_00->field_2bc;
	if ((param_2 != 0.0) || (in_liveObj_00->field_2c0 != 0)) {
		fVar11 = (float)in_liveObj_00->field_2c0;
		fVar10 = (float)(int)param_2;
		local_2c = 0.0;
		fVar9 = 1.0 / SQRT(fVar11 * fVar11 + fVar10 * fVar10);
		local_28 = fVar9 * fVar11 * local_4c;
		local_30 = fVar9 * fVar10 * local_4c;
		lego::res::Res_AddTranslation(resData,D3DRMCOMBINE_BEFORE,local_30,0.0,local_28);
		iVar8 = 1;
	}
	if (iVar8 == 0) goto LAB_00443210;
	bVar2 = false;
	lego::game::LiveObject_GetBlockCoordinates(in_liveObj_00,(int *)&local_50,(int *)&in_liveObj);
	lego::game::LiveObject_GetPosition(in_liveObj_00,&local_40,&local_3c);
	liveObj = (LiveObject *)FUN_00446030(in_liveObj_00,&local_40,0,1);
	if (liveObj != NULL) {
		lego::game::LiveObject_GetPosition(liveObj,&local_30,&local_2c);
		local_30 = local_40 - local_30;
		local_2c = local_3c - local_2c;
		local_38 = local_40 - local_38;
		local_34 = local_3c - local_34;
		fVar9 = 1.0 / SQRT(local_34 * local_34 + local_38 * local_38);
		param_2 = 1.0 / SQRT(local_2c * local_2c + local_30 * local_30);
		fVar9 = param_2 * local_2c * fVar9 * local_34 + param_2 * local_30 * fVar9 * local_38;
		if ((ushort)((ushort)(fVar9 < 0.0) << 8 | (ushort)(fVar9 == 0.0) << 0xe) != 0) {
			bVar2 = true;
		}
	}
	BVar3 = lego::game::Game_IsNoclipOn();
	if ((BVar3 == 0) &&
		 (((iVar4 = FUN_00431cd0(in_liveObj_00,local_50,(int)in_liveObj,local_50,(int)in_liveObj,1),
			 iVar4 == 0 || (bVar2)) || (iVar4 = FUN_00432ac0(local_50,(int)in_liveObj), iVar4 != 0)))) {
		lego::res::Res_SetFramePosition(resData,NULL,local_18.x,local_18.y,local_18.z);
		lego::res::Res_SetFrameOrientation
							(resData,NULL,local_24.x,local_24.y,local_24.z,local_c.x,local_c.y,local_c.z);
		(in_liveObj_00->faceDirection).x = local_24.x;
		(in_liveObj_00->faceDirection).y = local_24.y;
		(in_liveObj_00->faceDirection).z = local_24.z;
	}
	else {
		BVar3 = lego::game::Level_GetBlockFlags1_10Not8(local_50,(uint)in_liveObj);
		if (BVar3 != 0) {
			pfVar13 = &local_3c;
			pfVar12 = &local_40;
			fVar11 = 0.0;
			uVar5 = FUN_00432f00(local_50,(int)in_liveObj);
			fVar9 = local_40;
			fVar10 = local_3c;
			pLVar6 = lego::game::GetSurfaceMap();
			FUN_0044fe50(pLVar6,fVar9,fVar10,uVar5,fVar11,pfVar12,pfVar13);
		}
		OVar1 = in_liveObj_00->objType;
		if (OVar1 == OBJECT_VEHICLE) {
			pLVar6 = lego::game::GetSurfaceMap();
			lego::res::Vehicle_SetPosition
								(in_liveObj_00->vehicle,local_40,local_3c,lego::res::Res_GetSurfaceMapZ_Callback,
								 pLVar6);
		}
		else {
			if (OVar1 == OBJECT_MINIFIGURE) {
				pLVar6 = lego::game::GetSurfaceMap();
				creature = in_liveObj_00->miniFigure;
				getZcallback = FUN_00442820;
			}
			else {
				if (OVar1 != OBJECT_ROCKMONSTER) goto LAB_004431a9;
				pLVar6 = lego::game::GetSurfaceMap();
				creature = in_liveObj_00->rockMonster;
				getZcallback = lego::res::Res_GetSurfaceMapZ_Callback;
			}
			lego::res::Creature_SetPosition(creature,local_40,local_3c,getZcallback,pLVar6);
		}
	}
LAB_004431a9:
	BVar3 = lego::game::Level_GetBlockFlags1_10Not8(local_50,(uint)in_liveObj);
	if (((BVar3 != 0) &&
			(BVar3 = FUN_004326a0(in_liveObj_00,local_50,(uint)in_liveObj,0,1), BVar3 != 0)) &&
		 ((in_liveObj_00->objType != OBJECT_MINIFIGURE ||
			(BVar3 = lego::game::LiveObject_HasToolEquipped(in_liveObj_00,TOOL_DRILL), BVar3 != 0)))) {
		iVar8 = 3;
	}
	if ((local_48 != 0) &&
		 (OVar7 = lego::game::LiveObject_GetStatsFlags1(in_liveObj_00),
		 (OVar7 & STATS1_CROSSLAND) == STATS1_NONE)) {
		iVar8 = 4;
	}
LAB_00443210:
	in_liveObj_00->field_2bc = 0;
	in_liveObj_00->field_2c0 = 0;
	in_liveObj_00->field_2c4 = 0;
	if (iVar8 != 0) {
		*param_3 = local_44;
	}
	return iVar8;
}



void __cdecl FUN_00443240(LiveObject *in_liveObj,float param_2)
{
	ObjectType OVar1;
	LiveFlags3 LVar2;
	LiveObject *liveObj;
	LevelSurfaceMap *pLVar3;
	ResourceData *pRVar4;
	BOOL BVar5;
	int iVar6;
	uint uVar7;
	float10 fVar8;
	longlong lVar9;
	float fVar10;
	float fVar11;
	float fVar12;
	Vector3F *pVVar13;
	float *pfVar14;
	uint local_30;
	float local_2c;
	float local_28;
	Vector3F local_24;
	Vector3F local_18;
	Vector3F local_c;
	
	liveObj = in_liveObj;
	FUN_00403a70(in_liveObj);
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_VEHICLE) {
		lego::game::LiveObject_GetPosition(liveObj,(float *)&in_liveObj,&param_2);
		pLVar3 = lego::game::GetSurfaceMap();
		lego::res::Vehicle_SetPosition
							(liveObj->vehicle,(float)in_liveObj,param_2,lego::res::Res_GetSurfaceMapZ_Callback,
							 pLVar3);
		return;
	}
	if (OVar1 == OBJECT_BUILDING) {
		lego::game::LiveObject_GetPosition(liveObj,(float *)&in_liveObj,&param_2);
		pLVar3 = lego::game::GetSurfaceMap();
		lego::res::Building_SetPosition
							(liveObj->building,(float)in_liveObj,param_2,lego::res::Res_GetSurfaceMapZ_Callback,
							 pLVar3);
		return;
	}
	if (OVar1 == OBJECT_ROCKMONSTER) {
		lego::game::LiveObject_GetPosition(liveObj,(float *)&in_liveObj,&param_2);
		pLVar3 = lego::game::GetSurfaceMap();
		lego::res::Creature_SetPosition
							(liveObj->rockMonster,(float)in_liveObj,param_2,lego::res::Res_GetSurfaceMapZ_Callback
							 ,pLVar3);
		return;
	}
	if (OVar1 == OBJECT_MINIFIGURE) {
		pRVar4 = lego::game::LiveObject_GetResource(liveObj);
		lego::res::Res_GetPosition(pRVar4,NULL,&local_18);
		local_2c = local_18.x;
		local_28 = local_18.y;
		lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_30,(int *)&in_liveObj);
		BVar5 = lego::game::Level_GetBlockFlags1_10Not8(local_30,(uint)in_liveObj);
		if ((BVar5 != 0) && (iVar6 = FUN_00432ac0(local_30,(int)in_liveObj), iVar6 == 0)) {
			pfVar14 = &local_24.y;
			pVVar13 = &local_24;
			fVar12 = 0.0;
			uVar7 = FUN_00432f00(local_30,(int)in_liveObj);
			fVar10 = local_2c;
			fVar11 = local_28;
			pLVar3 = lego::game::GetSurfaceMap();
			FUN_0044fe50(pLVar3,fVar10,fVar11,uVar7,fVar12,(float *)pVVar13,pfVar14);
			local_24.x = local_24.x - local_2c;
			local_24.y = local_24.y - local_28;
			fVar11 = param_2 * 0.5;
			fVar10 = SQRT(local_24.y * local_24.y + local_24.x * local_24.x);
			if ((ushort)((ushort)(fVar10 < fVar11) << 8 | (ushort)(fVar10 == fVar11) << 0xe) == 0) {
				local_2c = (fVar11 / fVar10) * local_24.x + local_2c;
				local_28 = (fVar11 / fVar10) * local_24.y + local_28;
			}
		}
		pLVar3 = lego::game::GetSurfaceMap();
		fVar11 = local_28;
		fVar10 = local_2c;
		fVar8 = lego::res::Res_GetSurfaceMapZ_Callback(local_2c,local_28,pLVar3);
		local_c.z = (float)fVar8;
		if (((local_18.x == local_2c) && (local_18.y == local_28)) && (local_18.z == local_c.z)) {
			return;
		}
		pLVar3 = lego::game::GetSurfaceMap();
		lego::res::Creature_SetPosition(liveObj->miniFigure,fVar10,fVar11,FUN_00442820,pLVar3);
		return;
	}
	if ((((OVar1 != OBJECT_POWERCRYSTAL) && (OVar1 != OBJECT_ORE)) &&
			((OVar1 != OBJECT_BARRIER && ((OVar1 != OBJECT_DYNAMITE && (OVar1 != OBJECT_ELECTRICFENCE)))))
			) && (OVar1 != OBJECT_SONICBLASTER)) {
		return;
	}
	if (liveObj->carryingThisObject != NULL) {
		return;
	}
	lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_30,(int *)&local_2c);
	if ((liveObj->objType == OBJECT_BARRIER) ||
		 (uVar7 = FUN_00432a30(local_30,(uint)local_2c), uVar7 == 0)) {
LAB_00443554:
		if (liveObj->resData_2dc == NULL) goto LAB_00443614;
	}
	else {
		if (liveObj->resData_2dc == NULL) {
			pRVar4 = (ResourceData *)FUN_0040c4e0(local_30,(uint)local_2c);
			liveObj->resData_2dc = pRVar4;
			local_24.y = 0.0;
			local_24.x = local_2c;
			LVar2 = liveObj->flags3_3e8;
			(liveObj->point_2f4).x = (float)(ulonglong)local_30;
			liveObj->flags3_3e8 = LVar2 & 0xffefffff;
			(liveObj->point_2f4).y = (float)(ulonglong)(uint)local_2c;
			goto LAB_00443554;
		}
	}
	lVar9 = __ftol((float10)(liveObj->point_2f4).y);
	uVar7 = (uint)lVar9;
	lVar9 = __ftol((float10)(liveObj->point_2f4).x);
	uVar7 = FUN_00432a30((uint)lVar9,uVar7);
	if (uVar7 != 0) {
		lego::res::Res_GetPosition(liveObj->resData_2dc,NULL,&local_18);
		fVar10 = local_18.x;
		fVar11 = local_18.y;
		pLVar3 = lego::game::GetSurfaceMap();
		fVar8 = lego::game::SurfaceMap_UnkGetZ(pLVar3,fVar10,fVar11);
		fVar8 = fVar8 - (float10)1.2285;
		if ((ushort)((ushort)((float10)local_18.z < fVar8) << 8 |
								(ushort)((float10)local_18.z == fVar8) << 0xe) == 0) {
			local_18.z = (float)fVar8;
		}
		lego::res::Res_SetFramePosition(liveObj->other,NULL,local_18.x,local_18.y,local_18.z);
		lego::res::Res_SetFrameOrientation(liveObj->other,liveObj->resData_2dc,0.0,0.0,1.0,0.0,1.0,0.0);
		return;
	}
LAB_00443614:
	liveObj->resData_2dc = NULL;
	lego::res::Res_GetPosition(liveObj->other,NULL,&local_24);
	fVar10 = local_24.x;
	fVar11 = local_24.y;
	pLVar3 = lego::game::GetSurfaceMap();
	fVar8 = lego::game::SurfaceMap_UnkGetZ(pLVar3,fVar10,fVar11);
	in_liveObj = (LiveObject *)(float)(fVar8 - (float10)1.2285);
	fVar8 = (fVar8 - (float10)1.2285) - (float10)0.5;
	if ((ushort)((ushort)(fVar8 < (float10)local_24.z) << 8 |
							(ushort)(fVar8 == (float10)local_24.z) << 0xe) == 0) {
		local_24.z = local_24.z + param_2;
		if ((ushort)((ushort)(local_24.z < (float)in_liveObj) << 8 |
								(ushort)(local_24.z == (float)in_liveObj) << 0xe) == 0) {
			local_24.z = (float)in_liveObj;
		}
		lego::res::Res_SetFramePosition(liveObj->other,NULL,local_24.x,local_24.y,local_24.z);
	}
	if ((ushort)((ushort)(local_24.z < (float)in_liveObj - -0.5) << 8 |
							(ushort)(local_24.z == (float)in_liveObj - -0.5) << 0xe) == 0) {
		local_24.z = local_24.z - param_2;
		if (local_24.z < (float)in_liveObj) {
			local_24.z = (float)in_liveObj;
		}
		lego::res::Res_SetFramePosition(liveObj->other,NULL,local_24.x,local_24.y,local_24.z);
	}
	lego::res::Res_GetOrientation(liveObj->other,NULL,&local_18,&local_c);
	if (0.0 <= local_18.z) {
		if ((ushort)((ushort)(local_18.z < 0.0) << 8 | (ushort)(local_18.z == 0.0) << 0xe) == 0) {
			local_18.z = local_18.z - param_2 * 0.05;
			if (local_18.z < 0.0) {
				local_18.z = 0.0;
			}
			lego::res::Res_SetFrameOrientation
								(liveObj->other,NULL,local_18.x,local_18.y,local_18.z,0.0,0.0,-1.0);
		}
		return;
	}
	local_18.z = local_18.z - param_2 * -0.05;
	if ((ushort)((ushort)(local_18.z < 0.0) << 8 | (ushort)(local_18.z == 0.0) << 0xe) == 0) {
		local_18.z = 0.0;
	}
	lego::res::Res_SetFrameOrientation
						(liveObj->other,NULL,local_18.x,local_18.y,local_18.z,0.0,0.0,-1.0);
	return;
}



void __cdecl FUN_004437d0(LiveObject *liveObj)
{
	ResourceData *resData;
	ResourceData *resData_00;
	Vector3F local_48;
	Vector3F local_3c;
	Vector3F local_30;
	Vector3F local_24;
	Vector3F local_18;
	Vector3F local_c;
	
	resData = lego::game::LiveObject_GetResource(liveObj->drivenObject);
	if (liveObj->objType == OBJECT_VEHICLE) {
		resData_00 = lego::res::Vehicle_GetDriverNull(liveObj->vehicle);
		if (resData_00 != NULL) goto LAB_0044380f;
	}
	resData_00 = lego::game::LiveObject_GetResource(liveObj);
LAB_0044380f:
	lego::res::Res_GetPosition(resData,NULL,&local_24);
	lego::res::Res_GetPosition(resData_00,NULL,&local_48);
	if (((local_24.x != local_48.x) || (local_24.y != local_48.y)) || (local_24.z != local_48.z)) {
		lego::res::Res_SetFramePosition(resData,NULL,local_48.x,local_48.y,local_48.z);
	}
	lego::res::Res_GetOrientation(resData,NULL,&local_18,&local_c);
	lego::res::Res_GetOrientation(resData_00,NULL,&local_30,&local_3c);
	if ((((local_18.x != local_30.x) || (local_18.y != local_30.y)) ||
			((local_18.z != local_30.z || ((local_c.x != local_3c.x || (local_c.y != local_3c.y)))))) ||
		 (local_c.z != local_3c.z)) {
		lego::res::Res_SetFrameOrientation
							(resData,NULL,local_30.x,local_30.y,local_30.z,local_3c.x,local_3c.y,local_3c.z);
	}
	return;
}



BOOL __cdecl FUN_00443930(LiveObject *liveObj)
{
	short sVar1;
	BOOL BVar2;
	uint uVar3;
	uint uVar4;
	undefined4 actData;
	
	if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE) {
		BVar2 = FUN_0043bdb0(liveObj);
		if (BVar2 == 0) {
			uVar4 = 0;
			do {
				actData = 1;
				sVar1 = lego::util::randomInt16();
				lego::game::LiveObject_SetActivityUnk(liveObj,(int)sVar1 % 0x15 + ACTIVITY_WAITING1,actData)
				;
				uVar3 = lego::game::Game_UpdateSomeAITasks(liveObj);
				if (uVar3 != 0) {
					liveObj->flags1_3e0 = liveObj->flags1_3e0 | 0x8000;
					return 1;
				}
				uVar4 += 1;
			} while (uVar4 < 5);
			return 0;
		}
	}
	return 0;
}



BOOL __cdecl FUN_004439b0(LiveObject *liveObj)
{
	if ((liveObj->objType == OBJECT_ROCKMONSTER) &&
		 ((liveObj->flags3_3e8 & 0x4000000) != LIVEOBJ3_NONE)) {
		return 1;
	}
	return 0;
}



BOOL __cdecl FUN_004439d0(LiveObject *liveObj,uint *param_2,undefined4 *param_3,undefined4 param_4)
{
	LiveObject *pLVar1;
	uint *puVar2;
	BOOL BVar3;
	int local_8;
	void *local_4;
	
	puVar2 = param_2;
	pLVar1 = liveObj;
	local_8 = 0;
	BVar3 = FUN_00443b00(liveObj,(Point2I *)param_2,&local_8);
	if (BVar3 != 0) {
		return 0;
	}
	BVar3 = FUN_004413b0(pLVar1,*puVar2,puVar2[1],0,0,&local_4,&param_2,&liveObj,FUN_00443b00,&local_8
											);
	if ((BVar3 == 0) &&
		 (BVar3 = FUN_004413b0(pLVar1,*puVar2,puVar2[1],0,0,&local_4,&param_2,&liveObj,FUN_00443b00,
													 &local_8), BVar3 == 0)) {
		return 0;
	}
	*param_3 = *(undefined4 *)((int)local_4 + (int)liveObj * 4 + -4);
	param_3[1] = param_2[(int)&liveObj[-1].pool_m_next + 3];
	std::free(local_4);
	std::free(param_2);
	return 1;
}



void __cdecl FUN_00443ab0(LiveObject *liveObj)
{
	if (((liveObj->objType == OBJECT_ROCKMONSTER) &&
			((liveObj->flags3_3e8 & 0x80000000) != LIVEOBJ3_NONE)) &&
		 ((liveObj->flags2_3e4 & 0x20000000) == LIVEOBJ2_NONE)) {
		liveObj->flags2_3e4 = liveObj->flags2_3e4 | 0x20000000;
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_WAKEUP,0);
		lego::game::Game_UpdateSomeAITasks(liveObj);
	}
	return;
}



BOOL __cdecl FUN_00443b00(LiveObject *liveObj,Point2I *position,int *param_3)
{
	BOOL BVar1;
	int iVar2;
	
	if ((*param_3 == 0) &&
		 (BVar1 = lego::game::Level_GetBlockFlags1_10Not8(position->x,position->y), BVar1 != 0)) {
		return 0;
	}
	iVar2 = FUN_00431cd0(liveObj,position->x,position->y,position->x,position->y,1);
	if (((iVar2 != 0) && (BVar1 = FUN_004330b0(liveObj,position->x,position->y,0.0,NULL), BVar1 == 0))
		 && (BVar1 = lego::game::Level_GetBlockFlags1_180000(position), BVar1 == 0)) {
		return 1;
	}
	return 0;
}



float __cdecl FUN_00443b70(LiveObject *in_liveObj,float param_2)
{
	float fVar1;
	float fVar2;
	char cVar3;
	void *pvVar4;
	LiveObject *liveObj;
	short sVar5;
	LiveFlags3 LVar6;
	LiveFlags1 LVar7;
	LiveObject *pLVar8;
	ObjectStatsFlags1 OVar9;
	LevelSurfaceMap *surfaceMap;
	BOOL BVar10;
	uint uVar11;
	int iVar12;
	float10 in_ST0;
	float10 extraout_ST0;
	float10 extraout_ST0_00;
	float10 extraout_ST0_01;
	float10 extraout_ST0_02;
	float10 extraout_ST0_03;
	float10 extraout_ST0_04;
	float10 extraout_ST0_05;
	float10 extraout_ST0_06;
	float10 extraout_ST0_07;
	float10 extraout_ST0_08;
	float10 fVar13;
	float10 extraout_ST1;
	ulonglong uVar14;
	longlong lVar15;
	float *out_x;
	float *out_y;
	uint local_2c;
	float local_28;
	float local_24;
	float local_20;
	float local_1c;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	liveObj = in_liveObj;
	iVar12 = 0;
	pvVar4 = in_liveObj->routeptr_24;
	local_1c = param_2;
	BVar10 = 1;
	if (pvVar4 == NULL) {
		in_ST0 = (float10)lego::game::LiveObject_UnkDoRouting_FUN_00441c00(in_liveObj,0);
	}
	else {
		if (in_liveObj->objType == OBJECT_VEHICLE) {
			in_liveObj->elapsedTime1 = 0.0;
		}
		if ((in_liveObj->vector_28c).x <= (in_liveObj->vector_28c).y) {
			LVar6 = in_liveObj->flags3_3e8;
			if ((LVar6 & 0x400) != LIVEOBJ3_NONE) {
				uVar11 = in_liveObj->routingBlocksCurrent;
				in_liveObj->flags3_3e8 = LVar6 & 0xfffffbff;
				switch(*(undefined *)((int)pvVar4 + uVar11 * 0x14 + 0x11)) {
				case 2:
					in_liveObj->flags1_3e0 = in_liveObj->flags1_3e0 | LIVEOBJ1_REINFORCING;
					break;
				case 3:
					in_liveObj->flags1_3e0 = in_liveObj->flags1_3e0 | 0x200;
					break;
				case 4:
					in_liveObj->flags1_3e0 = in_liveObj->flags1_3e0 | LIVEOBJ1_CLEARING;
					break;
				case 5:
					in_liveObj->flags1_3e0 = in_liveObj->flags1_3e0 | 0x800;
					break;
				case 6:
					in_liveObj->flags1_3e0 = in_liveObj->flags1_3e0 | 0x1000000;
					break;
				case 7:
					in_liveObj->flags1_3e0 = in_liveObj->flags1_3e0 | 0x2000;
					break;
				case 8:
					FUN_0043a130(in_liveObj,1);
					break;
				case 9:
					in_liveObj->flags1_3e0 = in_liveObj->flags1_3e0 | LIVEOBJ1_PLACING;
					break;
				case 10:
					in_liveObj->flags1_3e0 = in_liveObj->flags1_3e0 | 0x20000;
					break;
				case 0xb:
					in_liveObj->flags1_3e0 = in_liveObj->flags1_3e0 | LIVEOBJ1_EATING;
					break;
				case 0xc:
					in_liveObj->flags2_3e4 = in_liveObj->flags2_3e4 | 4;
					break;
				case 0xd:
					in_liveObj->flags2_3e4 = in_liveObj->flags2_3e4 | 0x40;
					break;
				case 0xe:
					in_liveObj->flags2_3e4 = in_liveObj->flags2_3e4 | LIVEOBJ2_TRAINING;
					break;
				case 0xf:
					in_liveObj->flags2_3e4 = in_liveObj->flags2_3e4 | LIVEOBJ2_UPGRADING;
					break;
				case 0x10:
					in_liveObj->flags2_3e4 = in_liveObj->flags2_3e4 | 0x200000;
					break;
				case 0x11:
					in_liveObj->flags2_3e4 = in_liveObj->flags2_3e4 | 0x4000000;
					break;
				case 0x12:
					in_liveObj->flags2_3e4 = in_liveObj->flags2_3e4 | 0x10000000;
					break;
				case 0x13:
					FUN_00444360(in_liveObj);
					break;
				case 0x14:
					FUN_00403c40(in_liveObj,0x1d,NULL,1);
					break;
				case 0x15:
					in_liveObj->flags2_3e4 = in_liveObj->flags2_3e4 | 0x80000000;
				}
				if ((*(byte *)((int)pvVar4 + uVar11 * 0x14 + 0x10) & 0x20) != 0) {
					liveObj->flags2_3e4 = liveObj->flags2_3e4 | 0x80000;
				}
				in_ST0 = (float10)lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,1);
				if ((liveObj->flags1_3e0 & 0x8000000) != LIVEOBJ1_NONE) {
					sVar5 = lego::util::randomInt16();
					uVar14 = __ftol((float10)10.0 / (float10)param_2);
					if ((int)((ulonglong)(uint)(int)sVar5 % (uVar14 & 0xffffffff)) != 0) {
						FUN_00433b40((int *)liveObj,150.0,1);
						return (float)extraout_ST0_00;
					}
					liveObj->flags1_3e0 = liveObj->flags1_3e0 & 0xf7ffffff;
					return (float)extraout_ST0;
				}
				goto LAB_004442ff;
			}
			if (in_liveObj->routingBlocksTotal < 2) {
				in_liveObj->flags3_3e8 = LVar6 | 0x400;
				*(byte *)((int)pvVar4 + in_liveObj->routingBlocksCurrent * 0x14 + 0x10) =
						 *(byte *)((int)pvVar4 + in_liveObj->routingBlocksCurrent * 0x14 + 0x10) | 8;
			}
			else {
				uVar11 = in_liveObj->routingBlocksCurrent + 1;
				in_liveObj->routingBlocksCurrent = uVar11;
				if (((*(byte *)((int)pvVar4 + uVar11 * 0x14 + 0x10) & 0x10) != 0) &&
					 (*(char *)((int)pvVar4 + uVar11 * 0x14 + 0x11) != '\x01')) {
					iVar12 = 1;
				}
			}
			uVar11 = in_liveObj->routingBlocksCurrent;
			if (iVar12 != 0) {
				uVar11 += 1;
			}
			if (*(char *)((int)pvVar4 + uVar11 * 0x14 + 0x11) == '\x05') {
				FUN_00447a90(in_liveObj);
			}
			BVar10 = FUN_00444940(liveObj,iVar12,liveObj->flags3_3e8 & 8,~liveObj->flags1_3e0 >> 10 & 1);
			in_ST0 = extraout_ST0_01;
			if (liveObj->routingBlocksTotal - 1 <= liveObj->routingBlocksCurrent) {
				liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x400;
			}
		}
		if (BVar10 != 0) {
			if ((((((*(byte *)&liveObj->flags1_3e0 & 8) == 0) &&
						(*(char *)((int)pvVar4 + liveObj->routingBlocksCurrent * 0x14 + 0x11) == '\x01')) &&
					 (BVar10 = lego::game::LiveObject_GetDrillNullPosition(liveObj,&local_20,&local_24),
					 BVar10 != 0)) &&
					((iVar12 = FUN_00433b10(local_20,local_24,(int *)&in_liveObj,(int *)&local_2c),
					 iVar12 != 0 &&
					 (BVar10 = lego::game::Level_GetBlockFlags1_10Not8((uint)in_liveObj,local_2c), BVar10 != 0
					 )))) && ((in_liveObj ==
										 *(LiveObject **)((int)pvVar4 + liveObj->routingBlocksCurrent * 0x14) &&
										(local_2c == *(uint *)((int)pvVar4 + liveObj->routingBlocksCurrent * 0x14 + 4)))
									 )) {
				BVar10 = 1;
				LVar6 = liveObj->flags3_3e8 & 0x2000000;
				lVar15 = __ftol((float10)(liveObj->point_2f4).y);
				uVar11 = (uint)lVar15;
				lVar15 = __ftol((float10)(liveObj->point_2f4).x);
				BVar10 = FUN_004326a0(liveObj,(uint)lVar15,uVar11,LVar6,BVar10);
				if (BVar10 == 0) {
					LVar7 = liveObj->flags1_3e0 | 0x80000000;
				}
				else {
					LVar7 = liveObj->flags1_3e0 | 0x18;
				}
				liveObj->flags1_3e0 = LVar7;
			}
			FUN_004468d0(liveObj,param_2,&local_28,&local_1c);
			if ((liveObj->flags3_3e8 & 0x4000) == LIVEOBJ3_NONE) {
				(liveObj->vector_28c).y = local_28 + (liveObj->vector_28c).y;
			}
			fVar1 = (liveObj->vector_28c).y;
			fVar2 = (liveObj->vector_28c).x;
			if ((ushort)((ushort)(fVar1 < fVar2) << 8 | (ushort)(fVar1 == fVar2) << 0xe) == 0) {
				fVar1 = (liveObj->vector_28c).y;
				(liveObj->vector_28c).y = (liveObj->vector_28c).x;
				(liveObj->vector_28c).z = fVar1 - (liveObj->vector_28c).x;
			}
			FUN_004067f0((uint *)&liveObj->value_30,(liveObj->vector_28c).y,&local_18);
			cVar3 = *(char *)((int)pvVar4 + liveObj->routingBlocksCurrent * 0x14 + 0x11);
			in_ST0 = extraout_ST0_02;
			if (cVar3 == '\x03') {
				if (liveObj->object_2fc != NULL) {
					lego::game::LiveObject_GetPosition(liveObj->object_2fc,&local_8,&local_4);
					local_10 = local_8 - local_18;
					local_c = local_4 - local_14;
					param_2 = SQRT(local_c * local_c + local_10 * local_10);
					in_ST0 = extraout_ST0_03;
					if ((ushort)((ushort)(param_2 < 6.6) << 8 | (ushort)(param_2 == 6.6) << 0xe) != 0) {
						liveObj->flags1_3e0 = liveObj->flags1_3e0 | 0x200;
						in_ST0 = (float10)lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,1);
						if ((liveObj->objType == OBJECT_MINIFIGURE) && (param_2 != 0.0)) {
							lego::res::Creature_SetOrientation(liveObj->miniFigure,local_10,local_c);
							(liveObj->faceDirection).x = local_10;
							(liveObj->faceDirection).y = local_c;
							return (float)extraout_ST0_04;
						}
						goto LAB_004442ff;
					}
				}
			}
			else {
				if (cVar3 == '\f') {
					if (liveObj->object_2fc != NULL) {
						lego::game::LiveObject_GetPosition(liveObj->object_2fc,&local_8,&local_4);
						param_2 = SQRT((local_14 - local_4) * (local_14 - local_4) +
													 (local_18 - local_8) * (local_18 - local_8));
						fVar13 = lego::game::LiveObject_GetCollRadius(liveObj->object_2fc);
						in_ST0 = extraout_ST1;
						if ((ushort)((ushort)((float10)param_2 < fVar13) << 8 |
												(ushort)((float10)param_2 == fVar13) << 0xe) != 0) {
							liveObj->flags2_3e4 = liveObj->flags2_3e4 | 4;
							fVar13 = (float10)lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,1);
							return (float)fVar13;
						}
					}
				}
				else {
					if ((cVar3 == '\t') &&
						 ((*(byte *)((int)pvVar4 + liveObj->routingBlocksCurrent * 0x14 + 0x10) & 0xc) == 0)) {
						uVar11 = liveObj->value_30;
						local_8 = liveObj->floats_34[uVar11 * 2 + -2];
						local_4 = liveObj->floats_34[uVar11 * 2 + -1];
						param_2 = local_18 - local_8;
						fVar1 = SQRT((local_14 - local_4) * (local_14 - local_4) + param_2 * param_2);
						if ((ushort)((ushort)(fVar1 < 6.0) << 8 | (ushort)(fVar1 == 6.0) << 0xe) != 0) {
							liveObj->flags1_3e0 = liveObj->flags1_3e0 | LIVEOBJ1_PLACING;
							fVar13 = (float10)lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,1);
							return (float)fVar13;
						}
					}
				}
			}
			if (((((liveObj->flags3_3e8 & 0x800) == LIVEOBJ3_NONE) &&
					 (cVar3 = *(char *)((int)pvVar4 + liveObj->routingBlocksCurrent * 0x14 + 0x11),
					 cVar3 != '\a')) && (cVar3 != '\x06')) &&
				 (((cVar3 != '\x03' && (cVar3 != '\x05')) &&
					(pLVar8 = (LiveObject *)FUN_00446030(liveObj,&local_18,0,0), in_ST0 = extraout_ST0_05,
					pLVar8 != NULL)))) {
				OVar9 = lego::game::LiveObject_GetStatsFlags1(liveObj);
				if (((OVar9 & STATS1_BUMPDAMAGE) != STATS1_NONE) && (pLVar8->objType == OBJECT_VEHICLE)) {
					lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,0);
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_REPAIR,0);
					lego::game::Game_UpdateSomeAITasks(liveObj);
					liveObj->object_2fc = pLVar8;
					liveObj->flags2_3e4 = liveObj->flags2_3e4 | 0x40000;
					return (float)extraout_ST0_06;
				}
				FUN_00444940(liveObj,0,0,0);
				fVar1 = (liveObj->vector_28c).y;
				liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x800;
				(liveObj->vector_28c).y = local_28 + fVar1;
				in_ST0 = extraout_ST0_07;
			}
			if ((liveObj->flags3_3e8 & 0x4000) == LIVEOBJ3_NONE) {
				in_ST0 = (float10)FUN_004428b0(liveObj,local_18,local_14);
			}
			if ((*(char *)((int)pvVar4 + liveObj->routingBlocksTotal * 0x14 + -3) == '\x04') &&
				 (liveObj->objType == OBJECT_VEHICLE)) {
				out_y = &local_4;
				out_x = &local_8;
				surfaceMap = lego::game::GetSurfaceMap();
				lego::game::SurfaceMap_ToBlockCoordinatesNoZ
									(surfaceMap,local_18,local_14,(int *)out_x,(int *)out_y);
				in_ST0 = extraout_ST0_08;
				if ((local_8 == *(float *)((int)pvVar4 + liveObj->routingBlocksTotal * 0x14 + -0x14)) &&
					 (local_4 == *(float *)((int)pvVar4 + liveObj->routingBlocksTotal * 0x14 + -0x10))) {
					liveObj->flags1_3e0 = liveObj->flags1_3e0 | LIVEOBJ1_CLEARING;
					fVar13 = (float10)lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,1);
					return (float)fVar13;
				}
			}
		}
	}
LAB_004442ff:
	return (float)in_ST0;
}



void __cdecl FUN_00444360(LiveObject *liveObj)
{
	LiveObject *pLVar1;
	
	pLVar1 = liveObj->object_2fc;
	if ((pLVar1 != NULL) && (pLVar1->objType == OBJECT_BUILDING)) {
		liveObj->flags4_3ec = liveObj->flags4_3ec | 0x40;
		pLVar1->flags4_3ec = pLVar1->flags4_3ec | 0x40;
		FUN_00403c40(liveObj,0x1c,NULL,1);
	}
	return;
}



void __cdecl FUN_004443b0(LiveObject *liveObj,float elapsed)
{
	uint uVar1;
	float10 fVar2;
	Point2I local_8;
	
	if (((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) &&
		 ((liveObj->objType != OBJECT_ROCKMONSTER ||
			(liveObj->carriedObjects[0]->objType == OBJECT_BOULDER)))) {
		fVar2 = lego::game::LiveObject_GetCarryMinHealth(liveObj);
		if ((fVar2 < (float10)liveObj->health) && ((*(byte *)&liveObj->flags4_3ec & 0x20) == 0)) {
			fVar2 = lego::game::LiveObject_GetRestPercent(liveObj);
			if ((((float)(fVar2 * (float10)0.01) != 0.0) && ((*(byte *)&liveObj->flags1_3e0 & 4) == 0)) &&
				 ((float)(fVar2 * (float10)0.01) * liveObj->health < liveObj->float_33c * 0.04)) {
				lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_8,&local_8.y);
				uVar1 = lego::game::Level_IsBlockLava(&local_8);
				if (((uVar1 == 0) &&
						((lego::globals::g_Game.level)->blocks
						 [((lego::globals::g_Game.level)->dimensions).width * local_8.y + local_8.x].terrain !=
						 TERRAIN_LAKE)) && (liveObj->routingBlocksCurrent != liveObj->routingBlocksTotal - 1)) {
					liveObj->float_33c = 0.0;
					liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x4000;
					liveObj->flags1_3e0 = liveObj->flags1_3e0 | LIVEOBJ1_REST;
					lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_REST,0);
					lego::game::Game_UpdateSomeAITasks(liveObj);
				}
			}
			liveObj->float_33c = elapsed + liveObj->float_33c;
			return;
		}
		FUN_0043a130(liveObj,0);
	}
	return;
}



BOOL __cdecl FUN_00444520(LiveObject *liveObj)
{
	int iVar1;
	short sVar2;
	BOOL BVar3;
	int iVar4;
	int iVar5;
	LevelSurfaceMap *surfMap;
	uint uVar6;
	uint y;
	float10 fVar7;
	float *pfVar8;
	int local_90;
	float *local_8c;
	int local_88;
	float *local_84;
	uint local_80;
	uint local_7c;
	float local_78;
	float local_74;
	int local_70 [4];
	undefined4 local_60;
	undefined4 local_5c;
	undefined4 local_58;
	undefined4 local_54;
	undefined4 local_50;
	undefined4 local_4c;
	undefined4 local_48;
	undefined4 local_44;
	undefined4 local_40;
	undefined4 local_3c;
	undefined4 local_38;
	undefined4 local_34;
	float local_30;
	float local_2c;
	float local_18;
	float local_14;
	
	local_70[0] = -1;
	local_70[1] = 0;
	local_70[2] = 0xffffffff;
	local_70[3] = 1;
	local_60 = 0;
	local_5c = 1;
	local_58 = 1;
	local_54 = 1;
	local_50 = 1;
	local_4c = 0;
	local_48 = 1;
	local_44 = 0xffffffff;
	local_40 = 0;
	local_3c = 0xffffffff;
	local_38 = 0xffffffff;
	local_34 = 0xffffffff;
	BVar3 = FUN_0043bdb0(liveObj);
	if (BVar3 != 0) {
		return 0;
	}
	lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_90,&local_88);
	local_80 = 0;
	do {
		sVar2 = lego::util::randomInt16();
		uVar6 = (int)sVar2 >> 0x1f;
		iVar4 = (((int)sVar2 ^ uVar6) - uVar6 & 7 ^ uVar6) - uVar6;
		iVar1 = local_70[iVar4 * 2 + 1];
		iVar4 = local_70[iVar4 * 2];
		iVar5 = FUN_00431cd0(liveObj,local_90 + iVar4,local_88 + iVar1,local_90 + iVar4,local_88 + iVar1
												 ,0);
		if (iVar5 != 0) {
			pfVar8 = &local_30;
			y = local_88 + iVar1;
			uVar6 = local_90 + iVar4;
			surfMap = lego::game::GetSurfaceMap();
			FUN_00450390(surfMap,uVar6,y,pfVar8);
			fVar7 = lego::game::Game_ChooseRandomRange(local_30 - -1.0,local_18 - 1.0);
			local_78 = (float)fVar7;
			fVar7 = lego::game::Game_ChooseRandomRange(local_2c - -1.0,local_14 - 1.0);
			local_74 = (float)fVar7;
			BVar3 = FUN_004413b0(liveObj,local_90,local_88,local_90 + iVar4,local_88 + iVar1,&local_8c,
													 &local_84,&local_7c,0,0);
			if (BVar3 != 0) {
				BVar3 = FUN_004419c0(liveObj,local_7c,local_8c,local_84,&local_78);
				if (BVar3 != 0) {
					std::free(local_8c);
					std::free(local_84);
					return 1;
				}
				std::free(local_8c);
				std::free(local_84);
			}
		}
		local_80 += 1;
	} while (local_80 < 0x10);
	return 0;
}



void __cdecl FUN_00444720(LiveObject *in_liveObj,float *param_2)
{
	LiveObject *liveObj;
	BOOL BVar1;
	LevelSurfaceMap *surfaceMap;
	float in_x;
	float in_y;
	char **out_x;
	VehicleData **out_y;
	VehicleData **local_20;
	uint local_1c;
	float local_18;
	float local_14;
	char *local_10;
	VehicleData *local_c;
	char *local_8;
	VehicleData *local_4;
	
	liveObj = in_liveObj;
	lego::game::LiveObject_GetBlockCoordinates(in_liveObj,(int *)&local_10,(int *)&local_c);
	if (((((liveObj->flags1_3e0 & 0x800000) == LIVEOBJ1_NONE) &&
			 (BVar1 = FUN_00438870(liveObj,1), BVar1 != 0)) && (BVar1 = FUN_004294f0(liveObj), BVar1 == 0)
			) && ((liveObj->drivenObject == NULL &&
						(BVar1 = lego::game::Level_GetBlockFlags1_10Not8((uint)local_10,(uint)local_c),
						BVar1 == 0)))) {
		FUN_00441df0(liveObj,1,1);
		lego::game::LiveObject_GetPosition(liveObj,&local_18,&local_14);
		out_x = &local_8;
		in_x = lego::globals::g_Game.MiniFigureRunAway * *param_2 + local_18;
		out_y = &local_4;
		in_y = param_2[1] * lego::globals::g_Game.MiniFigureRunAway + local_14;
		local_18 = in_x;
		local_14 = in_y;
		surfaceMap = lego::game::GetSurfaceMap();
		BVar1 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
											(surfaceMap,in_x,in_y,(int *)out_x,(int *)out_y);
		if (BVar1 != 0) {
			if ((local_8 == local_10) && (local_4 == local_c)) {
				in_liveObj = (LiveObject *)&local_10;
				local_20 = &local_c;
				local_1c = 1;
			}
			else {
				BVar1 = FUN_004413b0(liveObj,local_10,local_c,local_8,local_4,&in_liveObj,&local_20,
														 &local_1c,0,0);
				if (BVar1 == 0) {
					return;
				}
			}
			BVar1 = FUN_004419c0(liveObj,local_1c,(float *)in_liveObj,(float *)local_20,&local_18);
			if (BVar1 != 0) {
				*(byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -4) =
						 *(byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -4) | 0x40;
			}
			std::free(in_liveObj);
			std::free(local_20);
			liveObj->flags1_3e0 = liveObj->flags1_3e0 | 0x800000;
			FUN_00407380(liveObj);
		}
	}
	return;
}



void __cdecl FUN_004448e0(LiveObject *liveObj)
{
	if (((liveObj->flags1_3e0 & 0x4000000) == LIVEOBJ1_NONE) && (liveObj->drivenObject == NULL)) {
		FUN_00441df0(liveObj,0,1);
		liveObj->flags1_3e0 = liveObj->flags1_3e0 | 0x4000000;
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_SLIP,0);
		lego::game::Game_UpdateSomeAITasks(liveObj);
		FUN_00403e60(liveObj);
	}
	return;
}



BOOL __cdecl FUN_00444940(LiveObject *liveObj,int param_2,int param_3,int param_4)
{
	Vector3F *out_vector;
	uint *puVar1;
	byte bVar2;
	LiveFlags1 LVar3;
	LiveFlags3 LVar4;
	LevelSurfaceMap *pLVar5;
	uint uVar6;
	float fVar7;
	BOOL BVar8;
	int iVar9;
	uint uVar10;
	float *pfVar11;
	float fVar12;
	undefined4 unaff_EDI;
	float10 fVar13;
	float fVar14;
	uint uVar15;
	uint y;
	float fVar16;
	float *pfVar17;
	ActivityType AVar18;
	float local_74;
	float local_70;
	float local_6c;
	float local_68;
	undefined4 local_64;
	BOOL local_60;
	uint local_5c;
	uint local_58;
	float local_54;
	float local_50;
	float local_4c;
	float local_48;
	float local_44;
	float local_40;
	float local_3c;
	float local_38;
	float local_34;
	float local_30;
	Vector3F local_2c;
	float local_20 [4];
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_6c = 0.0;
	local_70 = 0.0;
	local_60 = 1;
	uVar10 = *(uint *)((int)liveObj->routeptr_24 + liveObj->routingBlocksCurrent * 0x14);
	y = *(uint *)((int)liveObj->routeptr_24 + liveObj->routingBlocksCurrent * 0x14 + 4);
	lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_58,(int *)&local_5c);
	lego::game::LiveObject_GetPosition(liveObj,&local_3c,&local_38);
	local_44 = (liveObj->faceDirection).x;
	local_40 = (liveObj->faceDirection).y;
	out_vector = &liveObj->faceDirection;
	if (param_2 == 0) {
		pfVar11 = &local_48;
		pfVar17 = &local_4c;
		pLVar5 = lego::game::GetSurfaceMap();
		FUN_0044f900(pLVar5,uVar10,y,pfVar17,pfVar11);
	}
	else {
		pfVar11 = &local_30;
		uVar6 = *(uint *)((int)liveObj->routeptr_24 + liveObj->routingBlocksCurrent * 0x14 + 4);
		pfVar17 = &local_34;
		uVar15 = *(uint *)((int)liveObj->routeptr_24 + liveObj->routingBlocksCurrent * 0x14);
		pLVar5 = lego::game::GetSurfaceMap();
		FUN_0044f900(pLVar5,uVar15,uVar6,pfVar17,pfVar11);
		uVar6 = liveObj->routingBlocksCurrent + 1;
		liveObj->routingBlocksCurrent = uVar6;
		pfVar11 = &local_48;
		pfVar17 = &local_4c;
		puVar1 = (uint *)((int)liveObj->routeptr_24 + uVar6 * 0x14);
		uVar6 = *puVar1;
		uVar15 = puVar1[1];
		pLVar5 = lego::game::GetSurfaceMap();
		FUN_0044f900(pLVar5,uVar6,uVar15,pfVar17,pfVar11);
		local_58 = uVar10;
		local_5c = y;
	}
	pfVar17 = &local_50;
	pfVar11 = &local_54;
	pLVar5 = lego::game::GetSurfaceMap();
	FUN_0044f900(pLVar5,local_58,local_5c,pfVar11,pfVar17);
	fVar12 = local_6c;
	fVar7 = local_70;
	if (*(char *)((int)liveObj->routeptr_24 + liveObj->routingBlocksCurrent * 0x14 + 0x11) != '\x01')
	{
		pfVar11 = &local_74;
		pfVar17 = &local_70;
		fVar12 = local_4c;
		fVar7 = local_48;
		pLVar5 = lego::game::GetSurfaceMap();
		lego::game::SurfaceMap_ToBlockCoordinatesNoZ(pLVar5,fVar12,fVar7,(int *)pfVar17,(int *)pfVar11);
		fVar7 = (float)FUN_00432f00((int)local_70,(int)local_74);
		BVar8 = lego::game::Level_GetBlockFlags1_10Not8((uint)local_70,(uint)local_74);
		fVar12 = local_6c;
		if ((BVar8 != 0) &&
			 (iVar9 = FUN_00432ac0((int)local_70,(int)local_74), fVar12 = local_6c, iVar9 == 0)) {
			uVar10 = FUN_00432f30((int)local_70,(int)local_74);
			if (uVar10 != 0) {
				if (ABS(local_4c - local_54) <= ABS(local_48 - local_50)) {
					local_20[0] = 0.1;
					local_20[1] = 0.0;
					local_20[2] = -0.1;
					local_20[3] = 0.0;
					local_10 = 0xbdcccccd;
					local_c = 0;
					local_8 = 0x3dcccccd;
					local_4 = 0;
					uVar10 = FUN_004331f0((int)local_70,(int)local_74);
					pfVar11 = local_20 + uVar10 * 2;
				}
				else {
					local_20[0] = 0.0;
					local_20[1] = -0.1;
					local_20[2] = 0.0;
					local_20[3] = -0.1;
					local_10 = 0;
					local_c = 0x3dcccccd;
					local_8 = 0;
					local_4 = 0x3dcccccd;
					uVar10 = FUN_004331f0((int)local_70,(int)local_74);
					pfVar11 = local_20 + uVar10 * 2;
				}
				local_4c = *pfVar11 + local_4c;
				local_48 = pfVar11[1] + local_48;
			}
			pfVar11 = &local_48;
			pfVar17 = &local_4c;
			fVar16 = 0.05;
			uVar10 = FUN_00432f00((int)local_70,(int)local_74);
			fVar12 = local_4c;
			fVar14 = local_48;
			pLVar5 = lego::game::GetSurfaceMap();
			FUN_0044fe50(pLVar5,fVar12,fVar14,uVar10,fVar16,pfVar17,pfVar11);
			fVar12 = 1.401298e-45;
		}
	}
	if (fVar12 == 0.0) {
		pLVar5 = lego::game::GetSurfaceMap();
		fVar13 = lego::game::SurfaceMap_GetFloat10(pLVar5);
		local_6c = (float)(((float10)*(float *)((int)liveObj->routeptr_24 +
																					 liveObj->routingBlocksCurrent * 0x14 + 8) - (float10)0.5)
											* fVar13);
		pLVar5 = lego::game::GetSurfaceMap();
		fVar13 = lego::game::SurfaceMap_GetFloat10(pLVar5);
		local_68 = (float)(((float10)*(float *)((int)liveObj->routeptr_24 +
																					 liveObj->routingBlocksCurrent * 0x14 + 0xc) -
											 (float10)0.5) * fVar13);
		local_4c = local_6c + local_4c;
		local_48 = local_68 + local_48;
	}
	bVar2 = *(byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksCurrent * 0x14 + 0x10);
	if ((bVar2 & 4) == 0) {
		if ((bVar2 & 0x40) == 0) {
			if (((bVar2 & 8) != 0) && ((local_6c != 0.0 || (local_68 != 0.0)))) {
				local_54 = local_6c;
				local_50 = local_68;
				goto LAB_00444e0b;
			}
			local_54 = local_4c - local_54;
			fVar14 = local_48 - local_50;
			local_50 = fVar14;
			if ((fVar12 != 0.0) && (fVar7 == 0.0)) {
				local_50 = fVar7;
				if (ABS(local_54) <= ABS(fVar14)) {
					local_54 = 0.0;
					local_50 = fVar14;
				}
				goto LAB_00444e0b;
			}
			if ((local_54 != 0.0) || (fVar14 != 0.0)) goto LAB_00444e0b;
		}
		local_54 = local_4c - local_3c;
		local_50 = local_48 - local_38;
		goto LAB_00444e0b;
	}
	switch(bVar2 & 3) {
	case 0:
		local_54 = 0.0;
		local_50 = 1.0;
		param_3 = 0;
		goto LAB_00444e0b;
	case 1:
		local_54 = 1.0;
		break;
	case 2:
		local_54 = 0.0;
		local_50 = -1.0;
		param_3 = 0;
		goto LAB_00444e0b;
	case 3:
		local_54 = -1.0;
		break;
	default:
		goto switchD_00444cce_caseD_4;
	}
	local_50 = 0.0;
switchD_00444cce_caseD_4:
	param_3 = 0;
LAB_00444e0b:
	if (param_3 != 0) {
		local_2c.x = local_4c - local_3c;
		fVar12 = local_48 - local_38;
		local_2c.z = 0.0;
		local_64 = 0;
		local_2c.y = 1.0 / SQRT(fVar12 * fVar12 + local_2c.x * local_2c.x);
		local_68 = 1.0 / SQRT(local_40 * local_40 + local_44 * local_44);
		fVar7 = 1.0 / SQRT(local_50 * local_50 + local_54 * local_54);
		local_2c.x = local_2c.y * local_2c.x;
		local_2c.y = local_2c.y * fVar12;
		local_6c = local_68 * local_44;
		local_68 = local_68 * local_40;
		local_74 = fVar7 * local_50 * local_68 + fVar7 * local_54 * local_6c;
		local_70 = local_2c.y * local_68 + local_2c.x * local_6c + 0.0;
		if (((param_4 == 0) ||
				((ushort)((ushort)(local_74 < 0.7) << 8 | (ushort)(local_74 == 0.7) << 0xe) != 0)) ||
			 (-0.7 <= local_70)) {
			if (((((ushort)((ushort)(local_74 < 0.0) << 8 | (ushort)(local_74 == 0.0) << 0xe) != 0) &&
					 (local_70 < 0.7)) &&
					((ushort)((ushort)(ABS(local_70) < 0.1) << 8 | (ushort)(ABS(local_70) == 0.1) << 0xe) == 0
					)) || (BVar8 = FUN_00445860(liveObj), BVar8 != 0)) {
				if (-0.9 <= local_74) {
					fVar12 = local_2c.x * (liveObj->faceDirection).z;
					fVar7 = local_2c.x * (liveObj->faceDirection).y;
					fVar14 = out_vector->x * local_2c.y;
					local_2c.x = local_2c.y * (liveObj->faceDirection).z -
											 local_2c.z * (liveObj->faceDirection).y;
					local_2c.y = out_vector->x * local_2c.z - fVar12;
					local_2c.z = fVar7 - fVar14;
					lego::math::Vector3_Rotate(out_vector,out_vector,&local_2c,-1.570796);
					if (liveObj->objType != OBJECT_VEHICLE) {
						local_44 = out_vector->x;
						local_40 = (liveObj->faceDirection).y;
					}
					if ((ushort)((ushort)(local_2c.z < 0.0) << 8 | (ushort)(local_2c.z == 0.0) << 0xe) == 0) {
						if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE) {
							AVar18 = ACTIVITY_TURNRIGHT;
						}
						else {
							AVar18 = ACTIVITY_CARRYTURNRIGHT;
						}
					}
					else {
						if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE) {
							AVar18 = ACTIVITY_TURNLEFT;
						}
						else {
							AVar18 = ACTIVITY_CARRYTURNLEFT;
						}
					}
					lego::game::LiveObject_SetActivityUnk(liveObj,AVar18,1);
				}
				else {
					if (liveObj->objType != OBJECT_VEHICLE) {
						local_44 = -out_vector->x;
						out_vector->x = local_44;
						local_40 = -(liveObj->faceDirection).y;
						(liveObj->faceDirection).y = local_40;
					}
					if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE) {
						AVar18 = ACTIVITY_TURNRIGHT;
					}
					else {
						AVar18 = ACTIVITY_CARRYTURNRIGHT;
					}
					lego::game::LiveObject_SetActivityUnk(liveObj,AVar18,0);
					if (liveObj->objType != OBJECT_VEHICLE) {
						liveObj->flags1_3e0 = liveObj->flags1_3e0 | LIVEOBJ1_TURNRIGHT;
					}
				}
				LVar3 = liveObj->flags1_3e0;
				liveObj->flags1_3e0 = LVar3 | LIVEOBJ1_TURNING;
				if (liveObj->objType != OBJECT_VEHICLE) {
					local_60 = 0;
					liveObj->flags1_3e0 = LVar3 & ~LIVEOBJ1_MOVING | LIVEOBJ1_TURNING;
				}
			}
		}
		else {
			local_44 = -local_44;
			local_40 = -local_40;
			local_54 = -local_54;
			local_50 = -local_50;
			liveObj->flags1_3e0 = liveObj->flags1_3e0 | LIVEOBJ1_UNK_2_LEFTING;
		}
	}
	local_6c = SQRT((local_38 - local_48) * (local_38 - local_48) +
									(local_3c - local_4c) * (local_3c - local_4c)) * 0.2;
	if ((ushort)((ushort)(local_6c < 0.1) << 8 | (ushort)(local_6c == 0.1) << 0xe) == 0) {
		fVar12 = (float)FUN_0048eb30(SUB84((double)local_44,0),
																 CONCAT44(unaff_EDI,(int)((ulonglong)(double)local_44 >> 0x20)));
		if (fVar12 == 0.0) {
			local_44 = 1.0;
			local_40 = fVar12;
		}
		FUN_00406690(&local_44,local_6c);
		FUN_00406690(&local_54,local_6c * 1.6);
		FUN_00406750((uint *)&liveObj->value_30,&local_3c,&local_44,&local_4c,&local_54,0x32);
		FUN_004454a0(liveObj);
	}
	else {
		liveObj->floats_34[0] = local_3c;
		liveObj->floats_34[1] = local_38;
		liveObj->value_30 = 0;
	}
	fVar13 = FUN_004066e0((uint *)&liveObj->value_30);
	LVar4 = liveObj->flags3_3e8;
	fVar12 = (liveObj->vector_28c).z;
	(liveObj->vector_28c).x = (float)fVar13;
	(liveObj->point_298).x = local_54;
	liveObj->flags3_3e8 = LVar4 & 0xfffff7ff;
	(liveObj->vector_28c).y = fVar12;
	(liveObj->point_298).y = local_50;
	return local_60;
}



void __cdecl FUN_00445270(LiveObject *liveObj,Point2F *point)
{
	Vector3F *out_vector;
	float fVar1;
	float fVar2;
	float fVar3;
	LiveFlags1 LVar4;
	ActivityType actType;
	float10 fVar5;
	Vector3F local_c;
	
	if (liveObj->objType != OBJECT_MINIFIGURE) {
		return;
	}
	fVar1 = (liveObj->faceDirection).y;
	fVar2 = (liveObj->faceDirection).z;
	out_vector = &liveObj->faceDirection;
	local_c.x = point->x;
	fVar3 = point->y;
	local_c.z = 0.0;
	fVar1 = 1.0 / SQRT(out_vector->x * out_vector->x + fVar2 * fVar2 + fVar1 * fVar1);
	local_c.y = 1.0 / SQRT(fVar3 * fVar3 + local_c.x * local_c.x);
	local_c.x = local_c.y * local_c.x;
	out_vector->x = out_vector->x * fVar1;
	local_c.y = local_c.y * fVar3;
	(liveObj->faceDirection).y = fVar1 * (liveObj->faceDirection).y;
	(liveObj->faceDirection).z = fVar1 * (liveObj->faceDirection).z;
	fVar5 = (float10)FUN_0048e350();
	fVar1 = (float)fVar5;
	lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,0);
	if ((ushort)((ushort)(fVar1 < 2.356194) << 8 | (ushort)(fVar1 == 2.356194) << 0xe) == 0) {
		LVar4 = liveObj->flags1_3e0;
		out_vector->x = -out_vector->x;
		(liveObj->faceDirection).y = -(liveObj->faceDirection).y;
		liveObj->flags1_3e0 = LVar4 | LIVEOBJ1_TURNRIGHT;
	}
	else {
		if ((ushort)((ushort)(fVar1 < 0.7853982) << 8 | (ushort)(fVar1 == 0.7853982) << 0xe) != 0) {
			return;
		}
		fVar1 = local_c.x * (liveObj->faceDirection).z;
		fVar2 = local_c.x * (liveObj->faceDirection).y;
		fVar3 = out_vector->x * local_c.y;
		local_c.x = local_c.y * (liveObj->faceDirection).z - local_c.z * (liveObj->faceDirection).y;
		local_c.y = out_vector->x * local_c.z - fVar1;
		local_c.z = fVar2 - fVar3;
		lego::math::Vector3_Rotate(out_vector,out_vector,&local_c,-1.570796);
		actType = ACTIVITY_TURNLEFT;
		if (local_c.z < 0.0) goto LAB_00445461;
	}
	actType = ACTIVITY_TURNRIGHT;
LAB_00445461:
	if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) {
		actType = (actType == ACTIVITY_TURNRIGHT) + ACTIVITY_CARRYTURNLEFT;
	}
	liveObj->flags1_3e0 = liveObj->flags1_3e0 | LIVEOBJ1_TURNING;
	lego::game::LiveObject_SetActivityUnk(liveObj,actType,0);
	lego::game::Game_UpdateSomeAITasks(liveObj);
	return;
}



void __cdecl FUN_004454a0(LiveObject *in_liveObj)
{
	char cVar1;
	LiveObject *liveObj;
	ObjectStatsFlags1 OVar2;
	LevelSurfaceMap *pLVar3;
	BOOL BVar4;
	float *pfVar5;
	uint uVar6;
	float10 fVar7;
	float fVar8;
	uint x;
	float fVar9;
	LiveObject *y;
	uint *out_x;
	char **out_x_00;
	LiveObject **out_y;
	VehicleData **out_y_00;
	uint local_14;
	LiveObject *local_10;
	float local_c;
	char *local_8;
	VehicleData *local_4;
	
	liveObj = in_liveObj;
	OVar2 = lego::game::LiveObject_GetStatsFlags1(in_liveObj);
	if (((((OVar2 & STATS1_ROUTEAVOIDANCE) != STATS1_NONE) &&
			 (cVar1 = *(char *)((int)liveObj->routeptr_24 + liveObj->routingBlocksCurrent * 0x14 + 0x11),
			 cVar1 != '\a')) && (cVar1 != '\x03')) && ((cVar1 != '\x06' && (cVar1 != '\x05')))) {
		local_10 = liveObj;
		OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		if ((OVar2 & STATS1_COLLRADIUS) != STATS1_NONE) {
			FUN_00437a70(FUN_00445600,(LiveObject *)&local_10);
		}
		uVar6 = 0;
		if (liveObj->value_30 != 0) {
			pfVar5 = liveObj->floats_34;
			do {
				fVar9 = pfVar5[1];
				out_y = &in_liveObj;
				out_x = &local_14;
				fVar8 = *pfVar5;
				pLVar3 = lego::game::GetSurfaceMap();
				lego::game::SurfaceMap_ToBlockCoordinatesNoZ(pLVar3,fVar8,fVar9,(int *)out_x,(int *)out_y);
				BVar4 = FUN_004329d0(local_14,(int)in_liveObj,0);
				if (BVar4 != 0) {
					out_y_00 = &local_4;
					out_x_00 = &local_8;
					x = local_14;
					y = in_liveObj;
					pLVar3 = lego::game::GetSurfaceMap();
					FUN_0044f900(pLVar3,x,(uint)y,(float *)out_x_00,(float *)out_y_00);
					fVar8 = *pfVar5 - (float)local_8;
					fVar9 = pfVar5[1] - (float)local_4;
					local_c = SQRT(fVar8 * fVar8 + fVar9 * fVar9);
					*pfVar5 = (1.0 / local_c) * fVar8;
					pfVar5[1] = (1.0 / local_c) * fVar9;
					pLVar3 = lego::game::GetSurfaceMap();
					fVar7 = lego::game::SurfaceMap_GetFloat10(pLVar3);
					*pfVar5 = (float)(fVar7 * (float10)0.71 * (float10)*pfVar5 + (float10)(float)local_8);
					pfVar5[1] = (float)(fVar7 * (float10)0.71 * (float10)pfVar5[1] + (float10)(float)local_4);
				}
				uVar6 += 1;
				pfVar5 = pfVar5 + 2;
			} while (uVar6 < (uint)liveObj->value_30);
		}
	}
	return;
}



BOOL __cdecl FUN_00445600(LiveObject *liveObj1,LiveObject **param_2)
{
	float fVar1;
	LiveObject *pLVar2;
	int iVar3;
	float fVar4;
	ObjectStatsFlags1 OVar5;
	uint uVar6;
	float *pfVar7;
	float10 fVar8;
	float10 fVar9;
	float10 fVar10;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	pLVar2 = *param_2;
	if ((((liveObj1 != pLVar2) && (liveObj1->carryingThisObject != pLVar2)) &&
			(liveObj1->object_300 != pLVar2)) && ((liveObj1->flags3_3e8 & 0x2000) == LIVEOBJ3_NONE)) {
		OVar5 = lego::game::LiveObject_GetStatsFlags1(liveObj1);
		if ((OVar5 & STATS1_CAUSESLIP) == STATS1_NONE) {
			pLVar2 = *param_2;
			fVar8 = lego::game::LiveObject_GetCollRadius(pLVar2);
			lego::game::LiveObject_GetPosition(liveObj1,&local_8,&local_4);
			uVar6 = 1;
			if (1 < pLVar2->value_30 - 1U) {
				pfVar7 = pLVar2->floats_34 + 3;
				do {
					fVar4 = local_4 - *pfVar7;
					fVar1 = local_8 - pfVar7[-1];
					fVar9 = lego::game::LiveObject_GetCollRadius(liveObj1);
					if ((float10)SQRT(fVar1 * fVar1 + fVar4 * fVar4) < fVar9 + (float10)(float)fVar8) {
						local_10 = pfVar7[-1] - local_8;
						fVar1 = *pfVar7 - local_4;
						local_c = SQRT(fVar1 * fVar1 + local_10 * local_10);
						if (local_c == 0.0) {
							fVar9 = lego::game::Game_ChooseRandomRange(0.0,1.0);
							fVar1 = (float)fVar9;
							fVar9 = lego::game::Game_ChooseRandomRange(0.0,1.0);
							fVar10 = (float10)1.0 /
											 SQRT(fVar9 * (float10)(float)fVar9 + (float10)fVar1 * (float10)fVar1);
							local_10 = (float)(fVar10 * (float10)fVar1);
							local_c = (float)(fVar10 * (float10)(float)fVar9);
						}
						else {
							local_c = 1.0 / local_c;
							local_10 = local_c * local_10;
							local_c = local_c * fVar1;
						}
						fVar9 = lego::game::LiveObject_GetCollRadius(liveObj1);
						fVar9 = fVar9 + (float10)(float)fVar8;
						pfVar7[-1] = (pfVar7[-3] +
												 pfVar7[1] + (float)(fVar9 * (float10)local_10 + (float10)local_8)) *
												 0.3333333;
						*pfVar7 = (pfVar7[-2] + pfVar7[2] + (float)fVar9 * local_c + local_4) * 0.3333333;
					}
					uVar6 += 1;
					pfVar7 = pfVar7 + 2;
				} while (uVar6 < pLVar2->value_30 - 1U);
			}
			iVar3 = pLVar2->value_30;
			fVar1 = pLVar2->floats_34[iVar3 * 2 + -3];
			pfVar7 = pLVar2->floats_34 + iVar3 * 2 + -1;
			pfVar7[-1] = (pLVar2->floats_34[iVar3 * 2 + -4] - pLVar2->floats_34[iVar3 * 2 + -6]) +
									 pfVar7[-3];
			*pfVar7 = pfVar7[-2] + (fVar1 - pfVar7[-4]);
		}
	}
	return 0;
}



BOOL __cdecl FUN_00445860(LiveObject *liveObj)
{
	BOOL BVar1;
	LevelSurfaceMap *pLVar2;
	float10 fVar3;
	float fVar4;
	float in_y;
	uint *out_x;
	uint *out_y;
	uint local_20;
	uint local_1c;
	uint local_18;
	uint local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_14,(int *)&local_18);
	BVar1 = lego::game::Level_GetBlockFlags1_10Not8(local_14,local_18);
	if (BVar1 != 0) {
		return 0;
	}
	lego::game::LiveObject_GetPosition(liveObj,&local_8,&local_4);
	local_10 = (liveObj->faceDirection).x;
	local_c = (liveObj->faceDirection).y;
	fVar4 = 1.0 / SQRT(local_c * local_c + local_10 * local_10);
	pLVar2 = lego::game::GetSurfaceMap();
	fVar3 = lego::game::SurfaceMap_GetFloat10(pLVar2);
	out_y = &local_20;
	local_c = fVar4 * local_c * (float)(fVar3 * (float10)0.3333333);
	local_10 = fVar4 * local_10 * (float)(fVar3 * (float10)0.3333333);
	in_y = local_c + local_4;
	fVar4 = local_10 + local_8;
	out_x = &local_1c;
	local_8 = fVar4;
	local_4 = in_y;
	pLVar2 = lego::game::GetSurfaceMap();
	lego::game::SurfaceMap_ToBlockCoordinatesNoZ(pLVar2,fVar4,in_y,(int *)out_x,(int *)out_y);
	BVar1 = lego::game::Level_GetBlockFlags1_10Not8(local_1c,local_20);
	if ((BVar1 == 0) && (BVar1 = FUN_004329d0(local_1c,local_20,0), BVar1 == 0)) {
		return 0;
	}
	return 1;
}



void __cdecl FUN_004459a0(LiveObject *liveObj)
{
	uint uVar1;
	float10 fVar2;
	
	if (liveObj->objType == OBJECT_ROCKMONSTER) {
		FUN_00437a70(FUN_00445af0,liveObj);
	}
	if (((liveObj->objType == OBJECT_DYNAMITE) || (liveObj->objType == OBJECT_SONICBLASTER)) &&
		 ((liveObj->flags3_3e8 & 0x10000) != LIVEOBJ3_NONE)) {
		uVar1 = lego::res::Res_GetAnimAppData_Fieldc(liveObj->other);
		fVar2 = lego::res::Res_GetAnimFloat10(liveObj->other);
		if ((float10)(ulonglong)uVar1 - (float10)75.0 < fVar2) {
			FUN_00437a70(FUN_00445a30,liveObj);
		}
	}
	return;
}



BOOL __cdecl FUN_00445a30(LiveObject *liveObj1,LiveObject *liveObj2)
{
	float fVar1;
	float fVar2;
	float fVar3;
	Vector3F local_18;
	Vector3F local_c;
	
	if ((liveObj1->objType == OBJECT_MINIFIGURE) && ((*(byte *)&liveObj1->flags5_3f0 & 8) != 0)) {
		lego::game::LiveObject_GetPosition(liveObj1,(float *)&local_18,&local_18.y);
		lego::game::LiveObject_GetPosition(liveObj2,&local_18.z,(float *)&local_c);
		fVar3 = local_18.x - local_18.z;
		fVar1 = local_18.y - local_c.x;
		fVar2 = SQRT(fVar1 * fVar1 + fVar3 * fVar3);
		if (fVar2 < lego::globals::g_Game.DynamiteDamageRadius) {
			fVar2 = 1.0 / fVar2;
			local_c.y = fVar2 * fVar3;
			local_c.z = fVar2 * fVar1;
			FUN_00444720(liveObj1,&local_c.y);
			return 0;
		}
	}
	return 0;
}



BOOL __cdecl FUN_00445af0(LiveObject *liveObj1,LiveObject *liveObj2)
{
	float fVar1;
	float fVar2;
	ObjectStatsFlags1 OVar3;
	ResourceData *resData;
	LevelSurfaceMap *surfaceMap;
	BOOL BVar4;
	uint weaponType;
	float10 fVar5;
	float10 fVar6;
	float in_y;
	LiveObject *liveObj;
	uint *puVar7;
	float *out_y;
	float fVar8;
	ObjectType local_34;
	int local_30;
	float local_2c;
	float local_28;
	float local_24;
	float local_20;
	float local_1c;
	float local_18;
	uint local_14;
	float local_10;
	Vector3F local_c;
	
	lego::game::LiveObject_GetPosition(liveObj2,&local_1c,&local_18);
	lego::game::LiveObject_GetPosition(liveObj1,&local_24,&local_20);
	local_2c = local_24 - local_1c;
	local_28 = local_20 - local_18;
	fVar2 = SQRT(local_28 * local_28 + local_2c * local_2c);
	fVar5 = lego::game::LiveObject_GetAlertRadius(liveObj2);
	fVar1 = (float)fVar5;
	if ((liveObj2->flags3_3e8 & 0x80000000) == LIVEOBJ3_NONE) {
		if (((((liveObj1->flags2_3e4 & 2) == LIVEOBJ2_NONE) &&
				 ((liveObj1->flags2_3e4 & 0x100) == LIVEOBJ2_NONE)) &&
				((((byte)lego::globals::g_Game.flags2 & 1) == 0 ||
				 ((*(byte *)&liveObj1->flags4_3ec & 4) == 0)))) && (liveObj1->drivenObject == NULL)) {
			if (liveObj1->objType == OBJECT_MINIFIGURE) {
				OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj2);
				if ((OVar3 & STATS1_GRABMINIFIGURE) != STATS1_NONE) {
					resData = lego::game::LiveObject_GetResource(liveObj2);
					lego::res::Res_GetOrientation(resData,NULL,&local_c,NULL);
					out_y = &local_10;
					puVar7 = &local_14;
					fVar8 = 1.0 / SQRT(local_c.y * local_c.y + local_c.x * local_c.x);
					local_18 = fVar8 * local_c.y * 15.0 + local_18;
					local_1c = fVar8 * local_c.x * 15.0 + local_1c;
					fVar8 = local_1c;
					in_y = local_18;
					surfaceMap = lego::game::GetSurfaceMap();
					lego::game::SurfaceMap_ToBlockCoordinatesNoZ
										(surfaceMap,fVar8,in_y,(int *)puVar7,(int *)out_y);
					BVar4 = lego::game::Level_GetBlockFlags1_10Not8(local_14,(uint)local_10);
					if (BVar4 == 0) {
						BVar4 = FUN_004329d0(local_14,(int)local_10,1);
						if (BVar4 == 0) {
							local_1c = local_24 - local_1c;
							local_18 = local_20 - local_18;
							fVar5 = lego::game::LiveObject_GetCollRadius(liveObj1);
							if ((float10)SQRT(local_18 * local_18 + local_1c * local_1c) < fVar5) {
								FUN_0044b510(liveObj2,liveObj1);
								return 0;
							}
						}
					}
				}
				OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj2);
				if ((OVar3 & STATS1_CAUSESLIP) != STATS1_NONE) {
					fVar5 = lego::game::LiveObject_GetCollRadius(liveObj2);
					fVar6 = lego::game::LiveObject_GetCollRadius(liveObj1);
					if ((ushort)((ushort)(fVar6 + (float10)(float)fVar5 < (float10)fVar2) << 8 |
											(ushort)(fVar6 + (float10)(float)fVar5 == (float10)fVar2) << 0xe) == 0) {
						FUN_004448e0(liveObj1);
						liveObj2->health = -1.0;
						liveObj2->flags3_3e8 = liveObj2->flags3_3e8 | 0x800000;
					}
				}
				OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj2);
				if (((OVar3 & STATS1_CANSCARE) != STATS1_NONE) && (fVar1 != 0.0)) {
					fVar5 = lego::game::LiveObject_GetCollRadius(liveObj1);
					if ((float10)fVar2 < fVar5 + (float10)fVar1) {
						local_2c = (1.0 / fVar2) * local_2c;
						local_28 = (1.0 / fVar2) * local_28;
						FUN_00444720(liveObj1,&local_2c);
					}
				}
			}
			if (((liveObj1->objType == OBJECT_VEHICLE) || (liveObj1->objType == OBJECT_MINIFIGURE)) &&
				 ((liveObj1->flags1_3e0 & 0x200) == LIVEOBJ1_NONE)) {
				fVar5 = lego::game::LiveObject_GetPainThreshold(liveObj2);
				if (fVar5 < (float10)liveObj2->health) {
					fVar5 = lego::game::LiveObject_GetStampRadius(liveObj2);
					if ((ushort)((ushort)(fVar5 < (float10)fVar2) << 8 |
											(ushort)(fVar5 == (float10)fVar2) << 0xe) == 0) {
						FUN_0043acb0((uint *)liveObj2,(undefined4 *)liveObj1);
					}
				}
			}
			if ((liveObj1->objType == OBJECT_MINIFIGURE) || (liveObj1->objType == OBJECT_VEHICLE)) {
				OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj2);
				if (((OVar3 & STATS1_SCAREDBYPLAYER) != STATS1_NONE) &&
					 ((liveObj2->flags1_3e0 & 0x8000000) == LIVEOBJ1_NONE)) {
					fVar5 = lego::game::LiveObject_GetCollRadius(liveObj1);
					if ((float10)fVar2 < fVar5 + (float10)fVar1) {
						BVar4 = FUN_00444520(liveObj2);
						if (BVar4 != 0) {
							liveObj2->flags1_3e0 = liveObj2->flags1_3e0 | 0x8000000;
						}
					}
				}
			}
			if (liveObj1->objType == OBJECT_MINIFIGURE) {
				OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj2);
				if ((OVar3 & STATS1_FLOCKS) != STATS1_NONE) {
					local_24 = local_24 - (float)liveObj2->flocksData_32c->field_18;
					local_10 = local_20 - (float)liveObj2->flocksData_32c->field_20;
					fVar8 = local_10 * local_10;
					fVar5 = lego::game::LiveObject_GetCollRadius(liveObj1);
					if ((float10)SQRT(fVar8 + local_24 * local_24) < fVar5 + (float10)fVar1) {
						fVar8 = 1.0;
						BVar4 = 1;
						liveObj = liveObj1;
						weaponType = lego::game::Game_GetWeaponType("BatAttack");
						fVar5 = lego::game::Weapon_GetWeaponFloat12c4(weaponType,liveObj);
						FUN_0043f960(liveObj1,(float)fVar5,BVar4,fVar8);
						liveObj2->flags2_3e4 = liveObj2->flags2_3e4 | 0x80;
						if ((*(byte *)&liveObj2->flocksData_32c->field_24 & 1) == 0) {
							FUN_00403580((int *)&liveObj2,1,liveObj1);
							puVar7 = &liveObj2->flocksData_32c->field_24;
							*puVar7 = *puVar7 | 1;
						}
					}
				}
			}
			OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj2);
			if ((OVar3 & STATS1_CANSCARESCORPION) != STATS1_NONE) {
				BVar4 = lego::game::Game_GetObjectByName("Scorpion",&local_34,&local_30,NULL);
				if (((BVar4 != 0) && (local_34 == liveObj1->objType)) &&
					 ((local_30 == liveObj1->objIndex && (fVar1 != 0.0)))) {
					fVar5 = lego::game::LiveObject_GetCollRadius(liveObj1);
					if ((float10)fVar2 < fVar5 + (float10)fVar1) {
						local_2c = (1.0 / fVar2) * local_2c;
						local_28 = (1.0 / fVar2) * local_28;
						FUN_00444720(liveObj1,&local_2c);
					}
				}
			}
		}
	}
	else {
		if ((liveObj1->objType == OBJECT_MINIFIGURE) || (liveObj1->objType == OBJECT_VEHICLE)) {
			fVar5 = lego::game::LiveObject_GetWakeRadius(liveObj2);
			if ((ushort)((ushort)(fVar5 < (float10)fVar2) << 8 | (ushort)(fVar5 == (float10)fVar2) << 0xe)
					== 0) {
				FUN_00443ab0(liveObj2);
				return 1;
			}
		}
	}
	return 0;
}



VehicleData * __cdecl
FUN_00446030(LiveObject *liveObj,int param_2,char *param_3,CreatureData *param_4)
{
	ObjectStatsFlags1 OVar1;
	LiveObject *local_14;
	int local_10;
	char *local_c;
	VehicleData *local_8;
	CreatureData *local_4;
	
	local_10 = param_2;
	local_14 = liveObj;
	local_c = param_3;
	local_8 = NULL;
	local_4 = param_4;
	OVar1 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if ((OVar1 & STATS1_COLLBOX) != STATS1_NONE) {
		FUN_00437a70(FUN_004463b0,(LiveObject *)&local_14);
	}
	OVar1 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if ((OVar1 & STATS1_COLLRADIUS) != STATS1_NONE) {
		FUN_00437a70(FUN_004460b0,(LiveObject *)&local_14);
	}
	return local_8;
}



BOOL __cdecl FUN_004460b0(undefined4 *param_1,int *param_2)
{
	LiveObject *liveObj;
	float fVar1;
	ObjectStatsFlags1 OVar2;
	ResourceData *pRVar3;
	float *pfVar4;
	int iVar5;
	BOOL BVar6;
	Point2F *pPVar7;
	float10 fVar8;
	float10 fVar9;
	float10 fVar10;
	float local_60;
	float local_5c;
	Point2F local_58;
	Point2F local_50 [3];
	float local_38;
	float local_34;
	float local_30;
	undefined4 local_2c;
	float local_28;
	float local_24;
	undefined4 local_20;
	float local_1c;
	float local_18;
	undefined4 local_14;
	float local_10;
	float local_c;
	undefined4 local_8;
	float local_4;
	
	liveObj = (LiveObject *)*param_2;
	if (((((param_2[4] == 0) ||
				(OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj),
				(OVar2 & STATS1_STOREOBJECTS) == STATS1_NONE)) && ((LiveObject *)param_1 != liveObj)) &&
			(((LiveObject *)param_1[0xc1] != liveObj &&
			 (liveObj->carryingThisObject != (LiveObject *)param_1)))) &&
		 (((LiveObject *)param_1 != liveObj->drivenObject &&
			(((liveObj->flags1_3e0 & 0x600000) == LIVEOBJ1_NONE && ((param_1[0xf8] & 0x600000) == 0))))))
	{
		fVar8 = lego::game::LiveObject_GetCollHeight((LiveObject *)param_1);
		if ((ushort)((ushort)(fVar8 < (float10)(float)param_2[2]) << 8 |
								(ushort)(fVar8 == (float10)(float)param_2[2]) << 0xe) == 0) {
			lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_60,&local_5c);
			pRVar3 = lego::game::LiveObject_GetResource((LiveObject *)param_1);
			local_60 = local_60 - *(float *)param_2[1];
			local_5c = local_5c - ((float *)param_2[1])[1];
			fVar1 = SQRT(local_5c * local_5c + local_60 * local_60);
			OVar2 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1);
			if ((OVar2 & STATS1_COLLRADIUS) == STATS1_NONE) {
				OVar2 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1);
				if ((OVar2 & STATS1_COLLBOX) != STATS1_NONE) {
					fVar9 = lego::game::LiveObject_GetCollRadius(liveObj);
					fVar10 = lego::game::LiveObject_GetCollRadius((LiveObject *)param_1);
					fVar8 = (float10)fVar1;
					if ((ushort)((ushort)(fVar10 + (float10)(float)fVar9 < fVar8) << 8 |
											(ushort)(fVar10 + (float10)(float)fVar9 == fVar8) << 0xe) == 0) {
						pfVar4 = (float *)lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
						local_30 = *pfVar4 * -0.5;
						iVar5 = lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
						local_28 = *(float *)(iVar5 + 4) * 0.5;
						pfVar4 = (float *)lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
						local_24 = *pfVar4 * 0.5;
						iVar5 = lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
						local_1c = *(float *)(iVar5 + 4) * 0.5;
						pfVar4 = (float *)lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
						local_18 = *pfVar4 * 0.5;
						iVar5 = lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
						local_10 = *(float *)(iVar5 + 4) * -0.5;
						pfVar4 = (float *)lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
						local_c = *pfVar4 * -0.5;
						iVar5 = lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
						local_4 = *(float *)(iVar5 + 4) * -0.5;
						local_8 = 0;
						local_14 = 0;
						local_20 = 0;
						local_2c = 0;
						pPVar7 = &local_58;
						pfVar4 = &local_30;
						iVar5 = 4;
						do {
							FUN_00475330((int **)pRVar3,pfVar4,pfVar4);
							fVar1 = pfVar4[1];
							pPVar7->x = *pfVar4;
							pPVar7->y = fVar1;
							pfVar4 = pfVar4 + 3;
							pPVar7 = pPVar7 + 1;
							iVar5 += -1;
						} while (iVar5 != 0);
						local_38 = local_58.x;
						local_34 = local_58.y;
						BVar6 = FUN_00479e40((Point2F *)param_2[1],&local_58,local_50,4);
						if (BVar6 == 0) {
							fVar8 = FUN_00408a30((float *)param_2[1],(float *)&local_58,(float *)local_50,4);
							fVar9 = lego::game::LiveObject_GetCollRadius(liveObj);
							if ((ushort)((ushort)(fVar9 < (float10)(float)fVar8) << 8 |
													(ushort)(fVar9 == (float10)(float)fVar8) << 0xe) == 0) {
								param_2[3] = (int)param_1;
							}
						}
						else {
							param_2[3] = (int)param_1;
						}
					}
				}
			}
			else {
				fVar9 = lego::game::LiveObject_GetCollRadius(liveObj);
				fVar10 = lego::game::LiveObject_GetCollRadius((LiveObject *)param_1);
				fVar8 = (float10)fVar1;
				if ((ushort)((ushort)(fVar10 + (float10)(float)fVar9 < fVar8) << 8 |
										(ushort)(fVar10 + (float10)(float)fVar9 == fVar8) << 0xe) == 0) {
					param_2[3] = (int)param_1;
				}
			}
		}
		if (param_2[3] != 0) {
			return 1;
		}
	}
	return 0;
}



BOOL __cdecl FUN_004463b0(int **param_1,int **param_2)
{
	float fVar1;
	LiveObject *liveObj;
	ObjectStatsFlags1 OVar2;
	float *pfVar3;
	int iVar4;
	BOOL BVar5;
	float *pfVar6;
	int iVar7;
	LiveObject **ppLVar8;
	Point2F *pPVar9;
	Point2F *pPVar10;
	float10 fVar11;
	float10 fVar12;
	float local_f8;
	float local_f4;
	Point2F local_f0;
	LiveObject *local_e8 [2];
	ResourceData *local_e0;
	ResourceData *local_dc;
	Point2F local_d8;
	float local_d0;
	float local_cc;
	undefined4 local_c8;
	float local_c4;
	float local_c0;
	undefined4 local_bc;
	float local_b8;
	float local_b4;
	Point2F local_b0;
	Point2F local_a8 [4];
	Point2F local_88;
	Point2F local_80 [3];
	float local_68;
	float local_64;
	float local_60 [2];
	float local_58 [10];
	float local_30 [12];
	
	local_e8[1] = (LiveObject *)*param_2;
	if (((((param_2[4] == NULL) ||
				(OVar2 = lego::game::LiveObject_GetStatsFlags1(local_e8[1]),
				(OVar2 & STATS1_STOREOBJECTS) == STATS1_NONE)) && ((LiveObject *)param_1 != local_e8[1])) &&
			(((LiveObject *)param_1[0xc1] != local_e8[1] &&
			 (local_e8[1]->carryingThisObject != (LiveObject *)param_1)))) &&
		 (((local_e8[1]->flags1_3e0 & 0x600000) == LIVEOBJ1_NONE &&
			((((uint)param_1[0xf8] & 0x600000) == 0 &&
			 (fVar11 = lego::game::LiveObject_GetCollHeight((LiveObject *)param_1),
			 (ushort)((ushort)(fVar11 < (float10)(float)param_2[2]) << 8 |
							 (ushort)(fVar11 == (float10)(float)param_2[2]) << 0xe) == 0)))))) {
		lego::game::LiveObject_GetPosition((LiveObject *)param_1,(float *)&local_f0,&local_f0.y);
		lego::game::LiveObject_GetPosition(local_e8[1],&local_f8,&local_f4);
		local_f8 = local_f8 - (float)*param_2[1];
		local_f4 = local_f4 - (float)param_2[1][1];
		local_dc = lego::game::LiveObject_GetResource((LiveObject *)param_1);
		local_e0 = lego::game::LiveObject_GetResource(local_e8[1]);
		OVar2 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1);
		if ((OVar2 & STATS1_COLLRADIUS) == STATS1_NONE) {
			OVar2 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1);
			if ((OVar2 & STATS1_COLLBOX) != STATS1_NONE) {
				local_f0.y = local_f0.y - (float)param_2[1][1];
				local_f0.x = local_f0.x - (float)*param_2[1];
				fVar11 = lego::game::LiveObject_GetCollRadius((LiveObject *)param_1);
				local_e8[0] = (LiveObject *)(float)fVar11;
				fVar11 = lego::game::LiveObject_GetCollRadius(local_e8[1]);
				if ((float10)SQRT(local_f0.x * local_f0.x + local_f0.y * local_f0.y) <
						fVar11 + (float10)(float)local_e8[0]) {
					local_e8[0] = (LiveObject *)param_1;
					ppLVar8 = local_e8;
					iVar4 = 2;
					pfVar3 = local_58;
					do {
						liveObj = *ppLVar8;
						pfVar6 = (float *)lego::game::LiveObject_GetCollBox(liveObj);
						pfVar3[-2] = *pfVar6 * -0.5;
						iVar7 = lego::game::LiveObject_GetCollBox(liveObj);
						*pfVar3 = *(float *)(iVar7 + 4) * 0.5;
						pfVar6 = (float *)lego::game::LiveObject_GetCollBox(liveObj);
						pfVar3[1] = *pfVar6 * 0.5;
						iVar7 = lego::game::LiveObject_GetCollBox(liveObj);
						pfVar3[3] = *(float *)(iVar7 + 4) * 0.5;
						pfVar6 = (float *)lego::game::LiveObject_GetCollBox(liveObj);
						pfVar3[4] = *pfVar6 * 0.5;
						iVar7 = lego::game::LiveObject_GetCollBox(liveObj);
						pfVar3[6] = *(float *)(iVar7 + 4) * -0.5;
						pfVar6 = (float *)lego::game::LiveObject_GetCollBox(liveObj);
						pfVar3[7] = *pfVar6 * -0.5;
						iVar7 = lego::game::LiveObject_GetCollBox(liveObj);
						ppLVar8 = ppLVar8 + 1;
						iVar4 += -1;
						pfVar3[9] = *(float *)(iVar7 + 4) * -0.5;
						pfVar3[8] = 0.0;
						pfVar3[5] = 0.0;
						pfVar3[2] = 0.0;
						pfVar3[-1] = 0.0;
						pfVar3 = pfVar3 + 0xc;
					} while (iVar4 != 0);
					pPVar10 = &local_b0;
					pfVar3 = local_30;
					iVar4 = 4;
					do {
						FUN_00475330((int **)local_e0,pfVar3,pfVar3);
						fVar1 = pfVar3[1];
						pPVar10->x = *pfVar3;
						pPVar10->y = fVar1;
						pfVar3 = pfVar3 + 3;
						pPVar10 = pPVar10 + 1;
						iVar4 += -1;
					} while (iVar4 != 0);
					pPVar10 = &local_d8;
					pfVar3 = local_60;
					iVar4 = 4;
					do {
						FUN_00475330((int **)local_dc,pfVar3,pfVar3);
						fVar1 = pfVar3[1];
						pPVar10->x = *pfVar3;
						pPVar10->y = fVar1;
						pfVar3 = pfVar3 + 3;
						pPVar10 = pPVar10 + 1;
						iVar4 += -1;
					} while (iVar4 != 0);
					pfVar3 = &local_b8;
					iVar4 = 2;
					do {
						*pfVar3 = pfVar3[-8];
						pfVar3[1] = pfVar3[-7];
						pfVar3 = pfVar3 + 10;
						iVar4 += -1;
					} while (iVar4 != 0);
					pPVar10 = &local_d8;
					iVar4 = 4;
					do {
						BVar5 = FUN_00479e40(pPVar10,&local_b0,local_a8,4);
						if (BVar5 != 0) {
							param_2[3] = (int *)param_1;
						}
						pPVar10 = pPVar10 + 1;
						iVar4 += -1;
					} while (iVar4 != 0);
				}
			}
		}
		else {
			local_f0.y = local_f0.y - (float)param_2[1][1];
			local_f0.x = local_f0.x - (float)*param_2[1];
			fVar11 = lego::game::LiveObject_GetCollRadius((LiveObject *)param_1);
			local_e8[0] = (LiveObject *)(float)fVar11;
			fVar11 = lego::game::LiveObject_GetCollRadius(local_e8[1]);
			if ((float10)SQRT(local_f0.x * local_f0.x + local_f0.y * local_f0.y) <
					fVar11 + (float10)(float)local_e8[0]) {
				pfVar3 = (float *)lego::game::LiveObject_GetCollBox(local_e8[1]);
				local_d8.x = *pfVar3 * -0.5;
				iVar4 = lego::game::LiveObject_GetCollBox(local_e8[1]);
				local_d0 = *(float *)(iVar4 + 4) * 0.5;
				pfVar3 = (float *)lego::game::LiveObject_GetCollBox(local_e8[1]);
				local_cc = *pfVar3 * 0.5;
				iVar4 = lego::game::LiveObject_GetCollBox(local_e8[1]);
				local_c4 = *(float *)(iVar4 + 4) * 0.5;
				pfVar3 = (float *)lego::game::LiveObject_GetCollBox(local_e8[1]);
				local_c0 = *pfVar3 * 0.5;
				iVar4 = lego::game::LiveObject_GetCollBox(local_e8[1]);
				local_b8 = *(float *)(iVar4 + 4) * -0.5;
				pfVar3 = (float *)lego::game::LiveObject_GetCollBox(local_e8[1]);
				local_b4 = *pfVar3 * -0.5;
				iVar4 = lego::game::LiveObject_GetCollBox(local_e8[1]);
				local_b0.y = *(float *)(iVar4 + 4) * -0.5;
				local_b0.x = 0.0;
				local_bc = 0;
				local_c8 = 0;
				local_d8.y = 0.0;
				pPVar10 = &local_d8;
				iVar4 = 4;
				pPVar9 = &local_88;
				do {
					FUN_00475330((int **)local_e0,pPVar10,pPVar10);
					fVar1 = pPVar10->y;
					pPVar9->x = pPVar10->x;
					pPVar9->y = fVar1;
					pPVar10 = (Point2F *)&pPVar10[1].y;
					iVar4 += -1;
					pPVar9->x = local_f8 + pPVar9->x;
					pPVar9->y = local_f4 + pPVar9->y;
					pPVar9 = pPVar9 + 1;
				} while (iVar4 != 0);
				local_68 = local_88.x;
				local_64 = local_88.y;
				BVar5 = FUN_00479e40(&local_f0,&local_88,local_80,4);
				if (BVar5 == 0) {
					fVar11 = FUN_00408a30((float *)&local_f0,(float *)&local_88,(float *)local_80,4);
					fVar12 = lego::game::LiveObject_GetCollRadius((LiveObject *)param_1);
					if ((ushort)((ushort)(fVar12 < (float10)(float)fVar11) << 8 |
											(ushort)(fVar12 == (float10)(float)fVar11) << 0xe) == 0) {
						param_2[3] = (int *)param_1;
					}
				}
				else {
					param_2[3] = (int *)param_1;
				}
			}
		}
		if (param_2[3] != NULL) {
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_004468d0(LiveObject *in_liveObj,float elapsed,float *param_3,float *out_float_4)
{
	LiveFlags1 LVar1;
	ObjectType OVar2;
	ulonglong uVar3;
	LiveObject *liveObj;
	float *pfVar4;
	LevelSurfaceMap *surfaceMap;
	BOOL BVar5;
	ObjectStatsFlags2 OVar6;
	float10 fVar7;
	Point2I *out_x;
	int *out_y;
	float *out_unk_z;
	float local_1c;
	Point2I local_18;
	float local_10;
	float local_c;
	uint local_8;
	undefined4 uStack4;
	
	pfVar4 = param_3;
	liveObj = in_liveObj;
	LVar1 = in_liveObj->flags1_3e0;
	local_1c = (float)(LVar1 & 0x2000000);
	OVar2 = in_liveObj->objType;
	if (OVar2 == OBJECT_VEHICLE) {
		fVar7 = lego::res::Vehicle_GetFloat14(in_liveObj->vehicle);
		in_liveObj = (LiveObject *)(float)fVar7;
	}
	else {
		if (OVar2 == OBJECT_MINIFIGURE) {
			fVar7 = lego::game::LiveObject_GetCreatureResFloat(in_liveObj->miniFigure);
			in_liveObj = (LiveObject *)(float)fVar7;
		}
		else {
			if (OVar2 == OBJECT_ROCKMONSTER) {
				fVar7 = lego::game::LiveObject_GetCreatureResFloat(in_liveObj->rockMonster);
				in_liveObj = (LiveObject *)(float)fVar7;
			}
			else {
				if (OVar2 == OBJECT_BUILDING) {
					fVar7 = lego::res::Building_GetAnimFloat14_zero(in_liveObj->building);
					in_liveObj = (LiveObject *)(float)fVar7;
				}
				else {
					if (((in_liveObj->flags3_3e8 & LIVEOBJ3_SIMPLEOBJECT) != LIVEOBJ3_NONE) ||
						 (OVar2 == OBJECT_UPGRADEPART)) {
						*out_float_4 = elapsed;
						return;
					}
				}
			}
		}
	}
	if ((LVar1 & 8) == LIVEOBJ1_NONE) {
		if (((LVar1 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE) || (liveObj->objType == OBJECT_VEHICLE)) {
			fVar7 = lego::game::LiveObject_GetRouteSpeed(liveObj);
			*param_3 = (float)fVar7;
			if ((LVar1 & LIVEOBJ1_UNK_2_LEFTING) != LIVEOBJ1_NONE) {
				*param_3 = (float)(fVar7 * (float10)0.5);
			}
		}
		else {
			fVar7 = lego::game::LiveObject_GetRouteSpeed(liveObj);
			*param_3 = (float)(fVar7 * (float10)0.5);
		}
	}
	else {
		fVar7 = lego::game::LiveObject_GetRouteSpeed(liveObj);
		*param_3 = (float)(fVar7 * (float10)0.05);
	}
	if (local_1c != 0.0) {
		*param_3 = *param_3 * 0.05;
	}
	local_1c = 1.0;
	lego::game::LiveObject_GetPosition(liveObj,&local_10,&local_c);
	out_unk_z = &local_1c;
	out_y = &local_18.y;
	out_x = &local_18;
	surfaceMap = lego::game::GetSurfaceMap();
	BVar5 = lego::game::SurfaceMap_ToBlockCoordinates
										(surfaceMap,local_10,local_c,(int *)out_x,out_y,out_unk_z);
	if (BVar5 != 0) {
		local_8 = lego::game::Level_GetBlockRubbleLevel_OrFlag200000(&local_18);
		uStack4 = 0;
		uVar3 = (ulonglong)local_8;
		fVar7 = lego::game::LiveObject_GetRubbleCoef(liveObj);
		param_3 = (float *)(float)((float10)1.0 -
															((float10)1.0 - fVar7) * (float10)((float)uVar3 * 0.25));
		BVar5 = lego::game::Level_IsBlockPowerPath(&local_18);
		if (BVar5 != 0) {
			fVar7 = lego::game::LiveObject_GetPathCoef(liveObj);
			param_3 = (float *)(float)(fVar7 * (float10)(float)param_3);
		}
		if ((liveObj->objType == OBJECT_MINIFIGURE) &&
			 ((lego::globals::g_Game.level)->blocks
				[((lego::globals::g_Game.level)->dimensions).width * local_18.y + local_18.x].terrain ==
				TERRAIN_LAKE)) {
			param_3 = (float *)((1.0 - local_1c * 0.8) * (float)param_3);
		}
		BVar5 = lego::game::Level_GetBlockFlags1_8(local_18.x,local_18.y);
		if (BVar5 != 0) {
			*pfVar4 = *pfVar4 * (float)param_3;
		}
	}
	if ((float)in_liveObj == 0.0) {
		*out_float_4 = 1.0;
	}
	else {
		*out_float_4 = *pfVar4 / (float)in_liveObj;
	}
	if (((liveObj->objType == OBJECT_BUILDING) &&
			(OVar6 = lego::game::LiveObject_GetStatsFlags2(liveObj),
			(OVar6 & STATS2_UPGRADEBUILDING) != STATS2_NONE)) &&
		 ((liveObj->flags2_3e4 & LIVEOBJ2_UPGRADING) != LIVEOBJ2_NONE)) {
		fVar7 = lego::game::LiveObject_GetFunctionCoef(liveObj);
		*out_float_4 = (float)(fVar7 * (float10)*out_float_4);
	}
	*out_float_4 = *out_float_4 * elapsed;
	*pfVar4 = *pfVar4 * elapsed;
	return;
}



undefined4 __cdecl FUN_00446b80(int param_1,int param_2,int param_3)
{
	int iVar1;
	LwoFrame *pLVar2;
	int iVar3;
	int iVar4;
	int *piVar5;
	
	if ((*(byte *)(param_1 + 0x3e0) & 1) != 0) {
		iVar1 = *(int *)(param_1 + 0x28);
		pLVar2 = *(LwoFrame **)(param_1 + 0x24);
		iVar3 = *(int *)((int)pLVar2 + iVar1 * 0x14 + -0x14);
		iVar4 = *(int *)((int)pLVar2 + iVar1 * 0x14 + -0x10);
		if ((((param_2 == iVar3) && ((param_3 == iVar4 + -1 || (param_3 == iVar4 + 1)))) ||
				((param_3 == iVar4 && ((param_2 == iVar3 + -1 || (param_2 == iVar3 + 1)))))) &&
			 (piVar5 = FUN_0048df40(pLVar2,(iVar1 + 1) * 0x14), piVar5 != NULL)) {
			*(int **)(param_1 + 0x24) = piVar5;
			piVar5[*(int *)(param_1 + 0x28) * 5] = param_2;
			*(int *)(*(int *)(param_1 + 0x24) + 4 + *(int *)(param_1 + 0x28) * 0x14) = param_3;
			*(undefined4 *)(*(int *)(param_1 + 0x24) + 8 + *(int *)(param_1 + 0x28) * 0x14) = 0x3f000000;
			*(undefined4 *)(*(int *)(param_1 + 0x24) + 0xc + *(int *)(param_1 + 0x28) * 0x14) = 0x3f000000
			;
			*(undefined *)(*(int *)(param_1 + 0x24) + 0x10 + *(int *)(param_1 + 0x28) * 0x14) = 0;
			*(undefined *)(*(int *)(param_1 + 0x24) + 0x11 + *(int *)(param_1 + 0x28) * 0x14) = 1;
			*(int *)(param_1 + 0x28) = *(int *)(param_1 + 0x28) + 1;
			*(uint *)(param_1 + 1000) = *(uint *)(param_1 + 1000) & 0xfffffbff;
			return 1;
		}
	}
	return 0;
}



BOOL __cdecl
FUN_00446c80(LiveObject *liveObj,uint param_2,uint param_3,int param_4,uint *param_5,int param_6)
{
	float fVar1;
	bool bVar2;
	LevelSurfaceMap *pLVar3;
	BOOL BVar4;
	undefined4 uVar5;
	uint y;
	int iVar6;
	float **ppfVar7;
	uint uVar8;
	float *pfVar9;
	int *piVar10;
	uint uVar11;
	uint uVar12;
	longlong lVar13;
	float **ppfVar14;
	float **ppfVar15;
	uint *puVar16;
	float *out_x;
	undefined4 uVar17;
	undefined4 uVar18;
	int *local_11c;
	float *local_118;
	BOOL local_114;
	float local_110;
	float local_10c;
	uint local_108;
	float local_104;
	float local_100;
	undefined4 uStack252;
	uint local_f8;
	uint local_f4;
	float local_f0;
	float local_ec;
	float local_e8;
	float local_e4;
	float local_e0;
	undefined4 local_dc;
	undefined4 local_d8;
	undefined4 local_d4;
	undefined4 local_d0;
	undefined4 local_cc;
	undefined4 local_c8;
	undefined4 local_c4;
	float local_c0;
	undefined4 local_bc;
	undefined4 local_b8;
	undefined4 local_b4;
	undefined4 local_b0;
	undefined4 local_ac;
	undefined4 local_a8;
	undefined4 local_a4;
	undefined4 local_a0;
	undefined4 local_9c;
	undefined4 local_98;
	undefined4 local_94;
	undefined4 local_90;
	undefined4 local_8c;
	undefined4 local_88;
	undefined4 local_84;
	int local_80 [8];
	float *local_60 [8];
	float *local_40 [8];
	uint local_20 [8];
	
	local_108 = 0xffffffff;
	local_f8 = 0xffffffff;
	local_f4 = 0xffffffff;
	piVar10 = local_80;
	local_80[0] = 0;
	local_b8 = 0;
	for (iVar6 = 7; piVar10 = piVar10 + 1, iVar6 != 0; iVar6 += -1) {
		*piVar10 = 0;
	}
	local_a4 = 0;
	local_a0 = 0;
	local_8c = 0;
	local_e0 = 0.0;
	local_d4 = 0;
	local_d0 = 0;
	local_c4 = 0;
	local_114 = 0;
	local_c0 = -1.0;
	local_bc = 0xc0000000;
	local_b4 = 0xc0000000;
	local_b0 = 0x3f800000;
	local_ac = 0xbf800000;
	local_a8 = 0x3f800000;
	local_9c = 0x3f800000;
	local_98 = 0xbf800000;
	local_94 = 0x3f800000;
	local_90 = 0xc0000000;
	local_88 = 0xc0000000;
	local_84 = 0xbf800000;
	local_dc = 0xbf800000;
	local_d8 = 0x3f800000;
	local_cc = 0x3f800000;
	local_c8 = 0xbf800000;
	bVar2 = true;
	if (param_4 == 0) {
		local_118 = &local_e0;
		uVar8 = 4;
	}
	else {
		local_118 = &local_c0;
		uVar8 = 8;
	}
	lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_110,(int *)&local_10c);
	if (param_6 == 0) {
		pfVar9 = &local_ec;
		out_x = &local_f0;
		uVar12 = param_2;
		uVar11 = param_3;
		pLVar3 = lego::game::GetSurfaceMap();
		FUN_0044f900(pLVar3,uVar12,uVar11,out_x,pfVar9);
		lego::game::LiveObject_GetPosition(liveObj,&local_e8,&local_e4);
		local_104 = SQRT((local_ec - local_e4) * (local_ec - local_e4) +
										 (local_f0 - local_e8) * (local_f0 - local_e8));
		pLVar3 = lego::game::GetSurfaceMap();
		if (local_104 < pLVar3->BlockSize) {
			bVar2 = false;
		}
	}
	uVar11 = 0;
	uVar12 = local_f4;
	if (uVar8 != 0) {
		local_104 = (float)(ulonglong)param_2;
		uStack252 = 0;
		local_100 = (float)(ulonglong)param_3;
		pfVar9 = local_118;
		do {
			*pfVar9 = *pfVar9 + local_104;
			fVar1 = pfVar9[1];
			pfVar9[1] = fVar1 + local_100;
			if ((((*pfVar9 == (float)(int)local_110) && (fVar1 + local_100 == (float)(int)local_10c)) &&
					(bVar2)) &&
				 ((uVar12 = uVar11, param_4 != 0 ||
					(BVar4 = lego::game::Level_GetBlockFlags1_10Not8((uint)local_110,(uint)local_10c),
					BVar4 == 0)))) break;
			uVar11 += 1;
			pfVar9 = pfVar9 + 2;
			uVar12 = local_f4;
		} while (uVar11 < uVar8);
	}
	if (uVar12 != 0xffffffff) {
		BVar4 = FUN_004419c0(liveObj,1,&local_110,&local_10c,NULL);
		if (BVar4 == 0) {
			return 0;
		}
		if (param_5 != NULL) {
			*param_5 = uVar12;
		}
		return 1;
	}
	uVar12 = 0;
	if (uVar8 != 0) {
		local_11c = local_80;
		ppfVar7 = local_40;
		pfVar9 = local_118;
		do {
			if (((float)(int)local_110 != *pfVar9) || ((float)(int)local_10c != pfVar9[1])) {
				lVar13 = __ftol((float10)pfVar9[1]);
				uVar5 = (undefined4)lVar13;
				uVar18 = 0;
				puVar16 = local_20 + uVar12;
				uVar17 = 0;
				ppfVar15 = local_60 + uVar12;
				ppfVar14 = ppfVar7;
				lVar13 = __ftol((float10)*pfVar9);
				BVar4 = FUN_004413b0(liveObj,local_110,local_10c,(int)lVar13,uVar5,ppfVar14,ppfVar15,puVar16
														 ,uVar17,uVar18);
				if (BVar4 != 0) {
					*local_11c = 1;
				}
			}
			uVar12 += 1;
			pfVar9 = pfVar9 + 2;
			ppfVar7 = ppfVar7 + 1;
			local_11c = local_11c + 1;
		} while (uVar12 < uVar8);
	}
	uVar12 = 0;
	if (uVar8 != 0) {
		do {
			if ((local_108 != 0xffffffff) && (uVar12 == uVar8)) break;
			uVar11 = uVar12 % uVar8;
			if (local_80[uVar11] != 0) {
				if (uVar12 < uVar8) {
					lVar13 = __ftol((float10)local_118[uVar11 * 2 + 1]);
					y = (uint)lVar13;
					lVar13 = __ftol((float10)local_118[uVar11 * 2]);
					BVar4 = lego::game::Level_GetBlockFlags1_10Not8((uint)lVar13,y);
					if (BVar4 != 0) goto LAB_0044704f;
				}
				if (local_20[uVar11] < local_f8) {
					local_108 = uVar11;
					local_f8 = local_20[uVar11];
				}
			}
LAB_0044704f:
			uVar12 += 1;
		} while (uVar12 < uVar8 * 2);
	}
	if (local_108 != 0xffffffff) {
		BVar4 = FUN_004419c0(liveObj,local_20[local_108],local_40[local_108],local_60[local_108],NULL);
		if (BVar4 == 0) {
			local_114 = 0;
		}
		else {
			if (param_5 != NULL) {
				*param_5 = local_108;
			}
			local_114 = 1;
		}
	}
	uVar12 = 0;
	if (uVar8 != 0) {
		ppfVar7 = local_60;
		do {
			if (local_80[uVar12] != 0) {
				std::free(local_40[uVar12]);
				std::free(*ppfVar7);
			}
			uVar12 += 1;
			ppfVar7 = ppfVar7 + 1;
		} while (uVar12 < uVar8);
	}
	return local_114;
}



undefined4 __cdecl FUN_00447100(int *param_1,uint param_2,uint param_3,int param_4)
{
	int iVar1;
	int iVar2;
	undefined4 uVar3;
	BOOL BVar4;
	float10 fVar5;
	uint local_84;
	int local_80 [4];
	undefined4 local_70;
	undefined4 local_6c;
	undefined4 local_68;
	undefined4 local_64;
	int local_60 [4];
	undefined4 local_50;
	undefined4 local_4c;
	undefined4 local_48;
	undefined4 local_44;
	undefined4 local_40 [4];
	undefined4 local_30;
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	BVar4 = FUN_004326a0((LiveObject *)param_1,param_2,param_3,param_4,1);
	if (BVar4 != 0) {
		BVar4 = FUN_00446c80((LiveObject *)param_1,param_2,param_3,param_4,&local_84,1);
		if (BVar4 != 0) {
			if (param_4 != 0) {
				local_60[0] = 0;
				local_60[1] = 1;
				local_60[2] = 1;
				local_44 = 0;
				local_60[3] = 2;
				local_50 = 2;
				local_80[2] = 0;
				local_4c = 3;
				local_48 = 3;
				local_70 = 0;
				local_80[0] = -1;
				local_80[1] = 0xffffffff;
				local_80[3] = 0xffffffff;
				local_68 = 0xffffffff;
				local_6c = 0;
				local_64 = 0;
				local_40[0] = 0x3f666666;
				local_40[1] = 0x3f000000;
				local_40[2] = 0x3dcccccd;
				local_40[3] = 0x3f000000;
				local_30 = 0x3f000000;
				local_2c = 0x3dcccccd;
				local_28 = 0x3f000000;
				local_24 = 0x3f666666;
				local_20 = 0x3dcccccd;
				local_1c = 0x3f000000;
				local_18 = 0x3f666666;
				local_14 = 0x3f000000;
				local_10 = 0x3f000000;
				local_c = 0x3f666666;
				local_8 = 0x3f000000;
				local_4 = 0x3dcccccd;
				FUN_00446b80((int)param_1,local_80[local_60[local_84] * 2] + param_2,
										 local_80[local_60[local_84] * 2 + 1] + param_3);
				iVar1 = param_1[10];
				iVar2 = param_1[9];
				uVar3 = local_40[local_84 * 2 + 1];
				*(undefined4 *)(iVar2 + -0xc + iVar1 * 0x14) = local_40[local_84 * 2];
				*(undefined4 *)(iVar2 + -8 + iVar1 * 0x14) = uVar3;
				param_1[0xbd] = (int)(float)(ulonglong)param_2;
				param_1[0xfa] = param_1[0xfa] | 0x2000000;
				param_1[0xbe] = (int)(float)(ulonglong)param_3;
				return 1;
			}
			FUN_00446b80((int)param_1,param_2,param_3);
			fVar5 = lego::game::Game_ChooseRandomRange(0.3,0.7);
			*(float *)(param_1[9] + -0xc + param_1[10] * 0x14) = (float)fVar5;
			fVar5 = lego::game::Game_ChooseRandomRange(0.3,0.7);
			*(float *)(param_1[9] + -8 + param_1[10] * 0x14) = (float)fVar5;
			param_1[0xbd] = (int)(float)(ulonglong)param_2;
			param_1[0xfa] = param_1[0xfa] & 0xfdffffff;
			param_1[0xbe] = (int)(float)(ulonglong)param_3;
			return 1;
		}
	}
	return 0;
}



// WARNING: Variable defined which should be unmapped: param_4

undefined4 FUN_004472ed(undefined param_1,undefined param_2,undefined param_3,undefined8 param_4)
{
	int unaff_EBX;
	int unaff_EBP;
	int unaff_ESI;
	undefined4 unaff_EDI;
	float10 fVar1;
	
	FUN_00446b80(unaff_ESI,unaff_EBP,unaff_EBX);
	fVar1 = lego::game::Game_ChooseRandomRange(0.3,0.7);
	*(float *)(*(int *)(unaff_ESI + 0x24) + -0xc + *(int *)(unaff_ESI + 0x28) * 0x14) = (float)fVar1;
	fVar1 = lego::game::Game_ChooseRandomRange(0.3,0.7);
	*(float *)(*(int *)(unaff_ESI + 0x24) + -8 + *(int *)(unaff_ESI + 0x28) * 0x14) = (float)fVar1;
	*(float *)(unaff_ESI + 0x2f4) = (float)CONCAT44(unaff_EDI,unaff_EBP);
	*(uint *)(unaff_ESI + 1000) = *(uint *)(unaff_ESI + 1000) & 0xfdffffff;
	*(float *)(unaff_ESI + 0x2f8) = (float)CONCAT44(unaff_EDI,unaff_EBX);
	return 1;
}



BOOL __cdecl FUN_00447390(LiveObject *in_liveObj)
{
	BOOL BVar1;
	LiveObject *liveObj;
	undefined **ppuVar2;
	float10 fVar3;
	Point2I point;
	
	if ((in_liveObj->flags3_3e8 & 0x4000000) != LIVEOBJ3_NONE) {
		fVar3 = lego::game::LiveObject_GetCarryMinHealth(in_liveObj);
		if (fVar3 < (float10)in_liveObj->health) {
			BVar1 = FUN_0044a890(in_liveObj,(int *)&point,&point.y,1,0,0);
			if (BVar1 != 0) {
				liveObj = lego::game::LiveObject__Create
														((int **)lego::globals::g_Game.RES_Boulder,OBJECT_BOULDER,0);
				FUN_00442b60(liveObj,10000.0,10000.0,0,1);
				lego::game::LiveObject_FUN_0044a210(liveObj,1);
				BVar1 = FUN_00447470(in_liveObj,point.x,point.y,liveObj);
				if (BVar1 != 0) {
					ppuVar2 = (undefined **)FUN_00429090(&point);
					FUN_00440eb0(liveObj,ppuVar2);
					in_liveObj->float_33c = 0.0;
					return 1;
				}
				lego::game::LiveObject_ReleaseBoulderUnk(liveObj);
			}
		}
	}
	return 0;
}



BOOL __cdecl FUN_00447470(LiveObject *liveObj,uint x,uint y,LiveObject *liveObj2)
{
	BOOL BVar1;
	
	if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE) {
		BVar1 = FUN_00449b40(liveObj,x,y,4.0);
		if (BVar1 != 0) {
			*(undefined *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -3) = 3;
			liveObj->object_2fc = liveObj2;
			liveObj2->object_300 = liveObj;
			return 1;
		}
	}
	return 0;
}



undefined4 __cdecl FUN_004474d0(float *param_1,undefined4 *param_2)
{
	short sVar1;
	short sVar2;
	uint uVar3;
	BOOL BVar4;
	int iVar5;
	uint uVar6;
	uint uVar7;
	uint uVar8;
	uint uVar9;
	Point2I local_70;
	int local_68;
	int local_64;
	int local_60 [4];
	undefined4 local_50;
	undefined4 local_4c;
	undefined4 local_48;
	undefined4 local_44;
	undefined4 local_40;
	undefined4 local_3c;
	undefined4 local_38;
	undefined4 local_34;
	undefined4 local_30;
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	if (*param_1 == 4.203895e-45) {
		if (param_2 != NULL) {
			local_60[0] = 2;
			local_60[1] = 0;
			local_60[2] = 0;
			local_60[3] = 2;
			local_50 = 0xfffffffe;
			local_4c = 0;
			local_48 = 0;
			local_44 = 0xfffffffe;
			local_40 = 2;
			local_3c = 0xffffffff;
			local_38 = 2;
			local_34 = 1;
			local_30 = 1;
			local_2c = 2;
			local_28 = 0xffffffff;
			local_24 = 2;
			local_20 = 0xfffffffe;
			local_1c = 1;
			local_18 = 0xfffffffe;
			local_14 = 0xffffffff;
			local_10 = 0xffffffff;
			local_c = 0xfffffffe;
			local_8 = 1;
			local_4 = 0xfffffffe;
			sVar1 = lego::util::randomInt16();
			sVar2 = lego::util::randomInt16();
			uVar6 = (int)sVar2 >> 0x1f;
			lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_2,&local_68,&local_64);
			uVar9 = 0;
			do {
				uVar7 = 0;
				uVar8 = (int)sVar1 % 0xc;
				do {
					uVar3 = uVar8;
					if ((((int)sVar2 ^ uVar6) - uVar6 & 1 ^ uVar6) - uVar6 == 1) {
						uVar3 = 0x18 - uVar8;
					}
					local_70.x = local_60[(uVar3 % 0xc) * 2] + local_68;
					local_70.y = local_60[(uVar3 % 0xc) * 2 + 1] + local_64;
					if (((uVar9 == 1) ||
							(BVar4 = lego::game::Level_GetBlockFlags1_180000(&local_70), BVar4 == 0)) &&
						 (iVar5 = FUN_00447670(param_1,(float)local_70.x,(float *)local_70.y,param_2),
						 iVar5 != 0)) {
						return 1;
					}
					uVar7 += 1;
					uVar8 += 1;
				} while (uVar7 < 0xc);
				uVar9 += 1;
				if (1 < uVar9) {
					return 0;
				}
			} while( true );
		}
		FUN_0043a130((LiveObject *)param_1,0);
	}
	return 0;
}



int __cdecl FUN_00447670(float *param_1,float param_2,float *param_3,undefined4 *param_4)
{
	float *liveObj;
	float fVar1;
	float *pfVar2;
	BOOL BVar3;
	BOOL BVar4;
	float *local_10;
	float local_c;
	float *local_8;
	uint local_4;
	
	liveObj = param_1;
	BVar4 = 0;
	if (((uint)param_1[0xf8] & 0x400) != 0) {
		BVar3 = FUN_0043bdb0((LiveObject *)param_1);
		if (BVar3 == 0) {
			lego::game::LiveObject_GetBlockCoordinates
								((LiveObject *)param_4,(int *)&local_c,(int *)&local_8);
			pfVar2 = param_3;
			fVar1 = param_2;
			if ((local_c != param_2) || (local_8 != param_3)) {
				lego::game::LiveObject_GetBlockCoordinates
									((LiveObject *)liveObj,(int *)&param_2,(int *)&param_1);
				if ((param_2 == fVar1) && (param_1 == pfVar2)) {
					BVar4 = FUN_004419c0((LiveObject *)liveObj,1,&param_2,(float *)&param_1,NULL);
				}
				else {
					BVar4 = FUN_004413b0(liveObj,param_2,param_1,fVar1,pfVar2,&param_3,&local_10,&local_4,0,0)
					;
					if (BVar4 == 0) {
						return 0;
					}
					BVar4 = FUN_004419c0((LiveObject *)liveObj,local_4,param_3,local_10,NULL);
					std::free(param_3);
					std::free(local_10);
				}
				if (BVar4 != 0) {
					*(undefined *)((int)liveObj[9] + -3 + (int)liveObj[10] * 0x14) = 5;
					*(undefined4 **)((int)liveObj[0xc2] + 0x2fc) = param_4;
					return BVar4;
				}
			}
		}
	}
	return BVar4;
}



void __cdecl FUN_004477b0(LiveObject *in_liveObj)
{
	LiveObject *liveObj;
	float fVar1;
	float fVar2;
	float10 fVar3;
	float10 fVar4;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	liveObj = in_liveObj->object_2fc;
	in_liveObj->object_2fc = NULL;
	if (liveObj != NULL) {
		lego::game::LiveObject_GetPosition(liveObj,&local_10,&local_c);
		lego::game::LiveObject_GetPosition(in_liveObj,&local_8,&local_4);
		local_18 = local_10 - local_8;
		local_14 = local_c - local_4;
		fVar2 = local_18 * local_18;
		fVar1 = local_14 * local_14;
		fVar3 = lego::game::LiveObject_GetCollRadius(liveObj);
		fVar4 = lego::game::LiveObject_GetCollRadius(in_liveObj);
		if ((float10)SQRT(fVar1 + fVar2) < fVar4 + fVar4 + (float10)(float)fVar3) {
			FUN_00447c10(liveObj,&local_18,1);
			FUN_0043f960(liveObj,10.0,1,1.0);
		}
	}
	return;
}



int __cdecl FUN_00447880(LiveObject *in_liveObj)
{
	LiveObject *liveObj;
	ObjectStatsFlags2 OVar1;
	BOOL BVar2;
	int iVar3;
	float10 fVar4;
	
	iVar3 = 0;
	liveObj = in_liveObj->object_2fc;
	if ((liveObj != NULL) && ((liveObj->flags2_3e4 & 0x100000) == LIVEOBJ2_NONE)) {
		OVar1 = lego::game::LiveObject_GetStatsFlags2(in_liveObj);
		if ((OVar1 & STATS2_DRAINPOWER) == STATS2_NONE) {
			if ((in_liveObj->flags4_3ec & 0x400000) == 0) {
				if (in_liveObj->objType == OBJECT_ROCKMONSTER) {
					lego::game::Info_FUN_00419ab0(INFO_UNDERATTACK,NULL,liveObj,NULL);
				}
				fVar4 = lego::game::LiveObject_GetRepairValue(in_liveObj);
				if ((float10)0.0 <= fVar4) {
					liveObj->health = (float)(fVar4 + (float10)liveObj->health);
				}
				else {
					FUN_0043f960(liveObj,(float)-fVar4,1,1.0);
					liveObj->flags2_3e4 = liveObj->flags2_3e4 | 0x40000000;
				}
				if (liveObj->health < 100.0) {
					FUN_00402e60(liveObj,0);
				}
				else {
					liveObj->health = (float)&DAT_42c80000;
					iVar3 = 1;
				}
			}
			else {
				FUN_00438ab0(liveObj);
				in_liveObj->flags4_3ec = in_liveObj->flags4_3ec & 0xffbfffff;
			}
		}
		else {
			BVar2 = FUN_00438870(liveObj,0);
			if (BVar2 == 0) {
				return 1;
			}
			if (lego::globals::g_Game.DrainTime <= in_liveObj->elapsedTime2) {
				FUN_004375c0(in_liveObj,-1,1.0);
				in_liveObj->elapsedTime2 = 0.0;
			}
		}
		if ((ushort)((ushort)(liveObj->health < 0.0) << 8 | (ushort)(liveObj->health == 0.0) << 0xe) ==
				0) goto LAB_004479d1;
	}
	iVar3 = 1;
LAB_004479d1:
	if (iVar3 != 0) {
		in_liveObj->object_2fc = NULL;
	}
	return iVar3;
}



undefined4 __cdecl FUN_004479f0(int param_1)
{
	float fVar1;
	
	fVar1 = *(float *)(param_1 + 0x344) - -25.0;
	*(undefined4 *)(param_1 + 0x2fc) = 0;
	*(float *)(param_1 + 0x344) = fVar1;
	if ((ushort)((ushort)(fVar1 < *(float *)(param_1 + 0x340)) << 8 |
							(ushort)(fVar1 == *(float *)(param_1 + 0x340)) << 0xe) == 0) {
		*(undefined4 *)(param_1 + 0x344) = *(undefined4 *)(param_1 + 0x340);
		return 1;
	}
	return 0;
}



void __cdecl FUN_00447a40(LiveObject *liveObj)
{
	LiveObject *liveObj2;
	
	if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) != LIVEOBJ1_NONE) {
		liveObj2 = liveObj->carriedObjects[0];
		liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_CARRYING;
		liveObj->numCarriedObjects = 0;
		liveObj->carriedObjects[0] = NULL;
		liveObj2->flags3_3e8 = liveObj2->flags3_3e8 | 0x2000;
		FUN_00403c40(liveObj,4,liveObj2,1);
	}
	return;
}



void __cdecl FUN_00447a90(LiveObject *liveObj)
{
	void *pvVar1;
	LiveObject *pLVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	LevelSurfaceMap *pLVar6;
	uint x;
	uint uVar7;
	Point2F *pPVar8;
	Point2F *pPVar9;
	Point2F *pPVar10;
	float *out_y;
	Point2F local_20;
	float local_14;
	float local_10;
	float local_c;
	Point2F local_8;
	
	pLVar2 = liveObj->carriedObjects[0]->object_2fc;
	pvVar1 = (void *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14);
	out_y = &local_20.y;
	pPVar9 = &local_20;
	uVar7 = *(uint *)((int)pvVar1 + -0x10);
	x = *(uint *)((int)pvVar1 + -0x14);
	pLVar6 = lego::game::GetSurfaceMap();
	FUN_0044f900(pLVar6,x,uVar7,(float *)pPVar9,out_y);
	lego::game::LiveObject_GetPosition(pLVar2,&local_10,&local_c);
	fVar3 = local_10 - local_20.x;
	fVar5 = local_c - local_20.y;
	pPVar9 = &local_8;
	pPVar8 = &local_20;
	pPVar10 = NULL;
	fVar4 = 1.0 / SQRT(fVar5 * fVar5 + fVar3 * fVar3);
	local_14 = fVar4 * fVar5 * 0.1;
	local_20.x = fVar4 * fVar3 * 0.1 + local_20.x;
	local_20.y = local_14 + local_20.y;
	pLVar6 = lego::game::GetSurfaceMap();
	FUN_0044fb30(pLVar6,pPVar8,pPVar10,pPVar9);
	uVar7 = liveObj->routingBlocksTotal;
	pvVar1 = liveObj->routeptr_24;
	*(float *)((int)pvVar1 + uVar7 * 0x14 + -0xc) = local_8.x;
	*(float *)((int)pvVar1 + uVar7 * 0x14 + -8) = local_8.y;
	*(byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -4) =
			 *(byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -4) | 8;
	pLVar2 = liveObj->carriedObjects[0];
	(pLVar2->point_2f4).x = local_10;
	(pLVar2->point_2f4).y = local_c;
	liveObj->carriedObjects[0]->object_2fc = NULL;
	return;
}



void __cdecl FUN_00447bc0(LiveObject *liveObj)
{
	if (liveObj->objType == OBJECT_BUILDING) {
		FUN_00437a70(FUN_00447be0,liveObj);
	}
	return;
}



undefined4 __cdecl FUN_00447be0(int *param_1,int param_2)
{
	if (((*param_1 == 5) && (param_1[0xbf] == param_2)) && ((LiveObject *)param_1[0xc1] != NULL)) {
		lego::game::LiveObject_UnkDoRouting_FUN_00441c00((LiveObject *)param_1[0xc1],0);
	}
	return 0;
}



void __cdecl FUN_00447c10(LiveObject *liveObj,float *param_2,int param_3)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	BOOL BVar5;
	uint uVar6;
	ActivityType actType;
	float10 fVar7;
	
	if (((*(byte *)&liveObj->flags2_3e4 & 2) != 0) && (liveObj->object_3c0 != NULL)) {
		liveObj = liveObj->object_3c0;
	}
	if ((liveObj->flags1_3e0 & 0x1000) == LIVEOBJ1_NONE) {
		BVar5 = FUN_00438870(liveObj,1);
		if (BVar5 != 0) {
			if (param_2 == NULL) {
				actType = (-(uint)(param_3 != 0) & 0xfffffff7) + ACTIVITY_STAMP;
			}
			else {
				fVar1 = (liveObj->faceDirection).x;
				fVar2 = (liveObj->faceDirection).y;
				fVar7 = (float10)fcos((float10)0.7853981852531433);
				fVar3 = 1.0 / SQRT(fVar2 * fVar2 + fVar1 * fVar1);
				fVar1 = fVar3 * fVar1;
				fVar3 = fVar3 * fVar2;
				fVar4 = 1.0 - (float)fVar7;
				fVar2 = fVar3 * param_2[1] + fVar1 * *param_2;
				if ((ushort)((ushort)(fVar2 < fVar4) << 8 | (ushort)(fVar2 == fVar4) << 0xe) == 0) {
					actType = ACTIVITY_HITBACK;
				}
				else {
					if (-fVar4 <= fVar2) {
						fVar1 = fVar3 * *param_2 - fVar1 * param_2[1];
						if ((ushort)((ushort)(fVar1 < 0.0) << 8 | (ushort)(fVar1 == 0.0) << 0xe) == 0) {
							actType = ACTIVITY_HITRIGHT;
						}
						else {
							actType = ACTIVITY_HITLEFT;
						}
					}
					else {
						actType = ACTIVITY_HITFRONT;
					}
				}
			}
			FUN_00441df0(liveObj,0,1);
			lego::game::LiveObject_SetActivityUnk(liveObj,actType,1);
			uVar6 = lego::game::Game_UpdateSomeAITasks(liveObj);
			if (uVar6 == 0) {
				lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,1);
				lego::game::Game_UpdateSomeAITasks(liveObj);
			}
			FUN_00447df0(liveObj,1.0);
			liveObj->flags1_3e0 = liveObj->flags1_3e0 | 0x1000;
			if (liveObj->objType == OBJECT_ROCKMONSTER) {
				liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0x7fffffff;
			}
		}
	}
	return;
}



void __cdecl FUN_00447dc0(uint *param_1)
{
	lego::game::LiveObject_SetActivityUnk((LiveObject *)param_1,ACTIVITY_TELEPORT,0);
	lego::game::Game_UpdateSomeAITasks((LiveObject *)param_1);
	param_1[0xf8] = param_1[0xf8] | 0x200000;
	return;
}



float10 __cdecl FUN_00447df0(LiveObject *in_liveObj,float elapsed)
{
	ObjectType OVar1;
	LiveObject *liveObj;
	float elapsed2;
	float10 fVar2;
	
	elapsed2 = elapsed;
	liveObj = in_liveObj;
	FUN_004468d0(in_liveObj,elapsed,(float *)&in_liveObj,&elapsed);
	if ((liveObj->flags1_3e0 & 0x4000) != LIVEOBJ1_NONE) goto LAB_00447ed1;
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_VEHICLE) {
		fVar2 = FUN_0046d480(liveObj->vehicle,elapsed,elapsed2,liveObj->unkbool_2d8);
	}
	else {
		if (OVar1 == OBJECT_MINIFIGURE) {
			fVar2 = FUN_00406c60(liveObj->miniFigure,elapsed,liveObj->unkbool_2d8);
		}
		else {
			if (OVar1 == OBJECT_ROCKMONSTER) {
				fVar2 = FUN_00406c60(liveObj->rockMonster,elapsed,liveObj->unkbool_2d8);
			}
			else {
				if (OVar1 == OBJECT_BUILDING) {
					fVar2 = FUN_00408790(liveObj->building,elapsed,liveObj->unkbool_2d8);
				}
				else {
					if ((liveObj->flags3_3e8 & LIVEOBJ3_SIMPLEOBJECT) != LIVEOBJ3_NONE) {
						FUN_00448160(liveObj,elapsed2);
						goto LAB_00447ed1;
					}
					if (OVar1 != OBJECT_UPGRADEPART) goto LAB_00447ed1;
					fVar2 = FUN_0046c3d0(liveObj->upgrade,elapsed,liveObj->unkbool_2d8);
				}
			}
		}
	}
	liveObj->float_2d4 = (float)fVar2;
LAB_00447ed1:
	if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 | (ushort)(liveObj->float_2d4 == 0.0) << 0xe)
			== 0) {
		FUN_00403e90(liveObj);
	}
	return (float10)elapsed;
}



uint __cdecl lego::game::Game_UpdateSomeAITasks(LiveObject *liveObj)
{
	ObjectStatsFlags1 OVar1;
	int iVar2;
	char *pcVar3;
	ResourceData *pRVar4;
	uint uVar5;
	char *pcVar6;
	char local_100 [256];
	
	uVar5 = 0;
	pcVar6 = liveObj->aitaskName1;
	if (pcVar6 == liveObj->aitaskName2) {
		return 0;
	}
	if ((((pcVar6 != globals::g_Activities_TABLE[0]) && (pcVar6 != globals::g_Activities_TABLE[1])) &&
			(pcVar6 != globals::g_Activities_TABLE[4])) &&
		 (((pcVar6 != globals::g_Activities_TABLE[6] && (pcVar6 != globals::g_Activities_TABLE[8])) &&
			((pcVar6 != globals::g_Activities_TABLE[17] &&
			 ((pcVar6 != globals::g_Activities_TABLE[22] && (pcVar6 != globals::g_Activities_TABLE[2])))))
			))) {
		FUN_00403e60(liveObj);
	}
	switch(liveObj->objType) {
	case OBJECT_VEHICLE:
		uVar5 = FUN_0046c6b0(liveObj->vehicle,liveObj->aitaskName1,liveObj->float_2d4);
		pRVar4 = res::Vehicle_GetCameraNull(liveObj->vehicle,liveObj->index_2e0);
		break;
	case OBJECT_MINIFIGURE:
		uVar5 = FUN_00406d70(liveObj->miniFigure,liveObj->aitaskName1,liveObj->float_2d4);
		pRVar4 = res::Creature_GetCameraNull(liveObj->miniFigure,liveObj->index_2e0);
		break;
	case OBJECT_ROCKMONSTER:
		uVar5 = FUN_00406d70(liveObj->rockMonster,liveObj->aitaskName1,liveObj->float_2d4);
		pRVar4 = res::Creature_GetCameraNull(liveObj->rockMonster,liveObj->index_2e0);
		break;
	case OBJECT_BUILDING:
		uVar5 = FUN_004084a0(liveObj->building,liveObj->aitaskName1,liveObj->float_2d4);
		pRVar4 = (ResourceData *)FUN_00408520(liveObj->building,liveObj->index_2e0);
		break;
	default:
		goto switchD_00447f7d_caseD_4;
	}
	liveObj->resData_2dc = pRVar4;
switchD_00447f7d_caseD_4:
	OVar1 = LiveObject_GetStatsFlags1(liveObj);
	if ((((OVar1 & STATS1_CANBEDRIVEN) != STATS1_NONE) && (liveObj->drivenObject != NULL)) &&
		 (liveObj->drivenObject->objType == OBJECT_MINIFIGURE)) {
		iVar2 = std::_stricmp(globals::g_Activities_TABLE[1],liveObj->aitaskName1);
		pcVar6 = "Activity_";
		if (iVar2 != 0) {
			pcVar6 = liveObj->aitaskName1;
		}
		pcVar3 = Object_GetTypeName(liveObj->objType,liveObj->objIndex);
		std::sprintf(local_100,"%s%s",pcVar6,pcVar3);
		FUN_00406d70(liveObj->drivenObject->miniFigure,local_100,0.0);
		pRVar4 = res::Creature_GetCameraNull
											 (liveObj->drivenObject->miniFigure,liveObj->drivenObject->index_2e0);
		liveObj->drivenObject->resData_2dc = pRVar4;
		liveObj->drivenObject->aitaskName1 = liveObj->drivenObject->aitaskName2;
	}
	liveObj->float_2d4 = 0.0;
	liveObj->aitaskName2 = liveObj->aitaskName1;
	liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xfffdffff;
	return uVar5;
}



void __cdecl FUN_00448160(LiveObject *param_1,float param_2)
{
	uint *puVar1;
	ObjectType OVar2;
	LiveObject *liveObj;
	LevelSurfaceMap *pLVar3;
	LiveObject *pLVar4;
	uint weaponType;
	LiveFlags1 LVar5;
	int iVar6;
	int iVar7;
	LevelData *level;
	LiveFlags3 LVar8;
	float10 fVar9;
	float10 fVar10;
	float10 fVar11;
	longlong lVar12;
	float fVar13;
	BOOL BVar14;
	LiveObject *y;
	int *out_x;
	float fVar15;
	float *out_x_00;
	ResourceData *resData;
	int *out_y;
	float *pfVar16;
	char *pcVar17;
	int iVar18;
	float local_4c;
	float local_48;
	LiveObject *local_44;
	int local_40;
	int local_3c;
	int local_38;
	float local_34;
	float local_30;
	float local_2c;
	float local_28;
	Vector3F local_24;
	float local_18;
	float local_14;
	float local_10;
	Vector3F local_c;
	
	liveObj = param_1;
	OVar2 = param_1->objType;
	if (OVar2 == OBJECT_BOULDER) {
		if ((param_1->flags3_3e8 & 0x2000) != LIVEOBJ3_NONE) {
			lego::res::Res_GetPosition(param_1->other,NULL,&local_c);
			fVar15 = (liveObj->point_2f4).y;
			fVar13 = (liveObj->point_2f4).x;
			local_24.z = 0.0;
			local_24.x = fVar13;
			local_24.y = fVar15;
			pLVar3 = lego::game::GetSurfaceMap();
			fVar9 = lego::game::SurfaceMap_UnkGetZ(pLVar3,fVar13,fVar15);
			param_1 = (LiveObject *)(float)fVar9;
			fVar10 = lego::game::LiveObject_GetCollRadius(liveObj);
			fVar9 = (float10)(float)param_1;
			fVar11 = (fVar9 - fVar10) - (float10)local_c.z;
			fVar15 = (float)((float10)local_24.x - (float10)local_c.x);
			fVar13 = (float)((float10)local_24.y - (float10)local_c.y);
			local_10 = (float)fVar11;
			param_1 = (LiveObject *)(param_2 * 3.5);
			local_4c = (float)SQRT(fVar11 * (float10)local_10 +
														 ((float10)local_24.y - (float10)local_c.y) * (float10)fVar13 +
														 ((float10)local_24.x - (float10)local_c.x) * (float10)fVar15);
			param_2 = 1.0 / local_4c;
			local_18 = param_2 * fVar15 * (float)param_1;
			local_c.x = local_18 + local_c.x;
			local_14 = param_2 * fVar13 * (float)param_1;
			local_c.y = local_14 + local_c.y;
			local_c.z = param_2 * local_10 * (float)param_1 + local_c.z;
			fVar15 = local_c.x;
			fVar13 = local_c.y;
			local_24.z = local_c.z;
			if (local_4c < (float)param_1) {
				liveObj->carryingThisObject = NULL;
				liveObj->health = -1.0;
				liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xffffdfff | 0x800000;
				fVar15 = local_24.x;
				fVar13 = local_24.y;
				local_24.z = (float)(fVar9 - fVar10);
			}
			local_24.y = fVar13;
			local_24.x = fVar15;
			local_34 = local_24.x;
			out_y = &local_38;
			out_x = &local_3c;
			local_30 = local_24.y;
			fVar15 = local_24.x;
			fVar13 = local_24.y;
			local_44 = param_1;
			pLVar3 = lego::game::GetSurfaceMap();
			lego::game::SurfaceMap_ToBlockCoordinatesNoZ(pLVar3,fVar15,fVar13,out_x,out_y);
			fVar15 = local_24.x;
			fVar13 = local_24.y;
			pLVar3 = lego::game::GetSurfaceMap();
			fVar9 = lego::game::SurfaceMap_UnkGetZ(pLVar3,fVar15,fVar13);
			param_2 = (float)(fVar9 - (float10)local_24.z);
			pLVar4 = (LiveObject *)FUN_00446030(liveObj,&local_34,param_2,1);
			if (pLVar4 != NULL) {
				liveObj->carryingThisObject = NULL;
				liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xffffdfff;
				pfVar16 = &local_2c;
				fVar15 = 0.0;
				BVar14 = 1;
				local_28 = 1.0 / SQRT(local_14 * local_14 + local_18 * local_18);
				local_2c = local_28 * local_18;
				local_28 = local_28 * local_14;
				weaponType = lego::game::Game_GetWeaponType("Boulder");
				FUN_0046f530(pLVar4,weaponType,BVar14,fVar15,pfVar16);
				liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x800000;
				liveObj->health = -1.0;
				lego::res::Res_PlayResourceSound(NULL,0x22,0,0,&local_24);
			}
			lego::res::Res_SetFramePosition(liveObj->other,NULL,local_24.x,local_24.y,local_24.z);
			return;
		}
	}
	else {
		if (OVar2 == OBJECT_POWERCRYSTAL) {
			if (param_1->carryingThisObject == NULL) {
				lego::res::Res_AddRotation(param_1->other,D3DRMCOMBINE_BEFORE,0.0,1.0,0.0,param_2 * 0.01);
				return;
			}
		}
		else {
			if ((OVar2 == OBJECT_DYNAMITE) || (OVar2 == OBJECT_SONICBLASTER)) {
				if ((param_1->flags3_3e8 & 0x10000) == LIVEOBJ3_NONE) {
					if ((param_1->flags1_3e0 & LIVEOBJ1_PLACING) != LIVEOBJ1_NONE) {
						param_1->flags1_3e0 = param_1->flags1_3e0 & ~LIVEOBJ1_PLACING;
						param_1->flags3_3e8 = param_1->flags3_3e8 | 0x10000;
						lego::res::Res_ResourceShortNormal_FUN_00473630(param_1->other,"TickDown");
						lego::res::Res_DoCallbacks(liveObj->other,0.0);
						lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_44,&local_40);
						FUN_00432640((int *)&local_44,1);
						lego::game::Info_FUN_00419ab0(INFO_DYNAMITEPLACED,NULL,liveObj,NULL);
						lVar12 = __ftol((float10)(liveObj->point_2f4).y);
						iVar6 = (int)lVar12;
						lVar12 = __ftol((float10)(liveObj->point_2f4).x);
						iVar7 = (int)lVar12;
						pLVar3 = lego::game::GetSurfaceMap();
						FUN_0044f830(pLVar3,iVar7,iVar6);
						return;
					}
					lego::res::Res_DoAnimElapsedCallbacks(param_1->other,param_2);
				}
				else {
					if (((ushort)((ushort)(param_1->health < 0.0) << 8 |
											 (ushort)(param_1->health == 0.0) << 0xe) != 0) ||
						 (fVar9 = lego::res::Res_DoAnimElapsedCallbacks(param_1->other,param_2),
						 fVar9 != (float10)0.0)) {
						lVar12 = __ftol((float10)(liveObj->point_2f4).x);
						iVar6 = (int)lVar12;
						local_3c = iVar6;
						lVar12 = __ftol((float10)(liveObj->point_2f4).y);
						iVar7 = (int)lVar12;
						local_38 = iVar7;
						if ((iVar6 != 0) && (iVar7 != 0)) {
							iVar18 = 0;
							level = lego::game::GetLevel();
							FUN_00430460(level,iVar6,iVar7,iVar18);
						}
						if (liveObj->objType == OBJECT_DYNAMITE) {
							lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_3c,&local_38);
							FUN_00432640(&local_3c,0);
							FUN_00440a70((undefined4 *)liveObj,lego::globals::g_Game.DynamiteDamageRadius,
													 lego::globals::g_Game.DynamiteMaxDamage,
													 lego::globals::g_Game.DynamiteWakeRadius);
							lego::snd::Snd_Play_FUN_00465260(0x2b,0);
							FUN_0040c680(liveObj,NULL);
							FUN_00435e62(lego::globals::g_Game.structbc_24,5.0,50.0);
						}
						else {
							if (liveObj->objType == OBJECT_SONICBLASTER) {
								lego::game::LiveObject_GetPosition(liveObj,(float *)&local_c,&local_c.y);
								lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_44,&local_40);
								pLVar3 = lego::game::GetSurfaceMap();
								fVar9 = lego::game::SurfaceMap_UnkGetZ(pLVar3,local_c.x,local_c.y);
								local_c.z = (float)fVar9;
								FUN_0040cc10(8,(undefined4 *)&local_c,NULL);
								FUN_00435e62(lego::globals::g_Game.structbc_24,2.0,(float)&DAT_42c80000);
								FUN_00432640((int *)&local_44,0);
							}
						}
						liveObj->health = -1.0;
						liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x800000;
						return;
					}
				}
			}
			else {
				if (OVar2 == OBJECT_ELECTRICFENCE) {
					if ((param_1->flags1_3e0 & LIVEOBJ1_PLACING) != LIVEOBJ1_NONE) {
						param_1->flags1_3e0 = param_1->flags1_3e0 & ~LIVEOBJ1_PLACING;
						FUN_0040ce80(param_1);
						lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_44,(int *)&param_1);
						pfVar16 = &local_48;
						out_x_00 = &local_4c;
						pLVar4 = local_44;
						y = param_1;
						pLVar3 = lego::game::GetSurfaceMap();
						FUN_0044f900(pLVar3,(uint)pLVar4,(uint)y,out_x_00,pfVar16);
						fVar9 = FUN_00442740(liveObj);
						BVar14 = 1;
						param_2 = (float)(fVar9 - (float10)-0.7853982);
						fVar9 = (float10)FUN_0048e46a();
						FUN_00442b60(liveObj,local_4c,local_48,(float)((float10)param_2 - fVar9),BVar14);
						FUN_00432400((int)local_44,(int)param_1,0);
						return;
					}
				}
				else {
					if (OVar2 == OBJECT_BARRIER) {
						fVar9 = lego::res::Res_DoAnimElapsedCallbacks(param_1->other,param_2);
						if (fVar9 == (float10)0.0) {
							return;
						}
						LVar5 = liveObj->flags1_3e0;
						if ((LVar5 & LIVEOBJ1_PLACING) != LIVEOBJ1_NONE) {
							pcVar17 = "Expand";
							liveObj->flags1_3e0 = LVar5 & ~LIVEOBJ1_PLACING | 0x100;
							goto LAB_0044872d;
						}
						if ((LVar5 & 0x100) != LIVEOBJ1_NONE) {
							liveObj->flags1_3e0 = LVar5 & 0xfffffeff;
							liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x10000;
							pcVar17 = "Long";
							goto LAB_00448783;
						}
						LVar8 = liveObj->flags3_3e8;
						if ((LVar8 & 0x800000) != LIVEOBJ3_NONE) {
							liveObj->health = (float)&DAT_42c80000;
							liveObj->flags3_3e8 = LVar8 & 0xff7fffff;
							liveObj->flags1_3e0 = LVar5 | 0x200000;
							lego::res::Res_ResourceShortNormal_FUN_00473630(liveObj->other,"Teleport");
							lego::res::Res_DoCallbacks(liveObj->other,0.0);
							return;
						}
					}
					else {
						if (OVar2 != OBJECT_SPIDERWEB) {
							if (OVar2 != OBJECT_ICECUBE) {
								if ((((OVar2 != OBJECT_ELECTRICFENCESTUD) && (OVar2 != OBJECT_PUSHER)) &&
										(OVar2 != OBJECT_FREEZER)) && (OVar2 != OBJECT_LASERSHOT)) {
									return;
								}
								lego::res::Res_DoAnimElapsedCallbacks(param_1->other,param_2);
								return;
							}
							fVar9 = lego::res::Res_DoAnimElapsedCallbacks(param_1->other,param_2);
							if (fVar9 == (float10)0.0) {
								return;
							}
							LVar5 = liveObj->flags1_3e0;
							if ((LVar5 & 0x100) == LIVEOBJ1_NONE) {
								LVar8 = liveObj->flags3_3e8;
								if ((LVar8 & 0x800000) == LIVEOBJ3_NONE) {
									if ((LVar5 & 0x200000) == LIVEOBJ1_NONE) {
										return;
									}
									liveObj->flags1_3e0 = LVar5 & 0xffdfffff;
									liveObj->health = -1.0;
									liveObj->flags3_3e8 = LVar8 | 0x800000;
									puVar1 = (uint *)(liveObj->field_364 + 0x3e4);
									*puVar1 = *puVar1 & 0xf7ffffff;
									return;
								}
								liveObj->health = (float)&DAT_42c80000;
								liveObj->flags3_3e8 = LVar8 & 0xff7fffff;
								liveObj->flags1_3e0 = LVar5 | 0x200000;
								pcVar17 = "Melt";
LAB_00448783:
								lego::res::Res_ResourceShortNormal_FUN_00473630(liveObj->other,pcVar17);
								lego::res::Res_DoCallbacks(liveObj->other,0.0);
								return;
							}
							liveObj->flags1_3e0 = LVar5 & 0xfffffeff;
							liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x10000;
							pcVar17 = "Normal";
LAB_0044872d:
							lego::res::Res_ResourceShortNormal_FUN_00473630(liveObj->other,pcVar17);
							lego::res::Res_DoCallbacks(liveObj->other,0.0);
							return;
						}
						if (((param_1->flags1_3e0 & 0x2000000) == LIVEOBJ1_NONE) ||
							 ((param_1->flags1_3e0 & 0x100) != LIVEOBJ1_NONE)) {
							resData = param_1->other;
							fVar15 = param_2;
						}
						else {
							resData = param_1->other;
							fVar15 = 0.0;
						}
						fVar9 = lego::res::Res_DoAnimElapsedCallbacks(resData,fVar15);
						if (fVar9 == (float10)0.0) {
							return;
						}
						LVar5 = liveObj->flags1_3e0;
						if ((LVar5 & 0x100) != LIVEOBJ1_NONE) {
							liveObj->flags1_3e0 = LVar5 & 0xfffffeff;
							liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x10000;
							pcVar17 = "FlapInWind";
							goto LAB_0044872d;
						}
						LVar8 = liveObj->flags3_3e8;
						if ((LVar8 & 0x800000) != LIVEOBJ3_NONE) {
							liveObj->health = (float)&DAT_42c80000;
							liveObj->flags3_3e8 = LVar8 & 0xff7fffff;
							liveObj->flags1_3e0 = LVar5 | 0x200000;
							pcVar17 = "Disintegrate";
							goto LAB_00448783;
						}
					}
					if ((LVar5 & 0x200000) != LIVEOBJ1_NONE) {
						liveObj->flags1_3e0 = LVar5 & 0xffdfffff;
						liveObj->health = -1.0;
						liveObj->flags3_3e8 = LVar8 | 0x800000;
						return;
					}
				}
			}
		}
	}
	return;
}



void __cdecl FUN_00448a80(int *param_1)
{
	if (((param_1[0xf8] & 0x400U) != 0) && (*(int *)param_1[0xc2] == 8)) {
		((int *)param_1[0xc2])[0xbe] = 0;
		*(undefined4 *)(param_1[0xc2] + 0x2f4) = 0;
		FUN_0043a130((LiveObject *)param_1,1);
	}
	return;
}



undefined4 __cdecl FUN_00448ac0(int *param_1,uint *param_2)
{
	int iVar1;
	BOOL BVar2;
	
	if (*(int *)param_1[0xc2] == 8) {
		iVar1 = FUN_00432880((int)param_1,*param_2,param_2[1]);
		if (iVar1 != 0) {
			BVar2 = FUN_00449b40((LiveObject *)param_1,*param_2,param_2[1],7.0);
			if (BVar2 != 0) {
				iVar1 = param_1[0xc2];
				*(undefined *)(param_1[9] + -3 + param_1[10] * 0x14) = 9;
				*(float *)(iVar1 + 0x2f4) = (float)*param_2;
				*(float *)(iVar1 + 0x2f8) = (float)param_2[1];
				return 1;
			}
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00448b40(int *param_1,float *param_2)
{
	float *pfVar1;
	int *liveObj;
	float *pfVar2;
	int iVar3;
	BOOL BVar4;
	uint local_c;
	float local_8;
	float local_4;
	
	pfVar2 = param_2;
	liveObj = param_1;
	if (*(int *)param_1[0xc2] == 0xd) {
		pfVar1 = param_2 + 1;
		iVar3 = FUN_00432900(param_1,(uint)*param_2,(uint)param_2[1]);
		if (iVar3 != 0) {
			lego::game::LiveObject_GetBlockCoordinates
								((LiveObject *)liveObj,(int *)&local_8,(int *)&local_4);
			if ((local_8 == *pfVar2) && (local_4 == *pfVar1)) {
				FUN_004419c0((LiveObject *)liveObj,1,pfVar2,pfVar1,NULL);
				return 0;
			}
			BVar4 = FUN_004413b0(liveObj,local_8,local_4,*pfVar2,*pfVar1,&param_1,&param_2,&local_c,0,0);
			if (BVar4 != 0) {
				BVar4 = FUN_004419c0((LiveObject *)liveObj,local_c,(float *)param_1,param_2,NULL);
				std::free(param_1);
				std::free(param_2);
				if (BVar4 != 0) {
					iVar3 = liveObj[0xc2];
					*(undefined *)(liveObj[9] + -3 + liveObj[10] * 0x14) = 9;
					*(float *)(iVar3 + 0x2f4) = (float)(int)*pfVar2;
					*(float *)(iVar3 + 0x2f8) = (float)(int)*pfVar1;
					return 1;
				}
			}
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00448c60(undefined4 *param_1)
{
	BOOL BVar1;
	LiveObject *pLVar2;
	float10 fVar3;
	float local_10;
	float local_c;
	int local_8;
	int local_4;
	
	BVar1 = lego::game::LiveObject_HasToolEquipped((LiveObject *)param_1,TOOL_SONICBLASTER);
	if (BVar1 != 0) {
		lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_10,&local_c);
		lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_1,&local_8,&local_4);
		fVar3 = FUN_00442740((LiveObject *)param_1);
		pLVar2 = lego::game::Game_CreateLiveResourceObject
											 (lego::globals::g_Game.RES_OohScary,OBJECT_SONICBLASTER,0,0,local_10,local_c,
												(float)fVar3);
		FUN_00432640(&local_8,1);
		lego::res::Res_ResourceShortNormal_FUN_00473630(pLVar2->other,"TickDown");
		lego::res::Res_DoCallbacks(pLVar2->other,0.0);
		pLVar2->flags3_3e8 = pLVar2->flags3_3e8 | 0x10000;
		return 1;
	}
	return 0;
}



undefined4 __cdecl FUN_00448d20(int *param_1,float *param_2)
{
	float *pfVar1;
	float fVar2;
	int iVar3;
	float *pfVar4;
	short sVar5;
	int iVar6;
	BOOL BVar7;
	uint uVar8;
	float10 fVar9;
	float *local_18;
	uint local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	pfVar4 = param_2;
	if (*(int *)param_1[0xc2] == 0xb) {
		pfVar1 = param_2 + 1;
		iVar6 = FUN_0040d170((int)*param_2,(int)param_2[1]);
		if (iVar6 != 0) {
			lego::game::LiveObject_GetBlockCoordinates
								((LiveObject *)param_1,(int *)&local_8,(int *)&local_4);
			if ((local_8 == *pfVar4) && (local_4 == *pfVar1)) {
				BVar7 = FUN_004419c0((LiveObject *)param_1,1,pfVar4,pfVar1,NULL);
			}
			else {
				BVar7 = FUN_004413b0(param_1,local_8,local_4,*pfVar4,*pfVar1,&param_2,&local_18,&local_14,0,
														 0);
				if (BVar7 == 0) {
					return 0;
				}
				BVar7 = FUN_004419c0((LiveObject *)param_1,local_14,param_2,local_18,NULL);
				std::free(param_2);
				std::free(local_18);
			}
			if (BVar7 != 0) {
				*(undefined *)(param_1[9] + -3 + param_1[10] * 0x14) = 9;
				if (*param_1 == 1) {
					fVar9 = lego::game::Game_ChooseRandomRange(0.55,0.75);
					fVar2 = (float)fVar9;
					sVar5 = lego::util::randomInt16();
					uVar8 = (int)sVar5 >> 0x1f;
					switch((((int)sVar5 ^ uVar8) - uVar8 & 3 ^ uVar8) - uVar8) {
					case 0:
						local_10 = 0.5;
						local_c = fVar2;
						break;
					case 1:
						local_c = 0.5;
						local_10 = fVar2;
						break;
					case 2:
						local_10 = 0.5;
						local_c = 1.0 - fVar2;
						break;
					case 3:
						local_c = 0.5;
						local_10 = 1.0 - fVar2;
					}
					iVar6 = param_1[10];
					iVar3 = param_1[9];
					*(float *)(iVar3 + -0xc + iVar6 * 0x14) = local_10;
					*(float *)(iVar3 + -8 + iVar6 * 0x14) = local_c;
					*(byte *)(param_1[9] + -4 + param_1[10] * 0x14) =
							 *(byte *)(param_1[9] + -4 + param_1[10] * 0x14) | 8;
				}
				iVar6 = param_1[0xc2];
				*(float *)(iVar6 + 0x2f4) = (float)(int)*pfVar4;
				*(float *)(iVar6 + 0x2f8) = (float)(int)*pfVar1;
				return 1;
			}
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00448f10(uint *param_1)
{
	lego::game::LiveObject_SetActivityUnk((LiveObject *)param_1,ACTIVITY_CLEAR,0);
	lego::game::Game_UpdateSomeAITasks((LiveObject *)param_1);
	param_1[0xf9] = param_1[0xf9] | 0x200;
	return 1;
}



int __cdecl FUN_00448f50(int *param_1,float *param_2,int param_3)
{
	byte *pbVar1;
	float fVar2;
	int *liveObj;
	float *liveObj_00;
	int iVar3;
	ResourceData *resData;
	LevelSurfaceMap *surfaceMap;
	byte bVar4;
	BOOL BVar5;
	float *out_x;
	float *out_y;
	uint local_30;
	float local_2c;
	float local_28;
	float local_24;
	float local_20;
	int local_1c;
	int local_18 [2];
	float local_10;
	Vector3F local_c;
	
	liveObj_00 = param_2;
	liveObj = param_1;
	BVar5 = 0;
	if (*param_2 == 5.605194e-45) {
		if (*param_1 == 2) {
			iVar3 = FUN_00449170(param_1,(int *)param_2,1);
			if (iVar3 != 0) {
				return 1;
			}
		}
		else {
			if (*param_1 == 1) {
				resData = lego::game::LiveObject_GetDepositNull((LiveObject *)param_2);
				lego::res::Res_GetPosition(resData,NULL,&local_c);
				out_y = &local_28;
				out_x = &local_2c;
				surfaceMap = lego::game::GetSurfaceMap();
				lego::game::SurfaceMap_ToBlockCoordinatesNoZ
									(surfaceMap,local_c.x,local_c.y,(int *)out_x,(int *)out_y);
				lego::game::LiveObject_GetBlockCoordinates
									((LiveObject *)liveObj,(int *)&local_24,(int *)&local_20);
				lego::game::LiveObject_GetBlockCoordinates((LiveObject *)liveObj_00,&local_1c,local_18);
				fVar2 = (float)(int)local_2c - (float)local_1c;
				local_10 = (float)(int)local_28 - (float)local_18[0];
				if (ABS(fVar2) <= ABS(local_10)) {
					if ((ushort)((ushort)(local_10 < 0.0) << 8 | (ushort)(local_10 == 0.0) << 0xe) == 0) {
						bVar4 = 0;
					}
					else {
						bVar4 = 2;
					}
				}
				else {
					if ((ushort)((ushort)(fVar2 < 0.0) << 8 | (ushort)(fVar2 == 0.0) << 0xe) == 0) {
						bVar4 = 1;
					}
					else {
						bVar4 = 3;
					}
				}
				if ((local_24 == local_2c) && (local_20 == local_28)) {
					BVar5 = FUN_004419c0((LiveObject *)liveObj,1,&local_2c,&local_28,NULL);
				}
				else {
					BVar5 = FUN_004413b0(liveObj,local_24,local_20,local_2c,local_28,&param_2,&param_1,
															 &local_30,0,0);
					if (BVar5 == 0) {
						return 0;
					}
					BVar5 = FUN_004419c0((LiveObject *)liveObj,local_30,param_2,(float *)param_1,NULL);
					std::free(param_2);
					std::free(param_1);
				}
				if (BVar5 != 0) {
					*(undefined *)(liveObj[9] + -3 + liveObj[10] * 0x14) = 0xf;
					pbVar1 = (byte *)(liveObj[9] + -4 + liveObj[10] * 0x14);
					*pbVar1 = *pbVar1 | 4;
					*(byte *)(liveObj[9] + -4 + liveObj[10] * 0x14) =
							 *(byte *)(liveObj[9] + -4 + liveObj[10] * 0x14) | bVar4;
					liveObj[0x101] = param_3;
					liveObj[0xbf] = (int)liveObj_00;
					liveObj_00[0xc0] = (float)liveObj;
					return BVar5;
				}
			}
		}
	}
	return BVar5;
}



undefined4 __cdecl FUN_00449170(int *param_1,int *param_2,int param_3)
{
	byte *pbVar1;
	int iVar2;
	int iVar3;
	float fVar4;
	int *piVar5;
	BOOL BVar6;
	LevelSurfaceMap *surfMap;
	uint uVar7;
	float10 fVar8;
	uint local_28;
	uint local_24;
	float local_20 [4];
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	piVar5 = param_2;
	if ((*param_1 == 2) && (*param_2 == 4)) {
		lego::game::LiveObject_GetBlockCoordinates
							((LiveObject *)param_2,(int *)&local_28,(int *)&local_24);
		BVar6 = FUN_00446c80((LiveObject *)param_1,local_28,local_24,0,(uint *)&param_2,1);
		if (BVar6 != 0) {
			surfMap = lego::game::GetSurfaceMap();
			fVar8 = lego::game::SurfaceMap_GetFloat10(surfMap);
			local_c = (float)((float10)4.0 / fVar8);
			fVar8 = lego::game::Game_ChooseRandomRange(0.1,0.9);
			iVar2 = param_1[10];
			local_20[0] = (float)fVar8;
			local_8 = local_c;
			uVar7 = (int)param_2 - 2U & 3;
			local_20[3] = local_20[0];
			local_10 = local_20[0];
			local_4 = local_20[0];
			local_20[1] = 1.0 - local_c;
			local_20[2] = 1.0 - local_c;
			iVar3 = param_1[9];
			fVar4 = local_20[uVar7 * 2 + 1];
			*(float *)(iVar3 + -0xc + iVar2 * 0x14) = local_20[uVar7 * 2];
			*(float *)(iVar3 + -8 + iVar2 * 0x14) = fVar4;
			if (param_3 == 0) {
				*(undefined *)(param_1[9] + -3 + param_1[10] * 0x14) = 0xe;
			}
			else {
				*(undefined *)(param_1[9] + -3 + param_1[10] * 0x14) = 0xf;
			}
			*(byte *)(param_1[9] + -4 + param_1[10] * 0x14) =
					 *(byte *)(param_1[9] + -4 + param_1[10] * 0x14) | 4;
			pbVar1 = (byte *)(param_1[9] + -4 + param_1[10] * 0x14);
			param_2._0_1_ = (byte)uVar7;
			*pbVar1 = *pbVar1 | (byte)param_2;
			param_1[0xbf] = (int)piVar5;
			return 1;
		}
	}
	return 0;
}



undefined4 __cdecl FUN_004492d0(int *param_1)
{
	int iVar1;
	BOOL BVar2;
	uint local_8;
	uint local_4;
	
	if ((((*param_1 == 2) && ((param_1[0xf8] & 0x400U) != 0)) && (*(int *)param_1[0xc2] == 6)) &&
		 ((((int *)param_1[0xc2])[0xfa] & 0x80000000U) != 0)) {
		iVar1 = FUN_0044a690(param_1,&local_8);
		if (iVar1 != 0) {
			BVar2 = FUN_00449b40((LiveObject *)param_1,local_8,local_4,3.0);
			if (BVar2 != 0) {
				*(undefined *)(param_1[9] + -3 + param_1[10] * 0x14) = 0x12;
				param_1[0xbd] = (int)(float)local_8;
				param_1[0xbe] = (int)(float)local_4;
				return 1;
			}
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00449360(int *param_1,int *param_2,int param_3,int param_4)
{
	byte *pbVar1;
	int iVar2;
	int iVar3;
	float fVar4;
	bool bVar5;
	int *liveObj;
	ObjectStatsFlags2 OVar6;
	BOOL BVar7;
	LevelSurfaceMap *surfMap;
	uint uVar8;
	float10 fVar9;
	uint local_28;
	uint local_24;
	float local_20 [4];
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	liveObj = param_2;
	iVar2 = *param_1;
	if ((iVar2 != 2) && (iVar2 != 3)) {
		return 0;
	}
	if (*param_2 != 4) {
		return 0;
	}
	if ((iVar2 == 3) &&
		 (OVar6 = lego::game::LiveObject_GetStatsFlags2((LiveObject *)param_1),
		 (OVar6 & STATS2_DRAINPOWER) == STATS2_NONE)) {
		bVar5 = true;
	}
	else {
		bVar5 = false;
	}
	lego::game::LiveObject_GetBlockCoordinates
						((LiveObject *)liveObj,(int *)&local_28,(int *)&local_24);
	BVar7 = FUN_00446c80((LiveObject *)param_1,local_28,local_24,0,(uint *)&param_2,
											 (uint)(*param_1 != 3));
	if (BVar7 == 0) {
		return 0;
	}
	surfMap = lego::game::GetSurfaceMap();
	fVar9 = lego::game::SurfaceMap_GetFloat10(surfMap);
	local_c = (float)((float10)4.0 / fVar9);
	if (bVar5) {
		fVar9 = (float10)0.5;
	}
	else {
		fVar9 = lego::game::Game_ChooseRandomRange(0.2,0.8);
	}
	local_20[0] = (float)fVar9;
	local_8 = local_c;
	uVar8 = (int)param_2 - 2U & 3;
	local_20[1] = 1.0 - local_c;
	local_20[2] = 1.0 - local_c;
	iVar2 = param_1[10];
	local_20[3] = (float)fVar9;
	local_10 = (float)fVar9;
	local_4 = (float)fVar9;
	iVar3 = param_1[9];
	fVar4 = local_20[uVar8 * 2 + 1];
	*(float *)(iVar3 + -0xc + iVar2 * 0x14) = local_20[uVar8 * 2];
	*(float *)(iVar3 + -8 + iVar2 * 0x14) = fVar4;
	*(undefined *)(param_1[9] + -3 + param_1[10] * 0x14) = 6;
	*(byte *)(param_1[9] + -4 + param_1[10] * 0x14) =
			 *(byte *)(param_1[9] + -4 + param_1[10] * 0x14) | 4;
	param_2._0_1_ = (byte)uVar8;
	pbVar1 = (byte *)(param_1[9] + -4 + param_1[10] * 0x14);
	*pbVar1 = *pbVar1 | (byte)param_2;
	if (param_3 != 0) {
		pbVar1 = (byte *)(param_1[9] + -4 + param_1[10] * 0x14);
		*pbVar1 = *pbVar1 | 0x20;
	}
	if (param_4 != 0) {
		param_1[0xfb] = param_1[0xfb] | 0x400000;
	}
	param_1[0xbf] = (int)liveObj;
	return 1;
}



undefined4 __cdecl FUN_00449500(int *param_1,uint *param_2)
{
	BOOL BVar1;
	
	BVar1 = FUN_00432950((LiveObject *)param_1,*param_2,param_2[1]);
	if (BVar1 != 0) {
		BVar1 = FUN_00449b40((LiveObject *)param_1,*param_2,param_2[1],3.0);
		if (BVar1 != 0) {
			*(undefined *)(param_1[9] + -3 + param_1[10] * 0x14) = 2;
			param_1[0xbd] = (int)(float)*param_2;
			param_1[0xbe] = (int)(float)param_2[1];
			return 1;
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00449570(int *param_1,float *param_2)
{
	int *liveObj;
	float *pfVar1;
	int iVar2;
	ObjectStatsFlags1 OVar3;
	BOOL BVar4;
	uint local_c;
	float local_8;
	float local_4;
	
	pfVar1 = param_2;
	iVar2 = lego::game::Level_GetBlockRubbleLevel_OrFlag200000((Point2I *)param_2);
	liveObj = param_1;
	if (iVar2 != 0) {
		OVar3 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1);
		if ((OVar3 & STATS1_CANCLEARRUBBLE) == STATS1_NONE) {
			return 1;
		}
		lego::game::LiveObject_GetBlockCoordinates
							((LiveObject *)liveObj,(int *)&local_8,(int *)&local_4);
		if ((local_8 == *pfVar1) && (local_4 == pfVar1[1])) {
			BVar4 = FUN_004419c0((LiveObject *)liveObj,1,pfVar1,pfVar1 + 1,NULL);
		}
		else {
			BVar4 = FUN_004413b0(liveObj,local_8,local_4,*pfVar1,pfVar1[1],&param_2,&param_1,&local_c,0,0)
			;
			if (BVar4 == 0) {
				return 0;
			}
			BVar4 = FUN_004419c0((LiveObject *)liveObj,local_c,param_2,(float *)param_1,NULL);
			std::free(param_2);
			std::free(param_1);
		}
		if (BVar4 == 0) {
			return 0;
		}
		*(undefined *)(liveObj[9] + -3 + liveObj[10] * 0x14) = 4;
		if (*liveObj == 1) {
			FUN_00432640((int *)pfVar1,1);
			FUN_00433050((int *)pfVar1,1);
			return 1;
		}
	}
	return 1;
}



undefined4 __cdecl FUN_004496a0(int *param_1)
{
	BOOL BVar1;
	
	if (*param_1 != 2) {
		return 0;
	}
	BVar1 = lego::game::LiveObject_HasToolEquipped((LiveObject *)param_1,TOOL_LASERBEAM);
	if (((BVar1 == 0) &&
			(BVar1 = lego::game::LiveObject_HasToolEquipped((LiveObject *)param_1,TOOL_PUSHERBEAM),
			BVar1 == 0)) &&
		 (BVar1 = lego::game::LiveObject_HasToolEquipped((LiveObject *)param_1,TOOL_FREEZERBEAM),
		 BVar1 == 0)) {
		return 0;
	}
	return 1;
}



int __cdecl FUN_004496f0(int *param_1,float *param_2)
{
	float *pfVar1;
	BOOL BVar2;
	float *local_18;
	uint local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	pfVar1 = param_2;
	lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_2,(int *)&local_10,(int *)&local_c)
	;
	lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_1,(int *)&local_8,(int *)&local_4);
	if ((local_8 == local_10) && (local_4 == local_c)) {
		BVar2 = FUN_004419c0((LiveObject *)param_1,1,&local_10,&local_c,NULL);
	}
	else {
		BVar2 = FUN_004413b0(param_1,local_8,local_4,local_10,local_c,&param_2,&local_18,&local_14,0,0);
		if (BVar2 == 0) {
			return 0;
		}
		BVar2 = FUN_004419c0((LiveObject *)param_1,local_14,param_2,local_18,NULL);
		std::free(param_2);
		std::free(local_18);
	}
	if (BVar2 != 0) {
		*(undefined *)(param_1[9] + -3 + param_1[10] * 0x14) = 0x11;
		param_1[0xbf] = (int)pfVar1;
	}
	return BVar2;
}



int __cdecl FUN_004497e0(int *param_1,undefined4 *param_2)
{
	int *liveObj;
	BOOL BVar1;
	float *local_18;
	uint local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	liveObj = param_1;
	lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_1,(int *)&local_8,(int *)&local_4);
	lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_2,(int *)&local_10,(int *)&local_c)
	;
	if ((local_8 == local_10) && (local_4 == local_c)) {
		BVar1 = FUN_004419c0((LiveObject *)liveObj,1,&local_10,&local_c,NULL);
	}
	else {
		BVar1 = FUN_004413b0(liveObj,local_8,local_4,local_10,local_c,&param_1,&local_18,&local_14,0,0);
		if (BVar1 == 0) {
			return 0;
		}
		BVar1 = FUN_004419c0((LiveObject *)liveObj,local_14,(float *)param_1,local_18,NULL);
		std::free(param_1);
		std::free(local_18);
	}
	if (BVar1 != 0) {
		*(undefined *)(liveObj[9] + -3 + liveObj[10] * 0x14) = 0x14;
	}
	return BVar1;
}



int __cdecl FUN_004498d0(LiveObject *liveObj,float *param_2)
{
	LiveObject *liveObj_00;
	float *pfVar1;
	BOOL BVar2;
	float *local_10;
	uint local_c;
	float local_8;
	float local_4;
	
	liveObj_00 = liveObj;
	lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_8,(int *)&local_4);
	pfVar1 = param_2;
	if ((local_8 == *param_2) && (local_4 == param_2[1])) {
		BVar2 = FUN_004419c0(liveObj_00,1,param_2,param_2 + 1,NULL);
	}
	else {
		BVar2 = FUN_004413b0(liveObj_00,local_8,local_4,*param_2,param_2[1],&liveObj,&local_10,&local_c,
												 0,0);
		if (BVar2 == 0) {
			return 0;
		}
		BVar2 = FUN_004419c0(liveObj_00,local_c,(float *)liveObj,local_10,NULL);
		std::free(liveObj);
		std::free(local_10);
	}
	if (BVar2 != 0) {
		*(undefined *)((int)liveObj_00->routeptr_24 + liveObj_00->routingBlocksTotal * 0x14 + -3) = 0x10
		;
		(liveObj_00->point_2f4).x = (float)(int)*pfVar1;
		(liveObj_00->point_2f4).y = (float)(int)pfVar1[1];
	}
	return BVar2;
}



int __cdecl FUN_004499c0(LiveObject *in_liveObj)
{
	LiveObject *liveObj;
	ObjectStatsFlags2 OVar1;
	int iVar2;
	BOOL BVar3;
	BOOL BVar4;
	float *local_18;
	uint local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	liveObj = in_liveObj;
	BVar4 = 0;
	OVar1 = lego::game::LiveObject_GetStatsFlags2(in_liveObj);
	if ((OVar1 & STATS2_USEHOLES) == STATS2_NONE) {
		BVar3 = FUN_0044a890(liveObj,(int *)&local_10,(int *)&local_c,1,0,1);
		if ((BVar3 != 0) && (BVar3 = FUN_00449b40(liveObj,(uint)local_10,(uint)local_c,3.0), BVar3 != 0)
			 ) {
			BVar4 = 1;
			*(undefined *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -3) = 10;
			(liveObj->point_2f4).x = (float)(int)local_10;
			(liveObj->point_2f4).y = (float)(int)local_c;
		}
	}
	else {
		iVar2 = FUN_0044a7b0((undefined4 *)liveObj,&local_10);
		if (iVar2 != 0) {
			lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_8,(int *)&local_4);
			if ((local_8 == local_10) && (local_4 == local_c)) {
				BVar4 = FUN_004419c0(liveObj,1,&local_10,&local_c,NULL);
			}
			else {
				BVar4 = FUN_004413b0(liveObj,local_8,local_4,local_10,local_c,&in_liveObj,&local_18,
														 &local_14,0,0);
				if (BVar4 == 0) {
					BVar4 = 0;
				}
				else {
					BVar4 = FUN_004419c0(liveObj,local_14,(float *)in_liveObj,local_18,NULL);
					std::free(in_liveObj);
					std::free(local_18);
				}
			}
			if (BVar4 == 0) {
				return 0;
			}
			*(undefined *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -3) = 10;
			(liveObj->point_2f4).x = (float)(int)local_10;
			(liveObj->point_2f4).y = (float)(int)local_c;
		}
	}
	if (BVar4 != 0) {
		FUN_004029d0(liveObj);
	}
	return BVar4;
}



BOOL __cdecl FUN_00449b40(LiveObject *liveObj,uint x,uint y,float param_4)
{
	byte *pbVar1;
	uint uVar2;
	BOOL BVar3;
	LevelSurfaceMap *surfMap;
	float10 fVar4;
	
	uVar2 = y;
	BVar3 = lego::game::Level_GetBlockFlags1_10Not8(x,y);
	if ((BVar3 != 0) && (BVar3 = FUN_00446c80(liveObj,x,uVar2,0,&y,1), BVar3 != 0)) {
		surfMap = lego::game::GetSurfaceMap();
		fVar4 = lego::game::SurfaceMap_GetFloat10(surfMap);
		fVar4 = (float10)param_4 / fVar4;
		*(undefined4 *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -8) =
				 0x3f000000;
		*(undefined4 *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -0xc) =
				 0x3f000000;
		switch(y) {
		case 0:
			*(float *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -8) = (float)fVar4
			;
			break;
		case 1:
			*(float *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -0xc) =
					 (float)fVar4;
			break;
		case 2:
			*(float *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -8) =
					 (float)((float10)1.0 - fVar4);
			break;
		case 3:
			*(float *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -0xc) =
					 (float)((float10)1.0 - fVar4);
		}
		pbVar1 = (byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -4);
		*pbVar1 = *pbVar1 | 8;
		return 1;
	}
	return 0;
}



BOOL __cdecl FUN_00449c40(LiveObject *liveObj,undefined4 param_2,BOOL *out_bool)
{
	BOOL BVar1;
	longlong lVar2;
	longlong lVar3;
	Point2I local_8;
	
	*out_bool = 0;
	if ((*(byte *)&liveObj->flags1_3e0 & 0x40) == 0) {
		return 0;
	}
	lVar2 = __ftol((float10)(liveObj->point_2f4).x);
	local_8.x = (uint)lVar2;
	lVar3 = __ftol((float10)(liveObj->point_2f4).y);
	local_8.y = (int)lVar3;
	BVar1 = FUN_00432950(liveObj,(uint)lVar2,local_8.y);
	if (BVar1 == 0) {
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_CANTDO,1);
		liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_REINFORCING | 0x80000000;
	}
	else {
		if ((ushort)((ushort)(liveObj->float_2d4 < 0.0) << 8 |
								(ushort)(liveObj->float_2d4 == 0.0) << 0xe) != 0) {
			return 1;
		}
		liveObj->flags1_3e0 = liveObj->flags1_3e0 & ~LIVEOBJ1_REINFORCING;
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_STAND,0);
		FUN_00431070(local_8.x,local_8.y);
		(liveObj->point_2f4).y = -1.0;
		(liveObj->point_2f4).x = -1.0;
		*out_bool = 1;
	}
	lego::game::Level_SetBlockFlags1_8000000(&local_8,0);
	return 1;
}



void __cdecl FUN_00449d30(LiveObject *liveObj)
{
	if (liveObj->objType == OBJECT_MINIFIGURE) {
		liveObj->flags2_3e4 = liveObj->flags2_3e4 | LIVEOBJ2_UNK_800;
	}
	if ((liveObj->flags1_3e0 & LIVEOBJ1_CARRYING) == LIVEOBJ1_NONE) {
		liveObj->flags1_3e0 = liveObj->flags1_3e0 | LIVEOBJ1_EATING;
		lego::game::LiveObject_SetActivityUnk(liveObj,ACTIVITY_EAT,0);
		lego::game::Game_UpdateSomeAITasks(liveObj);
		FUN_00403e60(liveObj);
	}
	return;
}



BOOL __cdecl FUN_00449d80(LiveObject *liveObj1,LiveObject *liveObj2)
{
	byte *pbVar1;
	uint uVar2;
	void *pvVar3;
	LiveObject *liveObj;
	LiveObject *pLVar4;
	BOOL BVar5;
	LevelSurfaceMap *surfMap;
	uint uVar6;
	float10 fVar7;
	uint local_28;
	uint local_24;
	float local_20 [4];
	undefined4 local_10;
	float local_c;
	float local_8;
	undefined4 local_4;
	
	pLVar4 = liveObj2;
	liveObj = liveObj1;
	if ((liveObj1->objType == OBJECT_MINIFIGURE) && (liveObj2->objType == OBJECT_BUILDING)) {
		lego::game::LiveObject_GetBlockCoordinates(liveObj2,(int *)&local_28,(int *)&local_24);
		BVar5 = FUN_00446c80(liveObj,local_28,local_24,0,(uint *)&liveObj1,1);
		if (BVar5 != 0) {
			surfMap = lego::game::GetSurfaceMap();
			fVar7 = lego::game::SurfaceMap_GetFloat10(surfMap);
			fVar7 = (float10)4.0 / fVar7;
			local_20[0] = 0.5;
			local_20[3] = 0.5;
			local_10 = 0x3f000000;
			local_4 = 0x3f000000;
			uVar6 = (int)&liveObj1[-1].pool_m_next + 2U & 3;
			uVar2 = liveObj->routingBlocksTotal;
			pvVar3 = liveObj->routeptr_24;
			local_20[1] = (float)((float10)1.0 - fVar7);
			local_20[2] = (float)((float10)1.0 - fVar7);
			local_c = (float)fVar7;
			local_8 = (float)fVar7;
			*(float *)((int)pvVar3 + uVar2 * 0x14 + -0xc) = local_20[uVar6 * 2];
			*(float *)((int)pvVar3 + uVar2 * 0x14 + -8) = local_20[uVar6 * 2 + 1];
			*(undefined *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -3) = 0xb;
			*(byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -4) =
					 *(byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -4) | 4;
			liveObj1._0_1_ = (byte)uVar6;
			pbVar1 = (byte *)((int)liveObj->routeptr_24 + liveObj->routingBlocksTotal * 0x14 + -4);
			*pbVar1 = *pbVar1 | (byte)liveObj1;
			liveObj->object_2fc = pLVar4;
			return 1;
		}
		liveObj->flags2_3e4 = liveObj->flags2_3e4 & ~LIVEOBJ2_UNK_800;
	}
	return 0;
}



BOOL __cdecl FUN_00449ec0(void)
{
	BOOL BVar1;
	
	BVar1 = FUN_00437a90(FUN_00449fb0,NULL,0);
	return BVar1;
}



void __cdecl
lego::game::Flocks_CallbackFUN_00449ee0(FlockData *flockData,FlockSubdata *subdata,void *lpContext)
{
	ResourceData *resData;
	LevelSurfaceMap *surfaceMap;
	LevelData *pLVar1;
	BOOL BVar2;
	FlockSubdata **out_x;
	uint *puVar3;
	uint local_10;
	Vector3F local_c;
	
	resData = subdata->resData_98;
	res::Res_GetPosition(resData,NULL,&local_c);
	puVar3 = &local_10;
	out_x = &subdata;
	surfaceMap = GetSurfaceMap();
	SurfaceMap_ToBlockCoordinatesNoZ(surfaceMap,local_c.x,local_c.y,(int *)out_x,(int *)puVar3);
	pLVar1 = GetLevel();
	if (subdata <= (FlockSubdata *)(pLVar1->dimensions).width) {
		pLVar1 = GetLevel();
		puVar3 = (uint *)&(pLVar1->dimensions).height;
		if (local_10 < *puVar3 || local_10 == *puVar3) {
			BVar2 = FUN_00433d60((int)subdata,local_10);
			if (BVar2 == 0) {
				BVar2 = FUN_00432e70((uint)subdata,local_10);
				if (BVar2 == 0) {
					res::Res_UnkSetup3DFrameTransform(resData,0);
					return;
				}
			}
		}
	}
	res::Res_UnkSetup3DFrameTransform(resData,1);
	return;
}



void __cdecl lego::game::LiveObject_SetResourceFlag80(LiveObject *liveObj,BOOL state)
{
	ResourceData *resData;
	
	resData = LiveObject_GetResource(liveObj);
	if (resData != NULL) {
		res::Res_SetFlag80(resData,state);
	}
	return;
}



BOOL __cdecl FUN_00449fb0(LiveObject *liveObj)
{
	int *piVar1;
	bool bVar2;
	ObjectStatsFlags1 OVar3;
	BOOL BVar4;
	ObjectStatsFlags2 OVar5;
	int iVar6;
	int *piVar7;
	uint uVar8;
	int *piVar9;
	int iVar10;
	uint uVar11;
	uint y;
	uint x;
	uint local_20;
	BOOL local_1c;
	Point2F local_18;
	int local_10;
	int local_c;
	float local_8;
	float local_4;
	
	uVar11 = 0;
	local_1c = 0;
	OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if ((OVar3 & STATS1_FLOCKS) != STATS1_NONE) {
		lego::game::Flocks_CallbackForAllSubdata
							(liveObj->flocksData_32c,lego::game::Flocks_CallbackFUN_00449ee0,NULL);
		return 0;
	}
	BVar4 = lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&x,(int *)&y);
	if (BVar4 == 0) {
		lego::game::LiveObject_FUN_0044a210(liveObj,1);
		return 0;
	}
	BVar4 = lego::game::Level_GetBlockFlags1_8(x,y);
	if (BVar4 != 0) {
		liveObj->flags3_3e8 = liveObj->flags3_3e8 & 0xffefffff;
	}
	BVar4 = FUN_00432e70(x,y);
	if (((BVar4 == 0) && ((liveObj->flags3_3e8 & 0x100000) == LIVEOBJ3_NONE)) &&
		 ((liveObj->objType != OBJECT_MINIFIGURE ||
			((liveObj->drivenObject == NULL ||
			 (OVar5 = lego::game::LiveObject_GetStatsFlags2(liveObj->drivenObject),
			 (OVar5 & STATS2_INVISIBLEDRIVER) == STATS2_NONE)))))) {
		BVar4 = 0;
	}
	else {
		BVar4 = 1;
	}
	lego::game::LiveObject_FUN_0044a210(liveObj,BVar4);
	BVar4 = FUN_00433d60(x,y);
	if (((BVar4 != 0) || (BVar4 = FUN_00432e70(x,y), BVar4 != 0)) ||
		 ((liveObj->flags3_3e8 & 0x100000) != LIVEOBJ3_NONE)) {
		iVar10 = 1;
		local_1c = 1;
		if (liveObj->objType == OBJECT_BUILDING) {
			FUN_00442560(liveObj,&local_18);
			lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_10,&local_c);
			lego::game::LiveObject_GetPosition(liveObj,&local_8,&local_4);
			if (ABS(local_18.x) <= ABS(local_18.y)) {
				if ((ushort)((ushort)(local_18.y < 0.0) << 8 | (ushort)(local_18.y == 0.0) << 0xe) == 0) {
					iVar10 = 0;
				}
				else {
					iVar10 = 2;
				}
			}
			else {
				if ((ushort)((ushort)(local_18.x < 0.0) << 8 | (ushort)(local_18.x == 0.0) << 0xe) != 0) {
					iVar10 = 3;
				}
			}
			iVar6 = FUN_00408290(lego::globals::g_Game.BuildingData_TABLE + liveObj->objIndex,&local_20);
			piVar7 = FUN_004643d0(&local_10,iVar6,local_20,iVar10);
			uVar8 = local_20;
			piVar1 = piVar7;
			if (local_20 != 0) {
				do {
					piVar9 = piVar1 + 2;
					if (((uVar11 == uVar8 - 1) || (*piVar7 != *piVar9)) || (piVar7[1] != piVar1[3])) {
						bVar2 = false;
						BVar4 = FUN_00433d60(*piVar7,piVar7[1]);
						uVar8 = local_20;
						if (BVar4 == 0) {
							local_1c = 0;
							break;
						}
					}
					else {
						bVar2 = true;
					}
					if (bVar2) {
						uVar11 += 1;
						piVar9 = piVar1 + 4;
						piVar7 = piVar7 + 2;
					}
					uVar11 += 1;
					piVar7 = piVar7 + 2;
					piVar1 = piVar9;
				} while (uVar11 < uVar8);
			}
		}
	}
	lego::game::LiveObject_SetResourceFlag80(liveObj,local_1c);
	return 0;
}



void __cdecl lego::game::LiveObject_FUN_0044a210(LiveObject *liveObj,BOOL use3rdFrame)
{
	ObjectType OVar1;
	
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_VEHICLE) {
		FUN_0046d580(liveObj->vehicle,use3rdFrame);
		return;
	}
	if (OVar1 == OBJECT_MINIFIGURE) {
		FUN_00406bc0((BasicObjectData *)liveObj->miniFigure,use3rdFrame);
		return;
	}
	if (OVar1 == OBJECT_ROCKMONSTER) {
		FUN_00406bc0((BasicObjectData *)liveObj->rockMonster,use3rdFrame);
		return;
	}
	if (OVar1 == OBJECT_BUILDING) {
		FUN_004085a0(liveObj->building,use3rdFrame);
		return;
	}
	if (OVar1 == OBJECT_UPGRADEPART) {
		FUN_00406bc0((BasicObjectData *)liveObj->upgrade,use3rdFrame);
		return;
	}
	if ((liveObj->flags3_3e8 & LIVEOBJ3_SIMPLEOBJECT) != LIVEOBJ3_NONE) {
		res::Res_UnkSetup3DFrameTransform(liveObj->other,use3rdFrame);
	}
	return;
}



BOOL __cdecl FUN_0044a2b0(LiveObject *liveObj)
{
	ObjectType OVar1;
	
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_VEHICLE) {
		OVar1 = lego::res::Vehicle_GetFlag2(liveObj->vehicle);
		return OVar1;
	}
	if (OVar1 == OBJECT_MINIFIGURE) {
		OVar1 = lego::res::Object_GetFlag8((BasicObjectData *)liveObj->miniFigure);
		return OVar1;
	}
	if (OVar1 == OBJECT_ROCKMONSTER) {
		OVar1 = lego::res::Object_GetFlag8((BasicObjectData *)liveObj->rockMonster);
		return OVar1;
	}
	if (OVar1 == OBJECT_BUILDING) {
		OVar1 = lego::res::Object_GetFlag8((BasicObjectData *)liveObj->building);
		return OVar1;
	}
	if (OVar1 == OBJECT_UPGRADEPART) {
		OVar1 = lego::res::Object_GetFlag8((BasicObjectData *)liveObj->upgrade);
		return OVar1;
	}
	if ((liveObj->flags3_3e8 & LIVEOBJ3_SIMPLEOBJECT) != LIVEOBJ3_NONE) {
		OVar1 = lego::res::Res_GetFlag8(liveObj->other);
	}
	return OVar1;
}



void __cdecl FUN_0044a330(LiveObject *liveObj,int param_2,Vector3F *param_3,Vector3F *param_4)
{
	ObjectType OVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	ResourceData *pRVar5;
	LiveObject *pLVar6;
	Vector3F local_c;
	
	if ((liveObj->resData_2dc != NULL) && (liveObj->index_2e0 == param_2)) goto LAB_0044a3a2;
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_VEHICLE) {
		pRVar5 = lego::res::Vehicle_GetCameraNull(liveObj->vehicle,param_2);
LAB_0044a371:
		liveObj->resData_2dc = pRVar5;
	}
	else {
		if (OVar1 == OBJECT_MINIFIGURE) {
			pRVar5 = lego::res::Creature_GetCameraNull(liveObj->miniFigure,param_2);
			goto LAB_0044a371;
		}
		if (OVar1 != OBJECT_ROCKMONSTER) goto LAB_0044a3a2;
		pRVar5 = lego::res::Creature_GetCameraNull(liveObj->rockMonster,param_2);
		liveObj->resData_2dc = pRVar5;
	}
	if (pRVar5 != NULL) {
		liveObj->index_2e0 = param_2;
	}
LAB_0044a3a2:
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_VEHICLE) {
		pLVar6 = (LiveObject *)lego::res::Vehicle_IsCameraFlipDir(liveObj->vehicle);
	}
	else {
		if (OVar1 == OBJECT_MINIFIGURE) {
			pLVar6 = (LiveObject *)lego::res::Creature_IsCameraFlipDir(liveObj->miniFigure);
		}
		else {
			pLVar6 = liveObj;
			if (OVar1 == OBJECT_ROCKMONSTER) {
				pLVar6 = (LiveObject *)lego::res::Creature_IsCameraFlipDir(liveObj->rockMonster);
			}
		}
	}
	if (liveObj->resData_2dc != NULL) {
		lego::res::Res_GetPosition(liveObj->resData_2dc,NULL,param_3);
		lego::res::Res_GetOrientation(liveObj->resData_2dc,NULL,param_4,&local_c);
		fVar2 = 1.0 / SQRT(param_4->x * param_4->x + param_4->z * param_4->z + param_4->y * param_4->y);
		fVar4 = fVar2 * param_4->x;
		fVar3 = fVar2 * param_4->y;
		fVar2 = fVar2 * param_4->z;
		param_4->x = fVar4;
		param_4->y = fVar3;
		param_4->z = fVar2;
		if (pLVar6 != NULL) {
			param_4->x = fVar4 * -1.0;
			param_4->y = fVar3 * -1.0;
			param_4->z = fVar2 * -1.0;
			return;
		}
	}
	return;
}



ResourceData * __cdecl lego::game::LiveObject_GetResource(LiveObject *liveObj)
{
	LiveObject *pLVar1;
	
	if (true) {
		switch(liveObj->objType) {
		case OBJECT_VEHICLE:
			pLVar1 = (LiveObject *)res::Vehicle_GetAEResource(liveObj->vehicle);
			return (ResourceData *)pLVar1;
		case OBJECT_MINIFIGURE:
			pLVar1 = (LiveObject *)LiveObject_GetAEResource((BasicObjectData *)liveObj->miniFigure);
			return (ResourceData *)pLVar1;
		case OBJECT_ROCKMONSTER:
			pLVar1 = (LiveObject *)LiveObject_GetAEResource((BasicObjectData *)liveObj->rockMonster);
			return (ResourceData *)pLVar1;
		case OBJECT_BUILDING:
			pLVar1 = (LiveObject *)LiveObject_GetAEResource((BasicObjectData *)liveObj->building);
			return (ResourceData *)pLVar1;
		case OBJECT_UPGRADEPART:
			pLVar1 = (LiveObject *)LiveObject_GetAEResource((BasicObjectData *)liveObj->upgrade);
			return (ResourceData *)pLVar1;
		}
	}
	if ((liveObj->flags3_3e8 & LIVEOBJ3_SIMPLEOBJECT) == LIVEOBJ3_NONE) {
		return (ResourceData *)liveObj;
	}
	return (ResourceData *)(LiveObject *)liveObj->other;
}



BOOL __cdecl
lego::game::LiveObject_GetDrillNullPosition(LiveObject *liveObj,float *out_x,float *out_y)
{
	ObjectType OVar1;
	ResourceData *resData;
	CreatureData *creature;
	Vector3F vector;
	
	OVar1 = liveObj->objType;
	if (OVar1 == OBJECT_VEHICLE) {
		resData = res::Vehicle_GetDrillNull(liveObj->vehicle);
	}
	else {
		if (OVar1 == OBJECT_MINIFIGURE) {
			creature = liveObj->miniFigure;
		}
		else {
			if (OVar1 != OBJECT_ROCKMONSTER) {
				return 0;
			}
			creature = liveObj->rockMonster;
		}
		resData = res::Creature_GetDrillNull(creature);
	}
	if (resData == NULL) {
		return 0;
	}
	res::Res_GetPosition(resData,NULL,&vector);
	*out_x = vector.x;
	*out_y = vector.y;
	return 1;
}



void __cdecl FUN_0044a5d0(int *param_1,int param_2,int param_3,float param_4)
{
	ObjectStatsFlags3 OVar1;
	
	if ((*param_1 == 2) && ((LiveObject *)param_1[0xdb] != NULL)) {
		param_1 = (int *)(LiveObject *)param_1[0xdb];
	}
	if ((*(byte *)((int)param_1 + 0x3e0) & 1) != 0) {
		lego::game::LiveObject_UnkDoRouting_FUN_00441c00((LiveObject *)param_1,0);
	}
	OVar1 = lego::game::LiveObject_GetStatsFlags3((LiveObject *)param_1);
	if ((OVar1 & STATS3_CANSTRAFE) == STATS3_NONE) {
		param_3 = 0;
	}
	*(int *)((int)param_1 + 700) = *(int *)((int)param_1 + 700) + param_3;
	*(int *)((int)param_1 + 0x2c0) = *(int *)((int)param_1 + 0x2c0) + param_2;
	*(float *)((int)param_1 + 0x2c4) = param_4 + *(float *)((int)param_1 + 0x2c4);
	return;
}



void __cdecl lego::game::Level_RegisterRechargeSeam(Point2I *position)
{
	if (globals::g_RechargeSeams_COUNT < 10) {
		globals::g_RechargeSeams_TABLE[globals::g_RechargeSeams_COUNT].x = position->x;
		globals::g_RechargeSeams_TABLE[globals::g_RechargeSeams_COUNT].y = position->y;
		globals::g_RechargeSeams_COUNT += 1;
	}
	return;
}



undefined4 __cdecl FUN_0044a690(undefined4 *param_1,undefined4 *param_2)
{
	float fVar1;
	LevelSurfaceMap *surfMap;
	uint uVar2;
	uint uVar3;
	Point2I *pPVar4;
	uint x;
	uint y;
	float *out_x;
	float *out_y;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	uVar2 = 0xffffffff;
	local_14 = 10000.0;
	lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_10,&local_c);
	uVar3 = 0;
	if (lego::globals::g_RechargeSeams_COUNT != 0) {
		pPVar4 = lego::globals::g_RechargeSeams_TABLE;
		do {
			y = pPVar4->y;
			x = pPVar4->x;
			out_y = &local_4;
			out_x = &local_8;
			surfMap = lego::game::GetSurfaceMap();
			FUN_0044f900(surfMap,x,y,out_x,out_y);
			fVar1 = SQRT((local_c - local_4) * (local_c - local_4) +
									 (local_10 - local_8) * (local_10 - local_8));
			if (fVar1 < local_14) {
				uVar2 = uVar3;
				local_14 = fVar1;
			}
			uVar3 += 1;
			pPVar4 = pPVar4 + 1;
		} while (uVar3 < lego::globals::g_RechargeSeams_COUNT);
	}
	if (uVar2 == 0xffffffff) {
		return 0;
	}
	if (param_2 != NULL) {
		*param_2 = lego::globals::g_RechargeSeams_TABLE[uVar2].x;
		param_2[1] = lego::globals::g_RechargeSeams_TABLE[uVar2].y;
	}
	return 1;
}



void __cdecl lego::game::Level_RegisterSlimySlugHole(Point2I *position)
{
	if (globals::g_SlimySlugHoles_COUNT < 20) {
		globals::g_SlimySlugHoles_TABLE[globals::g_SlimySlugHoles_COUNT].x = position->x;
		globals::g_SlimySlugHoles_TABLE[globals::g_SlimySlugHoles_COUNT].y = position->y;
		globals::g_SlimySlugHoles_COUNT += 1;
	}
	return;
}



undefined4 __cdecl FUN_0044a7b0(undefined4 *param_1,undefined4 *param_2)
{
	float fVar1;
	LevelSurfaceMap *surfMap;
	uint uVar2;
	uint uVar3;
	Point2I *pPVar4;
	uint x;
	uint y;
	float *out_x;
	float *out_y;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	uVar2 = 0xffffffff;
	local_14 = 10000.0;
	lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_10,&local_c);
	uVar3 = 0;
	if (lego::globals::g_SlimySlugHoles_COUNT != 0) {
		pPVar4 = lego::globals::g_SlimySlugHoles_TABLE;
		do {
			y = pPVar4->y;
			x = pPVar4->x;
			out_y = &local_4;
			out_x = &local_8;
			surfMap = lego::game::GetSurfaceMap();
			FUN_0044f900(surfMap,x,y,out_x,out_y);
			fVar1 = SQRT((local_c - local_4) * (local_c - local_4) +
									 (local_10 - local_8) * (local_10 - local_8));
			if (fVar1 < local_14) {
				uVar2 = uVar3;
				local_14 = fVar1;
			}
			uVar3 += 1;
			pPVar4 = pPVar4 + 1;
		} while (uVar3 < lego::globals::g_SlimySlugHoles_COUNT);
	}
	if (uVar2 == 0xffffffff) {
		return 0;
	}
	if (param_2 != NULL) {
		*param_2 = lego::globals::g_SlimySlugHoles_TABLE[uVar2].x;
		param_2[1] = lego::globals::g_SlimySlugHoles_TABLE[uVar2].y;
	}
	return 1;
}



BOOL __cdecl
FUN_0044a890(LiveObject *liveObj,int *param_2,int *param_3,BOOL param_4,BOOL param_5,BOOL param_6)
{
	float fVar1;
	BOOL BVar2;
	int iVar3;
	int iVar4;
	float *pfVar5;
	float *pfVar6;
	uint number;
	uint x;
	uint y;
	longlong lVar7;
	int local_4cc;
	int local_4c8;
	LevelSurfaceMap *local_4c4;
	float local_4c0;
	float local_4bc;
	float local_4b8;
	float local_4b4;
	float local_4b0;
	float local_4ac [299];
	
	local_4c4 = lego::game::GetSurfaceMap();
	number = 0;
	lego::game::LiveObject_GetPosition(liveObj,&local_4b8,&local_4b4);
	lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_4cc,&local_4c8);
	y = local_4c8 - 10;
	iVar3 = local_4cc;
	iVar4 = local_4c8;
	if ((int)y < local_4c8 + 10) {
		do {
			x = iVar3 - 10;
			if ((int)x < iVar3 + 10) {
				pfVar5 = local_4ac + number * 3;
				do {
					BVar2 = lego::game::Level_GetBlockFlags1_10Not8(x,y);
					pfVar6 = pfVar5;
					if (((BVar2 != 0) &&
							((param_6 != 0 || (BVar2 = lego::game::Level_GetBlockFlags1_20(x,y), BVar2 == 0)))) &&
						 ((param_5 != 0 || (BVar2 = lego::game::Level_GetBlockFlags1_c0(x,y), BVar2 == 0)))) {
						FUN_0044f900(local_4c4,x,y,&local_4c0,&local_4bc);
						fVar1 = SQRT((local_4bc - local_4b4) * (local_4bc - local_4b4) +
												 (local_4c0 - local_4b8) * (local_4c0 - local_4b8));
						if (((param_4 == 0) || (local_4c4->BlockSize <= fVar1)) && (number < 100)) {
							number += 1;
							pfVar6 = pfVar5 + 3;
							pfVar5[-1] = (float)x;
							*pfVar5 = (float)y;
							pfVar5[1] = fVar1;
						}
					}
					x += 1;
					iVar3 = local_4cc;
					iVar4 = local_4c8;
					pfVar5 = pfVar6;
				} while ((int)x < local_4cc + 10);
			}
			y += 1;
		} while ((int)y < iVar4 + 10);
	}
	if (number == 0) {
		return 0;
	}
	std::qsort(&local_4b0,number,0xc,FUN_0044aa60);
	lVar7 = __ftol((float10)local_4b0);
	*param_2 = (int)lVar7;
	lVar7 = __ftol((float10)local_4ac[0]);
	*param_3 = (int)lVar7;
	return 1;
}



BOOL __cdecl FUN_0044aa60(int param_1,int param_2)
{
	if ((ushort)((ushort)(*(float *)(param_1 + 8) < *(float *)(param_2 + 8)) << 8 |
							(ushort)(*(float *)(param_1 + 8) == *(float *)(param_2 + 8)) << 0xe) == 0) {
		return 1;
	}
	if (*(float *)(param_1 + 8) < *(float *)(param_2 + 8)) {
		return -1;
	}
	return 0;
}



PolyMeshData * __cdecl
lego::res::Res_LoadPolyMesh
					(CFGProperty *aeRoot,char *rootName,char *dirname,PolyMode polyMode,uint numCameraFrames)
{
	char *pcVar1;
	CFGProperty *prop;
	int iVar2;
	PolyMeshData *lastPolyData;
	uint index;
	PolyMeshData *local_104;
	char local_100 [256];
	
	index = 0;
	lastPolyData = NULL;
	local_104 = NULL;
	if (polyMode != POLY_FP) {
		numCameraFrames = 1;
	}
	if (numCameraFrames != 0) {
		do {
			if (polyMode == POLY_FP) {
				std::sprintf(local_100,"FPPoly::Camera%i",index + 1);
			}
			else {
				if (polyMode == POLY_HIGH) {
					pcVar1 = "HighPoly";
				}
				else {
					if (polyMode != POLY_MEDIUM) goto LAB_0044ab0b;
					pcVar1 = "MediumPoly";
				}
				std::sprintf(local_100,pcVar1);
			}
LAB_0044ab0b:
			pcVar1 = cfg::CFG_JoinPath(rootName,local_100,0);
			for (prop = cfg::CFG_GetBlockFirstChild(aeRoot,pcVar1); prop != NULL;
					prop = cfg::CFG_NextFlatProperty(prop)) {
				pcVar1 = prop->key;
				if (*pcVar1 == '!') {
					if ((globals::g_CMDLINE_FLAGS & CMD_REDUCEPROMESHES) == CMD_NONE) {
						if (true) {
							pcVar1 = pcVar1 + 1;
						}
						goto LAB_0044ab53;
					}
				}
				else {
LAB_0044ab53:
					iVar2 = std::_stricmp("NULL",prop->value);
					if (iVar2 == 0) {
						lastPolyData = Res_CreateNullPolyMesh(lastPolyData,pcVar1,index);
					}
					else {
						lastPolyData = Res_CreatePolyMesh(lastPolyData,pcVar1,dirname,prop->value,index);
					}
					if (local_104 == NULL) {
						local_104 = lastPolyData;
					}
				}
			}
			index += 1;
		} while (index < numCameraFrames);
	}
	return local_104;
}



BOOL __cdecl
FUN_0044abd0(ObjectType objType,int objIndex,BOOL param_3,BOOL param_4,Point2F *param_5,uint x,
						uint y,BOOL param_8,int **param_9)
{
	float fVar1;
	float fVar2;
	BOOL BVar3;
	int iVar4;
	int iVar5;
	LevelSurfaceMap *surfMap;
	Point2I *pPVar6;
	undefined4 uVar7;
	LiveObject *pLVar8;
	ObjectStatsFlags1 OVar9;
	uint uVar10;
	uint y_00;
	Point2F *out_x;
	float *out_y;
	Point2I local_10;
	Point2F local_8;
	
	y_00 = y;
	uVar10 = x;
	local_10.x = x;
	local_10.y = y;
	if (objType == OBJECT_BUILDING) {
		if (param_8 != 0) {
			BVar3 = lego::game::Level_GetBlockFlags1_8(x,y);
			if (BVar3 == 0) {
				if ((param_4 == 0) && (FUN_0045cee0(0x17), param_3 != 0)) {
					FUN_00428730(1);
				}
				FUN_004649e0((ResourceData **)param_9,1);
			}
			else {
				iVar4 = FUN_00408290(lego::globals::g_Game.BuildingData_TABLE + objIndex,&x);
				iVar5 = lego::game::Object_GetWaterEntrances(OBJECT_BUILDING,objIndex,0);
				FUN_004649e0((ResourceData **)param_9,0);
				out_y = &local_8.y;
				out_x = &local_8;
				surfMap = lego::game::GetSurfaceMap();
				FUN_0044f900(surfMap,uVar10,y_00,(float *)out_x,out_y);
				fVar1 = param_5->x - local_8.x;
				fVar2 = param_5->y - local_8.y;
				if (((ushort)((ushort)(fVar1 < 0.0) << 8 | (ushort)(fVar1 == 0.0) << 0xe) != 0) ||
					 (fVar1 <= ABS(fVar2))) {
					if ((0.0 <= fVar1) ||
						 (y = (uint)ABS(fVar1),
						 (ushort)((ushort)((float)y < ABS(fVar2)) << 8 | (ushort)((float)y == ABS(fVar2)) << 0xe
										 ) != 0)) {
						if (((ushort)((ushort)(fVar2 < 0.0) << 8 | (ushort)(fVar2 == 0.0) << 0xe) != 0) ||
							 (fVar2 <= ABS(fVar1))) {
							if ((fVar2 < 0.0) &&
								 (y = (uint)ABS(fVar2),
								 (ushort)((ushort)((float)y < ABS(fVar1)) << 8 |
												 (ushort)((float)y == ABS(fVar1)) << 0xe) == 0)) {
								lego::globals::g_Game.placeObjDirection = DIRECTION_DOWN;
							}
						}
						else {
							lego::globals::g_Game.placeObjDirection = DIRECTION_UP;
						}
					}
					else {
						lego::globals::g_Game.placeObjDirection = DIRECTION_LEFT;
					}
				}
				else {
					lego::globals::g_Game.placeObjDirection = DIRECTION_RIGHT;
				}
				uVar10 = 0;
				do {
					pPVar6 = (Point2I *)
									 FUN_00464480(param_9,(int *)&local_10,iVar4,x,
																uVar10 + lego::globals::g_Game.placeObjDirection & 3,
																(uint *)(lego::globals::g_Game.level)->surfaceMap,iVar5);
					if (pPVar6 != NULL) {
						if ((param_4 == 0) && (FUN_0045cee0(0x16), param_3 != 0)) {
							uVar7 = FUN_004096c0(objIndex,&local_10,
																	 uVar10 + lego::globals::g_Game.placeObjDirection & 3,pPVar6,x);
							pLVar8 = FUN_00438da0(NULL,&local_10,OBJECT_ORE,0);
							iVar4 = lego::game::Object_GetCostRefinedOre(OBJECT_BUILDING,objIndex,0);
							OVar9 = lego::game::Object_GetStatsFlags1(OBJECT_BUILDING,objIndex);
							if ((OVar9 & STATS1_STOREOBJECTS) == STATS1_NONE) {
								FUN_00408df0((int *)&local_10,(uint *)pPVar6,x);
							}
							iVar5 = lego::game::Object_GetCostCrystal(OBJECT_BUILDING,objIndex,0);
							lego::game::Level_SpawnCarryableObject(&local_10,OBJECT_POWERCRYSTAL,0,0,iVar5);
							if ((pLVar8 == NULL) || (iVar4 == 0)) {
								iVar4 = lego::game::Object_GetCostOre(OBJECT_BUILDING,objIndex,0);
								iVar5 = 0;
							}
							else {
								iVar5 = 1;
							}
							lego::game::Level_SpawnCarryableObject(&local_10,OBJECT_ORE,iVar5,0,iVar4);
							FUN_00408c10(uVar7,NULL);
							FUN_004649e0((ResourceData **)param_9,1);
							FUN_0041e680();
							FUN_00428730(0);
							return 0;
						}
						lego::globals::g_Game.placeObjDirection =
								 uVar10 + lego::globals::g_Game.placeObjDirection & 3;
						break;
					}
					uVar10 += 1;
				} while (uVar10 < 5);
				if (uVar10 != 5) {
					return 1;
				}
				if ((param_4 == 0) && (FUN_0045cee0(0x17), param_3 != 0)) {
					FUN_00428730(1);
					lego::front::Text_DisplayType(TEXT_CANNOTPLACEBUILDING,0,0);
					return 1;
				}
			}
			lego::front::Text_DisplayType(TEXT_CANNOTPLACEBUILDING,0,0);
			return 1;
		}
		FUN_004649e0((ResourceData **)param_9,1);
	}
	return 1;
}



void __cdecl lego::main::Main_LoadObjTtSFXs(CFGProperty *root,char *keyBasePath)
{
	char *keyPath;
	CFGProperty *prop;
	BOOL BVar1;
	int iVar2;
	int (*paiVar3) [15];
	ObjectType local_8;
	int local_4;
	
	paiVar3 = globals::g_ObjTtSFX_TABLE;
	for (iVar2 = 300; iVar2 != 0; iVar2 += -1) {
		(*paiVar3)[0] = 0;
		paiVar3 = (int (*) [15])(*paiVar3 + 1);
	}
	iVar2 = 0x14;
	local_8 = 0x14;
	do {
		iVar2 += -1;
		local_4 = 0xf;
	} while (iVar2 != 0);
	keyPath = cfg::CFG_JoinPath(keyBasePath,"ObjTtSFXs",0);
	for (prop = cfg::CFG_GetBlockFirstChild(root,keyPath); prop != NULL;
			prop = cfg::CFG_NextFlatProperty(prop)) {
		BVar1 = game::Game_GetObjectByName(prop->key,&local_8,&local_4,NULL);
		if ((BVar1 != 0) && (BVar1 = snd::Snd_GetSFX(prop->value,(int *)&keyBasePath), BVar1 != 0)) {
			globals::g_ObjTtSFX_TABLE[local_8][local_4] = (int)keyBasePath;
		}
	}
	return;
}



int __cdecl lego::game::LiveObject_GetObjTtSFX(LiveObject *liveObj)
{
	int local_4;
	
	LiveObject_GetTypeIndex(liveObj,(int *)&liveObj,&local_4);
	return globals::g_ObjTtSFX_TABLE[(int)liveObj][local_4];
}



void __cdecl FUN_0044b080(BOOL state)
{
	if (state != 0) {
		lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS =
				 lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS | 0x20;
		return;
	}
	lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS =
			 lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS & 0xffffffdf;
	return;
}



void __cdecl FUN_0044b0a0(LiveObject *liveObj)
{
	LiveObject *pLVar1;
	int iVar2;
	uint uVar3;
	LiveObject *in_liveObj;
	
	pLVar1 = NULL;
	if (((((byte)lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS & 0x20) == 0) &&
			(liveObj->objType == OBJECT_VEHICLE)) && ((liveObj->flags4_3ec & 0x800) == 0)) {
		if ((liveObj->flags4_3ec & 0x40) != 0) {
			pLVar1 = liveObj->object_2fc;
		}
		in_liveObj = pLVar1;
		if (pLVar1 == NULL) {
			in_liveObj = liveObj;
		}
		uVar3 = (uint)(pLVar1 != NULL);
		iVar2 = lego::game::Object_GetCostCrystal(OBJECT_VEHICLE,liveObj->objIndex,0);
		FUN_0044b110(in_liveObj,iVar2,uVar3);
		liveObj->flags4_3ec = liveObj->flags4_3ec | 0x800;
	}
	return;
}



void __cdecl FUN_0044b110(LiveObject *in_liveObj,int param_2,int param_3)
{
	ResourceData *resData;
	LevelSurfaceMap *surfaceMap;
	BOOL BVar1;
	LiveObject *liveObj;
	float10 fVar2;
	float in_x;
	float in_y;
	uint *out_x;
	uint *out_y;
	float local_24;
	float local_20;
	float local_1c;
	float local_18;
	uint local_14;
	uint local_10;
	Vector3F local_c;
	
	if (param_2 != 0) {
		do {
			if (((param_3 == 0) || (in_liveObj->objType != OBJECT_BUILDING)) ||
				 (resData = lego::res::Building_GetEntranceNull(in_liveObj->building), resData == NULL)) {
				lego::game::LiveObject_GetPosition(in_liveObj,&local_24,&local_20);
			}
			else {
				lego::res::Res_GetPosition(resData,NULL,&local_c);
				local_24 = local_c.x;
				local_20 = local_c.y;
			}
			fVar2 = lego::game::Game_ChooseRandomRange(-5.0,5.0);
			local_1c = (float)fVar2;
			fVar2 = lego::game::Game_ChooseRandomRange(-5.0,5.0);
			local_18 = (float)fVar2;
			in_y = local_18 + local_20;
			out_y = &local_10;
			out_x = &local_14;
			in_x = local_1c + local_24;
			surfaceMap = lego::game::GetSurfaceMap();
			BVar1 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
												(surfaceMap,in_x,in_y,(int *)out_x,(int *)out_y);
			if ((BVar1 != 0) &&
				 (BVar1 = lego::game::Level_GetBlockFlags1_8(local_14,local_10), BVar1 != 0)) {
				local_24 = local_1c + local_24;
				local_20 = local_18 + local_20;
			}
			liveObj = lego::game::Game_CreateLiveResourceObject
													(lego::globals::g_Game.RES_Crystal,OBJECT_POWERCRYSTAL,0,0,local_24,
													 local_20,0.0);
			FUN_00402650(liveObj,0.0);
			param_2 += -1;
		} while (param_2 != 0);
	}
	return;
}



void __cdecl FUN_0044b250(int *param_1)
{
	if ((int *)param_1[0xd2] != NULL) {
		FUN_0044b110((LiveObject *)param_1,*(int *)param_1[0xd2],0);
	}
	return;
}



void __cdecl FUN_0044b270(LiveObject *in_liveObj)
{
	short sVar1;
	BOOL BVar2;
	LiveObject *in_liveObj_00;
	int iVar3;
	bool bVar4;
	char *objName;
	uint uVar5;
	int out_objIndex;
	ObjectType out_objType;
	ResourceData *local_c;
	float local_8;
	float local_4;
	
	bVar4 = false;
	BVar2 = lego::game::Game_GetObjectByName("RockMonster",&out_objType,&out_objIndex,NULL);
	objName = (char *)in_liveObj;
	if (((BVar2 != 0) && (out_objType == in_liveObj->objType)) &&
		 (out_objIndex == in_liveObj->objIndex)) {
		objName = "TinyRM";
		bVar4 = true;
	}
	if (!bVar4) {
		BVar2 = lego::game::Game_GetObjectByName("Lavamonster",&out_objType,&out_objIndex,NULL);
		if (((BVar2 != 0) && (out_objType == in_liveObj->objType)) &&
			 (out_objIndex == in_liveObj->objIndex)) {
			objName = "TinyRM";
			bVar4 = true;
		}
		if (((!bVar4) &&
				(BVar2 = lego::game::Game_GetObjectByName("Icemonster",&out_objType,&out_objIndex,NULL),
				BVar2 != 0)) &&
			 ((out_objType == in_liveObj->objType && (out_objIndex == in_liveObj->objIndex)))) {
			objName = "TinyIM";
		}
	}
	BVar2 = lego::game::Game_GetObjectByName(objName,&out_objType,&out_objIndex,&local_c);
	if (BVar2 != 0) {
		lego::game::LiveObject_GetPosition(in_liveObj,&local_8,&local_4);
		uVar5 = 0;
		while( true ) {
			sVar1 = lego::util::randomInt16();
			in_liveObj_00 =
					 lego::game::Game_CreateLiveResourceObject
										 (local_c,out_objType,out_objIndex,0,local_8,local_4,(float)((int)sVar1 % 7));
			in_liveObj_00->health = -1.0;
			iVar3 = FUN_004499c0(in_liveObj_00);
			if (iVar3 == 0) break;
			uVar5 += 1;
			in_liveObj->flags2_3e4 = in_liveObj->flags2_3e4 | 0x20;
			if (2 < uVar5) {
				return;
			}
		}
		lego::pool::ReservedPool_LiveObject___Release(in_liveObj_00);
	}
	return;
}



void __cdecl FUN_0044b400(uint x,uint y,uint param_3)
{
	short sVar1;
	BOOL BVar2;
	LevelSurfaceMap *surfMap;
	LiveObject *pLVar3;
	int iVar4;
	float10 fVar5;
	float *pfVar6;
	int local_44;
	ObjectType local_40;
	ResourceData *local_3c;
	float local_38;
	float local_34;
	float local_30;
	float local_2c;
	float local_18;
	float local_14;
	
	BVar2 = lego::game::Game_GetObjectByName("SmallSpider",&local_40,&local_44,&local_3c);
	if (BVar2 != 0) {
		pfVar6 = &local_30;
		surfMap = lego::game::GetSurfaceMap();
		FUN_00450390(surfMap,x,y,pfVar6);
		for (iVar4 = (param_3 & 3) + 2; iVar4 != 0; iVar4 += -1) {
			sVar1 = lego::util::randomInt16();
			fVar5 = lego::game::Game_ChooseRandomRange(local_30 - -1.0,local_18 - 1.0);
			local_38 = (float)fVar5;
			fVar5 = lego::game::Game_ChooseRandomRange(local_2c - 1.0,local_14 - -1.0);
			local_34 = (float)fVar5;
			pLVar3 = lego::game::Game_CreateLiveResourceObject
												 (local_3c,local_40,local_44,0,local_38,local_34,(float)((int)sVar1 % 7));
			pLVar3->flags1_3e0 = pLVar3->flags1_3e0 | 0x10000;
		}
	}
	return;
}



void __cdecl FUN_0044b510(LiveObject *liveObj1,LiveObject *liveObj2)
{
	BOOL BVar1;
	float10 fVar2;
	
	BVar1 = FUN_00438870(liveObj2,1);
	if ((((BVar1 != 0) && ((liveObj2->flags2_3e4 & 0x100) == LIVEOBJ2_NONE)) &&
			((*(byte *)&liveObj1->flags2_3e4 & 1) == 0)) && ((liveObj2->flags2_3e4 & 2) == LIVEOBJ2_NONE))
	{
		BVar1 = FUN_0043bdb0(liveObj1);
		if (BVar1 == 0) {
			fVar2 = lego::game::LiveObject_GetPainThreshold(liveObj1);
			if (fVar2 < (float10)liveObj1->health) {
				FUN_0041cf40(liveObj2);
				FUN_00441df0(liveObj2,0,1);
				FUN_00441df0(liveObj1,0,1);
				lego::game::LiveObject_SetActivityUnk(liveObj1,ACTIVITY_THROWMAN,1);
				lego::game::Game_UpdateSomeAITasks(liveObj1);
				lego::game::LiveObject_SetActivityUnk(liveObj2,ACTIVITY_THROWNBYROCKMONSTER,1);
				lego::game::Game_UpdateSomeAITasks(liveObj2);
				FUN_00403e60(liveObj1);
				FUN_00403e60(liveObj2);
				liveObj1->flags2_3e4 = liveObj1->flags2_3e4 | 1;
				liveObj2->flags2_3e4 = liveObj2->flags2_3e4 | 2;
				liveObj1->object_3c0 = liveObj2;
				liveObj2->object_3c0 = liveObj1;
			}
		}
	}
	return;
}



BOOL __cdecl lego::game::Tool_IsBeamWeapon(ToolType toolIndex)
{
	if (((toolIndex != TOOL_LASERBEAM) && (toolIndex != TOOL_PUSHERBEAM)) &&
		 (toolIndex != TOOL_FREEZERBEAM)) {
		return 0;
	}
	return 1;
}



void __cdecl lego::game::MiniFigure_EquipTool(LiveObject *liveObj,ToolType toolType)
{
	uint uVar1;
	uint uVar2;
	BOOL BVar3;
	ToolType *pTVar4;
	uint uVar5;
	
	uVar1 = LiveObject_GetNumOfToolsCanCarry(liveObj);
	uVar5 = 0;
	liveObj->field_3f4 = 0;
	if (uVar1 != 0) {
		liveObj->flags4_3ec = liveObj->flags4_3ec & 0xfffffffb;
		uVar2 = LiveObject_GetEquippedBeam(liveObj);
		if ((uVar2 != 0) || (BVar3 = Tool_IsBeamWeapon(toolType), BVar3 != 0)) {
			liveObj->flags4_3ec = liveObj->flags4_3ec | 4;
		}
		BVar3 = Tool_IsBeamWeapon(toolType);
		if ((BVar3 != 0) && (liveObj->numCarriedTools != 0)) {
			pTVar4 = liveObj->carriedTools;
			do {
				BVar3 = Tool_IsBeamWeapon(*pTVar4);
				if (BVar3 != 0) {
					liveObj->carriedTools[uVar5] = toolType;
					return;
				}
				uVar5 += 1;
				pTVar4 = pTVar4 + 1;
			} while (uVar5 < liveObj->numCarriedTools);
		}
		if (uVar1 != 0) {
			uVar5 = liveObj->numCarriedTools;
			if (uVar5 == uVar1) {
				uVar1 = 0;
				if (uVar5 != 1) {
					pTVar4 = liveObj->carriedTools;
					do {
						uVar1 += 1;
						*pTVar4 = pTVar4[1];
						pTVar4 = pTVar4 + 1;
					} while (uVar1 < liveObj->numCarriedTools - 1);
				}
				liveObj->carriedTools[liveObj->numCarriedTools - 1] = toolType;
				return;
			}
			liveObj->carriedTools[uVar5] = toolType;
			liveObj->numCarriedTools = liveObj->numCarriedTools + 1;
		}
	}
	return;
}



BOOL __cdecl lego::game::LiveObject_HasToolEquipped(LiveObject *liveObj,ToolType toolType)
{
	uint uVar1;
	ToolType *pTVar2;
	
	uVar1 = 0;
	if (liveObj->numCarriedTools == 0) {
		return 0;
	}
	pTVar2 = liveObj->carriedTools;
	do {
		if (*pTVar2 == toolType) {
			return 1;
		}
		uVar1 += 1;
		pTVar2 = pTVar2 + 1;
	} while (uVar1 < liveObj->numCarriedTools);
	return 0;
}



BOOL __cdecl FUN_0044b780(int *param_1,int param_2)
{
	int *liveObj;
	int iVar1;
	BOOL BVar2;
	
	liveObj = param_1;
	if (*param_1 == 2) {
		iVar1 = FUN_0046a3e0(param_2,(int *)&param_1);
		if (iVar1 != 0) {
			BVar2 = lego::game::LiveObject_HasToolEquipped((LiveObject *)liveObj,(ToolType)param_1);
			return BVar2;
		}
	}
	return 1;
}



int __cdecl FUN_0044b7c0(int *param_1,float *param_2)
{
	int *liveObj;
	int iVar1;
	ResourceData *resData;
	LevelSurfaceMap *pLVar2;
	BOOL BVar3;
	int iVar4;
	float *pfVar5;
	float *pfVar6;
	uint local_34;
	BOOL local_30;
	float local_2c;
	float local_28;
	Point2F local_24;
	float local_1c;
	float local_18;
	float local_14;
	float local_10;
	Vector3F local_c;
	
	liveObj = param_1;
	local_30 = 0;
	iVar4 = 0;
	if (*param_1 == 2) {
		lego::game::LiveObject_GetPosition((LiveObject *)param_1,(float *)&local_24,&local_24.y);
		iVar1 = FUN_004390b0(&local_24);
		if (iVar1 != 0) {
			resData = lego::res::Building_GetToolNull
													(*(BuildingData **)(iVar1 + 0x18),(&DAT_004dfe18)[(int)param_2]);
			lego::res::Res_GetPosition(resData,NULL,&local_c);
			local_14 = local_c.x;
			pfVar6 = &local_28;
			pfVar5 = &local_2c;
			local_10 = local_c.y;
			pLVar2 = lego::game::GetSurfaceMap();
			lego::game::SurfaceMap_ToBlockCoordinatesNoZ
								(pLVar2,local_c.x,local_c.y,(int *)pfVar5,(int *)pfVar6);
			pfVar6 = &local_18;
			pfVar5 = &local_1c;
			pLVar2 = lego::game::GetSurfaceMap();
			lego::game::SurfaceMap_ToBlockCoordinatesNoZ
								(pLVar2,local_24.x,local_24.y,(int *)pfVar5,(int *)pfVar6);
			if ((local_1c == local_2c) && (local_18 == local_28)) {
				local_30 = FUN_004419c0((LiveObject *)liveObj,1,&local_2c,&local_28,&local_14);
			}
			else {
				BVar3 = FUN_004413b0(liveObj,local_1c,local_18,local_2c,local_28,&param_1,&param_2,&local_34
														 ,0,0);
				if (BVar3 != 0) {
					BVar3 = FUN_004419c0((LiveObject *)liveObj,local_34,(float *)param_1,param_2,&local_14);
					std::free(param_1);
					std::free(param_2);
					local_30 = BVar3;
				}
			}
			iVar4 = local_30;
			if (local_30 != 0) {
				liveObj[0xbf] = iVar1;
				*(undefined *)(liveObj[9] + -3 + liveObj[10] * 0x14) = 0xd;
			}
		}
	}
	return iVar4;
}



void __cdecl lego::game::LiveObject_FlocksInit(LiveObject *in_liveObj)
{
	LiveObject *liveObj;
	LiveObject *pLVar1;
	ResourceData *in_resData;
	ResourceData *resData;
	ResourceData *pRVar2;
	FlockData *pFVar3;
	FlockSubdata *flockSubdata;
	float10 fVar4;
	float speed;
	float fVar5;
	float fVar6;
	LiveObject *resData_00;
	Vector3F vector2;
	Vector3F vector1;
	
	liveObj = in_liveObj;
	vector1.x = 0.0;
	vector1.y = 0.0;
	vector1.z = 0.0;
	vector2.x = 0.0;
	vector2.y = 0.0;
	vector2.z = 0.0;
	pLVar1 = (LiveObject *)LiveObject_GetFlocks_Size(in_liveObj);
	in_resData = LiveObject_GetResource(in_liveObj);
	resData = pool::ReservedPool_ResourceData___Next(in_resData);
	pRVar2 = res::GetRoot();
	FUN_004759d0(resData,pRVar2);
	fVar6 = 0.0;
	resData_00 = in_liveObj;
	fVar4 = LiveObject_GetFlocks_Speed(in_liveObj);
	fVar5 = (float)fVar4;
	fVar4 = LiveObject_GetFlocks_Turn(in_liveObj);
	pFVar3 = LiveObject_FlocksAllocData(NULL,NULL,(float)fVar4,fVar5,fVar6,(ResourceData *)resData_00)
	;
	in_liveObj->flocksData_32c = pFVar3;
	pFVar3->flocksSubdata1->resData_98 = resData;
	in_liveObj = pLVar1;
	if (0 < (int)pLVar1) {
		do {
			pRVar2 = res::Res_DuplicateResource(in_resData);
			FUN_004759d0(pRVar2,resData);
			fVar4 = LiveObject_GetFlocks_GoalUpdate(liveObj);
			fVar5 = (float)fVar4;
			fVar4 = LiveObject_GetFlocks_Tightness(liveObj);
			fVar6 = (float)fVar4;
			fVar4 = LiveObject_GetFlocks_Speed(liveObj);
			speed = (float)fVar4;
			fVar4 = LiveObject_GetFlocks_Turn(liveObj);
			flockSubdata = LiveObject_FlocksAllocSubdata
															 (&vector1,&vector2,(float)fVar4,speed,fVar6,fVar5,pRVar2);
			LiveObject_FlocksAddSubdata(liveObj->flocksData_32c,flockSubdata);
			in_liveObj = (LiveObject *)((int)&in_liveObj[-1].pool_m_next + 3);
		} while (in_liveObj != NULL);
	}
	return;
}



void __cdecl lego::math::FlocksMatrix_FUN_0044ba60(int **param_1,float *matrix,float scalar)
{
	float fVar1;
	float fVar2;
	float fVar3;
	Vector3F vector;
	float matrix_b [16];
	float matrix_a [16];
	
	fVar1 = matrix[0xd];
	fVar2 = matrix[0xc];
	fVar3 = matrix[0xe];
	matrix[0xc] = 0.0;
	matrix[0xd] = 0.0;
	matrix[0xe] = 0.0;
	FlocksMatrix_FUN_0047a010(matrix_b,1.570796);
	FlocksMatrix_FUN_00479fa0(matrix_a,matrix_b,matrix);
	FlocksMatrix_FUN_0047a170(matrix,matrix_a);
	matrix[0xc] = fVar2;
	matrix[0xd] = fVar3;
	matrix[0xe] = -fVar1 - scalar;
	res::Res_AddTransform((ResourceData *)param_1,D3DRMCOMBINE_REPLACE,(Matrix4F *)matrix);
	return;
}



void __cdecl FUN_0044bb10(undefined4 param_1,int param_2,float *param_3)
{
	ResourceData *resData1;
	float y;
	float x;
	LevelSurfaceMap *pLVar1;
	float10 fVar2;
	float fVar3;
	float fVar4;
	Vector3F *pVVar5;
	Vector3F local_30;
	Vector3F local_24;
	Vector3F local_18;
	Vector3F local_c;
	
	resData1 = *(ResourceData **)(param_2 + 0x98);
	if (param_3[3] == 0.0) {
		lego::math::FlocksMatrix_FUN_0044ba60((int **)resData1,(float *)(param_2 + 0x58),param_3[1]);
		if (param_3[2] != 0.0) {
			lego::res::Res_GetOrientation(resData1,NULL,&local_24,&local_30);
			local_30.x = local_30.x * 0.5;
			local_30.y = local_30.y * 0.5;
			local_30.z = (local_30.z - 1.0) * 0.5;
			lego::res::Res_SetFrameOrientation
								(resData1,NULL,local_24.x,local_24.y,local_24.z,local_30.x,local_30.y,local_30.z);
		}
	}
	else {
		y = *(float *)(param_2 + 0x90);
		x = *(float *)(param_2 + 0x88);
		local_c.x = 0.0;
		local_c.y = 1.0;
		local_c.z = 0.0;
		local_18.x = 0.0;
		local_18.y = 0.0;
		local_18.z = -1.0;
		fVar3 = x;
		fVar4 = y;
		pLVar1 = lego::game::GetSurfaceMap();
		fVar2 = lego::game::SurfaceMap_UnkGetZ(pLVar1,fVar3,fVar4);
		pVVar5 = &local_30;
		fVar3 = x;
		fVar4 = y;
		pLVar1 = lego::game::GetSurfaceMap();
		FUN_0044fd70((uint *)pLVar1,fVar3,fVar4,(undefined4 *)pVVar5);
		lego::math::Vector3_Rotate(&local_24,&local_c,&local_18,-*(float *)(param_2 + 0x24));
		lego::res::Res_SetFrameOrientation
							(resData1,NULL,local_30.x,local_30.y,local_30.z,local_24.x,local_24.y,local_24.z);
		lego::res::Res_GetOrientation(resData1,NULL,&local_30,&local_24);
		lego::res::Res_SetFrameOrientation
							(resData1,NULL,local_24.x,local_24.y,local_24.z,local_30.x,local_30.y,local_30.z);
		lego::res::Res_SetFramePosition(resData1,NULL,x,y,(float)fVar2);
	}
	if (param_3[4] == 0.0) {
		lego::res::Res_DoAnimElapsedCallbacks(resData1,*param_3);
	}
	else {
		if (0.0 <= *(float *)(param_2 + 0x28)) {
			lego::res::Res_DoAnimElapsedCallbacks(resData1,*param_3);
			return;
		}
		fVar2 = lego::res::Res_GetAnimFloat10(resData1);
		if (fVar2 != (float10)0.0) {
			fVar2 = lego::res::Res_DoAnimElapsedCallbacks(resData1,*param_3);
			if ((ushort)((ushort)(fVar2 < (float10)0.0) << 8 | (ushort)(fVar2 == (float10)0.0) << 0xe) ==
					0) {
				lego::res::Res_DoCallbacks(resData1,0.0);
				return;
			}
		}
	}
	return;
}



void __cdecl
lego::game::Flocks_ReleaseResourceCallback
					(FlockData *flockData,FlockSubdata *subdata,void *lpContext)
{
	ResourceData *resData;
	
	resData = subdata->resData_98;
	if (resData != NULL) {
		FUN_004759d0(resData,NULL);
		pool::ReservedPool_ResourceData___Release(resData);
	}
	return;
}



void __cdecl lego::game::Flocks_ReleaseData(FlockData *flockData)
{
	ResourceData *resData;
	
	if (flockData != NULL) {
		Flocks_CallbackForAllSubdata(flockData,Flocks_ReleaseResourceCallback,NULL);
		resData = flockData->flocksSubdata1->resData_98;
		FUN_004759d0(resData,NULL);
		pool::ReservedPool_ResourceData___Release(resData);
		flockData->flocksSubdata1->resData_98 = NULL;
		unk::Lego_UnkRecurseFree__0040f780((undefined4 *)flockData);
	}
	return;
}



void __cdecl FUN_0044bdf0(LiveObject *liveObj,BOOL param_2)
{
	FlockData *flockData;
	float10 fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	
	flockData = liveObj->flocksData_32c;
	if (param_2 != 0) {
		fVar1 = lego::game::LiveObject_GetFlocks_Tightness(liveObj);
		fVar4 = (float)(fVar1 + fVar1);
		fVar1 = lego::game::LiveObject_GetFlocks_Speed(liveObj);
		fVar3 = (float)(fVar1 + fVar1);
		fVar1 = lego::game::LiveObject_GetFlocks_Turn(liveObj);
		lego::game::Flocks_SetParameters1(flockData,(float)(fVar1 + fVar1),fVar3,fVar4);
		fVar1 = lego::game::LiveObject_GetFlocks_GoalUpdate(liveObj);
		fVar4 = (float)(fVar1 + fVar1);
		fVar1 = lego::game::LiveObject_GetFlocks_Tightness(liveObj);
		fVar3 = (float)(fVar1 + fVar1);
		fVar1 = lego::game::LiveObject_GetFlocks_Speed(liveObj);
		fVar2 = (float)(fVar1 * (float10)3.0);
		fVar1 = lego::game::LiveObject_GetFlocks_Turn(liveObj);
		FUN_0040ff10(flockData,(float)(fVar1 * (float10)4.0),fVar2,fVar3,fVar4);
		return;
	}
	fVar1 = lego::game::LiveObject_GetFlocks_Tightness(liveObj);
	fVar4 = (float)fVar1;
	fVar1 = lego::game::LiveObject_GetFlocks_Speed(liveObj);
	fVar3 = (float)fVar1;
	fVar1 = lego::game::LiveObject_GetFlocks_Turn(liveObj);
	lego::game::Flocks_SetParameters1(flockData,(float)fVar1,fVar3,fVar4);
	fVar1 = lego::game::LiveObject_GetFlocks_GoalUpdate(liveObj);
	fVar4 = (float)fVar1;
	fVar1 = lego::game::LiveObject_GetFlocks_Tightness(liveObj);
	fVar3 = (float)fVar1;
	fVar1 = lego::game::LiveObject_GetFlocks_Speed(liveObj);
	fVar2 = (float)fVar1;
	fVar1 = lego::game::LiveObject_GetFlocks_Turn(liveObj);
	FUN_0040ff10(flockData,(float)fVar1,fVar2,fVar3,fVar4);
	return;
}



void __cdecl FUN_0044bef0(LiveObject *liveObj,float param_2)
{
	uint *puVar1;
	FlockData *pFVar2;
	ObjectStatsFlags1 OVar3;
	ResourceData *pRVar4;
	BOOL BVar5;
	float10 fVar6;
	ResourceData *opt_refResData;
	Vector3F *out_position;
	float local_2c;
	float local_28;
	float local_24;
	Vector3F local_20;
	float local_14;
	float local_10;
	uint local_c;
	uint local_8;
	uint local_4;
	
	OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if ((OVar3 & STATS1_FLOCKS) != STATS1_NONE) {
		OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		if ((OVar3 & STATS1_FLOCKS_DEBUG) == STATS1_NONE) {
			pRVar4 = lego::game::LiveObject_GetResource(liveObj);
			BVar5 = lego::res::Res_GetFlag8(pRVar4);
			if (BVar5 == 0) {
				lego::game::LiveObject_FUN_0044a210(liveObj,1);
			}
		}
		pFVar2 = liveObj->flocksData_32c;
		if ((*(byte *)&pFVar2->field_24 & 1) != 0) {
			pFVar2->field_14 = param_2 + (float)pFVar2->field_14;
		}
		fVar6 = lego::game::LiveObject_GetFlocks_AttackTime(liveObj);
		if (((ushort)((ushort)(fVar6 < (float10)param_2) << 8 |
								 (ushort)(fVar6 == (float10)param_2) << 0xe) != 0) &&
			 ((*(byte *)&liveObj->flags2_3e4 & 0x80) == 0)) {
			FUN_00403c40(liveObj,1,NULL,1);
			puVar1 = &liveObj->flocksData_32c->field_24;
			*puVar1 = *puVar1 & 0xfffffffe;
		}
		out_position = &local_20;
		opt_refResData = NULL;
		pRVar4 = lego::game::LiveObject_GetResource(liveObj);
		lego::res::Res_GetPosition(pRVar4,opt_refResData,out_position);
		local_28 = -local_20.z;
		local_2c = local_20.x;
		local_24 = local_20.y;
		BVar5 = lego::res::Res_GetActFrameIsLWSFile((ActFrameResource *)liveObj->flocksData_32c);
		if (BVar5 == 0) {
			FUN_0040ff50((int *)liveObj->flocksData_32c,&local_2c);
			FUN_0040ffa0((int)liveObj->flocksData_32c,&local_2c);
			FUN_0040ffe0((int)liveObj->flocksData_32c,&local_2c);
		}
		if ((*(byte *)&liveObj->flags2_3e4 & 0x80) == 0) {
			FUN_0044bdf0(liveObj,0);
		}
		else {
			FUN_0044bdf0(liveObj,1);
			liveObj->flags2_3e4 = liveObj->flags2_3e4 & 0xffffff7f;
		}
		FUN_0040fce0((int *)liveObj->flocksData_32c,&local_2c);
		fVar6 = lego::game::LiveObject_GetFlocks_Randomness(liveObj);
		FUN_0040fe80((int)liveObj->flocksData_32c,(float)fVar6);
		lego::game::Flocks_FUN_0040fd30(liveObj->flocksData_32c,param_2);
		local_14 = param_2;
		fVar6 = lego::game::LiveObject_GetFlocks_Height(liveObj);
		local_10 = (float)fVar6;
		OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		local_c = OVar3 >> 0x17 & 1;
		OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		local_8 = OVar3 >> 0x1a & 1;
		OVar3 = lego::game::LiveObject_GetStatsFlags1(liveObj);
		local_4 = OVar3 >> 0x1c & 1;
		lego::game::Flocks_CallbackForAllSubdata(liveObj->flocksData_32c,FUN_0044bb10,&local_14);
	}
	return;
}



void __cdecl FUN_0044c0f0(LiveObject *liveObj)
{
	ObjectStatsFlags1 OVar1;
	FlockData **ppFVar2;
	FlockData *pFVar3;
	float10 fVar4;
	float local_c;
	float local_8;
	float local_4;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags1(liveObj);
	if ((OVar1 & STATS1_FLOCKS_QUICKDESTROY) != STATS1_NONE) {
		lego::game::Flocks_ReleaseData(liveObj->flocksData_32c);
		return;
	}
	ppFVar2 = (FlockData **)std::malloc(0x10);
	if (ppFVar2 == NULL) {
		lego::game::Flocks_ReleaseData(liveObj->flocksData_32c);
		return;
	}
	pFVar3 = liveObj->flocksData_32c;
	local_c = (pFVar3->flocksSubdata1->vector_0).x;
	local_8 = (pFVar3->flocksSubdata1->vector_0).y;
	local_4 = (pFVar3->flocksSubdata1->vector_0).z;
	*ppFVar2 = pFVar3;
	pFVar3 = (FlockData *)lego::game::LiveObject_GetStatsFlags1(liveObj);
	ppFVar2[2] = pFVar3;
	ppFVar2[1] = DAT_004ebdd0;
	fVar4 = lego::game::LiveObject_GetFlocks_Height(liveObj);
	ppFVar2[3] = (FlockData *)(float)fVar4;
	DAT_004ebdd0 = (FlockData *)ppFVar2;
	FUN_0040ff50((int *)liveObj->flocksData_32c,&local_c);
	FUN_0040ffe0((int)liveObj->flocksData_32c,&local_c);
	return;
}



// WARNING: Type propagation algorithm not settling

void __cdecl FUN_0044c1c0(undefined4 *param_1)
{
	FlockSubdata *pFVar1;
	int iVar2;
	FlockSubdata *pFVar3;
	FlockSubdata *buffer;
	FlockSubdata *pFVar4;
	undefined4 local_14;
	uint local_10;
	uint local_c;
	uint local_8;
	uint local_4;
	
	pFVar3 = NULL;
	buffer = DAT_004ebdd0;
	if (DAT_004ebdd0 != NULL) {
		do {
			lego::game::Flocks_CallbackForAllSubdata
								(*(FlockData **)&buffer->vector_0,FUN_00410000,param_1);
			local_14 = *param_1;
			local_10 = (uint)(buffer->vector_c).x;
			local_c = (uint)*(float *)((int)&buffer->vector_0 + 8) >> 0x17 & 1;
			local_8 = (uint)*(float *)((int)&buffer->vector_0 + 8) >> 0x1a & 1;
			local_4 = (uint)*(float *)((int)&buffer->vector_0 + 8) >> 0x1c & 1;
			lego::game::Flocks_CallbackForAllSubdata
								(*(FlockData **)&buffer->vector_0,FUN_0044bb10,&local_14);
			iVar2 = FUN_004101b0(*(int *)&buffer->vector_0);
			if (iVar2 == 0) {
				pFVar4 = *(FlockSubdata **)((int)&buffer->vector_0 + 4);
			}
			else {
				pFVar4 = *(FlockSubdata **)((int)&buffer->vector_0 + 4);
				pFVar1 = pFVar4;
				if (pFVar3 != NULL) {
					*(FlockSubdata **)((int)&pFVar3->vector_0 + 4) = pFVar4;
					pFVar1 = DAT_004ebdd0;
				}
				DAT_004ebdd0 = pFVar1;
				lego::game::Flocks_ReleaseData(*(FlockData **)&buffer->vector_0);
				std::free(buffer);
				buffer = pFVar3;
			}
			pFVar3 = buffer;
			buffer = pFVar4;
		} while (pFVar4 != NULL);
	}
	return;
}



undefined4 __cdecl FUN_0044c290(uint *param_1)
{
	if ((ushort)((ushort)((float)param_1[0xb5] < 0.0) << 8 |
							(ushort)((float)param_1[0xb5] == 0.0) << 0xe) == 0) {
		param_1[0xf8] = param_1[0xf8] & 0xffefffff;
		FUN_0044b270((LiveObject *)param_1);
		FUN_0044b250((int *)param_1);
		param_1[0xfa] = param_1[0xfa] | 0x800000;
		lego::nerps::NERPs_IncRockMonstersDestroyed();
		return 1;
	}
	return 0;
}



undefined4 __cdecl FUN_0044c2f0(int *param_1,float param_2)
{
	LiveObject *pLVar1;
	float10 fVar2;
	float local_c;
	float local_8 [2];
	
	if (((param_1[0xf9] & 0x8000000U) == 0) && (*param_1 == 3)) {
		param_1[0xf9] = param_1[0xf9] | 0x8000000;
		param_1[0xda] = (int)(param_2 * 25.0);
		lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_c,local_8);
		fVar2 = FUN_00442740((LiveObject *)param_1);
		pLVar1 = lego::game::Game_CreateLiveResourceObject
											 (lego::globals::g_Game.RES_IceCube,OBJECT_ICECUBE,0,0,local_c,local_8[0],
												(float)fVar2);
		lego::res::Res_ResourceShortNormal_FUN_00473630(pLVar1->other,"Start");
		lego::res::Res_DoCallbacks(pLVar1->other,0.0);
		pLVar1->flags1_3e0 = pLVar1->flags1_3e0 | 0x100;
		param_1[0xd9] = (int)pLVar1;
		pLVar1->field_364 = param_1;
		return 1;
	}
	return 0;
}



void __cdecl FUN_0044c3d0(int param_1)
{
	uint *puVar1;
	
	if ((*(uint *)(*(int *)(param_1 + 0x364) + 0x3e0) & 0x200000) == 0) {
		*(undefined **)(*(int *)(param_1 + 0x364) + 0x340) = &DAT_42c80000;
		puVar1 = (uint *)(*(int *)(param_1 + 0x364) + 1000);
		*puVar1 = *puVar1 | 0x800000;
	}
	return;
}



undefined4 __cdecl FUN_0044c410(int **param_1,int **param_2,int *param_3)
{
	int *piVar1;
	
	piVar1 = *param_1;
	if (((piVar1 != (int *)0x2) && (piVar1 != (int *)0x3)) && (piVar1 != (int *)0x1)) {
		return 0;
	}
	FUN_00441df0((LiveObject *)param_1,0,1);
	param_1[0xed] = *param_2;
	param_1[0xee] = param_2[1];
	param_1[0xef] = param_3;
	param_1[0xf9] = (int *)((uint)param_1[0xf9] | 0x4000);
	return 1;
}



void __cdecl FUN_0044c470(int *param_1,float param_2)
{
	LevelSurfaceMap *pLVar1;
	int iVar2;
	float fVar3;
	float fVar4;
	int *piVar5;
	int *piVar6;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	int local_8;
	int local_4;
	
	lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_18,&local_14);
	local_10 = (float)param_1[0xed] * param_2;
	piVar6 = &local_4;
	piVar5 = &local_8;
	local_c = (float)param_1[0xee] * param_2;
	fVar3 = local_10 + local_18;
	fVar4 = local_c + local_14;
	local_18 = fVar3;
	local_14 = fVar4;
	pLVar1 = lego::game::GetSurfaceMap();
	lego::game::SurfaceMap_ToBlockCoordinatesNoZ(pLVar1,fVar3,fVar4,piVar5,piVar6);
	iVar2 = FUN_00431cd0((LiveObject *)param_1,local_8,local_4,local_8,local_4,1);
	if (iVar2 == 0) {
LAB_0044c517:
		fVar3 = (float)param_1[0xed];
		fVar4 = 1.0 / SQRT(fVar3 * fVar3 + (float)param_1[0xee] * (float)param_1[0xee]);
		fVar3 = SQRT(fVar3 * fVar3 + (float)param_1[0xee] * (float)param_1[0xee]);
		param_1[0xed] = (int)((float)param_1[0xed] * fVar4);
		param_1[0xee] = (int)(fVar4 * (float)param_1[0xee]);
		if ((ushort)((ushort)((float)param_1[0xed] < 0.5) << 8 |
								(ushort)((float)param_1[0xed] == 0.5) << 0xe) == 0) {
			param_1[0xed] = 0x3f800000;
			param_1[0xee] = 0;
		}
		else {
			if (-0.5 <= (float)param_1[0xed]) {
				if ((ushort)((ushort)((float)param_1[0xee] < 0.5) << 8 |
										(ushort)((float)param_1[0xee] == 0.5) << 0xe) == 0) {
					param_1[0xed] = 0;
					param_1[0xee] = 0x3f800000;
				}
				else {
					if ((float)param_1[0xee] < -0.5) {
						param_1[0xed] = 0;
						param_1[0xee] = -0x40800000;
					}
				}
			}
			else {
				param_1[0xed] = -0x40800000;
				param_1[0xee] = 0;
			}
		}
		param_1[0xed] = (int)((float)param_1[0xed] * fVar3);
		param_1[0xee] = (int)((float)param_1[0xee] * fVar3);
		lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_18,&local_14);
		local_10 = (float)param_1[0xed] * param_2;
		piVar6 = &local_4;
		piVar5 = &local_8;
		local_c = (float)param_1[0xee] * param_2;
		fVar3 = local_10 + local_18;
		fVar4 = local_c + local_14;
		local_18 = fVar3;
		local_14 = fVar4;
		pLVar1 = lego::game::GetSurfaceMap();
		lego::game::SurfaceMap_ToBlockCoordinatesNoZ(pLVar1,fVar3,fVar4,piVar5,piVar6);
		iVar2 = FUN_00431cd0((LiveObject *)param_1,local_8,local_4,local_8,local_4,1);
		if (iVar2 != 0) {
			iVar2 = FUN_00446030((LiveObject *)param_1,&local_18,0,0);
			if (iVar2 == 0) goto LAB_0044c6eb;
		}
		param_1[0xf9] = param_1[0xf9] & 0xffffbfff;
	}
	else {
		iVar2 = FUN_00446030((LiveObject *)param_1,&local_18,0,0);
		if (iVar2 != 0) goto LAB_0044c517;
LAB_0044c6eb:
		FUN_00442b60((LiveObject *)param_1,local_18,local_14,0,0);
	}
	if ((ushort)((ushort)((float)param_1[0xef] < 0.0) << 8 |
							(ushort)((float)param_1[0xef] == 0.0) << 0xe) != 0) {
		param_1[0xf9] = param_1[0xf9] & 0xffffbfff;
	}
	param_1[0xef] = (int)((float)param_1[0xef] - SQRT(local_c * local_c + local_10 * local_10));
	return;
}



void __cdecl FUN_0044c760(LiveObject *liveObj)
{
	ObjectStatsFlags2 OVar1;
	ObjectStatsFlags1 OVar2;
	
	if ((*(byte *)&liveObj->flags4_3ec & 2) != 0) {
		OVar1 = lego::game::LiveObject_GetStatsFlags2(liveObj);
		if ((OVar1 & STATS2_CANDOUBLESELECT) != STATS2_NONE) {
			OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj);
			if (((OVar2 & STATS1_CANBEDRIVEN) == STATS1_NONE) || (liveObj->drivenObject != NULL)) {
				lego::globals::g_Game.flags1 |= GAME1_LASERTRACKER;
				liveObj->flags4_3ec = liveObj->flags4_3ec | 1;
			}
		}
	}
	FUN_0041e680();
	return;
}



undefined4 __cdecl FUN_0044c7c0(LiveObject *liveObj)
{
	if ((*(byte *)&liveObj->flags4_3ec & 1) != 0) {
		lego::globals::g_Game.flags1 &= ~GAME1_LASERTRACKER;
	}
	liveObj->flags4_3ec = liveObj->flags4_3ec & 0xfffffffe;
	return 0;
}



undefined4 __cdecl FUN_0044c7f0(int *param_1)
{
	uint uVar1;
	
	if (*param_1 == 2) {
		uVar1 = lego::game::LiveObject_GetEquippedBeam((LiveObject *)param_1);
		if (uVar1 != 0) {
			return 1;
		}
	}
	return 0;
}



void FUN_0044c810(void)
{
	BOOL BVar1;
	ObjectType local_4;
	
	lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS |= 0x40;
	BVar1 = FUN_00437a70(FUN_0044c8b0,NULL);
	if (BVar1 == 0) {
		if (DAT_004ebbc8 == 0) {
			local_4 = OBJECT_VEHICLE;
			BVar1 = FUN_00437a70(FUN_0044c8b0,(LiveObject *)&local_4);
			if ((BVar1 == 0) && (DAT_004ebbc4 != 0)) {
				DAT_004ebbc4 = 0;
				DAT_004ebbc8 = 0;
				FUN_00437a70(FUN_0044c8b0,(LiveObject *)&local_4);
				return;
			}
		}
		else {
			DAT_004ebbc4 = 0;
			DAT_004ebbc8 = 0;
			FUN_00437a70(FUN_0044c8b0,NULL);
		}
	}
	return;
}



BOOL __cdecl FUN_0044c8b0(LiveObject *liveObj,int *param_2)
{
	int iVar1;
	uint uVar2;
	BOOL BVar3;
	LiveObject **ppLVar4;
	float local_c;
	float local_8;
	float local_4;
	
	iVar1 = 0;
	if (param_2 != NULL) {
		iVar1 = *param_2;
	}
	if (iVar1 == 0) {
		if (liveObj->objType != OBJECT_BUILDING) {
			return 0;
		}
	}
	else {
		if (liveObj->objType != OBJECT_MINIFIGURE) {
			return 0;
		}
	}
	uVar2 = 0;
	if (DAT_004ebbc4 != 0) {
		ppLVar4 = (LiveObject **)&DAT_004eb7c4;
		do {
			if (*ppLVar4 == liveObj) {
				return 0;
			}
			uVar2 += 1;
			ppLVar4 = ppLVar4 + 1;
		} while (uVar2 < DAT_004ebbc4);
	}
	if (DAT_004ebbc4 < 0x100) {
		(&DAT_004eb7c4)[DAT_004ebbc4] = liveObj;
		DAT_004ebbc4 += 1;
		if (liveObj->objType == OBJECT_BUILDING) {
			DAT_004ebbc8 += 1;
		}
		FUN_0042dd70(liveObj,NULL,0);
		BVar3 = FUN_004505a0((lego::globals::g_Game.level)->surfaceMap,(int)lego::globals::g_Game.ptr_1c
												 ,lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y,
												 (uint *)&param_2,(uint *)&liveObj,&local_c);
		if (BVar3 != 0) {
			lego::res::Res_SetFramePosition
								(lego::globals::g_Game.struct2c_48,NULL,local_c,local_8,local_4 - 250.0);
			return 1;
		}
	}
	else {
		DAT_004ebbc4 = 0;
		DAT_004ebbc8 = 0;
	}
	return 1;
}



void __cdecl
FUN_0044c9d0(ResourceData *resData1,ResourceData *resData2,float vector_x,float vector_y,
						float vector_z)
{
	Vector3F_004ebde0.x = vector_x;
	Vector3F_004ebde0.y = vector_y;
	Vector3F_004ebdec.x = vector_x;
	Vector3F_004ebdec.y = vector_y;
	Vector3F_004ebde0.z = vector_z;
	Vector3F_004ebdec.z = vector_z;
	RESDATA_004ebdd8 = resData1;
	RESDATA_004ebddc = resData2;
	lego::res::Res_SetLightColor(resData1,vector_x,vector_y,vector_z,1.0);
	return;
}



void __cdecl FUN_0044ca50(int param_1)
{
	if (param_1 != 0) {
		FLAGS_004ebec8 |= 0x100;
		lego::res::Res_SetLightColor
							(RESDATA_004ebdd8,Vector3F_004ebde0.x,Vector3F_004ebde0.y,Vector3F_004ebde0.z,1.0);
		return;
	}
	FLAGS_004ebec8 = FLAGS_004ebec8 & 0xfffffeff;
	return;
}



void __cdecl lego::main::Main_Load_LightEffects(CFGProperty *root,char *keyBasePath)
{
	game::Game_loadCFGLightEffectsBlink(root,keyBasePath);
	game::Game_loadCFGLightEffectsFade(root,keyBasePath);
	game::Game_loadCFGLightEffectsMove(root,keyBasePath);
	return;
}



BOOL __cdecl lego::game::Game_loadCFGLightEffectsBlink(CFGProperty *root,char *keyBase)
{
	char *pcVar1;
	BOOL BVar2;
	char *pcVar3;
	int iVar4;
	float10 fVar5;
	float10 fVar6;
	float *out_r;
	float *out_g;
	float *out_b;
	float blink_blue;
	float blink_green;
	float blink_red;
	char *min_rangeStr;
	char *max_rangeStr;
	
	pcVar3 = keyBase;
	out_b = &blink_blue;
	out_g = &blink_green;
	out_r = &blink_red;
	pcVar1 = cfg::CFG_JoinPath(keyBase,"LightEffects","BlinkRGBMax",0);
	BVar2 = cfg::CFG_GetPropertyRGBF(root,pcVar1,out_r,out_g,out_b);
	if (BVar2 != 0) {
		pcVar1 = cfg::CFG_JoinPath(keyBase,"LightEffects","MaxChangeAllowed",0);
		pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
		if (pcVar1 == NULL) {
			pcVar1 = ____EMPTYSTR__;
		}
		else {
			pcVar1 = cfg::CFG_JoinPath(keyBase,"LightEffects","MaxChangeAllowed",0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
		}
		fVar5 = std::atof(pcVar1);
		keyBase = (char *)(float)fVar5;
		if ((float10)0.0 != fVar5) {
			keyBase = (char *)((float)keyBase * 0.003921569);
		}
		pcVar3 = cfg::CFG_JoinPath(pcVar3,"LightEffects","RandomRangeForTimeBetweenBlinks",0);
		pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
		if (pcVar3 != NULL) {
			iVar4 = lego::util::stringSplit(pcVar3,&min_rangeStr,":");
			if (iVar4 == 2) {
				fVar5 = std::atof(min_rangeStr);
				fVar6 = std::atof(max_rangeStr);
				std::free(pcVar3);
				Game_setLightEffectsBlink
									(blink_red,blink_green,blink_blue,(float)keyBase,(float)(fVar5 * (float10)25.0),
									 (float)(fVar6 * (float10)25.0));
				return 1;
			}
			std::free(pcVar3);
		}
	}
	return 0;
}



void __cdecl
lego::game::Game_setLightEffectsBlink
					(float red,float green,float blue,float maxChange,float minRange,float maxRange)
{
	globals::g_BlinkRGBMax.red = red;
	globals::g_BlinkRGBMax.green = green;
	globals::g_BlinkRGBMax.blue = blue;
	globals::g_RandomRangeForTimeBetweenBlinks_min = minRange;
	globals::g_RandomRangeForTimeBetweenBlinks_max = maxRange;
	globals::g_MaxChangeAllowed = maxChange;
	FLAGS_004ebec8 = FLAGS_004ebec8 | 1;
	return;
}



BOOL __cdecl lego::game::Game_loadCFGLightEffectsFade(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	BOOL BVar2;
	int iVar3;
	float10 fVar4;
	float10 fVar5;
	float10 fVar6;
	float10 fVar7;
	float10 fVar8;
	float10 fVar9;
	float *pfVar10;
	float *pfVar11;
	float *pfVar12;
	float local_40;
	float local_3c;
	float local_38;
	float local_34;
	float local_30;
	float local_2c;
	char *local_28;
	char *local_24;
	
	pfVar12 = &local_34;
	pfVar11 = &local_30;
	pfVar10 = &local_2c;
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"LightEffects","FadeRGBMin",0);
	BVar2 = cfg::CFG_GetPropertyRGBF(root,pcVar1,pfVar10,pfVar11,pfVar12);
	if (BVar2 != 0) {
		pfVar12 = &local_40;
		pfVar11 = &local_3c;
		pfVar10 = &local_38;
		pcVar1 = cfg::CFG_JoinPath(keyBasePath,"LightEffects","FadeRGBMax",0);
		BVar2 = cfg::CFG_GetPropertyRGBF(root,pcVar1,pfVar10,pfVar11,pfVar12);
		if (BVar2 != 0) {
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"LightEffects","RandomRangeForTimeBetweenFades",0);
			pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
			if (pcVar1 != NULL) {
				iVar3 = lego::util::stringSplit(pcVar1,&local_28,":");
				if (iVar3 == 2) {
					fVar4 = std::atof(local_28);
					fVar5 = std::atof(local_24);
					std::free(pcVar1);
					pcVar1 = cfg::CFG_JoinPath(keyBasePath,"LightEffects","RandomRangeForFadeTimeFade",0);
					pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
					if (pcVar1 == NULL) {
						return 0;
					}
					iVar3 = lego::util::stringSplit(pcVar1,&local_28,":");
					if (iVar3 == 2) {
						fVar6 = std::atof(local_28);
						fVar7 = std::atof(local_24);
						std::free(pcVar1);
						pcVar1 = cfg::CFG_JoinPath(keyBasePath,"LightEffects","RandomRangeForHoldTimeOfFade",0);
						pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
						if (pcVar1 == NULL) {
							return 0;
						}
						iVar3 = lego::util::stringSplit(pcVar1,&local_28,":");
						if (iVar3 == 2) {
							fVar8 = std::atof(local_28);
							fVar9 = std::atof(local_24);
							std::free(pcVar1);
							Game_setLightEffectsFade__0044ced0
												(local_2c,local_30,local_34,local_38,local_3c,local_40,
												 (float)(fVar4 * (float10)25.0),(float)(fVar5 * (float10)25.0),
												 (float)(fVar6 * (float10)25.0),(float)(fVar7 * (float10)25.0),
												 (float)(fVar8 * (float10)25.0),(float)(fVar9 * (float10)25.0));
							return 1;
						}
					}
				}
				std::free(pcVar1);
			}
		}
	}
	return 0;
}



void __cdecl
lego::game::Game_setLightEffectsFade__0044ced0
					(float min_red,float min_green,float min_blue,float max_red,float max_green,float max_blue
					,float time_min,float time_max,float fade_min,float fade_max,float hold_min,float hold_max
					)
{
	globals::g_FadeRGBMin.red = min_red;
	globals::g_FadeRGBMin.green = min_green;
	globals::g_FadeRGBMin.blue = min_blue;
	globals::g_FadeRGBMax.red = max_red;
	globals::g_FadeRGBMax.green = max_green;
	globals::g_FadeRGBMax.blue = max_blue;
	globals::g_RandomRangeForTimeBetweenFades_min = time_min;
	globals::g_RandomRangeForTimeBetweenFades_max = time_max;
	globals::g_RandomRangeForFadeTimeFade_min = fade_min;
	globals::g_RandomRangeForFadeTimeFade_max = fade_max;
	globals::g_RandomRangeForHoldTimeOfFade_min = hold_min;
	globals::g_RandomRangeForHoldTimeOfFade_max = hold_max;
	FLAGS_004ebec8 = FLAGS_004ebec8 | 4;
	return;
}



BOOL __cdecl lego::game::Game_loadCFGLightEffectsMove(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	int iVar2;
	float10 fVar3;
	float10 fVar4;
	float10 fVar5;
	float10 fVar6;
	float10 fVar7;
	float10 fVar8;
	float10 fVar9;
	float10 fVar10;
	float10 fVar11;
	char *local_28;
	char *local_24;
	char *local_20;
	
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"LightEffects","RandomRangeForTimeBetweenMoves",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		iVar2 = lego::util::stringSplit(pcVar1,&local_28,":");
		if (iVar2 == 2) {
			fVar3 = std::atof(local_28);
			fVar4 = std::atof(local_24);
			std::free(pcVar1);
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"LightEffects","RandomRangeForSpeedOfMove",0);
			pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
			if (pcVar1 == NULL) {
				return 0;
			}
			iVar2 = lego::util::stringSplit(pcVar1,&local_28,":");
			if (iVar2 == 2) {
				fVar5 = std::atof(local_28);
				fVar6 = std::atof(local_24);
				std::free(pcVar1);
				pcVar1 = cfg::CFG_JoinPath(keyBasePath,"LightEffects","RandomRangeForDistOfMove",0);
				pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
				if (pcVar1 == NULL) {
					return 0;
				}
				iVar2 = lego::util::stringSplit(pcVar1,&local_28,":");
				if (iVar2 == 2) {
					fVar7 = std::atof(local_28);
					fVar8 = std::atof(local_24);
					std::free(pcVar1);
					pcVar1 = cfg::CFG_JoinPath(keyBasePath,"LightEffects","MoveLimit",0);
					pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
					if (pcVar1 == NULL) {
						return 0;
					}
					iVar2 = lego::util::stringSplit(pcVar1,&local_28,":");
					if (iVar2 == 3) {
						fVar9 = std::atof(local_28);
						fVar10 = std::atof(local_24);
						fVar11 = std::atof(local_20);
						std::free(pcVar1);
						Game_setLightEffectsMove
											((float)(fVar3 * (float10)25.0),(float)(fVar4 * (float10)25.0),
											 (float)(fVar5 * (float10)25.0),(float)(fVar6 * (float10)25.0),(float)fVar7,
											 (float)fVar8,(float)fVar9,(float)fVar10,(float)fVar11);
						return 1;
					}
				}
			}
		}
		std::free(pcVar1);
	}
	return 0;
}



void __cdecl
lego::game::Game_setLightEffectsMove
					(float minTime,float maxTime,float minSpeed,float maxSpeed,float minDist,float maxDist,
					float limit_x,float limit_y,float limit_z)
{
	globals::g_RandomRangeForTimeBetweenMoves_min = minTime;
	globals::g_RandomRangeForTimeBetweenMoves_max = maxTime;
	globals::g_RandomRangeForSpeedOfMove_max = maxSpeed;
	globals::g_RandomRangeForDistOfMove_min = minDist;
	globals::g_RandomRangeForSpeedOfMove_min = minSpeed;
	globals::g_RandomRangeForDistOfMove_max = maxDist;
	res::Res_GetPosition(RESDATA_004ebdd8,RESDATA_004ebddc,&Vector3F_004ebe74);
	globals::g_MoveLimit_Vector.x = limit_x;
	globals::g_MoveLimit_Vector.y = limit_y;
	globals::g_MoveLimit_Vector.z = limit_z;
	FLAGS_004ebec8 = FLAGS_004ebec8 | 0x40;
	return;
}



void FUN_0044d230(void)
{
	lego::res::Res_GetPosition(RESDATA_004ebdd8,RESDATA_004ebddc,&Vector3F_004ebe74);
	FLAGS_004ebec8 = FLAGS_004ebec8 & 0xffffff7f;
	return;
}



void __cdecl FUN_0044d260(float param_1)
{
	if (((FLAGS_004ebec8 & 0x100) == 0) && (RESDATA_004ebdd8 != NULL)) {
		FUN_0044d390(param_1);
		FUN_0044d540(param_1);
		FUN_0044da20(param_1);
		FUN_0044dd10(param_1);
		FUN_0044d2b0();
	}
	return;
}



void FUN_0044d2b0(void)
{
	float local_c;
	float local_8;
	float local_4;
	
	local_4 = Vector3F_004ebdec.x;
	local_8 = Vector3F_004ebdec.y;
	local_c = Vector3F_004ebdec.z;
	if (Vector3F_004ebdec.x < 0.0) {
		local_4 = 0.0;
	}
	if ((ushort)((ushort)(local_4 < 1.0) << 8 | (ushort)(local_4 == 1.0) << 0xe) == 0) {
		local_4 = 1.0;
	}
	if (Vector3F_004ebdec.y < 0.0) {
		local_8 = 0.0;
	}
	if ((ushort)((ushort)(local_8 < 1.0) << 8 | (ushort)(local_8 == 1.0) << 0xe) == 0) {
		local_8 = 1.0;
	}
	if (Vector3F_004ebdec.z < 0.0) {
		local_c = 0.0;
	}
	if ((ushort)((ushort)(local_c < 1.0) << 8 | (ushort)(local_c == 1.0) << 0xe) == 0) {
		local_c = 1.0;
	}
	lego::res::Res_SetLightColor(RESDATA_004ebdd8,local_4,local_8,local_c,1.0);
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_0044d390(float param_1)
{
	float fVar1;
	float fVar2;
	bool bVar3;
	short sVar4;
	float10 fVar5;
	float local_8;
	float local_4;
	
	bVar3 = false;
	if (((byte)FLAGS_004ebec8 & 1) == 0) {
		return;
	}
	_DAT_004ebe04 = _DAT_004ebe04 - param_1;
	if ((ushort)((ushort)(_DAT_004ebe04 < 0.0) << 8 | (ushort)(_DAT_004ebe04 == 0.0) << 0xe) == 0) {
		return;
	}
	fVar5 = lego::game::Game_ChooseRandomRange
										(lego::globals::g_RandomRangeForTimeBetweenBlinks_min,
										 lego::globals::g_RandomRangeForTimeBetweenBlinks_max);
	_DAT_004ebe04 = (float)fVar5;
	sVar4 = lego::util::randomInt16();
	fVar2 = (float)((int)sVar4 % 1000) * 0.001;
	param_1 = (lego::globals::g_BlinkRGBMax.red + lego::globals::g_BlinkRGBMax.red) * fVar2 -
						lego::globals::g_BlinkRGBMax.red;
	local_8 = (lego::globals::g_BlinkRGBMax.green + lego::globals::g_BlinkRGBMax.green) * fVar2 -
						lego::globals::g_BlinkRGBMax.green;
	fVar1 = param_1 + _DAT_004ebe10;
	local_4 = (lego::globals::g_BlinkRGBMax.blue + lego::globals::g_BlinkRGBMax.blue) * fVar2 -
						lego::globals::g_BlinkRGBMax.blue;
	if (lego::globals::g_MaxChangeAllowed <= ABS(fVar1)) {
		FUN_0044d510(&param_1);
		FUN_0044d510(&local_8);
		FUN_0044d510(&local_4);
		fVar1 = param_1 + _DAT_004ebe10;
		if (lego::globals::g_MaxChangeAllowed <= ABS(fVar1)) goto LAB_0044d4b5;
	}
	bVar3 = true;
LAB_0044d4b5:
	if (!bVar3) {
		return;
	}
	Vector3F_004ebdec.x = param_1 + Vector3F_004ebdec.x;
	Vector3F_004ebdec.y = local_8 + Vector3F_004ebdec.y;
	Vector3F_004ebdec.z = local_4 + Vector3F_004ebdec.z;
	_DAT_004ebe10 = fVar1;
	return;
}



void __cdecl FUN_0044d510(float *param_1)
{
	if (*param_1 < 0.0) {
		*param_1 = *param_1 * -1.0;
		return;
	}
	*param_1 = -*param_1;
	return;
}



void __cdecl FUN_0044d540(float param_1)
{
	float fVar1;
	short sVar2;
	float10 fVar3;
	
	if ((FLAGS_004ebec8 & 4) != 0) {
		if ((FLAGS_004ebec8 & 8) == 0) {
			FLOAT_004ebe3c = FLOAT_004ebe3c - param_1;
			if ((ushort)((ushort)(FLOAT_004ebe3c < 0.0) << 8 | (ushort)(FLOAT_004ebe3c == 0.0) << 0xe) !=
					0) {
				fVar3 = lego::game::Game_ChooseRandomRange
													(lego::globals::g_RandomRangeForTimeBetweenFades_min,
													 lego::globals::g_RandomRangeForTimeBetweenFades_max);
				FLOAT_004ebe3c = (float)fVar3;
				fVar3 = lego::game::Game_ChooseRandomRange
													(lego::globals::g_RandomRangeForHoldTimeOfFade_min,
													 lego::globals::g_RandomRangeForHoldTimeOfFade_max);
				FLOAT_004ebe5c = (float)fVar3;
				sVar2 = lego::util::randomInt16();
				FLOAT_004ebe68 = 0.0;
				FLOAT_004ebe6c = 0.0;
				FLOAT_004ebe70 = 0.0;
				fVar1 = (float)((int)sVar2 % 1000) * 0.001;
				FLOAT_004ebe18 =
						 ABS(lego::globals::g_FadeRGBMax.red - lego::globals::g_FadeRGBMin.red) * fVar1 +
						 lego::globals::g_FadeRGBMin.red;
				FLOAT_004ebe1c =
						 ABS(lego::globals::g_FadeRGBMax.green - lego::globals::g_FadeRGBMin.green) * fVar1 +
						 lego::globals::g_FadeRGBMin.green;
				FLOAT_004ebe20 =
						 ABS(lego::globals::g_FadeRGBMax.blue - lego::globals::g_FadeRGBMin.blue) * fVar1 +
						 lego::globals::g_FadeRGBMin.blue;
				FUN_0044d9d0();
				FLAGS_004ebec8 |= 0x18;
			}
		}
		else {
			if ((FLAGS_004ebec8 & 0x10) == 0) {
				if ((FLAGS_004ebec8 & 0x20) == 0) {
					FLOAT_004ebe5c = FLOAT_004ebe5c - param_1;
					if ((ushort)((ushort)(FLOAT_004ebe5c < 0.0) << 8 | (ushort)(FLOAT_004ebe5c == 0.0) << 0xe)
							!= 0) {
						FUN_0044d9d0();
						FLOAT_004ebe68 = FLOAT_004ebe18;
						FLOAT_004ebe6c = FLOAT_004ebe1c;
						FLOAT_004ebe70 = FLOAT_004ebe20;
						FLAGS_004ebec8 = FLAGS_004ebec8 | 0x20;
						return;
					}
				}
				else {
					fVar1 = param_1 * FLOAT_004ebe48;
					Vector3F_004ebdec.x = Vector3F_004ebdec.x - fVar1;
					FLOAT_004ebe68 = FLOAT_004ebe68 - fVar1;
					Vector3F_004ebdec.y = Vector3F_004ebdec.y - param_1 * FLOAT_004ebe4c;
					FLOAT_004ebe6c = FLOAT_004ebe6c - param_1 * FLOAT_004ebe4c;
					Vector3F_004ebdec.z = Vector3F_004ebdec.z - param_1 * FLOAT_004ebe50;
					FLOAT_004ebe70 = FLOAT_004ebe70 - param_1 * FLOAT_004ebe50;
					if (fVar1 < 0.0) {
						if (FLOAT_004ebe68 >= 0.0) {
							Vector3F_004ebdec.x = Vector3F_004ebdec.x - FLOAT_004ebe68;
							Vector3F_004ebdec.y = Vector3F_004ebdec.y - FLOAT_004ebe6c;
							Vector3F_004ebdec.z = Vector3F_004ebdec.z - FLOAT_004ebe70;
							FLAGS_004ebec8 = FLAGS_004ebec8 & 0xffffffd7;
							return;
						}
					}
					else {
						if ((ushort)((ushort)(FLOAT_004ebe68 < 0.0) << 8 |
												(ushort)(FLOAT_004ebe68 == 0.0) << 0xe) != 0) {
							Vector3F_004ebdec.x = Vector3F_004ebdec.x - FLOAT_004ebe68;
							Vector3F_004ebdec.y = Vector3F_004ebdec.y - FLOAT_004ebe6c;
							Vector3F_004ebdec.z = Vector3F_004ebdec.z - FLOAT_004ebe70;
							FLAGS_004ebec8 = FLAGS_004ebec8 & 0xffffffd7;
							return;
						}
					}
				}
			}
			else {
				fVar1 = param_1 * FLOAT_004ebe48;
				Vector3F_004ebdec.x = fVar1 + Vector3F_004ebdec.x;
				Vector3F_004ebdec.y = param_1 * FLOAT_004ebe4c + Vector3F_004ebdec.y;
				Vector3F_004ebdec.z = param_1 * FLOAT_004ebe50 + Vector3F_004ebdec.z;
				FLOAT_004ebe68 = fVar1 + FLOAT_004ebe68;
				FLOAT_004ebe6c = param_1 * FLOAT_004ebe4c + FLOAT_004ebe6c;
				FLOAT_004ebe70 = param_1 * FLOAT_004ebe50 + FLOAT_004ebe70;
				if (fVar1 < 0.0) {
					if ((ushort)((ushort)(FLOAT_004ebe68 < FLOAT_004ebe18) << 8 |
											(ushort)(FLOAT_004ebe68 == FLOAT_004ebe18) << 0xe) != 0) {
						Vector3F_004ebdec.x = (FLOAT_004ebe18 - FLOAT_004ebe68) + Vector3F_004ebdec.x;
						Vector3F_004ebdec.y = (FLOAT_004ebe1c - FLOAT_004ebe6c) + Vector3F_004ebdec.y;
						Vector3F_004ebdec.z = (FLOAT_004ebe20 - FLOAT_004ebe70) + Vector3F_004ebdec.z;
						FLAGS_004ebec8 = FLAGS_004ebec8 & 0xffffffef;
						return;
					}
				}
				else {
					if (FLOAT_004ebe68 >= FLOAT_004ebe18) {
						Vector3F_004ebdec.x = Vector3F_004ebdec.x - (FLOAT_004ebe68 - FLOAT_004ebe18);
						Vector3F_004ebdec.y = Vector3F_004ebdec.y - (FLOAT_004ebe6c - FLOAT_004ebe1c);
						Vector3F_004ebdec.z = Vector3F_004ebdec.z - (FLOAT_004ebe70 - FLOAT_004ebe20);
						FLAGS_004ebec8 = FLAGS_004ebec8 & 0xffffffef;
						return;
					}
				}
			}
		}
	}
	return;
}



void FUN_0044d9d0(void)
{
	float10 fVar1;
	
	fVar1 = lego::game::Game_ChooseRandomRange
										(lego::globals::g_RandomRangeForFadeTimeFade_min,
										 lego::globals::g_RandomRangeForFadeTimeFade_max);
	FLOAT_004ebe48 = (float)((float10)FLOAT_004ebe18 / fVar1);
	FLOAT_004ebe4c = (float)((float10)FLOAT_004ebe1c / fVar1);
	FLOAT_004ebe50 = (float)((float10)FLOAT_004ebe20 / fVar1);
	return;
}



void __cdecl FUN_0044da20(float param_1)
{
	bool bVar1;
	float fVar2;
	int iVar3;
	float10 fVar4;
	float local_18;
	float local_14;
	float local_10;
	Vector3F local_c;
	
	bVar1 = false;
	if ((FLAGS_004ebec8 & 0x40) == 0) {
		return;
	}
	if ((FLAGS_004ebec8 & 0x80) == 0) {
		FLOAT_004ebe8c = FLOAT_004ebe8c - param_1;
		if ((ushort)((ushort)(FLOAT_004ebe8c < 0.0) << 8 | (ushort)(FLOAT_004ebe8c == 0.0) << 0xe) == 0)
		{
			return;
		}
		fVar4 = lego::game::Game_ChooseRandomRange
											(lego::globals::g_RandomRangeForTimeBetweenMoves_min,
											 lego::globals::g_RandomRangeForTimeBetweenMoves_max);
		FLOAT_004ebe8c = (float)fVar4;
		fVar4 = lego::game::Game_ChooseRandomRange
											(lego::globals::g_RandomRangeForSpeedOfMove_min,
											 lego::globals::g_RandomRangeForSpeedOfMove_max);
		FLOAT_004ebe98 = (float)fVar4;
		fVar4 = lego::game::Game_ChooseRandomRange
											(lego::globals::g_RandomRangeForDistOfMove_min,
											 lego::globals::g_RandomRangeForDistOfMove_max);
		FLOAT_004ebeb0 = (float)fVar4;
		lego::math::Vector3_Random((Vector3F *)&FLOAT_004ebea4);
		fVar2 = 1.0 / SQRT(FLOAT_004ebeac * FLOAT_004ebeac +
											 FLOAT_004ebea8 * FLOAT_004ebea8 + FLOAT_004ebea4 * FLOAT_004ebea4);
		FLOAT_004ebea4 = fVar2 * FLOAT_004ebea4 * FLOAT_004ebe98;
		FLOAT_004ebea8 = fVar2 * FLOAT_004ebea8 * FLOAT_004ebe98;
		FLOAT_004ebeac = fVar2 * FLOAT_004ebeac * FLOAT_004ebe98;
		FLAGS_004ebec8 = FLAGS_004ebec8 | 0x80;
		return;
	}
	lego::res::Res_GetPosition(RESDATA_004ebdd8,RESDATA_004ebddc,&local_c);
	local_18 = local_c.x + FLOAT_004ebea4;
	local_14 = local_c.y + FLOAT_004ebea8;
	local_10 = local_c.z + FLOAT_004ebeac;
	iVar3 = FUN_0044dc60(&local_18);
	if (iVar3 == 0) {
		local_18 = local_c.x - FLOAT_004ebea4;
		local_14 = local_c.y - FLOAT_004ebea8;
		local_10 = local_c.z - FLOAT_004ebeac;
		iVar3 = FUN_0044dc60(&local_18);
		if (iVar3 == 0) goto LAB_0044dae5;
	}
	bVar1 = true;
LAB_0044dae5:
	if (!bVar1) {
		FLAGS_004ebec8 = FLAGS_004ebec8 & 0xffffff7f;
		return;
	}
	lego::res::Res_SetFramePosition(RESDATA_004ebdd8,RESDATA_004ebddc,local_18,local_14,local_10);
	FLOAT_004ebeb0 = FLOAT_004ebeb0 - FLOAT_004ebe98;
	if ((ushort)((ushort)(FLOAT_004ebeb0 < 0.0) << 8 | (ushort)(FLOAT_004ebeb0 == 0.0) << 0xe) == 0) {
		return;
	}
	FLAGS_004ebec8 = FLAGS_004ebec8 & 0xffffff7f;
	return;
}



undefined4 __cdecl FUN_0044dc60(float *param_1)
{
	if ((ushort)((ushort)(ABS(*param_1 - Vector3F_004ebe74.x) < lego::globals::g_MoveLimit_Vector.x)
							 << 8 | (ushort)(ABS(*param_1 - Vector3F_004ebe74.x) ==
															lego::globals::g_MoveLimit_Vector.x) << 0xe) == 0) {
		return 0;
	}
	if ((ushort)((ushort)(ABS(param_1[1] - Vector3F_004ebe74.y) < lego::globals::g_MoveLimit_Vector.y)
							 << 8 | (ushort)(ABS(param_1[1] - Vector3F_004ebe74.y) ==
															lego::globals::g_MoveLimit_Vector.y) << 0xe) == 0) {
		return 0;
	}
	if ((ushort)((ushort)(ABS(param_1[2] - Vector3F_004ebe74.z) < lego::globals::g_MoveLimit_Vector.z)
							 << 8 | (ushort)(ABS(param_1[2] - Vector3F_004ebe74.z) ==
															lego::globals::g_MoveLimit_Vector.z) << 0xe) == 0) {
		return 0;
	}
	return 1;
}



void __cdecl FUN_0044dce0(int param_1)
{
	if (param_1 != 0) {
		FLAGS_004ebec8 = FLAGS_004ebec8 & 0xfffffbff | 0x200;
		return;
	}
	FLAGS_004ebec8 = FLAGS_004ebec8 & 0xffffedff;
	return;
}



void __cdecl FUN_0044dd10(float param_1)
{
	float fVar1;
	
	if ((FLAGS_004ebec8 & 0x200) == 0) {
		if ((FLAGS_004ebec8 & 0x400) == 0) {
			fVar1 = param_1 * 0.1;
			Vector3F_004ebdec.x = fVar1 + Vector3F_004ebdec.x;
			Vector3F_004ebdec.y = fVar1 + Vector3F_004ebdec.y;
			Vector3F_004ebdec.z = fVar1 + Vector3F_004ebdec.z;
			if (Vector3F_004ebde0.x <= Vector3F_004ebdec.x) {
				FLAGS_004ebec8 |= 0x400;
				Vector3F_004ebdec.x = Vector3F_004ebde0.z;
			}
		}
	}
	else {
		if ((FLAGS_004ebec8 & 0x1000) != 0) {
			Vector3F_004ebdec.x = 0.0;
			Vector3F_004ebdec.y = 0.0;
			Vector3F_004ebdec.z = 0.0;
			return;
		}
		fVar1 = param_1 * 0.1;
		Vector3F_004ebdec.x = Vector3F_004ebdec.x - fVar1;
		Vector3F_004ebdec.y = Vector3F_004ebdec.y - fVar1;
		Vector3F_004ebdec.z = Vector3F_004ebdec.z - fVar1;
		if ((ushort)((ushort)(Vector3F_004ebdec.x < 0.0) << 8 |
								(ushort)(Vector3F_004ebdec.x == 0.0) << 0xe) != 0) {
			Vector3F_004ebdec.x = 0.0;
			FLAGS_004ebec8 = FLAGS_004ebec8 | 0x1000;
			return;
		}
	}
	return;
}



void __cdecl
lego::main::Main_LoadLoadScreen
					(char *loadScreen,char *shutdownScreen,ImageFont *font5HI,char *profileFilename,
					Direction progressDirection,char *progressBar,Rect2F *progressArea,char *loadingText)
{
	char cVar1;
	char *pcVar2;
	undefined4 *puVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	FileStream *file;
	LoaderProfileItem *pLVar7;
	undefined4 *puVar8;
	ImageBMP **ppIVar9;
	char *pcVar10;
	char *local_128;
	char *local_124;
	char local_100 [256];
	
	file = NULL;
	ppIVar9 = &globals::g_LoadScreen_bmp;
	for (iVar4 = 0xa4; iVar4 != 0; iVar4 += -1) {
		*ppIVar9 = NULL;
		ppIVar9 = ppIVar9 + 1;
	}
	globals::g_LoadScreen_bmp = image::Image_LoadBMP(loadScreen,0,0);
	globals::g_ShutdownScreen_bmp = image::Image_LoadBMP(shutdownScreen,0,0);
	globals::g_LoadScreen_Font = font5HI;
	globals::g_LoaderProfileItems_LAST = NULL;
	globals::g_ProgressBar_bmp = image::Image_LoadBMP(progressBar,0,0);
	globals::g_LoadScreen_ProgressArea.x = progressArea->x;
	globals::g_LoadScreen_ProgressArea.y = progressArea->y;
	globals::g_LoadScreen_ProgressArea.width = progressArea->width;
	globals::g_LoadScreen_ProgressArea.height = progressArea->height;
	globals::g_LoadScreen_ProgressDirection = progressDirection;
	if (loadingText == NULL) {
		globals::g_LoadingText = NULL;
	}
	else {
		pcVar2 = std::_strdup(loadingText);
		cVar1 = *pcVar2;
		globals::g_LoadingText = pcVar2;
		while (cVar1 != '\0') {
			if (cVar1 == '_') {
				*pcVar2 = ' ';
			}
			pcVar10 = pcVar2 + 1;
			pcVar2 = pcVar2 + 1;
			cVar1 = *pcVar10;
		}
		FUN_00401bc0(font5HI,&DAT_00557084,NULL,(byte *)"%s",loadingText);
	}
	if (profileFilename != NULL) {
		file = lego::file::File_Open(profileFilename,"r");
	}
	pLVar7 = globals::g_LoaderProfileItems_TABLE;
	do {
		if (((file == NULL) || (pcVar2 = lego::file::File_GetS(local_100,0x100,file), pcVar2 == NULL))
			 || (iVar4 = util::stringSplit(local_100,&local_128,"="), iVar4 != 2)) {
			pLVar7->name = NULL;
		}
		else {
			uVar5 = 0xffffffff;
			pcVar2 = local_128;
			do {
				if (uVar5 == 0) break;
				uVar5 -= 1;
				cVar1 = *pcVar2;
				pcVar2 = pcVar2 + 1;
			} while (cVar1 != '\0');
			puVar3 = (undefined4 *)std::malloc(~uVar5);
			uVar5 = 0xffffffff;
			pLVar7->name = (char *)puVar3;
			pcVar2 = local_128;
			do {
				pcVar10 = pcVar2;
				if (uVar5 == 0) break;
				uVar5 -= 1;
				pcVar10 = pcVar2 + 1;
				cVar1 = *pcVar2;
				pcVar2 = pcVar10;
			} while (cVar1 != '\0');
			uVar5 = ~uVar5;
			puVar8 = (undefined4 *)(pcVar10 + -uVar5);
			for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
				*puVar3 = *puVar8;
				puVar8 = puVar8 + 1;
				puVar3 = puVar3 + 1;
			}
			for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
				*(undefined *)puVar3 = *(undefined *)puVar8;
				puVar8 = (undefined4 *)((int)puVar8 + 1);
				puVar3 = (undefined4 *)((int)puVar3 + 1);
			}
			iVar4 = std::atoi(local_124);
			pLVar7->field_8 = iVar4;
			pLVar7->field_4 = 0;
		}
		pLVar7 = pLVar7 + 1;
		if ((LoaderProfileItem *)((int)&globals::g_LoaderProfileItems_TABLE[0x31].field_8 + 3U) < pLVar7
			 ) {
			if (file != NULL) {
				lego::file::File_Close(file);
			}
			lego::file::File_SetOpenCallback(lego::file::File_funcPtrCallback__0044e180,NULL);
			return;
		}
	} while( true );
}



void __cdecl lego::file::Log_LoaderProfile(char *filename)
{
	FileStream *file;
	int iVar1;
	LoaderProfileItem *pLVar2;
	
	if (filename == NULL) {
		file = NULL;
	}
	else {
		file = File_Open(filename,"w");
	}
	pLVar2 = globals::g_LoaderProfileItems_TABLE;
	do {
		if (pLVar2->name != NULL) {
			iVar1 = pLVar2->field_4;
			if (iVar1 == 0) {
				iVar1 = pLVar2->field_8;
			}
			if (file != NULL) {
				File_PrintF(file,"%s%s%i\n",pLVar2->name,"=",iVar1);
			}
			std::free(pLVar2->name);
		}
		pLVar2 = pLVar2 + 1;
	} while (pLVar2 < &globals::g_LoaderProfileItems_LAST);
	if (file != NULL) {
		File_Close(file);
	}
	pool::ReservedPool_ImageBMP___Release(globals::g_LoadScreen_bmp);
	if (globals::g_ShutdownScreen_bmp != NULL) {
		pool::ReservedPool_ImageBMP___Release(globals::g_ShutdownScreen_bmp);
	}
	return;
}



void __cdecl lego::main::LoaderProfile_Lookup(char *itemName)
{
	char cVar1;
	int iVar2;
	undefined4 *puVar3;
	uint uVar4;
	uint uVar5;
	LoaderProfileItem *pLVar6;
	LoaderProfileItem *pLVar7;
	LoaderProfileItem *pLVar8;
	undefined4 *puVar9;
	int iVar10;
	char *pcVar11;
	
	if (itemName == NULL) {
		globals::g_LoaderProfileFlags = globals::g_LoaderProfileFlags & 0xfffffffe;
		return;
	}
	iVar10 = 0;
	pLVar8 = globals::g_LoaderProfileItems_TABLE;
	pLVar6 = NULL;
	do {
		pLVar7 = pLVar8;
		if ((pLVar8->name != NULL) &&
			 (iVar2 = std::_stricmp(pLVar8->name,itemName), pLVar7 = pLVar6, iVar2 == 0)) {
			globals::g_LoaderProfileItems_LAST = globals::g_LoaderProfileItems_TABLE + iVar10;
			globals::g_LoaderProfileItems_TABLE[iVar10].field_4 = 0;
			break;
		}
		pLVar8 = pLVar8 + 1;
		iVar10 += 1;
		pLVar6 = pLVar7;
	} while (pLVar8 < &globals::g_LoaderProfileItems_LAST);
	if ((iVar10 == 0x32) && (pLVar7 != NULL)) {
		uVar4 = 0xffffffff;
		pcVar11 = itemName;
		do {
			if (uVar4 == 0) break;
			uVar4 -= 1;
			cVar1 = *pcVar11;
			pcVar11 = pcVar11 + 1;
		} while (cVar1 != '\0');
		puVar3 = (undefined4 *)std::malloc(~uVar4);
		uVar4 = 0xffffffff;
		pLVar7->name = (char *)puVar3;
		do {
			pcVar11 = itemName;
			if (uVar4 == 0) break;
			uVar4 -= 1;
			pcVar11 = itemName + 1;
			cVar1 = *itemName;
			itemName = pcVar11;
		} while (cVar1 != '\0');
		uVar4 = ~uVar4;
		puVar9 = (undefined4 *)(pcVar11 + -uVar4);
		for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
			*puVar3 = *puVar9;
			puVar9 = puVar9 + 1;
			puVar3 = puVar3 + 1;
		}
		for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
			*(undefined *)puVar3 = *(undefined *)puVar9;
			puVar9 = (undefined4 *)((int)puVar9 + 1);
			puVar3 = (undefined4 *)((int)puVar3 + 1);
		}
		pLVar7->field_4 = 0;
		pLVar7->field_8 = 0;
		globals::g_LoaderProfileItems_LAST = pLVar7;
	}
	globals::g_LoaderProfileFlags |= 1;
	FLOAT_00557088 = -1.0;
	lego::file::File_funcPtrCallback__0044e180(NULL,0,NULL);
	return;
}



void __cdecl lego::file::File_funcPtrCallback__0044e180(char *filename,int fileSize,void *lpValue)
{
	float fVar1;
	int iVar2;
	longlong lVar3;
	char *format;
	char *pcVar4;
	float local_10;
	float local_c;
	float local_8;
	float fStack4;
	
	if (((byte)globals::g_LoaderProfileFlags & 1) != 0) {
		if (((globals::g_LoaderProfileItems_LAST == NULL) ||
				(globals::g_LoaderProfileItems_LAST->field_4 =
							globals::g_LoaderProfileItems_LAST->field_4 + fileSize,
				globals::g_LoaderProfileItems_LAST == NULL)) ||
			 (globals::g_LoaderProfileItems_LAST->field_8 == 0)) {
			fileSize = 0;
		}
		else {
			fileSize = (int)((float)(ulonglong)(uint)globals::g_LoaderProfileItems_LAST->field_4 /
											(float)globals::g_LoaderProfileItems_LAST->field_8);
		}
		if ((ushort)((ushort)((float)fileSize < FLOAT_00557088 - -0.002) << 8 |
								(ushort)((float)fileSize == FLOAT_00557088 - -0.002) << 0xe) == 0) {
			fStack4 = globals::g_LoadScreen_ProgressArea.y;
			local_8 = globals::g_LoadScreen_ProgressArea.x;
			local_10 = globals::g_LoadScreen_ProgressArea.width;
			local_c = globals::g_LoadScreen_ProgressArea.height;
			image::Image_Blt__0047df70(globals::g_LoadScreen_bmp,NULL,NULL,NULL);
			if ((ushort)((ushort)((float)fileSize < 1.0) << 8 | (ushort)((float)fileSize == 1.0) << 0xe)
					== 0) {
				fileSize = 1065353216;
			}
			switch(globals::g_LoadScreen_ProgressDirection) {
			case DIRECTION_UP:
				fVar1 = local_c + fStack4;
				fStack4 = fVar1 - local_c * (float)fileSize;
				local_c = fVar1 - fStack4;
				break;
			case DIRECTION_RIGHT:
				local_10 = local_10 * (float)fileSize;
				break;
			case DIRECTION_DOWN:
				local_c = local_c * (float)fileSize;
				break;
			case DIRECTION_LEFT:
				fVar1 = local_10 + local_8;
				local_8 = fVar1 - local_10 * (float)fileSize;
				local_10 = fVar1 - local_8;
			}
			if (globals::g_ProgressBar_bmp != NULL) {
				image::Image_Blt__0047df70(globals::g_ProgressBar_bmp,NULL,&local_8,&local_10);
			}
			if (globals::g_LoadingText != NULL) {
				format = "%s";
				pcVar4 = globals::g_LoadingText;
				lVar3 = __ftol((float10)globals::g_LoadScreen_ProgressArea.y);
				iVar2 = (int)lVar3 + -1;
				lVar3 = __ftol((float10)globals::g_LoadScreen_ProgressArea.width * (float10)0.5 +
											 (float10)globals::g_LoadScreen_ProgressArea.x);
				FUN_0047a440(globals::g_LoadScreen_Font,(int)lVar3 - (DAT_00557084 >> 1),iVar2,format,pcVar4
										);
			}
			main::Main_UpdateAndRender__004781f0(0);
			FLOAT_00557088 = (float)fileSize;
		}
	}
	return;
}



void __cdecl lego::main::Main_ShowShutdownScreen(void)
{
	if (globals::g_ShutdownScreen_bmp != NULL) {
		image::Image_Blt__0047df70(globals::g_ShutdownScreen_bmp,NULL,NULL,NULL);
		draw::Draw_Render();
		return;
	}
	return;
}



LevelSurfaceMap * __cdecl
lego::game::Level_CreatureSurfaceMap
					(ResourceData *in_resData,char *filename,float blockSize,float roughLevel)
{
	Size2I *out_width;
	float *pfVar1;
	int iVar2;
	MapFileInfo *mapFileInfo;
	LevelSurfaceMap *buffer;
	uint uVar3;
	int *piVar4;
	SurfaceMapStruct38 *pSVar5;
	ResourceData *pRVar6;
	void *pvVar7;
	uint uVar8;
	int iVar9;
	uint uVar10;
	SurfaceMapStruct38 *pSVar11;
	undefined4 *puVar12;
	uint uVar13;
	float10 fVar14;
	float10 fVar15;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	uVar10 = 0;
	mapFileInfo = (MapFileInfo *)lego::file::File_ReadAllBytes(filename,NULL);
	if (mapFileInfo != NULL) {
		buffer = (LevelSurfaceMap *)std::malloc(0x73d4);
		if (buffer != NULL) {
			piVar4 = &(buffer->dimensions).height;
			out_width = &buffer->dimensions;
			buffer->BlockSize = blockSize;
			buffer->RoughLevel = roughLevel;
			MapFile_GetDimensions(mapFileInfo,(int *)out_width,piVar4);
			uVar3 = out_width->width - 1;
			uVar8 = *piVar4 - 1;
			(buffer->smallDimensions).width = uVar3;
			(buffer->smallDimensions).height = uVar8;
			(buffer->blockDimensions_neg).width = -((float)(ulonglong)uVar3 * blockSize * 0.5);
			buffer->field_2c = 0;
			(buffer->blockDimensions_neg).height = (float)(ulonglong)uVar8 * blockSize * 0.5;
			puVar12 = buffer->flat_4034;
			for (iVar9 = 0x20; iVar9 != 0; iVar9 += -1) {
				*puVar12 = 0;
				puVar12 = puVar12 + 1;
			}
			buffer->field_73d0 = 0;
			buffer->count_4a84 = 0;
			buffer->field_7198 = 0;
			buffer->float_20 = 0.0;
			piVar4 = FUN_00489780(1.0,1.0,1.0,0,0,0,0);
			pSVar5 = buffer->table38_719c;
			buffer->field_30 = piVar4;
			pSVar11 = pSVar5;
			for (iVar9 = 0x8c; iVar9 != 0; iVar9 += -1) {
				pSVar11->field_0 = 0;
				pSVar11 = (SurfaceMapStruct38 *)&pSVar11->float_4;
			}
			puVar12 = buffer->flat_40b4;
			for (iVar9 = 0x80; iVar9 != 0; iVar9 += -1) {
				*puVar12 = 0;
				puVar12 = puVar12 + 1;
			}
			iVar9 = 10;
			do {
				pSVar5->field_0 = 0xffffffff;
				pSVar5 = pSVar5 + 1;
				iVar9 += -1;
			} while (iVar9 != 0);
			pRVar6 = res::Res_Unk_LoadVisualMesh(in_resData,3);
			buffer->resData_73cc = pRVar6;
			pRVar6 = res::Res_Unk_LoadVisualMesh(in_resData,2);
			buffer->resData_24 = pRVar6;
			if (pRVar6 != NULL) {
				pvVar7 = std::malloc(out_width->width * (buffer->dimensions).height * 0x28);
				buffer->field_28 = pvVar7;
				if (pvVar7 != NULL) {
					local_18 = 0;
					local_14 = 1;
					local_10 = 3;
					local_c = 1;
					local_8 = 2;
					local_4 = 3;
					if ((buffer->smallDimensions).width * (buffer->smallDimensions).height != 0) {
						do {
							piVar4 = FUN_00474bb0(buffer->resData_24,4,2,3,(undefined2 *)&local_18);
							FUN_00474df0(buffer->resData_24,(int)piVar4,1);
							res::Res_SetMeshGroupQuality
												(buffer->resData_24,(D3DRMRenderQuality)piVar4,QUALITY_GOURAUD);
							uVar10 += 1;
						} while (uVar10 < (uint)((buffer->smallDimensions).width *
																		(buffer->smallDimensions).height));
					}
					uVar10 = 0;
					if ((buffer->dimensions).height != 0) {
						do {
							uVar8 = out_width->width;
							uVar3 = 0;
							if (uVar8 != 0) {
								do {
									*(undefined *)(buffer->field_28 + 0x19 + (uVar10 * uVar8 + uVar3) * 0x28) = 0x60;
									*(undefined *)
									 (buffer->field_28 + 0x18 + (uVar10 * out_width->width + uVar3) * 0x28) = 0;
									iVar9 = out_width->width;
									iVar2 = buffer->field_28;
									uVar8 = FUN_00451880((int)mapFileInfo,uVar3,uVar10,iVar9);
									*(char *)(iVar2 + (uVar10 * iVar9 + uVar3) * 0x28 + 0x1a) = (char)uVar8;
									pfVar1 = (float *)(buffer->field_28 + 0x1c +
																		(uVar10 * out_width->width + uVar3) * 0x28);
									fVar14 = Game_ChooseRandomRange(0.0,1.0);
									*pfVar1 = (float)fVar14;
									fVar14 = Game_ChooseRandomRange(0.0,1.0);
									fVar15 = (float10)1.0 /
													 SQRT((float10)*pfVar1 * (float10)*pfVar1 + fVar14 * fVar14);
									*pfVar1 = (float)(fVar15 * (float10)*pfVar1);
									pfVar1[1] = (float)(fVar15 * fVar14);
									iVar9 = uVar10 * out_width->width + uVar3;
									pfVar1 = (float *)(buffer->field_28 + 0x1c + iVar9 * 0x28);
									*pfVar1 = *(float *)(buffer->field_28 + 0x1c + iVar9 * 0x28) * 0.3;
									pfVar1[1] = pfVar1[1] * 0.3;
									iVar9 = uVar10 * out_width->width + uVar3;
									uVar3 += 1;
									*(undefined *)(buffer->field_28 + 0x24 + iVar9 * 0x28) = 0;
									uVar8 = out_width->width;
								} while (uVar3 < uVar8);
							}
							uVar10 += 1;
						} while (uVar10 < (uint)(buffer->dimensions).height);
					}
					FUN_0044e790((uint *)buffer);
					filename = NULL;
					if ((buffer->smallDimensions).height != 0) {
						do {
							blockSize = 0.0;
							if ((buffer->smallDimensions).width != 0) {
								do {
									iVar9 = buffer->field_28 +
													((int)filename * out_width->width + (int)blockSize) * 0x28;
									iVar2 = buffer->field_28 +
													((int)(filename + 1) * out_width->width + (int)blockSize) * 0x28;
									uVar10 = (uint)*(byte *)(iVar9 + 0x1a) - (uint)*(byte *)(iVar2 + 0x42);
									uVar13 = (uint)*(byte *)(iVar9 + 0x42) - (uint)*(byte *)(iVar2 + 0x1a);
									uVar8 = (int)uVar10 >> 0x1f;
									uVar3 = (int)uVar13 >> 0x1f;
									if ((uVar10 ^ uVar8) - uVar8 < (uVar13 ^ uVar3) - uVar3) {
										FUN_0044f0b0((uint *)buffer,(uint)blockSize,(uint)filename,1);
									}
									else {
										FUN_004517b0((uint *)buffer,(uint)blockSize,(uint)filename);
									}
									blockSize = (float)((int)blockSize + 1);
								} while ((uint)blockSize < (uint)(buffer->smallDimensions).width);
							}
							filename = filename + 1;
						} while (filename < (char *)(buffer->smallDimensions).height);
					}
					std::free(mapFileInfo);
					return buffer;
				}
				pool::ReservedPool_ResourceData___Release(buffer->resData_24);
			}
			std::free(buffer);
		}
		std::free(mapFileInfo);
	}
	return NULL;
}



void __cdecl FUN_0044e790(uint *param_1)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	uint uVar6;
	float *pfVar7;
	float *pfVar8;
	float10 fVar9;
	float10 extraout_ST0;
	longlong lVar10;
	longlong lVar11;
	uint local_d8;
	uint local_d4;
	int local_d0;
	float local_b0 [5];
	undefined4 local_9c;
	undefined4 local_98;
	undefined4 local_94;
	undefined local_90 [4];
	float local_8c [35];
	
	local_b0[0] = 0.0;
	fVar5 = (float)param_1[5];
	local_b0[1] = 0.0;
	local_b0[2] = 1.0;
	local_b0[3] = 0.0;
	local_b0[4] = 1.0;
	local_9c = 0x3f800000;
	local_98 = 0;
	local_94 = 0x3f800000;
	local_d8 = 0;
	if (param_1[1] != 0) {
		do {
			local_d4 = 0;
			if (*param_1 != 0) {
				do {
					pfVar7 = local_b0;
					fVar9 = (float10)(ulonglong)local_d4;
					pfVar8 = local_8c;
					local_d0 = 4;
					do {
						fVar1 = pfVar7[1];
						fVar2 = (float)param_1[4];
						fVar3 = pfVar7[1];
						fVar4 = (float)param_1[7];
						pfVar8[-1] = (float)((fVar9 + (float10)*pfVar7) * (float10)(float)param_1[4] +
																(float10)(float)param_1[6]);
						*pfVar8 = fVar4 - (fVar1 + (float)(ulonglong)local_d8) * fVar2;
						lVar10 = __ftol((float10)fVar3);
						uVar6 = param_1[2];
						lVar11 = __ftol((float10)*pfVar7);
						fVar2 = -((float)(uint)*(byte *)(param_1[10] + 0x1a +
																						((local_d8 + (int)lVar10) * uVar6 + local_d4 +
																						(int)lVar11) * 0x28) * fVar5);
						fVar1 = (float)param_1[8];
						pfVar8[1] = fVar2;
						if (fVar2 < fVar1) {
							param_1[8] = (uint)fVar2;
						}
						pfVar7 = pfVar7 + 2;
						pfVar8 = pfVar8 + 9;
						local_d0 += -1;
						fVar9 = extraout_ST0;
					} while (local_d0 != 0);
					FUN_00474ff0((int *)param_1[9],local_d8 * *param_1 + local_d4,0,4,(int)local_90);
					local_d4 += 1;
				} while (local_d4 < *param_1);
			}
			local_d8 += 1;
		} while (local_d8 < param_1[1]);
	}
	return;
}



void __thiscall FUN_0044e930(void *this,undefined *param_1)
{
	lego::pool::ReservedPool_ResourceData___Release(*(ResourceData **)(param_1 + 0x24));
	lego::pool::ReservedPool_ResourceData___Release(*(ResourceData **)(param_1 + 0x73cc));
	std::free(*(void **)(param_1 + 0x28));
	std::free(param_1);
	return;
}



void __cdecl FUN_0044e970(LevelSurfaceMap *param_1,uint param_2)
{
	param_1->flat_40b4[param_2 & 0xff] = 1;
	return;
}



void __cdecl
lego::game::Level_FadeInBlock
					(LevelSurfaceMap *surfaceMap,int *param_2,int *param_3,uint param_4,uint param_5)
{
	byte bVar1;
	uint uVar2;
	int *piVar3;
	int **ppiVar4;
	undefined **ppuVar5;
	int **ppiVar6;
	int iVar7;
	SurfaceMapStruct38 *pSVar8;
	undefined4 local_a8;
	undefined4 local_a4;
	undefined4 local_a0;
	undefined4 local_9c;
	undefined4 local_98;
	undefined4 local_94;
	undefined local_90 [28];
	int *local_74 [29];
	
	local_a4 = 1;
	local_9c = 1;
	iVar7 = (surfaceMap->smallDimensions).width;
	local_a8 = 0;
	local_a0 = 3;
	local_98 = 2;
	local_94 = 3;
	bVar1 = *(byte *)(surfaceMap->field_28 + 0x18 +
									 (int)((int)param_3 * (surfaceMap->dimensions).width + (int)param_2) * 0x28);
	if ((bVar1 != (byte)param_4) && (surfaceMap->flat_40b4[bVar1] == 0)) {
		uVar2 = 0;
		pSVar8 = surfaceMap->table38_719c;
		do {
			if ((*(byte *)&pSVar8->flags & 1) == 0) {
				if (pSVar8->field_0 == -1) {
					piVar3 = FUN_00474bb0(surfaceMap->resData_73cc,4,2,3,(undefined2 *)&local_a8);
					pSVar8->field_0 = piVar3;
				}
				else {
					FUN_00474df0(surfaceMap->resData_73cc,pSVar8->field_0,0);
				}
				FUN_00474f80(surfaceMap->resData_24,(int)((int)param_3 * iVar7 + (int)param_2),0,4,
										 (int)local_90);
				ppiVar6 = (int **)(pSVar8->table_10 + 1);
				iVar7 = 4;
				ppiVar4 = local_74;
				do {
					ppiVar6[-1] = ppiVar4[-1];
					*ppiVar6 = *ppiVar4;
					ppiVar6 = ppiVar6 + 2;
					iVar7 += -1;
					ppiVar4 = ppiVar4 + 9;
				} while (iVar7 != 0);
				ppuVar5 = (undefined **)
									FUN_0040b780((int *)surfaceMap->field_2c,
															 (uint)ppiVar6 & 0xffffff00 |
															 (uint)*(byte *)(surfaceMap->field_28 + 0x18 +
																							(int)((int)param_3 * (surfaceMap->dimensions).width +
																									 (int)param_2) * 0x28));
				FUN_00475060(surfaceMap->resData_73cc,pSVar8->field_0,ppuVar5);
				pSVar8->field_8 = param_2;
				pSVar8->field_c = param_3;
				pSVar8->float_4 = 0.05;
				pSVar8->flags = pSVar8->flags | 1;
				break;
			}
			uVar2 += 1;
			pSVar8 = pSVar8 + 1;
		} while (uVar2 < 10);
	}
	FUN_0044f4f0(surfaceMap,(uint)param_2,(uint)param_3,param_4,param_5);
	return;
}



void __cdecl FUN_0044eb20(LevelSurfaceMap *surfMap,int x,int y)
{
	FUN_00474da0(surfMap->resData_24,(surfMap->smallDimensions).width * y + x);
	return;
}



void __cdecl FUN_0044eb40(LevelSurfaceMap *param_1)
{
	uint uVar1;
	uint uVar2;
	
	uVar1 = 0;
	if ((param_1->dimensions).height != 0) {
		do {
			uVar2 = 0;
			if ((param_1->dimensions).width != 0) {
				do {
					FUN_004511f0((uint *)param_1,uVar2,uVar1);
					uVar2 += 1;
				} while (uVar2 < (uint)(param_1->dimensions).width);
			}
			uVar1 += 1;
		} while (uVar1 < (uint)(param_1->dimensions).height);
	}
	return;
}



undefined4 __cdecl
FUN_0044eb80(uint *param_1,uint *param_2,uint param_3,float param_4,float param_5)
{
	bool bVar1;
	int *piVar2;
	uint *puVar3;
	uint uVar4;
	float *pfVar5;
	float local_9c;
	float local_98;
	int local_90;
	uint local_8c;
	int local_80 [5];
	undefined4 local_6c;
	undefined4 local_68;
	undefined4 local_64;
	int local_60 [5];
	undefined4 local_4c;
	undefined4 local_48;
	undefined4 local_44;
	undefined4 local_40;
	undefined4 local_3c;
	undefined4 local_38;
	undefined4 local_34;
	undefined4 local_30 [2];
	float local_28 [10];
	
	local_4c = 3;
	local_3c = 3;
	local_34 = 3;
	local_80[0] = 0;
	local_80[1] = 0;
	local_80[2] = 1;
	local_80[3] = 0;
	local_80[4] = 1;
	local_6c = 1;
	local_68 = 0;
	local_64 = 1;
	local_60[0] = 0;
	local_60[1] = 1;
	local_60[2] = 0;
	local_60[3] = 2;
	local_60[4] = 0;
	local_48 = 1;
	local_44 = 2;
	local_40 = 1;
	local_38 = 2;
	bVar1 = false;
	local_98 = 10000.0;
	local_9c = -10000.0;
	local_8c = 0;
	if (param_3 != 0) {
		puVar3 = param_2 + 2;
		do {
			if (((local_8c == param_3 - 1) || (*param_2 != *puVar3)) || (param_2[1] != puVar3[1])) {
				FUN_00450390((LevelSurfaceMap *)param_1,*param_2,param_2[1],local_30);
				uVar4 = 0;
				piVar2 = local_60 + 1;
				do {
					if (param_5 < ABS(local_28[piVar2[-1] * 3] - local_28[*piVar2 * 3])) {
						return 0;
					}
					uVar4 += 1;
					piVar2 = piVar2 + 2;
				} while (uVar4 < 6);
				pfVar5 = local_28;
				piVar2 = local_80;
				local_90 = 4;
				do {
					if ((*(byte *)(param_1[10] + 0x19 +
												((piVar2[1] + param_2[1]) * param_1[2] + *piVar2 + *param_2) * 0x28) & 8) !=
							0) {
						if (*pfVar5 < local_98) {
							local_98 = *pfVar5;
						}
						if ((ushort)((ushort)(*pfVar5 < local_9c) << 8 | (ushort)(*pfVar5 == local_9c) << 0xe)
								== 0) {
							local_9c = *pfVar5;
						}
						bVar1 = true;
					}
					piVar2 = piVar2 + 2;
					pfVar5 = pfVar5 + 3;
					local_90 += -1;
				} while (local_90 != 0);
			}
			else {
				local_8c += 1;
				puVar3 = puVar3 + 2;
				param_2 = param_2 + 2;
			}
			local_8c += 1;
			puVar3 = puVar3 + 2;
			param_2 = param_2 + 2;
		} while (local_8c < param_3);
	}
	if ((bVar1) &&
		 ((ushort)((ushort)(local_9c - local_98 < param_4) << 8 |
							(ushort)(local_9c - local_98 == param_4) << 0xe) == 0)) {
		return 0;
	}
	return 1;
}



void __cdecl FUN_0044ed90(LevelSurfaceMap *param_1,uint *param_2,uint param_3,float param_4)
{
	int iVar1;
	float *pfVar2;
	int iVar3;
	float fVar4;
	float fVar5;
	int *piVar6;
	int iVar7;
	int *piVar8;
	uint *puVar9;
	uint uVar10;
	uint *puVar11;
	float local_230;
	int *local_22c;
	uint local_228;
	uint local_224;
	uint local_220;
	uint local_218;
	float local_214;
	undefined4 *local_210;
	int local_200 [5];
	undefined4 local_1ec;
	undefined4 local_1e8;
	undefined4 local_1e4;
	undefined4 local_1e0 [2];
	float afStack472 [118];
	
	fVar4 = param_4 * 0.5;
	local_200[2] = 1;
	local_200[4] = 1;
	local_1ec = 1;
	local_1e4 = 1;
	local_224 = 0;
	local_228 = 0;
	local_230 = 0.0;
	local_200[0] = 0;
	local_200[1] = 0;
	local_200[3] = 0;
	local_1e8 = 0;
	local_214 = 10000.0;
	local_22c = (int *)0xc61c4000;
	local_220 = 0;
	local_218 = 0;
	if (param_3 != 0) {
		local_210 = local_1e0;
		puVar9 = param_2 + 2;
		puVar11 = &DAT_004ebed0;
		do {
			if (((local_218 == param_3 - 1) || (*param_2 != *puVar9)) || (param_2[1] != puVar9[1])) {
				*puVar11 = *param_2;
				uVar10 = param_2[1];
				puVar11[1] = uVar10;
				FUN_00450390(param_1,*puVar11,uVar10,local_210);
				uVar10 = 0;
				piVar8 = local_200;
				do {
					iVar3 = uVar10 + local_220 * 4;
					if ((*(byte *)(param_1->field_28 + 0x19 +
												((piVar8[1] + puVar11[1]) * (param_1->dimensions).width + *puVar11 + *piVar8
												) * 0x28) & 8) == 0) {
						local_230 = afStack472[iVar3 * 3] + local_230;
						local_224 += 1;
					}
					else {
						pfVar2 = afStack472 + iVar3 * 3;
						if (afStack472[iVar3 * 3] < local_214) {
							local_214 = *pfVar2;
						}
						if ((ushort)((ushort)(*pfVar2 < (float)local_22c) << 8 |
												(ushort)(*pfVar2 == (float)local_22c) << 0xe) == 0) {
							local_22c = (int *)*pfVar2;
						}
						local_228 += 1;
					}
					uVar10 += 1;
					piVar8 = piVar8 + 2;
				} while (uVar10 < 4);
				local_220 += 1;
				local_210 = local_210 + 0xc;
				puVar11 = puVar11 + 2;
			}
			else {
				local_218 += 1;
				puVar9 = puVar9 + 2;
				param_2 = param_2 + 2;
			}
			local_218 += 1;
			puVar9 = puVar9 + 2;
			param_2 = param_2 + 2;
		} while (local_218 < param_3);
	}
	local_230 = local_230 / (float)(ulonglong)local_224;
	if (local_228 != 0) {
		if ((ushort)((ushort)(fVar4 + local_230 < (float)local_22c) << 8 |
								(ushort)(fVar4 + local_230 == (float)local_22c) << 0xe) == 0) {
			local_230 = (float)local_22c - fVar4;
		}
		if (local_230 - fVar4 < local_214) {
			local_230 = fVar4 + local_214;
		}
	}
	local_218 = 0;
	if (local_220 != 0) {
		local_22c = &DAT_004ebed0;
		do {
			local_228 = 0;
			piVar8 = local_22c + 1;
			piVar6 = local_200;
			do {
				iVar3 = piVar6[1];
				iVar7 = *piVar6;
				if ((*(byte *)(param_1->field_28 + 0x19 +
											((iVar3 + *piVar8) * (param_1->dimensions).width + *local_22c + iVar7) * 0x28)
						& 8) == 0) {
					iVar1 = local_228 + local_218 * 4;
					fVar5 = afStack472[iVar1 * 3] - local_230;
					if (fVar4 < ABS(fVar5)) {
						FUN_0044f640((uint *)param_1,*local_22c + iVar7,*piVar8 + iVar3,
												 ((fVar5 / fVar5) * fVar4 + local_230) - afStack472[iVar1 * 3]);
					}
					iVar7 = (*piVar8 + iVar3) * (param_1->dimensions).width + *local_22c + iVar7;
					*(byte *)(param_1->field_28 + 0x19 + iVar7 * 0x28) =
							 *(byte *)(param_1->field_28 + 0x19 + iVar7 * 0x28) | 8;
				}
				local_228 += 1;
				piVar6 = piVar6 + 2;
			} while (local_228 < 4);
			local_218 += 1;
			local_22c = local_22c + 2;
		} while (local_218 < local_220);
	}
	return;
}



void __cdecl FUN_0044f0b0(uint *param_1,uint param_2,uint param_3,int param_4)
{
	byte *pbVar1;
	byte bVar2;
	int iVar3;
	int iVar4;
	undefined4 *puVar5;
	undefined4 *puVar6;
	undefined4 local_b4 [9];
	undefined4 local_90 [9];
	undefined4 local_6c [9];
	undefined4 local_48 [9];
	undefined4 local_24 [9];
	
	if (((param_4 != 0) &&
			((*(byte *)(param_1[10] + 0x19 + (param_3 * param_1[2] + param_2) * 0x28) & 1) == 0)) ||
		 ((param_4 == 0 &&
			((*(byte *)(param_1[10] + 0x19 + (param_3 * param_1[2] + param_2) * 0x28) & 1) != 0)))) {
		iVar4 = *param_1 * param_3 + param_2;
		FUN_00474f80((ResourceData *)param_1[9],iVar4,0,4,(int)local_b4);
		iVar3 = param_3 * param_1[2] + param_2;
		bVar2 = *(byte *)(param_1[10] + 0x19 + iVar3 * 0x28);
		pbVar1 = (byte *)(param_1[10] + 0x19 + iVar3 * 0x28);
		if ((bVar2 & 1) == 0) {
			*pbVar1 = bVar2 | 1;
			puVar5 = local_48;
			puVar6 = local_24;
			for (iVar3 = 9; iVar3 != 0; iVar3 += -1) {
				*puVar6 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar6 = puVar6 + 1;
			}
			puVar5 = local_6c;
			puVar6 = local_48;
			for (iVar3 = 9; iVar3 != 0; iVar3 += -1) {
				*puVar6 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar6 = puVar6 + 1;
			}
			puVar5 = local_90;
			puVar6 = local_6c;
			for (iVar3 = 9; iVar3 != 0; iVar3 += -1) {
				*puVar6 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar6 = puVar6 + 1;
			}
			puVar5 = local_b4;
			puVar6 = local_90;
			for (iVar3 = 9; iVar3 != 0; iVar3 += -1) {
				*puVar6 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar6 = puVar6 + 1;
			}
			puVar5 = local_b4;
		}
		else {
			*pbVar1 = bVar2 & 0xfe;
			puVar5 = local_b4;
			puVar6 = local_24;
			for (iVar3 = 9; iVar3 != 0; iVar3 += -1) {
				*puVar6 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar6 = puVar6 + 1;
			}
			puVar5 = local_90;
			puVar6 = local_b4;
			for (iVar3 = 9; iVar3 != 0; iVar3 += -1) {
				*puVar6 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar6 = puVar6 + 1;
			}
			puVar5 = local_6c;
			puVar6 = local_90;
			for (iVar3 = 9; iVar3 != 0; iVar3 += -1) {
				*puVar6 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar6 = puVar6 + 1;
			}
			puVar5 = local_48;
			puVar6 = local_6c;
			for (iVar3 = 9; iVar3 != 0; iVar3 += -1) {
				*puVar6 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar6 = puVar6 + 1;
			}
			puVar5 = local_48;
		}
		puVar6 = local_24;
		for (iVar3 = 9; iVar3 != 0; iVar3 += -1) {
			*puVar5 = *puVar6;
			puVar6 = puVar6 + 1;
			puVar5 = puVar5 + 1;
		}
		FUN_00474ff0((int *)param_1[9],iVar4,0,4,(int)local_b4);
		FUN_004517b0(param_1,param_2,param_3);
		FUN_0044f270((int)param_1,param_2,param_3);
		FUN_0044f270((int)param_1,param_2 + 1,param_3);
		FUN_0044f270((int)param_1,param_2 + 1,param_3 + 1);
		FUN_0044f270((int)param_1,param_2,param_3 + 1);
	}
	return;
}



void __cdecl FUN_0044f270(int param_1,int param_2,int param_3)
{
	byte *pbVar1;
	
	pbVar1 = (byte *)(*(int *)(param_1 + 0x28) + 0x19 +
									 (*(int *)(param_1 + 8) * param_3 + param_2) * 0x28);
	*pbVar1 = *pbVar1 | 4;
	*(uint *)(param_1 + 0x73d0) = *(uint *)(param_1 + 0x73d0) | 2;
	return;
}



void __cdecl FUN_0044f2b0(uint *param_1,float param_2)
{
	int iVar1;
	uint uVar2;
	uint uVar3;
	uint uVar4;
	
	if ((*(byte *)(param_1 + 0x1cf4) & 2) != 0) {
		uVar3 = 0;
		if (param_1[3] != 0) {
			do {
				uVar2 = param_1[2];
				uVar4 = 0;
				if (uVar2 != 0) {
					do {
						if ((*(byte *)(param_1[10] + 0x19 + (uVar3 * uVar2 + uVar4) * 0x28) & 4) != 0) {
							FUN_004511f0(param_1,uVar4,uVar3);
							iVar1 = uVar3 * param_1[2] + uVar4;
							*(byte *)(param_1[10] + 0x19 + iVar1 * 0x28) =
									 *(byte *)(param_1[10] + 0x19 + iVar1 * 0x28) & 0xfb;
						}
						uVar2 = param_1[2];
						uVar4 += 1;
					} while (uVar4 < uVar2);
				}
				uVar3 += 1;
			} while (uVar3 < param_1[3]);
		}
		param_1[0x1cf4] = param_1[0x1cf4] & 0xfffffffd;
	}
	FUN_00450e20((int *)param_1,param_2);
	FUN_0044f350((int *)param_1,param_2);
	return;
}



void __cdecl FUN_0044f350(int *param_1,float param_2)
{
	float fVar1;
	int *piVar2;
	int *piVar3;
	int iVar4;
	int iVar5;
	int *piVar6;
	undefined local_90 [28];
	int local_74 [29];
	
	iVar5 = 10;
	piVar6 = param_1 + 0x1c6a;
	do {
		if ((*(byte *)(piVar6 + 10) & 1) != 0) {
			FUN_00474f80((ResourceData *)param_1[9],*param_1 * *piVar6 + piVar6[-1],0,4,(int)local_90);
			piVar3 = local_74;
			iVar4 = 4;
			piVar2 = piVar6;
			do {
				piVar3[-1] = piVar2[1];
				*piVar3 = piVar2[2];
				piVar3 = piVar3 + 9;
				iVar4 += -1;
				piVar2 = piVar2 + 2;
			} while (iVar4 != 0);
			FUN_00474ff0((int *)param_1[0x1cf3],piVar6[-3],0,4,(int)local_90);
			lego::res::Res_SetMeshColorMultiplier
								((ResourceData *)param_1[0x1cf3],piVar6[-3],1.0,1.0,1.0,1.0 - (float)piVar6[-2]);
			fVar1 = (float)piVar6[-2] - param_2 * -0.04;
			piVar6[-2] = (int)fVar1;
			if ((ushort)((ushort)(fVar1 < 1.0) << 8 | (ushort)(fVar1 == 1.0) << 0xe) == 0) {
				FUN_00474df0((ResourceData *)param_1[0x1cf3],piVar6[-3],1);
				piVar6[10] = piVar6[10] & 0xfffffffe;
			}
		}
		piVar6 = piVar6 + 0xe;
		iVar5 += -1;
	} while (iVar5 != 0);
	return;
}



void __cdecl FUN_0044f460(LevelSurfaceMap *param_1,byte param_2,byte param_3)
{
	char *pcVar1;
	uint uVar2;
	uint uVar3;
	uint uVar4;
	
	uVar2 = (uint)param_2;
	uVar4 = 0;
	uVar3 = (uint)*(byte *)((int)param_1->flat_4034 + uVar2);
	if (uVar3 != 0) {
		do {
			if (*(byte *)(&param_1->field_0x34 + uVar4 + uVar2 * 0x80) == param_3) {
				return;
			}
			uVar4 += 1;
		} while (uVar4 < uVar3);
	}
	*(byte *)(&param_1->field_0x34 + uVar3 + uVar2 * 0x80) = param_3;
	pcVar1 = (char *)((int)param_1->flat_4034 + uVar2);
	*pcVar1 = *pcVar1 + '\x01';
	uVar2 = (uint)param_3;
	*(byte *)(&param_1->field_0x34 + (uint)*(byte *)((int)param_1->flat_4034 + uVar2) + uVar2 * 0x80)
			 = param_2;
	*(char *)((int)param_1->flat_4034 + uVar2) = *(char *)((int)param_1->flat_4034 + uVar2) + '\x01';
	return;
}



void __cdecl FUN_0044f4e0(LevelSurfaceMap *param_1,undefined4 param_2)
{
	param_1->field_2c = param_2;
	return;
}



void __cdecl
FUN_0044f4f0(LevelSurfaceMap *param_1,uint param_2,uint param_3,uint param_4,uint param_5)
{
	byte bVar1;
	undefined **ppuVar2;
	uint uVar3;
	int iVar4;
	float *pfVar5;
	byte local_94 [4];
	undefined local_90 [28];
	float local_74 [29];
	
	uVar3 = (param_1->smallDimensions).width;
	if ((param_2 < uVar3) && (param_3 < (uint)(param_1->smallDimensions).height)) {
		iVar4 = param_3 * uVar3 + param_2;
		local_94[0] = 1;
		local_94[1] = 3;
		local_94[2] = 2;
		local_94[3] = 0;
		ppuVar2 = (undefined **)FUN_0040b780((int *)param_1->field_2c,param_4);
		*(undefined *)
		 (param_1->field_28 + 0x18 + (param_3 * (param_1->dimensions).width + param_2) * 0x28) =
				 (undefined)param_4;
		if ((*(byte *)(param_1->field_28 + 0x19 +
									(param_3 * (param_1->dimensions).width + param_2) * 0x28) & 1) != 0) {
			param_5 = (uint)(byte)((char)param_5 + 1);
		}
		FUN_00475060(param_1->resData_24,iVar4,ppuVar2);
		if ((*(byte *)(param_1->field_28 + 0x19 +
									(param_3 * (param_1->dimensions).width + param_2) * 0x28) & 0x10) == 0) {
			FUN_00474f80(param_1->resData_24,iVar4,0,4,(int)local_90);
			uVar3 = 0;
			pfVar5 = local_74;
			do {
				bVar1 = local_94[uVar3 - (param_5 & 0xff) & 3];
				uVar3 += 1;
				pfVar5[-1] = (float)(uint)(bVar1 >> 1);
				*pfVar5 = (float)(uint)(bVar1 & 1);
				pfVar5 = pfVar5 + 9;
			} while (uVar3 < 4);
			FUN_00474ff0((int *)param_1->resData_24,iVar4,0,4,(int)local_90);
		}
	}
	return;
}



void __cdecl FUN_0044f640(uint *param_1,uint param_2,uint param_3,undefined4 param_4)
{
	float *pfVar1;
	uint uVar2;
	int iVar3;
	uint uVar4;
	uint uVar5;
	longlong lVar6;
	float *pfVar7;
	float local_2c;
	undefined4 uStack40;
	undefined4 local_24;
	float local_20 [5];
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	uVar4 = 0;
	local_24 = param_4;
	local_20[0] = 0.0;
	local_20[1] = 0.0;
	local_20[2] = -1.0;
	local_20[3] = 0.0;
	local_20[4] = -1.0;
	local_c = 0xbf800000;
	local_8 = 0;
	local_4 = 0xbf800000;
	local_2c = 0.0;
	uStack40 = 0;
	iVar3 = 4;
	pfVar1 = local_20 + 1;
	do {
		iVar3 += -1;
		pfVar1[-1] = (float)(ulonglong)param_2 + pfVar1[-1];
		*pfVar1 = *pfVar1 + (float)(ulonglong)param_3;
		pfVar1 = pfVar1 + 2;
	} while (iVar3 != 0);
	pfVar1 = local_20;
	do {
		pfVar7 = &local_2c;
		uVar5 = uVar4;
		lVar6 = __ftol((float10)pfVar1[1]);
		uVar2 = (uint)lVar6;
		lVar6 = __ftol((float10)*pfVar1);
		FUN_00451710(param_1,(uint)lVar6,uVar2,uVar5,pfVar7);
		uVar4 += 1;
		pfVar1 = pfVar1 + 2;
	} while (uVar4 < 4);
	for (uVar4 = param_3 - 1; uVar4 <= param_3; uVar4 += 1) {
		for (uVar5 = param_2 - 1; uVar5 <= param_2; uVar5 += 1) {
			FUN_004517b0(param_1,uVar5,uVar4);
		}
	}
	return;
}



void __cdecl FUN_0044f750(LevelSurfaceMap *param_1,int param_2)
{
	uint uVar1;
	uint uVar2;
	uint uVar3;
	
	uVar2 = 0;
	if ((param_1->smallDimensions).height != 0) {
		do {
			uVar1 = (param_1->smallDimensions).width;
			uVar3 = 0;
			if (uVar1 != 0) {
				do {
					FUN_004750f0(param_1->resData_24,uVar2 * uVar1 + uVar3,param_2);
					uVar1 = (param_1->smallDimensions).width;
					uVar3 += 1;
				} while (uVar3 < uVar1);
			}
			uVar2 += 1;
		} while (uVar2 < (uint)(param_1->smallDimensions).height);
	}
	return;
}



uint __cdecl FUN_0044f7a0(LevelSurfaceMap *surfMap,int x,int y,int index)
{
	byte bVar1;
	int iVar2;
	
	iVar2 = (surfMap->dimensions).width * y + x;
	bVar1 = *(byte *)(surfMap->field_28 + 0x24 + iVar2 * 0x28);
	*(char *)(surfMap->field_28 + 0x24 + iVar2 * 0x28) = (char)index;
	FUN_0044f880((int *)surfMap,x,y,1,(&FLOAT_004a62c0)[index * 3],(&FLOAT_004a62c4)[index * 3],
							 (&FLOAT_004a62c8)[index * 3]);
	return (uint)bVar1;
}



uint __cdecl FUN_0044f800(LevelSurfaceMap *surfMap,int x,int y)
{
	return (uint)*(byte *)(surfMap->field_28 + 0x24 + ((surfMap->dimensions).width * y + x) * 0x28);
}



void __cdecl FUN_0044f830(LevelSurfaceMap *param_1,int param_2,int param_3)
{
	FUN_0044f880((int *)param_1,param_2,param_3,0,1.0,1.0,1.0);
	*(undefined *)
	 (param_1->field_28 + 0x24 + ((param_1->dimensions).width * param_3 + param_2) * 0x28) = 0;
	return;
}



void __cdecl
FUN_0044f880(int *param_1,int param_2,int param_3,int param_4,float param_5,float param_6,
						float param_7)
{
	int index;
	
	index = *param_1 * param_3 + param_2;
	if (param_4 != 0) {
		lego::res::Res_SetMeshColorMultiplier
							((ResourceData *)param_1[9],index,param_5,param_6,param_7,1.0);
		return;
	}
	lego::res::Res_SetMeshColorMultiplier((ResourceData *)param_1[9],index,1.0,1.0,1.0,1.0);
	*(undefined *)(param_1[10] + 0x24 + (param_1[2] * param_3 + param_2) * 0x28) = 0;
	return;
}



BOOL __cdecl FUN_0044f900(LevelSurfaceMap *surfMap,uint x,uint y,float *out_x,float *out_y)
{
	if ((x < (uint)(surfMap->smallDimensions).width) && (y < (uint)(surfMap->smallDimensions).height))
	{
		*out_x = surfMap->BlockSize * 0.5 +
						 (float)(ulonglong)x * surfMap->BlockSize + (surfMap->blockDimensions_neg).width;
		*out_y = (surfMap->blockDimensions_neg).height -
						 (surfMap->BlockSize * 0.5 + (float)(ulonglong)y * surfMap->BlockSize);
		return 1;
	}
	return 0;
}



BOOL __cdecl
lego::game::SurfaceMap_ToBlockCoordinatesNoZ
					(LevelSurfaceMap *surfaceMap,float in_x,float in_y,int *out_x,int *out_y)
{
	BOOL BVar1;
	
	BVar1 = SurfaceMap_ToBlockCoordinates(surfaceMap,in_x,in_y,out_x,out_y,(float *)&out_y);
	return BVar1;
}



BOOL __cdecl
lego::game::SurfaceMap_ToBlockCoordinates
					(LevelSurfaceMap *surfaceMap,float in_x,float in_y,int *out_x,int *out_y,float *out_unk_z)
{
	float fVar1;
	int iVar2;
	int iVar3;
	longlong lVar4;
	
	lVar4 = __ftol(((float10)in_x - (float10)(surfaceMap->blockDimensions_neg).width) /
								 (float10)surfaceMap->BlockSize);
	iVar2 = (int)lVar4;
	lVar4 = __ftol(((float10)(surfaceMap->blockDimensions_neg).height - (float10)in_y) /
								 (float10)surfaceMap->BlockSize);
	iVar3 = (int)lVar4;
	if (out_x != NULL) {
		*out_x = iVar2;
	}
	if (out_y != NULL) {
		*out_y = iVar3;
	}
	if ((((-1 < iVar2) && (iVar2 < (surfaceMap->smallDimensions).width)) && (-1 < iVar3)) &&
		 (iVar3 < (surfaceMap->smallDimensions).height)) {
		if (out_unk_z != NULL) {
			fVar1 = surfaceMap->BlockSize * 0.5;
			in_x = (in_x - ((float)iVar2 * surfaceMap->BlockSize + (surfaceMap->blockDimensions_neg).width
										 )) / fVar1;
			fVar1 = -((in_y - ((surfaceMap->blockDimensions_neg).height -
												(float)iVar3 * surfaceMap->BlockSize)) / fVar1);
			if ((ushort)((ushort)(in_x < 1.0) << 8 | (ushort)(in_x == 1.0) << 0xe) == 0) {
				in_x = 2.0 - in_x;
			}
			if ((ushort)((ushort)(fVar1 < 1.0) << 8 | (ushort)(fVar1 == 1.0) << 0xe) == 0) {
				fVar1 = 2.0 - fVar1;
			}
			if (in_x < fVar1) {
				fVar1 = in_x;
			}
			*out_unk_z = fVar1;
		}
		return 1;
	}
	return 0;
}



void __cdecl FUN_0044fad0(int *param_1,float param_2,float param_3,int *param_4,int *param_5)
{
	int iVar1;
	int iVar2;
	longlong lVar3;
	
	lVar3 = __ftol(((float10)param_2 - (float10)(float)param_1[6]) / (float10)(float)param_1[4]);
	iVar2 = (int)lVar3;
	lVar3 = __ftol(((float10)(float)param_1[7] - (float10)param_3) / (float10)(float)param_1[4]);
	iVar1 = (int)lVar3;
	if (iVar2 < 0) {
		iVar2 = 0;
	}
	if (*param_1 <= iVar2) {
		iVar2 = *param_1 + -1;
	}
	if (iVar1 < 0) {
		iVar1 = 0;
	}
	if (param_1[1] <= iVar1) {
		iVar1 = param_1[1] + -1;
	}
	if (param_4 != NULL) {
		*param_4 = iVar2;
	}
	if (param_5 != NULL) {
		*param_5 = iVar1;
	}
	return;
}



undefined4 __cdecl
FUN_0044fb30(LevelSurfaceMap *surfaceMap,Point2F *param_2,Point2F *param_3,Point2F *param_4)
{
	float fVar1;
	LevelSurfaceMap *surfMap;
	Point2F *pPVar2;
	Point2F *pPVar3;
	BOOL BVar4;
	Point2F *local_8;
	float fStack4;
	
	pPVar2 = param_2;
	surfMap = surfaceMap;
	BVar4 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
										(surfaceMap,param_2->x,param_2->y,(int *)&surfaceMap,(int *)&param_2);
	pPVar3 = param_4;
	if (BVar4 != 0) {
		if (param_3 != NULL) {
			local_8 = param_2;
			fStack4 = 0.0;
			param_3->x = (float)ZEXT48(surfaceMap);
			param_3->y = (float)ZEXT48(param_2);
		}
		if (param_4 != NULL) {
			FUN_0044f900(surfMap,(uint)surfaceMap,(uint)param_2,(float *)&local_8,&fStack4);
			pPVar3->x = pPVar2->x - (float)local_8;
			pPVar3->y = pPVar2->y - fStack4;
			fVar1 = 1.0 / surfMap->BlockSize;
			pPVar3->x = fVar1 * pPVar3->x - -0.5;
			pPVar3->y = fVar1 * pPVar3->y - -0.5;
		}
	}
	return 0;
}



float10 __cdecl lego::game::SurfaceMap_UnkGetZ(LevelSurfaceMap *surfMap,float x,float y)
{
	LevelSurfaceMap *surfMap_00;
	BOOL BVar1;
	float10 fVar2;
	uint local_38;
	float local_34;
	float local_30;
	float local_2c;
	float local_28;
	float local_24;
	float local_20;
	float local_1c;
	float local_18;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	surfMap_00 = surfMap;
	local_34 = 0.0;
	BVar1 = SurfaceMap_ToBlockCoordinatesNoZ(surfMap,x,y,(int *)&local_38,(int *)&surfMap);
	if (BVar1 != 0) {
		BVar1 = FUN_00450390(surfMap_00,local_38,(uint)surfMap,&local_30);
		if (BVar1 == 0) {
			if (surfMap_00->BlockSize <= (x - local_30) + (local_2c - y)) {
				local_28 = (local_4 - local_10) + (local_1c - local_10) + local_10;
			}
			else {
				local_10 = (local_4 - local_28) + (local_1c - local_28) + local_28;
			}
		}
		else {
			if (surfMap_00->BlockSize <= (local_24 - x) + (local_20 - y)) {
				local_1c = (local_10 - local_4) + (local_28 - local_4) + local_4;
			}
			else {
				local_4 = (local_10 - local_1c) + (local_28 - local_1c) + local_1c;
			}
		}
		fVar2 = ((float10)local_10 - (float10)local_4) *
						(((float10)local_18 - (float10)local_c) / ((float10)x - (float10)local_c)) +
						(float10)local_4;
		return (((float10)local_2c - (float10)local_8) / ((float10)y - (float10)local_8)) *
					 ((((float10)local_1c - (float10)local_28) *
						 (((float10)x - (float10)local_30) / ((float10)local_24 - (float10)local_30)) +
						(float10)local_28) - fVar2) + fVar2;
	}
	return (float10)local_34;
}



void __cdecl FUN_0044fd70(uint *param_1,float param_2,float param_3,undefined4 *param_4)
{
	uint *surfMap;
	BOOL BVar1;
	uint uVar2;
	undefined4 *puVar3;
	uint local_34;
	float local_30;
	float local_2c;
	float local_24;
	float local_20;
	
	surfMap = param_1;
	BVar1 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
										((LevelSurfaceMap *)param_1,param_2,param_3,(int *)&local_34,(int *)&param_1);
	if (BVar1 == 0) {
		return;
	}
	BVar1 = FUN_00450390((LevelSurfaceMap *)surfMap,local_34,(uint)param_1,&local_30);
	if (BVar1 == 0) {
		uVar2 = surfMap[2];
		if ((local_2c - param_3) + (param_2 - local_30) < (float)surfMap[4]) {
LAB_0044fe14:
			puVar3 = (undefined4 *)(surfMap[10] + (uVar2 * (int)param_1 + local_34) * 0x28);
			goto LAB_0044fe28;
		}
	}
	else {
		uVar2 = surfMap[2];
		if ((float)surfMap[4] <= (local_20 - param_3) + (local_24 - param_2)) goto LAB_0044fe14;
	}
	puVar3 = (undefined4 *)(surfMap[10] + 0xc + (uVar2 * (int)param_1 + local_34) * 0x28);
LAB_0044fe28:
	*param_4 = *puVar3;
	param_4[1] = puVar3[1];
	param_4[2] = puVar3[2];
	return;
}



undefined4 __cdecl
FUN_0044fe50(LevelSurfaceMap *surfMap,float param_2,float param_3,int param_4,float param_5,
						float *param_6,float *param_7)
{
	float fVar1;
	float fVar2;
	LevelSurfaceMap *surfMap_00;
	BOOL BVar3;
	float *pfVar4;
	int iVar5;
	int iVar6;
	uint local_68;
	Point2F local_64;
	Point2F local_5c;
	Point2F local_54;
	Point2F local_4c;
	Point2F local_44;
	float local_3c;
	float local_38;
	float local_34;
	float local_30 [12];
	
	surfMap_00 = surfMap;
	BVar3 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
										(surfMap,param_2,param_3,(int *)&local_68,(int *)&surfMap);
	if (BVar3 == 0) {
		return 0;
	}
	BVar3 = FUN_00450390(surfMap_00,local_68,(uint)surfMap,local_30);
	if (BVar3 == 0) {
		iVar5 = (surfMap_00->dimensions).width;
		if ((param_2 - local_30[0]) + (local_30[1] - param_3) < surfMap_00->BlockSize) {
			pfVar4 = (float *)(surfMap_00->field_28 + (iVar5 * (int)surfMap + local_68) * 0x28);
			local_3c = *pfVar4;
			local_38 = pfVar4[1];
			local_34 = pfVar4[2];
			goto LAB_0044ff78;
		}
		pfVar4 = (float *)(surfMap_00->field_28 + 0xc + (iVar5 * (int)surfMap + local_68) * 0x28);
	}
	else {
		iVar5 = (surfMap_00->dimensions).width;
		if ((local_30[3] - param_2) + (local_30[4] - param_3) < surfMap_00->BlockSize) {
			pfVar4 = (float *)(surfMap_00->field_28 + 0xc + (iVar5 * (int)surfMap + local_68) * 0x28);
			local_3c = *pfVar4;
			local_38 = pfVar4[1];
			local_34 = pfVar4[2];
			goto LAB_0044ff78;
		}
		pfVar4 = (float *)(surfMap_00->field_28 + (iVar5 * (int)surfMap + local_68) * 0x28);
	}
	local_3c = *pfVar4;
	local_38 = pfVar4[1];
	local_34 = pfVar4[2];
LAB_0044ff78:
	if (param_4 == 0) {
		if (ABS(local_3c) <= ABS(local_38)) {
			if (0.0 <= local_38) {
				iVar5 = 0;
				iVar6 = 1;
			}
			else {
				iVar5 = 2;
				iVar6 = 3;
			}
		}
		else {
			if (0.0 <= local_3c) {
				iVar5 = 1;
				iVar6 = 2;
			}
			else {
				iVar5 = 0;
				iVar6 = 3;
			}
		}
	}
	else {
		if (BVar3 == 0) {
			iVar5 = 1;
			iVar6 = 3;
		}
		else {
			iVar5 = 0;
			iVar6 = 2;
		}
	}
	local_54.x = local_30[iVar5 * 3];
	local_54.y = local_30[iVar5 * 3 + 1];
	local_4c.x = param_2;
	local_5c.x = local_30[iVar6 * 3] - local_54.x;
	local_5c.y = local_30[iVar6 * 3 + 1] - local_54.y;
	local_4c.y = param_3;
	local_64.x = local_3c;
	local_64.y = local_38;
	lego::math::Vector2_UnkOperation5(&local_44,&local_54,&local_5c,&local_4c,&local_64);
	fVar2 = param_5 * surfMap_00->BlockSize;
	fVar1 = 1.0 / SQRT(local_64.y * local_64.y + local_64.x * local_64.x);
	*param_6 = local_44.x - fVar1 * local_64.x * fVar2;
	*param_7 = local_44.y - fVar1 * local_64.y * fVar2;
	return 1;
}



float10 __cdecl FUN_00450130(int *param_1,float param_2,float param_3)
{
	int *piVar1;
	BOOL BVar2;
	float *pfVar3;
	float *pfVar4;
	int iVar5;
	float10 fVar6;
	float10 extraout_ST0;
	longlong lVar7;
	uint local_68;
	int local_64;
	float local_60;
	undefined4 uStack92;
	float local_58;
	undefined4 uStack84;
	float local_50 [5];
	undefined4 local_3c;
	undefined4 local_38;
	undefined4 local_34;
	float local_30;
	float local_2c;
	float local_28;
	float local_24;
	float local_20;
	float local_1c;
	float local_18;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	piVar1 = param_1;
	local_58 = 0.0;
	BVar2 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
										((LevelSurfaceMap *)param_1,param_2,param_3,(int *)&local_68,(int *)&param_1);
	if (BVar2 != 0) {
		uStack92 = 0;
		local_58 = (float)local_68;
		fVar6 = (float10)ZEXT48(param_1);
		uStack84 = 0;
		local_60 = (float)(ulonglong)local_68;
		local_50[0] = 0.0;
		local_50[1] = 0.0;
		local_50[2] = 1.0;
		local_50[3] = 0.0;
		local_50[4] = 1.0;
		local_3c = 0x3f800000;
		local_38 = 0;
		local_34 = 0x3f800000;
		pfVar3 = local_50;
		local_64 = 4;
		pfVar4 = &local_2c;
		do {
			pfVar4[-1] = (*pfVar3 + local_60) * (float)piVar1[4] + (float)piVar1[6];
			*pfVar4 = (float)((float10)(float)piVar1[7] -
											 ((float10)pfVar3[1] + fVar6) * (float10)(float)piVar1[4]);
			lVar7 = __ftol((float10)pfVar3[1]);
			iVar5 = ((int)param_1 + (int)lVar7) * piVar1[2] + local_68;
			lVar7 = __ftol((float10)*pfVar3);
			pfVar3 = pfVar3 + 2;
			local_58 = (float)(uint)*(byte *)(piVar1[10] + 0x1a + (iVar5 + (int)lVar7) * 0x28);
			local_64 += -1;
			pfVar4[1] = -((float)(int)local_58 * (float)piVar1[5]);
			pfVar4 = pfVar4 + 3;
			fVar6 = extraout_ST0;
		} while (local_64 != 0);
		if ((float)piVar1[4] <= (local_24 - param_2) + (local_20 - param_3)) {
			fVar6 = (float10)local_4;
			local_1c = (float)(((float10)local_10 - fVar6) + ((float10)local_28 - fVar6) + fVar6);
		}
		else {
			fVar6 = ((float10)local_10 - (float10)local_1c) + ((float10)local_28 - (float10)local_1c) +
							(float10)local_1c;
		}
		fVar6 = ((float10)local_10 - fVar6) *
						(((float10)local_18 - (float10)local_c) / ((float10)param_2 - (float10)local_c)) + fVar6
		;
		return (((float10)local_2c - (float10)local_8) / ((float10)param_3 - (float10)local_8)) *
					 ((((float10)local_1c - (float10)local_28) *
						 (((float10)param_2 - (float10)local_30) / ((float10)local_24 - (float10)local_30)) +
						(float10)local_28) - fVar6) + fVar6;
	}
	return (float10)local_58;
}



void __cdecl FUN_00450320(LevelSurfaceMap *surfMap,int param_2,int param_3,undefined4 *param_4)
{
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	
	FUN_00474f80(surfMap->resData_24,param_3 * (surfMap->smallDimensions).width + param_2,
							 *(byte *)(surfMap->field_28 + 0x19 +
												((surfMap->dimensions).width * param_3 + param_2) * 0x28) & 1,1,
							 (int)&local_24);
	*param_4 = local_24;
	param_4[1] = local_20;
	param_4[2] = local_1c;
	return;
}



BOOL __cdecl FUN_00450390(LevelSurfaceMap *surfMap,uint x,uint y,undefined4 *param_4)
{
	uint uVar1;
	undefined4 local_90;
	undefined4 local_8c;
	undefined4 local_88;
	undefined4 local_6c;
	undefined4 local_68;
	undefined4 local_64;
	undefined4 local_48;
	undefined4 local_44;
	undefined4 local_40;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	
	uVar1 = (surfMap->smallDimensions).width;
	if ((x < uVar1) && (y < (uint)(surfMap->smallDimensions).height)) {
		FUN_00474f80(surfMap->resData_24,y * uVar1 + x,0,4,(int)&local_90);
		if ((*(byte *)(surfMap->field_28 + 0x19 + ((surfMap->dimensions).width * y + x) * 0x28) & 1) !=
				0) {
			*param_4 = local_6c;
			param_4[1] = local_68;
			param_4[2] = local_64;
			param_4[3] = local_48;
			param_4[4] = local_44;
			param_4[5] = local_40;
			param_4[6] = local_24;
			param_4[7] = local_20;
			param_4[8] = local_1c;
			param_4[9] = local_90;
			param_4[10] = local_8c;
			param_4[0xb] = local_88;
			return 1;
		}
		*param_4 = local_90;
		param_4[1] = local_8c;
		param_4[2] = local_88;
		param_4[3] = local_6c;
		param_4[4] = local_68;
		param_4[5] = local_64;
		param_4[6] = local_48;
		param_4[7] = local_44;
		param_4[8] = local_40;
		param_4[9] = local_24;
		param_4[10] = local_20;
		param_4[0xb] = local_1c;
		uVar1 = 0;
	}
	return uVar1;
}



void __cdecl FUN_004504e0(int *param_1,int param_2,int param_3,undefined4 *param_4)
{
	undefined4 local_90;
	undefined4 local_8c;
	undefined4 local_88;
	undefined4 local_6c;
	undefined4 local_68;
	undefined4 local_64;
	undefined4 local_48;
	undefined4 local_44;
	undefined4 local_40;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	
	FUN_00474f80((ResourceData *)param_1[9],param_3 * *param_1 + param_2,0,4,(int)&local_90);
	*param_4 = local_90;
	param_4[1] = local_8c;
	param_4[2] = local_88;
	param_4[3] = local_6c;
	param_4[4] = local_68;
	param_4[5] = local_64;
	param_4[6] = local_48;
	param_4[7] = local_44;
	param_4[8] = local_40;
	param_4[9] = local_24;
	param_4[10] = local_20;
	param_4[0xb] = local_1c;
	return;
}



uint __cdecl FUN_00450580(LevelSurfaceMap *param_1,uint x,uint y)
{
	if ((uint)(param_1->smallDimensions).width <= x) {
		return 0;
	}
	return (uint)(y < (uint)(param_1->smallDimensions).height);
}



BOOL __cdecl
FUN_004505a0(LevelSurfaceMap *surfMap,int param_2,uint param_3,uint param_4,uint *out_x,uint *out_y,
						float *param_7)
{
	int iVar1;
	BOOL BVar2;
	float *pfVar3;
	undefined4 *puVar4;
	Point2I local_b8;
	int local_b0;
	int local_ac;
	Point2F local_a8;
	Vector3F local_a0;
	Vector3F local_94;
	float local_88;
	float local_84;
	float local_7c;
	float local_78;
	float local_74;
	undefined4 local_70;
	undefined4 local_6c;
	float local_68;
	float local_64;
	undefined4 local_60;
	undefined4 local_5c;
	Point2F local_58;
	Point2F local_50 [3];
	float local_38;
	float local_34;
	undefined4 local_30 [12];
	
	local_a8.x = (float)(ulonglong)param_3;
	local_b8.x = param_4;
	local_b8.y = 0;
	local_a8.y = (float)(ulonglong)param_4;
	local_70 = 0;
	local_6c = 0x3f800000;
	local_60 = 0x3f800000;
	local_5c = 0x3f800000;
	local_78 = local_a8.x;
	local_74 = local_a8.y;
	local_68 = local_a8.x;
	local_64 = local_a8.y;
	FUN_00477550(param_2,&local_94,&local_78);
	FUN_00477550(param_2,&local_a0,&local_68);
	local_a0.x = local_a0.x - local_94.x;
	local_a0.y = local_a0.y - local_94.y;
	local_94.z = local_a0.z - local_94.z;
	local_a0.z = 1.0 / SQRT(local_94.z * local_94.z +
													local_a0.y * local_a0.y + local_a0.x * local_a0.x);
	local_a0.x = local_a0.z * local_a0.x;
	local_a0.y = local_a0.z * local_a0.y;
	local_a0.z = local_a0.z * local_94.z;
	iVar1 = FUN_00450820(surfMap,&local_94,&local_a0,(Vector3F *)param_7,&local_b8,0x14);
	if (iVar1 == 0) {
		return 0;
	}
	local_ac = -2;
	do {
		local_b0 = -2;
		iVar1 = local_ac;
		do {
			if (((uint)(local_b0 + local_b8.x) < (uint)(surfMap->smallDimensions).width) &&
				 ((uint)(local_b8.y + iVar1) < (uint)(surfMap->smallDimensions).height)) {
				FUN_00450390(surfMap,local_b0 + local_b8.x,local_b8.y + iVar1,local_30);
				puVar4 = local_30;
				iVar1 = 4;
				pfVar3 = &local_58.y;
				do {
					FUN_00477570(param_2,&local_88,puVar4);
					puVar4 = puVar4 + 3;
					iVar1 += -1;
					pfVar3[-1] = local_88 / local_7c;
					*pfVar3 = local_84 / local_7c;
					pfVar3 = pfVar3 + 2;
				} while (iVar1 != 0);
				local_38 = local_58.x;
				local_34 = local_58.y;
				BVar2 = FUN_00479e40(&local_a8,&local_58,local_50,4);
				iVar1 = local_ac;
				if (BVar2 != 0) {
					*out_x = local_b0 + local_b8.x;
					*out_y = local_b8.y + local_ac;
					FUN_004518a0(surfMap,*out_x,local_b8.y + local_ac,&local_94,&local_a0,(Vector3F *)param_7)
					;
					return 1;
				}
			}
			local_b0 += 1;
		} while (local_b0 < 3);
		local_ac = iVar1 + 1;
		if (2 < local_ac) {
			return 0;
		}
	} while( true );
}



void __cdecl
FUN_00450820(LevelSurfaceMap *surfMap,Vector3F *param_2,Vector3F *param_3,Vector3F *param_4,
						Point2I *out_coordinates,int unkCount)
{
	float10 fVar1;
	Vector3F local_18;
	Vector3F local_c;
	
	local_18.x = 0.0;
	local_18.y = 0.0;
	local_18.z = -50.0;
	local_c.x = 0.0;
	local_c.y = 0.0;
	local_c.z = -1.0;
	if (unkCount != 0) {
		do {
			lego::math::Vector3_Unk_FUN_00479ba0(param_4,param_2,param_3,&local_18,&local_c);
			fVar1 = lego::game::SurfaceMap_UnkGetZ(surfMap,param_4->x,param_4->y);
			local_18.z = (float)fVar1;
			unkCount += -1;
		} while (unkCount != 0);
	}
	lego::game::SurfaceMap_ToBlockCoordinatesNoZ
						(surfMap,param_4->x,param_4->y,(int *)out_coordinates,&out_coordinates->y);
	return;
}



void __cdecl
FUN_004508c0(LevelSurfaceMap *surfMap,int param_2,int param_3,int param_4,undefined *param_5)
{
	int iVar1;
	int x;
	int y;
	int iVar2;
	int iVar3;
	
	iVar2 = -param_4;
	if (-param_4 == param_4 || SBORROW4(iVar2,param_4) != param_4 * -2 < 0) {
		y = iVar2 + param_3;
		iVar1 = iVar2;
		do {
			if (iVar2 <= param_4) {
				x = iVar2 + param_2;
				iVar3 = iVar2;
				do {
					if ((((iVar3 * iVar3 + iVar1 * iVar1 <= param_4 * param_4) && (-1 < x)) &&
							(x < (surfMap->smallDimensions).width)) &&
						 ((-1 < y && (y < (surfMap->smallDimensions).height)))) {
						FUN_004509c0(surfMap,x,y,0);
						if (param_5 != NULL) {
							(*(code *)param_5)(x,y);
						}
						surfMap->table_42b4[surfMap->count_4a84 * 2] = (short)iVar3 + (short)param_2;
						surfMap->table_42b4[surfMap->count_4a84 * 2 + 1] = (short)iVar1 + (short)param_3;
						surfMap->count_4a84 = surfMap->count_4a84 + 1;
					}
					iVar3 += 1;
					x += 1;
				} while (iVar3 <= param_4);
			}
			iVar1 += 1;
			y += 1;
		} while (iVar1 <= param_4);
	}
	return;
}



void __cdecl FUN_004509c0(LevelSurfaceMap *surfMap,int x,int y,BOOL state)
{
	FUN_00474df0(surfMap->resData_24,y * (surfMap->smallDimensions).width + x,state);
	return;
}



void __cdecl FUN_004509f0(int *param_1,int param_2,int param_3)
{
	FUN_004509c0((LevelSurfaceMap *)param_1,param_2,param_3,0);
	*(short *)(param_1 + param_1[0x12a1] + 0x10ad) = (short)param_2;
	*(short *)((int)param_1 + param_1[0x12a1] * 4 + 0x42b6) = (short)param_3;
	param_1[0x12a1] = param_1[0x12a1] + 1;
	return;
}



void __cdecl FUN_00450a40(LevelSurfaceMap *surfMap)
{
	uint uVar1;
	ushort *puVar2;
	
	uVar1 = 0;
	if (surfMap->count_4a84 != 0) {
		puVar2 = surfMap->table_42b4;
		do {
			FUN_004509c0(surfMap,(uint)*puVar2,(uint)puVar2[1],1);
			uVar1 += 1;
			puVar2 = puVar2 + 2;
		} while (uVar1 < surfMap->count_4a84);
	}
	surfMap->count_4a84 = 0;
	return;
}



void __cdecl
FUN_00450a90(uint *param_1,uint param_2,uint param_3,float *out_x,float *out_y,float *out_z)
{
	uint uVar1;
	int iVar2;
	Vector3F local_24;
	
	if (param_1[2] <= param_2) {
		return;
	}
	if (param_1[3] <= param_3) {
		return;
	}
	uVar1 = *param_1;
	iVar2 = 0;
	if (param_2 == uVar1) {
		if (param_3 == param_1[1]) {
			param_2 -= 1;
			param_3 -= 1;
			iVar2 = 2;
			goto LAB_00450ae4;
		}
		if (param_2 == uVar1) {
			param_2 -= 1;
			iVar2 = 1;
			goto LAB_00450ae4;
		}
	}
	if (param_3 == param_1[1]) {
		param_3 -= 1;
		iVar2 = -1;
	}
LAB_00450ae4:
	if ((*(byte *)(param_1[10] + 0x19 + (param_3 * param_1[2] + param_2) * 0x28) & 1) != 0) {
		iVar2 += 1;
	}
	if (iVar2 == -1) {
		iVar2 = 3;
	}
	FUN_00474f80((ResourceData *)param_1[9],param_3 * uVar1 + param_2,iVar2,1,(int)&local_24);
	*out_x = local_24.x;
	*out_y = local_24.y;
	*out_z = local_24.z;
	return;
}



float10 __cdecl lego::game::SurfaceMap_GetFloat10(LevelSurfaceMap *surfMap)
{
	return (float10)surfMap->BlockSize;
}



undefined4 __cdecl FUN_00450b60(int param_1,int param_2,int param_3,int param_4)
{
	int iVar1;
	undefined4 uVar2;
	
	uVar2 = 0xffffffff;
	if (param_1 == param_3) {
		if (param_2 + -1 == param_4) {
			return 0;
		}
		if (param_2 + 1 == param_4) {
			return 2;
		}
	}
	else {
		iVar1 = param_1 + 1;
		if (param_2 == param_4) {
			if (iVar1 == param_3) {
				return 1;
			}
			if (param_1 + -1 == param_3) {
				return 3;
			}
		}
		else {
			if (iVar1 == param_3) {
				if (param_2 + -1 == param_4) {
					return 4;
				}
				if ((iVar1 == param_3) && (param_2 + 1 == param_4)) {
					return 5;
				}
			}
			if (param_1 + -1 == param_3) {
				if (param_2 + 1 == param_4) {
					return 6;
				}
				if ((param_1 + -1 == param_3) && (param_2 + -1 == param_4)) {
					uVar2 = 7;
				}
			}
		}
	}
	return uVar2;
}



void __cdecl FUN_00450c20(LevelSurfaceMap *param_1,uint param_2,uint param_3,int param_4)
{
	uint uVar1;
	int iVar2;
	uint uVar3;
	ushort *puVar4;
	
	if (param_4 == 0) {
		if ((*(byte *)(param_1->field_28 + 0x19 +
									(param_3 * (param_1->dimensions).width + param_2) * 0x28) & 0x10) != 0) {
			uVar1 = param_1->field_7198;
			uVar3 = 0;
			if (uVar1 != 0) {
				puVar4 = (ushort *)&param_1->field_0x4a8a;
				while ((puVar4[-1] != param_2 || (*puVar4 != param_3))) {
					uVar3 += 1;
					puVar4 = puVar4 + 2;
					if (uVar1 <= uVar3) {
						return;
					}
				}
				param_1->field_7198 = uVar1 - 1;
				*(undefined2 *)(&param_1->field_0x4a88 + uVar3 * 4) =
						 *(undefined2 *)(&param_1->count_4a84 + uVar1);
				*(undefined2 *)(&param_1->field_0x4a8a + uVar3 * 4) =
						 *(undefined2 *)(&param_1->field_0x4a8a + param_1->field_7198 * 4);
				iVar2 = param_3 * (param_1->dimensions).width + param_2;
				*(byte *)(param_1->field_28 + 0x19 + iVar2 * 0x28) =
						 *(byte *)(param_1->field_28 + 0x19 + iVar2 * 0x28) & 0xef;
			}
		}
	}
	else {
		if ((*(byte *)(param_1->field_28 + 0x19 +
									(param_3 * (param_1->dimensions).width + param_2) * 0x28) & 0x10) == 0) {
			*(short *)(&param_1->field_0x4a88 + param_1->field_7198 * 4) = (short)param_2;
			*(short *)(&param_1->field_0x4a8a + param_1->field_7198 * 4) = (short)param_3;
			iVar2 = param_3 * (param_1->dimensions).width + param_2;
			param_1->field_7198 = param_1->field_7198 + 1;
			*(byte *)(param_1->field_28 + 0x19 + iVar2 * 0x28) =
					 *(byte *)(param_1->field_28 + 0x19 + iVar2 * 0x28) | 0x10;
			return;
		}
	}
	return;
}



void __cdecl FUN_00450d40(LevelSurfaceMap *surfMap,BOOL param_2)
{
	uint uVar1;
	ushort *puVar2;
	
	if ((param_2 != 0) && ((*(byte *)&surfMap->field_73d0 & 4) == 0)) {
		uVar1 = 0;
		if (surfMap->field_7198 != 0) {
			puVar2 = (ushort *)&surfMap->field_0x4a88;
			do {
				lego::res::Res_SetMeshColorUnk
									(surfMap->resData_24,
									 (uint)puVar2[1] * (surfMap->smallDimensions).width + (uint)*puVar2,0.3,0.3,0.3);
				uVar1 += 1;
				puVar2 = puVar2 + 2;
			} while (uVar1 < (uint)surfMap->field_7198);
		}
		surfMap->field_73d0 = surfMap->field_73d0 | 4;
		return;
	}
	if ((param_2 == 0) && ((*(byte *)&surfMap->field_73d0 & 4) != 0)) {
		uVar1 = 0;
		if (surfMap->field_7198 != 0) {
			puVar2 = (ushort *)&surfMap->field_0x4a88;
			do {
				lego::res::Res_SetMeshColorUnk
									(surfMap->resData_24,
									 (uint)puVar2[1] * (surfMap->smallDimensions).width + (uint)*puVar2,0.0,0.0,0.0);
				uVar1 += 1;
				puVar2 = puVar2 + 2;
			} while (uVar1 < (uint)surfMap->field_7198);
		}
		surfMap->field_73d0 = surfMap->field_73d0 & 0xfffffffb;
	}
	return;
}



void __cdecl FUN_00450e20(int *param_1,float param_2)
{
	float *pfVar1;
	byte bVar2;
	int iVar3;
	float fVar4;
	float fVar5;
	float fVar6;
	float fVar7;
	float fVar8;
	ushort *puVar9;
	int iVar10;
	int iVar11;
	uint uVar12;
	uint uVar13;
	uint uVar14;
	int iVar15;
	float10 fVar16;
	float10 fVar17;
	float10 fVar18;
	uint local_11c;
	float local_118;
	float local_114;
	float local_110;
	float local_10c;
	float *local_108;
	int *local_104;
	uint local_100;
	uint local_f4;
	float local_d0;
	float local_cc [4];
	undefined4 local_bc;
	undefined4 local_b8;
	undefined4 local_b4;
	int local_b0;
	int local_ac [4];
	undefined4 local_9c;
	undefined4 local_98;
	undefined4 local_94;
	undefined local_90 [24];
	float afStack120 [30];
	
	if ((ushort)((ushort)(param_2 < 0.001) << 8 | (ushort)(param_2 == 0.001) << 0xe) == 0) {
		local_ac[1] = 1;
		local_ac[3] = 1;
		local_9c = 1;
		local_94 = 1;
		local_d0 = 0.0;
		local_cc[0] = 1.0;
		local_cc[1] = 1.0;
		local_cc[2] = 1.0;
		local_cc[3] = 1.0;
		local_bc = 0;
		local_b8 = 0;
		local_b4 = 0;
		local_b0 = 0;
		local_ac[0] = 0;
		local_ac[2] = 0;
		local_98 = 0;
		local_f4 = 0;
		if (param_1[0x1c66] != 0) {
			fVar6 = 50.0 / param_2;
			puVar9 = (ushort *)((int)param_1 + 0x4a8a);
			fVar7 = 1.0 / (fVar6 - -1.0);
			do {
				uVar14 = (uint)*puVar9;
				uVar13 = (uint)puVar9[-1];
				iVar11 = *param_1 * uVar14 + uVar13;
				bVar2 = *(byte *)(param_1[10] + 0x19 + (uVar14 * param_1[2] + uVar13) * 0x28);
				FUN_00474f80((ResourceData *)param_1[9],iVar11,0,4,(int)local_90);
				local_108 = &local_d0;
				local_104 = &local_b0;
				local_100 = 0;
				local_11c = 0;
				do {
					uVar12 = local_100;
					if ((bVar2 & 1) != 0) {
						uVar12 = local_100 + 1 & 3;
					}
					iVar15 = uVar14 + *(int *)((int)local_ac + local_11c);
					iVar3 = *local_104;
					iVar10 = iVar15 * param_1[2] + uVar13 + iVar3;
					fVar4 = afStack120[uVar12 * 9];
					local_110 = *(float *)(param_1[10] + 0x1c + iVar10 * 0x28) + *local_108;
					fVar5 = afStack120[uVar12 * 9 + 1];
					local_10c = *(float *)(param_1[10] + 0x20 + iVar10 * 0x28) +
											*(float *)((int)local_cc + local_11c);
					fVar8 = SQRT((fVar5 - local_10c) * (fVar5 - local_10c) +
											 (fVar4 - local_110) * (fVar4 - local_110));
					local_118 = local_110;
					local_114 = local_10c;
					if (((ushort)((ushort)(fVar8 < 0.36) << 8 | (ushort)(fVar8 == 0.36) << 0xe) != 0) &&
						 (local_118 = fVar4, local_114 = fVar5, fVar8 < 0.05)) {
						fVar16 = lego::game::Game_ChooseRandomRange(0.0,1.0);
						fVar4 = (float)fVar16;
						fVar16 = lego::game::Game_ChooseRandomRange(0.0,1.0);
						pfVar1 = (float *)(param_1[10] + 0x1c + (iVar15 * param_1[2] + uVar13 + iVar3) * 0x28);
						fVar17 = (float10)1.0 /
										 SQRT(fVar16 * (float10)(float)fVar16 + (float10)fVar4 * (float10)fVar4);
						fVar18 = ((float10)*pfVar1 + fVar17 * (float10)fVar4) * (float10)0.3;
						fVar4 = (pfVar1[1] + (float)(fVar17 * (float10)(float)fVar16)) * 0.3;
						local_10c = fVar4 + *(float *)((int)local_cc + local_11c);
						local_110 = (float)(fVar18 + (float10)*local_108);
						*pfVar1 = (float)fVar18;
						pfVar1[1] = fVar4;
					}
					local_11c += 8;
					local_104 = local_104 + 2;
					local_108 = local_108 + 2;
					afStack120[uVar12 * 9] = fVar7 * (fVar6 * local_118 + local_110);
					local_100 += 1;
					afStack120[uVar12 * 9 + 1] = fVar7 * (fVar6 * local_114 + local_10c);
				} while (local_11c < 0x20);
				FUN_00474ff0((int *)param_1[9],iVar11,0,4,(int)local_90);
				local_f4 += 1;
				puVar9 = puVar9 + 2;
			} while (local_f4 < (uint)param_1[0x1c66]);
		}
	}
	return;
}



void __cdecl FUN_004511f0(uint *param_1,uint param_2,uint param_3)
{
	float fVar1;
	float fVar2;
	float *pfVar3;
	uint uVar4;
	int iVar5;
	float *pfVar6;
	float *pfVar7;
	undefined4 *puVar8;
	uint uVar9;
	float *pfVar10;
	longlong lVar11;
	longlong lVar12;
	longlong lVar13;
	uint uVar14;
	undefined4 *puVar15;
	int local_a0;
	int local_94;
	float local_80 [5];
	undefined4 local_6c;
	undefined4 local_68;
	undefined4 local_64;
	undefined4 local_60;
	undefined4 local_5c;
	float local_58;
	undefined4 local_54;
	undefined4 local_50;
	undefined4 local_4c;
	undefined4 local_48;
	undefined4 local_44;
	undefined4 local_40;
	undefined4 local_3c;
	undefined4 local_38;
	undefined4 local_34;
	float local_30 [2];
	float local_28 [10];
	
	uVar9 = 0;
	local_80[0] = 0.0;
	local_80[1] = 0.0;
	local_80[2] = -1.0;
	local_80[3] = 0.0;
	local_80[4] = -1.0;
	local_6c = 0xbf800000;
	local_68 = 0;
	local_64 = 0xbf800000;
	local_60 = 0;
	local_5c = 0;
	local_58 = 0.0;
	local_54 = 0;
	local_50 = 0;
	local_4c = 0;
	local_48 = 0;
	local_44 = 0;
	local_40 = 0;
	local_3c = 0;
	local_38 = 0;
	local_34 = 0;
	iVar5 = 4;
	pfVar3 = local_80 + 1;
	do {
		iVar5 += -1;
		pfVar3[-1] = pfVar3[-1] + (float)(ulonglong)param_2;
		*pfVar3 = (float)(ulonglong)param_3 + *pfVar3;
		pfVar3 = pfVar3 + 2;
	} while (iVar5 != 0);
	pfVar3 = local_80;
	pfVar6 = local_30;
	do {
		uVar14 = uVar9;
		pfVar10 = pfVar6;
		lVar11 = __ftol((float10)pfVar3[1]);
		uVar4 = (uint)lVar11;
		lVar11 = __ftol((float10)*pfVar3);
		FUN_00451590(param_1,(uint)lVar11,uVar4,uVar14,pfVar10);
		uVar9 += 1;
		pfVar6 = pfVar6 + 3;
		pfVar3 = pfVar3 + 2;
	} while (uVar9 < 4);
	pfVar3 = local_80;
	local_a0 = 4;
	pfVar6 = &local_58;
	do {
		lVar11 = __ftol((float10)pfVar3[1]);
		lVar12 = __ftol((float10)*pfVar3);
		pfVar10 = local_80;
		pfVar7 = local_28;
		local_94 = 4;
		do {
			lVar13 = __ftol((float10)pfVar10[1]);
			uVar9 = (uint)lVar13;
			lVar13 = __ftol((float10)*pfVar10);
			iVar5 = FUN_00451440(param_1,(uint)lVar12,(uint)lVar11,(uint)lVar13,uVar9);
			if (iVar5 == 0) {
				fVar1 = pfVar7[-1];
				fVar2 = *pfVar7;
				pfVar6[-2] = pfVar7[-2] + pfVar6[-2];
				pfVar6[-1] = fVar1 + pfVar6[-1];
				*pfVar6 = fVar2 + *pfVar6;
			}
			pfVar10 = pfVar10 + 2;
			pfVar7 = pfVar7 + 3;
			local_94 += -1;
		} while (local_94 != 0);
		pfVar3 = pfVar3 + 2;
		local_a0 += -1;
		fVar1 = 1.0 / SQRT(pfVar6[-2] * pfVar6[-2] + *pfVar6 * *pfVar6 + pfVar6[-1] * pfVar6[-1]);
		*pfVar6 = fVar1 * *pfVar6;
		pfVar6[-2] = fVar1 * pfVar6[-2];
		pfVar6[-1] = fVar1 * pfVar6[-1];
		pfVar6 = pfVar6 + 3;
	} while (local_a0 != 0);
	uVar9 = 0;
	pfVar3 = local_80;
	puVar8 = &local_60;
	do {
		uVar14 = uVar9;
		puVar15 = puVar8;
		lVar11 = __ftol((float10)pfVar3[1]);
		uVar4 = (uint)lVar11;
		lVar11 = __ftol((float10)*pfVar3);
		FUN_004514f0(param_1,(uint)lVar11,uVar4,uVar14,puVar15);
		uVar9 += 1;
		puVar8 = puVar8 + 3;
		pfVar3 = pfVar3 + 2;
	} while (uVar9 < 4);
	return;
}



undefined4 __cdecl FUN_00451440(uint *param_1,uint param_2,uint param_3,uint param_4,uint param_5)
{
	byte bVar1;
	char cVar2;
	uint uVar3;
	uint uVar4;
	
	if ((param_3 != param_5) || (param_2 != param_4)) {
		if ((param_2 < *param_1) &&
			 (((param_3 < param_1[1] && (param_4 < *param_1)) && (param_5 < param_1[1])))) {
			bVar1 = *(byte *)(param_1[10] + 0x18 + (param_3 * param_1[2] + param_2) * 0x28);
			cVar2 = *(char *)(param_1[10] + 0x18 + (param_5 * param_1[2] + param_4) * 0x28);
			param_3 = (uint)bVar1;
			if ((bVar1 != 0xff) && (cVar2 != -1)) {
				uVar3 = 0;
				uVar4 = (uint)*(byte *)((int)param_1 + param_3 + 0x4034);
				if (uVar4 != 0) {
					do {
						if (*(char *)((int)param_1 + uVar3 + param_3 * 0x80 + 0x34) == cVar2) {
							return 1;
						}
						uVar3 += 1;
					} while (uVar3 < uVar4);
					return 0;
				}
			}
		}
	}
	return 0;
}



void __cdecl FUN_004514f0(uint *param_1,uint param_2,uint param_3,uint param_4,undefined4 *param_5)
{
	int iVar1;
	undefined local_24 [12];
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	
	iVar1 = param_3 * *param_1 + param_2;
	if ((param_2 < *param_1) && (param_3 < param_1[1])) {
		if ((*(byte *)(param_1[10] + 0x19 + (param_1[2] * param_3 + param_2) * 0x28) & 1) != 0) {
			param_4 = param_4 + 1 & 3;
		}
		FUN_00474f80((ResourceData *)param_1[9],iVar1,param_4,1,(int)local_24);
		local_18 = *param_5;
		local_14 = param_5[1];
		local_10 = param_5[2];
		FUN_00474ff0((int *)param_1[9],iVar1,param_4,1,(int)local_24);
	}
	return;
}



undefined4 __cdecl FUN_00451590(uint *param_1,uint param_2,uint param_3,uint param_4,float *param_5)
{
	float *pfVar1;
	int iVar2;
	float fVar3;
	int iVar4;
	
	if ((param_2 < *param_1) && (param_3 < param_1[1])) {
		pfVar1 = (float *)(param_1[10] + (param_3 * param_1[2] + param_2) * 0x28);
		if ((*(byte *)((int)pfVar1 + 0x19) & 1) != 0) {
			param_4 = param_4 + 1 & 3;
		}
		if (param_4 == 0) {
			*param_5 = *pfVar1;
			param_5[1] = pfVar1[1];
			param_5[2] = pfVar1[2];
		}
		if (param_4 == 2) {
			pfVar1 = (float *)(param_1[10] + 0xc + (param_3 * param_1[2] + param_2) * 0x28);
			*param_5 = *pfVar1;
			param_5[1] = pfVar1[1];
			param_5[2] = pfVar1[2];
		}
		if ((param_4 == 1) || (param_4 == 3)) {
			pfVar1 = (float *)(param_1[10] + (param_3 * param_1[2] + param_2) * 0x28);
			*param_5 = *pfVar1;
			param_5[1] = pfVar1[1];
			param_5[2] = pfVar1[2];
			iVar4 = param_3 * param_1[2] + param_2;
			iVar2 = param_1[10] + 0xc + iVar4 * 0x28;
			*param_5 = *(float *)(param_1[10] + 0xc + iVar4 * 0x28) + *param_5;
			param_5[1] = *(float *)(iVar2 + 4) + param_5[1];
			fVar3 = *(float *)(iVar2 + 8) + param_5[2];
			param_5[2] = fVar3;
			fVar3 = 1.0 / SQRT(*param_5 * *param_5 + fVar3 * fVar3 + param_5[1] * param_5[1]);
			*param_5 = fVar3 * *param_5;
			param_5[1] = fVar3 * param_5[1];
			param_5[2] = fVar3 * param_5[2];
		}
		return 1;
	}
	param_5[2] = 0.0;
	param_5[1] = 0.0;
	*param_5 = 0.0;
	return 0;
}



void __cdecl FUN_00451710(uint *param_1,uint param_2,uint param_3,uint param_4,float *param_5)
{
	int iVar1;
	float local_24;
	float local_20;
	float local_1c;
	
	iVar1 = param_3 * *param_1 + param_2;
	if ((param_2 < *param_1) && (param_3 < param_1[1])) {
		if ((*(byte *)(param_1[10] + 0x19 + (param_1[2] * param_3 + param_2) * 0x28) & 1) != 0) {
			param_4 = param_4 + 1 & 3;
		}
		FUN_00474f80((ResourceData *)param_1[9],iVar1,param_4,1,(int)&local_24);
		local_24 = *param_5 + local_24;
		local_20 = param_5[1] + local_20;
		local_1c = param_5[2] + local_1c;
		FUN_00474ff0((int *)param_1[9],iVar1,param_4,1,(int)&local_24);
	}
	return;
}



void __cdecl FUN_004517b0(uint *param_1,uint param_2,uint param_3)
{
	Vector3F local_90 [3];
	Vector3F local_6c [3];
	Vector3F local_48 [3];
	Vector3F local_24 [3];
	
	if ((param_2 < *param_1) && (param_3 < param_1[1])) {
		FUN_00474f80((ResourceData *)param_1[9],param_3 * *param_1 + param_2,0,4,(int)local_90);
		lego::math::Vector3_VectorSqrtUnk
							((Vector3F *)(param_1[10] + (param_3 * param_1[2] + param_2) * 0x28),local_90,local_6c
							 ,local_24);
		lego::math::Vector3_VectorSqrtUnk
							((Vector3F *)(param_1[10] + 0xc + (param_3 * param_1[2] + param_2) * 0x28),local_6c,
							 local_48,local_24);
	}
	return;
}



void __cdecl
lego::game::MapFile_GetDimensions(MapFileInfo *mapFileInfo,int *out_width,int *out_height)
{
	*out_width = (mapFileInfo->dimensions).width;
	*out_height = (mapFileInfo->dimensions).height;
	return;
}



uint __cdecl FUN_00451880(int param_1,int param_2,int param_3,int param_4)
{
	uint uVar1;
	
	uVar1 = param_4 * param_3 + param_2;
	return uVar1 & 0xffff0000 | (uint)*(ushort *)(param_1 + 0x10 + uVar1 * 2);
}



BOOL __cdecl
FUN_004518a0(LevelSurfaceMap *surfMap,uint x,uint y,Vector3F *param_4,Vector3F *param_5,
						Vector3F *out_vector)
{
	int iVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	float fVar6;
	float fVar7;
	bool bVar8;
	int iVar9;
	BOOL BVar10;
	Point2F local_88;
	Vector3F local_7c;
	Point2F local_70;
	Point2F local_68;
	float local_60;
	float local_5c;
	float local_58;
	float local_54;
	Vector3F local_50;
	Vector3F local_44;
	int local_38;
	BOOL local_34;
	Vector3F local_30;
	float local_24;
	float local_20;
	Vector3F local_18;
	float local_c;
	float local_8;
	
	local_34 = FUN_00450390(surfMap,x,y,(undefined4 *)&local_30);
	bVar8 = false;
	local_38 = 0;
	iVar9 = y * (surfMap->dimensions).width + x;
	iVar1 = surfMap->field_28 + iVar9 * 0x28;
	local_7c.x = *(float *)(surfMap->field_28 + iVar9 * 0x28);
	local_7c.y = *(float *)(iVar1 + 4);
	local_7c.z = *(float *)(iVar1 + 8);
	BVar10 = lego::math::Vector3_Unk_FUN_00479ba0(&local_50,param_4,param_5,&local_30,&local_7c);
	if (BVar10 != 0) {
		if (local_34 == 0) {
			local_68.x = local_24;
			local_68.y = local_20;
		}
		else {
			local_68.x = local_18.x;
			local_68.y = local_18.y;
		}
		local_88.x = local_50.x;
		local_88.y = local_50.y;
		BVar10 = FUN_00479e40(&local_88,&local_70,&local_68,3);
		if (BVar10 != 0) {
			bVar8 = true;
		}
	}
	iVar9 = y * (surfMap->dimensions).width + x;
	iVar1 = surfMap->field_28 + 0xc + iVar9 * 0x28;
	local_7c.x = *(float *)(surfMap->field_28 + 0xc + iVar9 * 0x28);
	local_7c.y = *(float *)(iVar1 + 4);
	local_7c.z = *(float *)(iVar1 + 8);
	BVar10 = lego::math::Vector3_Unk_FUN_00479ba0(&local_44,param_4,param_5,&local_18,&local_7c);
	if (BVar10 != 0) {
		if (local_34 == 0) {
			local_68.x = local_18.x;
			local_68.y = local_18.y;
			local_60 = local_c;
			local_5c = local_8;
			local_58 = local_24;
			local_54 = local_20;
		}
		else {
			local_68.x = local_24;
			local_68.y = local_20;
			local_60 = local_18.x;
			local_5c = local_18.y;
			local_58 = local_30.x;
			local_54 = local_30.y;
		}
		local_88.x = local_44.x;
		local_88.y = local_44.y;
		local_70.x = local_58;
		local_70.y = local_54;
		BVar10 = FUN_00479e40(&local_88,&local_70,&local_68,3);
		if (BVar10 != 0) {
			local_38 = 1;
		}
	}
	if (!bVar8) {
		if (local_38 == 0) {
			return 0;
		}
		if (true) goto LAB_00451c3e;
	}
	if (local_38 == 0) {
		if (bVar8) {
			out_vector->x = local_50.x;
			out_vector->y = local_50.y;
			out_vector->z = local_50.z;
			return 1;
		}
	}
	else {
		fVar2 = local_50.x - param_4->x;
		fVar3 = local_44.x - param_4->x;
		fVar7 = local_50.y - param_4->y;
		fVar4 = local_44.y - param_4->y;
		fVar6 = local_50.z - param_4->z;
		fVar5 = local_44.z - param_4->z;
		fVar2 = SQRT(fVar6 * fVar6 + fVar7 * fVar7 + fVar2 * fVar2);
		fVar3 = SQRT(fVar5 * fVar5 + fVar4 * fVar4 + fVar3 * fVar3);
		if ((ushort)((ushort)(fVar3 < fVar2) << 8 | (ushort)(fVar3 == fVar2) << 0xe) == 0) {
			out_vector->x = local_50.x;
			out_vector->y = local_50.y;
			out_vector->z = local_50.z;
			return 1;
		}
	}
LAB_00451c3e:
	out_vector->x = local_44.x;
	out_vector->y = local_44.y;
	out_vector->z = local_44.z;
	return 1;
}



PolyMeshData * __cdecl
lego::res::Res_CreatePolyMesh
					(PolyMeshData *lastPolyData,char *partName,char *dirname,char *meshFilename,uint index)
{
	char cVar1;
	ResourceData *pRVar2;
	PolyMeshData *pPVar3;
	undefined4 *puVar4;
	uint uVar5;
	uint uVar6;
	undefined4 *puVar7;
	char *pcVar8;
	char filenameBuffer [256];
	
	std::sprintf(filenameBuffer,"%s\\%s",dirname,meshFilename);
	pRVar2 = Res_LoadResource(NULL,filenameBuffer,"LWO",1);
	if (pRVar2 == NULL) {
		pRVar2 = Res_LoadResource(NULL,filenameBuffer,"MESH",1);
		if (pRVar2 == NULL) {
			return NULL;
		}
	}
	pPVar3 = (PolyMeshData *)std::malloc(0x18);
	pPVar3->int_10 = 2;
	if (lastPolyData != NULL) {
		lastPolyData->previous = pPVar3;
	}
	pPVar3->field_0 = pRVar2;
	uVar5 = 0xffffffff;
	pPVar3->previous = NULL;
	pPVar3->index = index;
	pcVar8 = partName;
	do {
		if (uVar5 == 0) break;
		uVar5 -= 1;
		cVar1 = *pcVar8;
		pcVar8 = pcVar8 + 1;
	} while (cVar1 != '\0');
	puVar4 = (undefined4 *)std::malloc(~uVar5);
	uVar5 = 0xffffffff;
	pPVar3->partName = (char *)puVar4;
	do {
		pcVar8 = partName;
		if (uVar5 == 0) break;
		uVar5 -= 1;
		pcVar8 = partName + 1;
		cVar1 = *partName;
		partName = pcVar8;
	} while (cVar1 != '\0');
	uVar5 = ~uVar5;
	puVar7 = (undefined4 *)(pcVar8 + -uVar5);
	for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
		*puVar4 = *puVar7;
		puVar7 = puVar7 + 1;
		puVar4 = puVar4 + 1;
	}
	for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
		*(undefined *)puVar4 = *(undefined *)puVar7;
		puVar7 = (undefined4 *)((int)puVar7 + 1);
		puVar4 = (undefined4 *)((int)puVar4 + 1);
	}
	pPVar3->field_4 = 0;
	return pPVar3;
}



PolyMeshData * __cdecl
lego::res::Res_CreateNullPolyMesh(PolyMeshData *lastPolyData,char *partName,uint index)
{
	char cVar1;
	PolyMeshData *pPVar2;
	undefined4 *puVar3;
	uint uVar4;
	uint uVar5;
	undefined4 *puVar6;
	char *pcVar7;
	
	pPVar2 = (PolyMeshData *)std::malloc(0x18);
	pPVar2->int_10 = 2;
	if (lastPolyData != NULL) {
		lastPolyData->previous = pPVar2;
	}
	pPVar2->index = index;
	uVar4 = 0xffffffff;
	pPVar2->previous = NULL;
	pPVar2->field_0 = 0;
	pcVar7 = partName;
	do {
		if (uVar4 == 0) break;
		uVar4 -= 1;
		cVar1 = *pcVar7;
		pcVar7 = pcVar7 + 1;
	} while (cVar1 != '\0');
	puVar3 = (undefined4 *)std::malloc(~uVar4);
	uVar4 = 0xffffffff;
	pPVar2->partName = (char *)puVar3;
	do {
		pcVar7 = partName;
		if (uVar4 == 0) break;
		uVar4 -= 1;
		pcVar7 = partName + 1;
		cVar1 = *partName;
		partName = pcVar7;
	} while (cVar1 != '\0');
	uVar4 = ~uVar4;
	puVar6 = (undefined4 *)(pcVar7 + -uVar4);
	for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
		*puVar3 = *puVar6;
		puVar6 = puVar6 + 1;
		puVar3 = puVar3 + 1;
	}
	for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
		*(undefined *)puVar3 = *(undefined *)puVar6;
		puVar6 = (undefined4 *)((int)puVar6 + 1);
		puVar3 = (undefined4 *)((int)puVar3 + 1);
	}
	pPVar2->field_4 = 0;
	return pPVar2;
}



PolyMeshData * __cdecl lego::res::PolyMesh_Duplicate(PolyMeshData *polyData)
{
	PolyMeshData *pPVar1;
	int iVar2;
	int iVar3;
	uint *puVar4;
	PolyMeshData *pPVar5;
	uint *puVar6;
	
	iVar2 = 0;
	pPVar1 = polyData;
	if (polyData != NULL) {
		do {
			pPVar1 = pPVar1->previous;
			iVar2 += 1;
		} while (pPVar1 != NULL);
	}
	if (iVar2 == 0) {
		return NULL;
	}
	pPVar1 = (PolyMeshData *)std::malloc(iVar2 * 0x18);
	iVar2 = 0;
	if (polyData != NULL) {
		puVar4 = (uint *)&pPVar1->int_10;
		do {
			pPVar5 = polyData;
			puVar6 = puVar4 + -4;
			for (iVar3 = 6; iVar3 != 0; iVar3 += -1) {
				*puVar6 = pPVar5->field_0;
				pPVar5 = (PolyMeshData *)&pPVar5->field_4;
				puVar6 = puVar6 + 1;
			}
			puVar4[-3] = 0;
			iVar2 += 1;
			*puVar4 = *puVar4 & 0xfffffffd | 1;
			puVar4[1] = (uint)(puVar4 + 2);
			polyData = polyData->previous;
			puVar4 = puVar4 + 6;
		} while (polyData != NULL);
	}
	pPVar1->int_10 = pPVar1->int_10 | 2;
	pPVar1[iVar2 + -1].previous = NULL;
	return pPVar1;
}



void __cdecl FUN_00451e80(PolyMeshData *polyData,ResourceData *resData,BOOL param_3,int param_4)
{
	char *pcVar1;
	ResourceData *pRVar2;
	
	if (polyData != NULL) {
		do {
			if (param_4 == polyData->index) {
				if (polyData->field_4 == 0) {
					pcVar1 = lego::res::Res_GetNull(resData,polyData->partName,NULL);
					pRVar2 = FUN_00473e80(resData,pcVar1,0,NULL);
					polyData->field_4 = pRVar2;
				}
				if ((int **)polyData->field_4 != NULL) {
					FUN_00474a20((int **)polyData->field_4,polyData->field_0,param_3);
				}
			}
			polyData = polyData->previous;
		} while (polyData != NULL);
	}
	return;
}



void __cdecl FUN_00451ef0(PolyMeshData *polyData)
{
	if (polyData != NULL) {
		do {
			polyData->field_4 = 0;
			polyData = polyData->previous;
		} while (polyData != NULL);
	}
	return;
}



void __cdecl lego::res::PolyMesh_Destroy(PolyMeshData *polyData)
{
	PolyMeshData **ppPVar1;
	PolyMeshData *pPVar2;
	PolyMeshData *pPVar3;
	PolyMeshData *pPVar4;
	
	pPVar3 = NULL;
	pPVar2 = polyData;
	pPVar4 = pPVar3;
	if (polyData != NULL) {
		do {
			if ((*(byte *)&pPVar2->int_10 & 1) == 0) {
				if (pPVar2->partName != NULL) {
					std::free(pPVar2->partName);
				}
				if ((ResourceData *)pPVar2->field_0 != NULL) {
					pool::ReservedPool_ResourceData___Release((ResourceData *)pPVar2->field_0);
				}
			}
			pPVar3 = pPVar2;
			if (((*(byte *)&pPVar2->int_10 & 2) == 0) && (pPVar3 = pPVar4, pPVar4 != NULL)) {
				pPVar4->previous = pPVar2->previous;
			}
			ppPVar1 = &pPVar2->previous;
			pPVar2 = *ppPVar1;
			pPVar4 = pPVar3;
		} while (*ppPVar1 != NULL);
	}
	if ((pPVar3 != NULL) && (polyData != NULL)) {
		do {
			pPVar2 = polyData->previous;
			std::free(polyData);
			polyData = pPVar2;
		} while (pPVar2 != NULL);
	}
	return;
}



void __cdecl lego::main::Boot_InitTable_Message(void)
{
	globals::g_Messages_TABLE[0] = "Message_Null";
	globals::g_Messages_TABLE[1] = "Message_Select";
	globals::g_Messages_TABLE[2] = "Message_Selected";
	globals::g_Messages_TABLE[3] = "Message_ClearSelection";
	globals::g_Messages_TABLE[4] = "Message_Deselect";
	globals::g_Messages_TABLE[5] = "Message_Goto";
	globals::g_Messages_TABLE[6] = "Message_RockMonsterGoto";
	globals::g_Messages_TABLE[7] = "Message_RockMonsterGotoComplete";
	globals::g_Messages_TABLE[8] = "Message_UserGoto";
	globals::g_Messages_TABLE[9] = "Message_FirstPerson";
	globals::g_Messages_TABLE[10] = "Message_TrackObject";
	globals::g_Messages_TABLE[11] = "Message_TopView";
	globals::g_Messages_TABLE[12] = "Message_PlaySample";
	globals::g_Messages_TABLE[13] = "Message_Dig";
	globals::g_Messages_TABLE[14] = "Message_DigComplete";
	globals::g_Messages_TABLE[15] = "Message_Repair";
	globals::g_Messages_TABLE[16] = "Message_RepairComplete";
	globals::g_Messages_TABLE[17] = "Message_Reinforce";
	globals::g_Messages_TABLE[18] = "Message_ReinforceComplete";
	globals::g_Messages_TABLE[19] = "Message_RockFall";
	globals::g_Messages_TABLE[20] = "Message_RockFallComplete";
	globals::g_Messages_TABLE[21] = "Message_GenerateCrystal";
	globals::g_Messages_TABLE[22] = "Message_GenerateCrystalComplete";
	globals::g_Messages_TABLE[23] = "Message_CollectCrystal";
	globals::g_Messages_TABLE[24] = "Message_CollectCrystalComplete";
	globals::g_Messages_TABLE[25] = "Message_CrystalToRefinery";
	globals::g_Messages_TABLE[26] = "Message_CrystalToRefineryComplete";
	globals::g_Messages_TABLE[27] = "Message_GenerateOre";
	globals::g_Messages_TABLE[28] = "Message_GenerateOreComplete";
	globals::g_Messages_TABLE[29] = "Message_CollectOre";
	globals::g_Messages_TABLE[30] = "Message_CollectOreComplete";
	globals::g_Messages_TABLE[31] = "Message_GenerateRockMonster";
	globals::g_Messages_TABLE[32] = "Message_GenerateRockMonsterComplete";
	globals::g_Messages_TABLE[33] = "Message_GatherRock";
	globals::g_Messages_TABLE[34] = "Message_GatherRockComplete";
	globals::g_Messages_TABLE[35] = "Message_PickRandomFloor";
	globals::g_Messages_TABLE[36] = "Message_PickRandomFloorComplete";
	globals::g_Messages_TABLE[37] = "Message_AttackBuilding";
	globals::g_Messages_TABLE[38] = "Message_AttackBuildingComplete";
	globals::g_Messages_TABLE[39] = "Message_Clear";
	globals::g_Messages_TABLE[40] = "Message_ClearComplete";
	globals::g_Messages_TABLE[41] = "Message_GetIn";
	globals::g_Messages_TABLE[42] = "Message_ManSelectedAndMonsterClicked";
	globals::g_Messages_TABLE[43] = "Message_FollowAttack";
	globals::g_Messages_TABLE[44] = "Message_CollectTool";
	globals::g_Messages_TABLE[45] = "Message_ReduceSelection";
	globals::g_Messages_TABLE[46] = "Message_ClearFallIn";
	globals::g_Messages_TABLE[47] = "Message_ClearFallInComplete";
	globals::g_Messages_TABLE[48] = "Message_BuildPath";
	globals::g_Messages_TABLE[49] = "Message_BuildPathComplete";
	globals::g_Messages_TABLE[50] = "Message_Train";
	globals::g_Messages_TABLE[51] = "Message_TrainComplete";
	globals::g_Messages_TABLE[52] = "Message_GenerateCrystalAndOre";
	globals::g_Messages_TABLE[53] = "Message_GenerateCrystalAndOreComplete";
	globals::g_Messages_TABLE[54] = "Message_GenerateFromCryOre";
	globals::g_Messages_TABLE[55] = "Message_GenerateFromCryOreComplete";
	globals::g_Messages_TABLE[56] = "Message_Upgrade";
	globals::g_Messages_TABLE[57] = "Message_UpgradeComplete";
	globals::g_Messages_TABLE[58] = "Message_ClearBuilding";
	globals::g_Messages_TABLE[59] = "Message_ClearBuildingComplete";
	globals::g_Messages_TABLE[60] = "Message_ClearInitial";
	globals::g_Messages_TABLE[61] = "Message_ClearInitialComplete";
	globals::g_Messages_TABLE[62] = "Message_ClearRemovePath";
	globals::g_Messages_TABLE[63] = "Message_ClearRemovePathComplete";
	globals::g_Messages_TABLE[64] = "Message_Debug_DestroyAll";
	return;
}



void __cdecl FUN_00452220(LiveObject *liveObj)
{
	int iVar1;
	uint uVar2;
	uint uVar3;
	uint uVar4;
	MessageAction *pMVar5;
	MessageAction *pMVar6;
	
	uVar4 = 0;
	uVar2 = *(uint *)(&DAT_004fff20 + BOOL_004fff28 * 4);
	if (uVar2 != 0) {
		do {
			uVar3 = uVar2;
			if (liveObj == MessageAction_ARRAY_ARRAY_004ebf20[BOOL_004fff28][uVar4].object_4) {
				uVar3 = uVar2 - 1;
				pMVar5 = MessageAction_ARRAY_ARRAY_004ebf20[BOOL_004fff28 + -1] + uVar2 + 0x7ff;
				pMVar6 = MessageAction_ARRAY_ARRAY_004ebf20[BOOL_004fff28] + uVar4;
				for (iVar1 = 5; iVar1 != 0; iVar1 += -1) {
					pMVar6->event = pMVar5->event;
					pMVar5 = (MessageAction *)&pMVar5->object_4;
					pMVar6 = (MessageAction *)&pMVar6->object_4;
				}
				*(uint *)(&DAT_004fff20 + BOOL_004fff28 * 4) = uVar3;
			}
			uVar4 += 1;
			uVar2 = uVar3;
		} while (uVar4 < uVar3);
	}
	return;
}



int __cdecl lego::game::Game_LookupPTLEventIndex(char *ptlName)
{
	int cmpResult;
	char **ppcVar1;
	int index;
	
	index = 0;
	ppcVar1 = globals::g_Messages_TABLE;
	do {
		cmpResult = std::_stricmp(*ppcVar1 + 8,ptlName);
		if (cmpResult == 0) {
			return index;
		}
		ppcVar1 = ppcVar1 + 1;
		index += 1;
	} while (ppcVar1 < &DAT_00500294);
	return cmpResult;
}



void __cdecl
lego::game::Debug_RegisterSelectedUnitHotkey
					(byte diKeyCode,int param_2,int param_3,BOOL param_4,Point2I *opt_param_5)
{
	uint uVar1;
	
	globals::g_SelectedUnit_Hotkeys_Keys_TABLE[globals::g_SelectedUnit_Hotkeys_COUNT] = diKeyCode;
	uVar1 = globals::g_SelectedUnit_Hotkeys_COUNT;
	globals::g_SelectedUnit_Hotkeys_Actions_TABLE[globals::g_SelectedUnit_Hotkeys_COUNT].field_0 =
			 param_2;
	globals::g_SelectedUnit_Hotkeys_Actions_TABLE[uVar1].bool_8 = param_4;
	globals::g_SelectedUnit_Hotkeys_Actions_TABLE[uVar1].field_4 = param_3;
	if (opt_param_5 != NULL) {
		globals::g_SelectedUnit_Hotkeys_Actions_TABLE[uVar1].field_c = opt_param_5->x;
		globals::g_SelectedUnit_Hotkeys_Actions_TABLE[uVar1].field_10 = opt_param_5->y;
	}
	globals::g_SelectedUnit_Hotkeys_COUNT += 1;
	return;
}



void __cdecl
lego::game::Level_AddMessageAction
					(MessageType msgType,LiveObject *liveObj,BOOL param_3,undefined4 *param_4)
{
	uint uVar1;
	BOOL BVar2;
	
	BVar2 = BOOL_004fff28;
	uVar1 = *(uint *)(&DAT_004fff20 + BOOL_004fff28 * 4);
	if (uVar1 < 0x800) {
		*(uint *)(&DAT_004fff20 + BOOL_004fff28 * 4) = uVar1 + 1;
		MessageAction_ARRAY_ARRAY_004ebf20[BVar2][uVar1].event = MESSAGE_NULL;
		MessageAction_ARRAY_ARRAY_004ebf20[BVar2][uVar1].object_4 = NULL;
		MessageAction_ARRAY_ARRAY_004ebf20[BVar2][uVar1].field_8 = 0;
		MessageAction_ARRAY_ARRAY_004ebf20[BVar2][uVar1].field_c = 0;
		MessageAction_ARRAY_ARRAY_004ebf20[BVar2][uVar1].field_10 = 0;
		MessageAction_ARRAY_ARRAY_004ebf20[BVar2][uVar1].event = msgType;
		MessageAction_ARRAY_ARRAY_004ebf20[BVar2][uVar1].object_4 = liveObj;
		MessageAction_ARRAY_ARRAY_004ebf20[BVar2][uVar1].field_8 = param_3;
		if (param_4 != NULL) {
			MessageAction_ARRAY_ARRAY_004ebf20[BVar2][uVar1].field_c = *param_4;
			MessageAction_ARRAY_ARRAY_004ebf20[BVar2][uVar1].field_10 = param_4[1];
		}
	}
	return;
}



void __cdecl lego::game::Game_PTL_UNKInit__00452390(void)
{
	BOOL BVar1;
	BOOL *pBVar2;
	uint *puVar3;
	uint uVar4;
	int iVar5;
	
	if (((globals::g_Game.flags1 & GAME1_CAMERADISABLED) == GAME1_NONE) &&
		 (uVar4 = 0, globals::g_SelectedUnit_Hotkeys_COUNT != 0)) {
		pBVar2 = &globals::g_SelectedUnit_Hotkeys_Actions_TABLE[0].bool_8;
		do {
			if (globals::g_KeyboardState_Current_TABLE[globals::g_SelectedUnit_Hotkeys_Keys_TABLE[uVar4]]
					!= 0) {
				Level_AddMessageAction(pBVar2[-2],pBVar2[-1],*pBVar2,pBVar2 + 1);
			}
			uVar4 += 1;
			pBVar2 = pBVar2 + 5;
		} while (uVar4 < globals::g_SelectedUnit_Hotkeys_COUNT);
	}
	uVar4 = 0;
	if (*(int *)(&DAT_004fff20 + BOOL_004fff28 * 4) != 0) {
		do {
			Game_PTLEventToAction__0045db30(MessageAction_ARRAY_ARRAY_004ebf20[BOOL_004fff28] + uVar4);
			uVar4 += 1;
		} while (uVar4 < *(uint *)(&DAT_004fff20 + BOOL_004fff28 * 4));
	}
	BVar1 = BOOL_004fff28;
	iVar5 = *(int *)(&DAT_004fff20 + BOOL_004fff28 * 4);
	*(undefined4 *)(&DAT_004fff20 + BOOL_004fff28 * 4) = 0;
	BOOL_004fff28 = ZEXT14(BOOL_004fff28 == 0);
	*(undefined4 *)(&DAT_004fff20 + BOOL_004fff28 * 4) = 0;
	if (iVar5 != 0) {
		puVar3 = &MessageAction_ARRAY_ARRAY_004ebf20[BVar1][0].field_8;
		do {
			if (true) {
				switch(puVar3[-2]) {
				case 1:
					FUN_00452980((LiveObject *)puVar3[-1],*puVar3);
					break;
				case 3:
					Game_UnselectAllUnits();
					break;
				case 4:
					FUN_00452f10((LiveObject *)puVar3[-1]);
					break;
				case 5:
				case 6:
					FUN_004034f0((int *)puVar3[-1],puVar3 + 1,*puVar3);
					break;
				case 8:
					FUN_004031a0((int *)globals::g_SelectedUnits_TABLE,globals::g_SelectedUnits_COUNT,
											 puVar3 + 1,*puVar3);
					break;
				case 9:
					FUN_00453020(*puVar3);
					break;
				case 10:
					if (globals::g_SelectedUnits_COUNT != 0) {
						FUN_00425c80(globals::g_SelectedUnits_TABLE[0]);
					}
					break;
				case 0xb:
					FUN_00429520(1,NULL,0);
					break;
				case 0xc:
					lego::snd::Snd_Play_FUN_00465260(*puVar3,0);
					break;
				case 0x13:
					FUN_004316b0(puVar3[1],puVar3[2],*puVar3 & 0xffff,(float)(*puVar3 >> 0x10));
					break;
				case 0x15:
					Level_GenerateCrystal((Point2I *)(puVar3 + 1),0,NULL,1);
					break;
				case 0x17:
					FUN_00402650((LiveObject *)puVar3[-1],0.0);
					break;
				case 0x19:
					FUN_00403540((LiveObject *)puVar3[-1],*puVar3);
					break;
				case 0x1b:
					Level_GenerateOre((Point2I *)(puVar3 + 1),0,NULL,1);
					break;
				case 0x1d:
					FUN_00402650((LiveObject *)puVar3[-1],0.0);
					break;
				case 0x1f:
					FUN_0043b160();
					break;
				case 0x21:
					FUN_00447390((LiveObject *)puVar3[-1]);
					break;
				case 0x23:
					FUN_004526f0(puVar3[-1]);
					break;
				case 0x25:
					FUN_004474d0((float *)puVar3[-1],(undefined4 *)*puVar3);
					break;
				case 0x2b:
					FUN_004035f0(puVar3[-1],*puVar3);
					break;
				case 0x2d:
					FUN_00452b80();
					break;
				case 0x34:
					FUN_00439600(puVar3 + 1,0);
					break;
				case 0x36:
					Level_GenerateCryOreAt((Point2I *)(puVar3 + 1));
					break;
				case 0x40:
					FUN_00452f80();
				}
			}
			puVar3 = puVar3 + 5;
			iVar5 += -1;
		} while (iVar5 != 0);
	}
	return;
}



void __cdecl FUN_004526f0(undefined4 param_1)
{
	int iVar1;
	int iVar2;
	bool bVar3;
	short sVar4;
	LevelSurfaceMap *pLVar5;
	BOOL BVar6;
	uint uVar7;
	uint local_8;
	uint local_4;
	
	pLVar5 = lego::game::GetSurfaceMap();
	iVar1 = (pLVar5->smallDimensions).width;
	pLVar5 = lego::game::GetSurfaceMap();
	iVar2 = (pLVar5->smallDimensions).height;
	bVar3 = false;
	uVar7 = 0;
	do {
		sVar4 = lego::util::randomInt16();
		local_8 = (int)sVar4 % iVar1;
		sVar4 = lego::util::randomInt16();
		local_4 = (int)sVar4 % iVar2;
		BVar6 = lego::game::Level_GetBlockFlags1_8(local_8,local_4);
		if (BVar6 != 0) {
			bVar3 = true;
			break;
		}
		uVar7 += 1;
	} while (uVar7 < 1000);
	if (bVar3) {
		lego::game::Level_AddMessageAction(MESSAGE_PICKRANDOMFLOOR_COMPLETE,param_1,0,&local_8);
	}
	return;
}



void __cdecl FUN_00452770(LiveObject *liveObj)
{
	FUN_00452220(liveObj);
	FUN_00452f10(liveObj);
	if (lego::globals::g_Game.object_a0 == liveObj) {
		FUN_00429520(1,NULL,0);
		lego::globals::g_Game.object_a0 = NULL;
	}
	if ((lego::globals::g_Game.structbc_28)->object_4 == liveObj) {
		(lego::globals::g_Game.structbc_28)->object_4 = NULL;
		lego::game::LiveObject_GetPosition
							(liveObj,(float *)&lego::globals::g_Game.tvFaceDirection_338,
							 &lego::globals::g_Game.tvFaceDirection_338.y);
		lego::globals::g_Game.flags1 |= GAME1_UNK_4000;
	}
	return;
}



BOOL __cdecl FUN_004527e0(undefined4 *param_1,uint *param_2)
{
	LiveObject **ppLVar1;
	uint uVar2;
	int iVar3;
	LiveObject **ppLVar4;
	
	if (lego::globals::g_SelectedUnits_COUNT != 0) {
		*param_2 = lego::globals::g_SelectedUnits_COUNT;
		ppLVar1 = (LiveObject **)std::malloc(lego::globals::g_SelectedUnits_COUNT * 4);
		*param_1 = ppLVar1;
		ppLVar4 = lego::globals::g_SelectedUnits_TABLE;
		for (uVar2 = *param_2 & 0x3fffffff; uVar2 != 0; uVar2 -= 1) {
			*ppLVar1 = *ppLVar4;
			ppLVar4 = ppLVar4 + 1;
			ppLVar1 = ppLVar1 + 1;
		}
		for (iVar3 = 0; iVar3 != 0; iVar3 += -1) {
			*(undefined *)ppLVar1 = *(undefined *)ppLVar4;
			ppLVar4 = (LiveObject **)((int)ppLVar4 + 1);
			ppLVar1 = (LiveObject **)((int)ppLVar1 + 1);
		}
		return 1;
	}
	return 0;
}



// Returns a the table of selected units, and can return the number of units in the table with
// out_count

LiveObject * __cdecl lego::game::Game_GetSelectedUnits(int *out_count)
{
	if (globals::g_SelectedUnits_COUNT != 0) {
		if (out_count != NULL) {
			*out_count = globals::g_SelectedUnits_COUNT;
		}
		return (LiveObject *)globals::g_SelectedUnits_TABLE;
	}
	if (out_count != NULL) {
		*out_count = 0;
	}
	return NULL;
}



BOOL __cdecl lego::game::Game_IsAnyUnitsSelected(void)
{
	return (uint)(globals::g_SelectedUnits_COUNT != 0);
}



LiveObject * __cdecl lego::game::Game_GetPrimarySelectedObject(void)
{
										// Return the first-selected Object if count is non-zero (otherwise address is
										// masked against 0x0)
	return (LiveObject *)
				 (-(uint)(globals::g_SelectedUnits_COUNT != 0) & (uint)globals::g_SelectedUnits_TABLE[0]);
}



LiveObject ** __cdecl lego::game::Game_GetSelectedUnits(void)
{
	return globals::g_SelectedUnits_TABLE;
}



uint __cdecl lego::game::Game_GetNumSelectedUnits(void)
{
	return globals::g_SelectedUnits_COUNT;
}



void __cdecl lego::game::Game_CleanupSelectedUnitsCount(void)
{
	globals::g_SelectedUnits_COUNT = 0;
	return;
}



BOOL __cdecl FUN_004528d0(LiveObject *liveObj,uint *out_index)
{
	LiveFlags3 LVar1;
	
	if (out_index != NULL) {
		LVar1 = lego::game::LiveObject_FindIndexOfInTable
											(lego::globals::g_SelectedUnits_TABLE,lego::globals::g_SelectedUnits_COUNT,
											 liveObj,out_index);
		return LVar1;
	}
	return liveObj->flags3_3e8 & 0x200000;
}



BOOL __cdecl
lego::game::LiveObject_FindIndexOfInTable
					(LiveObject **objsTable,uint objsCount,LiveObject *thisObj,uint *out_index)
{
	uint uVar1;
	
	uVar1 = 0;
	if (objsCount == 0) {
		return 0;
	}
	do {
		if (*objsTable == thisObj) {
			if (out_index != NULL) {
				*out_index = uVar1;
			}
			return 1;
		}
		uVar1 += 1;
		objsTable = objsTable + 1;
	} while (uVar1 < objsCount);
	return 0;
}



BOOL __cdecl FUN_00452950(LiveObject *liveObj)
{
	BOOL BVar1;
	
	BVar1 = FUN_004528d0(liveObj,NULL);
	if ((BVar1 == 0) && ((*(byte *)&liveObj->flags4_3ec & 2) == 0)) {
		return 0;
	}
	return 1;
}



BOOL __cdecl FUN_00452980(LiveObject *liveObj,int param_2)
{
	BOOL BVar1;
	
	BVar1 = FUN_004529a0(liveObj,param_2,1);
	return BVar1;
}



BOOL __cdecl FUN_004529a0(LiveObject *liveObj,int param_2,int param_3)
{
	BOOL BVar1;
	ObjectStatsFlags1 OVar2;
	ResourceData *resData;
	Point2F local_14;
	Vector3F local_c;
	
	if (liveObj->carryingThisObject != NULL) {
		liveObj = liveObj->carryingThisObject;
	}
	BVar1 = FUN_00452b30(liveObj);
	if (BVar1 != 0) {
		if (param_2 == 0) {
			BVar1 = FUN_00452950(liveObj);
			if (BVar1 != 0) {
				FUN_0044c760(liveObj);
				return 0;
			}
		}
		BVar1 = FUN_004528d0(liveObj,NULL);
		if ((BVar1 == 0) && (lego::globals::g_SelectedUnits_COUNT < 100)) {
			FUN_00437a70(FUN_0044c7c0,NULL);
			lego::globals::g_SelectedUnits_TABLE[lego::globals::g_SelectedUnits_COUNT] = liveObj;
			lego::globals::g_SelectedUnits_COUNT += 1;
			liveObj->flags3_3e8 = liveObj->flags3_3e8 | 0x200000;
			if ((liveObj->objType != OBJECT_BUILDING) &&
				 (((liveObj->flags1_3e0 & 0x24002000) == LIVEOBJ1_NONE &&
					((liveObj->flags2_3e4 & 0x100) == LIVEOBJ2_NONE)))) {
				lego::game::LiveObject_UnkDoRouting_FUN_00441c00(liveObj,0);
				FUN_00403a90(liveObj);
				if ((liveObj->objType == OBJECT_MINIFIGURE) && (param_3 != 0)) {
					lego::res::Res_GetOrientation
										((lego::globals::g_Game.structbc_24)->resData_30,NULL,&local_c,NULL);
					local_14.x = -local_c.x;
					local_14.y = -local_c.y;
					FUN_00441df0(liveObj,0,0);
					FUN_00445270(liveObj,&local_14);
				}
			}
			if ((*(byte *)&liveObj->flags3_3e8 & 0x80) != 0) {
				OVar2 = lego::game::LiveObject_GetStatsFlags1(liveObj);
				if (((OVar2 & STATS1_CANBEDRIVEN) == STATS1_NONE) || (liveObj->drivenObject != NULL)) {
					resData = lego::game::LiveObject_GetResource(liveObj);
					lego::res::Res_PlayResourceSound(resData,0x11,0,1,NULL);
					return 1;
				}
			}
		}
	}
	return 0;
}



BOOL __cdecl FUN_00452b30(LiveObject *liveObj)
{
	BOOL BVar1;
	
	if ((liveObj->flags3_3e8 & 0x100) != LIVEOBJ3_NONE) {
		BVar1 = FUN_00438870(liveObj,1);
		if ((((BVar1 != 0) && ((*(byte *)&liveObj->flags2_3e4 & 10) == 0)) &&
				((liveObj->flags1_3e0 & 0x24000000) == LIVEOBJ1_NONE)) &&
			 ((liveObj->objType != OBJECT_VEHICLE ||
				((liveObj->flags1_3e0 & LIVEOBJ1_CLEARING) == LIVEOBJ1_NONE)))) {
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_00452b80(void)
{
	LiveObject *pLVar1;
	ObjectType OVar2;
	LiveObject *pLVar3;
	bool bVar4;
	bool bVar5;
	bool bVar6;
	bool bVar7;
	bool bVar8;
	bool bVar9;
	bool bVar10;
	bool bVar11;
	ObjectStatsFlags1 OVar12;
	LiveObject **ppLVar13;
	uint uVar14;
	int iVar15;
	
	uVar14 = 0;
	bVar5 = false;
	bVar6 = false;
	bVar8 = false;
	bVar7 = false;
	bVar9 = false;
	bVar10 = false;
	bVar11 = false;
	if (lego::globals::g_SelectedUnits_COUNT != 0) {
		ppLVar13 = lego::globals::g_SelectedUnits_TABLE;
		do {
			pLVar1 = *ppLVar13;
			if ((pLVar1->objType == OBJECT_MINIFIGURE) && (pLVar1->drivenObject == NULL)) {
				bVar5 = true;
				break;
			}
			OVar12 = lego::game::LiveObject_GetStatsFlags1(pLVar1);
			if ((OVar12 & STATS1_CANBEDRIVEN) == STATS1_NONE) {
				OVar2 = pLVar1->objType;
				if (OVar2 == OBJECT_VEHICLE) {
					OVar12 = lego::game::LiveObject_GetStatsFlags1(pLVar1);
					if (((OVar12 & STATS1_CROSSLAND) == STATS1_NONE) &&
						 ((*(byte *)&pLVar1->flags4_3ec & 0x40) == 0)) {
						bVar7 = true;
					}
					else {
						bVar6 = true;
					}
				}
				else {
					if (OVar2 == OBJECT_BUILDING) {
						bVar9 = true;
					}
					else {
						if ((OVar2 == OBJECT_ELECTRICFENCE) &&
							 ((pLVar1->flags2_3e4 & 0x2000000) != LIVEOBJ2_NONE)) {
							bVar10 = true;
						}
					}
				}
			}
			else {
				if (pLVar1->drivenObject == NULL) {
					bVar8 = true;
				}
				else {
					OVar12 = lego::game::LiveObject_GetStatsFlags1(pLVar1);
					if (((OVar12 & STATS1_CROSSLAND) == STATS1_NONE) &&
						 ((*(byte *)&pLVar1->flags4_3ec & 0x40) == 0)) {
						bVar7 = true;
					}
					else {
						bVar6 = true;
					}
				}
			}
			uVar14 += 1;
			ppLVar13 = ppLVar13 + 1;
		} while (uVar14 < lego::globals::g_SelectedUnits_COUNT);
	}
	uVar14 = 0;
	if (bVar5) {
		FUN_0041b200(9,NULL);
		bVar7 = false;
		bVar6 = false;
		bVar8 = false;
		bVar9 = false;
		bVar10 = false;
	}
	else {
		if (bVar6) {
			FUN_0041b200(10,NULL);
			bVar7 = false;
			bVar8 = false;
			bVar9 = false;
			bVar10 = false;
		}
		else {
			if (bVar7) {
				FUN_0041b200(0xb,NULL);
				bVar8 = false;
				bVar9 = false;
				bVar10 = false;
			}
			else {
				if (bVar8) {
					FUN_0041b200(0xc,NULL);
					bVar9 = false;
					bVar10 = false;
				}
				else {
					if (bVar9) {
						FUN_0041b200(0xd,NULL);
						bVar10 = false;
					}
					else {
						bVar11 = !bVar10;
						if (bVar11) {
							iVar15 = 0;
						}
						else {
							iVar15 = 0xe;
						}
						FUN_0041b200(iVar15,NULL);
					}
				}
			}
		}
	}
	if (lego::globals::g_SelectedUnits_COUNT != 0) {
		ppLVar13 = lego::globals::g_SelectedUnits_TABLE;
		do {
			pLVar1 = *ppLVar13;
			bVar4 = false;
			if ((bVar5) && ((pLVar1->objType != OBJECT_MINIFIGURE || (pLVar1->drivenObject != NULL))))
			goto LAB_00452e44;
			if (bVar6) {
				OVar12 = lego::game::LiveObject_GetStatsFlags1(pLVar1);
				if ((OVar12 & STATS1_CANBEDRIVEN) == STATS1_NONE) {
LAB_00452df3:
					if (pLVar1->objType != OBJECT_VEHICLE) goto LAB_00452e44;
				}
				else {
					OVar12 = lego::game::LiveObject_GetStatsFlags1(pLVar1);
					if (((OVar12 & STATS1_CROSSLAND) == STATS1_NONE) &&
						 ((*(byte *)&pLVar1->flags4_3ec & 0x40) == 0)) {
LAB_00452de2:
						bVar4 = true;
					}
LAB_00452de7:
					pLVar3 = pLVar1->drivenObject;
joined_r0x00452e42:
					if (pLVar3 == NULL) goto LAB_00452e44;
				}
			}
			else {
				if (bVar7) {
					OVar12 = lego::game::LiveObject_GetStatsFlags1(pLVar1);
					if ((OVar12 & STATS1_CANBEDRIVEN) == STATS1_NONE) goto LAB_00452df3;
					OVar12 = lego::game::LiveObject_GetStatsFlags1(pLVar1);
					if (((OVar12 & STATS1_CROSSLAND) != STATS1_NONE) ||
						 ((*(byte *)&pLVar1->flags4_3ec & 0x40) != 0)) goto LAB_00452de2;
					goto LAB_00452de7;
				}
				if (bVar8) {
					OVar12 = lego::game::LiveObject_GetStatsFlags1(pLVar1);
					if ((OVar12 & STATS1_CANBEDRIVEN) != STATS1_NONE) {
						pLVar3 = pLVar1->drivenObject;
						goto joined_r0x00452e42;
					}
				}
				else {
					if ((!bVar9) || (pLVar1->objType == OBJECT_BUILDING)) {
						if (!bVar10) goto LAB_00452e49;
						if (pLVar1->objType == OBJECT_ELECTRICFENCE) {
							pLVar3 = (LiveObject *)(pLVar1->flags2_3e4 & 0x2000000);
							goto joined_r0x00452e42;
						}
					}
				}
LAB_00452e44:
				bVar4 = true;
			}
LAB_00452e49:
			if ((bVar4) || (bVar11)) {
				lego::globals::g_SelectedUnits_COUNT -= 1;
				*ppLVar13 = lego::globals::g_SelectedUnits_TABLE[lego::globals::g_SelectedUnits_COUNT];
				uVar14 -= 1;
				pLVar1->flags3_3e8 = pLVar1->flags3_3e8 & 0xffdfffff;
				ppLVar13 = ppLVar13 + -1;
			}
			uVar14 += 1;
			ppLVar13 = ppLVar13 + 1;
		} while (uVar14 < lego::globals::g_SelectedUnits_COUNT);
	}
	return;
}



void __cdecl lego::game::Game_UnselectAllUnits(void)
{
	LiveFlags4 *pLVar1;
	LiveObject **ppLVar2;
	uint uVar3;
	
	uVar3 = 0;
	if (globals::g_SelectedUnits_COUNT != 0) {
		ppLVar2 = globals::g_SelectedUnits_TABLE;
		do {
			if (((*ppLVar2)->flags3_3e8 & 0x200000) != LIVEOBJ3_NONE) {
				pLVar1 = &(*ppLVar2)->flags4_3ec;
				*pLVar1 = *pLVar1 | 2;
			}
			(*ppLVar2)->flags3_3e8 = (*ppLVar2)->flags3_3e8 & 0xffdfffff;
			(*ppLVar2)->flags4_3ec = (*ppLVar2)->flags4_3ec & 0xfffffffe;
			uVar3 += 1;
			ppLVar2 = ppLVar2 + 1;
		} while (uVar3 < globals::g_SelectedUnits_COUNT);
	}
	globals::g_SelectedUnits_COUNT = 0;
	return;
}



BOOL __cdecl FUN_00452f10(LiveObject *liveObj)
{
	LiveObject *pLVar1;
	BOOL BVar2;
	
	pLVar1 = liveObj;
	if (lego::globals::g_SelectedUnits_COUNT != 0) {
		BVar2 = FUN_004528d0(liveObj,(uint *)&liveObj);
		if (BVar2 != 0) {
			if (liveObj == NULL) {
				FUN_0041b200(0,NULL);
			}
										// param_1 is no longer liveObject, transformed by first function call of this
										// function
			lego::globals::g_SelectedUnits_COUNT -= 1;
			lego::globals::g_SelectedUnits_TABLE[(int)liveObj] =
					 lego::globals::g_SelectedUnits_TABLE[lego::globals::g_SelectedUnits_COUNT];
			pLVar1->flags3_3e8 = pLVar1->flags3_3e8 & 0xffdfffff;
			return 1;
		}
	}
	return 0;
}



int __cdecl FUN_00452f80(void)
{
	LiveObject *pLVar1;
	ObjectStatsFlags1 OVar2;
	uint uVar3;
	
	uVar3 = lego::globals::g_SelectedUnits_COUNT;
	if (lego::globals::g_SelectedUnits_COUNT != 0) {
		do {
			OVar2 = lego::game::LiveObject_GetStatsFlags1(lego::globals::g_SelectedUnits_TABLE[0]);
			if (((OVar2 & STATS1_CANBEDRIVEN) != STATS1_NONE) &&
				 (pLVar1 = lego::globals::g_SelectedUnits_TABLE[0]->drivenObject, pLVar1 != NULL)) {
				pLVar1->flags2_3e4 = pLVar1->flags2_3e4 & ~LIVEOBJ2_DRIVING;
				lego::globals::g_SelectedUnits_TABLE[0]->drivenObject->drivenObject = NULL;
			}
			if (lego::globals::g_SelectedUnits_TABLE[0]->objType == OBJECT_BUILDING) {
				FUN_00409f20(lego::globals::g_SelectedUnits_TABLE[0]);
			}
			else {
				if (lego::globals::g_SelectedUnits_TABLE[0]->objType == OBJECT_ELECTRICFENCE) {
					FUN_0040cfd0(lego::globals::g_SelectedUnits_TABLE[0]);
				}
				lego::pool::ReservedPool_LiveObject___Release(lego::globals::g_SelectedUnits_TABLE[0]);
			}
			uVar3 -= 1;
		} while (uVar3 != 0);
	}
	return lego::globals::g_SelectedUnits_COUNT;
}



BOOL __cdecl FUN_00453020(int param_1)
{
	LiveObject *liveObj;
	LiveObject **ppLVar1;
	uint uVar2;
	
	if (((lego::globals::g_Game.object_a0 != NULL) &&
			((*(byte *)&(lego::globals::g_Game.object_a0)->flags3_3e8 & 0x10) != 0)) &&
		 ((liveObj = lego::globals::g_Game.object_a0,
			(lego::globals::g_Game.object_a0)->objType == OBJECT_MINIFIGURE ||
			((lego::globals::g_Game.object_a0)->drivenObject != NULL)))) {
LAB_00453096:
		FUN_00429520(0,liveObj,param_1);
		return 1;
	}
	uVar2 = 0;
	if (lego::globals::g_SelectedUnits_COUNT != 0) {
		ppLVar1 = lego::globals::g_SelectedUnits_TABLE;
		do {
			liveObj = *ppLVar1;
			if ((liveObj->objType == OBJECT_MINIFIGURE) && (liveObj->drivenObject != NULL)) {
				liveObj = liveObj->drivenObject;
			}
			if (((*(byte *)&liveObj->flags3_3e8 & 0x10) != 0) &&
				 ((liveObj->objType == OBJECT_MINIFIGURE || (liveObj->drivenObject != NULL))))
			goto LAB_00453096;
			uVar2 += 1;
			ppLVar1 = ppLVar1 + 1;
		} while (uVar2 < lego::globals::g_SelectedUnits_COUNT);
	}
	return 0;
}



BOOL __cdecl lego::game::Level_LoadNERPsFile(char *filename)
{
	int iVar1;
	BOOL *pBVar2;
	int *piVar3;
	int local_4;
	
	pBVar2 = &globals::nerps::g_NERPs_Camera_IsLockedOn;
	for (iVar1 = 0x2d; iVar1 != 0; iVar1 += -1) {
		*pBVar2 = 0;
		pBVar2 = pBVar2 + 1;
	}
	local_4 = 1;
	FUN_0046ad50();
	globals::nerps::g_NERPs_FileLength = 0;
	piVar3 = globals::nerps::g_NERPs_REGISTERS_TABLE;
	for (iVar1 = 0xb; iVar1 != 0; iVar1 += -1) {
		*piVar3 = 0;
		piVar3 = piVar3 + 1;
	}
	globals::nerps::g_NERPs_FileData = NULL;
	globals::nerps::g_NERPs_IsLoaded = 1;
	nerps::funcs::NERPFunc__SetMessagePermit(&local_4);
	globals::nerps::g_NERPs_FileData =
			 lego::file::File_ReadAllBytes(filename,&globals::nerps::g_NERPs_FileLength);
	return (uint)((byte *)globals::nerps::g_NERPs_FileData != NULL);
}



// WARNING: Function: _alloca4k replaced with injection: alloca_probe

BOOL __cdecl lego::game::Level_LoadNERPMessageFile(char *filename)
{
	NERPMessageSound *pNVar1;
	char cVar2;
	byte bVar3;
	IDirectDrawSurface4 **ppIVar4;
	char *buffer;
	ImageBMP *pIVar5;
	void *pvVar6;
	char *pcVar7;
	int iVar8;
	NERPMessageSound *pNVar9;
	uint uVar10;
	undefined4 *puVar11;
	undefined4 *puVar12;
	byte *pbVar13;
	uint uVar14;
	int iVar15;
	bool bVar16;
	int iStack8464;
	byte *pbStack8460;
	undefined4 *puStack8456;
	int iStack8452;
	char acStack8448 [128];
	ImageBMP aIStack8320 [4];
	char acStack8192 [4096];
	char local_1000 [4092];
	undefined4 uStack4;
	
	uStack4 = 0x45313a;
	bVar16 = true;
	iStack8464 = 0;
	buffer = (char *)lego::file::File_ReadAllBytes(filename,(uint *)&pbStack8460);
	if (buffer == NULL) {
		globals::nerps::g_NERPMessageBuffer = buffer;
		globals::nerps::g_NERPMessageSounds_UNKCOUNT = globals::nerps::g_NERPMessageSounds_COUNT;
		return 0;
	}
	globals::nerps::g_NERPMessageBuffer = buffer;
	if (pbStack8460 != NULL) {
		iStack8452 = 0;
		pbVar13 = pbStack8460;
		do {
			if (*buffer == '_') {
				*buffer = ' ';
			}
			bVar3 = *buffer;
			pIVar5 = (ImageBMP *)((uint)pbVar13 & 0xffffff00 | (uint)bVar3);
			if (bVar3 < 0x20) {
				*buffer = 0;
				bVar16 = true;
			}
			else {
				if (bVar16) {
					if (bVar3 == ':') {
						pIVar5 = aIStack8320;
						pbVar13 = (byte *)buffer + 1;
						std::sscanf((char *)pbVar13,"%s",pIVar5);
						buffer = (char *)pbVar13;
						if (pIVar5 != NULL) {
							uVar14 = 0xffffffff;
							pIVar5 = aIStack8320;
							do {
								if (uVar14 == 0) break;
								uVar14 -= 1;
								ppIVar4 = &pIVar5->ddSurface;
								pIVar5 = (ImageBMP *)((int)&pIVar5->ddSurface + 1);
							} while (*(char *)ppIVar4 != '\0');
							bVar16 = false;
							buffer = (char *)(pbVar13 + (~uVar14 - 1));
							bVar3 = *buffer;
							for (; (pIVar5 = (ImageBMP *)(uint)bVar3, bVar3 < 0x21 &&
										 ((byte *)buffer + -(int)globals::nerps::g_NERPMessageBuffer < pbStack8460));
									buffer = (char *)((byte *)buffer + 1)) {
								if (bVar3 == '\r') {
									bVar16 = true;
								}
								*buffer = 0;
								bVar3 = ((byte *)buffer)[1];
							}
							std::sscanf(buffer,"%s",acStack8448);
							if ((pIVar5 != NULL) && (!bVar16)) {
								uVar14 = 0xffffffff;
								pcVar7 = acStack8448;
								do {
									if (uVar14 == 0) break;
									uVar14 -= 1;
									cVar2 = *pcVar7;
									pcVar7 = pcVar7 + 1;
								} while (cVar2 != '\0');
								buffer = (char *)((byte *)buffer + (~uVar14 - 1));
								pIVar5 = image::Image_LoadBMP(acStack8448,0,0);
								if (pIVar5 != NULL) {
									pvVar6 = std::malloc(globals::nerps::g_NERPMessages_COUNT * 8 + 8);
									uVar14 = 0;
									bVar16 = globals::nerps::g_NERPMessages_COUNT == 0;
									if (!bVar16) {
										do {
											puVar11 = (undefined4 *)
																((int)globals::nerps::g_NERPMessages_TABLE + uVar14 * 8);
											uVar14 += 1;
											*(undefined4 *)((int)pvVar6 + uVar14 * 8 + -8) = *puVar11;
											*(undefined4 *)((int)pvVar6 + uVar14 * 8 + -4) = puVar11[1];
										} while (uVar14 < (uint)globals::nerps::g_NERPMessages_COUNT);
										bVar16 = globals::nerps::g_NERPMessages_COUNT == 0;
									}
									if (!bVar16) {
										std::free(globals::nerps::g_NERPMessages_TABLE);
									}
									*(byte **)((int)pvVar6 + globals::nerps::g_NERPMessages_COUNT * 8) = pbVar13;
									*(ImageBMP **)((int)pvVar6 + globals::nerps::g_NERPMessages_COUNT * 8 + 4) =
											 pIVar5;
									pIVar5 = (ImageBMP *)(globals::nerps::g_NERPMessages_COUNT + 1);
									globals::nerps::g_NERPMessages_COUNT = (int)pIVar5;
									globals::nerps::g_NERPMessages_TABLE = pvVar6;
								}
							}
						}
					}
					iVar8 = iStack8452;
					if (*buffer == '$') {
						pbVar13 = (byte *)buffer + 1;
						std::sscanf((char *)pbVar13,"%s",local_1000);
						buffer = (char *)pbVar13;
						if (pIVar5 != NULL) {
							uVar14 = 0xffffffff;
							pcVar7 = local_1000;
							do {
								if (uVar14 == 0) break;
								uVar14 -= 1;
								cVar2 = *pcVar7;
								pcVar7 = pcVar7 + 1;
							} while (cVar2 != '\0');
							bVar16 = false;
							buffer = (char *)(pbVar13 + (~uVar14 - 1));
							bVar3 = *buffer;
							for (; (bVar3 < 0x21 &&
										 ((byte *)buffer + -(int)globals::nerps::g_NERPMessageBuffer < pbStack8460));
									buffer = (char *)((byte *)buffer + 1)) {
								if (bVar3 == '\r') {
									bVar16 = true;
								}
								*buffer = 0;
								bVar3 = ((byte *)buffer)[1];
							}
							pcVar7 = acStack8192;
							std::sscanf(buffer,"%s",pcVar7);
							if ((pcVar7 != NULL) && (!bVar16)) {
								uVar14 = 0xffffffff;
								pcVar7 = acStack8192;
								do {
									if (uVar14 == 0) break;
									uVar14 -= 1;
									cVar2 = *pcVar7;
									pcVar7 = pcVar7 + 1;
								} while (cVar2 != '\0');
								buffer = (char *)((byte *)buffer + (~uVar14 - 1));
								iVar8 = lego::snd::Sample_Load(acStack8192,1,0,0);
								if (iVar8 != 0) {
									pNVar9 = (NERPMessageSound *)
													 std::malloc(globals::nerps::g_NERPMessageSounds_COUNT * 8 + 8);
									bVar16 = globals::nerps::g_NERPMessageSounds_COUNT == 0;
									uVar14 = 0;
									if (!bVar16) {
										do {
											pNVar1 = globals::nerps::g_NERPMessageSounds_TABLE + uVar14;
											uVar10 = uVar14 + 1;
											pNVar9[uVar14].key = pNVar1->key;
											pNVar9[uVar14].sampleIndex = pNVar1->sampleIndex;
											uVar14 = uVar10;
										} while (uVar10 < (uint)globals::nerps::g_NERPMessageSounds_COUNT);
										bVar16 = globals::nerps::g_NERPMessageSounds_COUNT == 0;
									}
									if (!bVar16) {
										std::free(globals::nerps::g_NERPMessageSounds_TABLE);
									}
									pNVar9[globals::nerps::g_NERPMessageSounds_COUNT].key = (char *)pbVar13;
									pNVar9[globals::nerps::g_NERPMessageSounds_COUNT].sampleIndex = iVar8;
									globals::nerps::g_NERPMessageSounds_COUNT += 1;
									globals::nerps::g_NERPMessageSounds_TABLE = pNVar9;
									globals::nerps::g_NERPMessageSounds_UNKCOUNT =
											 globals::nerps::g_NERPMessageSounds_COUNT;
								}
							}
						}
					}
					else {
						puVar11 = (undefined4 *)std::malloc(iStack8452 + 4);
						if (iVar8 != 0) {
							puVar12 = puVar11;
							iVar15 = iStack8464;
							do {
								*puVar12 = *(undefined4 *)((int)((int)puStack8456 - (int)puVar11) + (int)puVar12);
								puVar12 = puVar12 + 1;
								iVar15 += -1;
							} while (iVar15 != 0);
						}
						if (iVar8 != 0) {
							std::free(puStack8456);
						}
						*(char **)((int)puVar11 + iVar8) = buffer;
						iStack8464 += 1;
						iStack8452 = iVar8 + 4;
						puStack8456 = puVar11;
					}
				}
				bVar16 = false;
			}
			buffer = (char *)((byte *)buffer + 1);
			pbVar13 = (byte *)buffer + -(int)globals::nerps::g_NERPMessageBuffer;
		} while (pbVar13 < pbStack8460);
	}
	DAT_00556da4 = iStack8464;
	DAT_00556da8 = puStack8456;
	return 1;
}



undefined4 __cdecl FUN_004534c0(uint param_1)
{
	if (param_1 < DAT_00556da4) {
		return *(undefined4 *)(DAT_00556da8 + param_1 * 4);
	}
	return 0;
}



undefined4 FUN_004534e0(void)
{
	int iVar1;
	uint uVar2;
	BOOL *pBVar3;
	
	if (lego::globals::nerps::g_NERPs_FileLength != 0) {
		std::free(lego::globals::nerps::g_NERPs_FileData);
	}
	if (lego::globals::nerps::g_NERPMessageBuffer != NULL) {
		std::free(lego::globals::nerps::g_NERPMessageBuffer);
		if (DAT_00556da8 != NULL) {
			std::free(DAT_00556da8);
		}
	}
	uVar2 = 0;
	lego::globals::nerps::g_NERPMessageBuffer = NULL;
	DAT_00556da8 = NULL;
	DAT_00556da4 = 0;
	lego::globals::nerps::g_NERPs_FileLength = 0;
	if (lego::globals::nerps::g_NERPMessageSounds_COUNT != 0) {
		do {
			lego::snd::Sample_CloseStreamed
								(lego::globals::nerps::g_NERPMessageSounds_TABLE[uVar2].sampleIndex);
			uVar2 += 1;
		} while (uVar2 < (uint)lego::globals::nerps::g_NERPMessageSounds_COUNT);
		if (lego::globals::nerps::g_NERPMessageSounds_COUNT != 0) {
			if (lego::globals::nerps::g_NERPMessageSounds_TABLE != NULL) {
				std::free(lego::globals::nerps::g_NERPMessageSounds_TABLE);
				lego::globals::nerps::g_NERPMessageSounds_TABLE = NULL;
			}
			lego::globals::nerps::g_NERPMessageSounds_COUNT = 0;
		}
	}
	pBVar3 = &lego::globals::nerps::g_NERPs_Camera_IsLockedOn;
	for (iVar1 = 0x2d; iVar1 != 0; iVar1 += -1) {
		*pBVar3 = 0;
		pBVar3 = pBVar3 + 1;
	}
	FUN_0046ad50();
	return 1;
}



void __cdecl lego::nerps::NERPs_UnkReserveStack__004535a0(uint *param_1)
{
	uint uVar1;
	
	uVar1 = *param_1;
	if (((uVar1 & 0xffff0000) == 0x20000) &&
		 (globals::nerps::g_NERPs_FUNCTIONS_TABLE[uVar1 & 0xffff].arguments == NERPS_ARGS_0)) {
		uVar1 = (*globals::nerps::g_NERPs_FUNCTIONS_TABLE[uVar1 & 0xffff].function)(NULL);
	}
	*param_1 = uVar1;
	return;
}



void __cdecl lego::nerps::NERPs_Exec__004535e0(float param_1)
{
	NERPSFunctionArgs NVar1;
	void *pvVar2;
	uint uVar3;
	uint uVar4;
	uint uVar5;
	uint uVar6;
	int iVar7;
	uint uVar8;
	uint uVar9;
	uint uVar10;
	uint local_220;
	uint local_21c;
	uint local_210;
	uint local_20c;
	uint local_208;
	uint local_204;
	char local_200 [512];
	
	pvVar2 = globals::nerps::g_NERPs_FileData;
	uVar5 = 0;
	if (globals::nerps::g_NERPs_FileData != NULL) {
		local_204 = globals::nerps::g_NERPs_FileLength >> 2;
		local_220 = 0;
		uVar10 = 0;
		uVar8 = 0;
		uVar4 = local_21c;
		if (local_204 != 0) {
			do {
				iVar7 = 0;
				uVar3 = *(uint *)((int)pvVar2 + local_220 * 4);
				if ((uVar3 & 0x20000) == 0) {
					if ((uVar3 & 0x10000) == 0) {
						if ((uVar3 & 0x40000) == 0) {
							if ((uVar3 & 0x80000) == 0) {
								uVar4 = SEXT24(*(short *)((int)pvVar2 + local_220 * 4));
								if (uVar5 != 0) {
									uVar4 = (uint)(uVar4 == 0);
								}
								uVar5 = uVar4;
								local_21c = uVar4;
								if (uVar8 != 0) {
									if (uVar8 == 1) {
										if ((uVar10 == 0) || (uVar5 = uVar8, uVar4 == 0)) {
LAB_00453acb:
											uVar5 = 0;
										}
									}
									else {
										if (uVar8 == 2) {
											if ((uVar10 == 0) && (uVar4 == 0)) goto LAB_00453acb;
											uVar5 = 1;
										}
										else {
											if (uVar8 == 3) {
												uVar5 = (uint)(uVar4 < uVar10);
											}
											else {
												if (uVar8 == 4) {
													uVar5 = (uint)(uVar10 < uVar4);
												}
												else {
													if (uVar8 == 5) {
														uVar5 = (uint)(uVar10 == uVar4);
													}
													else {
														if (uVar8 == 6) {
															uVar5 = (uint)(uVar4 <= uVar10);
														}
														else {
															if (uVar8 != 7) goto joined_r0x00453b1b;
															uVar5 = (uint)(uVar10 <= uVar4);
														}
													}
												}
											}
										}
									}
								}
								goto LAB_00453b28;
							}
							if (uVar10 != 0) {
								local_220 = uVar3 & 0xffff;
							}
LAB_00453a74:
							uVar10 = 0;
							uVar5 = 0;
							uVar9 = 0;
						}
						else {
							uVar10 = 0;
							uVar5 = 0;
							uVar9 = 0;
						}
					}
					else {
						uVar6 = 0;
						uVar3 &= 0xffff;
						uVar5 = uVar10;
						if (uVar3 == 0) goto LAB_00453b28;
						uVar5 = uVar6;
						uVar9 = uVar3;
						if ((uVar3 != 2) && (uVar5 = uVar3, uVar9 = uVar8, uVar3 != 1)) {
							if (uVar3 == 5) {
								uVar5 = uVar6;
								uVar9 = 3;
							}
							else {
								if (uVar3 == 6) {
									uVar5 = uVar6;
									uVar9 = 4;
								}
								else {
									if (uVar3 == 7) {
										uVar5 = uVar6;
										uVar9 = 5;
									}
									else {
										if (uVar3 == 8) {
											uVar5 = uVar6;
											uVar9 = 6;
										}
										else {
											if (uVar3 == 9) {
												uVar5 = uVar6;
												uVar9 = 7;
											}
											else {
												uVar5 = uVar6;
												if (uVar3 == 10) {
													uVar9 = 8;
												}
											}
										}
									}
								}
							}
						}
					}
				}
				else {
					uVar3 &= 0xffff;
					if ((uVar3 == 0) && ((uVar10 != 0 || (uVar8 == 0)))) break;
					NVar1 = globals::nerps::g_NERPs_FUNCTIONS_TABLE[uVar3].arguments;
					if (NVar1 == NERPS_ARGS_0) {
LAB_0045383f:
						uVar4 = (*globals::nerps::g_NERPs_FUNCTIONS_TABLE[uVar3].function)(NULL);
						local_21c = uVar4;
					}
					else {
						if ((NVar1 != NERPS_ARGS_1) && (NVar1 != NERPS_ARGS_2)) {
							if (NVar1 == NERPS_ARGS_0_NORETURN) {
								if (uVar10 == 0) goto LAB_00453a74;
								if (DAT_00500998 != 0) {
									std::sprintf(local_200,"Func Call %s",
															 globals::nerps::g_NERPs_FUNCTIONS_TABLE[uVar3].name);
								}
								(*globals::nerps::g_NERPs_FUNCTIONS_TABLE
									[*(uint *)((int)pvVar2 + local_220 * 4) & 0xffff].function)(NULL);
								uVar10 = 0;
								uVar4 = local_21c;
								uVar5 = 0;
								uVar9 = 0;
							}
							else {
								if (NVar1 == NERPS_ARGS_1_NORETURN) {
									if (uVar10 != 0) {
										if (DAT_00500998 != 0) {
											std::sprintf(local_200,"Func Call %s",
																	 globals::nerps::g_NERPs_FUNCTIONS_TABLE[uVar3].name);
										}
										local_210 = *(uint *)((int)pvVar2 + local_220 * 4 + 4);
										NERPs_UnkReserveStack__004535a0(&local_210);
										(*globals::nerps::g_NERPs_FUNCTIONS_TABLE
											[*(uint *)((int)pvVar2 + local_220 * 4) & 0xffff].function)((int *)&local_210)
										;
										uVar4 = local_21c;
									}
									local_220 += 1;
								}
								else {
									if (NVar1 == NERPS_ARGS_2_NORETURN) {
										if (uVar10 != 0) {
											local_210 = *(uint *)((int)pvVar2 + local_220 * 4 + 4);
											local_20c = *(uint *)((int)pvVar2 + local_220 * 4 + 8);
											NERPs_UnkReserveStack__004535a0(&local_210);
											NERPs_UnkReserveStack__004535a0(&local_20c);
											(*globals::nerps::g_NERPs_FUNCTIONS_TABLE
												[*(uint *)((int)pvVar2 + local_220 * 4) & 0xffff].function)
																((int *)&local_210);
											uVar4 = local_21c;
										}
										local_220 += 2;
									}
									else {
										uVar9 = uVar8;
										if (NVar1 != NERPS_ARGS_3_NORETURN) goto LAB_00453b2d;
										if (uVar10 != 0) {
											local_210 = *(uint *)((int)pvVar2 + local_220 * 4 + 4);
											local_20c = *(uint *)((int)pvVar2 + local_220 * 4 + 8);
											local_208 = *(uint *)((int)pvVar2 + local_220 * 4 + 0xc);
											NERPs_UnkReserveStack__004535a0(&local_210);
											NERPs_UnkReserveStack__004535a0(&local_20c);
											NERPs_UnkReserveStack__004535a0(&local_208);
											(*globals::nerps::g_NERPs_FUNCTIONS_TABLE
												[*(uint *)((int)pvVar2 + local_220 * 4) & 0xffff].function)
																((int *)&local_210);
											uVar4 = local_21c;
										}
										local_220 += 3;
									}
								}
								uVar10 = 0;
								uVar5 = 0;
								uVar9 = 0;
							}
							goto LAB_00453b2d;
						}
						if (NVar1 == NERPS_ARGS_0) goto LAB_0045383f;
						if (NVar1 == NERPS_ARGS_1) {
							local_210 = *(uint *)((int)pvVar2 + local_220 * 4 + 4);
							NERPs_UnkReserveStack__004535a0(&local_210);
							uVar4 = (*globals::nerps::g_NERPs_FUNCTIONS_TABLE
												[*(uint *)((int)pvVar2 + local_220 * 4) & 0xffff].function)
																((int *)&local_210);
							iVar7 = 1;
							local_21c = uVar4;
						}
						else {
							if (NVar1 == NERPS_ARGS_2) {
								local_210 = *(uint *)((int)pvVar2 + local_220 * 4 + 4);
								local_20c = *(uint *)((int)pvVar2 + local_220 * 4 + 8);
								NERPs_UnkReserveStack__004535a0(&local_210);
								NERPs_UnkReserveStack__004535a0(&local_20c);
								uVar4 = (*globals::nerps::g_NERPs_FUNCTIONS_TABLE
													[*(uint *)((int)pvVar2 + local_220 * 4) & 0xffff].function)
																	((int *)&local_210);
								iVar7 = 2;
								local_21c = uVar4;
							}
						}
					}
					local_220 += iVar7;
					if (uVar5 != 0) {
						uVar4 = (uint)(uVar4 == 0);
						local_21c = uVar4;
					}
					uVar5 = uVar4;
					if (uVar8 != 0) {
						if (uVar8 == 1) {
							if ((uVar10 == 0) || (uVar5 = uVar8, uVar4 == 0)) {
LAB_00453947:
								uVar5 = 0;
							}
						}
						else {
							if (uVar8 == 2) {
								if ((uVar10 == 0) && (uVar4 == 0)) goto LAB_00453947;
								uVar5 = 1;
							}
							else {
								if (uVar8 == 3) {
									uVar5 = (uint)(uVar4 < uVar10);
								}
								else {
									if (uVar8 == 4) {
										uVar5 = (uint)(uVar10 < uVar4);
									}
									else {
										if (uVar8 == 5) {
											uVar5 = (uint)(uVar10 == uVar4);
										}
										else {
											if (uVar8 == 6) {
												uVar5 = (uint)(uVar4 <= uVar10);
											}
											else {
												if (uVar8 == 7) {
													uVar5 = (uint)(uVar10 <= uVar4);
												}
												else {
joined_r0x00453b1b:
													uVar5 = uVar10;
													if (uVar8 == 8) {
														uVar5 = (uint)(uVar10 != uVar4);
													}
												}
											}
										}
									}
								}
							}
						}
					}
LAB_00453b28:
					uVar10 = uVar5;
					uVar5 = 0;
					uVar9 = 1;
				}
LAB_00453b2d:
				local_220 += 1;
				uVar8 = uVar9;
			} while (local_220 < local_204);
		}
		FUN_00454060(param_1);
	}
	return;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetGameSpeed(int *stack)
{
	LevelData *pLVar1;
	
	if ((*stack == 0) && (pLVar1 = game::GetLevel(), pLVar1->status != LEVELSTATUS_NONE)) {
		return 0;
	}
	game::Game_UnkSetGameSpeed_UnkBool(stack[1]);
	game::Game_SetGameSpeed((float)(ulonglong)(uint)*stack * 0.01);
	game::Game_UnkSetGameSpeed_UnkBool(stack[1]);
	return 0;
}



void __cdecl lego::unk::Lego_SetDatTo_004a773c___00453bc0(undefined4 param_1)
{
	DAT_004a773c = param_1;
	return;
}



void FUN_00453bd0(void)
{
	if (DAT_004a773c != 0) {
		FUN_00456ad0();
		return;
	}
	return;
}



void __cdecl FUN_00453be0(void)
{
	char *pcVar1;
	int iVar2;
	int local_8;
	undefined4 local_4;
	
	local_8 = 100;
	local_4 = 0;
	FUN_00428730(0);
	if (UINT_00556de4 != 0) {
		UINT_00556de4 -= 1;
		if (3 < (int)UINT_00556de4) {
			UINT_00556de4 = 3;
		}
		if ((int)UINT_00556de0 < (int)UINT_00556de4) {
			UINT_00556de4 = UINT_00556de0;
		}
		pcVar1 = (char *)FUN_004534c0((&lego::globals::nerps::g_NERPMessageSounds_UNKCOUNT)
																	[UINT_00556de0 - UINT_00556de4]);
		FUN_0046aee0(pcVar1,0);
		if (UINT_00556de4 == 0) {
			FUN_00426290(0,1);
			iVar2 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
			if (iVar2 != 0) {
				lego::nerps::funcs::NERPFunc__SetGameSpeed(&local_8);
			}
		}
		FUN_004262d0(1);
		return;
	}
	if (BOOL_004a7740 != 0) {
		UINT_00556de8 += 1;
	}
	BOOL_004a7740 = 0;
	return;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMessagesAreUpToDate(int *stack)
{
	return (uint)(DAT_00556da4 <= UINT_00556de8);
}



int __cdecl lego::nerps::funcs::NERPFunc__SupressArrow(int *stack)
{
	DAT_005009b0 = *stack;
	if (UINT_00556de4 == 0) {
		FUN_00426290((uint)(DAT_005009b0 == 0),1);
		return 0;
	}
	FUN_00426290(1,1);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__AdvanceMessage(int *stack)
{
	if (1 < (int)UINT_00556de4) {
		UINT_00556de4 = 1;
	}
	FUN_00453be0();
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__AllowCameraMovement(int *stack)
{
	DAT_005009b4 = *stack << 0xc;
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__ClickOnlyObjects(int *stack)
{
	int local_4;
	
	local_4 = 0x1ff3 - DAT_005009b4;
	NERPFunc__SetTutorialFlags(&local_4);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__ClickOnlyMap(int *stack)
{
	int local_4;
	
	local_4 = 0x1ffb - DAT_005009b4;
	NERPFunc__SetTutorialFlags(&local_4);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__ClickOnlyIcon(int *stack)
{
	int local_4;
	
	local_4 = 0x1ffe - DAT_005009b4;
	NERPFunc__SetTutorialFlags(&local_4);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__ClickOnlyCalltoarms(int *stack)
{
	int local_4;
	
	local_4 = 0x1f7f - DAT_005009b4;
	NERPFunc__SetTutorialFlags(&local_4);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__DisallowAll(int *stack)
{
	int local_4;
	
	local_4 = 0x1fff - DAT_005009b4;
	NERPFunc__SetTutorialFlags(&local_4);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashCallToArmsIcon(int *stack)
{
	if (*stack != 0) {
		FUN_0045c930(6,2,1);
		return 0;
	}
	unk::Lego_ClearFlag2__004b41bc();
	return 0;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_00453e70(float param_1)
{
	float fVar1;
	float *pfVar2;
	float *pfVar3;
	
	fVar1 = param_1 * 1000.0 * 0.04;
	pfVar2 = lego::globals::nerps::g_NERPs_TIMERS_TABLE;
	do {
		pfVar3 = pfVar2 + 1;
		*pfVar2 = *pfVar2 + fVar1;
		pfVar2 = pfVar3;
	} while (pfVar3 < &DAT_005009b0);
	if (_DAT_0050098c == 0.0) {
		return;
	}
	if (0.0 <= _DAT_0050098c) {
		if ((DAT_004a773c == 0) || (DAT_00500988 != 0)) {
			_DAT_0050098c = _DAT_0050098c - fVar1;
			if ((ushort)((ushort)(_DAT_0050098c < 0.0) << 8 | (ushort)(_DAT_0050098c == 0.0) << 0xe) == 0)
			goto LAB_00453f3e;
		}
		else {
			if ((DAT_00500984 != 0) &&
				 (((0 < (int)UINT_00556de4 && (DAT_005009b0 != 0)) || (DAT_005009b0 == 0)))) {
				FUN_00426290(BOOL_004a7740,1);
			}
			DAT_00500984 = BOOL_004a7740;
			if (BOOL_004a7740 != 0) goto LAB_00453f3e;
		}
	}
	_DAT_0050098c = 0.0;
LAB_00453f3e:
	if ((DAT_00556df0 != 0) && (_DAT_0050098c < 1000.0)) {
		lego::unk::Lego_ClearFlag2__004b41bc();
		return;
	}
	return;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTimer0(int *stack)
{
	longlong lVar1;
	
	lVar1 = __ftol((float10)globals::nerps::g_NERPs_TIMERS_TABLE[0]);
	return (int)lVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTimer1(int *stack)
{
	longlong lVar1;
	
	lVar1 = __ftol((float10)globals::nerps::g_NERPs_TIMERS_TABLE[1]);
	return (int)lVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTimer2(int *stack)
{
	longlong lVar1;
	
	lVar1 = __ftol((float10)globals::nerps::g_NERPs_TIMERS_TABLE[2]);
	return (int)lVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTimer3(int *stack)
{
	longlong lVar1;
	
	lVar1 = __ftol((float10)globals::nerps::g_NERPs_TIMERS_TABLE[3]);
	return (int)lVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTimer0(int *stack)
{
	globals::nerps::g_NERPs_TIMERS_TABLE[0] = (float)(ulonglong)(uint)*stack;
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTimer1(int *stack)
{
	globals::nerps::g_NERPs_TIMERS_TABLE[1] = (float)(ulonglong)(uint)*stack;
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTimer2(int *stack)
{
	globals::nerps::g_NERPs_TIMERS_TABLE[2] = (float)(ulonglong)(uint)*stack;
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTimer3(int *stack)
{
	globals::nerps::g_NERPs_TIMERS_TABLE[3] = (float)(ulonglong)(uint)*stack;
	return 1;
}



void __cdecl FUN_00454060(float param_1)
{
	float fVar1;
	BOOL BVar2;
	LevelData *pLVar3;
	float10 fVar4;
	LiveObject *local_10;
	undefined4 local_c;
	int local_8;
	int local_4;
	
	if (lego::globals::nerps::g_NERPs_Camera_IsLockedOn == 0) goto LAB_00454114;
	if (LIVEOBJ_00556d50 == NULL) {
		if (&DAT_00000009 < lego::globals::nerps::g_NERPs_Camera_LockedOnTarget) goto LAB_00454114;
		BVar2 = FUN_0042df20((uint)lego::globals::nerps::g_NERPs_Camera_LockedOnTarget,(int *)&local_10)
		;
		if (BVar2 == 0) {
			lego::globals::nerps::g_NERPs_Camera_IsLockedOn = 0;
			goto LAB_00454114;
		}
		lego::game::LiveObject_GetBlockCoordinates(local_10,&local_8,&local_4);
		lego::game::LiveObject_GetPosition
							(local_10,(float *)&Point2I_00556d48,(float *)&Point2I_00556d48.y);
	}
	else {
		lego::game::LiveObject_GetBlockCoordinates(LIVEOBJ_00556d50,&local_8,&local_4);
		lego::game::LiveObject_GetPosition
							(LIVEOBJ_00556d50,(float *)&Point2I_00556d48,(float *)&Point2I_00556d48.y);
		local_10 = LIVEOBJ_00556d50;
	}
	FUN_0042dd70(local_10,NULL,1);
LAB_00454114:
	if (BOOL_00556d54 != 0) {
		fVar1 = FLOAT_00556d58 / (param_1 * 25.0);
		FLOAT_00556d5c = fVar1 + FLOAT_00556d5c;
		if (((ushort)((ushort)(FLOAT_00556d5c < FLOAT_00556d58 - 5.0) << 8 |
								 (ushort)(FLOAT_00556d5c == FLOAT_00556d58 - 5.0) << 0xe) == 0) &&
			 ((ushort)((ushort)(FLOAT_00556d58 - -5.0 < FLOAT_00556d5c) << 8 |
								(ushort)(FLOAT_00556d58 - -5.0 == FLOAT_00556d5c) << 0xe) == 0)) {
			BOOL_00556d54 = 0;
			FLOAT_00556d5c = 0.0;
		}
		FUN_00436cc7(lego::globals::g_Game.structbc_24,fVar1);
	}
	if (BOOL_00556d60 != 0) {
		if ((ushort)((ushort)(FLOAT_00556d64 < 0.0) << 8 | (ushort)(FLOAT_00556d64 == 0.0) << 0xe) == 0)
		{
			fVar1 = FLOAT_00556d64 - FLOAT_00556d68;
		}
		else {
			fVar1 = FLOAT_00556d64 + FLOAT_00556d68;
		}
		fVar4 = lego::game::Game_GetFloatFPS_e40();
		fVar4 = fVar4 * (float10)(fVar1 * 0.1666667) * (float10)0.3333333;
		FLOAT_00556d68 = (float)(fVar4 + (float10)FLOAT_00556d68);
		if ((((ushort)((ushort)(FLOAT_00556d64 < 0.0) << 8 | (ushort)(FLOAT_00556d64 == 0.0) << 0xe) ==
					0) && ((ushort)((ushort)(FLOAT_00556d68 < FLOAT_00556d64 - 1.0) << 8 |
												 (ushort)(FLOAT_00556d68 == FLOAT_00556d64 - 1.0) << 0xe) == 0)) ||
			 ((FLOAT_00556d64 < 0.0 && (FLOAT_00556d68 < FLOAT_00556d64 - -1.0)))) {
			BOOL_00556d60 = 0;
			FLOAT_00556d68 = 0.0;
		}
		FUN_00436c16(lego::globals::g_Game.structbc_24,(float)(fVar4 * (float10)0.01745329));
	}
	pLVar3 = lego::game::GetLevel();
	if (pLVar3->status != LEVELSTATUS_NONE) {
		local_10 = (LiveObject *)0x64;
		local_c = 0;
		lego::nerps::funcs::NERPFunc__SetGameSpeed((int *)&local_10);
	}
	return;
}



int __cdecl lego::nerps::funcs::NERPFunc__CameraLockOnMonster(int *stack)
{
	if (*stack != 0) {
		FUN_00437a70(FUN_004542e0,(LiveObject *)&LIVEOBJ_00556d50);
		globals::nerps::g_NERPs_Camera_IsLockedOn = 1;
		return 0;
	}
	globals::nerps::g_NERPs_Camera_IsLockedOn = 0;
	LIVEOBJ_00556d50 = NULL;
	return 0;
}



undefined4 __cdecl FUN_004542e0(int *param_1,int **param_2)
{
	BOOL BVar1;
	
	if (param_1 != NULL) {
		BVar1 = FUN_004439b0((LiveObject *)param_1);
		if (BVar1 != 0) {
			*param_2 = param_1;
			return 1;
		}
	}
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__CameraLockOnObject(int *stack)
{
	if (*stack != 0) {
		globals::nerps::g_NERPs_Camera_LockedOnTarget = (void *)(*stack + -1);
		globals::nerps::g_NERPs_Camera_IsLockedOn = 1;
	}
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__CameraUnlock(int *stack)
{
	globals::nerps::g_NERPs_Camera_IsLockedOn = 0;
	globals::nerps::g_NERPs_Camera_LockedOnTarget = (void *)0xffffffff;
	LIVEOBJ_00556d50 = NULL;
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__CameraZoomIn(int *stack)
{
	if (FLOAT_00556d5c != 0.0) {
		FUN_00436cc7(globals::g_Game.structbc_24,FLOAT_00556d58 - FLOAT_00556d5c);
		FLOAT_00556d5c = 0.0;
	}
	if (-(float)(ulonglong)(uint)*stack != 0.0) {
		BOOL_00556d54 = 1;
	}
	FLOAT_00556d58 = -(float)(ulonglong)(uint)*stack;
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__CameraZoomOut(int *stack)
{
	if (FLOAT_00556d5c != 0.0) {
		FUN_00436cc7(globals::g_Game.structbc_24,FLOAT_00556d58 - FLOAT_00556d5c);
	}
	if ((float)(ulonglong)(uint)*stack != 0.0) {
		BOOL_00556d54 = 1;
	}
	FLOAT_00556d58 = (float)(ulonglong)(uint)*stack;
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__CameraRotate(int *stack)
{
	if (FLOAT_00556d68 != 0.0) {
		FUN_00436c16(globals::g_Game.structbc_24,(FLOAT_00556d64 - FLOAT_00556d68) * 0.01745329);
		FLOAT_00556d68 = 0.0;
	}
	FLOAT_00556d64 = (float)(ulonglong)(uint)*stack;
	if ((ushort)((ushort)(FLOAT_00556d64 < 180.0) << 8 | (ushort)(FLOAT_00556d64 == 180.0) << 0xe) ==
			0) {
		FLOAT_00556d64 = FLOAT_00556d64 - 360.0;
	}
	if (FLOAT_00556d64 != 0.0) {
		BOOL_00556d60 = 1;
	}
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetSelectedRecordObject(int *stack)
{
	BOOL BVar1;
	uint uVar2;
	LiveObject *local_4;
	
	uVar2 = 0;
	do {
		local_4 = NULL;
		BVar1 = FUN_0042df20(uVar2,(int *)&local_4);
		if (BVar1 != 0) {
			BVar1 = FUN_004528d0(local_4,NULL);
			if (BVar1 != 0) {
				return uVar2 + 1;
			}
		}
		uVar2 += 1;
	} while (uVar2 < 10);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetCrystalPriority(int *stack)
{
	game::Game_SetIsPriorityDisabled(0,(uint)(*stack == 0));
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetMonsterAttackPowerstation(int *stack)
{
	ObjectType local_c;
	int local_8;
	char *local_4;
	
	if (*stack == 1) {
		local_c = 0x200;
		local_8 = -1;
		local_4 = (char *)0x1;
		FUN_00437a70(FUN_004545c0,(LiveObject *)&local_c);
		return 0;
	}
	local_c = OBJECT_NONE;
	local_8 = -1;
	local_4 = NULL;
	FUN_00437a70(FUN_004545c0,(LiveObject *)&local_c);
	return 0;
}



undefined4 __cdecl FUN_004545c0(undefined4 *param_1,uint *param_2)
{
	BOOL BVar1;
	ObjectStatsFlags2 OVar2;
	int local_8;
	int local_4;
	
	if (param_1 != NULL) {
		lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_1,&local_8,&local_4);
		BVar1 = FUN_004329d0(local_8,local_4,1);
		if (BVar1 != 0) {
			OVar2 = lego::game::LiveObject_GetStatsFlags2((LiveObject *)param_1);
			if (((*param_2 & OVar2) != STATS2_NONE) || (param_2[1] != 0xffffffff)) {
				OVar2 = lego::game::LiveObject_GetStatsFlags2((LiveObject *)param_1);
				if ((param_2[1] & OVar2) == STATS2_NONE) {
					return 0;
				}
				if (*param_2 != 0xffffffff) {
					return 0;
				}
			}
			if (param_2[2] == 0) {
				FUN_00403450((LiveObject *)param_1);
			}
			else {
				if (param_2[2] == 1) {
					FUN_00403490((LiveObject *)param_1);
					return 0;
				}
			}
		}
	}
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetMonsterAttackNowt(int *stack)
{
	ObjectType local_c;
	int local_8;
	char *local_4;
	
	if (*stack == 1) {
		local_c = OBJECT_NONE;
		local_8 = -1;
		local_4 = (char *)0x1;
		FUN_00437a70(FUN_004545c0,(LiveObject *)&local_c);
		return 0;
	}
	local_c = OBJECT_NONE;
	local_8 = -1;
	local_4 = NULL;
	FUN_00437a70(FUN_004545c0,(LiveObject *)&local_c);
	return 0;
}



void __cdecl FUN_004546d0(char *param_1,float param_2)
{
	char local_8c [128];
	float local_c;
	ObjectType local_8;
	int local_4;
	
	std::sprintf(local_8c,"%s",param_1);
	local_c = param_2;
	lego::game::Game_GetObjectByName(param_1,&local_8,&local_4,NULL);
	FUN_00437a70(FUN_00454740,(LiveObject *)local_8c);
	return;
}



BOOL __cdecl FUN_00454740(LiveObject *liveObj,int param_2)
{
	if (((liveObj != NULL) && (liveObj->objType == *(ObjectType *)(param_2 + 0x84))) &&
		 (liveObj->objIndex == *(int *)(param_2 + 0x88))) {
		lego::game::LiveObject_SetLevel(liveObj,*(uint *)(param_2 + 0x80));
	}
	return 0;
}



undefined4 __cdecl FUN_00454780(undefined4 param_1,int param_2,int param_3,int *param_4)
{
	LevelData *pLVar1;
	int local_14;
	int local_10;
	float local_c;
	float local_8 [2];
	
	pLVar1 = lego::game::GetLevel();
	lego::game::LiveObject_GetPosition((LiveObject *)param_4[1],&local_c,local_8);
	lego::game::SurfaceMap_ToBlockCoordinatesNoZ
						(pLVar1->surfaceMap,local_c,local_8[0],&local_14,&local_10);
	if ((param_2 == local_14) && (param_3 == local_10)) {
		*param_4 = *param_4 + 1;
	}
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetRecordObjectAtTutorial(int *stack)
{
	int *piVar1;
	BOOL BVar2;
	uint uVar3;
	int local_8;
	int *local_4;
	
	piVar1 = stack;
	uVar3 = 0;
	do {
		stack = NULL;
		BVar2 = FUN_0042df20(uVar3,(int *)&stack);
		if (BVar2 != 0) {
			local_4 = stack;
			local_8 = 0;
			FUN_00456f70(*piVar1,FUN_00454780,&local_8);
			if (local_8 != 0) {
				return uVar3 + 1;
			}
		}
		uVar3 += 1;
	} while (uVar3 < 10);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetRecordObjectAmountAtTutorial(int *stack)
{
	int *piVar1;
	BOOL BVar2;
	uint uVar3;
	int local_8;
	int *local_4;
	
	piVar1 = stack;
	local_8 = 0;
	uVar3 = 0;
	do {
		stack = NULL;
		BVar2 = FUN_0042df20(uVar3,(int *)&stack);
		if (BVar2 != 0) {
			local_4 = stack;
			FUN_00456f70(*piVar1,FUN_00454780,&local_8);
		}
		uVar3 += 1;
	} while (uVar3 < 10);
	return local_8;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_004548c0(LevelData *level,int param_2,undefined4 param_3,undefined4 *param_4)
{
	BOOL BVar1;
	float10 fVar2;
	float10 fVar3;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	fVar2 = (float10)fsin((float10)_DAT_005009b8);
	_DAT_005009b8 = _DAT_005009b8 - (float)param_4 * 25.0 * -0.01333333;
	if (DAT_00556dec != 0) {
		BVar1 = FUN_0042df20(DAT_00556dec - 1,(int *)&param_4);
		if (BVar1 != 0) {
			param_4[0xfe] = 1;
			lego::game::LiveObject_GetPosition((LiveObject *)param_4,&local_c,&local_8);
			fVar3 = lego::game::SurfaceMap_UnkGetZ(level->surfaceMap,local_c,local_8);
			local_4 = (float)fVar3;
			FUN_00477590(param_2,&local_14,&local_c);
			local_14 = local_14 - (float)((lego::globals::g_Game.TutorialIcon)->width / 2);
			local_10 = local_10 -
								 ((float)fVar2 * 20.0 + (float)((lego::globals::g_Game.TutorialIcon)->height << 1));
			lego::image::Image_Blt__0047df70(lego::globals::g_Game.TutorialIcon,NULL,&local_14,NULL);
		}
	}
	return;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetRecordObjectPointer(int *stack)
{
	DAT_00556dec = *stack;
	return *stack;
}



void __cdecl FUN_004549d0(int *param_1)
{
	FUN_0041e740(*param_1);
	return;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetOxygenLevel(int *stack)
{
	int iVar1;
	longlong lVar2;
	float local_4;
	
	local_4 = (globals::g_Game.level)->oxygenLevel;
	if (local_4 < 1.0) {
		local_4 = 0.0;
	}
	if (local_4 == 0.0) {
		iVar1 = FUN_0046a780(0x40b);
		if (iVar1 == 0) {
			local_4 = 1.0;
		}
	}
	if (local_4 < 1.0) {
		local_4 = 1.0;
	}
	lVar2 = __ftol((float10)local_4);
	return (int)lVar2;
}



int __cdecl lego::nerps::funcs::NERPFunc__GenerateSlug(int *stack)
{
	uint local_c;
	ResourceData *local_8;
	ObjectType local_4;
	
	game::Game_GetObjectByName("Slug",&local_4,(int *)&local_c,&local_8);
	FUN_0043b010(NULL,local_c);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetAttackDefer(int *stack)
{
	FUN_004359b0(*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetCallToArms(int *stack)
{
	game::Game_SetCallToArmsOn(*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetCallToArmsButtonClicked(int *stack)
{
	return globals::g_Game.flags2 & GAME2_CALLTOARMS;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetRockMonster(int *stack)
{
	uint uVar1;
	
	uVar1 = game::Level_GetEmergeCreature();
	FUN_0043b1f0((int **)(globals::g_Game.RockMonsterData_TABLE + uVar1),4.203895e-45,uVar1,*stack - 1
							 ,stack[1] - 1);
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetRockMonstersDestroyed(int *stack)
{
	return globals::nerps::g_NERPs_RockMonstersDestroyed;
}



void FUN_00454b40(void)
{
	lego::globals::nerps::g_NERPs_HiddenObjectsFound += 1;
	return;
}



void __cdecl FUN_00454b50(void)
{
	lego::globals::nerps::g_NERPs_HiddenObjectsFound = 0;
	return;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetHiddenObjectsFound(int *stack)
{
	return globals::nerps::g_NERPs_HiddenObjectsFound;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetHiddenObjectsFound(int *stack)
{
	globals::nerps::g_NERPs_HiddenObjectsFound = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetUpgradeBuildingIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x41,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetUpgradeBuildingIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x41;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashUpgradeBuildingIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x41,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetGoBackIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGoBackIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashGoBackIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetRockMonsterRunningAway(int *stack)
{
	ObjectType local_c;
	int local_8;
	
	local_c = OBJECT_NONE;
	local_8 = 0;
	FUN_00437a70(FUN_00454c70,(LiveObject *)&local_c);
	return local_8;
}



undefined4 __cdecl FUN_00454c70(int *param_1,int *param_2)
{
	int iVar1;
	
	iVar1 = *param_2;
	if ((((iVar1 == 0) || (iVar1 == 1)) || (iVar1 == 2)) && (*param_1 == 3)) {
		if (iVar1 == 0) {
			if (((ushort)((ushort)((float)param_1[0xd0] < 0.0) << 8 |
									 (ushort)((float)param_1[0xd0] == 0.0) << 0xe) == 0) &&
				 ((float)param_1[0xd0] <
					*(float *)(param_1[0xcd] + 0xe8) - *(float *)(param_1[0xcd] + 0xe8) * 0.01 * 20.0)) {
				lego::game::LiveObject_UnkDoRouting_FUN_00441c00((LiveObject *)param_1,0);
				param_2[1] = param_2[1] + 1;
			}
		}
		else {
			if (iVar1 == 1) {
				*(int *)(param_1[0xcd] + 0xe8) = param_2[2];
				return 0;
			}
			if (iVar1 == 2) {
				param_1[0xd0] = param_2[2];
				return 0;
			}
		}
	}
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetRockMonsterPainThreshold(int *stack)
{
	ObjectType local_c;
	char *local_4;
	
	local_c = OBJECT_VEHICLE;
	local_4 = (char *)(float)(ulonglong)(uint)*stack;
	FUN_00437a70(FUN_00454c70,(LiveObject *)&local_c);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetRockMonsterHealth(int *stack)
{
	ObjectType local_c;
	char *local_4;
	
	local_c = OBJECT_MINIFIGURE;
	local_4 = (char *)(float)(ulonglong)(uint)*stack;
	FUN_00437a70(FUN_00454c70,(LiveObject *)&local_c);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetPauseGame(int *stack)
{
	FUN_00425b60(0,*stack);
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetAnyKeyPressed(int *stack)
{
	int iVar1;
	
	iVar1 = input::Input_GetNumKeysPressed();
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetIconPos(int *stack)
{
	globals::nerps::g_NERPs_IconPos.x = (float)(ulonglong)(uint)*stack;
	globals::nerps::g_NERPs_IconPos.y = (float)(ulonglong)(uint)stack[1];
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetIconSpace(int *stack)
{
	globals::nerps::g_NERPs_IconSpace = *stack;
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetIconWidth(int *stack)
{
	globals::nerps::g_NERPs_IconWidth = *stack;
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetLevelCompleted(int *stack)
{
	game::Level_SetCompleteStatus(LEVELSTATUS_COMPLETE);
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetLevelFail(int *stack)
{
	if ((globals::g_Game.flags1 & GAME1_UNK_8000000) == GAME1_NONE) {
		game::Level_SetCompleteStatus(LEVELSTATUS_FAILED);
	}
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetGameFail(int *stack)
{
	game::Level_SetCompleteStatus(LEVELSTATUS_FAILED);
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTutorialPointer(int *stack)
{
	FUN_00457430(*stack,(undefined4 *)stack[1]);
	return 1;
}



void __cdecl lego::nerps::NERPs_SetSubmenuIconClicked__00454e90(char *itemName,BOOL state)
{
	ObjectType objType;
	
	game::Game_GetObjectByName(itemName,&objType,(int *)&itemName,NULL);
	NERPs_SetSubmenuIconClicked_internal___0041e750(objType,(int)itemName,state);
	return;
}



int __cdecl lego::nerps::NERPs_FlashSubmenuIcon__00454ed0(char *itemName,BOOL state)
{
	int local_4;
	
	game::Game_GetObjectByName(itemName,(ObjectType *)&itemName,&local_4,NULL);
	NERPs_FlashSubmenuIcon_internal___0041e6d0((ObjectType)itemName,local_4,state);
	return (int)itemName;
}



undefined4 __cdecl FUN_00454f10(undefined4 param_1,int param_2,int param_3,undefined4 *param_4)
{
	LevelData *pLVar1;
	
	pLVar1 = lego::game::GetLevel();
	pLVar1->blocks[(pLVar1->dimensions).width * param_3 + param_2].clickCount = *param_4;
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTutorialBlockClicks(int *stack)
{
	FUN_00456f70(*stack,FUN_00454f10,stack + 1);
	return 1;
}



undefined4 __cdecl FUN_00454f60(undefined4 param_1,uint param_2,int param_3,int *param_4)
{
	LevelData *pLVar1;
	int iVar2;
	Point2I local_8;
	
	pLVar1 = lego::game::GetLevel();
	local_8.x = param_2;
	local_8.y = param_3;
	iVar2 = 0;
	pLVar1->blocks[(pLVar1->dimensions).width * param_3 + param_2].field_2c = *param_4;
	if (0 < *param_4) {
		do {
			lego::game::Level_GenerateCrystal(&local_8,0,NULL,1);
			iVar2 += 1;
		} while (iVar2 < *param_4);
	}
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTutorialCrystals(int *stack)
{
	FUN_00456f70(*stack,FUN_00454f60,stack + 1);
	return 1;
}



undefined4 __cdecl FUN_00454ff0(undefined4 param_1,uint param_2,int param_3,undefined4 *param_4)
{
	LevelData *pLVar1;
	Point2I local_8;
	
	pLVar1 = lego::game::GetLevel();
	local_8.x = param_2;
	local_8.y = param_3;
	pLVar1->blocks[(pLVar1->dimensions).width * param_3 + param_2].field_30 = *param_4;
	lego::game::Level_GenerateOre(&local_8,0,NULL,0);
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetOreAtIconPositions(int *stack)
{
	FUN_00456f70(*stack,FUN_00454ff0,stack + 1);
	return 1;
}



int __cdecl FUN_00455070(char *param_1)
{
	LiveObject **ppLVar1;
	uint uVar2;
	int iVar3;
	uint uVar4;
	int local_4;
	
	iVar3 = 0;
	lego::game::Game_GetObjectByName(param_1,(ObjectType *)&param_1,&local_4,NULL);
	ppLVar1 = lego::game::Game_GetSelectedUnits();
	uVar4 = 0;
	uVar2 = lego::game::Game_GetNumSelectedUnits();
	if (uVar2 != 0) {
		do {
			if (((char *)(*ppLVar1)->objType == param_1) && ((*ppLVar1)->objIndex == local_4)) {
				iVar3 += 1;
			}
			uVar4 += 1;
			ppLVar1 = ppLVar1 + 1;
			uVar2 = lego::game::Game_GetNumSelectedUnits();
		} while (uVar4 < uVar2);
	}
	return iVar3;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMiniFigureSelected(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455070("Pilot");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetSmallTruckSelected(int *stack)
{
	LiveObject *pLVar1;
	int local_8;
	ObjectType local_4;
	
	pLVar1 = game::Game_GetFirstSelectedObject();
	if (pLVar1 == NULL) {
		return 0;
	}
	game::Game_GetObjectByName("SmallTruck",&local_4,&local_8,NULL);
	if (pLVar1->objIndex != local_8) {
		return 0;
	}
	return (uint)(pLVar1->objType == local_4);
}



int __cdecl lego::nerps::funcs::NERPFunc__GetSmallDiggerSelected(int *stack)
{
	LiveObject *pLVar1;
	int local_8;
	ObjectType local_4;
	
	pLVar1 = game::Game_GetFirstSelectedObject();
	if (pLVar1 == NULL) {
		return 0;
	}
	game::Game_GetObjectByName("SmallDigger",&local_4,&local_8,NULL);
	if (pLVar1->objIndex != local_8) {
		return 0;
	}
	return (uint)(pLVar1->objType == local_4);
}



int __cdecl lego::nerps::funcs::NERPFunc__GetRapidRiderSelected(int *stack)
{
	LiveObject *pLVar1;
	int local_8;
	ObjectType local_4;
	
	pLVar1 = game::Game_GetFirstSelectedObject();
	if (pLVar1 == NULL) {
		return 0;
	}
	game::Game_GetObjectByName("SmallCat",&local_4,&local_8,NULL);
	if (pLVar1->objIndex != local_8) {
		return 0;
	}
	return (uint)(pLVar1->objType == local_4);
}



int __cdecl lego::nerps::funcs::NERPFunc__GetSmallHelicopterSelected(int *stack)
{
	LiveObject *pLVar1;
	int local_8;
	ObjectType local_4;
	
	pLVar1 = game::Game_GetFirstSelectedObject();
	if (pLVar1 == NULL) {
		return 0;
	}
	game::Game_GetObjectByName("SmallHeli",&local_4,&local_8,NULL);
	if (pLVar1->objIndex != local_8) {
		return 0;
	}
	return (uint)(pLVar1->objType == local_4);
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGraniteGrinderSelected(int *stack)
{
	LiveObject *pLVar1;
	int local_8;
	ObjectType local_4;
	
	pLVar1 = game::Game_GetFirstSelectedObject();
	if (pLVar1 == NULL) {
		return 0;
	}
	game::Game_GetObjectByName("WalkerDigger",&local_4,&local_8,NULL);
	if (pLVar1->objIndex != local_8) {
		return 0;
	}
	return (uint)(pLVar1->objType == local_4);
}



int __cdecl lego::nerps::funcs::NERPFunc__GetChromeCrusherSelected(int *stack)
{
	LiveObject *pLVar1;
	int local_8;
	ObjectType local_4;
	
	pLVar1 = game::Game_GetFirstSelectedObject();
	if (pLVar1 == NULL) {
		return 0;
	}
	game::Game_GetObjectByName("LargeDigger",&local_4,&local_8,NULL);
	if (pLVar1->objIndex != local_8) {
		return 0;
	}
	return (uint)(pLVar1->objType == local_4);
}



char * __cdecl FUN_00455320(char *param_1)
{
	ObjectType local_c;
	int local_8;
	char *local_4;
	
	lego::game::Game_GetObjectByName(param_1,&local_c,&local_8,NULL);
	local_4 = NULL;
	FUN_00437a70(FUN_00455360,(LiveObject *)&local_c);
	return local_4;
}



undefined4 __cdecl FUN_00455360(int *param_1,int *param_2)
{
	if (((*param_1 == *param_2) && (param_1[1] == param_2[1])) && (param_1[0xdb] != 0)) {
		param_2[2] = param_2[2] + 1;
	}
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__AddPoweredCrystals(int *stack)
{
	uint uVar1;
	
	uVar1 = 0;
	if (*stack != 0) {
		do {
			game::Level_IncField8c();
			uVar1 += 1;
		} while (uVar1 < (uint)*stack);
	}
	FUN_00439c50();
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__AddStoredOre(int *stack)
{
	uint uVar1;
	
	uVar1 = 0;
	if (*stack != 0) {
		do {
			FUN_0041f8d0(0);
			uVar1 += 1;
		} while (uVar1 < (uint)*stack);
	}
	return *stack;
}



undefined4 __cdecl FUN_004553f0(undefined4 param_1,int param_2,int param_3,int *param_4)
{
	LevelData *pLVar1;
	
	pLVar1 = lego::game::GetLevel();
	*param_4 = *param_4 + pLVar1->blocks[(pLVar1->dimensions).width * param_3 + param_2].field_2c;
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTutorialCrystals(int *stack)
{
	int local_4;
	
	local_4 = 0;
	FUN_00456f70(*stack,FUN_004553f0,&local_4);
	return local_4;
}



undefined4 __cdecl FUN_00455450(undefined4 param_1,int param_2,int param_3,int *param_4)
{
	LevelData *pLVar1;
	
	pLVar1 = lego::game::GetLevel();
	*param_4 = *param_4 + pLVar1->blocks[(pLVar1->dimensions).width * param_3 + param_2].clickCount;
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTutorialBlockClicks(int *stack)
{
	int local_4;
	
	local_4 = 0;
	FUN_00456f70(*stack,FUN_00455450,&local_4);
	return local_4;
}



int __cdecl lego::game::Level_GetObjectsOfLevel(char *objName,int in_objLevel)
{
	int iVar1;
	uint uVar2;
	int iVar3;
	char *pcVar4;
	uint objLevel;
	ObjectType objType;
	ObjectType local_c;
	char *local_8;
	char *local_4;
	
	Game_GetObjectByName(objName,&objType,(int *)&objName,NULL);
	iVar3 = in_objLevel;
	if (in_objLevel < 0) {
		pcVar4 = NULL;
		objLevel = 0;
		iVar1 = Object_GetLevels(objType,(int)objName);
		if (iVar1 != 0) {
			do {
				if (iVar3 == -1) {
					iVar1 = LiveObject_GetOrSubLevelsTable(objType,(int)objName,objLevel,1);
					pcVar4 = pcVar4 + iVar1;
				}
				if (iVar3 == -2) {
					local_c = objType;
					local_8 = objName;
					local_4 = NULL;
					FUN_00437a70(FUN_00455580,(LiveObject *)&local_c);
					pcVar4 = local_4 + (int)pcVar4;
				}
				objLevel += 1;
				uVar2 = Object_GetLevels(objType,(int)objName);
			} while (objLevel < uVar2);
		}
		return (int)pcVar4;
	}
	iVar3 = LiveObject_GetOrSubLevelsTable(objType,(int)objName,in_objLevel,1);
	return iVar3;
}



undefined4 __cdecl FUN_00455580(int *param_1,int *param_2)
{
	if ((*param_1 == *param_2) && (param_1[1] == param_2[1])) {
		if ((param_1[0xfa] & 0x20000000U) != 0) {
			param_2[2] = param_2[2] + 1;
			return 0;
		}
		param_2[2] = 0;
	}
	return 0;
}



uint __cdecl lego::game::Game_GetPilotPreviousLevel(char *objName,int objLevel)
{
	uint uVar1;
	ObjectType objType;
	
	Game_GetObjectByName(objName,&objType,(int *)&objName,NULL);
	uVar1 = LiveObject_GetPreviousLevel(objType,(int)objName,objLevel);
	return uVar1;
}



void __cdecl FUN_00455600(char *param_1)
{
	ObjectType local_4;
	
	lego::game::Game_GetObjectByName(param_1,&local_4,(int *)&param_1,NULL);
	FUN_0041e790(local_4,(int)param_1);
	return;
}



undefined4 __cdecl FUN_00455630(int param_1,int param_2)
{
	int iVar1;
	
	if (param_2 == 1) {
		iVar1 = FUN_0041e7c0(param_1,1);
		if (iVar1 != 0) {
			lego::nerps::NERPs_SetIconFlag4__0041e6a0(param_1,1);
			return 1;
		}
	}
	else {
		lego::unk::Lego_ClearFlag2__004b41bc();
		lego::nerps::NERPs_SetIconFlag4__0041e6a0(param_1,0);
	}
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMiniFigureinGraniteGrinder(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455320("Walkerdigger");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMiniFigureinChromeCrusher(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455320("LargeDigger");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMiniFigureinSmallDigger(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455320("SmallDigger");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMiniFigureinRapidRider(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455320("SmallCat");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMiniFigureinSmallTruck(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455320("SmallTruck");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMiniFigureinSmallHelicopter(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455320("SmallHeli");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetBarracksLevel(int *stack)
{
	FUN_004546d0("Barracks",*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetDocksLevel(int *stack)
{
	FUN_004546d0("Docks",*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetGeoDomeLevel(int *stack)
{
	FUN_004546d0("Geo-dome",*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetPowerstationLevel(int *stack)
{
	FUN_004546d0("Powerstation",*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetToolStoreLevel(int *stack)
{
	FUN_004546d0("Toolstation",*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetGunstationLevel(int *stack)
{
	FUN_004546d0("Gunstation",*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTeleportPadLevel(int *stack)
{
	FUN_004546d0("TeleportPad",*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetSuperTeleportLevel(int *stack)
{
	FUN_004546d0("TeleportBIG",*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetUpgradeStationLevel(int *stack)
{
	FUN_004546d0("Upgrade",*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetBarracksSelected(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455070("Barracks");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetDocksSelected(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455070("Docks");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGeoDomeSelected(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455070("Geo-Dome");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPowerstationSelected(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455070("Powerstation");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetToolStoreSelected(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455070("Toolstation");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGunstationSelected(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455070("Gunstation");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTeleportPadSelected(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455070("TeleportPad");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetSuperTeleportSelected(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455070("TeleportBIG");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetUpgradeStationSelected(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455070("Upgrade");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPoweredBarracksBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Barracks",-2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPoweredDocksBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Docks",-2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPoweredGeodomeBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Geo-dome",-2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPoweredPowerstationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Powerstation",-2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPoweredToolStoresBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Toolstation",-2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPoweredGunstationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("GunStation",-2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPoweredTeleportsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("TeleportPad",-2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPoweredVehicleTeleportsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("TeleportBIG",-2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPoweredUpgradeStationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Upgrade",-2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetBarracksBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Barracks",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetDocksBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Docks",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGeodomeBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Geo-dome",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPowerstationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Powerstation",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetToolStoresBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Toolstation",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGunstationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("GunStation",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTeleportsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("TeleportPad",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetVehicleTeleportsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("TeleportBIG",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetUpgradeStationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Upgrade",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel1BarracksBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Barracks",1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel1DocksBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Docks",1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel1GeodomeBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Geo-dome",1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel1PowerstationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Powerstation",1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel1ToolStoresBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Toolstation",1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel1GunstationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("GunStation",1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel1TeleportsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("TeleportPad",1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel1VehicleTeleportsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("TeleportBIG",1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel1UpgradeStationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Upgrade",1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel2BarracksBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Barracks",2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel2DocksBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Docks",2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel2GeodomeBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Geo-dome",2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel2PowerstationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Powerstation",2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel2ToolStoresBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Toolstation",2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel2GunstationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("GunStation",2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel2TeleportsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("TeleportPad",2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel2VehicleTeleportsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("TeleportBIG",2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLevel2UpgradeStationsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Upgrade",2);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetBarracksIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455600("Barracks");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGeodomeIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455600("Geo-dome");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPowerstationIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455600("Powerstation");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetToolStoreIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455600("Toolstation");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGunstationIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455600("Gunstation");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTeleportPadIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455600("TeleportPad");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetVehicleTransportIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455600("TeleportBIG");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetUpgradeStationIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455600("Upgrade");
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetBarracksIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_SetSubmenuIconClicked__00454e90("Barracks",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetGeodomeIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_SetSubmenuIconClicked__00454e90("Geo-dome",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetPowerstationIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_SetSubmenuIconClicked__00454e90("Powerstation",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetToolStoreIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_SetSubmenuIconClicked__00454e90("Toolstation",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetGunstationIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_SetSubmenuIconClicked__00454e90("Gunstation",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTeleportPadIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_SetSubmenuIconClicked__00454e90("TeleportPad",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetVehicleTransportIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_SetSubmenuIconClicked__00454e90("TeleportBIG",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetUpgradeStationIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_SetSubmenuIconClicked__00454e90("Upgrade",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashBarracksIcon(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_FlashSubmenuIcon__00454ed0("Barracks",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashGeodomeIcon(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_FlashSubmenuIcon__00454ed0("Geo-dome",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashPowerStationIcon(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_FlashSubmenuIcon__00454ed0("Powerstation",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashToolStoreIcon(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_FlashSubmenuIcon__00454ed0("Toolstation",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashGunstationIcon(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_FlashSubmenuIcon__00454ed0("Gunstation",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashTeleportPadIcon(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_FlashSubmenuIcon__00454ed0("TeleportPad",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashVehicleTransportIcon(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_FlashSubmenuIcon__00454ed0("TeleportBIG",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashUpgradeStationIcon(int *stack)
{
	int iVar1;
	
	iVar1 = NERPs_FlashSubmenuIcon__00454ed0("Upgrade",*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPathsBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Path",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetStudCount(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("ProcessedOre",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetSmallHelicoptersOnLevel(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("SmallHeli",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGraniteGrindersOnLevel(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("WalkerDigger",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetRapidRidersOnLevel(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("SmallCat",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetSmallDiggersOnLevel(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("SmallDigger",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetSlugsOnLevel(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Slug",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMiniFiguresOnLevel(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Pilot",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetOreRefineriesBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("Refinery",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetCrystalRefineriesBuilt(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetObjectsOfLevel("CrystalRefinery",-1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTeleportIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 1;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetDynamiteClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0xd;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMountIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x18;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTrainIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x39;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetDropSonicBlasterIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x21;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGetToolIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x30;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGetPusherIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x36;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGetSonicBlasterIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x38;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTrainSailorIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x3e;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTrainPilotIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x3d;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTrainDriverIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x3a;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetGetLaserIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x35;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetDismountIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0x19;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetDigIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0xb;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetBuildIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 2;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetLayPathIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 5;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetPlaceFenceIconClicked(int *stack)
{
	int iVar1;
	int local_4;
	
	local_4 = 0xe;
	iVar1 = FUN_004549d0(&local_4);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTeleportIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(1,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetDynamiteClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0xd,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTrainIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x39,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTrainDriverIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x3a,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTrainSailorIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x3e,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetGetToolIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x30,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetDropSonicBlasterIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x21,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetGetLaserIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x35,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetGetPusherIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x36,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetGetSonicBlasterIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x38,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetDismountIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x19,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTrainPilotIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x3d,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetMountIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0x18,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetDigIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0xb,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetBuildIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(2,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetLayPathIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(5,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetPlaceFenceIconClicked(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_0041e720(0xe,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashTeleportIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(1,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashDynamiteIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0xd,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashMountIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x18,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashTrainIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x39,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashTrainDriverIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x3a,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashTrainPilotIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x3d,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashTrainSailorIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x3e,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashDismountIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x19,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashGetToolIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x30,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashDropSonicBlasterIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x21,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashGetLaserIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x35,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashGetPusherIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x36,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashGetSonicBlasterIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0x38,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashDigIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0xb,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashBuildIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(2,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashLayPathIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(5,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__FlashPlaceFenceIcon(int *stack)
{
	int iVar1;
	
	iVar1 = FUN_00455630(0xe,*stack);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetRandom(int *stack)
{
	ushort uVar1;
	
	uVar1 = util::randomInt16();
	return uVar1 & 0xfff;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetRandomTrueFalse(int *stack)
{
	ushort uVar1;
	
	uVar1 = util::randomInt16();
	return uVar1 & 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetRandom10(int *stack)
{
	short sVar1;
	
	sVar1 = util::randomInt16();
	return (int)sVar1 % 10;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetRandom100(int *stack)
{
	short sVar1;
	
	sVar1 = util::randomInt16();
	return (int)sVar1 % 100;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetCrystalsPickedUp(int *stack)
{
	return (globals::g_Game.level)->field_94;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetCrystalsCurrentlyStored(int *stack)
{
	int iVar1;
	
	iVar1 = game::Level_GetCrystalCount(1);
	return iVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__False(int *stack)
{
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetOrePickedUp(int *stack)
{
	return (globals::g_Game.level)->field_a8;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetOreCurrentlyStored(int *stack)
{
	return (globals::g_Game.level)->numOre;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTutorialFlags(int *stack)
{
	return globals::nerps::g_NERPs_TutorialFlags;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetR0(int *stack)
{
	return globals::nerps::g_NERPs_REGISTERS_TABLE[0];
}



int __cdecl lego::nerps::funcs::NERPFunc__GetR1(int *stack)
{
	return globals::nerps::g_NERPs_REGISTERS_TABLE[1];
}



int __cdecl lego::nerps::funcs::NERPFunc__GetR2(int *stack)
{
	return globals::nerps::g_NERPs_REGISTERS_TABLE[2];
}



int __cdecl lego::nerps::funcs::NERPFunc__GetR3(int *stack)
{
	return globals::nerps::g_NERPs_REGISTERS_TABLE[3];
}



int __cdecl lego::nerps::funcs::NERPFunc__GetR4(int *stack)
{
	return globals::nerps::g_NERPs_REGISTERS_TABLE[4];
}



int __cdecl lego::nerps::funcs::NERPFunc__GetR5(int *stack)
{
	return globals::nerps::g_NERPs_REGISTERS_TABLE[5];
}



int __cdecl lego::nerps::funcs::NERPFunc__GetR6(int *stack)
{
	return globals::nerps::g_NERPs_REGISTERS_TABLE[6];
}



int __cdecl lego::nerps::funcs::NERPFunc__GetR7(int *stack)
{
	return globals::nerps::g_NERPs_REGISTERS_TABLE[7];
}



int __cdecl lego::nerps::funcs::NERPFunc__AddR0(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[0] += *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[0];
}



int __cdecl lego::nerps::funcs::NERPFunc__AddR1(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[1] += *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[1];
}



int __cdecl lego::nerps::funcs::NERPFunc__AddR2(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[2] += *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[2];
}



int __cdecl lego::nerps::funcs::NERPFunc__AddR3(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[3] += *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[3];
}



int __cdecl lego::nerps::funcs::NERPFunc__AddR4(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[4] += *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[4];
}



int __cdecl lego::nerps::funcs::NERPFunc__AddR5(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[5] += *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[5];
}



int __cdecl lego::nerps::funcs::NERPFunc__AddR6(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[6] += *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[6];
}



int __cdecl lego::nerps::funcs::NERPFunc__AddR7(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[7] += *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[7];
}



int __cdecl lego::nerps::funcs::NERPFunc__SubR0(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[0] -= *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[0];
}



int __cdecl lego::nerps::funcs::NERPFunc__SubR1(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[1] -= *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[1];
}



int __cdecl lego::nerps::funcs::NERPFunc__SubR2(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[2] -= *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[2];
}



int __cdecl lego::nerps::funcs::NERPFunc__SubR3(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[3] -= *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[3];
}



int __cdecl lego::nerps::funcs::NERPFunc__SubR4(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[4] -= *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[4];
}



int __cdecl lego::nerps::funcs::NERPFunc__SubR5(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[5] -= *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[5];
}



int __cdecl lego::nerps::funcs::NERPFunc__SubR6(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[6] -= *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[6];
}



int __cdecl lego::nerps::funcs::NERPFunc__SubR7(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[7] -= *stack;
	return globals::nerps::g_NERPs_REGISTERS_TABLE[7];
}



int __cdecl lego::nerps::funcs::NERPFunc__SetR0(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[0] = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetR1(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[1] = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetR2(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[2] = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetR3(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[3] = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetR4(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[4] = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetR5(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[5] = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetR6(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[6] = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetR7(int *stack)
{
	globals::nerps::g_NERPs_REGISTERS_TABLE[7] = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTutorialFlags(int *stack)
{
	globals::nerps::g_NERPs_TutorialFlags = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTrainFlags(int *stack)
{
	return globals::nerps::g_NERPs_TrainFlags;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTrainFlags(int *stack)
{
	globals::nerps::g_NERPs_TrainFlags = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMonstersOnLevel(int *stack)
{
	int iVar1;
	int iVar2;
	int iVar3;
	
	iVar1 = game::Level_GetObjectsOfLevel("LavaMonster",0);
	iVar2 = game::Level_GetObjectsOfLevel("RockMonster",0);
	iVar3 = game::Level_GetObjectsOfLevel("IceMonster",0);
	return iVar3 + iVar1 + iVar2;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetBuildingsTeleported(int *stack)
{
	return globals::g_BuildingsTeleported;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetBuildingsTeleported(int *stack)
{
	game::Game_SetNumBuildingsTeleported(*stack);
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetMessagePermit(int *stack)
{
	globals::nerps::g_NERPs_IsLoaded = *stack;
	if (*stack == 1) {
		FUN_00426290(0,1);
		FUN_004262d0(0);
	}
	FLAGS_00504610 = 0;
	DAT_00504614 = 0;
	return *stack;
}



BOOL __cdecl lego::nerps::NERPs_IsLoaded(void)
{
	return globals::nerps::g_NERPs_IsLoaded;
}



int __cdecl lego::nerps::NERPs_GetMessageWait(void)
{
	return globals::nerps::g_NERPs_MessageWait;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetMessageWait(int *stack)
{
	globals::nerps::g_NERPs_MessageWait = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetMessageTimerValues(int *stack)
{
	globals::nerps::g_NERPs_MessageTimerValues[0] = (float)(ulonglong)(uint)*stack;
	globals::nerps::g_NERPs_MessageTimerValues[1] = (float)(ulonglong)(uint)stack[1];
	globals::nerps::g_NERPs_MessageTimerValues[2] = (float)(ulonglong)(uint)stack[2];
	return 1;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

int __cdecl lego::nerps::funcs::NERPFunc__GetMessageTimer(int *stack)
{
	longlong lVar1;
	
	lVar1 = __ftol((float10)_DAT_0050098c);
	return (int)lVar1;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetMessage(int *stack)
{
	BOOL BVar1;
	char *pcVar2;
	int iVar3;
	uint uVar4;
	
	BVar1 = NERPs_IsLoaded();
	if (BVar1 != 0) {
		return 0;
	}
	uVar4 = *stack;
	if (uVar4 != 0) {
		uVar4 -= 1;
	}
	pcVar2 = (char *)FUN_004534c0(uVar4);
	if (uVar4 != (&globals::nerps::g_NERPMessageSounds_UNKCOUNT)[UINT_00556de0]) {
		if (UINT_00556de0 == 8) {
			DAT_00556dc0 = DAT_00556dd0;
			DAT_00556dc4 = DAT_00556dd4;
			DAT_00556dcc = DAT_00556ddc;
			DAT_00556dc8 = DAT_00556dd8;
			UINT_00556de0 = 4;
		}
		(&DAT_00556dc0)[UINT_00556de0] = uVar4;
		UINT_00556de0 += 1;
		if (UINT_00556de0 != 0) {
			FUN_004262d0(1);
		}
		if (UINT_00556de4 != 0) {
			UINT_00556de4 += 1;
		}
	}
	FUN_0046aee0(pcVar2,stack[1]);
	DAT_00500988 = stack[1];
	BOOL_004a7740 = 1;
	iVar3 = NERPs_GetMessageWait();
	if (iVar3 != 0) {
		draw::Draw_Render();
		while ((globals::g_KeyboardState_Current_TABLE[28] == 0 ||
					 (globals::g_KeyboardState_Previous_TABLE[28] ==
						globals::g_KeyboardState_Current_TABLE[28]))) {
			input::Input_UpdateKeyboardState();
		}
	}
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetObjectiveSwitch(int *stack)
{
	DAT_005009bc = *stack;
	return *stack;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetObjectiveSwitch(int *stack)
{
	if (DAT_005009bc != 0) {
		DAT_005009bc = 0;
		return 1;
	}
	return 0;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetObjectiveShowing(int *stack)
{
	BOOL BVar1;
	
	BVar1 = game::Level_IsObjectiveFinished();
	return (uint)(BVar1 != 0);
}



void __cdecl FUN_00456ad0(void)
{
	if (lego::globals::nerps::g_NERPs_UnkSampleIndex != -1) {
		lego::snd::SFX_UnkAdjustVolumeOrPlay___0047b030
							(2,NULL,lego::globals::nerps::g_NERPs_UnkSampleIndex,0,NULL);
	}
	return;
}



// WARNING: Could not reconcile some variable overlaps
// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl lego::game::Level_NERPMessage_Parse(char *param_1,undefined4 *param_2,BOOL param_3)
{
	char cVar1;
	bool bVar2;
	byte bVar3;
	BOOL BVar4;
	int iVar5;
	uint uVar6;
	uint uVar7;
	undefined4 *puVar8;
	char *pcVar9;
	ImageBMP **ppIVar10;
	float10 fVar11;
	undefined4 *local_164;
	float local_160;
	uint local_15c;
	undefined4 uStack344;
	float local_154;
	ImageBMP *local_150 [20];
	char local_100 [256];
	
	ppIVar10 = local_150;
	local_150[0] = NULL;
	local_15c &= 0xffffff00;
	for (iVar5 = 0x13; ppIVar10 = ppIVar10 + 1, iVar5 != 0; iVar5 += -1) {
		*ppIVar10 = NULL;
	}
	local_154 = globals::nerps::g_NERPs_MessageTimerValues[2];
	if (((globals::nerps::g_NERPMessages_COUNT == 0) &&
			(globals::nerps::g_NERPMessageSounds_COUNT == 0)) && (param_2 != NULL)) {
		uVar6 = 0xffffffff;
		do {
			pcVar9 = param_1;
			if (uVar6 == 0) break;
			uVar6 -= 1;
			pcVar9 = param_1 + 1;
			cVar1 = *param_1;
			param_1 = pcVar9;
		} while (cVar1 != '\0');
		uVar6 = ~uVar6;
		puVar8 = (undefined4 *)(pcVar9 + -uVar6);
		for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
			*param_2 = *puVar8;
			puVar8 = puVar8 + 1;
			param_2 = param_2 + 1;
		}
		for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
			*(undefined *)param_2 = *(undefined *)puVar8;
			puVar8 = (undefined4 *)((int)puVar8 + 1);
			param_2 = (undefined4 *)((int)param_2 + 1);
		}
	}
	else {
		cVar1 = *param_1;
		local_164 = param_2;
		while (cVar1 != '\0') {
			cVar1 = *param_1;
			if (cVar1 == '<') {
				cVar1 = param_1[1];
				param_1 = param_1 + 1;
				bVar2 = false;
				pcVar9 = local_100;
				while ((cVar1 != '\0' && (!bVar2))) {
					if (cVar1 == '>') {
						*pcVar9 = '\0';
						bVar3 = 0;
						if (globals::nerps::g_NERPMessages_COUNT != 0) {
							uVar6 = 0;
							do {
								iVar5 = std::_stricmp(*(char **)((int)globals::nerps::g_NERPMessages_TABLE +
																								uVar6 * 8),local_100);
								if (iVar5 == 0) {
									bVar2 = true;
									local_150[local_15c & 0xff] =
											 *(ImageBMP **)
												((int)globals::nerps::g_NERPMessages_TABLE + (uint)bVar3 * 8 + 4);
									local_15c = local_15c & 0xffffff00 | (uint)(byte)((char)local_15c + 1);
									break;
								}
								bVar3 += 1;
								uVar6 = (uint)bVar3;
							} while (uVar6 < (uint)globals::nerps::g_NERPMessages_COUNT);
						}
					}
					else {
						*pcVar9 = cVar1;
					}
					pcVar9 = pcVar9 + 1;
					param_1 = param_1 + 1;
					cVar1 = *param_1;
				}
			}
			else {
				if (cVar1 == '#') {
					cVar1 = param_1[1];
					param_1 = param_1 + 1;
					bVar2 = false;
					pcVar9 = local_100;
					while ((cVar1 != '\0' && (!bVar2))) {
						if (cVar1 == '#') {
							*pcVar9 = '\0';
							bVar3 = 0;
							if (globals::nerps::g_NERPMessageSounds_COUNT != 0) {
								uVar6 = 0;
								do {
									iVar5 = std::_stricmp(globals::nerps::g_NERPMessageSounds_TABLE[uVar6].key,
																				local_100);
									if (iVar5 == 0) {
										uVar6 = (uint)bVar3;
										iVar5 = globals::nerps::g_NERPMessageSounds_TABLE[uVar6].sampleIndex;
										if (globals::nerps::g_NERPMessageSounds_UNKCOUNT != uVar6) {
											globals::nerps::g_NERPMessageSounds_UNKCOUNT = uVar6;
											fVar11 = lego::snd::Sample_GetDuration(iVar5);
											local_154 = (float)(fVar11 * (float10)globals::nerps::
																														g_NERPs_MessageTimerValues[0] +
																				 (float10)globals::nerps::g_NERPs_MessageTimerValues[1]);
											BVar4 = lego::snd::Audio_GetFlag1();
											if (BVar4 != 0) {
												FUN_00465140();
												fVar11 = lego::snd::Sample_GetDuration(iVar5);
												FUN_00465180((float)(fVar11 * (float10)25.0));
												lego::snd::SFX_UnkAdjustVolumeOrPlay___0047b030(2,NULL,iVar5,0,NULL);
												globals::nerps::g_NERPs_UnkSampleIndex = iVar5;
												iVar5 = nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
												if (iVar5 == 0) {
													FUN_00401800(0x14,1);
													DAT_00556df0 = 1;
												}
											}
										}
										break;
									}
									bVar3 += 1;
									uVar6 = (uint)bVar3;
								} while (uVar6 < (uint)globals::nerps::g_NERPMessageSounds_COUNT);
							}
							bVar2 = true;
						}
						else {
							*pcVar9 = cVar1;
						}
						pcVar9 = pcVar9 + 1;
						param_1 = param_1 + 1;
						cVar1 = *param_1;
					}
				}
				else {
					if (param_2 != NULL) {
						*(char *)local_164 = cVar1;
						local_164 = (undefined4 *)((int)local_164 + 1);
					}
					param_1 = param_1 + 1;
				}
			}
			cVar1 = *param_1;
		}
		if (param_2 != NULL) {
			*(char *)local_164 = '\0';
		}
		if ((char)local_15c != '\0') {
			ppIVar10 = local_150;
			uVar7 = local_15c & 0xff;
			iVar5 = 0;
			uVar6 = uVar7;
			do {
				local_15c = globals::nerps::g_NERPs_IconWidth * uVar7;
				local_160 = globals::nerps::g_NERPs_IconPos.y;
				uStack344 = 0;
				local_164 = (undefined4 *)
										((float)(ulonglong)(uint)(globals::nerps::g_NERPs_IconSpace * iVar5) +
										(globals::nerps::g_NERPs_IconPos.x - (float)(ulonglong)local_15c));
				image::Image_Blt__0047df70(*ppIVar10,NULL,(float *)&local_164,NULL);
				iVar5 += 1;
				ppIVar10 = ppIVar10 + 1;
				uVar6 -= 1;
			} while (uVar6 != 0);
		}
	}
	if (param_3 != 0) {
		_DAT_0050098c = local_154;
	}
	return;
}



void __cdecl lego::game::Level_InitBlockPointersTable(LevelData *level)
{
	BlockPointer *pBVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	BlockPointer **ppBVar5;
	uint uVar6;
	
	uVar4 = 0;
	ppBVar5 = level->blockPointers;
	for (iVar2 = 0x37; iVar2 != 0; iVar2 += -1) {
		*ppBVar5 = NULL;
		ppBVar5 = ppBVar5 + 1;
	}
	if ((level->dimensions).width != 0) {
		do {
			uVar6 = 0;
			if ((level->dimensions).height != 0) {
				do {
					if (level->blocks[uVar6 * (level->dimensions).width + uVar4].blockpointer != 0) {
						pBVar1 = (BlockPointer *)std::malloc(0xc);
						uVar3 = (uint)level->blocks[uVar6 * (level->dimensions).width + uVar4].blockpointer;
						(pBVar1->position).x = uVar4;
						(pBVar1->position).y = uVar6;
						pBVar1->id = (uint)level->blockPointers[uVar3];
						level->blockPointers[uVar3] = pBVar1;
						level->blocks[uVar6 * (level->dimensions).width + uVar4].blockpointer = 0;
					}
					uVar6 += 1;
				} while (uVar6 < (uint)(level->dimensions).height);
			}
			uVar4 += 1;
		} while (uVar4 < (uint)(level->dimensions).width);
	}
	return;
}



int __cdecl FUN_00456ef0(int param_1,int param_2)
{
	int iVar1;
	
	if (((-1 < param_2) && (param_2 < 0x37)) &&
		 (iVar1 = *(int *)(param_1 + 0x114 + param_2 * 4), iVar1 != 0)) {
		return iVar1;
	}
	return 0;
}



void __cdecl FUN_00456f20(void)
{
	void *pvVar1;
	LevelData *pLVar2;
	void *buffer;
	BlockPointer **ppBVar3;
	int iVar4;
	
	pLVar2 = lego::game::GetLevel();
	iVar4 = 0;
	ppBVar3 = pLVar2->blockPointers;
	do {
		buffer = (void *)FUN_00456ef0((int)pLVar2,iVar4);
		while (buffer != NULL) {
			pvVar1 = *(void **)((int)buffer + 8);
			std::free(buffer);
			buffer = pvVar1;
		}
		*ppBVar3 = NULL;
		iVar4 += 1;
		ppBVar3 = ppBVar3 + 1;
	} while (iVar4 < 0x37);
	return;
}



void __cdecl FUN_00456f70(int param_1,undefined *param_2,undefined4 param_3)
{
	LevelData *pLVar1;
	undefined4 *puVar2;
	int iVar3;
	
	pLVar1 = lego::game::GetLevel();
	puVar2 = (undefined4 *)FUN_00456ef0((int)pLVar1,param_1);
	while ((puVar2 != NULL &&
				 (iVar3 = (*(code *)param_2)(puVar2,*puVar2,puVar2[1],param_3), iVar3 != 0))) {
		puVar2 = (undefined4 *)puVar2[2];
	}
	return;
}



BOOL __cdecl
lego::game::Game_UnkTutorialBlockGet(undefined4 param_1,int x,int y,undefined4 *param_4)
{
	LiveObject *liveObj1;
	LevelData *level;
	BOOL BVar1;
	uint uVar2;
	uint *puVar3;
	int iVar4;
	char **ppcVar5;
	Point2I local_48;
	uint local_40;
	uint local_3c;
	Vector3F local_38;
	char *local_2c [5];
	CreatureData *local_18;
	BuildingData *local_14;
	ResourceData *local_10;
	UpgradeData *local_c;
	LiveObject *local_8;
	uint local_4;
	
	level = GetLevel();
	local_48.x = x;
	local_48.y = y;
	switch(*param_4) {
	case 1:
		param_4[2] = param_4[2] +
								 (level->blocks[(level->dimensions).width * y + x].flags1 & BLOCK1_UNK_8);
		return 1;
	case 2:
		iVar4 = 0;
		level = GetLevel();
		FUN_00430460(level,x,y,iVar4);
		return 1;
	case 3:
		BVar1 = Level_IsBlockPowerPath(&local_48);
		param_4[2] = param_4[2] + BVar1;
		return 1;
	case 4:
		iVar4 = (level->dimensions).width * y + x;
		level->blocks[iVar4].flags1 = level->blocks[iVar4].flags1 & ~BLOCK1_RUBBLE_FULL;
		FUN_00432bc0(&local_48);
		FUN_00432530(&local_48);
		return 1;
	case 5:
		FUN_0042dd70(NULL,(uint *)&local_48,1);
		return 1;
	case 6:
		res::Res_GetPosition((globals::g_Game.structbc_24)->resData_2c,NULL,&local_38);
		SurfaceMap_ToBlockCoordinatesNoZ
							(level->surfaceMap,local_38.x,local_38.y,(int *)&local_40,(int *)&local_3c);
		if ((local_48.x == local_40) && (local_48.y == local_3c)) {
			param_4[2] = 1;
			return 1;
		}
		break;
	case 7:
		uVar2 = Level_GetEmergeCreature();
		puVar3 = FUN_0043b1f0((int **)(globals::g_Game.RockMonsterData_TABLE + uVar2),4.203895e-45,uVar2
													,local_48.x,local_48.y);
		if (puVar3 != NULL) {
			*(undefined4 *)(puVar3[0xcd] + 0xe8) = 0x42700000;
			return 1;
		}
		break;
	case 8:
		FUN_00403320((undefined4 *)&local_48);
		return 1;
	case 9:
		FUN_00403360((int *)&local_48);
		return 1;
	case 10:
		ppcVar5 = local_2c;
		for (iVar4 = 0xb; iVar4 != 0; iVar4 += -1) {
			*ppcVar5 = NULL;
			ppcVar5 = ppcVar5 + 1;
		}
		local_18 = (CreatureData *)x;
		local_14 = (BuildingData *)y;
		FUN_00437a70(FUN_00457320,(LiveObject *)local_2c);
		param_4[2] = local_2c[2] + param_4[2];
		return 1;
	case 0xb:
		ppcVar5 = local_2c;
		for (iVar4 = 0xb; iVar4 != 0; iVar4 += -1) {
			*ppcVar5 = NULL;
			ppcVar5 = ppcVar5 + 1;
		}
		local_18 = (CreatureData *)x;
		local_14 = (BuildingData *)y;
		local_10 = (ResourceData *)0x1;
		FUN_00437a70(FUN_00457390,(LiveObject *)local_2c);
		return 1;
	case 0xc:
		ppcVar5 = local_2c;
		for (iVar4 = 0xb; iVar4 != 0; iVar4 += -1) {
			*ppcVar5 = NULL;
			ppcVar5 = ppcVar5 + 1;
		}
		local_18 = (CreatureData *)x;
		local_14 = (BuildingData *)y;
		local_c = (UpgradeData *)0x1;
		local_4 = 2;
		FUN_00437a70(FUN_00457320,(LiveObject *)local_2c);
		liveObj1 = local_8;
		if (local_2c[2] != NULL) {
			local_4 = 6;
			FUN_00437a70(FUN_00457320,(LiveObject *)local_2c);
			if (local_2c[2] != NULL) {
				FUN_00439ce0(liveObj1,local_8);
				return 1;
			}
		}
		break;
	case 0xd:
		ppcVar5 = local_2c;
		for (iVar4 = 0xb; iVar4 != 0; iVar4 += -1) {
			*ppcVar5 = NULL;
			ppcVar5 = ppcVar5 + 1;
		}
		local_18 = (CreatureData *)x;
		local_14 = (BuildingData *)y;
		FUN_00437a70(FUN_00457320,(LiveObject *)local_2c);
		param_4[2] = local_2c[2] + param_4[2];
	}
	return 1;
}



undefined4 __cdecl FUN_00457320(int *param_1,int param_2)
{
	int local_8;
	int local_4;
	
	if (param_1 != NULL) {
		lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_1,&local_8,&local_4);
		if ((local_8 == *(int *)(param_2 + 0x14)) && (local_4 == *(int *)(param_2 + 0x18))) {
			if ((*(int *)(param_2 + 0x20) != 0) && (*param_1 == *(int *)(param_2 + 0x28))) {
				*(int **)(param_2 + 0x24) = param_1;
				*(undefined4 *)(param_2 + 8) = 1;
				return 1;
			}
			*(int *)(param_2 + 8) = *(int *)(param_2 + 8) + 1;
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00457390(undefined4 *param_1,int param_2)
{
	int local_8;
	int local_4;
	
	if (param_1 != NULL) {
		lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_1,&local_8,&local_4);
		if ((local_8 == *(int *)(param_2 + 0x14)) && (local_4 == *(int *)(param_2 + 0x18))) {
			param_1[0xfe] = 1;
			return 0;
		}
		param_1[0xfe] = 0;
	}
	return 0;
}



int __cdecl
lego::nerps::funcs::NERPFunc__MakeSomeoneOnThisBlockPickUpSomethingOnThisBlock(int *stack)
{
	undefined4 local_2c;
	int local_28;
	int local_24;
	
	local_24 = 0;
	local_28 = *stack;
	local_2c = 0xc;
	FUN_00456f70(local_28,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
	return local_24;
}



void __cdecl FUN_00457430(int param_1,undefined4 *param_2)
{
	LevelData *pLVar1;
	int *piVar2;
	BOOL BVar3;
	int local_34;
	int local_30;
	undefined4 local_2c;
	int local_28;
	undefined4 local_24;
	int local_18;
	int local_14;
	
	pLVar1 = lego::game::GetLevel();
	for (piVar2 = (int *)FUN_00456ef0((int)pLVar1,param_1); piVar2 != NULL; piVar2 = (int *)piVar2[2])
	{
		if (param_2 == (undefined4 *)0x1) {
			pLVar1->blocks[(pLVar1->dimensions).width * piVar2[1] + *piVar2].blockpointer = (byte)param_1;
			local_28 = param_1;
			local_24 = 0;
			local_2c = 0xb;
			FUN_00456f70(param_1,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
		}
		if (param_2 == NULL) {
			pLVar1->blocks[(pLVar1->dimensions).width * piVar2[1] + *piVar2].blockpointer = 0;
		}
	}
	if ((DAT_00556dec != 0) && (BVar3 = FUN_0042df20(DAT_00556dec - 1,(int *)&param_2), BVar3 != 0)) {
		lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_2,&local_34,&local_30);
		local_18 = local_34;
		local_14 = local_30;
		FUN_00457390(param_2,(int)&local_2c);
	}
	return;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetCongregationAtTutorial(int *stack)
{
	int local_2c;
	int local_28;
	int local_24;
	
	local_24 = 0;
	local_28 = *stack;
	local_2c = 9 - (uint)(stack[1] != 0);
	FUN_00456f70(local_28,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
	return local_24;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetRockMonsterAtTutorial(int *stack)
{
	undefined4 local_2c;
	int local_28;
	int local_24;
	
	local_2c = 7;
	local_28 = *stack;
	local_24 = 0;
	FUN_00456f70(local_28,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
	return local_24;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetCameraGotoTutorial(int *stack)
{
	undefined4 local_2c;
	int local_28;
	int local_24;
	
	local_2c = 5;
	local_28 = *stack;
	local_24 = 0;
	FUN_00456f70(local_28,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
	return local_24;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetCameraAtTutorial(int *stack)
{
	undefined4 local_2c;
	int local_28;
	int local_24;
	
	local_2c = 6;
	local_28 = *stack;
	local_24 = 0;
	FUN_00456f70(local_28,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
	return local_24;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTutorialBlockIsGround(int *stack)
{
	undefined4 local_2c;
	int local_28;
	int local_24;
	
	local_2c = 1;
	local_28 = *stack;
	local_24 = 0;
	FUN_00456f70(local_28,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
	return local_24;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetTutorialBlockIsPath(int *stack)
{
	undefined4 local_2c;
	int local_28;
	int local_24;
	
	local_2c = 3;
	local_28 = *stack;
	local_24 = 0;
	FUN_00456f70(local_28,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
	return local_24;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTutorialBlockIsGround(int *stack)
{
	undefined4 local_2c;
	int local_28;
	int local_24;
	
	local_2c = 2;
	local_28 = *stack;
	local_24 = 0;
	FUN_00456f70(local_28,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
	return local_24;
}



int __cdecl lego::nerps::funcs::NERPFunc__SetTutorialBlockIsPath(int *stack)
{
	undefined4 local_2c;
	int local_28;
	int local_24;
	
	local_2c = 4;
	local_28 = *stack;
	local_24 = 0;
	FUN_00456f70(local_28,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
	return local_24;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetUnitAtBlock(int *stack)
{
	undefined4 local_2c;
	int local_28;
	int local_24;
	
	local_2c = 10;
	local_28 = *stack;
	local_24 = 0;
	FUN_00456f70(local_28,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
	return local_24;
}



int __cdecl lego::nerps::funcs::NERPFunc__GetMonsterAtTutorial(int *stack)
{
	undefined4 local_2c;
	int local_28;
	int local_24;
	
	local_2c = 0xd;
	local_28 = *stack;
	local_24 = 0;
	FUN_00456f70(local_28,PTR_Game_UnkTutorialBlockGet_004a776c,&local_2c);
	return local_24;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl
lego::game::Level_LoadObjectiveText
					(CFGProperty *root,undefined4 param_2,char *param_3,LevelData *level,char *filename)
{
	char cVar1;
	Struct_830 *pSVar2;
	uint uVar3;
	char *pcVar4;
	ImageFont *pIVar5;
	uint uVar6;
	char *pcVar7;
	int iVar8;
	int iVar9;
	Struct_830 **ppSVar10;
	void **ppvVar11;
	undefined4 *puVar12;
	undefined4 *puVar13;
	char *pcVar14;
	bool bVar15;
	longlong lVar16;
	size_t _MaxCount;
	size_t local_cc8;
	int local_cc0;
	Rect2F local_cbc;
	int local_cac;
	int local_ca8;
	Rect2F local_ca4;
	char *local_c94;
	Rect2F local_c90;
	char local_c80 [126];
	char acStack3074 [1026];
	undefined4 local_800 [256];
	char local_400 [1024];
	
	local_ca4.x = (float)(level->objective).ObjectiveImage_width_x - -60.0;
	local_c90.y = (float)(level->objective).ObjectiveImage_height_y - -220.0;
	local_ca4.y = (float)(level->objective).ObjectiveImage_height_y - -60.0;
	local_cbc.x = (float)(level->objective).ObjectiveImage_width_x - -40.0;
	local_cbc.y = (float)(level->objective).ObjectiveImage_height_y - -34.0;
	local_c90.width = 320.0;
	local_c90.height = 20.0;
	local_ca4.width = 390.0;
	local_cac = 0;
	local_ca4.height = 180.0;
	local_cbc.width = 422.0;
	local_cbc.height = 21.0;
	local_cc0 = 0;
	iVar8 = 0;
	local_ca8 = 0;
	local_c90.x = local_ca4.x;
	std::sprintf(&DAT_00500bc8,"%s",filename);
	if (PTR_ARRAY_00500e08[0] != NULL) {
		FUN_00485450((undefined *)PTR_ARRAY_00500e08[0]);
	}
	if (PTR_00500e18 != NULL) {
		FUN_00485450((undefined *)PTR_00500e18);
	}
	if (PTR_00500e1c != NULL) {
		FUN_00485450((undefined *)PTR_00500e1c);
	}
	if (PTR_00500e20 != NULL) {
		FUN_00485450((undefined *)PTR_00500e20);
	}
	if (PTR_00500e24 != NULL) {
		FUN_00485450((undefined *)PTR_00500e24);
	}
	ppSVar10 = PTR_ARRAY_00500e08;
	do {
		pSVar2 = unk::Lego_unkMakeDrawRegion__004853b0(globals::g_Game.bmpMbriefFONT,&local_ca4,0x400);
		*ppSVar10 = pSVar2;
		draw::Draw_SetStruct830_Flag4(pSVar2,0);
		ppSVar10 = ppSVar10 + 1;
	} while (ppSVar10 < &PTR_00500e18);
	PTR_00500e24 = unk::Lego_unkMakeDrawRegion__004853b0
													 (globals::g_Game.bmpMbriefFONT2,&local_c90,0x400);
	_DAT_00500e2c = 0;
	PTR_00500bc4 = lego::file::File_Open(&DAT_00500bc8,"r");
	ppvVar11 = (void **)&DAT_00500c48;
	do {
		if (*ppvVar11 != NULL) {
			std::free(*ppvVar11);
			*ppvVar11 = NULL;
		}
		ppvVar11[0x6c] = NULL;
		ppvVar11[0x68] = NULL;
		ppvVar11[100] = NULL;
		ppvVar11 = ppvVar11 + 1;
	} while (ppvVar11 < &DAT_00500c58);
	if (PTR_00500bc4 != NULL) {
		lego::file::File_Seek(PTR_00500bc4,0,0);
		uVar6 = 0xffffffff;
		pcVar4 = param_3;
		do {
			if (uVar6 == 0) break;
			uVar6 -= 1;
			cVar1 = *pcVar4;
			pcVar4 = pcVar4 + 1;
		} while (cVar1 != '\0');
		uVar3 = 0;
		if (~uVar6 != 1) {
			do {
				if (iVar8 == 2) {
					local_c94 = param_3 + uVar3;
					local_ca8 = 1;
					break;
				}
				if (param_3[uVar3] == ':') {
					iVar8 += 1;
				}
				uVar3 += 1;
			} while (uVar3 < ~uVar6 - 1);
		}
		pcVar4 = lego::file::File_GetS(acStack3074 + 2,0x400,PTR_00500bc4);
		while (pcVar4 != NULL) {
			if (local_ca8 != 0) {
				uVar6 = 0xffffffff;
				pcVar4 = local_c94;
				do {
					pcVar7 = pcVar4;
					if (uVar6 == 0) break;
					uVar6 -= 1;
					pcVar7 = pcVar4 + 1;
					cVar1 = *pcVar4;
					pcVar4 = pcVar7;
				} while (cVar1 != '\0');
				uVar6 = ~uVar6;
				puVar12 = (undefined4 *)(pcVar7 + -uVar6);
				puVar13 = local_800;
				for (uVar3 = uVar6 >> 2; uVar3 != 0; uVar3 -= 1) {
					*puVar13 = *puVar12;
					puVar12 = puVar12 + 1;
					puVar13 = puVar13 + 1;
				}
				for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
					*(undefined *)puVar13 = *(undefined *)puVar12;
					puVar12 = (undefined4 *)((int)puVar12 + 1);
					puVar13 = (undefined4 *)((int)puVar13 + 1);
				}
				local_cc8 = std::sprintf(local_400,"[%s]",local_800);
				if (acStack3074[2] == '[') {
					local_cac = 0;
					local_cc0 = 0;
				}
				if (local_cac != 0) {
					uVar6 = 0xffffffff;
					uVar3 = 10;
					pcVar4 = acStack3074 + 2;
					do {
						if (uVar6 == 0) break;
						uVar6 -= 1;
						cVar1 = *pcVar4;
						pcVar4 = pcVar4 + 1;
					} while (cVar1 != '\0');
					_MaxCount = 10;
					iVar9 = 4;
					acStack3074[~uVar6] = '\0';
					iVar8 = std::_strnicmp(acStack3074 + 2,"Objective:",_MaxCount);
					if (iVar8 == 0) {
						iVar9 = 0;
					}
					else {
						uVar3 = 0xb;
						iVar8 = std::_strnicmp(acStack3074 + 2,"Completion:",0xb);
						if (iVar8 == 0) {
							iVar9 = 1;
						}
						else {
							uVar3 = 8;
							iVar8 = std::_strnicmp(acStack3074 + 2,"Failure:",8);
							if (iVar8 == 0) {
								iVar9 = 2;
							}
							else {
								uVar3 = 0xf;
								iVar8 = std::_strnicmp(acStack3074 + 2,"CrystalFailure:",0xf);
								if (iVar8 == 0) {
									iVar9 = 3;
								}
							}
						}
					}
					if (iVar9 != 4) {
						uVar6 = 0xffffffff;
						pcVar4 = acStack3074 + 2;
						do {
							if (uVar6 == 0) break;
							uVar6 -= 1;
							cVar1 = *pcVar4;
							pcVar4 = pcVar4 + 1;
						} while (cVar1 != '\0');
						if (uVar3 < ~uVar6 - 1) {
							do {
								if ((acStack3074[uVar3 + 2] != ' ') && (acStack3074[uVar3 + 2] != '\t')) break;
								uVar6 = 0xffffffff;
								uVar3 += 1;
								pcVar4 = acStack3074 + 2;
								do {
									if (uVar6 == 0) break;
									uVar6 -= 1;
									cVar1 = *pcVar4;
									pcVar4 = pcVar4 + 1;
								} while (cVar1 != '\0');
							} while (uVar3 < ~uVar6 - 1);
						}
						bVar15 = false;
						pcVar4 = acStack3074 + 2;
						cVar1 = acStack3074[2];
						while (cVar1 != '\0') {
							if ((bVar15) && ((*pcVar4 == 'a' || (*pcVar4 == 'n')))) {
								pcVar4[-1] = ' ';
								if (*pcVar4 == 'a') {
									iVar8 = (&DAT_00500df8)[iVar9];
									*pcVar4 = '\a';
									(&DAT_00500df8)[iVar9] = iVar8 + 1;
									bVar15 = false;
								}
								else {
									*pcVar4 = '\n';
									bVar15 = false;
								}
							}
							else {
								bVar15 = *pcVar4 == '\\';
							}
							pcVar7 = pcVar4 + 1;
							pcVar4 = pcVar4 + 1;
							cVar1 = *pcVar7;
						}
						Game_DisplayInfoMessage(PTR_ARRAY_00500e08[iVar9],"%s",acStack3074 + uVar3 + 2);
						pcVar4 = std::_strdup(acStack3074 + uVar3 + 2);
						(&DAT_00500c48)[iVar9] = pcVar4;
					}
				}
				if (local_cc0 != 0) {
					uVar6 = 0xffffffff;
					pcVar4 = acStack3074 + 2;
					pcVar7 = acStack3074 + 2;
					do {
						if (uVar6 == 0) break;
						uVar6 -= 1;
						cVar1 = *pcVar7;
						pcVar7 = pcVar7 + 1;
					} while (cVar1 != '\0');
					acStack3074[~uVar6] = '\0';
					Game_DisplayInfoMessage(PTR_00500e24,"%s",pcVar4);
					local_cc0 = 0;
					_DAT_00500e2c = 1;
				}
				iVar8 = std::_strnicmp(local_400,acStack3074 + 2,local_cc8);
				if (iVar8 == 0) {
					local_cac = 1;
				}
				iVar8 = std::_strnicmp(acStack3074 + 2,"[BEGIN]",7);
				if (iVar8 == 0) {
					local_cc0 = 1;
				}
			}
			pcVar4 = lego::file::File_GetS(acStack3074 + 2,0x400,PTR_00500bc4);
		}
		lego::file::File_Close(PTR_00500bc4);
	}
	pcVar4 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MissionBriefingText",0);
	pcVar4 = cfg::CFG_GetPropertyValue(root,pcVar4);
	if (pcVar4 != NULL) {
		pIVar5 = FUN_00401b90(globals::g_Game.bmpMbriefFONT2,pcVar4);
		local_cbc.x = (local_cbc.width * 0.5 - (float)((uint)pIVar5 >> 1)) + local_cbc.x;
		local_cbc.width = (float)ZEXT48(pIVar5);
		PTR_00500e18 = unk::Lego_unkMakeDrawRegion__004853b0
														 (globals::g_Game.bmpMbriefFONT2,&local_cbc,0x400);
		if (PTR_00500e18 != NULL) {
			iVar8 = -1;
			uVar6 = 0;
			pcVar7 = pcVar4;
			do {
				if (iVar8 == 0) break;
				iVar8 += -1;
				cVar1 = *pcVar7;
				pcVar7 = pcVar7 + 1;
			} while (cVar1 != '\0');
			if (iVar8 != -1) {
				pcVar7 = pcVar4;
				do {
					cVar1 = *pcVar7;
					if (cVar1 == '_') {
						cVar1 = ' ';
					}
					pcVar7[(int)(local_c80 + -(int)pcVar4)] = cVar1;
					uVar6 += 1;
					uVar3 = 0xffffffff;
					pcVar7 = pcVar7 + 1;
					pcVar14 = pcVar4;
					do {
						if (uVar3 == 0) break;
						uVar3 -= 1;
						cVar1 = *pcVar14;
						pcVar14 = pcVar14 + 1;
					} while (cVar1 != '\0');
				} while (uVar6 < ~uVar3);
			}
			FUN_00485c70(PTR_00500e18);
			Game_DisplayInfoMessage(PTR_00500e18,"%s",local_c80);
		}
	}
	pcVar4 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MissionCompletedText",0);
	pcVar4 = cfg::CFG_GetPropertyValue(root,pcVar4);
	if (pcVar4 != NULL) {
		pIVar5 = FUN_00401b90(globals::g_Game.bmpMbriefFONT2,pcVar4);
		local_cbc.x = (local_cbc.width * 0.5 - (float)((uint)pIVar5 >> 1)) + local_cbc.x;
		local_cbc.width = (float)ZEXT48(pIVar5);
		PTR_00500e1c = unk::Lego_unkMakeDrawRegion__004853b0
														 (globals::g_Game.bmpMbriefFONT2,&local_cbc,0x400);
		if (PTR_00500e1c != NULL) {
			iVar8 = -1;
			uVar6 = 0;
			pcVar7 = pcVar4;
			do {
				if (iVar8 == 0) break;
				iVar8 += -1;
				cVar1 = *pcVar7;
				pcVar7 = pcVar7 + 1;
			} while (cVar1 != '\0');
			if (iVar8 != -1) {
				pcVar7 = pcVar4;
				do {
					cVar1 = *pcVar7;
					if (cVar1 == '_') {
						cVar1 = ' ';
					}
					pcVar7[(int)(local_c80 + -(int)pcVar4)] = cVar1;
					uVar6 += 1;
					uVar3 = 0xffffffff;
					pcVar7 = pcVar7 + 1;
					pcVar14 = pcVar4;
					do {
						if (uVar3 == 0) break;
						uVar3 -= 1;
						cVar1 = *pcVar14;
						pcVar14 = pcVar14 + 1;
					} while (cVar1 != '\0');
				} while (uVar6 < ~uVar3);
			}
			FUN_00485c70(PTR_00500e1c);
			Game_DisplayInfoMessage(PTR_00500e1c,"%s",local_c80);
		}
	}
	pcVar4 = cfg::CFG_JoinPath(globals::g_Game.CfgRootName,"Main","MissionFailedText",0);
	pcVar4 = cfg::CFG_GetPropertyValue(root,pcVar4);
	if (pcVar4 != NULL) {
		pIVar5 = FUN_00401b90(globals::g_Game.bmpMbriefFONT2,pcVar4);
		local_cbc.x = (local_cbc.width * 0.5 - (float)((uint)pIVar5 >> 1)) + local_cbc.x;
		local_cbc.width = (float)ZEXT48(pIVar5);
		PTR_00500e20 = unk::Lego_unkMakeDrawRegion__004853b0
														 (globals::g_Game.bmpMbriefFONT2,&local_cbc,0x400);
		if (PTR_00500e20 != NULL) {
			iVar8 = -1;
			uVar6 = 0;
			pcVar7 = pcVar4;
			do {
				if (iVar8 == 0) break;
				iVar8 += -1;
				cVar1 = *pcVar7;
				pcVar7 = pcVar7 + 1;
			} while (cVar1 != '\0');
			if (iVar8 != -1) {
				pcVar7 = pcVar4;
				do {
					cVar1 = *pcVar7;
					if (cVar1 == '_') {
						cVar1 = ' ';
					}
					pcVar7[(int)(local_c80 + -(int)pcVar4)] = cVar1;
					uVar6 += 1;
					uVar3 = 0xffffffff;
					pcVar7 = pcVar7 + 1;
					pcVar14 = pcVar4;
					do {
						if (uVar3 == 0) break;
						uVar3 -= 1;
						cVar1 = *pcVar14;
						pcVar14 = pcVar14 + 1;
					} while (cVar1 != '\0');
				} while (uVar6 < ~uVar3);
			}
			FUN_00485c70(PTR_00500e20);
			Game_DisplayInfoMessage(PTR_00500e20,"%s",local_c80);
		}
	}
	if (_DAT_00500e2c == 0) {
		local_ca4.height = local_ca4.height + local_c90.height;
		ppSVar10 = PTR_ARRAY_00500e08;
		do {
			lVar16 = __ftol((float10)local_ca4.height);
			uVar6 = (uint)lVar16;
			lVar16 = __ftol((float10)local_ca4.width);
			FUN_00485490(*ppSVar10,(uint)lVar16,uVar6);
			ppSVar10 = ppSVar10 + 1;
		} while (ppSVar10 < PTR_ARRAY_00500e08 + 3);
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl
lego::game::Level_LoadObjectiveInfo
					(CFGProperty *root,char *keyRootPath,char *levelName,LevelData *level,int screenWidth,
					int screenHeight)
{
	ObjectiveData *pOVar1;
	char *pcVar2;
	uint uVar3;
	ImageBMP *pIVar4;
	int iVar5;
	uint uVar6;
	uint uVar7;
	char *pcVar8;
	BOOL BVar9;
	int iVar10;
	ObjectiveData *pOVar11;
	int local_500;
	ObjectType local_4fc;
	Point2I local_4f8;
	char *local_4f0;
	char *local_4ec;
	char *local_4e8;
	char *local_4e4;
	char *local_4e0;
	char *local_4dc;
	char local_400 [1024];
	
	pOVar1 = &level->objective;
	pOVar11 = pOVar1;
	for (iVar10 = 0x15; iVar10 != 0; iVar10 += -1) {
		pOVar11->ObjectiveImage = NULL;
		pOVar11 = (ObjectiveData *)&pOVar11->ObjectiveImage_width_x;
	}
	globals::g_ObjectiveFlags = OBJECTIVE_NONE;
	_DAT_00500e34 = 1;
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"DontShowObjectiveAdvisor",0);
	uVar3 = cfg::CFG_GetPropertyBool(root,pcVar2);
	if (uVar3 != 1) {
		globals::g_ObjectiveFlags |= OBJECTIVE_SHOWADVISOR;
	}
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"DontShowObjectiveAcheiveAdvisor",0);
	uVar3 = cfg::CFG_GetPropertyBool(root,pcVar2);
	if (uVar3 != 1) {
		globals::g_ObjectiveFlags |= OBJECTIVE_SHOWACHEIVEADVISOR;
	}
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"DontShowObjectiveFailedAdvisor",0);
	uVar3 = cfg::CFG_GetPropertyBool(root,pcVar2);
	if (uVar3 != 1) {
		globals::g_ObjectiveFlags |= OBJECTIVE_SHOWFAILEDADVISOR;
	}
	std::sprintf(local_400,"ObjectiveImage%ix%i",screenWidth,screenHeight);
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,local_400,0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = std::_strdup(pcVar2);
		iVar10 = lego::util::stringSplit(pcVar2,&local_4f0,",");
		if ((ImageBMP *)pOVar1->ObjectiveImage != NULL) {
			pool::ReservedPool_ImageBMP___Release((ImageBMP *)pOVar1->ObjectiveImage);
		}
		pIVar4 = image::Image_LoadBMP(local_4f0,0,0);
		pOVar1->ObjectiveImage = pIVar4;
		if (pIVar4 != NULL) {
			image::Image_SetFirstColorAsKey(pIVar4);
		}
		iVar5 = std::atoi(local_4ec);
		(level->objective).ObjectiveImage_width_x = (int)(float)iVar5;
		iVar5 = std::atoi(local_4e8);
		(level->objective).ObjectiveImage_height_y = (int)(float)iVar5;
		if ((iVar10 == 6) && (pOVar1->ObjectiveImage != NULL)) {
			uVar3 = std::atoi(local_4e4);
			uVar6 = std::atoi(local_4e0);
			uVar7 = std::atoi(local_4dc);
			image::Image_unkFogFromFloat__0047deb0
								((ImageBMP *)pOVar1->ObjectiveImage,(float)(ulonglong)(uVar3 / 0xff),
								 (float)(ulonglong)(uVar6 / 0xff),(float)(ulonglong)(uVar7 / 0xff),
								 (float)(ulonglong)(uVar3 / 0xff),(float)(ulonglong)(uVar6 / 0xff),
								 (float)(ulonglong)(uVar7 / 0xff));
		}
		std::free(pcVar2);
	}
	std::sprintf(local_400,"ObjectiveAcheivedImage%ix%i",screenWidth,screenHeight);
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,local_400,0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = std::_strdup(pcVar2);
		iVar10 = lego::util::stringSplit(pcVar2,&local_4f0,",");
		pIVar4 = (ImageBMP *)(level->objective).ObjectiveAcheivedImage;
		if (pIVar4 != NULL) {
			pool::ReservedPool_ImageBMP___Release(pIVar4);
		}
		pIVar4 = image::Image_LoadBMP(local_4f0,0,0);
		(level->objective).ObjectiveAcheivedImage = pIVar4;
		if (pIVar4 != NULL) {
			image::Image_SetFirstColorAsKey(pIVar4);
		}
		iVar5 = std::atoi(local_4ec);
		(level->objective).ObjectiveAcheivedImage_width_x = (int)(float)iVar5;
		iVar5 = std::atoi(local_4e8);
		(level->objective).ObjectiveAcheivedImage_height_y = (int)(float)iVar5;
		if ((iVar10 == 6) && ((level->objective).ObjectiveAcheivedImage != NULL)) {
			uVar3 = std::atoi(local_4e4);
			uVar6 = std::atoi(local_4e0);
			uVar7 = std::atoi(local_4dc);
			image::Image_unkFogFromFloat__0047deb0
								((ImageBMP *)pOVar1->ObjectiveImage,(float)(ulonglong)(uVar3 / 0xff),
								 (float)(ulonglong)(uVar6 / 0xff),(float)(ulonglong)(uVar7 / 0xff),
								 (float)(ulonglong)(uVar3 / 0xff),(float)(ulonglong)(uVar6 / 0xff),
								 (float)(ulonglong)(uVar7 / 0xff));
		}
		std::free(pcVar2);
	}
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"ObjectiveAcheivedAVI",0);
	pcVar2 = cfg::CFG_CopyPropertyValue(root,pcVar2);
	if (pcVar2 != NULL) {
		iVar10 = lego::util::stringSplit(pcVar2,&local_4f0,",");
		pcVar8 = std::_strdup(local_4f0);
		(level->objective).ObjectiveAcheivedAVI = pcVar8;
		if (iVar10 == 3) {
			iVar10 = std::atoi(local_4ec);
			(level->objective).ObjectiveAcheivedAVI_width_x = (int)(float)iVar10;
			iVar10 = std::atoi(local_4e8);
			(level->objective).ObjectiveAcheivedAVI_height_y = (int)(float)iVar10;
			std::free(pcVar2);
		}
		else {
			(level->objective).field_30 = 1;
			std::free(pcVar2);
		}
	}
	std::sprintf(local_400,"ObjectiveFailedImage%ix%i",screenWidth,screenHeight);
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,local_400,0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = std::_strdup(pcVar2);
		lego::util::stringSplit(pcVar2,&local_4f0,",");
		pIVar4 = (ImageBMP *)(level->objective).ObjectiveFailedImage;
		if (pIVar4 != NULL) {
			pool::ReservedPool_ImageBMP___Release(pIVar4);
		}
		pIVar4 = image::Image_LoadBMP(local_4f0,0,0);
		(level->objective).ObjectiveFailedImage = pIVar4;
		if (pIVar4 != NULL) {
			image::Image_SetFirstColorAsKey(pIVar4);
		}
		iVar10 = std::atoi(local_4ec);
		(level->objective).ObjectiveFailedImage_width_x = (int)(float)iVar10;
		iVar10 = std::atoi(local_4e8);
		(level->objective).ObjectiveFailedImage_height_y = (int)(float)iVar10;
		std::free(pcVar2);
	}
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"CrystalObjective",0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 == NULL) {
		pcVar2 = ____EMPTYSTR__;
	}
	else {
		pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"CrystalObjective",0);
		pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	}
	iVar10 = std::atoi(pcVar2);
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"OreObjective",0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 == NULL) {
		pcVar2 = ____EMPTYSTR__;
	}
	else {
		pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"OreObjective",0);
		pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	}
	iVar5 = std::atoi(pcVar2);
	Level_SetCryOreObjectives(level,iVar10,iVar5);
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"TimerObjective",0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = std::_strdup(pcVar2);
		lego::util::stringSplit(pcVar2,&local_4f0,":");
		iVar10 = std::atoi(local_4f0);
		iVar5 = std::_stricmp(local_4ec,"HitTimeFailObjective");
		Level_SetTimerObjective(level,(float)iVar10 * 25.0,(uint)(iVar5 == 0));
		std::free(pcVar2);
	}
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"ConstructionObjective",0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if ((pcVar2 != NULL) &&
		 (BVar9 = Game_GetObjectByName(pcVar2,&local_4fc,&local_500,NULL), BVar9 != 0)) {
		Level_SetConstructionObjective(level,local_4fc,local_500);
	}
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"BlockObjective",0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = std::_strdup(pcVar2);
		lego::util::stringSplit(pcVar2,&local_4f0,",");
		local_4f8.x = std::atoi(local_4f0);
		local_4f8.y = std::atoi(local_4ec);
		Level_SetBlockObjective(level,&local_4f8);
		std::free(pcVar2);
	}
	pcVar2 = cfg::CFG_JoinPath(keyRootPath,levelName,"ObjectiveText",0);
	pcVar2 = cfg::CFG_GetPropertyValue(root,pcVar2);
	if (pcVar2 != NULL) {
		Level_LoadObjectiveText(root,keyRootPath,levelName,level,pcVar2);
	}
	if (globals::g_ObjectiveFlags == OBJECTIVE_NONE) {
		globals::g_ObjectiveFlags = OBJECTIVE_SHOWADVISOR;
	}
	return;
}



void __cdecl
lego::game::Level_SetCryOreObjectives(LevelData *level,int crystalObjective,int oreObjective)
{
	if (crystalObjective != 0) {
		globals::g_ObjectiveFlags |= OBJECTIVE_CRYSTAL;
		(level->objective).CrystalObjective = crystalObjective;
	}
	if (oreObjective != 0) {
		globals::g_ObjectiveFlags |= OBJECTIVE_ORE;
		(level->objective).OreObjective = oreObjective;
	}
	return;
}



void __cdecl lego::game::Level_SetBlockObjective(LevelData *level,Point2I *position)
{
	globals::g_ObjectiveFlags |= OBJECTIVE_BLOCK;
	(level->objective).BlockObjective.x = position->x;
	(level->objective).BlockObjective.y = position->y;
	return;
}



void __cdecl
lego::game::Level_SetTimerObjective(LevelData *level,float timerObjective,BOOL hitTimeFailObjective)
{
	globals::g_ObjectiveFlags |= OBJECTIVE_TIMER;
	(level->objective).TimerObjective = timerObjective;
	if (hitTimeFailObjective != 0) {
		globals::g_ObjectiveFlags |= OBJECTIVE_SHOWACHEIVEADVISOR;
	}
	return;
}



void __cdecl lego::game::Level_SetConstructionObjective(LevelData *level,int objType,int objIndex)
{
	globals::g_ObjectiveFlags |= OBJECTIVE_CONSTRUCTION;
	(level->objective).ConstructionObjective_type = objType;
	(level->objective).ConstructionObjective_index = objIndex;
	return;
}



BOOL FUN_00458910(void)
{
	return lego::globals::g_LevelIsComplete;
}



void __cdecl lego::game::Game_SetEndTeleportEnabled(BOOL endTeleportEnabled)
{
	globals::g_IsEndTeleportEnabled = endTeleportEnabled;
	return;
}



void __cdecl lego::game::Level_SetCompleteStatus(LevelCompleteStatus status)
{
	bool bVar1;
	bool bVar2;
	LevelData *pLVar3;
	int iVar4;
	char *pcVar5;
	char *pcVar6;
	uint uVar7;
	char *pcVar8;
	char local_100 [256];
	
	pLVar3 = GetLevel();
	pcVar8 = NULL;
	bVar1 = true;
	bVar2 = true;
	iVar4 = nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
	if (iVar4 == 0) {
		globals::g_Game.flags2 |= GAME2_INMENU;
	}
	DAT_00500dd8 = 0;
	DAT_00500ddc = 0;
	DAT_00500de0 = 0;
	DAT_00500de4 = 0;
	if ((globals::g_ObjectiveFlags & (OBJECTIVE_UNK_1|OBJECTIVE_COMPLETE|OBJECTIVE_FAILED)) !=
			OBJECTIVE_NONE) {
		DAT_00500dd8 = 0;
		DAT_00500ddc = 0;
		DAT_00500de0 = 0;
		DAT_00500de4 = 0;
		return;
	}
	if ((globals::g_ObjectiveFlags & OBJECTIVE_CRYSTAL) != OBJECTIVE_NONE) {
		DAT_00500dd8 = 0;
		DAT_00500ddc = 0;
		DAT_00500de0 = 0;
		DAT_00500de4 = 0;
		return;
	}
	while ((((globals::g_ButtonState_LeftDown != 0 || (globals::g_ButtonState_RightDown != 0)) ||
					(BOOL_0076bb48 != 0)) || (BOOL_0076bb4c != 0))) {
		BOOL_0076bb4c = 0;
		main::Main_UpdateAndRender__004781f0(1);
	}
	if (status == LEVELSTATUS_NONE) {
		pcVar8 = ____EMPTYSTR__;
		globals::g_ObjectiveFlags |= OBJECTIVE_UNK_1;
		bVar1 = false;
		pLVar3->status = LEVELSTATUS_NONE;
	}
	else {
		if (status == LEVELSTATUS_COMPLETE) {
			globals::g_LevelIsComplete = 1;
			globals::g_ObjectiveFlags |= OBJECTIVE_COMPLETE;
			pLVar3->status = LEVELSTATUS_COMPLETE;
			pcVar8 = "Acheived";
			image::Image_CreateCapture
								(&ImageBMP_005539a4,globals::g_Menu_SaveImage_BigSize.width,
								 globals::g_Menu_SaveImage_BigSize.height);
			BOOL_005539a0 = 1;
		}
		else {
			if (status == LEVELSTATUS_FAILED) {
				globals::g_LevelIsComplete = 0;
				globals::g_ObjectiveFlags |= OBJECTIVE_FAILED;
				pcVar8 = "Failed";
				pLVar3->status = LEVELSTATUS_FAILED;
			}
			else {
				if (status != LEVELSTATUS_FAILED_CRYSTALS) goto LAB_00458a9a;
				globals::g_LevelIsComplete = 0;
				globals::g_ObjectiveFlags |= OBJECTIVE_FAILED|OBJECTIVE_CRYSTAL;
				pcVar8 = "FailedCrystals";
				pLVar3->status = LEVELSTATUS_FAILED;
				bVar2 = false;
			}
		}
		FUN_004262f0();
		unk::Lego_UnkLevelImportantPilot___004604e0();
	}
LAB_00458a9a:
	globals::g_ObjectiveFlags |= OBJECTIVE_UNK_8;
	if (bVar1) {
		uVar7 = (-(uint)(globals::g_IsEndTeleportEnabled != 0) & 0xfffffffe) + 4;
		FUN_0046a7d0(1,2,uVar7);
		FUN_0046a7d0(2,2,uVar7);
		FUN_0046a7d0(8,2,uVar7);
		FUN_0046a7d0(0x400,2,uVar7);
		unk::Lego_SetBool_004b9a54(1);
		FUN_0044b080(1);
	}
	if ((pcVar8 != NULL) && (((byte)globals::g_Game.flags1 & 0x10) != 0)) {
		if (bVar2) {
			pcVar6 = pLVar3->levelName;
		}
		else {
			pcVar6 = ____EMPTYSTR__;
		}
		pcVar5 = "_";
		if (!bVar2) {
			pcVar5 = ____EMPTYSTR__;
		}
		std::sprintf(local_100,"Stream_Objective%s%s%s",pcVar8,pcVar5,pcVar6);
		if (globals::g_StreamObjective_Sample != NULL) {
			std::free(globals::g_StreamObjective_Sample);
		}
		globals::g_StreamObjective_Sample = std::_strdup(local_100);
		DAT_00500e3c = 0xffffffff;
		DAT_00500e44 = 0;
		return;
	}
	globals::g_StreamObjective_Sample = NULL;
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_00458ba0(void)
{
	int iVar1;
	
	if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_UNK_1) == OBJECTIVE_NONE) {
		if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_COMPLETE) == OBJECTIVE_NONE) {
			if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_FAILED) != OBJECTIVE_NONE) {
				lego::globals::g_ObjectiveFlags &= ~(OBJECTIVE_FAILED|OBJECTIVE_CRYSTAL);
			}
		}
		else {
			lego::globals::g_ObjectiveFlags &= ~OBJECTIVE_COMPLETE;
		}
	}
	else {
		lego::nerps::funcs::NERPFunc__SetObjectiveSwitch((int *)&DAT_00500e34);
		lego::globals::g_ObjectiveFlags &= ~OBJECTIVE_UNK_1;
		_DAT_00500e34 = 0;
		if ((lego::globals::g_Game.flags2 & GAME2_MUSICON) != GAME2_NONE) {
			lego::snd::Music_PlayNext(1);
			lego::globals::g_Game.flags2 &= ~GAME2_MUSICON;
		}
	}
	lego::unk::Lego_ClearFlag2__004b41bc();
	if (DAT_00500e3c != -1) {
		lego::snd::AudioPlayback_Cleanup(0);
		DAT_00500e3c = -1;
	}
	FUN_00425b60(0,0);
	lego::snd::Audio_FUN_00465580_true(0);
	iVar1 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
	if (iVar1 == 0) {
		lego::globals::g_Game.flags2 &= ~GAME2_INMENU;
	}
	return;
}



BOOL __cdecl lego::game::Level_IsObjectiveFinished(void)
{
	if (((byte)globals::g_ObjectiveFlags & 7) == 0) {
		return 0;
	}
	return 1;
}



void __cdecl FUN_00458c80(int param_1,int param_2,uint *param_3)
{
	int iVar1;
	BOOL BVar2;
	uint uVar3;
	
	uVar3 = 4;
	if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_UNK_1) == OBJECTIVE_NONE) {
		if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_COMPLETE) == OBJECTIVE_NONE) {
			if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_FAILED) != OBJECTIVE_NONE) {
				uVar3 = (uint)((byte)(lego::globals::g_ObjectiveFlags >> 8) & 1 | 2);
			}
		}
		else {
			uVar3 = 1;
		}
	}
	else {
		uVar3 = 0;
	}
	*param_3 = 0;
	if (((param_1 != 0) || (param_2 != 0)) && ((&DAT_00500dd8)[uVar3] == (&DAT_00500df8)[uVar3])) {
		if (((lego::globals::g_MousePosition.x < 0x82) ||
				((lego::globals::g_Game.BackButton)->width + 0x82 <= lego::globals::g_MousePosition.x)) ||
			 ((lego::globals::g_MousePosition.y < 0x13b ||
				((lego::globals::g_Game.BackButton)->height + 0x13b <= lego::globals::g_MousePosition.y))))
		{
			if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_UNK_1) == OBJECTIVE_NONE) {
				if ((lego::globals::g_ObjectiveFlags & (OBJECTIVE_COMPLETE|OBJECTIVE_FAILED)) !=
						OBJECTIVE_NONE) {
					iVar1 = FUN_0046a780(0x40b);
					if (iVar1 != 0) {
						FUN_00458ba0();
						BVar2 = FUN_00435870();
						*param_3 = (uint)(BVar2 == 0);
					}
				}
			}
			else {
				FUN_00458ba0();
				lego::game::Game_SetMenuNextPosition(NULL);
				lego::game::Game_SetMenuPreviousPosition(NULL);
				FUN_00425b60(0,0);
				lego::input::Input_SetMousePosition
									(lego::globals::g_RESOLUTION.width / 2,lego::globals::g_RESOLUTION.height / 2);
				iVar1 = FUN_00407290();
				if (iVar1 != 0) {
					lego::game::Game_ToggleObjectUIsAlwaysVisible();
				}
			}
		}
	}
	if (uVar3 == 4) goto LAB_00458e8c;
	if ((uint)(&DAT_00500dd8)[uVar3] < (uint)(&DAT_00500df8)[uVar3]) {
		if (((lego::globals::g_MousePosition.x < 0x1d6) ||
				((lego::globals::g_Game.NextButton)->width + 0x1d6 <= lego::globals::g_MousePosition.x)) ||
			 ((lego::globals::g_MousePosition.y < 0x13b ||
				((lego::globals::g_Game.NextButton)->height + 0x13b <= lego::globals::g_MousePosition.y))))
		{
LAB_00458e07:
			if (param_1 == 0) goto LAB_00458e20;
			if (param_2 != 0) goto LAB_00458e0f;
		}
		else {
			FUN_0046ba30(0x21);
			if (param_2 == 0) goto LAB_00458e07;
LAB_00458e0f:
			FUN_00428730(0);
		}
		(&DAT_00500dd8)[uVar3] = (&DAT_00500dd8)[uVar3] + 1;
	}
LAB_00458e20:
	if (((((&DAT_00500dd8)[uVar3] != 0) && (0x81 < lego::globals::g_MousePosition.x)) &&
			(lego::globals::g_MousePosition.x < (lego::globals::g_Game.BackButton)->width + 0x82)) &&
		 ((0x13a < lego::globals::g_MousePosition.y &&
			(lego::globals::g_MousePosition.y < (lego::globals::g_Game.BackButton)->height + 0x13b)))) {
		FUN_0046ba30(0x22);
		if (param_2 != 0) {
			FUN_00428730(0);
			(&DAT_00500dd8)[uVar3] = (&DAT_00500dd8)[uVar3] + -1;
		}
	}
LAB_00458e8c:
	lego::game::Level_IsObjectiveFinished();
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_00458ea0(Struct_830 *param_1,LevelData *level,float param_3,float param_4)
{
	ImageBMP *bitmap;
	bool bVar1;
	bool bVar2;
	Struct_830 *pSVar3;
	Size2F *pSVar4;
	BOOL BVar5;
	int iVar6;
	undefined4 uVar7;
	float10 fVar8;
	Point2F *pPVar9;
	int local_10;
	Point2F local_c;
	int local_4;
	
	bVar1 = false;
	bVar2 = false;
	uVar7 = 0;
	local_c.x = 0.0;
	if (PROGRAMMER_MODE_3 < lego::globals::g_PROGRAMMER_MODE) {
		FUN_00458ba0();
	}
	if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_UNK_1) == OBJECTIVE_NONE) {
		if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_COMPLETE) == OBJECTIVE_NONE) {
			if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_FAILED) == OBJECTIVE_NONE) {
				BVar5 = FUN_00459310((int)level,&local_4,param_3);
				if (BVar5 == 0) {
					FUN_00462ac0(param_3);
				}
				else {
					if (local_4 == 0) {
						lego::game::Level_SetCompleteStatus(LEVELSTATUS_FAILED);
					}
					else {
						lego::game::Level_SetCompleteStatus(LEVELSTATUS_COMPLETE);
					}
				}
			}
			else {
				iVar6 = FUN_0046a780(0x40b);
				if (iVar6 != 0) {
					local_10 = 2;
					FUN_00459620();
					if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_CRYSTAL) != OBJECTIVE_NONE) {
						local_10 = 3;
					}
					FUN_00425b60(0,1);
					bVar2 = true;
					if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_UNK_8) != OBJECTIVE_NONE) {
						if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_SHOWFAILEDADVISOR) != OBJECTIVE_NONE) {
							FUN_00401800(0,1);
						}
						lego::globals::g_ObjectiveFlags &= ~OBJECTIVE_UNK_8;
					}
					lego::front::Text_DisplayType(TEXT_SPACETOCONTINUE,0,0);
					uVar7 = 1;
					bVar1 = true;
				}
			}
		}
		else {
			iVar6 = FUN_0046a780(0x40b);
			if (iVar6 != 0) {
				bVar1 = true;
				FUN_00425b60(0,1);
				lego::unk::Lego_Unk_SORRFile__004595a0();
				if ((level->objective).field_34 == 0) {
					if ((level->objective).field_30 == 0) {
						pSVar4 = (Size2F *)&(level->objective).ObjectiveAcheivedAVI_width_x;
					}
					else {
						pSVar4 = NULL;
					}
					FUN_0042eef0((char *)(level->objective).ObjectiveAcheivedAVI,pSVar4);
					(level->objective).field_34 = 1;
				}
				local_10 = 1;
				bVar2 = true;
				lego::front::Text_DisplayType(TEXT_SPACETOCONTINUE,0,0);
				if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_UNK_8) != OBJECTIVE_NONE) {
					if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_SHOWACHEIVEADVISOR) != OBJECTIVE_NONE) {
						FUN_00401800(0,1);
					}
					lego::globals::g_ObjectiveFlags &= ~OBJECTIVE_UNK_8;
				}
				uVar7 = 1;
			}
		}
	}
	else {
		uVar7 = 1;
		FUN_00425b60(0,1);
		local_10 = 0;
		bVar2 = true;
		if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_UNK_8) != OBJECTIVE_NONE) {
			if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_SHOWADVISOR) != OBJECTIVE_NONE) {
				FUN_00401800(0,1);
			}
			lego::globals::g_ObjectiveFlags &= ~OBJECTIVE_UNK_8;
		}
		local_c.x = 1.401298e-45;
		lego::front::Text_DisplayType(TEXT_SPACETOCONTINUE,0,0);
	}
	if ((DAT_00500e3c != -1) &&
		 (_DAT_00500e40 = _DAT_00500e40 - param_4,
		 (ushort)((ushort)(_DAT_00500e40 < 0.0) << 8 | (ushort)(_DAT_00500e40 == 0.0) << 0xe) != 0)) {
		lego::unk::Lego_ClearFlag2__004b41bc();
		DAT_00500e3c = -1;
	}
	if (((bVar1) && ((lego::globals::g_Game.flags2 & GAME2_MUSICON) == GAME2_NONE)) &&
		 (((byte)lego::globals::g_Game.flags1 & 8) != 0)) {
		lego::globals::g_Game.flags2 |= GAME2_MUSICON;
		lego::snd::Music_PlayNext(0);
	}
	if ((DAT_00500e44 != 0) && (lego::globals::g_StreamObjective_Sample != NULL)) {
		BVar5 = lego::snd::Snd_GetSFX(lego::globals::g_StreamObjective_Sample,(int *)&param_4);
		if (BVar5 != 0) {
			iVar6 = lego::snd::Audio_GetFlag8();
			lego::snd::Audio_FUN_00465590(0,0);
			lego::snd::Snd_Play_FUN_00465260((int)param_4,0);
			DAT_00500e3c = iVar6;
			fVar8 = lego::snd::Sample_GetRandomDuration((int)param_4);
			_DAT_00500e40 = (float)((fVar8 - (float10)1.5) * (float10)25.0);
			lego::snd::Audio_FUN_00465580_true(1);
		}
		std::free(lego::globals::g_StreamObjective_Sample);
		lego::globals::g_StreamObjective_Sample = NULL;
	}
	DAT_00500e44 = uVar7;
	if (local_c.x != 0.0) {
		lego::snd::Audio_FUN_00465580_true(1);
	}
	if (bVar2) {
		if ((uint)(&DAT_00500dd8)[local_10] < (uint)(&DAT_00500df8)[local_10]) {
			pPVar9 = &local_c;
			local_c.x = 470.0;
			local_c.y = 315.0;
		}
		else {
			pPVar9 = NULL;
		}
		lego::game::Game_SetMenuNextPosition(pPVar9);
		if ((&DAT_00500dd8)[local_10] == 0) {
			pPVar9 = NULL;
		}
		else {
			pPVar9 = &local_c;
			local_c.x = 130.0;
			local_c.y = 315.0;
		}
		lego::game::Game_SetMenuPreviousPosition(pPVar9);
		if ((&DAT_00500dd8)[local_10] != (&DAT_00500de8)[local_10]) {
			FUN_00485c70(PTR_ARRAY_00500e08[local_10]);
			FUN_004854d0((int)PTR_ARRAY_00500e08[local_10],(&DAT_00500dd8)[local_10],(byte *)"%s");
			(&DAT_00500de8)[local_10] = (&DAT_00500dd8)[local_10];
		}
		bitmap = (ImageBMP *)(level->objective).ObjectiveImage;
		if (bitmap != NULL) {
			lego::image::Image_Blt__0047df70
								(bitmap,NULL,(float *)&(level->objective).ObjectiveImage_width_x,NULL);
		}
		pSVar3 = PTR_00500e1c;
		if ((level->status != LEVELSTATUS_COMPLETE) &&
			 (pSVar3 = PTR_00500e20, level->status != LEVELSTATUS_FAILED)) {
			pSVar3 = PTR_00500e18;
		}
		if (pSVar3 != NULL) {
			FUN_00485650((int *)pSVar3,0,param_3,NULL);
		}
		if (PTR_ARRAY_00500e08[local_10] != NULL) {
			FUN_00485650((int *)PTR_ARRAY_00500e08[local_10],0,param_3,NULL);
		}
		if (PTR_00500e24 != NULL) {
			FUN_00485650((int *)PTR_00500e24,0,param_3,NULL);
		}
	}
	return;
}



BOOL __cdecl FUN_00459310(int param_1,undefined4 *param_2,float param_3)
{
	float fVar1;
	BOOL BVar2;
	
	if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_SHOWADVISOR) != OBJECTIVE_NONE) {
		return 0;
	}
	*param_2 = 1;
	if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_TIMER) != OBJECTIVE_NONE) {
		fVar1 = *(float *)(param_1 + 0x104) - param_3;
		*(float *)(param_1 + 0x104) = fVar1;
		if ((ushort)((ushort)(fVar1 < 0.0) << 8 | (ushort)(fVar1 == 0.0) << 0xe) != 0) {
			if ((lego::globals::g_ObjectiveFlags & OBJECTIVE_SHOWACHEIVEADVISOR) != OBJECTIVE_NONE) {
				*param_2 = 0;
			}
			return 1;
		}
	}
	if (((lego::globals::g_ObjectiveFlags & OBJECTIVE_CRYSTAL) != OBJECTIVE_NONE) &&
		 (*(uint *)(param_1 + 0x8c) < *(uint *)(param_1 + 0xf4))) {
		return 0;
	}
	if (((lego::globals::g_ObjectiveFlags & OBJECTIVE_ORE) != OBJECTIVE_NONE) &&
		 (*(uint *)(param_1 + 0xa0) < *(uint *)(param_1 + 0xf8))) {
		return 0;
	}
	BVar2 = FUN_00437a70(FUN_004593c0,(LiveObject *)(param_1 + 0xbc));
	return (uint)(BVar2 != 0);
}



BOOL __cdecl FUN_004593c0(int *param_1,int param_2)
{
	int local_8;
	int local_4;
	
	if (((lego::globals::g_ObjectiveFlags & OBJECTIVE_BLOCK) != OBJECTIVE_NONE) &&
		 ((*param_1 == 2 || (*param_1 == 1)))) {
		lego::game::LiveObject_GetBlockCoordinates((LiveObject *)param_1,&local_8,&local_4);
		if ((local_8 == *(int *)(param_2 + 0x40)) && (local_4 == *(int *)(param_2 + 0x44))) {
			return 1;
		}
	}
	if ((((lego::globals::g_ObjectiveFlags & OBJECTIVE_CONSTRUCTION) != OBJECTIVE_NONE) &&
			(*(int *)(param_2 + 0x4c) == *param_1)) && (*(int *)(param_2 + 0x50) == param_1[1])) {
		return 1;
	}
	return 0;
}



void __cdecl lego::game::LiveObject_UnkRecallMiniFigureName(LiveObject *liveObj)
{
	LiveFlags5 *pLVar1;
	
	if ((liveObj->objType == OBJECT_MINIFIGURE) &&
		 (((liveObj->flags5_3f0 != LIVEOBJ5_NONE || (liveObj->objLevel != 0)) ||
			(liveObj->customName != NULL)))) {
		if (UINT_00500e54 == UINT_00500e58) {
			UINT_00500e58 += 10;
			PTR_00500e50 = FUN_0048df40((LwoFrame *)PTR_00500e50,UINT_00500e58 * 0x14);
		}
		pLVar1 = (LiveFlags5 *)((int)PTR_00500e50 + UINT_00500e54 * 0x14);
		UINT_00500e54 = UINT_00500e54 + 1;
		*pLVar1 = liveObj->flags5_3f0;
		pLVar1[1] = liveObj->objLevel;
		pLVar1[2] = LIVEOBJ5_NONE;
		pLVar1[3] = LIVEOBJ5_NONE;
		pLVar1[4] = LIVEOBJ5_NONE;
		if (liveObj->customName != NULL) {
			std::_strncpy((char *)(pLVar1 + 2),liveObj->customName,0xb);
		}
	}
	return;
}



BOOL __cdecl lego::game::LiveObject_RecallMiniFigure(LiveObject *liveObj)
{
	void *pvVar1;
	
	if ((liveObj->objType == OBJECT_MINIFIGURE) && (UINT_00500e54 != 0)) {
		UINT_00500e54 -= 1;
		pvVar1 = (void *)((int)PTR_00500e50 + UINT_00500e54 * 0x14);
		liveObj->flags5_3f0 = *(LiveFlags5 *)((int)PTR_00500e50 + UINT_00500e54 * 0x14);
		LiveObject_SetLevel(liveObj,*(uint *)((int)pvVar1 + 4));
		LiveObject_SetCustomName(liveObj,(char *)((int)pvVar1 + 8));
		return 1;
	}
	return 0;
}



void __cdecl FUN_00459560(void)
{
	UINT_00500e54 = 0;
	UINT_00500e58 = 0;
	if (PTR_00500e50 != NULL) {
		std::free(PTR_00500e50);
	}
	PTR_00500e50 = NULL;
	return;
}



void __cdecl lego::unk::Lego_Unk_SORRFile__004595a0(void)
{
	uint uVar1;
	int iVar2;
	undefined4 *puVar3;
	undefined4 *puVar4;
	
	if ((UINT_00500e54 != 0) && (PTR_00500e50 != NULL)) {
		if (DAT_00500e5c != NULL) {
			std::free(DAT_00500e5c);
		}
		DAT_00500e5c = (undefined4 *)std::malloc(UINT_00500e54 * 0x14);
		puVar3 = (undefined4 *)PTR_00500e50;
		puVar4 = DAT_00500e5c;
		for (uVar1 = UINT_00500e54 * 5 & 0x3fffffff; uVar1 != 0; uVar1 -= 1) {
			*puVar4 = *puVar3;
			puVar3 = puVar3 + 1;
			puVar4 = puVar4 + 1;
		}
		for (iVar2 = 0; iVar2 != 0; iVar2 += -1) {
			*(undefined *)puVar4 = *(undefined *)puVar3;
			puVar3 = (undefined4 *)((int)puVar3 + 1);
			puVar4 = (undefined4 *)((int)puVar4 + 1);
		}
		DAT_00500e60 = UINT_00500e54;
		DAT_00500e64 = 1;
	}
	return;
}



BOOL __cdecl FUN_00459620(void)
{
	uint uVar1;
	int iVar2;
	undefined4 *puVar3;
	undefined4 *puVar4;
	
	FUN_00459560();
	if ((DAT_00500e5c != NULL) && (DAT_00500e60 != 0)) {
		PTR_00500e50 = std::malloc(DAT_00500e60 * 0x14);
		puVar3 = DAT_00500e5c;
		puVar4 = (undefined4 *)PTR_00500e50;
		for (uVar1 = DAT_00500e60 * 5 & 0x3fffffff; uVar1 != 0; uVar1 -= 1) {
			*puVar4 = *puVar3;
			puVar3 = puVar3 + 1;
			puVar4 = puVar4 + 1;
		}
		for (iVar2 = 0; iVar2 != 0; iVar2 += -1) {
			*(undefined *)puVar4 = *(undefined *)puVar3;
			puVar3 = (undefined4 *)((int)puVar3 + 1);
			puVar4 = (undefined4 *)((int)puVar4 + 1);
		}
		UINT_00500e54 = DAT_00500e60;
		UINT_00500e58 = DAT_00500e60;
		return 1;
	}
	return 0;
}



undefined4 __cdecl lego::unk::Lego_GetDat_00500e64(void)
{
	return DAT_00500e64;
}



BOOL __cdecl lego::unk::Lego_Write_SORRFile__004596a0(char *filename)
{
	FileStream *file;
	undefined4 local_8;
	uint local_4;
	
	file = lego::file::File_Open(filename,"wb");
	if (file != NULL) {
		local_8 = 1397707346;
		local_4 = UINT_00500e54;
		lego::file::File_Write((byte *)&local_8,4,2,file);
		lego::file::File_Write((byte *)PTR_00500e50,0x14,UINT_00500e54,file);
		lego::file::File_Close(file);
		Lego_Unk_SORRFile__004595a0();
		DAT_00500e64 = 0;
		return 1;
	}
	return 0;
}



BOOL __cdecl lego::unk::Lego_Read_SORRFile__00459730(char *filename)
{
	FileStream *file;
	int iVar1;
	BOOL BVar2;
	int local_8;
	uint local_4;
	
	BVar2 = 0;
	FUN_00459560();
	file = lego::file::File_Open(filename,"rb");
	if (file != NULL) {
		iVar1 = lego::file::File_GetLength(file);
		lego::file::File_Read((byte *)&local_8,4,2,file);
		if (local_8 == 1397707346) {
			if (iVar1 - 8U == local_4 * 0x14) {
				UINT_00500e54 = local_4;
				UINT_00500e58 = local_4;
				PTR_00500e50 = std::malloc(local_4 * 0x14);
				lego::file::File_Read((byte *)PTR_00500e50,0x14,UINT_00500e54,file);
				Lego_Unk_SORRFile__004595a0();
				DAT_00500e64 = 0;
			}
		}
		lego::file::File_Close(file);
		BVar2 = 1;
	}
	return BVar2;
}



void __cdecl lego::main::Main_Load_ObjInfo(CFGProperty *root,char *keyBasePath)
{
	Main_Load_ObjInfo_HealthBar(root,keyBasePath);
	Main_Load_ObjInfo_Hunger(root,keyBasePath);
	Main_Load_ObjInfo_Bubble(root,keyBasePath);
	return;
}



BOOL __cdecl lego::main::Main_Load_ObjInfo_HealthBar(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	int iVar2;
	BOOL BVar3;
	uint uVar4;
	float *pfVar5;
	ColourRGBF *pCVar6;
	float *pfVar7;
	float *out_b;
	char *local_28;
	char *local_24;
	
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"ObjInfo","HealthBarPosition",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 == NULL) {
		return 0;
	}
	iVar2 = util::stringSplit(pcVar1,&local_28,":");
	if (iVar2 == 2) {
		iVar2 = std::atoi(local_28);
		DAT_00500e6c = (float)iVar2;
		iVar2 = std::atoi(local_24);
		DAT_00500e70 = (float)iVar2;
		std::free(pcVar1);
		pcVar1 = cfg::CFG_JoinPath(keyBasePath,"ObjInfo","HealthBarWidthHeight",0);
		pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
		if (pcVar1 == NULL) {
			return 0;
		}
		iVar2 = util::stringSplit(pcVar1,&local_28,":");
		if (iVar2 == 2) {
			iVar2 = std::atoi(local_28);
			globals::g_HealthBarWidthHeight_width = (float)iVar2;
			iVar2 = std::atoi(local_24);
			globals::g_HealthBarWidthHeight_height = (float)iVar2;
			std::free(pcVar1);
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"ObjInfo","HealthBarBorderSize",0);
			pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			if (pcVar1 == NULL) {
				pcVar1 = ____EMPTYSTR__;
			}
			else {
				pcVar1 = cfg::CFG_JoinPath(keyBasePath,"ObjInfo","HealthBarBorderSize",0);
				pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
			}
			globals::g_HealthBarBorderSize = std::atoi(pcVar1);
			out_b = &globals::g_HealthBarBorderRGB_blue;
			pfVar7 = &globals::g_HealthBarBorderRGB_green;
			pfVar5 = &globals::g_HealthBarBorderRGB_red;
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"ObjInfo","HealthBarBorderRGB",0);
			BVar3 = cfg::CFG_GetPropertyRGBF(root,pcVar1,pfVar5,pfVar7,out_b);
			if (BVar3 == 0) {
				return 0;
			}
			globals::g_HealthBarBorderRGB_red_bright =
					 globals::g_HealthBarBorderRGB_red + globals::g_HealthBarBorderRGB_red * 0.4;
			globals::g_HealthBarBorderRGB_red_dark =
					 globals::g_HealthBarBorderRGB_red - globals::g_HealthBarBorderRGB_red * 0.4;
			globals::g_HealthBarBorderRGB_green_bright =
					 globals::g_HealthBarBorderRGB_green + globals::g_HealthBarBorderRGB_green * 0.4;
			globals::g_HealthBarBorderRGB_green_dark =
					 globals::g_HealthBarBorderRGB_green - globals::g_HealthBarBorderRGB_green * 0.4;
			globals::g_HealthBarBorderRGB_blue_bright =
					 globals::g_HealthBarBorderRGB_blue + globals::g_HealthBarBorderRGB_blue * 0.4;
			globals::g_HealthBarBorderRGB_blue_dark =
					 globals::g_HealthBarBorderRGB_blue - globals::g_HealthBarBorderRGB_blue * 0.4;
			pfVar5 = &globals::g_HealthBarBorderRGB_green;
			do {
				if ((ushort)((ushort)(pfVar5[-3] < 1.0) << 8 | (ushort)(pfVar5[-3] == 1.0) << 0xe) == 0) {
					pfVar5[-3] = 1.0;
				}
				if ((ushort)((ushort)(*pfVar5 < 1.0) << 8 | (ushort)(*pfVar5 == 1.0) << 0xe) == 0) {
					*pfVar5 = 1.0;
				}
				if ((ushort)((ushort)(pfVar5[3] < 1.0) << 8 | (ushort)(pfVar5[3] == 1.0) << 0xe) == 0) {
					pfVar5[3] = 1.0;
				}
				if (pfVar5[-3] < 0.0) {
					pfVar5[-3] = 0.0;
				}
				if (*pfVar5 < 0.0) {
					*pfVar5 = 0.0;
				}
				if (pfVar5[3] < 0.0) {
					pfVar5[3] = 0.0;
				}
				pfVar5 = pfVar5 + 1;
			} while (pfVar5 < &globals::g_HealthBarBorderRGB_blue);
			pfVar7 = &globals::g_HealthBarBackgroundRGB.blue;
			pfVar5 = &globals::g_HealthBarBackgroundRGB.green;
			pCVar6 = &globals::g_HealthBarBackgroundRGB;
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"ObjInfo","HealthBarBackgroundRGB",0);
			BVar3 = cfg::CFG_GetPropertyRGBF(root,pcVar1,(float *)pCVar6,pfVar5,pfVar7);
			if (BVar3 == 0) {
				return 0;
			}
			pfVar7 = &globals::g_HealthBarRGB.blue;
			pfVar5 = &globals::g_HealthBarRGB.green;
			pCVar6 = &globals::g_HealthBarRGB;
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"ObjInfo","HealthBarRGB",0);
			BVar3 = cfg::CFG_GetPropertyRGBF(root,pcVar1,(float *)pCVar6,pfVar5,pfVar7);
			if (BVar3 == 0) {
				return 0;
			}
			pcVar1 = cfg::CFG_JoinPath(keyBasePath,"ObjInfo","HealthBarVertical",0);
			uVar4 = cfg::CFG_GetPropertyBool(root,pcVar1);
			if (uVar4 == 1) {
				globals::g_ObjInfoFlags__00500e68 |= 8;
			}
			globals::g_ObjInfoFlags__00500e68 = globals::g_ObjInfoFlags__00500e68 | 2;
			return 1;
		}
	}
	std::free(pcVar1);
	return 0;
}



BOOL __cdecl lego::main::Main_Load_ObjInfo_Hunger(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	int iVar2;
	char *local_28;
	char *local_24;
	
	FUN_00459c80((int)root,keyBasePath);
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"ObjInfo","HungerImagesPosition",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		iVar2 = util::stringSplit(pcVar1,&local_28,":");
		if (iVar2 == 2) {
			iVar2 = std::atoi(local_28);
			globals::g_HungerImagesPosition_x = (float)iVar2;
			iVar2 = std::atoi(local_24);
			globals::g_HungerImagesPosition_y = (float)iVar2;
			std::free(pcVar1);
			globals::g_ObjInfoFlags__00500e68 = globals::g_ObjInfoFlags__00500e68 | 1;
			return 1;
		}
		std::free(pcVar1);
	}
	return 0;
}



void __cdecl FUN_00459c80(int param_1,char *param_2)
{
	char *pcVar1;
	ImageBMP *image;
	ImageBMP **ppIVar2;
	int iVar3;
	undefined4 uVar4;
	undefined4 uVar5;
	char local_40 [64];
	
	iVar3 = 0;
	ppIVar2 = (ImageBMP **)&DAT_00500ec4;
	do {
		std::sprintf(local_40,"HungerImage%i",iVar3);
		uVar5 = 0;
		uVar4 = 0;
		pcVar1 = lego::cfg::CFG_JoinPath(param_2,"ObjInfo","HungerImages",local_40,0);
		pcVar1 = lego::cfg::CFG_GetPropertyValue((CFGProperty *)param_1,pcVar1);
		image = lego::image::Image_LoadBMP(pcVar1,uVar4,uVar5);
		*ppIVar2 = image;
		if (image != NULL) {
			lego::image::Image_unkFogFromFloat__0047deb0(image,0.0,0.0,0.0,0.0,0.0,0.0);
		}
		ppIVar2 = ppIVar2 + 1;
		iVar3 += 1;
	} while (ppIVar2 < &lego::globals::g_BubbleImagesPosition_x);
	return;
}



BOOL __cdecl lego::main::Main_Load_ObjInfo_Bubble(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	int iVar2;
	char *local_28;
	char *local_24;
	
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"ObjInfo","BubbleImagesPosition",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		iVar2 = util::stringSplit(pcVar1,&local_28,":");
		if (iVar2 == 2) {
			iVar2 = std::atoi(local_28);
			globals::g_BubbleImagesPosition_x = (float)iVar2;
			iVar2 = std::atoi(local_24);
			globals::g_BubbleImagesPosition_y = (float)iVar2;
			std::free(pcVar1);
			globals::g_ObjInfoFlags__00500e68 = globals::g_ObjInfoFlags__00500e68 | 0x10;
			return 1;
		}
		std::free(pcVar1);
	}
	return 0;
}



void __cdecl FUN_00459dc0(int *param_1,int param_2,int param_3)
{
	undefined *puVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	BOOL BVar6;
	float *pfVar7;
	float fVar8;
	float *pfVar9;
	float *pfVar10;
	uint uVar11;
	float *pfVar12;
	int iVar13;
	float *pfVar14;
	float *pfVar15;
	float fVar16;
	float fVar17;
	float local_17c;
	float local_178;
	float local_174;
	float local_170;
	float *local_16c;
	int local_168;
	float *local_164;
	uint local_160;
	float local_15c;
	undefined4 uStack344;
	float local_154;
	float local_150;
	float local_14c;
	uint local_148;
	undefined4 uStack324;
	float local_140 [20];
	float local_f0 [20];
	float local_a0 [20];
	float local_50 [20];
	
	iVar13 = 0;
	local_168 = 0;
	if ((((byte)lego::globals::g_ObjInfoFlags__00500e68 & 2) != 0) &&
		 (BVar6 = FUN_0040aa10((LiveObject *)param_1), BVar6 != 0)) {
		uStack344 = 0;
		local_15c = (float)(lego::globals::g_HealthBarBorderSize * 2);
		fVar8 = lego::globals::g_HealthBarWidthHeight_width + (float)(ulonglong)(uint)local_15c;
		fVar16 = lego::globals::g_HealthBarWidthHeight_height + (float)(ulonglong)(uint)local_15c;
		local_17c = (float)param_2 + DAT_00500e6c;
		local_178 = (float)param_3 + DAT_00500e70;
		local_160 = 0;
		uVar11 = local_160;
		if (lego::globals::g_HealthBarBorderSize != 0) {
			local_164 = local_f0;
			local_16c = local_f0 + 1;
			local_150 = (local_178 + fVar16) - 2.0;
			local_15c = (local_17c + fVar8) - 2.0;
			local_14c = (local_17c + fVar8) - 1.0;
			local_154 = (local_178 + fVar16) - 1.0;
			pfVar9 = local_50;
			pfVar15 = local_50 + 1;
			pfVar12 = local_140 + 1;
			pfVar14 = local_140;
			pfVar10 = local_a0 + 1;
			pfVar7 = local_a0;
			do {
				local_160 = uVar11;
				uStack324 = 0;
				fVar4 = (float)(ulonglong)local_160;
				fVar2 = local_17c + fVar4;
				fVar3 = local_178 + fVar4;
				fVar5 = local_154 - fVar4;
				*pfVar7 = fVar2;
				*pfVar10 = fVar3;
				fVar17 = *pfVar7;
				*pfVar9 = fVar2;
				*pfVar12 = local_150 - fVar4;
				*pfVar15 = fVar5;
				pfVar7[2] = local_14c - fVar4;
				*pfVar14 = fVar17;
				*local_164 = local_15c - fVar4;
				pfVar10[2] = fVar3;
				*local_16c = fVar5;
				pfVar9[2] = local_14c - fVar4;
				pfVar14[2] = fVar2 - -1.0;
				pfVar15[2] = fVar5;
				fVar17 = pfVar9[2];
				pfVar12[2] = fVar3;
				pfVar7 = pfVar7 + 4;
				pfVar10 = pfVar10 + 4;
				pfVar14 = pfVar14 + 4;
				pfVar15 = pfVar15 + 4;
				local_16c[2] = fVar3 - -1.0;
				pfVar9 = pfVar9 + 4;
				local_164[2] = fVar17;
				iVar13 = local_168 + 2;
				local_164 = local_164 + 4;
				pfVar12 = pfVar12 + 4;
				local_16c = local_16c + 4;
				uVar11 = local_160 + 1;
				local_168 = iVar13;
				local_148 = local_160;
			} while (uVar11 < lego::globals::g_HealthBarBorderSize);
		}
		local_160 = uVar11;
		puVar1 = (undefined *)param_1[0xd0];
		if (0.0 <= (float)puVar1) {
			if ((ushort)((ushort)((float)puVar1 < 100.0) << 8 | (ushort)((float)puVar1 == 100.0) << 0xe)
					== 0) {
				puVar1 = &DAT_42c80000;
			}
		}
		else {
			puVar1 = NULL;
		}
		if (((byte)lego::globals::g_ObjInfoFlags__00500e68 & 8) == 0) {
			local_174 = (float)puVar1 * fVar8 * 0.01;
			local_170 = fVar16;
			lego::draw::Draw_SurfaceLock_FUN_00486350
								(&local_17c,1,lego::globals::g_HealthBarRGB.red,lego::globals::g_HealthBarRGB.green,
								 lego::globals::g_HealthBarRGB.blue,0);
			local_17c = local_17c + local_174;
			local_174 = fVar8 - local_174;
			fVar8 = lego::globals::g_HealthBarBackgroundRGB.red;
			fVar16 = lego::globals::g_HealthBarBackgroundRGB.green;
			fVar17 = lego::globals::g_HealthBarBackgroundRGB.blue;
		}
		else {
			local_170 = (1.0 - (float)puVar1 * 0.01) * fVar16;
			local_174 = fVar8;
			lego::draw::Draw_SurfaceLock_FUN_00486350
								(&local_17c,1,lego::globals::g_HealthBarBackgroundRGB.red,
								 lego::globals::g_HealthBarBackgroundRGB.green,
								 lego::globals::g_HealthBarBackgroundRGB.blue,0);
			local_178 = local_178 + local_170;
			local_170 = fVar16 - local_170;
			fVar8 = lego::globals::g_HealthBarRGB.red;
			fVar16 = lego::globals::g_HealthBarRGB.green;
			fVar17 = lego::globals::g_HealthBarRGB.blue;
		}
		lego::draw::Draw_SurfaceLock_FUN_00486350(&local_17c,1,fVar8,fVar16,fVar17,0);
		lego::draw::Draw_SurfaceLock_FUN_004862b0
							(local_a0,local_140,iVar13,lego::globals::g_HealthBarBorderRGB_red_bright,
							 lego::globals::g_HealthBarBorderRGB_green_bright,
							 lego::globals::g_HealthBarBorderRGB_blue_bright,0);
		lego::draw::Draw_SurfaceLock_FUN_004862b0
							(local_50,local_f0,iVar13,lego::globals::g_HealthBarBorderRGB_red_dark,
							 lego::globals::g_HealthBarBorderRGB_green_dark,
							 lego::globals::g_HealthBarBorderRGB_blue_dark,0);
	}
	return;
}



void __cdecl FUN_0045a210(int param_1,int param_2,int param_3)
{
	uint uVar1;
	longlong lVar2;
	float local_8;
	float local_4;
	
	if (((byte)lego::globals::g_ObjInfoFlags__00500e68 & 1) != 0) {
		lVar2 = __ftol((float10)*(float *)(param_1 + 0x344) * (float10)0.01 * (float10)5.0);
		uVar1 = (uint)lVar2;
		if (4 < uVar1) {
			uVar1 = 4;
		}
		if ((ImageBMP *)(&DAT_00500ec4)[uVar1] != NULL) {
			local_8 = (float)param_2 + lego::globals::g_HungerImagesPosition_x;
			local_4 = (float)param_3 + lego::globals::g_HungerImagesPosition_y;
			lego::image::Image_Blt__0047df70((ImageBMP *)(&DAT_00500ec4)[uVar1],NULL,&local_8,NULL);
		}
	}
	return;
}



void __cdecl FUN_0045a290(undefined4 *param_1,int param_2,int param_3)
{
	float local_8;
	float local_4;
	
	if (((byte)lego::globals::g_ObjInfoFlags__00500e68 & 0x10) != 0) {
		local_8 = (float)param_2 + lego::globals::g_BubbleImagesPosition_x;
		local_4 = (float)param_3 + lego::globals::g_BubbleImagesPosition_y;
		lego::image::Image_Blt__0047df70((ImageBMP *)param_1,NULL,&local_8,NULL);
	}
	return;
}



void __cdecl lego::main::Main_InitPanelButtons(void)
{
	globals::g_Panels_TABLE[0] = "Panel_Radar";
	globals::g_Panels_TABLE[1] = "Panel_RadarFill";
	globals::g_Panels_TABLE[2] = "Panel_RadarOverlay";
	globals::g_Panels_TABLE[3] = "Panel_Messages";
	globals::g_Panels_TABLE[4] = "Panel_MessagesSide";
	globals::g_Panels_TABLE[5] = "Panel_CrystalSideBar";
	globals::g_Panels_TABLE[6] = "Panel_TopPanel";
	globals::g_Panels_TABLE[7] = "Panel_Information";
	globals::g_Panels_TABLE[8] = "Panel_PriorityList";
	globals::g_Panels_TABLE[9] = "Panel_CameraControl";
	globals::g_Panels_TABLE[10] = "Panel_InfoDock";
	globals::g_Panels_TABLE[11] = "Panel_Encyclopedia";
	globals::g_PanelButtons_Radar_TABLE[0] = "PanelButton_Radar_Toggle";
	globals::g_PanelButtons_Radar_TABLE[1] = "PanelButton_Radar_TaggedObjectView";
	globals::g_PanelButtons_Radar_TABLE[2] = "PanelButton_Radar_ZoomIn";
	globals::g_PanelButtons_Radar_TABLE[3] = "PanelButton_Radar_ZoomOut";
	globals::g_PanelButtons_Radar_TABLE[4] = "PanelButton_Radar_MapView";
	globals::g_PanelButtons_CrystalSideBar_TABLE[0] = "PanelButton_CrystalSideBar_Ore";
	globals::g_PanelButtons_CrystalSideBar_TABLE[1] = "PanelButton_CrystalSideBar_Crystals";
	globals::g_PanelButtons_TopPanel_TABLE[0] = "PanelButton_TopPanel_Options";
	globals::g_PanelButtons_TopPanel_TABLE[1] = "PanelButton_TopPanel_Priorities";
	globals::g_PanelButtons_TopPanel_TABLE[2] = "PanelButton_TopPanel_CallToArms";
	globals::g_PanelButtons_Information_TABLE[0] = "PanelButton_Information_Toggle";
	globals::g_PanelButtons_Information_TABLE[1] = "PanelButton_Information_Function";
	globals::g_PanelButtons_PriorityList_TABLE[0] = "PanelButton_PriorityList_Disable1";
	globals::g_PanelButtons_PriorityList_TABLE[1] = "PanelButton_PriorityList_Disable2";
	globals::g_PanelButtons_PriorityList_TABLE[2] = "PanelButton_PriorityList_Disable3";
	globals::g_PanelButtons_PriorityList_TABLE[3] = "PanelButton_PriorityList_Disable4";
	globals::g_PanelButtons_PriorityList_TABLE[4] = "PanelButton_PriorityList_Disable5";
	globals::g_PanelButtons_PriorityList_TABLE[5] = "PanelButton_PriorityList_Disable6";
	globals::g_PanelButtons_PriorityList_TABLE[6] = "PanelButton_PriorityList_Disable7";
	globals::g_PanelButtons_PriorityList_TABLE[7] = "PanelButton_PriorityList_Disable8";
	globals::g_PanelButtons_PriorityList_TABLE[8] = "PanelButton_PriorityList_Disable9";
	globals::g_PanelButtons_PriorityList_TABLE[9] = "PanelButton_PriorityList_UpOne1";
	globals::g_PanelButtons_PriorityList_TABLE[10] = "PanelButton_PriorityList_UpOne2";
	globals::g_PanelButtons_PriorityList_TABLE[11] = "PanelButton_PriorityList_UpOne3";
	globals::g_PanelButtons_PriorityList_TABLE[12] = "PanelButton_PriorityList_UpOne4";
	globals::g_PanelButtons_PriorityList_TABLE[13] = "PanelButton_PriorityList_UpOne5";
	globals::g_PanelButtons_PriorityList_TABLE[14] = "PanelButton_PriorityList_UpOne6";
	globals::g_PanelButtons_PriorityList_TABLE[15] = "PanelButton_PriorityList_UpOne7";
	globals::g_PanelButtons_PriorityList_TABLE[16] = "PanelButton_PriorityList_UpOne8";
	globals::g_PanelButtons_PriorityList_TABLE[17] = "PanelButton_PriorityList_Close";
	globals::g_PanelButtons_PriorityList_TABLE[18] = "PanelButton_PriorityList_Reset";
	globals::g_PanelButtons_CameraControl_TABLE[0] = "PanelButton_CameraControl_ZoomIn";
	globals::g_PanelButtons_CameraControl_TABLE[1] = "PanelButton_CameraControl_ZoomOut";
	globals::g_PanelButtons_CameraControl_TABLE[2] = "PanelButton_CameraControl_CycleBuildings";
	globals::g_PanelButtons_CameraControl_TABLE[3] = "PanelButton_CameraControl_Rotate";
	globals::g_PanelButtons_InfoDock_TABLE[0] = "PanelButton_InfoDock_Goto";
	globals::g_PanelButtons_InfoDock_TABLE[1] = "PanelButton_InfoDock_Close";
	globals::g_PanelButtons_Encyclopedia_TABLE[0] = "PanelButton_Encyclopedia_Close";
	UINT_005017d0 = 0xc;
	UINT_005017d4 = 0x18;
	return;
}



void __cdecl lego::main::Main_LoadInterfaceButtons_ScrollInfo(void)
{
	Main_LoadInterfaceButtons_ScrollInfo__internal();
	FUN_0045bb10();
	FUN_0045ae70(6,1,1);
	FUN_0045ae70(6,2,1);
	return;
}



void __cdecl FUN_0045a530(void)
{
	char *pcVar1;
	char **ppcVar2;
	char *pcVar3;
	int iVar4;
	
	ppcVar2 = (char **)&DAT_0050113c;
	do {
		ppcVar2[-5] = ppcVar2[-7];
		pcVar3 = NULL;
		*ppcVar2 = (char *)((uint)*ppcVar2 & 0xfffffff5 | 4);
		ppcVar2[-4] = ppcVar2[-6];
		if (ppcVar2[-1] != NULL) {
			iVar4 = 0;
			do {
				pcVar1 = ppcVar2[-2];
				*(undefined4 *)(pcVar1 + iVar4 + 0x24) = 0;
				pcVar1 = pcVar1 + iVar4;
				iVar4 += 0x2c;
				pcVar3 = pcVar3 + 1;
				*(uint *)(pcVar1 + 0x28) = *(uint *)(pcVar1 + 0x28) & 0xffffffb7;
			} while (pcVar3 < ppcVar2[-1]);
		}
		ppcVar2 = ppcVar2 + 0xc;
	} while (ppcVar2 < lego::globals::g_PanelButtons_Radar_TABLE + 0xb);
	FLOAT_00501820 = 0.0;
	return;
}



void __cdecl FUN_0045a5a0(byte *param_1,int param_2,undefined4 param_3)
{
	uint uVar1;
	ImageBMP *image;
	BOOL BVar2;
	int iVar3;
	
	iVar3 = param_2 * 0x30;
	(&DAT_00501138)[param_2 * 0xc] = 0;
	(&DAT_0050113c)[param_2 * 0xc] = param_3;
	image = lego::image::Image_LoadBMP((char *)param_1,0,0);
	*(ImageBMP **)(&DAT_00501110 + iVar3) = image;
	if (image != NULL) {
		*(undefined4 *)(&DAT_00501114 + iVar3) = 0;
		lego::image::Image_unkFogFromFloat__0047deb0(image,0.0,0.0,0.0,0.0,0.0,0.0);
		(&DAT_0050113c)[param_2 * 0xc] = (&DAT_0050113c)[param_2 * 0xc] | 1;
		return;
	}
	BVar2 = lego::unk::Lego_CrashesFunc_00483f40((char *)param_1,(int *)(&DAT_00501110 + iVar3));
	if (BVar2 != 0) {
		uVar1 = (&DAT_0050113c)[param_2 * 0xc];
		*(undefined4 *)(&DAT_00501114 + iVar3) = 1;
		(&DAT_0050113c)[param_2 * 0xc] = uVar1 | 1;
	}
	return;
}



BOOL __cdecl lego::game::Game_GetPanel(char *panelName,int *out_index)
{
	int iVar1;
	char **ppcVar2;
	int iVar3;
	
	iVar3 = 0;
	ppcVar2 = globals::g_Panels_TABLE;
	do {
		iVar1 = std::_stricmp(panelName,*ppcVar2);
		if (iVar1 == 0) {
			*out_index = iVar3;
			return 1;
		}
		ppcVar2 = ppcVar2 + 1;
		iVar3 += 1;
	} while (ppcVar2 < &DAT_00501110);
	return 0;
}



uint __cdecl FUN_0045a670(int param_1,int param_2,int param_3)
{
	BOOL BVar1;
	int iVar2;
	longlong lVar3;
	
	if (*(int *)(&DAT_00501114 + param_1 * 0x30) == 0) {
		lVar3 = __ftol((float10)(float)(&DAT_0050112c)[param_1 * 0xc]);
		iVar2 = param_3 - (int)lVar3;
		lVar3 = __ftol((float10)(float)(&DAT_00501128)[param_1 * 0xc]);
		BVar1 = lego::image::Image_FUN_0047e260
											(*(ImageBMP **)(&DAT_00501110 + param_1 * 0x30),param_2 - (int)lVar3,iVar2);
		if (BVar1 != 0) {
			return (uint)(param_1 == 0);
		}
	}
	return 1;
}



undefined4 __cdecl FUN_0045a6d0(int param_1,char *param_2,uint *param_3)
{
	int iVar1;
	char **ppcVar2;
	uint uVar3;
	
	ppcVar2 = lego::globals::g_PanelButtons_Radar_TABLE + param_1 * 0x18;
	uVar3 = 0;
	do {
		if (*ppcVar2 != NULL) {
			iVar1 = std::_stricmp(param_2,*ppcVar2);
			if (iVar1 == 0) {
				*param_3 = uVar3;
				return 1;
			}
		}
		uVar3 += 1;
		ppcVar2 = ppcVar2 + 1;
	} while (uVar3 < 0x18);
	return 0;
}



void __cdecl
FUN_0045a720(uint param_1,undefined4 *param_2,int param_3,int param_4,int param_5,char *format,...)
{
	uint uVar1;
	undefined4 *puVar2;
	int iVar3;
	float10 fVar4;
	longlong lVar5;
	byte *pbVar6;
	undefined4 *puVar7;
	
	puVar2 = param_2;
	uVar1 = param_1;
	if (param_5 != 0) {
		FUN_0047a410((ImageFont *)param_2,&param_1,NULL,(byte *)format,(undefined4 *)&stack0x0000001c);
		param_3 -= param_1 >> 1;
	}
	puVar7 = (undefined4 *)&stack0x0000001c;
	pbVar6 = (byte *)format;
	fVar4 = FUN_0048e540(SUB84((double)((float)param_4 + (float)(&DAT_0050112c)[uVar1 * 0xc]),0),
											 (uint)((ulonglong)
															(double)((float)param_4 + (float)(&DAT_0050112c)[uVar1 * 0xc]) >> 0x20
														 ));
	lVar5 = __ftol(fVar4);
	iVar3 = (int)lVar5;
	fVar4 = FUN_0048e540(SUB84((double)((float)param_3 + (float)(&DAT_00501128)[uVar1 * 0xc]),0),
											 (uint)((ulonglong)
															(double)((float)param_3 + (float)(&DAT_00501128)[uVar1 * 0xc]) >> 0x20
														 ));
	lVar5 = __ftol(fVar4);
	FUN_0047a470(puVar2,(int)lVar5,iVar3,pbVar6,puVar7);
	return;
}



undefined4 * __cdecl FUN_0045a7c0(int param_1,ImageFont *font,Rect2F *rect,uint size)
{
	Struct_830 **ppSVar1;
	Struct_830 *pSVar2;
	longlong lVar3;
	Rect2F local_10;
	
	local_10.x = 0.0;
	local_10.y = 0.0;
	local_10.width = rect->width;
	local_10.height = rect->height;
	ppSVar1 = (Struct_830 **)std::malloc(0x10);
	if (ppSVar1 != NULL) {
		*ppSVar1 = NULL;
		ppSVar1[1] = NULL;
		ppSVar1[2] = NULL;
		ppSVar1[3] = NULL;
		pSVar2 = lego::unk::Lego_unkMakeDrawRegion__004853b0(font,&local_10,size);
		*ppSVar1 = pSVar2;
		lVar3 = __ftol((float10)rect->x);
		ppSVar1[1] = (Struct_830 *)lVar3;
		lVar3 = __ftol((float10)rect->y);
		ppSVar1[2] = (Struct_830 *)lVar3;
		ppSVar1[3] = (Struct_830 *)(&DAT_00501110 + param_1 * 0x30);
	}
	return ppSVar1;
}



void __cdecl FUN_0045a850(Struct_830 *param_1,char *param_2,...)
{
	FUN_00485510((Struct_830 *)param_1->font,0,param_2,(undefined4 *)&stack0x0000000c);
	return;
}



void __cdecl FUN_0045a870(int **param_1,uint param_2,float param_3)
{
	int iVar1;
	float10 fVar2;
	longlong lVar3;
	
	fVar2 = FUN_0048e540(SUB84((double)((float)(int)param_1[2] + (float)param_1[3][7]),0),
											 (uint)((ulonglong)(double)((float)(int)param_1[2] + (float)param_1[3][7]) >>
														 0x20));
	lVar3 = __ftol(fVar2);
	iVar1 = (int)lVar3;
	fVar2 = FUN_0048e540(SUB84((double)((float)(int)param_1[1] + (float)param_1[3][6]),0),
											 (uint)((ulonglong)(double)((float)(int)param_1[1] + (float)param_1[3][6]) >>
														 0x20));
	lVar3 = __ftol(fVar2);
	FUN_00485470(*param_1,(int)lVar3,iVar1);
	FUN_00485650(*param_1,param_2,param_3,NULL);
	return;
}



void __cdecl FUN_0045a8e0(int *param_1)
{
	FUN_00485c70((Struct_830 *)*param_1);
	return;
}



void __cdecl FUN_0045a8f0(int *param_1,undefined4 *param_2,undefined4 *param_3)
{
	FUN_00485cc0(*param_1,param_2,param_3);
	return;
}



void __cdecl FUN_0045a910(int param_1,int param_2,int param_3,int param_4,int param_5)
{
	byte bVar1;
	int iVar2;
	
	iVar2 = param_1 * 0x30;
	*(float *)(&DAT_00501118 + iVar2) = (float)param_2;
	(&DAT_00501120)[param_1 * 0xc] = (float)param_4;
	bVar1 = *(byte *)(&DAT_0050113c + param_1 * 0xc);
	*(float *)(&DAT_0050111c + iVar2) = (float)param_3;
	(&DAT_00501124)[param_1 * 0xc] = (float)param_5;
	*(undefined4 *)(&DAT_00501130 + iVar2) = 0;
	if ((bVar1 & 2) != 0) {
		(&DAT_00501128)[param_1 * 0xc] = (float)param_2;
		(&DAT_0050112c)[param_1 * 0xc] = (float)param_3;
		return;
	}
	(&DAT_00501128)[param_1 * 0xc] = (float)param_4;
	(&DAT_0050112c)[param_1 * 0xc] = (float)param_5;
	return;
}



void __cdecl FUN_0045a9a0(int param_1,undefined4 param_2,undefined4 param_3)
{
	(&DAT_00501128)[param_1 * 0xc] = param_2;
	(&DAT_0050112c)[param_1 * 0xc] = param_3;
	return;
}



void __cdecl FUN_0045a9c0(int param_1,undefined4 *param_2,undefined4 *param_3)
{
	*param_2 = (&DAT_00501128)[param_1 * 0xc];
	*param_3 = (&DAT_0050112c)[param_1 * 0xc];
	return;
}



void __cdecl FUN_0045a9f0(int param_1,float param_2)
{
	uint uVar1;
	undefined4 unaff_ESI;
	int iVar2;
	ImageBMP **ppIVar3;
	float10 fVar4;
	longlong lVar5;
	ulonglong uVar6;
	float local_28;
	float local_24;
	float local_20;
	float local_1c;
	uint local_18;
	undefined4 uStack20;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	iVar2 = param_1 * 0x30;
	ppIVar3 = (ImageBMP **)(&DAT_00501110 + iVar2);
	if ((*(byte *)(&DAT_0050113c + param_1 * 0xc) & 4) == 0) {
		local_28 = *(float *)(&DAT_00501118 + iVar2);
		local_24 = *(float *)(&DAT_0050111c + iVar2);
	}
	else {
		local_28 = (float)(&DAT_00501120)[param_1 * 0xc];
		local_24 = (float)(&DAT_00501124)[param_1 * 0xc];
	}
	if (param_2 != 0.0) {
		if ((ushort)((ushort)(ABS((float)(&DAT_00501128)[param_1 * 0xc] - local_28) < 1.0) << 8 |
								(ushort)(ABS((float)(&DAT_00501128)[param_1 * 0xc] - local_28) == 1.0) << 0xe) == 0)
		{
			(&DAT_00501128)[param_1 * 0xc] =
					 ((4.0 / param_2) * (float)(&DAT_00501128)[param_1 * 0xc] + local_28) /
					 (4.0 / param_2 - -1.0);
		}
		else {
			(&DAT_00501128)[param_1 * 0xc] = local_28;
		}
		if ((ushort)((ushort)(ABS((float)(&DAT_0050112c)[param_1 * 0xc] - local_24) < 1.0) << 8 |
								(ushort)(ABS((float)(&DAT_0050112c)[param_1 * 0xc] - local_24) == 1.0) << 0xe) == 0)
		{
			(&DAT_0050112c)[param_1 * 0xc] =
					 ((4.0 / param_2) * (float)(&DAT_0050112c)[param_1 * 0xc] + local_24) /
					 (4.0 / param_2 - -1.0);
		}
		else {
			(&DAT_0050112c)[param_1 * 0xc] = local_24;
		}
	}
	fVar4 = FUN_0048e540(SUB84((double)(float)(&DAT_00501128)[param_1 * 0xc],0),
											 (uint)((ulonglong)(double)(float)(&DAT_00501128)[param_1 * 0xc] >> 0x20));
	local_20 = (float)fVar4;
	local_10 = (float)fVar4;
	fVar4 = FUN_0048e540(SUB84((double)(float)(&DAT_0050112c)[param_1 * 0xc],0),
											 (uint)((ulonglong)(double)(float)(&DAT_0050112c)[param_1 * 0xc] >> 0x20));
	local_1c = (float)fVar4;
	local_c = (float)fVar4;
	if (*(int *)(&DAT_00501114 + iVar2) == 0) {
		lego::image::Image_Blt__0047df70(*ppIVar3,NULL,&local_20,NULL);
	}
	else {
		if (*(int *)(&DAT_00501114 + iVar2) == 1) {
			local_18 = lego::res::Res_GetActFrameIsLWSFile((ActFrameResource *)*ppIVar3);
			uStack20 = 0;
			local_8 = (float)(ulonglong)local_18;
			local_18 = FUN_004853a0((int)*ppIVar3);
			uStack20 = 0;
			local_4 = (float)(ulonglong)local_18;
			uVar6 = CONCAT44(1,~lego::globals::g_Game.flags1 >> 0x14) & 0xffffffff00000001;
			FUN_00484330((uint *)*ppIVar3,&local_10,(int)uVar6,(int)(uVar6 >> 0x20),unaff_ESI);
		}
	}
	if (param_1 == 9) {
		if ((DAT_00501860 & 0x10) != 0) {
			lego::image::Image_Blt__0047df70
								(lego::globals::g_PanelRotationControl_UpImage_bmp,NULL,
								 (float *)&g_PanelRotationControl_UpImage_position,NULL);
			DAT_00501860 &= 0xffffffef;
		}
		if ((DAT_00501860 & 0x20) != 0) {
			lego::image::Image_Blt__0047df70
								(lego::globals::g_PanelRotationControl_DownImage_bmp,NULL,
								 (float *)&g_PanelRotationControl_DownImage_position,NULL);
			DAT_00501860 &= 0xffffffdf;
		}
		if ((DAT_00501860 & 0x40) != 0) {
			lego::image::Image_Blt__0047df70
								(lego::globals::g_PanelRotationControl_LeftImage_bmp,NULL,
								 (float *)&g_PanelRotationControl_LeftImage_position,NULL);
			DAT_00501860 &= 0xffffffbf;
		}
		if ((DAT_00501860 & 0x80) != 0) {
			lego::image::Image_Blt__0047df70
								(lego::globals::g_PanelRotationControl_RightImage_bmp,NULL,
								 (float *)&g_PanelRotationControl_RightImage_position,NULL);
			DAT_00501860 &= 0xffffff7f;
		}
	}
	lVar5 = __ftol((float10)(float)(&DAT_00501128)[param_1 * 0xc] - (float10)local_28);
	uVar1 = (int)(uint)lVar5 >> 0x1f;
	if (((int)(((uint)lVar5 ^ uVar1) - uVar1) < 2) &&
		 (lVar5 = __ftol((float10)(float)(&DAT_0050112c)[param_1 * 0xc] - (float10)local_24),
		 uVar1 = (int)(uint)lVar5 >> 0x1f, (int)(((uint)lVar5 ^ uVar1) - uVar1) < 2)) {
		(&DAT_0050113c)[param_1 * 0xc] = (&DAT_0050113c)[param_1 * 0xc] & 0xfffffff7;
	}
	FUN_0045ac80(param_1);
	return;
}



void __cdecl FUN_0045ac80(int param_1)
{
	float fVar1;
	ImageBMP *bitmap;
	int iVar2;
	uint uVar3;
	int iVar4;
	uint uVar5;
	float *pfVar6;
	float local_8;
	float local_4;
	
	uVar5 = 0;
	if ((&DAT_00501138)[param_1 * 0xc] != 0) {
		iVar4 = 0;
		do {
			pfVar6 = (float *)((&DAT_00501134)[param_1 * 0xc] + iVar4);
			local_8 = *pfVar6 + (float)(&DAT_00501128)[param_1 * 0xc];
			local_4 = pfVar6[1] + (float)(&DAT_0050112c)[param_1 * 0xc];
			fVar1 = pfVar6[10];
			if (((uint)fVar1 & 0x10) == 0) {
				uVar3 = (uint)fVar1 & 0x40;
				if ((((uint)fVar1 & 8) == 0) && (((uint)fVar1 & 2) != 0)) {
					if (uVar3 == 0) {
LAB_0045ad31:
						bitmap = (ImageBMP *)pfVar6[4];
					}
					else {
						iVar2 = lego::unk::Lego_GetDat_004ded1c();
						if (iVar2 == 0) goto LAB_0045ad5a;
						bitmap = (ImageBMP *)pfVar6[4];
					}
				}
				else {
					if ((((uint)fVar1 & 4) == 0) && (((uint)fVar1 & 8) == 0)) {
						if ((uVar3 == 0) || (iVar2 = lego::unk::Lego_GetDat_004ded1c(), iVar2 == 0)) {
							bitmap = (ImageBMP *)pfVar6[6];
						}
						else {
							bitmap = (ImageBMP *)pfVar6[4];
						}
					}
					else {
						if ((uVar3 != 0) && (iVar2 = lego::unk::Lego_GetDat_004ded1c(), iVar2 != 0))
						goto LAB_0045ad31;
						bitmap = (ImageBMP *)pfVar6[5];
					}
				}
				if (bitmap != NULL) {
					lego::image::Image_Blt__0047df70(bitmap,NULL,&local_8,NULL);
				}
			}
LAB_0045ad5a:
			uVar5 += 1;
			iVar4 += 0x2c;
		} while (uVar5 < (uint)(&DAT_00501138)[param_1 * 0xc]);
	}
	return;
}



void __cdecl FUN_0045ad80(int param_1,int param_2,BOOL param_3)
{
	uint *puVar1;
	uint uVar2;
	
	puVar1 = (uint *)((&DAT_00501134)[param_1 * 0xc] + 0x28 + param_2 * 0x2c);
	uVar2 = *(uint *)((&DAT_00501134)[param_1 * 0xc] + 0x28 + param_2 * 0x2c);
	if (param_3 != 0) {
		*puVar1 = uVar2 | 0x10;
		return;
	}
	*puVar1 = uVar2 & 0xffffffef;
	return;
}



void __cdecl FUN_0045adc0(int param_1)
{
	uint uVar1;
	
	uVar1 = (&DAT_0050113c)[param_1 * 0xc];
	if ((uVar1 & 2) != 0) {
		(&DAT_0050113c)[param_1 * 0xc] = uVar1 & 0xfffffffd | 0xc;
		return;
	}
	(&DAT_0050113c)[param_1 * 0xc] = uVar1 & 0xfffffffb | 10;
	return;
}



undefined4 __cdecl FUN_0045adf0(int param_1)
{
	if ((((&DAT_0050113c)[param_1 * 0xc] & 4) != 0) && (((&DAT_0050113c)[param_1 * 0xc] & 8) == 0)) {
		return 1;
	}
	return 0;
}



undefined4 __cdecl FUN_0045ae20(int param_1)
{
	if ((((&DAT_0050113c)[param_1 * 0xc] & 2) != 0) && (((&DAT_0050113c)[param_1 * 0xc] & 8) == 0)) {
		return 1;
	}
	return 0;
}



uint __cdecl FUN_0045ae50(int param_1)
{
	return (&DAT_0050113c)[param_1 * 0xc] & 8;
}



void __cdecl FUN_0045ae70(int param_1,int param_2,int param_3)
{
	int iVar1;
	
	iVar1 = (&DAT_00501134)[param_1 * 0xc] + param_2 * 0x2c;
	if (param_3 != 0) {
		*(uint *)(iVar1 + 0x28) = *(uint *)(iVar1 + 0x28) | 0x20;
		return;
	}
	*(uint *)(iVar1 + 0x28) = *(uint *)(iVar1 + 0x28) & 0xffffffdf;
	return;
}



void __cdecl FUN_0045aeb0(int param_1,int param_2,int param_3)
{
	int iVar1;
	uint uVar2;
	
	iVar1 = (&DAT_00501134)[param_1 * 0xc] + param_2 * 0x2c;
	uVar2 = *(uint *)(iVar1 + 0x28);
	if ((uVar2 & 0x20) != 0) {
		if (param_3 != 0) {
			*(uint *)(iVar1 + 0x28) = uVar2 | 8;
			return;
		}
		*(uint *)(iVar1 + 0x28) = uVar2 & 0xfffffff3;
	}
	return;
}



void __cdecl
FUN_0045aef0(int param_1,int param_2,int param_3,int param_4,int *param_5,int param_6,int param_7,
						int param_8)
{
	float *pfVar1;
	float fVar2;
	float fVar3;
	char *pcVar4;
	void *pvVar5;
	ImageBMP *pIVar6;
	float *pfVar7;
	char **ppcVar8;
	float *pfVar9;
	
	if (param_2 != 0) {
		pvVar5 = std::malloc(param_2 * 0x2c);
		(&DAT_00501134)[param_1 * 0xc] = pvVar5;
		(&DAT_00501138)[param_1 * 0xc] = param_2;
		if (param_2 != 0) {
			pfVar9 = (float *)(param_4 + 4);
			ppcVar8 = (char **)param_5;
			do {
				pfVar7 = (float *)((param_8 - (int)param_5) + (int)ppcVar8);
				pfVar1 = (float *)((&DAT_00501134)[param_1 * 0xc] +
													*(int *)((int)pfVar7 + (param_3 - param_8)) * 0x2c);
				*pfVar1 = pfVar9[-1];
				pfVar1[1] = *pfVar9;
				pfVar1[2] = pfVar9[1] + pfVar9[-1];
				fVar2 = pfVar9[2];
				fVar3 = *pfVar9;
				pfVar1[6] = 0.0;
				pfVar1[4] = 0.0;
				pfVar1[5] = 0.0;
				pfVar1[3] = fVar2 + fVar3;
				pfVar1[8] = *pfVar7;
				if ((param_5 != NULL) && (*ppcVar8 != NULL)) {
					pIVar6 = lego::image::Image_LoadBMP(*ppcVar8,0,0);
					pfVar1[6] = (float)pIVar6;
					if (pIVar6 != NULL) {
						lego::image::Image_unkFogFromFloat__0047deb0(pIVar6,0.0,0.0,0.0,0.0,0.0,0.0);
					}
				}
				if ((param_6 != 0) &&
					 (pcVar4 = *(char **)((param_6 - (int)param_5) + (int)ppcVar8), pcVar4 != NULL)) {
					pIVar6 = lego::image::Image_LoadBMP(pcVar4,0,0);
					pfVar1[4] = (float)pIVar6;
					if (pIVar6 != NULL) {
						lego::image::Image_unkFogFromFloat__0047deb0(pIVar6,0.0,0.0,0.0,0.0,0.0,0.0);
					}
				}
				if ((param_7 != 0) &&
					 (pcVar4 = *(char **)((param_7 - (int)param_5) + (int)ppcVar8), pcVar4 != NULL)) {
					pIVar6 = lego::image::Image_LoadBMP(pcVar4,0,0);
					pfVar1[5] = (float)pIVar6;
					if (pIVar6 != NULL) {
						lego::image::Image_unkFogFromFloat__0047deb0(pIVar6,0.0,0.0,0.0,0.0,0.0,0.0);
					}
				}
				pfVar9 = pfVar9 + 4;
				ppcVar8 = ppcVar8 + 1;
				param_2 += -1;
				pfVar1[10] = 0.0;
			} while (param_2 != 0);
		}
	}
	return;
}



BOOL __cdecl
FUN_0045b070(float param_1,uint param_2,uint param_3,uint param_4,int param_5,undefined4 *param_6)
{
	int *piVar1;
	uint uVar2;
	int iVar3;
	uint uVar4;
	uint uVar5;
	LevelData *pLVar6;
	int iVar7;
	
	iVar7 = param_5;
	uVar5 = param_4;
	uVar2 = param_3;
	if (param_4 == 0) {
		DAT_00501860 &= 0xfffffffe;
	}
	iVar3 = FUN_0045b5d0((uint *)&param_6,&param_4,param_2,param_3,param_4,param_5,&param_5,param_6);
	if (iVar3 == 0) {
		iVar7 = FUN_00463b60((int *)&param_3,param_2,uVar2,uVar5,iVar7);
		if (iVar7 == 0) {
			return (BOOL)NULL;
		}
		if (param_3 == 0) {
			FUN_0041a1c0();
		}
		if (param_5 == 0) {
			return (BOOL)(undefined4 *)0x1;
		}
	}
	else {
		lego::globals::g_Game.flags1 |= GAME1_UNK_200;
		if ((param_6 == (undefined4 *)&DAT_0000000c) || (param_4 == 0x18)) {
			return (BOOL)param_6;
		}
		uVar4 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
		if (param_5 != 0) {
			piVar1 = (int *)((&DAT_00501134)[(int)param_6 * 0xc] + 0x24 + param_4 * 0x2c);
			*piVar1 = *piVar1 + 1;
			if (((uVar4 & 0x10) != 0) && (param_6 == NULL)) {
				FUN_00428730(1);
				return (BOOL)(undefined4 *)0x1;
			}
			if ((((uVar4 & 0x20) != 0) && (param_6 == (undefined4 *)0x6)) && (param_4 == 0)) {
				FUN_0045aeb0(6,0,0);
				FUN_00428730(1);
				return (BOOL)(undefined4 *)0x1;
			}
			if ((((uVar4 & 0x40) != 0) && (param_6 == (undefined4 *)0x6)) && (param_4 == 1)) {
				FUN_0045aeb0(6,1,0);
				FUN_00428730(1);
				return (BOOL)(undefined4 *)0x1;
			}
			if ((((uVar4 & 0x80) != 0) && (param_6 == (undefined4 *)0x6)) && (param_4 == 2)) {
				FUN_0045aeb0(6,2,0);
				FUN_00428730(1);
				return (BOOL)(undefined4 *)0x1;
			}
			if ((((uVar4 & 0x400) != 0) && (param_6 == (undefined4 *)&DAT_00000009)) && (param_4 == 2)) {
				FUN_00428730(1);
				return (BOOL)(undefined4 *)0x1;
			}
			if (((uVar4 & 0x1000) != 0) && (param_6 == (undefined4 *)&DAT_00000009)) {
				if ((param_4 == 0) || (param_4 == 1)) goto LAB_0045b57a;
				if (param_4 == 3) {
					FUN_00428730(1);
					return (BOOL)(undefined4 *)0x1;
				}
			}
		}
		if (uVar5 != 0) {
			if (param_6 == NULL) {
				if ((lego::globals::g_Game.flags1 & GAME1_RADAR_MAPVIEW) != GAME1_NONE) {
					if (param_4 == 2) {
						if (lego::globals::g_Game.tvTiltOrZoom_334 < 20.0) {
							lego::globals::g_Game.tvTiltOrZoom_334 =
									 param_1 + lego::globals::g_Game.tvTiltOrZoom_334;
						}
						if ((ushort)((ushort)(lego::globals::g_Game.tvTiltOrZoom_334 < 20.0) << 8 |
												(ushort)(lego::globals::g_Game.tvTiltOrZoom_334 == 20.0) << 0xe) == 0) {
							lego::globals::g_Game.tvTiltOrZoom_334 = 20.0;
						}
					}
					else {
						if (param_4 == 3) {
							if ((ushort)((ushort)(lego::globals::g_Game.tvTiltOrZoom_334 < 10.0) << 8 |
													(ushort)(lego::globals::g_Game.tvTiltOrZoom_334 == 10.0) << 0xe) == 0) {
								lego::globals::g_Game.tvTiltOrZoom_334 =
										 lego::globals::g_Game.tvTiltOrZoom_334 - param_1;
							}
							if (lego::globals::g_Game.tvTiltOrZoom_334 < 10.0) {
								lego::globals::g_Game.tvTiltOrZoom_334 = 10.0;
							}
						}
					}
				}
			}
			else {
				if (((param_6 == (undefined4 *)&DAT_00000009) &&
						(uVar5 = lego::nerps::funcs::NERPFunc__GetTutorialFlags(NULL), (uVar5 & 0x1000) == 0))
					 && (FUN_0045c1e0(param_4,param_1), param_4 == 3)) {
					FUN_0045bf90(param_2,uVar2,param_1);
				}
			}
		}
		if (param_5 == 0) {
			return (BOOL)(undefined4 *)0x1;
		}
		pLVar6 = lego::game::GetLevel();
		if (pLVar6->status == LEVELSTATUS_NONE) {
			FUN_00428730(0);
			if (false) {
				return (BOOL)(undefined4 *)0x1;
			}
			switch(param_6) {
			case NULL:
				if (param_4 == 0) {
					FUN_0045adc0(0);
					FUN_0045adc0(1);
					return (BOOL)(undefined4 *)0x1;
				}
				if (param_4 != 1) {
					if (param_4 != 4) {
						return (BOOL)(undefined4 *)0x1;
					}
					lego::globals::g_Game.flags1 =
							 lego::globals::g_Game.flags1 & ~GAME1_RADAR_TRACKOBJECTVIEW | GAME1_RADAR_MAPVIEW;
					FUN_0045ad80(0,2,0);
					FUN_0045ad80(0,3,0);
					return (BOOL)(undefined4 *)0x1;
				}
				lego::globals::g_Game.flags1 =
						 lego::globals::g_Game.flags1 &
						 (GAME1_HIGHFOGCOLOURRGB|GAME1_UNK_20000|GAME1_UNK_40000|GAME1_DYNAMICPM|
							GAME1_CAMERADISABLED|GAME1_UNK_200000|GAME1_ONLYBUILDONPATHS|GAME1_ALWAYSROCKFALL|
							GAME1_DEBUG_NONERPS|GAME1_PAUSED|GAME1_STREAMNERPSSPEACH|GAME1_UNK_8000000|
							GAME1_LASERTRACKER|GAME1_UNK_20000000|GAME1_DEBUG_NOCLIP_FPS|GAME1_UNK_80000000) |
						 (ushort)((ushort)lego::globals::g_Game.flags1 | 0x2000) & ~GAME1_RADAR_MAPVIEW;
				FUN_0045ad80(0,2,1);
				FUN_0045ad80(0,3,1);
				return (BOOL)(undefined4 *)0x1;
			default:
				return (BOOL)(undefined4 *)0x1;
			case (undefined4 *)0x6:
				goto switchD_0045b34e_caseD_6;
			case (undefined4 *)0x8:
				if (param_4 == 0x12) {
					FUN_0045d1c0();
					return (BOOL)(undefined4 *)0x1;
				}
				if (param_4 == 0x11) {
					if ((DAT_005012bc & 4) != 0) {
						return (BOOL)(undefined4 *)0x1;
					}
					FUN_0041e680();
					return (BOOL)(undefined4 *)0x1;
				}
				FUN_0045b8e0(param_4);
				return (BOOL)(undefined4 *)0x1;
			case (undefined4 *)0x9:
				if (param_4 != 2) {
					return (BOOL)(undefined4 *)0x1;
				}
				FUN_0044c810();
				return (BOOL)(undefined4 *)0x1;
			case (undefined4 *)0xa:
				if (param_4 == 1) {
					FUN_00419d90();
					return (BOOL)(undefined4 *)0x1;
				}
				if (param_4 != 0) {
					return (BOOL)(undefined4 *)0x1;
				}
				FUN_00419d10(0);
				FUN_00419cd0();
				return (BOOL)(undefined4 *)0x1;
			case (undefined4 *)0xb:
				if (param_4 != 0) {
					return (BOOL)(undefined4 *)0x1;
				}
				if ((DAT_0050134c & 4) != 0) {
					return (BOOL)(undefined4 *)0x1;
				}
				FUN_0041e680();
				return (BOOL)(undefined4 *)0x1;
			}
		}
	}
LAB_0045b57a:
	FUN_00428730(1);
	return (BOOL)(undefined4 *)0x1;
switchD_0045b34e_caseD_6:
	if ((lego::globals::g_Game.unkbool_308 != 0) && (param_4 == 1)) {
		if ((DAT_005012bc & 4) == 0) {
			FUN_0041e680();
		}
		else {
			lego::game::Level_AddMessageAction(MESSAGE_CLEARSELECT,0,0,NULL);
			FUN_0041b200(0x16,NULL);
		}
	}
	if (param_4 == 0) {
		FUN_00425b60(1,0);
		lego::globals::g_Game.flags2 = lego::globals::g_Game.flags2 ^ GAME2_INOPTIONSMENU;
		return (BOOL)(undefined4 *)0x1;
	}
	if (param_4 != 2) {
		return (BOOL)(undefined4 *)0x1;
	}
	if ((lego::globals::g_Game.flags2 & GAME2_CALLTOARMS) != GAME2_NONE) {
		lego::game::Game_SetCallToArmsOn(0);
		return (BOOL)(undefined4 *)0x1;
	}
	lego::game::Game_SetCallToArmsOn(1);
	return (BOOL)(undefined4 *)0x1;
}



int __cdecl
FUN_0045b5d0(uint *param_1,uint *param_2,int param_3,int param_4,int param_5,int param_6,
						undefined4 *param_7,undefined4 *param_8)
{
	float *pfVar1;
	uint uVar2;
	int iVar3;
	int iVar4;
	float fVar5;
	uint local_4;
	
	iVar4 = 0;
	if (param_7 != NULL) {
		*param_7 = 0;
	}
	*param_2 = 0x18;
	*param_1 = 0xc;
	if (((byte)DAT_00501860 & 1) != 0) {
		*param_1 = 9;
		*param_2 = 3;
		return 1;
	}
	local_4 = 0;
	do {
		if ((*(byte *)(&DAT_0050113c + local_4 * 0xc) & 1) != 0) {
			if ((((param_8 != NULL) && (local_4 != 1)) && (local_4 != 2)) &&
				 (uVar2 = FUN_0045a670(local_4,param_3,param_4), uVar2 == 0)) {
				*param_8 = 1;
			}
			uVar2 = 0;
			if ((&DAT_00501138)[local_4 * 0xc] != 0) {
				do {
					pfVar1 = (float *)((&DAT_00501134)[local_4 * 0xc] + uVar2 * 0x2c);
					if (iVar4 == 0) {
						if ((local_4 == 9) && (uVar2 == 3)) {
							iVar3 = FUN_0045bb60(param_3,param_4,
																	 lego::globals::g_PanelRotationControl_CenterPosition.x,
																	 lego::globals::g_PanelRotationControl_CenterPosition.y,
																	 lego::globals::g_PanelRotationControl_Radius);
						}
						else {
							iVar3 = FUN_0045b850(&DAT_00501110 + local_4 * 0x30,pfVar1,param_3,param_4);
						}
						if ((false) || (iVar3 == 0)) goto LAB_0045b7eb;
						*param_1 = local_4;
						if (param_5 == 0) {
							fVar5 = pfVar1[8];
							if (((fVar5 == 3.643376e-44) && (DAT_004ebbc8 == 0)) &&
								 (((byte)lego::pool::globals::ReservedPool_LiveObject___g_INITFLAGS & 0x40) != 0)) {
								fVar5 = 4.904545e-44;
							}
							FUN_0046ba30((int)fVar5);
							if (UINT_005017d4 != 0x18) {
								if ((local_4 == UINT_005017d0) && (uVar2 == UINT_005017d4)) {
									*param_2 = uVar2;
									fVar5 = pfVar1[10];
									if (((uint)fVar5 & 0x20) != 0) {
										if (((uint)fVar5 & 8) == 0) {
											fVar5 = (float)((uint)fVar5 | 8);
										}
										else {
											fVar5 = (float)((uint)fVar5 & 0xfffffff7);
										}
										pfVar1[10] = fVar5;
									}
									if (param_7 != NULL) {
										*param_7 = 1;
									}
									pfVar1[10] = (float)((uint)pfVar1[10] & 0xfffffffb | 2);
								}
								goto LAB_0045b7e4;
							}
							iVar4 = 1;
							*param_2 = uVar2;
							pfVar1[10] = (float)((uint)pfVar1[10] & 0xfffffffb | 2);
						}
						else {
							if (UINT_005017d4 == 0x18) {
								if (param_6 == 0) {
									UINT_005017d0 = local_4;
									iVar4 = 1;
									UINT_005017d4 = uVar2;
									*param_2 = uVar2;
									pfVar1[10] = (float)((uint)pfVar1[10] & 0xfffffffd | 4);
								}
								else {
LAB_0045b7e4:
									iVar4 = 1;
								}
							}
							else {
								if ((local_4 != UINT_005017d0) || (uVar2 != UINT_005017d4)) goto LAB_0045b7e4;
								iVar4 = 1;
								*param_2 = uVar2;
								pfVar1[10] = (float)((uint)pfVar1[10] & 0xfffffffd | 4);
							}
						}
					}
					else {
LAB_0045b7eb:
						fVar5 = pfVar1[10];
						pfVar1[10] = (float)((uint)fVar5 & 0xfffffffd);
						if (((uint)fVar5 & 8) == 0) {
							fVar5 = (float)((uint)fVar5 & 0xfffffff9);
						}
						else {
							fVar5 = (float)((uint)fVar5 & 0xfffffffd | 4);
						}
						pfVar1[10] = fVar5;
					}
					uVar2 += 1;
				} while (uVar2 < (uint)(&DAT_00501138)[local_4 * 0xc]);
			}
		}
		local_4 += 1;
		if (0xb < local_4) {
			if (param_5 == 0) {
				UINT_005017d0 = 0xc;
				UINT_005017d4 = 0x18;
			}
			return iVar4;
		}
	} while( true );
}



undefined4 __cdecl FUN_0045b850(int param_1,float *param_2,int param_3,int param_4)
{
	float fVar1;
	float fVar2;
	longlong lVar3;
	longlong lVar4;
	
	lVar3 = __ftol((float10)*(float *)(param_1 + 0x18));
	lVar4 = __ftol((float10)*(float *)(param_1 + 0x1c));
	fVar1 = (float)(param_3 - (int)lVar3);
	if ((((*param_2 <= fVar1) && (fVar2 = (float)(param_4 - (int)lVar4), fVar2 < param_2[3])) &&
			(param_2[1] <= fVar2)) && (fVar1 < param_2[2])) {
		return 1;
	}
	return 0;
}



void FUN_0045b8d0(void)
{
	DAT_00501860 = DAT_00501860 & 0xfffffff9;
	return;
}



void __cdecl FUN_0045b8e0(undefined4 param_1)
{
	switch(param_1) {
	case 0:
		FUN_0045d7b0(0);
		return;
	case 1:
		FUN_0045d7b0(1);
		return;
	case 2:
		FUN_0045d7b0(2);
		return;
	case 3:
		FUN_0045d7b0(3);
		return;
	case 4:
		FUN_0045d7b0(4);
		return;
	case 5:
		FUN_0045d7b0(5);
		return;
	case 6:
		FUN_0045d7b0(6);
		return;
	case 7:
		FUN_0045d7b0(7);
		return;
	case 8:
		FUN_0045d7b0(8);
		return;
	case 9:
		FUN_0045d730(1);
		return;
	case 10:
		FUN_0045d730(2);
		return;
	case 0xb:
		FUN_0045d730(3);
		return;
	case 0xc:
		FUN_0045d730(4);
		return;
	case 0xd:
		FUN_0045d730(5);
		return;
	case 0xe:
		FUN_0045d730(6);
		return;
	case 0xf:
		FUN_0045d730(7);
		return;
	case 0x10:
		FUN_0045d730(8);
	}
	return;
}



void __cdecl lego::main::Main_LoadInterfaceButtons_ScrollInfo__internal(void)
{
	Rect2F rect;
	
	unk::Lego_LoadScrollInfoPanel__00463970("Interface\\InfoPanel\\scrollInfo.bmp",0,0,7,0);
	FUN_004639f0(0,8,0x21);
	rect.x = 0.0;
	rect.y = 0.0;
	rect.width = 18.0;
	rect.height = 11.0;
	FUN_00463a30(0,1,(float *)&rect,0,0);
	rect.x = 0.0;
	rect.y = 11.0;
	rect.width = 18.0;
	rect.height = 11.0;
	FUN_00463a30(0,0,(float *)&rect,0,0);
	rect.x = 0.0;
	rect.y = 0.0;
	rect.width = 0.0;
	rect.height = 0.0;
	FUN_00463ad0(0,(float *)&rect,1,0,"Interface\\Buttons\\scrollInfoSld.bmp");
	rect.x = 40.0;
	rect.y = 12.0;
	rect.width = 180.0;
	rect.height = 43.0;
	DAT_005017d8 = FUN_0045a7c0(7,globals::g_Game.bmpFONT5_HI,&rect,0x100);
	return;
}



void __cdecl FUN_0045bb10(void)
{
	Rect2F rect;
	
	rect.x = 21.0;
	rect.y = 11.0;
	rect.width = 221.0;
	rect.height = 227.0;
	DAT_005017dc = FUN_0045a7c0(0xb,lego::globals::g_Game.bmpFONT5_HI,&rect,0x400);
	return;
}



undefined4 __cdecl FUN_0045bb60(int param_1,int param_2,int param_3,int param_4,int param_5)
{
	float fVar1;
	
	fVar1 = SQRT((float)(param_4 - param_2) * (float)(param_4 - param_2) +
							 (float)(param_3 - param_1) * (float)(param_3 - param_1));
	if ((ushort)((ushort)((float)param_5 < fVar1) << 8 | (ushort)((float)param_5 == fVar1) << 0xe) ==
			0) {
		return 1;
	}
	return 0;
}



void __cdecl FUN_0045bbc0(int param_1,int param_2,int param_3,float *param_4,float *param_5)
{
	*param_4 = (float)param_1 / (float)param_3;
	*param_5 = (float)param_2 / (float)param_3;
	return;
}



void __cdecl FUN_0045bbf0(undefined4 *param_1,undefined4 *param_2)
{
	float fVar1;
	float10 extraout_ST0;
	float10 extraout_ST1;
	longlong lVar2;
	int in_stack_0000000c;
	int in_stack_00000010;
	int in_stack_00000014;
	
	fVar1 = (float)((float10)*param_1 - (float10)in_stack_0000000c);
	lVar2 = __ftol(((float10)1.0 /
								 SQRT(((float10)*param_2 - (float10)in_stack_00000010) *
											(float10)(float)((float10)*param_2 - (float10)in_stack_00000010) +
											((float10)*param_1 - (float10)in_stack_0000000c) * (float10)fVar1)) *
								 (float10)fVar1 * (float10)((float)in_stack_00000014 - 1.0) +
								 (float10)in_stack_0000000c);
	*param_1 = (int)lVar2;
	lVar2 = __ftol(extraout_ST0 + extraout_ST1);
	*param_2 = (int)lVar2;
	return;
}



void __cdecl lego::main::Main_LoadPanelRotationControl(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	float10 fVar2;
	char *local_28;
	char *local_24;
	char *local_20;
	
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"PanelRotationControl","CenterPositionX",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 == NULL) {
		globals::g_PanelRotationControl_CenterPosition.x = 1;
	}
	else {
		globals::g_PanelRotationControl_CenterPosition.x = std::atoi(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"PanelRotationControl","CenterPositionY",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 == NULL) {
		globals::g_PanelRotationControl_CenterPosition.y = 1;
	}
	else {
		globals::g_PanelRotationControl_CenterPosition.y = std::atoi(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"PanelRotationControl","Radius",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 == NULL) {
		globals::g_PanelRotationControl_Radius = 1;
	}
	else {
		globals::g_PanelRotationControl_Radius = std::atoi(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"PanelRotationControl","LeftImage",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 == NULL) {
		globals::g_PanelRotationControl_LeftImage_bmp = NULL;
	}
	else {
		util::stringSplit(pcVar1,&local_28,",");
		globals::g_PanelRotationControl_LeftImage_bmp = image::Image_LoadBMP(local_28,0,0);
		image::Image_SetFirstColorAsKey(globals::g_PanelRotationControl_LeftImage_bmp);
		fVar2 = std::atof(local_24);
		g_PanelRotationControl_LeftImage_position.x = (float)fVar2;
		fVar2 = std::atof(local_20);
		g_PanelRotationControl_LeftImage_position.y = (float)fVar2;
		std::free(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"PanelRotationControl","RightImage",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 == NULL) {
		globals::g_PanelRotationControl_RightImage_bmp = NULL;
	}
	else {
		util::stringSplit(pcVar1,&local_28,",");
		globals::g_PanelRotationControl_RightImage_bmp = image::Image_LoadBMP(local_28,0,0);
		image::Image_SetFirstColorAsKey(globals::g_PanelRotationControl_RightImage_bmp);
		fVar2 = std::atof(local_24);
		g_PanelRotationControl_RightImage_position.x = (float)fVar2;
		fVar2 = std::atof(local_20);
		g_PanelRotationControl_RightImage_position.y = (float)fVar2;
		std::free(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"PanelRotationControl","UpImage",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 == NULL) {
		globals::g_PanelRotationControl_UpImage_bmp = NULL;
	}
	else {
		util::stringSplit(pcVar1,&local_28,",");
		globals::g_PanelRotationControl_UpImage_bmp = image::Image_LoadBMP(local_28,0,0);
		image::Image_SetFirstColorAsKey(globals::g_PanelRotationControl_UpImage_bmp);
		fVar2 = std::atof(local_24);
		g_PanelRotationControl_UpImage_position.x = (float)fVar2;
		fVar2 = std::atof(local_20);
		g_PanelRotationControl_UpImage_position.y = (float)fVar2;
		std::free(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"PanelRotationControl","DownImage",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		util::stringSplit(pcVar1,&local_28,",");
		globals::g_PanelRotationControl_DownImage_bmp = image::Image_LoadBMP(local_28,0,0);
		image::Image_SetFirstColorAsKey(globals::g_PanelRotationControl_DownImage_bmp);
		fVar2 = std::atof(local_24);
		g_PanelRotationControl_DownImage_position.x = (float)fVar2;
		fVar2 = std::atof(local_20);
		g_PanelRotationControl_DownImage_position.y = (float)fVar2;
		std::free(pcVar1);
		return;
	}
	globals::g_PanelRotationControl_DownImage_bmp = NULL;
	return;
}



undefined4 __cdecl FUN_0045bf90(int param_1,int param_2,float param_3)
{
	float fVar1;
	int iVar2;
	float local_8;
	float local_4;
	
	iVar2 = FUN_0045bb60(param_1,param_2,lego::globals::g_PanelRotationControl_CenterPosition.x,
											 lego::globals::g_PanelRotationControl_CenterPosition.y,
											 lego::globals::g_PanelRotationControl_Radius);
	if (iVar2 == 0) {
		if ((DAT_00501860 & 1) == 0) {
			return 0;
		}
		if (true) {
			FUN_0045bbf0(&param_1,&param_2);
			lego::input::Input_SetMousePosition(param_1,param_2);
			goto LAB_0045c031;
		}
	}
	iVar2 = FUN_0045bb60(param_1,param_2,lego::globals::g_PanelRotationControl_CenterPosition.x,
											 lego::globals::g_PanelRotationControl_CenterPosition.y,4);
	if (iVar2 != 0) {
		return 1;
	}
LAB_0045c031:
	DAT_00501860 |= 1;
	FUN_0045bbc0(lego::globals::g_PanelRotationControl_CenterPosition.x - param_1,
							 param_2 - lego::globals::g_PanelRotationControl_CenterPosition.y,
							 lego::globals::g_PanelRotationControl_Radius,&local_4,&local_8);
	iVar2 = FUN_0045bb60(param_1,lego::globals::g_PanelRotationControl_CenterPosition.y,
											 lego::globals::g_PanelRotationControl_CenterPosition.x,
											 lego::globals::g_PanelRotationControl_CenterPosition.y,3);
	if (iVar2 != 0) {
		FUN_00436b22(lego::globals::g_Game.structbc_24,local_8 * param_3 * 0.04);
		if (0.0 <= local_8) {
			DAT_00501860 = DAT_00501860 | 0x20;
			return 1;
		}
		DAT_00501860 = DAT_00501860 | 0x10;
		return 1;
	}
	iVar2 = FUN_0045bb60(lego::globals::g_PanelRotationControl_CenterPosition.x,param_2,
											 lego::globals::g_PanelRotationControl_CenterPosition.x,
											 lego::globals::g_PanelRotationControl_CenterPosition.y,3);
	fVar1 = local_4 * param_3 * 0.04;
	if (iVar2 == 0) {
		FUN_00436c16(lego::globals::g_Game.structbc_24,fVar1);
		FUN_00436b22(lego::globals::g_Game.structbc_24,local_8 * param_3 * 0.04);
		if (0.0 <= local_8) {
			DAT_00501860 |= 0x20;
		}
		else {
			DAT_00501860 |= 0x10;
		}
		if (local_4 < 0.0) {
			DAT_00501860 = DAT_00501860 | 0x80;
			return 1;
		}
	}
	else {
		FUN_00436c16(lego::globals::g_Game.structbc_24,fVar1);
		if (local_4 < 0.0) {
			DAT_00501860 = DAT_00501860 | 0x80;
			return 1;
		}
	}
	DAT_00501860 = DAT_00501860 | 0x40;
	return 1;
}



void __cdecl FUN_0045c1e0(int param_1,float param_2)
{
	if (param_1 == 0) {
		FUN_00436cc7(lego::globals::g_Game.structbc_24,param_2 * -3.0);
		return;
	}
	if (param_1 == 1) {
		FUN_00436cc7(lego::globals::g_Game.structbc_24,param_2 * 3.0);
	}
	return;
}



void __cdecl FUN_0045c230(int param_1,int param_2,undefined4 *param_3)
{
	float *pfVar1;
	
	pfVar1 = (float *)((&DAT_00501134)[param_1 * 0xc] + param_2 * 0x2c);
	*param_3 = *(undefined4 *)((&DAT_00501134)[param_1 * 0xc] + param_2 * 0x2c);
	param_3[1] = pfVar1[1];
	param_3[2] = pfVar1[2] - *pfVar1;
	param_3[3] = pfVar1[3] - pfVar1[1];
	return;
}



void __cdecl
lego::main::Main_LoadRightPanelCrystals(char *smallCrystal,char *usedCrystal,char *noSmallCrystal)
{
	globals::g_RightPanel_SmallCrystal_bmp = image::Image_LoadBMP(smallCrystal,0,0);
	if (globals::g_RightPanel_SmallCrystal_bmp != NULL) {
		image::Image_unkFogFromFloat__0047deb0
							(globals::g_RightPanel_SmallCrystal_bmp,0.0,0.0,0.0,0.0,0.0,0.0);
	}
	globals::g_RightPanel_UsedCrystal_bmp = image::Image_LoadBMP(usedCrystal,0,0);
	if (globals::g_RightPanel_UsedCrystal_bmp != NULL) {
		image::Image_unkFogFromFloat__0047deb0
							(globals::g_RightPanel_UsedCrystal_bmp,0.0,0.0,0.0,0.0,0.0,0.0);
	}
	globals::g_RightPanel_NoSmallCrystal_bmp = image::Image_LoadBMP(noSmallCrystal,0,0);
	if (globals::g_RightPanel_NoSmallCrystal_bmp != NULL) {
		image::Image_unkFogFromFloat__0047deb0
							(globals::g_RightPanel_NoSmallCrystal_bmp,0.0,0.0,0.0,0.0,0.0,0.0);
	}
	return;
}



void __cdecl
lego::game::Level_LoadRewardQuotaCrystals(CFGProperty *root,char *keyBasePath,char *levelName)
{
	char *pcVar1;
	
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,levelName,"Reward","Quota","Crystals",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 == NULL) {
		pcVar1 = ____EMPTYSTR__;
	}
	else {
		pcVar1 = cfg::CFG_JoinPath(keyBasePath,levelName,"Reward","Quota","Crystals",0);
		pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	}
	globals::g_RewardsQuotaCrystals = std::atoi(pcVar1);
	if ((26 < globals::g_RewardsQuotaCrystals) || (globals::g_RewardsQuotaCrystals == 0)) {
		globals::g_RewardsQuotaCrystals = 26;
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_0045c390(uint param_1,uint param_2,undefined4 param_3)
{
	undefined4 *puVar1;
	uint uVar2;
	int iVar3;
	uint *puVar4;
	undefined4 *puVar5;
	uint uVar6;
	uint *puVar7;
	uint uVar8;
	uint uVar9;
	ImageBMP *bitmap;
	uint *local_70;
	float local_6c;
	uint local_68 [26];
	
	local_68[2] = 0;
	local_68[0] = 0;
	puVar4 = local_68 + 3;
	for (iVar3 = 0x17; iVar3 != 0; iVar3 += -1) {
		*puVar4 = 0;
		puVar4 = puVar4 + 1;
	}
	local_68[1] = 0;
	puVar5 = &DAT_00501868;
	do {
		iVar3 = 2;
		puVar1 = puVar5;
		do {
			*puVar1 = puVar1[1];
			puVar1 = puVar1 + 6;
			iVar3 += -1;
		} while (iVar3 != 0);
		puVar5 = puVar5 + 1;
	} while (puVar5 < &DAT_0050187c);
	_DAT_0050187c = param_1;
	local_70 = local_68 + 2;
	_DAT_00501894 = param_2;
	uVar6 = 0;
	puVar4 = local_68;
	do {
		uVar8 = 0;
		do {
			uVar9 = *puVar4;
			uVar2 = 0;
			if (uVar9 != 0) {
				puVar7 = local_70;
				do {
					if (*puVar7 == (&DAT_00501868)[uVar8 + uVar6]) {
						local_68[(uVar2 + uVar6) * 2 + 3] = local_68[(uVar2 + uVar6) * 2 + 3] + 1;
						break;
					}
					uVar2 += 1;
					puVar7 = puVar7 + 2;
				} while (uVar2 < uVar9);
			}
			if (uVar2 == uVar9) {
				local_68[(uVar2 + uVar6) * 2 + 2] = (&DAT_00501868)[uVar8 + uVar6];
				local_68[(uVar2 + uVar6) * 2 + 3] = 1;
				*puVar4 = uVar9 + 1;
			}
			uVar8 += 1;
		} while (uVar8 < 6);
		uVar6 += 6;
		local_70 = local_70 + 0xc;
		puVar4 = puVar4 + 1;
		if (0xb < uVar6) {
			uVar6 = 0;
			do {
				uVar8 = local_68[uVar6];
				uVar9 = 0;
				if (uVar8 != 0) {
					puVar7 = local_68;
					puVar4 = local_68 + uVar6 * 0xc + 3;
					do {
						puVar7 = puVar7 + 2;
						uVar2 = *puVar4;
						if (uVar9 < uVar2) {
							uVar9 = uVar2;
							if (uVar6 == 0) {
								param_1 = *puVar7;
							}
							else {
								param_2 = puVar4[-1];
							}
						}
						puVar4 = puVar4 + 2;
						uVar8 -= 1;
					} while (uVar8 != 0);
				}
				uVar6 += 1;
			} while (uVar6 < 2);
			FUN_0045a720(5,(undefined4 *)lego::globals::g_Game.bmpToolTipFont,0x29,0x1d5,1,"%i",param_1);
			if (lego::globals::g_RightPanel_NoSmallCrystal_bmp != NULL) {
				local_70 = (uint *)0x441c0000;
				local_6c = 429.0;
				for (uVar6 = lego::globals::g_RewardsQuotaCrystals; uVar6 != 0; uVar6 -= 1) {
					lego::image::Image_Blt__0047df70
										(lego::globals::g_RightPanel_NoSmallCrystal_bmp,NULL,(float *)&local_70,NULL);
					local_6c = local_6c - 17.0;
				}
			}
			if (lego::globals::g_RightPanel_SmallCrystal_bmp != NULL) {
				uVar6 = 0;
				if (lego::globals::g_RewardsQuotaCrystals < param_1) {
					param_1 = lego::globals::g_RewardsQuotaCrystals;
				}
				if (lego::globals::g_RewardsQuotaCrystals < param_2) {
					param_2 = lego::globals::g_RewardsQuotaCrystals;
				}
				local_70 = (uint *)0x441c0000;
				local_6c = 429.0;
				bitmap = lego::globals::g_RightPanel_SmallCrystal_bmp;
				uVar8 = param_2;
				if (lego::globals::g_RightPanel_UsedCrystal_bmp != NULL) {
					for (; bitmap = lego::globals::g_RightPanel_UsedCrystal_bmp,
							lego::globals::g_RightPanel_UsedCrystal_bmp = bitmap, uVar8 != 0; uVar8 = uVar8 - 1) {
						lego::image::Image_Blt__0047df70
											(lego::globals::g_RightPanel_SmallCrystal_bmp,NULL,(float *)&local_70,NULL);
						local_6c = local_6c - 17.0;
						uVar6 = param_2;
					}
				}
				if (uVar6 < param_1) {
					iVar3 = param_1 - uVar6;
					do {
						lego::image::Image_Blt__0047df70(bitmap,NULL,(float *)&local_70,NULL);
						local_6c = local_6c - 17.0;
						iVar3 += -1;
					} while (iVar3 != 0);
				}
			}
			return;
		}
	} while( true );
}



void __cdecl
lego::main::Main_LoadAirMeter
					(char *airJuice,uint param_2,uint param_3,uint param_4,char *noAir,uint param_6,
					uint param_7)
{
	globals::g_AirMeter_AirJuice_bmp = image::Image_LoadBMP(airJuice,0,0);
	globals::g_AirMeter_AirJuice_positionORsize.x = (float)(ulonglong)param_2;
	globals::g_AirMeter_AirJuice_positionORsize.y = (float)(ulonglong)param_3;
	UINT_00501800 = param_4;
	globals::g_AirMeter_NoAir_bmp = image::Image_LoadBMP(noAir,0,0);
	if (globals::g_AirMeter_NoAir_bmp != NULL) {
		image::Image_unkFogFromFloat__0047deb0(globals::g_AirMeter_NoAir_bmp,0.0,0.0,0.0,0.0,0.0,0.0);
	}
	globals::g_AirMeter_NoAir_positionORsize.x = (float)(ulonglong)param_6;
	globals::g_AirMeter_NoAir_positionORsize.y = (float)(ulonglong)param_7;
	return;
}



void __cdecl FUN_0045c6b0(int param_1,undefined *param_2)
{
	float local_10;
	float fStack12;
	float local_8;
	float local_4;
	
	if ((lego::globals::g_AirMeter_AirJuice_bmp != NULL) &&
		 ((ushort)((ushort)((float)param_2 < 0.0) << 8 | (ushort)((float)param_2 == 0.0) << 0xe) == 0))
	{
		local_4 = (float)lego::globals::g_AirMeter_AirJuice_bmp->height;
		if ((ushort)((ushort)((float)param_2 < 100.0) << 8 | (ushort)((float)param_2 == 100.0) << 0xe)
				== 0) {
			param_2 = &DAT_42c80000;
		}
		local_8 = (float)(ulonglong)UINT_00501800 * 0.01 * (float)param_2;
		local_10 = (float)(&DAT_00501128)[param_1 * 0xc] +
							 lego::globals::g_AirMeter_AirJuice_positionORsize.x;
		fStack12 = (float)(&DAT_0050112c)[param_1 * 0xc] +
							 lego::globals::g_AirMeter_AirJuice_positionORsize.y;
		lego::image::Image_Blt__0047df70(lego::globals::g_AirMeter_AirJuice_bmp,NULL,&local_10,&local_8)
		;
	}
	return;
}



void __cdecl FUN_0045c760(undefined4 param_1)
{
	DAT_0050180c = param_1;
	return;
}



void __cdecl FUN_0045c770(int param_1)
{
	ImageBMP *bitmap;
	int iVar1;
	float local_8;
	float local_4;
	
	bitmap = lego::globals::g_AirMeter_NoAir_bmp;
	if (lego::globals::g_AirMeter_NoAir_bmp != NULL) {
		local_8 = (float)(&DAT_00501128)[param_1 * 0xc] +
							lego::globals::g_AirMeter_NoAir_positionORsize.x;
		local_4 = (float)(&DAT_0050112c)[param_1 * 0xc] +
							lego::globals::g_AirMeter_NoAir_positionORsize.y;
		if (DAT_0050180c != 0) {
			iVar1 = lego::unk::Lego_GetDat_004ded1c();
			if (iVar1 != 0) {
				lego::image::Image_Blt__0047df70(bitmap,NULL,&local_8,NULL);
			}
		}
	}
	return;
}



void __cdecl
lego::main::Main_LoadRightPanel_CryOreSidebar(char *sidebar,uint param_2,uint param_3,uint param_4)
{
	DAT_00501810 = image::Image_LoadBMP(sidebar,0,0);
	globals::g_RightPanel_CryOreSideBar_positionORsize.x = (float)(ulonglong)param_2;
	globals::g_RightPanel_CryOreSideBar_positionORsize.y = (float)(ulonglong)param_3;
	UINT_0050181c = param_4;
	return;
}



void __cdecl FUN_0045c840(int param_1,int param_2)
{
	if (param_1 == 0) {
		if (param_2 != 0) {
			do {
				param_2 += -1;
				FLOAT_00501820 = (FLOAT_00501820 - 0.05) * 20.0 * 0.05263158;
			} while (param_2 != 0);
		}
	}
	else {
		if (param_2 != 0) {
			do {
				param_2 += -1;
				FLOAT_00501820 = FLOAT_00501820 - (1.0 - FLOAT_00501820) * -0.05;
			} while (param_2 != 0);
		}
	}
	if (FLOAT_00501820 < 0.0) {
		FLOAT_00501820 = 0.0;
	}
	return;
}



void __cdecl FUN_0045c8b0(void)
{
	float local_10;
	float local_c;
	float local_8;
	float fStack4;
	
	if ((DAT_00501810 != NULL) &&
		 ((ushort)((ushort)(FLOAT_00501820 < 0.0) << 8 | (ushort)(FLOAT_00501820 == 0.0) << 0xe) == 0))
	{
		local_10 = (float)DAT_00501810->width;
		local_8 = lego::globals::g_RightPanel_CryOreSideBar_positionORsize.x;
		local_c = (float)(ulonglong)UINT_0050181c * FLOAT_00501820;
		fStack4 = lego::globals::g_RightPanel_CryOreSideBar_positionORsize.y - local_c;
		lego::image::Image_Blt__0047df70(DAT_00501810,NULL,&local_8,&local_10);
	}
	return;
}



undefined4 __cdecl FUN_0045c930(undefined4 param_1,int param_2,int param_3)
{
	uint uVar1;
	
	uVar1 = FUN_0045c970(param_1,param_2,&param_2);
	if (uVar1 != 0) {
		FUN_00401800(param_2,param_3);
		return 1;
	}
	return 0;
}



uint __cdecl FUN_0045c970(undefined4 param_1,int param_2,int *param_3)
{
	*param_3 = 0x15;
	if (true) {
		switch(param_1) {
		case 0:
			if (param_2 == 0) {
				*param_3 = 6;
				return (uint)(*param_3 != 0x15);
			}
			if (param_2 == 1) {
				*param_3 = 7;
				return (uint)(*param_3 != 0x15);
			}
			if (param_2 == 2) {
				*param_3 = 8;
				return (uint)(*param_3 != 0x15);
			}
			if (param_2 == 3) {
				*param_3 = 9;
				return (uint)(*param_3 != 0x15);
			}
			if (param_2 == 4) {
				*param_3 = 10;
				return (uint)(*param_3 != 0x15);
			}
			break;
		case 6:
			if (param_2 == 0) {
				*param_3 = 0xe;
				return (uint)(*param_3 != 0x15);
			}
			if (param_2 == 1) {
				*param_3 = 0xf;
				return (uint)(*param_3 != 0x15);
			}
			if (param_2 == 2) {
				*param_3 = 0x10;
				return (uint)(*param_3 != 0x15);
			}
			break;
		case 9:
			if (param_2 == 0) {
				*param_3 = 0x12;
				return (uint)(*param_3 != 0x15);
			}
			if (param_2 == 1) {
				*param_3 = 0x13;
			}
			break;
		case 10:
			if (param_2 == 0) {
				*param_3 = 0xb;
				return (uint)(*param_3 != 0x15);
			}
			if (param_2 == 1) {
				*param_3 = 0xc;
				return (uint)(*param_3 != 0x15);
			}
		}
	}
	return (uint)(*param_3 != 0x15);
}



void __cdecl lego::main::Main_InitPointers(void)
{
	globals::g_Pointers_TABLE[0] = "Pointer_Standard";
	globals::g_Pointers_TABLE[1] = "Pointer_Blank";
	globals::g_Pointers_TABLE[2] = "Pointer_Selected";
	globals::g_Pointers_TABLE[3] = "Pointer_Drill";
	globals::g_Pointers_TABLE[4] = "Pointer_CantDrill";
	globals::g_Pointers_TABLE[5] = "Pointer_Clear";
	globals::g_Pointers_TABLE[6] = "Pointer_Go";
	globals::g_Pointers_TABLE[7] = "Pointer_CantGo";
	globals::g_Pointers_TABLE[8] = "Pointer_Teleport";
	globals::g_Pointers_TABLE[9] = "Pointer_CantTeleport";
	globals::g_Pointers_TABLE[10] = "Pointer_Reinforce";
	globals::g_Pointers_TABLE[11] = "Pointer_CantReinforce";
	globals::g_Pointers_TABLE[12] = "Pointer_RadarPan";
	globals::g_Pointers_TABLE[13] = "Pointer_TrackObject";
	globals::g_Pointers_TABLE[14] = "Pointer_Help";
	globals::g_Pointers_TABLE[15] = "Pointer_CantHelp";
	globals::g_Pointers_TABLE[16] = "Pointer_PutDown";
	globals::g_Pointers_TABLE[17] = "Pointer_GetIn";
	globals::g_Pointers_TABLE[18] = "Pointer_GetOut";
	globals::g_Pointers_TABLE[19] = "Pointer_TutorialBlockInfo";
	globals::g_Pointers_TABLE[20] = "Pointer_Okay";
	globals::g_Pointers_TABLE[21] = "Pointer_NotOkay";
	globals::g_Pointers_TABLE[22] = "Pointer_CanBuild";
	globals::g_Pointers_TABLE[23] = "Pointer_CannotBuild";
	globals::g_Pointers_TABLE[24] = "Pointer_Dynamite";
	globals::g_Pointers_TABLE[25] = "Pointer_CantDynamite";
	globals::g_Pointers_TABLE[26] = "Pointer_PickUp";
	globals::g_Pointers_TABLE[27] = "Pointer_CantPickUp";
	globals::g_Pointers_TABLE[28] = "Pointer_PickUpOre";
	globals::g_Pointers_TABLE[29] = "Pointer_LegoManCantDig";
	globals::g_Pointers_TABLE[30] = "Pointer_VehicleCantDig";
	globals::g_Pointers_TABLE[31] = "Pointer_LegoManDig";
	globals::g_Pointers_TABLE[32] = "Pointer_VehicleDig";
	globals::g_Pointers_TABLE[33] = "Pointer_LegoManCantPickUp";
	globals::g_Pointers_TABLE[34] = "Pointer_VehicleCantPickUp";
	globals::g_Pointers_TABLE[35] = "Pointer_LegoManPickUp";
	globals::g_Pointers_TABLE[36] = "Pointer_VehiclePickUp";
	globals::g_Pointers_TABLE[37] = "Pointer_LegoManCantGo";
	globals::g_Pointers_TABLE[38] = "Pointer_VehicleCantGo";
	globals::g_Pointers_TABLE[39] = "Pointer_LegoManGo";
	globals::g_Pointers_TABLE[40] = "Pointer_VehicleGo";
	globals::g_Pointers_TABLE[41] = "Pointer_LegoManClear";
	globals::g_Pointers_TABLE[42] = "Pointer_VehicleClear";
	globals::g_Pointers_TABLE[43] = "Pointer_SurfaceType_Immovable";
	globals::g_Pointers_TABLE[44] = "Pointer_SurfaceType_Hard";
	globals::g_Pointers_TABLE[45] = "Pointer_SurfaceType_Medium";
	globals::g_Pointers_TABLE[46] = "Pointer_SurfaceType_Loose";
	globals::g_Pointers_TABLE[47] = "Pointer_SurfaceType_Soil";
	globals::g_Pointers_TABLE[48] = "Pointer_SurfaceType_Lava";
	globals::g_Pointers_TABLE[49] = "Pointer_SurfaceType_Water";
	globals::g_Pointers_TABLE[50] = "Pointer_SurfaceType_OreSeam";
	globals::g_Pointers_TABLE[51] = "Pointer_SurfaceType_Lake";
	globals::g_Pointers_TABLE[52] = "Pointer_SurfaceType_CrystalSeam";
	globals::g_Pointers_TABLE[53] = "Pointer_SurfaceType_RechargeSeam";
	globals::g_Pointers_TABLE[54] = "Pointer_CantZoom";
	globals::g_Pointers_TABLE[55] = "Pointer_Zoom";
	return;
}



void __cdecl FUN_0045cd30(CFGProperty *prop)
{
	char cVar1;
	bool bVar2;
	int iVar3;
	ImageBMP *pIVar4;
	int iVar5;
	char *pcVar6;
	char *pcVar7;
	int local_42c;
	char *local_428;
	char *local_424;
	char *local_420;
	char local_400 [1024];
	
	if (prop != NULL) {
		do {
			pcVar6 = prop->key;
			bVar2 = true;
			if (pcVar6 != NULL) {
				iVar5 = -1;
				pcVar7 = pcVar6;
				do {
					if (iVar5 == 0) break;
					iVar5 += -1;
					cVar1 = *pcVar7;
					pcVar7 = pcVar7 + 1;
				} while (cVar1 != '\0');
				if ((iVar5 != -2) && (*pcVar6 == '!')) {
					if ((lego::globals::g_CMDLINE_FLAGS & CMD_REDUCEIMAGES) == CMD_NONE) {
						pcVar6 = pcVar6 + 1;
					}
					else {
						bVar2 = false;
					}
				}
			}
			if ((bVar2) && (iVar5 = FUN_0045ce90(pcVar6,&local_42c), iVar5 != 0)) {
				std::sprintf(local_400,"%s",prop->value);
				iVar3 = lego::util::stringSplit(local_400,&local_428,",");
				iVar5 = local_42c;
				if (iVar3 == 1) {
					iVar3 = local_42c * 4;
					pIVar4 = lego::image::Image_LoadBMP(local_428,0,0);
					(&DAT_00501a9c)[iVar5] = pIVar4;
					*(undefined4 *)(&DAT_00501b7c + iVar3) = 0;
				}
				else {
					lego::unk::Lego_CrashesFunc_00483f40(local_428,&DAT_00501a9c + local_42c);
					*(undefined4 *)(&DAT_00501b7c + local_42c * 4) = 1;
					iVar5 = std::atoi(local_424);
					*(int *)(&DAT_00501c5c + local_42c * 8) = iVar5;
					iVar5 = std::atoi(local_420);
					*(int *)(&DAT_00501c60 + local_42c * 8) = iVar5;
				}
				if (*(int *)(&DAT_00501b7c + local_42c * 4) == 0) {
					lego::image::Image_unkFogFromFloat__0047deb0
										((ImageBMP *)(&DAT_00501a9c)[local_42c],0.0,0.0,0.0,0.0,0.0,0.0);
				}
			}
			prop = lego::cfg::CFG_NextFlatProperty(prop);
		} while (prop != NULL);
	}
	return;
}



undefined4 __cdecl FUN_0045ce90(char *param_1,int *param_2)
{
	int iVar1;
	char **ppcVar2;
	int iVar3;
	
	iVar3 = 0;
	ppcVar2 = lego::globals::g_Pointers_TABLE;
	do {
		iVar1 = std::_stricmp(*ppcVar2,param_1);
		if (iVar1 == 0) {
			*param_2 = iVar3;
			return 1;
		}
		ppcVar2 = ppcVar2 + 1;
		iVar3 += 1;
	} while (ppcVar2 < &FLOAT_00501efc);
	return 0;
}



undefined4 __cdecl FUN_0045ced0(int param_1)
{
	return (&DAT_00501a9c)[param_1];
}



void __cdecl FUN_0045cee0(int param_1)
{
	if ((ushort)((ushort)(FLOAT_00501efc < 0.0) << 8 | (ushort)(FLOAT_00501efc == 0.0) << 0xe) != 0) {
		INT_00501a98 = param_1;
	}
	return;
}



void __cdecl FUN_0045cf00(int param_1,float param_2)
{
	INT_00501a98 = param_1;
	FLOAT_00501efc = param_2;
	return;
}



int FUN_0045cf20(void)
{
	return INT_00501a98;
}



void __cdecl FUN_0045cf30(uint param_1,uint param_2)
{
	ImageBMP *bitmap;
	undefined4 unaff_ESI;
	float local_20;
	float fStack28;
	uint local_18;
	undefined4 uStack20;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	local_20 = (float)(ulonglong)param_1;
	fStack28 = (float)(ulonglong)param_2;
	if (*(int *)(&DAT_00501b7c + INT_00501a98 * 4) != 1) {
		bitmap = (&DAT_00501a9c)[INT_00501a98];
		if ((&DAT_00501a9c)[INT_00501a98] == NULL) {
			bitmap = DAT_00501a9c;
		}
		lego::image::Image_Blt__0047df70(bitmap,NULL,&local_20,NULL);
		return;
	}
	local_10 = (float)*(int *)(&DAT_00501c5c + INT_00501a98 * 8) + local_20;
	local_c = (float)*(int *)(&DAT_00501c60 + INT_00501a98 * 8) + fStack28;
	local_18 = lego::res::Res_GetActFrameIsLWSFile((ActFrameResource *)(&DAT_00501a9c)[INT_00501a98]);
	uStack20 = 0;
	local_8 = (float)(ulonglong)local_18;
	local_18 = FUN_004853a0((int)(&DAT_00501a9c)[INT_00501a98]);
	uStack20 = 0;
	local_4 = (float)(ulonglong)local_18;
	lego::image::Image_Blt__0047df70(DAT_00501aa0,NULL,&local_20,NULL);
	FUN_00484330((uint *)(&DAT_00501a9c)[INT_00501a98],&local_10,
							 ~lego::globals::g_Game.flags1 >> 0x14 & 1,1,unaff_ESI);
	return;
}



void __cdecl FUN_0045d050(float param_1)
{
	if ((ushort)((ushort)(FLOAT_00501efc < 0.0) << 8 | (ushort)(FLOAT_00501efc == 0.0) << 0xe) == 0) {
		FLOAT_00501efc = FLOAT_00501efc - param_1;
	}
	return;
}



void __cdecl lego::main::Main_LoadPriorityImages(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	CFGProperty *prop;
	int iVar2;
	int iVar3;
	ImageBMP *pIVar4;
	int local_254;
	char *local_250;
	char *local_24c;
	char *local_248;
	char *local_244;
	char *local_228;
	char *local_224;
	char local_200 [512];
	
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"PriorityImages",0);
	for (prop = cfg::CFG_GetBlockFirstChild(root,pcVar1); prop != NULL;
			prop = cfg::CFG_NextFlatProperty(prop)) {
		iVar2 = game::Game_GetAIPriority(prop->key,&local_254);
		if (iVar2 != 0) {
			std::sprintf(local_200,"%s",prop->value);
			util::stringSplit(local_200,&local_250,":");
			iVar3 = util::stringSplit(local_250,&local_228,"|");
			iVar2 = local_254 * 4;
			pcVar1 = std::_strdup(local_228);
			*(char **)(&DAT_00501f00 + iVar2) = pcVar1;
			if (iVar3 == 2) {
				snd::Snd_GetSFX(local_224,(int *)(&DAT_005020b0 + iVar2));
			}
			pIVar4 = image::Image_LoadBMP(local_24c,0,0);
			*(ImageBMP **)(&DAT_00501f6c + local_254 * 4) = pIVar4;
			pIVar4 = image::Image_LoadBMP(local_248,0,0);
			*(ImageBMP **)(&DAT_00501fd8 + local_254 * 4) = pIVar4;
			pIVar4 = image::Image_LoadBMP(local_244,0,0);
			*(ImageBMP **)(&DAT_00502044 + local_254 * 4) = pIVar4;
		}
	}
	return;
}



void FUN_0045d1c0(void)
{
	undefined4 *puVar1;
	uint uVar2;
	
	uVar2 = 0;
	if (lego::globals::g_LevelPriorities_COUNT != 0) {
		puVar1 = lego::globals::g_Priorities_unk_TABLE;
		do {
			puVar1[-0x6c] = puVar1[-0x1b];
			lego::game::Game_SetAITaskValue2(puVar1[-0x1b],*puVar1);
			lego::game::Game_SetIsPriorityDisabled(puVar1[-0x6c],puVar1[0x1b]);
			uVar2 += 1;
			puVar1 = puVar1 + 1;
		} while (uVar2 < lego::globals::g_LevelPriorities_COUNT);
	}
	return;
}



BOOL __cdecl lego::game::Level_LoadPriorities(CFGProperty *root,char *keyBasePath,char *keyName)
{
	char *keyPath;
	CFGProperty *prop;
	int iVar1;
	uint uVar2;
	
	globals::g_LevelPriorities_COUNT = 0;
	keyPath = cfg::CFG_JoinPath(keyBasePath,keyName,"Priorities",0);
	for (prop = cfg::CFG_GetBlockFirstChild(root,keyPath); prop != NULL;
			prop = cfg::CFG_NextFlatProperty(prop)) {
		iVar1 = Game_GetAIPriority(prop->key,(int *)&keyName);
		if (iVar1 != 0) {
			globals::g_PriorityNames_a_TABLE[globals::g_LevelPriorities_COUNT] = keyName;
			globals::g_PriorityNames_b_TABLE[globals::g_LevelPriorities_COUNT] = keyName;
			globals::g_Priorities_unk_TABLE[globals::g_LevelPriorities_COUNT] =
					 globals::g_LevelPriorities_COUNT * -5 + 0x50;
			Game_SetAITaskValue2
								((int)keyName,globals::g_Priorities_unk_TABLE[globals::g_LevelPriorities_COUNT]);
			uVar2 = lego::util::parseBoolLiteral(prop->value);
			if (uVar2 == 1) {
				Game_SetIsPriorityDisabled((int)keyName,0);
				globals::g_Priorities_bool1_TABLE[globals::g_LevelPriorities_COUNT] = 0;
			}
			else {
				Game_SetIsPriorityDisabled((int)keyName,1);
				globals::g_Priorities_bool1_TABLE[globals::g_LevelPriorities_COUNT] = 1;
			}
			globals::g_LevelPriorities_COUNT += 1;
		}
	}
	return 1;
}



void __cdecl lego::main::Main_LoadPrioritiesImagePositions(CFGProperty *root,char *keyBasePath)
{
	char *keyPath1;
	char *pcVar1;
	int iVar2;
	int value;
	char **ppcVar3;
	char *local_40;
	char *local_3c;
	
	keyPath1 = keyBasePath;
	value = 0;
	ppcVar3 = (char **)&globals::g_PrioritiesImagePositions_TABLE[0].y;
	do {
		value += 1;
		std::itoa(value,(char *)&keyBasePath,10);
		pcVar1 = cfg::CFG_JoinPath(keyPath1,"PrioritiesImagePositions",&keyBasePath,0);
		pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
		if (pcVar1 != NULL) {
			util::stringSplit(pcVar1,&local_40,",");
			iVar2 = std::atoi(local_40);
			ppcVar3[-1] = (char *)(float)iVar2;
			iVar2 = std::atoi(local_3c);
			*ppcVar3 = (char *)(float)iVar2;
		}
		ppcVar3 = ppcVar3 + 2;
	} while (ppcVar3 < globals::g_PriorityNames_b_TABLE + 1);
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

undefined4 __cdecl FUN_0045d3d0(uint param_1,uint param_2,int param_3,int param_4,int param_5)
{
	char *pcVar1;
	uint uVar2;
	float fVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	float *pfVar7;
	char **ppcVar8;
	float local_30;
	float local_2c;
	float local_28;
	float local_24;
	uint local_20;
	undefined4 uStack28;
	uint local_18;
	undefined4 uStack20;
	uint local_10;
	undefined4 uStack12;
	uint local_8;
	undefined4 uStack4;
	
	iVar4 = FUN_0045adf0(8);
	if ((iVar4 == 0) && (uVar5 = FUN_0045ae50(8), uVar5 == 0)) {
		FUN_0045a9c0(8,&local_28,&local_24);
		uVar5 = 0;
		if (lego::globals::g_LevelPriorities_COUNT != 0) {
			pfVar7 = &lego::globals::g_PrioritiesImagePositions_TABLE[0].y;
			ppcVar8 = lego::globals::g_PriorityNames_a_TABLE;
			do {
				pcVar1 = *ppcVar8;
				iVar4 = *(int *)(&DAT_00501f6c + (int)pcVar1 * 4);
				if (iVar4 != 0) {
					uStack28 = 0;
					local_30 = pfVar7[-1] + local_28;
					local_20 = param_1;
					uVar6 = *(uint *)(iVar4 + 8);
					fVar3 = (float)(ulonglong)param_1;
					uVar2 = *(uint *)(iVar4 + 4);
					local_2c = local_24 + *pfVar7;
					if ((local_30 <= fVar3) &&
						 (uStack20 = 0, local_18 = uVar2,
						 (ushort)((ushort)(fVar3 < (float)(ulonglong)uVar2 + local_30) << 8 |
										 (ushort)(fVar3 == (float)(ulonglong)uVar2 + local_30) << 0xe) != 0)) {
						uStack12 = 0;
						local_10 = param_2;
						fVar3 = (float)(ulonglong)param_2;
						if ((local_2c <= fVar3) &&
							 (uStack4 = 0, local_8 = uVar6,
							 (ushort)((ushort)(fVar3 < (float)(ulonglong)uVar6 + local_2c) << 8 |
											 (ushort)(fVar3 == (float)(ulonglong)uVar6 + local_2c) << 0xe) != 0)) {
							DAT_005023bc |= 1;
							FUN_0045d630(&local_30,uVar2 - 1,uVar6 - 1);
							if (param_3 == 0) {
								if ((_DAT_004a9ee8 == uVar5) && (_DAT_004a9eec == pcVar1)) {
									lego::unk::Lego_LoadToolTip_HasNLEscape__0046b7e0
														(7,*(char **)(&DAT_00501f00 + (int)pcVar1 * 4));
									FUN_0046ba30(7);
									FUN_0041b9c0(*(undefined4 *)(&DAT_005020b0 + (int)pcVar1 * 4));
								}
								else {
									FUN_0046ba30(0);
									_DAT_004a9ee8 = uVar5;
									_DAT_004a9eec = pcVar1;
								}
							}
							uVar6 = FUN_0045d5c0(uVar5,param_3,param_4);
							if ((uVar6 != 0) && (param_5 != 0)) {
								FUN_0045d680(uVar5);
							}
							return 1;
						}
					}
				}
				uVar5 += 1;
				ppcVar8 = ppcVar8 + 1;
				pfVar7 = pfVar7 + 2;
			} while (uVar5 < lego::globals::g_LevelPriorities_COUNT);
		}
		FUN_0045d5c0(0x1b,param_3,param_4);
	}
	return 0;
}



uint __cdecl FUN_0045d5c0(int param_1,int param_2,int param_3)
{
	int iVar1;
	
	iVar1 = DAT_005023b8;
	if (param_2 == 0) {
		DAT_005023b8 = 0x1b;
	}
	else {
		if (DAT_005023b8 == 0x1b) {
			if (param_3 == 0) {
				DAT_005023b8 = param_1;
				DAT_005023bc = DAT_005023bc | 2;
				return (uint)(param_1 == 0x1b);
			}
		}
		else {
			if (DAT_005023b8 == param_1) {
				DAT_005023bc = DAT_005023bc | 2;
				return (uint)(DAT_005023b8 == param_1);
			}
		}
	}
	return (uint)(iVar1 == param_1);
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_0045d630(undefined4 *param_1,uint param_2,uint param_3)
{
	_DAT_005023a8 = *param_1;
	_DAT_005023ac = param_1[1];
	_DAT_005023b0 = (float)(ulonglong)param_2;
	_DAT_005023b4 = (float)(ulonglong)param_3;
	return;
}



void __cdecl FUN_0045d680(uint param_1)
{
	if (((byte)DAT_00501860 & 2) != 0) {
		FUN_0045d6b0(param_1);
		return;
	}
	if (((byte)DAT_00501860 & 4) != 0) {
		FUN_0045d730(param_1);
	}
	return;
}



void __cdecl FUN_0045d6b0(uint param_1)
{
	char *index;
	char *index_00;
	uint uVar1;
	int iVar2;
	int iVar3;
	
	if ((param_1 != 0) && (param_1 < lego::globals::g_LevelPriorities_COUNT)) {
		index = lego::globals::g_PriorityNames_a_TABLE[param_1];
		iVar3 = 0;
		if (param_1 != 0) {
			iVar2 = 0x50;
			uVar1 = param_1;
			do {
				index_00 = *(char **)(&DAT_00502118 + uVar1 * 4);
				lego::globals::g_PriorityNames_a_TABLE[uVar1] = index_00;
				lego::game::Game_SetAITaskValue2((int)index_00,iVar2 + param_1 * -5);
				iVar3 += 1;
				iVar2 += 5;
				uVar1 = param_1 - iVar3;
			} while (uVar1 != 0);
		}
		lego::globals::g_PriorityNames_a_TABLE[0] = index;
		lego::game::Game_SetAITaskValue2((int)index,0x50);
	}
	FUN_00428730(3);
	return;
}



void __cdecl FUN_0045d730(uint param_1)
{
	char *pcVar1;
	
	if ((param_1 != 0) && (param_1 < lego::globals::g_LevelPriorities_COUNT)) {
		pcVar1 = lego::globals::g_PriorityNames_a_TABLE[param_1];
		lego::globals::g_PriorityNames_a_TABLE[param_1] = *(char **)(&DAT_00502118 + param_1 * 4);
		*(char **)(&DAT_00502118 + param_1 * 4) = pcVar1;
		lego::game::Game_SetAITaskValue2
							((int)lego::globals::g_PriorityNames_a_TABLE[param_1],param_1 * -5 + 0x50);
		lego::game::Game_SetAITaskValue2(*(int *)(&DAT_00502118 + param_1 * 4),param_1 * -5 + 0x55);
		FUN_0045d810(param_1 - 1);
	}
	FUN_00428730(0);
	return;
}



void __cdecl FUN_0045d7b0(uint param_1)
{
	BOOL BVar1;
	
	if (param_1 < lego::globals::g_LevelPriorities_COUNT) {
		BVar1 = lego::game::Game_IsPriorityDisabled
											((int)lego::globals::g_PriorityNames_a_TABLE[param_1]);
		lego::game::Game_SetIsPriorityDisabled
							((int)lego::globals::g_PriorityNames_a_TABLE[param_1],(uint)(BVar1 == 0));
		if (((BVar1 == 0) != 0) &&
			 ((lego::globals::g_PriorityNames_a_TABLE[param_1] == NULL ||
				(lego::globals::g_PriorityNames_a_TABLE[param_1] == (char *)0x1)))) {
			lego::front::Text_DisplayType(TEXT_CRYSTALOREDISABLED,1,0);
		}
	}
	return;
}



void __cdecl FUN_0045d810(undefined4 param_1)
{
	int iVar1;
	longlong lVar2;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	switch(param_1) {
	case 0:
		FUN_0045d900(0);
		return;
	case 1:
		iVar1 = 9;
		break;
	case 2:
		iVar1 = 10;
		break;
	case 3:
		iVar1 = 0xb;
		break;
	case 4:
		iVar1 = 0xc;
		break;
	case 5:
		iVar1 = 0xd;
		break;
	case 6:
		iVar1 = 0xe;
		break;
	case 7:
		iVar1 = 0xf;
		break;
	case 8:
		iVar1 = 0x10;
		break;
	default:
		goto switchD_0045d821_caseD_9;
	}
	FUN_0045a9c0(8,&local_18,&local_14);
	FUN_0045c230(8,iVar1,&local_10);
	lVar2 = __ftol((float10)local_4 * (float10)0.5 + (float10)local_c + (float10)local_14);
	iVar1 = (int)lVar2;
	lVar2 = __ftol((float10)local_8 * (float10)0.5 + (float10)local_10 + (float10)local_18);
	lego::input::Input_SetMousePosition((int)lVar2,iVar1);
switchD_0045d821_caseD_9:
	return;
}



void __cdecl FUN_0045d900(int priorityIndex)
{
	char *pcVar1;
	int iVar2;
	int y;
	longlong lVar3;
	float local_10;
	float local_c;
	uint local_8;
	undefined4 local_4;
	
	pcVar1 = lego::globals::g_PriorityNames_a_TABLE[priorityIndex];
	if (*(int *)(&DAT_00501f6c + (int)pcVar1 * 4) != 0) {
		FUN_0045a9c0(8,&local_10,&local_c);
		iVar2 = *(int *)(&DAT_00501f6c + (int)pcVar1 * 4);
		local_4 = 0;
		local_8 = *(uint *)(iVar2 + 8) >> 1;
		lVar3 = __ftol((float10)lego::globals::g_PrioritiesImagePositions_TABLE[priorityIndex].y +
									 (float10)local_c + (float10)local_8);
		y = (int)lVar3;
		local_8 = *(uint *)(iVar2 + 4) >> 1;
		local_4 = 0;
		lVar3 = __ftol((float10)lego::globals::g_PrioritiesImagePositions_TABLE[priorityIndex].x +
									 (float10)local_10 + (float10)local_8);
		lego::input::Input_SetMousePosition((int)lVar3,y);
	}
	return;
}



void __cdecl FUN_0045d990(void)
{
	char *priorityIndex;
	ImageBMP *bitmap;
	int iVar1;
	BOOL BVar2;
	uint uVar3;
	char **ppcVar4;
	float *pfVar5;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	iVar1 = FUN_0045adf0(8);
	if (iVar1 == 0) {
		FUN_0045a9c0(8,&local_8,&local_4);
		uVar3 = 0;
		if (lego::globals::g_LevelPriorities_COUNT != 0) {
			pfVar5 = &lego::globals::g_PrioritiesImagePositions_TABLE[0].y;
			ppcVar4 = lego::globals::g_PriorityNames_a_TABLE;
			do {
				local_10 = pfVar5[-1] + local_8;
				local_c = local_4 + *pfVar5;
				priorityIndex = *ppcVar4;
				BVar2 = lego::game::Game_IsPriorityDisabled((int)priorityIndex);
				if (BVar2 == 0) {
					if (((DAT_005023bc & 2) == 0) || (DAT_005023b8 != uVar3)) {
						bitmap = *(ImageBMP **)(&DAT_00501f6c + (int)priorityIndex * 4);
					}
					else {
						bitmap = *(ImageBMP **)(&DAT_00501fd8 + (int)priorityIndex * 4);
					}
				}
				else {
					bitmap = *(ImageBMP **)(&DAT_00502044 + (int)priorityIndex * 4);
				}
				if (bitmap != NULL) {
					lego::image::Image_Blt__0047df70(bitmap,NULL,&local_10,NULL);
				}
				uVar3 += 1;
				ppcVar4 = ppcVar4 + 1;
				pfVar5 = pfVar5 + 2;
			} while (uVar3 < lego::globals::g_LevelPriorities_COUNT);
		}
		if ((DAT_005023bc & 1) != 0) {
			FUN_0041cc60((float *)&DAT_005023a8);
			DAT_005023bc &= 0xfffffffe;
		}
		DAT_005023bc &= 0xfffffffd;
	}
	return;
}



BOOL __cdecl lego::main::Main_loadPTLCFG__0045daa0(char *filename,char *keyBlockPath)
{
	uint uVar1;
	CFGProperty *root;
	CFGProperty *prop;
	MessageType MVar2;
	
	globals::g_LEVEL_PTLEVENTS_COUNT = 0;
	root = cfg::CFG_Open(filename);
	if (root != NULL) {
		prop = cfg::CFG_GetBlockFirstChild(root,keyBlockPath);
		uVar1 = globals::g_LEVEL_PTLEVENTS_COUNT;
		while (prop != NULL) {
			globals::g_LEVEL_PTLEVENTS_COUNT = uVar1 + 1;
			MVar2 = game::Game_LookupPTLEventIndex(prop->key);
			globals::g_LEVEL_PTLEVENTS_TABLE[uVar1].eventIndex = MVar2;
			MVar2 = game::Game_LookupPTLEventIndex(prop->value);
			globals::g_LEVEL_PTLEVENTS_TABLE[uVar1].actionIndex = MVar2;
			prop = cfg::CFG_NextFlatProperty(prop);
			uVar1 = globals::g_LEVEL_PTLEVENTS_COUNT;
		}
		globals::g_LEVEL_PTLEVENTS_COUNT = uVar1;
		cfg::CFG_Close(root);
		return 1;
	}
	return 0;
}



void __cdecl lego::game::Game_PTLEventToAction__0045db30(MessageAction *out_message)
{
	uint uVar1;
	PTLProperty *pPVar2;
	
	uVar1 = 0;
	if (globals::g_LEVEL_PTLEVENTS_COUNT != 0) {
		pPVar2 = globals::g_LEVEL_PTLEVENTS_TABLE;
		while (out_message->event != pPVar2->eventIndex) {
			uVar1 += 1;
			pPVar2 = pPVar2 + 1;
			if (globals::g_LEVEL_PTLEVENTS_COUNT <= uVar1) {
				return;
			}
		}
		out_message->event = pPVar2->actionIndex;
	}
	return;
}



void __cdecl FUN_0045db60(int param_1,undefined4 param_2)
{
	*(undefined4 *)(param_1 + 0x14) = param_2;
	return;
}



void __cdecl lego::main::Main_InitUnkVectorTables(void)
{
	Vector3F *pVVar1;
	Vector3F *pVVar2;
	float *pfVar3;
	int iVar4;
	int iVar5;
	uint uVar6;
	float *pfVar7;
	
	pVVar1 = globals::g_UnkVector3F_30_TABLE;
	do {
		iVar5 = 3;
		pVVar2 = pVVar1;
		do {
			pVVar1 = (Vector3F *)&pVVar2->y;
			iVar5 += -1;
			pVVar2->x = pVVar2->x * 0.003921569;
			pVVar2 = pVVar1;
		} while (iVar5 != 0);
	} while (pVVar1 < &globals::g_UnkStructF_a_INT);
	pfVar3 = &globals::g_UnkStructF10_a_TABLE[0].float_c;
	do {
		pfVar3[0x50] = 1.0;
		*pfVar3 = 1.0;
		pfVar3 = pfVar3 + 4;
	} while (pfVar3 < &globals::g_UnkStructF10_b_TABLE[0].float_c);
	globals::g_UnkStructF10_a_TABLE[0].float_0 = 320.0;
	globals::g_UnkStructF10_a_TABLE[0].float_4 = 40.0;
	globals::g_UnkStructF10_b_TABLE[0].float_0 = 420.0;
	globals::g_UnkStructF10_b_TABLE[0].float_4 = 180.0;
	globals::g_UnkStructF10_a_TABLE[1].float_0 = 420.0;
	globals::g_UnkStructF10_a_TABLE[1].float_4 = 180.0;
	globals::g_UnkStructF10_b_TABLE[1].float_0 = 360.0;
	globals::g_UnkStructF10_b_TABLE[1].float_4 = 180.0;
	globals::g_UnkStructF10_a_TABLE[2].float_0 = 360.0;
	globals::g_UnkStructF10_a_TABLE[2].float_4 = 180.0;
	globals::g_UnkStructF10_b_TABLE[2].float_0 = 360.0;
	globals::g_UnkStructF10_b_TABLE[2].float_4 = 400.0;
	globals::g_UnkStructF10_a_TABLE[3].float_0 = 360.0;
	globals::g_UnkStructF10_a_TABLE[3].float_4 = 400.0;
	globals::g_UnkStructF10_b_TABLE[3].float_0 = 280.0;
	globals::g_UnkStructF10_b_TABLE[3].float_4 = 400.0;
	globals::g_UnkStructF10_a_TABLE[4].float_0 = 280.0;
	globals::g_UnkStructF10_a_TABLE[4].float_4 = 400.0;
	globals::g_UnkStructF10_b_TABLE[4].float_0 = 280.0;
	globals::g_UnkStructF10_b_TABLE[4].float_4 = 180.0;
	globals::g_UnkStructF10_a_TABLE[5].float_0 = 280.0;
	globals::g_UnkStructF10_a_TABLE[5].float_4 = 180.0;
	globals::g_UnkStructF10_b_TABLE[5].float_0 = 220.0;
	globals::g_UnkStructF10_b_TABLE[5].float_4 = 180.0;
	globals::g_UnkStructF10_a_TABLE[6].float_0 = 220.0;
	globals::g_UnkStructF10_a_TABLE[6].float_4 = 180.0;
	globals::g_UnkStructF10_b_TABLE[6].float_0 = 320.0;
	globals::g_UnkStructF10_b_TABLE[6].float_4 = 40.0;
	globals::g_UnkStructF10_a_COUNT = 7;
	uVar6 = 0;
	pfVar3 = &globals::g_UnkStructF10_a_TABLE[0].float_4;
	do {
		iVar5 = 2;
		pfVar7 = pfVar3;
		do {
			iVar4 = Config_GetResolutionWidth();
			pfVar7[-1] = (float)iVar4 * 0.0015625 * pfVar7[-1];
			iVar4 = Config_GetResolutionHeight();
			iVar5 += -1;
			*pfVar7 = (float)iVar4 * 0.002083333 * *pfVar7;
			pfVar7 = pfVar7 + 0x50;
		} while (iVar5 != 0);
		uVar6 += 1;
		pfVar3 = pfVar3 + 4;
	} while (uVar6 < globals::g_UnkStructF10_a_COUNT);
	globals::g_UnkStructF_a_INT = -1;
	globals::g_UnkStructF_b_INT = -1;
	return;
}



int * __cdecl FUN_0045dd50(LevelSurfaceMap *param_1,int *param_2,int param_3)
{
	LevelSurfaceMap *pLVar1;
	LevelSurfaceMap **ppLVar2;
	float10 fVar3;
	
	ppLVar2 = (LevelSurfaceMap **)std::malloc(0x3c);
	if (ppLVar2 != NULL) {
		ppLVar2[1] = (LevelSurfaceMap *)*param_2;
		ppLVar2[2] = (LevelSurfaceMap *)param_2[1];
		ppLVar2[3] = (LevelSurfaceMap *)param_2[2];
		pLVar1 = (LevelSurfaceMap *)param_2[3];
		ppLVar2[5] = (LevelSurfaceMap *)param_3;
		ppLVar2[4] = pLVar1;
		fVar3 = lego::game::SurfaceMap_GetFloat10(param_1);
		ppLVar2[6] = (LevelSurfaceMap *)(float)fVar3;
		*ppLVar2 = param_1;
		return (int *)ppLVar2;
	}
	return (int *)NULL;
}



void __cdecl FUN_0045ddb0(undefined *param_1)
{
	std::free(param_1);
	return;
}



void __cdecl FUN_0045ddc0(int param_1,float *param_2,float param_3,float param_4)
{
	float fVar1;
	longlong lVar2;
	float local_20;
	float local_1c;
	float local_18;
	undefined4 local_14;
	Rect2F local_10;
	
	local_14 = 0;
	local_20 = *param_2;
	local_1c = param_2[1];
	local_18 = param_3;
	lego::draw::Draw_SurfaceLock_GetTranslation(&local_10);
	lego::draw::Draw_SurfaceLock_Translate((Rect2F *)(param_1 + 4));
	FUN_0045ec00(param_1,&local_20);
	fVar1 = param_4 * 0.7 - -0.3;
	lVar2 = __ftol((float10)local_18);
	lego::draw::Draw_SurfaceLock_FUN_00486650
						(&local_20,(int)lVar2,(int)lVar2 * 2,fVar1 * 0.7,fVar1 * 0.9,fVar1,0);
	lego::draw::Draw_SurfaceLock_Translate(&local_10);
	return;
}



// WARNING: Function: _alloca4k replaced with injection: alloca_probe

void __cdecl FUN_0045de80(LiveObject *param_1,ResourceData **param_2)
{
	BuildingData *pBVar1;
	BuildingData *pBVar2;
	ResourceData *pRVar3;
	ObjectType OVar4;
	int iVar5;
	BOOL BVar6;
	LevelSurfaceMap *pLVar7;
	uint uVar8;
	BuildingData **ppBVar9;
	uint uVar10;
	BuildingData **ppBVar11;
	int iVar12;
	BuildingData **ppBVar13;
	undefined4 *puVar14;
	float *pfVar15;
	float *pfVar16;
	float *pfVar17;
	BuildingData **ppBVar18;
	undefined *puVar19;
	float *pfVar20;
	uint uStack46860;
	uint uStack46856;
	uint uStack46852;
	uint uStack46848;
	BuildingData **ppBStack46844;
	Vector3F VStack46840;
	uint uStack46828;
	uint uStack46824;
	int iStack46820;
	int iStack46816;
	float fStack46812;
	float fStack46808;
	Vector3F VStack46796;
	Vector3F VStack46784;
	Vector3F VStack46772;
	undefined4 uStack46760;
	undefined4 uStack46756;
	undefined4 uStack46752;
	undefined4 uStack46748;
	float fStack46744;
	undefined4 uStack46740;
	undefined4 uStack46736;
	undefined4 uStack46732;
	float fStack46728;
	float fStack46724;
	undefined4 uStack46720;
	undefined4 uStack46716;
	undefined4 uStack46712;
	float fStack46708;
	undefined4 uStack46704;
	undefined4 uStack46700;
	undefined4 uStack46696;
	undefined4 uStack46692;
	undefined4 uStack46688;
	undefined4 uStack46684;
	float fStack46680;
	undefined4 uStack46676;
	undefined4 uStack46672;
	undefined4 uStack46668;
	float fStack46664;
	float fStack46660;
	undefined4 uStack46656;
	undefined4 uStack46652;
	undefined4 uStack46648;
	float fStack46644;
	undefined4 uStack46640;
	undefined4 uStack46636;
	float afStack46632 [2];
	undefined auStack46624 [24];
	float fStack46600;
	undefined4 uStack46596;
	Rect2F RStack46592;
	undefined auStack46576 [4];
	float afStack46572 [23];
	undefined auStack46480 [4];
	float afStack46476 [39];
	undefined auStack46320 [164];
	float afStack46156 [59];
	undefined auStack45920 [720];
	BuildingData *apBStack45200 [400];
	BuildingData *apBStack43600 [400];
	undefined auStack42000 [8];
	BuildingData *apBStack41992 [10497];
	undefined4 uStack4;
	
	uStack4 = 0x45de8a;
	param_1->other = *param_2;
	param_1->upgrade = (UpgradeData *)param_2[1];
	iVar12 = 0;
	uVar8 = 0;
	uStack46856 = 0;
	uStack46860 = 0;
	uStack46824 = 0;
	uStack46828 = 0;
	VStack46840.x =
			 (((float)param_1->vehicle * 0.5) / (float)param_1->rockMonster) * (float)param_1->building;
	VStack46840.y =
			 (((float)param_1->miniFigure * 0.5) / (float)param_1->rockMonster) * (float)param_1->building
	;
	FUN_0044fad0((int *)param_1->objType,(float)*param_2 - VStack46840.x,
							 VStack46840.y + (float)param_2[1],(int *)&uStack46828,(int *)&uStack46824);
	FUN_0044fad0((int *)param_1->objType,(float)*param_2 + VStack46840.x,
							 (float)param_2[1] - VStack46840.y,&iStack46820,&iStack46816);
	lego::draw::Draw_SurfaceLock_GetTranslation(&RStack46592);
	lego::draw::Draw_SurfaceLock_Translate((Rect2F *)&param_1->objIndex);
	uStack46852 = uStack46824;
	uStack46848 = uStack46828;
	iVar5 = iStack46820;
	if ((int)uStack46824 <= iStack46816) {
		do {
			uVar10 = uStack46848;
			if ((int)uStack46848 <= iVar5) {
				ppBStack46844 = apBStack45200 + uVar8 * 2 + 1;
				ppBVar11 = apBStack45200 + uVar8 * 2;
				ppBVar9 = apBStack43600 + uVar8 * 2 + 1;
				ppBVar18 = apBStack43600 + uVar8 * 2;
				ppBVar13 = apBStack41992 + iVar12 * 7;
				do {
					iVar5 = FUN_0045eca0((int)(ppBVar13 + -2),uStack46848,uStack46852);
					if (iVar5 != 0) {
						iVar5 = lego::unk::Lego_GetDat_004ded1c();
						if (((iVar5 != 0) && (uStack46848 == lego::globals::g_UnkStructF_a_INT)) &&
							 (uStack46852 == lego::globals::g_UnkStructF_b_INT)) {
							ppBVar13[2] = (BuildingData *)0x3f800000;
							ppBVar13[3] = NULL;
							ppBVar13[4] = NULL;
						}
						OVar4 = param_1->objType;
						pBVar1 = param_1->building;
						pBVar2 = param_1->building;
						ppBVar13[-2] = (BuildingData *)
													 ((float)uStack46848 * (float)param_1->building + *(float *)(OVar4 + 0x18)
													 );
						ppBVar13[-1] = (BuildingData *)
													 (-((float)uStack46852 * (float)pBVar2) + *(float *)(OVar4 + 0x1c));
						ppBVar13[1] = pBVar1;
						*ppBVar13 = pBVar1;
						FUN_0045ec00((int)param_1,(float *)(ppBVar13 + -2));
						*ppBVar13 = (BuildingData *)((float)*ppBVar13 - 1.0);
						ppBVar13[1] = (BuildingData *)((float)ppBVar13[1] - 1.0);
						BVar6 = lego::game::Level_GetBlockFlags1_20(uStack46848,uStack46852);
						if ((BVar6 != 0) && (uStack46860 < 200)) {
							pBVar1 = *ppBVar13;
							pBVar2 = ppBVar13[-1];
							*ppBVar18 = ppBVar13[-2];
							*ppBVar9 = pBVar2;
							pBVar1 = (BuildingData *)(((float)pBVar1 - 1.0) + (float)ppBVar13[-2]);
							*ppBVar11 = pBVar1;
							ppBVar18[2] = pBVar1;
							*ppBStack46844 = pBVar2;
							ppBVar9[2] = pBVar2;
							ppBVar11[2] = pBVar1;
							pBVar2 = (BuildingData *)(((float)ppBVar13[1] - 1.0) + (float)ppBVar13[-1]);
							ppBStack46844[2] = pBVar2;
							ppBVar18[4] = pBVar1;
							ppBVar9[4] = pBVar2;
							ppBVar11[4] = ppBVar13[-2];
							ppBStack46844[4] = pBVar2;
							ppBVar18[6] = ppBVar13[-2];
							ppBVar9[6] = pBVar2;
							ppBVar11[6] = ppBVar13[-2];
							ppBStack46844[6] = ppBVar13[-1];
							uStack46860 += 4;
							ppBVar18 = ppBVar18 + 8;
							ppBVar9 = ppBVar9 + 8;
							ppBVar11 = ppBVar11 + 8;
							ppBStack46844 = ppBStack46844 + 8;
						}
						uStack46856 += 1;
						ppBVar13 = ppBVar13 + 7;
					}
					uStack46848 += 1;
					uVar10 = uStack46828;
					iVar5 = iStack46820;
					uVar8 = uStack46860;
					iVar12 = uStack46856;
				} while ((int)uStack46848 <= iStack46820);
			}
			uStack46852 += 1;
			uStack46848 = uVar10;
		} while ((int)uStack46852 <= iStack46816);
	}
	lego::draw::Draw_FillSurface((Rect2F *)&param_1->objIndex,0);
	lego::draw::Draw_SurfaceLock_FUN_004864d0(auStack42000,iVar12,0);
	lego::draw::Draw_SurfaceLock_FUN_004862b0
						(apBStack43600,apBStack45200,uVar8,lego::globals::g_UnkVector3F_30_TABLE[0].x,
						 lego::globals::g_UnkVector3F_30_TABLE[0].y,lego::globals::g_UnkVector3F_30_TABLE[0].z,0
						);
	param_1->routeptr_24 = (void *)((float)*param_2 - VStack46840.x);
	param_1->routingBlocksTotal = (uint)((float)param_2[1] - VStack46840.y);
	param_1->routingBlocksCurrent = (uint)((float)*param_2 + VStack46840.x);
	pRVar3 = param_2[1];
	param_1->floats_34[0] = (float)auStack42000;
	param_1->floats_34[1] = 0.0;
	param_1->value_30 = (int)(VStack46840.y + (float)pRVar3);
	FUN_00437a70(FUN_0045e720,param_1);
	lego::draw::Draw_SurfaceLock_FUN_004864d0(param_1->floats_34[0],(int)param_1->floats_34[1],0);
	if (lego::globals::g_Game.unkbool_308 == 1) {
		uStack46760 = 0;
		uStack46756 = 0;
		uStack46752 = 0;
		uStack46748 = 0x3f800000;
		iVar5 = lego::main::Config_GetResolutionWidth();
		uStack46740 = 0;
		fStack46744 = (float)iVar5;
		uStack46736 = 0;
		uStack46732 = 0x3f800000;
		iVar5 = lego::main::Config_GetResolutionWidth();
		fStack46728 = (float)iVar5;
		iVar5 = lego::main::Config_GetResolutionHeight();
		uStack46720 = 0;
		fStack46724 = (float)iVar5;
		uStack46716 = 0x3f800000;
		uStack46712 = 0;
		iVar5 = lego::main::Config_GetResolutionHeight();
		uStack46704 = 0;
		fStack46708 = (float)iVar5;
		uStack46700 = 0x3f800000;
		uStack46696 = 0;
		uStack46692 = 0;
		uStack46688 = 0x3f800000;
		uStack46684 = 0x3f800000;
		iVar5 = lego::main::Config_GetResolutionWidth();
		uStack46676 = 0;
		fStack46680 = (float)iVar5;
		uStack46672 = 0x3f800000;
		uStack46668 = 0x3f800000;
		iVar5 = lego::main::Config_GetResolutionWidth();
		fStack46664 = (float)iVar5;
		iVar5 = lego::main::Config_GetResolutionHeight();
		uStack46656 = 0x3f800000;
		fStack46660 = (float)iVar5;
		uStack46652 = 0x3f800000;
		uStack46648 = 0;
		iVar5 = lego::main::Config_GetResolutionHeight();
		uStack46640 = 0x3f800000;
		fStack46644 = (float)iVar5;
		uStack46636 = 0x3f800000;
		VStack46784.x = 0.0;
		VStack46784.y = 0.0;
		pLVar7 = lego::game::GetSurfaceMap();
		VStack46772.x = 0.0;
		puVar19 = auStack46576;
		VStack46784.z = pLVar7->float_20 * 0.5;
		VStack46772.y = 0.0;
		VStack46772.z = -1.0;
		puVar14 = &uStack46760;
		iVar5 = 8;
		do {
			FUN_00477550((int)lego::globals::g_Game.ptr_1c,puVar19,puVar14);
			puVar14 = puVar14 + 4;
			puVar19 = puVar19 + 0xc;
			iVar5 += -1;
		} while (iVar5 != 0);
		uStack46856 = 0;
		uVar8 = lego::globals::g_UnkStructF10_a_COUNT;
		do {
			uVar10 = 0;
			if (uVar8 != 0) {
				puVar14 = &lego::globals::g_UnkStructF10_a_TABLE[0].field_8;
				puVar19 = auStack45920 + uStack46856 * 0x1e0;
				do {
					if (uStack46856 == 0) {
						puVar14[0x50] = 0;
						*puVar14 = 0;
					}
					else {
						puVar14[0x50] = 0x3f800000;
						*puVar14 = 0x3f800000;
					}
					FUN_00477550((int)lego::globals::g_Game.ptr_1c,puVar19 + -0xf0,puVar14 + -2);
					FUN_00477550((int)lego::globals::g_Game.ptr_1c,puVar19,puVar14 + 0x4e);
					uVar10 += 1;
					puVar19 = puVar19 + 0xc;
					puVar14 = puVar14 + 4;
					uVar8 = lego::globals::g_UnkStructF10_a_COUNT;
				} while (uVar10 < lego::globals::g_UnkStructF10_a_COUNT);
			}
			uStack46856 += 1;
		} while (uStack46856 < 2);
		pfVar15 = afStack46156;
		pfVar17 = afStack46476;
		uStack46860 = 2;
		do {
			uVar10 = 0;
			pfVar16 = pfVar15;
			pfVar20 = pfVar17;
			if (uVar8 != 0) {
				do {
					VStack46840.x = pfVar16[0x77] - pfVar16[-1];
					VStack46840.y = pfVar16[0x78] - *pfVar16;
					VStack46840.z = pfVar16[0x79] - pfVar16[1];
					lego::math::Vector3_Unk_FUN_00479ba0
										(&VStack46796,(Vector3F *)(pfVar16 + -1),&VStack46840,&VStack46784,&VStack46772)
					;
					fStack46812 = VStack46796.x;
					fStack46808 = VStack46796.y;
					FUN_0045ec00((int)param_1,&fStack46812);
					pfVar20[-1] = fStack46812;
					*pfVar20 = fStack46808;
					uVar10 += 1;
					pfVar16 = pfVar16 + 3;
					pfVar20 = pfVar20 + 2;
					uVar8 = lego::globals::g_UnkStructF10_a_COUNT;
				} while (uVar10 < lego::globals::g_UnkStructF10_a_COUNT);
			}
			pfVar17 = pfVar17 + 0x28;
			pfVar15 = pfVar15 + 0x3c;
			uStack46860 += -1;
		} while (uStack46860 != 0);
		lego::draw::Draw_SurfaceLock_FUN_004862b0(auStack46480,auStack46320,uVar8,1.0,1.0,1.0,2);
		pfVar15 = afStack46632 + 1;
		pfVar17 = afStack46572;
		iVar5 = 4;
		do {
			VStack46840.x = pfVar17[0xb] - pfVar17[-1];
			VStack46840.y = pfVar17[0xc] - *pfVar17;
			VStack46840.z = pfVar17[0xd] - pfVar17[1];
			lego::math::Vector3_Unk_FUN_00479ba0
								(&VStack46796,(Vector3F *)(pfVar17 + -1),&VStack46840,&VStack46784,&VStack46772);
			fStack46812 = VStack46796.x;
			fStack46808 = VStack46796.y;
			FUN_0045ec00((int)param_1,&fStack46812);
			pfVar15[-1] = fStack46812;
			*pfVar15 = fStack46808;
			pfVar17 = pfVar17 + 3;
			pfVar15 = pfVar15 + 2;
			iVar5 += -1;
		} while (iVar5 != 0);
		fStack46600 = afStack46632[0];
		uStack46596 = afStack46632[1];
		lego::draw::Draw_SurfaceLock_FUN_004862b0(afStack46632,auStack46624,4,0.7,0.7,0.7,2);
	}
	lego::draw::Draw_SurfaceLock_Translate(&RStack46592);
	return;
}



uint __cdecl FUN_0045e6c0(int *param_1)
{
	int iVar1;
	ObjectStatsFlags2 OVar2;
	
	iVar1 = *param_1;
	if ((((((iVar1 != 0xe) && (iVar1 != 5)) && (iVar1 != 8)) && ((iVar1 != 0xd && (iVar1 != 0x10))))
			&& ((iVar1 != 0x11 && ((iVar1 != 0x13 && (iVar1 != 9)))))) &&
		 ((iVar1 != 0x12 && ((iVar1 != 4 && (iVar1 != 0xc)))))) {
		OVar2 = lego::game::LiveObject_GetStatsFlags2((LiveObject *)param_1);
		return ~OVar2 >> 0x1d & 1;
	}
	return 0;
}



undefined4 __cdecl FUN_0045e720(int *param_1,int param_2)
{
	int iVar1;
	float fVar2;
	uint uVar3;
	float local_8;
	float local_4;
	
	uVar3 = FUN_0045e6c0(param_1);
	if (uVar3 == 0) {
		return 0;
	}
	lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_8,&local_4);
	if ((((*(float *)(param_2 + 0x24) <= local_8) &&
			 ((ushort)((ushort)(local_8 < *(float *)(param_2 + 0x2c)) << 8 |
								(ushort)(local_8 == *(float *)(param_2 + 0x2c)) << 0xe) != 0)) &&
			(*(float *)(param_2 + 0x28) <= local_4)) &&
		 ((ushort)((ushort)(local_4 < *(float *)(param_2 + 0x30)) << 8 |
							(ushort)(local_4 == *(float *)(param_2 + 0x30)) << 0xe) != 0)) {
		iVar1 = *param_1;
		if (iVar1 == 3) {
			*(float *)(*(int *)(param_2 + 0x34) + 0x10 + *(int *)(param_2 + 0x38) * 0x1c) =
					 lego::globals::g_UnkVector3F_30_TABLE[15].x;
			*(float *)(*(int *)(param_2 + 0x34) + 0x14 + *(int *)(param_2 + 0x38) * 0x1c) =
					 lego::globals::g_UnkVector3F_30_TABLE[15].y;
			*(float *)(*(int *)(param_2 + 0x34) + 0x18 + *(int *)(param_2 + 0x38) * 0x1c) =
					 lego::globals::g_UnkVector3F_30_TABLE[15].z;
			fVar2 = 0.3333333;
		}
		else {
			if ((iVar1 == 6) || (iVar1 == 7)) {
				*(float *)(*(int *)(param_2 + 0x34) + 0x10 + *(int *)(param_2 + 0x38) * 0x1c) =
						 lego::globals::g_UnkVector3F_30_TABLE[16].x;
				*(float *)(*(int *)(param_2 + 0x34) + 0x14 + *(int *)(param_2 + 0x38) * 0x1c) =
						 lego::globals::g_UnkVector3F_30_TABLE[16].y;
				*(float *)(*(int *)(param_2 + 0x34) + 0x18 + *(int *)(param_2 + 0x38) * 0x1c) =
						 lego::globals::g_UnkVector3F_30_TABLE[16].z;
				fVar2 = 0.25;
			}
			else {
				*(float *)(*(int *)(param_2 + 0x34) + 0x10 + *(int *)(param_2 + 0x38) * 0x1c) =
						 lego::globals::g_UnkVector3F_30_TABLE[14].x;
				*(float *)(*(int *)(param_2 + 0x34) + 0x14 + *(int *)(param_2 + 0x38) * 0x1c) =
						 lego::globals::g_UnkVector3F_30_TABLE[14].y;
				*(float *)(*(int *)(param_2 + 0x34) + 0x18 + *(int *)(param_2 + 0x38) * 0x1c) =
						 lego::globals::g_UnkVector3F_30_TABLE[14].z;
				fVar2 = 0.3333333;
			}
		}
		*(float *)(*(int *)(param_2 + 0x34) + *(int *)(param_2 + 0x38) * 0x1c) =
				 local_8 - fVar2 * 0.5 * *(float *)(param_2 + 0x18);
		*(float *)(*(int *)(param_2 + 0x34) + 4 + *(int *)(param_2 + 0x38) * 0x1c) =
				 fVar2 * 0.5 * *(float *)(param_2 + 0x18) + local_4;
		*(float *)(*(int *)(param_2 + 0x34) + 8 + *(int *)(param_2 + 0x38) * 0x1c) =
				 fVar2 * *(float *)(param_2 + 0x18);
		*(float *)(*(int *)(param_2 + 0x34) + 0xc + *(int *)(param_2 + 0x38) * 0x1c) =
				 fVar2 * *(float *)(param_2 + 0x18);
		FUN_0045ec00(param_2,(float *)(*(int *)(param_2 + 0x34) + *(int *)(param_2 + 0x38) * 0x1c));
		*(int *)(param_2 + 0x38) = *(int *)(param_2 + 0x38) + 1;
	}
	return 0;
}



undefined4 __cdecl FUN_0045e920(int param_1,uint param_2,uint param_3)
{
	if ((((*(float *)(param_1 + 4) <= (float)(ulonglong)param_2) &&
			 ((float)(ulonglong)param_2 < *(float *)(param_1 + 0xc) + *(float *)(param_1 + 4))) &&
			(*(float *)(param_1 + 8) <= (float)(ulonglong)param_3)) &&
		 ((float)(ulonglong)param_3 < *(float *)(param_1 + 0x10) + *(float *)(param_1 + 8))) {
		return 1;
	}
	return 0;
}



undefined4 __cdecl
FUN_0045e990(int **param_1,uint param_2,uint param_3,float *param_4,int *param_5,int *param_6)
{
	float fVar1;
	float fVar2;
	BOOL BVar3;
	
	fVar1 = (float)(ulonglong)param_2;
	if (((float)param_1[1] <= fVar1) &&
		 ((ushort)((ushort)((float)param_1[3] + (float)param_1[1] < fVar1) << 8 |
							(ushort)((float)param_1[3] + (float)param_1[1] == fVar1) << 0xe) == 0)) {
		fVar2 = (float)(ulonglong)param_3;
		if (((float)param_1[2] <= fVar2) &&
			 ((ushort)((ushort)((float)param_1[4] + (float)param_1[2] < fVar2) << 8 |
								(ushort)((float)param_1[4] + (float)param_1[2] == fVar2) << 0xe) == 0)) {
			fVar2 = (float)param_1[6] *
							(((float)param_1[2] + (float)param_1[3] * 0.5) - fVar2) * (1.0 / (float)param_1[5]) +
							(float)param_1[8];
			fVar1 = (float)param_1[7] +
							-((float)param_1[6] *
							 (((float)param_1[1] + (float)param_1[3] * 0.5) - fVar1) * (1.0 / (float)param_1[5]));
			BVar3 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
												((LevelSurfaceMap *)*param_1,fVar1,fVar2,param_5,param_6);
			if (BVar3 != 0) {
				if (param_4 != NULL) {
					*param_4 = fVar1;
					param_4[1] = fVar2;
				}
				return 1;
			}
		}
	}
	return 0;
}



undefined4 __cdecl
FUN_0045eae0(int **param_1,uint param_2,uint param_3,undefined4 *param_4,undefined4 *param_5)
{
	int iVar1;
	BOOL BVar2;
	int local_18;
	int local_14;
	LiveObject *local_10;
	float local_c;
	char *local_8;
	VehicleData *local_4;
	
	local_c = 0.0;
	local_8 = NULL;
	local_4 = NULL;
	local_10 = NULL;
	iVar1 = FUN_0045e990(param_1,param_2,param_3,&local_c,&local_18,&local_14);
	if (iVar1 != 0) {
		BVar2 = FUN_004329d0(local_18,local_14,1);
		if (BVar2 == 0) {
			local_4 = (VehicleData *)((float)param_1[6] * 0.1666667);
		}
		else {
			local_4 = (VehicleData *)param_1[6];
		}
		BVar2 = FUN_00437a70((LiveObjectPredicate *)&LAB_0045eba0,(LiveObject *)&local_10);
		if (BVar2 != 0) {
			*param_4 = local_10;
			if (param_5 != NULL) {
				lego::game::LiveObject_GetPosition(local_10,(float *)param_5,(float *)(param_5 + 1));
			}
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_0045ec00(int param_1,float *param_2)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	float fVar6;
	
	fVar1 = *(float *)(param_1 + 0xc);
	fVar2 = *(float *)(param_1 + 0x10);
	fVar3 = *(float *)(param_1 + 4);
	fVar4 = *(float *)(param_1 + 8);
	*param_2 = *param_2 - *(float *)(param_1 + 0x1c);
	param_2[1] = param_2[1] - *(float *)(param_1 + 0x20);
	*param_2 = (*(float *)(param_1 + 0x14) / *(float *)(param_1 + 0x18)) * *param_2;
	param_2[1] = (*(float *)(param_1 + 0x14) / *(float *)(param_1 + 0x18)) * param_2[1];
	param_2[2] = (*(float *)(param_1 + 0x14) / *(float *)(param_1 + 0x18)) * param_2[2];
	fVar5 = *(float *)(param_1 + 0x14);
	fVar6 = *(float *)(param_1 + 0x18);
	*param_2 = *param_2 + fVar1 * 0.5 + fVar3;
	param_2[1] = (fVar2 * 0.5 + fVar4) - param_2[1];
	param_2[3] = (fVar5 / fVar6) * param_2[3];
	return;
}



undefined4 __cdecl FUN_0045eca0(int param_1,uint param_2,uint param_3)
{
	uint y;
	BOOL BVar1;
	uint uVar2;
	Point2I local_8;
	
	y = param_3;
	uVar2 = param_2;
	local_8.x = param_2;
	local_8.y = param_3;
	FUN_00433260(param_2,param_3,&param_2);
	BVar1 = lego::game::Level_GetBlockFlags1_10Not8(uVar2,y);
	if (BVar1 == 0) {
		BVar1 = FUN_00432e70(uVar2,y);
		if ((BVar1 != 0) && (BVar1 = FUN_00432ec0(uVar2,y), BVar1 != 0)) {
			if (((lego::globals::g_Game.level)->blocks
					 [((lego::globals::g_Game.level)->dimensions).width * y + uVar2].flags1 & BLOCK1_HIDDEN)
					!= BLOCK1_NONE) {
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[29].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[29].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[29].z;
				return 1;
			}
			switch(param_2) {
			case 1:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[8].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[8].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[8].z;
				return 1;
			case 2:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[7].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[7].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[7].z;
				return 1;
			case 3:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[6].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[6].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[6].z;
				return 1;
			case 4:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[5].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[5].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[5].z;
				return 1;
			case 5:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[4].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[4].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[4].z;
				return 1;
			case 6:
				goto switchD_0045ef37_caseD_6;
			case 7:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[2].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[2].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[2].z;
				return 1;
			case 8:
switchD_0045ef37_caseD_8:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[24].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[24].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[24].z;
				return 1;
			case 9:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[27].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[27].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[27].z;
				return 1;
			case 10:
switchD_0045ef37_caseD_a:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[25].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[25].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[25].z;
				return 1;
			case 0xb:
switchD_0045ef37_caseD_b:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[26].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[26].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[26].z;
				return 1;
			default:
				goto switchD_0045ef37_caseD_b;
			}
		}
		BVar1 = lego::game::Level_GetBlockFlags1_8(uVar2,y);
		if (BVar1 == 0) {
			return 0;
		}
		if (param_2 != 6) {
			if (param_2 == 7) {
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[2].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[2].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[2].z;
				return 1;
			}
			if (param_2 == 9) {
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[27].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[27].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[27].z;
				return 1;
			}
			if (((lego::globals::g_Game.level)->blocks
					 [((lego::globals::g_Game.level)->dimensions).width * y + uVar2].flags1 &
					BLOCK1_UNK_100000) != BLOCK1_NONE) {
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[28].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[28].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[28].z;
				return 1;
			}
			BVar1 = lego::game::Level_IsBlockPowerPath(&local_8);
			if (BVar1 != 0) {
				uVar2 = FUN_004320a0((int *)&local_8);
				if (uVar2 != 0) {
					*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[22].x;
					*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[22].y;
					*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[22].z;
					return 1;
				}
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[23].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[23].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[23].z;
				return 1;
			}
			*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[1].x;
			*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[1].y;
			*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[1].z;
			return 1;
		}
switchD_0045ef37_caseD_6:
		*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[3].x;
		*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[3].y;
		*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[3].z;
	}
	else {
		uVar2 = FUN_00432b50(uVar2,y);
		if (uVar2 == 0) {
			if (true) {
				switch(param_2) {
				case 1:
					*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[13].x;
					*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[13].y;
					*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[13].z;
					return 1;
				case 2:
					*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[12].x;
					*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[12].y;
					*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[12].z;
					return 1;
				case 3:
					*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[11].x;
					*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[11].y;
					*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[11].z;
					return 1;
				case 4:
					*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[10].x;
					*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[10].y;
					*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[10].z;
					return 1;
				case 5:
					*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[9].x;
					*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[9].y;
					*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[9].z;
					return 1;
				case 8:
					goto switchD_0045ef37_caseD_8;
				case 10:
					goto switchD_0045ef37_caseD_a;
				case 0xb:
					goto switchD_0045ef37_caseD_b;
				}
			}
		}
		else {
			switch(param_2) {
			case 1:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[21].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[21].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[21].z;
				return 1;
			case 2:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[20].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[20].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[20].z;
				return 1;
			case 3:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[19].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[19].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[19].z;
				return 1;
			case 4:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[18].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[18].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[18].z;
				return 1;
			case 5:
				*(float *)(param_1 + 0x10) = lego::globals::g_UnkVector3F_30_TABLE[17].x;
				*(float *)(param_1 + 0x14) = lego::globals::g_UnkVector3F_30_TABLE[17].y;
				*(float *)(param_1 + 0x18) = lego::globals::g_UnkVector3F_30_TABLE[17].z;
				return 1;
			}
		}
	}
switchD_0045ef37_caseD_b:
	return 1;
}



undefined4 __cdecl lego::unk::Lego_TODORewardLoading(void)
{
	int iVar1;
	uint uVar2;
	undefined4 *puVar3;
	char **ppcVar4;
	char *local_28 [4];
	char *local_18;
	char *local_14;
	char *local_10;
	char *local_c;
	char *local_8;
	char *local_4;
	
	local_28[0] = "Crystals";
	local_28[1] = "Ore";
	local_28[2] = "Diggable";
	local_28[3] = "Constructions";
	local_18 = "Caverns";
	local_14 = "Figures";
	local_10 = "RockMonsters";
	local_c = "Oxygen";
	local_8 = "Timer";
	local_4 = "Score";
	PTR_00553990 = std::malloc(0x318c);
	puVar3 = (undefined4 *)PTR_00553990;
	for (iVar1 = 0xc63; iVar1 != 0; iVar1 += -1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	uVar2 = 0;
	ppcVar4 = local_28;
	*(int *)((int)PTR_00553990 + 0x1ce8) = (int)PTR_00553990 + 0x1cec;
	*(undefined4 *)((int)PTR_00553990 + 0x1ce4) = 10;
	do {
		std::sprintf((char *)(*(int *)((int)PTR_00553990 + 0x1ce8) + 4 + uVar2),"%s",*ppcVar4);
		uVar2 += 0x210;
		ppcVar4 = ppcVar4 + 1;
	} while (uVar2 < 0x14a0);
	uVar2 = 0;
	do {
		FUN_0045f6a0((uint *)(*(int *)((int)PTR_00553990 + 0x1ce8) + uVar2));
		uVar2 += 0x210;
	} while (uVar2 < 0x14a0);
	uVar2 = 0;
	do {
		FUN_0045f7f0((uint *)(*(int *)((int)PTR_00553990 + 0x1ce8) + uVar2));
		uVar2 += 0x210;
	} while (uVar2 < 0x14a0);
	uVar2 = 0;
	do {
		FUN_0045f8b0((uint *)(*(int *)((int)PTR_00553990 + 0x1ce8) + uVar2));
		uVar2 += 0x210;
	} while (uVar2 < 0x14a0);
	uVar2 = 0;
	do {
		Lego_RewardLoadFonts__0045f4f0(*(int *)((int)PTR_00553990 + 0x1ce8) + uVar2);
		uVar2 += 0x210;
	} while (uVar2 < 0x14a0);
	uVar2 = 0;
	do {
		FUN_0045f4b0(*(int *)((int)PTR_00553990 + 0x1ce8) + uVar2);
		uVar2 += 0x210;
	} while (uVar2 < 0x14a0);
	uVar2 = 0;
	do {
		FUN_0045f550((uint *)(*(int *)((int)PTR_00553990 + 0x1ce8) + uVar2));
		uVar2 += 0x210;
	} while (uVar2 < 0x14a0);
	return 1;
}



void __cdecl FUN_0045f4b0(int param_1)
{
	char *pcVar1;
	
	pcVar1 = lego::cfg::CFG_JoinPath
										 (lego::globals::g_Reward_CfgRootName,"Reward","Sounds",param_1 + 4,0);
	pcVar1 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar1);
	*(char **)(param_1 + 0x208) = pcVar1;
	return;
}



void __cdecl lego::unk::Lego_RewardLoadFonts__0045f4f0(int param_1)
{
	char *pcVar1;
	ImageFont *pIVar2;
	
	pcVar1 = cfg::CFG_JoinPath(globals::g_Reward_CfgRootName,"Reward","Fonts",param_1 + 4,0);
	pcVar1 = cfg::CFG_CopyPropertyValue(globals::g_Reward_LegoCfgRoot,pcVar1);
	if (pcVar1 != NULL) {
		pIVar2 = draw::Image_LoadFont(pcVar1);
		*(ImageFont **)(param_1 + 0x204) = pIVar2;
		if (pIVar2 != NULL) {
			return;
		}
	}
	*(ImageFont **)(param_1 + 0x204) = globals::g_Reward_Font;
	return;
}



void __cdecl FUN_0045f550(uint *param_1)
{
	char *pcVar1;
	uint uVar2;
	ImageBMP *image;
	char local_250 [64];
	char local_210 [128];
	char *local_190;
	char *local_18c;
	char *local_188;
	
	pcVar1 = lego::cfg::CFG_JoinPath
										 (lego::globals::g_Reward_CfgRootName,"Reward","BoxImages",param_1 + 1,0);
	pcVar1 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar1);
	if (pcVar1 == NULL) {
		if ((lego::globals::g_CMDLINE_FLAGS & CMD_REDUCEIMAGES) == CMD_NONE) {
			std::sprintf(local_250,"!%s",param_1 + 1);
			pcVar1 = lego::cfg::CFG_JoinPath
												 (lego::globals::g_Reward_CfgRootName,"Reward","Images",local_250,0);
			pcVar1 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar1);
		}
		if (pcVar1 == NULL) {
			return;
		}
	}
	lego::util::stringSplit(pcVar1,&local_190,"|");
	std::sprintf(local_210,"%s",local_190);
	uVar2 = std::atoi(local_18c);
	param_1[0x59] = uVar2;
	uVar2 = std::atoi(local_188);
	param_1[0x5a] = uVar2;
	image = lego::image::Image_LoadBMP(local_210,0,0);
	param_1[0x83] = (uint)image;
	if (image != NULL) {
		lego::image::Image_unkFogFromFloat__0047deb0(image,0.0,0.0,0.0,0.0,0.0,0.0);
		*param_1 = *param_1 | 0x40;
		std::free(pcVar1);
	}
	return;
}



void __cdecl FUN_0045f6a0(uint *param_1)
{
	char *pcVar1;
	uint uVar2;
	ImageBMP *image;
	char local_250 [64];
	char local_210 [128];
	char *local_190;
	char *local_18c;
	char *local_188;
	
	pcVar1 = lego::cfg::CFG_JoinPath
										 (lego::globals::g_Reward_CfgRootName,"Reward","Images",param_1 + 1,0);
	pcVar1 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar1);
	if (pcVar1 == NULL) {
		if ((lego::globals::g_CMDLINE_FLAGS & CMD_REDUCEIMAGES) == CMD_NONE) {
			std::sprintf(local_250,"!%s",param_1 + 1);
			pcVar1 = lego::cfg::CFG_JoinPath
												 (lego::globals::g_Reward_CfgRootName,"Reward","Images",local_250,0);
			pcVar1 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar1);
		}
		if (pcVar1 == NULL) {
			return;
		}
	}
	lego::util::stringSplit(pcVar1,&local_190,"|");
	std::sprintf(local_210,"%s",local_190);
	uVar2 = std::atoi(local_18c);
	param_1[0x57] = uVar2;
	uVar2 = std::atoi(local_188);
	param_1[0x58] = uVar2;
	image = lego::image::Image_LoadBMP(local_210,0,0);
	param_1[0x80] = (uint)image;
	if (image != NULL) {
		lego::image::Image_unkFogFromFloat__0047deb0(image,0.0,0.0,0.0,0.0,0.0,0.0);
		*param_1 = *param_1 | 2;
		std::free(pcVar1);
	}
	return;
}



void __cdecl FUN_0045f7f0(uint *param_1)
{
	char *pcVar1;
	uint uVar2;
	char *local_190;
	char *local_18c;
	char *local_188;
	
	pcVar1 = lego::cfg::CFG_JoinPath
										 (lego::globals::g_Reward_CfgRootName,"Reward","Text",param_1 + 1,0);
	pcVar1 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar1);
	if (pcVar1 != NULL) {
		lego::util::stringSplit(pcVar1,&local_190,"|");
		std::sprintf((char *)(param_1 + 0x15),"%s",local_190);
		lego::util::stringReplaceChar((char *)(param_1 + 0x15),'_',' ');
		uVar2 = std::atoi(local_18c);
		param_1[0x55] = uVar2;
		uVar2 = std::atoi(local_188);
		param_1[0x56] = uVar2;
		*param_1 = *param_1 | 0x31;
		std::free(pcVar1);
	}
	return;
}



void __cdecl FUN_0045f8b0(uint *param_1)
{
	char *pcVar1;
	uint uVar2;
	char local_250 [64];
	char local_210 [128];
	char *local_190;
	char *local_18c;
	char *local_188;
	char *local_184;
	char *local_180;
	
	pcVar1 = lego::cfg::CFG_JoinPath
										 (lego::globals::g_Reward_CfgRootName,"Reward","Flics",param_1 + 1,0);
	pcVar1 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar1);
	if (pcVar1 == NULL) {
		if ((lego::globals::g_CMDLINE_FLAGS & CMD_REDUCEFLICS) == CMD_NONE) {
			std::sprintf(local_250,"!%s",param_1 + 1);
			pcVar1 = lego::cfg::CFG_JoinPath
												 (lego::globals::g_Reward_CfgRootName,"Reward","Flics",local_250,0);
			pcVar1 = lego::cfg::CFG_CopyPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar1);
		}
		if (pcVar1 == NULL) {
			return;
		}
	}
	lego::util::stringSplit(pcVar1,&local_190,"|");
	std::sprintf(local_210,"%s",local_190);
	std::sprintf((char *)(param_1 + 0x5b),"%s",local_210);
	uVar2 = std::atoi(local_18c);
	param_1[0x7d] = uVar2;
	uVar2 = std::atoi(local_188);
	param_1[0x7e] = uVar2;
	uVar2 = std::atoi(local_184);
	param_1[0x7b] = uVar2;
	uVar2 = std::atoi(local_180);
	param_1[0x7c] = uVar2;
	*param_1 = *param_1 | 4;
	std::free(pcVar1);
	return;
}



void __cdecl FUN_0045fa10(void)
{
	byte *pbVar1;
	uint uVar2;
	
	uVar2 = 0;
	do {
		if ((*(byte *)(*(int *)((int)PTR_00553990 + 0x1ce8) + uVar2) & 2) != 0) {
			FUN_0045fa70(*(int *)((int)PTR_00553990 + 0x1ce8) + uVar2);
		}
		pbVar1 = (byte *)(*(int *)((int)PTR_00553990 + 0x1ce8) + uVar2);
		if ((*pbVar1 & 1) != 0) {
			FUN_0045fa90((int)pbVar1);
		}
		uVar2 += 0x210;
	} while (uVar2 < 0x14a0);
	std::free(PTR_00553990);
	return;
}



void __cdecl FUN_0045fa70(int param_1)
{
	lego::pool::ReservedPool_ImageBMP___Release(*(ImageBMP **)(param_1 + 0x200));
	return;
}



void __cdecl FUN_0045fa90(int param_1)
{
	lego::pool::ReservedPool_ImageFont___Release(*(ImageFont **)(param_1 + 0x204));
	return;
}



BOOL __cdecl lego::main::Main_LoadRewardGraphics(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	float10 fVar2;
	undefined4 uVar3;
	undefined4 uVar4;
	char *local_190;
	char *local_18c;
	
	game::GetLevel();
	uVar4 = 0;
	uVar3 = 0;
	globals::g_Reward_LegoCfgRoot = root;
	globals::g_Reward_CfgRootName = keyBasePath;
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","Wallpaper",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	globals::g_Reward_Wallpaper_bmp = image::Image_LoadBMP(pcVar1,uVar3,uVar4);
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","Display",0);
	globals::g_Reward_Display = cfg::CFG_GetPropertyBool(root,pcVar1);
	if (globals::g_Reward_Display == 2) {
		globals::g_Reward_Display = 0;
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","CentreText",0);
	globals::g_Reward_CentreText = cfg::CFG_GetPropertyBool(root,pcVar1);
	if (globals::g_Reward_CentreText == 2) {
		globals::g_Reward_CentreText = 0;
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","ScrollSpeed",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 == NULL) {
		pcVar1 = ____EMPTYSTR__;
	}
	else {
		pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","ScrollSpeed",0);
		pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	}
	fVar2 = std::atof(pcVar1);
	globals::g_Reward_ScrollSpeed = (float)fVar2;
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","VertSpacing",0);
	pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	if (pcVar1 == NULL) {
		pcVar1 = ____EMPTYSTR__;
	}
	else {
		pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","VertSpacing",0);
		pcVar1 = cfg::CFG_GetPropertyValue(root,pcVar1);
	}
	fVar2 = std::atof(pcVar1);
	globals::g_Reward_VertSpacing = (float)fVar2;
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","Font",0);
	globals::g_Reward_Font_filename = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","TitleFont",0);
	globals::g_Reward_TitleFont_filename = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","BackFont",0);
	globals::g_Reward_BackFont_filename = cfg::CFG_CopyPropertyValue(root,pcVar1);
	globals::g_Reward_Font = draw::Image_LoadFont(globals::g_Reward_Font_filename);
	globals::g_Reward_TitleFont = draw::Image_LoadFont(globals::g_Reward_TitleFont_filename);
	globals::g_Reward_BackFont = draw::Image_LoadFont(globals::g_Reward_BackFont_filename);
	Main_LoadRewardSaveAdvanceButtons(root,keyBasePath);
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","CompleteText",0);
	globals::g_Reward_CompleteText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","FailedText",0);
	globals::g_Reward_FailedText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","QuitText",0);
	globals::g_Reward_QuitText = cfg::CFG_CopyPropertyValue(root,pcVar1);
	pcVar1 = cfg::CFG_JoinPath(globals::g_Reward_CfgRootName,"Reward","TextPos",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(globals::g_Reward_LegoCfgRoot,pcVar1);
	if (pcVar1 != NULL) {
		util::stringSplit(pcVar1,&local_190,"|");
		globals::g_Reward_TextPos.x = std::atoi(local_190);
		globals::g_Reward_TextPos.y = std::atoi(local_18c);
	}
	return 1;
}



BOOL __cdecl lego::main::Main_LoadRewardSaveAdvanceButtons(CFGProperty *root,char *keyBasePath)
{
	char *pcVar1;
	int iVar2;
	char *local_190;
	char *local_18c;
	char *local_188;
	char *local_184;
	char *local_180;
	char *local_17c;
	
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","SaveButton",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		util::stringSplit(pcVar1,&local_190,"|");
		globals::g_Reward_SaveButton = image::Image_LoadBMP(local_190,0,0);
		if (globals::g_Reward_SaveButton != NULL) {
			globals::g_Reward_SaveButton_hi = image::Image_LoadBMP(local_18c,0,0);
			globals::g_Reward_SaveButton_in = image::Image_LoadBMP(local_188,0,0);
			globals::g_Reward_SaveButton_dim = image::Image_LoadBMP(local_184,0,0);
			iVar2 = std::atoi(local_180);
			globals::g_Reward_SaveButton_position.x = (float)iVar2;
			iVar2 = std::atoi(local_17c);
			globals::g_Reward_SaveButton_position.y = (float)iVar2;
			image::Image_unkFogFromFloat__0047deb0(globals::g_Reward_SaveButton,0.0,0.0,0.0,0.0,0.0,0.0);
			if (globals::g_Reward_SaveButton_hi != NULL) {
				image::Image_unkFogFromFloat__0047deb0
									(globals::g_Reward_SaveButton_hi,0.0,0.0,0.0,0.0,0.0,0.0);
			}
			if (globals::g_Reward_SaveButton_in != NULL) {
				image::Image_unkFogFromFloat__0047deb0
									(globals::g_Reward_SaveButton_in,0.0,0.0,0.0,0.0,0.0,0.0);
			}
		}
		std::free(pcVar1);
	}
	pcVar1 = cfg::CFG_JoinPath(keyBasePath,"Reward","AdvanceButton",0);
	pcVar1 = cfg::CFG_CopyPropertyValue(root,pcVar1);
	if (pcVar1 != NULL) {
		util::stringSplit(pcVar1,&local_190,"|");
		globals::g_Reward_AdvanceButton = image::Image_LoadBMP(local_190,0,0);
		if (globals::g_Reward_AdvanceButton != NULL) {
			globals::g_Reward_AdvanceButton_hi = image::Image_LoadBMP(local_18c,0,0);
			globals::g_Reward_AdvanceButton_in = image::Image_LoadBMP(local_188,0,0);
			globals::g_Reward_AdvanceButton_dim = image::Image_LoadBMP(local_184,0,0);
			iVar2 = std::atoi(local_180);
			globals::g_Reward_AdvanceButton_position.x = (float)iVar2;
			iVar2 = std::atoi(local_17c);
			globals::g_Reward_AdvanceButton_position.y = (float)iVar2;
			image::Image_unkFogFromFloat__0047deb0
								(globals::g_Reward_AdvanceButton,0.0,0.0,0.0,0.0,0.0,0.0);
			if (globals::g_Reward_AdvanceButton_hi != NULL) {
				image::Image_unkFogFromFloat__0047deb0
									(globals::g_Reward_AdvanceButton_hi,0.0,0.0,0.0,0.0,0.0,0.0);
			}
			if (globals::g_Reward_AdvanceButton_in != NULL) {
				image::Image_unkFogFromFloat__0047deb0
									(globals::g_Reward_AdvanceButton_in,0.0,0.0,0.0,0.0,0.0,0.0);
			}
		}
		std::free(pcVar1);
	}
	if ((globals::g_Reward_SaveButton != NULL) && (globals::g_Reward_AdvanceButton != NULL)) {
		return 1;
	}
	return 0;
}



undefined4 lego::main::Main_initFrontEndReward__00460060(void)
{
	LevelData *pLVar1;
	char *pcVar2;
	uint uVar3;
	int iVar4;
	undefined4 *puVar5;
	undefined4 *puVar6;
	float10 fVar7;
	
	pLVar1 = game::GetLevel();
	globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 = std::malloc(0x318c);
	puVar5 = (undefined4 *)globals::g_UNK_PTR_STRUCTSIZE_318c__00553994;
	for (iVar4 = 0xc63; iVar4 != 0; iVar4 += -1) {
		*puVar5 = 0;
		puVar5 = puVar5 + 1;
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Reward_CfgRootName,pLVar1->levelName,"Reward","Enable",0);
	uVar3 = cfg::CFG_GetPropertyBool(globals::g_Reward_LegoCfgRoot,pcVar2);
	*(uint *)globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 = uVar3;
										// WARNING: Load size is inaccurate
	if (*globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 == 2) {
		*(undefined4 *)globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 = 0;
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Reward_CfgRootName,pLVar1->levelName,"Reward","Modifier",0);
	pcVar2 = cfg::CFG_GetPropertyValue(globals::g_Reward_LegoCfgRoot,pcVar2);
	if (pcVar2 == NULL) {
		pcVar2 = ____EMPTYSTR__;
	}
	else {
		pcVar2 = cfg::CFG_JoinPath(globals::g_Reward_CfgRootName,pLVar1->levelName,"Reward","Modifier",0
															);
		pcVar2 = cfg::CFG_GetPropertyValue(globals::g_Reward_LegoCfgRoot,pcVar2);
	}
	iVar4 = std::atoi(pcVar2);
	*(int *)((int)globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 + 0x1c0) = iVar4;
	pcVar2 = cfg::CFG_JoinPath(globals::g_Reward_CfgRootName,"Reward","Timer",0);
	pcVar2 = cfg::CFG_GetPropertyValue(globals::g_Reward_LegoCfgRoot,pcVar2);
	if (pcVar2 == NULL) {
		pcVar2 = ____EMPTYSTR__;
	}
	else {
		pcVar2 = cfg::CFG_JoinPath(globals::g_Reward_CfgRootName,"Reward","Timer",0);
		pcVar2 = cfg::CFG_GetPropertyValue(globals::g_Reward_LegoCfgRoot,pcVar2);
	}
	fVar7 = std::atof(pcVar2);
	FLOAT_0055398c = (float)fVar7;
	if ((float10)0.0 == fVar7) {
		FLOAT_0055398c = 76.9375;
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Reward_CfgRootName,"Reward","DisplayText",0);
	globals::g_REWARD_DisplayText = cfg::CFG_GetPropertyBool(globals::g_Reward_LegoCfgRoot,pcVar2);
	if (globals::g_REWARD_DisplayText == 2) {
		globals::g_REWARD_DisplayText = 1;
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Reward_CfgRootName,"Reward","DisplayImages",0);
	globals::g_REWARD_DisplayImages = cfg::CFG_GetPropertyBool(globals::g_Reward_LegoCfgRoot,pcVar2);
	if (globals::g_REWARD_DisplayImages == 2) {
		globals::g_REWARD_DisplayImages = 1;
	}
	pcVar2 = cfg::CFG_JoinPath(globals::g_Reward_CfgRootName,"Reward","DisplayFlics",0);
	globals::g_REWARD_DisplayFlics = cfg::CFG_GetPropertyBool(globals::g_Reward_LegoCfgRoot,pcVar2);
	if (globals::g_REWARD_DisplayFlics == 2) {
		globals::g_REWARD_DisplayFlics = 1;
	}
	*(int *)((int)globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 + 0x1ce8) =
			 (int)globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 + 0x1cec;
	uVar3 = 0;
	*(undefined4 *)((int)globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 + 0x1ce4) = 10;
	do {
		puVar5 = (undefined4 *)(*(int *)((int)PTR_00553990 + 0x1ce8) + uVar3);
		puVar6 = (undefined4 *)
						 (*(int *)((int)globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 + 0x1ce8) + uVar3);
		uVar3 += 0x210;
		for (iVar4 = 0x84; iVar4 != 0; iVar4 += -1) {
			*puVar6 = *puVar5;
			puVar5 = puVar5 + 1;
			puVar6 = puVar6 + 1;
		}
	} while (uVar3 < 0x14a0);
	uVar3 = 0;
	do {
		FUN_00460360(*(int *)((int)globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 + 0x1ce8) + uVar3);
		uVar3 += 0x210;
	} while (uVar3 < 0x14a0);
	uVar3 = 0;
	do {
		FUN_00460400(*(int *)((int)globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 + 0x1ce8) + uVar3);
		uVar3 += 0x210;
	} while (uVar3 < 0x14a0);
	iVar4 = std::_stricmp(pLVar1->levelName,"Levels::Level03");
	if (iVar4 == 0) {
		*(undefined4 *)(*(int *)((int)globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 + 0x1ce8) + 0x868) =
				 1;
	}
	return 1;
}



void __cdecl FUN_00460360(int param_1)
{
	LevelData *pLVar1;
	char *pcVar2;
	float10 fVar3;
	
	pLVar1 = lego::game::GetLevel();
	pcVar2 = lego::cfg::CFG_JoinPath
										 (lego::globals::g_Reward_CfgRootName,pLVar1->levelName,"Reward","Importance",
											param_1 + 4,0);
	pcVar2 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = lego::cfg::CFG_JoinPath
											 (lego::globals::g_Reward_CfgRootName,pLVar1->levelName,"Reward","Importance",
												param_1 + 4,0);
		pcVar2 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar2);
		fVar3 = std::atof(pcVar2);
		*(float *)(param_1 + 0x24) = (float)fVar3;
		return;
	}
	fVar3 = std::atof(____EMPTYSTR__);
	*(float *)(param_1 + 0x24) = (float)fVar3;
	return;
}



void __cdecl FUN_00460400(int param_1)
{
	LevelData *pLVar1;
	char *pcVar2;
	int iVar3;
	
	pLVar1 = lego::game::GetLevel();
	pcVar2 = lego::cfg::CFG_JoinPath
										 (lego::globals::g_Reward_CfgRootName,pLVar1->levelName,"Reward","Quota",
											param_1 + 4,0);
	pcVar2 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar2);
	if (pcVar2 != NULL) {
		pcVar2 = lego::cfg::CFG_JoinPath
											 (lego::globals::g_Reward_CfgRootName,pLVar1->levelName,"Reward","Quota",
												param_1 + 4,0);
		pcVar2 = lego::cfg::CFG_GetPropertyValue(lego::globals::g_Reward_LegoCfgRoot,pcVar2);
		iVar3 = std::atoi(pcVar2);
		*(int *)(param_1 + 0x28) = iVar3;
		return;
	}
	iVar3 = std::atoi(____EMPTYSTR__);
	*(int *)(param_1 + 0x28) = iVar3;
	return;
}



void lego::unk::lego_freeStructSize_318c__004604a0(void)
{
	std::free(globals::g_UNK_PTR_STRUCTSIZE_318c__00553994);
	return;
}



void * __cdecl lego::unk::Lego_GetUnkStruct_318c__00553994(undefined4 param_1)
{
	return globals::g_UNK_PTR_STRUCTSIZE_318c__00553994;
}



void __cdecl FUN_004604c0(void)
{
	LevelData *pLVar1;
	
	pLVar1 = lego::game::GetLevel();
	if (pLVar1 == NULL) {
		return;
	}
	lego::unk::Lego_GetUnkStruct_318c__00553994(pLVar1->field_10);
	return;
}



void __cdecl lego::unk::Lego_UnkLevelImportantPilot___004604e0(void)
{
	LevelData *pLVar1;
	int iVar2;
	undefined4 *puVar3;
	undefined4 *puVar4;
	undefined4 local_198 [102];
	
	pLVar1 = game::GetLevel();
	if (pLVar1 == NULL) {
		return;
	}
	iVar2 = Lego_GetUnkStruct_318c__00553994(pLVar1->field_10);
	if (iVar2 == 0) {
		return;
	}
	puVar3 = (undefined4 *)FUN_00460550(local_198);
	puVar4 = UNKSTRUCT_198_005539c4;
	for (iVar2 = 0x66; iVar2 != 0; iVar2 += -1) {
		*puVar4 = *puVar3;
		puVar3 = puVar3 + 1;
		puVar4 = puVar4 + 1;
	}
	UINT_00556118 = game::Game_GetPilotPreviousLevel("Pilot",0);
	return;
}



void __cdecl FUN_00460550(undefined4 *param_1)
{
	int iVar1;
	uint objLevel;
	undefined4 *puVar2;
	uint objIndex;
	undefined4 local_198 [100];
	float local_8;
	float local_4;
	
	local_8 = 0.0;
	FUN_00437a70(FUN_004605d0,(LiveObject *)local_198);
	local_4 = 0.0;
	objIndex = 0;
	do {
		objLevel = 0;
		do {
			iVar1 = lego::game::LiveObject_GetPreviousLevel(OBJECT_BUILDING,objIndex,objLevel);
			objLevel += 1;
			local_4 = (float)((int)local_4 + iVar1);
		} while (objLevel < 0x10);
		objIndex += 1;
	} while (objIndex < 0xf);
	puVar2 = local_198;
	for (iVar1 = 0x66; iVar1 != 0; iVar1 += -1) {
		*param_1 = *puVar2;
		puVar2 = puVar2 + 1;
		param_1 = param_1 + 1;
	}
	return;
}



undefined4 __cdecl FUN_004605d0(LiveObject *liveObj,int param_2)
{
	int iVar1;
	char *pcVar2;
	int local_4;
	
	lego::game::LiveObject_GetTypeIndex(liveObj,(int *)&liveObj,&local_4);
	iVar1 = param_2;
	if (liveObj == (LiveObject *)&DAT_00000004) {
		pcVar2 = lego::game::Object_GetTypeName(OBJECT_BUILDING,local_4);
		*(char **)(iVar1 + *(int *)(iVar1 + 400) * 4) = pcVar2;
		*(int *)(iVar1 + 400) = *(int *)(iVar1 + 400) + 1;
	}
	return 0;
}



BOOL __cdecl FUN_00460620(void)
{
	undefined *puVar1;
	TerrainType TVar2;
	float fVar3;
	LevelData *pLVar4;
	int iVar5;
	LevelSurfaceMap *pLVar6;
	int iVar7;
	ImageBMP *pIVar8;
	uint uVar9;
	undefined4 *puVar10;
	IDirectDrawSurface4 **ppIVar11;
	undefined4 *puVar12;
	uint uVar13;
	char *out_buffer;
	float10 fVar14;
	ulonglong uVar15;
	uint local_30;
	uint local_28;
	uint local_24;
	int local_20;
	int local_1c;
	Point2I local_18;
	uint local_10;
	undefined4 uStack12;
	uint local_8;
	undefined4 uStack4;
	
	pLVar4 = lego::game::GetLevel();
	if (pLVar4 == NULL) {
		return 0;
	}
	iVar5 = lego::unk::Lego_GetUnkStruct_318c__00553994(pLVar4->field_10);
	if (iVar5 != 0) {
		if (BOOL_005539a0 != 0) {
			pIVar8 = &ImageBMP_005539a4;
			ppIVar11 = (IDirectDrawSurface4 **)(iVar5 + 8);
			for (iVar7 = 8; iVar7 != 0; iVar7 += -1) {
				*ppIVar11 = pIVar8->ddSurface;
				pIVar8 = (ImageBMP *)&pIVar8->width;
				ppIVar11 = ppIVar11 + 1;
			}
			*(undefined4 *)(iVar5 + 4) = 1;
		}
		*(undefined4 *)(iVar5 + 0x1d1c) = 0;
		*(undefined4 *)(iVar5 + 0x1f2c) = 0;
		*(float *)(iVar5 + 0x2140) = FLOAT_00555adc;
		*(float *)(iVar5 + 0x2560) = FLOAT_00555efc;
		*(undefined4 *)(iVar5 + 0x213c) = 0;
		*(undefined4 *)(iVar5 + 0x1b04) = 0;
		*(undefined4 *)(iVar5 + 0x1b08) = 0;
		iVar7 = FUN_00460bd0("Pilot",0,0);
		*(int *)(iVar5 + 0x2778) = iVar7;
		*(uint *)(iVar5 + 0x277c) = UINT_00556118;
		*(float *)(iVar5 + 0x2784) = FLOAT_00556120;
		uVar13 = UINT_00556324;
		*(uint *)(iVar5 + 0x2988) = UINT_00556324;
		*(int *)(iVar5 + 0x298c) = lego::globals::nerps::g_NERPs_RockMonstersDestroyed;
		fVar3 = (float)(ulonglong)(uVar13 * 100);
		if ((ushort)((ushort)(FLOAT_00556330 < fVar3) << 8 | (ushort)(FLOAT_00556330 == fVar3) << 0xe)
				!= 0) {
			fVar3 = FLOAT_00556330;
		}
		*(float *)(iVar5 + 0x2994) = fVar3;
		*(uint *)(iVar5 + 0x2990) = UINT_0055632c;
		puVar10 = UNKSTRUCT_198_005539c4;
		puVar12 = (undefined4 *)(iVar5 + 0x28);
		for (iVar7 = 0x66; iVar7 != 0; iVar7 += -1) {
			*puVar12 = *puVar10;
			puVar10 = puVar10 + 1;
			puVar12 = puVar12 + 1;
		}
		uVar13 = 0;
		*(undefined4 *)(iVar5 + 0x1c8) = 0;
		fVar3 = (lego::globals::g_Game.level)->oxygenLevel;
		*(undefined **)(iVar5 + 0x2b8c) = &DAT_42c80000;
		*(float *)(iVar5 + 0x2b90) = fVar3;
		*(float *)(iVar5 + 0x2da0) = FLOAT_0055673c;
		*(float *)(iVar5 + 0x2d9c) = FLOAT_00556738 / *(float *)(iVar5 + 0x2da0);
		pLVar6 = pLVar4->surfaceMap;
		if ((pLVar6->smallDimensions).width != 0) {
			do {
				uVar9 = 0;
				if ((pLVar6->smallDimensions).height != 0) {
					do {
						TVar2 = pLVar4->blocks[uVar9 * (pLVar4->dimensions).width + uVar13].terrain;
						*(int *)(iVar5 + 0x1c8) = *(int *)(iVar5 + 0x1c8) + 1;
						local_18.x = uVar13;
						local_18.y = uVar9;
						lego::game::Level_GetBlockCryOre
											(&local_18,(int *)&local_28,&local_1c,(int *)&local_24,&local_20);
						local_10 = local_28;
						uStack12 = 0;
						uStack4 = 0;
						*(float *)(iVar5 + 0x1d1c) = (float)(ulonglong)local_28 + *(float *)(iVar5 + 0x1d1c);
						local_8 = local_24;
						*(float *)(iVar5 + 0x1f2c) = (float)(ulonglong)local_24 + *(float *)(iVar5 + 0x1f2c);
						if ((*(byte *)&pLVar4->blocks[uVar9 * (pLVar4->dimensions).width + uVar13].flags1 & 8)
								== 0) {
							if (TVar2 != TERRAIN_IMMOVABLE) {
								*(float *)(iVar5 + 0x213c) = *(float *)(iVar5 + 0x213c) - -1.0;
								*(float *)(iVar5 + 0x1b04) = *(float *)(iVar5 + 0x1b04) - -1.0;
							}
							if (TVar2 == TERRAIN_CRYSTALSEAM) {
								*(float *)(iVar5 + 0x1d1c) = *(float *)(iVar5 + 0x1d1c) - -4.0;
							}
						}
						else {
							if ((TVar2 != TERRAIN_WATER_unused) && (TVar2 != TERRAIN_LAVA)) {
								*(float *)(iVar5 + 0x1b04) = *(float *)(iVar5 + 0x1b04) - -1.0;
							}
						}
						if ((pLVar4->blocks[uVar9 * (pLVar4->dimensions).width + uVar13].flags1 & 0x61100000) !=
								BLOCK1_NONE) {
							*(float *)(iVar5 + 0x1b08) = *(float *)(iVar5 + 0x1b08) - -1.0;
							*(float *)(iVar5 + 0x213c) = *(float *)(iVar5 + 0x213c) - -1.0;
						}
						uVar9 += 1;
					} while (uVar9 < (uint)(pLVar4->surfaceMap->smallDimensions).height);
				}
				pLVar6 = pLVar4->surfaceMap;
				uVar13 += 1;
			} while (uVar13 < (uint)(pLVar6->smallDimensions).width);
		}
		*(int *)(iVar5 + 0x1cc) = *(int *)(iVar5 + 0x1b8);
		*(undefined4 *)(iVar5 + 0x1d0) = *(undefined4 *)(iVar5 + 0x1bc);
		local_30 = 0;
		*(float *)(iVar5 + 0x1f2c) = *(float *)(iVar5 + 0x1f2c) - *(float *)(iVar5 + 0x213c) * -4.0;
		if (*(int *)(iVar5 + 0x1b8) != 0) {
			out_buffer = (char *)(iVar5 + 0x1d4);
			puVar10 = (undefined4 *)(iVar5 + 0x28);
			do {
				std::sprintf(out_buffer,"%s",*puVar10);
				local_30 += 1;
				puVar10 = puVar10 + 1;
				out_buffer = out_buffer + 0x40;
			} while (local_30 < *(uint *)(iVar5 + 0x1cc));
		}
		*(float *)(iVar5 + 0x1d20) = (float)(ulonglong)(uint)pLVar4->numCrystals;
		*(float *)(iVar5 + 0x1f30) = (float)(ulonglong)(uint)pLVar4->numOre;
		*(float *)(iVar5 + 0x276c) = (float)(ulonglong)*(uint *)(iVar5 + 0x2778);
		*(float *)(iVar5 + 0x2770) =
				 (float)(ulonglong)(*(uint *)(iVar5 + 0x2778) - *(int *)(iVar5 + 0x277c));
		*(undefined4 *)(iVar5 + 0x2980) = *(undefined4 *)(iVar5 + 0x2994);
		*(float *)(iVar5 + 0x297c) = (float)(ulonglong)(uint)(*(int *)(iVar5 + 0x2988) * 100);
		uVar13 = (*(uint *)(iVar5 + 0x1cc) - *(int *)(iVar5 + 0x1d0)) + 1;
		local_8 = *(uint *)(iVar5 + 0x2d94);
		*(float *)(iVar5 + 0x234c) = (float)(ulonglong)*(uint *)(iVar5 + 0x1cc);
		*(float *)(iVar5 + 0x2350) = (float)(ulonglong)uVar13;
		if (local_8 == 0) {
			*(undefined4 *)(iVar5 + 0x2da4) = 0;
			local_8 = uVar13;
		}
		else {
			fVar14 = (float10)*(float *)(iVar5 + 0x2da0) * (float10)0.04;
			uStack4 = 0;
			if ((float10)(ulonglong)local_8 <= fVar14) {
				*(undefined **)(iVar5 + 0x2da4) = &DAT_42c80000;
			}
			else {
				uVar15 = __ftol(((float10)100.0 / (float10)(ulonglong)local_8) * fVar14);
				*(float *)(iVar5 + 0x2da4) = (float)(uVar15 & 0xffffffff);
				if ((ushort)((ushort)(*(float *)(iVar5 + 0x2da4) < 100.0) << 8 |
										(ushort)(*(float *)(iVar5 + 0x2da4) == 100.0) << 0xe) == 0) {
					puVar1 = &DAT_42c80000;
				}
				else {
					puVar1 = *(undefined **)(iVar5 + 0x2da4);
				}
				*(undefined **)(iVar5 + 0x2da4) = puVar1;
				if ((float)puVar1 < 0.0) {
					puVar1 = NULL;
				}
				*(undefined **)(iVar5 + 0x2da4) = puVar1;
				local_8 = (uint)uVar15;
			}
		}
		if (*(uint *)(iVar5 + 0x2344) != 0) {
			uVar15 = 100 / (ulonglong)*(uint *)(iVar5 + 0x2344);
			local_8 = (uint)uVar15;
			*(float *)(iVar5 + 0x2354) = (float)uVar15 * *(float *)(iVar5 + 0x2350);
		}
		if (*(uint *)(iVar5 + 0x2554) != 0) {
			uVar15 = 100 / (ulonglong)*(uint *)(iVar5 + 0x2554);
			local_8 = (uint)uVar15;
			*(float *)(iVar5 + 0x2564) = (float)uVar15 * *(float *)(iVar5 + 0x2560);
		}
		uVar13 = *(uint *)(iVar5 + 0x1d14);
		if (uVar13 != 0) {
			*(float *)(iVar5 + 0x1d1c) = (float)(ulonglong)uVar13;
			local_8 = uVar13;
		}
		uStack4 = 0;
		uVar13 = 0;
		do {
			if (uVar13 != 0x1080) {
				iVar7 = *(int *)(iVar5 + 0x1ce8) + uVar13;
				if ((ushort)((ushort)(*(float *)(iVar7 + 0x38) < 100.0) << 8 |
										(ushort)(*(float *)(iVar7 + 0x38) == 100.0) << 0xe) == 0) {
					puVar1 = &DAT_42c80000;
				}
				else {
					puVar1 = *(undefined **)(iVar7 + 0x38);
				}
				*(undefined **)(iVar7 + 0x38) = puVar1;
				if ((float)puVar1 < 0.0) {
					puVar1 = NULL;
				}
				*(undefined **)(iVar7 + 0x38) = puVar1;
			}
			uVar13 += 0x210;
		} while (uVar13 < 0x14a0);
		FUN_00460c10();
		FUN_004611c0();
		puVar10 = &DATSTRUCT_318c_0055399c;
		for (iVar5 = 0xc63; iVar5 != 0; iVar5 += -1) {
			*puVar10 = 0;
			puVar10 = puVar10 + 1;
		}
		return 1;
	}
	return 0;
}



int __cdecl FUN_00460bd0(char *param_1,int param_2,int param_3)
{
	BOOL BVar1;
	int iVar2;
	ObjectType local_4;
	
	BVar1 = lego::game::Game_GetObjectByName(param_1,&local_4,(int *)&param_1,NULL);
	if (BVar1 != 0) {
		iVar2 = lego::game::LiveObject_GetOrSubLevelsTable(local_4,(int)param_1,param_2,param_3);
		return iVar2;
	}
	return 0;
}



undefined4 FUN_00460c10(void)
{
	float fVar1;
	float fVar2;
	undefined *puVar3;
	LevelData *pLVar4;
	int iVar5;
	uint uVar6;
	
	pLVar4 = lego::game::GetLevel();
	if (pLVar4 == NULL) {
		return 0;
	}
	iVar5 = lego::unk::Lego_GetUnkStruct_318c__00553994(pLVar4->field_10);
	if (iVar5 == 0) {
		return 0;
	}
	*(undefined4 *)(iVar5 + 0x2fb0) = 0;
	*(undefined4 *)(iVar5 + 0x2fac) = 0;
	*(undefined4 *)(iVar5 + 0x2fb4) = 0;
	puVar3 = &DAT_42c80000;
	if (*(float *)(iVar5 + 0x1d1c) != 0.0) {
		puVar3 = (undefined *)((100.0 / *(float *)(iVar5 + 0x1d1c)) * *(float *)(iVar5 + 0x1d20));
	}
	*(undefined **)(iVar5 + 0x1d24) = puVar3;
	if ((ushort)((ushort)((float)puVar3 < 100.0) << 8 | (ushort)((float)puVar3 == 100.0) << 0xe) == 0)
	{
		puVar3 = &DAT_42c80000;
	}
	*(undefined **)(iVar5 + 0x1d24) = puVar3;
	puVar3 = &DAT_42c80000;
	if (*(float *)(iVar5 + 0x1f2c) != 0.0) {
		puVar3 = (undefined *)((100.0 / *(float *)(iVar5 + 0x1f2c)) * *(float *)(iVar5 + 0x1f30));
	}
	*(undefined **)(iVar5 + 0x1f34) = puVar3;
	if ((ushort)((ushort)((float)puVar3 < 100.0) << 8 | (ushort)((float)puVar3 == 100.0) << 0xe) == 0)
	{
		puVar3 = &DAT_42c80000;
	}
	*(undefined **)(iVar5 + 0x1f34) = puVar3;
	puVar3 = &DAT_42c80000;
	if (*(float *)(iVar5 + 0x213c) != 0.0) {
		puVar3 = (undefined *)((100.0 / *(float *)(iVar5 + 0x213c)) * *(float *)(iVar5 + 0x2140));
	}
	*(undefined **)(iVar5 + 0x2144) = puVar3;
	if ((ushort)((ushort)((float)puVar3 < 100.0) << 8 | (ushort)((float)puVar3 == 100.0) << 0xe) == 0)
	{
		puVar3 = &DAT_42c80000;
	}
	*(undefined **)(iVar5 + 0x2144) = puVar3;
	puVar3 = &DAT_42c80000;
	if (*(float *)(iVar5 + 0x1b04) != 0.0) {
		puVar3 = (undefined *)((100.0 / *(float *)(iVar5 + 0x1b04)) * *(float *)(iVar5 + 0x1b08));
	}
	*(undefined **)(iVar5 + 0x1b0c) = puVar3;
	if ((ushort)((ushort)((float)puVar3 < 100.0) << 8 | (ushort)((float)puVar3 == 100.0) << 0xe) == 0)
	{
		puVar3 = &DAT_42c80000;
	}
	*(undefined **)(iVar5 + 0x1b0c) = puVar3;
	puVar3 = &DAT_42c80000;
	if (*(float *)(iVar5 + 0x2b8c) != 0.0) {
		puVar3 = (undefined *)((100.0 / *(float *)(iVar5 + 0x2b8c)) * *(float *)(iVar5 + 0x2b90));
	}
	*(undefined **)(iVar5 + 0x2b94) = puVar3;
	if ((ushort)((ushort)((float)puVar3 < 100.0) << 8 | (ushort)((float)puVar3 == 100.0) << 0xe) == 0)
	{
		puVar3 = &DAT_42c80000;
	}
	*(undefined **)(iVar5 + 0x2b94) = puVar3;
	puVar3 = &DAT_42c80000;
	if (*(float *)(iVar5 + 0x234c) != 0.0) {
		puVar3 = (undefined *)((100.0 / *(float *)(iVar5 + 0x234c)) * *(float *)(iVar5 + 0x2350));
	}
	*(undefined **)(iVar5 + 0x2354) = puVar3;
	if ((ushort)((ushort)((float)puVar3 < 100.0) << 8 | (ushort)((float)puVar3 == 100.0) << 0xe) == 0)
	{
		puVar3 = &DAT_42c80000;
	}
	*(undefined **)(iVar5 + 0x2354) = puVar3;
	puVar3 = &DAT_42c80000;
	if (*(float *)(iVar5 + 0x276c) != 0.0) {
		puVar3 = (undefined *)((100.0 / *(float *)(iVar5 + 0x276c)) * *(float *)(iVar5 + 0x2770));
	}
	*(undefined **)(iVar5 + 0x2774) = puVar3;
	if ((ushort)((ushort)((float)puVar3 < 100.0) << 8 | (ushort)((float)puVar3 == 100.0) << 0xe) == 0)
	{
		puVar3 = &DAT_42c80000;
	}
	*(undefined **)(iVar5 + 0x2774) = puVar3;
	puVar3 = &DAT_42c80000;
	if (*(float *)(iVar5 + 0x297c) != 0.0) {
		puVar3 = (undefined *)((100.0 / *(float *)(iVar5 + 0x297c)) * *(float *)(iVar5 + 0x2980));
	}
	*(undefined **)(iVar5 + 0x2984) = puVar3;
	if ((ushort)((ushort)((float)puVar3 < 100.0) << 8 | (ushort)((float)puVar3 == 100.0) << 0xe) == 0)
	{
		puVar3 = &DAT_42c80000;
	}
	*(undefined **)(iVar5 + 0x2984) = puVar3;
	uVar6 = 0;
	if (0.0 < *(float *)(iVar5 + 0x2760)) {
		do {
			uVar6 += 1;
			*(float *)(iVar5 + 0x2fac) = *(float *)(iVar5 + 0x2fac) - -100.0;
			*(float *)(iVar5 + 0x2fb0) = *(float *)(iVar5 + 0x2774) + *(float *)(iVar5 + 0x2fb0);
		} while ((float)(ulonglong)uVar6 < *(float *)(iVar5 + 0x2760));
	}
	uVar6 = 0;
	if (0.0 < *(float *)(iVar5 + 0x1d10)) {
		do {
			uVar6 += 1;
			*(float *)(iVar5 + 0x2fac) = *(float *)(iVar5 + 0x2fac) - -100.0;
			*(float *)(iVar5 + 0x2fb0) = *(float *)(iVar5 + 0x1d24) + *(float *)(iVar5 + 0x2fb0);
		} while ((float)(ulonglong)uVar6 < *(float *)(iVar5 + 0x1d10));
	}
	uVar6 = 0;
	if (0.0 < *(float *)(iVar5 + 0x2b80)) {
		do {
			uVar6 += 1;
			*(float *)(iVar5 + 0x2fac) = *(float *)(iVar5 + 0x2fac) - -100.0;
			*(float *)(iVar5 + 0x2fb0) = *(float *)(iVar5 + 0x2b94) + *(float *)(iVar5 + 0x2fb0);
		} while ((float)(ulonglong)uVar6 < *(float *)(iVar5 + 0x2b80));
	}
	uVar6 = 0;
	if (0.0 < *(float *)(iVar5 + 0x2340)) {
		do {
			uVar6 += 1;
			*(float *)(iVar5 + 0x2fac) = *(float *)(iVar5 + 0x2fac) - -100.0;
			*(float *)(iVar5 + 0x2fb0) = *(float *)(iVar5 + 0x2354) + *(float *)(iVar5 + 0x2fb0);
		} while ((float)(ulonglong)uVar6 < *(float *)(iVar5 + 0x2340));
	}
	uVar6 = 0;
	if (0.0 < *(float *)(iVar5 + 0x2550)) {
		do {
			uVar6 += 1;
			*(float *)(iVar5 + 0x2fac) = *(float *)(iVar5 + 0x2fac) - -100.0;
			*(float *)(iVar5 + 0x2fb0) = *(float *)(iVar5 + 0x2564) + *(float *)(iVar5 + 0x2fb0);
		} while ((float)(ulonglong)uVar6 < *(float *)(iVar5 + 0x2550));
	}
	uVar6 = 0;
	if (0.0 < *(float *)(iVar5 + 0x2d90)) {
		fVar1 = *(float *)(iVar5 + 0x2fac);
		fVar2 = *(float *)(iVar5 + 0x2fb0);
		do {
			uVar6 += 1;
			fVar1 = fVar1 - -100.0;
			fVar2 = (100.0 - *(float *)(iVar5 + 0x2da4)) + fVar2;
		} while ((float)(ulonglong)uVar6 < *(float *)(iVar5 + 0x2d90));
		*(float *)(iVar5 + 0x2fb0) = fVar2;
		*(float *)(iVar5 + 0x2fac) = fVar1;
	}
	uVar6 = 0;
	if (0.0 < *(float *)(iVar5 + 0x2970)) {
		do {
			uVar6 += 1;
			*(float *)(iVar5 + 0x2fac) = *(float *)(iVar5 + 0x2fac) - -100.0;
			*(float *)(iVar5 + 0x2fb0) = *(float *)(iVar5 + 0x2984) + *(float *)(iVar5 + 0x2fb0);
		} while ((float)(ulonglong)uVar6 < *(float *)(iVar5 + 0x2970));
	}
	if ((ushort)((ushort)(*(float *)(iVar5 + 0x2fb0) < *(float *)(iVar5 + 0x2fac)) << 8 |
							(ushort)(*(float *)(iVar5 + 0x2fb0) == *(float *)(iVar5 + 0x2fac)) << 0xe) == 0) {
		*(undefined4 *)(iVar5 + 0x2fb0) = *(undefined4 *)(iVar5 + 0x2fac);
	}
	if (*(float *)(iVar5 + 0x2fb0) < 0.0) {
		*(undefined4 *)(iVar5 + 0x2fb0) = 0;
	}
	puVar3 = &DAT_42c80000;
	if (*(float *)(iVar5 + 0x2fac) != 0.0) {
		puVar3 = (undefined *)((100.0 / *(float *)(iVar5 + 0x2fac)) * *(float *)(iVar5 + 0x2fb0));
	}
	*(undefined **)(iVar5 + 0x2fb4) = puVar3;
	if ((ushort)((ushort)((float)puVar3 < 100.0) << 8 | (ushort)((float)puVar3 == 100.0) << 0xe) == 0)
	{
		puVar3 = &DAT_42c80000;
	}
	*(undefined **)(iVar5 + 0x2fb4) = puVar3;
	puVar3 = (undefined *)((float)(ulonglong)*(uint *)(iVar5 + 0x1c0) + *(float *)(iVar5 + 0x2fb4));
	*(undefined **)(iVar5 + 0x2fb4) = puVar3;
	if ((ushort)((ushort)((float)puVar3 < 100.0) << 8 | (ushort)((float)puVar3 == 100.0) << 0xe) == 0)
	{
		puVar3 = &DAT_42c80000;
	}
	*(undefined **)(iVar5 + 0x2fb4) = puVar3;
	return 1;
}



BOOL __cdecl FUN_004611c0(void)
{
	LevelCompleteStatus LVar1;
	float fVar2;
	float fVar3;
	LevelData *pLVar4;
	int iVar5;
	char *pcVar6;
	
	fVar2 = (float)lego::globals::g_RESOLUTION.height;
	fVar3 = (float)lego::globals::g_RESOLUTION.width;
	pLVar4 = lego::game::GetLevel();
	if (pLVar4 == NULL) {
		return 0;
	}
	iVar5 = lego::unk::Lego_GetUnkStruct_318c__00553994(pLVar4->field_10);
	if (iVar5 != 0) {
		FUN_00461330();
		FUN_00462ba0(&DAT_00556b5c,0,fVar2 * 0.05,fVar3,fVar2 - fVar2 * 0.2857143,
								 lego::globals::g_Reward_ScrollSpeed);
		FUN_00462d70(DAT_00556b5c,0x43c80000);
		FUN_00462d80(DAT_00556b5c,0);
		FUN_00462c90(DAT_00556b5c,pLVar4->FullName,(int)lego::globals::g_Reward_TitleFont,0,
								 (float)lego::globals::g_RESOLUTION.height * 0.04,3);
		LVar1 = pLVar4->status;
		pcVar6 = lego::globals::g_Reward_CompleteText;
		if (((LVar1 == LEVELSTATUS_COMPLETE) ||
				(pcVar6 = lego::globals::g_Reward_FailedText, LVar1 == LEVELSTATUS_FAILED)) ||
			 (pcVar6 = lego::globals::g_Reward_QuitText, LVar1 == LEVELSTATUS_FAILED_CRYSTALS)) {
			pcVar6 = lego::util::formatText(pcVar6);
			std::sprintf(lego::globals::g_LevelStatusMessage_text,"%s",pcVar6);
		}
		FUN_00462c90(DAT_00556b5c,lego::globals::g_LevelStatusMessage_text,
								 (int)lego::globals::g_Reward_Font,0,lego::globals::g_Reward_VertSpacing,1);
		return 1;
	}
	return 0;
}



undefined4 FUN_00461330(void)
{
	char cVar1;
	LevelData *pLVar2;
	int iVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	uint uVar7;
	undefined4 *puVar8;
	char *pcVar9;
	char *pcVar10;
	undefined4 *puVar11;
	float10 fVar12;
	longlong lVar13;
	ulonglong uVar14;
	char *pcVar15;
	undefined **format;
	char local_100 [128];
	char local_80 [128];
	
	pLVar2 = lego::game::GetLevel();
	if (pLVar2 == NULL) {
		return 0;
	}
	iVar3 = lego::unk::Lego_GetUnkStruct_318c__00553994(pLVar2->field_10);
	if (iVar3 == 0) {
		return 0;
	}
	lVar13 = __ftol((float10)*(float *)(iVar3 + 0x1d24));
	*(int *)(iVar3 + 0x1d3c) = (int)lVar13;
	std::sprintf((char *)(iVar3 + 0x1dc0),"%d%%%%",(int)lVar13);
	lVar13 = __ftol((float10)*(float *)(iVar3 + 0x1f34));
	*(int *)(iVar3 + 0x1f4c) = (int)lVar13;
	std::sprintf((char *)(iVar3 + 0x1fd0),"%d%%%%",(int)lVar13);
	lVar13 = __ftol((float10)*(float *)(iVar3 + 0x2144));
	*(int *)(iVar3 + 0x215c) = (int)lVar13;
	std::sprintf((char *)(iVar3 + 0x21e0),"%d%%%%",(int)lVar13);
	lVar13 = __ftol((float10)*(float *)(iVar3 + 0x1b0c));
	*(int *)(iVar3 + 0x1b24) = (int)lVar13;
	std::sprintf((char *)(iVar3 + 0x1ba8),&DAT_004aa4c4,(int)lVar13);
	*(undefined4 *)(iVar3 + 0x236c) = *(undefined4 *)(iVar3 + 0x1cc);
	std::sprintf((char *)(iVar3 + 0x23f0),&DAT_004aa4c4,*(undefined4 *)(iVar3 + 0x1cc));
	lVar13 = __ftol((float10)*(float *)(iVar3 + 0x2564));
	*(int *)(iVar3 + 0x257c) = (int)lVar13;
	std::sprintf((char *)(iVar3 + 0x2600),"%d%%%%",(int)lVar13);
	lVar13 = __ftol((float10)*(float *)(iVar3 + 0x2774));
	*(int *)(iVar3 + 0x278c) = (int)lVar13;
	std::sprintf((char *)(iVar3 + 0x2810),"%d%%%%",(int)lVar13);
	if (100.0 <= *(float *)(iVar3 + 0x2994)) {
		fVar12 = (float10)100.0;
	}
	else {
		fVar12 = (float10)*(float *)(iVar3 + 0x2994);
	}
	lVar13 = __ftol(fVar12);
	*(int *)(iVar3 + 0x299c) = (int)lVar13;
	std::sprintf((char *)(iVar3 + 0x2a20),"%d%%%%",(int)lVar13);
	lVar13 = __ftol((float10)*(float *)(iVar3 + 0x2b94));
	*(int *)(iVar3 + 0x2bac) = (int)lVar13;
	std::sprintf((char *)(iVar3 + 0x2c30),"%d%%%%",(int)lVar13);
	uVar14 = __ftol((float10)*(float *)(iVar3 + 0x2da0) * (float10)*(float *)(iVar3 + 0x2d9c) *
									(float10)0.04);
	*(int *)(iVar3 + 0x2dbc) = (int)uVar14;
	uVar5 = (uint)((uVar14 & 0xffffffff) % 359999);
	std::sprintf(local_80,____EMPTYSTR__);
	if (uVar5 < 0xe11) {
		pcVar15 = &DAT_004aa4b4;
	}
	else {
		uVar6 = (uVar5 - 1) / 0xe10;
		uVar7 = uVar6;
		do {
			uVar5 -= 0xe10;
			uVar7 -= 1;
		} while (uVar7 != 0);
		if (uVar6 < 10) {
			pcVar15 = &DAT_004aa4bc;
		}
		else {
			pcVar15 = &DAT_004aa4b8;
		}
		std::sprintf(local_100,pcVar15,uVar6);
		pcVar15 = local_100;
	}
	uVar7 = 0xffffffff;
	do {
		pcVar9 = pcVar15;
		if (uVar7 == 0) break;
		uVar7 -= 1;
		pcVar9 = pcVar15 + 1;
		cVar1 = *pcVar15;
		pcVar15 = pcVar9;
	} while (cVar1 != '\0');
	uVar7 = ~uVar7;
	iVar4 = -1;
	pcVar15 = local_80;
	do {
		pcVar10 = pcVar15;
		if (iVar4 == 0) break;
		iVar4 += -1;
		pcVar10 = pcVar15 + 1;
		cVar1 = *pcVar15;
		pcVar15 = pcVar10;
	} while (cVar1 != '\0');
	puVar8 = (undefined4 *)(pcVar9 + -uVar7);
	puVar11 = (undefined4 *)(pcVar10 + -1);
	for (uVar6 = uVar7 >> 2; uVar6 != 0; uVar6 -= 1) {
		*puVar11 = *puVar8;
		puVar8 = puVar8 + 1;
		puVar11 = puVar11 + 1;
	}
	for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
		*(undefined *)puVar11 = *(undefined *)puVar8;
		puVar8 = (undefined4 *)((int)puVar8 + 1);
		puVar11 = (undefined4 *)((int)puVar11 + 1);
	}
	if (uVar5 < 0x3d) {
		pcVar15 = &DAT_004aa4a4;
	}
	else {
		uVar6 = (uVar5 - 1) / 0x3c;
		uVar7 = uVar6;
		do {
			uVar5 -= 0x3c;
			uVar7 -= 1;
		} while (uVar7 != 0);
		if (uVar6 < 10) {
			pcVar15 = &DAT_004aa4ac;
		}
		else {
			pcVar15 = &DAT_004aa4a8;
		}
		std::sprintf(local_100,pcVar15,uVar6);
		pcVar15 = local_100;
	}
	uVar7 = 0xffffffff;
	do {
		pcVar9 = pcVar15;
		if (uVar7 == 0) break;
		uVar7 -= 1;
		pcVar9 = pcVar15 + 1;
		cVar1 = *pcVar15;
		pcVar15 = pcVar9;
	} while (cVar1 != '\0');
	uVar7 = ~uVar7;
	iVar4 = -1;
	pcVar15 = local_80;
	do {
		pcVar10 = pcVar15;
		if (iVar4 == 0) break;
		iVar4 += -1;
		pcVar10 = pcVar15 + 1;
		cVar1 = *pcVar15;
		pcVar15 = pcVar10;
	} while (cVar1 != '\0');
	puVar8 = (undefined4 *)(pcVar9 + -uVar7);
	puVar11 = (undefined4 *)(pcVar10 + -1);
	for (uVar6 = uVar7 >> 2; uVar6 != 0; uVar6 -= 1) {
		*puVar11 = *puVar8;
		puVar8 = puVar8 + 1;
		puVar11 = puVar11 + 1;
	}
	for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
		*(undefined *)puVar11 = *(undefined *)puVar8;
		puVar8 = (undefined4 *)((int)puVar8 + 1);
		puVar11 = (undefined4 *)((int)puVar11 + 1);
	}
	if (uVar5 < 2) {
		pcVar15 = &DAT_004aa49c;
	}
	else {
		if (uVar5 - 1 < 10) {
			format = &PTR_g_ScanRealFiles_FilePaths_TABLE_810__848__004aa4a0;
		}
		else {
			format = (undefined **)&DAT_004aa4c4;
		}
		std::sprintf(local_100,(char *)format,uVar5 - 1);
		pcVar15 = local_100;
	}
	uVar5 = 0xffffffff;
	do {
		pcVar9 = pcVar15;
		if (uVar5 == 0) break;
		uVar5 -= 1;
		pcVar9 = pcVar15 + 1;
		cVar1 = *pcVar15;
		pcVar15 = pcVar9;
	} while (cVar1 != '\0');
	uVar5 = ~uVar5;
	iVar4 = -1;
	pcVar15 = local_80;
	do {
		pcVar10 = pcVar15;
		if (iVar4 == 0) break;
		iVar4 += -1;
		pcVar10 = pcVar15 + 1;
		cVar1 = *pcVar15;
		pcVar15 = pcVar10;
	} while (cVar1 != '\0');
	puVar8 = (undefined4 *)(pcVar9 + -uVar5);
	puVar11 = (undefined4 *)(pcVar10 + -1);
	for (uVar7 = uVar5 >> 2; uVar7 != 0; uVar7 -= 1) {
		*puVar11 = *puVar8;
		puVar8 = puVar8 + 1;
		puVar11 = puVar11 + 1;
	}
	for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
		*(undefined *)puVar11 = *(undefined *)puVar8;
		puVar8 = (undefined4 *)((int)puVar8 + 1);
		puVar11 = (undefined4 *)((int)puVar11 + 1);
	}
	std::sprintf((char *)(iVar3 + 0x2e40),"%s",local_80);
	lVar13 = __ftol((float10)*(float *)(iVar3 + 0x2fb4));
	*(int *)(iVar3 + 0x2fcc) = (int)lVar13;
	std::sprintf((char *)(iVar3 + 0x3050),"%d%%%%",(int)lVar13);
	return 1;
}



BOOL lego::main::Main_waitFrontEndRewards__004616d0(void)
{
	LevelData *pLVar1;
	int iVar2;
	int iVar3;
	BOOL BVar4;
	int **ppiVar5;
	uint uVar6;
	char *in_filename;
	int iVar7;
	uint local_34;
	int local_30;
	float local_2c;
	int local_28;
	float local_24;
	float local_20;
	undefined4 local_1c;
	LevelData *local_18;
	undefined4 uStack20;
	DWORD local_10;
	undefined4 uStack12;
	DWORD local_8;
	undefined4 uStack4;
	
	local_30 = 0;
	local_28 = 0;
	local_1c = 0;
	local_34 = 0;
	local_18 = (LevelData *)timeGetTime();
	uStack20 = 0;
	local_2c = FLOAT_0055398c;
	local_24 = (float)ZEXT48(local_18);
	pLVar1 = game::GetLevel();
	if (pLVar1 == NULL) {
		return 0;
	}
	local_18 = pLVar1;
	iVar2 = unk::Lego_GetUnkStruct_318c__00553994(pLVar1->field_10);
	if (iVar2 != 0) {
		iVar3 = FUN_00462a40();
		if (iVar3 != 0) {
			while (((local_30 < 4 || (globals::g_ButtonState_LeftDown != 0)) || (BOOL_0076bb4c != 0))) {
				local_10 = timeGetTime();
				uStack12 = 0;
				local_20 = ((float)(ulonglong)local_10 - local_24) * 0.001;
				local_8 = timeGetTime();
				uStack4 = 0;
				local_24 = (float)(ulonglong)local_8;
				local_2c = local_20 + local_2c;
				FUN_00462760((int *)&local_34,&local_30,&local_2c);
				if ((((globals::g_KeyboardState_Current_TABLE[57] == 0) &&
						 (globals::g_KeyboardState_Previous_TABLE[57] != 0)) || (BOOL_0076bb4c != 0)) &&
					 (local_30 < 3)) {
					local_30 += 1;
					if (local_30 == 3) {
						local_30 = 2;
					}
					if ((local_30 < 2) || (pLVar1->status != LEVELSTATUS_COMPLETE)) {
						local_34 = 9;
					}
					else {
						local_34 = 10;
					}
				}
				if (globals::g_Reward_Wallpaper_bmp != NULL) {
					image::Image_Blt__0047df70(globals::g_Reward_Wallpaper_bmp,NULL,NULL,NULL);
				}
				iVar3 = 0;
				if (0 < (int)local_34) {
					iVar7 = 0;
					do {
						FUN_00461a50((uint *)(iVar7 + *(int *)(iVar2 + 0x1ce8)),2,local_34);
						iVar3 += 1;
						iVar7 += 0x210;
					} while (iVar3 < (int)local_34);
				}
				iVar7 = 0;
				iVar3 = 0;
				while( true ) {
					uVar6 = local_34;
					if (9 < (int)local_34) {
						uVar6 = 9;
					}
					if ((int)uVar6 <= iVar7) break;
					FUN_00461a50((uint *)(*(int *)(iVar2 + 0x1ce8) + iVar3),0x40,local_34);
					iVar7 += 1;
					iVar3 += 0x210;
				}
				iVar3 = 0;
				if (0 < (int)local_34) {
					iVar7 = 0;
					do {
						FUN_00461a50((uint *)(iVar7 + *(int *)(iVar2 + 0x1ce8)),4,local_34);
						iVar3 += 1;
						iVar7 += 0x210;
					} while (iVar3 < (int)local_34);
				}
				FUN_004628c0(&local_34,&local_28);
				if ((local_28 != 0) && (FUN_00461f50(local_34), local_30 < 3)) {
					FUN_00462090(&local_30,&local_1c);
				}
				FUN_00462d90(DAT_00556b5c);
				if (local_30 == 3) {
					local_30 = 4;
				}
				FUN_00462650(&local_34,&local_30,&local_28,&local_2c);
				FUN_004629c0(local_20);
				pLVar1 = local_18;
			}
			FUN_00462c20((int *)&DAT_00556b5c);
			iVar3 = 0;
			do {
				if ((*(byte *)(iVar3 + *(int *)(iVar2 + 0x1ce8)) & 4) != 0) {
					FUN_004841c0(*(undefined4 **)(iVar3 + *(int *)(iVar2 + 0x1ce8) + 0x1fc));
					*(undefined4 *)(iVar3 + 0x1fc + *(int *)(iVar2 + 0x1ce8)) = 0;
				}
				iVar3 += 0x210;
			} while (iVar3 < 0x14a0);
			snd::AudioPlayback_Cleanup(1);
			if ((pLVar1->status == LEVELSTATUS_COMPLETE) && (globals::g_Game.EndGameAVI1 != NULL)) {
				BVar4 = FUN_00418050();
				if ((BVar4 == 0) ||
					 (in_filename = globals::g_Game.EndGameAVI2, globals::g_Game.EndGameAVI2 == NULL)) {
					in_filename = globals::g_Game.EndGameAVI1;
				}
				BVar4 = lego::file::File_Exist(in_filename);
				if (BVar4 != 0) {
					ppiVar5 = video::Avi_Open(in_filename);
					video::Avi_Play(ppiVar5,0);
					video::Avi_Close(ppiVar5);
				}
				snd::Audio_AddToSoundQueue1(0x2c,1);
				Main_ShowCredits();
				snd::AudioPlayback_Cleanup(1);
			}
			return 1;
		}
		return 0;
	}
	return 0;
}



void __cdecl FUN_00461a50(uint *param_1,uint param_2,uint param_3)
{
	char *pcVar1;
	uint *puVar2;
	int iVar3;
	ImageFont *pIVar4;
	undefined4 unaff_EDI;
	float local_3c;
	float fStack56;
	undefined4 local_34;
	float local_30;
	float fStack44;
	undefined4 local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	if (param_3 == 0) {
		iVar3 = 0;
	}
	else {
		iVar3 = param_3 - 1;
	}
	iVar3 = *(int *)((int)lego::globals::g_UNK_PTR_STRUCTSIZE_318c__00553994 + 0x1ce8) + iVar3 * 0x210
	;
	if (((lego::globals::g_REWARD_DisplayImages != 0) && ((*(byte *)param_1 & 2) != 0)) &&
		 ((param_2 & 2) != 0)) {
		local_3c = (float)param_1[0x58];
		local_30 = (float)(ulonglong)param_1[0x57];
		fStack56 = 0.0;
		fStack44 = (float)(ulonglong)(uint)local_3c;
		lego::image::Image_Blt__0047df70((ImageBMP *)param_1[0x80],NULL,&local_30,NULL);
	}
	if (((lego::globals::g_REWARD_DisplayImages != 0) && ((*(byte *)param_1 & 0x40) != 0)) &&
		 ((param_2 & 0x40) != 0)) {
		local_30 = (float)param_1[0x5a];
		local_3c = (float)(ulonglong)param_1[0x59];
		fStack44 = 0.0;
		fStack56 = (float)(ulonglong)(uint)local_30;
		lego::image::Image_Blt__0047df70((ImageBMP *)param_1[0x83],NULL,&local_3c,NULL);
	}
	if (((lego::globals::g_REWARD_DisplayFlics != 0) && ((*(byte *)param_1 & 4) != 0)) &&
		 ((param_2 & 4) != 0)) {
		if (param_1[0x7f] == 0) {
			lego::unk::Lego_CrashesFunc_00483f40((char *)(param_1 + 0x5b),(int *)(param_1 + 0x7f));
		}
		local_10 = (float)(ulonglong)param_1[0x7d];
		local_30 = (float)param_1[0x7c];
		local_c = (float)(ulonglong)param_1[0x7e];
		local_8 = (float)(ulonglong)param_1[0x7b];
		puVar2 = (uint *)param_1[0x7f];
		fStack44 = 0.0;
		local_4 = (float)(ulonglong)(uint)local_30;
		FUN_00484330(puVar2,&local_10,(uint)((int)puVar2[0x189] < 0x23),0,unaff_EDI);
	}
	if (lego::globals::g_REWARD_DisplayText != 0) {
		if (((*(byte *)param_1 & 1) != 0) && ((param_2 & 1) != 0)) {
			pIVar4 = FUN_00401b90((ImageFont *)param_1[0x81],(char *)(param_1 + 0x35));
			FUN_0047a440((ImageFont *)param_1[0x81],param_1[0x55] - ((uint)pIVar4 >> 1),param_1[0x56],
									 (char *)(param_1 + 0x35));
			if (param_3 < 10) {
				pcVar1 = (char *)(iVar3 + 0x54);
				pIVar4 = FUN_00401b90(lego::globals::g_Reward_TitleFont,pcVar1);
				FUN_0047a440(lego::globals::g_Reward_TitleFont,
										 lego::globals::g_Reward_TextPos.x - ((uint)pIVar4 >> 1),
										 lego::globals::g_Reward_TextPos.y,pcVar1);
			}
		}
		if ((lego::globals::g_REWARD_DisplayText != 0) &&
			 ((((*param_1 & 0x10) != 0 && ((param_2 & 0x10) != 0)) ||
				(((*param_1 & 0x20) != 0 && ((param_2 & 0x20) != 0)))))) {
			local_1c = 0x3df0f0f1;
			local_18 = 0x3df0f0f1;
			local_14 = 0x3df0f0f1;
			local_28 = 0x3e70f0f1;
			local_24 = 0x3e70f0f1;
			local_20 = 0x3e70f0f1;
			local_3c = 0.0;
			fStack56 = 0.0;
			local_34 = 0;
			pIVar4 = FUN_00401b90((ImageFont *)param_1[0x81],(char *)(param_1 + 0x35));
			local_30 = (float)&pIVar4->field_0x14;
			local_10 = (float)(ulonglong)((param_1[0x55] - ((uint)pIVar4 >> 1)) - 10);
			local_c = (float)(ulonglong)param_1[0x56];
			fStack44 = 0.0;
			local_8 = (float)(ulonglong)(uint)local_30;
			local_30 = (float)lego::draw::Font_GetField_be4((ImageFont *)param_1[0x81]);
			fStack44 = 0.0;
			local_4 = (float)(ulonglong)(uint)local_30;
			FUN_0046bb70(local_10,local_c,local_8,local_4,local_1c,local_18,local_14,local_28,local_24,
									 local_20,local_3c,fStack56,local_34,param_2 & 0x20);
			FUN_0047a440((ImageFont *)param_1[0x81],param_1[0x55] - ((uint)pIVar4 >> 1),param_1[0x56],
									 (char *)(param_1 + 0x35));
			if (param_3 < 10) {
				pcVar1 = (char *)(iVar3 + 0x54);
				pIVar4 = FUN_00401b90(lego::globals::g_Reward_TitleFont,pcVar1);
				local_30 = (float)&pIVar4->field_0x14;
				local_10 = (float)(ulonglong)
													((lego::globals::g_Reward_TextPos.x - ((uint)pIVar4 >> 1)) - 10);
				local_c = (float)(ulonglong)(uint)lego::globals::g_Reward_TextPos.y;
				fStack44 = 0.0;
				local_8 = (float)(ulonglong)(uint)local_30;
				local_30 = (float)lego::draw::Font_GetField_be4(lego::globals::g_Reward_TitleFont);
				fStack44 = 0.0;
				local_4 = (float)(ulonglong)(uint)local_30;
				FUN_0046bb70(local_10,local_c,local_8,local_4,local_1c,local_18,local_14,local_28,local_24,
										 local_20,local_3c,fStack56,local_34,0);
				FUN_0047a440(lego::globals::g_Reward_TitleFont,
										 lego::globals::g_Reward_TextPos.x - ((uint)pIVar4 >> 1),
										 lego::globals::g_Reward_TextPos.y,pcVar1);
			}
		}
	}
	return;
}



int __cdecl FUN_00461f50(uint param_1)
{
	char cVar1;
	ImageFont *pIVar2;
	LevelData *pLVar3;
	ImageFont *pIVar4;
	int iVar5;
	ImageFont *pIVar6;
	uint uVar7;
	int iVar8;
	char *pcVar9;
	char local_40 [32];
	char local_20 [32];
	
	pLVar3 = lego::game::GetLevel();
	if (pLVar3 == NULL) {
		return (int)NULL;
	}
	pIVar4 = (ImageFont *)lego::unk::Lego_GetUnkStruct_318c__00553994(pLVar3->field_10);
	if (pIVar4 == NULL) {
		return (int)NULL;
	}
	if (pLVar3->status == LEVELSTATUS_COMPLETE) {
		FUN_00461a50((uint *)(*(int *)&pIVar4[2].field_0x500 + 0x1290),1,param_1);
		std::sprintf(local_40,"%s",*(int *)&pIVar4[2].field_0x500 + 0x12e4);
		iVar5 = *(int *)&pIVar4[2].field_0x500;
		uVar7 = 0xffffffff;
		iVar8 = 0;
		pcVar9 = (char *)(iVar5 + 0x12e4);
		do {
			if (uVar7 == 0) break;
			uVar7 -= 1;
			cVar1 = *pcVar9;
			pcVar9 = pcVar9 + 1;
		} while (cVar1 != '\0');
		if (0 < (int)(~uVar7 - 1)) {
			do {
				if (*(char *)(iVar8 + 0x12e4 + iVar5) == ' ') {
					local_40[iVar8] = '\0';
					std::sprintf(local_20,"%s",local_40 + iVar8 + 1);
				}
				iVar5 = *(int *)&pIVar4[2].field_0x500;
				uVar7 = 0xffffffff;
				iVar8 += 1;
				pcVar9 = (char *)(iVar5 + 0x12e4);
				do {
					if (uVar7 == 0) break;
					uVar7 -= 1;
					cVar1 = *pcVar9;
					pcVar9 = pcVar9 + 1;
				} while (cVar1 != '\0');
			} while (iVar8 < (int)(~uVar7 - 1));
		}
		pcVar9 = local_40;
		iVar5 = *(int *)(*(int *)&pIVar4[2].field_0x500 + 0x13e8) + -0x28;
		pIVar6 = FUN_00401b90(lego::globals::g_Reward_BackFont,local_40);
		pIVar2 = pIVar4 + 2;
		pIVar4 = lego::globals::g_Reward_BackFont;
		FUN_0047a440(lego::globals::g_Reward_BackFont,
								 *(int *)(*(int *)&pIVar2->field_0x500 + 0x13e4) - ((uint)pIVar6 >> 1),iVar5,pcVar9)
		;
	}
	return (int)pIVar4;
}



int __cdecl FUN_00462090(undefined4 *param_1,undefined4 *param_2)
{
	float fVar1;
	bool bVar2;
	LevelData *pLVar3;
	int iVar4;
	ImageBMP *pIVar5;
	
	bVar2 = false;
	pLVar3 = lego::game::GetLevel();
	if (pLVar3 == NULL) {
		return 0;
	}
	iVar4 = lego::unk::Lego_GetUnkStruct_318c__00553994(pLVar3->field_10);
	if (iVar4 == 0) {
		return 0;
	}
	if (pLVar3->status == LEVELSTATUS_COMPLETE) {
		fVar1 = (float)lego::globals::g_MousePosition.x;
		pIVar5 = lego::globals::g_Reward_SaveButton;
		if (((((ushort)((ushort)(fVar1 < lego::globals::g_Reward_SaveButton_position.x) << 8 |
									 (ushort)(fVar1 == lego::globals::g_Reward_SaveButton_position.x) << 0xe) == 0) &&
				 (fVar1 < (float)(ulonglong)(uint)lego::globals::g_Reward_SaveButton->width +
									lego::globals::g_Reward_SaveButton_position.x)) &&
				(fVar1 = (float)lego::globals::g_MousePosition.y,
				(ushort)((ushort)(fVar1 < lego::globals::g_Reward_SaveButton_position.y) << 8 |
								(ushort)(fVar1 == lego::globals::g_Reward_SaveButton_position.y) << 0xe) == 0)) &&
			 (fVar1 < (float)(ulonglong)(uint)lego::globals::g_Reward_SaveButton->height +
								lego::globals::g_Reward_SaveButton_position.y)) {
			FUN_0046ba30(0x24);
			if (((lego::globals::g_ButtonState_LeftDown != 0) &&
					(pIVar5 = lego::globals::g_Reward_SaveButton_in,
					lego::globals::g_Reward_SaveButton_in != NULL)) ||
				 (pIVar5 = lego::globals::g_Reward_SaveButton_hi,
				 lego::globals::g_Reward_SaveButton_hi != NULL)) {
				lego::image::Image_Blt__0047df70
									(pIVar5,NULL,(float *)&lego::globals::g_Reward_SaveButton_position,NULL);
			}
			iVar4 = FUN_00435480();
			if (iVar4 != 0) {
				bVar2 = true;
				lego::snd::Snd_Play_FUN_00465260(0x13,0);
				FUN_004622f0();
				*param_2 = 1;
				lego::snd::Sample_StopSoundBufferInstance(0x29);
				lego::snd::Audio_AddToSoundQueue1(0x29,1);
			}
			goto LAB_004621e1;
		}
	}
	else {
		pIVar5 = lego::globals::g_Reward_SaveButton_dim;
		if (lego::globals::g_Reward_SaveButton_dim == NULL) goto LAB_004621e1;
	}
	lego::image::Image_Blt__0047df70
						(pIVar5,NULL,(float *)&lego::globals::g_Reward_SaveButton_position,NULL);
LAB_004621e1:
	fVar1 = (float)lego::globals::g_MousePosition.x;
	if ((((ushort)((ushort)(fVar1 < lego::globals::g_Reward_AdvanceButton_position.x) << 8 |
								(ushort)(fVar1 == lego::globals::g_Reward_AdvanceButton_position.x) << 0xe) != 0) ||
			((float)(ulonglong)(uint)lego::globals::g_Reward_AdvanceButton->width +
			 lego::globals::g_Reward_AdvanceButton_position.x <= fVar1)) ||
		 ((fVar1 = (float)lego::globals::g_MousePosition.y,
			(ushort)((ushort)(fVar1 < lego::globals::g_Reward_AdvanceButton_position.y) << 8 |
							(ushort)(fVar1 == lego::globals::g_Reward_AdvanceButton_position.y) << 0xe) != 0 ||
			((float)(ulonglong)(uint)lego::globals::g_Reward_AdvanceButton->height +
			 lego::globals::g_Reward_AdvanceButton_position.y <= fVar1)))) {
		iVar4 = lego::image::Image_Blt__0047df70
											(lego::globals::g_Reward_AdvanceButton,NULL,
											 (float *)&lego::globals::g_Reward_AdvanceButton_position,NULL);
	}
	else {
		FUN_0046ba30(0x25);
		if (((lego::globals::g_ButtonState_LeftDown != 0) &&
				(pIVar5 = lego::globals::g_Reward_AdvanceButton_in,
				lego::globals::g_Reward_AdvanceButton_in != NULL)) ||
			 (pIVar5 = lego::globals::g_Reward_AdvanceButton_hi,
			 lego::globals::g_Reward_AdvanceButton_hi != NULL)) {
			lego::image::Image_Blt__0047df70
								(pIVar5,NULL,(float *)&lego::globals::g_Reward_AdvanceButton_position,NULL);
		}
		iVar4 = FUN_00435480();
		if (iVar4 != 0) {
			bVar2 = true;
			*param_1 = 3;
			lego::snd::Snd_Play_FUN_00465260(0x13,0);
			iVar4 = FUN_00462530();
		}
	}
	if ((!bVar2) && (iVar4 = FUN_00435480(), iVar4 != 0)) {
		lego::snd::Snd_Play_FUN_00465260(0x14,0);
	}
	return iVar4;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void FUN_004622f0(void)
{
	LevelData *pLVar1;
	BOOL BVar2;
	BOOL BVar3;
	int *piVar4;
	int iVar5;
	undefined *puVar6;
	undefined4 *puVar7;
	int iVar8;
	undefined *puVar9;
	LevelData *pLVar10;
	uint uVar11;
	uint unaff_EBX;
	undefined4 unaff_EBP;
	undefined4 unaff_ESI;
	undefined4 unaff_EDI;
	char *pcVar12;
	undefined4 local_d0 [6];
	undefined4 local_b8 [46];
	
	pLVar1 = lego::game::GetLevel();
	lego::unk::Lego_GetIntNotM1__00558020();
	BVar2 = lego::unk::Lego_GetIntNotM1__00558024();
	FUN_00416840();
	BVar3 = lego::main::Config_IsFrontEndEnabled();
	if (BVar3 != 0) {
		pcVar12 = pLVar1->levelName;
		piVar4 = FUN_00416d30();
		iVar5 = FUN_00416d50(piVar4,pcVar12);
		FUN_00417ec0(iVar5);
		iVar5 = lego::save::Save_GetSaveNumber();
		puVar6 = FUN_00417da0();
		puVar7 = (undefined4 *)FUN_00417f70(local_b8);
		FUN_004604c0();
		if (BVar2 == 0) {
			iVar8 = FUN_00458910();
			if (iVar8 != 0) {
				do {
					lego::front::Menu_Open_FUN_00416bb0(4);
				} while (DAT_00558508 != 0);
				if (_DAT_00558504 == 1) {
					iVar5 = FUN_00417f10();
					if (iVar5 != 0) {
						FUN_00417f30(unaff_EDI,unaff_ESI,unaff_EBP,unaff_EBX);
						FUN_00417f20(0);
					}
					puVar9 = FUN_00417da0();
					if (puVar9 != NULL) {
						puVar9 = FUN_00417da0();
						if ((puVar9 != puVar6) && (puVar6 != NULL)) {
							FUN_00417ff0(local_b8);
							pLVar10 = lego::game::GetLevel();
							pcVar12 = pLVar10->levelName;
							piVar4 = FUN_00416d30();
							uVar11 = FUN_00416d50(piVar4,pcVar12);
							FUN_00417de0(uVar11);
							pcVar12 = pLVar1->levelName;
							piVar4 = FUN_00416d30();
							iVar5 = FUN_00416d50(piVar4,pcVar12);
							FUN_00417e70(iVar5,puVar7);
							FUN_00437370(local_d0);
							FUN_00417e50(local_d0);
							FUN_00417ef0(unaff_EDI,unaff_ESI,unaff_EBP,unaff_EBX);
							return;
						}
						pLVar10 = lego::game::GetLevel();
						pcVar12 = pLVar10->levelName;
						piVar4 = FUN_00416d30();
						uVar11 = FUN_00416d50(piVar4,pcVar12);
						FUN_00417de0(uVar11);
						pcVar12 = pLVar1->levelName;
						piVar4 = FUN_00416d30();
						iVar5 = FUN_00416d50(piVar4,pcVar12);
						FUN_00417e70(iVar5,puVar7);
						FUN_00437370(local_d0);
						FUN_00417e50(local_d0);
						FUN_00417ef0(unaff_EDI,unaff_ESI,unaff_EBP,unaff_EBX);
						return;
					}
					pLVar1 = lego::game::GetLevel();
					pcVar12 = pLVar1->levelName;
					piVar4 = FUN_00416d30();
					FUN_00416d50(piVar4,pcVar12);
					return;
				}
				lego::save::Save_SetSaveNumber(iVar5);
				puVar6 = FUN_00417da0();
				if (puVar6 != NULL) {
					pLVar10 = lego::game::GetLevel();
					pcVar12 = pLVar10->levelName;
					piVar4 = FUN_00416d30();
					uVar11 = FUN_00416d50(piVar4,pcVar12);
					FUN_00417de0(uVar11);
					pcVar12 = pLVar1->levelName;
					piVar4 = FUN_00416d30();
					iVar5 = FUN_00416d50(piVar4,pcVar12);
					FUN_00417e70(iVar5,puVar7);
					FUN_00437370(local_d0);
					FUN_00417e50(local_d0);
				}
			}
		}
	}
	return;
}



void FUN_00462530(void)
{
	LevelData *pLVar1;
	int *piVar2;
	uint uVar3;
	int iVar4;
	undefined *puVar5;
	uint uVar6;
	undefined4 unaff_EBX;
	undefined4 unaff_ESI;
	undefined4 unaff_EDI;
	undefined4 *puVar7;
	uint unaff_retaddr;
	LevelIdentifier *pLVar8;
	undefined4 uVar9;
	char *pcVar10;
	undefined4 uVar11;
	
	pLVar1 = lego::game::GetLevel();
	pcVar10 = pLVar1->levelName;
	piVar2 = FUN_00416d30();
	uVar3 = FUN_00416d50(piVar2,pcVar10);
	iVar4 = lego::save::Save_GetSaveNumber();
	if (iVar4 == -1) {
		lego::save::Save_SetSaveNumber(5);
	}
	pLVar1 = lego::game::GetLevel();
	if (pLVar1->status == LEVELSTATUS_COMPLETE) {
		pLVar1 = (LevelData *)FUN_00417de0(uVar3);
	}
	FUN_004604c0();
	FUN_00417e70(uVar3,(undefined4 *)pLVar1);
	if (iVar4 == -1) {
		puVar5 = FUN_00417d80(5);
		if (puVar5 != NULL) {
			puVar7 = (undefined4 *)(*(int *)(puVar5 + 0x34) + 0x3190);
			for (uVar6 = *(int *)(puVar5 + 0x18) * 0x3190 - 0x3190U >> 2; uVar6 != 0; uVar6 -= 1) {
				*puVar7 = 0;
				puVar7 = puVar7 + 1;
			}
			for (iVar4 = 0; iVar4 != 0; iVar4 += -1) {
				*(undefined *)puVar7 = 0;
				puVar7 = (undefined4 *)((int)puVar7 + 1);
			}
			pLVar1 = lego::game::GetLevel();
			if (pLVar1->status == LEVELSTATUS_COMPLETE) {
				pLVar1 = (LevelData *)FUN_00417de0(uVar3);
			}
			FUN_004604c0();
			FUN_00417e70(uVar3,(undefined4 *)pLVar1);
		}
		FUN_00417ef0(unaff_EDI,unaff_ESI,unaff_EBX,unaff_retaddr);
		lego::game::Game_UnkLoadSaveSlot__004179c0
							(5,(undefined4 *)(lego::globals::g_Struct_b8_TABLE__00558080 + 5),0);
	}
	uVar11 = 0;
	uVar9 = *(undefined4 *)
					 (*(int *)(*(int *)(*(int *)(*lego::globals::menu::g_MainMenuFull + 4) + 0x18) + 4) + 0x10
					 );
	pLVar8 = &LevelIdentifier_00557fe4;
	puVar5 = FUN_00417da0();
	FUN_00417310(DAT_00557ff8,*(int *)(puVar5 + 0x34),pLVar8,uVar9,uVar11);
	FUN_00418040(0);
	return;
}



void __cdecl
FUN_00462650(undefined4 *param_1,undefined4 *param_2,undefined4 *param_3,undefined4 *param_4)
{
	LevelData *pLVar1;
	int iVar2;
	int iVar3;
	
	pLVar1 = lego::game::GetLevel();
	if (pLVar1 == NULL) {
		return;
	}
	iVar2 = lego::unk::Lego_GetUnkStruct_318c__00553994(pLVar1->field_10);
	if (iVar2 == 0) {
		return;
	}
	if (((byte)lego::globals::g_Game.flags2 & 0x10) != 0) {
		if (((lego::globals::g_KeyboardState_Current_TABLE[57] != 0) &&
				(lego::globals::g_KeyboardState_Current_TABLE[1] != 0)) &&
			 (lego::globals::g_KeyboardState_Previous_TABLE[1] !=
				lego::globals::g_KeyboardState_Current_TABLE[1])) {
			lego::main::Game_Exit();
		}
		if ((lego::globals::g_KeyboardState_Current_TABLE[19] != 0) &&
			 (lego::globals::g_KeyboardState_Previous_TABLE[19] !=
				lego::globals::g_KeyboardState_Current_TABLE[19])) {
			*param_1 = 0;
			*param_2 = 0;
			*param_4 = FLOAT_0055398c;
			*param_3 = 0;
			lego::snd::Sample_StopSoundBufferInstance(0x29);
			lego::snd::Audio_AddToSoundQueue1(0x29,1);
			iVar3 = 0;
			do {
				FUN_00462720((byte *)(*(int *)(iVar2 + 0x1ce8) + iVar3));
				iVar3 += 0x210;
			} while (iVar3 < 0x14a0);
		}
	}
	return;
}



void __cdecl FUN_00462720(byte *param_1)
{
	if ((*param_1 & 4) != 0) {
		FUN_004841c0(*(undefined4 **)(param_1 + 0x1fc));
		lego::unk::Lego_CrashesFunc_00483f40((char *)(param_1 + 0x16c),(int *)(param_1 + 0x1fc));
	}
	return;
}



void __cdecl FUN_00462760(int *param_1,int *param_2,float *param_3)
{
	char *sfxName;
	bool bVar1;
	LevelData *pLVar2;
	int iVar3;
	int iVar4;
	BOOL BVar5;
	bool bVar6;
	int local_4;
	
	bVar1 = false;
	pLVar2 = lego::game::GetLevel();
	if (pLVar2 == NULL) {
		return;
	}
	iVar3 = lego::unk::Lego_GetUnkStruct_318c__00553994(pLVar2->field_10);
	if (iVar3 == 0) {
		return;
	}
	if (FLOAT_0055398c <= *param_3) {
		bVar6 = *param_2 == 0;
		if (!bVar6) goto LAB_004627c2;
		bVar1 = true;
	}
	bVar6 = *param_2 == 0;
LAB_004627c2:
	if ((!bVar6) && (FLOAT_0055398c + FLOAT_0055398c <= *param_3)) {
		pLVar2 = lego::game::GetLevel();
		if ((pLVar2->status == LEVELSTATUS_COMPLETE) && (*param_1 < 10)) {
			bVar1 = true;
		}
	}
	if (bVar1) {
		*param_3 = *param_3 - FLOAT_0055398c;
		iVar4 = *param_1;
		if (iVar4 < 10) {
			iVar4 += 1;
		}
		*param_1 = iVar4;
		sfxName = *(char **)(iVar4 * 0x210 + -8 + *(int *)(iVar3 + 0x1ce8));
		if (sfxName != NULL) {
			BVar5 = lego::snd::Snd_GetSFX(sfxName,&local_4);
			if (BVar5 != 0) {
				lego::snd::Audio_AddToSoundQueue1(local_4,0);
			}
		}
		iVar4 = *param_1;
		if (9 < iVar4) {
			if (*param_2 == 0) {
				*param_1 = 9;
				*param_2 = *param_2 + 1;
				return;
			}
			if ((9 < iVar4) && (1 < *param_2)) {
				if (10 < iVar4) {
					*param_1 = 10;
					*param_2 = *param_2 + 1;
					return;
				}
				iVar4 = 0;
				do {
					FUN_00462720((byte *)(*(int *)(iVar3 + 0x1ce8) + iVar4));
					iVar4 += 0x210;
				} while (iVar4 < 0x14a0);
			}
		}
	}
	return;
}



void __cdecl FUN_004628c0(uint *param_1,undefined4 *param_2)
{
	uint uVar1;
	LevelData *pLVar2;
	int iVar3;
	uint uVar4;
	int iVar5;
	int iVar6;
	
	pLVar2 = lego::game::GetLevel();
	if (pLVar2 == NULL) {
		return;
	}
	iVar3 = lego::unk::Lego_GetUnkStruct_318c__00553994(pLVar2->field_10);
	if (iVar3 == 0) {
		return;
	}
	if (((*param_1 == 10) || ((pLVar2->status != LEVELSTATUS_COMPLETE && (*param_1 == 9)))) &&
		 ((*(int *)(iVar3 + 0x3178) == 0 ||
			(((lego::globals::g_REWARD_DisplayFlics == 0 ||
				(0x21 < *(int *)(*(int *)(*(int *)(iVar3 + 0x1ce8) + 0x148c) + 0x624))) ||
			 (pLVar2->status != LEVELSTATUS_COMPLETE)))))) {
		*param_2 = 1;
	}
	iVar6 = 0;
	iVar5 = 0;
	while( true ) {
		uVar1 = *param_1;
		uVar4 = uVar1;
		if (9 < (int)uVar1) {
			uVar4 = 9;
		}
		if ((int)uVar4 <= iVar6) break;
		FUN_00461a50((uint *)(*(int *)(iVar3 + 0x1ce8) + iVar5),1,uVar1);
		iVar6 += 1;
		iVar5 += 0x210;
	}
	FUN_00401b90(lego::globals::g_Reward_TitleFont,pLVar2->FullName);
	FUN_00401b90(lego::globals::g_Reward_TitleFont,lego::globals::g_LevelStatusMessage_text);
	return;
}



void __cdecl FUN_004629c0(float param_1)
{
	FUN_0045d050(1.0);
	FUN_0045cee0(0);
	FUN_0045cf30(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y);
	FUN_00435480();
	BOOL_0076bb4c = 0;
	FUN_00465460(param_1);
										// param_1 / 25.0 * 1000.0 (related to milliseconds)
	FUN_0046ba80(lego::globals::g_MousePosition.x,lego::globals::g_MousePosition.y,
							 param_1 * 0.04 * 1000.0);
	lego::main::Main_UpdateAndRender__004781f0(1);
	return;
}



undefined4 FUN_00462a40(void)
{
	LevelData *pLVar1;
	int *piVar2;
	
	pLVar1 = lego::game::GetLevel();
	if (pLVar1 != NULL) {
		piVar2 = (int *)lego::unk::Lego_GetUnkStruct_318c__00553994(pLVar1->field_10);
		if (piVar2 != NULL) {
			if ((lego::globals::g_Reward_Display != 0) && (*piVar2 != 0)) {
				while( true ) {
					if ((((lego::globals::g_KeyboardState_Current_TABLE[57] == 0) ||
							 (lego::globals::g_KeyboardState_Previous_TABLE[57] ==
								lego::globals::g_KeyboardState_Current_TABLE[57])) &&
							(lego::globals::g_KeyboardState_Current_TABLE[57] == 0)) &&
						 ((lego::globals::g_KeyboardState_Previous_TABLE[57] == 0 && (true)))) break;
					lego::main::Main_UpdateAndRender__004781f0(1);
				}
				BOOL_0076bb4c = 0;
				lego::snd::Audio_AddToSoundQueue1(0x29,1);
				return 1;
			}
			FUN_00462530();
		}
	}
	return 0;
}



void __cdecl FUN_00462ac0(float param_1)
{
	FLOAT_00556738 = param_1 + FLOAT_00556738;
	FLOAT_0055673c = FLOAT_0055673c - -1.0;
	return;
}



void __cdecl lego::unk::Lego_DecFloat_00555adc(void)
{
	FLOAT_00555adc = FLOAT_00555adc - -1.0;
	return;
}



void __cdecl lego::unk::Lego_DecFloat_00555efc(void)
{
	FLOAT_00555efc = FLOAT_00555efc - -1.0;
	return;
}



void __cdecl lego::nerps::NERPs_IncDat_00556324(void)
{
	UINT_00556324 += 1;
	return;
}



void __cdecl lego::nerps::NERPs_IncRockMonstersDestroyed(void)
{
	globals::nerps::g_NERPs_RockMonstersDestroyed += 1;
	return;
}



void __cdecl lego::nerps::NERPs_IncDat_0055632c(void)
{
	UINT_0055632c += 1;
	return;
}



void __cdecl lego::nerps::NERPs_AddToFloat_00556330(float param_1)
{
	FLOAT_00556330 = param_1 + FLOAT_00556330;
	return;
}



void __cdecl lego::nerps::NERPs_AddToFloat_00556120(float param_1)
{
	FLOAT_00556120 = param_1 + FLOAT_00556120;
	return;
}



undefined4 * __cdecl
FUN_00462ba0(undefined4 *param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
						undefined4 param_5,undefined4 param_6)
{
	undefined4 *puVar1;
	undefined4 *puVar2;
	undefined4 *puVar3;
	int iVar4;
	
	puVar1 = (undefined4 *)std::malloc(0x28);
	if (puVar1 != NULL) {
		puVar3 = puVar1;
		for (iVar4 = 10; iVar4 != 0; iVar4 += -1) {
			*puVar3 = 0;
			puVar3 = puVar3 + 1;
		}
		puVar2 = (undefined4 *)std::malloc(4);
		puVar1[8] = puVar2;
		puVar3 = (undefined4 *)std::malloc(0x20);
		*puVar2 = puVar3;
		for (iVar4 = 8; iVar4 != 0; iVar4 += -1) {
			*puVar3 = 0;
			puVar3 = puVar3 + 1;
		}
		puVar1[5] = param_6;
		puVar1[1] = param_2;
		puVar1[2] = param_3;
		puVar1[3] = param_4;
		puVar1[4] = param_5;
		*puVar1 = param_3;
	}
	*param_1 = puVar1;
	return puVar1;
}



undefined4 __cdecl FUN_00462c20(int *param_1)
{
	void *buffer;
	int iVar1;
	uint uVar2;
	
	uVar2 = 0;
	iVar1 = *param_1;
	if (*(int *)(iVar1 + 0x1c) != 0) {
		do {
			buffer = *(void **)(*(int *)(*(int *)(iVar1 + 0x20) + uVar2 * 4) + 0x14);
			if (buffer != NULL) {
				std::free(buffer);
			}
			std::free(*(void **)(*(int *)(*param_1 + 0x20) + uVar2 * 4));
			iVar1 = *param_1;
			uVar2 += 1;
		} while (uVar2 < *(uint *)(iVar1 + 0x1c));
	}
	if (*(void **)(*param_1 + 0x20) != NULL) {
		std::free(*(void **)(*param_1 + 0x20));
	}
	std::free((void *)*param_1);
	return 1;
}



undefined4 __cdecl
FUN_00462c90(int param_1,char *param_2,int param_3,undefined4 param_4,undefined4 param_5,
						uint param_6)
{
	char cVar1;
	int iVar2;
	int *piVar3;
	void *pvVar4;
	int iVar5;
	uint uVar6;
	undefined4 *puVar7;
	char *pcVar8;
	
	if (param_3 == 0) {
		return 0;
	}
	iVar2 = *(int *)(param_1 + 0x1c);
	iVar5 = iVar2 + 1;
	*(int *)(param_1 + 0x1c) = iVar5;
	piVar3 = FUN_0048df40(*(LwoFrame **)(param_1 + 0x20),iVar5 * 4);
	*(int **)(param_1 + 0x20) = piVar3;
	iVar2 *= 4;
	pvVar4 = std::malloc(0x20);
	*(void **)(*(int *)(param_1 + 0x20) + iVar2) = pvVar4;
	puVar7 = *(undefined4 **)(*(int *)(param_1 + 0x20) + iVar2);
	for (iVar5 = 8; iVar5 != 0; iVar5 += -1) {
		*puVar7 = 0;
		puVar7 = puVar7 + 1;
	}
	*(undefined4 *)(*(int *)(*(int *)(param_1 + 0x20) + iVar2) + 4) = param_4;
	*(undefined4 *)(*(int *)(*(int *)(param_1 + 0x20) + iVar2) + 8) = param_5;
	uVar6 = 0xffffffff;
	pcVar8 = param_2;
	do {
		if (uVar6 == 0) break;
		uVar6 -= 1;
		cVar1 = *pcVar8;
		pcVar8 = pcVar8 + 1;
	} while (cVar1 != '\0');
	pvVar4 = std::malloc(~uVar6);
	*(void **)(*(int *)(*(int *)(param_1 + 0x20) + iVar2) + 0x14) = pvVar4;
	std::sprintf(*(char **)(*(int *)(*(int *)(param_1 + 0x20) + iVar2) + 0x14),"%s",param_2);
	**(undefined4 **)(*(int *)(param_1 + 0x20) + iVar2) = 3;
	*(int *)(*(int *)(*(int *)(param_1 + 0x20) + iVar2) + 0x18) = param_3;
	iVar5 = *(int *)(*(int *)(param_1 + 0x20) + iVar2);
	*(uint *)(iVar5 + 0x1c) = *(uint *)(iVar5 + 0x1c) | param_6;
	return *(undefined4 *)(*(int *)(param_1 + 0x20) + iVar2);
}



void __cdecl FUN_00462d70(int param_1,undefined4 param_2)
{
	*(undefined4 *)(param_1 + 0x18) = param_2;
	return;
}



void __cdecl FUN_00462d80(int param_1,uint param_2)
{
	*(uint *)(param_1 + 0x24) = *(uint *)(param_1 + 0x24) | param_2;
	return;
}



BOOL __cdecl FUN_00462d90(float *param_1)
{
	int iVar1;
	float fVar2;
	float *pfVar3;
	int iVar4;
	int *piVar5;
	ImageFont *pIVar6;
	uint uVar7;
	float *pfVar8;
	longlong lVar9;
	ulonglong uVar10;
	int local_2c;
	float local_28;
	float *local_24;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	pfVar3 = param_1;
	local_28 = 0.0;
	if (param_1[7] != 0.0) {
		do {
			iVar4 = (int)local_28 * 4;
			piVar5 = *(int **)(iVar4 + (int)pfVar3[8]);
			lVar9 = __ftol((float10)(float)piVar5[1] + (float10)pfVar3[1]);
			local_2c = (int)lVar9;
			uVar10 = __ftol((float10)(float)piVar5[2] + (float10)pfVar3[2]);
			param_1 = (float *)uVar10;
			if ((*(byte *)(pfVar3 + 9) & 1) != 0) {
				if ((float)(int)param_1 < *pfVar3) {
					lVar9 = __ftol((float10)pfVar3[6] + (float10)pfVar3[4]);
					do {
						param_1 = (float *)((int)param_1 + (int)lVar9);
						uVar10 = ZEXT48(param_1);
					} while ((float)(int)param_1 < *pfVar3);
				}
				pfVar8 = (float *)uVar10;
				fVar2 = pfVar3[6] + *pfVar3 + pfVar3[4];
				if ((ushort)((ushort)((float)(int)param_1 < fVar2) << 8 |
										(ushort)((float)(int)param_1 == fVar2) << 0xe) == 0) {
					lVar9 = __ftol((float10)pfVar3[4]);
					do {
						pfVar8 = (float *)((int)pfVar8 - (int)lVar9);
						uVar10 = ZEXT48(pfVar8);
						param_1 = pfVar8;
					} while ((ushort)((ushort)((float)(int)pfVar8 < fVar2) << 8 |
													 (ushort)((float)(int)pfVar8 == fVar2) << 0xe) == 0);
				}
			}
			iVar1 = *piVar5;
			if (iVar1 == 1) {
				FUN_00485470((void *)piVar5[3],local_2c,(int)uVar10);
				FUN_00485650(*(int **)(*(int *)(iVar4 + (int)pfVar3[8]) + 0xc),0,
										 lego::globals::g_FPSLOCK_VSYNC,NULL);
LAB_00462e93:
				local_8 = (float)local_2c;
				piVar5 = (int *)(iVar4 + (int)pfVar3[8]);
				local_4 = (float)(int)param_1;
				local_10 = (float)(ulonglong)*(uint *)(*(int *)(*piVar5 + 0x10) + 4);
				local_c = (float)(ulonglong)*(uint *)(*(int *)(*piVar5 + 0x10) + 8);
				lego::image::Image_Blt__0047df70(*(ImageBMP **)(*piVar5 + 0x10),NULL,&local_8,&local_10);
LAB_00462ef7:
				iVar1 = *(int *)(iVar4 + (int)pfVar3[8]);
				if ((*(byte *)(iVar1 + 0x1c) & 1) != 0) {
					pIVar6 = FUN_00401b90(*(ImageFont **)(iVar1 + 0x18),*(char **)(iVar1 + 0x14));
					lVar9 = __ftol(((float10)pfVar3[3] - (float10)pfVar3[1]) * (float10)-0.5);
					local_2c += -(int)lVar9 - ((uint)pIVar6 >> 1);
				}
				uVar10 &= 0xffffffff;
				iVar4 = *(int *)(iVar4 + (int)pfVar3[8]);
				uVar7 = *(uint *)(iVar4 + 0x1c) & 2;
				if (uVar7 != 0) {
					uVar10 = __ftol((float10)*(float *)(iVar4 + 8));
					param_1 = (float *)uVar10;
				}
				if ((uVar7 != 0) ||
					 ((fVar2 = (float)(int)param_1, fVar2 < pfVar3[4] + *pfVar3 &&
						((ushort)((ushort)(fVar2 < *pfVar3) << 8 | (ushort)(fVar2 == *pfVar3) << 0xe) == 0)))) {
					FUN_0047a440(*(ImageFont **)(iVar4 + 0x18),local_2c,(int)uVar10,*(char **)(iVar4 + 0x14));
				}
			}
			else {
				if (iVar1 == 2) goto LAB_00462e93;
				if (iVar1 == 3) goto LAB_00462ef7;
			}
			local_28 = (float)((int)local_28 + 1);
		} while ((uint)local_28 < (uint)pfVar3[7]);
	}
	pfVar3[2] = pfVar3[2] - pfVar3[5];
	if (((byte)lego::globals::g_Game.flags2 & 0x10) != 0) {
		if (lego::globals::g_KeyboardState_Current_TABLE[31] != 0) {
			pfVar3[5] = 0.0;
		}
		if (lego::globals::g_KeyboardState_Current_TABLE[19] != 0) {
			pfVar3[2] = *pfVar3;
		}
		if (lego::globals::g_KeyboardState_Current_TABLE[13] != 0) {
			pfVar3[5] = pfVar3[5] - -0.01;
		}
		if (lego::globals::g_KeyboardState_Current_TABLE[12] != 0) {
			pfVar3[5] = pfVar3[5] - 0.01;
		}
		param_1 = NULL;
		local_24 = NULL;
		do {
			if (*(char *)((int)param_1 + 0x76bb82) != '\0') {
				pfVar8 = param_1;
				if (pfVar3[5] < 0.0) {
					pfVar8 = local_24;
				}
				pfVar3[5] = (float)(int)pfVar8 * 0.1;
			}
			param_1 = (float *)((int)param_1 + 1);
			local_24 = (float *)((int)local_24 + -1);
		} while (-10 < (int)local_24);
	}
	return 1;
}



BOOL __cdecl FUN_00463060(ResourceData *resData,int width,int height)
{
	uint uVar1;
	uint uVar2;
	
	RESDATA_00553180 = lego::res::Res_Unk_LoadVisualMesh(resData,2);
	if (RESDATA_00553180 != NULL) {
		DAT_00553194 = 0;
		uVar2 = height * width;
		BOOL_0055318c = 0;
		GRIDPTR_00553198 = std::malloc(uVar2 * 8);
		if (GRIDPTR_00553198 != NULL) {
			uVar1 = 0;
			if (uVar2 != 0) {
				do {
					*(undefined4 *)((int)GRIDPTR_00553198 + uVar1 * 8) = 0;
					*(undefined *)((int)GRIDPTR_00553198 + uVar1 * 8 + 4) = 1;
					uVar1 += 1;
				} while (uVar1 < uVar2);
			}
			Size2I_00553184.width = width;
			Size2I_00553184.height = height;
			BOOL_00553190 = 1;
			UINT_0055396c = 0;
			return 1;
		}
		lego::pool::ReservedPool_ResourceData___Release(RESDATA_00553180);
	}
	return 0;
}



BOOL __cdecl lego::main::Main_LoadRoofTexture(char *filename)
{
	uint uVar1;
	uint uVar2;
	
	if (DAT_00553194 != NULL) {
		FUN_004749d0((int **)DAT_00553194);
	}
	DAT_00553194 = draw::Draw_UnkMakeDirectXSurfaceTuple(filename,1,NULL,NULL);
	if (DAT_00553194 != NULL) {
		uVar1 = res::Res_GetMeshGroupCount(RESDATA_00553180);
		uVar2 = 0;
		if (uVar1 != 0) {
			do {
				FUN_00475060(RESDATA_00553180,uVar2,(undefined **)DAT_00553194);
				uVar2 += 1;
			} while (uVar2 < uVar1);
		}
		return 1;
	}
	return 0;
}



void __fastcall FUN_00463190(void *param_1)
{
	if (GRIDPTR_00553198 != NULL) {
		std::free(GRIDPTR_00553198);
	}
	GRIDPTR_00553198 = NULL;
	if (RESDATA_00553180 != NULL) {
		lego::pool::ReservedPool_ResourceData___Release(RESDATA_00553180);
	}
	RESDATA_00553180 = NULL;
	FUN_004749d0(DAT_00553194);
	return;
}



void __cdecl
FUN_004631e0(int param_1,int param_2,undefined4 *param_3,undefined4 *param_4,undefined4 *param_5,
						undefined4 *param_6)
{
	int **ppiVar1;
	ushort uVar2;
	bool bVar3;
	byte bVar4;
	int *piVar5;
	undefined4 local_a8;
	undefined4 local_a4;
	undefined4 local_a0;
	undefined4 local_9c;
	undefined4 local_98;
	undefined4 local_94;
	undefined4 local_90;
	undefined4 local_8c;
	undefined4 local_88;
	undefined4 local_84;
	undefined4 local_80;
	undefined4 local_7c;
	undefined4 local_78;
	undefined4 local_74;
	undefined4 local_70;
	undefined4 local_6c;
	undefined4 local_68;
	undefined4 local_64;
	undefined4 local_60;
	undefined4 local_5c;
	undefined4 local_58;
	undefined4 local_54;
	undefined4 local_50;
	undefined4 local_4c;
	undefined4 local_48;
	undefined4 local_44;
	undefined4 local_40;
	undefined4 local_3c;
	undefined4 local_38;
	undefined4 local_34;
	undefined4 local_30;
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	ppiVar1 = (int **)((int)GRIDPTR_00553198 + (param_2 * Size2I_00553184.width + param_1) * 8);
	bVar3 = false;
	if ((*(byte *)(ppiVar1 + 1) & 1) != 0) {
		local_18 = 0;
		local_10 = 3;
		local_4 = 3;
		local_14 = 1;
		local_c = 1;
		local_8 = 2;
		piVar5 = FUN_00474bb0(RESDATA_00553180,4,2,3,(undefined2 *)&local_18);
		*ppiVar1 = piVar5;
		if (piVar5 != (int *)0xffffffff) {
			FUN_00475060(RESDATA_00553180,(int)piVar5,DAT_00553194);
			FUN_004750f0(RESDATA_00553180,(int)*ppiVar1,1);
			FUN_00474df0(RESDATA_00553180,(int)*ppiVar1,1);
			*(byte *)(ppiVar1 + 1) = *(byte *)(ppiVar1 + 1) & 0xfe;
		}
	}
	BOOL_00553190 = 1;
	*(byte *)(ppiVar1 + 1) = *(byte *)(ppiVar1 + 1) | 2;
	if ((float)param_5[2] <= (float)param_3[2]) {
		if ((ushort)((ushort)((float)param_5[2] < (float)param_4[2]) << 8 |
								(ushort)((float)param_5[2] == (float)param_4[2]) << 0xe) != 0) {
			uVar2 = (ushort)((float)param_5[2] < (float)param_6[2]) << 8 |
							(ushort)((float)param_5[2] == (float)param_6[2]) << 0xe;
			goto joined_r0x0046334a;
		}
	}
	else {
		if ((ushort)((ushort)((float)param_3[2] < (float)param_4[2]) << 8 |
								(ushort)((float)param_3[2] == (float)param_4[2]) << 0xe) != 0) {
			uVar2 = (ushort)((float)param_3[2] < (float)param_6[2]) << 8 |
							(ushort)((float)param_3[2] == (float)param_6[2]) << 0xe;
joined_r0x0046334a:
			if (uVar2 != 0) goto LAB_00463350;
		}
	}
	bVar3 = true;
LAB_00463350:
	if (bVar3) {
		local_3c = *param_4;
		local_38 = param_4[1];
		local_34 = param_4[2];
		local_60 = *param_5;
		local_5c = param_5[1];
		local_58 = param_5[2];
		local_84 = *param_6;
		local_80 = param_6[1];
		local_7c = param_6[2];
		local_a8 = *param_3;
		local_a4 = param_3[1];
		local_a0 = param_3[2];
		bVar4 = *(byte *)(ppiVar1 + 1) | 4;
	}
	else {
		local_3c = *param_3;
		local_38 = param_3[1];
		local_34 = param_3[2];
		local_60 = *param_4;
		local_5c = param_4[1];
		local_58 = param_4[2];
		local_84 = *param_5;
		local_80 = param_5[1];
		local_7c = param_5[2];
		local_a8 = *param_6;
		local_a4 = param_6[1];
		local_a0 = param_6[2];
		bVar4 = *(byte *)(ppiVar1 + 1) & 0xfb;
	}
	*(byte *)(ppiVar1 + 1) = bVar4;
	local_30 = 0;
	local_28 = 0;
	local_54 = 0;
	local_4c = 0;
	local_78 = 0;
	local_70 = 0;
	local_9c = 0;
	local_94 = 0;
	local_2c = 0;
	local_50 = 0;
	local_74 = 0;
	local_98 = 0;
	local_1c = 0xffffffff;
	local_40 = 0xffffffff;
	local_64 = 0xffffffff;
	local_88 = 0xffffffff;
	local_24 = 0;
	local_20 = 0x3f800000;
	local_48 = 0x3f800000;
	local_44 = 0x3f800000;
	local_6c = 0x3f800000;
	local_68 = 0;
	local_90 = 0;
	local_8c = 0;
	FUN_00474ff0((int *)RESDATA_00553180,(int)*ppiVar1,0,4,(int)&local_a8);
	return;
}



void __cdecl FUN_004634f0(void)
{
	int *piVar1;
	float fVar2;
	uint uVar3;
	BOOL BVar4;
	uint uVar5;
	int iVar6;
	float *pfVar7;
	int *piVar8;
	uint local_134;
	uint local_130;
	int local_124;
	Vector3F local_11c;
	int local_110 [4];
	undefined4 local_100;
	undefined4 local_fc;
	undefined4 local_f8;
	undefined4 local_f4;
	undefined4 local_f0;
	undefined4 local_ec;
	undefined4 local_e8;
	undefined4 local_e4;
	undefined4 local_e0;
	undefined4 local_dc;
	undefined4 local_d8;
	undefined4 local_d4;
	undefined4 local_d0;
	undefined4 local_cc;
	undefined4 local_c8;
	undefined4 local_c4;
	undefined4 local_c0;
	undefined4 local_bc;
	undefined4 local_b8;
	undefined4 local_b4;
	undefined4 local_b0;
	undefined4 local_ac;
	undefined4 local_a8;
	undefined4 local_a4;
	undefined4 local_a0;
	undefined4 local_9c;
	undefined4 local_98;
	undefined4 local_94;
	undefined local_90 [20];
	float local_7c [31];
	
	if (BOOL_00553190 != 0) {
		BOOL_00553190 = 0;
		local_130 = 0;
		uVar5 = Size2I_00553184.width;
		if (Size2I_00553184.height != 0) {
			do {
				local_134 = 0;
				if (uVar5 != 0) {
					do {
						iVar6 = local_130 * uVar5 + local_134;
						piVar1 = (int *)((int)GRIDPTR_00553198 + iVar6 * 8);
						if ((*(byte *)((int)GRIDPTR_00553198 + iVar6 * 8 + 4) & 2) != 0) {
							local_fc = 1;
							local_f4 = 1;
							local_e8 = 1;
							local_e0 = 1;
							local_dc = 1;
							local_d4 = 1;
							local_c0 = 1;
							local_b8 = 1;
							local_110[2] = 0xffffffff;
							local_f8 = 0xffffffff;
							local_c4 = 0xffffffff;
							local_bc = 0xffffffff;
							local_a8 = 0xffffffff;
							local_a4 = 0xffffffff;
							local_9c = 0xffffffff;
							local_98 = 0xffffffff;
							local_110[0] = 0;
							local_110[1] = 0;
							local_110[3] = 0;
							local_100 = 0;
							local_f0 = 0;
							local_ec = 0;
							local_e4 = 0;
							local_d8 = 0;
							local_d0 = 0;
							local_cc = 0;
							local_c8 = 0;
							local_b4 = 0;
							local_b0 = 0;
							local_ac = 0;
							local_a0 = 0;
							local_94 = 0;
							FUN_00474f80(RESDATA_00553180,*piVar1,0,4,(int)local_90);
							uVar5 = 0;
							pfVar7 = local_7c;
							do {
								uVar3 = uVar5;
								if ((*(byte *)(piVar1 + 1) & 4) != 0) {
									uVar3 = uVar5 - 1 & 3;
								}
								local_124 = 4;
								piVar8 = local_110 + uVar3 * 8;
								do {
									BVar4 = FUN_00463850(local_134 + *piVar8,piVar8[1] + local_130,&local_11c);
									if (BVar4 != 0) {
										pfVar7[-2] = local_11c.x + pfVar7[-2];
										pfVar7[-1] = local_11c.y + pfVar7[-1];
										*pfVar7 = local_11c.z + *pfVar7;
									}
									piVar8 = piVar8 + 2;
									local_124 += -1;
								} while (local_124 != 0);
								uVar5 += 1;
								fVar2 = 1.0 / SQRT(pfVar7[-2] * pfVar7[-2] +
																	 *pfVar7 * *pfVar7 + pfVar7[-1] * pfVar7[-1]);
								*pfVar7 = fVar2 * *pfVar7;
								pfVar7[-2] = fVar2 * pfVar7[-2];
								pfVar7[-1] = fVar2 * pfVar7[-1];
								pfVar7 = pfVar7 + 9;
							} while (uVar5 < 4);
							FUN_00474ff0((int *)RESDATA_00553180,*piVar1,0,4,(int)local_90);
							*(byte *)(piVar1 + 1) = *(byte *)(piVar1 + 1) & 0xfd;
							uVar5 = Size2I_00553184.width;
						}
						local_134 += 1;
					} while (local_134 < uVar5);
				}
				local_130 += 1;
			} while (local_130 < (uint)Size2I_00553184.height);
		}
	}
	return;
}



void __cdecl FUN_00463770(BOOL use3rdFrame)
{
	if (BOOL_0055318c != use3rdFrame) {
		BOOL_0055318c = use3rdFrame;
		if (use3rdFrame != 0) {
			lego::res::Res_UnkSetup3DFrameTransform(RESDATA_00553180,1);
			return;
		}
		lego::res::Res_UnkSetup3DFrameTransform(RESDATA_00553180,0);
	}
	return;
}



void __cdecl FUN_004637b0(int param_1,int param_2)
{
	void *pvVar1;
	int iVar2;
	
	iVar2 = param_2 * Size2I_00553184.width + param_1;
	pvVar1 = (void *)((int)GRIDPTR_00553198 + iVar2 * 8);
	FUN_00474df0(RESDATA_00553180,*(int *)((int)GRIDPTR_00553198 + iVar2 * 8),0);
	(&DAT_0055319c)[UINT_0055396c] = pvVar1;
	UINT_0055396c = UINT_0055396c + 1;
	return;
}



void __cdecl FUN_00463800(void)
{
	uint uVar1;
	int **ppiVar2;
	
	uVar1 = 0;
	if (UINT_0055396c != 0) {
		ppiVar2 = (int **)&DAT_0055319c;
		do {
			FUN_00474df0(RESDATA_00553180,**ppiVar2,1);
			uVar1 += 1;
			ppiVar2 = ppiVar2 + 1;
		} while (uVar1 < UINT_0055396c);
	}
	UINT_0055396c = 0;
	return;
}



BOOL __cdecl FUN_00463850(uint param_1,uint param_2,Vector3F *param_3)
{
	int *piVar1;
	float fVar2;
	Vector3F local_a8;
	Vector3F local_9c;
	Vector3F local_90 [3];
	Vector3F local_6c [3];
	Vector3F local_48 [3];
	Vector3F local_24 [3];
	
	if (((param_1 < (uint)Size2I_00553184.width) && (param_2 < (uint)Size2I_00553184.height)) &&
		 (piVar1 = (int *)((int)GRIDPTR_00553198 + (param_2 * Size2I_00553184.width + param_1) * 8),
		 (*(byte *)(piVar1 + 1) & 1) == 0)) {
		FUN_00474f80(RESDATA_00553180,*piVar1,0,4,(int)local_90);
		lego::math::Vector3_VectorSqrtUnk(&local_a8,local_90,local_6c,local_48);
		lego::math::Vector3_VectorSqrtUnk(&local_9c,local_48,local_24,local_90);
		local_9c.y = local_9c.y + local_a8.y;
		local_9c.z = local_9c.z + local_a8.z;
		local_9c.x = local_9c.x + local_a8.x;
		fVar2 = 1.0 / SQRT(local_9c.x * local_9c.x + local_9c.z * local_9c.z + local_9c.y * local_9c.y);
		param_3->x = fVar2 * local_9c.x;
		param_3->y = fVar2 * local_9c.y;
		param_3->z = fVar2 * local_9c.z;
		return 1;
	}
	return 0;
}



void __cdecl
lego::unk::Lego_LoadScrollInfoPanel__00463970
					(char *filename,int index,int param_3,int param_4,int param_5)
{
	ImageBMP *pIVar1;
	char **ppcVar2;
	int iVar3;
	
	ppcVar2 = (char **)&param_5;
	if (filename != NULL) {
		do {
			iVar3 = index * 0x20;
			*(undefined4 *)(&DAT_0055315c + iVar3) = 1;
			*(uint *)(&DAT_0055315c + iVar3) = (-(uint)((char *)param_3 != NULL) & 8) + 9;
			pIVar1 = image::Image_LoadBMP(filename,0,0);
			*(ImageBMP **)(&DAT_00553140 + iVar3) = pIVar1;
			if (pIVar1 != NULL) {
				*(uint *)(&DAT_0055315c + iVar3) = *(uint *)(&DAT_0055315c + iVar3) | 4;
			}
			filename = *ppcVar2;
			(&DAT_00553158)[index * 8] = param_4;
			index = (int)ppcVar2[1];
			param_3 = (int)ppcVar2[2];
			param_4 = (int)ppcVar2[3];
			ppcVar2 = ppcVar2 + 4;
		} while (filename != NULL);
	}
	return;
}



void __cdecl FUN_004639f0(int param_1,uint param_2,uint param_3)
{
	(&DAT_00553144)[param_1 * 8] = (float)(ulonglong)param_2;
	(&DAT_00553148)[param_1 * 8] = (float)(ulonglong)param_3;
	return;
}



void __cdecl FUN_00463a30(int param_1,int param_2,float *param_3,int param_4,int param_5)
{
	float fVar1;
	float fVar2;
	float *pfVar3;
	ImageBMP *pIVar4;
	
	if (param_2 == 0) {
		pfVar3 = (float *)std::malloc(0x1c);
		(&DAT_0055314c)[param_1 * 8] = pfVar3;
	}
	else {
		pfVar3 = (float *)std::malloc(0x1c);
		(&DAT_00553150)[param_1 * 8] = pfVar3;
	}
	*pfVar3 = *param_3;
	pfVar3[1] = param_3[1];
	pfVar3[2] = param_3[2] + *param_3;
	fVar1 = param_3[3];
	fVar2 = param_3[1];
	pfVar3[4] = 0.0;
	pfVar3[5] = 0.0;
	pfVar3[3] = fVar1 + fVar2;
	if (param_4 != 0) {
		pIVar4 = lego::image::Image_LoadBMP((char *)param_4,0,0);
		pfVar3[4] = (float)pIVar4;
	}
	if (param_5 != 0) {
		pIVar4 = lego::image::Image_LoadBMP((char *)param_5,0,0);
		pfVar3[5] = (float)pIVar4;
	}
	pfVar3[6] = 0.0;
	return;
}



void __cdecl FUN_00463ad0(int param_1,float *param_2,int param_3,undefined4 param_4,char *param_5)
{
	void *pvVar1;
	ImageBMP *pIVar2;
	
	pvVar1 = std::malloc(0x28);
	(&DAT_00553154)[param_1 * 8] = pvVar1;
	pIVar2 = lego::image::Image_LoadBMP(param_5,0,0);
	*(ImageBMP **)((&DAT_00553154)[param_1 * 8] + 0x18) = pIVar2;
	*(float *)(&DAT_00553154)[param_1 * 8] = *param_2;
	*(float *)((&DAT_00553154)[param_1 * 8] + 4) = param_2[1];
	*(float *)((&DAT_00553154)[param_1 * 8] + 8) = param_2[2] + *param_2;
	*(float *)((&DAT_00553154)[param_1 * 8] + 0xc) = param_2[3] + param_2[1];
	*(undefined4 *)((&DAT_00553154)[param_1 * 8] + 0x10) = 0;
	*(undefined4 *)((&DAT_00553154)[param_1 * 8] + 0x14) = 0;
	*(int *)((&DAT_00553154)[param_1 * 8] + 0x1c) = param_3 + -1;
	*(undefined4 *)((&DAT_00553154)[param_1 * 8] + 0x20) = param_4;
	return;
}



int __cdecl FUN_00463b60(int *param_1,uint param_2,uint param_3,int param_4,int param_5)
{
	uint uVar1;
	float fVar2;
	float fVar3;
	int iVar4;
	undefined4 uVar5;
	int iVar6;
	uint uVar7;
	float *pfVar8;
	int local_60;
	int *local_5c;
	
	iVar6 = 0;
	local_60 = 0;
	local_5c = &DAT_00553158;
	do {
		if (((*(byte *)(local_5c + 1) & 4) != 0) && (iVar4 = FUN_0045adf0(*local_5c), iVar4 == 0)) {
			uVar7 = 0;
			do {
				if (uVar7 == 0) {
					pfVar8 = (float *)local_5c[-3];
				}
				else {
					pfVar8 = (float *)local_5c[-2];
				}
				if ((iVar6 == 0) && (iVar4 = FUN_00463ec0(local_5c + -6,pfVar8,param_2,param_3), iVar4 != 0)
					 ) {
					*param_1 = local_60;
					if (param_4 == 0) {
						if (INT_00553160 != 3) {
							if (uVar7 != INT_00553160) goto LAB_00463c6b;
							iVar6 = local_5c[-1];
							uVar1 = *(uint *)(iVar6 + 0x20);
							if (uVar7 == 0) {
								if (uVar1 < *(uint *)(iVar6 + 0x1c)) {
									iVar4 = uVar1 + 1;
LAB_00463c54:
									*(int *)(iVar6 + 0x20) = iVar4;
								}
							}
							else {
								if (uVar1 != 0) {
									iVar4 = uVar1 - 1;
									goto LAB_00463c54;
								}
							}
							*(undefined4 *)(local_5c[-1] + 0x24) = 1;
							pfVar8[6] = (float)((uint)pfVar8[6] & 0xfffffffb | 2);
							goto LAB_00463c6b;
						}
						iVar6 = 1;
						pfVar8[6] = (float)((uint)pfVar8[6] & 0xfffffffb | 2);
					}
					else {
						if (INT_00553160 == 3) {
							if (param_5 == 0) {
								iVar6 = 1;
								INT_00553160 = uVar7;
								pfVar8[6] = (float)((uint)pfVar8[6] & 0xfffffffd | 4);
							}
							else {
LAB_00463c6b:
								iVar6 = 1;
							}
						}
						else {
							if (uVar7 != INT_00553160) goto LAB_00463c6b;
							iVar6 = 1;
							pfVar8[6] = (float)((uint)pfVar8[6] & 0xfffffffd | 4);
						}
					}
				}
				else {
					pfVar8[6] = (float)((uint)pfVar8[6] & 0xfffffff9);
				}
				uVar7 += 1;
			} while (uVar7 < 2);
			if ((iVar6 == 0) && (iVar4 = FUN_00463f50((int)(local_5c + -6),param_2,param_3), iVar4 != 0))
			{
				if (param_4 == 0) {
					if (INT_00553160 == 3) {
						INT_00553160 = 2;
					}
					BOOL_005023c0 = 1;
				}
				else {
					if (INT_00553160 == 2) {
						if ((*(byte *)(local_5c + 1) & 8) == 0) {
							pfVar8 = (float *)local_5c[-1];
							fVar2 = (float)(ulonglong)(uint)pfVar8[7] / (pfVar8[2] - *pfVar8);
							fVar3 = (((float)(ulonglong)param_2 - (float)(&DAT_00501128)[*local_5c * 0xc]) -
											(float)local_5c[-5]) - *pfVar8;
						}
						else {
							iVar6 = local_5c[-1];
							fVar2 = (float)(ulonglong)*(uint *)(iVar6 + 0x1c) /
											(*(float *)(iVar6 + 0xc) - *(float *)(iVar6 + 4));
							fVar3 = (((float)(ulonglong)param_3 - (float)(&DAT_0050112c)[*local_5c * 0xc]) -
											(float)local_5c[-4]) - *(float *)(iVar6 + 4);
						}
						uVar5 = FUN_00464100(fVar3 / fVar2);
						iVar6 = 1;
						*(undefined4 *)(local_5c[-1] + 0x20) = uVar5;
						*(undefined4 *)(local_5c[-1] + 0x24) = 1;
						*param_1 = local_60;
						goto LAB_00463da4;
					}
				}
				iVar6 = 1;
				*param_1 = local_60;
			}
			else {
				BOOL_005023c0 = 0;
			}
LAB_00463da4:
			pfVar8 = (float *)local_5c[-1];
			if (pfVar8[9] != 0.0) {
				fVar2 = pfVar8[7];
				if ((*(byte *)(local_5c + 1) & 8) == 0) {
					if (fVar2 == 0.0) {
						fVar2 = *pfVar8 - (float)(ulonglong)*(uint *)((int)pfVar8[6] + 4);
					}
					else {
						fVar2 = (float)(ulonglong)(uint)pfVar8[8] *
										((float)(ulonglong)(uint)fVar2 /
										((pfVar8[2] - *pfVar8) - (float)(ulonglong)*(uint *)((int)pfVar8[6] + 4)));
					}
					pfVar8[4] = fVar2;
				}
				else {
					if (fVar2 == 0.0) {
						pfVar8[5] = 0.0;
					}
					else {
						pfVar8[5] = (float)(ulonglong)(uint)pfVar8[8] *
												((float)(ulonglong)(uint)fVar2 /
												((pfVar8[3] - pfVar8[1]) - (float)(ulonglong)*(uint *)((int)pfVar8[6] + 8)))
						;
					}
				}
				*(undefined4 *)(local_5c[-1] + 0x24) = 0;
			}
		}
		local_5c = local_5c + 8;
		local_60 += 1;
		if ((int *)0x553177 < local_5c) {
			if ((param_4 == 0) && (BOOL_005023c0 == 0)) {
				INT_00553160 = 3;
			}
			return iVar6;
		}
	} while( true );
}



undefined4 __cdecl FUN_00463ec0(int param_1,float *param_2,int param_3,int param_4)
{
	int iVar1;
	float fVar2;
	float fVar3;
	longlong lVar4;
	longlong lVar5;
	
	iVar1 = *(int *)(param_1 + 0x18);
	lVar4 = __ftol((float10)(float)(&DAT_00501128)[iVar1 * 0xc] + (float10)*(float *)(param_1 + 4));
	lVar5 = __ftol((float10)(float)(&DAT_0050112c)[iVar1 * 0xc] + (float10)*(float *)(param_1 + 8));
	fVar2 = (float)(param_3 - (int)lVar4);
	if ((((*param_2 <= fVar2) && (fVar3 = (float)(param_4 - (int)lVar5), fVar3 < param_2[3])) &&
			(param_2[1] <= fVar3)) && (fVar2 < param_2[2])) {
		return 1;
	}
	return 0;
}



undefined4 __cdecl FUN_00463f50(int param_1,int param_2,int param_3)
{
	int iVar1;
	float *pfVar2;
	float fVar3;
	float fVar4;
	longlong lVar5;
	longlong lVar6;
	
	iVar1 = *(int *)(param_1 + 0x18);
	lVar5 = __ftol((float10)(float)(&DAT_00501128)[iVar1 * 0xc] + (float10)*(float *)(param_1 + 4));
	lVar6 = __ftol((float10)(float)(&DAT_0050112c)[iVar1 * 0xc] + (float10)*(float *)(param_1 + 8));
	fVar3 = (float)(param_2 - (int)lVar5);
	pfVar2 = *(float **)(param_1 + 0x14);
	if ((((*pfVar2 <= fVar3) && (fVar4 = (float)(param_3 - (int)lVar6), fVar4 < pfVar2[3])) &&
			(pfVar2[1] <= fVar4)) && (fVar3 < pfVar2[2])) {
		return 1;
	}
	return 0;
}



void __cdecl FUN_00463fe0(int index)
{
	float *pfVar1;
	uint uVar2;
	ImageBMP *bitmap;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	local_10 = (float)(&DAT_00553144)[index * 8] +
						 (float)(&DAT_00501128)[(&DAT_00553158)[index * 8] * 0xc];
	local_c = (float)(&DAT_00553148)[index * 8] +
						(float)(&DAT_0050112c)[(&DAT_00553158)[index * 8] * 0xc];
	lego::image::Image_Blt__0047df70(*(ImageBMP **)(&DAT_00553140 + index * 0x20),NULL,&local_10,NULL)
	;
	uVar2 = 0;
	do {
		if (uVar2 == 0) {
			pfVar1 = (float *)(&DAT_0055314c)[index * 8];
		}
		else {
			pfVar1 = (float *)(&DAT_00553150)[index * 8];
		}
		if ((((uint)pfVar1[6] & 2) == 0) || (pfVar1[4] == 0.0)) {
			if ((((uint)pfVar1[6] & 4) != 0) && (pfVar1[5] != 0.0)) {
				local_8 = *pfVar1;
				local_4 = pfVar1[1];
				bitmap = (ImageBMP *)pfVar1[5];
				goto LAB_004640a7;
			}
		}
		else {
			local_8 = *pfVar1;
			local_4 = pfVar1[1];
			bitmap = (ImageBMP *)pfVar1[4];
LAB_004640a7:
			local_4 = local_4 + local_c;
			local_8 = local_8 + local_10;
			lego::image::Image_Blt__0047df70(bitmap,NULL,&local_8,NULL);
		}
		uVar2 += 1;
		if (1 < uVar2) {
			pfVar1 = (float *)(&DAT_00553154)[index * 8];
			local_8 = pfVar1[4] + local_10 + *pfVar1;
			local_4 = pfVar1[1] + pfVar1[5] + local_c;
			lego::image::Image_Blt__0047df70((ImageBMP *)pfVar1[6],NULL,&local_8,NULL);
			return;
		}
	} while( true );
}



longlong __cdecl FUN_00464100(float param_1)
{
	float10 fVar1;
	longlong lVar2;
	uint local_8;
	uint uStack4;
	
	uStack4 = (uint)((ulonglong)(double)param_1 >> 0x20);
	local_8 = SUB84((double)param_1,0);
	fVar1 = FUN_0048e540(local_8,uStack4);
	if ((float10)param_1 - fVar1 < (float10)0.5) {
		fVar1 = FUN_0048e540(local_8,uStack4);
		lVar2 = __ftol(fVar1);
		return lVar2;
	}
	fVar1 = FUN_0048eba0(local_8,uStack4);
	lVar2 = __ftol(fVar1);
	return lVar2;
}



void __cdecl
lego::draw::Draw_UnkFuncOfInterestTable__00464160
					(int index,undefined4 *out_param_2,undefined4 *out_param_3)
{
	*out_param_2 = *(undefined4 *)((&DAT_00553154)[index * 8] + 0x1c);
	*out_param_3 = *(undefined4 *)((&DAT_00553154)[index * 8] + 0x20);
	return;
}



void __cdecl FUN_00464190(int param_1,undefined4 param_2,undefined4 param_3)
{
	*(undefined4 *)((&DAT_00553154)[param_1 * 8] + 0x1c) = param_2;
	*(undefined4 *)((&DAT_00553154)[param_1 * 8] + 0x20) = param_3;
	*(undefined4 *)((&DAT_00553154)[param_1 * 8] + 0x24) = 1;
	return;
}



int ** __cdecl FUN_004641c0(ResourceData *in_resData,float param_2)
{
	int iVar1;
	undefined4 uVar2;
	ResourceData **buffer;
	ResourceData *pRVar3;
	int *piVar4;
	int *piVar5;
	undefined4 *puVar6;
	int *piVar7;
	uint uVar8;
	uint uVar9;
	uint uVar10;
	int iVar11;
	undefined4 *puVar12;
	D3DRMRenderQuality local_184;
	undefined4 local_17c [4];
	undefined4 local_16c [4];
	int local_15c [4];
	undefined4 local_14c;
	undefined4 local_148;
	undefined4 local_144;
	undefined4 local_140;
	undefined4 local_13c;
	undefined4 local_138;
	undefined4 local_134;
	undefined4 local_130;
	undefined4 local_12c;
	undefined4 local_128;
	undefined4 local_124;
	undefined4 local_120;
	undefined4 local_11c;
	undefined4 local_118;
	undefined4 local_114;
	undefined4 local_110;
	undefined4 local_10c;
	int local_108 [30];
	undefined local_90 [32];
	undefined4 local_70 [28];
	
	buffer = (ResourceData **)std::malloc(8);
	if (buffer != NULL) {
		*buffer = NULL;
		buffer[1] = NULL;
		pRVar3 = lego::res::Res_Unk_LoadVisualMesh(in_resData,3);
		*buffer = pRVar3;
		if (pRVar3 != NULL) {
			local_16c[0] = 0;
			local_15c[1] = 1;
			local_15c[3] = 1;
			local_16c[1] = 0x3f800000;
			local_16c[2] = 0x3f800000;
			local_16c[3] = 0;
			local_17c[0] = 0;
			local_17c[1] = 0;
			local_17c[2] = 0x3f800000;
			local_17c[3] = 0x3f800000;
			local_144 = 0;
			local_140 = 0;
			local_13c = 0xbf800000;
			local_138 = 0;
			local_134 = 0x3f800000;
			local_130 = 0;
			local_12c = 0x3f800000;
			local_128 = 0;
			local_124 = 0;
			local_120 = 0;
			local_11c = 0xbf800000;
			local_118 = 0;
			local_114 = 0xbf800000;
			local_110 = 0;
			local_10c = 0;
			local_15c[0] = 0;
			local_15c[2] = 3;
			local_14c = 2;
			local_148 = 3;
			uVar10 = 0;
			piVar4 = local_108;
			do {
				piVar7 = local_15c;
				iVar11 = 6;
				piVar5 = piVar4;
				do {
					piVar4 = piVar5 + 1;
					iVar1 = *piVar7;
					piVar7 = piVar7 + 1;
					iVar11 += -1;
					*piVar5 = uVar10 + iVar1;
					piVar5 = piVar4;
				} while (iVar11 != 0);
				uVar10 += 4;
			} while (uVar10 < 0x14);
			local_184 = 0;
			buffer[1] = (ResourceData *)param_2;
			do {
				FUN_00474bb0(*buffer,0x14,10,3,(undefined2 *)local_108);
				uVar10 = 0;
				puVar12 = &local_144;
				do {
					puVar6 = local_70;
					uVar8 = 0;
					do {
						uVar9 = uVar8 + 4;
						puVar6[-5] = *puVar12;
						puVar6[-4] = puVar12[1];
						puVar6[-3] = puVar12[2];
						uVar2 = *(undefined4 *)((int)local_16c + uVar8);
						*puVar6 = 0xffffffff;
						puVar6[-2] = uVar2;
						puVar6[-1] = *(undefined4 *)((int)local_17c + uVar8);
						puVar6 = puVar6 + 9;
						uVar8 = uVar9;
					} while (uVar9 < 0x10);
					FUN_00474ff0((int *)*buffer,local_184,uVar10,4,(int)local_90);
					uVar10 += 4;
					puVar12 = puVar12 + 3;
				} while (uVar10 < 0x14);
				lego::res::Res_SetMeshGroupQuality(*buffer,local_184,QUALITY_GOURAUD);
				local_184 += 1;
			} while (local_184 < 10);
			lego::res::Res_UnkSetup3DFrameTransform(*buffer,1);
			return (int **)buffer;
		}
		std::free(buffer);
	}
	return (int **)NULL;
}



undefined4 * __cdecl FUN_004643d0(int *param_1,int param_2,int param_3,int param_4)
{
	int *piVar1;
	uint uVar2;
	int iVar3;
	
	if (param_3 != 0) {
		uVar2 = (int)(param_4 + 0x8000U) >> 0x1f;
		piVar1 = &DAT_005023c8;
		do {
			*piVar1 = *(int *)(param_2 + -0x5023c8 + (int)piVar1);
			piVar1[1] = *(int *)(param_2 + -0x5023c4 + (int)piVar1);
			if (true) {
				switch(((param_4 + 0x8000U ^ uVar2) - uVar2 & 3 ^ uVar2) - uVar2) {
				default:
					goto switchD_0046441a_caseD_0;
				case 1:
					iVar3 = *piVar1;
					*piVar1 = -piVar1[1];
					goto LAB_00464440;
				case 2:
					*piVar1 = -*piVar1;
					iVar3 = piVar1[1];
					break;
				case 3:
					iVar3 = *piVar1;
					*piVar1 = piVar1[1];
				}
				iVar3 = -iVar3;
LAB_00464440:
				piVar1[1] = iVar3;
			}
switchD_0046441a_caseD_0:
			*piVar1 = *piVar1 + *param_1;
			param_3 += -1;
			piVar1[1] = piVar1[1] + param_1[1];
			piVar1 = piVar1 + 2;
		} while (param_3 != 0);
	}
	return &DAT_005023c8;
}



uint __cdecl
FUN_00464480(int **param_1,int *param_2,int param_3,uint param_4,int param_5,uint *param_6,
						int param_7)
{
	int iVar1;
	bool bVar2;
	bool bVar3;
	bool bVar4;
	bool bVar5;
	byte bVar6;
	uint *puVar7;
	BOOL BVar8;
	uint uVar9;
	int iVar10;
	float *pfVar11;
	int *piVar12;
	float *pfVar13;
	uint *puVar14;
	uint uVar15;
	int iVar16;
	uint *puVar17;
	uint *puVar18;
	float local_3d8;
	float local_3d4;
	uint local_3d0;
	uint *local_3cc;
	uint *local_3c8;
	float local_3c4;
	uint local_3c0;
	Point2I local_3ac;
	int local_3a4;
	int local_3a0 [5];
	undefined4 local_38c;
	undefined4 local_388;
	undefined4 local_384;
	int local_380 [4];
	undefined4 local_370;
	undefined4 local_36c;
	undefined4 local_368;
	undefined4 local_364;
	undefined4 local_360;
	undefined4 local_35c;
	undefined4 local_358;
	undefined4 local_354;
	undefined4 local_350;
	undefined4 local_34c;
	undefined4 local_348;
	undefined4 local_344;
	undefined4 local_340;
	undefined4 local_33c;
	undefined4 local_338;
	undefined4 local_334;
	float local_330 [24];
	float local_2d0 [180];
	
	local_380[2] = 2;
	local_354 = 2;
	local_350 = 2;
	local_380[3] = 3;
	local_368 = 5;
	local_35c = 5;
	local_344 = 3;
	local_340 = 3;
	local_380[1] = 1;
	local_364 = 1;
	local_360 = 1;
	bVar6 = 1;
	local_348 = 7;
	local_33c = 7;
	local_358 = 6;
	local_34c = 6;
	uVar15 = 0;
	local_3c0 = 0;
	local_380[0] = 0;
	local_370 = 0;
	local_36c = 4;
	local_338 = 4;
	local_334 = 0;
	puVar7 = FUN_004643d0(param_2,param_3,param_4,param_5);
	local_3a4 = FUN_0044eb80((uint *)(lego::globals::g_Game.level)->surfaceMap,puVar7,param_4,
													 (lego::globals::g_Game.level)->BuildingTolerance,
													 (lego::globals::g_Game.level)->BuildingMaxVariation);
	bVar5 = false;
	bVar4 = false;
	bVar3 = false;
	if (param_4 != 0) {
		local_3a0[2] = 1;
		local_38c = 1;
		local_3a0[0] = 0;
		local_3a0[1] = 0xffffffff;
		local_3a0[3] = 0;
		local_3a0[4] = 0;
		local_388 = 0xffffffff;
		local_384 = 0;
		puVar14 = puVar7 + 1;
		puVar18 = puVar7;
		puVar17 = puVar7;
		do {
			local_3c8 = puVar17 + 2;
			bVar2 = false;
			piVar12 = local_3a0 + 1;
			local_3cc = (uint *)0x4;
			do {
				local_3ac.x = piVar12[-1] + *puVar18;
				local_3ac.y = *puVar14 + *piVar12;
				BVar8 = lego::game::Level_IsBlockPowerPath(&local_3ac);
				if ((BVar8 != 0) && (uVar9 = FUN_00432f60((int *)&local_3ac), uVar9 == 0)) {
					bVar4 = true;
					bVar2 = true;
				}
				piVar12 = piVar12 + 2;
				local_3cc = (uint *)((int)local_3cc + -1);
			} while (local_3cc != NULL);
			if (((uVar15 < param_4 - 1) && (*puVar18 == *local_3c8)) && (*puVar14 == puVar17[3])) {
				if (bVar2) {
					bVar5 = true;
				}
				uVar15 += 1;
				puVar18 = puVar18 + 2;
				puVar14 = puVar14 + 2;
				bVar3 = true;
				local_3c8 = puVar17 + 4;
			}
			uVar15 += 1;
			puVar18 = puVar18 + 2;
			puVar14 = puVar14 + 2;
			puVar17 = local_3c8;
		} while (uVar15 < param_4);
	}
	if (bVar3) {
		bVar4 = bVar5;
	}
	local_3d0 = 0;
	uVar15 = 0;
	if (param_4 != 0) {
		local_3ac.x = param_4 - 1;
		puVar17 = puVar7;
		puVar18 = puVar7;
		do {
			local_3cc = puVar18 + 2;
			if (((local_3d0 < (uint)local_3ac.x) && (*puVar17 == *local_3cc)) &&
				 (puVar17[1] == puVar18[3])) {
				iVar16 = 1;
				local_3c8 = (uint *)0x1;
				if (param_7 + 1U <= local_3c0) goto LAB_0046471f;
			}
			else {
				local_3c8 = NULL;
LAB_0046471f:
				iVar16 = 0;
			}
			iVar10 = FUN_00431a50(*puVar17,puVar17[1],(int)local_3c8,iVar16);
			if (((iVar10 == 0) || (!bVar4)) ||
				 (local_3d8 = (float)FUN_004286b0(param_2), local_3d8 != 0.0)) {
				bVar6 = 0;
				local_3d8 = 0.6;
				local_3d4 = 0.0;
LAB_004647ee:
				local_3c4 = 0.0;
			}
			else {
				if (iVar16 == 0) {
					if (local_3c8 != NULL) {
						local_3d8 = 0.7;
						local_3d4 = 0.7;
						goto LAB_004647ee;
					}
					if (local_3a4 == 0) {
						bVar6 = 0;
						local_3d8 = 0.7;
						local_3d4 = 0.0;
						local_3c4 = 0.7;
					}
					else {
						local_3d8 = 0.0;
						local_3d4 = 0.7;
						local_3c4 = 0.1;
					}
				}
				else {
					local_3d4 = 0.7;
					local_3c4 = 0.9;
				}
			}
			lego::res::Res_SetMeshColorMultiplier
								((ResourceData *)*param_1,local_3c0,local_3d8,local_3d4,local_3c4,0.2);
			lego::res::Res_SetMeshColorUnk
								((ResourceData *)*param_1,local_3c0,local_3d8 * 0.5,local_3d4 * 0.5,local_3c4 * 0.5)
			;
			uVar15 = FUN_00450580((LevelSurfaceMap *)param_6,*puVar17,puVar17[1]);
			if (uVar15 == 0) {
				FUN_00474df0((ResourceData *)*param_1,local_3c0,1);
			}
			else {
				FUN_004504e0((int *)param_6,*puVar17,puVar17[1],local_330);
				iVar16 = 4;
				pfVar11 = local_330 + 2;
				do {
					iVar16 += -1;
					pfVar11[10] = pfVar11[-2];
					pfVar11[0xb] = pfVar11[-1];
					pfVar11[0xc] = *pfVar11;
					*pfVar11 = *pfVar11 - (float)param_1[1];
					pfVar11 = pfVar11 + 3;
				} while (iVar16 != 0);
				FUN_00474f80((ResourceData *)*param_1,local_3c0,0,0x14,(int)local_2d0);
				piVar12 = local_380;
				pfVar11 = local_2d0;
				iVar16 = 5;
				do {
					iVar10 = 4;
					pfVar13 = pfVar11;
					do {
						iVar1 = *piVar12;
						piVar12 = piVar12 + 1;
						pfVar11 = pfVar13 + 9;
						iVar10 += -1;
						*pfVar13 = local_330[iVar1 * 3];
						pfVar13[1] = local_330[iVar1 * 3 + 1];
						pfVar13[2] = local_330[iVar1 * 3 + 2];
						pfVar13 = pfVar11;
					} while (iVar10 != 0);
					iVar16 += -1;
				} while (iVar16 != 0);
				FUN_00474ff0(*param_1,local_3c0,0,0x14,(int)local_2d0);
				FUN_00474df0((ResourceData *)*param_1,local_3c0,0);
			}
			local_3c0 += 1;
			if (local_3c8 != NULL) {
				local_3d0 += 1;
				puVar17 = puVar17 + 2;
				local_3cc = puVar18 + 4;
			}
			local_3d0 += 1;
			puVar17 = puVar17 + 2;
			puVar18 = local_3cc;
			uVar15 = local_3c0;
		} while (local_3d0 < param_4);
	}
	for (; uVar15 < 10; uVar15 = uVar15 + 1) {
		FUN_00474df0((ResourceData *)*param_1,uVar15,1);
	}
	return -(uint)bVar6 & (uint)puVar7;
}



void __cdecl FUN_004649e0(ResourceData **param_1,BOOL use3rdFrame)
{
	lego::res::Res_UnkSetup3DFrameTransform(*param_1,use3rdFrame);
	return;
}



void __cdecl lego::main::Main_Alloc_SFXNames_HashTable(void)
{
	uint uVar1;
	
	globals::g_SampleHashNames_TABLE = (uint *)std::malloc(0x7bc);
	uVar1 = util::hash_string("SFX_NULL",0,1);
	*globals::g_SampleHashNames_TABLE = uVar1;
	uVar1 = util::hash_string("SFX_Stamp",0,1);
	globals::g_SampleHashNames_TABLE[1] = uVar1;
	uVar1 = util::hash_string("SFX_Drill",0,1);
	globals::g_SampleHashNames_TABLE[2] = uVar1;
	uVar1 = util::hash_string("SFX_DrillFade",0,1);
	globals::g_SampleHashNames_TABLE[3] = uVar1;
	uVar1 = util::hash_string("SFX_RockBreak",0,1);
	globals::g_SampleHashNames_TABLE[4] = uVar1;
	uVar1 = util::hash_string("SFX_Drip",0,1);
	globals::g_SampleHashNames_TABLE[5] = uVar1;
	uVar1 = util::hash_string("SFX_Ambient",0,1);
	globals::g_SampleHashNames_TABLE[6] = uVar1;
	uVar1 = util::hash_string("SFX_AmbientLoop",0,1);
	globals::g_SampleHashNames_TABLE[7] = uVar1;
	uVar1 = util::hash_string("SFX_Step",0,1);
	globals::g_SampleHashNames_TABLE[8] = uVar1;
	uVar1 = util::hash_string("SFX_RockMonster",0,1);
	globals::g_SampleHashNames_TABLE[9] = uVar1;
	uVar1 = util::hash_string("SFX_RockMonster2",0,1);
	globals::g_SampleHashNames_TABLE[10] = uVar1;
	uVar1 = util::hash_string("SFX_RockMonsterStep",0,1);
	globals::g_SampleHashNames_TABLE[0xb] = uVar1;
	uVar1 = util::hash_string("SFX_MFDeposit",0,1);
	globals::g_SampleHashNames_TABLE[0xc] = uVar1;
	uVar1 = util::hash_string("SFX_ButtonPressed",0,1);
	globals::g_SampleHashNames_TABLE[0xd] = uVar1;
	uVar1 = util::hash_string("SFX_MFLift",0,1);
	globals::g_SampleHashNames_TABLE[0xe] = uVar1;
	uVar1 = util::hash_string("SFX_MFThrow",0,1);
	globals::g_SampleHashNames_TABLE[0xf] = uVar1;
	uVar1 = util::hash_string("SFX_Walker",0,1);
	globals::g_SampleHashNames_TABLE[0x10] = uVar1;
	uVar1 = util::hash_string("SFX_YesSir",0,1);
	globals::g_SampleHashNames_TABLE[0x11] = uVar1;
	uVar1 = util::hash_string("SFX_Build",0,1);
	globals::g_SampleHashNames_TABLE[0x12] = uVar1;
	uVar1 = util::hash_string("SFX_Okay",0,1);
	globals::g_SampleHashNames_TABLE[0x13] = uVar1;
	uVar1 = util::hash_string("SFX_NotOkay",0,1);
	globals::g_SampleHashNames_TABLE[0x14] = uVar1;
	uVar1 = util::hash_string("SFX_InterfaceSlideOnScreen",0,1);
	globals::g_SampleHashNames_TABLE[0x15] = uVar1;
	uVar1 = util::hash_string("SFX_InterfaceSlideOffScreen",0,1);
	globals::g_SampleHashNames_TABLE[0x16] = uVar1;
	uVar1 = util::hash_string("SFX_PanelSlideOnScreen",0,1);
	globals::g_SampleHashNames_TABLE[0x17] = uVar1;
	uVar1 = util::hash_string("SFX_PanelSlideOffScreen",0,1);
	globals::g_SampleHashNames_TABLE[0x18] = uVar1;
	uVar1 = util::hash_string("SFX_Siren",0,1);
	globals::g_SampleHashNames_TABLE[0x19] = uVar1;
	uVar1 = util::hash_string("SFX_CrystalRecharge",0,1);
	globals::g_SampleHashNames_TABLE[0x1a] = uVar1;
	uVar1 = util::hash_string("SFX_Laser",0,1);
	globals::g_SampleHashNames_TABLE[0x1b] = uVar1;
	uVar1 = util::hash_string("SFX_LaserHit",0,1);
	globals::g_SampleHashNames_TABLE[0x1c] = uVar1;
	uVar1 = util::hash_string("SFX_LazerRecharge",0,1);
	globals::g_SampleHashNames_TABLE[0x1d] = uVar1;
	uVar1 = util::hash_string("SFX_TopPriority",0,1);
	globals::g_SampleHashNames_TABLE[0x1e] = uVar1;
	uVar1 = util::hash_string("SFX_ImmovableRock",0,1);
	globals::g_SampleHashNames_TABLE[0x1f] = uVar1;
	uVar1 = util::hash_string("SFX_Wall",0,1);
	globals::g_SampleHashNames_TABLE[0x20] = uVar1;
	uVar1 = util::hash_string("SFX_Floor",0,1);
	globals::g_SampleHashNames_TABLE[0x21] = uVar1;
	uVar1 = util::hash_string("SFX_BoulderHit",0,1);
	globals::g_SampleHashNames_TABLE[0x22] = uVar1;
	uVar1 = util::hash_string("SFX_Place",0,1);
	globals::g_SampleHashNames_TABLE[0x23] = uVar1;
	uVar1 = util::hash_string("SFX_PlaceOre",0,1);
	globals::g_SampleHashNames_TABLE[0x24] = uVar1;
	uVar1 = util::hash_string("SFX_PlaceCrystal",0,1);
	globals::g_SampleHashNames_TABLE[0x25] = uVar1;
	uVar1 = util::hash_string("SFX_Lava",0,1);
	globals::g_SampleHashNames_TABLE[0x26] = uVar1;
	uVar1 = util::hash_string("SFX_RockWipe",0,1);
	globals::g_SampleHashNames_TABLE[0x27] = uVar1;
	uVar1 = util::hash_string("SFX_FallIn",0,1);
	globals::g_SampleHashNames_TABLE[0x28] = uVar1;
	uVar1 = util::hash_string("SFX_MusicLoop",0,1);
	globals::g_SampleHashNames_TABLE[0x29] = uVar1;
	uVar1 = util::hash_string("SFX_CaptainSlide",0,1);
	globals::g_SampleHashNames_TABLE[0x2a] = uVar1;
	uVar1 = util::hash_string("SFX_Dynamite",0,1);
	globals::g_SampleHashNames_TABLE[0x2b] = uVar1;
	uVar1 = util::hash_string("SFX_AmbientMusicLoop",0,1);
	globals::g_SampleHashNames_TABLE[0x2c] = uVar1;
	res::Res_SetSoundCallback(res::Res_ResourceSoundCallback,0);
	return;
}



void __cdecl
lego::res::Res_ResourceSoundCallback(char *sampleName,ResourceData *resData,void *lpValue)
{
	BOOL BVar1;
	
	BVar1 = snd::Snd_GetSFX(sampleName,(int *)&sampleName);
	if (BVar1 != 0) {
		Res_PlayResourceSound(resData,(int)sampleName,0,1,NULL);
	}
	return;
}



void __cdecl lego::snd::Audio_SetAudioFlag2(BOOL state)
{
	if (state != 0) {
		globals::g_AudioFlags = globals::g_AudioFlags | 2;
		return;
	}
	globals::g_AudioFlags = globals::g_AudioFlags & 0xfffffffd;
	return;
}



BOOL __cdecl lego::snd::Snd_GetSFX(char *sfxName,int *out_index)
{
	uint uVar1;
	uint uVar2;
	uint uVar3;
	uint *puVar4;
	
	if (sfxName != NULL) {
		uVar2 = util::hash_string(sfxName,0,1);
		uVar3 = 0;
		uVar1 = globals::g_SampleHashNames_COUNT + 0x2d;
		puVar4 = globals::g_SampleHashNames_TABLE;
		if (uVar1 != 0) {
			do {
				if (uVar2 == *puVar4) {
					*out_index = uVar3;
					return 1;
				}
				uVar3 += 1;
				puVar4 = puVar4 + 1;
			} while (uVar3 < uVar1);
		}
		if (((byte)globals::g_AudioFlags & 2) != 0) {
			*out_index = uVar1;
			uVar2 = util::hash_string(sfxName,0,1);
			globals::g_SampleHashNames_TABLE[uVar1] = uVar2;
			globals::g_SampleHashNames_COUNT = globals::g_SampleHashNames_COUNT + 1;
			return 1;
		}
	}
	return 0;
}



BOOL __cdecl lego::snd::Sample_LoadProperty(char *value,int index)
{
	char cVar1;
	uint uVar2;
	SampleProperty *pSVar3;
	char cVar4;
	int iVar5;
	char *pcVar6;
	BOOL isStreamed;
	char *pcVar7;
	SampleProperty *pSVar8;
	char **local_1e0;
	int numParts;
	BOOL success;
	SampleProperty *lastItem;
	char pound_buffer [64];
	char *filename_parts [100];
	
	pSVar8 = globals::g_SampleProperties_TABLE + index;
	isStreamed = 0;
	success = 1;
	lastItem = NULL;
	globals::g_SampleProperties_TABLE[index].next = NULL;
	numParts = util::stringSplit(value,filename_parts,",");
	if (numParts != 0) {
		local_1e0 = filename_parts;
		do {
			pcVar7 = *local_1e0;
			cVar1 = *pcVar7;
			if (cVar1 == '*') {
				pcVar7 = pcVar7 + 1;
			}
			iVar5 = 0;
			if (*pcVar7 == '#') {
				cVar4 = pcVar7[1];
				pcVar7 = pcVar7 + 1;
				if (cVar4 != '#') {
					pcVar6 = pound_buffer;
					do {
						*pcVar6 = cVar4;
						cVar4 = pcVar7[1];
						pcVar6 = pcVar6 + 1;
						pcVar7 = pcVar7 + 1;
					} while (cVar4 != '#');
				}
				iVar5 = std::atoi(pound_buffer);
				pcVar7 = pcVar7 + 1;
			}
			if (*pcVar7 == '@') {
				isStreamed = 1;
				pcVar7 = pcVar7 + 1;
			}
			iVar5 = Sample_Load(pcVar7,isStreamed,(uint)(cVar1 == '*'),iVar5);
			pSVar8->sampleIndex = iVar5;
			uVar2 = globals::g_SampleGroups_COUNT;
			if (iVar5 == -1) {
				success = 0;
				pSVar3 = lastItem;
			}
			else {
				pSVar3 = pSVar8;
				if (lastItem != NULL) {
					pSVar8 = globals::g_SampleGroups_TABLE + globals::g_SampleGroups_COUNT;
					globals::g_SampleGroups_COUNT += 1;
					lastItem->next = pSVar8;
					globals::g_SampleGroups_TABLE[uVar2].next = NULL;
					pSVar3 = pSVar8;
				}
			}
			lastItem = pSVar3;
			local_1e0 = local_1e0 + 1;
			numParts += -1;
		} while (numParts != 0);
	}
	return success;
}



int __cdecl lego::snd::Sample_ChooseRandomSound(int propIndex)
{
	SampleProperty *pSVar1;
	SampleProperty *pSVar2;
	int iVar3;
	short sVar4;
	uint uVar5;
	
	uVar5 = 0;
	if (propIndex != 0) {
		if (globals::g_SampleProperties_TABLE[propIndex].next != NULL) {
			pSVar1 = globals::g_SampleProperties_TABLE + propIndex;
			for (pSVar2 = pSVar1; pSVar2 != NULL; pSVar2 = pSVar2->next) {
				uVar5 += 1;
			}
			sVar4 = util::randomInt16();
			pSVar2 = pSVar1;
			for (uVar5 = (uint)(int)sVar4 % uVar5; uVar5 != 0; uVar5 -= 1) {
				pSVar2 = pSVar2->next;
			}
			iVar3 = pSVar2->sampleIndex;
			pSVar2->sampleIndex = pSVar1->sampleIndex;
			pSVar1->sampleIndex = iVar3;
		}
		return globals::g_SampleProperties_TABLE[propIndex].sampleIndex;
	}
	return -1;
}



void __cdecl FUN_00465140(void)
{
	if ((INT_00503b28 != -1) &&
		 ((ushort)((ushort)(lego::globals::g_GlobalSampleDuration < 0.0) << 8 |
							(ushort)(lego::globals::g_GlobalSampleDuration == 0.0) << 0xe) == 0)) {
		lego::snd::Sample_StopSoundBufferInstance(INT_00503b28);
		INT_00503b28 = -1;
		lego::globals::g_GlobalSampleDuration = 0.0;
	}
	return;
}



BOOL __cdecl FUN_00465180(float param_1)
{
	if ((ushort)((ushort)(lego::globals::g_GlobalSampleDuration < 0.0) << 8 |
							(ushort)(lego::globals::g_GlobalSampleDuration == 0.0) << 0xe) != 0) {
		lego::globals::g_GlobalSampleDuration = param_1;
		INT_00503b28 = -1;
		return 1;
	}
	return 0;
}



BOOL __cdecl lego::snd::Snd_FUN_004651b0(int sampleIndex,int *out_param_2)
{
	uint uVar1;
	uint in_EAX;
	uint uVar2;
	float10 fVar3;
	
	uVar1 = (uint)(ushort)((ushort)(globals::g_GlobalSampleDuration < 0.0) << 8 |
												(ushort)(globals::g_GlobalSampleDuration == 0.0) << 0xe);
	uVar2 = in_EAX & 0xffff0000 | uVar1;
	if (uVar1 != 0) {
		Snd_Play_FUN_00465260(sampleIndex,0);
		INT_00503b28 = uVar2;
		if (uVar2 != 0xffffffff) {
			fVar3 = Sample_GetRandomDuration(sampleIndex);
			globals::g_GlobalSampleIndex = sampleIndex;
			globals::g_GlobalSampleDuration = (float)(fVar3 * (float10)25.0);
			if (out_param_2 != NULL) {
				*out_param_2 = INT_00503b28;
			}
			return 1;
		}
	}
	return 0;
}



void __cdecl lego::snd::Audio_AddToSoundQueue1(int index,BOOL mode)
{
	if (globals::g_SoundQueue_Unk1_COUNT < 10) {
		globals::g_SoundQueueIndexes_Unk1_TABLE[globals::g_SoundQueue_Unk1_COUNT] = index;
		globals::g_SoundQueueModes_Unk1_TABLE[globals::g_SoundQueue_Unk1_COUNT] = mode;
		globals::g_SoundQueue_Unk1_COUNT += 1;
	}
	return;
}



void __cdecl lego::snd::Snd_Play_FUN_00465260(int in_sampleIndex,BOOL modeChoice)
{
	Sound3DInstance *pSVar1;
	uint uVar2;
	int sampleIndex;
	
	uVar2 = globals::g_Sound3DInstances_COUNT;
	if (((byte)globals::g_AudioFlags & 8) == 0) {
		if ((in_sampleIndex != 0) && (((byte)globals::g_AudioFlags & 1) != 0)) {
			sampleIndex = Sample_ChooseRandomSound(in_sampleIndex);
			if (sampleIndex != 0) {
				SFX_UnkAdjustVolumeOrPlay___0047b030(2,NULL,sampleIndex,modeChoice,NULL);
			}
		}
	}
	else {
		if (globals::g_Sound3DInstances_COUNT < 10) {
			pSVar1 = globals::g_Sound3DInstances_TABLE + globals::g_Sound3DInstances_COUNT;
			globals::g_Sound3DInstances_COUNT = globals::g_Sound3DInstances_COUNT + 1;
			pSVar1->sampleIndex = in_sampleIndex;
			globals::g_Sound3DInstances_TABLE[uVar2].flags =
					 globals::g_Sound3DInstances_TABLE[uVar2].flags & 0xfffffffe;
			return;
		}
	}
	return;
}



void __cdecl lego::snd::Sample_PlayRandomAtVolume(int sampleIndex,int volume)
{
	int sampleDataIndex;
	
	sampleDataIndex = Sample_ChooseRandomSound(sampleIndex);
	Sample_PlayAtVolume(sampleDataIndex,volume);
	return;
}



int __cdecl lego::snd::Sample_GetRandomVolume(int sampleIndex)
{
	int iVar1;
	
	iVar1 = Sample_ChooseRandomSound(sampleIndex);
	iVar1 = Sample_GetVolume(iVar1);
	return iVar1;
}



void __cdecl
lego::res::Res_PlayResourceSound
					(ResourceData *resData,int sampleIndex,BOOL flag2,BOOL flag4,Vector3F *opt_position)
{
	IDirect3DRMFrame3 *rmFrame3;
	
	if (resData == NULL) {
		rmFrame3 = NULL;
	}
	else {
		rmFrame3 = Res_GetFrame1(resData);
	}
	snd::Snd_PlayOrInitSoundUnk(rmFrame3,sampleIndex,flag2,flag4,opt_position);
	return;
}



int __cdecl
lego::snd::Snd_PlayOrInitSoundUnk
					(IDirect3DRMFrame3 *rmFrame3,int sampleIndex,BOOL flag2,BOOL flag4,Vector3F *opt_position)
{
	Sound3DInstance *pSVar1;
	uint uVar2;
	int iVar3;
	
	uVar2 = globals::g_Sound3DInstances_COUNT;
	if (((byte)globals::g_AudioFlags & 8) == 0) {
		if ((sampleIndex != 0) && (((byte)globals::g_AudioFlags & 1) != 0)) {
			iVar3 = Sample_ChooseRandomSound(sampleIndex);
			if (iVar3 != 0) {
				if (flag4 != 0) {
					iVar3 = SFX_UnkAdjustVolumeOrPlay___0047b030(0,rmFrame3,iVar3,flag2,NULL);
					return iVar3;
				}
				iVar3 = SFX_UnkAdjustVolumeOrPlay___0047b030(1,NULL,iVar3,flag2,opt_position);
				return iVar3;
			}
		}
	}
	else {
		if (globals::g_Sound3DInstances_COUNT < 10) {
			pSVar1 = globals::g_Sound3DInstances_TABLE + globals::g_Sound3DInstances_COUNT;
			globals::g_Sound3DInstances_COUNT = globals::g_Sound3DInstances_COUNT + 1;
			pSVar1->sampleIndex = sampleIndex;
			globals::g_Sound3DInstances_TABLE[uVar2].frame = rmFrame3;
			globals::g_Sound3DInstances_TABLE[uVar2].flags =
					 ((flag4 & 1U) << 1 | flag2 & 1U) << 1 |
					 globals::g_Sound3DInstances_TABLE[uVar2].flags & 0xfffffff9 | 1;
			if (opt_position != NULL) {
				globals::g_Sound3DInstances_TABLE[uVar2].position.x = opt_position->x;
				globals::g_Sound3DInstances_TABLE[uVar2].position.y = opt_position->y;
				globals::g_Sound3DInstances_TABLE[uVar2].position.z = opt_position->z;
				return 0;
			}
		}
	}
	return 0;
}



float10 __cdecl lego::snd::Sample_GetRandomDuration(int sampleIndex)
{
	int sfxIndex;
	float10 fVar1;
	
	sfxIndex = Sample_ChooseRandomSound(sampleIndex);
	if (sfxIndex != 0) {
		fVar1 = Sample_GetDuration(sfxIndex);
		return fVar1;
	}
	return (float10)0.0;
}



void __cdecl lego::snd::Sample_StopSoundBufferInstance(int sampleBufferIndex)
{
	Sample_StopSoundBufferInstance_internal(sampleBufferIndex);
	return;
}



void __cdecl FUN_00465460(float elapsed)
{
	BOOL BVar1;
	int *piVar2;
	BOOL *pBVar3;
	uint uVar4;
	int *piVar5;
	BOOL *pBVar6;
	
	BVar1 = lego::snd::Audio_GetFlag8();
	lego::globals::g_GlobalSampleDuration = lego::globals::g_GlobalSampleDuration - elapsed;
	lego::snd::Audio_FUN_00465590(0,0);
	uVar4 = 0;
	if (lego::globals::g_SoundQueue_Unk2_COUNT != 0) {
		piVar2 = lego::globals::g_SoundQueueIndexes_Unk2_TABLE;
		do {
			lego::snd::Snd_Play_FUN_00465260(*piVar2,piVar2[10]);
			uVar4 += 1;
			piVar2 = piVar2 + 1;
		} while (uVar4 < lego::globals::g_SoundQueue_Unk2_COUNT);
	}
	if (BVar1 != 0) {
		lego::snd::Audio_FUN_00465580_true(1);
	}
	piVar2 = lego::globals::g_SoundQueueIndexes_Unk1_TABLE;
	piVar5 = lego::globals::g_SoundQueueIndexes_Unk2_TABLE;
	for (uVar4 = lego::globals::g_SoundQueue_Unk1_COUNT; uVar4 != 0; uVar4 -= 1) {
		*piVar5 = *piVar2;
		piVar2 = piVar2 + 1;
		piVar5 = piVar5 + 1;
	}
	pBVar3 = lego::globals::g_SoundQueueModes_Unk1_TABLE;
	pBVar6 = lego::globals::g_SoundQueueModes_Unk2_TABLE;
	for (uVar4 = lego::globals::g_SoundQueue_Unk1_COUNT;
			lego::globals::g_SoundQueue_Unk2_COUNT = lego::globals::g_SoundQueue_Unk1_COUNT, uVar4 != 0;
			uVar4 -= 1) {
		*pBVar6 = *pBVar3;
		pBVar3 = pBVar3 + 1;
		pBVar6 = pBVar6 + 1;
	}
	lego::globals::g_SoundQueue_Unk1_COUNT = 0;
	thunk_FUN_0047b650();
	return;
}



void __cdecl thunk_FUN_0047b650(void)
{
	undefined4 *puVar1;
	uint in_ECX;
	undefined4 *puVar2;
	IDirect3DRMFrame3 **ppIVar3;
	uint uStack4;
	
	puVar2 = (undefined4 *)PTR_00507684;
	ppIVar3 = lego::globals::g_SoundBufferFrames_TABLE;
	uStack4 = in_ECX;
	do {
		if (*ppIVar3 != NULL) {
			FUN_0047b6d0(*ppIVar3,0,0);
		}
		ppIVar3 = ppIVar3 + 1;
	} while (ppIVar3 < &DAT_005348d4);
	if (puVar2 != NULL) {
		do {
			puVar1 = (undefined4 *)puVar2[3];
			(**(code **)(*(int *)puVar2[1] + 0x24))((int *)puVar2[1],&uStack4);
			if ((uStack4 & 1) == 0) {
				FUN_0047b4e0(*puVar2,(int *)puVar2[2]);
			}
			puVar2 = puVar1;
		} while (puVar1 != NULL);
	}
	FUN_0047c070(0);
	FUN_0047c070(1);
	return;
}



void __cdecl lego::snd::Audio_SetFlag1_AndOtherFunc(BOOL isSoundOn,BOOL param_2)
{
	if (isSoundOn != 0) {
		globals::g_AudioFlags = globals::g_AudioFlags | 1;
		return;
	}
	globals::g_AudioFlags &= 0xfffffffe;
	if (param_2 != 0) {
		FUN_0047b420();
	}
	globals::g_GlobalSampleIndex = 0;
	return;
}



void __cdecl lego::snd::Audio_SetFlag1_AndOtherFunc_true(BOOL isSoundOn)
{
	Audio_SetFlag1_AndOtherFunc(isSoundOn,1);
	return;
}



BOOL __cdecl lego::snd::Audio_GetFlag8(void)
{
	return globals::g_AudioFlags & 8;
}



void __cdecl lego::snd::Audio_FUN_00465580_true(BOOL setFlag8)
{
	Audio_FUN_00465590(setFlag8,1);
	return;
}



void __cdecl lego::snd::Audio_FUN_00465590(BOOL setFlag8,BOOL doSomething)
{
	uint uVar1;
	uint *puVar2;
	uint uVar3;
	
	if (setFlag8 != 0) {
		globals::g_AudioFlags = globals::g_AudioFlags | 8;
		return;
	}
	globals::g_AudioFlags &= 0xfffffff7;
	if (doSomething != 0) {
		uVar3 = 0;
		if (globals::g_Sound3DInstances_COUNT != 0) {
			puVar2 = &globals::g_Sound3DInstances_TABLE[0].flags;
			do {
				uVar1 = *puVar2;
				if ((uVar1 & 1) == 0) {
					Snd_Play_FUN_00465260(puVar2[-5],(int)(uVar1 << 0x1e) >> 0x1f);
				}
				else {
					Snd_PlayOrInitSoundUnk
										((IDirect3DRMFrame3 *)puVar2[-4],puVar2[-5],(int)(uVar1 << 30) >> 31,
										 (int)(uVar1 << 29) >> 31,(Vector3F *)(puVar2 + -3));
				}
				uVar3 += 1;
				puVar2 = puVar2 + 6;
			} while (uVar3 < globals::g_Sound3DInstances_COUNT);
		}
		globals::g_Sound3DInstances_COUNT = 0;
	}
	return;
}



BOOL __cdecl lego::snd::Audio_GetFlag1(void)
{
	return globals::g_AudioFlags & 1;
}



BOOL __cdecl lego::main::Main_InitSmokeAnim_empty(void)
{
	globals::g_SmokeAnimFrames_ptr1_UNK = NULL;
	globals::g_SmokeAnimFrames_ptr2_UNK = NULL;
	globals::g_SmokeAnimeFrames_COUNT = 0;
	return 1;
}



void __cdecl lego::main::Main_LoadSmokeAnim(char *dirname,char *filebaseName,uint frames)
{
	int **ppiVar1;
	uint uVar2;
	void **ppvVar3;
	char local_208 [260];
	char local_104 [260];
	
	uVar2 = 0;
	globals::g_SmokeAnimeFrames_COUNT = frames;
	if (frames != 0) {
		ppvVar3 = globals::g_SmokeAnimFrames_TABLE;
		do {
			std::sprintf(local_104,"%s\\",dirname);
			std::sprintf(local_208,"%s%i.bmp",filebaseName,uVar2);
			ppiVar1 = draw::Draw_LoadAnimFrame(local_104,local_208,0,0);
			*ppvVar3 = ppiVar1;
			uVar2 += 1;
			ppvVar3 = (int **)ppvVar3 + 1;
		} while (uVar2 < frames);
	}
	return;
}



int * __cdecl
FUN_004656f0(int param_1,uint param_2,uint param_3,int *param_4,float param_5,float param_6,
						float param_7,float param_8,int param_9,int param_10,uint param_11,int param_12)
{
	float fVar1;
	float fVar2;
	short sVar3;
	int *piVar4;
	LevelSurfaceMap *surfMap;
	ResourceData *pRVar5;
	Struct_34 *pSVar6;
	short extraout_var;
	short extraout_var_00;
	int iVar7;
	int *piVar8;
	uint uVar9;
	uint uVar10;
	float10 fVar11;
	ulonglong uVar12;
	longlong lVar13;
	float local_24;
	float local_20;
	float local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	uVar10 = 0;
	local_18 = 0;
	local_14 = 3;
	local_10 = 2;
	local_c = 2;
	local_8 = 1;
	local_4 = 0;
	piVar4 = (int *)std::malloc(0x2a8);
	piVar8 = piVar4;
	for (iVar7 = 0xaa; iVar7 != 0; iVar7 += -1) {
		*piVar8 = 0;
		piVar8 = piVar8 + 1;
	}
	if ((param_10 == 0) || (param_10 == 2)) {
		surfMap = lego::game::GetSurfaceMap();
		pRVar5 = lego::res::GetRoot();
		uVar12 = __ftol((float10)surfMap->BlockSize * (float10)0.6);
		FUN_0044f900(surfMap,param_2,param_3,&local_24,&local_20);
		fVar1 = (float)(uVar12 & 0xffffffff) * 0.5;
		local_24 = ((float)(((ulonglong)param_11 % 0x109e) % (uVar12 & 0xffffffff)) - fVar1) + local_24;
		local_20 = ((float)(((ulonglong)param_11 % 0x5eb) % (uVar12 & 0xffffffff)) - fVar1) + local_20;
		fVar11 = lego::game::SurfaceMap_UnkGetZ(surfMap,local_24,local_20);
		local_1c = (float)fVar11;
		pRVar5 = lego::pool::ReservedPool_ResourceData___Next(pRVar5);
		piVar4[0xa3] = (int)pRVar5;
		lego::res::Res_SetFramePosition(pRVar5,NULL,local_24,local_20,local_1c);
		piVar4[0xa5] = 2;
		piVar4[0x97] = (int)local_24;
		piVar4[0x98] = (int)local_20;
		piVar4[0x99] = (int)local_1c;
		if ((param_11 & 3) == 0) {
			piVar4[0xa8] = param_12;
		}
	}
	else {
		if (param_10 == 1) {
			piVar4[0xa5] = 4;
			piVar4[0xa3] = param_1;
		}
	}
	piVar4[0x9a] = *param_4;
	fVar1 = (float)param_4[1];
	piVar4[0x9b] = (int)fVar1;
	fVar2 = (float)param_4[2];
	piVar4[0x9c] = (int)fVar2;
	fVar1 = 1.0 / SQRT((float)piVar4[0x9a] * (float)piVar4[0x9a] + fVar2 * fVar2 + fVar1 * fVar1);
	piVar4[0x9a] = (int)(fVar1 * (float)piVar4[0x9a]);
	piVar4[0x9b] = (int)(fVar1 * (float)piVar4[0x9b]);
	piVar4[0x9c] = (int)(fVar1 * (float)piVar4[0x9c]);
	piVar4[0x9d] = (int)param_5;
	piVar4[0x9e] = (int)param_6;
	piVar4[0x9f] = (int)param_7;
	if (param_10 == 2) {
		piVar4[0xa0] = 4;
		piVar4[0xa1] = 0;
		piVar4[0xa5] = piVar4[0xa5] | 8;
		piVar4[0xa2] = 0x40000000;
	}
	else {
		if (((ushort)((ushort)(param_8 < 0.0) << 8 | (ushort)(param_8 == 0.0) << 0xe) == 0) ||
			 (param_8 < 1.0)) {
			lVar13 = __ftol((float10)param_8 * (float10)10.0);
			piVar4[0xa0] = (int)lVar13;
		}
		else {
			piVar4[0xa0] = 10;
		}
		piVar4[0xa2] = param_9;
	}
	pSVar6 = lego::res::Res_Unk_CreateUserVisualStruct34
										 (*(IDirect3DRMFrame3 **)(piVar4[0xa3] + 4),&LAB_004661a0,0x4800,piVar4,0);
	piVar4[0xa4] = (int)pSVar6;
	if (piVar4[0xa0] != 0) {
		do {
			iVar7 = FUN_004824e0((Struct_34 *)piVar4[0xa4],4,2,3,(undefined2 *)&local_18);
			piVar8 = piVar4 + iVar7 * 0xf;
			FUN_00483380((Struct_34 *)piVar4[0xa4],iVar7,
									 (undefined **)
									 lego::globals::g_SmokeAnimFrames_TABLE
									 [uVar10 % lego::globals::g_SmokeAnimeFrames_COUNT]);
			FUN_00483530((Struct_34 *)piVar4[0xa4],iVar7,param_5,param_6,param_7,0);
			FUN_00483530((Struct_34 *)piVar4[0xa4],iVar7,param_5 * 0.2,param_6 * 0.2,param_7 * 0.2,3);
			FUN_00482a60((Struct_34 *)piVar4[0xa4],iVar7,1);
			sVar3 = lego::util::randomInt16();
			uVar9 = (int)extraout_var >> 0xf;
			piVar8[10] = (int)((float)(((CONCAT22(extraout_var,sVar3) ^ uVar9) - uVar9 & 3 ^ uVar9) -
																uVar9) - -6.0);
			sVar3 = lego::util::randomInt16();
			uVar9 = (int)extraout_var_00 >> 0xf;
			fVar1 = ((float)(((CONCAT22(extraout_var_00,sVar3) ^ uVar9) - uVar9 & 3 ^ uVar9) - uVar9) +
							(float)piVar8[10]) - -2.0;
			piVar8[0xb] = (int)fVar1;
			if ((*(byte *)(piVar4 + 0xa5) & 8) == 0) {
				piVar8[10] = (int)((float)piVar8[10] * 0.5);
			}
			else {
				piVar8[0xb] = (int)(fVar1 + fVar1);
			}
			uVar10 += 1;
		} while (uVar10 < (uint)piVar4[0xa0]);
	}
	piVar4[0x96] = 0;
	if (param_10 != 2) {
		iVar7 = 10;
		do {
			if ((ushort)((ushort)((float)piVar4[0x96] < 0.0) << 8 |
									(ushort)((float)piVar4[0x96] == 0.0) << 0xe) != 0) {
				uVar10 = 0;
				piVar8 = piVar4;
				if (piVar4[0xa0] != 0) {
					do {
						if (*piVar8 == 0) {
							FUN_00465f10((int)piVar4,uVar10);
							break;
						}
						uVar10 += 1;
						piVar8 = piVar8 + 0xf;
					} while (uVar10 < (uint)piVar4[0xa0]);
				}
			}
			uVar10 = 0;
			piVar4[0x96] = (int)((float)piVar4[0x96] - 5.0);
			piVar8 = piVar4;
			if (piVar4[0xa0] != 0) {
				do {
					if (*piVar8 != 0) {
						FUN_004660c0((int)piVar4,uVar10,5.0);
					}
					uVar10 += 1;
					piVar8 = piVar8 + 0xf;
				} while (uVar10 < (uint)piVar4[0xa0]);
			}
			iVar7 += -1;
		} while (iVar7 != 0);
	}
	piVar4[0xa7] = (int)lego::globals::g_SmokeAnimFrames_ptr2_UNK;
	if (lego::globals::g_SmokeAnimFrames_ptr1_UNK != NULL) {
		*(int **)((int)lego::globals::g_SmokeAnimFrames_ptr2_UNK + 0x298) = piVar4;
		lego::globals::g_SmokeAnimFrames_ptr2_UNK = piVar4;
		return piVar4;
	}
	lego::globals::g_SmokeAnimFrames_ptr1_UNK = piVar4;
	lego::globals::g_SmokeAnimFrames_ptr2_UNK = piVar4;
	return piVar4;
}



void __cdecl FUN_00465c30(void)
{
	undefined *puVar1;
	undefined *puVar2;
	
	puVar2 = (undefined *)lego::globals::g_SmokeAnimFrames_ptr1_UNK;
	if (lego::globals::g_SmokeAnimFrames_ptr1_UNK != NULL) {
		do {
			puVar1 = *(undefined **)(puVar2 + 0x298);
			FUN_00465c70(puVar2,*(int *)(puVar2 + 0x28c));
			puVar2 = puVar1;
		} while (puVar1 != NULL);
	}
	lego::globals::g_SmokeAnimFrames_ptr1_UNK = NULL;
	return;
}



void __cdecl FUN_00465c70(undefined *param_1,int param_2)
{
	if ((param_1[0x294] & 2) == 0) {
		FUN_00482390(*(Struct_34 **)(param_1 + 0x290),*(IDirect3DRMFrame3 **)(param_2 + 4));
	}
	else {
		FUN_00482390(*(Struct_34 **)(param_1 + 0x290),
								 *(IDirect3DRMFrame3 **)(*(int *)(param_1 + 0x28c) + 4));
		lego::pool::ReservedPool_ResourceData___Release(*(ResourceData **)(param_1 + 0x28c));
	}
	if ((undefined *)lego::globals::g_SmokeAnimFrames_ptr2_UNK == param_1) {
		lego::globals::g_SmokeAnimFrames_ptr2_UNK = *(void **)(param_1 + 0x29c);
		if (lego::globals::g_SmokeAnimFrames_ptr2_UNK == NULL) {
			lego::globals::g_SmokeAnimFrames_ptr1_UNK = lego::globals::g_SmokeAnimFrames_ptr2_UNK;
			std::free(param_1);
			return;
		}
	}
	if (*(int *)(param_1 + 0x298) != 0) {
		*(undefined4 *)(*(int *)(param_1 + 0x298) + 0x29c) = *(undefined4 *)(param_1 + 0x29c);
		if (*(int *)((int)*(void **)(param_1 + 0x298) + 0x29c) == 0) {
			lego::globals::g_SmokeAnimFrames_ptr1_UNK = *(void **)(param_1 + 0x298);
		}
	}
	if (*(int *)(param_1 + 0x29c) != 0) {
		*(undefined4 *)(*(int *)(param_1 + 0x29c) + 0x298) = *(undefined4 *)(param_1 + 0x298);
	}
	if (*(int *)(param_1 + 0x2a4) != 0) {
		lego::snd::Sample_StopSoundBufferInstance(*(int *)(param_1 + 0x2a4));
	}
	std::free(param_1);
	return;
}



void __cdecl FUN_00465d50(BOOL param_1)
{
	void **ppvVar1;
	void *pvVar2;
	
	pvVar2 = lego::globals::g_SmokeAnimFrames_ptr1_UNK;
	if (lego::globals::g_SmokeAnimFrames_ptr1_UNK != NULL) {
		do {
			FUN_00465d80((int)pvVar2,param_1);
			ppvVar1 = (void **)((int)pvVar2 + 0x298);
			pvVar2 = *ppvVar1;
		} while (*ppvVar1 != NULL);
	}
	return;
}



void __cdecl FUN_00465d80(int param_1,int param_2)
{
	FUN_00482a90(*(int *)(param_1 + 0x290),param_2);
	if (param_2 != 0) {
		*(uint *)(param_1 + 0x294) = *(uint *)(param_1 + 0x294) | 1;
		return;
	}
	*(uint *)(param_1 + 0x294) = *(uint *)(param_1 + 0x294) & 0xfffffffe;
	return;
}



void __cdecl FUN_00465dc0(float param_1)
{
	int *piVar1;
	bool bVar2;
	Vector3F *opt_position;
	uint uVar3;
	int *piVar4;
	int *piVar5;
	
	piVar5 = (int *)lego::globals::g_SmokeAnimFrames_ptr1_UNK;
	if (lego::globals::g_SmokeAnimFrames_ptr1_UNK != NULL) {
		do {
			piVar1 = (int *)piVar5[0xa6];
			bVar2 = true;
			if (((*(byte *)(piVar5 + 0xa5) & 0x20) == 0) && (piVar5[0xa9] == 0)) {
				if (piVar5[0xa8] != 0) {
					opt_position = (Vector3F *)(piVar5 + 0x97);
					lego::res::Res_PlayResourceSound(NULL,piVar5[0xa8],1,0,opt_position);
					piVar5[0xa9] = (int)opt_position;
				}
				if (piVar5[0xa9] == 0) {
					piVar5[0xa5] = piVar5[0xa5] | 0x20;
				}
			}
			uVar3 = piVar5[0xa5];
			if ((uVar3 & 1) == 0) {
				if (((uVar3 & 8) == 0) || ((uVar3 & 0x10) == 0)) {
					if ((ushort)((ushort)((float)piVar5[0x96] < 0.0) << 8 |
											(ushort)((float)piVar5[0x96] == 0.0) << 0xe) != 0) {
						uVar3 = 0;
						piVar4 = piVar5;
						if (piVar5[0xa0] != 0) {
							do {
								if (*piVar4 == 0) {
									FUN_00465f10((int)piVar5,uVar3);
									break;
								}
								uVar3 += 1;
								piVar4 = piVar4 + 0xf;
							} while (uVar3 < (uint)piVar5[0xa0]);
						}
					}
					piVar5[0x96] = (int)((float)piVar5[0x96] - param_1);
				}
				uVar3 = 0;
				piVar4 = piVar5;
				if (piVar5[0xa0] != 0) {
					do {
						if (*piVar4 != 0) {
							FUN_004660c0((int)piVar5,uVar3,param_1);
							bVar2 = false;
						}
						uVar3 += 1;
						piVar4 = piVar4 + 0xf;
					} while (uVar3 < (uint)piVar5[0xa0]);
				}
				if ((((piVar5[0xa5] & 8U) != 0) && ((piVar5[0xa5] & 0x10U) != 0)) && (bVar2)) {
					FUN_00465c70((undefined *)piVar5,piVar5[0xa3]);
				}
			}
			piVar5 = piVar1;
		} while (piVar1 != NULL);
	}
	return;
}



int __cdecl FUN_00465f10(int param_1,int param_2)
{
	undefined4 *puVar1;
	longlong lVar2;
	float fVar3;
	short sVar4;
	short extraout_var;
	Vector3F local_18;
	Vector3F local_c;
	
	puVar1 = (undefined4 *)(param_1 + param_2 * 0x3c);
	if ((*(uint *)(param_1 + 0x294) & 8) != 0) {
		if (*(int *)(param_1 + 0x284) == 3) {
			*(uint *)(param_1 + 0x294) = *(uint *)(param_1 + 0x294) | 0x10;
		}
		*(int *)(param_1 + 0x284) = *(int *)(param_1 + 0x284) + 1;
	}
	*puVar1 = 1;
	FUN_00482a60(*(Struct_34 **)(param_1 + 0x290),param_2,0);
	lego::math::Vector3_Random(&local_18);
	local_18.z = -ABS(local_18.z) * 0.17 - 0.83;
	puVar1[1] = local_18.x * 0.17;
	puVar1[2] = local_18.y * 0.17;
	puVar1[3] = local_18.z;
	local_18.z = *(float *)(param_1 + 0x270) + local_18.z;
	fVar3 = -*(float *)(param_1 + 0x288) / local_18.z;
	local_18.z = fVar3 * local_18.z;
	local_18.x = fVar3 * (*(float *)(param_1 + 0x268) + local_18.x * 0.17);
	local_18.y = fVar3 * (*(float *)(param_1 + 0x26c) + local_18.y * 0.17);
	*(undefined4 *)(param_1 + 0x294) = 4;
	lego::res::Res_GetPosition(*(ResourceData **)(param_1 + 0x28c),NULL,&local_c);
	puVar1[7] = local_c.x;
	puVar1[0xc] = 0;
	puVar1[0xe] = 0;
	puVar1[8] = local_c.y;
	puVar1[9] = local_c.z;
	puVar1[4] = local_18.x;
	puVar1[5] = local_18.y;
	puVar1[6] = local_18.z;
	sVar4 = lego::util::randomInt16();
	lVar2 = CONCAT44((int)extraout_var >> 0xf,CONCAT22(extraout_var,sVar4));
	puVar1[0xd] = (int)(lVar2 % 0x1e) + 0x28;
	*(float *)(param_1 + 600) = (0.5 / *(float *)(param_1 + 0x288)) * (float)puVar1[0xb];
	return (int)(lVar2 / 0x1e);
}



void __cdecl FUN_004660c0(int param_1,int param_2,float param_3)
{
	undefined4 *puVar1;
	float fVar2;
	
	fVar2 = *(float *)(param_1 + 0x14 + param_2 * 0x3c);
	puVar1 = (undefined4 *)(param_1 + param_2 * 0x3c);
	puVar1[7] = *(float *)(param_1 + 0x10 + param_2 * 0x3c) * param_3 + (float)puVar1[7];
	puVar1[8] = (float)puVar1[8] + fVar2 * param_3;
	puVar1[9] = (float)puVar1[9] + (float)puVar1[6] * param_3;
	fVar2 = ABS((float)puVar1[6] * param_3) + (float)puVar1[0xe];
	puVar1[0xe] = fVar2;
	if ((float)puVar1[0xd] <= fVar2) {
		*puVar1 = 0;
		FUN_00482a60(*(Struct_34 **)(param_1 + 0x290),param_2,1);
		return;
	}
	puVar1[0xc] = param_3 + (float)puVar1[0xc];
	FUN_004836e0(*(Struct_34 **)(param_1 + 0x290),param_2,0.7 - (fVar2 / (float)puVar1[0xd]) * 0.7,4);
	return;
}



void __cdecl FUN_00466200(int param_1,int param_2,int param_3,float *param_4)
{
	int iVar1;
	float fVar2;
	float fVar3;
	ResourceData *resData;
	Vector3F local_80;
	Vector3F local_74;
	float local_68;
	float local_64;
	float local_60;
	float local_5c;
	float local_58;
	float local_54;
	float local_50;
	float local_4c;
	float local_48;
	float local_44;
	float local_40;
	float local_3c;
	Vector3F local_38;
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	Vector3F local_c;
	
	local_2c = 0;
	local_28 = 0x3f800000;
	local_24 = 0;
	local_20 = 0;
	local_1c = 0x3f800000;
	local_18 = 0;
	local_14 = 0x3f800000;
	local_10 = 0x3f800000;
	iVar1 = param_1 + param_2 * 0x3c;
	resData = (ResourceData *)FUN_00477230(param_3);
	lego::res::Res_GetOrientation(resData,NULL,&local_38,&local_c);
	local_74.y = local_38.x * -1.0 - 0.0;
	local_74.x = 0.0 - local_38.y * -1.0;
	local_80.x = 0.0;
	local_80.y = 0.0;
	local_80.z = -1.0;
	local_74.z = 0.0;
	if ((ushort)((ushort)(local_38.z < 0.3) << 8 | (ushort)(local_38.z == 0.3) << 0xe) == 0) {
		lego::math::Vector3_Rotate(&local_80,&local_80,&local_74,0.7);
	}
	fVar3 = *(float *)(iVar1 + 0x38) / (float)*(int *)(iVar1 + 0x34) - -1.0;
	fVar2 = *(float *)(iVar1 + 0x28) * fVar3;
	fVar3 = *(float *)(iVar1 + 0x2c) * fVar3;
	local_74.x = fVar2 * local_74.x;
	local_74.y = fVar2 * local_74.y;
	local_74.z = fVar2 * local_74.z;
	local_68 = *(float *)(iVar1 + 0x1c) + local_74.x;
	local_5c = *(float *)(iVar1 + 0x1c) - local_74.x;
	local_64 = *(float *)(iVar1 + 0x20) + local_74.y;
	local_58 = *(float *)(iVar1 + 0x20) - local_74.y;
	local_80.x = fVar3 * local_80.x;
	local_60 = *(float *)(iVar1 + 0x24) + local_74.z;
	local_54 = *(float *)(iVar1 + 0x24) - local_74.z;
	local_80.y = fVar3 * local_80.y;
	local_80.z = fVar3 * local_80.z;
	local_50 = local_5c - local_80.x;
	local_44 = local_68 - local_80.x;
	local_4c = local_58 - local_80.y;
	local_40 = local_64 - local_80.y;
	local_48 = local_54 - local_80.z;
	local_3c = local_60 - local_80.z;
	FUN_004827c0(*(int *)(param_1 + 0x290),param_2,0,4,(int)&local_68,param_4,&local_2c);
	return;
}



void __cdecl lego::game::Level_AllocBlocksStruct_c_Table(LevelData *level)
{
	uint uVar1;
	int iVar2;
	undefined4 *puVar3;
	
	globals::g_Level_BlocksStruct_c_TABLE =
			 std::malloc((level->dimensions).width * (level->dimensions).height * 0xc);
	if ((undefined4 *)globals::g_Level_BlocksStruct_c_TABLE != NULL) {
		puVar3 = (undefined4 *)globals::g_Level_BlocksStruct_c_TABLE;
		for (uVar1 = (level->dimensions).width * (level->dimensions).height * 3 & 0x3fffffff; uVar1 != 0
				; uVar1 -= 1) {
			*puVar3 = 0;
			puVar3 = puVar3 + 1;
		}
		for (iVar2 = 0; iVar2 != 0; iVar2 += -1) {
			*(undefined *)puVar3 = 0;
			puVar3 = (undefined4 *)((int)puVar3 + 1);
		}
	}
	LEVELDATA_005530ec = level;
	return;
}



void __cdecl lego::game::Level_FreeBlocksStruct_c_Table(void)
{
	if (globals::g_Level_BlocksStruct_c_TABLE != NULL) {
		std::free(globals::g_Level_BlocksStruct_c_TABLE);
		globals::g_Level_BlocksStruct_c_TABLE = NULL;
	}
	return;
}



void __cdecl lego::game::Level_Start(LevelData *level)
{
	Level_FreeBlocksStruct_c_Table();
	Level_AllocBlocksStruct_c_Table(level);
	return;
}



BOOL __cdecl lego::game::Level_DoSomethingBlockStruct_c__00466510(uint x,uint y)
{
	int iVar1;
	uint y_00;
	BOOL BVar2;
	LiveObject *pLVar3;
	float local_8;
	float local_4;
	
	y_00 = y;
	if ((*(uint *)((int)globals::g_Level_BlocksStruct_c_TABLE +
								((LEVELDATA_005530ec->dimensions).width * y + x) * 0xc + 8) & 0x100) == 0) {
		BVar2 = Level_DoSomethingBlock_004666b0(x,y,&y);
		if (BVar2 != 0) {
			FUN_0044f900(LEVELDATA_005530ec->surfaceMap,x,y_00,&local_8,&local_4);
			pLVar3 = Game_CreateLiveResourceObject
												 (globals::g_Game.RES_SpiderWeb,OBJECT_SPIDERWEB,0,0,local_8,local_4,
													(float)y);
			Level_SetBlockStruct_c_Value(x,y_00,pLVar3);
			iVar1 = *(int *)((int)globals::g_Level_BlocksStruct_c_TABLE +
											((LEVELDATA_005530ec->dimensions).width * y_00 + x) * 0xc);
			*(uint *)(iVar1 + 0x3e0) = *(uint *)(iVar1 + 0x3e0) | 0x100;
			res::Res_ResourceShortNormal_FUN_00473630
								(*(ResourceData **)
									(*(int *)((int)globals::g_Level_BlocksStruct_c_TABLE +
													 ((LEVELDATA_005530ec->dimensions).width * y_00 + x) * 0xc) + 0x1c),
								 "Expand");
			res::Res_DoCallbacks
								(*(ResourceData **)
									(*(int *)((int)globals::g_Level_BlocksStruct_c_TABLE +
													 ((LEVELDATA_005530ec->dimensions).width * y_00 + x) * 0xc) + 0x1c),0.0);
			return 1;
		}
	}
	return 0;
}



void __cdecl lego::game::Level_SetBlockStruct_c_Value(int x,int y,undefined4 param_3)
{
	uint *puVar1;
	
	*(undefined4 *)
	 ((int)globals::g_Level_BlocksStruct_c_TABLE +
	 ((LEVELDATA_005530ec->dimensions).width * y + x) * 0xc) = param_3;
	puVar1 = (uint *)((int)globals::g_Level_BlocksStruct_c_TABLE +
									 ((LEVELDATA_005530ec->dimensions).width * y + x) * 0xc + 8);
	*puVar1 = *puVar1 | 0x100;
	*(undefined **)
	 ((int)globals::g_Level_BlocksStruct_c_TABLE +
	 ((LEVELDATA_005530ec->dimensions).width * y + x) * 0xc + 4) = &DAT_42c80000;
	return;
}



BOOL __cdecl lego::game::Level_DoSomethingBlock_004666b0(int x,int y,undefined4 *param_3)
{
	int iVar1;
	LevelBlock *pLVar2;
	int iVar3;
	
	iVar1 = (LEVELDATA_005530ec->dimensions).width;
	pLVar2 = LEVELDATA_005530ec->blocks;
	iVar3 = y * iVar1 + x;
	if ((*(byte *)&pLVar2[iVar3].flags1 & 8) == 0) {
		return 0;
	}
	if (((*(byte *)&(pLVar2 + iVar3)[1].flags1 & 0x10) == 0) ||
		 ((*(byte *)&(pLVar2 + iVar3)[-1].flags1 & 0x10) == 0)) {
		if ((*(byte *)&pLVar2[(y + 1) * iVar1 + x].flags1 & 0x10) == 0) {
			return 0;
		}
		if ((*(byte *)&pLVar2[(y + -1) * iVar1 + x].flags1 & 0x10) == 0) {
			return 0;
		}
		if (param_3 != NULL) {
			*param_3 = 0;
		}
	}
	else {
		if (param_3 != NULL) {
			*param_3 = 0x3fc90fdb;
			return 1;
		}
	}
	return 1;
}



BOOL __cdecl FUN_00466750(LiveObject *liveObj)
{
	LiveObject *pLVar1;
	BOOL BVar2;
	int iVar3;
	uint local_24;
	Point2F local_20;
	float local_18;
	float local_14;
	undefined4 local_10;
	float local_c;
	float local_8;
	undefined4 local_4;
	
	pLVar1 = liveObj;
	BVar2 = lego::game::LiveObject_GetBlockCoordinates(liveObj,(int *)&local_24,(int *)&liveObj);
	if (BVar2 != 0) {
		if ((*(uint *)((int)lego::globals::g_Level_BlocksStruct_c_TABLE +
									((LEVELDATA_005530ec->dimensions).width * (int)liveObj + local_24) * 0xc + 8) &
				0x100) != 0) {
			FUN_0044f900(LEVELDATA_005530ec->surfaceMap,local_24,(uint)liveObj,&local_c,&local_8);
			FUN_00442560(*(LiveObject **)
										((int)lego::globals::g_Level_BlocksStruct_c_TABLE +
										((LEVELDATA_005530ec->dimensions).width * (int)liveObj + local_24) * 0xc),
									 &local_20);
			local_18 = local_20.x;
			local_14 = local_20.y;
			local_4 = 0;
			local_10 = 0;
			iVar3 = FUN_00470520((undefined4 *)pLVar1,&local_c,&local_18,0);
			if (iVar3 != 0) {
				pLVar1->flags1_3e0 = pLVar1->flags1_3e0 | 0x2000000;
				iVar3 = *(int *)((int)lego::globals::g_Level_BlocksStruct_c_TABLE +
												((LEVELDATA_005530ec->dimensions).width * (int)liveObj + local_24) * 0xc);
				*(uint *)(iVar3 + 0x3e0) = *(uint *)(iVar3 + 0x3e0) | 0x2000000;
				return 1;
			}
		}
	}
	return 0;
}



void __cdecl FUN_00466880(undefined param_1)
{
	FUN_00437a70(FUN_004668a0,(LiveObject *)&param_1);
	return;
}



undefined4 __cdecl FUN_004668a0(LiveObject *liveObj,float *param_2)
{
	void *pvVar1;
	LiveObject *pLVar2;
	BOOL BVar3;
	int iVar4;
	uint weaponType;
	float10 fVar5;
	LiveObject *liveObj_00;
	int local_4;
	
	pLVar2 = liveObj;
	if (liveObj->objType == OBJECT_SPIDERWEB) {
		lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_4,(int *)&liveObj);
		if (((*(uint *)((int)lego::globals::g_Level_BlocksStruct_c_TABLE +
									 ((LEVELDATA_005530ec->dimensions).width * (int)liveObj + local_4) * 0xc + 8) &
				 0x100) != 0) &&
			 (BVar3 = lego::game::Level_DoSomethingBlock_004666b0(local_4,(int)liveObj,NULL), BVar3 == 0))
		{
			FUN_00466a10(local_4,(int)liveObj);
			return 0;
		}
	}
	else {
		if ((liveObj->flags1_3e0 & 0x2000000) != LIVEOBJ1_NONE) {
			lego::game::LiveObject_GetBlockCoordinates(liveObj,&local_4,(int *)&liveObj);
			pvVar1 = lego::globals::g_Level_BlocksStruct_c_TABLE;
			iVar4 = (LEVELDATA_005530ec->dimensions).width * (int)liveObj + local_4;
			if ((*(uint *)((int)lego::globals::g_Level_BlocksStruct_c_TABLE + iVar4 * 0xc + 8) & 0x100) !=
					0) {
				liveObj_00 = pLVar2;
				weaponType = lego::game::Game_GetWeaponType("SpiderWeb");
				fVar5 = lego::game::Weapon_GetWeaponFloat12c4(weaponType,liveObj_00);
				*(float *)((int)lego::globals::g_Level_BlocksStruct_c_TABLE +
									((LEVELDATA_005530ec->dimensions).width * (int)liveObj + local_4) * 0xc + 4) =
						 (float)((float10)*(float *)((int)pvVar1 + iVar4 * 0xc + 4) - fVar5 * (float10)*param_2)
				;
				if (0.0 <= *(float *)((int)lego::globals::g_Level_BlocksStruct_c_TABLE +
														 ((LEVELDATA_005530ec->dimensions).width * (int)liveObj + local_4) * 0xc
														 + 4)) {
					return 0;
				}
				FUN_00466a10(local_4,(int)liveObj);
			}
			pLVar2->flags1_3e0 = pLVar2->flags1_3e0 & 0xfdffffff;
			return 0;
		}
		FUN_00466750(liveObj);
	}
	return 0;
}



void __cdecl FUN_00466a10(int param_1,int param_2)
{
	int iVar1;
	
	iVar1 = *(int *)((int)lego::globals::g_Level_BlocksStruct_c_TABLE +
									((LEVELDATA_005530ec->dimensions).width * param_2 + param_1) * 0xc);
	*(uint *)(iVar1 + 1000) = *(uint *)(iVar1 + 1000) | 0x800000;
	iVar1 = *(int *)((int)lego::globals::g_Level_BlocksStruct_c_TABLE +
									((LEVELDATA_005530ec->dimensions).width * param_2 + param_1) * 0xc);
	*(uint *)(iVar1 + 0x3e0) = *(uint *)(iVar1 + 0x3e0) & 0xfdffffff;
	iVar1 = (LEVELDATA_005530ec->dimensions).width * param_2 + param_1;
	*(uint *)((int)lego::globals::g_Level_BlocksStruct_c_TABLE + iVar1 * 0xc + 8) =
			 *(uint *)((int)lego::globals::g_Level_BlocksStruct_c_TABLE + iVar1 * 0xc + 8) & 0xfffffeff;
	return;
}



BOOL __cdecl lego::game::Game_ParseStats(CFGProperty *root,char *baseKeyPath)
{
	uint *puVar1;
	float fVar2;
	char *pcVar3;
	CFGProperty *prop;
	BOOL BVar4;
	uint uVar5;
	ObjectStats **ppOVar6;
	ObjectStats *pOVar7;
	int iVar8;
	char **ppcVar9;
	uint uVar10;
	float10 fVar11;
	int *piVar12;
	BOOL *out_index;
	ObjectType local_14c;
	int local_148;
	char *local_144;
	uint local_140;
	uint local_13c;
	char **local_138;
	char *local_134;
	char *local_130;
	char **local_12c;
	uint local_128;
	char *local_124;
	float local_120;
	float local_11c;
	char *local_118;
	float local_114;
	float local_110;
	float local_10c;
	float local_108;
	float local_104;
	float local_100;
	float local_fc;
	float local_f8;
	float local_f4;
	float local_f0;
	float local_ec;
	int local_e8;
	BOOL local_e4;
	int local_e0;
	int local_dc;
	int local_d8;
	int local_d4;
	uint local_d0;
	undefined4 uStack204;
	char *local_c8 [32];
	char *local_48;
	char *local_44 [4];
	char *local_34;
	char *local_28;
	char *local_20;
	
	local_48 = NULL;
	ppcVar9 = local_44;
	for (iVar8 = 0x11; iVar8 != 0; iVar8 += -1) {
		*ppcVar9 = NULL;
		ppcVar9 = ppcVar9 + 1;
	}
	pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",0);
	for (prop = cfg::CFG_GetBlockFirstChild(root,pcVar3); prop != NULL;
			prop = cfg::CFG_NextFlatProperty(prop)) {
		local_128 = 0;
		local_13c = 0;
		local_140 = 0;
		pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Levels",0);
		pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
		if (pcVar3 == NULL) {
			pcVar3 = ____EMPTYSTR__;
		}
		else {
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Levels",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
		}
		local_134 = (char *)std::atoi(pcVar3);
		BVar4 = Game_GetObjectByName(prop->key,&local_14c,&local_148,NULL);
		if (BVar4 != 0) {
			if (globals::g_ObjectStats_TABLE[local_14c] == NULL) {
				uVar5 = FUN_0042ee70(local_14c);
				ppOVar6 = (ObjectStats **)std::malloc(uVar5 * 4);
				globals::g_ObjectStats_TABLE[local_14c] = ppOVar6;
				for (uVar5 &= 0x3fffffff; uVar5 != 0; uVar5 -= 1) {
					*ppOVar6 = NULL;
					ppOVar6 = ppOVar6 + 1;
				}
				for (iVar8 = 0; iVar8 != 0; iVar8 += -1) {
					*(undefined *)ppOVar6 = 0;
					ppOVar6 = (ObjectStats **)((int)ppOVar6 + 1);
				}
			}
			globals::g_ObjectLevels_TABLE[local_14c][local_148] = (uint)local_134;
			uVar5 = (int)local_134 * 0x150;
			pOVar7 = (ObjectStats *)std::malloc(uVar5);
			globals::g_ObjectStats_TABLE[local_14c][local_148] = pOVar7;
			pOVar7 = globals::g_ObjectStats_TABLE[local_14c][local_148];
			for (uVar5 >>= 2; uVar5 != 0; uVar5 -= 1) {
				pOVar7->field_0 = 0;
				pOVar7 = (ObjectStats *)&pOVar7->field_4;
			}
			for (iVar8 = 0; iVar8 != 0; iVar8 += -1) {
				*(undefined *)&pOVar7->field_0 = 0;
				pOVar7 = (ObjectStats *)((int)&pOVar7->field_0 + 1);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RouteSpeed",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_12c = local_c8;
					local_144 = NULL;
					local_130 = local_134;
					do {
						fVar11 = std::atof(*local_12c);
						*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
											(int)local_144 + -4) = (float)fVar11;
						local_144 = (char *)((int)local_144 + 0x150);
						local_12c = local_12c + 1;
						local_130 = local_130 + -1;
					} while (local_130 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"SoilDrillTime",0);
			local_34 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"LooseDrillTime",0);
			local_44[3] = cfg::CFG_CopyPropertyValue(root,pcVar3);
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"MedDrillTime",0);
			local_44[2] = cfg::CFG_CopyPropertyValue(root,pcVar3);
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"HardDrillTime",0);
			local_44[1] = cfg::CFG_CopyPropertyValue(root,pcVar3);
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"SeamDrillTime",0);
			local_28 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			if (local_28 == NULL) {
				local_20 = NULL;
			}
			else {
				local_20 = std::_strdup(local_28);
			}
			local_12c = &local_48;
			local_114 = (float)(0x24 - (int)&local_48);
			local_120 = 2.522337e-44;
			do {
				pcVar3 = *local_12c;
				local_118 = pcVar3;
				if (pcVar3 != NULL) {
					lego::util::stringSplit(pcVar3,local_c8,":");
					if (local_134 != NULL) {
						local_144 = (char *)((int)local_114 + (int)local_12c);
						ppcVar9 = local_c8;
						local_130 = local_134;
						do {
							fVar11 = std::atof(*ppcVar9);
							ppcVar9 = ppcVar9 + 1;
							*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
												(int)local_144 + -0x24) = (float)(fVar11 * (float10)25.0);
							local_144 = (char *)((int)local_144 + 0x150);
							local_130 = local_130 + -1;
							pcVar3 = local_118;
						} while (local_130 != NULL);
					}
					std::free(pcVar3);
				}
				local_12c = local_12c + 1;
				local_120 = (float)((int)local_120 + -1);
			} while (local_120 != 0.0);
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"BuildingBase",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				local_144 = (char *)0xffffffff;
			}
			else {
				local_144 = (char *)Game_GetBuildingBase(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CostCrystal",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CostCrystal",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			local_d8 = std::atoi(pcVar3);
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CostOre",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CostOre",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			local_d4 = std::atoi(pcVar3);
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CostRefinedOre",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CostRefinedOre",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			local_124 = (char *)std::atoi(pcVar3);
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"TrackDist",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"TrackDist",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_120 = (float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"AlertRadius",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"AlertRadius",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_114 = (float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CollHeight",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CollHeight",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_118 = (char *)(float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"HealthDecayRate",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"HealthDecayRate",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_110 = (float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"EnergyDecayRate",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"EnergyDecayRate",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_100 = (float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"PickSphere",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"PickSphere",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_130 = (char *)(float)fVar11;
			piVar12 = &local_e0;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"DrillSound",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			BVar4 = lego::snd::Snd_GetSFX(pcVar3,piVar12);
			if (BVar4 == 0) {
				local_e0 = 2;
			}
			piVar12 = &local_e8;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"DrillFadeSound",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			BVar4 = lego::snd::Snd_GetSFX(pcVar3,piVar12);
			if (BVar4 == 0) {
				local_e8 = 3;
			}
			out_index = &local_e4;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"EngineSound",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			BVar4 = lego::snd::Snd_GetSFX(pcVar3,out_index);
			if (BVar4 == 0) {
				local_e4 = BVar4;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RestPercent",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RestPercent",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_10c = (float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CarryMinHealth",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CarryMinHealth",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_104 = (float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"StampRadius",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"StampRadius",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_fc = (float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"AttackRadius",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"AttackRadius",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_f8 = (float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"WaterEntrances",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"WaterEntrances",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			local_f4 = (float)std::atoi(pcVar3);
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RubbleCoef",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RubbleCoef",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_11c = (float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"PathCoef",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"PathCoef",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_138 = (char **)(float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"OxygenCoef",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"OxygenCoef",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_108 = (float)fVar11;
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Capacity",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Capacity",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			local_dc = std::atoi(pcVar3);
			if (local_11c == 0.0) {
				local_11c = 1.0;
			}
			if ((float)local_138 == 0.0) {
				local_138 = (char **)0x3f800000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CollRadius",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CollRadius",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_12c = (char **)(float)fVar11;
			if ((float10)0.0 == fVar11) {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CollBox",0);
				pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
				if (pcVar3 != NULL) {
					lego::util::stringSplit(pcVar3,local_c8,",");
					fVar11 = std::atof(local_c8[0]);
					local_f0 = (float)fVar11;
					fVar11 = std::atof(local_c8[1]);
					local_ec = (float)fVar11;
					fVar2 = local_ec;
					if ((ushort)((ushort)(local_f0 < local_ec) << 8 | (ushort)(local_f0 == local_ec) << 0xe)
							== 0) {
						fVar2 = local_f0;
					}
					local_12c = (char **)(fVar2 * 0.5);
					local_140 = 0x100;
				}
			}
			else {
				local_140 = 0x80;
			}
			if (local_134 != NULL) {
				iVar8 = 0;
				pcVar3 = local_134;
				do {
					*(char ***)
					 ((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes + iVar8 + 0x48) =
							 local_12c;
					*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
										iVar8 + 0x4c) = local_114;
					pOVar7 = globals::g_ObjectStats_TABLE[local_14c][local_148];
					*(float *)((int)pOVar7->DrillTimes + iVar8 + 0x7c) = local_f0;
					*(float *)((int)pOVar7->DrillTimes + iVar8 + 0x80) = local_ec;
					*(char **)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
										iVar8 + 0x54) = local_130;
					*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
										iVar8 + 0x58) = local_120;
					*(char **)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
										iVar8 + 0x50) = local_118;
					*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
										iVar8 + 0x5c) = local_110;
					*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
										iVar8 + 0x60) = local_100;
					*(char **)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->BuildingBase + iVar8)
							 = local_144;
					*(int *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillSound + iVar8) =
							 local_e0;
					*(int *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillFadeSound + iVar8)
							 = local_e8;
					*(BOOL *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->EngineSound + iVar8) =
							 local_e4;
					*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
										iVar8 + 0x68) = local_10c;
					pcVar3 = pcVar3 + -1;
					*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
										iVar8 + 0x6c) = local_104;
					*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
										iVar8 + 0x70) = local_fc;
					*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
										iVar8 + 0x74) = local_f8;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->WaterEntrances +
										iVar8) = local_f4;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->RubbleCoef + iVar8) =
							 local_11c;
					*(char ***)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->PathCoef + iVar8) =
							 local_138;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->OxygenCoef + iVar8) =
							 local_108;
					*(int *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->Capacity + iVar8) =
							 local_dc;
					*(int *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->CostCrystal + iVar8) =
							 local_d8;
					*(int *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->CostOre + iVar8) =
							 local_d4;
					*(char **)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->CostRefinedOre +
										iVar8) = local_124;
					iVar8 = iVar8 + 0x150;
				} while (pcVar3 != NULL);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"SingleWidthDig",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_124 = pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_138 = local_c8;
					iVar8 = 0;
					local_144 = local_134;
					do {
						uVar5 = lego::util::parseBoolLiteral(*local_138);
						if (uVar5 == 1) {
							*(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags1 + iVar8) =
									 *(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags1 +
														iVar8) | 1;
						}
						local_138 = local_138 + 1;
						iVar8 += 0x150;
						local_144 = local_144 + -1;
						pcVar3 = local_124;
					} while (local_144 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RepairValue",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_124 = pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_144 = NULL;
					ppcVar9 = local_c8;
					local_130 = local_134;
					do {
						fVar11 = std::atof(*ppcVar9);
						ppcVar9 = ppcVar9 + 1;
						*(float *)(local_144 +
											(int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->RepairValue) =
								 (float)fVar11;
						local_144 = local_144 + 0x150;
						local_130 = local_130 + -1;
						pcVar3 = local_124;
					} while (local_130 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"SurveyRadius",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_124 = pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_144 = NULL;
					ppcVar9 = local_c8;
					local_130 = local_134;
					do {
						iVar8 = std::atoi(*ppcVar9);
						ppcVar9 = ppcVar9 + 1;
						*(int *)(local_144 +
										(int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->SurveyRadius) = iVar8;
						local_144 = local_144 + 0x150;
						local_130 = local_130 + -1;
						pcVar3 = local_124;
					} while (local_130 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"MaxCarry",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_124 = pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_144 = NULL;
					ppcVar9 = local_c8;
					local_130 = local_134;
					do {
						iVar8 = std::atoi(*ppcVar9);
						ppcVar9 = ppcVar9 + 1;
						*(int *)(local_144 + (int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->MaxCarry)
								 = iVar8;
						local_144 = local_144 + 0x150;
						local_130 = local_130 + -1;
						pcVar3 = local_124;
					} while (local_130 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CarryStart",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_124 = pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_144 = NULL;
					ppcVar9 = local_c8;
					local_130 = local_134;
					do {
						iVar8 = std::atoi(*ppcVar9);
						ppcVar9 = ppcVar9 + 1;
						*(int *)(local_144 +
										(int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->CarryStart) = iVar8;
						local_144 = local_144 + 0x150;
						local_130 = local_130 + -1;
						pcVar3 = local_124;
					} while (local_130 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CrystalDrain",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_124 = pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_144 = NULL;
					ppcVar9 = local_c8;
					local_130 = local_134;
					do {
						iVar8 = std::atoi(*ppcVar9);
						ppcVar9 = ppcVar9 + 1;
						*(int *)(local_144 +
										(int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->CrystalDrain) = iVar8;
						local_144 = local_144 + 0x150;
						local_130 = local_130 + -1;
						pcVar3 = local_124;
					} while (local_130 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"NumOfToolsCanCarry",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_124 = pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_144 = NULL;
					ppcVar9 = local_c8;
					local_130 = local_134;
					do {
						iVar8 = std::atoi(*ppcVar9);
						ppcVar9 = ppcVar9 + 1;
						*(int *)(local_144 +
										(int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->NumOfToolsCanCarry) =
								 iVar8;
						local_144 = local_144 + 0x150;
						local_130 = local_130 + -1;
						pcVar3 = local_124;
					} while (local_130 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"UpgradeTime",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_124 = pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_144 = NULL;
					ppcVar9 = local_c8;
					local_130 = local_134;
					do {
						fVar11 = std::atof(*ppcVar9);
						ppcVar9 = ppcVar9 + 1;
						*(float *)(local_144 +
											(int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->UpgradeTime) =
								 (float)(fVar11 * (float10)25.0);
						local_144 = local_144 + 0x150;
						local_130 = local_130 + -1;
						pcVar3 = local_124;
					} while (local_130 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"FunctionCoef",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_124 = pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_144 = NULL;
					ppcVar9 = local_c8;
					local_130 = local_134;
					do {
						fVar11 = std::atof(*ppcVar9);
						ppcVar9 = ppcVar9 + 1;
						local_144 = local_144 + 0x150;
						*(float *)(local_144 +
											(int)&globals::g_ObjectStats_TABLE[local_14c][local_148][-1].FunctionCoef) =
								 (float)fVar11;
						local_130 = local_130 + -1;
						pcVar3 = local_124;
					} while (local_130 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"UpgradeCostOre",0);
			local_144 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			if (local_144 != NULL) {
				lego::util::stringSplit(local_144,local_c8,":");
				local_138 = local_c8 + 3;
				uVar5 = 0;
				do {
					iVar8 = std::atoi(*local_138);
					uVar10 = uVar5 + 0x150;
					local_138 = local_138 + -1;
					*(int *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148][1].DrillTimes +
									(uVar5 - 0x78)) = iVar8;
					uVar5 = uVar10;
				} while (uVar10 < 0x540);
				std::free(local_144);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"UpgradeCostStuds",0);
			local_144 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			if (local_144 != NULL) {
				lego::util::stringSplit(local_144,local_c8,":");
				local_138 = local_c8 + 3;
				uVar5 = 0;
				do {
					iVar8 = std::atoi(*local_138);
					uVar10 = uVar5 + 0x150;
					*(int *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148][1].DrillTimes +
									(uVar5 - 0x74)) = iVar8;
					local_138 = local_138 + -1;
					uVar5 = uVar10;
				} while (uVar10 < 0x540);
				std::free(local_144);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"ProcessOre",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 2;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"ProcessCrystal",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 4;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"StoreObjects",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 8;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"ManTeleporter",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x80000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"SmallTeleporter",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x10;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"BigTeleporter",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x20;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"WaterTeleporter",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x40;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"SnaxULike",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x4000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"ToolStore",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x100000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CauseSlip",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x200;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RandomMove",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x400;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanScare",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x800;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanScareScorpion",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x40000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RandomEnterWall",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x1000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"ScaredByPlayer",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x2000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"GrabMinifigure",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x8000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanBeDriven",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x20000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanSteal",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x80000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanClearRubble",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x10000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RouteAvoidance",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x20000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"BumpDamage",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x40000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x200000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Debug",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x400000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Smooth",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x800000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CrossWater",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x1000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CrossLand",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x2000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_OnGround",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x4000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_QuickDestroy",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x8000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_AnimateByPitch",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_140 |= 0x10000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"ScaredByBigBangs",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c = uVar5;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"UpgradeBuilding",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 2;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanBeShotAt",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x40000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"UseBigTeleporter",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x800;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"UseSmallTeleporter",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x1000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"UseWaterTeleporter",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x2000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"UseLegoManTeleporter",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x400000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"TrainPilot",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_12c = (char **)pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_138 = local_c8;
					iVar8 = 0;
					local_144 = local_134;
					do {
						uVar5 = lego::util::parseBoolLiteral(*local_138);
						if (uVar5 == 1) {
							*(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 + iVar8) =
									 *(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 +
														iVar8) | 4;
						}
						local_138 = local_138 + 1;
						iVar8 += 0x150;
						local_144 = local_144 + -1;
						pcVar3 = (char *)local_12c;
					} while (local_144 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"TrainSailor",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_12c = (char **)pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_138 = local_c8;
					iVar8 = 0;
					local_144 = local_134;
					do {
						uVar5 = lego::util::parseBoolLiteral(*local_138);
						if (uVar5 == 1) {
							*(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 + iVar8) =
									 *(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 +
														iVar8) | 8;
						}
						local_138 = local_138 + 1;
						iVar8 += 0x150;
						local_144 = local_144 + -1;
						pcVar3 = (char *)local_12c;
					} while (local_144 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"TrainDriver",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_12c = (char **)pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_138 = local_c8;
					iVar8 = 0;
					local_144 = local_134;
					do {
						uVar5 = lego::util::parseBoolLiteral(*local_138);
						if (uVar5 == 1) {
							*(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 + iVar8) =
									 *(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 +
														iVar8) | 0x10;
						}
						local_138 = local_138 + 1;
						iVar8 += 0x150;
						local_144 = local_144 + -1;
						pcVar3 = (char *)local_12c;
					} while (local_144 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"TrainDynamite",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_12c = (char **)pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_138 = local_c8;
					iVar8 = 0;
					local_144 = local_134;
					do {
						uVar5 = lego::util::parseBoolLiteral(*local_138);
						if (uVar5 == 1) {
							*(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 + iVar8) =
									 *(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 +
														iVar8) | 0x20;
						}
						local_138 = local_138 + 1;
						iVar8 += 0x150;
						local_144 = local_144 + -1;
						pcVar3 = (char *)local_12c;
					} while (local_144 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"TrainRepair",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_12c = (char **)pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_138 = local_c8;
					iVar8 = 0;
					local_144 = local_134;
					do {
						uVar5 = lego::util::parseBoolLiteral(*local_138);
						if (uVar5 == 1) {
							*(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 + iVar8) =
									 *(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 +
														iVar8) | 0x40;
						}
						local_138 = local_138 + 1;
						iVar8 += 0x150;
						local_144 = local_144 + -1;
						pcVar3 = (char *)local_12c;
					} while (local_144 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"TrainScanner",0);
			pcVar3 = cfg::CFG_CopyPropertyValue(root,pcVar3);
			local_12c = (char **)pcVar3;
			if (pcVar3 != NULL) {
				lego::util::stringSplit(pcVar3,local_c8,":");
				if (local_134 != NULL) {
					local_138 = local_c8;
					iVar8 = 0;
					local_144 = local_134;
					do {
						uVar5 = lego::util::parseBoolLiteral(*local_138);
						if (uVar5 == 1) {
							*(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 + iVar8) =
									 *(uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 +
														iVar8) | 0x80;
						}
						local_138 = local_138 + 1;
						iVar8 += 0x150;
						local_144 = local_144 + -1;
						pcVar3 = (char *)local_12c;
					} while (local_144 != NULL);
				}
				std::free(pcVar3);
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Tracker",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x100;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"PowerBuilding",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x600;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"SelfPowered",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x400;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"AttackPaths",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x4000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"SplitOnZeroHealth",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x8000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanBeHitByFence",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x10000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanDoubleSelect",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x20000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"DrainPower",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x80000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"UseHoles",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x100000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CrossLava",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x200000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"DamageCausesCallToArms",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x800000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanFreeze",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x1000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanLaser",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x2000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanPush",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x4000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"DontShowDamage",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x8000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RemoveReinforcement",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x10000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"DontShowOnRadar",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x20000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"InvisibleDriver",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x40000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Unselectable",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_13c |= 0x80000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CarryVehicles",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_128 = uVar5;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"VehicleCanBeCarried",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_128 |= 2;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"CanStrafe",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_128 |= 4;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"ClassAsLarge",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_128 |= 8;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"GetOutAtLand",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_128 |= 0x10;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"GetInAtLand",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_128 |= 0x20;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"TakeCarryingDrivers",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_128 |= 0x40;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"ShowHealthBar",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_128 |= 0x80;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"NeedsPilot",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_128 |= 0x100;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"EnterToolStore",0);
			uVar5 = cfg::CFG_GetPropertyBool(root,pcVar3);
			if (uVar5 == 1) {
				local_128 |= 0x200;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Turn",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Turn",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_138 = (char **)(float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_138 = (char **)&DAT_3d75c28f;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Speed",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Speed",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_11c = (float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_11c = 2.0;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Tightness",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Tightness",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_12c = (char **)(float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_12c = (char **)0x40000000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_GoalUpdate",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_GoalUpdate",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_108 = (float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_108 = 2.0;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Height",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Height",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_f4 = (float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_f4 = 30.0;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Randomness",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Randomness",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_f8 = (float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_f8 = 2.0;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Size",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_Size",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			local_d0 = std::atoi(pcVar3);
			uStack204 = 0;
			local_114 = (float)local_d0;
			if ((float)(ulonglong)local_d0 == 0.0) {
				local_114 = 7.006492e-45;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_AttackTime",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"Flocks_AttackTime",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_fc = (float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_fc = 300.0;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"AwarenessRange",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"AwarenessRange",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_104 = (float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_104 = 0.0;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"PainThreshold",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"PainThreshold",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_10c = (float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_10c = 0.0;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"FreezerTime",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"FreezerTime",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_130 = (char *)(float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_130 = NULL;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"FreezerDamage",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"FreezerDamage",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_120 = (float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_120 = 0.0;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"PusherDist",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"PusherDist",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_110 = (float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_110 = 0.0;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"PusherDamage",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"PusherDamage",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_100 = (float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_100 = 0.0;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"LaserDamage",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"LaserDamage",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_118 = (char *)(float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_118 = NULL;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"WakeRadius",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"WakeRadius",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			local_144 = (char *)(float)fVar11;
			if (fVar11 == (float10)0.0) {
				local_144 = (char *)0x41a00000;
			}
			pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RandomMoveTime",0);
			pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			if (pcVar3 == NULL) {
				pcVar3 = ____EMPTYSTR__;
			}
			else {
				pcVar3 = cfg::CFG_JoinPath(baseKeyPath,"Stats",prop->key,"RandomMoveTime",0);
				pcVar3 = cfg::CFG_GetPropertyValue(root,pcVar3);
			}
			fVar11 = std::atof(pcVar3);
			if (fVar11 == (float10)0.0) {
				fVar11 = (float10)200.0;
			}
			if (local_134 != NULL) {
				iVar8 = 0;
				pcVar3 = local_134;
				do {
					puVar1 = (uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags1 + iVar8
													 );
					*puVar1 = *puVar1 | local_140;
					puVar1 = (uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags2 + iVar8
													 );
					*puVar1 = *puVar1 | local_13c;
					puVar1 = (uint *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->flags3 + iVar8
													 );
					*puVar1 = *puVar1 | local_128;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->RandomMoveTime +
										iVar8) = (float)fVar11;
					*(char ***)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->Flocks_Turn + iVar8)
							 = local_138;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->Flocks_Speed + iVar8)
							 = local_11c;
					*(char ***)
					 ((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->Flocks_Tightness + iVar8) =
							 local_12c;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->Flocks_GoalUpdate +
										iVar8) = local_108;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->Flocks_Height + iVar8
										) = local_f4;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->Flocks_Randomness +
										iVar8) = local_f8;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->Flocks_Size + iVar8)
							 = local_114;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->Flocks_AttackTime +
										iVar8) = local_fc;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->AwarenessRange +
										iVar8) = local_104;
					pcVar3 = pcVar3 + -1;
					*(float *)((int)&globals::g_ObjectStats_TABLE[local_14c][local_148]->PainThreshold + iVar8
										) = local_10c;
					*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148][1].DrillTimes +
										iVar8 + -0x5c) = local_100;
					*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148][1].DrillTimes +
										iVar8 + -0x60) = local_110;
					*(char **)((int)globals::g_ObjectStats_TABLE[local_14c][local_148][1].DrillTimes +
										iVar8 + -0x58) = local_118;
					*(float *)((int)globals::g_ObjectStats_TABLE[local_14c][local_148][1].DrillTimes +
										iVar8 + -100) = local_120;
					*(char **)((int)globals::g_ObjectStats_TABLE[local_14c][local_148][1].DrillTimes +
										iVar8 + -0x68) = local_130;
					*(char **)((int)globals::g_ObjectStats_TABLE[local_14c][local_148]->DrillTimes +
										iVar8 + 0x78) = local_144;
					iVar8 = iVar8 + 0x150;
				} while (pcVar3 != NULL);
			}
		}
	}
	FUN_00469d50(0,8);
	FUN_00469d50(1,0xc);
	FUN_00469d50(2,0xb);
	FUN_00469d50(3,10);
	return 1;
}



void __cdecl FUN_00469d50(int param_1,undefined4 param_2)
{
	(&DAT_005040d8)[(&DAT_005040e4)[param_1 * 4] + param_1 * 4] = param_2;
	(&DAT_005040e4)[param_1 * 4] = (&DAT_005040e4)[param_1 * 4] + 1;
	return;
}



int __cdecl lego::game::Object_GetCostOre(ObjectType objType,int objIndex,int objLevel)
{
	return globals::g_ObjectStats_TABLE[objType][objIndex][objLevel].CostOre;
}



int __cdecl lego::game::Object_GetCostCrystal(ObjectType objType,int objIndex,int objLevel)
{
	return globals::g_ObjectStats_TABLE[objType][objIndex][objLevel].CostCrystal;
}



int __cdecl lego::game::Object_GetCostRefinedOre(ObjectType objType,int objIndex,int objLevel)
{
	return globals::g_ObjectStats_TABLE[objType][objIndex][objLevel].CostRefinedOre;
}



int __cdecl lego::game::LiveObject_GetCrystalDrain(LiveObject *liveObj)
{
	return globals::g_ObjectStats_TABLE[liveObj->objType][liveObj->objIndex][liveObj->objLevel].
				 CrystalDrain;
}



int __cdecl lego::game::LiveObject_GetCapacity(LiveObject *liveObj)
{
	return globals::g_ObjectStats_TABLE[liveObj->objType][liveObj->objIndex][liveObj->objLevel].
				 Capacity;
}



int __cdecl lego::game::LiveObject_GetMaxCarry(LiveObject *liveObj)
{
	return globals::g_ObjectStats_TABLE[liveObj->objType][liveObj->objIndex][liveObj->objLevel].
				 MaxCarry;
}



int __cdecl lego::game::LiveObject_GetCarryStart(LiveObject *liveObj)
{
	return globals::g_ObjectStats_TABLE[liveObj->objType][liveObj->objIndex][liveObj->objLevel].
				 CarryStart;
}



BOOL __cdecl lego::game::LiveObject_SetLevel(LiveObject *liveObj,uint level)
{
	ObjectType OVar1;
	int iVar2;
	uint uVar3;
	
	OVar1 = liveObj->objType;
	iVar2 = liveObj->objIndex;
	if (level < globals::g_ObjectLevels_TABLE[OVar1][iVar2]) {
		uVar3 = liveObj->objLevel;
		if (level != uVar3) {
			globals::g_LiveObjectLevels_Previous_TABLE[OVar1][iVar2][uVar3] =
					 globals::g_LiveObjectLevels_Previous_TABLE[OVar1][iVar2][uVar3] + 1;
			globals::g_LiveObjectLevels_Current_TABLE[liveObj->objType][liveObj->objIndex][level] =
					 globals::g_LiveObjectLevels_Current_TABLE[liveObj->objType][liveObj->objIndex][level] + 1
			;
		}
		liveObj->objLevel = level;
		liveObj->stats = globals::g_ObjectStats_TABLE[liveObj->objType][liveObj->objIndex] + level;
		return 1;
	}
	return 0;
}



float10 __cdecl lego::game::LiveObject_GetRouteSpeed(LiveObject *liveObj)
{
	return (float10)liveObj->stats->RouteSpeed;
}



float10 __cdecl lego::game::LiveObject_GetDrillTimeType(LiveObject *liveObj,SurfaceType surfaceType)
{
	return (float10)liveObj->stats->DrillTimes[surfaceType];
}



float10 __cdecl lego::game::LiveObject_GetRubbleCoef(LiveObject *liveObj)
{
	return (float10)liveObj->stats->RubbleCoef;
}



float10 __cdecl lego::game::LiveObject_GetWakeRadius(LiveObject *liveObj)
{
	return (float10)liveObj->stats->WakeRadius;
}



float10 __cdecl lego::game::LiveObject_GetPathCoef(LiveObject *liveObj)
{
	return (float10)liveObj->stats->PathCoef;
}



float10 __cdecl lego::game::LiveObject_GetCollRadius(LiveObject *liveObj)
{
	return (float10)liveObj->stats->CollRadius;
}



float10 __cdecl lego::game::LiveObject_GetCollHeight(LiveObject *liveObj)
{
	return (float10)liveObj->stats->CollHeight;
}



float10 __cdecl lego::game::LiveObject_GetPickSphere(LiveObject *liveObj)
{
	return (float10)liveObj->stats->PickSphere;
}



float10 __cdecl lego::game::LiveObject_GetPainThreshold(LiveObject *liveObj)
{
	return (float10)liveObj->stats->PainThreshold;
}



float10 __cdecl lego::game::LiveObject_GetAlertRadius(LiveObject *liveObj)
{
	return (float10)liveObj->stats->AlertRadius;
}



int __cdecl lego::game::LiveObject_GetCollBox(LiveObject *liveObj)
{
	return (int)&liveObj->stats->CollBox;
}



float10 __cdecl lego::game::LiveObject_GetTrackDist(LiveObject *liveObj)
{
	return (float10)liveObj->stats->TrackDist;
}



float10 __cdecl lego::game::LiveObject_GetHealthDecayRate(LiveObject *liveObj)
{
	return (float10)liveObj->stats->HealthDecayRate;
}



float10 __cdecl lego::game::LiveObject_GetEnergyDecayRate(LiveObject *liveObj)
{
	return (float10)liveObj->stats->EnergyDecayRate;
}



float10 __cdecl lego::game::ObjectStats_GetOxygenCoef(ObjectType objType,int objIndex)
{
	return (float10)globals::g_ObjectStats_TABLE[objType][objIndex]->OxygenCoef;
}



float10 __cdecl lego::game::LiveObject_GetOxygenCoef(LiveObject *liveObj)
{
	return (float10)liveObj->stats->OxygenCoef;
}



int __cdecl lego::game::LiveObject_GetSurveyRadius(LiveObject *liveObj)
{
	return liveObj->stats->SurveyRadius;
}



ObjectStatsFlags1 __cdecl lego::game::LiveObject_GetStatsFlags1(LiveObject *liveObj)
{
	return liveObj->stats->flags1;
}



ObjectStatsFlags2 __cdecl lego::game::LiveObject_GetStatsFlags2(LiveObject *liveObj)
{
	return liveObj->stats->flags2;
}



ObjectStatsFlags3 __cdecl lego::game::LiveObject_GetStatsFlags3(LiveObject *liveObj)
{
	return liveObj->stats->flags3;
}



ObjectStatsFlags1 __cdecl lego::game::Object_GetStatsFlags1(ObjectType objType,int objIndex)
{
	return globals::g_ObjectStats_TABLE[objType][objIndex]->flags1;
}



ObjectStatsFlags2 __cdecl lego::game::Object_GetStatsFlags2(ObjectType objType,int objIndex)
{
	return globals::g_ObjectStats_TABLE[objType][objIndex]->flags2;
}



ObjectStatsFlags3 __cdecl lego::game::Object_GetStatsFlags3(ObjectType objType,int objIndex)
{
	return globals::g_ObjectStats_TABLE[objType][objIndex]->flags3;
}



float10 __cdecl lego::game::LiveObject_GetRepairValue(LiveObject *liveObj)
{
	return (float10)liveObj->stats->RepairValue;
}



int __cdecl lego::game::Object_GetLevels(ObjectType objType,int objIndex)
{
	return globals::g_ObjectLevels_TABLE[objType][objIndex];
}



int __cdecl lego::game::Object_GetWaterEntrances(ObjectType objType,int objIndex,int objLevel)
{
	return globals::g_ObjectStats_TABLE[objType][objIndex][objLevel].WaterEntrances;
}



int __cdecl lego::game::LiveObject_GetDrillSoundType(LiveObject *liveObj,BOOL isFade)
{
	if (isFade != 0) {
		return liveObj->stats->DrillFadeSound;
	}
	return liveObj->stats->DrillSound;
}



int __cdecl lego::game::LiveObject_GetEngineSound(LiveObject *liveObj)
{
	return liveObj->stats->EngineSound;
}



float10 __cdecl lego::game::LiveObject_GetRestPercent(LiveObject *liveObj)
{
	return (float10)liveObj->stats->RestPercent;
}



float10 __cdecl lego::game::LiveObject_GetCarryMinHealth(LiveObject *liveObj)
{
	return (float10)liveObj->stats->CarryMinHealth;
}



float10 __cdecl lego::game::LiveObject_GetAttackRadius(LiveObject *liveObj)
{
	return (float10)liveObj->stats->AttackRadius;
}



float10 __cdecl lego::game::LiveObject_GetStampRadius(LiveObject *liveObj)
{
	return (float10)liveObj->stats->StampRadius;
}



int __cdecl lego::game::LiveObject_GetNumOfToolsCanCarry(LiveObject *liveObj)
{
	return liveObj->stats->NumOfToolsCanCarry;
}



float10 __cdecl lego::game::LiveObject_GetUpgradeTime(LiveObject *liveObj)
{
	return (float10)liveObj->stats->UpgradeTime;
}



float10 __cdecl lego::game::LiveObject_GetFunctionCoef(LiveObject *liveObj)
{
	return (float10)liveObj->stats->FunctionCoef;
}



int __cdecl lego::game::Object_GetUpgradeCostOre(ObjectType objType,int objIndex,int objLevel)
{
	return globals::g_ObjectStats_TABLE[objType][objIndex][objLevel].UpgradeCostOre;
}



int __cdecl lego::game::Object_GetUpgradeCostStuds(ObjectType objType,int objIndex,int objLevel)
{
	return globals::g_ObjectStats_TABLE[objType][objIndex][objLevel].UpgradeCostStuds;
}



undefined4 __cdecl FUN_0046a3e0(int param_1,int *out_index)
{
	int *piVar1;
	uint uVar2;
	int *piVar3;
	int iVar4;
	
	iVar4 = 0;
	piVar1 = &DAT_005040d8;
	do {
		uVar2 = 0;
		piVar3 = piVar1;
		if (piVar1[3] != 0) {
			do {
				if (param_1 == *piVar3) {
					*out_index = iVar4;
					return 1;
				}
				uVar2 += 1;
				piVar3 = piVar3 + 1;
			} while (uVar2 < (uint)piVar1[3]);
		}
		piVar1 = piVar1 + 4;
		iVar4 += 1;
	} while (piVar1 < &BOOL_00504188);
	return 0;
}



float10 __cdecl lego::game::LiveObject_GetFlocks_Height(LiveObject *liveObj)
{
	return (float10)liveObj->stats->Flocks_Height;
}



float10 __cdecl lego::game::LiveObject_GetFlocks_Randomness(LiveObject *liveObj)
{
	return (float10)liveObj->stats->Flocks_Randomness;
}



float10 __cdecl lego::game::LiveObject_GetFlocks_Turn(LiveObject *liveObj)
{
	return (float10)liveObj->stats->Flocks_Turn;
}



float10 __cdecl lego::game::LiveObject_GetFlocks_Tightness(LiveObject *liveObj)
{
	return (float10)liveObj->stats->Flocks_Tightness;
}



float10 __cdecl lego::game::LiveObject_GetFlocks_Speed(LiveObject *liveObj)
{
	return (float10)liveObj->stats->Flocks_Speed;
}



int __cdecl lego::game::LiveObject_GetFlocks_Size(LiveObject *liveObj)
{
	return liveObj->stats->Flocks_Size;
}



float10 __cdecl lego::game::LiveObject_GetFlocks_GoalUpdate(LiveObject *liveObj)
{
	return (float10)liveObj->stats->Flocks_GoalUpdate;
}



float10 __cdecl lego::game::LiveObject_GetFlocks_AttackTime(LiveObject *liveObj)
{
	return (float10)liveObj->stats->Flocks_AttackTime;
}



float10 __cdecl lego::game::LiveObject_GetAwarenessRange(LiveObject *liveObj)
{
	return (float10)liveObj->stats->AwarenessRange;
}



float10 __cdecl lego::game::LiveObject_GetPusherDist(LiveObject *liveObj)
{
	return (float10)liveObj->stats->PusherDist;
}



float10 __cdecl lego::game::LiveObject_GetPusherDamage(LiveObject *liveObj)
{
	return (float10)liveObj->stats->PusherDamage;
}



float10 __cdecl lego::game::LiveObject_GetLaserDamage(LiveObject *liveObj)
{
	return (float10)liveObj->stats->LaserDamage;
}



float10 __cdecl lego::game::LiveObject_GetFreezerDamage(LiveObject *liveObj)
{
	return (float10)liveObj->stats->FreezerDamage;
}



float10 __cdecl lego::game::LiveObject_GetFreezerTime(LiveObject *liveObj)
{
	return (float10)liveObj->stats->FreezerTime;
}



void __cdecl lego::game::LiveObject_SetUnkFlags2(LiveObject *liveObj)
{
	ObjectStats *pOVar1;
	ObjectStatsFlags2 OVar2;
	
	pOVar1 = liveObj->stats;
	OVar2 = pOVar1->flags2;
	if ((OVar2 & STATS2_SELFPOWERED) != STATS2_NONE) {
		pOVar1->flags2 =
				 OVar2 & (STATS2_SCAREDBYBIGBANGS|STATS2_UPGRADEBUILDING|STATS2_TRAINPILOT|
									STATS2_TRAINSAILOR|STATS2_TRAINDRIVER|STATS2_TRAINDYNAMITE|STATS2_TRAINREPAIR|
									STATS2_TRAINSCANNER|STATS2_TRACKER|STATS2_GENERATEPOWER|STATS2_USEBIGTELEPORTER|
									STATS2_USESMALLTELEPORTER|STATS2_USEWATERTELEPORTER|STATS2_ATTACKPATHS|
									STATS2_SPLITONZEROHEALTH|STATS2_CANBEHITBYFENCE|STATS2_CANDOUBLESELECT|
									STATS2_CANBESHOTAT|STATS2_DRAINPOWER|STATS2_USEHOLES|STATS2_CROSSLAVA|
									STATS2_USELEGOMANTELEPORTER|STATS2_DAMAGECAUSESCALLTOARMS|STATS2_CANFREEZE|
									STATS2_CANLASER|STATS2_CANPUSH|STATS2_DONTSHOWDAMAGE|STATS2_REMOVEREINFORCEMENT|
									STATS2_DONTSHOWONRADAR|STATS2_INVISIBLEDRIVER|STATS2_UNSELECTABLE);
		FUN_0043c830(liveObj);
		return;
	}
	pOVar1->flags2 = OVar2 | STATS2_SELFPOWERED;
	FUN_0043c830(liveObj);
	return;
}



void __cdecl lego::unk::Lego_FreeLinkedStruct20(undefined *param_1)
{
	if (param_1 != NULL) {
		Lego_FreeLinkedStruct20(*(undefined **)(param_1 + 0x1c));
		std::free(param_1);
	}
	return;
}



void __cdecl lego::unk::Lego_CleanupLinkedStruct20(void)
{
	globals::g_LinkedStruct20_COUNT = 0;
	Lego_FreeLinkedStruct20(globals::g_Linked_Struct20_NEXT);
	globals::g_Linked_Struct20_NEXT = NULL;
	return;
}



undefined4 __cdecl FUN_0046a680(int *param_1,int *param_2)
{
	if (*param_1 == *param_2) {
		param_1[0xe4] = param_2[1];
		param_1[0xe5] = param_2[2];
		if ((*(byte *)(param_2 + 1) & 2) != 0) {
			param_1[0xe6] = param_2[3];
			*(int *)(param_2[3] + 0x10) = *(int *)(param_2[3] + 0x10) + 1;
		}
		lego::globals::g_LinkedStruct20_COUNT += 1;
		param_1[0xfb] = param_1[0xfb] | 8;
	}
	return 0;
}



float __cdecl FUN_0046a6e0(void)
{
	LevelSurfaceMap *pLVar1;
	Struct_bc *pSVar2;
	float10 extraout_ST0;
	float *pfVar3;
	float local_c [3];
	
	pSVar2 = lego::globals::g_Game.structbc_24;
	if (lego::globals::g_Game.unkbool_308 != 1) {
		pSVar2 = lego::globals::g_Game.structbc_2c;
	}
	pfVar3 = local_c;
	pLVar1 = lego::game::GetSurfaceMap();
	FUN_00436d55((int *)pSVar2,(uint *)pLVar1,pfVar3);
	return (float)extraout_ST0;
}



void __cdecl lego::unk::SetLinkedStruct20_Next(int param_1)
{
	*(int *)(param_1 + 0x1c) = globals::g_Linked_Struct20_NEXT;
	globals::g_Linked_Struct20_NEXT = param_1;
	return;
}



undefined4 __cdecl FUN_0046a750(uint *param_1,uint param_2)
{
	uint uVar1;
	
	uVar1 = lego::game::Game_GetFirstObjectiveFlag(param_2);
	if ((*param_1 == uVar1) && (param_1[0xe4] != 0)) {
		BOOL_00504188 = 0;
	}
	return 0;
}



undefined4 __cdecl FUN_0046a780(uint param_1)
{
	LiveObject *liveObj;
	uint uVar1;
	
	uVar1 = 0;
	do {
		liveObj = (LiveObject *)(1 << ((byte)uVar1 & 0x1f));
		BOOL_00504188 = 1;
		if ((param_1 & (uint)liveObj) != 0) {
			FUN_00437a70(FUN_0046a750,liveObj);
			if (BOOL_00504188 == 0) {
				return 0;
			}
		}
		uVar1 += 1;
	} while (uVar1 < 0x1f);
	return 1;
}



void __cdecl FUN_0046a7d0(uint param_1,uint param_2,uint param_3)
{
	int iVar1;
	char *extraout_EDX;
	ObjectType local_10;
	uint local_c;
	char *local_8;
	VehicleData *local_4;
	
	local_10 = lego::game::Game_GetFirstObjectiveFlag(param_1);
	local_c = param_2;
	local_8 = (char *)param_3;
	if ((param_2 & 2) != 0) {
		local_4 = (VehicleData *)std::malloc(0x20);
		iVar1 = lego::unk::SetLinkedStruct20_Next((int)local_4);
		local_4->WheelMeshes[0] = NULL;
		if ((param_3 & 2) != 0) {
			FUN_0046a6e0();
			local_4->objIndex = iVar1;
			local_4->WheelNullName = extraout_EDX;
			local_4->aeResData1 = NULL;
			local_4->aeResData2 = (ResourceData *)FLOAT_004ab45c;
		}
		if ((param_3 & 1) != 0) {
			local_4->WheelMeshes[1] = (ResourceData *)INT_004ab454;
		}
		local_4->WheelMeshes[2] = (ResourceData *)param_3;
	}
	FUN_00437a70(FUN_0046a680,(LiveObject *)&local_10);
	return;
}



undefined4 __cdecl FUN_0046a880(undefined4 *param_1)
{
	uint uVar1;
	float *pfVar2;
	int iVar3;
	short sVar4;
	float local_10;
	float local_c [3];
	
	if ((param_1[0xe4] & 1) != 0) {
		param_1[0xd0] = 0xbf800000;
		param_1[0xe5] = 0;
		param_1[0xe4] = 4;
		lego::globals::g_LinkedStruct20_COUNT = lego::globals::g_LinkedStruct20_COUNT - 1;
		return 0;
	}
	if ((param_1[0xe4] & 2) != 0) {
		uVar1 = param_1[0xe5];
		if ((uVar1 & 2) == 0) {
			if ((uVar1 & 1) == 0) {
				if ((uVar1 & 4) != 0) {
					param_1[0xd0] = 0xbf800000;
					param_1[0xfa] = param_1[0xfa] | 0x800000;
					lego::globals::g_LinkedStruct20_COUNT -= 1;
				}
			}
			else {
				iVar3 = param_1[0xe6];
				sVar4 = lego::util::randomInt16();
				if ((int)sVar4 % *(int *)(iVar3 + 0x14) == 0) {
					param_1[0xd0] = 0xbf800000;
					*(int *)(iVar3 + 0x10) = *(int *)(iVar3 + 0x10) + -1;
					goto LAB_0046a960;
				}
			}
		}
		else {
			pfVar2 = (float *)param_1[0xe6];
			lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_10,local_c);
			local_10 = local_10 - *pfVar2;
			local_c[0] = local_c[0] - pfVar2[1];
			iVar3 = param_1[0xe6];
			if (SQRT(local_c[0] * local_c[0] + local_10 * local_10) < *(float *)(iVar3 + 8)) {
				param_1[0xd0] = 0xbf800000;
				*(int *)(iVar3 + 0x10) = *(int *)(iVar3 + 0x10) + -1;
LAB_0046a960:
				param_1[0xe4] = 4;
				param_1[0xe6] = 0;
				param_1[0xe5] = 0;
				lego::globals::g_LinkedStruct20_COUNT = lego::globals::g_LinkedStruct20_COUNT - 1;
				return 0;
			}
		}
	}
	return 0;
}



void __cdecl FUN_0046a9c0(int param_1,float param_2)
{
	if (param_1 != 0) {
		do {
			if ((*(int *)(param_1 + 0x10) != 0) && (*(int *)(param_1 + 0x18) == 2)) {
				*(float *)(param_1 + 8) = *(float *)(param_1 + 0xc) * param_2 + *(float *)(param_1 + 8);
			}
			param_1 = *(int *)(param_1 + 0x1c);
		} while (param_1 != 0);
	}
	return;
}



void __cdecl FUN_0046a9f0(float param_1)
{
	FUN_0046a9c0(lego::globals::g_Linked_Struct20_NEXT,param_1);
	if (lego::globals::g_LinkedStruct20_COUNT != 0) {
		FUN_00437a70(FUN_0046a880,NULL);
	}
	return;
}



uint __cdecl lego::game::Game_GetFirstObjectiveFlag(ObjectiveFlags objectiveFlags)
{
	if ((objectiveFlags & OBJECTIVE_UNK_1) != OBJECTIVE_NONE) {
		return 1;
	}
	if ((objectiveFlags & OBJECTIVE_COMPLETE) != OBJECTIVE_NONE) {
		return 2;
	}
	if ((objectiveFlags & OBJECTIVE_FAILED) != OBJECTIVE_NONE) {
		return 3;
	}
	if ((objectiveFlags & OBJECTIVE_UNK_8) != OBJECTIVE_NONE) {
		return 4;
	}
	if ((objectiveFlags & OBJECTIVE_SHOWADVISOR) != OBJECTIVE_NONE) {
		return 5;
	}
	if ((objectiveFlags & OBJECTIVE_SHOWACHEIVEADVISOR) != OBJECTIVE_NONE) {
		return 6;
	}
	if ((objectiveFlags & OBJECTIVE_HITTIMEFAIL) != OBJECTIVE_NONE) {
		return 7;
	}
	if ((objectiveFlags & OBJECTIVE_SHOWFAILEDADVISOR) != OBJECTIVE_NONE) {
		return 8;
	}
	if ((objectiveFlags & OBJECTIVE_CRYSTAL) != OBJECTIVE_NONE) {
		return 9;
	}
	if ((objectiveFlags & OBJECTIVE_ORE) != OBJECTIVE_NONE) {
		return 10;
	}
	if ((objectiveFlags & OBJECTIVE_BLOCK) != OBJECTIVE_NONE) {
		return 0xb;
	}
	if ((objectiveFlags & OBJECTIVE_TIMER) != OBJECTIVE_NONE) {
		return 0xc;
	}
	return -(uint)((objectiveFlags & OBJECTIVE_CONSTRUCTION) != OBJECTIVE_NONE) & 0xd;
}



void __cdecl
lego::main::Main_InitTexts
					(Struct_830 *param_1,Struct_830 *param_2,uint param_3,uint param_4,float param_5)
{
	if (param_5 == 0.0) {
		globals::g_Texts_TABLE[0] = "Text_Walk";
		globals::g_Texts_TABLE[1] = "Text_Drill";
		globals::g_Texts_TABLE[2] = "Text_NoDrill";
		globals::g_Texts_TABLE[3] = "Text_CantDrill";
		globals::g_Texts_TABLE[4] = "Text_Reinforce";
		globals::g_Texts_TABLE[5] = "Text_NoReinforce";
		globals::g_Texts_TABLE[6] = "Text_CantReinforce";
		globals::g_Texts_TABLE[7] = "Text_PickupCrystal";
		globals::g_Texts_TABLE[8] = "Text_Encyclopedia";
		globals::g_Texts_TABLE[9] = "Text_RadarHelp";
		globals::g_Texts_TABLE[10] = "Text_BuildHelp";
		globals::g_Texts_TABLE[11] = "Text_SelectionHelp";
		globals::g_Texts_TABLE[12] = "Text_Drive";
		globals::g_Texts_TABLE[13] = "Text_CantDrive";
		globals::g_Texts_TABLE[14] = "Text_MakeTeleporter";
		globals::g_Texts_TABLE[15] = "Text_CannotPlaceBuilding";
		globals::g_Texts_TABLE[16] = "Text_CrystalOreDisabled";
		globals::g_Texts_TABLE[17] = "Text_CrystalFound";
		globals::g_Texts_TABLE[18] = "Text_CavernDiscovered";
		globals::g_Texts_TABLE[19] = "Text_OreFound";
		globals::g_Texts_TABLE[20] = "Text_AirSupplyLow";
		globals::g_Texts_TABLE[21] = "Text_AirSupplyRunningOut";
		globals::g_Texts_TABLE[22] = "Text_SpaceToContinue";
		globals::g_Texts_TABLE[23] = "Text_GameCompleted";
		globals::g_Texts_TABLE[24] = "Text_ManTrained";
		globals::g_Texts_TABLE[25] = "Text_UnitUpgraded";
		globals::g_Texts_mutable_COUNT = 26;
		globals::g_Texts_COUNT = 26;
		PTR_0050461c = param_1;
		PTR_00504620 = param_2;
		UINT_0050465c = param_3;
		UINT_00504660 = param_4;
		FLOAT_00504668 = (float)&DAT_42c80000;
		return;
	}
	globals::g_Texts_TABLE[0] = "Text_Walk";
	globals::g_Texts_TABLE[1] = "Text_Drill";
	globals::g_Texts_TABLE[2] = "Text_NoDrill";
	globals::g_Texts_TABLE[3] = "Text_CantDrill";
	globals::g_Texts_TABLE[4] = "Text_Reinforce";
	globals::g_Texts_TABLE[5] = "Text_NoReinforce";
	globals::g_Texts_TABLE[6] = "Text_CantReinforce";
	globals::g_Texts_TABLE[7] = "Text_PickupCrystal";
	globals::g_Texts_TABLE[8] = "Text_Encyclopedia";
	globals::g_Texts_TABLE[9] = "Text_RadarHelp";
	globals::g_Texts_TABLE[10] = "Text_BuildHelp";
	globals::g_Texts_TABLE[11] = "Text_SelectionHelp";
	globals::g_Texts_TABLE[12] = "Text_Drive";
	globals::g_Texts_TABLE[13] = "Text_CantDrive";
	globals::g_Texts_TABLE[14] = "Text_MakeTeleporter";
	globals::g_Texts_TABLE[15] = "Text_CannotPlaceBuilding";
	globals::g_Texts_TABLE[16] = "Text_CrystalOreDisabled";
	globals::g_Texts_TABLE[17] = "Text_CrystalFound";
	globals::g_Texts_TABLE[18] = "Text_CavernDiscovered";
	globals::g_Texts_TABLE[19] = "Text_OreFound";
	globals::g_Texts_TABLE[20] = "Text_AirSupplyLow";
	globals::g_Texts_TABLE[21] = "Text_AirSupplyRunningOut";
	globals::g_Texts_TABLE[22] = "Text_SpaceToContinue";
	globals::g_Texts_TABLE[23] = "Text_GameCompleted";
	globals::g_Texts_TABLE[24] = "Text_ManTrained";
	globals::g_Texts_TABLE[25] = "Text_UnitUpgraded";
	globals::g_Texts_mutable_COUNT = 26;
	globals::g_Texts_COUNT = 26;
	PTR_0050461c = param_1;
	PTR_00504620 = param_2;
	UINT_0050465c = param_3;
	UINT_00504660 = param_4;
	FLOAT_00504668 = param_5;
	return;
}



void __cdecl
lego::main::Main_LoadMsgPanel
					(char *filename,uint param_2,uint param_3,uint param_4,Rect2F *param_5,Rect2F *param_6,
					float param_7)
{
	UINT_00504628 = param_3;
	Rect2F_0050462c.x = param_5->x;
	Rect2F_0050462c.y = param_5->y;
	Rect2F_0050462c.width = param_5->width;
	Rect2F_0050462c.height = param_5->height;
	FLOAT_0050463c =
			 (Rect2F_0050462c.y + Rect2F_0050462c.height) - (float)PTR_0050461c->font->field_be4;
	FLOAT_00504640 = param_7;
	FLOAT_00504644 = (float)(ulonglong)param_2;
	FUN_0046aca0();
	return;
}



void __cdecl FUN_0046aca0(void)
{
	int iVar1;
	uint uVar2;
	longlong lVar3;
	
	FLOAT_00504648 = (float)(ulonglong)UINT_00504628;
	lVar3 = __ftol((float10)Rect2F_0050462c.y);
	iVar1 = (int)lVar3;
	lVar3 = __ftol((float10)Rect2F_0050462c.x);
	FUN_00485470(PTR_0050461c,(int)lVar3,iVar1);
	lVar3 = __ftol((float10)Rect2F_0050462c.height);
	uVar2 = (uint)lVar3;
	lVar3 = __ftol((float10)Rect2F_0050462c.width);
	FUN_00485490(PTR_0050461c,(uint)lVar3,uVar2);
	Rect2F_0050464c.x = Rect2F_0050462c.x;
	Rect2F_0050464c.y = Rect2F_0050462c.y;
	Rect2F_0050464c.width = Rect2F_0050462c.width;
	Rect2F_0050464c.height = Rect2F_0050462c.height;
	FLAGS_00504664 = FLAGS_00504664 & 0xfffffffe;
	return;
}



void __cdecl FUN_0046ad50(void)
{
	FUN_0046aca0();
	lego::globals::g_Texts_mutable_COUNT = 0x1a;
	FLAGS_00504610 = 0;
	DAT_00504614 = 0;
	FLAGS_00504664 = 0;
	FUN_00485c70(PTR_0050461c);
	FUN_00485c70(PTR_00504620);
	return;
}



BOOL __cdecl lego::unk::Lego_GetTexts(char *textName,int *out_index)
{
	int iVar1;
	char **ppcVar2;
	int iVar3;
	
	iVar3 = 0;
	ppcVar2 = globals::g_Texts_TABLE;
	do {
		iVar1 = std::_stricmp(*ppcVar2,textName);
		if (iVar1 == 0) {
			*out_index = iVar3;
			return 1;
		}
		ppcVar2 = ppcVar2 + 1;
		iVar3 += 1;
	} while (ppcVar2 < &DAT_005041f8);
	return 0;
}



void __cdecl FUN_0046add0(int param_1,char *param_2)
{
	char *pcVar1;
	char cVar2;
	char *pcVar3;
	uint uVar4;
	
	if (*(void **)(&DAT_005041f8 + param_1 * 4) != NULL) {
		std::free(*(void **)(&DAT_005041f8 + param_1 * 4));
	}
	uVar4 = 0xffffffff;
	pcVar3 = param_2;
	do {
		if (uVar4 == 0) break;
		uVar4 -= 1;
		cVar2 = *pcVar3;
		pcVar3 = pcVar3 + 1;
	} while (cVar2 != '\0');
	pcVar3 = (char *)std::malloc(~uVar4);
	*(char **)(&DAT_005041f8 + param_1 * 4) = pcVar3;
	cVar2 = *param_2;
	while (cVar2 != '\0') {
		cVar2 = *param_2;
		if (cVar2 == '_') {
			*pcVar3 = ' ';
		}
		else {
			if ((cVar2 == '\\') && (param_2[1] == 'n')) {
				*pcVar3 = '\n';
				param_2 = param_2 + 1;
			}
			else {
				*pcVar3 = cVar2;
			}
		}
		pcVar1 = param_2 + 1;
		pcVar3 = pcVar3 + 1;
		param_2 = param_2 + 1;
		cVar2 = *pcVar1;
	}
	*pcVar3 = '\0';
	if (*(ImageBMP **)(&DAT_00504260 + param_1 * 4) != NULL) {
		lego::pool::ReservedPool_ImageBMP___Release(*(ImageBMP **)(&DAT_00504260 + param_1 * 4));
		*(undefined4 *)(&DAT_00504260 + param_1 * 4) = 0;
	}
	return;
}



void __cdecl FUN_0046ae70(int param_1,char *param_2,int param_3)
{
	ImageBMP *image;
	undefined4 in_stack_00000010;
	
	FUN_0046add0(param_1,param_2);
	std::sprintf(&DAT_005042c8 + param_1 * 0x20,"%s",in_stack_00000010);
	image = lego::image::Image_LoadBMP((char *)param_3,0,0);
	*(ImageBMP **)(&DAT_00504260 + param_1 * 4) = image;
	if (image != NULL) {
		lego::image::Image_unkFogFromFloat__0047deb0(image,0.0,0.0,0.0,0.0,0.0,0.0);
	}
	return;
}



void __cdecl FUN_0046aee0(char *param_1,uint param_2)
{
	DAT_00504614 = param_1;
	if (param_2 == 0) {
		param_2 = 0x8000;
	}
	FLAGS_00504610 = param_2 | 0x10000;
	lego::game::Level_NERPMessage_Parse(param_1,NULL,1);
	FLAGS_00504664 = FLAGS_00504664 | 1;
	return;
}



void __cdecl lego::front::Text_DisplayType(TextType textType,uint param_2,BOOL param_3)
{
	int iVar1;
	BOOL BVar2;
	
	if (param_2 == 0) {
		if ((ushort)((ushort)(FLOAT_00504618 < 0.0) << 8 | (ushort)(FLOAT_00504618 == 0.0) << 0xe) != 0)
		{
			globals::g_Texts_mutable_COUNT = textType;
		}
	}
	else {
		globals::g_Texts_mutable_COUNT = textType;
		FLOAT_00504618 = FLOAT_00504668;
	}
	iVar1 = nerps::funcs::NERPFunc__GetTutorialFlags(NULL);
	if (iVar1 == 0) {
		BVar2 = snd::Snd_GetSFX(&DAT_005042c8 + textType * 0x20,(int *)&param_2);
		if (BVar2 != 0) {
			snd::Snd_FUN_004651b0(param_2,NULL);
		}
	}
	if ((globals::g_Texts_mutable_COUNT == textType) && (param_3 != 0)) {
		FLAGS_00504664 = FLAGS_00504664 | 4;
		return;
	}
	FLAGS_00504664 = FLAGS_00504664 & 0xfffffffb;
	return;
}



void __cdecl FUN_0046afc0(float param_1)
{
	byte *pbVar1;
	float fVar2;
	BOOL BVar3;
	int iVar4;
	uint uVar5;
	ImageBMP *bitmap;
	Struct_830 *pSVar6;
	bool bVar7;
	longlong lVar8;
	int local_20c;
	float local_208;
	float local_204;
	undefined4 local_200 [128];
	
	uVar5 = lego::globals::g_Texts_mutable_COUNT;
	bitmap = NULL;
	bVar7 = true;
	if (FLAGS_00504610 == 0) {
		BVar3 = lego::nerps::NERPs_IsLoaded();
		if ((BVar3 != 0) && (lego::globals::g_Texts_mutable_COUNT != 0x1a)) {
			bitmap = *(ImageBMP **)(&DAT_00504260 + lego::globals::g_Texts_mutable_COUNT * 4);
			pbVar1 = *(byte **)(&DAT_005041f8 + lego::globals::g_Texts_mutable_COUNT * 4);
			bVar7 = bitmap == NULL;
			pSVar6 = PTR_0050461c;
			if (!bVar7) {
				local_208 = (float)(ulonglong)UINT_0050465c;
				local_204 = (float)(ulonglong)UINT_00504660;
				pSVar6 = PTR_00504620;
			}
			if (pbVar1 != NULL) {
				iVar4 = 1;
				if ((FLAGS_00504664 & 4) != 0) {
					iVar4 = lego::unk::Lego_GetDat_004ded1c();
				}
				if (iVar4 != 0) {
					FUN_004855c0((int)pSVar6,1,pbVar1);
				}
			}
			if ((ushort)((ushort)(FLOAT_00504618 < 0.0) << 8 | (ushort)(FLOAT_00504618 == 0.0) << 0xe) !=
					0) {
				lego::globals::g_Texts_mutable_COUNT = 0x1a;
			}
			FLOAT_00504618 = FLOAT_00504618 - param_1;
		}
	}
	else {
		if (DAT_00504614 == NULL) {
			FLAGS_00504610 = 0;
		}
		else {
			lego::game::Level_NERPMessage_Parse(DAT_00504614,local_200,0);
			FUN_004855c0((int)PTR_0050461c,0,(byte *)local_200);
			if ((FLAGS_00504610 & 0x8000) == 0) {
				FLAGS_00504610 -= 1;
			}
		}
	}
	if (((lego::globals::g_Game.flags1 & GAME1_CAMERADISABLED) != GAME1_NONE) && (uVar5 != 0x16)) {
		FUN_0046aca0();
		FUN_0045a9a0(3,FLOAT_00504644,FLOAT_00504648);
		FUN_0045a9f0(3,0.0);
		FUN_0045c6b0(3,(undefined *)(lego::globals::g_Game.level)->oxygenLevel);
		FUN_0045c770(3);
		return;
	}
	if (!bVar7) {
		FUN_0046aca0();
		FUN_0045a9a0(3,FLOAT_00504644,FLOAT_00504648);
		FUN_0045a9f0(3,0.0);
		FUN_0045c6b0(3,(undefined *)(lego::globals::g_Game.level)->oxygenLevel);
		FUN_0045c770(3);
		FUN_00485650((int *)PTR_00504620,0,param_1,NULL);
		lego::image::Image_Blt__0047df70(bitmap,NULL,&local_208,NULL);
		return;
	}
	FUN_0045a9a0(3,FLOAT_00504644,FLOAT_00504648);
	FUN_0045a9f0(3,0.0);
	FUN_0045c6b0(3,(undefined *)(lego::globals::g_Game.level)->oxygenLevel);
	FUN_0045c770(3);
	iVar4 = FUN_00485650((int *)PTR_0050461c,0,param_1,&local_20c);
	pSVar6 = PTR_0050461c;
	if (iVar4 == 0) {
		if ((FLAGS_00504664 & 1) != 0) {
			if (FLOAT_0050463c <= (float)local_20c) {
				FLAGS_00504664 = FLAGS_00504664 & 0xfffffffe;
				return;
			}
			fVar2 = (float)(ulonglong)(uint)PTR_0050461c->font->field_be4;
			FLOAT_00504648 = fVar2 + FLOAT_00504648;
			Rect2F_0050464c.y = fVar2 + Rect2F_0050464c.y;
			Rect2F_0050464c.height = Rect2F_0050464c.height - fVar2;
			lVar8 = __ftol((float10)Rect2F_0050464c.y);
			iVar4 = (int)lVar8;
			lVar8 = __ftol((float10)Rect2F_0050464c.x);
			FUN_00485470(pSVar6,(int)lVar8,iVar4);
			lVar8 = __ftol((float10)Rect2F_0050464c.height);
			uVar5 = (uint)lVar8;
			lVar8 = __ftol((float10)Rect2F_0050464c.width);
			FUN_00485490(PTR_0050461c,(uint)lVar8,uVar5);
			if ((float)(ulonglong)UINT_00504628 <= FLOAT_00504648) {
				FLOAT_00504648 = (float)(ulonglong)UINT_00504628;
				FLAGS_00504664 &= 0xfffffffe;
				Rect2F_0050464c.x = Rect2F_0050462c.x;
				Rect2F_0050464c.y = Rect2F_0050462c.y;
				Rect2F_0050464c.width = Rect2F_0050462c.width;
				Rect2F_0050464c.height = Rect2F_0050462c.height;
				lVar8 = __ftol((float10)Rect2F_0050462c.y);
				iVar4 = (int)lVar8;
				lVar8 = __ftol((float10)Rect2F_0050462c.x);
				FUN_00485470(PTR_0050461c,(int)lVar8,iVar4);
				lVar8 = __ftol((float10)Rect2F_0050464c.height);
				uVar5 = (uint)lVar8;
				lVar8 = __ftol((float10)Rect2F_0050464c.width);
				FUN_00485490(PTR_0050461c,(uint)lVar8,uVar5);
				return;
			}
		}
		return;
	}
	fVar2 = (float)(ulonglong)(uint)PTR_0050461c->font->field_be4;
	FLOAT_00504648 = FLOAT_00504648 - fVar2;
	Rect2F_0050464c.y = Rect2F_0050464c.y - fVar2;
	Rect2F_0050464c.height = fVar2 + Rect2F_0050464c.height;
	lVar8 = __ftol((float10)Rect2F_0050464c.y);
	iVar4 = (int)lVar8;
	lVar8 = __ftol((float10)Rect2F_0050464c.x);
	FUN_00485470(pSVar6,(int)lVar8,iVar4);
	lVar8 = __ftol((float10)Rect2F_0050464c.height);
	uVar5 = (uint)lVar8;
	lVar8 = __ftol((float10)Rect2F_0050464c.width);
	FUN_00485490(PTR_0050461c,(uint)lVar8,uVar5);
	FLAGS_00504664 = FLAGS_00504664 & 0xfffffffe;
	return;
}



void __cdecl
lego::main::Main_InitToolTips_AndBigStruct
					(ImageFont *font,int param_2,int param_3,float param_4,int screenWidth,int screenHeight,
					int param_7,float param_8,float param_9,float param_10)
{
	float *pfVar1;
	int iVar2;
	ToolTipData *pTVar3;
	
	globals::g_ToolTips_TABLE[0] = "ToolTip_RadarBlock";
	globals::g_ToolTips_TABLE[1] = "ToolTip_UnitSelect";
	globals::g_ToolTips_TABLE[2] = "ToolTip_Construction";
	globals::g_ToolTips_TABLE[3] = "ToolTip_InterfaceMenu";
	globals::g_ToolTips_TABLE[4] = "ToolTip_InterfaceMenuBackButton";
	globals::g_ToolTips_TABLE[5] = "ToolTip_MapBlock";
	globals::g_ToolTips_TABLE[6] = "ToolTip_Priority";
	globals::g_ToolTips_TABLE[7] = "ToolTip_InfoMenuContinue";
	globals::g_ToolTips_TABLE[8] = "ToolTip_InfoMenuDisableFuture";
	globals::g_ToolTips_TABLE[9] = "ToolTip_RadarToggle";
	globals::g_ToolTips_TABLE[10] = "ToolTip_RadarObjectView";
	globals::g_ToolTips_TABLE[11] = "ToolTip_RadarZoomIn";
	globals::g_ToolTips_TABLE[12] = "ToolTip_RadarZoomOut";
	globals::g_ToolTips_TABLE[13] = "ToolTip_RadarMapView";
	globals::g_ToolTips_TABLE[14] = "ToolTip_InfoDockGoto";
	globals::g_ToolTips_TABLE[15] = "ToolTip_InfoDockClose";
	globals::g_ToolTips_TABLE[16] = "ToolTip_TopPanelCallToArms";
	globals::g_ToolTips_TABLE[17] = "ToolTip_TopPanelInfo";
	globals::g_ToolTips_TABLE[18] = "ToolTip_TopPanelOptions";
	globals::g_ToolTips_TABLE[19] = "ToolTip_TopPanelPriorities";
	globals::g_ToolTips_TABLE[20] = "ToolTip_PriorityDisable";
	globals::g_ToolTips_TABLE[21] = "ToolTip_PriorityUpOne";
	globals::g_ToolTips_TABLE[22] = "ToolTip_PriorityReset";
	globals::g_ToolTips_TABLE[23] = "ToolTip_CamControlZoomIn";
	globals::g_ToolTips_TABLE[24] = "ToolTip_CamControlZoomOut";
	globals::g_ToolTips_TABLE[25] = "ToolTip_CamControlCycle";
	globals::g_ToolTips_TABLE[26] = "ToolTip_CamControlRotate";
	globals::g_ToolTips_TABLE[27] = "ToolTip_SideBar_Ore";
	globals::g_ToolTips_TABLE[28] = "ToolTip_SideBar_Crystals";
	globals::g_ToolTips_TABLE[29] = "ToolTip_Close";
	globals::g_ToolTips_TABLE[30] = "ToolTip_PreviousMessage";
	globals::g_ToolTips_TABLE[31] = "ToolTip_NextMessage";
	globals::g_ToolTips_TABLE[32] = "ToolTip_More";
	globals::g_ToolTips_TABLE[33] = "ToolTip_Back";
	globals::g_ToolTips_TABLE[34] = "ToolTip_CamControlCycleMinifigures";
	globals::g_ToolTips_TABLE[35] = "ToolTip_Reward_Save";
	globals::g_ToolTips_TABLE[36] = "ToolTip_Reward_Advance";
	globals::g_ToolTips_TABLE[37] = "ToolTip_FrontEnd_Back";
	FONT_0054cf20 = (ImageFont **)font;
	DAT_0054cf24 = draw::Font_GetField_be4(font);
	FLOAT_0054cf3c = param_4 * 25.0;
	UINT_0054cf28 = param_2;
	INT_0054cf2c = param_3;
	FLOAT_ARRAY_0054cf40[1] = param_8 + param_8 * 0.4;
	INT_0054cf30 = screenWidth;
	INT_0054cf34 = screenHeight;
	INT_0054cf38 = param_7;
	FLOAT_ARRAY_0054cf40[0] = param_8;
	FLOAT_ARRAY_0054cf40[3] = param_9;
	FLOAT_ARRAY_0054cf40[6] = param_10;
	FLOAT_ARRAY_0054cf40[4] = param_9 + param_9 * 0.4;
	FLOAT_ARRAY_0054cf40[7] = param_10 + param_10 * 0.4;
	FLOAT_ARRAY_0054cf40[2] = param_8 - param_8 * 0.4;
	pfVar1 = FLOAT_ARRAY_0054cf40 + 3;
	FLOAT_ARRAY_0054cf40[5] = param_9 - param_9 * 0.4;
	FLOAT_ARRAY_0054cf40[8] = param_10 - param_10 * 0.4;
	do {
		if ((ushort)((ushort)(pfVar1[-3] < 1.0) << 8 | (ushort)(pfVar1[-3] == 1.0) << 0xe) == 0) {
			pfVar1[-3] = 1.0;
		}
		if ((ushort)((ushort)(*pfVar1 < 1.0) << 8 | (ushort)(*pfVar1 == 1.0) << 0xe) == 0) {
			*pfVar1 = 1.0;
		}
		if ((ushort)((ushort)(pfVar1[3] < 1.0) << 8 | (ushort)(pfVar1[3] == 1.0) << 0xe) == 0) {
			pfVar1[3] = 1.0;
		}
		if (pfVar1[-3] < 0.0) {
			pfVar1[-3] = 0.0;
		}
		if (*pfVar1 < 0.0) {
			*pfVar1 = 0.0;
		}
		if (pfVar1[3] < 0.0) {
			pfVar1[3] = 0.0;
		}
		pfVar1 = pfVar1 + 1;
	} while (pfVar1 < FLOAT_ARRAY_0054cf40 + 6);
	pTVar3 = globals::g_ToolTipsData_TABLE;
	for (iVar2 = 0x1839; iVar2 != 0; iVar2 += -1) {
		pTVar3->float_0 = 0.0;
		pTVar3 = (ToolTipData *)pTVar3->tooltipText;
	}
	return;
}



undefined4 __cdecl FUN_0046b790(char *param_1,int *param_2)
{
	int iVar1;
	char **ppcVar2;
	int iVar3;
	
	iVar3 = 1;
	ppcVar2 = lego::globals::g_ToolTips_TABLE;
	do {
		iVar1 = std::_stricmp(param_1,*ppcVar2);
		if (iVar1 == 0) {
			*param_2 = iVar3;
			return 1;
		}
		ppcVar2 = (char **)((int)ppcVar2 + 4);
		iVar3 += 1;
	} while (ppcVar2 < lego::globals::g_ToolTipsData_TABLE);
	return 0;
}



void __cdecl lego::unk::Lego_LoadToolTip_HasNLEscape__0046b7e0(int index,char *format,...)
{
	byte *pbVar1;
	byte bVar2;
	uint uVar3;
	int iVar4;
	int iVar5;
	ImageBMP *pIVar6;
	byte *pbVar7;
	byte *pbVar8;
	char filename [260];
	char tooltipText [512];
	
	std::vsprintf(tooltipText,format,&stack0x0000000c);
										// Use @ to denote an image...
	if (tooltipText[0] == '@') {
		iVar5 = 1;
		while (tooltipText[1] != '\0') {
			filename[iVar5 + -1] = tooltipText[1];
			iVar4 = iVar5 + 1;
			iVar5 += 1;
			tooltipText[1] = tooltipText[iVar4];
		}
		filename[iVar5 + -1] = '\0';
		pIVar6 = image::Image_LoadBMP(filename,0,0);
		globals::g_ToolTipsData_TABLE[index].tooltipImage = pIVar6;
		globals::g_ToolTipsData_TABLE[index].flags = globals::g_ToolTipsData_TABLE[index].flags | 8;
	}
	else {
		pbVar7 = (byte *)tooltipText;
		pbVar8 = (byte *)globals::g_ToolTipsData_TABLE[index].tooltipText;
		while (tooltipText[0] != 0) {
			bVar2 = *pbVar7;
										// an \n as a return character...
			if ((bVar2 == '\\') && (pbVar7[1] == 'n')) {
				*pbVar8 = '\n';
				pbVar7 = pbVar7 + 1;
			}
			else {
										// Use underscores as spaces
				if (bVar2 == '_') {
					*pbVar8 = ' ';
				}
				else {
					*pbVar8 = bVar2;
				}
			}
			pbVar1 = pbVar7 + 1;
			pbVar8 = pbVar8 + 1;
			pbVar7 = pbVar7 + 1;
			tooltipText[0] = *pbVar1;
		}
		*pbVar8 = 0;
		FUN_00401bc0((ImageFont *)FONT_0054cf20,
								 (uint *)&globals::g_ToolTipsData_TABLE[index].field_0x204,
								 (int *)&globals::g_ToolTipsData_TABLE[index].field_0x208,
								 (byte *)globals::g_ToolTipsData_TABLE[index].tooltipText);
		globals::g_ToolTipsData_TABLE[index].flags =
				 globals::g_ToolTipsData_TABLE[index].flags & 0xfffffff7;
	}
	uVar3 = globals::g_ToolTipsData_TABLE[index].flags;
	globals::g_ToolTipsData_TABLE[index].field_25c = 0;
	globals::g_ToolTipsData_TABLE[index].field_264 = 0;
	globals::g_ToolTipsData_TABLE[index].field_260 = 0;
	globals::g_ToolTipsData_TABLE[index].field_26c = 0;
	globals::g_ToolTipsData_TABLE[index].field_268 = 0;
	globals::g_ToolTipsData_TABLE[index].flags = uVar3 | 3;
	return;
}



void __cdecl FUN_0046b920(int param_1,int param_2)
{
	int iVar1;
	int iVar2;
	
	if (param_2 == 0) {
		lego::globals::g_ToolTipsData_TABLE[param_1].field_260 = 0;
		lego::globals::g_ToolTipsData_TABLE[param_1].field_268 = 0;
	}
	else {
		if ((int)lego::globals::g_ToolTipsData_TABLE[param_1].field_260 < *(int *)(param_2 + 8)) {
			iVar1 = lego::globals::g_ToolTipsData_TABLE[param_1].field_264 -
							lego::globals::g_ToolTipsData_TABLE[param_1].field_260;
			lego::globals::g_ToolTipsData_TABLE[param_1].field_264 = iVar1;
			iVar2 = *(int *)(param_2 + 8);
			lego::globals::g_ToolTipsData_TABLE[param_1].field_260 = iVar2;
			lego::globals::g_ToolTipsData_TABLE[param_1].field_264 = iVar1 + iVar2;
		}
		iVar2 = lego::globals::g_ToolTipsData_TABLE[param_1].field_268 + *(int *)(param_2 + 4);
		lego::globals::g_ToolTipsData_TABLE[param_1].field_268 = iVar2;
		if ((int)lego::globals::g_ToolTipsData_TABLE[param_1].field_26c < iVar2) {
			lego::globals::g_ToolTipsData_TABLE[param_1].field_26c = iVar2;
		}
	}
	*(int *)(param_1 * 0x27c + 0x54d20c + lego::globals::g_ToolTipsData_TABLE[param_1].field_25c * 4)
			 = param_2;
	lego::globals::g_ToolTipsData_TABLE[param_1].field_25c =
			 lego::globals::g_ToolTipsData_TABLE[param_1].field_25c + 1;
	return;
}



void __cdecl FUN_0046b9c0(int param_1,undefined4 param_2)
{
	uint uVar1;
	
	uVar1 = lego::globals::g_ToolTipsData_TABLE[param_1].flags;
	lego::globals::g_ToolTipsData_TABLE[param_1].field_274 = param_2;
	lego::globals::g_ToolTipsData_TABLE[param_1].flags = uVar1 | 3;
	return;
}



void __cdecl FUN_0046b9f0(int param_1,int param_2)
{
	if (param_2 != 0) {
		lego::globals::g_ToolTipsData_TABLE[param_1].flags =
				 lego::globals::g_ToolTipsData_TABLE[param_1].flags | 0x10;
		return;
	}
	lego::globals::g_ToolTipsData_TABLE[param_1].flags =
			 lego::globals::g_ToolTipsData_TABLE[param_1].flags & 0xffffffef;
	return;
}



void __cdecl FUN_0046ba30(int param_1)
{
	lego::globals::g_ToolTipsData_TABLE[param_1].flags =
			 lego::globals::g_ToolTipsData_TABLE[param_1].flags | 4;
	return;
}



void __cdecl FUN_0046ba60(int param_1)
{
	lego::globals::g_ToolTipsData_TABLE[param_1].float_0 = FLOAT_0054cf3c;
	return;
}



void __cdecl FUN_0046ba80(uint mousex,uint mousey,float milliseconds)
{
	float *pfVar1;
	bool bVar2;
	BOOL BVar3;
	uint uVar4;
	bool bVar5;
	uint *puVar6;
	
	bVar5 = false;
	bVar2 = false;
	puVar6 = &lego::globals::g_ToolTipsData_TABLE[1].flags;
	uVar4 = BOOL_004ab64c;
	do {
		if ((*puVar6 & 3) != 0) {
			if (((*puVar6 & 4) == 0) || (bVar2)) {
				puVar6[-0x9e] = 0;
			}
			else {
				pfVar1 = (float *)(puVar6 + -0x9e);
				if (((float)puVar6[-0x9e] < FLOAT_0054cf3c) || (bVar5)) {
					uVar4 = 1;
					BOOL_004ab64c = 1;
					bVar2 = true;
					*pfVar1 = milliseconds + *pfVar1;
				}
				else {
					if (((puVar6[-1] != 0) && (uVar4 != 0)) &&
						 ((lego::globals::g_Game.flags2 & GAME2_DISABLETOOLTIPSOUND) == GAME2_NONE)) {
						BVar3 = lego::snd::Snd_FUN_004651b0(puVar6[-1],NULL);
						uVar4 = (uint)(BVar3 == 0);
						BOOL_004ab64c = uVar4;
					}
					if (puVar6 != (uint *)0x274) {
						FUN_0046bef0((int)pfVar1,mousex,mousey);
						uVar4 = BOOL_004ab64c;
					}
					bVar5 = true;
					bVar2 = true;
					*pfVar1 = milliseconds + *pfVar1;
				}
			}
			*puVar6 = *puVar6 & 0xfffffffb;
		}
		puVar6 = puVar6 + 0x9f;
	} while (puVar6 < &DAT_0055335c);
	return;
}



void __cdecl
FUN_0046bb70(float param_1,float param_2,float param_3,float param_4,undefined4 param_5,
						undefined4 param_6,undefined4 param_7,float param_8,float param_9,float param_10,
						float param_11,float param_12,float param_13,int param_14)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	float fVar6;
	float *pfVar7;
	float *pfVar8;
	float *pfVar9;
	float *pfVar10;
	int iVar11;
	float *pfVar12;
	float *pfVar13;
	float *local_168;
	float *local_164;
	int local_160;
	uint local_15c;
	float local_140 [20];
	float local_f0 [20];
	float local_a0 [20];
	float local_50 [20];
	
	iVar11 = 0;
	local_160 = 0;
	local_15c = 0;
	if (UINT_0054cf28 != 0) {
		local_168 = local_f0;
		local_164 = local_f0 + 1;
		pfVar8 = local_50;
		pfVar13 = local_50 + 1;
		pfVar10 = local_140 + 1;
		pfVar12 = local_140;
		pfVar9 = local_a0 + 1;
		pfVar7 = local_a0;
		do {
			fVar4 = (float)(ulonglong)local_15c;
			fVar2 = param_1 + fVar4;
			fVar3 = param_2 + fVar4;
			fVar6 = ((param_2 + param_4) - 1.0) - fVar4;
			fVar5 = ((param_1 + param_3) - 1.0) - fVar4;
			*pfVar7 = fVar2;
			*pfVar9 = fVar3;
			fVar1 = *pfVar7;
			*pfVar8 = fVar2;
			*pfVar10 = ((param_2 + param_4) - 2.0) - fVar4;
			*pfVar13 = fVar6;
			pfVar7[2] = fVar5;
			*pfVar12 = fVar1;
			*local_168 = ((param_1 + param_3) - 2.0) - fVar4;
			pfVar9[2] = fVar3;
			*local_164 = fVar6;
			pfVar8[2] = fVar5;
			pfVar12[2] = fVar2 - -1.0;
			pfVar13[2] = fVar6;
			fVar1 = pfVar8[2];
			pfVar10[2] = fVar3;
			pfVar7 = pfVar7 + 4;
			pfVar9 = pfVar9 + 4;
			pfVar12 = pfVar12 + 4;
			pfVar13 = pfVar13 + 4;
			local_164[2] = fVar3 - -1.0;
			pfVar8 = pfVar8 + 4;
			local_168[2] = fVar1;
			iVar11 = local_160 + 2;
			local_168 = local_168 + 4;
			pfVar10 = pfVar10 + 4;
			local_164 = local_164 + 4;
			local_15c += 1;
			local_160 = iVar11;
		} while (local_15c < UINT_0054cf28);
	}
	if (param_14 == 0) {
		lego::draw::Draw_SurfaceLock_FUN_00486350(&param_1,1,param_5,param_6,param_7,0);
		lego::draw::Draw_SurfaceLock_FUN_004862b0(local_a0,local_140,iVar11,param_8,param_9,param_10,0);
		lego::draw::Draw_SurfaceLock_FUN_004862b0(local_50,local_f0,iVar11,param_11,param_12,param_13,0)
		;
		return;
	}
	lego::draw::Draw_SurfaceLock_FUN_00486350(&param_1,1,param_5,param_6,param_7,2);
	lego::draw::Draw_SurfaceLock_FUN_004862b0(local_a0,local_140,iVar11,param_8,param_9,param_10,0);
	lego::draw::Draw_SurfaceLock_FUN_004862b0(local_50,local_f0,iVar11,param_11,param_12,param_13,0);
	return;
}



void __cdecl FUN_0046bef0(int param_1,uint param_2,uint param_3)
{
	int iVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	ImageBMP **ppIVar5;
	int iVar6;
	float10 extraout_ST0;
	float10 extraout_ST1;
	longlong lVar7;
	char *format;
	float local_44;
	float fStack64;
	uint local_3c;
	undefined4 uStack56;
	float local_34;
	float fStack48;
	float local_2c;
	float local_28;
	float fStack36;
	float local_20;
	float local_1c;
	float fStack24;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	local_34 = FLOAT_ARRAY_0054cf40[0];
	fStack48 = FLOAT_ARRAY_0054cf40[3];
	local_28 = FLOAT_ARRAY_0054cf40[1];
	fStack36 = FLOAT_ARRAY_0054cf40[4];
	local_2c = FLOAT_ARRAY_0054cf40[6];
	local_1c = FLOAT_ARRAY_0054cf40[2];
	fStack24 = FLOAT_ARRAY_0054cf40[5];
	local_20 = FLOAT_ARRAY_0054cf40[7];
	iVar2 = (INT_0054cf2c + UINT_0054cf28) * 2;
	local_14 = FLOAT_ARRAY_0054cf40[8];
	if ((*(uint *)(param_1 + 0x278) & 8) == 0) {
		uVar4 = *(uint *)(param_1 + 0x204);
		if (*(uint *)(param_1 + 0x204) <= *(uint *)(param_1 + 0x26c)) {
			uVar4 = *(uint *)(param_1 + 0x26c);
		}
		iVar6 = *(int *)(param_1 + 0x208) * DAT_0054cf24 + *(int *)(param_1 + 0x264);
	}
	else {
		uVar4 = *(uint *)(*(int *)(param_1 + 0x270) + 4);
		iVar6 = *(int *)(*(int *)(param_1 + 0x270) + 8);
	}
	uVar3 = iVar2 + iVar6;
	local_44 = (float)(iVar2 + uVar4);
	if ((*(uint *)(param_1 + 0x278) & 0x10) == 0) {
		if ((uint)INT_0054cf30 < (int)local_44 + param_2) {
			local_10 = (float)(ulonglong)(uint)(INT_0054cf30 - (int)local_44);
		}
		else {
			local_10 = (float)(ulonglong)param_2;
		}
	}
	else {
		local_10 = (float)(ulonglong)param_2 - -32.0;
		if ((ushort)((ushort)(local_10 < (float)(ulonglong)(uint)INT_0054cf30) << 8 |
								(ushort)(local_10 == (float)(ulonglong)(uint)INT_0054cf30) << 0xe) == 0) {
			local_10 = (float)(ulonglong)(uint)(INT_0054cf30 - (int)local_44);
		}
		else {
			local_10 = local_10 - (float)(ulonglong)(uint)local_44;
		}
	}
	local_c = (float)(ulonglong)(INT_0054cf38 + param_3);
	local_4 = (float)(ulonglong)uVar3;
	if ((float)(ulonglong)(uint)INT_0054cf34 < local_c + local_4) {
		local_c = (float)(ulonglong)(param_3 - uVar3) - 1.0;
	}
	fStack64 = 0.0;
	local_8 = (float)(ulonglong)(uint)local_44;
	FUN_0046bb70(local_10,local_c,local_8,local_4,FLOAT_ARRAY_0054cf40[0],FLOAT_ARRAY_0054cf40[3],
							 FLOAT_ARRAY_0054cf40[6],FLOAT_ARRAY_0054cf40[1],FLOAT_ARRAY_0054cf40[4],
							 FLOAT_ARRAY_0054cf40[7],FLOAT_ARRAY_0054cf40[2],FLOAT_ARRAY_0054cf40[5],
							 FLOAT_ARRAY_0054cf40[8],0);
	if ((*(byte *)(param_1 + 0x278) & 8) == 0) {
		param_2 = *(int *)(param_1 + 0x208) * DAT_0054cf24;
		local_3c = INT_0054cf2c;
		uStack56 = 0;
		iVar2 = param_1 + 4;
		uVar4 = 0;
		iVar6 = 0;
		format = "%s";
		lVar7 = __ftol((float10)local_c + (float10)(ulonglong)(uint)INT_0054cf2c +
									 (float10)(ulonglong)UINT_0054cf28);
		iVar1 = (int)lVar7;
		lVar7 = __ftol((float10)local_10 + extraout_ST0 + extraout_ST1);
		FUN_0047a440((ImageFont *)FONT_0054cf20,(int)lVar7,iVar1,format,iVar2);
		param_3 = 0;
		if (*(int *)(param_1 + 0x25c) != 0) {
			ppIVar5 = (ImageBMP **)(param_1 + 0x20c);
			do {
				if (*ppIVar5 == NULL) {
					param_2 += iVar6;
					iVar6 = 0;
					uVar4 = 0;
				}
				else {
					local_3c = UINT_0054cf28;
					uStack56 = 0;
					local_34 = (float)INT_0054cf2c;
					fStack48 = 0.0;
					fStack36 = 0.0;
					fStack24 = 0.0;
					local_1c = (float)param_2;
					local_44 = (float)(ulonglong)uVar4 +
										 local_10 + (float)(ulonglong)(uint)INT_0054cf2c +
										 (float)(ulonglong)UINT_0054cf28;
					fStack64 = (float)(ulonglong)param_2 +
										 local_c + (float)(ulonglong)(uint)INT_0054cf2c +
										 (float)(ulonglong)UINT_0054cf28;
					local_28 = (float)uVar4;
					lego::image::Image_Blt__0047df70(*ppIVar5,NULL,&local_44,NULL);
					iVar2 = (*ppIVar5)->height;
					if (iVar6 < iVar2) {
						iVar6 = iVar2;
					}
					uVar4 += (*ppIVar5)->width;
				}
				param_3 += 1;
				ppIVar5 = ppIVar5 + 1;
			} while (param_3 < *(uint *)(param_1 + 0x25c));
		}
		return;
	}
	local_3c = INT_0054cf2c;
	uStack56 = 0;
	local_44 = local_10 + (float)(ulonglong)(uint)INT_0054cf2c + (float)(ulonglong)UINT_0054cf28;
	fStack64 = local_c + (float)(ulonglong)(uint)INT_0054cf2c + (float)(ulonglong)UINT_0054cf28;
	lego::image::Image_Blt__0047df70(*(ImageBMP **)(param_1 + 0x270),NULL,&local_44,NULL);
	return;
}



void __cdecl FUN_0046c2f0(undefined4 *param_1,undefined4 param_2,undefined4 *param_3,char *param_4)
{
	ResourceData *pRVar1;
	
	*param_1 = 0;
	param_1[1] = 0;
	param_1[2] = 0;
	param_1[3] = 0;
	pRVar1 = lego::res::Res_LoadResource((ResourceData *)param_3,param_4,"LWO",1);
	param_1[1] = pRVar1;
	if (pRVar1 == NULL) {
		pRVar1 = lego::res::Res_LoadResource((ResourceData *)param_3,param_4,"ACT",1);
		param_1[1] = pRVar1;
	}
	if (param_1[1] == 0) {
		pRVar1 = lego::res::Res_LoadResource((ResourceData *)param_3,param_4,"MESH",1);
		param_1[1] = pRVar1;
	}
	param_1[2] = 0;
	*param_1 = param_2;
	return;
}



void __cdecl lego::res::Upgrade_Duplicate(UpgradeData *in_upgrade,UpgradeData *out_upgrade)
{
	ResourceData *pRVar1;
	
	out_upgrade->objectIndex = in_upgrade->objectIndex;
	out_upgrade->aeResData = in_upgrade->aeResData;
	out_upgrade->object_8 = in_upgrade->object_8;
	out_upgrade->field_c = in_upgrade->field_c;
	pRVar1 = Res_DuplicateResource(in_upgrade->aeResData);
	out_upgrade->aeResData = pRVar1;
	return;
}



void __cdecl FUN_0046c3b0(int param_1)
{
	lego::pool::ReservedPool_ResourceData___Release(*(ResourceData **)(param_1 + 4));
	return;
}



float10 __cdecl FUN_0046c3d0(UpgradeData *param_1,float param_2,undefined4 param_3)
{
	lego::res::Res_DoAnimElapsedCallbacks(param_1->aeResData,param_2);
	return (float10)0.0;
}



void __cdecl FUN_0046c3f0(UpgradeData *upgrade,char *param_2)
{
	BOOL BVar1;
	
	BVar1 = lego::res::Res_ResourceShortNormal_FUN_00473630(upgrade->aeResData,param_2);
	if (BVar1 == 0) {
		lego::res::Res_ResourceShortNormal_FUN_00473630
							(upgrade->aeResData,lego::globals::g_Activities_TABLE[0]);
	}
	return;
}



void __cdecl
lego::res::Res_LoadUpgradeLevels(ObjectUpgradesData *upgrades,CFGProperty *aeRoot,char *rootName)
{
	char cVar1;
	ObjectUpgradePartData *pOVar2;
	char *pcVar3;
	CFGProperty *prop;
	undefined4 *puVar4;
	UpgradeData *pUVar5;
	int iVar6;
	uint uVar7;
	uint uVar8;
	undefined4 *puVar9;
	char *pcVar10;
	uint local_12c;
	char *local_128;
	char *local_124;
	char *local_120;
	char local_100 [256];
	
	upgrades->count = 0;
	pOVar2 = (ObjectUpgradePartData *)std::malloc(4000);
	upgrades->parts = pOVar2;
	for (iVar6 = 1000; iVar6 != 0; iVar6 += -1) {
		pOVar2->level = 0;
		pOVar2 = (ObjectUpgradePartData *)&pOVar2->NullInstance;
	}
	local_12c = 0;
	do {
		std::sprintf(local_100,"Level%i%i%i%i",local_12c >> 3 & 1,local_12c >> 2 & 1,local_12c >> 1 & 1,
								 local_12c & 1);
		pcVar3 = cfg::CFG_JoinPath(rootName,"Upgrades",local_100,0);
		prop = cfg::CFG_GetBlockFirstChild(aeRoot,pcVar3);
		if (prop != NULL) {
			upgrades->levelsMask = upgrades->levelsMask | local_12c;
			for (; prop != NULL; prop = cfg::CFG_NextFlatProperty(prop)) {
				uVar7 = 0xffffffff;
				pOVar2 = upgrades->parts + upgrades->count;
				pcVar3 = prop->value;
				do {
					pcVar10 = pcVar3;
					if (uVar7 == 0) break;
					uVar7 -= 1;
					pcVar10 = pcVar3 + 1;
					cVar1 = *pcVar3;
					pcVar3 = pcVar10;
				} while (cVar1 != '\0');
				uVar7 = ~uVar7;
				puVar4 = (undefined4 *)(pcVar10 + -uVar7);
				puVar9 = (undefined4 *)local_100;
				for (uVar8 = uVar7 >> 2; uVar8 != 0; uVar8 -= 1) {
					*puVar9 = *puVar4;
					puVar4 = puVar4 + 1;
					puVar9 = puVar9 + 1;
				}
				for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
					*(undefined *)puVar9 = *(undefined *)puVar4;
					puVar4 = (undefined4 *)((int)puVar4 + 1);
					puVar9 = (undefined4 *)((int)puVar9 + 1);
				}
				iVar6 = util::stringSplit(local_100,&local_128,",");
				if (iVar6 == 3) {
					uVar7 = 0xffffffff;
					pcVar3 = local_120;
					do {
						if (uVar7 == 0) break;
						uVar7 -= 1;
						cVar1 = *pcVar3;
						pcVar3 = pcVar3 + 1;
					} while (cVar1 != '\0');
					puVar4 = (undefined4 *)std::malloc(~uVar7);
					uVar7 = 0xffffffff;
					pOVar2->WeaponName = (char *)puVar4;
					pcVar3 = local_120;
					do {
						pcVar10 = pcVar3;
						if (uVar7 == 0) break;
						uVar7 -= 1;
						pcVar10 = pcVar3 + 1;
						cVar1 = *pcVar3;
						pcVar3 = pcVar10;
					} while (cVar1 != '\0');
					uVar7 = ~uVar7;
					puVar9 = (undefined4 *)(pcVar10 + -uVar7);
					for (uVar8 = uVar7 >> 2; uVar8 != 0; uVar8 -= 1) {
						*puVar4 = *puVar9;
						puVar9 = puVar9 + 1;
						puVar4 = puVar4 + 1;
					}
					for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
						*(undefined *)puVar4 = *(undefined *)puVar9;
						puVar9 = (undefined4 *)((int)puVar9 + 1);
						puVar4 = (undefined4 *)((int)puVar4 + 1);
					}
				}
				pcVar3 = std::_strdup(local_128);
				pOVar2->NullObjectName = pcVar3;
				pOVar2->level = local_12c;
				iVar6 = std::atoi(local_124);
				pOVar2->NullInstance = iVar6 + -1;
				pUVar5 = game::Game_GetUpgradeData(prop->key);
				pOVar2->upgradeData = pUVar5;
				upgrades->count = upgrades->count + 1;
			}
		}
		local_12c += 1;
		if (0xf < local_12c) {
			if (upgrades->count == 0) {
				std::free(upgrades->parts);
				upgrades->parts = NULL;
			}
			return;
		}
	} while( true );
}



void __cdecl lego::game::LiveObject_ChangeUpgradeParts(ObjectUpgradesData *upgrades,int objLevel)
{
	LiveObject *pLVar1;
	LiveObject *pLVar2;
	UpgradeData *pUVar3;
	int iVar4;
	uint objIndex;
	
	iVar4 = 0;
	pLVar2 = (LiveObject *)upgrades->upgradeObjs;
	pUVar3 = (UpgradeData *)objLevel;
	while (pLVar2 != NULL) {
		pUVar3 = pLVar2->upgrade;
		pLVar1 = pUVar3->object_8;
		pool::ReservedPool_LiveObject___Release(pLVar2);
		pLVar2 = pLVar1;
	}
	objIndex = 0;
	upgrades->currentLevel = objLevel;
	upgrades->upgradeObjs = NULL;
	if (upgrades->count != 0) {
		do {
			if (*(int *)((int)&upgrades->parts->level + iVar4) == objLevel) {
				pLVar2 = LiveObject__Create(*(int ***)((int)&upgrades->parts->upgradeData + iVar4),
																		OBJECT_UPGRADEPART,objIndex);
				if (upgrades->upgradeObjs == NULL) {
					upgrades->upgradeObjs = (LiveObject **)pLVar2;
				}
				else {
					pUVar3->object_8 = pLVar2;
				}
				pUVar3 = pLVar2->upgrade;
				pUVar3->field_c = (int)&upgrades->parts->level + iVar4;
			}
			objIndex += 1;
			iVar4 += 0x14;
		} while (objIndex < upgrades->count);
	}
	return;
}



BOOL __cdecl lego::res::Vehicle_IsCameraFlipDir(VehicleData *vehicle)
{
	return (uint)(vehicle->CameraFlipDir == BOOL3_TRUE);
}



uint __cdecl FUN_0046c6b0(VehicleData *vehicle,char *activityName,float elapsed)
{
	uint uVar1;
	uint uVar2;
	BOOL BVar3;
	undefined4 *puVar4;
	
	FUN_00451ef0(vehicle->subdata_1e0);
	uVar1 = 0;
	vehicle->field_cc = 0;
	vehicle->field_d0 = 0;
	vehicle->resData_d4 = NULL;
	if (vehicle->CameraNullFrames != 0) {
		puVar4 = vehicle->cameraFramesTable_10c;
		do {
			*puVar4 = 0;
			uVar1 += 1;
			puVar4 = puVar4 + 1;
		} while (uVar1 < vehicle->CameraNullFrames);
	}
	uVar1 = 0;
	if (vehicle->CarryNullFrames != 0) {
		puVar4 = vehicle->carryFramesTable_e4;
		do {
			*puVar4 = 0;
			uVar1 += 1;
			puVar4 = puVar4 + 1;
		} while (uVar1 < vehicle->CarryNullFrames);
	}
	uVar2 = lego::res::Res_ResourceShortNormal_FUN_00473630(vehicle->aeResData1,activityName);
	uVar1 = vehicle->flags;
	vehicle->flags = uVar1 & 0xfffffffb;
	if ((uVar2 == 0) && ((uVar1 & 8) != 0)) {
		BVar3 = FUN_00473600(vehicle->aeResData1,activityName);
		if (BVar3 == 0) {
			vehicle->flags = vehicle->flags | 4;
		}
	}
	if (vehicle->aeResData2 != NULL) {
		uVar1 = lego::res::Res_ResourceShortNormal_FUN_00473630(vehicle->aeResData2,activityName);
		uVar2 |= uVar1;
	}
	if ((*(byte *)&vehicle->flags & 4) == 0) {
		lego::res::Res_DoCallbacks(vehicle->aeResData1,elapsed);
	}
	if (vehicle->aeResData2 != NULL) {
		lego::res::Res_DoCallbacks(vehicle->aeResData2,elapsed);
	}
	FUN_0046d520(vehicle);
	lego::game::LiveObject_VehicleUnkUpgrades(vehicle,activityName);
	return uVar2;
}



void __cdecl lego::game::LiveObject_VehicleUnkUpgrades(VehicleData *vehicle,char *param_2)
{
	int *opt_index;
	LiveObject *pLVar1;
	int iVar2;
	VehicleData *vehicle_00;
	undefined4 *puVar3;
	ResourceData *pRVar4;
	ResourceData *resData;
	char *pcVar5;
	undefined4 *puVar6;
	int iVar7;
	UpgradeData *upgrade;
	uint local_14;
	int local_10;
	int local_c;
	int local_8;
	UpgradeData *local_4;
	
	vehicle_00 = vehicle;
	iVar7 = 3;
	pLVar1 = (LiveObject *)(vehicle->upgrades).upgradeObjs;
	puVar3 = (undefined4 *)&vehicle->field_0x15c;
	puVar6 = (undefined4 *)&vehicle->field_0x138;
	do {
		puVar3[0x1a] = 0;
		*puVar3 = 0;
		puVar3[-3] = 0;
		*puVar6 = 0;
		puVar3 = puVar3 + 1;
		iVar7 += -1;
		puVar6[1] = 0;
		puVar6 = puVar6 + 2;
	} while (iVar7 != 0);
	vehicle->field_1dc = 0;
	do {
		if (pLVar1 == NULL) {
			return;
		}
		upgrade = pLVar1->upgrade;
		iVar7 = upgrade->field_c;
		local_8 = iVar7;
		local_4 = upgrade;
		pRVar4 = res::Vehicle_GetNull(vehicle_00,*(undefined4 *)(iVar7 + 8),*(undefined4 *)(iVar7 + 4));
		resData = LiveObject_GetAEResource((BasicObjectData *)upgrade);
		FUN_004759d0(resData,pRVar4);
		res::Res_IdentityFrameTransform(resData);
		if (param_2 == NULL) {
			res::Res_ResourceShortNormal_FUN_00473630(upgrade->aeResData,globals::g_Activities_TABLE[0]);
		}
		else {
			FUN_0046c3f0(upgrade,param_2);
		}
		if (*(int *)(iVar7 + 0xc) != 0) {
			iVar7 = vehicle_00->field_1dc;
			local_10 = 0;
			vehicle_00->table6_1c4[iVar7 + -0x15] = 0;
			local_14 = 0;
			opt_index = vehicle_00->table6_1c4 + iVar7 + -0x15;
			vehicle = (VehicleData *)(vehicle_00->cameraFramesTable_10c + iVar7 * 2 + 0xb);
			local_c = iVar7;
			do {
				vehicle->objIndex = 0;
				pcVar5 = res::Res_GetNull(vehicle_00->aeResData1,vehicle_00->FireNullName,opt_index);
				pRVar4 = FUN_00473e80(resData,pcVar5,0,NULL);
				vehicle_00->cameraFramesTable_10c[*opt_index + iVar7 * 2 + 0xb] = pRVar4;
				iVar2 = vehicle_00->cameraFramesTable_10c[iVar7 * 2 + *opt_index + 0xb];
				*opt_index = *opt_index + 1;
				if (iVar2 == 0) break;
				local_14 += 1;
				vehicle = (VehicleData *)&vehicle->WheelNullName;
			} while (local_14 < 2);
			pcVar5 = res::Res_GetNull(vehicle_00->aeResData1,vehicle_00->xPivot,&local_10);
			pRVar4 = FUN_00473e80(resData,pcVar5,0,NULL);
			iVar7 = local_c;
			vehicle_00->cameraFramesTable_10c[local_c + 0x11] = pRVar4;
			pcVar5 = res::Res_GetNull(vehicle_00->aeResData1,vehicle_00->yPivot,&local_10);
			pRVar4 = FUN_00473e80(resData,pcVar5,0,NULL);
			vehicle_00->cameraFramesTable_10c[iVar7 + 0x14] = pRVar4;
			vehicle_00->table6_1c4[iVar7] = local_8;
			vehicle_00->field_1dc = vehicle_00->field_1dc + 1;
			upgrade = local_4;
		}
		pLVar1 = upgrade->object_8;
	} while( true );
}



// WARNING: Function: _alloca4k replaced with injection: alloca_probe

BOOL __cdecl
lego::res::Res_LoadAEFileVehicle
					(VehicleData *vehicle,int index,ResourceData *resRoot,char *aeFilename,char *rootName)
{
	char cVar1;
	int iVar2;
	ResourceData *pRVar3;
	CFGProperty *prop;
	char *pcVar4;
	BOOL3 BVar5;
	PolyMeshData *pPVar6;
	CFGProperty *aeRoot;
	int iVar7;
	uint uVar8;
	uint uVar9;
	int *piVar10;
	undefined4 *puVar11;
	VehicleData *pVVar12;
	ResourceData **ppRVar13;
	char *pcVar14;
	undefined4 *puVar15;
	float10 fVar16;
	char *pcStack4560;
	char *pcStack4556;
	float fStack4520;
	float fStack4516;
	float fStack4504;
	char *apcStack4500 [2];
	int aiStack4492 [99];
	undefined4 auStack4096 [256];
	char acStack3072 [1024];
	undefined4 local_800 [256];
	char local_400 [1020];
	undefined4 uStack4;
	
	uStack4 = 0x46c9ba;
	pVVar12 = vehicle;
	for (iVar7 = 0x7b; iVar7 != 0; iVar7 += -1) {
		pVVar12->objIndex = 0;
		pVVar12 = (VehicleData *)&pVVar12->WheelNullName;
	}
	uVar8 = 0xffffffff;
	do {
		pcVar4 = aeFilename;
		if (uVar8 == 0) break;
		uVar8 -= 1;
		pcVar4 = aeFilename + 1;
		cVar1 = *aeFilename;
		aeFilename = pcVar4;
	} while (cVar1 != '\0');
	uVar8 = ~uVar8;
	puVar11 = (undefined4 *)(pcVar4 + -uVar8);
	puVar15 = local_800;
	for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
		*puVar15 = *puVar11;
		puVar11 = puVar11 + 1;
		puVar15 = puVar15 + 1;
	}
	for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
		*(undefined *)puVar15 = *(undefined *)puVar11;
		puVar11 = (undefined4 *)((int)puVar11 + 1);
		puVar15 = (undefined4 *)((int)puVar15 + 1);
	}
	iVar7 = util::stringSplit((char *)local_800,&pcStack4560,",");
	pRVar3 = Res_LoadResource(resRoot,pcStack4560,"ACT",1);
	vehicle->aeResData1 = pRVar3;
	if (pRVar3 != NULL) {
		if (iVar7 == 2) {
			pRVar3 = Res_LoadResource(pRVar3,pcStack4556,"ACT",1);
			vehicle->aeResData2 = pRVar3;
		}
		else {
			vehicle->aeResData2 = NULL;
		}
		uVar8 = 0xffffffff;
		pcVar4 = pcStack4560;
		do {
			pcVar14 = pcVar4;
			if (uVar8 == 0) break;
			uVar8 -= 1;
			pcVar14 = pcVar4 + 1;
			cVar1 = *pcVar4;
			pcVar4 = pcVar14;
		} while (cVar1 != '\0');
		uVar8 = ~uVar8;
		puVar11 = (undefined4 *)(pcVar14 + -uVar8);
		puVar15 = auStack4096;
		for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
			*puVar15 = *puVar11;
			puVar11 = puVar11 + 1;
			puVar15 = puVar15 + 1;
		}
		for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
			*(undefined *)puVar15 = *(undefined *)puVar11;
			puVar11 = (undefined4 *)((int)puVar11 + 1);
			puVar15 = (undefined4 *)((int)puVar15 + 1);
		}
		uVar8 = util::stringSplit((char *)auStack4096,apcStack4500 + 1,"\\");
		if (1 < uVar8) {
			piVar10 = aiStack4492;
			iVar7 = uVar8 - 1;
			do {
				iVar2 = *piVar10;
				piVar10 = piVar10 + 1;
				iVar7 += -1;
				*(undefined *)(iVar2 + -1) = '\\';
			} while (iVar7 != 0);
		}
		std::sprintf(acStack3072,"%s\\%s.%s",auStack4096,apcStack4500[uVar8],"ae");
		prop = cfg::CFG_Open(acStack3072);
		if (prop != NULL) {
			pcVar4 = cfg::CFG_JoinPath(rootName,"CameraNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			vehicle->CameraNullName = pcVar4;
			if (pcVar4 == NULL) {
				vehicle->CameraNullFrames = 0;
			}
			else {
				pcVar4 = cfg::CFG_JoinPath(rootName,"CameraNullFrames",0);
				pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				if (pcVar4 == NULL) {
					pcVar4 = ____EMPTYSTR__;
				}
				else {
					pcVar4 = cfg::CFG_JoinPath(rootName,"CameraNullFrames",0);
					pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				}
				uVar8 = std::atoi(pcVar4);
				vehicle->CameraNullFrames = uVar8;
				pcVar4 = cfg::CFG_JoinPath(rootName,"CameraFlipDir",0);
				BVar5 = cfg::CFG_GetPropertyBool(prop,pcVar4);
				vehicle->CameraFlipDir = BVar5;
			}
			pcVar4 = cfg::CFG_JoinPath(rootName,"CarryNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			vehicle->CarryNullName = pcVar4;
			if (pcVar4 == NULL) {
				vehicle->CarryNullFrames = 0;
			}
			else {
				pcVar4 = cfg::CFG_JoinPath(rootName,"CarryNullFrames",0);
				pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				if (pcVar4 == NULL) {
					uVar8 = std::atoi(____EMPTYSTR__);
					vehicle->CarryNullFrames = uVar8;
				}
				else {
					pcVar4 = cfg::CFG_JoinPath(rootName,"CarryNullFrames",0);
					pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
					uVar8 = std::atoi(pcVar4);
					vehicle->CarryNullFrames = uVar8;
				}
			}
			pcVar4 = cfg::CFG_JoinPath(rootName,"DrillNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			vehicle->DrillNullName = pcVar4;
			pcVar4 = cfg::CFG_JoinPath(rootName,"DepositNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			vehicle->DepositNullName = pcVar4;
			pcVar4 = cfg::CFG_JoinPath(rootName,"DriverNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			vehicle->DriverNullName = pcVar4;
			pcVar4 = cfg::CFG_JoinPath(rootName,"FireNullName",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			vehicle->FireNullName = pcVar4;
			pcVar4 = cfg::CFG_JoinPath(rootName,"yPivot",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			vehicle->yPivot = pcVar4;
			pcVar4 = cfg::CFG_JoinPath(rootName,"xPivot",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			vehicle->xPivot = pcVar4;
			pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMaxZ",0);
			pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
			if (pcVar4 == NULL) {
				vehicle->PivotMaxZ = 1.0;
			}
			else {
				pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMaxZ",0);
				pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				if (pcVar4 == NULL) {
					fVar16 = std::atof(____EMPTYSTR__);
					vehicle->PivotMaxZ = (float)fVar16;
				}
				else {
					pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMaxZ",0);
					pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
					fVar16 = std::atof(pcVar4);
					vehicle->PivotMaxZ = (float)fVar16;
				}
			}
			pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMinZ",0);
			pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
			if (pcVar4 == NULL) {
				vehicle->PivotMinZ = -1.0;
			}
			else {
				pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMinZ",0);
				pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
				if (pcVar4 == NULL) {
					fVar16 = std::atof(____EMPTYSTR__);
					vehicle->PivotMinZ = (float)fVar16;
				}
				else {
					pcVar4 = cfg::CFG_JoinPath(rootName,"PivotMinZ",0);
					pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
					fVar16 = std::atof(pcVar4);
					vehicle->PivotMinZ = (float)fVar16;
				}
			}
			Res_LoadUpgradeLevels(&vehicle->upgrades,prop,rootName);
			pcVar4 = cfg::CFG_JoinPath(rootName,"WheelMesh",0);
			pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
			if (pcVar4 != NULL) {
				std::sprintf(local_400,"%s\\%s",auStack4096,pcVar4);
				std::free(pcVar4);
				pcVar4 = cfg::CFG_JoinPath(rootName,"WheelNullName",0);
				pcVar4 = cfg::CFG_CopyPropertyValue(prop,pcVar4);
				vehicle->WheelNullName = pcVar4;
				if (pcVar4 != NULL) {
					ppRVar13 = vehicle->WheelMeshes;
					for (iVar7 = 6; iVar7 != 0; iVar7 += -1) {
						*ppRVar13 = NULL;
						ppRVar13 = ppRVar13 + 1;
					}
					pRVar3 = Res_LoadResource(vehicle->aeResData1,local_400,"LWO",0);
					vehicle->WheelMeshes[0] = pRVar3;
					vehicle->numWheelNulls = 1;
					puVar11 = vehicle->wheel_fields_28;
					for (iVar7 = 6; iVar7 != 0; iVar7 += -1) {
						*puVar11 = 0;
						puVar11 = puVar11 + 1;
					}
					if (vehicle->WheelMeshes[0] == NULL) {
						vehicle->WheelRadius = 0.0;
						vehicle->WheelMeshes[1] = NULL;
						vehicle->WheelMeshes[2] = NULL;
						vehicle->WheelMeshes[3] = NULL;
						vehicle->WheelMeshes[4] = NULL;
						vehicle->WheelMeshes[5] = NULL;
					}
					else {
						pcVar4 = cfg::CFG_JoinPath(rootName,"WheelRadius",0);
						pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
						if (pcVar4 == NULL) {
							pcVar4 = ____EMPTYSTR__;
						}
						else {
							pcVar4 = cfg::CFG_JoinPath(rootName,"WheelRadius",0);
							pcVar4 = cfg::CFG_GetPropertyValue(prop,pcVar4);
						}
						fVar16 = std::atof(pcVar4);
						vehicle->WheelRadius = (float)fVar16;
						if ((float)fVar16 == 0.0) {
							if (vehicle->WheelMeshes[0]->resType == RESOURCE_MESH) {
								Res_LoadVehicleWheels(vehicle->WheelMeshes[0],&fStack4520);
								vehicle->WheelRadius = (fStack4504 - fStack4516) * 0.5;
								Res_SetMeshGroupQuality(vehicle->WheelMeshes[0],0,QUALITY_GOURAUD);
							}
							else {
								vehicle->WheelRadius = 3.0;
							}
						}
					}
					pPVar6 = Res_LoadPolyMesh(prop,rootName,pcStack4560,POLY_MEDIUM,1);
					vehicle->subdata_1e0 = pPVar6;
					if (vehicle->aeResData2 != NULL) {
						uVar8 = 0xffffffff;
						pcVar4 = pcStack4556;
						do {
							pcVar14 = pcVar4;
							if (uVar8 == 0) break;
							uVar8 -= 1;
							pcVar14 = pcVar4 + 1;
							cVar1 = *pcVar4;
							pcVar4 = pcVar14;
						} while (cVar1 != '\0');
						uVar8 = ~uVar8;
						puVar11 = (undefined4 *)(pcVar14 + -uVar8);
						puVar15 = auStack4096;
						for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
							*puVar15 = *puVar11;
							puVar11 = puVar11 + 1;
							puVar15 = puVar15 + 1;
						}
						for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
							*(undefined *)puVar15 = *(undefined *)puVar11;
							puVar11 = (undefined4 *)((int)puVar11 + 1);
							puVar15 = (undefined4 *)((int)puVar15 + 1);
						}
						uVar8 = util::stringSplit((char *)auStack4096,apcStack4500 + 1,"\\");
						if (1 < uVar8) {
							piVar10 = aiStack4492;
							iVar7 = uVar8 - 1;
							do {
								iVar2 = *piVar10;
								piVar10 = piVar10 + 1;
								iVar7 += -1;
								*(undefined *)(iVar2 + -1) = '\\';
							} while (iVar7 != 0);
						}
						std::sprintf(acStack3072,"%s\\%s.%s",auStack4096,apcStack4500[uVar8],"ae");
						aeRoot = cfg::CFG_Open(acStack3072);
						if (aeRoot != NULL) {
							pPVar6 = Res_LoadPolyMesh(aeRoot,rootName,pcStack4556,POLY_MEDIUM,1);
							vehicle->subdata_1e4 = pPVar6;
						}
					}
					vehicle->flags = 1;
					pcVar4 = cfg::CFG_JoinPath(rootName,"HoldMissing",0);
					uVar8 = cfg::CFG_GetPropertyBool(prop,pcVar4);
					if (uVar8 == 1) {
						vehicle->flags = vehicle->flags | 8;
					}
					vehicle->field_60 = 0;
					vehicle->field_5c = 0;
					vehicle->float_64 = -1.0;
					vehicle->objIndex = index;
					cfg::CFG_Close(prop);
					return 1;
				}
			}
			cfg::CFG_Close(prop);
		}
	}
	return 0;
}



void __cdecl FUN_0046d0d0(int param_1)
{
	int iVar1;
	ResourceData **ppRVar2;
	
	lego::game::LiveObject_VehicleChangeUpgradeParts((VehicleData *)param_1,-1);
	if ((*(byte *)(param_1 + 0x1e8) & 1) != 0) {
		if (*(void **)(param_1 + 0xe0) != NULL) {
			std::free(*(void **)(param_1 + 0xe0));
		}
		if (*(void **)(param_1 + 4) != NULL) {
			std::free(*(void **)(param_1 + 4));
		}
		if (*(void **)(param_1 + 0xb4) != NULL) {
			std::free(*(void **)(param_1 + 0xb4));
		}
		if (*(void **)(param_1 + 0xbc) != NULL) {
			std::free(*(void **)(param_1 + 0xbc));
		}
	}
	ppRVar2 = (ResourceData **)(param_1 + 0x28);
	iVar1 = 6;
	do {
		if (ppRVar2[-6] != NULL) {
			lego::pool::ReservedPool_ResourceData___Release(ppRVar2[-6]);
		}
		if (*ppRVar2 != NULL) {
			lego::pool::ReservedPool_ResourceData___Release(*ppRVar2);
		}
		ppRVar2 = ppRVar2 + 1;
		iVar1 += -1;
	} while (iVar1 != 0);
	lego::pool::ReservedPool_ResourceData___Release(*(ResourceData **)(param_1 + 8));
	if (*(ResourceData **)(param_1 + 0xc) != NULL) {
		lego::pool::ReservedPool_ResourceData___Release(*(ResourceData **)(param_1 + 0xc));
	}
	return;
}



void __cdecl FUN_0046d190(VehicleData *vehicle,BOOL param_2)
{
	FUN_00451e80(vehicle->subdata_1e0,vehicle->aeResData1,(uint)(param_2 == 0),0);
	if ((vehicle->aeResData2 != NULL) && (vehicle->subdata_1e4 != NULL)) {
		FUN_00451e80(vehicle->subdata_1e4,vehicle->aeResData2,(uint)(param_2 == 0),0);
	}
	return;
}



void __cdecl FUN_0046d1e0(VehicleData *vehicle,BOOL param_2)
{
	FUN_0046d190(vehicle,param_2);
	return;
}



BOOL __cdecl FUN_0046d200(VehicleData *vehicle,int levelBit,BOOL condition)
{
	uint uVar1;
	uint uVar2;
	
	uVar2 = 1 << ((byte)levelBit & 0x1f);
	if (condition != 0) {
		uVar1 = lego::game::LiveObject_GetVehicle_UpgradesField8(vehicle);
		if ((uVar2 & uVar1) != 0) {
			return 0;
		}
	}
	return (vehicle->upgrades).levelsMask & uVar2;
}



int __cdecl lego::game::LiveObject_GetVehicle_UpgradesField8(VehicleData *vehicle)
{
	return (vehicle->upgrades).currentLevel;
}



void __cdecl lego::game::LiveObject_VehicleChangeUpgradeParts(VehicleData *vehicle,int objLevel)
{
	LiveObject_ChangeUpgradeParts(&vehicle->upgrades,objLevel);
	LiveObject_VehicleUnkUpgrades(vehicle,NULL);
	return;
}



void __cdecl FUN_0046d280(VehicleData *vehicle,BOOL param_2)
{
	ResourceData **ppRVar1;
	int iVar2;
	
	ppRVar1 = vehicle->WheelMeshes;
	iVar2 = 6;
	do {
		if (*ppRVar1 != NULL) {
			lego::res::Res_UnkSetup3DFrameTransform(*ppRVar1,param_2);
		}
		ppRVar1 = ppRVar1 + 1;
		iVar2 += -1;
	} while (iVar2 != 0);
	return;
}



BOOL __cdecl lego::res::Vehicle_Duplicate(VehicleData *in_vehicle,VehicleData *out_vehicle)
{
	ResourceData *pRVar1;
	PolyMeshData *pPVar2;
	int iVar3;
	VehicleData *pVVar4;
	ResourceData **ppRVar5;
	VehicleData *pVVar6;
	uint uVar7;
	
	pVVar4 = in_vehicle;
	pVVar6 = out_vehicle;
	for (iVar3 = 0x7b; iVar3 != 0; iVar3 += -1) {
		pVVar6->objIndex = pVVar4->objIndex;
		pVVar4 = (VehicleData *)&pVVar4->WheelNullName;
		pVVar6 = (VehicleData *)&pVVar6->WheelNullName;
	}
	out_vehicle->flags = out_vehicle->flags & 0xfffffffe;
	pRVar1 = Res_DuplicateResource(in_vehicle->aeResData1);
	out_vehicle->aeResData1 = pRVar1;
	if (pRVar1 != NULL) {
		if (in_vehicle->aeResData2 != NULL) {
			pRVar1 = Res_DuplicateResource(in_vehicle->aeResData2);
			out_vehicle->aeResData2 = pRVar1;
			FUN_004759d0(pRVar1,out_vehicle->aeResData1);
			Res_SetFramePosition(out_vehicle->aeResData2,out_vehicle->aeResData1,0.0,0.0,0.0);
			Res_SetFrameOrientation
								(out_vehicle->aeResData2,out_vehicle->aeResData1,0.0,0.0,1.0,0.0,1.0,0.0);
			FUN_00474180(out_vehicle->aeResData2,1);
		}
		pPVar2 = PolyMesh_Duplicate(in_vehicle->subdata_1e0);
		out_vehicle->subdata_1e0 = pPVar2;
		if (in_vehicle->subdata_1e4 != NULL) {
			pPVar2 = PolyMesh_Duplicate(in_vehicle->subdata_1e4);
			out_vehicle->subdata_1e4 = pPVar2;
		}
		FUN_00474180(out_vehicle->aeResData1,1);
		FUN_0046d520(out_vehicle);
		if ((in_vehicle->WheelMeshes[0] != NULL) && (uVar7 = 0, out_vehicle->numWheelNulls != 0)) {
			ppRVar5 = out_vehicle->WheelMeshes;
			do {
				pRVar1 = Res_DuplicateResource(in_vehicle->WheelMeshes[0]);
				*ppRVar5 = pRVar1;
				if (pRVar1 != NULL) {
					FUN_004759d0(pRVar1,out_vehicle->aeResData1);
					FUN_00474180(*ppRVar5,1);
				}
				uVar7 += 1;
				ppRVar5 = ppRVar5 + 1;
			} while (uVar7 < out_vehicle->numWheelNulls);
		}
		return 1;
	}
	return 0;
}



void __cdecl lego::res::Vehicle_SetOwnerObject(VehicleData *vehicle,LiveObject *liveObj)
{
	ResourceData **ppRVar1;
	uint uVar2;
	
	Res_SetOwnerObject(vehicle->aeResData1,liveObj);
	if (vehicle->aeResData2 != NULL) {
		Res_SetOwnerObject(vehicle->aeResData2,liveObj);
	}
	uVar2 = 0;
	if (vehicle->numWheelNulls != 0) {
		ppRVar1 = vehicle->WheelMeshes;
		do {
			if (*ppRVar1 != NULL) {
				Res_SetOwnerObject(*ppRVar1,liveObj);
			}
			uVar2 += 1;
			ppRVar1 = ppRVar1 + 1;
		} while (uVar2 < vehicle->numWheelNulls);
	}
	return;
}



float10 __cdecl lego::res::Vehicle_GetAnimFloat10(VehicleData *vehicle)
{
	float10 fVar1;
	
	fVar1 = Res_GetAnimFloat10(vehicle->aeResData1);
	return fVar1;
}



float10 __cdecl FUN_0046d480(VehicleData *vehicle,float elapsed,float elapsed2,uint param_4)
{
	float fVar1;
	int iVar2;
	float10 fVar3;
	
	if ((*(byte *)&vehicle->flags & 4) == 0) {
		fVar3 = lego::res::Res_DoAnimElapsedCallbacks(vehicle->aeResData1,elapsed);
	}
	else {
		fVar3 = (float10)0.0;
	}
	if (vehicle->aeResData2 != NULL) {
		fVar3 = lego::res::Res_DoAnimElapsedCallbacks(vehicle->aeResData2,elapsed2);
	}
	fVar1 = (float)fVar3;
	if ((1 < param_4) && (fVar1 != 0.0)) {
		iVar2 = lego::res::Res_GetAnimAppData_Fieldc(vehicle->aeResData1);
		return (float10)fVar1 - (float10)(ulonglong)(iVar2 * (param_4 - 1));
	}
	return (float10)fVar1;
}



void __cdecl FUN_0046d520(VehicleData *vehicle)
{
	VehicleData *pVVar1;
	char *pcVar2;
	ResourceData *pRVar3;
	
	pVVar1 = vehicle;
	vehicle = NULL;
	pVVar1->numWheelNulls = 0;
	do {
		pcVar2 = lego::res::Res_GetNull(pVVar1->aeResData1,pVVar1->WheelNullName,(int *)&vehicle);
		pRVar3 = FUN_00473e80(pVVar1->aeResData1,pcVar2,0,NULL);
		pVVar1->wheel_fields_28[(int)vehicle] = pRVar3;
		if (pVVar1->wheel_fields_28[(int)vehicle] != 0) {
			pVVar1->numWheelNulls = pVVar1->numWheelNulls + 1;
		}
		vehicle = (VehicleData *)((int)&vehicle->objIndex + 1);
	} while (vehicle < (VehicleData *)0x6);
	return;
}



void __cdecl FUN_0046d580(VehicleData *vehicle,BOOL use3rdFrame)
{
	ResourceData **ppRVar1;
	uint uVar2;
	
	if (use3rdFrame == 0) {
		uVar2 = vehicle->flags & 0xfffffffd;
	}
	else {
		uVar2 = vehicle->flags | 2;
	}
	vehicle->flags = uVar2;
	lego::res::Res_UnkSetup3DFrameTransform(vehicle->aeResData1,use3rdFrame);
	if (vehicle->aeResData2 != NULL) {
		lego::res::Res_UnkSetup3DFrameTransform(vehicle->aeResData2,use3rdFrame);
	}
	uVar2 = 0;
	if (vehicle->numWheelNulls != 0) {
		ppRVar1 = vehicle->WheelMeshes;
		do {
			if (*ppRVar1 != NULL) {
				lego::res::Res_UnkSetup3DFrameTransform(*ppRVar1,use3rdFrame);
			}
			uVar2 += 1;
			ppRVar1 = ppRVar1 + 1;
		} while (uVar2 < vehicle->numWheelNulls);
	}
	return;
}



BOOL __cdecl lego::res::Vehicle_GetFlag2(VehicleData *vehicle)
{
	return (vehicle->flags & 0xff) >> 1 & 1;
}



void __cdecl lego::res::Vehicle_SetOrientation(VehicleData *vehicle,float x,float y,float z)
{
	Res_SetFrameOrientation(vehicle->aeResData1,NULL,x,y,z,0.0,0.0,-1.0);
	return;
}



void __cdecl
lego::res::Vehicle_SetPosition
					(VehicleData *vehicle,float x,float y,GetSurfaceZCallback *getZcallback,
					LevelSurfaceMap *surfMap)
{
	float fVar1;
	uint uVar2;
	ResourceData **ppRVar3;
	float *pfVar4;
	Vector3F *pVVar5;
	undefined4 unaff_EDI;
	float10 fVar6;
	Vector3F local_a4;
	float local_98;
	float local_94;
	float local_90;
	float local_8c;
	Vector3F local_88;
	float local_7c;
	float local_78;
	float local_74;
	Vector3F local_70;
	Vector3F local_64;
	uint local_58;
	Vector3F local_54;
	float local_48;
	float local_44;
	float local_40;
	float local_3c;
	float local_38;
	float local_34;
	float local_30;
	float local_2c;
	float local_28;
	Vector3F local_c;
	
	fVar6 = (*getZcallback)(x,y,surfMap);
	Res_SetFramePosition(vehicle->aeResData1,NULL,x,y,(float)fVar6);
	Res_GetOrientation(vehicle->aeResData1,NULL,&local_88,&local_c);
	Res_SetFrameOrientation(vehicle->aeResData1,NULL,local_88.x,local_88.y,local_88.z,0.0,0.0,-1.0);
	if (vehicle->numWheelNulls != 0) {
		uVar2 = 0;
		if (vehicle->numWheelNulls != 0) {
			pVVar5 = &local_54;
			ppRVar3 = (ResourceData **)vehicle->wheel_fields_28;
			do {
				Res_GetPosition(*ppRVar3,NULL,pVVar5);
				fVar6 = (*getZcallback)(pVVar5->x,pVVar5->y,surfMap);
				pVVar5->z = (float)fVar6;
				uVar2 += 1;
				ppRVar3 = ppRVar3 + 1;
				pVVar5 = pVVar5 + 1;
			} while (uVar2 < vehicle->numWheelNulls);
		}
		local_98 = local_48 - local_3c;
		local_94 = local_44 - local_38;
		local_90 = local_40 - local_34;
		local_7c = local_48 - local_54.x;
		local_78 = local_44 - local_54.y;
		local_74 = local_40 - local_54.z;
		local_70.x = local_90 * local_78 - local_94 * local_74;
		local_70.y = local_98 * local_74 - local_90 * local_7c;
		local_70.z = local_94 * local_7c - local_98 * local_78;
		math::Vector3_Scale(&local_70,&local_70,
												1.0 / SQRT(local_70.z * local_70.z +
																	 local_70.y * local_70.y + local_70.x * local_70.x));
		local_7c = local_30 - local_3c;
		local_78 = local_2c - local_38;
		local_74 = local_28 - local_34;
		local_98 = local_30 - local_54.x;
		local_94 = local_2c - local_54.y;
		local_64.x = (local_28 - local_54.z) * local_78 - local_94 * local_74;
		local_64.y = local_98 * local_74 - (local_28 - local_54.z) * local_7c;
		local_64.z = local_94 * local_7c - local_98 * local_78;
		math::Vector3_Scale(&local_64,&local_64,
												1.0 / SQRT(local_64.z * local_64.z +
																	 local_64.y * local_64.y + local_64.x * local_64.x));
		local_a4.x = local_64.x + local_70.x;
		local_a4.y = local_64.y + local_70.y;
		local_a4.z = local_64.z + local_70.z;
		math::Vector3_Scale(&local_a4,&local_a4,
												1.0 / SQRT(local_a4.z * local_a4.z +
																	 local_a4.y * local_a4.y + local_a4.x * local_a4.x));
		pfVar4 = (float *)&vehicle->field_5c;
		uVar2 = FUN_0048eb30(SUB84((double)(float)vehicle->field_5c,0),
												 CONCAT44(unaff_EDI,
																	(int)((ulonglong)(double)(float)vehicle->field_5c >> 0x20)));
		if (((uVar2 == 0) ||
				(uVar2 = FUN_0048eb30(SUB84((double)(float)vehicle->field_60,0),
															CONCAT44(unaff_EDI,
																			 (int)((ulonglong)(double)(float)vehicle->field_60 >> 0x20))),
				uVar2 == 0)) ||
			 (uVar2 = FUN_0048eb30(SUB84((double)(float)vehicle->field_60,0),
														 CONCAT44(unaff_EDI,
																			(int)((ulonglong)(double)(float)vehicle->field_60 >> 0x20))),
			 uVar2 == 0)) {
			*pfVar4 = local_a4.x;
			vehicle->field_60 = local_a4.y;
			vehicle->float_64 = local_a4.z;
		}
		local_a4.x = *pfVar4 * 0.4 + local_a4.x;
		local_a4.y = (float)vehicle->field_60 * 0.4 + local_a4.y;
		local_a4.z = vehicle->float_64 * 0.4 + local_a4.z;
		local_8c = 1.0 / SQRT(local_a4.z * local_a4.z +
													local_a4.y * local_a4.y + local_a4.x * local_a4.x);
		local_a4.x = local_8c * local_a4.x;
		local_a4.y = local_8c * local_a4.y;
		local_a4.z = local_8c * local_a4.z;
		fVar1 = local_88.z * local_a4.z + local_88.y * local_a4.y + local_88.x * local_a4.x;
		*pfVar4 = local_a4.x;
		local_88.x = local_88.x - fVar1 * local_a4.x;
		local_88.y = local_88.y - fVar1 * local_a4.y;
		local_88.z = local_88.z - fVar1 * local_a4.z;
		vehicle->field_60 = local_a4.y;
		vehicle->float_64 = local_a4.z;
		Res_SetFrameOrientation
							(vehicle->aeResData1,NULL,local_88.x,local_88.y,local_88.z,-local_a4.x,-local_a4.y,
							 -local_a4.z);
		uVar2 = 0;
		if (vehicle->numWheelNulls != 0) {
			pVVar5 = &local_54;
			ppRVar3 = (ResourceData **)vehicle->wheel_fields_28;
			do {
				Res_GetPosition(*ppRVar3,NULL,pVVar5);
				fVar6 = (*getZcallback)(pVVar5->x,pVVar5->y,surfMap);
				Res_AddTranslation(*ppRVar3,D3DRMCOMBINE_AFTER,0.0,
													 (float)-((fVar6 - (float10)pVVar5->z) - (float10)vehicle->WheelRadius),
													 0.0);
				uVar2 += 1;
				ppRVar3 = ppRVar3 + 1;
				pVVar5 = pVVar5 + 1;
			} while (uVar2 < vehicle->numWheelNulls);
		}
		uVar2 = 0;
		if (vehicle->numWheelNulls != 0) {
			ppRVar3 = vehicle->WheelMeshes;
			do {
				if (*ppRVar3 != NULL) {
					Res_SetFramePosition(*ppRVar3,ppRVar3[6],0.0,0.0,0.0);
				}
				uVar2 += 1;
				ppRVar3 = ppRVar3 + 1;
			} while (uVar2 < vehicle->numWheelNulls);
		}
		local_58 = 0;
		if (vehicle->numWheelNulls != 0) {
			pVVar5 = &local_54;
			ppRVar3 = vehicle->WheelMeshes;
			pfVar4 = (float *)&vehicle->field_0x74;
			do {
				if (*ppRVar3 != NULL) {
					Res_GetPosition(*ppRVar3,NULL,pVVar5);
					local_98 = pVVar5->x - pfVar4[-2];
					local_94 = pVVar5->y - pfVar4[-1];
					local_90 = pVVar5->z - *pfVar4;
					local_8c = SQRT(local_90 * local_90 + local_94 * local_94 + local_98 * local_98) /
										 vehicle->WheelRadius;
					if (local_90 * local_88.z + local_94 * local_88.y + local_98 * local_88.x < 0.0) {
						local_8c = -local_8c;
					}
					Res_AddRotation(*ppRVar3,D3DRMCOMBINE_BEFORE,1.0,0.0,0.0,local_8c);
				}
				local_58 += 1;
				ppRVar3 = ppRVar3 + 1;
				pfVar4 = pfVar4 + 3;
				pVVar5 = pVVar5 + 1;
			} while (local_58 < vehicle->numWheelNulls);
		}
		uVar2 = 0;
		if (vehicle->numWheelNulls != 0) {
			ppRVar3 = vehicle->WheelMeshes;
			pVVar5 = (Vector3F *)&vehicle->field_0x6c;
			do {
				if (*ppRVar3 != NULL) {
					Res_GetPosition(*ppRVar3,NULL,pVVar5);
				}
				uVar2 += 1;
				pVVar5 = pVVar5 + 1;
				ppRVar3 = ppRVar3 + 1;
			} while (uVar2 < vehicle->numWheelNulls);
		}
		return;
	}
	return;
}



ResourceData * __cdecl lego::res::Vehicle_GetAEResource(VehicleData *vehicle)
{
	return vehicle->aeResData1;
}



ResourceData * __cdecl lego::res::Vehicle_GetNull(VehicleData *vehicle,char *nullName,int nullIndex)
{
	ResourceData *pRVar1;
	char *pcVar2;
	
	pRVar1 = NULL;
	if (vehicle->aeResData2 != NULL) {
		pcVar2 = Res_GetNull(vehicle->aeResData2,nullName,&nullIndex);
		pRVar1 = FUN_00473e80(vehicle->aeResData2,pcVar2,0,NULL);
	}
	if (pRVar1 == NULL) {
		pcVar2 = Res_GetNull(vehicle->aeResData1,nullName,&nullIndex);
		pRVar1 = FUN_00473e80(vehicle->aeResData1,pcVar2,0,NULL);
	}
	return pRVar1;
}



ResourceData * __cdecl lego::res::Vehicle_GetCameraNull(VehicleData *vehicle,int cameraIndex)
{
	ResourceData *pRVar1;
	
	if (vehicle->CameraNullName == NULL) {
		return NULL;
	}
	if ((ResourceData *)vehicle->cameraFramesTable_10c[cameraIndex] != NULL) {
		return (ResourceData *)vehicle->cameraFramesTable_10c[cameraIndex];
	}
	pRVar1 = Vehicle_GetNull(vehicle,vehicle->CameraNullName,cameraIndex);
	vehicle->cameraFramesTable_10c[cameraIndex] = pRVar1;
	return pRVar1;
}



ResourceData * __cdecl lego::res::Vehicle_GetDrillNull(VehicleData *vehicle)
{
	ResourceData *pRVar1;
	
	if (vehicle->DrillNullName == NULL) {
		pRVar1 = NULL;
	}
	else {
		pRVar1 = (ResourceData *)vehicle->field_cc;
		if (pRVar1 == NULL) {
			pRVar1 = Vehicle_GetNull(vehicle,vehicle->DrillNullName,0);
			vehicle->field_cc = pRVar1;
			return pRVar1;
		}
	}
	return pRVar1;
}



ResourceData * __cdecl lego::res::Vehicle_GetDepositNull(VehicleData *vehicle)
{
	ResourceData *pRVar1;
	
	if (vehicle->DepositNullName == NULL) {
		pRVar1 = NULL;
	}
	else {
		pRVar1 = (ResourceData *)vehicle->field_d0;
		if (pRVar1 == NULL) {
			pRVar1 = Vehicle_GetNull(vehicle,vehicle->DepositNullName,0);
			vehicle->field_d0 = pRVar1;
			return pRVar1;
		}
	}
	return pRVar1;
}



ResourceData * __cdecl lego::res::Vehicle_GetDriverNull(VehicleData *vehicle)
{
	ResourceData *pRVar1;
	
	if (vehicle->DriverNullName == NULL) {
		pRVar1 = NULL;
	}
	else {
		pRVar1 = vehicle->resData_d4;
		if (pRVar1 == NULL) {
			pRVar1 = Vehicle_GetNull(vehicle,vehicle->DriverNullName,0);
			vehicle->resData_d4 = pRVar1;
			return pRVar1;
		}
	}
	return pRVar1;
}



ResourceData * __cdecl lego::res::Vehicle_GetCarryNull(VehicleData *vehicle,int carryIndex)
{
	ResourceData *pRVar1;
	
	if (vehicle->CarryNullName == NULL) {
		return NULL;
	}
	if ((ResourceData *)vehicle->carryFramesTable_e4[carryIndex] != NULL) {
		return (ResourceData *)vehicle->carryFramesTable_e4[carryIndex];
	}
	pRVar1 = Vehicle_GetNull(vehicle,vehicle->CarryNullName,carryIndex);
	vehicle->carryFramesTable_e4[carryIndex] = pRVar1;
	return pRVar1;
}



int __cdecl lego::res::Vehicle_GetCarryNullFrames(VehicleData *vehicle)
{
	return vehicle->CarryNullFrames;
}



float10 __cdecl lego::res::Vehicle_GetFloat14(VehicleData *vehicle)
{
	float10 fVar1;
	
	fVar1 = Res_GetActFrameFloat14(vehicle->aeResData1);
	return fVar1;
}



void __cdecl lego::game::Level_Load_FUN_0046de50(ResourceData *resRoot,LevelData *level)
{
	Struct_428 *pSVar1;
	Struct_428 *pSVar2;
	uint uVar3;
	int iVar4;
	uint *puVar5;
	uint uVar6;
	uint uVar7;
	Struct_428 **ppSVar8;
	uint uVar9;
	Struct_428 *pSVar10;
	uint unkParam_x;
	Point2F *pPVar11;
	uint local_4;
	
	uVar7 = 0;
	Struct_428_COUNT_0054ceb0 = 0;
	PairStruct_428_COUNT_0054cf04 = 0;
	globals::g_LevelUnk_DigDepth = level->DigDepth;
	if ((level->dimensions).height != 0) {
		do {
			uVar9 = 0;
			unkParam_x = 0;
			uVar6 = 0;
			uVar3 = (level->dimensions).width;
			if (uVar3 != 0) {
				do {
					if (level->blocks[uVar7 * uVar3 + uVar6].terrain == TERRAIN_WATER_unused) {
						if (unkParam_x == uVar9) {
							unkParam_x = uVar6;
						}
						uVar9 = uVar6 + 1;
					}
					else {
						if (unkParam_x != uVar9) {
							pSVar2 = Level_LoadSearchStruct428(uVar7,unkParam_x,uVar9);
							if (pSVar2 == NULL) {
								Level_LoadAddFirstStruct428(uVar7,unkParam_x,uVar9);
							}
							else {
								Level_LoadAddStruct428(pSVar2,uVar7,unkParam_x,uVar9);
							}
						}
						uVar9 = 0;
						unkParam_x = 0;
					}
					uVar3 = (level->dimensions).width;
					uVar6 += 1;
				} while (uVar6 < uVar3);
			}
			uVar7 += 1;
		} while (uVar7 < (uint)(level->dimensions).height);
	}
	local_4 = 0;
	if (PairStruct_428_COUNT_0054cf04 != 0) {
		ppSVar8 = &PairStruct_428_ARRAY_0054ceb4[0].second;
		do {
			pSVar2 = *ppSVar8;
			pSVar1 = ppSVar8[-1];
			if (pSVar2->pointsCount != 0) {
				pSVar10 = pSVar2;
				pPVar11 = pSVar1->points + pSVar1->pointsCount;
				for (uVar7 = (pSVar2->pointsCount << 3) >> 2; uVar7 != 0; uVar7 -= 1) {
					pPVar11->x = pSVar10->points[0].x;
					pSVar10 = (Struct_428 *)&pSVar10->points[0].y;
					pPVar11 = (Point2F *)(&pPVar11->x + 1);
				}
				for (iVar4 = 0; iVar4 != 0; iVar4 += -1) {
					*(undefined *)&pPVar11->x = *(undefined *)&pSVar10->points[0].x;
					pSVar10 = (Struct_428 *)((int)&pSVar10->points[0].x + 1);
					pPVar11 = (Point2F *)((int)&pPVar11->x + 1);
				}
				pSVar1->pointsCount = pSVar1->pointsCount + pSVar2->pointsCount;
				pSVar2->pointsCount = 0;
			}
			local_4 += 1;
			ppSVar8 = ppSVar8 + 2;
		} while (local_4 < PairStruct_428_COUNT_0054cf04);
	}
	std::qsort(Struct_428_ARRAY_0054a520,Struct_428_COUNT_0054ceb0,0x428,util::Struct428_CompareCount)
	;
	uVar7 = 0;
	if (Struct_428_COUNT_0054ceb0 != 0) {
		puVar5 = &Struct_428_ARRAY_0054a520[0].pointsCount;
		uVar9 = Struct_428_COUNT_0054ceb0;
		do {
			if (*puVar5 == 0) {
				uVar9 = uVar7;
				Struct_428_COUNT_0054ceb0 = uVar7;
			}
			uVar7 += 1;
			puVar5 = puVar5 + 0x10a;
		} while (uVar7 < uVar9);
	}
	FUN_0046dfd0(resRoot,level);
	FUN_0046e140(resRoot,level);
	return;
}



void __cdecl FUN_0046dfd0(ResourceData *resData,LevelData *level)
{
	TerrainType TVar1;
	int iVar2;
	int iVar3;
	int iVar4;
	uint uVar5;
	float *pfVar6;
	longlong lVar7;
	Point2F *local_30;
	uint local_2c;
	uint *local_28;
	uint index;
	Point2F DIRECTIONS [4];
	
	DIRECTIONS[0].x = 0.0;
	DIRECTIONS[0].y = -1.0;
	DIRECTIONS[1].x = 1.0;
	DIRECTIONS[1].y = 0.0;
	DIRECTIONS[2].x = 0.0;
	DIRECTIONS[2].y = 1.0;
	DIRECTIONS[3].x = -1.0;
	DIRECTIONS[3].y = 0.0;
	index = 0;
	if (Struct_428_COUNT_0054ceb0 != 0) {
		local_28 = &Struct_428_ARRAY_0054a520[0].pointsCount;
		do {
			local_30 = (Point2F *)(local_28 + -200);
			local_28[0x3d] = 0;
			local_2c = 0;
			if (*local_28 != 0) {
				do {
					uVar5 = 0;
					pfVar6 = &DIRECTIONS[0].y;
					do {
						lVar7 = __ftol((float10)pfVar6[-1] + (float10)local_30->x);
						iVar3 = (int)lVar7;
						lVar7 = __ftol((float10)local_30->y + (float10)*pfVar6);
						iVar4 = (int)lVar7;
						if ((((-1 < iVar3) && (iVar2 = (level->dimensions).width, iVar3 < iVar2)) &&
								(-1 < iVar4)) &&
							 (((iVar4 < (level->dimensions).height &&
								 (TVar1 = level->blocks[iVar4 * iVar2 + iVar3].terrain,
								 TVar1 != TERRAIN_WATER_unused)) && (TVar1 != TERRAIN_IMMOVABLE)))) {
							local_28[local_28[0x3d] * 6 + 1] = local_2c;
							local_28[local_28[0x3d] * 6 + 2] = uVar5;
							local_28[0x3d] = local_28[0x3d] + 1;
							break;
						}
						uVar5 += 1;
						pfVar6 = pfVar6 + 2;
					} while (uVar5 < 4);
					local_30 = local_30 + 1;
					local_2c += 1;
				} while (local_2c < *local_28);
			}
			index += 1;
			local_28 = local_28 + 0x10a;
		} while (index < Struct_428_COUNT_0054ceb0);
	}
	return;
}



void __cdecl FUN_0046e140(ResourceData *in_resData,LevelData *level)
{
	int iVar1;
	undefined4 uVar2;
	uint uVar3;
	ResourceData *resData;
	int *index;
	undefined4 *puVar4;
	uint uVar5;
	undefined4 *puVar6;
	float *pfVar7;
	float *pfVar8;
	float *pfVar9;
	longlong lVar10;
	longlong lVar11;
	uint local_138;
	uint *local_134;
	float *local_130;
	int local_12c;
	uint local_128;
	undefined4 local_118 [4];
	undefined4 local_108 [4];
	undefined4 local_f8;
	undefined4 local_f4;
	undefined4 local_f0;
	undefined4 local_ec;
	undefined4 local_e8;
	undefined4 local_e4;
	float local_e0 [5];
	undefined4 local_cc;
	undefined4 local_c8;
	undefined4 local_c4;
	undefined4 local_c0;
	undefined4 local_bc;
	float local_b8 [10];
	undefined local_90 [4];
	undefined4 local_8c [35];
	
	local_f4 = 1;
	local_ec = 1;
	local_e0[0] = 0.0;
	local_e0[1] = 0.0;
	local_e0[2] = 1.0;
	local_e0[3] = 0.0;
	local_e0[4] = 1.0;
	local_cc = 1065353216;
	local_c8 = 0;
	local_c4 = 1065353216;
	local_f8 = 0;
	local_f0 = 3;
	local_e8 = 2;
	local_e4 = 3;
	local_118[0] = 0;
	local_118[1] = 1065353216;
	local_118[2] = 1065353216;
	local_118[3] = 0;
	local_108[0] = 0;
	local_108[1] = 0;
	local_108[2] = 1065353216;
	local_108[3] = 1065353216;
	local_128 = 0;
	if (Struct_428_COUNT_0054ceb0 != 0) {
		local_134 = &Struct_428_ARRAY_0054a520[0].pointsCount;
		do {
			pfVar9 = (float *)(local_134 + -200);
			local_134[0x3e] = 0xc61c4000;
			local_138 = 0;
			pfVar7 = pfVar9;
			if (*local_134 != 0) {
				do {
					puVar6 = &local_c0;
					lVar10 = __ftol((float10)pfVar7[1]);
					uVar3 = (uint)lVar10;
					lVar10 = __ftol((float10)*pfVar7);
					FUN_00450390(level->surfaceMap,(uint)lVar10,uVar3,puVar6);
					local_130 = local_b8;
					pfVar8 = local_e0;
					local_12c = 4;
					do {
						lVar10 = __ftol((float10)pfVar8[1] + (float10)pfVar7[1]);
						iVar1 = (level->dimensions).width;
						lVar11 = __ftol((float10)*pfVar7 + (float10)*pfVar8);
						if (level->blocks[(int)lVar10 * iVar1 + (int)lVar11].predug == PREDUG_WALL) {
							if ((ushort)((ushort)(*local_130 < (float)local_134[0x3e]) << 8 |
													(ushort)(*local_130 == (float)local_134[0x3e]) << 0xe) == 0) {
								local_134[0x3e] = (uint)*local_130;
							}
						}
						else {
							local_134[0x41] = local_134[0x41] | 1;
						}
						pfVar8 = pfVar8 + 2;
						local_130 = local_130 + 3;
						local_12c += -1;
					} while (local_12c != 0);
					local_138 += 1;
					pfVar7 = pfVar7 + 2;
				} while (local_138 < *local_134);
			}
			local_134[0x3f] = local_134[0x3e];
			resData = lego::res::Res_Unk_LoadVisualMesh(in_resData,3);
			local_134[0x40] = (uint)resData;
			lego::res::Res_UnkSetup3DFrameTransform(resData,~local_134[0x41] & 1);
			local_138 = 0;
			if (*local_134 != 0) {
				do {
					index = FUN_00474bb0((ResourceData *)local_134[0x40],4,2,3,(undefined2 *)&local_f8);
					lego::res::Res_SetMeshColorMultiplier
										((ResourceData *)local_134[0x40],(int)index,0.0,0.3,0.8,0.6);
					puVar6 = &local_c0;
					lVar10 = __ftol((float10)pfVar9[1]);
					uVar3 = (uint)lVar10;
					lVar10 = __ftol((float10)*pfVar9);
					FUN_00450390(level->surfaceMap,(uint)lVar10,uVar3,puVar6);
					puVar6 = &local_bc;
					puVar4 = local_8c;
					uVar3 = 0;
					do {
						puVar4[-1] = puVar6[-1];
						*puVar4 = *puVar6;
						puVar4[1] = local_134[0x3e];
						uVar5 = uVar3 + 4;
						puVar6 = puVar6 + 3;
						puVar4[2] = 0;
						puVar4[3] = 0;
						puVar4[4] = 3212836864;
						uVar2 = *(undefined4 *)((int)local_118 + uVar3);
						puVar4[7] = 0;
						puVar4[5] = uVar2;
						puVar4[6] = *(undefined4 *)((int)local_108 + uVar3);
						puVar4 = puVar4 + 9;
						uVar3 = uVar5;
					} while (uVar5 < 0x10);
					FUN_00474ff0((int *)local_134[0x40],local_138,0,4,(int)local_90);
					local_138 += 1;
					pfVar9 = pfVar9 + 2;
				} while (local_138 < *local_134);
			}
			local_128 += 1;
			local_134 = local_134 + 0x10a;
		} while (local_128 < Struct_428_COUNT_0054ceb0);
	}
	return;
}



void __cdecl FUN_0046e480(BOOL param_1)
{
	char **ppcVar1;
	uint uVar2;
	char *message;
	undefined4 uVar3;
	undefined4 uVar4;
	
	uVar2 = 0;
	if (Struct_428_COUNT_0054ceb0 != 0) {
		ppcVar1 = (char **)&Struct_428_ARRAY_0054a520[0].field_420;
		do {
			if (param_1 == 0) {
				message = *ppcVar1;
				uVar4 = 0;
				uVar3 = 0;
			}
			else {
				message = *ppcVar1;
				uVar4 = 1050924810;
				uVar3 = 1039516304;
			}
			lego::other::logf_removed(message,0,uVar3,uVar4);
			uVar2 += 1;
			ppcVar1 = ppcVar1 + 0x10a;
		} while (uVar2 < Struct_428_COUNT_0054ceb0);
	}
	return;
}



void __cdecl FUN_0046e4e0(LevelData *level,int param_2,uint param_3)
{
	undefined4 *puVar1;
	int iVar2;
	float fVar3;
	undefined4 *puVar4;
	uint y;
	longlong lVar5;
	undefined4 *puVar6;
	int local_50 [4];
	undefined4 local_40;
	undefined4 local_3c;
	undefined4 local_38;
	undefined4 local_34;
	undefined4 local_30 [2];
	float afStack40 [10];
	
	local_50[3] = 2;
	local_40 = 2;
	local_3c = 3;
	local_38 = 3;
	local_50[0] = 0;
	local_50[1] = 1;
	local_50[2] = 1;
	local_34 = 0;
	puVar4 = FUN_0046eb60(param_2,param_3,&param_3);
	if (puVar4 != NULL) {
		puVar4[0x109] = puVar4[0x109] & 0xfffffffb | 1;
		lego::res::Res_UnkSetup3DFrameTransform((ResourceData *)puVar4[0x108],0);
		puVar6 = local_30;
		iVar2 = puVar4[param_3 * 6 + 0xc9];
		puVar1 = puVar4 + param_3 * 6 + 0xc9;
		puVar1[5] = 1;
		puVar1[3] = 0;
		puVar1[4] = 0;
		lVar5 = __ftol((float10)(float)(puVar4 + iVar2 * 2)[1]);
		y = (uint)lVar5;
		lVar5 = __ftol((float10)(float)puVar4[iVar2 * 2]);
		FUN_00450390(level->surfaceMap,(uint)lVar5,y,puVar6);
		fVar3 = -afStack40[local_50[puVar1[1] * 2] * 3];
		if (-afStack40[local_50[puVar1[1] * 2 + 1] * 3] <= -afStack40[local_50[puVar1[1] * 2] * 3]) {
			fVar3 = -afStack40[local_50[puVar1[1] * 2 + 1] * 3];
		}
		puVar1[2] = -fVar3;
	}
	return;
}



void __cdecl FUN_0046e5f0(int param_1,uint param_2)
{
	undefined4 *puVar1;
	
	puVar1 = FUN_0046eb60(param_1,param_2,&param_2);
	if (puVar1 != NULL) {
		puVar1[0x109] = puVar1[0x109] & 0xfffffffd | 1;
		lego::res::Res_UnkSetup3DFrameTransform((ResourceData *)puVar1[0x108],0);
		puVar1[param_2 * 6 + 0xce] = 0;
	}
	return;
}



void __cdecl FUN_0046e650(LevelData *level,float param_2)
{
	float fVar1;
	float fVar2;
	float fVar3;
	bool bVar4;
	bool bVar5;
	uint *puVar6;
	float *pfVar7;
	int iVar8;
	uint uVar9;
	uint *puVar10;
	bool bVar11;
	uint local_a0;
	uint local_9c;
	undefined local_90 [8];
	uint local_88 [34];
	
	local_a0 = 0;
	local_9c = 0;
	if (Struct_428_COUNT_0054ceb0 != 0) {
		puVar10 = &Struct_428_ARRAY_0054a520[0].itemsCount;
		do {
			bVar5 = false;
			fVar1 = (float)puVar10[1];
			bVar11 = (*(byte *)(puVar10 + 4) & 2) == 0;
			uVar9 = 0;
			if (*puVar10 != 0) {
				pfVar7 = (float *)(puVar10 + -0x3a);
				do {
					bVar4 = false;
					if ((pfVar7[3] == 0.0) ||
						 ((ushort)((ushort)((float)puVar10[2] < *pfVar7) << 8 |
											(ushort)((float)puVar10[2] == *pfVar7) << 0xe) == 0)) {
LAB_0046e6eb:
						bVar4 = true;
					}
					else {
						if (fVar1 < *pfVar7) {
							fVar1 = *pfVar7;
						}
						bVar11 = false;
						local_a0 += 1;
						bVar5 = true;
						if ((float)puVar10[2] == *pfVar7) goto LAB_0046e6eb;
					}
					fVar3 = pfVar7[1] + param_2 * 1.5;
					pfVar7[1] = fVar3;
					if (bVar4) {
						pfVar7[2] = param_2 * 0.5 + pfVar7[2];
					}
					if ((ushort)((ushort)(fVar3 < 240.0) << 8 | (ushort)(fVar3 == 240.0) << 0xe) == 0) {
						pfVar7[1] = 240.0;
					}
					if ((ushort)((ushort)(pfVar7[2] < 240.0) << 8 | (ushort)(pfVar7[2] == 240.0) << 0xe) == 0)
					{
						pfVar7[2] = 240.0;
					}
					uVar9 += 1;
					pfVar7 = pfVar7 + 6;
				} while (uVar9 < *puVar10);
			}
			uVar9 = puVar10[4];
			if ((uVar9 & 4) != 0) {
				bVar5 = false;
			}
			if ((bVar5) || (bVar11)) {
				fVar3 = ((float)puVar10[2] - (float)puVar10[1]) / level->DigDepth;
				if (bVar5) {
					puVar10[4] = uVar9 & 0xfffffffd;
					fVar2 = ((float)(ulonglong)local_a0 * param_2 * 0.3) / (fVar3 - -1.0) + (float)puVar10[2];
					puVar10[2] = (uint)fVar2;
					if (fVar1 <= fVar2) {
						puVar10[2] = (uint)fVar1;
						puVar10[4] = uVar9 & 0xfffffffd | 4;
					}
				}
				else {
					puVar10[4] = uVar9 & 0xfffffffb;
					fVar2 = (float)puVar10[2] - param_2 * 0.05;
					puVar10[2] = (uint)fVar2;
					if ((ushort)((ushort)(fVar2 < fVar1) << 8 | (ushort)(fVar2 == fVar1) << 0xe) != 0) {
						puVar10[2] = (uint)fVar1;
						puVar10[4] = uVar9 & 0xfffffffb | 2;
					}
				}
				lego::res::Res_SetLightColor((ResourceData *)puVar10[3],0.0,0.3,0.8,0.6 - fVar3 * 0.4);
				uVar9 = 0;
				if (puVar10[-0x3d] != 0) {
					do {
						FUN_00474f80((ResourceData *)puVar10[3],uVar9,0,4,(int)local_90);
						puVar6 = local_88;
						iVar8 = 4;
						do {
							*puVar6 = puVar10[2];
							puVar6 = puVar6 + 9;
							iVar8 += -1;
						} while (iVar8 != 0);
						FUN_00474ff0((int *)puVar10[3],uVar9,0,4,(int)local_90);
						uVar9 += 1;
					} while (uVar9 < puVar10[-0x3d]);
				}
			}
			local_9c += 1;
			puVar10 = puVar10 + 0x10a;
		} while (local_9c < Struct_428_COUNT_0054ceb0);
	}
	FUN_0046e8d0(level);
	return;
}



void __cdecl FUN_0046e8d0(LevelData *level)
{
	uint uVar1;
	uint uVar2;
	uint *puVar3;
	uint *puVar4;
	longlong lVar5;
	float *pfVar6;
	int *local_9c;
	int *local_98;
	uint local_94;
	uint local_90;
	float local_8c;
	float local_88;
	int local_80 [4];
	undefined4 local_70;
	undefined4 local_6c;
	undefined4 local_68;
	undefined4 local_64;
	float local_60 [4];
	undefined4 local_50;
	undefined4 local_4c;
	undefined4 local_48;
	undefined4 local_44;
	undefined4 local_40;
	undefined4 local_3c;
	undefined4 local_38;
	undefined4 local_34;
	float local_30 [12];
	
	local_80[1] = 1;
	local_80[2] = 1;
	local_60[0] = 0.0;
	local_80[3] = 2;
	local_70 = 2;
	local_60[1] = 1.0;
	local_6c = 3;
	local_68 = 3;
	local_60[2] = 0.0;
	local_60[3] = 1.0;
	local_50 = 0;
	local_4c = 0;
	local_48 = 0;
	local_44 = 0xbf800000;
	local_40 = 0;
	local_3c = 0xbf800000;
	local_38 = 0;
	local_34 = 0;
	local_80[0] = 0;
	local_64 = 0;
	local_94 = 0;
	if (Struct_428_COUNT_0054ceb0 != 0) {
		puVar3 = &Struct_428_ARRAY_0054a520[0].itemsCount;
		do {
			local_90 = 0;
			if (*puVar3 != 0) {
				puVar4 = puVar3 + -0x3b;
				do {
					uVar1 = puVar4[-1];
					pfVar6 = local_30;
					lVar5 = __ftol((float10)(float)puVar3[uVar1 * 2 + -0x104]);
					uVar2 = (uint)lVar5;
					lVar5 = __ftol((float10)(float)puVar3[uVar1 * 2 + -0x105]);
					FUN_00450390(level->surfaceMap,(uint)lVar5,uVar2,pfVar6);
					uVar1 = *puVar4;
					local_8c = (local_30[local_80[uVar1 * 2 + 1] * 3] + local_30[local_80[uVar1 * 2] * 3]) *
										 0.5 + local_60[uVar1 * 3] * (float)puVar4[2];
					local_88 = local_60[uVar1 * 3 + 1] * (float)puVar4[2] +
										 (local_30[local_80[uVar1 * 2] * 3 + 1] +
										 local_30[local_80[uVar1 * 2 + 1] * 3 + 1]) * 0.5;
					lego::game::SurfaceMap_ToBlockCoordinatesNoZ
										(level->surfaceMap,local_8c,local_88,(int *)&local_98,(int *)&local_9c);
					FUN_0042f210(level,local_98,local_9c,1);
					uVar1 = puVar4[-1];
					pfVar6 = local_30;
					lVar5 = __ftol((float10)(float)puVar3[uVar1 * 2 + -0x104]);
					uVar2 = (uint)lVar5;
					lVar5 = __ftol((float10)(float)puVar3[uVar1 * 2 + -0x105]);
					FUN_00450390(level->surfaceMap,(uint)lVar5,uVar2,pfVar6);
					uVar1 = *puVar4;
					local_8c = (local_30[local_80[uVar1 * 2 + 1] * 3] + local_30[local_80[uVar1 * 2] * 3]) *
										 0.5 + local_60[uVar1 * 3] * (float)puVar4[3];
					local_88 = local_60[uVar1 * 3 + 1] * (float)puVar4[3] +
										 (local_30[local_80[uVar1 * 2] * 3 + 1] +
										 local_30[local_80[uVar1 * 2 + 1] * 3 + 1]) * 0.5;
					lego::game::SurfaceMap_ToBlockCoordinatesNoZ
										(level->surfaceMap,local_8c,local_88,(int *)&local_98,(int *)&local_9c);
					FUN_0042f210(level,local_98,local_9c,0);
					local_90 += 1;
					puVar4 = puVar4 + 6;
				} while (local_90 < *puVar3);
			}
			local_94 += 1;
			puVar3 = puVar3 + 0x10a;
		} while (local_94 < Struct_428_COUNT_0054ceb0);
	}
	return;
}



undefined4 * __cdecl FUN_0046eb60(int param_1,int param_2,uint *param_3)
{
	uint uVar1;
	ItemStruct_428 *pIVar2;
	ItemStruct_428 *pIVar3;
	float10 extraout_ST0;
	longlong lVar4;
	uint local_24;
	float local_20 [4];
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_20[0] = 0.0;
	local_20[1] = -1.0;
	local_20[2] = 1.0;
	local_20[3] = 0.0;
	local_10 = 0;
	local_c = 0x3f800000;
	local_8 = 0xbf800000;
	local_4 = 0;
	local_24 = 0;
	if (Struct_428_COUNT_0054ceb0 == 0) {
		return NULL;
	}
	pIVar2 = Struct_428_ARRAY_0054a520[0].items;
	do {
		uVar1 = 0;
		pIVar3 = pIVar2;
		if (pIVar2[10].index != 0) {
			do {
				lVar4 = __ftol((float10)(float)(&pIVar2[-0x22].field_c)[pIVar3->index * 2] +
											 (float10)local_20[pIVar3->direction * 2]);
				if ((param_1 == (int)lVar4) && (lVar4 = __ftol(extraout_ST0), param_2 == (int)lVar4)) {
					if (param_3 != NULL) {
						*param_3 = uVar1;
					}
					return &pIVar2[-0x22].field_c;
				}
				uVar1 += 1;
				pIVar3 = pIVar3 + 1;
			} while (uVar1 < pIVar2[10].index);
		}
		local_24 += 1;
		pIVar2 = (ItemStruct_428 *)&pIVar2[0x2c].field_8;
		if (Struct_428_COUNT_0054ceb0 <= local_24) {
			return NULL;
		}
	} while( true );
}



int __cdecl lego::game::util::Struct428_CompareCount(Struct_428 *a,Struct_428 *b)
{
	if (b->pointsCount < a->pointsCount) {
		return 0xffffffff;
	}
	return (uint)(a->pointsCount < b->pointsCount);
}



Struct_428 * __cdecl lego::game::Level_LoadSearchStruct428(int y,uint unkParam_x,uint unkParam_xMax)
{
	Struct_428 *pSVar1;
	Struct_428 *pSVar2;
	uint uVar3;
	Struct_428 *pSVar4;
	Struct_428 *pSVar5;
	uint uVar6;
	
	pSVar4 = NULL;
	if ((y != 0) && (unkParam_x < unkParam_xMax)) {
		do {
			uVar3 = 0;
			if (Struct_428_COUNT_0054ceb0 != 0) {
				pSVar1 = Struct_428_ARRAY_0054a520;
				do {
					uVar6 = 0;
					if (pSVar1->pointsCount != 0) {
						pSVar2 = pSVar1;
						pSVar5 = pSVar4;
						do {
							pSVar4 = pSVar5;
							if (((((float)(ulonglong)unkParam_x == pSVar2->points[0].x) &&
									 ((float)(ulonglong)(y - 1) == pSVar2->points[0].y)) &&
									(pSVar4 = pSVar1, pSVar5 != NULL)) && (pSVar4 = pSVar5, pSVar5 != pSVar1)) {
								PairStruct_428_ARRAY_0054ceb4[PairStruct_428_COUNT_0054cf04].first = pSVar5;
								PairStruct_428_ARRAY_0054ceb4[PairStruct_428_COUNT_0054cf04].second = pSVar1;
								PairStruct_428_COUNT_0054cf04 += 1;
							}
							uVar6 += 1;
							pSVar2 = (Struct_428 *)(pSVar2->points + 1);
							pSVar5 = pSVar4;
						} while (uVar6 < pSVar1->pointsCount);
					}
					uVar3 += 1;
					pSVar1 = pSVar1 + 1;
				} while (uVar3 < Struct_428_COUNT_0054ceb0);
			}
			unkParam_x += 1;
		} while (unkParam_x < unkParam_xMax);
	}
	return pSVar4;
}



void __cdecl
lego::game::Level_LoadAddStruct428(Struct_428 *struct428,uint y,uint unkParam_x,uint unkParam_xMax)
{
	if (unkParam_x < unkParam_xMax) {
		do {
			struct428->points[struct428->pointsCount].x = (float)(ulonglong)unkParam_x;
			struct428->points[struct428->pointsCount].y = (float)(ulonglong)y;
			unkParam_x += 1;
			struct428->pointsCount = struct428->pointsCount + 1;
		} while (unkParam_x < unkParam_xMax);
	}
	return;
}



void __cdecl lego::game::Level_LoadAddFirstStruct428(uint y,uint unkParam_x,uint unkParam_xMax)
{
	Struct_428 *struct428;
	
	struct428 = Struct_428_ARRAY_0054a520 + Struct_428_COUNT_0054ceb0;
	Struct_428_ARRAY_0054a520[Struct_428_COUNT_0054ceb0].pointsCount = 0;
	Level_LoadAddStruct428(struct428,y,unkParam_x,unkParam_xMax);
	Struct_428_COUNT_0054ceb0 = Struct_428_COUNT_0054ceb0 + 1;
	return;
}



BOOL __cdecl lego::main::Boot_Load_WeaponTypes(CFGProperty *root,char *keyBasePath)
{
	char cVar1;
	CFGProperty *prop;
	char *pcVar2;
	CFGProperty *pCVar3;
	int iVar4;
	BOOL BVar5;
	void *pvVar6;
	uint uVar7;
	int iVar8;
	int iVar9;
	char **ppcVar10;
	int iVar11;
	undefined4 *puVar12;
	uint uVar13;
	undefined4 *puVar14;
	float10 fVar15;
	ObjectType local_d8;
	uint local_d4;
	CFGProperty *local_d0;
	int local_cc;
	int local_c8;
	int local_c4;
	char *local_c0 [16];
	char local_80 [128];
	
	uVar13 = 0;
	globals::g_LegoCfgRoot_WeaponTypes = root;
	globals::g_WeaponTypes_COUNT = 0;
	pcVar2 = cfg::CFG_JoinPath(keyBasePath,"WeaponTypes",0);
	pCVar3 = cfg::CFG_GetBlockFirstChild(root,pcVar2);
	if (pCVar3 != NULL) {
		do {
			globals::g_WeaponTypes_COUNT += 1;
			pCVar3 = cfg::CFG_NextFlatProperty(pCVar3);
		} while (pCVar3 != NULL);
		globals::g_WeaponTypes_TABLE = (void **)std::malloc(globals::g_WeaponTypes_COUNT * 0x4b68);
		if (globals::g_WeaponTypes_TABLE != NULL) {
			if (globals::g_WeaponTypes_COUNT != 0) {
				iVar11 = 0;
				iVar9 = 0;
				do {
					local_d8 = OBJECT_NONE;
					do {
						local_d4 = 0;
						do {
							uVar7 = 0;
							do {
								iVar4 = (local_d4 + local_d8 * 0xf) * 0x10 + uVar7;
								uVar7 += 1;
								globals::g_WeaponTypes_TABLE[iVar4 + iVar9] = (void *)0xbf800000;
							} while (uVar7 < 0x10);
							local_d4 += 1;
						} while (local_d4 < 0xf);
						local_d8 += OBJECT_VEHICLE;
					} while (local_d8 < 0x14);
					*(undefined4 *)((int)globals::g_WeaponTypes_TABLE + iVar11 + 0x4b00) = 0;
					*(undefined4 *)((int)globals::g_WeaponTypes_TABLE + iVar11 + 0x4b0c) = 0;
					*(undefined4 *)((int)globals::g_WeaponTypes_TABLE + iVar11 + 0x4b10) = 0;
					iVar8 = 0x12;
					*(undefined4 *)((int)globals::g_WeaponTypes_TABLE + iVar11 + 0x4b1c) = 0x43160000;
					iVar4 = iVar11 + 0x4b20;
					do {
						iVar8 += -1;
						*(undefined4 *)((int)globals::g_WeaponTypes_TABLE + iVar4) = 0x40a00000;
						iVar4 = iVar4 + 4;
					} while (iVar8 != 0);
					uVar13 += 1;
					iVar9 += 0x12da;
					iVar11 += 0x4b68;
				} while (uVar13 < globals::g_WeaponTypes_COUNT);
			}
			globals::g_WeaponNames_TABLE = (char **)std::malloc(globals::g_WeaponTypes_COUNT * 4);
			if (globals::g_WeaponNames_TABLE != NULL) {
				pcVar2 = cfg::CFG_JoinPath(keyBasePath,"WeaponTypes",0);
				local_d0 = cfg::CFG_GetBlockFirstChild(root,pcVar2);
				if (local_d0 != NULL) {
					iVar9 = 0x4b04;
					local_c8 = 0;
					local_cc = 0;
					local_c4 = 0x4b04;
LAB_0046f010:
					prop = local_d0;
					pcVar2 = cfg::CFG_JoinPath(keyBasePath,"WeaponTypes",local_d0->key,0);
					pCVar3 = cfg::CFG_GetBlockFirstChild(root,pcVar2);
joined_r0x0046f044:
					do {
						if (pCVar3 == NULL) goto LAB_0046f2cb;
						iVar11 = std::_stricmp(pCVar3->key,"SlowDeath");
						if (iVar11 == 0) {
							util::stringSplit(pCVar3->value,local_c0,":");
							*(undefined4 *)((int)globals::g_WeaponTypes_TABLE + iVar9 + -4) = 1;
							fVar15 = std::atof(local_c0[0]);
							*(float *)((int)globals::g_WeaponTypes_TABLE + iVar9) = (float)fVar15;
							fVar15 = std::atof(local_c0[1]);
							*(float *)((int)globals::g_WeaponTypes_TABLE + iVar9 + 4) = (float)fVar15;
							goto LAB_0046f2b4;
						}
						iVar11 = std::_stricmp(pCVar3->key,"RechargeTime");
						if (iVar11 == 0) {
							fVar15 = std::atof(pCVar3->value);
							*(float *)((int)globals::g_WeaponTypes_TABLE + iVar9 + 8) = (float)fVar15;
							goto LAB_0046f2b4;
						}
						iVar11 = std::_stricmp(pCVar3->key,"DefaultDamage");
						if (iVar11 == 0) {
							fVar15 = std::atof(pCVar3->value);
							*(float *)((int)globals::g_WeaponTypes_TABLE + iVar9 + 0xc) = (float)fVar15;
							goto LAB_0046f2b4;
						}
						iVar11 = std::_stricmp(pCVar3->key,"DischargeRate");
						if (iVar11 == 0) {
							fVar15 = std::atof(pCVar3->value);
							*(float *)((int)globals::g_WeaponTypes_TABLE + iVar9 + 0x10) = (float)fVar15;
							goto LAB_0046f2b4;
						}
						iVar11 = std::_stricmp(pCVar3->key,"WeaponRange");
						if (iVar11 == 0) {
							fVar15 = std::atof(pCVar3->value);
							*(float *)((int)globals::g_WeaponTypes_TABLE + iVar9 + 0x18) = (float)fVar15;
							goto LAB_0046f2b4;
						}
						iVar11 = 0;
						ppcVar10 = globals::g_Game.SurfaceTypes_TABLE;
						do {
							std::sprintf(local_80,"WallDestroyTime_%s",*ppcVar10 + 0x11);
							iVar4 = std::_stricmp(pCVar3->key,local_80);
							if (iVar4 == 0) {
								fVar15 = std::atof(pCVar3->value);
								globals::g_WeaponTypes_TABLE[iVar11 + local_cc + 0x12c8] = (void *)(float)fVar15;
								pCVar3 = cfg::CFG_NextFlatProperty(pCVar3);
								break;
							}
							ppcVar10 = ppcVar10 + 1;
							iVar11 += 1;
						} while (ppcVar10 < globals::g_Game.SurfaceTypeDescriptions_name_TABLE);
						prop = local_d0;
						if (iVar11 == 0x12) {
							iVar11 = std::_stricmp(pCVar3->key,"Ammo");
							if (iVar11 == 0) {
								iVar11 = std::atoi(pCVar3->value);
								*(int *)((int)globals::g_WeaponTypes_TABLE + iVar9 + 0x14) = iVar11;
							}
							else {
								*(undefined4 *)((int)globals::g_WeaponTypes_TABLE + iVar9 + 0x14) = 0;
								BVar5 = game::Game_GetObjectByName(pCVar3->key,&local_d8,(int *)&local_d4,NULL);
								prop = local_d0;
								if (BVar5 == 0) goto joined_r0x0046f044;
								uVar13 = game::Object_GetLevels(local_d8,local_d4);
								util::stringSplit(pCVar3->value,local_c0,":");
								uVar7 = 0;
								if (uVar13 != 0) {
									ppcVar10 = local_c0;
									do {
										fVar15 = std::atof(*ppcVar10);
										ppcVar10 = ppcVar10 + 1;
										iVar9 = (local_d4 + local_d8 * 0xf) * 0x10 + uVar7;
										uVar7 += 1;
										globals::g_WeaponTypes_TABLE[iVar9 + local_cc] = (void *)(float)fVar15;
										iVar9 = local_c4;
									} while (uVar7 < uVar13);
								}
							}
LAB_0046f2b4:
							pCVar3 = cfg::CFG_NextFlatProperty(pCVar3);
							prop = local_d0;
						}
					} while( true );
				}
LAB_0046f345:
				if (local_d0 == NULL) {
					return 1;
				}
				std::free(globals::g_WeaponNames_TABLE);
			}
			std::free(globals::g_WeaponTypes_TABLE);
		}
	}
	return 0;
LAB_0046f2cb:
	uVar13 = 0xffffffff;
	pcVar2 = prop->key;
	do {
		if (uVar13 == 0) break;
		uVar13 -= 1;
		cVar1 = *pcVar2;
		pcVar2 = pcVar2 + 1;
	} while (cVar1 != '\0');
	pvVar6 = std::malloc(~uVar13);
	iVar9 += 0x4b68;
	*(void **)((int)globals::g_WeaponNames_TABLE + local_c8) = pvVar6;
	uVar13 = 0xffffffff;
	puVar12 = (undefined4 *)prop->key;
	do {
		if (uVar13 == 0) break;
		uVar13 -= 1;
		cVar1 = *(char *)puVar12;
		puVar12 = (undefined4 *)((int)puVar12 + 1);
	} while (cVar1 != '\0');
	puVar12 = (undefined4 *)prop->key;
	puVar14 = *(undefined4 **)((int)globals::g_WeaponNames_TABLE + local_c8);
	for (uVar7 = ~uVar13 >> 2; uVar7 != 0; uVar7 -= 1) {
		*puVar14 = *puVar12;
		puVar12 = puVar12 + 1;
		puVar14 = puVar14 + 1;
	}
	local_cc += 0x12da;
	for (uVar13 = ~uVar13 & 3; uVar13 != 0; uVar13 -= 1) {
		*(undefined *)puVar14 = *(undefined *)puVar12;
		puVar12 = (undefined4 *)((int)puVar12 + 1);
		puVar14 = (undefined4 *)((int)puVar14 + 1);
	}
	local_c8 = local_c8 + 4;
	local_c4 = iVar9;
	local_d0 = cfg::CFG_NextFlatProperty(prop);
	if (local_d0 == NULL) goto LAB_0046f345;
	goto LAB_0046f010;
}



uint __cdecl lego::game::Game_GetWeaponType(char *weaponName)
{
	int iVar1;
	uint uVar2;
	
	uVar2 = 0;
	if (globals::g_WeaponTypes_COUNT == 0) {
		return 1;
	}
	do {
		iVar1 = std::_stricmp(globals::g_WeaponNames_TABLE[uVar2],weaponName);
		if (iVar1 == 0) {
			return uVar2;
		}
		uVar2 += 1;
	} while (uVar2 < globals::g_WeaponTypes_COUNT);
	return globals::g_WeaponTypes_COUNT + 1;
}



float10 __cdecl FUN_0046f3d0(int param_1)
{
	return (float10)(float)lego::globals::g_WeaponTypes_TABLE[param_1 * 0x12da + 0x12c3];
}



float10 __cdecl FUN_0046f400(int param_1)
{
	return (float10)(float)lego::globals::g_WeaponTypes_TABLE[param_1 * 0x12da + 0x12c5];
}



float10 __cdecl FUN_0046f430(int param_1)
{
	return (float10)(float)lego::globals::g_WeaponTypes_TABLE[param_1 * 0x12da + 0x12c7];
}



float10 __cdecl FUN_0046f460(int param_1,int param_2)
{
	return (float10)(float)lego::globals::g_WeaponTypes_TABLE[param_1 * 0x12da + param_2 + 0x12c8];
}



float10 __cdecl lego::game::Weapon_GetWeaponFloat12c4(int weaponType,LiveObject *liveObj)
{
	ObjectType OVar1;
	
	OVar1 = liveObj->objType;
	if ((float)globals::g_WeaponTypes_TABLE
						 [liveObj->objLevel + (OVar1 * 3 + liveObj->objIndex + OVar1 * 0xc) * 0x10 +
							weaponType * 0x12da] == -1.0) {
		return (float10)(float)globals::g_WeaponTypes_TABLE[weaponType * 0x12da + 0x12c4];
	}
	return (float10)(float)globals::g_WeaponTypes_TABLE
												 [weaponType * 0x12da +
													OVar1 * 0xf0 + liveObj->objIndex * 0x10 + liveObj->objLevel];
}



void __cdecl
FUN_0046f530(LiveObject *liveObj,int weaponType,BOOL param_3,float param_4,float *param_5)
{
	float fVar1;
	void *pvVar2;
	BOOL BVar3;
	float10 fVar4;
	
	fVar4 = lego::game::Weapon_GetWeaponFloat12c4(weaponType,liveObj);
	fVar1 = (float)fVar4;
	if ((liveObj->flags3_3e8 & 0x40000) != LIVEOBJ3_NONE) {
		BVar3 = FUN_00438870(liveObj,1);
		if (BVar3 != 0) {
			if (lego::globals::g_WeaponTypes_TABLE[weaponType * 0x12da + 0x12c0] != NULL) {
				if (param_3 != 0) {
					FUN_0043f960(liveObj,(float)lego::globals::g_WeaponTypes_TABLE
																			[weaponType * 0x12da + 0x12c1] * fVar1,1,param_4);
					pvVar2 = lego::globals::g_WeaponTypes_TABLE[weaponType * 0x12da + 0x12c2];
					liveObj->field_35c = weaponType;
					liveObj->field_358 = pvVar2;
					FUN_00447c10(liveObj,param_5,1);
					return;
				}
				FUN_0043f960(liveObj,fVar1 * param_4,1,param_4);
				return;
			}
			if (liveObj->objType == OBJECT_ROCKMONSTER) {
				lego::nerps::NERPs_IncDat_0055632c();
			}
			FUN_0043f960(liveObj,fVar1,1,param_4);
			if (param_3 != 0) {
				FUN_00447c10(liveObj,param_5,1);
			}
		}
	}
	return;
}



void __cdecl FUN_0046f640(int **param_1,float param_2,int param_3)
{
	FUN_0043f960((LiveObject *)param_1,param_2,1,1.0);
	FUN_00447c10((LiveObject *)param_1,NULL,param_3);
	return;
}



void __cdecl FUN_0046f670(int param_1)
{
	float10 fVar1;
	float10 fVar2;
	float10 fVar3;
	float10 fVar4;
	float local_30;
	float local_2c;
	float local_28;
	float local_24;
	float local_20;
	float local_1c;
	int **local_18;
	float local_14;
	float *local_10;
	VehicleData *local_c;
	CreatureData *local_8;
	CreatureData *local_4;
	
	if (*(int *)(param_1 + 0x2a4) != 0) {
		local_4 = *(CreatureData **)(param_1 + 0x2a0);
		local_c = (VehicleData *)&local_24;
		local_18 = NULL;
		local_14 = 1.0;
		local_8 = NULL;
		local_10 = (float *)(param_1 + 0x280);
		fVar1 = FUN_0046f430(*(int *)(param_1 + 0x2a8));
		if (fVar1 != (float10)0.0) {
			fVar2 = (float10)*(float *)(param_1 + 0x268) - (float10)*(float *)(param_1 + 0x274);
			fVar3 = (float10)*(float *)(param_1 + 0x26c) - (float10)*(float *)(param_1 + 0x278);
			fVar4 = (float10)*(float *)(param_1 + 0x270) - (float10)*(float *)(param_1 + 0x27c);
			local_2c = (float)fVar3;
			local_28 = (float)fVar4;
			if (fVar1 <= SQRT(fVar4 * (float10)local_28 + fVar3 * (float10)local_2c + fVar2 * fVar2)) {
				lego::pool::ReservedPool_LiveObject___Release(*(LiveObject **)(param_1 + 0x2a4));
				*(undefined4 *)(param_1 + 0x2a4) = 0;
				return;
			}
		}
		local_24 = *(float *)(param_1 + 0x274) - *(float *)(param_1 + 0x280);
		local_20 = *(float *)(param_1 + 0x278) - *(float *)(param_1 + 0x284);
		local_1c = *(float *)(param_1 + 0x27c) - *(float *)(param_1 + 0x288);
		FUN_00437a70(FUN_00471630,(LiveObject *)&local_18);
		FUN_004718f0(&local_18);
		if (local_8 != NULL) {
			lego::pool::ReservedPool_LiveObject___Release(*(LiveObject **)(param_1 + 0x2a4));
			*(undefined4 *)(param_1 + 0x2a4) = 0;
			if (local_18 != NULL) {
				local_30 = (float)local_c->objIndex * local_14 + *local_10;
				local_2c = local_10[1] + (float)local_c->WheelNullName * local_14;
				local_28 = local_10[2] + (float)local_c->aeResData1 * local_14;
				FUN_0046fa30(local_18,(int **)(param_1 + 0x290),&local_30,*(int **)(param_1 + 0x2a8),
										 *(int *)(param_1 + 0x2ac));
			}
		}
	}
	return;
}



void __cdecl FUN_0046f810(float param_1)
{
	CFGProperty **ppCVar1;
	Struct_34 **ppSVar2;
	
	ppCVar1 = (CFGProperty **)&DAT_0050491c;
	do {
		if (ppCVar1[0xa9] != NULL) {
			FUN_0046fbe0((int *)ppCVar1,param_1);
		}
		ppCVar1 = ppCVar1 + 0xac;
	} while (ppCVar1 < &lego::globals::g_LegoCfgRoot_WeaponTypes);
	FUN_00437a70(FUN_0046f8d0,(LiveObject *)&param_1);
	ppCVar1 = (CFGProperty **)&DAT_0050491c;
	do {
		FUN_0046f670((int)ppCVar1);
		ppCVar1 = ppCVar1 + 0xac;
	} while (ppCVar1 < &lego::globals::g_LegoCfgRoot_WeaponTypes);
	ppSVar2 = (Struct_34 **)&DAT_0050487c;
	do {
		if (*ppSVar2 != NULL) {
			if ((float)ppSVar2[3] < 0.0) {
				FUN_00482390(*ppSVar2,(IDirect3DRMFrame3 *)ppSVar2[2]->field_4);
				FUN_00482390(ppSVar2[1],(IDirect3DRMFrame3 *)ppSVar2[2]->field_4);
				*ppSVar2 = NULL;
			}
			ppSVar2[3] = (Struct_34 *)((float)ppSVar2[3] - param_1);
		}
		ppSVar2 = ppSVar2 + 4;
	} while (ppSVar2 < &DAT_0050491c);
	return;
}



undefined4 __cdecl FUN_0046f8d0(int **param_1,float *param_2)
{
	float fVar1;
	int iVar2;
	ResourceData *resData;
	uint uVar3;
	float10 fVar4;
	float10 fVar5;
	ResourceData *opt_refResData;
	uint uVar6;
	Vector3F *out_position;
	Vector3F local_c;
	
	if ((ushort)((ushort)((float)param_1[0xd8] < 0.0) << 8 |
							(ushort)((float)param_1[0xd8] == 0.0) << 0xe) == 0) {
		param_1[0xd8] = (int *)((float)param_1[0xd8] - *param_2);
	}
	iVar2 = FUN_00471580((int *)param_1);
	if (iVar2 != 0) {
		uVar3 = 0;
		iVar2 = FUN_00471580((int *)param_1);
		if (*(int *)(iVar2 + 0xa4) != 0) {
			do {
				fVar4 = FUN_004715b0((int *)param_1,uVar3);
				if ((ushort)((ushort)(fVar4 < (float10)0.0) << 8 | (ushort)(fVar4 == (float10)0.0) << 0xe)
						== 0) {
					uVar6 = uVar3;
					fVar5 = FUN_004715b0((int *)param_1,uVar3);
					FUN_004715d0((int *)param_1,(float)(fVar5 - (float10)*param_2),uVar6);
					fVar5 = lego::snd::Sample_GetRandomDuration(0x1d);
					fVar1 = (float)(fVar5 * (float10)25.0 * (float10)lego::globals::g_Game.gameSpeed);
					fVar5 = FUN_004715b0((int *)param_1,uVar3);
					if ((fVar5 < (float10)fVar1) &&
						 ((ushort)((ushort)((float)fVar4 < fVar1) << 8 | (ushort)((float)fVar4 == fVar1) << 0xe)
							== 0)) {
						out_position = &local_c;
						opt_refResData = NULL;
						resData = lego::game::LiveObject_GetResource((LiveObject *)param_1);
						lego::res::Res_GetPosition(resData,opt_refResData,out_position);
						lego::res::Res_PlayResourceSound(NULL,0x1d,0,0,&local_c);
					}
				}
				uVar3 += 1;
				iVar2 = FUN_00471580((int *)param_1);
			} while (uVar3 < *(uint *)(iVar2 + 0xa4));
		}
	}
	if ((ushort)((ushort)((float)param_1[0xd6] < 0.0) << 8 |
							(ushort)((float)param_1[0xd6] == 0.0) << 0xe) == 0) {
		FUN_0046f530((LiveObject *)param_1,(int)param_1[0xd7],0,*param_2,NULL);
		param_1[0xd6] = (int *)((float)param_1[0xd6] - *param_2);
	}
	return 0;
}



void __cdecl FUN_0046fa30(int **param_1,int **param_2,undefined4 *param_3,int *param_4,int param_5)
{
	BOOL BVar1;
	ObjectStatsFlags2 OVar2;
	float10 fVar3;
	float10 fVar4;
	int *local_8;
	int *local_4;
	
	local_8 = *param_2;
	local_4 = param_2[1];
	BVar1 = FUN_004439b0((LiveObject *)param_1);
	if (BVar1 != 0) {
		FUN_0040bd40((Vector3F *)param_3);
	}
	if (param_5 == 1) {
		OVar2 = lego::game::LiveObject_GetStatsFlags2((LiveObject *)param_1);
		if ((OVar2 & STATS2_CANLASER) != STATS2_NONE) {
			fVar3 = lego::game::LiveObject_GetLaserDamage((LiveObject *)param_1);
			FUN_0046f640(param_1,(float)fVar3,1);
		}
		if (param_3 != NULL) {
			FUN_0040cc10(0,param_3,NULL);
		}
	}
	else {
		if (param_5 == 2) {
			OVar2 = lego::game::LiveObject_GetStatsFlags2((LiveObject *)param_1);
			if ((OVar2 & STATS2_CANPUSH) != STATS2_NONE) {
				fVar3 = lego::game::LiveObject_GetPusherDist((LiveObject *)param_1);
				fVar4 = lego::game::LiveObject_GetPusherDamage((LiveObject *)param_1);
				local_8 = (int *)((float)local_8 * 1.5);
				local_4 = (int *)((float)local_4 * 1.5);
				FUN_0046f640(param_1,(float)fVar4,1);
				FUN_0044c410(param_1,&local_8,(int *)(float)fVar3);
			}
			if (param_3 != NULL) {
				FUN_0040cc10(1,param_3,NULL);
				return;
			}
		}
		else {
			if (param_5 != 3) {
				FUN_0046f530((LiveObject *)param_1,(int)param_4,1,0.0,(float *)&local_8);
				return;
			}
			param_2 = (int **)0x41200000;
			OVar2 = lego::game::LiveObject_GetStatsFlags2((LiveObject *)param_1);
			if ((OVar2 & STATS2_CANFREEZE) != STATS2_NONE) {
				fVar3 = lego::game::LiveObject_GetFreezerTime((LiveObject *)param_1);
				if ((ushort)((ushort)(fVar3 < (float10)0.0) << 8 | (ushort)(fVar3 == (float10)0.0) << 0xe)
						== 0) {
					param_2 = (int **)(float)fVar3;
				}
				fVar3 = lego::game::LiveObject_GetFreezerDamage((LiveObject *)param_1);
				FUN_0046f640(param_1,(float)fVar3,0);
				FUN_0044c2f0((int *)param_1,(float)param_2);
			}
			if (param_3 != NULL) {
				FUN_0040cc10(2,param_3,NULL);
				return;
			}
		}
	}
	return;
}



void __cdecl FUN_0046fbe0(int *param_1,float param_2)
{
	float fVar1;
	float x;
	ResourceData *resData;
	float fVar2;
	float local_14;
	float local_10;
	float local_8;
	
	resData = lego::game::LiveObject_GetResource((LiveObject *)param_1[0xa9]);
	lego::res::Res_GetPosition(resData,NULL,(Vector3F *)(param_1 + 0xa0));
	fVar2 = (float)param_1[0xa3] * param_2;
	if (*param_1 == 0) {
		local_8 = (float)param_1[0xa5] * fVar2;
		param_1[0x9d] = (int)((float)param_1[0xa4] * fVar2 + (float)param_1[0x9d]);
		param_1[0x9e] = (int)((float)param_1[0x9e] + local_8);
		param_1[0x9f] = (int)((float)param_1[0x9f] + (float)param_1[0xa6] * fVar2);
		lego::res::Res_SetFramePosition
							(resData,NULL,(float)param_1[0x9d],(float)param_1[0x9e],(float)param_1[0x9f]);
		fVar2 = (float)param_1[0xa6];
		fVar1 = (float)param_1[0xa5];
		x = (float)param_1[0xa4];
	}
	else {
		fVar1 = (float)param_1[0x99];
		param_1[0x99] = (int)(fVar2 + fVar1);
		FUN_004067f0((uint *)(param_1 + 1),fVar2 + fVar1,&local_14);
		param_1[0x9d] = (int)((float)param_1[0xa4] * local_14 + (float)param_1[0x9a]);
		param_1[0x9e] = (int)((float)param_1[0x9b] + (float)param_1[0xa5] * local_14);
		param_1[0x9f] = (int)((float)param_1[0x9c] + local_10);
		lego::res::Res_SetFramePosition
							(resData,NULL,(float)param_1[0x9d],(float)param_1[0x9e],(float)param_1[0x9f]);
		fVar2 = ((float)param_1[0x9f] - (float)param_1[0xa2]) * 0.25;
		fVar1 = (float)param_1[0x9e] - (float)param_1[0xa1];
		x = (float)param_1[0x9d] - ((Vector3F *)(param_1 + 0xa0))->x;
	}
	lego::res::Res_SetFrameOrientation(resData,NULL,x,fVar1,fVar2,0.0,0.0,-1.0);
	return;
}



undefined4 __cdecl
FUN_0046fdb0(LiveObject *liveObj,float *param_2,float *param_3,uint param_4,uint param_5)
{
	float *pfVar1;
	float fVar2;
	uint uVar3;
	uint uVar4;
	int iVar5;
	int iVar6;
	LiveObject *pLVar7;
	
	uVar4 = param_5;
	uVar3 = param_4;
	pLVar7 = liveObj;
	if (param_5 == 1) {
		FUN_004375c0(liveObj,param_4,1.0);
	}
	FUN_004701b0(uVar4,&param_4,&param_5);
	iVar5 = lego::game::game_getResourceCount_FUN_0042eca0(param_4,param_5,(int *)&liveObj);
	if (iVar5 != 0) {
		iVar5 = lego::unk::Lego_GetNextIndex_Struct2b0_TABLE_00504bc0();
		if (iVar5 != -1) {
			iVar6 = iVar5 * 0x2b0;
			*(int *)(&DAT_0050491c + iVar6) = 0;
			*(uint *)(&DAT_00504bc4 + iVar6) = uVar3;
			*(uint *)(&DAT_00504bc8 + iVar6) = uVar4;
			*(float *)(&DAT_00504b90 + iVar6) = *param_2;
			*(float *)(&DAT_00504b94 + iVar6) = param_2[1];
			*(float *)(&DAT_00504b98 + iVar6) = param_2[2];
			*(float *)(&DAT_00504b84 + iVar6) = *param_2;
			*(float *)(&DAT_00504b88 + iVar6) = param_2[1];
			fVar2 = param_2[2];
			*(undefined4 *)(&DAT_00504ba8 + iVar6) = 0x40a00000;
			*(float *)(&DAT_00504b8c + iVar6) = fVar2;
			pfVar1 = (float *)(&DAT_00504bac + iVar6);
			*pfVar1 = *param_3;
			*(float *)(&DAT_00504bb0 + iVar6) = param_3[1];
			*(float *)(&DAT_00504bb4 + iVar6) = param_3[2];
			fVar2 = 1.0 / SQRT(*pfVar1 * *pfVar1 +
												 *(float *)(&DAT_00504bb4 + iVar6) * *(float *)(&DAT_00504bb4 + iVar6) +
												 *(float *)(&DAT_00504bb0 + iVar6) * *(float *)(&DAT_00504bb0 + iVar6));
			*pfVar1 = *pfVar1 * fVar2;
			*(float *)(&DAT_00504bb0 + iVar6) = fVar2 * *(float *)(&DAT_00504bb0 + iVar6);
			*(float *)(&DAT_00504bb4 + iVar6) = fVar2 * *(float *)(&DAT_00504bb4 + iVar6);
			*(LiveObject **)(&DAT_00504bbc + iVar6) = pLVar7;
			*(undefined4 *)(&DAT_00504bb8 + iVar6) = 0;
			pLVar7 = lego::game::Game_CreateLiveResourceObject
												 ((ResourceData *)liveObj,param_4,param_5,0,*param_2,param_2[1],0.0);
			(&DAT_00504bc0)[iVar5 * 0xac] = pLVar7;
			FUN_0046fbe0((int *)(&DAT_0050491c + iVar6),0.0);
			return 1;
		}
	}
	return 0;
}



undefined4 __cdecl
FUN_0046ff30(undefined4 param_1,float *param_2,float *param_3,undefined4 param_4,undefined4 param_5)
{
	float fVar1;
	int iVar2;
	int iVar3;
	LiveObject *pLVar4;
	float10 fVar5;
	int local_2c;
	ObjectType local_28;
	ResourceData *local_24;
	float local_20;
	undefined4 local_1c;
	float local_18;
	undefined4 local_14;
	float local_10;
	float local_c;
	float local_8;
	undefined4 local_4;
	
	local_8 = 0.0;
	local_4 = 0;
	local_18 = 1.0;
	local_14 = 0xbfa66666;
	local_20 = 0.3;
	local_1c = 0x3f800000;
	FUN_004701b0(param_5,&local_28,&local_2c);
	iVar2 = lego::game::game_getResourceCount_FUN_0042eca0(local_28,local_2c,(int *)&local_24);
	if (iVar2 != 0) {
		iVar2 = lego::unk::Lego_GetNextIndex_Struct2b0_TABLE_00504bc0();
		if (iVar2 != -1) {
			iVar3 = iVar2 * 0x2b0;
			*(undefined4 *)(&DAT_00504bc8 + iVar3) = param_5;
			*(undefined4 *)(&DAT_00504bc4 + iVar3) = param_4;
			*(int *)(&DAT_0050491c + iVar3) = 1;
			*(float *)(&DAT_00504b84 + iVar3) = *param_2;
			*(float *)(&DAT_00504b88 + iVar3) = param_2[1];
			*(float *)(&DAT_00504b8c + iVar3) = param_2[2];
			*(float *)(&DAT_00504b90 + iVar3) = *param_2;
			*(float *)(&DAT_00504b94 + iVar3) = param_2[1];
			*(float *)(&DAT_00504b98 + iVar3) = param_2[2];
			*(float *)(&DAT_00504bac + iVar3) = *param_3 - *param_2;
			*(float *)(&DAT_00504bb0 + iVar3) = param_3[1] - param_2[1];
			*(float *)(&DAT_00504bb4 + iVar3) = param_3[2] - param_2[2];
			fVar1 = 1.0 / SQRT(*(float *)(&DAT_00504bac + iVar3) * *(float *)(&DAT_00504bac + iVar3) +
												 *(float *)(&DAT_00504bb4 + iVar3) * *(float *)(&DAT_00504bb4 + iVar3) +
												 *(float *)(&DAT_00504bb0 + iVar3) * *(float *)(&DAT_00504bb0 + iVar3));
			*(float *)(&DAT_00504bac + iVar3) = *(float *)(&DAT_00504bac + iVar3) * fVar1;
			*(float *)(&DAT_00504bb0 + iVar3) = fVar1 * *(float *)(&DAT_00504bb0 + iVar3);
			*(float *)(&DAT_00504bb4 + iVar3) = fVar1 * *(float *)(&DAT_00504bb4 + iVar3);
			*(undefined4 *)(&DAT_00504ba8 + iVar3) = 0x40800000;
			local_c = param_3[2] - param_2[2];
			fVar1 = SQRT((*param_2 - *param_3) * (*param_2 - *param_3) +
									 (param_2[2] - param_3[2]) * (param_2[2] - param_3[2]) +
									 (param_2[1] - param_3[1]) * (param_2[1] - param_3[1]));
			local_10 = fVar1;
			FUN_00406690(&local_18,fVar1 * 0.2);
			FUN_00406690(&local_20,fVar1 * 0.3333333);
			FUN_00406750((uint *)(iVar3 + 0x504920),&local_8,&local_18,&local_10,&local_20,0x32);
			fVar5 = FUN_004066e0((uint *)(iVar3 + 0x504920));
			*(float *)(&DAT_00504b7c + iVar3) = (float)fVar5;
			*(undefined4 *)(&DAT_00504b80 + iVar3) = 0;
			*(undefined4 *)(&DAT_00504bbc + iVar3) = param_1;
			*(undefined4 *)(&DAT_00504bb8 + iVar3) = 0;
			pLVar4 = lego::game::Game_CreateLiveResourceObject
												 (local_24,local_28,local_2c,0,*param_2,param_2[1],0.0);
			(&DAT_00504bc0)[iVar2 * 0xac] = pLVar4;
			FUN_0046fbe0((int *)(&DAT_0050491c + iVar3),0.0);
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_004701b0(undefined4 param_1,undefined4 *param_2,undefined4 *param_3)
{
	switch(param_1) {
	case 1:
		*param_2 = 0x13;
		*param_3 = 0;
		return;
	case 2:
		*param_2 = 0x10;
		*param_3 = 0;
		return;
	case 3:
		*param_2 = 0x11;
		*param_3 = 0;
		return;
	case 4:
		*param_2 = 5;
		*param_3 = 0;
	}
	return;
}



int __cdecl lego::unk::Lego_GetNextIndex_Struct2b0_TABLE_00504bc0(void)
{
	int iVar1;
	int *piVar2;
	
	iVar1 = 0;
	piVar2 = &DAT_00504bc0;
	do {
		if (*piVar2 == 0) {
			return iVar1;
		}
		piVar2 = piVar2 + 0xac;
		iVar1 += 1;
	} while (piVar2 < globals::temp::tmp_CHAR_ARRAY_00506400 + 0x2a0);
	return -1;
}



int __cdecl FUN_00470250(void)
{
	int iVar1;
	int *piVar2;
	
	iVar1 = 0;
	piVar2 = &DAT_0050487c;
	do {
		if (*piVar2 == 0) {
			return iVar1;
		}
		piVar2 = piVar2 + 4;
		iVar1 += 1;
	} while (piVar2 < &DAT_0050491c);
	return -1;
}



int ** __cdecl
FUN_00470270(int **param_1,int **param_2,int *param_3,float param_4,float param_5,int param_6,
						float param_7)
{
	TerrainType TVar1;
	int **ppiVar2;
	int *liveObj;
	int iVar3;
	ResourceData *resData;
	LevelSurfaceMap *surfaceMap;
	BOOL BVar4;
	uint uVar5;
	LevelData *level;
	float10 fVar6;
	float in_x;
	float in_y;
	int *piVar7;
	int **opt_position;
	int *in_y_00;
	Point2I *pPVar8;
	Vector3F *pVVar9;
	int iVar10;
	float local_24;
	Point2I local_20;
	float local_18;
	float local_14;
	float local_10;
	Vector3F local_c;
	
	opt_position = param_1;
	local_24 = 1.0;
	param_1 = NULL;
	lego::res::Res_PlayResourceSound(NULL,0x1b,0,0,(Vector3F *)opt_position);
	liveObj = param_3;
	ppiVar2 = param_2;
	local_18 = param_5 * (float)*param_2;
	local_14 = param_5 * (float)param_2[1];
	local_10 = (float)param_2[2] * param_5;
	FUN_00471b20(opt_position,&local_18,&param_1,&local_24,param_3);
	local_18 = local_24 * local_18;
	local_14 = local_24 * local_14;
	local_10 = local_24 * local_10;
	local_c.x = local_18 + (float)*opt_position;
	local_c.y = (float)opt_position[1] + local_14;
	local_c.z = (float)opt_position[2] + local_10;
	pVVar9 = &local_c;
	resData = lego::game::LiveObject_GetResource((LiveObject *)liveObj);
	FUN_00470950(resData,(float *)opt_position,(float *)pVVar9);
	iVar3 = param_6;
	if ((param_1 != NULL) || (1.0 <= local_24)) {
		if (param_1 != NULL) {
			FUN_0040cc10(0,(undefined4 *)&local_c,NULL);
			lego::res::Res_PlayResourceSound(NULL,0x1c,0,0,&local_c);
			if (param_1 != NULL) {
				if ((liveObj == NULL) || (*liveObj != 2)) {
					pPVar8 = NULL;
				}
				else {
					local_20.x = (int)*ppiVar2;
					local_20.y = (int)ppiVar2[1];
					pPVar8 = &local_20;
				}
				FUN_00447c10((LiveObject *)param_1,(float *)pPVar8,1);
			}
		}
	}
	else {
		FUN_0040bd40(&local_c);
		lego::res::Res_PlayResourceSound(NULL,0x1c,0,0,&local_c);
		piVar7 = &local_20.y;
		pPVar8 = &local_20;
		in_x = local_c.x;
		in_y = local_c.y;
		surfaceMap = lego::game::GetSurfaceMap();
		lego::game::SurfaceMap_ToBlockCoordinatesNoZ(surfaceMap,in_x,in_y,(int *)pPVar8,piVar7);
		BVar4 = lego::game::Level_GetBlockFlags1_10Not8(local_20.x,local_20.y);
		if (BVar4 != 0) {
			uVar5 = lego::game::Level_IsBlockSolid(&local_20);
			if ((uVar5 == 0) &&
				 (TVar1 = (lego::globals::g_Game.level)->blocks
									[(int)(((lego::globals::g_Game.level)->dimensions).width * local_20.y + local_20.x
												)].terrain, TVar1 != TERRAIN_RECHARGESEAM)) {
				fVar6 = FUN_0046f460(iVar3,(uint)TVar1);
				param_5 = (float)fVar6;
				BVar4 = lego::game::Level_GetBlockUnkField14Test(local_20.x,local_20.y,param_5,param_4);
				if (BVar4 != 0) {
					iVar10 = 0;
					piVar7 = (int *)local_20.x;
					in_y_00 = (int *)local_20.y;
					level = lego::game::GetLevel();
					FUN_00430460(level,(int)piVar7,(int)in_y_00,iVar10);
				}
				goto LAB_004704fa;
			}
		}
		BVar4 = lego::game::Level_IsBlockPowerPath(&local_20);
		if (BVar4 != 0) {
			FUN_00430250(&local_20,0x3f);
			lego::game::Level_UpdateBlockSurfaceUnk(lego::globals::g_Game.level,local_20.x,local_20.y);
		}
	}
LAB_004704fa:
	FUN_004375c0((LiveObject *)liveObj,iVar3,param_7);
	return param_1;
}



void __cdecl FUN_00470520(undefined4 *param_1,float *param_2,float *param_3,int param_4)
{
	ObjectStatsFlags1 OVar1;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags1((LiveObject *)param_1);
	if ((OVar1 & STATS1_COLLBOX) != STATS1_NONE) {
		FUN_00470570(param_1,param_2,param_3,NULL,param_4);
		return;
	}
	FUN_00470800(param_1,param_2,param_3,param_4);
	return;
}



undefined4 __cdecl
FUN_00470570(undefined4 *param_1,float *param_2,float *param_3,float *param_4,int param_5)
{
	float fVar1;
	ushort uVar2;
	ResourceData *pRVar3;
	int iVar4;
	float *pfVar5;
	Point2F *pPVar6;
	Point2F *pPVar7;
	uint uVar8;
	Point2F local_78;
	Point2F local_70;
	Point2F local_68;
	Point2F local_60;
	Point2F local_58;
	float local_50 [6];
	float local_38;
	float local_34;
	float local_30;
	undefined4 local_2c;
	float local_28;
	float local_24;
	undefined4 local_20;
	float local_1c;
	float local_18;
	undefined4 local_14;
	float local_10;
	float local_c;
	undefined4 local_8;
	float local_4;
	
	pRVar3 = lego::game::LiveObject_GetResource((LiveObject *)param_1);
	local_68.x = *param_2;
	local_68.y = param_2[1];
	local_70.x = *param_3;
	local_70.y = param_3[1];
	if ((param_5 != 0) &&
		 (iVar4 = FUN_004708f0(param_1,(float *)&local_68,(float *)&local_70), iVar4 != 0)) {
		return 0;
	}
	pfVar5 = (float *)lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
	local_30 = *pfVar5 * -0.5;
	iVar4 = lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
	local_28 = *(float *)(iVar4 + 4) * 0.5;
	pfVar5 = (float *)lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
	local_24 = *pfVar5 * 0.5;
	iVar4 = lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
	local_1c = *(float *)(iVar4 + 4) * 0.5;
	pfVar5 = (float *)lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
	local_18 = *pfVar5 * 0.5;
	iVar4 = lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
	local_10 = *(float *)(iVar4 + 4) * -0.5;
	pfVar5 = (float *)lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
	local_c = *pfVar5 * -0.5;
	iVar4 = lego::game::LiveObject_GetCollBox((LiveObject *)param_1);
	local_4 = *(float *)(iVar4 + 4) * -0.5;
	local_8 = 0;
	local_14 = 0;
	local_20 = 0;
	local_2c = 0;
	pPVar7 = &local_58;
	pfVar5 = &local_30;
	iVar4 = 4;
	do {
		FUN_00475330((int **)pRVar3,pfVar5,pfVar5);
		fVar1 = pfVar5[1];
		pPVar7->x = *pfVar5;
		pPVar7->y = fVar1;
		pfVar5 = pfVar5 + 3;
		pPVar7 = pPVar7 + 1;
		iVar4 += -1;
	} while (iVar4 != 0);
	local_38 = local_58.x;
	local_34 = local_58.y;
	uVar8 = 0;
	pPVar7 = &local_58;
	do {
		local_60.x = pPVar7->x - pPVar7[1].x;
		local_60.y = pPVar7->y - pPVar7[1].y;
		pPVar6 = lego::math::Vector2_UnkOperation5(&local_78,&local_68,&local_70,pPVar7,&local_60);
		if (pPVar6 != NULL) {
			if (ABS(pPVar7->x - pPVar7[1].x) <= ABS(pPVar7->y - pPVar7[1].y)) {
				if (((ushort)((ushort)(local_78.y < pPVar7->y) << 8 |
										 (ushort)(local_78.y == pPVar7->y) << 0xe) == 0) && (local_78.y < pPVar7[1].y))
				goto LAB_004707ca;
				if (local_78.y < pPVar7->y) {
					uVar2 = (ushort)(local_78.y < pPVar7[1].y) << 8 |
									(ushort)(local_78.y == pPVar7[1].y) << 0xe;
					goto joined_r0x004707b1;
				}
			}
			else {
				if (((ushort)((ushort)(local_78.x < pPVar7->x) << 8 |
										 (ushort)(local_78.x == pPVar7->x) << 0xe) == 0) && (local_78.x < pPVar7[1].x))
				goto LAB_004707ca;
				if (local_78.x < pPVar7->x) {
					uVar2 = (ushort)(local_78.x < pPVar7[1].x) << 8 |
									(ushort)(local_78.x == pPVar7[1].x) << 0xe;
joined_r0x004707b1:
					if (uVar2 == 0) {
LAB_004707ca:
						if (param_4 != NULL) {
							*param_4 = local_78.x;
							param_4[1] = local_78.y;
						}
						return 1;
					}
				}
			}
		}
		uVar8 += 1;
		pPVar7 = pPVar7 + 1;
		if (3 < uVar8) {
			return 0;
		}
	} while( true );
}



undefined4 __cdecl FUN_00470800(undefined4 *param_1,float *param_2,float *param_3,int param_4)
{
	int iVar1;
	float10 fVar2;
	float local_28;
	float local_24;
	float local_20;
	float local_1c;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	local_28 = *param_2;
	local_24 = param_2[1];
	local_20 = *param_3;
	local_1c = param_3[1];
	if ((param_4 != 0) && (iVar1 = FUN_004708f0(param_1,&local_28,&local_20), iVar1 != 0)) {
		return 0;
	}
	local_10 = local_20 + local_28;
	local_c = local_1c + local_24;
	lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_18,&local_14);
	FUN_00408a90(&local_28,&local_10,&local_18,&local_8);
	fVar2 = lego::game::LiveObject_GetCollRadius((LiveObject *)param_1);
	if (fVar2 <= (float10)SQRT((local_4 - local_14) * (local_4 - local_14) +
														 (local_8 - local_18) * (local_8 - local_18))) {
		return 0;
	}
	return 1;
}



undefined4 __cdecl FUN_004708f0(undefined4 *param_1,float *param_2,float *param_3)
{
	float local_8;
	float local_4;
	
	lego::game::LiveObject_GetPosition((LiveObject *)param_1,&local_8,&local_4);
	if ((local_8 - *param_2) * *param_3 + (local_4 - param_2[1]) * param_3[1] < 0.0) {
		return 1;
	}
	return 0;
}



void __cdecl FUN_00470950(ResourceData *resData,float *param_2,float *param_3)
{
	int iVar1;
	Struct_34 *pSVar2;
	
	iVar1 = FUN_00470250();
	if (iVar1 != -1) {
		pSVar2 = lego::res::Res_Unk_CreateUserVisualStruct34(resData->frame2,0,0x4400,0,0);
		(&DAT_0050487c)[iVar1 * 4] = pSVar2;
		pSVar2 = lego::res::Res_Unk_CreateUserVisualStruct34(resData->frame2,0,0x4400,0,0);
		(&DAT_00504880)[iVar1 * 4] = pSVar2;
		FUN_00470a20((int *)(&DAT_0050487c)[iVar1 * 4],0.3,param_2,param_3,0.6,0.6,0.6,1.0);
		FUN_00470a20((int *)(&DAT_00504880)[iVar1 * 4],1.0,param_2,param_3,0.1,0.2,0.5,1.0);
		(&DAT_00504884)[iVar1 * 4] = resData;
		(&DAT_00504888)[iVar1 * 4] = 0x40a00000;
	}
	return;
}



void __cdecl
FUN_00470a20(int *param_1,float param_2,float *param_3,float *param_4,float param_5,float param_6,
						float param_7,float param_8)
{
	float *pfVar1;
	float *pfVar2;
	float *pfVar3;
	float fVar4;
	float fVar5;
	float fVar6;
	float fVar7;
	float fVar8;
	float fVar9;
	float fVar10;
	float fVar11;
	float fVar12;
	float fVar13;
	float *pfVar14;
	int index;
	uint uVar15;
	uint uVar16;
	float local_404;
	float local_400;
	undefined4 local_3e0;
	undefined4 local_3dc;
	undefined4 local_3d8;
	undefined4 local_3d4;
	undefined4 local_3d0;
	undefined4 local_3cc;
	undefined4 local_3c8;
	undefined4 local_3c4;
	undefined4 local_3c0;
	undefined4 local_3bc;
	undefined4 local_3b8;
	undefined4 local_3b4;
	undefined4 local_3b0;
	undefined4 local_3ac;
	undefined4 local_3a8;
	undefined4 local_3a4;
	undefined4 local_3a0;
	undefined4 local_39c;
	undefined4 local_398;
	undefined4 local_394;
	undefined4 local_390;
	undefined4 local_38c;
	undefined4 local_388;
	undefined4 local_384;
	undefined4 local_380;
	undefined4 local_37c;
	undefined4 local_378;
	undefined4 local_374;
	undefined4 local_370;
	undefined4 local_36c;
	undefined4 local_368;
	undefined4 local_364;
	undefined4 local_360;
	undefined4 local_35c;
	undefined4 local_358;
	undefined4 local_354;
	undefined4 local_350;
	undefined4 local_34c;
	undefined4 local_348;
	undefined4 local_344;
	undefined4 local_340;
	undefined4 local_33c;
	undefined4 local_338;
	undefined4 local_334;
	undefined4 local_330;
	undefined4 local_32c;
	undefined4 local_328;
	undefined4 local_324;
	undefined4 local_320;
	undefined4 local_31c;
	undefined4 local_318;
	undefined4 local_314;
	undefined4 local_310;
	undefined4 local_30c;
	undefined4 local_308;
	undefined4 local_304;
	undefined4 local_300;
	undefined4 local_2fc;
	undefined4 local_2f8;
	undefined4 local_2f4;
	undefined4 local_2f0;
	undefined4 local_2ec;
	undefined4 local_2e8;
	undefined4 local_2e4;
	undefined4 local_2e0;
	undefined4 local_2dc;
	undefined4 local_2d8;
	undefined4 local_2d4;
	undefined4 local_2d0;
	undefined4 local_2cc;
	undefined4 local_2c8;
	undefined4 local_2c4;
	undefined4 local_2c0;
	undefined4 local_2bc;
	undefined4 local_2b8;
	undefined4 local_2b4;
	undefined4 local_2b0;
	undefined4 local_2ac;
	undefined4 local_2a8;
	undefined4 local_2a4;
	undefined4 local_2a0;
	undefined4 local_29c;
	undefined4 local_298;
	undefined4 local_294;
	undefined4 local_290;
	undefined4 local_28c;
	undefined4 local_288;
	undefined4 local_284;
	undefined4 local_280;
	undefined4 local_27c;
	undefined4 local_278;
	undefined4 local_274;
	undefined4 local_270;
	undefined4 local_26c;
	undefined4 local_268;
	undefined4 local_264;
	undefined4 local_260;
	undefined4 local_25c;
	undefined4 local_258;
	undefined4 local_254;
	undefined4 local_250;
	undefined4 local_24c;
	undefined4 local_248;
	undefined4 local_244;
	undefined4 local_240;
	undefined4 local_23c;
	undefined4 local_238;
	undefined4 local_234;
	undefined4 local_230;
	undefined4 local_22c;
	undefined4 local_228;
	undefined4 local_224;
	undefined4 local_220;
	undefined4 local_21c;
	undefined4 local_218;
	undefined4 local_214;
	undefined4 local_210;
	undefined4 local_20c;
	undefined4 local_208;
	undefined4 local_204;
	undefined4 local_200;
	undefined4 local_1fc;
	undefined4 local_1f8;
	undefined4 local_1f4;
	undefined4 local_1f0;
	undefined4 local_1ec;
	undefined4 local_1e8;
	undefined4 local_1e4;
	undefined4 local_1e0;
	undefined4 local_1dc;
	undefined4 local_1d8;
	undefined4 local_1d4;
	undefined4 local_1d0;
	undefined4 local_1cc;
	undefined4 local_1c8;
	undefined4 local_1c4;
	undefined4 local_1c0;
	undefined4 local_1bc;
	undefined4 local_1b8;
	undefined4 local_1b4;
	undefined4 local_1b0;
	undefined4 local_1ac;
	undefined4 local_1a8;
	undefined4 local_1a4;
	undefined4 local_1a0;
	undefined4 local_19c;
	undefined4 local_198;
	undefined4 local_194;
	undefined4 local_190;
	undefined4 local_18c;
	undefined4 local_188;
	undefined4 local_184;
	undefined4 local_180;
	undefined4 local_17c;
	undefined4 local_178;
	undefined4 local_174;
	undefined4 local_170;
	undefined4 local_16c;
	undefined4 local_168;
	undefined4 local_164;
	undefined4 local_160;
	undefined4 local_15c;
	undefined4 local_158;
	undefined4 local_154;
	undefined4 local_150;
	undefined4 local_14c;
	undefined4 local_148;
	undefined4 local_144;
	undefined4 local_140;
	undefined4 local_13c;
	undefined4 local_138;
	undefined4 local_134;
	undefined4 local_130;
	undefined4 local_12c;
	undefined4 local_128;
	undefined4 local_124;
	float local_120;
	float local_11c;
	float local_118;
	float local_114;
	float local_110;
	float local_10c;
	float local_108;
	float local_104;
	float local_100;
	float local_fc;
	float local_f8;
	float local_f4;
	float local_f0;
	float local_ec;
	float local_e8;
	float local_e4;
	float local_e0;
	float local_dc;
	float local_d8;
	float local_d4;
	float local_d0;
	float local_cc;
	float local_c8;
	float local_c4;
	float afStack192 [24];
	float local_60 [24];
	
	local_31c = 0x3f800000;
	local_310 = 0x3f800000;
	local_308 = 0x3f800000;
	local_304 = 0x3f800000;
	local_2fc = 0x3f800000;
	local_2f0 = 0x3f800000;
	local_2e8 = 0x3f800000;
	local_2e4 = 0x3f800000;
	local_2dc = 0x3f800000;
	local_2d0 = 0x3f800000;
	local_2c8 = 0x3f800000;
	local_2c4 = 0x3f800000;
	local_2bc = 0x3f800000;
	local_2b0 = 0x3f800000;
	local_2a8 = 0x3f800000;
	local_2a4 = 0x3f800000;
	local_29c = 0x3f800000;
	local_290 = 0x3f800000;
	local_288 = 0x3f800000;
	local_284 = 0x3f800000;
	local_27c = 0x3f800000;
	local_270 = 0x3f800000;
	local_268 = 0x3f800000;
	local_264 = 0x3f800000;
	local_25c = 0x3f800000;
	local_250 = 0x3f800000;
	local_248 = 0x3f800000;
	local_244 = 0x3f800000;
	local_23c = 0x3f800000;
	local_230 = 0x3f800000;
	local_228 = 0x3f800000;
	local_224 = 0x3f800000;
	local_21c = 0x3f800000;
	local_210 = 0x3f800000;
	local_208 = 0x3f800000;
	local_204 = 0x3f800000;
	local_1fc = 0x3f800000;
	local_320 = 0;
	local_318 = 0;
	local_314 = 0;
	local_30c = 0;
	local_300 = 0;
	local_2f8 = 0;
	local_2f4 = 0;
	local_2ec = 0;
	local_2e0 = 0;
	local_2d8 = 0;
	local_2d4 = 0;
	local_2cc = 0;
	local_2c0 = 0;
	local_2b8 = 0;
	local_2b4 = 0;
	local_2ac = 0;
	local_2a0 = 0;
	local_298 = 0;
	local_294 = 0;
	local_28c = 0;
	local_280 = 0;
	local_278 = 0;
	local_274 = 0;
	local_26c = 0;
	local_260 = 0;
	local_258 = 0;
	local_254 = 0;
	local_24c = 0;
	local_240 = 0;
	local_238 = 0;
	local_234 = 0;
	local_22c = 0;
	local_220 = 0;
	local_218 = 0;
	local_214 = 0;
	local_20c = 0;
	local_200 = 0;
	local_1f8 = 0;
	local_1f4 = 0;
	local_1f0 = 0x3f800000;
	local_1e8 = 0x3f800000;
	local_1e4 = 0x3f800000;
	local_1dc = 0x3f800000;
	local_1d0 = 0x3f800000;
	local_1c8 = 0x3f800000;
	local_1c4 = 0x3f800000;
	local_1bc = 0x3f800000;
	local_1b0 = 0x3f800000;
	local_1a8 = 0x3f800000;
	local_1a4 = 0x3f800000;
	local_19c = 0x3f800000;
	local_190 = 0x3f800000;
	local_188 = 0x3f800000;
	local_184 = 0x3f800000;
	local_17c = 0x3f800000;
	local_170 = 0x3f800000;
	local_168 = 0x3f800000;
	local_164 = 0x3f800000;
	local_15c = 0x3f800000;
	local_150 = 0x3f800000;
	local_148 = 0x3f800000;
	local_144 = 0x3f800000;
	local_13c = 0x3f800000;
	local_130 = 0x3f800000;
	local_128 = 0x3f800000;
	local_124 = 0x3f800000;
	local_3dc = 1;
	local_3d8 = 9;
	local_3d4 = 9;
	local_3c8 = 1;
	local_3c0 = 10;
	local_3bc = 10;
	local_3b8 = 9;
	local_3b4 = 1;
	local_3a0 = 10;
	local_1ec = 0;
	local_1e0 = 0;
	local_1d8 = 0;
	local_1d4 = 0;
	local_1cc = 0;
	local_1c0 = 0;
	local_1b8 = 0;
	local_1b4 = 0;
	local_1ac = 0;
	local_1a0 = 0;
	local_198 = 0;
	local_194 = 0;
	local_18c = 0;
	local_180 = 0;
	local_178 = 0;
	local_174 = 0;
	local_16c = 0;
	local_160 = 0;
	local_158 = 0;
	local_154 = 0;
	local_14c = 0;
	local_140 = 0;
	local_138 = 0;
	local_134 = 0;
	local_12c = 0;
	local_3e0 = 0;
	local_3d0 = 8;
	local_3cc = 0;
	local_3c4 = 2;
	local_3b0 = 2;
	local_3ac = 3;
	local_3a8 = 0xb;
	local_3a4 = 0xb;
	local_39c = 2;
	local_398 = 3;
	local_394 = 4;
	local_384 = 3;
	local_390 = 0xc;
	local_38c = 0xc;
	local_370 = 0xc;
	local_378 = 0xd;
	local_374 = 0xd;
	local_358 = 0xd;
	local_360 = 0xe;
	local_35c = 0xe;
	local_340 = 0xe;
	local_348 = 0xf;
	local_344 = 0xf;
	local_328 = 0xf;
	local_388 = 0xb;
	fVar7 = *param_4 - *param_3;
	fVar8 = param_4[1] - param_3[1];
	fVar5 = param_4[2] - param_3[2];
	local_380 = 4;
	local_36c = 4;
	local_37c = 5;
	local_368 = 5;
	local_364 = 6;
	local_354 = 5;
	local_350 = 6;
	local_34c = 7;
	local_33c = 6;
	local_338 = 7;
	local_334 = 0;
	local_330 = 8;
	local_32c = 8;
	local_324 = 7;
	fVar4 = 1.0 / SQRT(fVar5 * fVar5 + fVar8 * fVar8 + fVar7 * fVar7);
	fVar8 = fVar4 * fVar8;
	fVar5 = fVar4 * fVar5;
	if ((fVar8 == 0.0) && (fVar5 == 0.0)) {
		local_400 = 1.0;
		local_404 = 0.0;
	}
	else {
		if (fVar8 == 0.0) {
			local_404 = 1.0;
			local_400 = 0.0;
		}
		else {
			local_400 = SQRT(1.0 / ((fVar5 * fVar5) / (fVar8 * fVar8) - -1.0));
			local_404 = -((fVar5 / fVar8) * local_400);
		}
	}
	fVar6 = local_404 * param_2;
	fVar9 = local_400 * param_2;
	fVar5 = (local_400 * fVar8 - local_404 * fVar5) * param_2;
	fVar8 = -(local_400 * fVar4 * fVar7) * param_2;
	fVar7 = local_404 * fVar4 * fVar7 * param_2;
	fVar12 = fVar6 * 0.4142136;
	fVar4 = fVar5 * 0.4142136;
	fVar10 = fVar8 * 0.4142136;
	fVar11 = fVar7 * 0.4142136;
	fVar13 = fVar9 * 0.4142136;
	local_120 = fVar4 + 0.0;
	local_11c = fVar6 + fVar10;
	local_118 = fVar9 + fVar11;
	local_114 = fVar5 + 0.0;
	local_110 = fVar8 + fVar12;
	local_10c = fVar7 + fVar13;
	local_108 = fVar5 + -0.0;
	local_104 = fVar8 + -fVar12;
	local_100 = fVar7 + -fVar13;
	local_fc = fVar4 - 0.0;
	local_f8 = fVar10 - fVar6;
	local_f4 = fVar11 - fVar9;
	local_f0 = -0.0 - fVar4;
	local_ec = -fVar6 - fVar10;
	local_e8 = -fVar9 - fVar11;
	local_e4 = -0.0 - fVar5;
	local_e0 = -fVar12 - fVar8;
	local_dc = -fVar13 - fVar7;
	local_d8 = 0.0 - fVar5;
	local_d4 = fVar12 - fVar8;
	local_d0 = fVar13 - fVar7;
	local_cc = 0.0 - fVar4;
	local_c8 = fVar6 - fVar10;
	local_c4 = fVar9 - fVar11;
	pfVar14 = &local_120;
	uVar15 = 0;
	do {
		fVar4 = *param_4;
		pfVar3 = (float *)((int)local_60 + uVar15 + 8);
		fVar5 = *pfVar14;
		fVar7 = pfVar14[1];
		*(float *)((int)local_60 + uVar15) = *pfVar14;
		pfVar1 = pfVar14 + 1;
		fVar8 = pfVar14[2];
		uVar16 = uVar15 + 0xc;
		*(float *)((int)local_60 + uVar15 + 4) = fVar7;
		pfVar2 = pfVar14 + 2;
		*pfVar3 = fVar8;
		fVar7 = *(float *)((int)local_60 + uVar15 + 4);
		fVar8 = *pfVar3;
		*(float *)((int)afStack192 + uVar15) = fVar4 + fVar5;
		fVar9 = 1.0 / SQRT(*(float *)((int)local_60 + uVar15) * *(float *)((int)local_60 + uVar15) +
											 fVar8 * fVar8 + fVar7 * fVar7);
		*(float *)((int)afStack192 + uVar15 + 4) = *pfVar1 + param_4[1];
		fVar4 = *param_3;
		pfVar14[0x1a] = *pfVar2 + param_4[2];
		fVar5 = *(float *)((int)local_60 + uVar15);
		*pfVar14 = fVar4 + *pfVar14;
		fVar4 = *(float *)((int)local_60 + uVar15 + 4);
		fVar7 = *pfVar3;
		*pfVar1 = *pfVar1 + param_3[1];
		fVar8 = *pfVar2;
		fVar6 = param_3[2];
		*(float *)((int)local_60 + uVar15) = fVar9 * fVar5;
		*(float *)((int)local_60 + uVar15 + 4) = fVar9 * fVar4;
		*pfVar3 = fVar9 * fVar7;
		*pfVar2 = fVar8 + fVar6;
		pfVar14 = pfVar14 + 3;
		uVar15 = uVar16;
	} while (uVar16 < 0x60);
	index = FUN_004824e0((Struct_34 *)param_1,0x10,0x10,3,(undefined2 *)&local_3e0);
	FUN_00483530((Struct_34 *)param_1,index,param_5,param_6,param_7,3);
	FUN_004836e0((Struct_34 *)param_1,index,param_8,4);
	FUN_004828e0((int)param_1,index,0,0x10,(int)&local_120,local_60,&local_320);
	return;
}



int __cdecl FUN_00471580(int *param_1)
{
	if (*param_1 == 1) {
		return param_1[3] + 0x138;
	}
	if (*param_1 != 4) {
		return 0;
	}
	return param_1[6] + 0xa0;
}



float10 __cdecl FUN_004715b0(int *param_1,int param_2)
{
	int iVar1;
	
	iVar1 = FUN_00471580(param_1);
	return (float10)*(float *)(iVar1 + 0x98 + param_2 * 4);
}



void __cdecl FUN_004715d0(int *param_1,undefined4 param_2,int param_3)
{
	int iVar1;
	
	iVar1 = FUN_00471580(param_1);
	*(undefined4 *)(iVar1 + 0x98 + param_3 * 4) = param_2;
	return;
}



BOOL __cdecl FUN_004715f0(int param_1,int param_2,float param_3,float param_4,float param_5)
{
	float fVar1;
	
	fVar1 = *(float *)(param_2 + 8) * param_5 + *(float *)(param_1 + 8);
	if (((ushort)((ushort)(fVar1 < param_4) << 8 | (ushort)(fVar1 == param_4) << 0xe) != 0) &&
		 (param_4 - param_3 <= fVar1)) {
		return 1;
	}
	return 0;
}



undefined4 __cdecl FUN_00471630(LiveObject *param_1,LiveObject *param_2)
{
	float fVar1;
	LiveObject *pLVar2;
	LevelSurfaceMap *surfMap;
	BOOL BVar3;
	float10 fVar4;
	float fVar5;
	float fVar6;
	float fVar7;
	float fVar8;
	LiveObject *pLVar9;
	float local_28;
	char *local_24;
	float local_20;
	float local_1c;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	pLVar2 = param_2;
	local_8 = *(float *)param_2->customName;
	local_4 = *(float *)((int)param_2->customName + 4);
	local_28 = (float)param_2->vehicle->objIndex;
	local_24 = param_2->vehicle->WheelNullName;
	fVar1 = SQRT((float)local_24 * (float)local_24 + local_28 * local_28);
	if ((param_1 != (LiveObject *)param_2->rockMonster) &&
		 (((ushort)((ushort)(fVar1 < -1e-05) << 8 | (ushort)(fVar1 == -1e-05) << 0xe) != 0 ||
			(1e-05 <= fVar1)))) {
		lego::game::LiveObject_GetPosition(param_1,&local_18,&local_14);
		fVar5 = local_18;
		fVar7 = local_14;
		surfMap = lego::game::GetSurfaceMap();
		fVar4 = lego::game::SurfaceMap_UnkGetZ(surfMap,fVar5,fVar7);
		fVar5 = (float)fVar4;
		FUN_00408b20(&local_8,&local_28,&local_18,&local_10);
		local_18 = local_10 - local_18;
		local_14 = local_c - local_14;
		fVar4 = lego::game::LiveObject_GetCollRadius(param_1);
		if ((float10)SQRT(local_14 * local_14 + local_18 * local_18) <= fVar4) {
			local_20 = local_10 - local_8;
			local_1c = local_c - local_4;
			fVar7 = SQRT(local_1c * local_1c + local_20 * local_20);
			if (((ushort)((ushort)(fVar7 < -1e-05) << 8 | (ushort)(fVar7 == -1e-05) << 0xe) == 0) &&
				 (fVar7 < 1e-05)) {
				fVar8 = 0.0;
				fVar6 = fVar5;
				fVar4 = lego::game::LiveObject_GetCollHeight(param_1);
				BVar3 = FUN_004715f0((int)param_2->customName,(int)param_2->vehicle,(float)fVar4,fVar6,fVar8
														);
				if (BVar3 != 0) {
					param_2->objType = (ObjectType)param_1;
					param_2->objIndex = 0;
					param_2->miniFigure = (CreatureData *)0x1;
					return 0;
				}
			}
			param_2 = (LiveObject *)(fVar7 / fVar1);
			if (((((ushort)((ushort)(local_28 < -1e-05) << 8 | (ushort)(local_28 == -1e-05) << 0xe) != 0)
					 || (1e-05 <= local_28)) ||
					((ushort)((ushort)(local_20 < -1e-05) << 8 | (ushort)(local_20 == -1e-05) << 0xe) != 0))
				 || (1e-05 <= local_20)) {
				fVar1 = local_28 / local_20;
			}
			else {
				if ((((ushort)((ushort)((float)local_24 < -1e-05) << 8 |
											(ushort)((float)local_24 == -1e-05) << 0xe) == 0) && ((float)local_24 < 1e-05)
						) && (((ushort)((ushort)(local_1c < -1e-05) << 8 | (ushort)(local_1c == -1e-05) << 0xe)
									 == 0 && (local_1c < 1e-05)))) {
					return 0;
				}
				fVar1 = (float)local_24 / local_1c;
			}
			if (fVar1 < 0.0) {
				param_2 = (LiveObject *)((float)param_2 * -1.0);
			}
			if (((ushort)((ushort)((float)param_2 < 0.0) << 8 | (ushort)((float)param_2 == 0.0) << 0xe) ==
					 0) && ((float)param_2 < (float)pLVar2->objIndex)) {
				pLVar9 = param_2;
				fVar4 = lego::game::LiveObject_GetCollHeight(param_1);
				BVar3 = FUN_004715f0((int)pLVar2->customName,(int)pLVar2->vehicle,(float)fVar4,fVar5,
														 (float)pLVar9);
				if (BVar3 != 0) {
					pLVar2->objType = (ObjectType)param_1;
					pLVar2->objIndex = (int)param_2;
					pLVar2->miniFigure = (CreatureData *)0x1;
				}
			}
		}
	}
	return 0;
}



void __cdecl FUN_004718f0(undefined4 *param_1)
{
	float *pfVar1;
	float *pfVar2;
	LevelSurfaceMap *pLVar3;
	BOOL BVar4;
	uint uVar5;
	uint uVar6;
	uint uVar7;
	uint uVar8;
	uint uVar9;
	float fVar10;
	float fVar11;
	Vector3F *pVVar12;
	uint *puVar13;
	uint *puVar14;
	Vector3F *pVVar15;
	Vector3F *out_vector;
	uint local_34;
	uint local_30;
	uint local_2c;
	uint local_28;
	float local_24;
	float local_20;
	float local_1c;
	Vector3F local_18;
	float local_8;
	float local_4;
	
	lego::game::GetSurfaceMap();
	lego::game::GetSurfaceMap();
	puVar13 = &local_28;
	pfVar1 = (float *)param_1[3];
	pfVar2 = (float *)param_1[2];
	local_18.x = *pfVar1 + *pfVar2;
	local_18.y = pfVar2[1] + pfVar1[1];
	local_18.z = pfVar2[2] + pfVar1[2];
	puVar14 = &local_30;
	fVar11 = pfVar2[1];
	fVar10 = *pfVar2;
	pLVar3 = lego::game::GetSurfaceMap();
	BVar4 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
										(pLVar3,fVar10,fVar11,(int *)puVar13,(int *)puVar14);
	if (BVar4 == 0) {
		pLVar3 = lego::game::GetSurfaceMap();
		if ((uint)(pLVar3->smallDimensions).width <= local_28) {
			pLVar3 = lego::game::GetSurfaceMap();
			local_28 = (pLVar3->smallDimensions).width - 1;
		}
		pLVar3 = lego::game::GetSurfaceMap();
		if ((uint)(pLVar3->smallDimensions).height <= local_30) {
			pLVar3 = lego::game::GetSurfaceMap();
			local_30 = (pLVar3->smallDimensions).height - 1;
		}
	}
	puVar13 = &local_34;
	puVar14 = &local_2c;
	fVar11 = local_18.x;
	fVar10 = local_18.y;
	pLVar3 = lego::game::GetSurfaceMap();
	BVar4 = lego::game::SurfaceMap_ToBlockCoordinatesNoZ
										(pLVar3,fVar11,fVar10,(int *)puVar14,(int *)puVar13);
	if (BVar4 == 0) {
		pLVar3 = lego::game::GetSurfaceMap();
		if ((uint)(pLVar3->smallDimensions).width <= local_2c) {
			pLVar3 = lego::game::GetSurfaceMap();
			local_2c = (pLVar3->smallDimensions).width - 1;
		}
		pLVar3 = lego::game::GetSurfaceMap();
		if ((uint)(pLVar3->smallDimensions).height <= local_34) {
			pLVar3 = lego::game::GetSurfaceMap();
			local_34 = (pLVar3->smallDimensions).height - 1;
		}
	}
	uVar6 = local_2c;
	uVar5 = local_34;
	if (local_2c < local_28) {
		local_2c = local_28;
		local_28 = uVar6;
	}
	if (local_34 < local_30) {
		local_34 = local_30;
		local_30 = uVar5;
	}
	uVar5 = local_34;
	uVar6 = local_2c;
	uVar7 = local_28;
	uVar8 = local_30;
	if (local_28 <= local_2c) {
		do {
			uVar9 = uVar8;
			if (uVar8 <= uVar5) {
				do {
					pVVar15 = (Vector3F *)param_1[3];
					pVVar12 = (Vector3F *)param_1[2];
					out_vector = &local_18;
					uVar5 = uVar7;
					uVar6 = uVar8;
					pLVar3 = lego::game::GetSurfaceMap();
					BVar4 = FUN_004518a0(pLVar3,uVar5,uVar6,pVVar12,pVVar15,out_vector);
					if (BVar4 != 0) {
						pfVar1 = (float *)param_1[2];
						pfVar2 = (float *)param_1[3];
						local_8 = local_18.y - pfVar1[1];
						local_4 = local_18.z - pfVar1[2];
						local_24 = pfVar2[2];
						local_20 = *pfVar2;
						local_1c = SQRT(local_20 * local_20 + local_24 * local_24 + pfVar2[1] * pfVar2[1]);
						fVar11 = SQRT(local_4 * local_4 +
													local_8 * local_8 + (local_18.x - *pfVar1) * (local_18.x - *pfVar1)) /
										 local_1c;
						if (fVar11 < (float)param_1[1]) {
							param_1[1] = fVar11;
							param_1[4] = 1;
							*param_1 = 0;
						}
					}
					uVar8 += 1;
					uVar5 = local_34;
					uVar6 = local_2c;
					uVar9 = local_30;
				} while (uVar8 <= local_34);
			}
			uVar7 += 1;
			uVar8 = uVar9;
		} while (uVar7 <= uVar6);
	}
	return;
}



CreatureData * __cdecl
FUN_00471b20(char *param_1,VehicleData *param_2,undefined4 *param_3,undefined4 *param_4,
						CreatureData *param_5)
{
	ObjectType local_18;
	int local_14;
	char *local_10;
	VehicleData *local_c;
	CreatureData *local_8;
	CreatureData *local_4;
	
	local_18 = OBJECT_NONE;
	local_8 = NULL;
	local_14 = *param_4;
	local_10 = param_1;
	local_c = param_2;
	local_4 = param_5;
	FUN_00437a70(FUN_00471630,(LiveObject *)&local_18);
	FUN_004718f0(&local_18);
	*param_4 = local_14;
	*param_3 = local_18;
	return local_8;
}



undefined4 __cdecl FUN_00471b90(undefined4 *param_1,undefined4 *param_2)
{
	undefined4 *puVar1;
	undefined4 *puVar2;
	int iVar3;
	undefined4 local_28;
	float local_24;
	float local_20;
	float local_1c;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	puVar1 = param_1;
	local_28 = 0x3f800000;
	FUN_00471f60(param_1,(int)&local_24);
	puVar2 = param_2;
	FUN_00471f60(param_2,(int)&local_18);
	local_c = local_18 - local_24;
	local_8 = local_14 - local_20;
	local_4 = local_10 - local_1c;
	iVar3 = FUN_00471b20(&local_24,&local_c,&param_1,&local_28,puVar1);
	if ((iVar3 != 0) && (param_1 != puVar2)) {
		return 1;
	}
	return 0;
}



undefined4 __cdecl FUN_00471c20(undefined4 *param_1,undefined4 *param_2)
{
	LevelData *pLVar1;
	uint uVar2;
	char *pcVar3;
	undefined4 uVar4;
	float local_3c;
	float local_38;
	float local_34;
	float local_30;
	float local_2c;
	float local_28;
	float local_24;
	float local_20;
	float local_1c;
	undefined4 local_18;
	undefined4 local_14;
	float *local_10;
	float *local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_10 = &local_3c;
	local_c = &local_24;
	uVar4 = 0;
	pcVar3 = "SeeThroughWalls";
	local_18 = 0;
	local_14 = 0x3f800000;
	local_8 = 0;
	local_4 = 0;
	pLVar1 = lego::game::GetLevel();
	pcVar3 = lego::cfg::CFG_JoinPath(lego::globals::g_Game.CfgRootName,pLVar1->levelName,pcVar3,uVar4)
	;
	uVar2 = lego::cfg::CFG_GetPropertyBool(lego::globals::g_LegoCfgRoot_WeaponTypes,pcVar3);
	if (uVar2 != 0) {
		return 0;
	}
	FUN_00471f60(param_1,(int)&local_3c);
	FUN_00471f60(param_2,(int)&local_30);
	local_24 = local_30 - local_3c;
	local_20 = local_2c - local_38;
	local_1c = local_28 - local_34;
	FUN_004718f0(&local_18);
	return local_8;
}



undefined4 __cdecl FUN_00471ce0(int param_1,int param_2,int param_3)
{
	return *(undefined4 *)(param_1 + param_2 * 8 + param_3 * 4);
}



undefined4 __cdecl FUN_00471d00(int param_1,int param_2)
{
	return *(undefined4 *)(param_1 + 0x18 + param_2 * 4);
}



undefined4 __cdecl FUN_00471d10(int param_1,int param_2)
{
	return *(undefined4 *)(param_1 + 0x24 + param_2 * 4);
}



void __cdecl FUN_00471d20(int param_1,undefined4 *param_2,float param_3,int param_4,int param_5)
{
	int iVar1;
	undefined4 *puVar2;
	float fVar3;
	float fVar4;
	ResourceData *resData;
	ResourceData *resData1;
	Vector3F local_c;
	
	if (param_4 != 0) {
		puVar2 = (undefined4 *)(param_1 + 0x68 + param_5 * 0xc);
		*puVar2 = *param_2;
		puVar2[1] = param_2[1];
		puVar2[2] = param_2[2];
	}
	resData = (ResourceData *)FUN_00471d00(param_1,param_5);
	if ((resData != NULL) &&
		 ((ushort)((ushort)(param_3 < 1e-05) << 8 | (ushort)(param_3 == 1e-05) << 0xe) == 0)) {
		lego::res::Res_GetPosition(resData,NULL,&local_c);
		fVar3 = 5.0 / param_3;
		iVar1 = param_1 + param_5 * 0xc;
		local_c.x = *(float *)(iVar1 + 0x68) - local_c.x;
		local_c.y = *(float *)(iVar1 + 0x6c) - local_c.y;
		local_c.z = *(float *)(iVar1 + 0x70) - local_c.z;
		fVar4 = 1.0 / SQRT(local_c.z * local_c.z + local_c.y * local_c.y + local_c.x * local_c.x);
		*(float *)(iVar1 + 0x44) = *(float *)(iVar1 + 0x44) * fVar3;
		*(float *)(iVar1 + 0x48) = *(float *)(iVar1 + 0x48) * fVar3;
		*(float *)(iVar1 + 0x4c) = *(float *)(iVar1 + 0x4c) * fVar3;
		*(float *)(iVar1 + 0x44) = fVar4 * local_c.x + *(float *)(iVar1 + 0x44);
		*(float *)(iVar1 + 0x48) = fVar4 * local_c.y + *(float *)(iVar1 + 0x48);
		*(float *)(iVar1 + 0x4c) = fVar4 * local_c.z + *(float *)(iVar1 + 0x4c);
		fVar3 = 1.0 / SQRT(*(float *)(iVar1 + 0x44) * *(float *)(iVar1 + 0x44) +
											 *(float *)(iVar1 + 0x4c) * *(float *)(iVar1 + 0x4c) +
											 *(float *)(iVar1 + 0x48) * *(float *)(iVar1 + 0x48));
		*(float *)(iVar1 + 0x44) = *(float *)(iVar1 + 0x44) * fVar3;
		*(float *)(iVar1 + 0x48) = fVar3 * *(float *)(iVar1 + 0x48);
		*(float *)(iVar1 + 0x4c) = fVar3 * *(float *)(iVar1 + 0x4c);
		if ((ushort)((ushort)(*(float *)(iVar1 + 0x4c) < *(float *)(param_1 + 0x30)) << 8 |
								(ushort)(*(float *)(iVar1 + 0x4c) == *(float *)(param_1 + 0x30)) << 0xe) == 0) {
			*(undefined4 *)(iVar1 + 0x4c) = *(undefined4 *)(param_1 + 0x30);
		}
		resData1 = (ResourceData *)FUN_00471d10(param_1,param_5);
		if (resData1 != NULL) {
			lego::res::Res_SetFrameOrientation
								(resData1,NULL,*(float *)(iVar1 + 0x44),*(float *)(param_1 + (param_5 + 6) * 0xc),
								 0.0,0.0,0.0,-1.0);
		}
		lego::res::Res_SetFrameOrientation
							(resData,NULL,*(float *)(iVar1 + 0x44),*(float *)(param_1 + (param_5 + 6) * 0xc),
							 *(float *)(iVar1 + 0x4c),0.0,0.0,-1.0);
	}
	return;
}



void __cdecl FUN_00471f30(int param_1,undefined4 *param_2,int param_3)
{
	undefined4 *puVar1;
	
	puVar1 = (undefined4 *)(param_1 + 0x44 + param_3 * 0xc);
	*param_2 = *puVar1;
	param_2[1] = puVar1[1];
	param_2[2] = puVar1[2];
	return;
}



undefined4 __cdecl FUN_00471f60(undefined4 *param_1,int param_2)
{
	ResourceData *resData;
	float10 fVar1;
	
	resData = lego::game::LiveObject_GetResource((LiveObject *)param_1);
	lego::res::Res_GetPosition(resData,NULL,(Vector3F *)param_2);
	fVar1 = lego::game::LiveObject_GetCollHeight((LiveObject *)param_1);
	*(float *)(param_2 + 8) = (float)((float10)*(float *)(param_2 + 8) - fVar1 * (float10)0.5);
	return 1;
}



undefined4 __cdecl FUN_00471fa0(int *param_1)
{
	ObjectStatsFlags2 OVar1;
	BOOL BVar2;
	
	OVar1 = lego::game::LiveObject_GetStatsFlags2((LiveObject *)param_1);
	if ((OVar1 & STATS2_TRACKER) != STATS2_NONE) {
		BVar2 = FUN_00438870((LiveObject *)param_1,(uint)(*param_1 != 4));
		if (BVar2 != 0) {
			return 1;
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00471fe0(int *param_1,float param_2,float param_3)
{
	int *liveObj;
	float fVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	ResourceData *resData;
	LiveObject *liveObj_00;
	float10 fVar5;
	Vector3F *pVVar6;
	float fVar7;
	int iVar8;
	int **ppiVar9;
	float fVar10;
	int *piVar11;
	int *local_34;
	float local_30;
	int *local_2c;
	undefined4 local_28;
	int *local_24;
	undefined4 local_20;
	Vector3F local_18;
	Vector3F local_c;
	
	fVar1 = param_3;
	liveObj = param_1;
	lego::game::Game_GetVector_45c(&local_18);
	pVVar6 = &local_18;
	iVar8 = 1;
	fVar7 = param_2;
	fVar10 = param_3;
	iVar2 = FUN_00471580(param_1);
	FUN_00471d20(iVar2,(undefined4 *)pVVar6,fVar7,iVar8,(int)fVar10);
	iVar2 = lego::input::Input_GetBool_0076bb3c();
	if (((iVar2 != 0) && ((lego::globals::g_Game.flags2 & GAME2_MOUSE_INSIDEGAMEVIEW) != GAME2_NONE))
		 && (fVar5 = FUN_004715b0(param_1,(int)param_3),
				(ushort)((ushort)(fVar5 < (float10)0.0) << 8 | (ushort)(fVar5 == (float10)0.0) << 0xe) != 0)
		 ) {
		ppiVar9 = &local_34;
		uVar3 = lego::input::Input_GetMousePositionY();
		uVar4 = lego::input::Input_GetMousePositionX();
		iVar2 = FUN_0043b620(uVar4,uVar3,ppiVar9);
		if ((iVar2 == 0) || (local_34 != param_1)) {
			param_1 = NULL;
			do {
				iVar2 = lego::game::Level_GetCrystalCount(1);
				if (iVar2 != 0) {
					fVar7 = fVar1;
					piVar11 = param_1;
					iVar2 = FUN_00471580(liveObj);
					resData = (ResourceData *)FUN_00471ce0(iVar2,(int)fVar7,(int)piVar11);
					if (resData == NULL) {
						return 1;
					}
					iVar2 = FUN_00471580(liveObj);
					uVar3 = lego::game::Game_GetWeaponType
														(*(char **)(*(int *)(iVar2 + 0x8c + (int)fVar1 * 4) + 0xc));
					fVar5 = FUN_0046f430(uVar3);
					local_30 = (float)fVar5;
					fVar5 = lego::game::LiveObject_GetFunctionCoef((LiveObject *)liveObj);
					param_3 = (float)fVar5;
					if (fVar5 == (float10)0.0) {
						param_3 = 1.0;
					}
					if (param_1 == NULL) {
						fVar7 = fVar1;
						fVar5 = FUN_0046f3d0(uVar3);
						FUN_004715d0(liveObj,(float)fVar5,(int)fVar7);
						ppiVar9 = &local_24;
						fVar7 = fVar1;
						iVar2 = FUN_00471580(liveObj);
						FUN_00471f30(iVar2,ppiVar9,(int)fVar7);
						FUN_00428730(0);
					}
					lego::res::Res_GetPosition(resData,NULL,&local_c);
					liveObj_00 = (LiveObject *)
											 FUN_00470270((int **)&local_c,&local_24,liveObj,param_2,local_30,uVar3,
																		param_3);
					if (liveObj_00 != NULL) {
						local_2c = local_24;
						local_28 = local_20;
						FUN_0046f530(liveObj_00,uVar3,1,0.0,(float *)&local_2c);
						liveObj[0xf1] = (int)liveObj_00;
					}
				}
				param_1 = (int *)((int)param_1 + 1);
			} while (param_1 < (int *)0x2);
		}
	}
	return 1;
}



undefined4 __cdecl FUN_004721c0(int *param_1,float param_2,int param_3)
{
	ResourceData *resData;
	int iVar1;
	float *pfVar2;
	int iVar3;
	Vector3F local_30;
	Vector3F local_24;
	float local_18;
	float local_14;
	float local_10;
	Vector3F local_c;
	
	resData = lego::game::LiveObject_GetResource((LiveObject *)param_1);
	if (resData != NULL) {
		lego::res::Res_GetOrientation(resData,NULL,&local_30,&local_c);
		lego::res::Res_GetPosition(resData,NULL,&local_24);
		local_30.x = local_30.x * 10000.0;
		pfVar2 = &local_18;
		local_30.y = local_30.y * 10000.0;
		iVar3 = 1;
		local_30.z = local_30.z * 10000.0;
		local_18 = local_30.x + local_24.x;
		local_14 = local_30.y + local_24.y;
		local_10 = local_30.z + local_24.z;
		iVar1 = FUN_00471580(param_1);
		FUN_00471d20(iVar1,pfVar2,param_2,iVar3,param_3);
	}
	return 1;
}



undefined4 __cdecl FUN_00472280(int *param_1,float param_2)
{
	int iVar1;
	float fVar2;
	uint uVar3;
	
	if ((*(byte *)(param_1 + 0xfb) & 1) == 0) {
		uVar3 = 0;
		iVar1 = FUN_00471580(param_1);
		if (*(int *)(iVar1 + 0xa4) != 0) {
			do {
				FUN_004721c0(param_1,param_2,uVar3);
				uVar3 += 1;
				iVar1 = FUN_00471580(param_1);
			} while (uVar3 < *(uint *)(iVar1 + 0xa4));
		}
	}
	else {
		fVar2 = 0.0;
		iVar1 = FUN_00471580(param_1);
		if (*(int *)(iVar1 + 0xa4) != 0) {
			do {
				FUN_00471fe0(param_1,param_2,fVar2);
				fVar2 = (float)((int)fVar2 + 1);
				iVar1 = FUN_00471580(param_1);
			} while ((uint)fVar2 < (uint)*(float *)(iVar1 + 0xa4));
			return 1;
		}
	}
	return 1;
}



undefined4 __cdecl FUN_00472320(LiveObject *param_1,int param_2)
{
	if (param_1->field_3c4 == param_2) {
		param_1->field_3c4 = 0;
	}
	return 0;
}



undefined4 __cdecl FUN_00472340(undefined4 *param_1,undefined4 *param_2)
{
	uint uVar1;
	float10 fVar2;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	uVar1 = lego::game::LiveObject_GetEquippedBeam((LiveObject *)param_1);
	if (((param_1 != NULL) && (param_2 != NULL)) && (uVar1 != 0)) {
		fVar2 = FUN_0046f430(uVar1);
		FUN_00471f60(param_1,(int)&local_c);
		FUN_00471f60(param_2,(int)&local_18);
		if (SQRT((local_10 - local_4) * (local_10 - local_4) +
						 (local_14 - local_8) * (local_14 - local_8) +
						 (local_18 - local_c) * (local_18 - local_c)) < (float)fVar2) {
			return 1;
		}
	}
	return 0;
}



undefined4 __cdecl FUN_004723f0(undefined4 *param_1,undefined4 *param_2)
{
	uint uVar1;
	float10 fVar2;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	uVar1 = lego::game::LiveObject_GetEquippedBeam((LiveObject *)param_1);
	if (((param_1 != NULL) && (param_2 != NULL)) && (uVar1 != 0)) {
		fVar2 = lego::game::LiveObject_GetAwarenessRange((LiveObject *)param_1);
		FUN_00471f60(param_1,(int)&local_c);
		FUN_00471f60(param_2,(int)&local_18);
		if (SQRT((local_10 - local_4) * (local_10 - local_4) +
						 (local_14 - local_8) * (local_14 - local_8) +
						 (local_18 - local_c) * (local_18 - local_c)) < (float)fVar2) {
			return 1;
		}
	}
	return 0;
}



uint __thiscall FUN_004724a0(void *this,int *param_1)
{
	int **ppiVar1;
	int *piVar2;
	code **ppcVar3;
	int iVar4;
	int unaff_EBP;
	
	ppiVar1 = (int **)((int)this + 8);
	iVar4 = (**(code **)(*param_1 + 0x10))(param_1,&idl::MSPID_PrimaryVideo,ppiVar1);
	*(int *)((int)this + 4) = iVar4;
	if (-1 < iVar4) {
		iVar4 = (**(code **)**ppiVar1)
											(*ppiVar1,&idl::IID_IDirectDrawMediaStream,(int **)((int)this + 0xc));
		*(int *)((int)this + 4) = iVar4;
		if (-1 < iVar4) {
			piVar2 = *(int **)((int)this + 0xc);
			iVar4 = (**(code **)(*piVar2 + 0x34))(piVar2,0,0,0,(int **)((int)this + 0x18));
			*(int *)((int)this + 4) = iVar4;
			if (-1 < iVar4) {
				piVar2 = *(int **)((int)this + 0x18);
				iVar4 = (**(code **)(*piVar2 + 0x20))(piVar2,(code **)((int)this + 0x10),(int)this + 0x20);
				*(int *)((int)this + 4) = iVar4;
				if (-1 < iVar4) {
					ppcVar3 = *(code ***)(code **)((int)this + 0x10);
					iVar4 = (**(code **)*ppcVar3)(ppcVar3,&idl::IID_IDirectDrawSurface3,(int)this + 0x14);
					*(int *)((int)this + 4) = iVar4;
					if (-1 < iVar4) {
						iVar4 = (**(code **)(unaff_EBP + 0x1c))(param_1,1);
						*(int *)((int)this + 4) = iVar4;
						if (-1 < iVar4) {
							return CONCAT31((int3)((uint)iVar4 >> 8),1);
						}
					}
				}
			}
		}
	}
	(**(code **)(**ppiVar1 + 8))(*ppiVar1);
	(**(code **)(**(int **)((int)this + 0xc) + 8))(*(int **)((int)this + 0xc));
	(**(code **)(**(int **)((int)this + 0x18) + 8))(*(int **)((int)this + 0x18));
	(**(code **)(**(int **)((int)this + 0x10) + 8))(*(int **)((int)this + 0x10));
	return *(uint *)((int)this + 4) & 0xffffff00 | (uint)(-1 < (int)*(uint *)((int)this + 4));
}



uint FUN_00472570(undefined4 param_1,undefined4 param_2,undefined4 param_3)
{
	int iVar1;
	HRESULT HVar2;
	uint uVar3;
	int *piVar4;
	int *piVar5;
	int *local_20c [125];
	int **ppiStack24;
	LPCSTR pCStack16;
	
	HVar2 = CoCreateInstance((IID *)&idl::CLSID_AMMultiMediaStream,NULL,1,
													 (IID *)&idl::IID_IAMMultiMediaStream,local_20c);
	if (-1 < HVar2) {
		HVar2 = (**(code **)(*local_20c[0] + 0x30))(local_20c[0]);
		if (-1 < HVar2) {
			HVar2 = (**(code **)(*local_20c[0] + 0x3c))(local_20c[0],param_3);
			if (-1 < HVar2) {
				piVar5 = NULL;
				HVar2 = (**(code **)(*local_20c[0] + 0x3c))(local_20c[0]);
				if (HVar2 < 0) {
					HVar2 = 0;
				}
				MultiByteToWideChar(0,0,pCStack16,-1,(LPWSTR)&stack0xfffffde4,0x104);
				piVar4 = (int *)&stack0xfffffde4;
				(**(code **)(*piVar5 + 0x40))(piVar5,piVar4,0);
				iVar1 = *piVar4;
				*ppiStack24 = piVar4;
				(**(code **)(iVar1 + 4))(piVar4);
			}
		}
	}
	uVar3 = (**(code **)(*local_20c[0] + 8))();
	return uVar3 & 0xffffff00 | (uint)(-1 < HVar2);
}



int ** __thiscall lego::video::Avi_FUN_00472650(void *this,char *param_1,int *param_2,int *param_3)
{
	char cVar1;
	undefined4 *puVar2;
	int iVar3;
	uint uVar4;
	uint uVar5;
	undefined4 *puVar6;
	char *pcVar7;
	char *pcVar8;
	
	*(undefined4 *)((int)this + 8) = 0;
	*(undefined4 *)((int)this + 0xc) = 0;
	*(undefined4 *)((int)this + 0x10) = 0;
	*(undefined4 *)((int)this + 0x14) = 0;
	*(undefined4 *)((int)this + 0x18) = 0;
	*(int **)((int)this + 0x1c) = param_2;
	*(int **)((int)this + 0x34) = param_3;
	CoInitialize(NULL);
	if (param_1 != NULL) {
		iVar3 = -1;
		pcVar7 = param_1;
		do {
			if (iVar3 == 0) break;
			iVar3 += -1;
			cVar1 = *pcVar7;
			pcVar7 = pcVar7 + 1;
		} while (cVar1 != '\0');
		if (iVar3 != -2) {
			uVar4 = 0xffffffff;
			pcVar7 = param_1;
			do {
				if (uVar4 == 0) break;
				uVar4 -= 1;
				cVar1 = *pcVar7;
				pcVar7 = pcVar7 + 1;
			} while (cVar1 != '\0');
			puVar2 = (undefined4 *)std::malloc(~uVar4);
			uVar4 = 0xffffffff;
			*(undefined4 **)((int)this + 0x30) = puVar2;
			pcVar7 = param_1;
			do {
				pcVar8 = pcVar7;
				if (uVar4 == 0) break;
				uVar4 -= 1;
				pcVar8 = pcVar7 + 1;
				cVar1 = *pcVar7;
				pcVar7 = pcVar8;
			} while (cVar1 != '\0');
			uVar4 = ~uVar4;
			puVar6 = (undefined4 *)(pcVar8 + -uVar4);
			for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
				*puVar2 = *puVar6;
				puVar6 = puVar6 + 1;
				puVar2 = puVar2 + 1;
			}
			for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
				*(undefined *)puVar2 = *(undefined *)puVar6;
				puVar6 = (undefined4 *)((int)puVar6 + 1);
				puVar2 = (undefined4 *)((int)puVar2 + 1);
			}
			uVar4 = FUN_00472570(param_1,this,param_3);
			if ((char)uVar4 != '\0') {
										// WARNING: Load size is inaccurate
				FUN_004724a0(this,*this);
			}
		}
	}
	return (int **)this;
}



void __fastcall lego::video::Avi_Close_internal(int **param_1)
{
	int *piVar1;
	
	piVar1 = param_1[2];
	if (piVar1 != NULL) {
		(**(code **)(*piVar1 + 8))(piVar1);
	}
	piVar1 = param_1[3];
	if (piVar1 != NULL) {
		(**(code **)(*piVar1 + 8))(piVar1);
	}
	piVar1 = param_1[6];
	if (piVar1 != NULL) {
		(**(code **)(*piVar1 + 8))(piVar1);
	}
	piVar1 = param_1[4];
	if (piVar1 != NULL) {
		(**(code **)(*piVar1 + 8))(piVar1);
	}
	piVar1 = param_1[7];
	if (piVar1 != NULL) {
		(**(code **)(*piVar1 + 8))(piVar1);
	}
	piVar1 = param_1[0xd];
	if (piVar1 != NULL) {
		(**(code **)(*piVar1 + 8))(piVar1);
	}
	piVar1 = *param_1;
	if (piVar1 != NULL) {
		(**(code **)(*piVar1 + 8))(piVar1);
	}
	if (param_1[0xc] != NULL) {
		std::free(param_1[0xc]);
	}
	return;
}



uint __fastcall FUN_00472760(int **param_1)
{
	int iVar1;
	uint uVar2;
	int *piVar3;
	undefined4 uVar4;
	
	piVar3 = param_1[6];
	if (piVar3 != NULL) {
		uVar4 = 0;
		iVar1 = (**(code **)(*piVar3 + 0x18))(piVar3,0,0,0,0);
		if (iVar1 == 0) {
			uVar2 = (**(code **)(*param_1[7] + 0x14))(param_1[7],uVar4,param_1[5],0,0x1000000,0);
			return uVar2 & 0xffffff00 | (uint)(uVar2 == 0);
		}
		(**(code **)(*param_1[2] + 8))(param_1[2]);
		param_1[2] = NULL;
		(**(code **)(*param_1[3] + 8))(param_1[3]);
		param_1[3] = NULL;
		(**(code **)(*param_1[6] + 8))(param_1[6]);
		param_1[6] = NULL;
		(**(code **)(*param_1[4] + 8))(param_1[4]);
		piVar3 = *param_1;
		param_1[4] = NULL;
		if (piVar3 != NULL) {
			uVar2 = (**(code **)(*piVar3 + 8))(piVar3);
			*param_1 = NULL;
			return uVar2 & 0xffffff00;
		}
	}
	return (uint)piVar3 & 0xffffff00;
}



int ** __cdecl lego::video::Avi_Open(char *aviFilename)
{
	char *filename;
	IDirectDraw4 *This;
	IDirectDrawSurface4 *This_00;
	FILE *file;
	void *pvVar1;
	BOOL BVar2;
	int **ppiVar3;
	undefined4 *in_FS_OFFSET;
	GUID *pGVar4;
	LPVOID local_214 [124];
	undefined4 uStack36;
	undefined4 uStack28;
	undefined4 local_c;
	undefined *puStack8;
	undefined4 local_4;
	
	local_c = *in_FS_OFFSET;
	local_4 = 0xffffffff;
	puStack8 = &LAB_0049e06c;
	*in_FS_OFFSET = &local_c;
	filename = lego::file::Path_JoinDataDir(aviFilename);
	ppiVar3 = NULL;
	This = draw::Draw_GetDirectDraw();
	pGVar4 = &idl::IID_IDirectDraw2;
	(*This->lpVtbl->QueryInterface)((IUnknown *)This,(IID *)&idl::IID_IDirectDraw2,local_214);
	This_00 = draw::Draw_GetDrawingSurface();
	(*This_00->lpVtbl->QueryInterface)
						((IUnknown *)This_00,(IID *)&idl::IID_IDirectDrawSurface3,(LPVOID *)&stack0xfffffddc);
	file = std::fopen(filename,"r");
	if (file == NULL) {
		BVar2 = lego::file::Path_GetCDROMDataPath(&stack0xfffffddc,aviFilename);
		if (BVar2 == 0) goto LAB_0047290d;
		pvVar1 = Avi__malloc_inernal(0x38);
		uStack28 = 1;
		if (pvVar1 != NULL) {
			ppiVar3 = Avi_FUN_00472650(pvVar1,&stack0xfffffddc,(int *)This,(int *)pGVar4);
			goto LAB_0047290d;
		}
	}
	else {
		std::fclose(file);
		pvVar1 = Avi__malloc_inernal(0x38);
		uStack28 = 0;
		if (pvVar1 != NULL) {
			ppiVar3 = Avi_FUN_00472650(pvVar1,filename,(int *)This,(int *)pGVar4);
			goto LAB_0047290d;
		}
	}
	ppiVar3 = NULL;
LAB_0047290d:
	*in_FS_OFFSET = uStack36;
	return ppiVar3;
}



void __cdecl FUN_00472930(undefined4 *param_1)
{
	undefined4 *puVar1;
	int iVar2;
	undefined4 *unaff_retaddr;
	undefined4 local_6c [27];
	
	puVar1 = local_6c;
	for (iVar2 = 0x1b; iVar2 != 0; iVar2 += -1) {
		*puVar1 = 0;
		puVar1 = puVar1 + 1;
	}
	local_6c[0] = 0x6c;
	(**(code **)(*(int *)param_1[5] + 0x58))((int *)param_1[5],local_6c);
	*unaff_retaddr = local_6c[1];
	*param_1 = local_6c[0];
	return;
}



undefined8 __cdecl lego::video::Avi_FUN_00472980(int **param_1)
{
	int *piVar1;
	undefined8 uVar2;
	undefined local_8 [8];
	
	piVar1 = *param_1;
	(**(code **)(*piVar1 + 0x24))();
	uVar2 = __alldiv((uint)piVar1,(uint)local_8,10000,0);
	return uVar2;
}



BOOL __cdecl lego::video::Avi_FUN_00472990(int **param_1)
{
	uint uVar1;
	
	uVar1 = FUN_00472760(param_1);
	return (uint)((char)uVar1 != '\0');
}



void __cdecl lego::video::Avi_Close(int **param_1)
{
	if (param_1 != NULL) {
		Avi_Close_internal(param_1);
		FUN_0045ddb0((undefined *)param_1);
	}
	return;
}



ResourceData * __cdecl lego::pool::ReservedPool_ResourceData___Init(char *cfgRootName)
{
	ResourceData *pRVar1;
	int iVar2;
	ResourceData **ppRVar3;
	
	ppRVar3 = globals::ReservedPool_ResourceData___g_TABLE;
	for (iVar2 = 0x806; iVar2 != 0; iVar2 += -1) {
		*ppRVar3 = NULL;
		ppRVar3 = ppRVar3 + 1;
	}
	ppRVar3 = globals::ReservedPool_ResourceData___g_TABLE;
	for (iVar2 = 0x14; iVar2 != 0; iVar2 += -1) {
		*ppRVar3 = NULL;
		ppRVar3 = ppRVar3 + 1;
	}
	lego::globals::g_ResourceExts_TABLE[1] = "x";
	lego::globals::g_ResourceExts_TABLE[2] = "x";
	lego::globals::g_ResourceExts_TABLE[3] = "x";
	lego::globals::g_ResourceTypes_TABLE[0] = "NULL";
	lego::globals::g_ResourceTypes_TABLE[1] = "MESH";
	lego::globals::g_ResourceTypes_TABLE[2] = "FRAME";
	lego::globals::g_ResourceTypes_TABLE[3] = "ANIM";
	lego::globals::g_ResourceTypes_TABLE[7] = "LWS";
	lego::globals::g_ResourceTypes_TABLE[8] = "LWO";
	lego::globals::g_ResourceTypes_TABLE[4] = "ACT";
	lego::globals::g_ResourceTypes_TABLE[5] = NULL;
	lego::globals::g_ResourceExts_TABLE[0] = ____EMPTYSTR__;
	lego::globals::g_ResourceExts_TABLE[4] = "ae";
	lego::globals::g_ResourceExts_TABLE[5] = ____EMPTYSTR__;
	lego::globals::g_Resource_CfgRootName = cfgRootName;
	globals::ReservedPool_ResourceData___g_NEXT = NULL;
	globals::ReservedPool_ResourceData___g_COUNT = 0;
	globals::ReservedPool_ResourceData___g_INITFLAGS = RESMANAGER_ISINIT;
	lego::globals::g_Textures_COUNT = 0;
	lego::globals::g_SharedTextures = NULL;
	pRVar1 = ReservedPool_ResourceData___Next(NULL);
										// D3DRMSORT_NONE (0x1)
	globals::ReservedPool_ResourceData___g_ROOT = pRVar1;
	(*(code *)pRVar1->frame1->lpVtbl->SetSortMode)(pRVar1->frame1,1);
	return pRVar1;
}



void __cdecl lego::pool::ReservedPool_ResourceData___Cleanup(void)
{
	int iVar1;
	ResourceData *in_resData;
	byte bVar2;
	int iVar3;
	SharedTextureResource *pSVar4;
	ResourceData **ppRVar5;
	uint uVar6;
	
	bVar2 = 0;
	ppRVar5 = globals::ReservedPool_ResourceData___g_TABLE;
	do {
		if (*ppRVar5 != NULL) {
			iVar1 = 1 << (bVar2 & 0x1f);
			if (iVar1 != 0) {
				iVar3 = 0;
				do {
					in_resData = (ResourceData *)((int)&(*ppRVar5)->frame1 + iVar3);
					if ((in_resData != NULL) && (in_resData->pool_m_next == in_resData)) {
						ReservedPool_ResourceData___Release_internal(in_resData,1);
					}
					iVar3 += 0x2c;
					iVar1 += -1;
				} while (iVar1 != 0);
			}
			std::free(*ppRVar5);
		}
		ppRVar5 = ppRVar5 + 1;
		bVar2 += 1;
	} while (ppRVar5 < &globals::ReservedPool_ResourceData___g_NEXT);
	uVar6 = 0;
	globals::ReservedPool_ResourceData___g_NEXT = NULL;
	globals::ReservedPool_ResourceData___g_INITFLAGS = RESMANAGER_NONE;
	if (lego::globals::g_Textures_COUNT != 0) {
		pSVar4 = lego::globals::g_Textures_TABLE;
		do {
			if (pSVar4->name != NULL) {
				std::free(pSVar4->name);
			}
			uVar6 += 1;
			pSVar4 = pSVar4 + 1;
		} while (uVar6 < lego::globals::g_Textures_COUNT);
	}
	if (lego::globals::g_SharedTextures != NULL) {
		std::free(lego::globals::g_SharedTextures);
	}
	return;
}



void __cdecl lego::res::Res_SetSharedTextures(char *filepath)
{
	globals::g_SharedTextures = std::_strdup(filepath);
	return;
}



void __cdecl lego::res::Res_ToggleSoundCallback(BOOL state)
{
	if (state != 0) {
		pool::globals::ReservedPool_ResourceData___g_INITFLAGS =
				 pool::globals::ReservedPool_ResourceData___g_INITFLAGS | RESMANAGER_SOUNDCALLBACK;
		return;
	}
	pool::globals::ReservedPool_ResourceData___g_INITFLAGS =
			 pool::globals::ReservedPool_ResourceData___g_INITFLAGS & ~RESMANAGER_SOUNDCALLBACK;
	return;
}



void __cdecl lego::res::Res_SetDrawCallback(ResourceDrawCallback *callback,void *lpValue)
{
	globals::g_ResourceDrawCallback = callback;
	globals::g_ResourceDrawCallback_VALUE = lpValue;
	return;
}



void __cdecl lego::res::Res_SetSoundCallback(ResourceSoundCallback *callback,void *lpValue)
{
	globals::g_ResourceSoundCallback = callback;
	globals::g_ResourceSoundCallback_VALUE = lpValue;
	pool::globals::ReservedPool_ResourceData___g_INITFLAGS =
			 pool::globals::ReservedPool_ResourceData___g_INITFLAGS | RESMANAGER_SOUNDCALLBACK;
	return;
}



ResourceData * __cdecl lego::res::GetRoot(void)
{
	return pool::globals::ReservedPool_ResourceData___g_ROOT;
}



ResourceData * __cdecl lego::pool::ReservedPool_ResourceData___Next(ResourceData *param_1)
{
	ResourceData *resData;
	HRESULT HVar1;
	int iVar2;
	IDirect3DRMFrame3 *lpD3DRMFrame;
	IDirect3DRMFrame3 *lpD3DRMFrame_00;
	ResourceData *pRVar3;
	
	lpD3DRMFrame = NULL;
	lpD3DRMFrame_00 = NULL;
	if (param_1 != NULL) {
		lpD3DRMFrame = param_1->frame1;
		lpD3DRMFrame_00 = param_1->frame3;
	}
	if (globals::ReservedPool_ResourceData___g_NEXT == NULL) {
		ReservedPool_ResourceData___Alloc();
	}
	resData = globals::ReservedPool_ResourceData___g_NEXT;
	pRVar3 = globals::ReservedPool_ResourceData___g_NEXT;
	globals::ReservedPool_ResourceData___g_NEXT =
			 globals::ReservedPool_ResourceData___g_NEXT->pool_m_next;
	for (iVar2 = 0xb; iVar2 != 0; iVar2 += -1) {
		pRVar3->frame1 = NULL;
		pRVar3 = (ResourceData *)&pRVar3->frame2;
	}
	resData->pool_m_next = resData;
	HVar1 = (*lego::globals::g_IDirect3DRM3->lpVtbl->CreateFrame)
										(lego::globals::g_IDirect3DRM3,lpD3DRMFrame,(IDirect3DRMFrame3 **)resData);
	if (HVar1 == 0) {
		HVar1 = (*lego::globals::g_IDirect3DRM3->lpVtbl->CreateFrame)
											(lego::globals::g_IDirect3DRM3,resData->frame1,&resData->frame2);
		if (HVar1 == 0) {
			HVar1 = (*lego::globals::g_IDirect3DRM3->lpVtbl->CreateFrame)
												(lego::globals::g_IDirect3DRM3,lpD3DRMFrame_00,&resData->frame3);
			if (HVar1 == 0) {
				res::Res_InitResourceAppData
									(resData->frame1,resData,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
				res::Res_InitResourceAppData
									(resData->frame2,resData,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
				res::Res_InitResourceAppData
									(resData->frame3,resData,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
				return resData;
			}
		}
	}
	ReservedPool_ResourceData___Release(resData);
	return NULL;
}



void __cdecl lego::pool::ReservedPool_ResourceData___Release(ResourceData *resData)
{
	ReservedPool_ResourceData___Release_internal(resData,0);
	return;
}



void __cdecl
lego::pool::ReservedPool_ResourceData___Release_internal(ResourceData *in_resData,BOOL isCleanup)
{
	ActStruct_14 *pAVar1;
	ResourceType RVar2;
	ResourceSubdata *pRVar3;
	int *piVar4;
	ResourceData *resData;
	undefined **ppuVar5;
	void *pvVar6;
	IDirect3DRMFrame3 **ppIVar7;
	void **buffer;
	ActFrameResource *actFrameRes;
	IDirect3DRMFrame3 **in_ECX;
	int *unaff_EBP;
	void *pvVar8;
	IDirect3DRMFrame3 **buffer_00;
	int *unaff_EDI;
	IDirect3DRMFrame3 *This;
	IDirect3DRMFrame3 **local_4;
	
	resData = in_resData;
	local_4 = in_ECX;
	if (in_resData->resType != RESOURCE_unassigned) {
		FUN_004759d0(in_resData,NULL);
	}
	if (((resData->resType == RESOURCE_ACT) || (resData->resType == RESOURCE_ANIM)) &&
		 (pAVar1 = resData->actstruct_24, pAVar1 != NULL)) {
		if (isCleanup == 0) {
			pAVar1->isUsed = 0;
			return;
		}
		if ((void *)pAVar1->field_4 != NULL) {
			std::free((void *)pAVar1->field_4);
		}
		std::free(resData->actstruct_24);
	}
	RVar2 = resData->resType;
	if (RVar2 == RESOURCE_ACT) {
		ppuVar5 = FUN_00475d30(resData,0,0,0);
		pvVar6 = std::malloc((int)ppuVar5 * 4);
		isCleanup = (BOOL)pvVar6;
		ppIVar7 = (IDirect3DRMFrame3 **)std::malloc((int)ppuVar5 * 4);
		local_4 = ppIVar7;
		FUN_00475d30(resData,(int)ppIVar7,(int)pvVar6,0);
		buffer_00 = ppIVar7;
		if (ppuVar5 != NULL) {
			pvVar8 = (void *)((int)pvVar6 - (int)ppIVar7);
			do {
				res::Res_FreeActFrameResource(*(ActFrameResource **)((int)pvVar8 + (int)ppIVar7));
				FUN_004765b0((int *)*ppIVar7);
				res::Res_FreeResourceAppData(*ppIVar7);
				(*(*ppIVar7)->lpVtbl->Release)((IUnknown *)*ppIVar7);
				ppIVar7 = ppIVar7 + 1;
				ppuVar5 = (undefined **)((int)ppuVar5 + -1);
				pvVar6 = (void *)isCleanup;
				buffer_00 = local_4;
			} while (ppuVar5 != NULL);
		}
		std::free(pvVar6);
		std::free(buffer_00);
	}
	else {
		if (RVar2 == RESOURCE_MESH) {
			pRVar3 = resData->subdata_c;
			if (pRVar3 != NULL) {
				if (pRVar3->struct34_c == NULL) {
					buffer = (void **)(*pRVar3->mesh->lpVtbl->GetAppData)((IUnknown *)pRVar3->mesh);
					if (buffer != NULL) {
						pvVar6 = NULL;
						if (buffer[1] != NULL) {
							do {
								piVar4 = *(int **)((int)*buffer + (int)pvVar6 * 4);
								(*(code *)resData->frame2->lpVtbl->DeleteVisual)(resData->frame2,piVar4);
								(**(code **)(*piVar4 + 8))(piVar4);
								pvVar6 = (void *)((int)pvVar6 + 1);
							} while (pvVar6 < buffer[1]);
						}
						std::free(*buffer);
						std::free(buffer);
					}
				}
				else {
					FUN_00482390(pRVar3->struct34_c,resData->frame2);
				}
			}
		}
		else {
			if ((RVar2 == RESOURCE_ANIM) &&
				 (actFrameRes = res::Res_GetAppData_ActFrame(resData->frame2), actFrameRes != NULL)) {
				res::Res_FreeActFrameResource(actFrameRes);
			}
		}
	}
	FUN_00475f40(resData);
	if ((resData->resType != RESOURCE_unassigned) ||
		 ((*(byte *)&resData->flags & RESDATA_UNK_10) == 0)) {
		res::Res_FreeResourceAppData(resData->frame1);
	}
	if (resData->resType != RESOURCE_unassigned) {
		res::Res_FreeResourceAppData(resData->frame2);
	}
	res::Res_FreeResourceAppData(resData->frame3);
	if (resData->resType == RESOURCE_unassigned) {
		(*resData->frame3->lpVtbl->Release)((IUnknown *)resData->frame3);
	}
	else {
		This = resData->frame1;
		(*(code *)This->lpVtbl->GetParent)(This,&in_resData);
		if (local_4 != NULL) {
			(*(code *)(*local_4)[0x25].lpVtbl)(local_4,resData->frame1);
			(**(code **)(*unaff_EBP + 8))(unaff_EBP);
		}
		(*resData->frame1->lpVtbl->Release)((IUnknown *)resData->frame1);
		(*resData->frame2->lpVtbl->Release)((IUnknown *)resData->frame2);
		(*(code *)resData->frame3->lpVtbl->GetParent)(resData->frame3,&stack0xfffffff4);
		if (unaff_EDI != NULL) {
			(**(code **)(*unaff_EDI + 0x94))(unaff_EDI,resData->frame3);
			(*This->lpVtbl->Release)((IUnknown *)This);
		}
		(*resData->frame3->lpVtbl->Release)((IUnknown *)resData->frame3);
	}
	resData->pool_m_next = globals::ReservedPool_ResourceData___g_NEXT;
	globals::ReservedPool_ResourceData___g_NEXT = resData;
	return;
}



ResourceData * __cdecl
lego::res::Res_LoadResource
					(ResourceData *resRoot,char *filenameNoExt,char *resourceName,BOOL isLooping)
{
	char cVar1;
	ResourceType RVar2;
	int iVar3;
	CFGProperty *root;
	CFGProperty *prop;
	char *pcVar4;
	char *pcVar5;
	BOOL BVar6;
	ResourceData *pRVar7;
	byte *fileData;
	IDirect3DRMMesh *rmMesh;
	Struct_34 *unk_lwo;
	ActFrameResource *actFrameRes;
	uint uVar8;
	uint uVar9;
	undefined4 *puVar10;
	undefined4 *puVar11;
	float10 fVar12;
	ResourceData *local_864;
	undefined4 *local_860;
	char *local_85c;
	BOOL isNoTexture;
	int local_854;
	char filenameBuffer [512];
	char local_650 [508];
	char *apcStack1108 [21];
	char filename [512];
	char local_200 [512];
	
	local_864 = NULL;
	RVar2 = main::Main_GetResourceType(resourceName,&isNoTexture);
	uVar8 = 0xffffffff;
	do {
		pcVar4 = filenameNoExt;
		if (uVar8 == 0) break;
		uVar8 -= 1;
		pcVar4 = filenameNoExt + 1;
		cVar1 = *filenameNoExt;
		filenameNoExt = pcVar4;
	} while (cVar1 != '\0');
	uVar8 = ~uVar8;
	puVar10 = (undefined4 *)(pcVar4 + -uVar8);
	puVar11 = (undefined4 *)filename;
	for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
		*puVar11 = *puVar10;
		puVar10 = puVar10 + 1;
		puVar11 = puVar11 + 1;
	}
	for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
		*(undefined *)puVar11 = *(undefined *)puVar10;
		puVar10 = (undefined4 *)((int)puVar10 + 1);
		puVar11 = (undefined4 *)((int)puVar11 + 1);
	}
	if (RVar2 == RESOURCE_ACT) {
		uVar8 = 0xffffffff;
		pcVar4 = filename;
		do {
			pcVar5 = pcVar4;
			if (uVar8 == 0) break;
			uVar8 -= 1;
			pcVar5 = pcVar4 + 1;
			cVar1 = *pcVar4;
			pcVar4 = pcVar5;
		} while (cVar1 != '\0');
		uVar8 = ~uVar8;
		puVar10 = (undefined4 *)(pcVar5 + -uVar8);
		puVar11 = (undefined4 *)local_200;
		for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
			*puVar11 = *puVar10;
			puVar10 = puVar10 + 1;
			puVar11 = puVar11 + 1;
		}
		for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
			*(undefined *)puVar11 = *(undefined *)puVar10;
			puVar10 = (undefined4 *)((int)puVar10 + 1);
			puVar11 = (undefined4 *)((int)puVar11 + 1);
		}
		iVar3 = util::stringSplit(filename,apcStack1108 + 1,"\\");
		std::sprintf(filenameBuffer,"%s\\%s.%s",local_200,apcStack1108[iVar3],
								 globals::g_ResourceExts_TABLE[4]);
		root = cfg::CFG_Open(filenameBuffer);
		if (root != NULL) {
			std::sprintf(filenameBuffer,"%s%s%s",globals::g_Resource_CfgRootName,"::","Activities");
			prop = cfg::CFG_GetBlockFirstChild(root,filenameBuffer);
			if (prop != NULL) {
				local_864 = pool::ReservedPool_ResourceData___Next(resRoot);
				local_864->resType = RESOURCE_ACT;
				do {
					local_85c = prop->key;
					if (*local_85c == '!') {
						if ((globals::g_CMDLINE_FLAGS & CMD_REDUCEANIMATION) == CMD_NONE) {
							if (true) {
								local_85c = local_85c + 1;
							}
							goto LAB_004730ee;
						}
					}
					else {
LAB_004730ee:
						std::sprintf(local_650,"%s%s%s%s%s",globals::g_Resource_CfgRootName,"::",prop->value,
												 "::","FILE");
						pcVar4 = cfg::CFG_GetPropertyValue(root,local_650);
						if (pcVar4 != NULL) {
							std::sprintf(filenameBuffer,"%s\\%s",local_200,pcVar4);
							std::sprintf(local_650,"%s%s%s%s%s",globals::g_Resource_CfgRootName,"::",prop->value,
													 "::","TRANSCOEF");
							pcVar4 = cfg::CFG_GetPropertyValue(root,local_650);
							if (pcVar4 == NULL) {
								pcVar4 = ____EMPTYSTR__;
							}
							else {
								pcVar4 = cfg::CFG_GetPropertyValue(root,local_650);
							}
							fVar12 = std::atof(pcVar4);
							local_860 = (undefined4 *)(float)fVar12;
							std::sprintf(local_650,"%s%s%s%s%s",globals::g_Resource_CfgRootName,"::",prop->value,
													 "::","TRIGGER");
							pcVar4 = cfg::CFG_GetPropertyValue(root,local_650);
							if (pcVar4 == NULL) {
								pcVar4 = ____EMPTYSTR__;
							}
							else {
								pcVar4 = cfg::CFG_GetPropertyValue(root,local_650);
							}
							local_854 = std::atoi(pcVar4);
							std::sprintf(local_650,"%s%s%s%s%s",globals::g_Resource_CfgRootName,"::",prop->value,
													 "::","LWSFILE");
							uVar8 = cfg::CFG_GetPropertyBool(root,local_650);
							std::sprintf(local_650,"%s%s%s%s%s",globals::g_Resource_CfgRootName,"::",prop->value,
													 "::","LOOPING");
							uVar9 = cfg::CFG_GetPropertyBool(root,local_650);
							std::sprintf(local_650,"%s%s%s%s%s",globals::g_Resource_CfgRootName,"::",prop->value,
													 "::","SAMPLE");
							pcVar5 = cfg::CFG_CopyPropertyValue(root,local_650);
							pcVar4 = local_85c;
							BVar6 = Res_LoadActFrameResource
																(local_864,filenameBuffer,local_85c,local_860,local_854,(int)pcVar5,
																 NULL,(uint)(uVar8 == 1),(uint)(uVar9 != 0));
							if ((BVar6 != 0) && (local_864->subdata_c == NULL)) {
								Res_ResourceShortNormal_FUN_00473630(local_864,pcVar4);
							}
						}
					}
					prop = cfg::CFG_NextFlatProperty(prop);
				} while (prop != NULL);
			}
			std::sprintf(filenameBuffer,"%s%s%s",globals::g_Resource_CfgRootName,"::","SCALE");
			pcVar4 = cfg::CFG_GetPropertyValue(root,filenameBuffer);
			if (pcVar4 == NULL) {
				pcVar4 = ____EMPTYSTR__;
			}
			else {
				pcVar4 = cfg::CFG_GetPropertyValue(root,filenameBuffer);
			}
			fVar12 = std::atof(pcVar4);
			local_85c = (char *)(float)fVar12;
			if ((float)local_85c != 0.0) {
				(*(code *)local_864->frame2->lpVtbl->AddScale)
									(local_864->frame2,0,local_85c,local_85c,local_85c);
			}
			cfg::CFG_Close(root);
			return local_864;
		}
	}
	else {
		if (RVar2 == RESOURCE_FRAME) {
			pRVar7 = pool::ReservedPool_ResourceData___Next(resRoot);
			pRVar7->resType = RESOURCE_FRAME;
			std::sprintf(filenameBuffer,"%s.%s",filename,globals::g_ResourceExts_TABLE[2]);
			Res_CreateFrame(filenameBuffer,pRVar7->frame2);
			return pRVar7;
		}
		if (RVar2 == RESOURCE_MESH) {
			std::sprintf(filenameBuffer,"%s.%s",filename,globals::g_ResourceExts_TABLE[1]);
			fileData = lego::file::File_ReadAllBytes(filenameBuffer,(uint *)&local_860);
			if (fileData != NULL) {
				pRVar7 = pool::ReservedPool_ResourceData___Next(resRoot);
				pRVar7->resType = RESOURCE_MESH;
				rmMesh = Res_CreateMesh(fileData,(uint)local_860,filenameBuffer,pRVar7->frame2,isNoTexture);
				if (rmMesh != NULL) {
					Res_InitResourceSubdata(pRVar7,NULL,NULL,rmMesh,NULL);
				}
				std::free(fileData);
				return pRVar7;
			}
		}
		else {
			if ((RVar2 == RESOURCE_ANIM) || (RVar2 == RESOURCE_LWS)) {
				pRVar7 = pool::ReservedPool_ResourceData___Next(resRoot);
				pRVar7->resType = RESOURCE_ANIM;
				std::sprintf(filenameBuffer,"%s.%s",filename,globals::g_ResourceExts_TABLE[3]);
				actFrameRes = Res_ReadActFrameResource
																(filenameBuffer,pRVar7->frame2,(uint *)&local_860,
																 (uint)(RVar2 == RESOURCE_LWS),isLooping);
				if (actFrameRes != NULL) {
					Res_InitResourceAppData
										(pRVar7->frame2,pRVar7,actFrameRes,filename,(int *)&local_860,NULL,NULL,NULL,
										 NULL,NULL,NULL);
					return pRVar7;
				}
			}
			else {
				if (RVar2 != RESOURCE_LWO) {
					return NULL;
				}
				pRVar7 = pool::ReservedPool_ResourceData___Next(resRoot);
				pRVar7->resType = RESOURCE_LWO;
				unk_lwo = (Struct_34 *)Res_CreateLWO(filename,pRVar7->frame2,isNoTexture);
				if (unk_lwo != NULL) {
					Res_InitResourceSubdata(pRVar7,NULL,NULL,NULL,unk_lwo);
					return pRVar7;
				}
			}
			pool::ReservedPool_ResourceData___Release(pRVar7);
		}
	}
	return NULL;
}



BOOL __cdecl FUN_00473600(ResourceData *resData,char *param_2)
{
	IDirect3DRMFrame3 *pIVar1;
	
	if (resData->resType == RESOURCE_ACT) {
		pIVar1 = lego::res::Res_GetActFrameChildByName(resData,param_2,0);
		if (pIVar1 != NULL) {
			return 1;
		}
	}
	return 0;
}



BOOL __cdecl
lego::res::Res_ResourceShortNormal_FUN_00473630(ResourceData *resData,char *activityName)
{
	char cVar1;
	IDirect3DRMFrame3 *frame2;
	IDirect3DRMFrame3 *frame2_00;
	undefined4 *name;
	uint uVar2;
	uint uVar3;
	char *buffer;
	BOOL BVar4;
	undefined4 *puVar5;
	char *pcVar6;
	undefined4 *puVar7;
	
	BVar4 = 0;
	if (resData->resType == RESOURCE_ACT) {
		frame2 = Res_GetActFrameChildByName(resData,activityName,1);
		if (frame2 == NULL) {
			BVar4 = 0;
		}
		else {
			buffer = NULL;
			if (((resData->subdata_c != NULL) && (pcVar6 = resData->subdata_c->name, pcVar6 != NULL)) &&
				 (frame2_00 = Res_GetActFrameChildByName(resData,pcVar6,0), buffer = pcVar6,
				 frame2_00 != NULL)) {
				Res_AddTransform3DFrame(resData->frame3,frame2_00);
			}
			Res_AddTransform3DFrame(resData->frame2,frame2);
			uVar2 = 0xffffffff;
			pcVar6 = activityName;
			do {
				if (uVar2 == 0) break;
				uVar2 -= 1;
				cVar1 = *pcVar6;
				pcVar6 = pcVar6 + 1;
			} while (cVar1 != '\0');
			name = (undefined4 *)std::malloc(~uVar2);
			uVar2 = 0xffffffff;
			do {
				pcVar6 = activityName;
				if (uVar2 == 0) break;
				uVar2 -= 1;
				pcVar6 = activityName + 1;
				cVar1 = *activityName;
				activityName = pcVar6;
			} while (cVar1 != '\0');
			uVar2 = ~uVar2;
			puVar5 = (undefined4 *)(pcVar6 + -uVar2);
			puVar7 = name;
			for (uVar3 = uVar2 >> 2; uVar3 != 0; uVar3 -= 1) {
				*puVar7 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar7 = puVar7 + 1;
			}
			for (uVar2 &= 3; uVar2 != 0; uVar2 -= 1) {
				*(undefined *)puVar7 = *(undefined *)puVar5;
				puVar5 = (undefined4 *)((int)puVar5 + 1);
				puVar7 = (undefined4 *)((int)puVar7 + 1);
			}
			Res_InitResourceSubdata(resData,(char *)name,NULL,NULL,NULL);
			BVar4 = 1;
			resData->flags = resData->flags | RESDATA_UNK_2;
			if (buffer != NULL) {
				std::free(buffer);
			}
		}
		if ((code *)resData->field_18 != NULL) {
			(*(code *)resData->field_18)(resData,resData->field_1c);
		}
	}
	return BVar4;
}



BOOL __cdecl lego::res::Res_SetLightPenumbra(ResourceData *resData,float penumbra)
{
	IDirect3DRMLight *pIVar1;
	int iVar2;
	
	pIVar1 = resData->subdata_c->light;
	iVar2 = (*(code *)pIVar1->lpVtbl->SetPenumbra)(pIVar1,penumbra);
	return (uint)(iVar2 == 0);
}



BOOL __cdecl lego::res::Res_SetLightUmbra(ResourceData *resData,float umbra)
{
	IDirect3DRMLight *pIVar1;
	int iVar2;
	
	pIVar1 = resData->subdata_c->light;
	iVar2 = (*(code *)pIVar1->lpVtbl->SetUmbra)(pIVar1,umbra);
	return (uint)(iVar2 == 0);
}



BOOL __cdecl lego::res::Res_SetLightRange(ResourceData *resData,float range)
{
	IDirect3DRMLight *pIVar1;
	int iVar2;
	
	pIVar1 = resData->subdata_c->light;
	iVar2 = (*(code *)pIVar1->lpVtbl->SetRange)(pIVar1,range);
	return (uint)(iVar2 == 0);
}



void __cdecl FUN_00473780(ResourceData *param_1,undefined **param_2)
{
	int *piVar1;
	GUID *pGVar2;
	undefined ***pppuVar3;
	
	pppuVar3 = &param_2;
	pGVar2 = &idl::IID_IDirect3DRMFrame;
	(***(code ***)*param_2)(*param_2,&idl::IID_IDirect3DRMFrame,pppuVar3);
	piVar1 = *(int **)(*(int *)&pGVar2->field_0xc + 4);
	(**(code **)(*piVar1 + 0x70))(piVar1,pppuVar3);
	return;
}



ResourceData * __cdecl
lego::res::Res_CreateLight
					(ResourceData *in_resData,D3DRMLightType lightType,float red,float green,float blue)
{
	ResourceData *resData;
	int iVar1;
	IDirect3DRM3 *rmLight;
	float fVar2;
	
	resData = pool::ReservedPool_ResourceData___Next(in_resData);
	if (resData != NULL) {
		resData->resType = RESOURCE_LIGHT;
										// IDirect3DRM3->CreateLightRGB(this, TD3DRMLightType ltLightType, float vRed,
										// float vGreen, float vBlue, IDirect3DRMLight** lplpD3DRMLight)
		rmLight = globals::g_IDirect3DRM3;
		fVar2 = red;
		iVar1 = (*(code *)globals::g_IDirect3DRM3->lpVtbl->CreateLightRGB)
											(globals::g_IDirect3DRM3,lightType,red,green,blue,&in_resData);
		if (iVar1 == 0) {
										// IDirect3DRMFrame3->AddLight(this, IDirect3DRMLight* lpD3DRMLight)
			(*(code *)resData->frame2->lpVtbl->AddLight)(resData->frame2,fVar2);
			Res_InitResourceSubdata(resData,NULL,(IDirect3DRMLight *)rmLight,NULL,NULL);
		}
	}
	return resData;
}



ResourceData * __cdecl lego::res::Res_Unk_LoadVisualMesh(ResourceData *in_resData,int unkMode)
{
	int iVar1;
	ResourceData *resData;
	int iVar2;
	void **data;
	void *pvVar3;
	undefined4 unkFlags;
	Struct_34 *unk_lwo;
	undefined4 unaff_ESI;
	IDirect3DRMMesh *rmMesh;
	
	resData = pool::ReservedPool_ResourceData___Next(in_resData);
	iVar1 = unkMode;
	if (resData != NULL) {
		resData->resType = RESOURCE_MESH;
		if (((unkMode == 3) || (unkMode == 2)) || (unkMode == 4)) {
			unkFlags = 0x2000;
			if (unkMode == 3) {
				unkFlags = 0x3000;
			}
			else {
				if (unkMode == 4) {
					unkFlags = 0x2800;
				}
			}
			unk_lwo = Res_Unk_CreateUserVisualStruct34(resData->frame2,0,unkFlags,0,0);
			Res_InitResourceSubdata(resData,NULL,NULL,NULL,unk_lwo);
		}
		else {
			rmMesh = (IDirect3DRMMesh *)&in_resData;
			iVar2 = (*(code *)globals::g_IDirect3DRM3->lpVtbl->CreateMesh)(globals::g_IDirect3DRM3);
			if (iVar2 == 0) {
				(*(code *)resData->frame2->lpVtbl->AddVisual)(resData->frame2,unaff_ESI);
				Res_InitResourceSubdata(resData,NULL,NULL,rmMesh,NULL);
				if (iVar1 == 1) {
					data = (void **)std::malloc(0x14);
					data[2] = &DAT_00000014;
					data[1] = NULL;
					pvVar3 = std::malloc(0x50);
					*data = pvVar3;
					data[3] = NULL;
					data[4] = (void *)0x1;
					(*rmMesh->lpVtbl->SetAppData)((IUnknown *)rmMesh,(DWORD)data);
					return resData;
				}
				(*rmMesh->lpVtbl->SetAppData)((IUnknown *)rmMesh,0);
				return resData;
			}
		}
	}
	return resData;
}



IDirect3DRMFrame3 * __cdecl lego::res::Res_GetFrame1(ResourceData *resData)
{
	return resData->frame1;
}



// WARNING: Type propagation algorithm not settling

ResourceData * __cdecl lego::res::Res_DuplicateResource(ResourceData *in_resData)
{
	char cVar1;
	IDirect3DRMMesh *pIVar2;
	ResourceSubdata *pRVar3;
	ResourceType RVar4;
	undefined **ppuVar5;
	ResourceData *pRVar6;
	ResourceData *pRVar7;
	int *piVar8;
	void *pvVar9;
	ResourceSubdata *pRVar10;
	char *pcVar11;
	ActStruct_14 *pAVar12;
	undefined **ppuVar13;
	IDirect3DRMFrame3 **buffer;
	void *buffer_00;
	char *pcVar14;
	ActFrameResource *pAVar15;
	int iVar16;
	Struct_34 *pSVar17;
	uint uVar18;
	uint uVar19;
	ResourceData *resData;
	undefined4 *puVar20;
	IDirect3DRMFrame3 **ppIVar21;
	ResourceData *pRVar22;
	undefined4 *puVar23;
	float10 fVar24;
	IDirect3DRMFrame3 *pIVar25;
	void *pvVar26;
	IDirect3DRMFrame3 **ppIVar27;
	undefined local_54 [12];
	undefined local_48 [40];
	undefined **ppuStack32;
	int *piStack28;
	undefined4 uStack4;
	
	resData = in_resData;
	pRVar22 = NULL;
	if (in_resData->resType == RESOURCE_MESH) {
		pIVar2 = in_resData->subdata_c->mesh;
		(*pIVar2->lpVtbl->GetAppData)((IUnknown *)pIVar2);
	}
	if ((resData->resType == RESOURCE_ACT) || (resData->resType == RESOURCE_ANIM)) {
		if ((resData->actstruct_24 != NULL) && (pRVar6 = resData->actstruct_24->resData, pRVar6 != NULL)
			 ) {
			resData = pRVar6;
		}
		pAVar12 = resData->actstruct_24;
		if (pAVar12 == NULL) {
			pRVar6 = FUN_00475a60(resData);
			pRVar6 = pool::ReservedPool_ResourceData___Next(pRVar6);
			pAVar12 = (ActStruct_14 *)std::malloc(0x14);
			resData->actstruct_24 = pAVar12;
			pAVar12->field_8 = 1;
			pvVar9 = std::malloc(4);
			resData->actstruct_24->field_4 = pvVar9;
			((ResourceData *)resData->actstruct_24->field_4)->frame1 = (IDirect3DRMFrame3 *)pRVar6;
			resData->actstruct_24->resData = NULL;
			resData->actstruct_24->frame = NULL;
			resData->actstruct_24->isUsed = 1;
		}
		else {
			pRVar6 = resData;
			if (pAVar12->isUsed != 0) {
				uVar18 = 0;
				pRVar6 = pRVar22;
				if (pAVar12->field_8 != 0) {
					pRVar7 = (ResourceData *)pAVar12->field_4;
					do {
						pRVar6 = *(ResourceData **)pRVar7;
						if ((pRVar6 != NULL) && (pRVar6->actstruct_24->isUsed == 0)) break;
						uVar18 += 1;
						pRVar7 = (ResourceData *)((int)pRVar7 + 4);
						pRVar6 = pRVar22;
					} while (uVar18 < (uint)pAVar12->field_8);
				}
			}
			pRVar22 = pRVar6;
			if (pRVar6 == NULL) {
				pRVar6 = FUN_00475a60(resData);
				pRVar6 = pool::ReservedPool_ResourceData___Next(pRVar6);
				iVar16 = resData->actstruct_24->field_8;
				resData->actstruct_24->field_8 = iVar16 + 1;
				piVar8 = FUN_0048df40((LwoFrame *)resData->actstruct_24->field_4,
															resData->actstruct_24->field_8 << 2);
				resData->actstruct_24->field_4 = piVar8;
				*(ResourceData **)(resData->actstruct_24->field_4 + iVar16 * 4) = pRVar6;
			}
			else {
				pRVar6->actstruct_24->isUsed = 1;
				pRVar7 = FUN_00475a60(resData);
				FUN_004759d0(pRVar6,pRVar7);
				Res_DoCallbacks(pRVar6,0.0);
			}
		}
	}
	else {
		pRVar6 = FUN_00475a60(resData);
		pRVar6 = pool::ReservedPool_ResourceData___Next(pRVar6);
	}
	(*(code *)resData->frame2->lpVtbl->GetParent)(resData->frame2,&in_resData);
	pIVar25 = resData->frame2;
	(*(code *)pIVar25->lpVtbl->GetTransform)(pIVar25,uStack4,local_48);
	(*(code *)pRVar6->frame2->lpVtbl->AddTransform)(pRVar6->frame2,0,local_54);
	(**(code **)(*piStack28 + 8))(piStack28);
	if (pRVar22 == NULL) {
		pRVar6->resType = resData->resType;
		if (resData->subdata_c == NULL) {
			pRVar6->subdata_c = NULL;
		}
		else {
			pRVar10 = (ResourceSubdata *)std::malloc(0x10);
			pRVar6->subdata_c = pRVar10;
			pRVar3 = resData->subdata_c;
			pRVar10->name = pRVar3->name;
			pRVar10->light = pRVar3->light;
			pRVar10->mesh = pRVar3->mesh;
			pRVar10->struct34_c = pRVar3->struct34_c;
			pcVar11 = resData->subdata_c->name;
			if (pcVar11 != NULL) {
				uVar18 = 0xffffffff;
				do {
					if (uVar18 == 0) break;
					uVar18 -= 1;
					cVar1 = *pcVar11;
					pcVar11 = pcVar11 + 1;
				} while (cVar1 != '\0');
				pcVar11 = (char *)std::malloc(~uVar18);
				pRVar6->subdata_c->name = pcVar11;
				uVar18 = 0xffffffff;
				pcVar11 = resData->subdata_c->name;
				do {
					pcVar14 = pcVar11;
					if (uVar18 == 0) break;
					uVar18 -= 1;
					pcVar14 = pcVar11 + 1;
					cVar1 = *pcVar11;
					pcVar11 = pcVar14;
				} while (cVar1 != '\0');
				uVar18 = ~uVar18;
				puVar20 = (undefined4 *)(pcVar14 + -uVar18);
				puVar23 = (undefined4 *)pRVar6->subdata_c->name;
				for (uVar19 = uVar18 >> 2; uVar19 != 0; uVar19 -= 1) {
					*puVar23 = *puVar20;
					puVar20 = puVar20 + 1;
					puVar23 = puVar23 + 1;
				}
				for (uVar18 &= 3; uVar18 != 0; uVar18 -= 1) {
					*(undefined *)puVar23 = *(undefined *)puVar20;
					puVar20 = (undefined4 *)((int)puVar20 + 1);
					puVar23 = (undefined4 *)((int)puVar23 + 1);
				}
			}
		}
		if ((resData->resType == RESOURCE_ACT) || (resData->resType == RESOURCE_ANIM)) {
			pAVar12 = (ActStruct_14 *)std::malloc(0x14);
			pRVar6->actstruct_24 = pAVar12;
			pAVar12->field_4 = 0;
			pRVar6->actstruct_24->field_8 = 0;
			pRVar6->actstruct_24->resData = resData;
			pRVar6->actstruct_24->frame = pIVar25;
			pRVar6->actstruct_24->isUsed = 1;
		}
		RVar4 = pRVar6->resType;
		if (RVar4 == RESOURCE_MESH) {
			pIVar2 = pRVar6->subdata_c->mesh;
			(*(code *)pRVar6->frame2->lpVtbl->AddVisual)(pRVar6->frame2,pIVar2);
			(*pIVar2->lpVtbl->AddRef)((IUnknown *)pIVar2);
			return pRVar6;
		}
		if (RVar4 == RESOURCE_ACT) {
			ppuVar13 = FUN_00475d30(resData,0,0,0);
			uVar18 = (int)ppuVar13 * 4;
			buffer = (IDirect3DRMFrame3 **)std::malloc(uVar18);
			ppIVar27 = buffer;
			buffer_00 = std::malloc(uVar18);
			pvVar9 = buffer_00;
			FUN_00475d30(resData,(int)buffer,0,buffer_00);
			ppuStack32 = NULL;
			if (ppuVar13 != NULL) {
				ppIVar21 = buffer;
				pvVar26 = (void *)((int)buffer_00 - (int)buffer);
				buffer_00 = pvVar9;
				buffer = ppIVar27;
				do {
					pcVar11 = Res_GetAppData_Filename(*ppIVar21);
					fVar24 = Res_GetAppData_Float14(*ppIVar21);
					puVar20 = (undefined4 *)(float)fVar24;
					pcVar14 = Res_GetAppData_SampleName(*ppIVar21);
					pAVar15 = Res_GetAppData_ActFrame(*ppIVar21);
					iVar16 = Res_GetAppData_Field20(*ppIVar21);
					Res_InitResourceAppData(*ppIVar21,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
					pvVar9 = pvVar26;
					Res_LoadActFrameResource
										(pRVar6,pcVar11,(char *)(*(int *)((int)pvVar26 + (int)ppIVar21) + 9),puVar20,
										 iVar16,(int)pcVar14,pAVar15,0,0);
					std::free(*(void **)((int)pvVar26 + (int)ppIVar21));
					ppuVar5 = ppuStack32;
					if ((uint)ppuStack32 % 0x19 == 0) {
						FUN_0047b650();
					}
					ppuStack32 = (undefined **)((int)ppuVar5 + 1);
					ppIVar21 = ppIVar21 + 1;
					pvVar26 = pvVar9;
				} while (ppuStack32 < ppuVar13);
			}
			std::free(buffer);
			std::free(buffer_00);
			if (pRVar6->subdata_c != NULL) {
				Res_ResourceShortNormal_FUN_00473630(pRVar6,pRVar6->subdata_c->name);
				return pRVar6;
			}
		}
		else {
			if (RVar4 == RESOURCE_ANIM) {
				pcVar11 = Res_GetAppData_Filename(resData->frame2);
				pAVar15 = Res_GetAppData_ActFrame(resData->frame2);
				pAVar15 = Res_InitActFrameResource(pAVar15,pRVar6->frame2,&ppuStack32);
				Res_InitResourceAppData
									(pRVar6->frame2,pRVar6,pAVar15,pcVar11,(int *)&ppuStack32,NULL,NULL,NULL,NULL,NULL
									 ,NULL);
				return pRVar6;
			}
			if (RVar4 == RESOURCE_LWO) {
				pSVar17 = pool::ReservedPool_Struct_34___Next_2
														(pRVar6->subdata_c->struct34_c,pRVar6->frame2);
				pRVar6->subdata_c->struct34_c = pSVar17;
			}
		}
	}
	return pRVar6;
}



void __cdecl lego::res::Res_SetFlag80(ResourceData *resData,BOOL state)
{
	if (state != 0) {
		resData->flags = resData->flags | RESDATA_UNK_80;
		return;
	}
	resData->flags = resData->flags & ~RESDATA_UNK_80;
	return;
}



void __cdecl lego::res::Res_UnkSetup3DFrameTransform(ResourceData *resData,BOOL use3rdFrame)
{
	ResourceDataFlags RVar1;
	
	RVar1 = resData->flags & RESDATA_UNK_8;
	if (use3rdFrame != 0) {
		if (RVar1 == RESDATA_NONE) {
			Res_AddTransform3DFrame(resData->frame3,resData->frame2);
			resData->flags = resData->flags | RESDATA_UNK_8;
			return;
		}
		if (use3rdFrame != 0) {
			return;
		}
	}
	if (RVar1 != RESDATA_NONE) {
		Res_AddTransform3DFrame(resData->frame1,resData->frame2);
		resData->flags = resData->flags & ~RESDATA_UNK_8;
	}
	return;
}



BOOL __cdecl lego::res::Res_GetFlag8(ResourceData *resData)
{
	return (resData->flags & 0xff) >> 3 & 1;
}



ResourceData * __cdecl
FUN_00473e80(ResourceData *resData,char *param_2,int param_3,undefined4 *param_4)
{
	char cVar1;
	ResourceData *pRVar2;
	uint uVar3;
	char *local_1c;
	int local_18;
	undefined4 local_14;
	IDirect3DRMFrame3 *local_10;
	undefined4 local_c;
	int local_8;
	undefined4 local_4;
	
	uVar3 = 0xffffffff;
	local_1c = param_2;
	do {
		if (uVar3 == 0) break;
		uVar3 -= 1;
		cVar1 = *param_2;
		param_2 = param_2 + 1;
	} while (cVar1 != '\0');
	local_18 = ~uVar3 - 1;
	local_14 = 0;
	local_10 = NULL;
	local_c = 0;
	local_8 = param_3;
	if (param_4 == NULL) {
		local_4 = 0;
	}
	else {
		local_4 = *param_4;
	}
	FUN_004765f0(resData->frame1,0,FUN_004766d0,&local_1c);
	if ((param_3 == 0) || (param_3 == 2)) {
		if (local_10 != NULL) {
			pRVar2 = lego::res::Res_Create_unassigned(local_10);
			return pRVar2;
		}
	}
	else {
		if (param_3 == 1) {
			*param_4 = local_c;
			return NULL;
		}
	}
	return NULL;
}



char * __cdecl lego::res::Res_GetNull(ResourceData *resData,char *name,int *opt_index)
{
	char *pcVar1;
	ActFrameResource *actFrameRes;
	BOOL BVar2;
	char *pcVar3;
	char *pcVar4;
	IDirect3DRMFrame3 *local_404;
	char local_400 [1024];
	
	if (resData->resType == RESOURCE_ACT) {
		local_404 = Res_GetActFrameChildByName(resData,resData->subdata_c->name,0);
	}
	else {
		if (resData->resType == RESOURCE_ANIM) {
			local_404 = resData->frame2;
		}
	}
	actFrameRes = Res_GetAppData_ActFrame(local_404);
	BVar2 = Res_GetActFrameIsLWSFile(actFrameRes);
	if (BVar2 == 0) {
		pcVar3 = Res_GetAppData_Filename(local_404);
		std::sprintf(local_400,"%s",pcVar3);
		std::_strlwr(local_400);
		pcVar4 = local_400;
		pcVar3 = local_400;
		while (local_400[0] != '\0') {
			if (local_400[0] == '\\') {
				pcVar3 = pcVar4 + 1;
			}
			pcVar1 = pcVar4 + 1;
			pcVar4 = pcVar4 + 1;
			local_400[0] = *pcVar1;
		}
		if (opt_index != NULL) {
			std::sprintf(globals::temp::tmp_CHAR_ARRAY_00506400,"xf_????????_%s_%s_%0.2d_DDc_00",name,
									 pcVar3,*opt_index);
			return globals::temp::tmp_CHAR_ARRAY_00506400;
		}
		pcVar4 = "xf_????????_%s_%s_??_DDc_00";
	}
	else {
		if (opt_index == NULL) {
			std::sprintf(globals::temp::tmp_CHAR_ARRAY_00506400,"%s_??",name);
			return globals::temp::tmp_CHAR_ARRAY_00506400;
		}
		pcVar3 = (char *)*opt_index;
		pcVar4 = "%s_%0.2i";
	}
	std::sprintf(globals::temp::tmp_CHAR_ARRAY_00506400,pcVar4,name,pcVar3);
	return globals::temp::tmp_CHAR_ARRAY_00506400;
}



void __cdecl lego::res::Res_SetOwnerObject(ResourceData *resData,LiveObject *liveObj)
{
	resData->ownerObj = liveObj;
	return;
}



LiveObject * __cdecl lego::res::Res_GetOwnerObject(ResourceData *resData)
{
	return resData->ownerObj;
}



void __cdecl lego::res::Res_SetRootSceneFogEnable(BOOL isFogEnabled)
{
	(*(code *)pool::globals::ReservedPool_ResourceData___g_ROOT->frame1->lpVtbl->SetSceneFogEnable)
						(pool::globals::ReservedPool_ResourceData___g_ROOT->frame1,isFogEnabled);
	if (isFogEnabled != 0) {
		(*(code *)pool::globals::ReservedPool_ResourceData___g_ROOT->frame1->lpVtbl->SetSceneBackground)
							(pool::globals::ReservedPool_ResourceData___g_ROOT->frame1,globals::g_SceneFogColor);
		return;
	}
	(*(code *)pool::globals::ReservedPool_ResourceData___g_ROOT->frame1->lpVtbl->SetSceneBackground)
						(pool::globals::ReservedPool_ResourceData___g_ROOT->frame1,0);
	return;
}



void __cdecl lego::res::Res_SetRootSceneFogColor(float red,float green,float blue)
{
	longlong lVar1;
	longlong lVar2;
	longlong lVar3;
	
	lVar1 = __ftol((float10)green * (float10)255.0);
	lVar2 = __ftol((float10)red * (float10)255.0);
	lVar3 = __ftol((float10)blue * (float10)255.0);
	globals::g_SceneFogColor = ((uint)lVar1 | ((uint)lVar2 | 0xffffff00) << 8) << 8 | (uint)lVar3;
	(*(code *)pool::globals::ReservedPool_ResourceData___g_ROOT->frame1->lpVtbl->SetSceneFogColor)
						(pool::globals::ReservedPool_ResourceData___g_ROOT->frame1,globals::g_SceneFogColor);
	return;
}



void __cdecl lego::res::Res_SetRootSceneFogMethod(D3DRMSceneFogMethod fogMethod)
{
	(*(code *)pool::globals::ReservedPool_ResourceData___g_ROOT->frame1->lpVtbl->SetSceneFogMode)
						(pool::globals::ReservedPool_ResourceData___g_ROOT->frame1,fogMethod);
	(*(code *)pool::globals::ReservedPool_ResourceData___g_ROOT->frame1->lpVtbl->SetSceneFogMethod)
						(pool::globals::ReservedPool_ResourceData___g_ROOT->frame1,globals::g_SceneFogMethod);
	return;
}



void __cdecl lego::res::Res_SetRootSceneFogParams(float rvStart,float rvEnd,float rvDensity)
{
	(*(code *)pool::globals::ReservedPool_ResourceData___g_ROOT->frame1->lpVtbl->SetSceneFogParams)
						(pool::globals::ReservedPool_ResourceData___g_ROOT->frame1,rvStart,rvEnd,rvDensity);
	return;
}



void __cdecl FUN_00474180(ResourceData *resData,int param_2)
{
	undefined **ppuVar1;
	IDirect3DRMFrame3 **buffer;
	uint uVar2;
	IDirect3DRMFrame3 **ppIVar3;
	uint groupId;
	
	if (resData->resType == RESOURCE_ACT) {
		ppuVar1 = FUN_00475d30(resData,0,0,0);
		buffer = (IDirect3DRMFrame3 **)std::malloc((int)ppuVar1 * 4);
		FUN_00475d30(resData,(int)buffer,0,0);
		ppIVar3 = buffer;
		for (; ppuVar1 != NULL; ppuVar1 = (undefined **)((int)ppuVar1 + -1)) {
			FUN_004765f0(*ppIVar3,0,FUN_00474230,&param_2);
			ppIVar3 = ppIVar3 + 1;
		}
		std::free(buffer);
		return;
	}
	if (resData->resType == RESOURCE_MESH) {
		uVar2 = lego::res::Res_GetMeshGroupCount(resData);
		groupId = 0;
		if (uVar2 != 0) {
			do {
				FUN_004750f0(resData,groupId,param_2);
				groupId += 1;
			} while (groupId < uVar2);
		}
	}
	return;
}



BOOL __cdecl FUN_00474230(IDirect3DRMFrame3 *rmFrame3,int *in_count)
{
	int iVar1;
	code **ppcVar2;
	int iVar3;
	uint uVar4;
	code **ppcVar5;
	undefined4 *unaff_ESI;
	uint uVar6;
	undefined4 *puStack32;
	IDirect3DRMFrame3 *pIStack28;
	int **ppiStack24;
	int *piStack20;
	int local_4;
	
	ppiStack24 = &in_count;
	iVar1 = *in_count;
	piStack20 = NULL;
	pIStack28 = rmFrame3;
	puStack32 = (undefined4 *)0x47424f;
	(*(code *)rmFrame3->lpVtbl->GetVisuals)();
	if (local_4 != 0) {
		puStack32 = &DAT_0076be24;
		(*(code *)rmFrame3->lpVtbl->GetVisuals)(rmFrame3,&local_4);
		puStack32 = NULL;
		if (unaff_ESI != NULL) {
			ppcVar5 = (code **)&DAT_0076be24;
			do {
				ppcVar2 = (code **)*ppcVar5;
				iVar3 = (**(code **)*ppcVar2)(ppcVar2,&idl::IID_IDirect3DRMMeshBuilder2,&pIStack28);
				if (iVar3 == 0) {
					(*(code *)rmFrame3->lpVtbl->GetOrientation)(rmFrame3,iVar1);
				}
				else {
					iVar3 = (**(code **)*ppcVar2)(ppcVar2,&idl::IID_IDirect3DRMMesh,&puStack32);
					if (iVar3 == 0) {
						uVar4 = (**(code **)(*piStack20 + 0x58))(piStack20);
						uVar6 = 0;
						if (uVar4 != 0) {
							do {
								if (iVar1 == 0) {
									iVar3 = 0;
								}
								else {
									iVar3 = 4;
								}
								(**(code **)(*piStack20 + 0x48))(piStack20,uVar6,iVar3);
								uVar6 += 1;
							} while (uVar6 < uVar4);
						}
					}
				}
				puStack32 = (undefined4 *)((int)puStack32 + 1);
				ppcVar5 = ppcVar5 + 1;
			} while (puStack32 < unaff_ESI);
		}
	}
	return 0;
}



IDirectDrawSurface4 * __cdecl
FUN_00474310(char *filename,BOOL param_2,uint *out_width,uint *out_height,BOOL *out_bool)
{
	BITMAP_FILE_INFO_STRUCT *bmpData;
	HRESULT HVar1;
	BOOL BVar2;
	IDirectDrawSurface4 *pIVar3;
	int iVar4;
	uint uVar5;
	IDirectDrawSurface4 *unaff_ESI;
	DDSURFACEDESC2 *pDVar6;
	undefined4 *puVar7;
	IDirectDrawSurface4 *unaff_EDI;
	DWORD *pDVar8;
	undefined4 *puVar9;
	DDPIXELFORMAT *pDVar10;
	IDirectDrawSurface4 *ddSurface;
	uint local_14c;
	DDCOLORKEY local_148;
	IDirectDrawPalette *ddPal2;
	uint length;
	D3DRMIMAGE d3dImage;
	DDSURFACEDESC2 surfDesc;
	DWORD local_7c [16];
	DDPIXELFORMAT DStack60;
	char *pcStack4;
	
	ddSurface = NULL;
	local_148.dwColorSpaceLowValue = 0;
	bmpData = (BITMAP_FILE_INFO_STRUCT *)lego::file::File_ReadAllBytes(filename,&length);
	if (bmpData != NULL) {
		lego::draw::Image_LoadBMP__internal(bmpData,length,&d3dImage);
		if ((d3dImage.isRGB == 0) && (d3dImage.bitsPerPixel == 8)) {
			pDVar6 = &surfDesc;
			for (iVar4 = 0x1f; iVar4 != 0; iVar4 += -1) {
				pDVar6->dwSize = 0;
				pDVar6 = (DDSURFACEDESC2 *)&pDVar6->dwFlags;
			}
			surfDesc.dwSize = 0x7c;
										// CMD_NM 0x20
			surfDesc.dwFlags = 0x1007;
			surfDesc.dwWidth = d3dImage.width;
			surfDesc.dwHeight = d3dImage.height;
			surfDesc.ddsCaps.dwCaps = 0x1000;
			if ((((byte)lego::globals::g_CMDLINE_FLAGS & 0x20) == 0) && (param_2 != 0)) {
				surfDesc.ddsCaps.dwCaps2 = 0x10;
			}
			else {
				surfDesc.ddsCaps.dwCaps = 0x5000;
			}
			surfDesc.ddpfPixelFormat.dwSize = 0x20;
			HVar1 = (*lego::globals::g_IDirect3DRMDevice3->lpVtbl->FindPreferredTextureFormat)
												(lego::globals::g_IDirect3DRMDevice3,0x800,4,&surfDesc.ddpfPixelFormat);
			if (HVar1 != 0) {
				pDVar6 = &surfDesc;
				pDVar8 = local_7c;
				for (iVar4 = 0x1f; iVar4 != 0; iVar4 += -1) {
					*pDVar8 = pDVar6->dwSize;
					pDVar6 = (DDSURFACEDESC2 *)&pDVar6->dwFlags;
					pDVar8 = pDVar8 + 1;
				}
				pDVar10 = &surfDesc.ddpfPixelFormat;
				for (iVar4 = 8; iVar4 != 0; iVar4 += -1) {
					pDVar10->dwSize = 0;
					pDVar10 = (DDPIXELFORMAT *)&pDVar10->dwFlags;
				}
				surfDesc.ddsCaps.dwCaps2 &= 0xffffffef;
				surfDesc.ddsCaps.dwCaps = surfDesc.ddsCaps.dwCaps & 0xffffafff | 0x840;
				surfDesc.ddpfPixelFormat.dwSize = 0x20;
				surfDesc.ddpfPixelFormat.dwFlags = 0x60;
				surfDesc.ddpfPixelFormat.dwRGBBitCount = 8;
				local_148.dwColorSpaceLowValue = 1;
			}
			HVar1 = (*lego::globals::g_IDirectDraw4->lpVtbl->CreateSurface)
												(lego::globals::g_IDirectDraw4,&surfDesc,&ddSurface,NULL);
			if (HVar1 == 0) {
				pDVar6 = &surfDesc;
				for (iVar4 = 0x1f; iVar4 != 0; iVar4 += -1) {
					pDVar6->dwSize = 0;
					pDVar6 = (DDSURFACEDESC2 *)&pDVar6->dwFlags;
				}
				surfDesc.dwSize = 0x7c;
				HVar1 = (*ddSurface->lpVtbl->Lock)(ddSurface,NULL,&surfDesc,1,NULL);
				if (HVar1 == 0) {
					iVar4 = 0;
					if (0 < d3dImage.height) {
						do {
							puVar7 = (undefined4 *)d3dImage.buffer1;
							puVar9 = (undefined4 *)surfDesc.lpSurface;
							for (uVar5 = d3dImage.stride >> 2; uVar5 != 0; uVar5 -= 1) {
								*puVar9 = *puVar7;
								puVar7 = puVar7 + 1;
								puVar9 = puVar9 + 1;
							}
							for (uVar5 = d3dImage.stride & 3; uVar5 != 0; uVar5 -= 1) {
								*(undefined *)puVar9 = *(undefined *)puVar7;
								puVar7 = (undefined4 *)((int)puVar7 + 1);
								puVar9 = (undefined4 *)((int)puVar9 + 1);
							}
							surfDesc.lpSurface = (LPVOID)((int)surfDesc.lpSurface + surfDesc.lPitch_dwLinearSize);
							d3dImage.buffer1 = (byte *)((int)d3dImage.buffer1 + d3dImage.stride);
							iVar4 += 1;
						} while (iVar4 < d3dImage.height);
					}
					(*ddSurface->lpVtbl->Unlock)(ddSurface,NULL);
					HVar1 = (*lego::globals::g_IDirectDraw4->lpVtbl->CreatePalette)
														(lego::globals::g_IDirectDraw4,0x4c,
														 (D3DRMPALETTEENTRY *)d3dImage.alpha_mask,
														 (IDirectDrawPalette **)&local_148.dwColorSpaceHighValue,NULL);
					if (HVar1 == 0) {
						HVar1 = (*ddSurface->lpVtbl->SetPalette)(ddSurface,ddPal2);
						if (HVar1 == 0) {
							pIVar3 = unaff_EDI;
							if (ddSurface != NULL) {
								pDVar10 = &DStack60;
								for (iVar4 = 8; iVar4 != 0; iVar4 += -1) {
									pDVar10->dwSize = 0;
									pDVar10 = (DDPIXELFORMAT *)&pDVar10->dwFlags;
								}
								DStack60.dwSize = 0x20;
								HVar1 = (*lego::globals::g_IDirect3DRMDevice3->lpVtbl->FindPreferredTextureFormat)
																	(lego::globals::g_IDirect3DRMDevice3,0x400,0,&DStack60);
								pIVar3 = unaff_EDI;
								if ((HVar1 == 0) &&
									 (HVar1 = (*lego::globals::g_IDirectDraw4->lpVtbl->CreateSurface)
																			(lego::globals::g_IDirectDraw4,
																			 (DDSURFACEDESC2 *)&surfDesc.ddsCaps.dwCaps4_VolumeDepth,
																			 (IDirectDrawSurface4 **)&stack0xfffffea8,NULL), HVar1 == 0))
								{
									if (DStack60.dwRGBBitCount == 0x10) {
										FUN_0047d2c0(pIVar3,(int *)unaff_EDI);
									}
									(*unaff_EDI->lpVtbl->Release)((IUnknown *)unaff_EDI);
								}
							}
							if (out_width != NULL) {
								BVar2 = lego::draw::BMP_loadFontAlpha__004746d0(pcStack4,(int *)&stack0xfffffeac);
								if (BVar2 == 0) {
									*out_width = 0;
								}
								else {
									if (ddSurface != NULL) {
										unaff_ESI = (IDirectDrawSurface4 *)
																lego::image::packNativeRGB
																					(pIVar3,(uint)CONCAT21(CONCAT11(*(undefined *)
																																					 (d3dImage.alpha_mask +
																																					 (int)unaff_ESI * 4),
																																					*(undefined *)
																																					 (d3dImage.alpha_mask + 1
																																					 + (int)unaff_ESI * 4)),
																																 *(undefined *)
																																	(d3dImage.alpha_mask + 2 +
																																	(int)unaff_ESI * 4)));
									}
									ddSurface = unaff_ESI;
									local_14c = (uint)unaff_ESI;
									(*pIVar3->lpVtbl->SetColorKey)(pIVar3,8,(DDCOLORKEY *)&ddSurface);
									*out_width = 1;
								}
							}
							if (filename != NULL) {
								*(IDirectDrawPalette **)filename = ddPal2;
							}
							if (param_2 != 0) {
								*(uint *)param_2 = length;
							}
							(*pIVar3->lpVtbl->AddRef)((IUnknown *)pIVar3);
						}
						(**(code **)(*(int *)local_148.dwColorSpaceHighValue + 8))
											(local_148.dwColorSpaceHighValue);
					}
				}
				pIVar3 = (IDirectDrawSurface4 *)(*ddSurface->lpVtbl->Release)((IUnknown *)ddSurface);
				if (pIVar3 == NULL) {
					ddSurface = pIVar3;
				}
			}
		}
		lego::draw::BMP_free(&d3dImage);
		std::free(bmpData);
	}
	return ddSurface;
}



BOOL __cdecl lego::draw::BMP_loadFontAlpha__004746d0(char *filename,int *out_number)
{
	char *pcVar1;
	byte *text;
	char cVar2;
	uint uVar3;
	int iVar4;
	char *pcVar5;
	
	cVar2 = *filename;
	pcVar5 = filename;
	while (cVar2 != '\0') {
		if (cVar2 == '\\') {
			pcVar5 = filename + 1;
		}
		pcVar1 = filename + 1;
		filename = filename + 1;
		cVar2 = *pcVar1;
	}
	if ((*pcVar5 == 'a') || (*pcVar5 == 'A')) {
		text = (byte *)(pcVar5 + 1);
		if (std::globals::g_CharWidth_1__004b0f74 < 2) {
			uVar3 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + (uint)*text * 2) & 4;
		}
		else {
			uVar3 = std::_unk_FUN_0048f490((uint)*text,4);
		}
		if (uVar3 != 0) {
			if (std::globals::g_CharWidth_1__004b0f74 < 2) {
				uVar3 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + (uint)(byte)pcVar5[2] * 2) & 4
				;
			}
			else {
				uVar3 = std::_unk_FUN_0048f490((uint)(byte)pcVar5[2],4);
			}
			if (uVar3 != 0) {
				if (std::globals::g_CharWidth_1__004b0f74 < 2) {
					uVar3 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + (uint)(byte)pcVar5[3] * 2) &
									4;
				}
				else {
					uVar3 = std::_unk_FUN_0048f490((uint)(byte)pcVar5[3],4);
				}
				if ((uVar3 != 0) && (pcVar5[4] == '_')) {
					iVar4 = std::atoi((char *)text);
					*out_number = iVar4;
					return 1;
				}
			}
		}
	}
	return 0;
}



// WARNING: Type propagation algorithm not settling

DirectXSurfaceTuple * __cdecl
lego::draw::Draw_UnkMakeDirectXSurfaceTuple
					(char *in_filename,BOOL param_2,uint *out_width,uint *out_height)
{
	byte bVar1;
	byte bVar2;
	D3DRMPALETTEENTRY *pDVar3;
	int *piVar4;
	char *filename;
	char *filename_00;
	DirectXSurfaceTuple *buffer;
	IDirectDrawSurface4 *This;
	HRESULT HVar5;
	BOOL BVar6;
	D3DRMIMAGE *pDVar7;
	int *piVar8;
	byte bVar9;
	undefined uVar10;
	ushort uVar11;
	undefined uVar12;
	undefined uVar13;
	undefined2 uVar14;
	IDirect3DRMTexture3 *local_c;
	DirectXSurfaceTuple *local_8;
	undefined4 uStack4;
	
	filename = in_filename;
	local_c = NULL;
	filename_00 = lego::file::Path_JoinDataDir(in_filename);
	buffer = (DirectXSurfaceTuple *)std::malloc(0xc);
	if (buffer != NULL) {
		local_8 = buffer;
		if (param_2 == 0) {
			HVar5 = (*lego::globals::g_IDirect3DRM3->lpVtbl->LoadTexture)
												(lego::globals::g_IDirect3DRM3,filename_00,&local_c);
			if (HVar5 == 0) {
				pDVar7 = (*local_c->lpVtbl->GetImage)(local_c);
				if (pDVar7 != NULL) {
					BVar6 = BMP_loadFontAlpha__004746d0(filename,(int *)&in_filename);
					if (BVar6 != 0) {
						pDVar3 = pDVar7->palette;
						bVar9 = pDVar3[(int)in_filename].red;
						bVar1 = pDVar3[(int)in_filename].blue;
						bVar2 = pDVar3[(int)in_filename].green;
						(*local_c->lpVtbl->SetDecalTransparency)(local_c,1);
						(*local_c->lpVtbl->SetDecalTransparentColor)
											(local_c,(uint)CONCAT21(CONCAT11(bVar9,bVar2),bVar1));
						buffer = local_8;
					}
					if (out_width != NULL) {
						*out_width = pDVar7->width;
					}
					if ((IDirectDrawPalette *)out_height != NULL) {
						*out_height = (uint)((IDirectDrawPalette *)&pDVar7->height)->lpVtbl;
					}
				}
				buffer->surface = NULL;
				buffer->texture = local_c;
				(*local_c->lpVtbl->SetAppData)((IUnknown *)local_c,(DWORD)buffer);
				return buffer;
			}
		}
		else {
			This = FUN_00474310(filename,param_2,out_width,out_height,NULL);
			if (This != NULL) {
				HVar5 = (*This->lpVtbl->QueryInterface)
													((IUnknown *)This,(IID *)&idl::IID_IDirectDrawSurface,&out_width);
				if (HVar5 == 0) {
					HVar5 = (*lego::globals::g_IDirect3DRM3->lpVtbl->CreateTextureFromSurface)
														(lego::globals::g_IDirect3DRM3,(IDirectDrawSurface4 *)out_width,&local_c
														);
					if (HVar5 == 0) {
						(**(code **)(*out_width + 8))((IUnknown *)out_width);
						BVar6 = BMP_loadFontAlpha__004746d0(filename,(int *)&in_filename);
						if (BVar6 != 0) {
							(*This->lpVtbl->GetPalette)(This,(IDirectDrawPalette **)&out_height);
							uVar12 = 1;
							uVar13 = 0;
							uVar14 = 0;
							bVar9 = (byte)uStack4;
							uVar10 = (undefined)((uint)uStack4 >> 8);
							uVar11 = (ushort)((uint)uStack4 >> 0x10);
							piVar8 = NULL;
										// IDirectDrawPalette::GetEntries(THIS_ DWORD dwFlags, DWORD dwBase, DWORD
										// dwNumEntries, D3DRMPALETTEENTRY* lpEntries)
							(**(code **)(*(int *)param_2 + 0x10))(param_2,0,bVar9,1,&stack0xfffffff0);
							(*local_c->lpVtbl->Release)((IUnknown *)local_c);
							piVar4 = (int *)CONCAT22(uVar14,CONCAT11(uVar13,uVar12));
							(**(code **)(*piVar4 + 0x50))(piVar4,1);
							(**(code **)(*piVar8 + 0x54))
												(piVar8,((uint)bVar9 << 8 | CONCAT21(uVar11,uVar10) & 0xff) << 8 |
																uVar11 & 0xff);
						}
						buffer->surface = This;
						buffer->texture = local_c;
						(*local_c->lpVtbl->SetAppData)((IUnknown *)local_c,(DWORD)buffer);
						return buffer;
					}
					(**(code **)(*out_width + 8))();
				}
				(*This->lpVtbl->Release)((IUnknown *)This);
				std::free(buffer);
				return NULL;
			}
		}
		std::free(buffer);
	}
	return NULL;
}



void __cdecl FUN_004749d0(int **param_1)
{
	int *piVar1;
	int iVar2;
	
	if (param_1 != NULL) {
		piVar1 = *param_1;
		if (piVar1 != NULL) {
			iVar2 = (**(code **)(*piVar1 + 8))(piVar1);
			while (iVar2 != 0) {
				iVar2 = (**(code **)(**param_1 + 8))(*param_1);
			}
		}
		piVar1 = param_1[1];
		if (piVar1 != NULL) {
			iVar2 = (**(code **)(*piVar1 + 8))(piVar1);
			while (iVar2 != 0) {
				iVar2 = (**(code **)(*param_1[1] + 8))(param_1[1]);
			}
		}
	}
	return;
}



void __cdecl FUN_00474a20(int **param_1,undefined4 param_2,int param_3)
{
	undefined4 uVar1;
	int iVar2;
	int unaff_EBX;
	uint uVar3;
	int *piVar4;
	int **unaff_EBP;
	undefined4 *puVar5;
	int **ppiVar6;
	int unaff_ESI;
	int *piVar7;
	uint unaff_retaddr;
	int *piVar8;
	int **ppiVar9;
	int *piVar10;
	
	ppiVar6 = param_1;
	if (param_1[4] == (int *)0x6) {
		piVar7 = *param_1;
	}
	else {
		piVar7 = param_1[1];
	}
	piVar10 = &param_3;
	if (param_3 != 0) {
		(**(code **)(*piVar7 + 0x80))(piVar7,piVar10,0);
		if (unaff_retaddr != 0) {
			(**(code **)(*piVar7 + 0x80))(piVar7,register0x00000010,&DAT_0076be24);
			uVar3 = 0;
			if (unaff_retaddr != 0) {
				puVar5 = &DAT_0076be24;
				do {
					(**(code **)(*piVar7 + 0xa0))(piVar7,*puVar5);
					uVar3 += 1;
					puVar5 = puVar5 + 1;
				} while (uVar3 < unaff_retaddr);
			}
		}
		piVar8 = ppiVar6[2];
		ppiVar9 = NULL;
		(**(code **)(*piVar8 + 0x80))(piVar8,register0x00000010);
		if (unaff_ESI != 0) {
			(**(code **)(*ppiVar6[2] + 0x80))(ppiVar6[2],&stack0xfffffff4,&DAT_0076be24);
			piVar4 = NULL;
			if (piVar10 != NULL) {
				puVar5 = &DAT_0076be24;
				ppiVar6 = ppiVar9;
				do {
					uVar1 = *puVar5;
					(**(code **)(*piVar7 + 0x48))(piVar7,uVar1);
					(**(code **)(*(int *)piVar8[2] + 0xa0))((int *)piVar8[2],uVar1);
					piVar4 = (int *)((int)piVar4 + 1);
					puVar5 = puVar5 + 1;
				} while (piVar4 < piVar10);
			}
		}
		ppiVar6[5] = (int *)((uint)ppiVar6[5] & 0xfffffffb);
		return;
	}
	(**(code **)(*piVar7 + 0x80))();
	if (unaff_retaddr != 0) {
		(**(code **)(*piVar7 + 0x80))(piVar7,register0x00000010,&DAT_0076be24);
		uVar3 = 0;
		if (unaff_retaddr != 0) {
			puVar5 = &DAT_0076be24;
			ppiVar6 = unaff_EBP;
			do {
				uVar1 = *puVar5;
				(**(code **)(*ppiVar6[2] + 0x48))(ppiVar6[2],uVar1);
				(**(code **)(*piVar7 + 0xa0))(piVar7,uVar1);
				uVar3 += 1;
				puVar5 = puVar5 + 1;
			} while (uVar3 < unaff_retaddr);
		}
	}
	if (unaff_EBX != 0) {
		iVar2 = *(int *)(*(int *)(unaff_EBX + 0xc) + 8);
		if (iVar2 == 0) {
			(**(code **)(*piVar7 + 0x48))
								(piVar7,*(undefined4 *)(*(int *)(*(int *)(unaff_EBX + 0xc) + 0xc) + 0xc));
			ppiVar6[5] = (int *)((uint)ppiVar6[5] | 4);
			return;
		}
		(**(code **)(*piVar7 + 0x48))(piVar7,iVar2);
	}
	ppiVar6[5] = (int *)((uint)ppiVar6[5] | 4);
	return;
}



int * __cdecl
FUN_00474bb0(ResourceData *resData,uint param_2,int param_3,int param_4,undefined2 *param_5)
{
	Struct_34 *pSVar1;
	ResourceData *pRVar2;
	LwoFrame *pLVar3;
	LwoFrame **ppLVar4;
	int iVar5;
	int *unaff_EDI;
	uint local_4;
	
	pRVar2 = resData;
	pSVar1 = resData->subdata_c->struct34_c;
	if (pSVar1 != NULL) {
		pLVar3 = (LwoFrame *)FUN_004824e0(pSVar1,param_2,param_3,param_4,param_5);
		return (int *)pLVar3;
	}
	resData = (ResourceData *)resData->subdata_c->mesh;
	ppLVar4 = (LwoFrame **)
						(*((IDirect3DRMMeshVtbl *)resData->frame1)->GetAppData)((IUnknown *)resData);
	if (ppLVar4 != NULL) {
		if (ppLVar4[4] == NULL) {
			if (ppLVar4[1] == ppLVar4[2]) {
				return (int *)(LwoFrame *)0xffffffff;
			}
			iVar5 = (*(code *)lego::globals::g_IDirect3DRM3->lpVtbl->CreateMesh)
												(lego::globals::g_IDirect3DRM3,&resData);
			if (iVar5 != 0) {
				return (int *)(LwoFrame *)0xffffffff;
			}
			(&(*ppLVar4)->dwSize)[(int)ppLVar4[1]] = local_4;
			ppLVar4[1] = (LwoFrame *)((int)&ppLVar4[1]->dwSize + 1);
			(*(code *)pRVar2->frame2->lpVtbl->AddVisual)(pRVar2->frame2,local_4);
			(**(code **)(*unaff_EDI + 0x18))(unaff_EDI,(uint)ppLVar4[1] | 0x80000000);
			if ((ppLVar4[1] == ppLVar4[2]) &&
				 (pLVar3 = (LwoFrame *)FUN_0048df40(*ppLVar4,(int)ppLVar4[2] * 4 + 0x50), pLVar3 != NULL)) {
				*ppLVar4 = pLVar3;
				ppLVar4[2] = (LwoFrame *)&ppLVar4[2]->field_0x14;
			}
		}
		else {
			ppLVar4[4] = NULL;
		}
	}
	iVar5 = (*(code *)resData->frame1[0xe].lpVtbl)(resData,param_2,param_3,param_4,param_5,&local_4);
	if (iVar5 != 0) {
		return (int *)(LwoFrame *)0xffffffff;
	}
	if (ppLVar4 == NULL) {
		return (int *)(LwoFrame *)param_3;
	}
	return (int *)ppLVar4[1];
}



int __cdecl lego::res::Res_GetMeshGroupCount(ResourceData *resData)
{
	Struct_34 *pSVar1;
	IDirect3DRMMesh *pIVar2;
	int iVar3;
	DWORD DVar4;
	
	pSVar1 = resData->subdata_c->struct34_c;
	if (pSVar1 != NULL) {
		iVar3 = Res_Struct34_GetField0(pSVar1);
		return iVar3;
	}
	pIVar2 = resData->subdata_c->mesh;
	DVar4 = (*pIVar2->lpVtbl->GetAppData)((IUnknown *)pIVar2);
	if (DVar4 != 0) {
		return *(int *)(DVar4 + 4) + 1;
	}
	pIVar2 = resData->subdata_c->mesh;
	iVar3 = (*(code *)pIVar2->lpVtbl->GetGroupCount)(pIVar2);
	return iVar3;
}



void __cdecl
lego::res::Res_SetMeshGroupQuality
					(ResourceData *resData,D3DRMRenderQuality customQuality,GraphicsQuality quality)
{
	ResourceData *pRVar1;
	D3DRMRenderQuality uVar2;
	
	pRVar1 = resData;
	if (resData->subdata_c->struct34_c == NULL) {
										// D3DRM render quality, same as seen with Main::Quality
		uVar2 = D3DRMRENDER_WIREFRAME;
		if (quality != QUALITY_WIREFRAME) {
			uVar2 = customQuality;
		}
		if (quality == QUALITY_UNLITFLAT) {
			uVar2 = D3DRMRENDER_UNLITFLAT;
		}
		if (quality == QUALITY_FLAT) {
			uVar2 = D3DRMRENDER_FLAT;
		}
		if (quality == QUALITY_GOURAUD) {
			uVar2 = D3DRMRENDER_GOURAUD;
		}
		resData = (ResourceData *)resData->subdata_c->mesh;
		Res_Unk_GetMeshAppData_out((IDirect3DRMMesh **)&resData,(BOOL *)&customQuality);
		(*(code *)pRVar1->subdata_c->mesh->lpVtbl->SetGroupQuality)(resData,customQuality,uVar2);
	}
	return;
}



uint __cdecl FUN_00474da0(ResourceData *resData,int index)
{
	Struct_34 *struct34;
	IDirect3DRMMesh *This;
	ResourceData *pRVar1;
	int *piVar2;
	uint uVar3;
	
	struct34 = resData->subdata_c->struct34_c;
	if (struct34 != NULL) {
		pRVar1 = (ResourceData *)FUN_00482a40(struct34,index);
		return (uint)pRVar1;
	}
	This = resData->subdata_c->mesh;
	piVar2 = (int *)(*This->lpVtbl->GetAppData)((IUnknown *)This);
	if (piVar2 != NULL) {
		if (resData != NULL) {
			piVar2 = *(int **)(*piVar2 + -4 + (int)resData * 4);
			uVar3 = (**(code **)(*piVar2 + 0x1c))(piVar2);
			return (uint)(~uVar3 >> 0x1f);
		}
		return (uint)(ResourceData *)piVar2[3];
	}
	return (uint)resData;
}



void __cdecl FUN_00474df0(ResourceData *resData,int index,BOOL state)
{
	Struct_34 *struct34;
	int *piVar1;
	DWORD DVar2;
	uint uVar3;
	IDirect3DRMMesh *This;
	IDirect3DRMMesh *This_00;
	int unaff_retaddr;
	
	struct34 = resData->subdata_c->struct34_c;
	if (struct34 != NULL) {
		FUN_00482a60(struct34,index,state);
		return;
	}
	This_00 = resData->subdata_c->mesh;
	piVar1 = (int *)(*This_00->lpVtbl->GetAppData)((IUnknown *)This_00);
	if (piVar1 == NULL) {
		return;
	}
	if (resData == NULL) {
		uVar3 = piVar1[3];
		This = NULL;
	}
	else {
		This = *(IDirect3DRMMesh **)(*piVar1 + -4 + (int)resData * 4);
		DVar2 = (*This->lpVtbl->GetAppData)((IUnknown *)This);
		uVar3 = ~DVar2 >> 0x1f;
		This_00 = This;
	}
	if (index != 0) {
		if (uVar3 == 0) {
			(**(code **)(**(int **)(unaff_retaddr + 4) + 0xa0))(*(int **)(unaff_retaddr + 4),This_00);
			goto LAB_00474e84;
		}
		if (index != 0) goto LAB_00474e84;
	}
	if (uVar3 != 0) {
		(**(code **)(**(int **)(unaff_retaddr + 4) + 0x48))(*(int **)(unaff_retaddr + 4),This_00);
	}
LAB_00474e84:
	if (This == NULL) {
		piVar1[3] = index;
		return;
	}
	DVar2 = (*This->lpVtbl->GetAppData)((IUnknown *)This);
	if (index == 0) {
		(*This->lpVtbl->SetAppData)((IUnknown *)This,DVar2 & 0x7fffffff | 0x80000000);
		return;
	}
	(*This->lpVtbl->SetAppData)((IUnknown *)This,DVar2 & 0x7fffffff);
	return;
}



BOOL __cdecl lego::res::Res_Unk_GetMeshAppData_out(IDirect3DRMMesh **lplpMesh,BOOL *shouldSetMesh)
{
	int *piVar1;
	
	piVar1 = (int *)(*(*lplpMesh)->lpVtbl->GetAppData)((IUnknown *)*lplpMesh);
	if (piVar1 != NULL) {
		if (*lplpMesh != NULL) {
			*lplpMesh = *(IDirect3DRMMesh **)(*piVar1 + -4 + (int)*lplpMesh * 4);
		}
		*lplpMesh = NULL;
		return 1;
	}
	return 0;
}



BOOL __cdecl
FUN_00474f00(ResourceData *resData,int param_2,uint *param_3,undefined4 param_4,undefined4 *param_5,
						uint *param_6,uint *param_7)
{
	Struct_34 *struct34;
	uint uVar1;
	int iVar2;
	
	struct34 = resData->subdata_c->struct34_c;
	if (struct34 != NULL) {
		uVar1 = FUN_00482460(struct34,param_2,param_3,param_4,param_5,param_6,param_7);
		return uVar1;
	}
	resData = (ResourceData *)resData->subdata_c->mesh;
	lego::res::Res_Unk_GetMeshAppData_out((IDirect3DRMMesh **)&resData,&param_2);
	iVar2 = (*(code *)resData->frame1[0x17].lpVtbl)
										(resData,param_2,param_3,param_4,param_5,param_6,param_7);
	return (uint)(iVar2 == 0);
}



int __cdecl FUN_00474f80(ResourceData *resData,int param_2,int param_3,int param_4,int param_5)
{
	Struct_34 *struct34;
	int iVar1;
	
	struct34 = resData->subdata_c->struct34_c;
	if (struct34 != NULL) {
		iVar1 = FUN_00482730_internal(struct34,param_2,param_3,param_4,param_5);
		return iVar1;
	}
	resData = (ResourceData *)resData->subdata_c->mesh;
	lego::res::Res_Unk_GetMeshAppData_out((IDirect3DRMMesh **)&resData,&param_2);
	iVar1 = (*(code *)resData->frame1[0x18].lpVtbl)(resData,param_2,param_3,param_4,param_5);
	if (iVar1 != 0) {
		iVar1 = -1;
	}
	return iVar1;
}



int __cdecl FUN_00474ff0(int *param_1,int param_2,int param_3,int param_4,int param_5)
{
	IDirect3DRMObject__Clone *pIVar1;
	int iVar2;
	
	pIVar1 = ((IDirect3DRMMesh *)(param_1 + 3))->lpVtbl->Clone;
	if (pIVar1 != NULL) {
		iVar2 = FUN_004826a0((int)pIVar1,param_2,param_3,param_4,param_5);
		return iVar2;
	}
	param_1 = (int *)((IDirect3DRMMesh *)(param_1 + 3))->lpVtbl->Release;
	lego::res::Res_Unk_GetMeshAppData_out((IDirect3DRMMesh **)&param_1,&param_2);
	iVar2 = (**(code **)(*param_1 + 0x3c))(param_1,param_2,param_3,param_4,param_5);
	if (iVar2 != 0) {
		iVar2 = -1;
	}
	return iVar2;
}



void __cdecl FUN_00475060(ResourceData *param_1,int param_2,undefined **param_3)
{
	Struct_34 *pSVar1;
	code **ppcVar2;
	int *unaff_retaddr;
	
	if (param_3 == NULL) {
		ppcVar2 = NULL;
	}
	else {
		ppcVar2 = (code **)param_3[1];
	}
	pSVar1 = param_1->subdata_c->struct34_c;
	if (pSVar1 != NULL) {
		FUN_00483380(pSVar1,param_2,param_3);
		return;
	}
	param_1 = (ResourceData *)param_1->subdata_c->mesh;
	lego::res::Res_Unk_GetMeshAppData_out((IDirect3DRMMesh **)&param_1,&param_2);
	if (ppcVar2 == NULL) {
		param_3 = NULL;
	}
	else {
		(**(code **)*ppcVar2)(ppcVar2,&idl::IID_IDirect3DRMTexture,&param_3);
	}
	(*(code *)param_1->frame1[0x15].lpVtbl)(param_1,param_2,param_3);
	if (unaff_retaddr != NULL) {
		(**(code **)(*unaff_retaddr + 8))(unaff_retaddr);
	}
	return;
}



void __cdecl FUN_004750f0(ResourceData *resData,int groupId,BOOL isCorrectPerspective)
{
	if (resData->subdata_c->struct34_c == NULL) {
		resData = (ResourceData *)resData->subdata_c->mesh;
		lego::res::Res_Unk_GetMeshAppData_out((IDirect3DRMMesh **)&resData,&groupId);
										// IDirect3DRMMesh->SetGroupMapping(int id, D3DRMMapping value)
										//   D3DRMMAP_WRAPU        = 0x1,
										//   D3DRMMAP_WRAPV        = 0x2,
										//   D3DRMMAP_PERSPCORRECT = 0x4,
		if (isCorrectPerspective != 0) {
			(*(code *)resData->frame1[0x12].lpVtbl)(resData,groupId,4);
			return;
		}
		(*(code *)resData->frame1[0x12].lpVtbl)(resData,groupId,0);
	}
	return;
}



BOOL __cdecl
FUN_00475150(ResourceData *promeshResData,float blockSize100th_x,float blockSize100th_y,
						float blockSize100th_z)
{
	Struct_34 *pSVar1;
	IDirect3DRMMesh *This;
	int *piVar2;
	int *piVar3;
	undefined4 unaff_ESI;
	uint uVar4;
	
	pSVar1 = promeshResData->subdata_c->struct34_c;
	if (pSVar1 != NULL) {
		FUN_00482630((uint *)pSVar1,blockSize100th_x,blockSize100th_y,blockSize100th_z);
		return 0;
	}
	This = promeshResData->subdata_c->mesh;
	(*(code *)This->lpVtbl->Scale)((IUnknown *)This);
	piVar3 = (int *)(*This->lpVtbl->GetAppData)((IUnknown *)This);
	if ((piVar3 != NULL) && (uVar4 = 0, piVar3[1] != 0)) {
		do {
			piVar2 = *(int **)(*piVar3 + uVar4 * 4);
			(**(code **)(*piVar2 + 0x2c))(piVar2,unaff_ESI,blockSize100th_y,blockSize100th_z);
			uVar4 += 1;
		} while (uVar4 < (uint)piVar3[1]);
	}
	return 0;
}



undefined4 __cdecl lego::res::Res_LoadVehicleWheels(ResourceData *wheelRes,float *param_2)
{
	IDirect3DRMMesh *This;
	int *piVar1;
	int *piVar2;
	float unaff_EBX;
	float unaff_ESI;
	float unaff_EDI;
	uint uVar3;
	float local_18;
	float local_14;
	float local_10;
	
	This = wheelRes->subdata_c->mesh;
	(*(code *)This->lpVtbl->GetBox)((IUnknown *)This);
	piVar2 = (int *)(*This->lpVtbl->GetAppData)((IUnknown *)This);
	if ((piVar2 != NULL) && (uVar3 = 0, piVar2[1] != 0)) {
		do {
			piVar1 = *(int **)(*piVar2 + uVar3 * 4);
			(**(code **)(*piVar1 + 0x34))(piVar1,&stack0xffffffdc);
			if (unaff_EDI < *param_2) {
				*param_2 = unaff_EDI;
			}
			if (unaff_ESI < param_2[1]) {
				param_2[1] = unaff_ESI;
			}
			if (unaff_EBX < param_2[2]) {
				param_2[2] = unaff_EBX;
			}
			if ((ushort)((ushort)(local_18 < param_2[3]) << 8 | (ushort)(local_18 == param_2[3]) << 0xe)
					== 0) {
				param_2[3] = local_18;
			}
			if ((ushort)((ushort)(local_14 < param_2[4]) << 8 | (ushort)(local_14 == param_2[4]) << 0xe)
					== 0) {
				param_2[4] = local_14;
			}
			if ((ushort)((ushort)(local_10 < param_2[5]) << 8 | (ushort)(local_10 == param_2[5]) << 0xe)
					== 0) {
				param_2[5] = local_10;
			}
			uVar3 += 1;
		} while (uVar3 < (uint)piVar2[1]);
	}
	return 0;
}



void __cdecl lego::res::Res_SetMeshColorUnk(ResourceData *resData,int index,float r,float g,float b)
{
	Struct_34 *pSVar1;
	
	pSVar1 = resData->subdata_c->struct34_c;
	if (pSVar1 != NULL) {
		FUN_00483530(pSVar1,index,r,g,b,3);
	}
	return;
}



void __cdecl
lego::res::Res_SetMeshColorMultiplier
					(ResourceData *resData,int index,float r,float g,float b,float unkMultiplier)
{
	Struct_34 *pSVar1;
	
	pSVar1 = resData->subdata_c->struct34_c;
	if (pSVar1 != NULL) {
		FUN_00483530(pSVar1,index,r,g,b,0);
		FUN_004836e0(pSVar1,index,unkMultiplier,4);
	}
	return;
}



void __cdecl FUN_00475330(int **param_1,undefined4 param_2,undefined4 param_3)
{
	(**(code **)(**param_1 + 0x108))(*param_1,param_2,param_3);
	return;
}



void __cdecl FUN_00475350(int **param_1,undefined4 param_2,undefined4 param_3)
{
	(**(code **)(**param_1 + 0x84))(*param_1,param_2,param_3);
	return;
}



void __cdecl lego::res::Res_SetLightColor(ResourceData *resData,float r,float g,float b,float alpha)
{
	IDirect3DRMLight *pIVar1;
	longlong lVar2;
	longlong lVar3;
	longlong lVar4;
	longlong lVar5;
	
	lVar2 = __ftol((float10)r * (float10)255.0);
	lVar3 = __ftol((float10)alpha * (float10)255.0);
	lVar4 = __ftol((float10)g * (float10)255.0);
	lVar5 = __ftol((float10)b * (float10)255.0);
	if (resData->resType == RESOURCE_LIGHT) {
		pIVar1 = resData->subdata_c->light;
		(*(code *)pIVar1->lpVtbl->SetColor)
							(pIVar1,(((uint)lVar2 | (int)lVar3 << 8) << 8 | (uint)lVar4) << 8 | (uint)lVar5);
	}
	return;
}



float10 __cdecl lego::res::Res_DoAnimElapsedCallbacks(ResourceData *resData,float elapsed)
{
	float10 fVar1;
	
	fVar1 = Res_GetAnimFloat10(resData);
	fVar1 = Res_DoCallbacks(resData,(float)(fVar1 + (float10)elapsed));
	return fVar1;
}



float10 __cdecl lego::res::Res_DoCallbacks(ResourceData *resData,float elapsed)
{
	float fVar1;
	IDirect3DRMFrame3 *rmFrame3;
	char *sampleName;
	uint uVar2;
	uint uVar3;
	ResourceDataFlags RVar4;
	float10 fVar5;
	ActFrameResource *local_14;
	float local_10;
	
	local_14 = NULL;
	local_10 = 0.0;
	if (resData->resType == RESOURCE_ACT) {
		rmFrame3 = Res_GetActFrameChildByName(resData,resData->subdata_c->name,0);
		if ((rmFrame3 != NULL) &&
			 (local_14 = Res_GetAppData_ActFrame(rmFrame3),
			 (*(byte *)&resData->flags & RESDATA_UNK_2) != 0)) {
			sampleName = Res_GetAppData_SampleName(rmFrame3);
			if ((sampleName != NULL) &&
				 ((globals::g_ResourceSoundCallback != NULL &&
					(((byte)pool::globals::ReservedPool_ResourceData___g_INITFLAGS & 0x40) != 0)))) {
				(*globals::g_ResourceSoundCallback)
									(sampleName,resData,globals::g_ResourceSoundCallback_VALUE);
			}
			resData->flags = resData->flags & ~RESDATA_UNK_2;
		}
	}
	else {
		rmFrame3 = (IDirect3DRMFrame3 *)elapsed;
		if (resData->resType == RESOURCE_ANIM) {
			local_14 = Res_GetAppData_ActFrame(resData->frame2);
			rmFrame3 = resData->frame2;
		}
	}
	if (local_14 != NULL) {
		RVar4 = resData->flags & RESDATA_UNK_8;
		fVar5 = Res_GetAnimFloat10(resData);
		uVar2 = Res_GetAppData_Fieldc(rmFrame3);
		Res_InitResourceAppData(rmFrame3,NULL,NULL,NULL,NULL,NULL,&elapsed,NULL,NULL,NULL,NULL);
		if (uVar2 != 0) {
			uVar2 -= 1;
			fVar1 = (float)(ulonglong)uVar2;
			if ((ushort)((ushort)(elapsed < fVar1) << 8 | (ushort)(elapsed == fVar1) << 0xe) == 0) {
				local_10 = elapsed - fVar1;
				RVar4 = RESDATA_NONE;
			}
		}
		if (RVar4 == RESDATA_NONE) {
			uVar3 = Res_GetAppData_Field20(rmFrame3);
			fVar1 = (float)(ulonglong)uVar3;
			if ((((uVar2 != 1) &&
					 (Res_SetAnimTime(local_14,elapsed,NULL), globals::g_ResourceDrawCallback != NULL)) &&
					(fVar1 != 0.0)) && (((float)fVar5 < fVar1 && (fVar1 <= elapsed)))) {
				(*globals::g_ResourceDrawCallback)(resData,globals::g_ResourceDrawCallback_VALUE);
				return (float10)local_10;
			}
		}
		else {
			resData->flags = resData->flags | RESDATA_UNK_20;
		}
	}
	return (float10)local_10;
}



void __cdecl lego::res::Res_UpdateAnimTime(ResourceData *resData)
{
	IDirect3DRMFrame3 *rmFrame3;
	ResourceData *pRVar1;
	float10 fVar2;
	
	if ((*(byte *)&resData->flags & RESDATA_UNK_20) != 0) {
		pRVar1 = resData;
		if (resData->resType == RESOURCE_ACT) {
			rmFrame3 = Res_GetActFrameChildByName(resData,resData->subdata_c->name,0);
			if (rmFrame3 != NULL) {
				pRVar1 = (ResourceData *)Res_GetAppData_ActFrame(rmFrame3);
				fVar2 = Res_GetAppData_Float10(rmFrame3);
				resData = (ResourceData *)(float)fVar2;
			}
		}
		else {
			if (resData->resType == RESOURCE_ANIM) {
				pRVar1 = (ResourceData *)Res_GetAppData_ActFrame(resData->frame2);
				fVar2 = Res_GetAppData_Float10(resData->frame2);
				resData = (ResourceData *)(float)fVar2;
			}
		}
		if (pRVar1 != NULL) {
			Res_SetAnimTime((ActFrameResource *)pRVar1,(float)resData,NULL);
		}
	}
	return;
}



float10 __cdecl lego::res::Res_GetAnimFloat10(ResourceData *resData)
{
	IDirect3DRMFrame3 *rmFrame3;
	float10 fVar1;
	
	fVar1 = (float10)0.0;
	if (resData->resType == RESOURCE_ACT) {
		rmFrame3 = Res_GetActFrameChildByName(resData,resData->subdata_c->name,0);
		if (rmFrame3 != NULL) {
			fVar1 = Res_GetAppData_Float10(rmFrame3);
			return fVar1;
		}
		fVar1 = (float10)(float)fVar1;
	}
	else {
		if (resData->resType == RESOURCE_ANIM) {
			fVar1 = Res_GetAppData_Float10(resData->frame2);
			return fVar1;
		}
	}
	return fVar1;
}



undefined4 __cdecl lego::res::Res_GetAnimAppData_Fieldc(ResourceData *resData)
{
	IDirect3DRMFrame3 *rmFrame3;
	undefined4 uVar1;
	
	rmFrame3 = NULL;
	if (resData->resType == RESOURCE_ACT) {
		rmFrame3 = Res_GetActFrameChildByName(resData,resData->subdata_c->name,0);
	}
	else {
		if (resData->resType == RESOURCE_ANIM) {
			rmFrame3 = resData->frame2;
		}
	}
	if (rmFrame3 != NULL) {
		uVar1 = Res_GetAppData_Fieldc(rmFrame3);
		return uVar1;
	}
	return 0;
}



void __cdecl
lego::res::Res_SetFramePosition
					(ResourceData *resData1,ResourceData *opt_resData2,float x,float y,float z)
{
										// IDirect3DRMFrame3->SetPosition(this, IDirect3DRMFrame3* lpRef, float rvX,
										// float rvY, float rvZ)
	Res_GetRelativeFrames
						(resData1,opt_resData2,(IDirect3DRMFrame3 **)&opt_resData2,
						 (IDirect3DRMFrame3 **)&resData1);
	(*(code *)opt_resData2->frame1[0x3c].lpVtbl)(opt_resData2,resData1,x,y,z);
	return;
}



void __cdecl
lego::res::Res_SetFrameOrientation
					(ResourceData *resData1,ResourceData *opt_resData2,float x,float y,float z,float ux,
					float uy,float uz)
{
	Res_GetRelativeFrames
						(resData1,opt_resData2,(IDirect3DRMFrame3 **)&opt_resData2,
						 (IDirect3DRMFrame3 **)&resData1);
										// IDirect3DRMFrame3->SetOrientation(this, IDirect3DRMFrame3* lpRef, float rvDx,
										// float rvDy, float rvDz, float rvUx, float rvUy, float rvUz)
	(*(code *)opt_resData2->frame1[0x3b].lpVtbl)(opt_resData2,resData1,x,y,z,ux,uy,uz);
	return;
}



void __cdecl
lego::res::Res_GetPosition
					(ResourceData *resData,ResourceData *opt_refResData,Vector3F *out_position)
{
	Res_GetRelativeFrames
						(resData,opt_refResData,(IDirect3DRMFrame3 **)&opt_refResData,
						 (IDirect3DRMFrame3 **)&resData);
										// IDirect3DRMFrame3->GetPosition(this, IDirect3DRMFrame3* lpRef, Vector3F*
										// lprvPos)
	(*(code *)opt_refResData->frame1[0x18].lpVtbl)(opt_refResData,resData,out_position);
	return;
}



void __cdecl
lego::res::Res_GetOrientation
					(ResourceData *resData,ResourceData *opt_refResData,Vector3F *out_dvector,
					Vector3F *out_uvector)
{
	Vector3F **unaff_retaddr;
	Vector3F *pVVar1;
	Vector3F *pVVar2;
	Vector3F dvector;
	Vector3F uvector;
	
	Res_GetRelativeFrames
						(resData,opt_refResData,(IDirect3DRMFrame3 **)&opt_refResData,
						 (IDirect3DRMFrame3 **)&resData);
	pVVar1 = &dvector;
	pVVar2 = &uvector;
										// IDirect3DRMFrame3->GetOrientation(this, IDirect3DRMFrame3* lpRef, Vector3F*
										// lprvDir, Vector3F* lprvUp)
	(*(code *)opt_refResData->frame1[0x1f].lpVtbl)();
	if (uvector.z != 0.0) {
		*(ResourceData **)uvector.z = opt_refResData;
		*(ResourceData **)((int)uvector.z + 4) = resData;
		*(Vector3F **)((int)uvector.z + 8) = pVVar1;
	}
	if (unaff_retaddr != NULL) {
		*unaff_retaddr = pVVar2;
		unaff_retaddr[1] = (Vector3F *)dvector.x;
		unaff_retaddr[2] = (Vector3F *)dvector.y;
	}
	return;
}



void __cdecl
lego::res::Res_AddRotation
					(ResourceData *resData,D3DRMCombineType combineType,float x,float y,float z,float theta)
{
										// enum D3DRMCombineType
										//   D3DRMCOMBINE_REPLACE = 0,
										//   D3DRMCOMBINE_BEFORE  = 1,
										//   D3DRMCOMBINE_AFTER   = 2,
										// 
										// IDirect3DRMFrame3->AddRotation(this, D3DRMCombineType rctCombine, float rvX,
										// float rvY, float rvZ, float rvTheta)
	(*(code *)resData->frame1->lpVtbl->AddRotation)(resData->frame1,combineType,x,y,z,theta);
	return;
}



void __cdecl
lego::res::Res_AddScale
					(ResourceData *resData,D3DRMCombineType combineType,float rvX,float rvY,float rvZ)
{
										// enum D3DRMCombineType
										//   D3DRMCOMBINE_REPLACE = 0,
										//   D3DRMCOMBINE_BEFORE  = 1,
										//   D3DRMCOMBINE_AFTER   = 2,
										// 
										// IDirect3DRMFrame3->AddScale(this, D3DRMCombineType rctCombine, float rvX,
										// float rvY, float rvZ)
	(*(code *)resData->frame1->lpVtbl->AddScale)(resData->frame1,combineType,rvX,rvY,rvZ);
	return;
}



void __cdecl
lego::res::Res_AddTranslation
					(ResourceData *resData,D3DRMCombineType combineType,float rvX,float rvY,float rvZ)
{
										// enum D3DRMCombineType
										//   D3DRMCOMBINE_REPLACE = 0,
										//   D3DRMCOMBINE_BEFORE  = 1,
										//   D3DRMCOMBINE_AFTER   = 2,
										// 
										// IDirect3DRMFrame3->AddTranslation(this, D3DRMCombineType rctCombine, float
										// rvX, float rvY, float rvZ)
	(*(code *)resData->frame1->lpVtbl->AddTranslation)(resData->frame1,combineType,rvX,rvY,rvZ);
	return;
}



void __cdecl lego::res::Res_IdentityFrameTransform(ResourceData *resData)
{
	Matrix4F identity;
	
	identity.values[0][0] = 1.0;
	identity.values[1][0] = 0.0;
	identity.values[2][0] = 0.0;
	identity.values[3][0] = 0.0;
	identity.values[0][1] = 0.0;
	identity.values[1][1] = 1.0;
	identity.values[2][1] = 0.0;
	identity.values[3][1] = 0.0;
	identity.values[0][2] = 0.0;
	identity.values[1][2] = 0.0;
	identity.values[2][2] = 1.0;
	identity.values[3][2] = 0.0;
	identity.values[0][3] = 0.0;
	identity.values[1][3] = 0.0;
	identity.values[2][3] = 0.0;
	identity.values[3][3] = 1.0;
	Res_AddTransform(resData,D3DRMCOMBINE_REPLACE,&identity);
	return;
}



void __cdecl
lego::res::Res_AddTransform(ResourceData *resData,D3DRMCombineType combineType,Matrix4F *matrix)
{
										// IDirect3DRMFrame3->AddTransform(this, D3DRMCombineType rctCombine,
										// D3DRMMatrix4D* rmMatrix)
	(*(code *)resData->frame1->lpVtbl->AddTransform)(resData->frame1,combineType,matrix);
	return;
}



float10 __cdecl FUN_00475990(ResourceData *resData)
{
	IDirect3DRMFrame3 *pIVar1;
	ResourceData **ppRStack72;
	Matrix4F matrix;
	
	ppRStack72 = &resData;
	pIVar1 = resData->frame1;
	(*(code *)pIVar1->lpVtbl->GetParent)(pIVar1);
	(*(code *)pIVar1->lpVtbl->GetTransform)(pIVar1,matrix.values[3][3],&ppRStack72);
	(**(code **)(*(int *)matrix.values[3][0] + 8))(matrix.values[3][0]);
	return (float10)matrix.values[1][0] / (float10)(float)pIVar1;
}



void __cdecl FUN_004759d0(ResourceData *resData,ResourceData *resRoot)
{
	IDirect3DRMFrame3 *frame2;
	IDirect3DRMFrame3 *frame2_00;
	ResourceData *pRVar1;
	int *unaff_EBX;
	int *unaff_EDI;
	IDirect3DRMFrame3 *This;
	
	pRVar1 = resRoot;
	frame2 = resData->frame1;
	frame2_00 = resData->frame3;
	if (resRoot == NULL) {
										// IDirect3DRMFrame3->GetParent(this, IDirect3DRMFrame3** lplpParent)
		This = frame2;
		(*(code *)frame2->lpVtbl->GetParent)(frame2,&resData);
		if (unaff_EBX != NULL) {
										// IDirect3DRMFrame3->DeleteChild(this, IDIrect3DRMFrame3* lpChild)
			(**(code **)(*unaff_EBX + 0x94))(unaff_EBX,frame2);
										// IDirect3DRMFrame3->Release(this)
										//  (releasing GetParent frame)
			(**(code **)(*unaff_EDI + 8))(unaff_EDI);
		}
		(*(code *)frame2->lpVtbl->GetParent)(frame2_00,&stack0xfffffffc);
		if (unaff_EDI != NULL) {
			(**(code **)(*unaff_EDI + 0x94))(unaff_EDI,frame2_00);
			(*This->lpVtbl->Release)((IUnknown *)This);
			return;
		}
	}
	else {
		resData = (ResourceData *)resRoot->frame1;
		lego::res::Res_AddTransform3DFrame((IDirect3DRMFrame3 *)resData,frame2);
		resData = (ResourceData *)pRVar1->frame3;
		lego::res::Res_AddTransform3DFrame((IDirect3DRMFrame3 *)resData,frame2_00);
	}
	return;
}



ResourceData * __cdecl FUN_00475a60(ResourceData *resData)
{
	ResourceData *pRVar1;
	IDirect3DRMFrame3 *unaff_ESI;
	
	if (resData == lego::pool::globals::ReservedPool_ResourceData___g_ROOT) {
		return NULL;
	}
	(*(code *)resData->frame1->lpVtbl->GetParent)(resData->frame1,&resData);
	if (unaff_ESI != NULL) {
		pRVar1 = lego::res::Res_Create_unassigned(unaff_ESI);
		(*unaff_ESI->lpVtbl->Release)((IUnknown *)unaff_ESI);
		return pRVar1;
	}
	return NULL;
}



float10 __cdecl lego::res::Res_GetActFrameFloat14(ResourceData *resData)
{
	char *frameName;
	IDirect3DRMFrame3 *rmFrame3;
	float10 fVar1;
	
	if (((resData->resType == RESOURCE_ACT) && (resData->subdata_c != NULL)) &&
		 (frameName = resData->subdata_c->name, frameName != NULL)) {
		rmFrame3 = Res_GetActFrameChildByName(resData,frameName,0);
		if (rmFrame3 != NULL) {
			fVar1 = Res_GetAppData_Float14(rmFrame3);
			return fVar1;
		}
	}
	return (float10)0.0;
}



int __cdecl FUN_00475af0(IDirect3DRMFrame3 *param_1)
{
	ResourceData *pRVar1;
	IDirect3DRMFrame3 *rmFrame3;
	ResourceData *pRVar2;
	
	pRVar2 = NULL;
	rmFrame3 = param_1;
	do {
		if (rmFrame3 == NULL) {
			return (int)pRVar2;
		}
		pRVar1 = lego::res::Res_GetAppData_Resource(rmFrame3);
		if ((pRVar1 != NULL) && (pRVar1->resType != RESOURCE_unassigned)) {
			pRVar2 = pRVar1;
		}
		(*(code *)rmFrame3->lpVtbl->GetParent)(rmFrame3,&param_1);
		rmFrame3 = param_1;
		if (param_1 == NULL) {
			rmFrame3 = NULL;
		}
		else {
			(*param_1->lpVtbl->Release)((IUnknown *)param_1);
		}
	} while (pRVar2 == NULL);
	return (int)pRVar2;
}



ResourceData * __cdecl lego::res::Res_Create_unassigned(IDirect3DRMFrame3 *rmFrame3)
{
	ResourceData *resData;
	
	resData = Res_GetAppData_Resource(rmFrame3);
	if (resData == NULL) {
		resData = pool::ReservedPool_ResourceData___Next(NULL);
		if (resData != NULL) {
			(*resData->frame1->lpVtbl->Release)((IUnknown *)resData->frame1);
			(*resData->frame2->lpVtbl->Release)((IUnknown *)resData->frame2);
			resData->frame1 = rmFrame3;
			resData->frame2 = NULL;
			resData->resType = RESOURCE_unassigned;
			(*rmFrame3->lpVtbl->AddDestroyCallback)((IUnknown *)rmFrame3,Res_DestroyAppDataCallback,NULL);
			Res_InitResourceAppData(rmFrame3,resData,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL);
		}
	}
	return resData;
}



void __cdecl
lego::res::Res_GetRelativeFrames
					(ResourceData *resData1,ResourceData *opt_resData2,IDirect3DRMFrame3 **out_curFrame,
					IDirect3DRMFrame3 **out_refFrame)
{
	*out_curFrame = resData1->frame1;
	if (opt_resData2 == NULL) {
		*out_refFrame = pool::globals::ReservedPool_ResourceData___g_ROOT->frame1;
		return;
	}
	*out_refFrame = opt_resData2->frame1;
	return;
}



ResourceType __cdecl lego::main::Main_GetResourceType(char *resourceName,BOOL *out_noTexture)
{
	char cVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	undefined4 *puVar5;
	char **ppcVar6;
	char *pcVar7;
	undefined4 *puVar8;
	ResourceType RVar9;
	undefined4 local_50 [10];
	char *local_28;
	char *local_24;
	
	if (resourceName == NULL) {
		return RESOURCE__INVALID;
	}
	uVar3 = 0xffffffff;
	do {
		pcVar7 = resourceName;
		if (uVar3 == 0) break;
		uVar3 -= 1;
		pcVar7 = resourceName + 1;
		cVar1 = *resourceName;
		resourceName = pcVar7;
	} while (cVar1 != '\0');
	uVar3 = ~uVar3;
	puVar5 = (undefined4 *)(pcVar7 + -uVar3);
	puVar8 = local_50;
	for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
		*puVar8 = *puVar5;
		puVar5 = puVar5 + 1;
		puVar8 = puVar8 + 1;
	}
	for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
		*(undefined *)puVar8 = *(undefined *)puVar5;
		puVar5 = (undefined4 *)((int)puVar5 + 1);
		puVar8 = (undefined4 *)((int)puVar8 + 1);
	}
	uVar3 = util::stringSplit((char *)local_50,&local_28,":");
	if (1 < uVar3) {
		iVar2 = std::_stricmp(local_24,"NOTEXTURE");
		if (iVar2 == 0) {
			*out_noTexture = 1;
			goto LAB_00475c6a;
		}
	}
	*out_noTexture = 0;
LAB_00475c6a:
	RVar9 = RESOURCE_NULL;
	ppcVar6 = globals::g_ResourceTypes_TABLE;
	do {
		if (*ppcVar6 != NULL) {
			iVar2 = std::_stricmp(*ppcVar6,(char *)local_50);
			if (iVar2 == 0) {
				return RVar9;
			}
		}
		ppcVar6 = ppcVar6 + 1;
		RVar9 += RESOURCE_MESH;
	} while (ppcVar6 < globals::g_ResourceExts_TABLE);
	return RESOURCE__INVALID;
}



void __cdecl lego::pool::ReservedPool_ResourceData___Alloc(void)
{
	ResourceData *pRVar1;
	ResourceData *pRVar2;
	int iVar3;
	uint uVar4;
	
	uVar4 = 1 << ((byte)globals::ReservedPool_ResourceData___g_COUNT & 0x1f);
	pRVar2 = (ResourceData *)std::malloc(uVar4 * 0x2c);
	globals::ReservedPool_ResourceData___g_TABLE[globals::ReservedPool_ResourceData___g_COUNT] =
			 pRVar2;
	pRVar2 = globals::ReservedPool_ResourceData___g_TABLE
					 [globals::ReservedPool_ResourceData___g_COUNT];
	if (pRVar2 != NULL) {
		globals::ReservedPool_ResourceData___g_COUNT += 1;
		if (1 < uVar4) {
			iVar3 = uVar4 - 1;
			pRVar1 = pRVar2;
			do {
				pRVar1->pool_m_next = pRVar1 + 1;
				iVar3 += -1;
				pRVar1 = pRVar1 + 1;
			} while (iVar3 != 0);
		}
		pRVar2[uVar4 - 1].pool_m_next = globals::ReservedPool_ResourceData___g_NEXT;
		globals::ReservedPool_ResourceData___g_NEXT = pRVar2;
	}
	return;
}



// WARNING: Exceeded maximum restarts with more pending

undefined ** __cdecl FUN_00475d30(ResourceData *resData,int param_2,int param_3,undefined4 param_4)
{
	IDirect3DRMFrame3 *rmFrame3;
	int iVar1;
	char *lpName;
	ActFrameResource *pAVar2;
	uint uVar3;
	int unaff_EBP;
	ResourceData *pRVar4;
	uint uVar5;
	IUnknown *pIVar6;
	ActFrameResource **ppAVar7;
	ResourceData *unaff_retaddr;
	int **ppiStack56;
	IUnknown *local_20;
	IDirect3DRMFrame3 *local_1c;
	int *local_18;
	IDirect3DRMFrame3 *local_14;
	uint local_10;
	uint local_c;
	uint local_8;
	
	pIVar6 = NULL;
	local_20 = NULL;
	local_1c = NULL;
	if (resData->resType == RESOURCE_ACT) {
		local_c = 0;
		pRVar4 = resData;
		do {
			uVar5 = local_c;
			if (local_c == 0) {
				local_14 = pRVar4->frame2;
			}
			if (local_c == 1) {
				local_14 = pRVar4->frame3;
			}
			ppiStack56 = &local_18;
			iVar1 = (*(code *)local_14->lpVtbl->GetChildren)();
			if (iVar1 == 0) {
				ppiStack56 = (int **)local_18;
				local_8 = (**(code **)(*local_18 + 0xc))();
				uVar3 = 0;
				if (local_8 != 0) {
					local_c = param_3 - param_2;
					ppAVar7 = (ActFrameResource **)(param_2 + (int)pIVar6 * 4);
					pRVar4 = unaff_retaddr;
					do {
						rmFrame3 = local_1c;
						uVar5 = uVar3;
						(*local_1c->lpVtbl->AddDestroyCallback)();
						(*local_20->lpVtbl->QueryInterface)
											(local_20,(IID *)&idl::IID_IDirect3DRMFrame3,(LPVOID *)&stack0xffffffcc);
						(*local_20->lpVtbl->Release)(local_20);
						(**(code **)((int)*ppiStack56 + 0x24))(ppiStack56,&stack0xffffffcc,0);
						if (uVar5 != 0) {
							lpName = (char *)std::malloc(uVar5);
							(*rmFrame3->lpVtbl->GetName)((IUnknown *)rmFrame3,(LPDWORD)&stack0xffffffc0,lpName);
							iVar1 = std::_strnicmp(lpName,"ActFrame",8);
							if (iVar1 == 0) {
								if (local_18 != NULL) {
									*(IDirect3DRMFrame3 **)
									 ((int)&((ResourceData *)((int)resData - param_2))->frame1 + (int)ppAVar7) =
											 rmFrame3;
								}
								if (local_14 != NULL) {
									pAVar2 = lego::res::Res_GetAppData_ActFrame(rmFrame3);
									*ppAVar7 = pAVar2;
								}
								if (local_10 != 0) {
									*(char **)(unaff_EBP + (int)ppAVar7) = lpName;
								}
								ppAVar7 = ppAVar7 + 1;
								if (local_10 != 0) goto LAB_00475e74;
							}
							std::free(lpName);
						}
LAB_00475e74:
						(*rmFrame3->lpVtbl->Release)((IUnknown *)rmFrame3);
						uVar3 += 1;
						uVar5 = local_10;
						pIVar6 = local_20;
						unaff_retaddr = pRVar4;
					} while (uVar3 < local_8);
				}
				(*local_1c->lpVtbl->Release)();
			}
			local_c = uVar5 + 1;
		} while (local_c < 2);
	}
	return (undefined **)pIVar6;
}



void __cdecl
lego::res::Res_InitResourceSubdata
					(ResourceData *resData,char *name,IDirect3DRMLight *rmLight,IDirect3DRMMesh *rmMesh,
					Struct_34 *unk_lwo)
{
	ResourceSubdata *pRVar1;
	
	if (resData->subdata_c == NULL) {
		pRVar1 = (ResourceSubdata *)std::malloc(0x10);
		resData->subdata_c = pRVar1;
		pRVar1->name = name;
		resData->subdata_c->light = rmLight;
		resData->subdata_c->mesh = rmMesh;
		resData->subdata_c->struct34_c = unk_lwo;
	}
	else {
		if (name != NULL) {
			resData->subdata_c->name = name;
		}
		if (rmLight != NULL) {
			resData->subdata_c->light = rmLight;
		}
		if (rmMesh != NULL) {
			resData->subdata_c->mesh = rmMesh;
		}
		if (unk_lwo != NULL) {
			resData->subdata_c->struct34_c = unk_lwo;
			return;
		}
	}
	return;
}



void __cdecl FUN_00475f40(ResourceData *resData)
{
	ResourceSubdata *pRVar1;
	ResourceType RVar2;
	IDirect3DRMMesh *This;
	
	pRVar1 = resData->subdata_c;
	if (pRVar1 != NULL) {
		RVar2 = resData->resType;
		if (RVar2 == RESOURCE_ACT) {
			std::free(pRVar1->name);
		}
		else {
			if (RVar2 == RESOURCE_LIGHT) {
				(*pRVar1->light->lpVtbl->Release)((IUnknown *)pRVar1->light);
			}
			else {
				if (RVar2 == RESOURCE_MESH) {
					if (pRVar1->mesh != NULL) {
						(*(code *)resData->frame2->lpVtbl->DeleteVisual)(resData->frame2,pRVar1->mesh);
						This = resData->subdata_c->mesh;
						(*This->lpVtbl->Release)((IUnknown *)This);
					}
				}
				else {
					if ((RVar2 == RESOURCE_LWO) && (pRVar1->struct34_c != NULL)) {
						FUN_00482390(pRVar1->struct34_c,resData->frame2);
					}
				}
			}
		}
		std::free(resData->subdata_c);
		resData->subdata_c = NULL;
	}
	return;
}



BOOL __cdecl
lego::res::Res_LoadActFrameResource
					(ResourceData *resData,char *filename,char *frameName,undefined4 *param_4,int param_5,
					int param_6,ActFrameResource *lastActFrameRes,BOOL isLWSFile,BOOL isLooping)
{
	HRESULT HVar1;
	ActFrameResource *actFrameRes;
	IDirect3DRMFrame3 *local_208;
	uint local_204;
	char local_200 [512];
	
	std::sprintf(local_200,"%s.%s",filename,globals::g_ResourceExts_TABLE[3]);
	HVar1 = (*globals::g_IDirect3DRM3->lpVtbl->CreateFrame)
										(globals::g_IDirect3DRM3,resData->frame3,&local_208);
	if (HVar1 == 0) {
		Res_SetActFrameName(local_208,"%s_%s","ActFrame",frameName);
		if (lastActFrameRes == NULL) {
			actFrameRes = Res_ReadActFrameResource(local_200,local_208,&local_204,isLWSFile,isLooping);
		}
		else {
			actFrameRes = Res_InitActFrameResource(lastActFrameRes,local_208,&local_204);
		}
		Res_InitResourceAppData
							(local_208,resData,actFrameRes,filename,(int *)&local_204,NULL,NULL,(float *)&param_4,
							 (int *)param_6,NULL,&param_5);
		return 1;
	}
	return 0;
}



void __cdecl lego::res::Res_DestroyAppDataCallback(IDirect3DRMFrame3 *rmFrame3)
{
	ResourceData *pRVar1;
	
	pRVar1 = Res_GetAppData_Resource(rmFrame3);
	if (pRVar1 != NULL) {
		pRVar1->flags = pRVar1->flags | RESDATA_UNK_10;
		Res_FreeResourceAppData(rmFrame3);
	}
	return;
}



// WARNING: Could not reconcile some variable overlaps

IDirect3DRMFrame3 * __cdecl
lego::res::Res_GetActFrameChildByName(ResourceData *resData,char *frameName,BOOL use3rdFrame)
{
	int *piVar1;
	int iVar2;
	IDirect3DRMFrameArray *pIVar3;
	char *lpName;
	int *unaff_EBX;
	int *unaff_EBP;
	IDirect3DRMFrame3 *pIVar4;
	IDirect3DRMFrame3 *unaff_EDI;
	IDirect3DRMFrameArray *pIVar5;
	int *piStack572;
	IDirect3DRMFrameArray *pIStack568;
	undefined *puStack564;
	int *piStack560;
	IDirect3DRMFrame3 *pIStack556;
	IDirect3DRMFrameArray **ppIStack552;
	IDirect3DRMFrame3 *pIVar6;
	IDirect3DRMFrame3 *rmFrame3;
	IDirect3DRMFrameArray *rmArray;
	IUnknown *rmFrameBase;
	uint dwNameSize;
	uint dwSize;
	char nameBuffer [512];
	
	pIVar4 = NULL;
	if (use3rdFrame == 0) {
		pIStack556 = resData->frame2;
	}
	else {
		pIStack556 = resData->frame3;
	}
	ppIStack552 = &rmArray;
										// IDirect3DRMFrame3->GetChildren(this, IDirect3DRMFrameArray** lplpChildren)
	piStack560 = (int *)0x476135;
	piVar1 = unaff_EBX;
	iVar2 = (*(code *)pIStack556->lpVtbl->GetChildren)();
	piStack560 = piVar1;
	if (iVar2 == 0) {
										// DWORD IDirect3DRMFrameArray->GetSize(this)
		puStack564 = (undefined *)0x476147;
		pIVar3 = (IDirect3DRMFrameArray *)(**(code **)(*piStack560 + 0xc))();
		pIVar5 = NULL;
		piStack572 = unaff_EBP;
		rmArray = pIVar3;
		if (pIVar3 != NULL) {
			do {
				puStack564 = &stack0xfffffde8;
										// IDirect3DRMFrameArray->GetElement(this, DWORD index, IDirect3DRMFrame**
										// lplpD3DRMFrame)
				pIStack568 = pIVar5;
				unaff_EBP = piStack572;
				(**(code **)(*piStack572 + 0x10))();
										// IDirect3DRMFrame->QueryInterface(this, IID_IDirect3DRMFrame3,
										// IDirect3DRMFrame3** lplpOut)
				pIVar6 = unaff_EDI;
				(*unaff_EDI->lpVtbl->QueryInterface)
									((IUnknown *)unaff_EDI,(IID *)&idl::IID_IDirect3DRMFrame3,&pIStack556);
										// IDirect3DRMFrame->Release(this)
				(**(code **)(*piStack560 + 8))(piStack560);
										// IDirect3DRMFrame3->GetName(this, DWORD* lpdwSize, LPSTR lpName)
				(**(code **)(*piStack572 + 0x24))(piStack572,&piStack560,0);
				if (piStack572 != NULL) {
					lpName = (char *)std::malloc((int)piStack572 + 1);
										// IDirect3DRMFrame3->GetName(this, DWORD* lpdwSize, LPSTR lpName)
					(*unaff_EDI->lpVtbl->GetName)((IUnknown *)unaff_EDI,(LPDWORD)&piStack572,lpName);
					std::sprintf((char *)&puStack564,"%s_%s","ActFrame",nameBuffer._508_4_);
					iVar2 = std::_stricmp(lpName,(char *)&puStack564);
					if (iVar2 == 0) {
						pIVar4 = unaff_EDI;
					}
					std::free(lpName);
					pIVar3 = pIStack568;
				}
										// IDirect3DRMFrame3->Release(this)
				(*unaff_EDI->lpVtbl->Release)((IUnknown *)unaff_EDI);
			} while ((pIVar4 == NULL) &&
							(pIVar5 = (IDirect3DRMFrameArray *)((int)&pIVar5->lpVtbl + 1), unaff_EDI = pIVar6,
							piStack572 = unaff_EBP, pIVar5 < pIVar3));
		}
										// IDirect3DRMFrameArray->Release(this)
		pIStack568 = (IDirect3DRMFrameArray *)0x47621c;
		(**(code **)(*unaff_EBP + 8))();
	}
	return pIVar4;
}



// WARNING: Type propagation algorithm not settling

void __cdecl
lego::res::Res_InitResourceAppData
					(IDirect3DRMFrame3 *rmFrame3,ResourceData *resData,ActFrameResource *actFrameRes,
					char *filename,int *param_5,char *frameName,float *param_7,float *param_8,int *param_9,
					SoundResource *soundRes,undefined4 *param_11)
{
	ActFrameResource **ppAVar1;
	ResourceAppData *appData;
	char *pcVar2;
	uint uVar3;
	uint uVar4;
	ActFrameResource *pAVar5;
	
	appData = (ResourceAppData *)(*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	if (appData == NULL) {
		appData = (ResourceAppData *)std::malloc(0x28);
		appData->actFrameRes = (ActFrameResource *)resData;
		appData->resData = (ResourceData *)rmFrame3;
		appData->filename = NULL;
		if (filename == NULL) {
			appData->field_c = 0;
		}
		else {
			appData->field_c = *(undefined4 *)filename;
		}
		appData->frameName = (char *)param_5;
		if (frameName == NULL) {
			appData->float_10 = 0.0;
		}
		else {
			appData->float_10 = *(float *)frameName;
		}
		if (param_7 == NULL) {
			appData->float_14 = 0.0;
		}
		else {
			appData->float_14 = *param_7;
		}
		if (soundRes == NULL) {
			appData->field_20 = 0;
		}
		else {
			appData->field_20 = soundRes->sound3dBuffer;
		}
		appData->sampleName = (char *)param_8;
		appData->soundRes = (SoundResource *)param_9;
		(*rmFrame3->lpVtbl->SetAppData)((IUnknown *)rmFrame3,(DWORD)appData);
	}
	else {
		if (rmFrame3 != NULL) {
			appData->resData = (ResourceData *)rmFrame3;
		}
		if (resData != NULL) {
			appData->actFrameRes = (ActFrameResource *)resData;
		}
		if ((actFrameRes != NULL) && (appData->filename != NULL)) {
			std::free(appData->filename);
		}
		if (filename != NULL) {
			appData->field_c = *(undefined4 *)filename;
		}
		if (param_5 != NULL) {
			appData->frameName = (char *)param_5;
		}
		if (frameName != NULL) {
			appData->float_10 = *(float *)frameName;
		}
		if (param_7 != NULL) {
			appData->float_14 = *param_7;
		}
		if (param_8 != NULL) {
			appData->sampleName = (char *)param_8;
		}
		if (param_9 != NULL) {
			appData->soundRes = (SoundResource *)param_9;
		}
		if (soundRes != NULL) {
			appData->field_20 = soundRes->sound3dBuffer;
		}
	}
	if (actFrameRes != NULL) {
		uVar3 = 0xffffffff;
		pAVar5 = actFrameRes;
		do {
			if (uVar3 == 0) break;
			uVar3 -= 1;
			ppAVar1 = &pAVar5->previous;
			pAVar5 = (ActFrameResource *)((int)&pAVar5->previous + 1);
		} while (*(char *)ppAVar1 != '\0');
		pcVar2 = (char *)std::malloc(~uVar3);
		uVar3 = 0xffffffff;
		appData->filename = pcVar2;
		do {
			pAVar5 = actFrameRes;
			if (uVar3 == 0) break;
			uVar3 -= 1;
			pAVar5 = (ActFrameResource *)((int)&actFrameRes->previous + 1);
			ppAVar1 = &actFrameRes->previous;
			actFrameRes = pAVar5;
		} while (*(char *)ppAVar1 != '\0');
		uVar3 = ~uVar3;
		pAVar5 = (ActFrameResource *)((int)pAVar5 - uVar3);
		for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
			*(ActFrameResource **)pcVar2 = pAVar5->previous;
			pAVar5 = (ActFrameResource *)&pAVar5->lwsStruct38;
			pcVar2 = pcVar2 + 4;
		}
		for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
			*pcVar2 = *(char *)&pAVar5->previous;
			pAVar5 = (ActFrameResource *)((int)&pAVar5->previous + 1);
			pcVar2 = pcVar2 + 1;
		}
	}
	return;
}



void __cdecl lego::res::Res_FreeResourceAppData(IDirect3DRMFrame3 *rmFrame3)
{
	ResourceAppData *appData;
	
	appData = (ResourceAppData *)(*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	if (appData != NULL) {
		if (appData->filename != NULL) {
			std::free(appData->filename);
		}
		std::free(appData);
	}
	(*rmFrame3->lpVtbl->SetAppData)((IUnknown *)rmFrame3,0);
	return;
}



// ACCESSOR FUNCTION: ResourceAppData->resData (field_0)

ResourceData * __cdecl lego::res::Res_GetAppData_Resource(IDirect3DRMFrame3 *rmFrame3)
{
	ResourceAppData *appData;
	
	appData = (ResourceAppData *)(*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	if (appData != NULL) {
		return appData->resData;
	}
	return NULL;
}



// ACCESSOR FUNCTION: ResourceAppData->filename (field_4)

char * __cdecl lego::res::Res_GetAppData_Filename(IDirect3DRMFrame3 *rmFrame3)
{
	ResourceAppData *appData;
	
	appData = (ResourceAppData *)(*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	if (appData != NULL) {
		return appData->filename;
	}
	return NULL;
}



// ACCESSOR FUNCTION: ResourceAppData->actFrameRes (field_1c)

ActFrameResource * __cdecl lego::res::Res_GetAppData_ActFrame(IDirect3DRMFrame3 *rmFrame3)
{
	ResourceAppData *appData;
	
	appData = (ResourceAppData *)(*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	if (appData != NULL) {
		return appData->actFrameRes;
	}
	return NULL;
}



// ACCESSOR FUNCTION: ResourceAppData->field_c (field_c)

undefined4 __cdecl lego::res::Res_GetAppData_Fieldc(IDirect3DRMFrame3 *rmFrame3)
{
	ResourceAppData *appData;
	
	appData = (ResourceAppData *)(*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	if (appData != NULL) {
		return appData->field_c;
	}
	return 0;
}



// ACCESSOR FUNCTION: ResourceAppData->float_10 (field_10)

float10 __cdecl lego::res::Res_GetAppData_Float10(IDirect3DRMFrame3 *rmFrame3)
{
	ResourceAppData *appData;
	
	appData = (ResourceAppData *)(*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	if (appData != NULL) {
		return (float10)appData->float_10;
	}
	return (float10)0.0;
}



// ACCESSOR FUNCTION: ResourceAppData->float_14 (field_14)

float10 __cdecl lego::res::Res_GetAppData_Float14(IDirect3DRMFrame3 *rmFrame3)
{
	ResourceAppData *appData;
	
	appData = (ResourceAppData *)(*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	if (appData != NULL) {
		return (float10)appData->float_14;
	}
	return (float10)0.0;
}



// ACCESSOR FUNCTION: ResourceAppData->sampleName (field_18)

char * __cdecl lego::res::Res_GetAppData_SampleName(IDirect3DRMFrame3 *rmFrame3)
{
	ResourceAppData *appData;
	
	appData = (ResourceAppData *)(*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	if (appData != NULL) {
		return appData->sampleName;
	}
	return NULL;
}



// ACCESSOR FUNCTION: ResourceAppData->field_20 (field_20)

undefined4 __cdecl lego::res::Res_GetAppData_Field20(IDirect3DRMFrame3 *rmFrame3)
{
	ResourceAppData *appData;
	
	appData = (ResourceAppData *)(*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	if (appData != NULL) {
		return appData->field_20;
	}
	return 0;
}



void __cdecl lego::res::Res_AddTransform3DFrame(IDirect3DRMFrame3 *frame1,IDirect3DRMFrame3 *frame2)
{
	IDirect3DRMFrame3 *this;
	Matrix4F matrix;
	
	this = frame2;
										// IDirect3DRMFrame3->GetParent(this, IDirect3DRMFrame3** lplpParent)
	(*(code *)frame2->lpVtbl->GetParent)(frame2,&frame2);
										// IDirect3DRMFrame3->GetTransform(this, IDirect3DRMFrame3* lpRefFrame,
										// Matrix4F** rmMatrix)
										// (this = frame2, lpRefFrame = GetParent)
	(*(code *)this->lpVtbl->GetTransform)(this,frame2,(Matrix4F **)&matrix);
	if (frame2 != NULL) {
										// IDirect3DRMFrame3->Release(this)
										//  (this = GetParent)
		(*frame2->lpVtbl->Release)((IUnknown *)frame2);
	}
										// IDirect3DRMFrame3->AddChild(this, IDirect3DRMFrame3* lpD3DRMFrameChild)
										//  (this = frame1, lpChild = frame2)
	(*(code *)frame1->lpVtbl->AddChild)(frame1,this);
										// IDirect3DRMFrame3->AddTransform(this, TD3DRMCombineType rctCombine, Matrix4F*
										// rmMatrix)
										//  (this = frame2)
	(*(code *)this->lpVtbl->AddTransform)(this,D3DRMCOMBINE_REPLACE,&matrix);
	return;
}



void __cdecl lego::res::Res_SetActFrameName(IDirect3DRMFrame3 *rmFrame3,char *format,...)
{
	int iVar1;
	char *frameName;
	char local_400 [1024];
	
	iVar1 = std::vsprintf(local_400,format,&stack0x0000000c);
	frameName = (char *)std::malloc(iVar1 + 1);
	std::vsprintf(frameName,format,&stack0x0000000c);
	(*rmFrame3->lpVtbl->SetName)((IUnknown *)rmFrame3,frameName);
	Res_InitResourceAppData(rmFrame3,NULL,NULL,NULL,NULL,frameName,NULL,NULL,NULL,NULL,NULL);
	return;
}



void __cdecl FUN_004765b0(int *param_1)
{
	void *buffer;
	
	buffer = (void *)FUN_004765d0(param_1);
	if (buffer != NULL) {
		std::free(buffer);
	}
	return;
}



undefined4 __cdecl FUN_004765d0(int *param_1)
{
	int iVar1;
	
	iVar1 = (**(code **)(*param_1 + 0x1c))(param_1);
	if (iVar1 != 0) {
		return *(undefined4 *)(iVar1 + 8);
	}
	return 0;
}



int * __cdecl
FUN_004765f0(IDirect3DRMFrame3 *rmFrame3,undefined4 param_2,undefined *someFunction,
						undefined4 param_4)
{
	IDirect3DRMFrame3 *pIVar1;
	undefined *someFunction_00;
	undefined4 uVar2;
	int iVar3;
	uint uVar4;
	int *piVar5;
	code **unaff_EBX;
	uint uVar6;
	IDirect3DRMFrame3 *unaff_EDI;
	int *local_8;
	int *local_4;
	
	uVar2 = param_4;
	someFunction_00 = someFunction;
	pIVar1 = rmFrame3;
	local_8 = NULL;
	iVar3 = (*(code *)someFunction)(rmFrame3,param_4);
	if (iVar3 != 0) {
		return (int *)(IDirect3DRMFrame3 *)0x1;
	}
	(*(code *)pIVar1->lpVtbl->GetChildren)(pIVar1,&rmFrame3);
	uVar4 = (**(code **)(*local_4 + 0xc))(local_4);
	uVar6 = 0;
	if (uVar4 != 0) {
		do {
			(**(code **)(*local_8 + 0x10))(local_8,uVar6,register0x00000010);
			(**(code **)*unaff_EBX)(unaff_EBX,&idl::IID_IDirect3DRMFrame3,&local_8);
			(*unaff_EDI->lpVtbl->Release)((IUnknown *)unaff_EDI);
			piVar5 = FUN_004765f0(unaff_EDI,(int)local_4 + 1,someFunction_00,uVar2);
			if (piVar5 != NULL) {
				(*unaff_EDI->lpVtbl->Release)((IUnknown *)unaff_EDI);
				break;
			}
			(*unaff_EDI->lpVtbl->Release)((IUnknown *)unaff_EDI);
			uVar6 += 1;
		} while (uVar6 < uVar4);
	}
	(**(code **)(*local_8 + 8))(local_8);
	return (int *)unaff_EDI;
}



BOOL __cdecl FUN_004766d0(IDirect3DRMFrame3 *param_1,byte **param_2)
{
	byte bVar1;
	IDirect3DRMFrame3 *This;
	byte **ppbVar2;
	byte *lpName;
	uint uVar3;
	byte *pbVar4;
	int iVar5;
	uint unaff_EBP;
	byte *pbVar6;
	bool bVar7;
	
	This = param_1;
	(*param_1->lpVtbl->GetName)((IUnknown *)param_1,(LPDWORD)&param_1,NULL);
	ppbVar2 = param_2;
	if ((byte *)((int)&param_1[-1].lpVtbl + 3) != param_2[1]) {
		return 0;
	}
	lpName = (byte *)std::malloc((uint)param_1);
	*lpName = 0;
	(*This->lpVtbl->GetName)((IUnknown *)This,(LPDWORD)&param_1,(LPSTR)lpName);
	uVar3 = 0;
	if (unaff_EBP != 0) {
		do {
			if ((*ppbVar2)[uVar3] == 0x3f) {
				lpName[uVar3] = 0x3f;
			}
			uVar3 += 1;
		} while (uVar3 < unaff_EBP);
	}
	pbVar6 = ppbVar2[5];
	if (pbVar6 == NULL) {
		ppbVar2[3] = NULL;
		if (ppbVar2[2] == NULL) {
			iVar5 = std::_stricmp((char *)lpName,(char *)*ppbVar2);
		}
		else {
			pbVar6 = *ppbVar2;
			pbVar4 = lpName;
			do {
				bVar1 = *pbVar4;
				bVar7 = bVar1 < *pbVar6;
				if (bVar1 != *pbVar6) {
LAB_0047676f:
					if (1 - bVar7 != (uint)(bVar7 != 0)) goto LAB_00476856;
					goto LAB_00476853;
				}
				if (bVar1 == 0) break;
				bVar1 = pbVar4[1];
				bVar7 = bVar1 < pbVar6[1];
				if (bVar1 != pbVar6[1]) goto LAB_0047676f;
				pbVar4 = pbVar4 + 2;
				pbVar6 = pbVar6 + 2;
			} while (bVar1 != 0);
			iVar5 = 0;
		}
		if (iVar5 != 0) goto LAB_00476856;
	}
	else {
		if (pbVar6 == (byte *)0x1) {
			if (ppbVar2[2] == NULL) {
				iVar5 = std::_stricmp((char *)lpName,(char *)*ppbVar2);
			}
			else {
				pbVar6 = *ppbVar2;
				pbVar4 = lpName;
				do {
					bVar1 = *pbVar4;
					bVar7 = bVar1 < *pbVar6;
					if (bVar1 != *pbVar6) {
LAB_004767d0:
						if (1 - bVar7 == (uint)(bVar7 != 0)) {
							ppbVar2[4] = ppbVar2[4] + 1;
						}
						goto LAB_00476856;
					}
					if (bVar1 == 0) break;
					bVar1 = pbVar4[1];
					bVar7 = bVar1 < pbVar6[1];
					if (bVar1 != pbVar6[1]) goto LAB_004767d0;
					pbVar4 = pbVar4 + 2;
					pbVar6 = pbVar6 + 2;
				} while (bVar1 != 0);
				iVar5 = 0;
			}
			if (iVar5 == 0) {
				ppbVar2[4] = ppbVar2[4] + 1;
			}
			goto LAB_00476856;
		}
		if (pbVar6 != (byte *)0x2) goto LAB_00476856;
		ppbVar2[3] = NULL;
		if (ppbVar2[2] == NULL) {
			iVar5 = std::_stricmp((char *)lpName,(char *)*ppbVar2);
		}
		else {
			pbVar6 = *ppbVar2;
			pbVar4 = lpName;
			do {
				bVar1 = *pbVar4;
				bVar7 = bVar1 < *pbVar6;
				if (bVar1 != *pbVar6) {
LAB_0047682a:
					iVar5 = (1 - (uint)bVar7) - (uint)(bVar7 != 0);
					goto joined_r0x00476843;
				}
				if (bVar1 == 0) break;
				bVar1 = pbVar4[1];
				bVar7 = bVar1 < pbVar6[1];
				if (bVar1 != pbVar6[1]) goto LAB_0047682a;
				pbVar4 = pbVar4 + 2;
				pbVar6 = pbVar6 + 2;
			} while (bVar1 != 0);
			iVar5 = 0;
		}
joined_r0x00476843:
		if (iVar5 == 0) {
			ppbVar2[4] = ppbVar2[4] + 1;
		}
		if (ppbVar2[4] != ppbVar2[6] + 1) goto LAB_00476856;
	}
LAB_00476853:
	ppbVar2[3] = (byte *)This;
LAB_00476856:
	std::free(lpName);
	if (ppbVar2[3] == NULL) {
		return 0;
	}
	return 1;
}



ActFrameResource * __cdecl
lego::res::Res_ReadActFrameResource
					(char *filename,IDirect3DRMFrame3 *rmFrame3,uint *out_param_3,BOOL isLWSFile,
					BOOL isLooping)
{
	char cVar1;
	undefined4 *puVar2;
	HRESULT HVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	IDirect3DRMFrame3 *unaff_EBX;
	ActFrameResource *pAVar7;
	IDirect3DRMAnimationSet2 *unaff_EBP;
	undefined4 *puVar8;
	char *pcVar9;
	char *local_11c;
	IDirect3DRMFrame3 *local_118;
	byte *local_114;
	uint local_110 [2];
	char acStack263 [3];
	char local_104 [260];
	
	pAVar7 = NULL;
	local_11c = NULL;
	if (isLWSFile == 0) {
		local_114 = lego::file::File_ReadAllBytes(filename,local_110);
		if (local_114 != NULL) {
										// IDirect3DRM3->CreateFrame(this, IDirect3DRMFrame3* lpD3DRMFrame,
										// IDirect3DRMFrame3** lplpD3DRMFrame)
			HVar3 = (*globals::g_IDirect3DRM3->lpVtbl->CreateFrame)
												(globals::g_IDirect3DRM3,rmFrame3,&local_118);
			if (HVar3 == 0) {
										// IDirect3DRM3->CreateAnimationSet(this, IDirect3DRMAnimationSet2**
										// lplpD3DRMAnimationSet)
				iVar4 = (*(code *)globals::g_IDirect3DRM3->lpVtbl->CreateAnimationSet)
													(globals::g_IDirect3DRM3,&local_11c);
				if (iVar4 == 0) {
					local_114 = (byte *)filename;
					local_110[0] = 0;
										// IDirect3DRMAnimationSet2->Load(this, void* lpvObjSource, void* lpvObjID,
										// TD3DRMLoadOptions drd3mLOFlags, TD3DRMLoadTexture3Callback
										// d3drmLoadTextureProc, void* lpArgLTP, IDirect3DRMFrame3* lpParentFrame)
					iVar4 = (*(code *)unaff_EBP->lpVtbl->Load)
														(unaff_EBP,&local_11c,0,2,Res_LoadD3DRMTexture3Callback,&local_114,
														 unaff_EBX);
					if (iVar4 == 0) {
										// IDirect3DRMAnimationSet2->SetTime(this, float rvTime)
						(*(code *)unaff_EBP->lpVtbl->SetTime)(unaff_EBP,0);
						iVar4 = FUN_00476a30(local_11c);
						if (filename != NULL) {
							*(int *)filename = iVar4;
						}
						pAVar7 = Res_AllocActFrameResource_Mode0(unaff_EBP,unaff_EBX,iVar4);
					}
					std::free(local_11c);
				}
										// IDirect3DRMFrame3->Release(this)
				(*unaff_EBX->lpVtbl->Release)((IUnknown *)unaff_EBX);
			}
		}
	}
	else {
		uVar5 = 0xffffffff;
		do {
			pcVar9 = filename;
			if (uVar5 == 0) break;
			uVar5 -= 1;
			pcVar9 = filename + 1;
			cVar1 = *filename;
			filename = pcVar9;
		} while (cVar1 != '\0');
		uVar5 = ~uVar5;
		puVar2 = (undefined4 *)(pcVar9 + -uVar5);
		puVar8 = (undefined4 *)local_104;
		for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
			*puVar8 = *puVar2;
			puVar2 = puVar2 + 1;
			puVar8 = puVar8 + 1;
		}
		for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
			*(undefined *)puVar8 = *(undefined *)puVar2;
			puVar2 = (undefined4 *)((int)puVar2 + 1);
			puVar8 = (undefined4 *)((int)puVar8 + 1);
		}
		uVar5 = 0xffffffff;
		pcVar9 = local_104;
		do {
			if (uVar5 == 0) break;
			uVar5 -= 1;
			cVar1 = *pcVar9;
			pcVar9 = pcVar9 + 1;
		} while (cVar1 != '\0');
		acStack263[~uVar5] = '\0';
		puVar2 = Res_OpenLWS(local_104,isLooping);
		if (puVar2 != NULL) {
			FUN_00487c50((ushort *)puVar2,rmFrame3);
			FUN_00487e60(puVar2,0.0);
			if (out_param_3 != NULL) {
				uVar5 = unk::Lego_GetFieldByte2((int)puVar2);
				*out_param_3 = uVar5;
			}
			pAVar7 = Res_AllocActFrameResource_Mode1(puVar2,rmFrame3,*out_param_3);
			return pAVar7;
		}
	}
	return pAVar7;
}



int __cdecl FUN_00476a30(char *param_1)
{
	byte *text;
	uint uVar1;
	int iVar2;
	
	iVar2 = 0;
	text = (byte *)std::strstr(param_1,"DDiScene");
	if (text != NULL) {
		while( true ) {
			if (std::globals::g_CharWidth_1__004b0f74 < 2) {
				uVar1 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + (uint)*text * 2) & 4;
			}
			else {
				uVar1 = std::_unk_FUN_0048f490((uint)*text,4);
			}
			if (uVar1 != 0) break;
			text = text + 1;
		}
		iVar2 = std::atoi((char *)text);
	}
	if (iVar2 == 0) {
		iVar2 = 1;
	}
	return iVar2;
}



BOOL __cdecl lego::res::Res_CreateFrame(char *filename,IDirect3DRMFrame3 *rmFrame3)
{
	int iVar1;
	uint uVar2;
	void *buffer;
	byte *local_10;
	uint local_c;
	char *local_8;
	undefined4 local_4;
	
	uVar2 = 0;
	local_10 = lego::file::File_ReadAllBytes(filename,&local_c);
	if (local_10 != NULL) {
		buffer = NULL;
		local_8 = filename;
		local_4 = 0;
		iVar1 = (*(code *)rmFrame3->lpVtbl->Load)
											(rmFrame3,&local_10,0,2,Res_LoadD3DRMTexture3Callback,&local_8);
		uVar2 = (uint)(iVar1 == 0);
		std::free(buffer);
	}
	return uVar2;
}



// WARNING: Restarted to delay deadcode elimination for space: stack

IDirect3DRMMesh * __cdecl
lego::res::Res_CreateMesh
					(void *fileData,uint fileSize,char *filename,IDirect3DRMFrame3 *rmFrame3,BOOL param_5)
{
	int iVar1;
	int *piVar2;
	IDirect3DRM3 *pIStack24;
	void **ppvStack20;
	undefined local_10 [8];
	void *local_8;
	int *local_4;
	
	local_8 = fileData;
	local_4 = (int *)fileSize;
	ppvStack20 = &fileData;
	pIStack24 = globals::g_IDirect3DRM3;
										// IDirect3DRM3->CreateMeshBuilder(this, IDirect3DRMMeshBuilder3**
										// lplpD3DRMMeshBuilder)
	ppvStack20 = (void **)(*(code *)globals::g_IDirect3DRM3->lpVtbl->CreateMeshBuilder)();
	if (ppvStack20 == NULL) {
		pIStack24 = (IDirect3DRM3 *)fileData;
		if (filename != NULL) {
			ppvStack20 = (void **)0x1;
		}
		piVar2 = (int *)0x2;
										// IDirect3DRMMeshBuilder3->Load(this, void* lpvObjSource, void* lpvObjID,
										// TD3DRMLoadOptions d3drmLOFlags, TD3DRMLoadTexture3Callback
										// d3drmLoadTextureProc, void* lpvArg)
										//   D3DRMLOAD_FROMMEMORY (0x2)
		iVar1 = (**(code **)(*local_4 + 0x2c))(local_4,local_10,0,2,Res_LoadD3DRMTexture3Callback);
		if (iVar1 == 0) {
										// IDirect3DRMMeshBuilder3->CreateMesh(this, IDirect3DRMMesh** lplpD3DRMMesh)
			(*(code *)pIStack24[0x30].lpVtbl)(&pIStack24,&pIStack24);
			(**(code **)(*piVar2 + 8))(piVar2);
										// IDirect3DRMFrame3->AddVisual(this, IDirect3DRMVisual* lpD3DRMVisual)
			iVar1 = (*(code *)pIStack24[0x12].lpVtbl)(&pIStack24,piVar2);
			if (iVar1 == 0) {
				return (IDirect3DRMMesh *)pIStack24;
			}
		}
		(*(code *)pIStack24[2].lpVtbl)(&pIStack24);
	}
	return NULL;
}



HRESULT __cdecl
lego::res::Res_LoadD3DRMTexture3Callback
					(char *tex_name,char **param_2,IDirect3DRMTexture3 **lplpD3DRMTex)
{
	byte bVar1;
	IDirect3DRMTexture3 *pIVar2;
	char cVar3;
	byte *pbVar4;
	DirectXSurfaceTuple *pDVar5;
	char **ppcVar6;
	uint uVar7;
	int iVar8;
	uint uVar9;
	uint uVar10;
	char *pcVar11;
	char *pcVar12;
	SharedTextureResource *pSVar13;
	undefined4 *puVar14;
	byte *pbVar15;
	char **ppcVar16;
	char *pcVar17;
	char *pcVar18;
	char *pcVar19;
	undefined4 *puVar20;
	char **ppcVar21;
	bool bVar22;
	char *local_410;
	char *local_40c;
	int local_408;
	char *local_404;
	char local_400 [1024];
	
	if ((*(byte *)(param_2 + 1) & 1) == 0) {
		pcVar12 = *param_2;
		pcVar11 = local_400;
		local_410 = NULL;
		local_40c = pcVar12;
		local_404 = pcVar11;
		local_408 = 0;
		if ((globals::g_SharedTextures != NULL) != 0xffffffff) {
LAB_00476c0f:
			if (local_408 == 0) {
				cVar3 = *pcVar12;
				if (cVar3 != '\0') {
					do {
						if (cVar3 == '\\') {
							if (local_410 != NULL) {
								*local_410 = '\\';
							}
							*pcVar11 = '\0';
							local_410 = pcVar11;
						}
						else {
							*pcVar11 = cVar3;
						}
						cVar3 = pcVar12[1];
						pcVar12 = pcVar12 + 1;
						pcVar11 = pcVar11 + 1;
					} while (cVar3 != '\0');
					local_404 = pcVar11;
					local_40c = pcVar12;
				}
				if (local_410 == NULL) {
					uVar7 = 0xffffffff;
					pcVar18 = tex_name;
					do {
						pcVar17 = pcVar18;
						if (uVar7 == 0) break;
						uVar7 -= 1;
						pcVar17 = pcVar18 + 1;
						cVar3 = *pcVar18;
						pcVar18 = pcVar17;
					} while (cVar3 != '\0');
					uVar7 = ~uVar7;
					puVar14 = (undefined4 *)(pcVar17 + -uVar7);
					puVar20 = (undefined4 *)local_400;
					for (uVar9 = uVar7 >> 2; uVar9 != 0; uVar9 -= 1) {
						*puVar20 = *puVar14;
						puVar14 = puVar14 + 1;
						puVar20 = puVar20 + 1;
					}
					for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
						*(undefined *)puVar20 = *(undefined *)puVar14;
						puVar14 = (undefined4 *)((int)puVar14 + 1);
						puVar20 = (undefined4 *)((int)puVar20 + 1);
					}
				}
				else {
					uVar7 = 0xffffffff;
					pcVar18 = "\\";
					do {
						pcVar17 = pcVar18;
						if (uVar7 == 0) break;
						uVar7 -= 1;
						pcVar17 = pcVar18 + 1;
						cVar3 = *pcVar18;
						pcVar18 = pcVar17;
					} while (cVar3 != '\0');
					uVar7 = ~uVar7;
					iVar8 = -1;
					puVar14 = (undefined4 *)local_400;
					do {
						puVar20 = puVar14;
						if (iVar8 == 0) break;
						iVar8 += -1;
						puVar20 = (undefined4 *)((int)puVar14 + 1);
						cVar3 = *(char *)puVar14;
						puVar14 = puVar20;
					} while (cVar3 != '\0');
					puVar14 = (undefined4 *)(pcVar17 + -uVar7);
					puVar20 = (undefined4 *)((int)puVar20 + -1);
					for (uVar9 = uVar7 >> 2; uVar9 != 0; uVar9 -= 1) {
						*puVar20 = *puVar14;
						puVar14 = puVar14 + 1;
						puVar20 = puVar20 + 1;
					}
					for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
						*(undefined *)puVar20 = *(undefined *)puVar14;
						puVar14 = (undefined4 *)((int)puVar14 + 1);
						puVar20 = (undefined4 *)((int)puVar20 + 1);
					}
					uVar7 = 0xffffffff;
					pcVar18 = tex_name;
					do {
						pcVar17 = pcVar18;
						if (uVar7 == 0) break;
						uVar7 -= 1;
						pcVar17 = pcVar18 + 1;
						cVar3 = *pcVar18;
						pcVar18 = pcVar17;
					} while (cVar3 != '\0');
					uVar7 = ~uVar7;
					iVar8 = -1;
					pcVar18 = local_400;
					do {
						pcVar19 = pcVar18;
						if (iVar8 == 0) break;
						iVar8 += -1;
						pcVar19 = pcVar18 + 1;
						cVar3 = *pcVar18;
						pcVar18 = pcVar19;
					} while (cVar3 != '\0');
					puVar14 = (undefined4 *)(pcVar17 + -uVar7);
					puVar20 = (undefined4 *)(pcVar19 + -1);
					for (uVar9 = uVar7 >> 2; uVar9 != 0; uVar9 -= 1) {
						*puVar20 = *puVar14;
						puVar14 = puVar14 + 1;
						puVar20 = puVar20 + 1;
					}
					for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
						*(undefined *)puVar20 = *(undefined *)puVar14;
						puVar14 = (undefined4 *)((int)puVar14 + 1);
						puVar20 = (undefined4 *)((int)puVar20 + 1);
					}
				}
			}
			else {
				std::sprintf(local_400,"%s\\%s",globals::g_SharedTextures,tex_name);
			}
			uVar7 = 0;
			*lplpD3DRMTex = NULL;
			if (globals::g_Textures_COUNT != 0) {
				pSVar13 = globals::g_Textures_TABLE;
				do {
					pbVar4 = (byte *)pSVar13->name;
					if (pbVar4 != NULL) {
						pbVar15 = (byte *)local_400;
						do {
							bVar1 = *pbVar4;
							bVar22 = bVar1 < *pbVar15;
							if (bVar1 != *pbVar15) {
LAB_00476d3e:
								iVar8 = (1 - (uint)bVar22) - (uint)(bVar22 != 0);
								goto LAB_00476d43;
							}
							if (bVar1 == 0) break;
							bVar1 = pbVar4[1];
							bVar22 = bVar1 < pbVar15[1];
							if (bVar1 != pbVar15[1]) goto LAB_00476d3e;
							pbVar4 = pbVar4 + 2;
							pbVar15 = pbVar15 + 2;
						} while (bVar1 != 0);
						iVar8 = 0;
LAB_00476d43:
						pcVar11 = local_404;
						if (iVar8 == 0) {
							pIVar2 = globals::g_Textures_TABLE[uVar7].texture;
							*lplpD3DRMTex = pIVar2;
							(*pIVar2->lpVtbl->AddRef)((IUnknown *)pIVar2);
							return 0;
						}
					}
					uVar7 += 1;
					pSVar13 = pSVar13 + 1;
					pcVar12 = local_40c;
				} while (uVar7 < globals::g_Textures_COUNT);
			}
			pDVar5 = draw::Draw_UnkMakeDirectXSurfaceTuple(local_400,0,NULL,NULL);
			if (pDVar5 == NULL) {
				local_408 += 1;
				if ((int)((globals::g_SharedTextures != NULL) + 1) <= local_408) {
					return -0x7789fcef;
				}
				goto LAB_00476c0f;
			}
			pIVar2 = pDVar5->texture;
			*lplpD3DRMTex = pIVar2;
			FUN_00476eb0(pIVar2);
			if (((byte)globals::g_CMDLINE_FLAGS & CMD_MIPMAP) != 0) {
				(*(code *)(*lplpD3DRMTex)->lpVtbl->GenerateMIPMap)(*lplpD3DRMTex,0);
			}
			if (globals::g_Textures_COUNT == 1000) {
				std::qsort(globals::g_Textures_TABLE,1000,8,FUN_00476fa0);
				for (; *(int *)(&DAT_0076be2c + globals::g_Textures_COUNT * 8) == 0;
						globals::g_Textures_COUNT -= 1) {
				}
			}
			uVar7 = globals::g_Textures_COUNT;
			if (globals::g_Textures_COUNT < 1000) {
				pSVar13 = globals::g_Textures_TABLE + globals::g_Textures_COUNT;
				(*(*lplpD3DRMTex)->lpVtbl->AddDestroyCallback)
									((IUnknown *)*lplpD3DRMTex,Res_DestroyD3DRMSharedTextureCallback,pSVar13);
				uVar9 = 0xffffffff;
				ppcVar6 = &local_40c;
				do {
					if (uVar9 == 0) break;
					uVar9 -= 1;
					cVar3 = *(char *)ppcVar6;
					ppcVar6 = (char **)((int)ppcVar6 + 1);
				} while (cVar3 != '\0');
				ppcVar6 = (char **)std::malloc(~uVar9);
				uVar9 = 0xffffffff;
				pSVar13->name = (char *)ppcVar6;
				ppcVar16 = &local_40c;
				do {
					ppcVar21 = ppcVar16;
					if (uVar9 == 0) break;
					uVar9 -= 1;
					ppcVar21 = (char **)((int)ppcVar16 + 1);
					cVar3 = *(char *)ppcVar16;
					ppcVar16 = ppcVar21;
				} while (cVar3 != '\0');
				uVar9 = ~uVar9;
				ppcVar16 = (char **)((int)ppcVar21 - uVar9);
				for (uVar10 = uVar9 >> 2; uVar10 != 0; uVar10 -= 1) {
					*ppcVar6 = *ppcVar16;
					ppcVar16 = ppcVar16 + 1;
					ppcVar6 = ppcVar6 + 1;
				}
				for (uVar9 &= 3; uVar9 != 0; uVar9 -= 1) {
					*(undefined *)ppcVar6 = *(undefined *)ppcVar16;
					ppcVar16 = (char **)((int)ppcVar16 + 1);
					ppcVar6 = (char **)((int)ppcVar6 + 1);
				}
				globals::g_Textures_TABLE[uVar7].texture = *lplpD3DRMTex;
				globals::g_Textures_COUNT += 1;
			}
			return 0;
		}
	}
	return -0x7789fcef;
}



void __cdecl FUN_00476eb0(IDirect3DRMTexture3 *rmTexture3)
{
	D3DRMIMAGE *pDVar1;
	int iVar2;
	undefined4 *buffer;
	uint uVar3;
	undefined4 *puVar4;
	undefined4 *puVar5;
	uint length;
	undefined4 *puVar6;
	undefined4 *puVar7;
	int local_c;
	
	pDVar1 = (*rmTexture3->lpVtbl->GetImage)(rmTexture3);
	if (pDVar1 != NULL) {
		iVar2 = pDVar1->bitsPerPixel * pDVar1->width;
		length = (int)(iVar2 + (iVar2 >> 0x1f & 7U)) >> 3;
		buffer = (undefined4 *)std::malloc(length);
		if (buffer != NULL) {
			puVar4 = (undefined4 *)pDVar1->buffer1;
			local_c = 0;
			puVar5 = (undefined4 *)((pDVar1->height + -1) * pDVar1->stride + (int)puVar4);
			if (0 < pDVar1->height / 2) {
				do {
					puVar6 = puVar5;
					puVar7 = buffer;
					for (uVar3 = length >> 2; uVar3 != 0; uVar3 -= 1) {
						*puVar7 = *puVar6;
						puVar6 = puVar6 + 1;
						puVar7 = puVar7 + 1;
					}
					for (uVar3 = length & 3; uVar3 != 0; uVar3 -= 1) {
						*(undefined *)puVar7 = *(undefined *)puVar6;
						puVar6 = (undefined4 *)((int)puVar6 + 1);
						puVar7 = (undefined4 *)((int)puVar7 + 1);
					}
					puVar6 = puVar4;
					puVar7 = puVar5;
					for (uVar3 = length >> 2; uVar3 != 0; uVar3 -= 1) {
						*puVar7 = *puVar6;
						puVar6 = puVar6 + 1;
						puVar7 = puVar7 + 1;
					}
					for (uVar3 = length & 3; uVar3 != 0; uVar3 -= 1) {
						*(undefined *)puVar7 = *(undefined *)puVar6;
						puVar6 = (undefined4 *)((int)puVar6 + 1);
						puVar7 = (undefined4 *)((int)puVar7 + 1);
					}
					puVar6 = buffer;
					puVar7 = puVar4;
					for (uVar3 = length >> 2; uVar3 != 0; uVar3 -= 1) {
						*puVar7 = *puVar6;
						puVar6 = puVar6 + 1;
						puVar7 = puVar7 + 1;
					}
					for (uVar3 = length & 3; uVar3 != 0; uVar3 -= 1) {
						*(undefined *)puVar7 = *(undefined *)puVar6;
						puVar6 = (undefined4 *)((int)puVar6 + 1);
						puVar7 = (undefined4 *)((int)puVar7 + 1);
					}
					puVar4 = (undefined4 *)((int)puVar4 + pDVar1->stride);
					puVar5 = (undefined4 *)((int)puVar5 - pDVar1->stride);
					local_c += 1;
				} while (local_c < pDVar1->height / 2);
			}
			std::free(buffer);
		}
	}
	return;
}



int __cdecl FUN_00476fa0(int *param_1,int *param_2)
{
	if ((*param_1 != 0) && (*param_2 == 0)) {
		return -1;
	}
	if ((*param_1 == 0) && (*param_2 != 0)) {
		return 1;
	}
	return 0;
}



void __cdecl
lego::res::Res_DestroyD3DRMSharedTextureCallback
					(IDirect3DRMTexture3 *lpD3DRMTex,SharedTextureResource *sharedTex)
{
	void *buffer;
	
	buffer = (void *)(*sharedTex->texture->lpVtbl->GetAppData)((IUnknown *)sharedTex->texture);
	std::free(buffer);
	std::free(sharedTex->name);
	sharedTex->name = NULL;
	sharedTex->texture = NULL;
	return;
}



void __cdecl lego::pool::ReservedPool_Struct_20___Init(void)
{
	int iVar1;
	void **ppvVar2;
	
	ppvVar2 = globals::ReservedPool_Struct_20___g_TABLE;
	for (iVar1 = 0x20; iVar1 != 0; iVar1 += -1) {
		*ppvVar2 = NULL;
		ppvVar2 = ppvVar2 + 1;
	}
	globals::ReservedPool_Struct_20___g_NEXT = NULL;
	globals::ReservedPool_Struct_20___g_COUNT = 0;
	globals::ReservedPool_Struct_20___g_ISINIT = 1;
	return;
}



void __cdecl lego::pool::ReservedPool_Struct_20___Cleanup(void)
{
	void **ppvVar1;
	
	FUN_004776a0();
	ppvVar1 = globals::ReservedPool_Struct_20___g_TABLE;
	do {
		if (*ppvVar1 != NULL) {
			std::free(*ppvVar1);
		}
		ppvVar1 = ppvVar1 + 1;
	} while (ppvVar1 < &globals::ReservedPool_Struct_20___g_NEXT);
	globals::ReservedPool_Struct_20___g_NEXT = NULL;
	globals::ReservedPool_Struct_20___g_ISINIT = 0;
	return;
}



void * __cdecl
lego::unk::Lego_AllocStruct20_ptr1c
					(float param_1,float param_2,float param_3,float param_4,ResourceData *resData)
{
	uint uVar1;
	uint uVar2;
	int iVar3;
	int iVar4;
	int iVar5;
	void *pvVar6;
	float10 extraout_ST0;
	longlong lVar7;
	float unaff_retaddr;
	float fVar8;
	float fStack4;
	
	uVar1 = (*(code *)globals::g_IDirect3DRMDevice3->lpVtbl->GetWidth)(globals::g_IDirect3DRMDevice3);
	uVar2 = (*(code *)globals::g_IDirect3DRMDevice3->lpVtbl->GetHeight)(globals::g_IDirect3DRMDevice3)
	;
	fVar8 = (float)(ulonglong)uVar1;
	lVar7 = __ftol((float10)param_2 * (float10)(ulonglong)uVar2);
	iVar3 = (int)lVar7;
	lVar7 = __ftol((float10)param_1 * (float10)fVar8);
	iVar4 = (int)lVar7;
	lVar7 = __ftol((float10)unaff_retaddr * extraout_ST0);
	iVar5 = (int)lVar7;
	lVar7 = __ftol((float10)fStack4 * (float10)fVar8);
	pvVar6 = pool::ReservedPool_Struct_20___Next((int)lVar7,iVar5,iVar4,iVar3,(ResourceData *)param_3)
	;
	return pvVar6;
}



void * __cdecl
lego::pool::ReservedPool_Struct_20___Next
					(int param_1,int param_2,int param_3,int param_4,ResourceData *resData)
{
	int **ppiVar1;
	undefined4 *puVar2;
	int *piVar3;
	void *pvVar4;
	uint uVar5;
	uint uVar6;
	int iVar7;
	int unaff_EBX;
	int unaff_retaddr;
	
	uVar5 = (*(code *)lego::globals::g_IDirect3DRMDevice3->lpVtbl->GetWidth)
										(lego::globals::g_IDirect3DRMDevice3);
	uVar6 = (*(code *)lego::globals::g_IDirect3DRMDevice3->lpVtbl->GetHeight)
										(lego::globals::g_IDirect3DRMDevice3);
	if (unaff_EBX < 0) {
		unaff_EBX += uVar5;
	}
	if (unaff_retaddr < 0) {
		unaff_retaddr += uVar6;
	}
	if (((uint)(param_1 + unaff_EBX) <= uVar5) && ((uint)(param_2 + unaff_retaddr) <= uVar6)) {
		if (globals::ReservedPool_Struct_20___g_NEXT == NULL) {
			ReservedPool_Struct_20___Alloc();
		}
		pvVar4 = globals::ReservedPool_Struct_20___g_NEXT;
		ppiVar1 = (int **)((int)globals::ReservedPool_Struct_20___g_NEXT + 0x10);
		puVar2 = (undefined4 *)((int)globals::ReservedPool_Struct_20___g_NEXT + 0x1c);
		globals::ReservedPool_Struct_20___g_NEXT =
				 *(void **)((int)globals::ReservedPool_Struct_20___g_NEXT + 0x1c);
		*puVar2 = 0;
		iVar7 = (*(code *)lego::globals::g_IDirect3DRM3->lpVtbl->CreateViewport)
											(lego::globals::g_IDirect3DRM3,lego::globals::g_IDirect3DRMDevice3,
											 *(undefined4 *)param_3,unaff_EBX,unaff_retaddr,param_1,param_2,ppiVar1);
		if (iVar7 == 0) {
			piVar3 = *ppiVar1;
			(**(code **)(*piVar3 + 0x18))(piVar3,pvVar4);
			*(undefined4 *)((int)pvVar4 + 0x14) = 0;
			return pvVar4;
		}
	}
	return NULL;
}



void __cdecl FUN_004771d0(int param_1,undefined4 *param_2,undefined4 *param_3)
{
	undefined4 uVar1;
	
	if (param_2 != NULL) {
		uVar1 = (**(code **)(**(int **)(param_1 + 0x10) + 0x80))(*(int **)(param_1 + 0x10));
		*param_2 = uVar1;
	}
	if (param_3 != NULL) {
		uVar1 = (**(code **)(**(int **)(param_1 + 0x10) + 0x84))(*(int **)(param_1 + 0x10));
		*param_3 = uVar1;
	}
	return;
}



void __cdecl FUN_00477210(int param_1,ResourceData *resData)
{
	(**(code **)(**(int **)(param_1 + 0x10) + 0x48))(*(int **)(param_1 + 0x10),resData->frame1);
	return;
}



// WARNING: Restarted to delay deadcode elimination for space: stack

undefined4 __cdecl FUN_00477230(int param_1)
{
	int iVar1;
	undefined4 *puVar2;
	int *unaff_ESI;
	undefined4 uVar3;
	
	uVar3 = 0;
	iVar1 = (**(code **)(**(int **)(param_1 + 0x10) + 100))(*(int **)(param_1 + 0x10));
	if (iVar1 == 0) {
		puVar2 = (undefined4 *)(**(code **)(*unaff_ESI + 0x1c))(unaff_ESI);
		if (puVar2 != NULL) {
			uVar3 = *puVar2;
		}
		(**(code **)(param_1 + 8))(&param_1);
	}
	return uVar3;
}



void __cdecl lego::main::Main_SetTVClipDist_InStruct(int param_1,float tvClipDist)
{
	(**(code **)(**(int **)(param_1 + 0x10) + 0x3c))(*(int **)(param_1 + 0x10),tvClipDist);
	return;
}



void __cdecl FUN_00477290(int param_1)
{
	(**(code **)(**(int **)(param_1 + 0x10) + 0x8c))(*(int **)(param_1 + 0x10));
	return;
}



void __cdecl FUN_004772b0(int param_1)
{
	(**(code **)(**(int **)(param_1 + 0x10) + 0x90))(*(int **)(param_1 + 0x10));
	return;
}



void __cdecl FUN_004772d0(int param_1,int param_2)
{
	int *piVar1;
	int iVar2;
	uint uVar3;
	undefined4 uVar4;
	int *piVar5;
	int *piStack32;
	float fStack28;
	float fStack24;
	code **ppcStack20;
	int iStack4;
	
	if (param_2 != 0) {
		piVar1 = (int *)FUN_004775d0(param_1);
		uVar4 = 0;
		iVar2 = (**(code **)(**(int **)(param_1 + 0x10) + 0x78))();
		ppcStack20 = (code **)(float)iVar2;
		iStack4 = (**(code **)(**(int **)(param_1 + 0x10) + 0x7c))();
		ppcStack20 = (code **)(float)iStack4;
		uVar3 = (**(code **)(**(int **)(param_1 + 0x10) + 0x80))();
		piVar5 = *(int **)(param_1 + 0x10);
		ppcStack20 = (code **)(float)(ulonglong)uVar3;
		uVar3 = (**(code **)(*piVar5 + 0x84))();
		ppcStack20 = (code **)(float)(ulonglong)uVar3;
		if (piVar1 != NULL) {
			uVar4 = (**(code **)(*piVar1 + 0xa4))();
		}
		__ftol((float10)(float)piStack32);
		__ftol((float10)fStack28);
		__ftol((float10)(float)piStack32 + (float10)fStack24);
		__ftol((float10)fStack28 + (float10)(float)ppcStack20);
		(**(code **)(**(int **)(param_1 + 0x10) + 0x98))();
		(**(code **)*ppcStack20)(ppcStack20,&idl::IID_IDirect3DViewport3);
		(**(code **)(*piStack32 + 8))(piStack32);
		(**(code **)(*piStack32 + 0x50))(piStack32,1,&stack0xffffffb8,3,uVar4,0x3f800000,0);
		(**(code **)(*piVar5 + 8))(piVar5);
		return;
	}
	(**(code **)(**(int **)(param_1 + 0x10) + 0x30))();
	return;
}



void __cdecl
lego::view::Viewport_FUN_00477410(float param_1,ResourceData *resRoot,undefined4 param_3)
{
	float fVar1;
	int result;
	float10 fVar2;
	
	*(undefined4 *)((int)param_1 + 0x18) = 1;
	if (*(float *)((int)param_1 + 0x14) != 0.0) {
		fVar2 = (float10)(**(code **)(**(int **)((int)param_1 + 0x10) + 0x88))
															 (*(int **)((int)param_1 + 0x10));
		fVar1 = (1.0 / (float)resRoot) * 4.0;
		(**(code **)(**(int **)((int)param_1 + 0x10) + 0x40))
							(*(int **)((int)param_1 + 0x10),
							 (1.0 / (fVar1 - -1.0)) *
							 (float)(fVar2 * (float10)fVar1 + (float10)*(float *)((int)param_1 + 0x14)));
		if (param_1 == *(float *)((int)param_1 + 0x14)) {
			*(undefined4 *)((int)param_1 + 0x14) = 0;
		}
	}
	result = (**(code **)(**(int **)((int)param_1 + 0x10) + 0x34))
										 (*(int **)((int)param_1 + 0x10),resRoot->frame1);
	if (result == 0) {
		FUN_00483020((int)param_1);
		*(undefined4 *)((int)param_1 + 0x18) = 0;
		return;
	}
	directx::D3DError(result,1,"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Viewports.c",286);
	*(undefined4 *)((int)param_1 + 0x18) = 0;
	return;
}



void __cdecl lego::pool::ReservedPool_Struct_20___Release(void *param_1)
{
	*(void **)((int)param_1 + 0x1c) = globals::ReservedPool_Struct_20___g_NEXT;
	globals::ReservedPool_Struct_20___g_NEXT = param_1;
	(**(code **)(**(int **)((int)param_1 + 0x10) + 8))(*(int **)((int)param_1 + 0x10));
	return;
}



void __cdecl FUN_00477500(int param_1,float param_2)
{
	*(float *)(param_1 + 0x14) = param_2;
	return;
}



void __cdecl FUN_00477510(int param_1,float param_2)
{
	(**(code **)(**(int **)(param_1 + 0x10) + 0x40))(*(int **)(param_1 + 0x10),param_2);
	*(undefined4 *)(param_1 + 0x14) = 0;
	return;
}



void __cdecl FUN_00477530(int param_1)
{
	(**(code **)(**(int **)(param_1 + 0x10) + 0x88))(*(int **)(param_1 + 0x10));
	return;
}



void __cdecl FUN_00477550(int param_1,undefined4 param_2,undefined4 param_3)
{
	(**(code **)(**(int **)(param_1 + 0x10) + 0x54))(*(int **)(param_1 + 0x10),param_2,param_3);
	return;
}



void __cdecl FUN_00477570(int param_1,undefined4 param_2,undefined4 param_3)
{
	(**(code **)(**(int **)(param_1 + 0x10) + 0x50))(*(int **)(param_1 + 0x10),param_2,param_3);
	return;
}



void __cdecl FUN_00477590(int param_1,undefined4 param_2,undefined4 param_3)
{
	int *piVar1;
	float *pfVar2;
	float local_10 [3];
	float *pfStack4;
	
	pfVar2 = local_10;
	piVar1 = *(int **)(param_1 + 0x10);
	(**(code **)(*piVar1 + 0x50))(piVar1,local_10,param_3);
	*pfStack4 = (float)piVar1 / local_10[0];
	pfStack4[1] = (float)pfVar2 / local_10[0];
	return;
}



// WARNING: Restarted to delay deadcode elimination for space: stack

undefined * __cdecl FUN_004775d0(int param_1)
{
	int *piVar1;
	int *piStack16;
	undefined4 *puStack12;
	undefined4 local_8;
	undefined4 local_4;
	
	puStack12 = &local_8;
	local_8 = 0;
	local_4 = 0;
	piStack16 = *(int **)(param_1 + 0x10);
	(**(code **)(*piStack16 + 100))();
	piVar1 = piStack16;
	if (piStack16 != NULL) {
		(**(code **)(*piStack16 + 8))();
		(**(code **)(*piVar1 + 0x68))(piVar1);
		(*(code *)piStack16[2])(&piStack16);
	}
	return (undefined *)puStack12;
}



void __cdecl lego::pool::ReservedPool_Struct_20___Alloc(void)
{
	void *pvVar1;
	void *pvVar2;
	int iVar3;
	uint uVar4;
	
	uVar4 = 1 << ((byte)globals::ReservedPool_Struct_20___g_COUNT & 0x1f);
	pvVar2 = std::malloc(uVar4 * 0x20);
	globals::ReservedPool_Struct_20___g_TABLE[globals::ReservedPool_Struct_20___g_COUNT] = pvVar2;
	pvVar2 = globals::ReservedPool_Struct_20___g_TABLE[globals::ReservedPool_Struct_20___g_COUNT];
	if (pvVar2 != NULL) {
		globals::ReservedPool_Struct_20___g_COUNT += 1;
		if (1 < uVar4) {
			iVar3 = uVar4 - 1;
			pvVar1 = pvVar2;
			do {
				*(void **)((int)pvVar1 + 0x1c) = (void *)((int)pvVar1 + 0x20);
				iVar3 += -1;
				pvVar1 = (void *)((int)pvVar1 + 0x20);
			} while (iVar3 != 0);
		}
		*(void **)((int)pvVar2 + (uVar4 * 0x20 - 4)) = globals::ReservedPool_Struct_20___g_NEXT;
		globals::ReservedPool_Struct_20___g_NEXT = pvVar2;
	}
	return;
}



void __cdecl FUN_004776a0(void)
{
	int iVar1;
	int iVar2;
	void **ppvVar3;
	uint uVar4;
	int iVar5;
	
	uVar4 = 0;
	if (lego::pool::globals::ReservedPool_Struct_20___g_COUNT != 0) {
		ppvVar3 = lego::pool::globals::ReservedPool_Struct_20___g_TABLE;
		do {
			if ((*ppvVar3 != NULL) && (iVar1 = 1 << ((byte)uVar4 & 0x1f), iVar1 != 0)) {
				iVar5 = 0;
				do {
					iVar2 = (int)*ppvVar3 + iVar5;
					if ((iVar2 != 0) && (*(int *)(iVar2 + 0x1c) == iVar2)) {
						(**(code **)(**(int **)(iVar2 + 0x10) + 8))(*(int **)(iVar2 + 0x10));
					}
					iVar5 += 0x20;
					iVar1 += -1;
				} while (iVar1 != 0);
			}
			uVar4 += 1;
			ppvVar3 = ppvVar3 + 1;
		} while (uVar4 < lego::pool::globals::ReservedPool_Struct_20___g_COUNT);
	}
	return;
}



int __cdecl lego::util::stringSplit(char *input,char **out_parts,char *delimiter)
{
	char cVar1;
	int iVar2;
	uint uVar3;
	int numParts;
	char *pcVar4;
	char **ppcVar5;
	
	uVar3 = 0xffffffff;
	pcVar4 = delimiter;
	do {
		if (uVar3 == 0) break;
		uVar3 -= 1;
		cVar1 = *pcVar4;
		pcVar4 = pcVar4 + 1;
	} while (cVar1 != '\0');
	if (*input == '\0') {
		return 0;
	}
	numParts = 1;
	*out_parts = input;
	if (*input != '\0') {
		ppcVar5 = out_parts + 1;
		do {
			iVar2 = std::strncmp(delimiter,input,~uVar3 - 1);
			if (iVar2 == 0) {
				*input = '\0';
				*ppcVar5 = input + (~uVar3 - 1);
				numParts += 1;
				ppcVar5 = ppcVar5 + 1;
			}
			pcVar4 = input + 1;
			input = input + 1;
		} while (*pcVar4 != '\0');
	}
	return numParts;
}



int __cdecl FUN_00477770(char *param_1,byte **param_2)
{
	uint uVar1;
	int iVar2;
	byte **ppbVar3;
	
	if (*param_1 != '\0') {
		*param_2 = (byte *)param_1;
		iVar2 = 1;
		if (*param_1 != '\0') {
			ppbVar3 = param_2 + 1;
			do {
				if (std::globals::g_CharWidth_1__004b0f74 < 2) {
					uVar1 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + (uint)(byte)*param_1 * 2) &
									8;
				}
				else {
					uVar1 = std::_unk_FUN_0048f490((uint)(byte)*param_1,8);
				}
				if (uVar1 == 0) {
					param_1 = (char *)((byte *)param_1 + 1);
				}
				else {
					*param_1 = 0;
					do {
						param_1 = (char *)((byte *)param_1 + 1);
						if (std::globals::g_CharWidth_1__004b0f74 < 2) {
							uVar1 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + (uint)(byte)*param_1 * 2
															 ) & 8;
						}
						else {
							uVar1 = std::_unk_FUN_0048f490((uint)(byte)*param_1,8);
						}
					} while (uVar1 != 0);
					*ppbVar3 = (byte *)param_1;
					iVar2 += 1;
					ppbVar3 = ppbVar3 + 1;
				}
			} while (*param_1 != 0);
		}
		return iVar2;
	}
	return 0;
}



char * __cdecl std::_strdup(char *strSource)
{
	char cVar1;
	undefined4 *puVar2;
	uint uVar3;
	uint uVar4;
	undefined4 *puVar5;
	char *pcVar6;
	undefined4 *puVar7;
	
	uVar3 = 0xffffffff;
	pcVar6 = strSource;
	do {
		if (uVar3 == 0) break;
		uVar3 -= 1;
		cVar1 = *pcVar6;
		pcVar6 = pcVar6 + 1;
	} while (cVar1 != '\0');
	puVar2 = (undefined4 *)malloc(~uVar3);
	uVar3 = 0xffffffff;
	do {
		pcVar6 = strSource;
		if (uVar3 == 0) break;
		uVar3 -= 1;
		pcVar6 = strSource + 1;
		cVar1 = *strSource;
		strSource = pcVar6;
	} while (cVar1 != '\0');
	uVar3 = ~uVar3;
	puVar5 = (undefined4 *)(pcVar6 + -uVar3);
	puVar7 = puVar2;
	for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
		*puVar7 = *puVar5;
		puVar5 = puVar5 + 1;
		puVar7 = puVar7 + 1;
	}
	for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
		*(undefined *)puVar7 = *(undefined *)puVar5;
		puVar5 = (undefined4 *)((int)puVar5 + 1);
		puVar7 = (undefined4 *)((int)puVar7 + 1);
	}
	return (char *)puVar2;
}



char * __cdecl lego::util::formatText(char *text,...)
{
	char *pcVar1;
	char cVar2;
	char *pcVar3;
	char *pcVar4;
	char fmtBuffer [256];
	char replBuffer [256];
	
	std::vsprintf(fmtBuffer,text,&stack0x00000008);
	pcVar3 = fmtBuffer;
	pcVar4 = replBuffer;
	while (fmtBuffer[0] != '\0') {
		cVar2 = *pcVar3;
		if ((cVar2 == '\\') && (pcVar3[1] == 'n')) {
			*pcVar4 = '\n';
			pcVar3 = pcVar3 + 1;
		}
		else {
			if (cVar2 == '_') {
				*pcVar4 = ' ';
			}
			else {
				*pcVar4 = cVar2;
			}
		}
		pcVar1 = pcVar3 + 1;
		pcVar4 = pcVar4 + 1;
		pcVar3 = pcVar3 + 1;
		fmtBuffer[0] = *pcVar1;
	}
	*pcVar4 = '\0';
	pcVar4 = std::_strdup(replBuffer);
	return pcVar4;
}



char * __cdecl lego::util::strstri(char *str,char *strSearch)
{
	char cVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	char *pcVar5;
	uint uVar6;
	
	uVar3 = 0xffffffff;
	pcVar5 = str;
	do {
		if (uVar3 == 0) break;
		uVar3 -= 1;
		cVar1 = *pcVar5;
		pcVar5 = pcVar5 + 1;
	} while (cVar1 != '\0');
	uVar3 = ~uVar3;
	uVar4 = 0xffffffff;
	pcVar5 = strSearch;
	do {
		if (uVar4 == 0) break;
		uVar4 -= 1;
		cVar1 = *pcVar5;
		pcVar5 = pcVar5 + 1;
	} while (cVar1 != '\0');
	if (((uVar3 != 1) && (~uVar4 - 1 != 0)) && (uVar6 = 0, uVar3 != 1)) {
		do {
			iVar2 = std::_strnicmp(str,strSearch,~uVar4 - 1);
			if (iVar2 == 0) {
				return str;
			}
			uVar6 += 1;
			str = str + 1;
		} while (uVar6 < uVar3 - 1);
		return NULL;
	}
	return NULL;
}



// https://github.com/microsoft/Windows-classic-samples/blob/master/Samples/Win7Samples/begin/sdkdiff/utils.cpp
// 
// hash_string()

uint __cdecl lego::util::hash_string(LPCSTR str,BOOL bIgnoreBlanks,BOOL bIgnoreCase)
{
	byte bVar1;
	uint uVar2;
	int iVar3;
	int iVar4;
	uint uVar5;
	byte *pbVar6;
	int iVar7;
	
	uVar5 = 0;
	iVar7 = 0x600937;
	iVar4 = 1;
	bVar1 = *str;
	pbVar6 = (byte *)str;
	while (bVar1 != 0) {
		if (bIgnoreBlanks != 0) {
			while( true ) {
				if (std::globals::g_CharWidth_1__004b0f74 < 2) {
					uVar2 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + (uint)*pbVar6 * 2) & 8;
				}
				else {
					uVar2 = std::_unk_FUN_0048f490((uint)*pbVar6,8);
				}
				if (uVar2 == 0) break;
				pbVar6 = pbVar6 + 1;
			}
		}
		bVar1 = *pbVar6;
		pbVar6 = pbVar6 + 1;
		str = (LPCSTR)(uint)bVar1;
		if (bIgnoreCase != 0) {
			uVar2 = std::toupper((int)str);
			str = (LPCSTR)(uVar2 & 0xff);
		}
		iVar3 = iVar4 * iVar7;
		iVar7 *= 0x600937;
		uVar5 += iVar3 * (int)str;
		iVar4 += 1;
		bVar1 = *pbVar6;
	}
	return uVar5;
}



uint __cdecl lego::util::parseBoolLiteral(char *text)
{
	int iVar1;
	
	iVar1 = std::_stricmp(text,"YES");
	if (iVar1 == 0) {
		return 1;
	}
	iVar1 = std::_stricmp(text,"TRUE");
	if (iVar1 == 0) {
		return 1;
	}
	iVar1 = std::_stricmp(text,"ON");
	if (iVar1 == 0) {
		return 1;
	}
	iVar1 = std::_stricmp(text,"NO");
	if (iVar1 == 0) {
		return 0;
	}
	iVar1 = std::_stricmp(text,"FALSE");
	if (iVar1 == 0) {
		return 0;
	}
	iVar1 = std::_stricmp(text,"OFF");
	return -(uint)(iVar1 != 0) & 2;
}



int lego::WinMain(HINSTANCE hInstance,HINSTANCE hPrevInstance,LPSTR lpCmdLine,int nShowCmd)
{
	char *pcVar1;
	char cVar2;
	DWORD DVar3;
	LPSTR pCVar4;
	char *pcVar5;
	BOOL BVar6;
	CmdlineFlags CVar7;
	DWORD DVar8;
	uint uVar9;
	uint uVar10;
	char *pcVar11;
	undefined4 *puVar12;
	undefined4 *puVar13;
	float fpsSync;
	BOOL insistOnCD;
	BOOL nosound;
	uint local_c88;
	undefined4 uStack3204;
	char mutexName [128];
	char fullCmdLine [1024];
	char errorMessage [1024];
	char standardParameters [1024];
	
	nosound = 0;
	insistOnCD = 0;
	if (true) {
		std::sprintf(mutexName,"%s Mutex","Lego Rock Raiders");
		CreateMutexA(NULL,TRUE,mutexName);
		DVar3 = GetLastError();
		if (DVar3 == ERROR_ALREADY_EXISTS) {
			return 0;
		}
	}
	pCVar4 = GetCommandLineA();
	cVar2 = *pCVar4;
	pcVar5 = pCVar4;
	while (cVar2 != '\0') {
		if (cVar2 == '\\') {
			pcVar5 = pCVar4 + 1;
		}
		pcVar11 = pCVar4 + 1;
		pCVar4 = pCVar4 + 1;
		cVar2 = *pcVar11;
	}
	uVar9 = 0xffffffff;
	do {
		pcVar11 = pcVar5;
		if (uVar9 == 0) break;
		uVar9 -= 1;
		pcVar11 = pcVar5 + 1;
		cVar2 = *pcVar5;
		pcVar5 = pcVar11;
	} while (cVar2 != '\0');
	uVar9 = ~uVar9;
	puVar12 = (undefined4 *)(pcVar11 + -uVar9);
	puVar13 = (undefined4 *)globals::wnd::g_ExeName;
	for (uVar10 = uVar9 >> 2; uVar10 != 0; uVar10 -= 1) {
		*puVar13 = *puVar12;
		puVar12 = puVar12 + 1;
		puVar13 = puVar13 + 1;
	}
	pcVar5 = globals::wnd::g_ExeName;
	for (uVar9 &= 3; cVar2 = globals::wnd::g_ExeName[0], uVar9 != 0; uVar9 -= 1) {
		*(undefined *)puVar13 = *(undefined *)puVar12;
		puVar12 = (undefined4 *)((int)puVar12 + 1);
		puVar13 = (undefined4 *)((int)puVar13 + 1);
	}
	while (cVar2 != '\0') {
		if (*pcVar5 == '\"') {
			*pcVar5 = '\0';
		}
		pcVar11 = pcVar5 + 1;
		pcVar5 = pcVar5 + 1;
		cVar2 = *pcVar11;
	}
	pcVar11 = globals::wnd::g_ExeName;
	pcVar5 = globals::wnd::g_ExeName;
	cVar2 = globals::wnd::g_ExeName[0];
	while (cVar2 != '\0') {
		if (cVar2 == '.') {
			pcVar5 = pcVar11 + 1;
		}
		pcVar1 = pcVar11 + 1;
		pcVar11 = pcVar11 + 1;
		cVar2 = *pcVar1;
	}
	if (pcVar5 != globals::wnd::g_ExeName) {
										// to upper
		std::_strupr(pcVar5);
		pcVar5 = std::strstr(globals::wnd::g_ExeName,".EXE");
		if (pcVar5 != NULL) {
			*pcVar5 = '\0';
		}
	}
	globals::wnd::g_WindowClassName = globals::wnd::g_ExeName;
	globals::wnd::g_IsFocused = 0;
	globals::wnd::g_IsClosing = 0;
	globals::g_GameFunctions_ISINIT = 0;
	globals::wnd::g_hInstance = hInstance;
	globals::g_FPSLOCK_VSYNC = 0.0;
	globals::g_CMDLINE_FLAGS = CMD_NONE;
	BVar6 = registry::Reg_QueryValue_OnLocalMachine
										("SOFTWARE\\LEGO Media\\Games\\Rock Raiders","StandardParameters",
										 REGISTRY_STRING,standardParameters,0x400);
	if (BVar6 == 0) {
		std::sprintf(fullCmdLine,"%s",lpCmdLine);
	}
	else {
		std::sprintf(fullCmdLine,"%s %s",lpCmdLine,standardParameters);
	}
	main::Boot_ParseCmdFlags(fullCmdLine,&nosound,&insistOnCD);
	BVar6 = registry::Reg_QueryValue_OnLocalMachine
										("SOFTWARE\\LEGO Media\\Games\\Rock Raiders","NoHALMessage",REGISTRY_STRING,
										 errorMessage,0x400);
	if (BVar6 == 0) {
		std::sprintf(errorMessage,"No DirectX 3D accelerator could be found.");
	}
	file::scan::Scan_Init();
	file::InitSharedFileBuffers();
	file::InitFileSystem
						(globals::wnd::g_ExeName,insistOnCD,"SOFTWARE\\LEGO Media\\Games\\Rock Raiders");
	pool::ReservedPool_CFGProperty___Init();
	main::Main_DirectInputCreate();
	BVar6 = wnd::Win_CreateMainWindow(hInstance);
	if (BVar6 != 0) {
		main::Main_InitDirectXBase(globals::wnd::g_hWnd);
		BVar6 = snd::InitSoundSystem(nosound);
		if ((BVar6 != 0) &&
			 (BVar6 = wnd::Win_ChooseScreenMode
													(TRUE,globals::g_CMDLINE_FLAGS & CMD_DEBUG,
													 globals::g_CMDLINE_FLAGS & CMD_BEST,globals::g_CMDLINE_FLAGS & CMD_WINDOW
													 ,errorMessage), BVar6 != 0)) {
			avi::InitAVIFile(globals::g_IDirectDraw4);
			main::Main_LockSurfaceRect(NULL);
			main::Main_InitGameFunctions(globals::wnd::g_ExeName);
			if (globals::g_GameFunctions_ISINIT != 0) {
				if ((globals::g_GameFunctions.Init != NULL) &&
					 (BVar6 = (*globals::g_GameFunctions.Init)(), BVar6 == 0)) {
					globals::g_GameFunctions.Init = NULL;
					globals::g_GameFunctions.Update = NULL;
					globals::g_GameFunctions.Cleanup = NULL;
				}
				if (globals::g_GameFunctions.Update != NULL) {
					fpsSync = 1.0;
					DVar3 = timeGetTime();
					while (globals::wnd::g_IsClosing == 0) {
						BOOL_0076bb4c = 0;
						BOOL_0076bb50 = 0;
						BOOL_0076bb54 = 0;
						globals::g_ButtonState_RightDoubleClicked = 0;
						wnd::Win_HandleMessageQueue();
						if ((globals::g_CMDLINE_FLAGS & CMD_FULLSCREEN) != CMD_NONE) {
							globals::wnd::g_IsFocused = TRUE;
						}
						input::Input_UpdateKeyboardState();
						input::Input_UpdateMousePosition();
						BVar6 = (*globals::g_GameFunctions.Update)(fpsSync);
						if (BVar6 == 0) {
							globals::wnd::g_IsClosing = TRUE;
						}
						main::Main_DoDirect3DRMUpdate();
						draw::Draw_Render();
						CVar7 = globals::g_CMDLINE_FLAGS & ~CMD_D3DRMUPDATED;
						if ((globals::g_CMDLINE_FLAGS & CMD_FPSLOCK30) == CMD_NONE) {
							if ((globals::g_CMDLINE_FLAGS & CMD_NOFPSLOCK) == CMD_NONE) {
								if (globals::g_FPSLOCK_VSYNC != 0.0) {
									fpsSync = globals::g_FPSLOCK_VSYNC;
									goto LAB_00477e2a;
								}
								globals::g_CMDLINE_FLAGS = CVar7;
								DVar8 = timeGetTime();
								uStack3204 = 0;
								local_c88 = DVar8 - DVar3;
								fpsSync = (float)(ulonglong)local_c88 * 0.025;
								DVar3 = DVar8;
								if ((ushort)((ushort)(fpsSync < 3.0) << 8 | (ushort)(fpsSync == 3.0) << 0xe) == 0) {
									fpsSync = 3.0;
								}
							}
							else {
								fpsSync = 0.0;
LAB_00477e2a:
								globals::g_CMDLINE_FLAGS = CVar7;
								DVar3 = timeGetTime();
							}
						}
						else {
							fpsSync = 0.8333333;
							globals::g_CMDLINE_FLAGS = CVar7;
						}
					}
				}
				if (globals::g_GameFunctions.Cleanup != NULL) {
					(*globals::g_GameFunctions.Cleanup)();
				}
			}
		}
		main::Main_CleanupDirectXBase();
		DestroyWindow(globals::wnd::g_hWnd);
	}
	input::Input_DirectInputCleanup();
	pool::ReservedPool_CFGProperty___Cleanup();
	other::logf_removed(NULL);
	file::scan::Scan_Cleanup();
	file::scan::Scan_WriteDataDirList();
	return 0;
}



void __cdecl lego::main::Main_DisableTextureManagement_NonVoodoo2(void)
{
	if ((globals::g_CMDLINE_FLAGS & CMD_FTM) == CMD_NONE) {
		globals::g_CMDLINE_FLAGS |= CMD_NM;
	}
	return;
}



void __cdecl lego::main::Boot_ParseCmdFlags(char *args,BOOL *out_nosound,BOOL *out_insistOnCD)
{
	char *pcVar1;
	char cVar2;
	char *pcVar3;
	uint uVar4;
	int iVar5;
	
	pcVar3 = util::strstri(args,"-insistOnCD");
	if (pcVar3 != NULL) {
		*out_insistOnCD = 1;
	}
	pcVar3 = util::strstri(args,"-nosound");
	if (pcVar3 != NULL) {
		*out_nosound = 1;
	}
	pcVar3 = util::strstri(args,"-debug");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_DEBUG;
	}
	pcVar3 = util::strstri(args,"-nm");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_NM;
	}
	pcVar3 = util::strstri(args,"-ftm");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_FTM;
	}
	pcVar3 = util::strstri(args,"-fvf");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_FVF;
	}
										// "best fit" for screen mode selection
	pcVar3 = util::strstri(args,"-best");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_BEST;
	}
										// Only used when "-best" is specified
	pcVar3 = util::strstri(args,"-window");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_WINDOW;
	}
	pcVar3 = util::strstri(args,"-dualmouse");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_DUALMOUSE;
	}
										// Automatically triggers "-debug" command line option as well
	pcVar3 = util::strstri(args,"-debugcomplete");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_DEBUGCOMPLETE;
	}
	pcVar3 = util::strstri(args,"-testercall");
	if (pcVar3 != NULL) {
		globals::g_PROGRAMMER_MODE = PROGRAMMER_MODE_2;
		globals::g_CMDLINE_FLAGS |= CMD_TESTERCALL;
	}
	pcVar3 = util::strstri(args,"-testlevels");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_TESTLEVELS;
	}
	pcVar3 = util::strstri(args,"-reducesamples");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_REDUCESAMPLES;
	}
	pcVar3 = util::strstri(args,"-showversion");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_SHOWVERSION;
	}
	pcVar3 = util::strstri(args,"-reduceanimation");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_REDUCEANIMATION;
	}
	pcVar3 = util::strstri(args,"-reducepromeshes");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_REDUCEPROMESHES;
	}
	pcVar3 = util::strstri(args,"-reduceflics");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_REDUCEFLICS;
	}
	pcVar3 = util::strstri(args,"-reduceimages");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_REDUCEIMAGES;
	}
	pcVar3 = util::strstri(args,"-startlevel");
	if (pcVar3 != NULL) {
		pcVar3 = pcVar3 + 0xb;
		iVar5 = 0;
		cVar2 = *pcVar3;
		while ((cVar2 != '\0' && (cVar2 == ' '))) {
			pcVar1 = pcVar3 + 1;
			pcVar3 = pcVar3 + 1;
			cVar2 = *pcVar1;
		}
		cVar2 = *pcVar3;
		while ((cVar2 != '\0' && (cVar2 != ' '))) {
			globals::g_STARTLEVEL[iVar5] = cVar2;
			pcVar1 = pcVar3 + 1;
			iVar5 += 1;
			pcVar3 = pcVar3 + 1;
			cVar2 = *pcVar1;
		}
		globals::g_STARTLEVEL[iVar5] = '\0';
		globals::g_CMDLINE_FLAGS |= CMD_STARTLEVEL;
	}
	pcVar3 = util::strstri(args,"-flags");
	if (pcVar3 != NULL) {
		globals::g_DEBUG_FLAGS = std::atoi(pcVar3 + 6);
	}
	pcVar3 = util::strstri(args,"-fpslock");
	if ((pcVar3 != NULL) && (uVar4 = std::atoi(pcVar3 + 8), uVar4 != 0)) {
		globals::g_FPSLOCK_VSYNC = 25.0 / (float)(ulonglong)uVar4;
	}
	pcVar3 = util::strstri(args,"-programmer");
	if (pcVar3 == NULL) {
		globals::g_PROGRAMMER_MODE = PROGRAMMER_OFF;
	}
	else {
		globals::g_PROGRAMMER_MODE = std::atoi(pcVar3 + 0xb);
		if (globals::g_PROGRAMMER_MODE == PROGRAMMER_OFF) {
			globals::g_PROGRAMMER_MODE = PROGRAMMER_MODE_1;
		}
	}
	pcVar3 = util::strstri(args,"-cleansaves");
	if (pcVar3 != NULL) {
		globals::g_CMDLINE_FLAGS |= CMD_CLEANSAVES;
	}
	return;
}



void __cdecl lego::main::Main_UpdateAndRender__004781f0(BOOL doFillSurface)
{
	wnd::Win_HandleMessageQueue();
	input::Input_UpdateKeyboardState();
	input::Input_UpdateMousePosition();
	Main_DoDirect3DRMUpdate();
	draw::Draw_Render();
	if (doFillSurface != 0) {
		draw::Draw_FillSurface(NULL,0);
	}
	globals::g_CMDLINE_FLAGS = globals::g_CMDLINE_FLAGS & ~CMD_D3DRMUPDATED;
	return;
}



DebugFlags __cdecl lego::main::Config_GetDebugFlags(void)
{
	return globals::g_DEBUG_FLAGS;
}



int __cdecl lego::wnd::setup::Setup_GetDeviceBitsPerPixel(void)
{
	HDC hdc;
	int iVar1;
	
	iVar1 = BITSPIXEL;
	hdc = GetDC(lego::globals::wnd::g_hWnd);
	iVar1 = GetDeviceCaps(hdc,iVar1);
	return iVar1;
}



void __cdecl lego::main::Main_DoDirect3DRMUpdate(void)
{
	if ((globals::g_CMDLINE_FLAGS & CMD_D3DRMUPDATED) == CMD_NONE) {
		(*(code *)globals::g_IDirect3DRMDevice3->lpVtbl->Update)(globals::g_IDirect3DRMDevice3);
		globals::g_CMDLINE_FLAGS |= CMD_D3DRMUPDATED;
	}
	return;
}



BOOL __cdecl lego::main::Main_SetGameFunctions(GameFunctions *gameFuncs)
{
	if (gameFuncs != NULL) {
		globals::g_GameFunctions.Init = gameFuncs->Init;
		globals::g_GameFunctions.Update = gameFuncs->Update;
		globals::g_GameFunctions.Cleanup = gameFuncs->Cleanup;
		globals::g_GameFunctions_ISINIT = 1;
		return 1;
	}
	return 0;
}



DWORD timeGetTime(void)
{
	DWORD DVar1;
	
										// WARNING: Could not recover jumptable at 0x004782c0. Too many branches
										// WARNING: Treating indirect jump as call
	DVar1 = timeGetTime();
	return DVar1;
}



BOOL __cdecl lego::wnd::Win_ShouldHandleMessage(MSG *msg)
{
	UINT UVar1;
	
	if ((((byte)globals::g_CMDLINE_FLAGS & CMD_FULLSCREEN) != 0) &&
		 (((UVar1 = msg->message, UVar1 == WM_ACTIVATEAPP || (UVar1 == WM_SYSKEYDOWN)) ||
			(UVar1 == WM_SYSKEYUP)))) {
		return 0;
	}
	return 1;
}



void __cdecl lego::wnd::Win_HandleMessageQueue(void)
{
	int iVar1;
	BOOL BVar2;
	MSG msg;
	
	iVar1 = PeekMessageA((LPMSG)&msg,NULL,0,0,1);
	while (iVar1 != 0) {
		BVar2 = Win_ShouldHandleMessage(&msg);
		if (BVar2 != 0) {
			TranslateMessage(&msg);
			DispatchMessageA(&msg);
		}
		iVar1 = PeekMessageA((LPMSG)&msg,NULL,0,0,1);
	}
	return;
}



void __cdecl
lego::wnd::Win_ShowGameWindow
					(BOOL isFullScreen,int windowedX,int windowedY,int screenWidth,int screenHeight)
{
	HWND hWnd;
	RECT rect;
	
	globals::g_RESOLUTION.width = screenWidth;
	globals::g_RESOLUTION.height = screenHeight;
	if (isFullScreen != 0) {
		globals::g_CMDLINE_FLAGS |= CMD_FULLSCREEN;
	}
	lego::file::scan::Scan_SetIsFullScreen(isFullScreen);
	if (isFullScreen == 0) {
		rect.left = windowedX;
		rect.right = screenWidth + windowedX;
		rect.bottom = screenHeight + windowedY;
										// WS_POPUPWINDOW | WS_CAPTION (0x80880000 | 0xc00000)
										// WS_POPUP | WS_BORDER | WS_DLGFRAME | WS_SYSMENU (0x80000000 | 0x800000 |
										// 0x400000 | 0x80000)
		globals::wnd::g_WindowStyle = 0x80c80000;
		rect.top = windowedY;
		Win_AdjustMainWindowedRect((LPRECT)&rect);
		SetWindowLongA(globals::wnd::g_hWnd,-0x10,globals::wnd::g_WindowStyle);
										// HWND_TOP (0x0) and SWP_NOZORDER (0x4)
										// Then hide system cursor since game draws its own
		SetWindowPos(globals::wnd::g_hWnd,NULL,rect.left,rect.top,rect.right - rect.left,
								 rect.bottom - rect.top,SWP_NOZORDER);
		ShowCursor(0);
	}
	else {
		hWnd = GetDesktopWindow();
		GetWindowRect(hWnd,(LPRECT)&rect);
										// HWND_TOP (0x0) and SWP_NOZORDER (0x4)
										// Then hide system cursor since game draws its own
		SetWindowPos(globals::wnd::g_hWnd,NULL,rect.left,rect.top,rect.right - rect.left,
								 rect.bottom - rect.top,SWP_NOZORDER);
		SetCursor(NULL);
	}
	ShowWindow(globals::wnd::g_hWnd,SW_SHOW);
	SetActiveWindow(globals::wnd::g_hWnd);
	return;
}



BOOL __cdecl
lego::main::Main_Direct3DRMCreate
					(DeviceMode *device,IUnknown *ddraw1,IDirectDrawSurface4 *ddSurface,BOOL isFullScreen)
{
	HRESULT HVar1;
	DeviceMode *result;
	DeviceMode *pDVar2;
	code ***ppvObj;
	DeviceMode **ppDVar3;
	IUnknown *local_8;
	code **local_4;
	
	pDVar2 = NULL;
	if ((device != NULL) &&
		 (pDVar2 = device, (device->flags & DEVICEMODE_TEXTUREVIDEOMEMORY) != DEVICEMODE_NONE)) {
		globals::g_CMDLINE_FLAGS |= CMD_TEXTUREVIDEOMEMORY;
	}
										// Direct3DRMFrame3::SetSceneFogMethod
										// D3DRMFOGMETHOD_VERTEX = 0x1
										// D3DRMFOGMETHOD_TABLE  = 0x2
										// D3DRMFOGMETHOD_ANY    = 0x4
	if (((globals::g_CMDLINE_FLAGS & CMD_FVF) != CMD_NONE) ||
		 (globals::g_SceneFogMethod = 2, (device->flags & DEVICEMODE_HARDWARE) == DEVICEMODE_NONE)) {
		globals::g_SceneFogMethod = 1;
	}
	HVar1 = Direct3DRMCreate(&local_8);
	result = device;
	if ((HVar1 == 0) &&
		 (HVar1 = (*local_8->lpVtbl->QueryInterface)
												(local_8,(IID *)&idl::IID_IDirect3DRM3,&globals::g_IDirect3DRM3),
		 result = device, HVar1 == 0)) {
		ppvObj = &local_4;
		(*ddSurface->lpVtbl->QueryInterface)
							((IUnknown *)ddSurface,(IID *)&idl::IID_IDirectDrawSurface,ppvObj);
		result = (DeviceMode *)
						 (*(code *)globals::g_IDirect3DRM3->lpVtbl->CreateDeviceFromSurface)
											 (globals::g_IDirect3DRM3,pDVar2,local_4,ppvObj,0,
												&globals::g_IDirect3DRMDevice3);
		if (result == NULL) {
			ppDVar3 = &device;
			(*(code *)globals::g_IDirect3DRMDevice3->lpVtbl->GetDirect3DDevice2)
								(globals::g_IDirect3DRMDevice3);
			(**(code **)*local_4)(local_4,&idl::IID_IDirect3DDevice3,&globals::g_IDirect3DDevice3);
			(**(code **)((*ppDVar3)->guid).Data4)(ppDVar3);
			if (local_8 != NULL) {
				(*(code *)globals::g_IDirect3DRMDevice3->lpVtbl->SetBufferCount)
									(globals::g_IDirect3DRMDevice3,2);
			}
			return 1;
		}
		directx::D3DError((HRESULT)result,3,"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Main.c",568);
	}
	if (result != NULL) {
		directx::D3DError((HRESULT)result,1,"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Main.c",576);
	}
	return 0;
}



void __cdecl lego::wnd::Win_AdjustMainWindowedRect(LPRECT lpRect)
{
										// Adjust rectangle to client coordinates only in windowed mode
	if (((byte)globals::g_CMDLINE_FLAGS & CMD_FULLSCREEN) == 0) {
		AdjustWindowRect(lpRect,globals::wnd::g_WindowStyle,0);
	}
	return;
}



void __cdecl
lego::draw::Draw_SetDirectXGraphicsQuality
					(GraphicsQuality quality,BOOL dither,BOOL filter,BOOL mipmap,BOOL linearmipmap,BOOL blend,
					BOOL sort)
{
	char cVar1;
	DWORD quality_00;
	
										// D3DRMRENDER_WIREFRAME 0x40
										// (D3DRMSHADE_FLAT|D3DRMLIGHT_OFF|D3DRMFILL_WIREFRAME)
	quality_00 = 0x40;
	if (quality == QUALITY_FLAT) {
										// D3DRMRENDER_FLAT 0x88 (D3DRMSHADE_FLAT|D3DRMLIGHT_ON|D3DRMFILL_SOLID)
		quality_00 = 0x88;
	}
	if (quality == QUALITY_UNLITFLAT) {
										// D3DRMRENDER_UNLITFLAT 0x80 (D3DRMSHADE_FLAT|D3DRMLIGHT_OFF|D3DRMFILL_SOLID)
		quality_00 = 0x80;
	}
	if (quality == QUALITY_GOURAUD) {
										// D3DRMRENDER_GOURAUD 0x89 (D3DRMSHADE_GOURAUD|D3DRMLIGHT_ON|D3DRMFILL_SOLID)
		quality_00 = 0x89;
	}
	if (filter == 0) {
										// D3DRMTEXTURE_NEAREST 0
		cVar1 = '\0';
	}
	else {
		if (mipmap == 0) {
										// D3DRMTEXTURE_LINEAR 1
			cVar1 = '\x01';
		}
		else {
										// D3DRMTEXTURE_MIPLINEAR 3 (!linearmipmap), D3DRMTEXTURE_LINEARMIPLINEAR 5
			cVar1 = (-(linearmipmap != 0) & 2U) + 3;
			lego::globals::g_CMDLINE_FLAGS |= CMD_MIPMAP;
		}
	}
	if (lego::globals::g_IDirect3DRMDevice3 != NULL) {
										// IDirect3DRMDevice3::SetDither(THIS_ BOOL)
		(*lego::globals::g_IDirect3DRMDevice3->lpVtbl->SetDither)
							(lego::globals::g_IDirect3DRMDevice3,dither);
										// IDirect3DRMDevice3::SetQuality(THIS_ D3DRMRENDERQUALITY)
		(*lego::globals::g_IDirect3DRMDevice3->lpVtbl->SetQuality)
							(lego::globals::g_IDirect3DRMDevice3,quality_00);
										// IDirect3DRMDevice3::SetTextureQuality(THIS_ D3DRMTEXTUREQUALITY)
		(*lego::globals::g_IDirect3DRMDevice3->lpVtbl->SetTextureQuality)
							(lego::globals::g_IDirect3DRMDevice3,(DWORD)cVar1);
	}
	return;
}



BOOL __cdecl lego::wnd::Win_SetMainWindowTitle(LPCSTR title)
{
	BOOL BVar1;
	
	BVar1 = SetWindowTextA(globals::wnd::g_hWnd,title);
	return BVar1;
}



BOOL __cdecl lego::wnd::Win_CreateMainWindow(HINSTANCE hInstance)
{
	ATOM AVar1;
	WNDCLASSA wndClass;
	
	wndClass.style = CS_DBLCLKS;
	wndClass.lpfnWndProc = Win_WindowProc;
	wndClass.cbClsExtra = 0;
	wndClass.cbWndExtra = 0;
	wndClass.hInstance = hInstance;
	wndClass.hIcon = NULL;
	wndClass.hCursor = NULL;
	wndClass.hbrBackground = NULL;
	wndClass.lpszMenuName = NULL;
	wndClass.lpszClassName = globals::wnd::g_WindowClassName;
	AVar1 = RegisterClassA(&wndClass);
	if (AVar1 == 0) {
		MessageBoxA(NULL,"Unable to register window class","Fatal Error",0);
		return 0;
	}
										// WS_POPUP | WS_SYSMENU
	globals::wnd::g_hWnd =
			 CreateWindowExA(WS_EX_APPWINDOW,globals::wnd::g_WindowClassName,____EMPTYSTR__,0x80080000,0,0
											 ,100,100,NULL,NULL,hInstance,NULL);
	if (globals::wnd::g_hWnd != NULL) {
		SetFocus(globals::wnd::g_hWnd);
		return 1;
	}
	MessageBoxA(NULL,"Unable to Create Main Window","Fatal Error",0);
	return 0;
}



LRESULT __cdecl
lego::wnd::Win_WindowProc__FullScreen(HWND hWnd,UINT message,WPARAM wParam,LPARAM lParam)
{
	LRESULT LVar1;
	
	if (message < 0x11) {
		if (message != 0x10) {
			if (true) {
				switch(message) {
				default:
					break;
				case 2:
					goto switchD_00478794_caseD_2;
				case 3:
				case 5:
				case 6:
					goto switchD_00478830_caseD_200;
				}
			}
			goto switchD_00478830_caseD_207;
		}
	}
	else {
		if (WM_ACTIVATEAPP < message) {
			if (message < WM_NCACTIVATE + 1) {
				if (message == WM_NCACTIVATE) {
switchD_00478830_caseD_200:
					return 0;
				}
				if (message == WM_WINDOWPOSCHANGING) {
					*(uint *)(lParam + 0x18) = *(uint *)(lParam + 0x18) & 0xfffffdff;
					return 0;
				}
			}
			else {
				if (message < WM_SYSKEYDOWN + 1) {
					if (message == WM_SYSKEYDOWN) {
						return 0;
					}
					if ((0xff < message) && (message < 0x102)) {
						return 0;
					}
				}
				else {
					if (true) {
						switch(message) {
						case 0x200:
						case 0x211:
						case 0x212:
							goto switchD_00478830_caseD_200;
						case 0x201:
						case 0x202:
						case 0x204:
						case 0x205:
							if ((globals::g_CMDLINE_FLAGS & CMD_DUALMOUSE) == CMD_NONE) {
								if (true) {
									switch(message) {
									case 0x201:
									case 0x204:
										if (globals::g_ButtonState_LeftDown == 0) {
											BOOL_0076bb4c = 1;
											BOOL_0076bb50 = 1;
										}
										globals::g_ButtonState_LeftDown = 1;
										globals::g_ButtonState_RightDown = 1;
										BOOL_0076bb54 = 1;
										return 0;
									case 0x202:
									case 0x205:
										BOOL_0076bb4c = 0;
										BOOL_0076bb50 = 0;
										globals::g_ButtonState_RightDown = 0;
										globals::g_ButtonState_LeftDown = 0;
									}
								}
							}
							else {
								if (true) {
									switch(message) {
									case 0x201:
										globals::g_ButtonState_LeftDown = 1;
										BOOL_0076bb4c = 1;
										return 0;
									case 0x202:
										globals::g_ButtonState_LeftDown = 0;
										BOOL_0076bb4c = 0;
										return 0;
									case 0x204:
										globals::g_ButtonState_RightDown = 1;
										BOOL_0076bb50 = 1;
										return 0;
									case 0x205:
										globals::g_ButtonState_RightDown = 0;
										BOOL_0076bb50 = 0;
										return 0;
									}
								}
							}
						case 0x203:
							BOOL_0076bb54 = 1;
							return 0;
						case 0x206:
							globals::g_ButtonState_RightDoubleClicked = 1;
							return 0;
						}
					}
				}
			}
			goto switchD_00478830_caseD_207;
		}
		if (message == WM_ACTIVATEAPP) {
										// True if this window is being activated
			globals::wnd::g_IsFocused = wParam;
			return 0;
		}
		if (message != WM_QUIT) goto switchD_00478830_caseD_207;
	}
switchD_00478794_caseD_2:
	globals::wnd::g_IsClosing = 1;
switchD_00478830_caseD_207:
	LVar1 = DefWindowProcA(hWnd,message,wParam,lParam);
	return LVar1;
}



LRESULT __cdecl
lego::wnd::Win_WindowProc__Windowed(HWND hWnd,UINT message,WPARAM wParam,LPARAM lParam)
{
	int iVar1;
	LRESULT LVar2;
	UINT UVar3;
	
	if (message < WM_ACTIVATE + 1) {
		UVar3 = message;
		if (message == WM_ACTIVATE) {
			return 0;
		}
	}
	else {
		if (WM_ACTIVATEAPP < message) {
										// Handle mouse button input (0x201 is WM_LBUTTONDOWN)
			iVar1 = message - 0x201;
			switch(iVar1) {
			case 0:
			case 1:
			case 3:
			case 4:
										// WM_LBUTTONDOWN (0x201) or WM_LBUTTONUP (0x202) or  WM_RBUTTONDOWN (0x204) or
										// WM_RBUTTONUP (0x205)
				if ((globals::g_CMDLINE_FLAGS & CMD_DUALMOUSE) == CMD_NONE) {
					if (true) {
						switch(iVar1) {
						case 0:
						case 3:
										// WM_LBUTTONDOWN (0x201) or WM_RBUTTONDOWN (0x204)
							SetCapture(hWnd);
							if (globals::g_ButtonState_LeftDown == 0) {
								BOOL_0076bb4c = 1;
								BOOL_0076bb50 = 1;
							}
							globals::g_ButtonState_LeftDown = 1;
							globals::g_ButtonState_RightDown = 1;
							BOOL_0076bb54 = 1;
							return 0;
						case 1:
						case 4:
										// WM_LBUTTONUP (0x202) or WM_RBUTTONUP (0x205)
							ReleaseCapture();
							BOOL_0076bb4c = 0;
							BOOL_0076bb50 = 0;
							globals::g_ButtonState_RightDown = 0;
							globals::g_ButtonState_LeftDown = 0;
						}
					}
				}
				else {
					if (true) {
						switch(iVar1) {
						case 0:
										// WM_LBUTTONDOWN (0x201)
							SetCapture(hWnd);
							globals::g_ButtonState_LeftDown = 1;
							BOOL_0076bb4c = 1;
							BOOL_0076bb54 = 1;
							return 0;
						case 1:
										// WM_LBUTTONUP (0x202)
							ReleaseCapture();
							globals::g_ButtonState_LeftDown = 0;
							BOOL_0076bb4c = 0;
							BOOL_0076bb54 = 1;
							return 0;
						case 3:
							globals::g_ButtonState_RightDown = 1;
							BOOL_0076bb50 = 1;
							BOOL_0076bb54 = 1;
							return 0;
						case 4:
										// WM_RBUTTONUP (0x205)
							globals::g_ButtonState_RightDown = 0;
							BOOL_0076bb50 = 0;
							BOOL_0076bb54 = 1;
							return 0;
						}
					}
				}
			case 2:
										// WM_LBUTTONDBLCLK (0x203)
				BOOL_0076bb54 = 1;
										// WM_RBUTTONDBLCLK (0x206)
				return 0;
			case 5:
				globals::g_ButtonState_RightDoubleClicked = 1;
				return 0;
			}
			goto switchD_004789e8_caseD_6;
		}
		if (message == WM_ACTIVATEAPP) {
										// True if this window is being activated
			globals::wnd::g_IsFocused = wParam;
			return 0;
		}
										// WM_CLOSE (0x10)  -0x10, is closing
		UVar3 = message - 0x10;
		if (message - 0x10 == 0) {
			globals::wnd::g_IsClosing = 1;
			return 0;
		}
	}
										// WM_QUIT (0x12)
	if (UVar3 == WM_DESTROY) {
		globals::wnd::g_IsClosing = 1;
		return 0;
	}
switchD_004789e8_caseD_6:
	LVar2 = DefWindowProcA(hWnd,message,wParam,lParam);
	return LVar2;
}



LRESULT lego::wnd::Win_WindowProc(HWND hWnd,UINT message,WPARAM wParam,LPARAM lParam)
{
	LRESULT LVar1;
	
	if (((byte)globals::g_CMDLINE_FLAGS & CMD_FULLSCREEN) != 0) {
		LVar1 = Win_WindowProc__FullScreen(hWnd,message,wParam,lParam);
		return LVar1;
	}
	LVar1 = Win_WindowProc__Windowed(hWnd,message,wParam,lParam);
	return LVar1;
}



void __cdecl lego::draw::Draw_SetRenderState(uint renderStateType,undefined4 renderStateValue)
{
	uint uVar1;
	uint *unaff_ESI;
	
	uVar1 = renderStateType;
	(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->GetRenderState)
						(lego::globals::g_IDirect3DDevice3,renderStateType);
	if (&renderStateType != unaff_ESI) {
		(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetRenderState)
							(lego::globals::g_IDirect3DDevice3,uVar1);
		if (lego::globals::g_RenderStates_TABLE[uVar1].isUsed == 0) {
			lego::globals::g_RenderStates_TABLE[uVar1].isUsed = 1;
			lego::globals::g_RenderStates_TABLE[uVar1].value = (DWORD)unaff_ESI;
		}
		else {
			if ((uint *)lego::globals::g_RenderStates_TABLE[uVar1].value == unaff_ESI) {
				lego::globals::g_RenderStates_TABLE[uVar1].isUsed = 0;
				return;
			}
		}
	}
	return;
}



void __cdecl lego::draw::Draw_CleanupRenderStates(void)
{
	CmdlineFlags *pCVar1;
	int iVar2;
	
	iVar2 = 0;
	pCVar1 = (CmdlineFlags *)&lego::globals::g_RenderStates_TABLE[0].isUsed;
	do {
		if (*pCVar1 != CMD_NONE) {
			(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetRenderState)
								(lego::globals::g_IDirect3DDevice3,iVar2,pCVar1[-1]);
			*pCVar1 = CMD_NONE;
		}
		pCVar1 = pCVar1 + 2;
		iVar2 += 1;
	} while (pCVar1 < &lego::globals::g_CMDLINE_FLAGS);
	return;
}



void lego::snd::SFX_UNKCallsMixer__00478c40(undefined param_1,undefined param_2)
{
	SFX_UnkMixer__00478c80((float *)&param_1,(float *)&param_2,1);
	return;
}



void __cdecl FUN_00478c60(float *param_1,float *param_2)
{
	lego::snd::SFX_UnkMixer__00478c80(param_1,param_2,0);
	return;
}



undefined4 __cdecl lego::snd::SFX_UnkMixer__00478c80(float *param_1,float *param_2,int param_3)
{
	UINT UVar1;
	MMRESULT MVar2;
	LPMIXERCONTROLA buffer;
	uint *buffer_00;
	uint uVar3;
	int iVar4;
	uint *puVar5;
	uint uVar6;
	uint uVar7;
	_union_1085 *p_Var8;
	UINT_PTR uMxId;
	tagMIXERCAPSA *ptVar9;
	tagMIXERLINEA *ptVar10;
	tagMIXERLINECONTROLSA *ptVar11;
	tMIXERCONTROLDETAILS *ptVar12;
	float10 extraout_ST0;
	longlong lVar13;
	HMIXEROBJ local_154;
	undefined4 local_150;
	uint local_14c;
	uint local_148;
	uint local_144;
	uint local_140;
	UINT local_13c;
	uint local_138;
	LPMIXERCONTROLA local_134;
	uint local_130;
	undefined4 uStack300;
	int local_128;
	undefined4 local_124;
	tMIXERCONTROLDETAILS local_120;
	int local_108;
	undefined4 local_104;
	uint local_100;
	undefined4 uStack252;
	uint local_f8;
	undefined4 uStack244;
	tagMIXERLINECONTROLSA local_f0;
	tagMIXERLINEA local_d8;
	tagMIXERCAPSA local_30;
	
	UVar1 = mixerGetNumDevs();
	local_150 = 0;
	if (param_3 != 0) {
		if ((ushort)((ushort)(*param_1 < 1.0) << 8 | (ushort)(*param_1 == 1.0) << 0xe) == 0) {
			*param_1 = 1.0;
		}
		if (*param_1 < 0.0) {
			*param_1 = 0.0;
		}
		if ((ushort)((ushort)(*param_2 < 1.0) << 8 | (ushort)(*param_2 == 1.0) << 0xe) == 0) {
			*param_2 = 1.0;
		}
		if (*param_2 < 0.0) {
			*param_2 = 0.0;
		}
	}
	local_140 = 0;
	local_13c = UVar1;
	if (UVar1 != 0) {
		do {
			uMxId = local_140;
			MVar2 = mixerOpen((LPHMIXER)&local_154,local_140,0,0,0);
			if (MVar2 == 0) {
				ptVar9 = &local_30;
				for (iVar4 = 0xc; iVar4 != 0; iVar4 += -1) {
					*(undefined4 *)ptVar9 = 0;
					ptVar9 = (tagMIXERCAPSA *)&ptVar9->vDriverVersion;
				}
				mixerGetDevCapsA(uMxId,(LPMIXERCAPSA)&local_30,0x30);
				local_148 = 0;
				if (local_30.cDestinations != 0) {
					do {
						uVar3 = local_148;
						ptVar10 = &local_d8;
						for (iVar4 = 0x2a; iVar4 != 0; iVar4 += -1) {
							ptVar10->cbStruct = 0;
							ptVar10 = (tagMIXERLINEA *)&ptVar10->dwDestination;
						}
						local_d8.cbStruct = 0xa8;
						local_d8.dwDestination = local_148;
						MVar2 = mixerGetLineInfoA(local_154,(LPMIXERLINEA)&local_d8,0);
						if (MVar2 == 0) {
							local_138 = local_d8.cConnections;
							local_144 = 0;
							uMxId = local_140;
							if (local_d8.cConnections != 0) {
								do {
									uVar7 = local_144;
									local_d8.cbStruct = 0xa8;
									local_d8.dwDestination = uVar3;
									local_d8.dwSource = local_144;
									MVar2 = mixerGetLineInfoA(local_154,(LPMIXERLINEA)&local_d8,1);
									if ((MVar2 == 0) && (local_d8.dwComponentType == 0x1005)) {
										ptVar11 = &local_f0;
										for (iVar4 = 6; iVar4 != 0; iVar4 += -1) {
											ptVar11->cbStruct = 0;
											ptVar11 = (tagMIXERLINECONTROLSA *)&ptVar11->dwLineID;
										}
										local_f0.cbStruct = 0x18;
										local_f0.dwLineID = local_d8.dwLineID;
										local_f0.cControls = local_d8.cControls;
										local_f0.cbmxctrl = 0x94;
										buffer = (LPMIXERCONTROLA)std::malloc(local_d8.cControls * 0x94);
										local_134 = buffer;
										local_f0.pamxctrl = buffer;
										MVar2 = mixerGetLineControlsA(local_154,(LPMIXERLINECONTROLSA)&local_f0,0);
										if ((MVar2 == 0) && (local_14c = 0, local_d8.cControls != 0)) {
											p_Var8 = &buffer->Bounds;
											do {
												if (((*(uint *)&p_Var8[-4].field_0x4 & 0x50000000) != 0) &&
													 ((*(uint *)&p_Var8[-4].field_0x4 & 0x50030001) != 0)) {
													local_120.dwControlID = *(DWORD *)(p_Var8 + -4);
													ptVar12 = &local_120;
													for (iVar4 = 6; iVar4 != 0; iVar4 += -1) {
														ptVar12->cbStruct = 0;
														ptVar12 = (tMIXERCONTROLDETAILS *)&ptVar12->dwControlID;
													}
													local_120.cbStruct = 0x18;
													local_120.cChannels = local_d8.cChannels;
													local_120.cbDetails = 4;
													local_120.u = 0;
													buffer_00 = (uint *)std::malloc(local_d8.cChannels << 2);
													local_120.paDetails = buffer_00;
													if (param_3 == 0) {
														MVar2 = mixerGetControlDetailsA
																							(local_154,(LPMIXERCONTROLDETAILS)&local_120,0);
														if (MVar2 == 0) {
															local_100 = *buffer_00 - *(int *)p_Var8;
															uStack252 = 0;
															local_108 = *(int *)&p_Var8->field_0x4 - *(int *)p_Var8;
															local_104 = 0;
															*param_1 = (float)(ulonglong)local_100 / (float)local_108;
															if (local_d8.cChannels == 2) {
																local_130 = buffer_00[1] - *(int *)p_Var8;
																uStack300 = 0;
																local_128 = *(int *)&p_Var8->field_0x4 - *(int *)p_Var8;
																local_124 = 0;
																local_150 = 1;
																*param_2 = (float)(ulonglong)local_130 / (float)local_128;
															}
															else {
																local_150 = 1;
																*param_2 = (float)(ulonglong)local_100 / (float)local_108;
															}
														}
													}
													else {
														iVar4 = *(int *)p_Var8;
														local_f8 = *(int *)&p_Var8->field_0x4 - iVar4;
														uStack244 = 0;
														lVar13 = __ftol((float10)*param_1 * (float10)(ulonglong)local_f8);
														uVar7 = (int)lVar13 + iVar4;
														lVar13 = __ftol((float10)*param_2 * extraout_ST0);
														uVar3 = (int)lVar13 + iVar4;
														if (local_d8.cChannels == 2) {
															*buffer_00 = uVar7;
															buffer_00[1] = uVar3;
														}
														else {
															uVar6 = 0;
															if (local_d8.cChannels != 0) {
																puVar5 = buffer_00;
																do {
																	*puVar5 = uVar3 + uVar7 >> 1;
																	uVar6 += 1;
																	puVar5 = puVar5 + 1;
																} while (uVar6 < local_d8.cChannels);
															}
														}
														MVar2 = mixerSetControlDetails
																							(local_154,(LPMIXERCONTROLDETAILS)&local_120,0);
														if (MVar2 == 0) {
															local_150 = 1;
														}
													}
													std::free(buffer_00);
													buffer = local_134;
												}
												local_14c += 1;
												p_Var8 = (_union_1085 *)&p_Var8[6].field_0x4;
												uVar3 = local_148;
												uVar7 = local_144;
											} while (local_14c < local_d8.cControls);
										}
										std::free(buffer);
									}
									local_144 = uVar7 + 1;
									uMxId = local_140;
								} while (local_144 < local_138);
							}
						}
						local_148 = uVar3 + 1;
					} while (local_148 < local_30.cDestinations);
				}
				mixerClose((HMIXER)local_154);
				UVar1 = local_13c;
			}
			local_140 = uMxId + 1;
		} while (local_140 < UVar1);
	}
	return local_150;
}



void __cdecl lego::pool::ReservedPool_CFGProperty___Init(void)
{
	int iVar1;
	CFGProperty **ppCVar2;
	
	ppCVar2 = globals::ReservedPool_CFGProperty___g_TABLE;
	for (iVar1 = 0x20; iVar1 != 0; iVar1 += -1) {
		*ppCVar2 = NULL;
		ppCVar2 = ppCVar2 + 1;
	}
	globals::ReservedPool_CFGProperty___g_NEXT = NULL;
	globals::ReservedPool_CFGProperty___g_COUNT = 0;
	globals::ReservedPool_CFGProperty___g_ISINIT = 1;
	return;
}



void __cdecl lego::pool::ReservedPool_CFGProperty___Cleanup(void)
{
	CFGProperty **ppCVar1;
	
	ppCVar1 = globals::ReservedPool_CFGProperty___g_TABLE;
	do {
		if (*ppCVar1 != NULL) {
			std::free(*ppCVar1);
		}
		ppCVar1 = ppCVar1 + 1;
	} while (ppCVar1 < &globals::ReservedPool_CFGProperty___g_NEXT);
	globals::ReservedPool_CFGProperty___g_NEXT = NULL;
	globals::ReservedPool_CFGProperty___g_ISINIT = 0;
	return;
}



CFGProperty * __cdecl lego::cfg::CFG_Open(char *filename)
{
	char cVar1;
	CFGProperty *current;
	uint uVar2;
	char *pcVar3;
	CFGProperty *root;
	byte *text;
	char *pcVar4;
	char *pcVar5;
	byte c;
	bool isComment;
	
	root = NULL;
	isComment = false;
	text = lego::file::File_ReadAllBytes(filename,(uint *)&filename);
	if (text != NULL) {
		root = pool::ReservedPool_CFGProperty___Next(NULL);
		pcVar4 = NULL;
		root->fileText = (char *)text;
		if (filename != NULL) {
			do {
				c = *text;
				if (c == 0x3b) {
					isComment = true;
				}
				else {
					if (c == 10) {
						isComment = false;
					}
				}
				if ((((isComment) || (c == 9)) || (c == 10)) || ((c == 0xd || (c == 0x20)))) {
					*text = 0;
				}
				text = text + 1;
				pcVar4 = pcVar4 + 1;
			} while (pcVar4 < filename);
		}
		pcVar4 = root->fileText;
		pcVar5 = NULL;
		current = root;
		pcVar3 = filename;
		if (filename != NULL) {
			do {
				if (*pcVar4 == '\0') {
					pcVar4 = pcVar4 + 1;
				}
				else {
					if ((*pcVar4 == '}') && (pcVar4[1] == '\0')) {
						uVar2 = current->depth - 1;
LAB_004791e1:
						current->depth = uVar2;
					}
					else {
						if (current->key == NULL) {
							current->key = pcVar4;
						}
						else {
							current->value = pcVar4;
							current = pool::ReservedPool_CFGProperty___Next(current);
							if ((*pcVar4 == '{') && (pcVar4[1] == '\0')) {
								uVar2 = current->depth + 1;
								goto LAB_004791e1;
							}
						}
					}
					while ((pcVar3 = filename, pcVar5 < filename &&
								 (cVar1 = *pcVar4, pcVar4 = pcVar4 + 1, cVar1 != '\0'))) {
						pcVar5 = pcVar5 + 1;
					}
				}
				pcVar5 = pcVar5 + 1;
			} while (pcVar5 < pcVar3);
		}
	}
	return root;
}



char * __cdecl lego::cfg::CFG_JoinPath(char *keyPath1,char *keyPath2,...)
{
	char cVar1;
	uint uVar2;
	uint uVar3;
	int iVar4;
	char **ppcVar5;
	undefined4 *puVar6;
	char *pcVar7;
	char *pcVar8;
	char *pcVar9;
	undefined4 *puVar10;
	
	uVar2 = 0xffffffff;
	do {
		pcVar7 = keyPath1;
		if (uVar2 == 0) break;
		uVar2 -= 1;
		pcVar7 = keyPath1 + 1;
		cVar1 = *keyPath1;
		keyPath1 = pcVar7;
	} while (cVar1 != '\0');
	uVar2 = ~uVar2;
	ppcVar5 = (char **)&stack0x0000000c;
	puVar6 = (undefined4 *)(pcVar7 + -uVar2);
	puVar10 = (undefined4 *)globals::temp::tmp_CFG_JOINPATH;
	for (uVar3 = uVar2 >> 2; uVar3 != 0; uVar3 -= 1) {
		*puVar10 = *puVar6;
		puVar6 = puVar6 + 1;
		puVar10 = puVar10 + 1;
	}
	for (uVar2 &= 3; uVar2 != 0; uVar2 -= 1) {
		*(undefined *)puVar10 = *(undefined *)puVar6;
		puVar6 = (undefined4 *)((int)puVar6 + 1);
		puVar10 = (undefined4 *)((int)puVar10 + 1);
	}
	if (keyPath2 != NULL) {
		do {
			uVar2 = 0xffffffff;
			pcVar7 = "::";
			do {
				pcVar8 = pcVar7;
				if (uVar2 == 0) break;
				uVar2 -= 1;
				pcVar8 = pcVar7 + 1;
				cVar1 = *pcVar7;
				pcVar7 = pcVar8;
			} while (cVar1 != '\0');
			uVar2 = ~uVar2;
			iVar4 = -1;
			pcVar7 = globals::temp::tmp_CFG_JOINPATH;
			do {
				pcVar9 = pcVar7;
				if (iVar4 == 0) break;
				iVar4 += -1;
				pcVar9 = pcVar7 + 1;
				cVar1 = *pcVar7;
				pcVar7 = pcVar9;
			} while (cVar1 != '\0');
			puVar6 = (undefined4 *)(pcVar8 + -uVar2);
			puVar10 = (undefined4 *)(pcVar9 + -1);
			for (uVar3 = uVar2 >> 2; uVar3 != 0; uVar3 -= 1) {
				*puVar10 = *puVar6;
				puVar6 = puVar6 + 1;
				puVar10 = puVar10 + 1;
			}
			for (uVar2 &= 3; uVar2 != 0; uVar2 -= 1) {
				*(undefined *)puVar10 = *(undefined *)puVar6;
				puVar6 = (undefined4 *)((int)puVar6 + 1);
				puVar10 = (undefined4 *)((int)puVar10 + 1);
			}
			uVar2 = 0xffffffff;
			do {
				pcVar7 = keyPath2;
				if (uVar2 == 0) break;
				uVar2 -= 1;
				pcVar7 = keyPath2 + 1;
				cVar1 = *keyPath2;
				keyPath2 = pcVar7;
			} while (cVar1 != '\0');
			uVar2 = ~uVar2;
			iVar4 = -1;
			pcVar8 = globals::temp::tmp_CFG_JOINPATH;
			do {
				pcVar9 = pcVar8;
				if (iVar4 == 0) break;
				iVar4 += -1;
				pcVar9 = pcVar8 + 1;
				cVar1 = *pcVar8;
				pcVar8 = pcVar9;
			} while (cVar1 != '\0');
			puVar6 = (undefined4 *)(pcVar7 + -uVar2);
			puVar10 = (undefined4 *)(pcVar9 + -1);
			for (uVar3 = uVar2 >> 2; uVar3 != 0; uVar3 -= 1) {
				*puVar10 = *puVar6;
				puVar6 = puVar6 + 1;
				puVar10 = puVar10 + 1;
			}
			keyPath2 = *ppcVar5;
			for (uVar2 &= 3; uVar2 != 0; uVar2 -= 1) {
				*(undefined *)puVar10 = *(undefined *)puVar6;
				puVar6 = (undefined4 *)((int)puVar6 + 1);
				puVar10 = (undefined4 *)((int)puVar10 + 1);
			}
			ppcVar5 = ppcVar5 + 1;
		} while (keyPath2 != NULL);
	}
	return globals::temp::tmp_CFG_JOINPATH;
}



CFGProperty * __cdecl lego::cfg::CFG_GetBlockFirstChild(CFGProperty *root,char *keyPath)
{
	CFGProperty *prop;
	
	prop = CFG_GetProperty(root,keyPath);
	if ((prop != NULL) && (prop->depth < prop->next->depth)) {
		return prop->next;
	}
	return NULL;
}



CFGProperty * __cdecl lego::cfg::CFG_NextFlatProperty(CFGProperty *prop)
{
	uint nextDepth;
	uint currentDepth;
	
	currentDepth = prop->depth;
	nextDepth = currentDepth;
	if (prop != NULL) {
		do {
			if (nextDepth < currentDepth) {
				return NULL;
			}
			prop = prop->next;
			if (prop->depth == currentDepth) {
				return prop;
			}
			nextDepth = prop->depth;
		} while (prop != NULL);
	}
	return NULL;
}



char * __cdecl lego::cfg::CFG_CopyPropertyValue(CFGProperty *prop,char *keyPath)
{
	char cVar1;
	CFGProperty *pCVar2;
	undefined4 *puVar3;
	uint uVar4;
	uint uVar5;
	undefined4 *puVar6;
	char *pcVar7;
	char *pcVar8;
	undefined4 *puVar9;
	
	pCVar2 = CFG_GetProperty(prop,keyPath);
	if ((pCVar2 == NULL) || (pCVar2->value == NULL)) {
		return (char *)NULL;
	}
	uVar4 = 0xffffffff;
	pcVar7 = pCVar2->value;
	do {
		if (uVar4 == 0) break;
		uVar4 -= 1;
		cVar1 = *pcVar7;
		pcVar7 = pcVar7 + 1;
	} while (cVar1 != '\0');
	puVar3 = (undefined4 *)std::malloc(~uVar4);
	uVar4 = 0xffffffff;
	pcVar7 = pCVar2->value;
	do {
		pcVar8 = pcVar7;
		if (uVar4 == 0) break;
		uVar4 -= 1;
		pcVar8 = pcVar7 + 1;
		cVar1 = *pcVar7;
		pcVar7 = pcVar8;
	} while (cVar1 != '\0');
	uVar4 = ~uVar4;
	puVar6 = (undefined4 *)(pcVar8 + -uVar4);
	puVar9 = puVar3;
	for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
		*puVar9 = *puVar6;
		puVar6 = puVar6 + 1;
		puVar9 = puVar9 + 1;
	}
	for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
		*(undefined *)puVar9 = *(undefined *)puVar6;
		puVar6 = (undefined4 *)((int)puVar6 + 1);
		puVar9 = (undefined4 *)((int)puVar9 + 1);
	}
	return (char *)puVar3;
}



char * __cdecl lego::cfg::CFG_GetPropertyValue(CFGProperty *root,char *keyPath)
{
	CFGProperty *prop;
	
	prop = CFG_GetProperty(root,keyPath);
	if (prop != NULL) {
		return prop->value;
	}
	return NULL;
}



uint __cdecl lego::cfg::CFG_GetPropertyBool(CFGProperty *prop,char *keyPath)
{
	char *text;
	uint uVar1;
	
	uVar1 = 2;
	text = CFG_CopyPropertyValue(prop,keyPath);
	if (text != NULL) {
		uVar1 = util::parseBoolLiteral(text);
		std::free(text);
	}
	return uVar1;
}



float10 __cdecl lego::cfg::CFG_GetPropertyRadians(CFGProperty *root,char *keyPath)
{
	char *pcVar1;
	float10 fVar2;
	
	pcVar1 = CFG_GetPropertyValue(root,keyPath);
	if (pcVar1 == NULL) {
		pcVar1 = ____EMPTYSTR__;
	}
	else {
		pcVar1 = CFG_GetPropertyValue(root,keyPath);
	}
	fVar2 = std::atof(pcVar1);
	if (fVar2 != (float10)0.0) {
		return fVar2 * (float10)0.002777778 * (float10)6.283185;
	}
	return (float10)0.0;
}



BOOL __cdecl
lego::cfg::CFG_GetPropertyRGBF
					(CFGProperty *root,char *keyPath,float *out_r,float *out_g,float *out_b)
{
	char *input;
	int numParts;
	int channel;
	uint result;
	char *parts_0;
	char *parts_1;
	char *parts_2;
	
	result = 0;
	input = CFG_CopyPropertyValue(root,keyPath);
	if (input != NULL) {
		numParts = util::stringSplit(input,&parts_0,":");
		if (numParts == 3) {
			channel = std::atoi(parts_0);
			*out_r = (float)channel * 0.003921569;
			channel = std::atoi(parts_1);
			*out_g = (float)channel * 0.003921569;
			channel = std::atoi(parts_2);
			*out_b = (float)channel * 0.003921569;
		}
		result = (uint)(numParts == 3);
		std::free(input);
	}
	return result;
}



void __cdecl lego::cfg::CFG_Close(CFGProperty *root)
{
	CFGProperty *prop;
	
	std::free(root->fileText);
	if (root != NULL) {
		do {
			prop = root->next;
			pool::ReservedPool_CFGProperty___Release(root);
			root = prop;
		} while (prop != NULL);
	}
	return;
}



CFGProperty * __cdecl lego::pool::ReservedPool_CFGProperty___Next(CFGProperty *previous)
{
	uint uVar1;
	CFGProperty *pCVar2;
	CFGProperty *next;
	
	if (globals::ReservedPool_CFGProperty___g_NEXT == NULL) {
		ReservedPool_CFGProperty___Alloc();
	}
	next = globals::ReservedPool_CFGProperty___g_NEXT;
	pCVar2 = globals::ReservedPool_CFGProperty___g_NEXT->pool_m_next;
	globals::ReservedPool_CFGProperty___g_NEXT->pool_m_next =
			 globals::ReservedPool_CFGProperty___g_NEXT;
	globals::ReservedPool_CFGProperty___g_NEXT = pCVar2;
	next->key = NULL;
	next->value = NULL;
	next->next = NULL;
	if (previous != NULL) {
		previous->next = next;
		next->previous = previous;
		uVar1 = previous->depth;
		next->fileText = NULL;
		next->depth = uVar1;
		return next;
	}
	next->depth = 0;
	next->previous = NULL;
	return next;
}



void __cdecl lego::pool::ReservedPool_CFGProperty___Release(CFGProperty *prop)
{
	prop->pool_m_next = globals::ReservedPool_CFGProperty___g_NEXT;
	globals::ReservedPool_CFGProperty___g_NEXT = prop;
	return;
}



CFGProperty * __cdecl lego::cfg::CFG_GetProperty(CFGProperty *prop,char *keyPath)
{
	char *pcVar1;
	int numParts;
	int tmpCmp;
	uint uVar2;
	char *pcVar3;
	uint uVar4;
	undefined4 *puVar5;
	size_t sVar6;
	char *pcVar7;
	undefined4 *puVar8;
	bool isWildcard;
	CFGProperty *result;
	char *input_parts [101];
	char c;
	uint depth;
	CFGProperty *previous;
	
	depth = 0xffffffff;
	pcVar7 = keyPath;
	do {
		if (depth == 0) break;
		depth -= 1;
		c = *pcVar7;
		pcVar7 = pcVar7 + 1;
	} while (c != '\0');
	result = NULL;
	input_parts[0] = (char *)std::malloc(~depth);
	depth = 0xffffffff;
	do {
		pcVar7 = keyPath;
		if (depth == 0) break;
		depth -= 1;
		pcVar7 = keyPath + 1;
		c = *keyPath;
		keyPath = pcVar7;
	} while (c != '\0');
	depth = ~depth;
	puVar5 = (undefined4 *)(pcVar7 + -depth);
	puVar8 = (undefined4 *)input_parts[0];
	for (uVar2 = depth >> 2; uVar2 != 0; uVar2 -= 1) {
		*puVar8 = *puVar5;
		puVar5 = puVar5 + 1;
		puVar8 = puVar8 + 1;
	}
	for (depth &= 3; depth != 0; depth -= 1) {
		*(undefined *)puVar8 = *(undefined *)puVar5;
		puVar5 = (undefined4 *)((int)puVar5 + 1);
		puVar8 = (undefined4 *)((int)puVar8 + 1);
	}
	numParts = util::stringSplit(input_parts[0],input_parts + 1,"::");
	if (prop != NULL) {
		do {
			if (prop->depth == numParts - 1U) {
				isWildcard = false;
				if (numParts == 1) {
					pcVar7 = prop->key;
					sVar6 = 0;
					c = *pcVar7;
					pcVar3 = pcVar7;
					while ((c != '\0' && (c != '*'))) {
						pcVar1 = pcVar3 + 1;
						sVar6 += 1;
						pcVar3 = pcVar3 + 1;
						c = *pcVar1;
					}
					if (*pcVar3 == '*') {
						tmpCmp = std::_strnicmp(input_parts[1],pcVar7,sVar6);
						isWildcard = tmpCmp == 0;
					}
				}
				if ((isWildcard) || (tmpCmp = std::_stricmp(input_parts[numParts],prop->key), tmpCmp == 0))
				{
					isWildcard = false;
					depth = numParts - 1U;
					for (previous = prop; previous != NULL; previous = previous->previous) {
						uVar2 = depth - 1;
						uVar4 = depth;
						if (previous->depth == uVar2) {
							if (depth == 1) {
								pcVar7 = previous->key;
								sVar6 = 0;
								c = *pcVar7;
								pcVar3 = pcVar7;
								while ((c != '\0' && (c != '*'))) {
									pcVar1 = pcVar3 + 1;
									sVar6 += 1;
									pcVar3 = pcVar3 + 1;
									c = *pcVar1;
								}
								if (*pcVar3 == '*') {
									tmpCmp = std::_strnicmp(input_parts[1],pcVar7,sVar6);
									isWildcard = tmpCmp == 0;
								}
							}
							uVar4 = uVar2;
							if ((!isWildcard) &&
								 (tmpCmp = std::_stricmp(input_parts[depth],previous->key), tmpCmp != 0)) break;
						}
						depth = uVar4;
					}
					if ((depth == 0) && (result = prop, !isWildcard)) break;
				}
			}
			prop = prop->next;
		} while (prop != NULL);
	}
	std::free(input_parts[0]);
	return result;
}



void __cdecl lego::pool::ReservedPool_CFGProperty___Alloc(void)
{
	CFGProperty *pCVar1;
	CFGProperty *pCVar2;
	int iVar3;
	uint uVar4;
	
	uVar4 = 1 << ((byte)globals::ReservedPool_CFGProperty___g_COUNT & 0x1f);
	pCVar2 = (CFGProperty *)std::malloc(uVar4 * 0x20);
	globals::ReservedPool_CFGProperty___g_TABLE[globals::ReservedPool_CFGProperty___g_COUNT] = pCVar2;
	pCVar2 = globals::ReservedPool_CFGProperty___g_TABLE[globals::ReservedPool_CFGProperty___g_COUNT];
	if (pCVar2 != NULL) {
		globals::ReservedPool_CFGProperty___g_COUNT += 1;
		if (1 < uVar4) {
			iVar3 = uVar4 - 1;
			pCVar1 = pCVar2;
			do {
				pCVar1->pool_m_next = pCVar1 + 1;
				iVar3 += -1;
				pCVar1 = pCVar1 + 1;
			} while (iVar3 != 0);
		}
		pCVar2[uVar4 - 1].pool_m_next = globals::ReservedPool_CFGProperty___g_NEXT;
		globals::ReservedPool_CFGProperty___g_NEXT = pCVar2;
	}
	return;
}



// out_vector = norm({ rand(), rand(), rand() })

Vector3F * __cdecl lego::math::Vector3_Random(Vector3F *out_vector)
{
	Vector3F *pVVar1;
	
	pVVar1 = D3DRMVectorRandom(out_vector);
	return pVVar1;
}



// out_vector = ::D3DRMVectorRotate(out_vector, v, axis, theta)

Vector3F * __cdecl
lego::math::Vector3_Rotate(Vector3F *out_vector,Vector3F *v,Vector3F *axis,float theta)
{
	Vector3F *pVVar1;
	
	pVVar1 = D3DRMVectorRotate(out_vector,v,axis,theta);
	return pVVar1;
}



Vector3F * __cdecl
lego::math::Vector3_VectorSqrtUnk(Vector3F *out_vector,Vector3F *a,Vector3F *b,Vector3F *c)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	float fVar6;
	float fVar7;
	
	fVar1 = c->x - b->x;
	fVar4 = b->x - a->x;
	fVar3 = c->y - b->y;
	fVar5 = c->z - b->z;
	fVar6 = b->y - a->y;
	fVar7 = b->z - a->z;
	fVar2 = fVar1 * fVar7 - fVar5 * fVar4;
	fVar4 = fVar3 * fVar4 - fVar1 * fVar6;
	fVar3 = fVar5 * fVar6 - fVar3 * fVar7;
	fVar1 = 1.0 / SQRT(fVar3 * fVar3 + fVar4 * fVar4 + fVar2 * fVar2);
	out_vector->x = fVar1 * fVar3;
	out_vector->y = fVar1 * fVar2;
	out_vector->z = fVar1 * fVar4;
	return out_vector;
}



float10 __cdecl FUN_004798f0(float *param_1,float *param_2,float *param_3,int param_4)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	Vector3F *pVVar5;
	Vector3F *pVVar6;
	float *pfVar7;
	float *pfVar8;
	Vector3F **ppVVar9;
	undefined4 unaff_EDI;
	uint uVar10;
	float10 fVar11;
	float local_8c;
	uint local_88;
	float local_7c;
	Vector3F local_78;
	Vector3F local_6c;
	Vector3F local_60;
	Vector3F *local_54 [5];
	Vector3F *local_40;
	Vector3F local_3c;
	float local_30 [12];
	
	local_54[0] = &local_78;
	local_54[1] = &local_6c;
	local_54[3] = &local_60;
	local_54[2] = &local_6c;
	local_54[4] = &local_60;
	local_78.x = *param_1;
	local_40 = &local_78;
	local_78.y = param_1[1];
	local_6c.x = *param_2;
	local_6c.y = param_2[1];
	local_60.x = *param_3;
	local_60.y = param_3[1];
	local_7c = 0.0;
	local_8c = 0.0;
	local_78.z = 0.0;
	local_6c.z = 0.0;
	local_60.z = 0.0;
	if (param_4 == 0) {
		local_3c.z = -1.0;
	}
	else {
		lego::math::Vector3_VectorSqrtUnk(&local_3c,&local_78,&local_6c,&local_60);
	}
	if (local_3c.z < 0.0) {
		uVar10 = 0;
		pfVar8 = local_30;
		ppVVar9 = local_54 + 1;
		pfVar7 = local_30 + 5;
		do {
			pVVar5 = *ppVVar9;
			pVVar6 = ppVVar9[-1];
			fVar1 = pVVar5->y;
			fVar2 = pVVar5->z;
			fVar3 = pVVar6->y;
			fVar4 = pVVar6->z;
			pfVar7[-2] = pVVar5->x - pVVar6->x;
			pfVar7[-1] = fVar1 - fVar3;
			*pfVar7 = fVar2 - fVar4;
			fVar2 = SQRT(pfVar7[-2] * pfVar7[-2] + *pfVar7 * *pfVar7 + pfVar7[-1] * pfVar7[-1]);
			fVar3 = 1.0 / fVar2;
			fVar1 = pfVar7[-2];
			*pfVar8 = fVar2;
			fVar2 = *pfVar8;
			pfVar7[-2] = fVar3 * fVar1;
			pfVar7[-1] = fVar3 * pfVar7[-1];
			*pfVar7 = fVar3 * *pfVar7;
			if ((ushort)((ushort)(fVar2 < local_8c) << 8 | (ushort)(fVar2 == local_8c) << 0xe) == 0) {
				local_8c = *pfVar8;
				local_88 = uVar10;
			}
			uVar10 += 1;
			ppVVar9 = ppVVar9 + 2;
			pfVar7 = pfVar7 + 3;
			pfVar8 = pfVar8 + 1;
		} while (uVar10 < 3);
		local_30[local_88 * 3 + 3] = local_30[local_88 * 3 + 3] * -1.0;
		local_30[local_88 * 3 + 4] = local_30[local_88 * 3 + 4] * -1.0;
		local_30[local_88 * 3 + 5] = local_30[local_88 * 3 + 5] * -1.0;
		fVar11 = (float10)FUN_0048e350();
		uVar10 = FUN_0048eb30(SUB84((double)fVar11,0),
													CONCAT44(unaff_EDI,(int)((ulonglong)(double)fVar11 >> 0x20)));
		if (uVar10 != 0) {
			fVar11 = (float10)fsin((float10)(float)fVar11);
			local_7c = (float)((float10)local_30[local_88] * (float10)0.5 *
												fVar11 * (float10)local_30[(local_88 + 1) % 3]);
		}
	}
	return (float10)local_7c;
}



short __cdecl lego::util::randomInt16(void)
{
	globals::g_RAND = globals::g_RAND * 0x343fd + 0x269ec3;
	return (short)((ushort)(globals::g_RAND >> 0x10) & 0x7fff);
}



float10 __cdecl lego::game::Game_ChooseRandomRange(float rangeMin,float rangeMax)
{
	short sVar1;
	
	sVar1 = lego::util::randomInt16();
	return (float10)(int)sVar1 * (float10)3.051851e-05 * ((float10)rangeMax - (float10)rangeMin) +
				 (float10)rangeMin;
}



// out_vector = a + (norm(b) * (dot_product((c - a), norm(d)) / dot_product(norm(b), norm(d)))
// CONDITION: dot_product(norm(b), norm(d)) != 0.0

BOOL __cdecl
lego::math::Vector3_Unk_FUN_00479ba0
					(Vector3F *out_vector,Vector3F *a,Vector3F *b,Vector3F *c,Vector3F *d)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	float fVar5;
	float fVar6;
	float fVar7;
	BOOL BVar8;
	Vector3F norm_b;
	Vector3F norm_d;
	
	fVar1 = d->x;
	fVar2 = b->x;
	fVar3 = d->y;
	fVar4 = b->y;
	fVar5 = b->z;
	fVar6 = d->z;
	fVar7 = 1.0 / SQRT(fVar5 * fVar5 + fVar4 * fVar4 + fVar2 * fVar2);
	b = (Vector3F *)(1.0 / SQRT(fVar6 * fVar6 + fVar3 * fVar3 + fVar1 * fVar1));
	norm_b.x = fVar7 * fVar2;
	norm_b.y = fVar7 * fVar4;
	norm_b.z = fVar7 * fVar5;
	norm_d.x = (float)b * fVar1;
	norm_d.y = (float)b * fVar3;
	norm_d.z = (float)b * fVar6;
	BVar8 = Vector3_SubAC_MulD_Div_DotProductBD((float *)&b,a,&norm_b,c,&norm_d);
	if (BVar8 != 0) {
		Vector3_AddScaled(out_vector,a,&norm_b,(float)b);
		return 1;
	}
	return 0;
}



// out_value = dot_product((c - a), d) / dot_product(b, d)
// CONDITION: dot_product(b, d) != 0.0

BOOL __cdecl
lego::math::Vector3_SubAC_MulD_Div_DotProductBD
					(float *out_value,Vector3F *a,Vector3F *b,Vector3F *c,Vector3F *d)
{
	float dot_product;
	
										// Vector3_DotProduct(b, d)
	dot_product = d->x * b->x + b->z * d->z + b->y * d->y;
	if (dot_product != 0.0) {
										// Vector3_Multiply((Vector3_Subtract(c, a), d)
		*out_value = ((c->x - a->x) * d->x + (c->y - a->y) * d->y + (c->z - a->z) * d->z) / dot_product;
		return 1;
	}
	return 0;
}



// out_vector = a + (b * scalar)

Vector3F * __cdecl
lego::math::Vector3_AddScaled(Vector3F *out_vector,Vector3F *a,Vector3F *b,float scalar)
{
	float fVar1;
	float fVar2;
	
	fVar1 = b->y;
	fVar2 = b->z;
	out_vector->x = scalar * b->x + a->x;
	out_vector->y = a->y + fVar1 * scalar;
	out_vector->z = a->z + fVar2 * scalar;
	return out_vector;
}



Point2F * __cdecl
lego::math::Vector2_UnkOperation5(Point2F *out_point,Point2F *a,Point2F *b,Point2F *c,Point2F *d)
{
	float fVar1;
	
	fVar1 = -b->y * d->x - -b->x * d->y;
	if (fVar1 != 0.0) {
		fVar1 = (a->x - c->x) * -(d->y / fVar1) + (d->x / fVar1) * (a->y - c->y);
		out_point->x = fVar1 * b->x;
		out_point->y = fVar1 * b->y;
		out_point->x = a->x + out_point->x;
		out_point->y = out_point->y + a->y;
		return out_point;
	}
	return NULL;
}



BOOL __cdecl FUN_00479e40(Point2F *param_1,Point2F *param_2,Point2F *param_3,int count)
{
	float fVar1;
	float *pfVar2;
	uint uVar3;
	Point2F *pPVar4;
	
	uVar3 = 0;
	if (count != 0) {
		pfVar2 = &param_2->y;
		pPVar4 = (Point2F *)((int)param_3 - (int)param_2);
		do {
			if (((((ushort)((ushort)(*pfVar2 < param_1->y) << 8 | (ushort)(*pfVar2 == param_1->y) << 0xe)
						 != 0) && (param_1->y <= *(float *)((int)&pPVar4->x + (int)pfVar2))) ||
					((param_1->y <= *pfVar2 &&
					 (fVar1 = *(float *)((int)&pPVar4->x + (int)pfVar2),
					 (ushort)((ushort)(fVar1 < param_1->y) << 8 | (ushort)(fVar1 == param_1->y) << 0xe) != 0))
					)) && (fVar1 = (param_3->x - pfVar2[-1]) *
												 ((*(float *)((int)&pPVar4->x + (int)pfVar2) - *pfVar2) /
												 (param_1->y - *pfVar2)) + pfVar2[-1],
								(ushort)((ushort)(fVar1 < param_1->x) << 8 | (ushort)(fVar1 == param_1->x) << 0xe)
								== 0)) {
				uVar3 += 1;
			}
			param_3 = param_3 + 1;
			pfVar2 = pfVar2 + 2;
			count += -1;
		} while (count != 0);
	}
	return uVar3 & 1;
}



BOOL __cdecl lego::math::Vector3_CompareUnk1(Vector3F *a,float scalar,Vector3F *b,Vector3F *c)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	
	fVar1 = b->y - a->y;
	fVar4 = b->z - a->z;
	fVar3 = b->x - a->x;
	fVar2 = (c->z + c->z) * fVar4 + (c->y + c->y) * fVar1 + (c->x + c->x) * fVar3;
	fVar1 = fVar2 * fVar2 - ((fVar3 * fVar3 + fVar4 * fVar4 + fVar1 * fVar1) * 4.0 - scalar * scalar);
	if ((ushort)((ushort)(fVar1 < 0.0) << 8 | (ushort)(fVar1 == 0.0) << 0xe) == 0) {
		return 1;
	}
	return 0;
}



void __cdecl lego::math::FlocksMatrix_FUN_00479fa0(float *inputs,float *matrix_a,float *matrix_b)
{
	float fVar1;
	float fVar2;
	float *pfVar3;
	float *pfVar4;
	float *pfVar5;
	float *pfVar6;
	int iVar7;
	int iVar8;
	float *pfVar9;
	
	FlocksMatrix_Clear(inputs);
	pfVar5 = (float *)((int)inputs - (int)matrix_b);
	inputs = (float *)&DAT_00000004;
	do {
		pfVar6 = (float *)((int)pfVar5 + (int)matrix_b);
		iVar7 = 4;
		pfVar9 = matrix_a;
		do {
			iVar8 = 4;
			pfVar3 = pfVar9;
			pfVar4 = matrix_b;
			do {
				fVar1 = *pfVar4;
				fVar2 = *pfVar3;
				pfVar3 = pfVar3 + 4;
				pfVar4 = pfVar4 + 1;
				iVar8 += -1;
				*pfVar6 = fVar1 * fVar2 + *pfVar6;
			} while (iVar8 != 0);
			pfVar6 = pfVar6 + 1;
			pfVar9 = pfVar9 + 1;
			iVar7 += -1;
		} while (iVar7 != 0);
		matrix_b = matrix_b + 4;
		inputs = (float *)((int)inputs + -1);
	} while (inputs != NULL);
	return;
}



void __cdecl lego::math::FlocksMatrix_FUN_0047a010(float *matrix,float theta)
{
	float10 fVar1;
	float10 fVar2;
	
	fVar1 = (float10)fcos((float10)theta);
	fVar2 = (float10)fsin((float10)theta);
	FlocksMatrix_IdentityUnk(matrix);
	matrix[6] = -(float)fVar2;
	matrix[5] = (float)fVar1;
	matrix[10] = (float)fVar1;
	matrix[9] = (float)fVar2;
	return;
}



void __cdecl lego::math::FlocksMatrix_FUN_0047a060(float *matrix,float theta)
{
	float10 fVar1;
	float10 fVar2;
	
	fVar1 = (float10)fcos((float10)theta);
	fVar2 = (float10)fsin((float10)theta);
	FlocksMatrix_IdentityUnk(matrix);
	matrix[8] = -(float)fVar2;
	*matrix = (float)fVar1;
	matrix[10] = (float)fVar1;
	matrix[2] = (float)fVar2;
	return;
}



void __cdecl lego::math::FlocksMatrix_FUN_0047a0b0(float *matrix,float theta)
{
	float10 fVar1;
	float10 fVar2;
	
	fVar1 = (float10)fcos((float10)theta);
	fVar2 = (float10)fsin((float10)theta);
	FlocksMatrix_IdentityUnk(matrix);
	matrix[1] = -(float)fVar2;
	*matrix = (float)fVar1;
	matrix[5] = (float)fVar1;
	matrix[4] = (float)fVar2;
	return;
}



void __cdecl lego::math::FlocksMatrix_FUN_0047a100(float *matrix,Vector3F *vector)
{
	FlocksMatrix_IdentityUnk(matrix);
	matrix[0xc] = vector->x;
	matrix[0xd] = vector->y;
	matrix[0xe] = vector->z;
	return;
}



void __cdecl lego::math::FlocksMatrix_IdentityUnk(float *matrix)
{
	float fVar1;
	int iVar2;
	int iVar3;
	
	iVar3 = 0;
	do {
		iVar2 = 0;
		do {
			if (iVar3 == iVar2) {
				fVar1 = 1.0;
			}
			else {
				fVar1 = 0.0;
			}
			*matrix = fVar1;
			iVar2 += 1;
			matrix = matrix + 1;
		} while (iVar2 < 4);
		iVar3 += 1;
	} while (iVar3 < 4);
	return;
}



void __cdecl lego::math::FlocksMatrix_Clear(float *matrix)
{
	int iVar1;
	
	for (iVar1 = 0x10; iVar1 != 0; iVar1 += -1) {
		*matrix = 0.0;
		matrix = matrix + 1;
	}
	return;
}



void __cdecl lego::math::FlocksMatrix_FUN_0047a170(float *matrix_a,float *matrix_b)
{
	float *pfVar1;
	int iVar2;
	int iVar3;
	
	iVar3 = 4;
	pfVar1 = matrix_a;
	do {
		iVar2 = 4;
		do {
			*pfVar1 = *(float *)((int)((int)matrix_b - (int)matrix_a) + (int)pfVar1);
			pfVar1 = pfVar1 + 1;
			iVar2 += -1;
		} while (iVar2 != 0);
		iVar3 += -1;
	} while (iVar3 != 0);
	return;
}



ImageFont * __cdecl lego::draw::Image_LoadFont(char *filename)
{
	uint uVar1;
	uint uVar2;
	ImageBMP *bitmap;
	ImageFont *font;
	void *pvVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	float *pfVar7;
	float *pfVar8;
	float10 fVar9;
	float10 fVar10;
	float10 extraout_ST0;
	float10 extraout_ST1;
	longlong lVar11;
	longlong lVar12;
	int local_58;
	uint local_50;
	int local_48;
	uint local_38;
	uint local_34;
	uint local_30;
	uint local_2c;
	uint local_28;
	float *local_24;
	undefined4 uStack32;
	ImageBMP *local_1c;
	uint local_18;
	undefined4 uStack20;
	char *local_10;
	undefined4 uStack12;
	uint local_8;
	undefined4 uStack4;
	
	bitmap = image::Image_LoadBMP(filename,0,0);
	if (bitmap != NULL) {
		local_1c = bitmap;
		font = pool::ReservedPool_ImageFont___Next(bitmap);
		if (font != NULL) {
			image::Image_SetFirstColorAsKey(bitmap);
			uVar5 = bitmap->width / 10;
			uVar2 = bitmap->height / 0x13;
			local_28 = uVar5;
			local_2c = image::Image_GetLastColor24(bitmap);
			local_30 = image::Image_GetUpperBitMask(bitmap);
			pvVar3 = image::Image_Lock(bitmap,&local_34,&local_38);
			if (pvVar3 != NULL) {
				fVar9 = (float10)(ulonglong)uVar5;
				uStack32 = 0;
				uVar1 = uVar5 - 1;
				pfVar7 = (float *)&font->field_0xc;
				local_50 = 0;
				local_48 = 0x13;
				local_24 = pfVar7;
				do {
					uStack20 = 0;
					fVar10 = (float10)(ulonglong)local_50;
					filename = NULL;
					local_58 = 10;
					pfVar8 = pfVar7;
					local_18 = local_50;
					do {
						uStack12 = 0;
						local_10 = filename;
						pfVar8[-2] = (float)ZEXT48(filename);
						pfVar8[-1] = (float)fVar10;
						*pfVar8 = (float)fVar9;
						pfVar8[1] = (float)(ulonglong)uVar2;
						if (uVar1 != 0) {
							lVar11 = __ftol(fVar10);
							uVar6 = uVar1;
							do {
								uStack4 = 0;
								local_8 = uVar6;
								lVar12 = __ftol((float10)(ulonglong)uVar6 + (float10)ZEXT48(filename));
								iVar4 = (int)lVar12 * (local_38 >> 3) + local_34 * (int)lVar11;
								uVar5 = local_28;
								fVar10 = extraout_ST0;
								fVar9 = extraout_ST1;
								if ((CONCAT31(CONCAT21(CONCAT11(*(undefined *)(iVar4 + (int)pvVar3),
																								*(undefined *)(iVar4 + 1 + (int)pvVar3)),
																			 *(undefined *)(iVar4 + 2 + (int)pvVar3)),
															*(undefined *)(iVar4 + 3 + (int)pvVar3)) & local_30) != local_2c)
								break;
								uVar6 -= 1;
								*pfVar8 = *pfVar8 - 1.0;
							} while (uVar6 != 0);
						}
						pfVar8 = pfVar8 + 0x4c;
						filename = filename + uVar5;
						local_58 += -1;
					} while (local_58 != 0);
					local_50 += uVar2;
					pfVar7 = pfVar7 + 4;
					local_48 += -1;
					if (local_48 == 0) {
						lVar11 = __ftol((float10)*(float *)&font->field_0x10);
						font->field_be4 = (int)lVar11;
						lVar11 = __ftol((float10)*local_24);
						*(int *)&font->field_0xbe8 = (int)lVar11 << 3;
						image::Image_Unlock(local_1c);
						return font;
					}
				} while( true );
			}
			pool::ReservedPool_ImageFont___Release(font);
		}
		pool::ReservedPool_ImageBMP___Release(bitmap);
	}
	return NULL;
}



void __cdecl
FUN_0047a410(ImageFont *font,uint *param_2,int *param_3,byte *param_4,undefined4 *param_5)
{
	uint uVar1;
	
	uVar1 = FUN_0047a4a0(font,0,0,0,param_3,param_4,param_5);
	if (param_2 != NULL) {
		*param_2 = uVar1;
	}
	return;
}



void __cdecl FUN_0047a440(ImageFont *font,int param_2,int param_3,char *format,...)
{
	FUN_0047a4a0(font,param_2,param_3,1,NULL,(byte *)format,(undefined4 *)&stack0x00000014);
	return;
}



void __cdecl
FUN_0047a470(undefined4 *param_1,int param_2,int param_3,byte *param_4,undefined4 *param_5)
{
	FUN_0047a4a0((ImageFont *)param_1,param_2,param_3,1,NULL,param_4,param_5);
	return;
}



uint __cdecl
FUN_0047a4a0(ImageFont *font,int param_2,int param_3,int param_4,int *param_5,byte *param_6,
						undefined4 *param_7)
{
	byte *pbVar1;
	char *pcVar2;
	char c;
	byte *pbVar3;
	uint uVar4;
	uint uVar5;
	int iVar6;
	ImageBMP *bitmap;
	byte bVar7;
	uint uVar8;
	uint local_828;
	uint local_824;
	uint local_820;
	uint local_81c;
	int local_818;
	float local_808;
	float local_804;
	char local_800 [12];
	char acStack2036 [1012];
	byte local_400 [1024];
	
	bVar7 = *param_6;
	local_824 = font->field_be4;
	local_818 = 1;
	local_828 = 0;
	local_81c = 0;
	pbVar3 = local_400;
	while (bVar7 != 0) {
		if ((*param_6 == 0x25) && (param_6[1] == 0x62)) {
			*pbVar3 = 0x40;
			pbVar3[1] = 0x5b;
			pbVar3[2] = 0x30;
			pbVar3[3] = 0x78;
			pbVar3[4] = 0x25;
			pbVar3[5] = 0x30;
			pbVar3[6] = 0x2e;
			pbVar3[7] = 0x38;
			pbVar3[8] = 0x78;
			pbVar3 = pbVar3 + 9;
			param_6 = param_6 + 1;
			*pbVar3 = 0x5d;
		}
		else {
			*pbVar3 = *param_6;
		}
		pbVar1 = param_6 + 1;
		param_6 = param_6 + 1;
		pbVar3 = pbVar3 + 1;
		bVar7 = *pbVar1;
	}
	*pbVar3 = 0;
	uVar4 = std::vsprintf(local_800,(char *)local_400,param_7);
	local_820 = 0;
	uVar8 = 0;
	if (uVar4 != 0) {
		do {
			c = local_800[local_820];
			if (c == '\n') {
				if (local_81c < local_828) {
					local_81c = local_828;
				}
				param_3 += local_824;
				local_824 = font->field_be4;
				local_828 = 0;
				local_818 += 1;
			}
			else {
				if (c == '\t') {
					iVar6 = *(uint *)&font->field_0xbe8 - local_828 % *(uint *)&font->field_0xbe8;
				}
				else {
					if ((((local_820 < uVar4 - 0xc) && (c == '@')) && (local_800[local_820 + 1] == '[')) &&
						 (((local_800[local_820 + 2] == '0' && (local_800[local_820 + 3] == 'x')) &&
							(acStack2036[local_820] == ']')))) {
						bitmap = NULL;
						uVar8 = 0;
						pcVar2 = local_800 + local_820 + 4;
						bVar7 = 0x1c;
						do {
							if (std::globals::g_CharWidth_1__004b0f74 < 2) {
								uVar5 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ +
																 (uint)(byte)pcVar2[uVar8] * 2) & 4;
							}
							else {
								uVar5 = std::_unk_FUN_0048f490((uint)(byte)pcVar2[uVar8],4);
							}
							bitmap = (ImageBMP *)
											 ((uint)bitmap |
											 (uint)(byte)pcVar2[uVar8] - ((-(uint)(uVar5 != 0) & 0xffffffd9) + 0x57) <<
											 (bVar7 & 0x1f));
							uVar8 += 1;
							bVar7 = bVar7 - 4;
						} while (uVar8 < 8);
						if (bitmap != NULL) {
							local_808 = (float)(ulonglong)(local_828 + param_2);
							local_804 = (float)param_3;
							local_828 += bitmap->width;
							if (local_824 < (uint)bitmap->height) {
								local_824 = bitmap->height;
							}
							lego::image::Image_Blt__0047df70(bitmap,NULL,&local_808,NULL);
						}
						local_820 += 0xc;
						goto LAB_0047a6f3;
					}
					iVar6 = lego::draw::Font_MeasureCharWidthEx(font,local_828 + param_2,param_3,c,param_4);
				}
				local_828 += iVar6;
			}
LAB_0047a6f3:
			local_820 += 1;
			uVar8 = local_828;
		} while (local_820 < uVar4);
	}
	if (param_5 != NULL) {
		*param_5 = local_818;
	}
	if (local_81c < uVar8) {
		local_81c = uVar8;
	}
	return local_81c;
}



int __cdecl
lego::draw::Font_MeasureCharWidthEx(ImageFont *font,int param_2,int param_3,char c,BOOL param_5)
{
	uint uVar1;
	uint uVar2;
	longlong lVar3;
	float local_8;
	float local_4;
	
	local_8 = (float)param_2;
	local_4 = (float)param_3;
	uVar1 = (byte)(c - 0x20) / 10;
	uVar2 = (uint)(byte)(c - 0x20) % 10;
	if (uVar1 < 0x13) {
		if (param_5 != 0) {
			image::Image_Blt__0047df70
								(font->bitmap,(float *)(&font->field_0x4 + (uVar1 + uVar2 * 0x13) * 0x10),&local_8,
								 NULL);
		}
		lVar3 = __ftol((float10)*(float *)(&font->field_0xc + (uVar1 + uVar2 * 0x13) * 0x10));
		return (int)lVar3;
	}
	return 0;
}



int __cdecl lego::draw::Font_MeasureCharWidth(ImageFont *font,char c)
{
	int iVar1;
	
	iVar1 = Font_MeasureCharWidthEx(font,0,0,c,0);
	return iVar1;
}



undefined4 __cdecl lego::draw::Font_GetField_be4(ImageFont *font)
{
	return font->field_be4;
}



void __cdecl lego::pool::ReservedPool_ImageFont___Release(ImageFont *font)
{
	ReservedPool_ImageBMP___Release(font->bitmap);
	font->pool_m_next = globals::ReservedPool_ImageFont___g_NEXT;
	globals::ReservedPool_ImageFont___g_NEXT = font;
	return;
}



ImageFont * __cdecl lego::pool::ReservedPool_ImageFont___Next(ImageBMP *bitmap)
{
	int iVar1;
	ImageFont *pIVar2;
	ImageFont *pIVar3;
	
	pIVar2 = globals::ReservedPool_ImageFont___g_NEXT;
	if (globals::ReservedPool_ImageFont___g_NEXT == NULL) {
		ReservedPool_ImageFont___Alloc();
		pIVar2 = globals::ReservedPool_ImageFont___g_NEXT;
	}
	globals::ReservedPool_ImageFont___g_NEXT = pIVar2->pool_m_next;
	pIVar3 = pIVar2;
	for (iVar1 = 0x2fd; iVar1 != 0; iVar1 += -1) {
		pIVar3->bitmap = NULL;
		pIVar3 = (ImageFont *)&pIVar3->field_0x4;
	}
	pIVar2->pool_m_next = pIVar2;
	pIVar2->bitmap = bitmap;
	return pIVar2;
}



void __cdecl lego::pool::ReservedPool_ImageFont___Alloc(void)
{
	ImageFont *pIVar1;
	ImageFont *pIVar2;
	int iVar3;
	uint uVar4;
	
	uVar4 = 1 << ((byte)globals::ReservedPool_ImageFont___g_COUNT & 0x1f);
	pIVar2 = (ImageFont *)std::malloc(uVar4 * 0xbf4);
	globals::ReservedPool_ImageFont___g_TABLE[globals::ReservedPool_ImageFont___g_COUNT] = pIVar2;
	pIVar2 = globals::ReservedPool_ImageFont___g_TABLE[globals::ReservedPool_ImageFont___g_COUNT];
	if (pIVar2 != NULL) {
		globals::ReservedPool_ImageFont___g_COUNT += 1;
		if (1 < uVar4) {
			iVar3 = uVar4 - 1;
			pIVar1 = pIVar2;
			do {
				pIVar1->pool_m_next = pIVar1 + 1;
				iVar3 += -1;
				pIVar1 = pIVar1 + 1;
			} while (iVar3 != 0);
		}
		pIVar2[uVar4 - 1].pool_m_next = globals::ReservedPool_ImageFont___g_NEXT;
		globals::ReservedPool_ImageFont___g_NEXT = pIVar2;
	}
	return;
}



BOOL __cdecl lego::snd::InitDirectSound(HWND hWnd)
{
	HRESULT HVar1;
	int iVar2;
	undefined4 local_20;
	undefined4 local_1c;
	int local_18;
	int local_14;
	int local_10;
	
	globals::g_DirectSoundEnabled = 0;
	globals::g_Listener3D_RootFrame = NULL;
	do {
		HVar1 = DirectSoundCreate(NULL,&globals::g_IDirectSound,NULL);
		if (HVar1 == 0) {
			iVar2 = (*(code *)globals::g_IDirectSound->lpVtbl->SetCooperativeLevel)();
			if (iVar2 == 0) {
				local_20 = 0x14;
				local_1c = 0x91;
				local_18 = iVar2;
				local_14 = iVar2;
				local_10 = iVar2;
				iVar2 = (*(code *)globals::g_IDirectSound->lpVtbl->CreateSoundBuffer)
													(globals::g_IDirectSound,&local_20,&globals::g_IDirectSoundBuffer,0);
				if (iVar2 == 0) {
					(*(code *)globals::g_IDirectSoundBuffer->lpVtbl->SetFormat)
										(globals::g_IDirectSoundBuffer,&stack0xffffffbc);
					HVar1 = (*globals::g_IDirectSoundBuffer->lpVtbl->QueryInterface)
														((IUnknown *)globals::g_IDirectSoundBuffer,
														 (IID *)&idl::IID_IDirectSound3DListener,
														 &globals::g_IDirectSound3DListener);
					if (HVar1 == 0) {
						(*(code *)globals::g_IDirectSound3DListener->lpVtbl->SetDopplerFactor)
											(globals::g_IDirectSound3DListener,&DAT_42c80000,0);
						goto LAB_0047aa15;
					}
					(*globals::g_IDirectSoundBuffer->lpVtbl->Release)
										((IUnknown *)globals::g_IDirectSoundBuffer);
					goto LAB_0047aa04;
				}
				(*globals::g_IDirectSound->lpVtbl->Release)((IUnknown *)globals::g_IDirectSound);
			}
			else {
LAB_0047aa04:
				(*globals::g_IDirectSound->lpVtbl->Release)((IUnknown *)globals::g_IDirectSound);
			}
			globals::g_IDirectSound = NULL;
		}
LAB_0047aa15:
		if (globals::g_IDirectSound == NULL) {
			iVar2 = 5;
		}
		else {
			iVar2 = 1;
			globals::g_DirectSoundEnabled = 1;
		}
		if (iVar2 != 4) {
			if (globals::g_DirectSoundEnabled != 0) {
				(*(code *)globals::g_IDirectSoundBuffer->lpVtbl->Play)(globals::g_IDirectSoundBuffer);
				(*(code *)globals::g_IDirectSound3DListener->lpVtbl->SetRolloffFactor)
									(globals::g_IDirectSound3DListener,1065353216,1);
				(*(code *)globals::g_IDirectSound3DListener->lpVtbl->SetDopplerFactor)
									(globals::g_IDirectSound3DListener,0,1);
				(*(code *)globals::g_IDirectSound3DListener->lpVtbl->CommitDeferredSettings)
									(globals::g_IDirectSound3DListener);
				globals::g_MinDistFor3DSoundsOnTopView = 1.0;
				FLOAT_00507690 = 800.0;
				(*(code *)globals::g_IDirectSoundBuffer->lpVtbl->GetVolume)
									(globals::g_IDirectSoundBuffer,&globals::g_SoundBufferVolume);
				Audio_InitSoundBufferVolume();
			}
			return 1;
		}
	} while( true );
}



void __cdecl lego::main::Main_DirectSoundCleanup(void)
{
	if (globals::g_DirectSoundEnabled != 0) {
		snd::Audio_SetSoundVolumeModifier(globals::g_SoundBufferVolume);
		(*(code *)globals::g_IDirectSoundBuffer->lpVtbl->Stop)(globals::g_IDirectSoundBuffer);
		(*globals::g_IDirectSoundBuffer->lpVtbl->Release)((IUnknown *)globals::g_IDirectSoundBuffer);
		(*globals::g_IDirectSound->lpVtbl->Release)((IUnknown *)globals::g_IDirectSound);
		globals::g_IDirectSound = NULL;
		globals::g_DirectSoundEnabled = 0;
	}
	return;
}



BOOL __cdecl lego::snd::SFX_IsValidVolumeModifier(int volume)
{
										// is volume in range [-10000 to 0], inclusive
	if ((volume < 1) && (-10001 < volume)) {
		return 1;
	}
	return 0;
}



int __cdecl
lego::snd::Sample_Load(char *in_filename,BOOL isStreamed,BOOL isMultiple,int volumeAdjust)
{
	char cVar1;
	int iVar2;
	BOOL BVar3;
	char *pcVar4;
	FILE *pFVar5;
	uint uVar6;
	uint uVar7;
	LPCSTR finalFilename;
	SampleFlags SVar8;
	undefined4 *puVar9;
	char *pcVar10;
	SampleData *pSVar11;
	int sfxIndex;
	char wavFilename [260];
	char cdromFilename [260];
	bool success;
	
	success = false;
	if ((globals::g_DirectSoundEnabled != 0) && (BVar3 = Sample__Next(&sfxIndex), BVar3 != 0)) {
		globals::g_SampleDatas_TABLE[sfxIndex].flags = SAMPLE_NONE;
		std::sprintf(wavFilename,"%s.wav",in_filename);
		if (isStreamed == 0) {
			BVar3 = Sample_OpenInMemory(globals::g_SampleDatas_TABLE + sfxIndex,wavFilename,isMultiple);
			if (BVar3 != 0) {
				SVar8 = globals::g_SampleDatas_TABLE[sfxIndex].flags & ~SAMPLE_STREAMED;
				globals::g_SampleDatas_TABLE[sfxIndex].flags = SVar8;
				if (isMultiple != 0) {
					globals::g_SampleDatas_TABLE[sfxIndex].flags = SVar8 | SAMPLE_MULTIPLE;
				}
				success = true;
			}
		}
		else {
			pcVar4 = lego::file::Path_JoinDataDir(wavFilename);
			finalFilename = NULL;
			pFVar5 = std::fopen(pcVar4,"r");
			if (pFVar5 == NULL) {
				BVar3 = lego::file::Path_GetCDROMDataPath(cdromFilename,wavFilename);
				if (BVar3 != 0) {
					finalFilename = cdromFilename;
				}
			}
			else {
				std::fclose(pFVar5);
				finalFilename = pcVar4;
			}
			if ((finalFilename != NULL) && (pFVar5 = std::fopen(finalFilename,"r"), pFVar5 != NULL)) {
				std::fseek(pFVar5,0,2);
				uVar6 = std::ftell(pFVar5);
				iVar2 = sfxIndex;
				globals::g_SampleDatas_TABLE[sfxIndex].length = uVar6;
				uVar6 = RIFF_OpenStreamed(finalFilename);
				globals::g_SampleDatas_TABLE[iVar2].avgBytesPerSec = uVar6;
				globals::g_SampleDatas_TABLE[iVar2].flags =
						 globals::g_SampleDatas_TABLE[iVar2].flags | SAMPLE_STREAMED;
				std::fclose(pFVar5);
				success = true;
			}
		}
		if (success) {
			uVar6 = 0xffffffff;
			pcVar4 = wavFilename;
			do {
				pcVar10 = pcVar4;
				if (uVar6 == 0) break;
				uVar6 -= 1;
				pcVar10 = pcVar4 + 1;
				cVar1 = *pcVar4;
				pcVar4 = pcVar10;
			} while (cVar1 != '\0');
			uVar6 = ~uVar6;
			puVar9 = (undefined4 *)(pcVar10 + -uVar6);
			pSVar11 = globals::g_SampleDatas_TABLE + sfxIndex;
			for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
				*(undefined4 *)pSVar11->filename = *puVar9;
				puVar9 = puVar9 + 1;
				pSVar11 = (SampleData *)(pSVar11->filename + 4);
			}
			for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
				pSVar11->filename[0] = *(char *)puVar9;
				puVar9 = (undefined4 *)((int)puVar9 + 1);
				pSVar11 = (SampleData *)(pSVar11->filename + 1);
			}
			BVar3 = SFX_IsValidVolumeModifier(volumeAdjust);
			if (BVar3 == 0) {
				globals::g_SampleDatas_TABLE[sfxIndex].volume = 0;
				globals::g_SampleDatas_TABLE[sfxIndex].flags =
						 globals::g_SampleDatas_TABLE[sfxIndex].flags | (SAMPLE_ISUSED|SAMPLE_VOLUME);
				return sfxIndex;
			}
			globals::g_SampleDatas_TABLE[sfxIndex].volume = volumeAdjust;
			globals::g_SampleDatas_TABLE[sfxIndex].flags =
					 globals::g_SampleDatas_TABLE[sfxIndex].flags | (SAMPLE_ISUSED|SAMPLE_VOLUME);
			return sfxIndex;
		}
	}
	return -1;
}



BOOL __cdecl lego::snd::Sample__Next(int *out_sfxIndex)
{
	SampleFlags *pSVar1;
	int iVar2;
	
	iVar2 = 0;
	pSVar1 = &globals::g_SampleDatas_TABLE[0].flags;
	do {
		if ((*(byte *)pSVar1 & 1) == 0) {
			*out_sfxIndex = iVar2;
			return 1;
		}
		pSVar1 = pSVar1 + 0x4d;
		iVar2 += 1;
	} while (pSVar1 < globals::g_FILEPATH_DATADIR_STRIP + 8);
	return 0;
}



BOOL __cdecl lego::snd::Sample_CloseStreamed(int sfxIndex)
{
	HGLOBAL hMem;
	IDirectSoundBuffer *This;
	IDirectSoundBuffer **ppIVar1;
	int iVar2;
	
	if ((globals::g_DirectSoundEnabled != 0) && (sfxIndex != -1)) {
		hMem = globals::g_SampleDatas_TABLE[sfxIndex].hGlobal_11c;
		globals::g_SampleDatas_TABLE[sfxIndex].flags =
				 globals::g_SampleDatas_TABLE[sfxIndex].flags & ~SAMPLE_ISUSED;
		if (hMem != NULL) {
			GlobalFree(hMem);
			globals::g_SampleDatas_TABLE[sfxIndex].hGlobal_11c = NULL;
		}
		ppIVar1 = &globals::g_SampleDatas_TABLE[sfxIndex].dSoundBuffer1;
		iVar2 = 3;
		do {
			This = *ppIVar1;
			if (This != NULL) {
				(*This->lpVtbl->Release)((IUnknown *)This);
				*ppIVar1 = NULL;
			}
			ppIVar1 = ppIVar1 + 1;
			iVar2 += -1;
		} while (iVar2 != 0);
		return 1;
	}
	return 0;
}



void __cdecl lego::snd::Snd_SetListener3DRootFrame(IDirect3DRMFrame3 *rmFrame3)
{
	if (globals::g_DirectSoundEnabled != 0) {
		globals::g_Listener3D_RootFrame = rmFrame3;
	}
	return;
}



void __cdecl lego::snd::Snd_UpdateListener3D(void)
{
	if ((globals::g_DirectSoundEnabled != 0) && (globals::g_Listener3D_RootFrame != NULL)) {
		Snd_UpdateListener3D_internal(globals::g_Listener3D_RootFrame);
	}
	return;
}



void __cdecl lego::snd::Snd_UpdateListener3D_internal(IDirect3DRMFrame3 *rmFrame3)
{
	IDirect3DRMFrame3 *pIVar1;
	BOOL BVar2;
	int *unaff_EDI;
	bool bVar3;
	undefined *puVar4;
	undefined *puVar5;
	IDirect3DRMFrame3 *pIStack52;
	undefined auStack48 [4];
	Vector3F VStack44;
	Vector3F local_18;
	Vector3F local_c;
	
	pIVar1 = rmFrame3;
	VStack44.z = (float)&rmFrame3;
	VStack44.y = (float)rmFrame3;
	VStack44.x = 6.58295e-39;
	(*(code *)rmFrame3->lpVtbl->GetScene)();
	VStack44.x = (float)&stack0xffffffe0;
	auStack48 = local_c.z;
	pIStack52 = pIVar1;
	(*(code *)pIVar1->lpVtbl->GetPosition)();
	BVar2 = math::Vector3_Equals((Vector3F *)(auStack48 + 4),&globals::g_SoundListener_Position);
	bVar3 = BVar2 == 0;
	if (bVar3) {
										// IDirectSound3DListener->SetPosition(float x, float y, float z, DWORD dwApply)
		(*(code *)globals::g_IDirectSound3DListener->lpVtbl->SetPosition)
							(globals::g_IDirectSound3DListener,VStack44.x,VStack44.y);
		globals::g_SoundListener_Position.x = VStack44.x;
		globals::g_SoundListener_Position.y = VStack44.y;
		globals::g_SoundListener_Position.z = VStack44.z;
	}
	puVar5 = &stack0xffffffe0;
	puVar4 = auStack48 + 4;
	(*(code *)pIVar1->lpVtbl->GetOrientation)(pIVar1,local_18.z);
	BVar2 = math::Vector3_Equals
										((Vector3F *)&stack0xffffffc4,&globals::g_SoundListener_FrontOrientation);
	if (BVar2 != 0) {
		BVar2 = math::Vector3_Equals((Vector3F *)auStack48,&globals::g_SoundListener_BackOrientation);
		if (BVar2 != 0) goto LAB_0047afa5;
	}
	(*(code *)globals::g_IDirectSound3DListener->lpVtbl->SetOrientation)
						(globals::g_IDirectSound3DListener,puVar4,puVar5,pIStack52,auStack48,VStack44.x,
						 VStack44.y,1);
	globals::g_SoundListener_FrontOrientation.y = (float)puVar5;
	globals::g_SoundListener_FrontOrientation.x = (float)puVar4;
	globals::g_SoundListener_FrontOrientation.z = (float)pIStack52;
	globals::g_SoundListener_BackOrientation.x = auStack48;
	globals::g_SoundListener_BackOrientation.y = VStack44.x;
	globals::g_SoundListener_BackOrientation.z = VStack44.y;
	bVar3 = true;
LAB_0047afa5:
	if (bVar3) {
		(*(code *)globals::g_IDirectSound3DListener->lpVtbl->CommitDeferredSettings)
							(globals::g_IDirectSound3DListener);
	}
	(**(code **)(*unaff_EDI + 8))(unaff_EDI);
	return;
}



void __cdecl
lego::snd::Snd_SetBuffer3DPosition(IDirectSound3DBuffer *sound3dBuffer,Vector3F *position)
{
										// IDirectSound3DBuffer->SetPosition(float x, float y, float z, DWORD dwApply)
	(*(code *)sound3dBuffer->lpVtbl->SetPosition)(sound3dBuffer,position->x,position->y,position->z,0)
	;
	return;
}



undefined4 * __cdecl FUN_0047aff0(undefined4 param_1,int param_2)
{
	undefined4 *puVar1;
	
	puVar1 = (undefined4 *)PTR_00507684;
	if (PTR_00507684 == NULL) {
		return NULL;
	}
	do {
		if (param_2 == puVar1[2]) {
			FUN_0047b4e0(*puVar1,(int *)puVar1[2]);
			return (undefined4 *)0x1;
		}
		puVar1 = (undefined4 *)puVar1[3];
	} while (puVar1 != NULL);
	return puVar1;
}



int __cdecl
lego::snd::SFX_UnkAdjustVolumeOrPlay___0047b030
					(int unkMode,IDirect3DRMFrame3 *rmFrame3,int sampleIndex,BOOL modeChoice,
					Vector3F *opt_position)
{
	SampleFlags SVar1;
	char *filename;
	FILE *file;
	BOOL BVar2;
	int *piVar3;
	uint uVar4;
	int *unaff_EBP;
	char *filename_00;
	IDirectSoundBuffer *This;
	int *piVar5;
	IDirectSound3DBuffer *ds3dBuffer;
	IDirectSound3DBuffer *sound3dBuffer;
	IDirectSound3DBuffer *local_118;
	IDirect3DRMFrame3 *local_114;
	Vector3F local_110;
	char local_104 [224];
	IDirect3DRMFrame3 *pIStack36;
	int iStack28;
	Vector3F *pVStack12;
	
	filename_00 = NULL;
	if ((globals::g_DirectSoundEnabled != 0) && (sampleIndex != -1)) {
		SVar1 = globals::g_SampleDatas_TABLE[sampleIndex].flags;
		if ((SVar1 & SAMPLE_VOLUME) != SAMPLE_NONE) {
			if ((SVar1 & SAMPLE_STREAMED) == SAMPLE_NONE) {
				if ((SVar1 & SAMPLE_MULTIPLE) == SAMPLE_NONE) {
					This = globals::g_SampleDatas_TABLE[sampleIndex].dSoundBuffer1;
				}
				else {
					uVar4 = globals::g_SampleDatas_TABLE[sampleIndex].bufferIndex + 1;
					globals::g_SampleDatas_TABLE[sampleIndex].bufferIndex = uVar4;
					if (2 < uVar4) {
						globals::g_SampleDatas_TABLE[sampleIndex].bufferIndex = 0;
					}
					This = *(IDirectSoundBuffer **)
									(sampleIndex * 0x134 + 0x5077b8 +
									globals::g_SampleDatas_TABLE[sampleIndex].bufferIndex * 4);
				}
				(*This->lpVtbl->QueryInterface)
									((IUnknown *)This,(IID *)&idl::IID_IDirectSound3DBuffer,&local_118);
				piVar3 = (int *)globals::g_SampleDatas_TABLE[sampleIndex].volume;
				if (unkMode == 2) {
					piVar3 = piVar3 + -200;
				}
				(*(code *)This->lpVtbl->SetVolume)();
										// IDirectSound3DBuffer->SetMinDistance(float flMinDistance, DWORD dwApply)
				sound3dBuffer = (IDirectSound3DBuffer *)globals::g_MinDistFor3DSoundsOnTopView;
				(**(code **)(*unaff_EBP + 0x44))();
										// IDirectSound3DBuffer->SetMaxDistance(float flMaxDistance, DWORD dwApply)
				(**(code **)(*piVar3 + 0x40))(piVar3);
				if (unkMode == 0) {
					ds3dBuffer = (IDirectSound3DBuffer *)0x1;
										// IDirectSound3DBuffer->SetMode(DWORD dwMode, DWORD dwApply)
										//  (dwMode = DS3DMODE_NORMAL (0x0), dwApply = TRUE (0x1))
					(*(code *)sound3dBuffer->lpVtbl->SetMode)(sound3dBuffer,0);
					piVar5 = (int *)&stack0xfffffec0;
										// IDirect3DRMFrame3->GetScene(this, IDirect3DRMFrame3** lplpRoot)
										//  (this = param_2 (rmFrame3), lplpRoot => local_114)
					(*(code *)pIStack36->lpVtbl->GetScene)(pIStack36);
					FUN_0047aff0(pIStack36,(int)ds3dBuffer);
					res::Res_InitSoundBufferResource(pIStack36,ds3dBuffer);
					FUN_0047b2e0(pIStack36,This,ds3dBuffer);
										// IDirect3DRMFrame3->GetPosition(this, IDirect3DRMFrame3* lpRef, Vector3F*
										// lprvPos)
										//  (this = param_2 (rmFrame3), lpRef = GetScene)
					(*(code *)pIStack36->lpVtbl->GetPosition)(pIStack36,piVar3,&stack0xfffffebc);
										// IDirectSound3DBuffer->SetPosition(float x, float y, float z, DWORD dwApply)
					(**(code **)(*piVar5 + 0x4c))(piVar5,unkMode,ds3dBuffer,piVar3,1);
										// IDirect3DRMFrame3->Release(this)
										//  (this = GetScene)
					(*pIStack36->lpVtbl->Release)((IUnknown *)pIStack36);
				}
				else {
					if (unkMode == 1) {
										// IDirectSound3DBuffer->SetMode(DWORD dwMode, DWORD dwApply)
										//  (dwMode = DS3DMODE_NORMAL (0x0), dwApply = TRUE (0x1))
						(*(code *)sound3dBuffer->lpVtbl->SetMode)(sound3dBuffer,0,1);
						Snd_SetBuffer3DPosition(sound3dBuffer,pVStack12);
						FUN_0047aff0(0,(int)sound3dBuffer);
					}
					else {
						if (unkMode != 2) goto LAB_0047b26d;
										// IDirectSound3DBuffer->SetMode(DWORD dwMode, DWORD dwApply)
										//  (dwMode = DS3DMODE_DISABLE (0x2), dwApply = TRUE (0x1))
						(*(code *)sound3dBuffer->lpVtbl->SetMode)(sound3dBuffer,2,1);
						FUN_0047aff0(0,(int)sound3dBuffer);
					}
					FUN_0047b2e0(0,This,sound3dBuffer);
				}
LAB_0047b26d:
				(*(code *)globals::g_IDirectSound3DListener->lpVtbl->CommitDeferredSettings)
									(globals::g_IDirectSound3DListener);
				(*(code *)This->lpVtbl->SetCurrentPosition)(This,0);
				if (iStack28 != 0) {
					(*(code *)This->lpVtbl->Play)(This,0,0,1);
					return sampleIndex * 3 + globals::g_SampleDatas_TABLE[sampleIndex].bufferIndex;
				}
				(*(code *)This->lpVtbl->Play)(This,0,0,0);
				return sampleIndex * 3 + globals::g_SampleDatas_TABLE[sampleIndex].bufferIndex;
			}
			filename = lego::file::Path_JoinDataDir((char *)(globals::g_SampleDatas_TABLE + sampleIndex));
			file = std::fopen(filename,"r");
			if (file == NULL) {
				BVar2 = lego::file::Path_GetCDROMDataPath
													(local_104,(char *)(globals::g_SampleDatas_TABLE + sampleIndex));
				if (BVar2 != 0) {
					filename_00 = local_104;
				}
			}
			else {
				std::fclose(file);
				filename_00 = filename;
			}
			if (filename_00 != NULL) {
				AudioPlayback_DoLooping__0047bc30
									(filename_00,modeChoice,globals::g_SampleDatas_TABLE[sampleIndex].volume);
				return sampleIndex * 3;
			}
		}
	}
	return -1;
}



void __cdecl FUN_0047b2e0(undefined4 param_1,undefined4 param_2,undefined4 param_3)
{
	undefined4 *puVar1;
	
	puVar1 = (undefined4 *)std::malloc(0x10);
	puVar1[3] = PTR_00507684;
	*puVar1 = param_1;
	puVar1[2] = param_3;
	puVar1[1] = param_2;
	PTR_00507684 = puVar1;
	return;
}



void __cdecl lego::snd::Sample_PlayAtVolume(int sampleDataIndex,int volume)
{
	byte bVar1;
	IDirectSoundBuffer *pIVar2;
	BOOL BVar3;
	uint uVar4;
	int iVar5;
	IDirectSoundBuffer **ppIVar6;
	
	BVar3 = SFX_IsValidVolumeModifier(volume);
	bVar1 = *(byte *)&globals::g_SampleDatas_TABLE[sampleDataIndex].flags;
	uVar4 = -(uint)(BVar3 != 0) & volume;
	globals::g_SampleDatas_TABLE[sampleDataIndex].volume = uVar4;
	if ((bVar1 & 4) != 0) {
		ppIVar6 = &globals::g_SampleDatas_TABLE[sampleDataIndex].dSoundBuffer1;
		iVar5 = 3;
		do {
			pIVar2 = *ppIVar6;
			if (pIVar2 != NULL) {
				(*(code *)pIVar2->lpVtbl->SetVolume)
									(pIVar2,globals::g_SampleDatas_TABLE[sampleDataIndex].volume);
			}
			ppIVar6 = ppIVar6 + 1;
			iVar5 += -1;
		} while (iVar5 != 0);
		return;
	}
	pIVar2 = globals::g_SampleDatas_TABLE[sampleDataIndex].dSoundBuffer1;
	if (pIVar2 != NULL) {
		(*(code *)pIVar2->lpVtbl->SetVolume)(pIVar2,uVar4);
	}
	return;
}



int __cdecl lego::snd::Sample_GetVolume(int sampleDataIndex)
{
	return globals::g_SampleDatas_TABLE[sampleDataIndex].volume;
}



IDirectSoundBuffer * __cdecl lego::snd::Sample_GetSoundBufferInstance(int sampleBufferIndex)
{
	if (sampleBufferIndex == -1) {
		return NULL;
	}
	return *(IDirectSoundBuffer **)
					((sampleBufferIndex % 3) * 4 + 0x5077b8 +
					((uint)(sampleBufferIndex - sampleBufferIndex % 3) / 3) * 0x134);
}



void __cdecl lego::snd::Sample_StopSoundBufferInstance_internal(int sampleBufferIndex)
{
	IDirectSoundBuffer *pIVar1;
	
	pIVar1 = Sample_GetSoundBufferInstance(sampleBufferIndex);
	if (((globals::g_DirectSoundEnabled != 0) && (sampleBufferIndex != -1)) && (pIVar1 != NULL)) {
		(*(code *)pIVar1->lpVtbl->Stop)(pIVar1);
	}
	return;
}



void __cdecl FUN_0047b420(void)
{
	void *pvVar1;
	
	pvVar1 = PTR_00507684;
	if (PTR_00507684 != NULL) {
		do {
			(**(code **)(**(int **)((int)pvVar1 + 4) + 0x48))(*(int **)((int)pvVar1 + 4));
			pvVar1 = *(void **)((int)pvVar1 + 0xc);
		} while (pvVar1 != NULL);
	}
	lego::snd::AudioPlayback_Cleanup(0);
	lego::snd::AudioPlayback_Cleanup(1);
	return;
}



void __cdecl
lego::res::Res_InitSoundBufferResource(IDirect3DRMFrame3 *rmFrame3,IDirectSound3DBuffer *ds3dBuffer)
{
	ResourceAppData *appData;
	SoundResource *soundRes;
	IDirect3DRMFrame3 **ppIVar1;
	int iVar2;
	
	appData = (ResourceAppData *)(*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	soundRes = (SoundResource *)std::malloc(0x14);
	if (appData == NULL) {
		soundRes->previous = NULL;
	}
	else {
		soundRes->previous = appData->soundRes;
	}
	soundRes->sound3dBuffer = (IDirectSound3DBuffer *)rmFrame3;
	soundRes->field_4 = 0;
	soundRes->field_8 = 0;
	soundRes->field_c = 0;
	Res_InitResourceAppData(rmFrame3,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,soundRes,NULL);
	iVar2 = 0;
	ppIVar1 = globals::g_SoundBufferFrames_TABLE;
	do {
		if (*ppIVar1 == NULL) {
			globals::g_SoundBufferFrames_TABLE[iVar2] = rmFrame3;
			return;
		}
		ppIVar1 = ppIVar1 + 1;
		iVar2 += 1;
	} while (ppIVar1 < &DAT_005348d4);
	return;
}



void __cdecl FUN_0047b4e0(undefined4 param_1,int *param_2)
{
	void *buffer;
	DWORD DVar1;
	uint uVar2;
	IDirect3DRMFrame3 **ppIVar3;
	IDirect3DRMFrame3 *unaff_retaddr;
	
	(**(code **)(*param_2 + 8))(param_2);
	if (unaff_retaddr == NULL) {
		FUN_0047b560(0,(int)param_2);
		return;
	}
	DVar1 = (*unaff_retaddr->lpVtbl->GetAppData)((IUnknown *)unaff_retaddr);
	uVar2 = FUN_0047b5f0(unaff_retaddr,(int)param_2,*(int **)(DVar1 + 0x24));
	if (uVar2 != 0) {
		FUN_0047b560(unaff_retaddr,(int)param_2);
		buffer = *(void **)(DVar1 + 0x24);
		*(undefined4 *)(DVar1 + 0x24) = *(undefined4 *)((int)buffer + 0x10);
		std::free(buffer);
	}
	ppIVar3 = lego::globals::g_SoundBufferFrames_TABLE;
	do {
		if (unaff_retaddr == *ppIVar3) {
			*ppIVar3 = NULL;
		}
		ppIVar3 = ppIVar3 + 1;
	} while (ppIVar3 < &DAT_005348d4);
	return;
}



void __cdecl FUN_0047b560(undefined4 param_1,int param_2)
{
	void *buffer;
	uint uVar1;
	
	uVar1 = FUN_0047b5a0(param_1,param_2,(int)PTR_00507684);
	buffer = PTR_00507684;
	if (uVar1 != 0) {
		PTR_00507684 = *(void **)((int)PTR_00507684 + 0xc);
		std::free(buffer);
	}
	return;
}



uint __cdecl FUN_0047b5a0(undefined4 param_1,int param_2,int param_3)
{
	void *buffer;
	uint uVar1;
	
	if (param_3 == 0) {
		return 0;
	}
	uVar1 = FUN_0047b5a0(param_1,param_2,*(int *)(param_3 + 0xc));
	if (uVar1 != 0) {
		buffer = *(void **)(param_3 + 0xc);
		*(undefined4 *)(param_3 + 0xc) = *(undefined4 *)((int)buffer + 0xc);
		std::free(buffer);
	}
	return (uint)(param_2 == *(int *)(param_3 + 8));
}



uint __cdecl FUN_0047b5f0(undefined4 param_1,int param_2,int *param_3)
{
	void *buffer;
	uint uVar1;
	
	if (param_3 == NULL) {
		return 0;
	}
	uVar1 = FUN_0047b5f0(param_1,param_2,(int *)param_3[4]);
	if (uVar1 != 0) {
		FUN_0047b560(param_1,param_2);
		buffer = (void *)param_3[4];
		param_3[4] = *(int *)((int)buffer + 0x10);
		std::free(buffer);
	}
	return (uint)(param_2 == *param_3);
}



void __cdecl FUN_0047b650(void)
{
	undefined4 *puVar1;
	uint in_ECX;
	undefined4 *puVar2;
	IDirect3DRMFrame3 **ppIVar3;
	uint local_4;
	
	puVar2 = (undefined4 *)PTR_00507684;
	ppIVar3 = lego::globals::g_SoundBufferFrames_TABLE;
	local_4 = in_ECX;
	do {
		if (*ppIVar3 != NULL) {
			FUN_0047b6d0(*ppIVar3,0,0);
		}
		ppIVar3 = ppIVar3 + 1;
	} while (ppIVar3 < &DAT_005348d4);
	if (puVar2 != NULL) {
		do {
			puVar1 = (undefined4 *)puVar2[3];
			(**(code **)(*(int *)puVar2[1] + 0x24))((int *)puVar2[1],&local_4);
			if ((local_4 & 1) == 0) {
				FUN_0047b4e0(*puVar2,(int *)puVar2[2]);
			}
			puVar2 = puVar1;
		} while (puVar1 != NULL);
	}
	FUN_0047c070(0);
	FUN_0047c070(1);
	return;
}



void __cdecl FUN_0047b6d0(IDirect3DRMFrame3 *rmFrame3,undefined4 param_2,undefined4 param_3)
{
	int **ppiVar1;
	IDirect3DRMFrame3 *pIVar2;
	DWORD DVar3;
	BOOL BVar4;
	int *unaff_EBX;
	float unaff_EDI;
	int *local_c;
	int *local_4;
	
	pIVar2 = rmFrame3;
	DVar3 = (*rmFrame3->lpVtbl->GetAppData)((IUnknown *)rmFrame3);
	ppiVar1 = *(int ***)(DVar3 + 0x24);
	(*(code *)pIVar2->lpVtbl->GetScene)(pIVar2,&rmFrame3);
	for (; ppiVar1 != NULL; ppiVar1 = (int **)ppiVar1[4]) {
		(*(code *)pIVar2->lpVtbl->GetPosition)(pIVar2,local_4,&stack0xffffffec);
		BVar4 = lego::math::Vector3_Equals((Vector3F *)&stack0xffffffec,(Vector3F *)(ppiVar1 + 1));
		if (BVar4 == 0) {
			(**(code **)(**ppiVar1 + 0x4c))(*ppiVar1,unaff_EDI,unaff_EBX,local_c,0);
			((Vector3F *)(ppiVar1 + 1))->x = unaff_EDI;
			ppiVar1[2] = unaff_EBX;
			ppiVar1[3] = local_c;
		}
	}
	(**(code **)(*local_4 + 8))(local_4);
	return;
}



void __cdecl lego::snd::Audio_SetMinDistFor3DSoundsOnTopView(float minDist)
{
	void **ppvVar1;
	void *pvVar2;
	
	globals::g_MinDistFor3DSoundsOnTopView = minDist;
	pvVar2 = PTR_00507684;
	if (PTR_00507684 != NULL) {
		do {
			(**(code **)(**(int **)((int)pvVar2 + 8) + 0x44))(*(int **)((int)pvVar2 + 8),minDist,0);
			ppvVar1 = (void **)((int)pvVar2 + 0xc);
			pvVar2 = *ppvVar1;
		} while (*ppvVar1 != NULL);
	}
	return;
}



void __cdecl lego::main::Main_SetMaxDistFor3DSounds(float maxDist)
{
	void **ppvVar1;
	void *pvVar2;
	
	FLOAT_00507690 = maxDist;
	pvVar2 = PTR_00507684;
	if (PTR_00507684 != NULL) {
		do {
			(**(code **)(**(int **)((int)pvVar2 + 8) + 0x40))(*(int **)((int)pvVar2 + 8),maxDist,0);
			ppvVar1 = (void **)((int)pvVar2 + 0xc);
			pvVar2 = *ppvVar1;
		} while (*ppvVar1 != NULL);
	}
	return;
}



void __cdecl lego::snd::Audio_SetSoundVolumeModifier(int volume)
{
	BOOL BVar1;
	
	if (globals::g_DirectSoundEnabled != 0) {
		BVar1 = SFX_IsValidVolumeModifier(volume);
		if (BVar1 != 0) {
			globals::g_SoundVolumeModifier = volume;
			(*(code *)globals::g_IDirectSoundBuffer->lpVtbl->SetVolume)
								(globals::g_IDirectSoundBuffer,volume);
		}
	}
	return;
}



void __cdecl FUN_0047b7f0(int param_1)
{
	if ((-1 < param_1) && (param_1 < 0xb)) {
		lego::snd::Audio_SetSoundVolumeModifier(*(int *)(&DAT_004abe30 + param_1 * 4));
	}
	return;
}



void __cdecl lego::snd::Audio_InitSoundBufferVolume(void)
{
	if (globals::g_DirectSoundEnabled != 0) {
		globals::g_SoundVolumeModifier = -300;
		(*(code *)globals::g_IDirectSoundBuffer->lpVtbl->SetVolume)
							(globals::g_IDirectSoundBuffer,4294966996);
	}
	return;
}



BOOL __cdecl lego::snd::Sample_OpenInMemory(SampleData *sfxData,char *filename,BOOL flag_asterisk)
{
	SampleData *pSVar1;
	byte *fileData;
	MMRESULT MVar2;
	HGLOBAL pvVar3;
	uint uVar4;
	BOOL BVar5;
	int iVar6;
	SampleData *pSVar7;
	uint local_2c;
	_MMCKINFO local_28;
	_MMCKINFO local_14;
	
	pSVar1 = sfxData;
	pSVar7 = sfxData;
	for (iVar6 = 0x4d; iVar6 != 0; iVar6 += -1) {
		*(undefined4 *)pSVar7->filename = 0;
		pSVar7 = (SampleData *)(pSVar7->filename + 4);
	}
	fileData = lego::file::File_ReadAllBytes(filename,(uint *)&filename);
	if (fileData != NULL) {
		MVar2 = RIFF_OpenInMemory((HPSTR)fileData,(LONG)filename,(HMMIO *)&sfxData,&pSVar1->hGlobal_11c,
															(LPMMCKINFO)&local_14);
		if (MVar2 == 0) {
			iVar6 = RIFF_SeekData((HMMIO *)&sfxData,(LPMMCKINFO)&local_28,(MMCKINFO *)&local_14);
			if (iVar6 == 0) {
				pvVar3 = GlobalAlloc(0,local_28.cksize);
				pSVar1->hGlobal_118 = pvVar3;
				if (pvVar3 != NULL) {
					uVar4 = RIFF_GetSetInfo((HMMIO)sfxData,local_28.cksize,(int)pvVar3,(int)&local_28,
																	&local_2c);
					if (uVar4 == 0) {
						pSVar1->length = local_2c;
						if (sfxData != NULL) {
							mmioClose((HMMIO)sfxData,0);
							sfxData = NULL;
						}
						BVar5 = Sample_CreateSoundBuffers(pSVar1);
						if (BVar5 != 0) {
							BVar5 = Sample_CopyToSoundBuffer(pSVar1);
							if (BVar5 != 0) {
								if (pSVar1->hGlobal_118 != NULL) {
									GlobalFree(pSVar1->hGlobal_118);
									pSVar1->hGlobal_118 = NULL;
								}
								std::free(fileData);
								return 1;
							}
						}
					}
				}
			}
		}
	}
	if (pSVar1->hGlobal_118 != NULL) {
		GlobalFree(pSVar1->hGlobal_118);
		pSVar1->hGlobal_118 = NULL;
	}
	return 0;
}



BOOL __cdecl lego::snd::Sample_CreateSoundBuffers(SampleData *param_1)
{
	int iVar1;
	IDirectSoundBuffer **ppIVar2;
	uint uVar3;
	undefined4 local_14;
	undefined4 local_10;
	uint local_c;
	int local_8;
	HGLOBAL local_4;
	
	local_4 = param_1->hGlobal_11c;
	local_c = param_1->length;
	local_8 = 0;
	local_14 = 0x14;
	local_10 = 0x200f2;
	iVar1 = (*(code *)globals::g_IDirectSound->lpVtbl->CreateSoundBuffer)
										(globals::g_IDirectSound,&local_14,&param_1->dSoundBuffer1,0);
	if (iVar1 != 0) {
		return 0;
	}
	param_1->bufferIndex = 0;
	if (local_8 != 0) {
		uVar3 = 1;
		ppIVar2 = &param_1->dSoundBuffer2;
		do {
			iVar1 = (*(code *)globals::g_IDirectSound->lpVtbl->DuplicateSoundBuffer)
												(globals::g_IDirectSound,param_1->dSoundBuffer1,ppIVar2);
			if (iVar1 != 0) {
				return 0;
			}
			uVar3 += 1;
			ppIVar2 = ppIVar2 + 1;
		} while (uVar3 < 3);
		return 1;
	}
	return 1;
}



BOOL __cdecl lego::snd::Sample_CopyToSoundBuffer(SampleData *param_1)
{
	SampleData *pSVar1;
	int iVar2;
	uint uVar3;
	SampleData *pSVar4;
	undefined4 *puVar5;
	SampleData **ppSVar6;
	undefined4 *puVar7;
	uint uStack48;
	undefined *puStack44;
	undefined4 *puStack40;
	SampleData **ppSStack36;
	undefined4 *puStack32;
	undefined4 *puStack28;
	undefined4 local_c;
	undefined4 local_8;
	undefined local_4 [4];
	
	pSVar1 = param_1;
	puStack32 = &local_8;
	puStack28 = NULL;
	ppSStack36 = &param_1;
	puStack40 = &local_c;
	local_c = 0;
	puStack44 = local_4;
	uStack48 = param_1->length;
	local_8 = 0;
	iVar2 = (*(code *)param_1->dSoundBuffer1->lpVtbl->Lock)(param_1->dSoundBuffer1,param_1->offset);
	if (iVar2 == -0x7787ff6a) {
		(*(code *)pSVar1->dSoundBuffer1->lpVtbl->Restore)(pSVar1->dSoundBuffer1);
		(*(code *)pSVar1->dSoundBuffer1->lpVtbl->Lock)
							(pSVar1->dSoundBuffer1,pSVar1->offset,pSVar1->length,&puStack40,&uStack48,&puStack32,
							 &puStack44,0);
	}
	else {
		if (iVar2 != 0) {
			return 0;
		}
	}
	pSVar4 = (SampleData *)pSVar1->hGlobal_118;
	ppSVar6 = ppSStack36;
	for (uVar3 = (uint)puStack44 >> 2; uVar3 != 0; uVar3 -= 1) {
		*ppSVar6 = *(SampleData **)pSVar4;
		pSVar4 = (SampleData *)((int)pSVar4 + 4);
		ppSVar6 = ppSVar6 + 1;
	}
	for (uVar3 = (uint)puStack44 & 3; uVar3 != 0; uVar3 -= 1) {
		*(undefined *)ppSVar6 = *(undefined *)pSVar4;
		pSVar4 = (SampleData *)((int)pSVar4 + 1);
		ppSVar6 = (SampleData **)((int)ppSVar6 + 1);
	}
	if (puStack28 != NULL) {
		puVar5 = (undefined4 *)(puStack44 + (int)pSVar1->hGlobal_118);
		puVar7 = puStack28;
		for (uVar3 = (uint)puStack40 >> 2; uVar3 != 0; uVar3 -= 1) {
			*puVar7 = *puVar5;
			puVar5 = puVar5 + 1;
			puVar7 = puVar7 + 1;
		}
		for (uVar3 = (uint)puStack40 & 3; uVar3 != 0; uVar3 -= 1) {
			*(undefined *)puVar7 = *(undefined *)puVar5;
			puVar5 = (undefined4 *)((int)puVar5 + 1);
			puVar7 = (undefined4 *)((int)puVar7 + 1);
		}
	}
	iVar2 = (*(code *)pSVar1->dSoundBuffer1->lpVtbl->Unlock)
										(pSVar1->dSoundBuffer1,ppSStack36,puStack44,puStack28,puStack40);
	if (iVar2 == 0) {
		iVar2 = (*(code *)pSVar1->dSoundBuffer1->lpVtbl->GetFrequency)
											(pSVar1->dSoundBuffer1,&pSVar1->frequency);
		if (iVar2 == 0) {
			iVar2 = (*(code *)pSVar1->dSoundBuffer1->lpVtbl->GetVolume)
												(pSVar1->dSoundBuffer1,&pSVar1->volume);
			return (uint)(iVar2 == 0);
		}
		return 0;
	}
	return 0;
}



float10 __cdecl lego::snd::Sample_GetDuration(int sfxIndex)
{
	if (sfxIndex == -1) {
		return (float10)0.0;
	}
	if ((*(byte *)&globals::g_SampleDatas_TABLE[sfxIndex].flags & 8) != 0) {
		return (float10)(ulonglong)globals::g_SampleDatas_TABLE[sfxIndex].length /
					 (float10)globals::g_SampleDatas_TABLE[sfxIndex].avgBytesPerSec;
	}
	return (float10)(ulonglong)globals::g_SampleDatas_TABLE[sfxIndex].length /
				 (float10)*(int *)((int)globals::g_SampleDatas_TABLE[sfxIndex].hGlobal_11c + 8);
}



BOOL __cdecl lego::snd::AudioPlayback_DoLooping__0047bc30(LPSTR filename,BOOL modeChoice,int volume)
{
	BOOL BVar1;
	IDirectSoundBuffer *pIVar2;
	AudioPlaybackData *pAVar3;
	
	pAVar3 = &globals::g_AudioPlaybackData_Unk2;
	if (modeChoice == 0) {
		pAVar3 = &globals::g_AudioPlaybackData_Unk1;
	}
	if ((pAVar3->isUsed2 != 0) || (pAVar3->isUsed1 != 0)) {
		AudioPlayback_Cleanup(modeChoice);
	}
	BVar1 = Snd_FUN_0047bd60(filename,modeChoice,volume);
	if (BVar1 != 0) {
		pIVar2 = globals::g_IDirectSoundBuffer_Unk1;
		if (modeChoice != 0) {
			pIVar2 = globals::g_IDirectSoundBuffer_Unk2;
		}
		(*(code *)pIVar2->lpVtbl->SetCurrentPosition)(pIVar2,0);
		pIVar2 = globals::g_IDirectSoundBuffer_Unk1;
		if (modeChoice != 0) {
			pIVar2 = globals::g_IDirectSoundBuffer_Unk2;
		}
										// DSBPLAY_LOOPING (0x1)
		(*(code *)pIVar2->lpVtbl->Play)(pIVar2,0,0,1);
		pAVar3->isUsed2 = 1;
		return 1;
	}
	pAVar3->isUsed2 = 0;
	return 0;
}



BOOL __cdecl lego::snd::AudioPlayback_Cleanup(BOOL modeChoice)
{
	IDirectSoundBuffer *pIVar1;
	AudioPlaybackData *pAVar2;
	
	pAVar2 = &globals::g_AudioPlaybackData_Unk2;
	if (modeChoice == 0) {
		pAVar2 = &globals::g_AudioPlaybackData_Unk1;
	}
	pAVar2->isUsed2 = 0;
	if (pAVar2->isUsed1 != 0) {
		pIVar1 = globals::g_IDirectSoundBuffer_Unk1;
		if (modeChoice != 0) {
			pIVar1 = globals::g_IDirectSoundBuffer_Unk2;
		}
		(*(code *)pIVar1->lpVtbl->Stop)(pIVar1);
		AudioPlayback_FreeMem(&pAVar2->hMmio,&pAVar2->waveFormat);
		pIVar1 = globals::g_IDirectSoundBuffer_Unk1;
		if (modeChoice != 0) {
			pIVar1 = globals::g_IDirectSoundBuffer_Unk2;
		}
		(*pIVar1->lpVtbl->Release)((IUnknown *)pIVar1);
		pAVar2->isUsed1 = 0;
	}
	return 1;
}



BOOL __cdecl lego::snd::Snd_FUN_0047bd60(LPSTR filename,BOOL modeChoice,int volume)
{
	WAVEFORMATEX **out_hglobal;
	HMMIO *out_hmmio;
	WAVEFORMATEX *pWVar1;
	DWORD modeChoice_00;
	MMRESULT MVar2;
	int iVar3;
	uint uVar4;
	AudioPlaybackData *pAVar5;
	DSBUFFERDESC sndBuffer;
	
	pAVar5 = &globals::g_AudioPlaybackData_Unk2;
	if (modeChoice == 0) {
		pAVar5 = &globals::g_AudioPlaybackData_Unk1;
	}
	out_hglobal = &pAVar5->waveFormat;
	out_hmmio = &pAVar5->hMmio;
	MVar2 = AudioPlayback_OpenMem(filename,out_hmmio,out_hglobal,(LPMMCKINFO)&pAVar5->mmckInfoData);
	if (MVar2 != 0) {
		return 0;
	}
	if ((*out_hglobal)->wFormatTag != WAVE_FORMAT_PCM) {
		AudioPlayback_FreeMem(out_hmmio,out_hglobal);
		return 0;
	}
	iVar3 = RIFF_SeekData(out_hmmio,(LPMMCKINFO)&pAVar5->mmckInfo,&pAVar5->mmckInfoData);
	if (iVar3 == 0) {
		pWVar1 = *out_hglobal;
		uVar4 = pWVar1->nSamplesPerSec * (uint)pWVar1->nBlockAlign * 3 >> 2;
		pAVar5->totalFrames = uVar4;
		uVar4 %= (uint)pWVar1->nBlockAlign;
		if (uVar4 != 0) {
			pAVar5->totalFrames = pAVar5->totalFrames + (pWVar1->nBlockAlign - uVar4);
		}
		sndBuffer.dwSize = 0x14;
		sndBuffer.dwFlags = 0x100e0;
		sndBuffer.dwBufferBytes = pAVar5->totalFrames << 2;
		sndBuffer.dwReserved = 0;
		pAVar5->bufferBytesSize = sndBuffer.dwBufferBytes;
		sndBuffer.lpwfxFormat = *out_hglobal;
		iVar3 = (*(code *)globals::g_IDirectSound->lpVtbl->CreateSoundBuffer)
											(globals::g_IDirectSound,&sndBuffer,&filename,0);
		modeChoice_00 = sndBuffer.dwReserved;
		if (iVar3 == 0) {
			if (sndBuffer.dwReserved == 0) {
				globals::g_IDirectSoundBuffer_Unk1 = (IDirectSoundBuffer *)sndBuffer.dwBufferBytes;
			}
			else {
				globals::g_IDirectSoundBuffer_Unk2 = (IDirectSoundBuffer *)sndBuffer.dwBufferBytes;
			}
			(**(code **)(*(int *)sndBuffer.dwBufferBytes + 0x3c))
								(sndBuffer.dwBufferBytes,sndBuffer.lpwfxFormat);
			pAVar5->field_54 = 0;
			pAVar5->playback_3c = 0;
			pAVar5->playback_44 = pAVar5->totalFrames << 1;
			pAVar5->modeChoice = modeChoice_00;
			FUN_0047bef0(modeChoice_00);
			pAVar5->field_4c = 0;
			pAVar5->isUsed1 = 1;
			return 1;
		}
		return 0;
	}
	AudioPlayback_FreeMem(out_hmmio,out_hglobal);
	return 0;
}



uint __cdecl FUN_0047bef0(BOOL modeChoice)
{
	LPMMCKINFO p_Var1;
	HMMIO *ppHVar2;
	undefined2 uVar3;
	int iVar4;
	uint uVar5;
	IDirectSoundBuffer *pIVar6;
	undefined *puVar7;
	uint uVar8;
	char cVar9;
	int unaff_EBP;
	AudioPlaybackData *pAVar10;
	uint *puVar11;
	undefined *puStack44;
	undefined4 uStack40;
	undefined local_14 [4];
	undefined local_10 [8];
	undefined local_8 [4];
	uint local_4;
	
	pAVar10 = &lego::globals::g_AudioPlaybackData_Unk2;
	if (modeChoice == 0) {
		pAVar10 = &lego::globals::g_AudioPlaybackData_Unk1;
	}
	pIVar6 = lego::globals::g_IDirectSoundBuffer_Unk1;
	if (modeChoice != 0) {
		pIVar6 = lego::globals::g_IDirectSoundBuffer_Unk2;
	}
	puStack44 = local_8;
	uStack40 = 0;
	iVar4 = (*(code *)pIVar6->lpVtbl->Lock)(pIVar6,0,pAVar10->bufferBytesSize,local_10);
	if (iVar4 != 0) {
		return 0;
	}
	p_Var1 = (LPMMCKINFO)&pAVar10->mmckInfo;
	ppHVar2 = &pAVar10->hMmio;
	lego::snd::RIFF_GetSetInfo(*ppHVar2,(uint)local_14,(int)&local_4,(int)p_Var1,(uint *)&puStack44);
	if (puStack44 < local_14) {
		puVar7 = puStack44;
		iVar4 = unaff_EBP;
		if (pAVar10->modeChoice == 0) {
			if (puStack44 < (undefined *)pAVar10->totalFrames) {
				pAVar10->field_54 = 1;
			}
			puVar7 = local_14 + -(int)puStack44;
			cVar9 = (pAVar10->waveFormat->wBitsPerSample != 8) + -1;
			uVar3 = CONCAT11(cVar9,cVar9);
			uVar5 = CONCAT22(uVar3,uVar3) & 0x80808080;
			puVar11 = (uint *)((int)&local_4 + (int)puStack44);
			for (uVar8 = (uint)puVar7 >> 2; uVar8 != 0; uVar8 -= 1) {
				*puVar11 = uVar5;
				puVar11 = puVar11 + 1;
			}
			for (uVar8 = (uint)puVar7 & 3; uVar8 != 0; uVar8 -= 1) {
				*(char *)puVar11 = (char)uVar5;
				puVar11 = (uint *)((int)puVar11 + 1);
			}
		}
		else {
			do {
				modeChoice = iVar4;
				lego::snd::RIFF_SeekData(ppHVar2,p_Var1,&pAVar10->mmckInfoData);
				lego::snd::RIFF_GetSetInfo
									(*ppHVar2,(uint)(local_14 + -(int)puVar7),(int)(puVar7 + (int)&local_4),
									 (int)p_Var1,(uint *)&puStack44);
				puVar7 = puVar7 + (int)puStack44;
				iVar4 = modeChoice;
			} while (puVar7 < local_14);
		}
	}
	pIVar6 = lego::globals::g_IDirectSoundBuffer_Unk1;
	if (modeChoice != 0) {
		pIVar6 = lego::globals::g_IDirectSoundBuffer_Unk2;
	}
	iVar4 = 0;
	(*(code *)pIVar6->lpVtbl->Unlock)(pIVar6,&local_4,local_14,0);
	uVar5 = pAVar10->bufferBytesSize;
	uVar8 = pAVar10->playback_3c + iVar4;
	pAVar10->playback_3c = uVar8;
	if (uVar5 <= uVar8) {
		pAVar10->playback_3c = uVar8 - uVar5;
		uVar8 = uVar5;
	}
	pAVar10->playback_40 = 0;
	pAVar10->playback_48 = 0;
	return uVar8;
}



void __cdecl FUN_0047c070(int param_1)
{
	LPMMCKINFO p_Var1;
	HMMIO *ppHVar2;
	byte bVar3;
	int iVar4;
	IDirectSoundBuffer *pIVar5;
	undefined *puVar6;
	int unaff_ESI;
	AudioPlaybackData *pAVar7;
	int unaff_EDI;
	uint uVar8;
	uint *puVar9;
	int iVar10;
	uint *puVar11;
	undefined *puVar12;
	undefined *puVar13;
	IDirectSoundBuffer *pIStack52;
	undefined *puStack48;
	undefined *puStack44;
	uint uStack24;
	int iStack20;
	undefined local_c [4];
	int iStack8;
	undefined local_4 [4];
	
	pAVar7 = &lego::globals::g_AudioPlaybackData_Unk2;
	if (param_1 == 0) {
		pAVar7 = &lego::globals::g_AudioPlaybackData_Unk1;
	}
	if ((pAVar7->isUsed2 != 0) && (pAVar7->isUsed1 != 0)) {
		pIStack52 = lego::globals::g_IDirectSoundBuffer_Unk1;
		if (param_1 != 0) {
			pIStack52 = lego::globals::g_IDirectSoundBuffer_Unk2;
		}
		puStack44 = local_4;
		puStack48 = local_c;
		(*(code *)pIStack52->lpVtbl->GetCurrentPosition)();
		uVar8 = uStack24;
		if (uStack24 < pAVar7->playback_48) {
			uVar8 = uStack24 + pAVar7->bufferBytesSize;
		}
		uVar8 = pAVar7->playback_40 + (uVar8 - pAVar7->playback_48);
		pAVar7->playback_48 = uStack24;
		pAVar7->playback_40 = uVar8;
		iVar4 = 0;
		if (pAVar7->playback_44 < uVar8) {
			while ((pAVar7->field_4c == 0 || (iVar4 != 0))) {
				iStack20 = 1;
				if (pAVar7->field_54 == 0) {
					pIVar5 = lego::globals::g_IDirectSoundBuffer_Unk1;
					if (param_1 != 0) {
						pIVar5 = lego::globals::g_IDirectSoundBuffer_Unk2;
					}
					puVar12 = NULL;
					puVar6 = &stack0xffffffdc;
					iVar10 = 0;
					iVar4 = (*(code *)pIVar5->lpVtbl->Lock)
														(pIVar5,pAVar7->playback_3c,pAVar7->totalFrames,&stack0xffffffe0);
					if (iVar4 != 0) {
						return;
					}
					p_Var1 = (LPMMCKINFO)&pAVar7->mmckInfo;
					ppHVar2 = &pAVar7->hMmio;
					lego::snd::RIFF_GetSetInfo
										(*ppHVar2,(uint)puVar6,iVar10,(int)p_Var1,(uint *)&stack0xffffffc4);
					if (puVar12 < puVar6) {
						puVar13 = puVar12;
						if (pAVar7->modeChoice == 0) {
							pAVar7->field_54 = 1;
							bVar3 = (pAVar7->waveFormat->wBitsPerSample != 8) - 1;
							puVar9 = (uint *)(puVar12 + iVar10);
							for (uVar8 = (uint)(puVar6 + -(int)puVar12) >> 2; uVar8 != 0; uVar8 -= 1) {
								*puVar9 = CONCAT22(CONCAT11(bVar3,bVar3),CONCAT11(bVar3,bVar3)) & 0x80808080;
								puVar9 = puVar9 + 1;
							}
							for (uVar8 = (uint)(puVar6 + -(int)puVar12) & 3; uVar8 != 0; uVar8 -= 1) {
								*(byte *)puVar9 = bVar3 & 0x80;
								puVar9 = (uint *)((int)puVar9 + 1);
							}
						}
						else {
							do {
								lego::snd::RIFF_SeekData(ppHVar2,p_Var1,&pAVar7->mmckInfoData);
								lego::snd::RIFF_GetSetInfo
													(*ppHVar2,(uint)(puVar6 + -(int)puVar12),(int)(puVar12 + iVar10),
													 (int)p_Var1,(uint *)&stack0xffffffc4);
								puVar12 = puVar12 + (int)puVar13;
							} while (puVar12 < puVar6);
						}
					}
					pIVar5 = lego::globals::g_IDirectSoundBuffer_Unk1;
					if (unaff_EDI != 0) {
						pIVar5 = lego::globals::g_IDirectSoundBuffer_Unk2;
					}
					(*(code *)pIVar5->lpVtbl->Unlock)(pIVar5,iVar10,puVar6,0,0);
					uVar8 = pAVar7->playback_3c + unaff_ESI;
					pAVar7->playback_3c = uVar8;
					pAVar7->playback_44 = pAVar7->playback_44 + unaff_ESI;
					param_1 = iStack8;
					if (pAVar7->bufferBytesSize <= uVar8) {
						pAVar7->playback_3c = uVar8 - pAVar7->bufferBytesSize;
					}
				}
				else {
					pIVar5 = lego::globals::g_IDirectSoundBuffer_Unk1;
					if (param_1 != 0) {
						pIVar5 = lego::globals::g_IDirectSoundBuffer_Unk2;
					}
					puVar6 = &stack0xffffffdc;
					puVar11 = NULL;
					(*(code *)pIVar5->lpVtbl->Lock)
										(pIVar5,pAVar7->playback_3c,pAVar7->totalFrames,&stack0xffffffe0);
					bVar3 = (pAVar7->waveFormat->wBitsPerSample != 8) - 1;
					puVar9 = puVar11;
					for (uVar8 = (uint)puVar6 >> 2; uVar8 != 0; uVar8 -= 1) {
						*puVar9 = CONCAT22(CONCAT11(bVar3,bVar3),CONCAT11(bVar3,bVar3)) & 0x80808080;
						puVar9 = puVar9 + 1;
					}
					for (uVar8 = (uint)puVar6 & 3; uVar8 != 0; uVar8 -= 1) {
						*(byte *)puVar9 = bVar3 & 0x80;
						puVar9 = (uint *)((int)puVar9 + 1);
					}
					pIVar5 = lego::globals::g_IDirectSoundBuffer_Unk1;
					if (param_1 != 0) {
						pIVar5 = lego::globals::g_IDirectSoundBuffer_Unk2;
					}
					(*(code *)pIVar5->lpVtbl->Unlock)(pIVar5,puVar11,puVar6,0,0);
					uVar8 = (pAVar7->mmckInfoData).cksize;
					if (((pAVar7->totalFrames < uVar8) && (uVar8 - pAVar7->totalFrames <= pAVar7->playback_40)
							) || (uVar8 <= pAVar7->playback_40)) {
						pAVar7->field_4c = 1;
					}
					pAVar7->playback_44 = pAVar7->playback_44 + unaff_ESI;
				}
				iVar4 = iStack20;
				if (pAVar7->playback_40 <= pAVar7->playback_44) {
					return;
				}
			}
			lego::snd::AudioPlayback_Cleanup(param_1);
		}
	}
	return;
}



// return (a.x == b.x) && (a.y == b.y) && (a.z == b.z)

BOOL __cdecl lego::math::Vector3_Equals(Vector3F *a,Vector3F *b)
{
	if (((a->x == b->x) && (a->y == b->y)) && (a->z == b->z)) {
		return 1;
	}
	return 0;
}



float10 __cdecl lego::main::Main_SetRollOffFor3DSounds(float rollOff)
{
	if (globals::g_DirectSoundEnabled != 0) {
		if (rollOff < 0.0) {
			rollOff = 0.0;
		}
		if ((ushort)((ushort)(rollOff < 10.0) << 8 | (ushort)(rollOff == 10.0) << 0xe) == 0) {
			rollOff = 10.0;
		}
		(*(code *)globals::g_IDirectSound3DListener->lpVtbl->SetRolloffFactor)
							(globals::g_IDirectSound3DListener,rollOff,0);
	}
	return (float10)rollOff;
}



uint __cdecl lego::game::Game_GetUnkMask__0047c420(void)
{
	return 0xffffd8f0;
}



void __cdecl lego::main::Main_InitDirectXBase(HWND hWnd)
{
	globals::g_DirectDraw_hWnd = hWnd;
	globals::g_IDirectDraw4 = NULL;
	globals::g_IDirectDrawSurface4_RenderTarget = NULL;
	globals::g_IDirectDrawSurface4_DrawTarget = NULL;
	globals::unk::UNUSED_0076bc90 = 0;
	globals::g_IDirectDrawClipper_RenderTarget = NULL;
	wnd::setup::globals::g_DirectDrawDriverEnumerate_TABLE = NULL;
	wnd::setup::globals::g_DirectDrawDeviceEnumerate_TABLE = NULL;
	wnd::setup::globals::g_DirectDrawScreenEnumerate_TABLE = NULL;
	wnd::setup::globals::g_DirectDrawDriverEnumerate_COUNT = 0;
	wnd::setup::globals::g_DirectDrawDeviceEnumerate_COUNT = 0;
	wnd::setup::globals::g_DirectDrawScreenEnumerate_COUNT = 0;
	return;
}



BOOL __cdecl lego::wnd::setup::Dlg_PopulateDriverModes(DriverMode *ref_driverModes,uint *out_count)
{
	globals::g_DirectDrawDriverEnumerate_TABLE = ref_driverModes;
	DirectDrawEnumerateA(Dlg_DirectDrawDriverEnumerate_Callback,NULL);
	*out_count = globals::g_DirectDrawDriverEnumerate_COUNT;
	return 1;
}



BOOL lego::wnd::setup::Dlg_DirectDrawDriverEnumerate_Callback
							 (LPGUID lpGuid,LPSTR lpDriverName,LPSTR lpDriverDescription,LPVOID lpContext)
{
	DriverMode *pDVar1;
	
	globals::g_DirectDrawDriverEnumerate_TABLE[globals::g_DirectDrawDriverEnumerate_COUNT].flags =
			 DRIVERMODE_ISUSED;
	if (lpGuid == NULL) {
		globals::g_DirectDrawDriverEnumerate_TABLE[globals::g_DirectDrawDriverEnumerate_COUNT].flags =
				 globals::g_DirectDrawDriverEnumerate_TABLE[globals::g_DirectDrawDriverEnumerate_COUNT].
				 flags | DRIVERMODE_NOGUID_10;
		globals::g_DirectDrawDriverEnumerate_TABLE[globals::g_DirectDrawDriverEnumerate_COUNT].flags =
				 globals::g_DirectDrawDriverEnumerate_TABLE[globals::g_DirectDrawDriverEnumerate_COUNT].
				 flags | DRIVERMODE_NOGUID_20;
	}
	else {
		pDVar1 = globals::g_DirectDrawDriverEnumerate_TABLE + globals::g_DirectDrawDriverEnumerate_COUNT
		;
		(pDVar1->guid).Data1 = lpGuid->Data1;
		*(undefined4 *)&(pDVar1->guid).Data2 = *(undefined4 *)&lpGuid->Data2;
		*(undefined4 *)(pDVar1->guid).Data4 = *(undefined4 *)lpGuid->Data4;
		*(undefined4 *)((pDVar1->guid).Data4 + 4) = *(undefined4 *)(lpGuid->Data4 + 4);
	}
	std::sprintf(globals::g_DirectDrawDriverEnumerate_TABLE
							 [globals::g_DirectDrawDriverEnumerate_COUNT].displayName,"%s (%s)",lpDriverName,
							 lpDriverDescription);
	globals::g_DirectDrawDriverEnumerate_COUNT = globals::g_DirectDrawDriverEnumerate_COUNT + 1;
	return 1;
}



BOOL __cdecl
lego::wnd::setup::Dlg_PopulateDeviceModes
					(DriverMode *driverMode,DeviceMode *ref_deviceModes,uint *out_count)
{
	HRESULT HVar1;
	uint uVar2;
	GUID *pGVar3;
	IUnknown *local_8;
	DeviceMode *local_4;
	
	uVar2 = 0;
	globals::g_DirectDrawDeviceEnumerate_COUNT = 0;
	HVar1 = DirectDrawCreate((LPGUID)driverMode,(IUnknown **)&local_4,NULL);
	if (HVar1 == 0) {
		HVar1 = (**(code **)(local_4->guid).Data1)
											((IUnknown *)local_4,(IID *)&idl::IID_IDirectDraw4,&local_8);
		if (HVar1 == 0) {
			pGVar3 = &idl::IID_IDirect3D3;
			HVar1 = (*local_8->lpVtbl->QueryInterface)(local_8,(IID *)&idl::IID_IDirect3D3,&driverMode);
			if (HVar1 == 0) {
				globals::g_DirectDrawDeviceEnumerate_TABLE = local_4;
				(*local_8->lpVtbl[1].QueryInterface)
									(local_8,(IID *)Dlg_DirectDrawDeviceEnumerate_Callback,NULL);
				(**(code **)(*(int *)pGVar3 + 8))(pGVar3);
			}
			uVar2 = (uint)(HVar1 == 0);
			(**(code **)(*(int *)pGVar3 + 8))(pGVar3);
		}
		(**(code **)((local_4->guid).Data1 + 8))(local_4);
	}
	*out_count = globals::g_DirectDrawDeviceEnumerate_COUNT;
	return uVar2;
}



HRESULT lego::wnd::setup::Dlg_DirectDrawDeviceEnumerate_Callback
									(LPGUID lpGuid,LPSTR lpDeviceDescription,LPSTR lpDeviceName,
									D3DDEVICEDESC_V1 *lpD3DHWDeviceDesc,D3DDEVICEDESC_V1 *lpD3DHELDeviceDesc,
									LPVOID lpContext)
{
	DeviceMode *pDVar1;
	DeviceModeFlags DVar2;
	
	pDVar1 = globals::g_DirectDrawDeviceEnumerate_TABLE + globals::g_DirectDrawDeviceEnumerate_COUNT;
	pDVar1->flags = DEVICEMODE_ISUSED;
	if (lpD3DHWDeviceDesc->dcmColorModel != 0) {
		pDVar1->flags = DEVICEMODE_ISUSED|DEVICEMODE_HARDWARE;
		lpD3DHELDeviceDesc = lpD3DHWDeviceDesc;
	}
										// D3DDD_COLORMODEL (0x1) and D3DCOLOR_RGB (0x2)
	if (((*(byte *)&lpD3DHELDeviceDesc->dwFlags & 1) != 0) && (lpD3DHELDeviceDesc->dcmColorModel == 2)
		 ) {
		pDVar1->flags = pDVar1->flags | DEVICEMODE_COLORMODEL_RGB;
	}
										// D3DDD_DEVICERENDERBITDEPTH (0x80)
	if ((*(byte *)&lpD3DHELDeviceDesc->dwFlags & 0x80) != 0) {
										// <https://github.com/github/VisualStudio/blob/263aac11f57d53c5f9fe64ba9916f77c058974d7/tools/Debugging%20Tools%20for%20Windows/winext/manifest/ddraw.h#L1421>
										// DDBD_8 (0x800) 8 bpp
		if ((lpD3DHELDeviceDesc->dwDeviceRenderBitDepth & 0x800) != 0) {
			pDVar1->flags = pDVar1->flags | DEVICEMODE_BPP_8;
		}
										// DDBD_16 (0x400) 16 bpp
		if ((lpD3DHELDeviceDesc->dwDeviceRenderBitDepth & 0x400) != 0) {
			pDVar1->flags = pDVar1->flags | DEVICEMODE_BPP_16;
		}
										// DDBD_24 (0x200) 24 bpp
		if ((lpD3DHELDeviceDesc->dwDeviceRenderBitDepth & 0x200) != 0) {
			pDVar1->flags = pDVar1->flags | DEVICEMODE_BPP_24;
		}
										// DDBD_32 (0x100) 32 bpp
		if ((lpD3DHELDeviceDesc->dwDeviceRenderBitDepth & 0x100) != 0) {
			pDVar1->flags = pDVar1->flags | DEVICEMODE_BPP_32;
		}
	}
										// D3DDD_DEVCAPS (0x2)
	if ((*(byte *)&lpD3DHELDeviceDesc->dwFlags & 2) != 0) {
										// D3DDEVCAPS_TEXTUREVIDEOMEMORY (0x200)
		if ((lpD3DHELDeviceDesc->dwDevCaps & 0x200) == 0) {
										// D3DDEVCAPS_TEXTURESYSTEMMEMORY (0x100)
			if ((lpD3DHELDeviceDesc->dwDevCaps & 0x100) == 0) goto LAB_0047c71d;
			DVar2 = pDVar1->flags | DEVICEMODE_TEXTURESYSTEMMEMORY;
		}
		else {
			DVar2 = pDVar1->flags | DEVICEMODE_TEXTUREVIDEOMEMORY;
		}
		pDVar1->flags = DVar2;
	}
LAB_0047c71d:
	(pDVar1->guid).Data1 = lpGuid->Data1;
	*(undefined4 *)&(pDVar1->guid).Data2 = *(undefined4 *)&lpGuid->Data2;
	*(undefined4 *)(pDVar1->guid).Data4 = *(undefined4 *)lpGuid->Data4;
	*(undefined4 *)((pDVar1->guid).Data4 + 4) = *(undefined4 *)(lpGuid->Data4 + 4);
	std::sprintf(pDVar1->displayName,"%s (%s)",lpDeviceName,lpDeviceDescription);
	globals::g_DirectDrawDeviceEnumerate_COUNT = globals::g_DirectDrawDeviceEnumerate_COUNT + 1;
	return 1;
}



BOOL __cdecl
lego::wnd::setup::Dlg_PopulateScreenModes
					(DriverMode *driverMode,BOOL isFullScreen,ScreenMode *ref_ScreenModes,uint *out_count)
{
	HRESULT HVar1;
	int *unaff_ESI;
	uint uVar2;
	ScreenMode *unaff_retaddr;
	IUnknown *local_4;
	IUnknown *pIVar3;
	IUnknown *ppIVar3;
	
	uVar2 = 0;
	globals::g_DirectDrawScreenEnumerate_COUNT = 0;
	if ((driverMode != NULL) && ((driverMode->flags & DRIVERMODE_ISUSED) != DRIVERMODE_NONE)) {
		HVar1 = DirectDrawCreate((LPGUID)(~-(uint)((driverMode->flags & DRIVERMODE_NOGUID_10) !=
																							DRIVERMODE_NONE) & (uint)driverMode),&local_4,NULL);
		if (HVar1 == 0) {
			pIVar3 = (IUnknown *)&idl::IID_IDirectDraw4;
			HVar1 = (*local_4->lpVtbl->QueryInterface)(local_4,(IID *)&idl::IID_IDirectDraw4,&driverMode);
			if (HVar1 == 0) {
				ppIVar3 = (IUnknown *)&local_4;
										// IDirectDraw4::EnumDisplayModes(THIS_ DWORD dwFlags, DDSURFACEDESC2*
										// lpDDSurfaceDesc, LPVOID lpContext, DDENUMMODESCALLBACK2* lpEnumModesCallback)
				globals::g_DirectDrawScreenEnumerate_TABLE = unaff_retaddr;
				(**(code **)(*unaff_ESI + 0x20))
									(unaff_ESI,0,0,ppIVar3,Dlg_DirectDrawScreenEnumerate_Callback);
				(*ppIVar3->lpVtbl->Release)(ppIVar3);
			}
			uVar2 = (uint)(HVar1 == 0);
			(*pIVar3->lpVtbl->Release)(pIVar3);
		}
	}
	*out_count = globals::g_DirectDrawScreenEnumerate_COUNT;
	return uVar2;
}



HRESULT lego::wnd::setup::Dlg_DirectDrawScreenEnumerate_Callback
									(DDSURFACEDESC2 *lpDDSurfaceDesc,LPVOID lpContext)
{
	int iVar1;
	ScreenMode *pSVar2;
	
	pSVar2 = globals::g_DirectDrawScreenEnumerate_TABLE + globals::g_DirectDrawScreenEnumerate_COUNT;
	pSVar2->flags = SCREENMODE_ISUSED;
	pSVar2->screenWidth = lpDDSurfaceDesc->dwWidth;
	pSVar2->screenHeight = lpDDSurfaceDesc->dwHeight;
	pSVar2->bitDepth = (lpDDSurfaceDesc->ddpfPixelFormat).dwRGBBitCount;
										// WARNING: Load size is inaccurate
										// lpContext (BOOL* isFullScreen)
	if (*lpContext == 0) {
		std::sprintf(pSVar2->displayName,"%ix%i",lpDDSurfaceDesc->dwWidth,lpDDSurfaceDesc->dwHeight);
	}
	else {
		std::sprintf(pSVar2->displayName,"%ix%i (%i bit)",lpDDSurfaceDesc->dwWidth,
								 lpDDSurfaceDesc->dwHeight,(lpDDSurfaceDesc->ddpfPixelFormat).dwRGBBitCount);
	}
										// WARNING: Load size is inaccurate
										// lpContext (BOOL* isFullScreen)
	if ((*lpContext == 0) && (globals::g_DirectDrawScreenEnumerate_COUNT != 0)) {
		iVar1 = Setup_GetDeviceBitsPerPixel();
		if (pSVar2->bitDepth != iVar1) {
										// Bit depth doesn't match system, we can't use this in windowed
			pSVar2->flags = pSVar2->flags & 0xfffffffe;
			return 1;
		}
	}
	globals::g_DirectDrawScreenEnumerate_COUNT = globals::g_DirectDrawScreenEnumerate_COUNT + 1;
	return 1;
}



// WARNING: Exceeded maximum restarts with more pending

BOOL __cdecl
lego::main::Main_DirectDrawCreate
					(BOOL isFullScreen,DriverMode *driver,DeviceMode *device,ScreenMode *screen,int x,int y,
					int screenWidth,int screenHeight)
{
	HRESULT HVar1;
	int iVar2;
	BOOL BVar3;
	IDirectDrawSurface4 **lplpDDAttachedSurface;
	IUnknown *unaff_ESI;
	LPGUID lpGUID;
	DDSURFACEDESC2 *pDVar4;
	DeviceMode *unaff_retaddr;
	IDirectDraw4 *pIVar5;
	HWND pHVar6;
	IDirectDraw4 **dwBPP;
	DDSURFACEDESC2 local_94;
	
	lpGUID = NULL;
	local_94.dwFlags = 0x10;
	if ((driver != NULL) && ((*(byte *)&driver->flags & 1) == 0)) {
		driver = NULL;
	}
	if (screen != NULL) {
		if ((*(byte *)&screen->flags & 1) == 0) {
			screen = NULL;
		}
		if (screen != NULL) {
			screenWidth = screen->screenWidth;
			screenHeight = screen->screenHeight;
			local_94.dwFlags = screen->bitDepth;
		}
	}
	globals::wnd::g_ScreenIsFullScreen = isFullScreen;
	if (driver != NULL) {
		lpGUID = (LPGUID)(~-(uint)((driver->flags & DRIVERMODE_NOGUID_10) != DRIVERMODE_NONE) &
										 (uint)driver);
	}
	globals::wnd::g_ScreenWidth = screenWidth;
	globals::wnd::g_ScreenHeight = screenHeight;
	wnd::Win_ShowGameWindow(isFullScreen,x,y,screenWidth,screenHeight);
	HVar1 = DirectDrawCreate(lpGUID,(IUnknown **)&local_94,NULL);
	if (HVar1 == 0) {
		dwBPP = &globals::g_IDirectDraw4;
		HVar1 = (*(*(IUnknownVtbl **)local_94.dwSize)->QueryInterface)
											((IUnknown *)local_94.dwSize,(IID *)&idl::IID_IDirectDraw4,
											 &globals::g_IDirectDraw4);
		if (HVar1 == 0) {
										// IDirectDraw4::SetCooperativeLevel(HWND a, DWORD b)
										// 
										// FullScreen = DDSCL_EXCLUSIVE | DDSCL_FULLSCREEN (0x11)
										// Windowed   = DDSCL_NORMAL (0x8)
			lplpDDAttachedSurface = (IDirectDrawSurface4 **)((-(uint)(isFullScreen != 0) & 9) + 8);
			pIVar5 = globals::g_IDirectDraw4;
			pHVar6 = globals::g_DirectDraw_hWnd;
			HVar1 = (*globals::g_IDirectDraw4->lpVtbl->SetCooperativeLevel)();
			if (HVar1 == 0) {
				if (isFullScreen == 0) {
					iVar2 = 0;
				}
				else {
										// IDirectDraw4::SetDisplayMode(DWORD a, DWORD b, DWORD c, DWORD d, DWORD e)
					iVar2 = (*globals::g_IDirectDraw4->lpVtbl->SetDisplayMode)
														(globals::g_IDirectDraw4,screenWidth,screenHeight,(DWORD)dwBPP,0,0);
				}
				if (iVar2 == 0) {
					pDVar4 = &local_94;
					for (iVar2 = 0x1f; iVar2 != 0; iVar2 += -1) {
						pDVar4->dwSize = 0;
						pDVar4 = (DDSURFACEDESC2 *)&pDVar4->dwFlags;
					}
					local_94.dwSize = 0x7c;
					local_94.dwFlags = 1;
					local_94.ddsCaps.dwCaps = 0x2200;
					if (isFullScreen != 0) {
						local_94.dwFlags = 0x21;
						local_94.dwBackBufferCount_Depth = 1;
						local_94.ddsCaps.dwCaps = 0x2218;
					}
										// IDirectDraw4::CreateSurface(LPDDSURFACEDESC2 a, LPDIRECTDRAWSURFACE4 FAR * b,
										// IUnknown FAR * c)
					HVar1 = (*globals::g_IDirectDraw4->lpVtbl->CreateSurface)
														(globals::g_IDirectDraw4,&local_94,
														 &globals::g_IDirectDrawSurface4_RenderTarget,NULL);
					if (HVar1 == 0) {
						if (isFullScreen == 0) {
										// IDirectDraw4::CreateSurface(LPDDSURFACEDESC2 a, LPDIRECTDRAWSURFACE4 FAR * b,
										// IUnknown FAR * c)
							local_94.ddsCaps.dwCaps = local_94.ddsCaps.dwCaps & 0xfffffdff | 0x40;
							local_94.dwFlags |= 6;
							local_94.dwHeight = screenHeight;
							local_94.dwWidth = screenWidth;
							iVar2 = (*globals::g_IDirectDraw4->lpVtbl->CreateSurface)
																(globals::g_IDirectDraw4,&local_94,
																 &globals::g_IDirectDrawSurface4_DrawTarget,NULL);
						}
						else {
										// IDirectDrawSurface4::GetAttachedSurface(THIS_ LPDDSCAPS2,
										// LPDIRECTDRAWSURFACE4 FAR *)
							unaff_ESI = NULL;
							iVar2 = (*globals::g_IDirectDrawSurface4_RenderTarget->lpVtbl->GetAttachedSurface)
																(globals::g_IDirectDrawSurface4_RenderTarget,
																 (DDSCAPS2)
																 CONCAT412(pHVar6,CONCAT48(pIVar5,CONCAT44(0x76bc8c,&stack0xffffff5c
																																					))),lplpDDAttachedSurface)
							;
						}
						if (iVar2 == 0) {
							BVar3 = Main_InitClipperRegion(isFullScreen,screenWidth,screenHeight);
							if ((BVar3 != 0) &&
								 (BVar3 = Main_Direct3DRMCreate
																		(unaff_retaddr,unaff_ESI,
																		 globals::g_IDirectDrawSurface4_DrawTarget,isFullScreen),
								 BVar3 != 0)) {
								(*unaff_ESI->lpVtbl->Release)(unaff_ESI);
								if (isFullScreen != 0) {
									ShowCursor(0);
								}
								return 1;
							}
							(*globals::g_IDirectDrawSurface4_DrawTarget->lpVtbl->Release)
												((IUnknown *)globals::g_IDirectDrawSurface4_DrawTarget);
							globals::g_IDirectDrawSurface4_DrawTarget = NULL;
						}
						(*globals::g_IDirectDrawSurface4_RenderTarget->lpVtbl->Release)
											((IUnknown *)globals::g_IDirectDrawSurface4_RenderTarget);
						globals::g_IDirectDrawSurface4_RenderTarget = NULL;
					}
				}
			}
			(*globals::g_IDirectDraw4->lpVtbl->Release)((IUnknown *)globals::g_IDirectDraw4);
			globals::g_IDirectDraw4 = NULL;
		}
		(*unaff_ESI->lpVtbl->Release)(unaff_ESI);
	}
	return 0;
}



void __cdecl lego::draw::Draw_Render(void)
{
	if (lego::globals::wnd::g_ScreenIsFullScreen != 0) {
										// DDFLIP_WAIT (0x1)
		(*lego::globals::g_IDirectDrawSurface4_RenderTarget->lpVtbl->Flip)
							(lego::globals::g_IDirectDrawSurface4_RenderTarget,NULL,1);
		return;
	}
	Draw_RenderWindowed();
	return;
}



int __cdecl lego::image::Image_FUN_0047cbb0(int *param_1,char *param_2)
{
	uint uVar1;
	FileStream *file;
	undefined4 *puVar2;
	int iVar3;
	int iVar4;
	uint uVar5;
	byte bVar6;
	int unaff_EBX;
	FileStream *unaff_EBP;
	int iVar7;
	uint length;
	undefined4 *puVar8;
	int iVar9;
	uint local_ec;
	byte bStack200;
	undefined uStack199;
	int iStack198;
	undefined4 uStack190;
	undefined4 uStack186;
	undefined auStack182 [3];
	undefined local_b3 [5];
	undefined2 uStack174;
	undefined2 uStack172;
	undefined4 uStack170;
	undefined4 uStack166;
	undefined4 uStack162;
	undefined4 uStack158;
	undefined4 uStack154;
	undefined4 uStack150;
	uint uStack136;
	uint uStack132;
	int iStack128;
	undefined4 local_7c [4];
	int iStack108;
	uint uStack60;
	uint uStack56;
	uint uStack52;
	uint uStack48;
	int *piStack16;
	
	bVar6 = 0;
	_auStack182 &= 0xff00ffff;
	iVar7 = 0;
	puVar2 = (undefined4 *)(auStack182 + 3);
	for (iVar3 = 0xd; iVar3 != 0; iVar3 += -1) {
		*puVar2 = 0;
		puVar2 = puVar2 + 1;
	}
	*(undefined *)puVar2 = 0;
	file = lego::file::File_Open(param_2,"wb");
	if (file != NULL) {
		iVar3 = 0;
		puVar2 = local_7c;
		for (iVar4 = 0x1f; iVar4 != 0; iVar4 += -1) {
			*puVar2 = 0;
			puVar2 = puVar2 + 1;
		}
		local_7c[0] = 0x7c;
		iVar4 = (**(code **)(*param_1 + 100))(param_1,0,local_7c,1);
		if (iVar4 == 0) {
			iVar4 = (-(uint)((uStack132 * 3 & 3) != 0) & 4) + (uStack132 * 3 & 0xfffffffc);
			length = iVar4 * uStack136;
			puVar2 = (undefined4 *)std::malloc(length);
			if (puVar2 != NULL) {
				puVar8 = puVar2;
				for (uVar5 = length >> 2; uVar5 != 0; uVar5 -= 1) {
					*puVar8 = 0;
					puVar8 = puVar8 + 1;
				}
				for (iVar7 = 0; iVar7 != 0; iVar7 += -1) {
					*(undefined *)puVar8 = 0;
					puVar8 = (undefined4 *)((int)puVar8 + 1);
				}
				uVar5 = 0;
				do {
					if ((uStack56 >> ((byte)uVar5 & 0x1f) & 1) != 0) {
						unaff_EBX += 1;
					}
					uVar5 += 1;
				} while (uVar5 < 0x20);
				uVar5 = 0;
				do {
					if ((uStack52 >> ((byte)uVar5 & 0x1f) & 1) != 0) {
						iVar3 += 1;
					}
					uVar5 += 1;
				} while (uVar5 < 0x20);
				uVar5 = 0;
				do {
					if ((uStack48 >> ((byte)uVar5 & 0x1f) & 1) != 0) {
						bVar6 += 1;
					}
					uVar5 += 1;
				} while (uVar5 < 0x20);
				uVar5 = 0;
				if (uStack136 != 0) {
					do {
						iVar7 = 0;
						local_ec = 0;
						if (uStack132 != 0) {
							iVar9 = 0;
							do {
								iVar7 += 3;
								uVar1 = *(uint *)(uVar5 * iStack128 + iStack108 + iVar9);
								*(char *)((int)puVar2 + iVar7 + ((uStack136 - uVar5) + -1) * iVar4 + -1) =
										 (char)(uVar1 >> (bVar6 + (char)iVar3 & 0x1f)) << (8U - (char)unaff_EBX & 0x1f);
								*(char *)((int)puVar2 + iVar7 + ((uStack136 - uVar5) + -1) * iVar4 + -2) =
										 (char)(uVar1 >> (bVar6 & 0x1f)) << (8U - (char)iVar3 & 0x1f);
								*(char *)((int)puVar2 + iVar7 + ((uStack136 - uVar5) + -1) * iVar4 + -3) =
										 (char)uVar1 << (8 - bVar6 & 0x1f);
								iVar9 += uStack60 >> 3;
								local_ec += 1;
							} while (local_ec < uStack132);
						}
						uVar5 += 1;
					} while (uVar5 < uStack136);
				}
				iVar7 = 1;
			}
			(**(code **)(*piStack16 + 0x80))(piStack16,0);
			iStack198 = length + 0x36;
			bStack200 = 0x42;
			uStack199 = 0x4d;
			uStack190 = 0x36;
			uStack186 = 0x28;
			_auStack182 = uStack132;
			local_b3._1_4_ = uStack136;
			uStack174 = 1;
			uStack172 = 0x18;
			uStack170 = 0;
			uStack166 = 0;
			uStack162 = 1;
			uStack158 = 1;
			uStack154 = 0;
			uStack150 = 0;
			file = unaff_EBP;
			if (iVar7 != 0) {
				lego::file::File_Write(&bStack200,0x36,1,unaff_EBP);
				lego::file::File_Write((byte *)puVar2,length,1,unaff_EBP);
				file = unaff_EBP;
			}
			std::free(puVar2);
		}
		lego::file::File_Close(file);
	}
	return iVar7;
}



void __cdecl lego::draw::Draw_CopyToDrawTarget(void)
{
	if (lego::globals::wnd::g_ScreenIsFullScreen != 0) {
										// DDBLT_WAIT (0x1000000)
		(*lego::globals::g_IDirectDrawSurface4_DrawTarget->lpVtbl->Blt)
							(lego::globals::g_IDirectDrawSurface4_DrawTarget,NULL,
							 lego::globals::g_IDirectDrawSurface4_RenderTarget,NULL,0x1000000,NULL);
	}
	return;
}



void __cdecl lego::draw::Draw_RenderWindowed(void)
{
	tagPOINT local_28;
	tagRECT local_20;
	tagRECT local_10;
	
	local_20.right = lego::globals::wnd::g_ScreenWidth;
	local_28.y = 0;
	local_28.x = 0;
	local_20.left = 0;
	local_20.top = 0;
	local_20.bottom = lego::globals::wnd::g_ScreenHeight;
	ClientToScreen(lego::globals::g_DirectDraw_hWnd,(LPPOINT)&local_28);
	OffsetRect((LPRECT)&local_20,local_28.x,local_28.y);
	local_10.bottom = lego::globals::wnd::g_ScreenHeight;
	local_10.left = 0;
	local_10.top = 0;
	local_10.right = lego::globals::wnd::g_ScreenWidth;
										// DDBLT_WAIT (0x1000000)
	(*lego::globals::g_IDirectDrawSurface4_RenderTarget->lpVtbl->Blt)
						(lego::globals::g_IDirectDrawSurface4_RenderTarget,(LPRECT)&local_20,
						 lego::globals::g_IDirectDrawSurface4_DrawTarget,(LPRECT)&local_10,0x1000000,NULL);
	return;
}



void __cdecl lego::main::Main_CleanupDirectXBase(void)
{
	if (globals::g_IDirectDrawSurface4_RenderTarget != NULL) {
		(*globals::g_IDirectDrawSurface4_RenderTarget->lpVtbl->Release)
							((IUnknown *)globals::g_IDirectDrawSurface4_RenderTarget);
	}
	if (globals::g_IDirectDrawClipper_RenderTarget != NULL) {
		(*globals::g_IDirectDrawClipper_RenderTarget->lpVtbl->Release)
							((IUnknown *)globals::g_IDirectDrawClipper_RenderTarget);
	}
	if (globals::g_IDirectDrawClipper_DrawTarget != NULL) {
		(*globals::g_IDirectDrawClipper_DrawTarget->lpVtbl->Release)
							((IUnknown *)globals::g_IDirectDrawClipper_DrawTarget);
	}
	if (globals::g_IDirectDraw4 != NULL) {
		if (globals::wnd::g_ScreenIsFullScreen != 0) {
			(*(code *)globals::g_IDirectDraw4->lpVtbl->RestoreDisplayMode)(globals::g_IDirectDraw4);
		}
		if (globals::g_IDirectDraw4 != NULL) {
			(*globals::g_IDirectDraw4->lpVtbl->Release)((IUnknown *)globals::g_IDirectDraw4);
		}
	}
	return;
}



void __cdecl lego::main::Main_CalculateTextureUsage(uint *ref_textureUsage)
{
	HRESULT HVar1;
	int iVar2;
	uint unaff_EDI;
	DDPIXELFORMAT *pDVar3;
	DDPIXELFORMAT pixFmt;
	
	pDVar3 = &pixFmt;
	for (iVar2 = 8; iVar2 != 0; iVar2 += -1) {
		*(undefined4 *)pDVar3 = 0;
		pDVar3 = (DDPIXELFORMAT *)((int)pDVar3 + 4);
	}
	pixFmt.dwSize = 0x20;
										// DDBD_8 (0x800), D3DRMFPTF_PALETTIZED (0x4)
	HVar1 = (*globals::g_IDirect3DRMDevice3->lpVtbl->FindPreferredTextureFormat)
										(globals::g_IDirect3DRMDevice3,0x800,4,&pixFmt);
	if (HVar1 != 0) {
		pDVar3 = &pixFmt;
		for (iVar2 = 8; iVar2 != 0; iVar2 += -1) {
			pDVar3->dwSize = 0;
			pDVar3 = (DDPIXELFORMAT *)&pDVar3->dwFlags;
		}
		pixFmt.dwSize = 0x20;
										// DDBD_16 (0x400), <no flags> (0x0)
		HVar1 = (*globals::g_IDirect3DRMDevice3->lpVtbl->FindPreferredTextureFormat)
											(globals::g_IDirect3DRMDevice3,0x400,0,&pixFmt);
		if (HVar1 == 0) {
			*(uint *)pixFmt.dwGBitMask = (unaff_EDI >> 3) * *(int *)pixFmt.dwGBitMask;
		}
	}
	return;
}



BOOL __cdecl lego::draw::Draw_GetAvailableVideoMemory(uint *out_totalMem,uint *out_freeMem)
{
	int iVar1;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_c = 0;
	local_8 = 0;
										// DDSCAPS_TEXTURE (0x1000)
	local_10 = 0x1000;
	local_4 = 0;
	*out_totalMem = 0;
	*out_freeMem = 0;
	iVar1 = (*(code *)lego::globals::g_IDirectDraw4->lpVtbl->GetAvailableVidMem)
										(lego::globals::g_IDirectDraw4,&local_10,out_totalMem,out_freeMem);
	return (uint)(iVar1 == 0);
}



HRESULT __cdecl lego::draw::Draw_FillSurface(Rect2F *rect,uint rgbColor)
{
	HRESULT HVar1;
	int iVar2;
	undefined4 *puVar3;
	longlong lVar4;
	tagRECT local_74;
	undefined4 local_64 [20];
	uint local_14;
	
	puVar3 = local_64;
	for (iVar2 = 0x19; iVar2 != 0; iVar2 += -1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	local_64[0] = 100;
	local_14 = image::packNativeRGB(lego::globals::g_IDirectDrawSurface4_DrawTarget,rgbColor);
	if (rect != NULL) {
		lVar4 = __ftol((float10)rect->x);
		local_74.left = (LONG)lVar4;
		lVar4 = __ftol((float10)rect->y);
		local_74.top = (LONG)lVar4;
		lVar4 = __ftol((float10)rect->width + (float10)rect->x);
		local_74.right = (LONG)lVar4;
		lVar4 = __ftol((float10)rect->height + (float10)rect->y);
		local_74.bottom = (LONG)lVar4;
										// DDBLT_WAIT | DDBLT_COLORFILL (0x1000000 | 0x400)
		HVar1 = (*lego::globals::g_IDirectDrawSurface4_DrawTarget->lpVtbl->Blt)
											(lego::globals::g_IDirectDrawSurface4_DrawTarget,(LPRECT)&local_74,NULL,NULL,
											 0x1000400,local_64);
		return HVar1;
	}
										// DDBLT_WAIT | DDBLT_COLORFILL (0x1000000 | 0x400)
	HVar1 = (*lego::globals::g_IDirectDrawSurface4_DrawTarget->lpVtbl->Blt)
										(lego::globals::g_IDirectDrawSurface4_DrawTarget,NULL,NULL,NULL,0x1000400,
										 local_64);
	return HVar1;
}



BOOL __cdecl lego::main::Main_InitClipperRegion(BOOL isFullScreen,int screenWidth,int screenHeight)
{
	int iVar1;
	HRGN hrgn;
	DWORD length;
	LPRGNDATA lpRgnData;
	int unaff_EBX;
	int unaff_EBP;
	IDirectDraw4 *pIVar2;
	
	pIVar2 = globals::g_IDirectDraw4;
	iVar1 = (*(code *)globals::g_IDirectDraw4->lpVtbl->CreateClipper)
										(globals::g_IDirectDraw4,0,&globals::g_IDirectDrawClipper_DrawTarget,0);
	if (iVar1 == 0) {
		hrgn = CreateRectRgn(0,0,unaff_EBP,unaff_EBX);
		length = GetRegionData(hrgn,0,NULL);
		lpRgnData = (LPRGNDATA)std::malloc(length);
		GetRegionData(hrgn,length,lpRgnData);
		iVar1 = (*(code *)globals::g_IDirectDrawClipper_DrawTarget->lpVtbl->SetClipList)
											(globals::g_IDirectDrawClipper_DrawTarget,lpRgnData,0);
		if (iVar1 == 0) {
			std::free(lpRgnData);
			iVar1 = (*(code *)globals::g_IDirectDrawSurface4_DrawTarget->lpVtbl->SetClipper)
												(globals::g_IDirectDrawSurface4_DrawTarget,
												 globals::g_IDirectDrawClipper_DrawTarget);
			if (iVar1 == 0) {
				if (pIVar2 != NULL) {
					return 1;
				}
				iVar1 = (*(code *)globals::g_IDirectDraw4->lpVtbl->CreateClipper)
													(globals::g_IDirectDraw4,0,&globals::g_IDirectDrawClipper_RenderTarget,0);
				if (iVar1 == 0) {
					iVar1 = (*(code *)globals::g_IDirectDrawClipper_RenderTarget->lpVtbl->SetHWnd)
														(globals::g_IDirectDrawClipper_RenderTarget,0,globals::g_DirectDraw_hWnd
														);
					if (iVar1 == 0) {
						iVar1 = (*(code *)globals::g_IDirectDrawSurface4_RenderTarget->lpVtbl->SetClipper)
															(globals::g_IDirectDrawSurface4_RenderTarget,
															 globals::g_IDirectDrawClipper_RenderTarget);
						if (iVar1 == 0) {
							return 1;
						}
					}
				}
			}
			(*globals::g_IDirectDrawClipper_DrawTarget->lpVtbl->Release)
								((IUnknown *)globals::g_IDirectDrawClipper_DrawTarget);
			globals::g_IDirectDrawClipper_DrawTarget = NULL;
		}
		std::free(lpRgnData);
	}
	return 0;
}



// WARNING: Could not reconcile some variable overlaps

void __cdecl FUN_0047d2c0(undefined4 param_1,int *param_2)
{
	int iVar1;
	uint uVar2;
	uint uVar3;
	uint uVar4;
	bool bVar5;
	uint uVar6;
	int iVar7;
	char cVar8;
	uint uVar9;
	uint uVar10;
	char cVar11;
	byte bVar12;
	undefined4 *puVar13;
	uint uVar14;
	uint uStack292;
	byte bStack276;
	byte bStack272;
	uint uStack260;
	uint uStack256;
	int iStack252;
	undefined4 local_f8 [4];
	int iStack232;
	int iStack184;
	undefined auStack144 [8];
	uint uStack136;
	uint uStack132;
	int iStack128;
	undefined4 local_7c [4];
	int iStack108;
	int iStack60;
	uint uStack56;
	uint uStack52;
	uint uStack48;
	int *piStack16;
	int *piStack12;
	int iStack8;
	
	puVar13 = local_7c;
	for (iVar7 = 0x1f; iVar7 != 0; iVar7 += -1) {
		*puVar13 = 0;
		puVar13 = puVar13 + 1;
	}
	puVar13 = local_f8;
	for (iVar7 = 0x1f; iVar7 != 0; iVar7 += -1) {
		*puVar13 = 0;
		puVar13 = puVar13 + 1;
	}
	local_7c[0] = 0x7c;
	local_f8[0] = 0x7c;
	iVar7 = (**(code **)(*param_2 + 100))(param_2,0,local_f8,1,0);
	if (iVar7 == 0) {
		if ((iStack184 == 8) &&
			 (iVar7 = (**(code **)(*piStack16 + 100))(piStack16,0,auStack144,1,0), iVar7 == 0)) {
			if ((iStack60 == 0x10) && ((uStack132 == uStack256 && (uStack136 == uStack260)))) {
				iVar7 = 0;
				cVar8 = '\0';
				do {
					if ((uStack56 >> ((byte)iVar7 & 0x1f) & 1) != 0) {
						cVar8 += '\x01';
					}
					iVar7 += 1;
				} while (iVar7 < 0x20);
				iVar7 = 0;
				cVar11 = '\0';
				do {
					if ((uStack52 >> ((byte)iVar7 & 0x1f) & 1) != 0) {
						cVar11 += '\x01';
					}
					iVar7 += 1;
				} while (iVar7 < 0x20);
				iVar7 = 0;
				bVar12 = 0;
				do {
					if ((uStack48 >> ((byte)iVar7 & 0x1f) & 1) != 0) {
						bVar12 += 1;
					}
					iVar7 += 1;
				} while (iVar7 < 0x20);
				uVar14 = 0;
				if (uStack260 != 0) {
					do {
						uVar10 = 0;
						if (uStack256 != 0) {
							bStack276 = 8 - cVar8;
							bStack272 = 8 - cVar11;
							uStack292._0_1_ = 8 - bVar12;
							do {
								iVar7 = 0x18;
								uVar2 = *(uint *)(uVar14 * iStack252 + uVar10 + iStack232);
								uVar9 = 3;
								bVar5 = true;
								do {
									uVar3 = uVar2 >> ((byte)iVar7 & 0x1f) & 0xff;
									iVar1 = iStack8 + uVar3 * 4;
									uVar3 = (uint)(*(byte *)(iStack8 + uVar3 * 4) >> (bStack276 & 0x1f));
									uVar4 = (uint)(*(byte *)(iVar1 + 1) >> (bStack272 & 0x1f));
									uVar6 = (uint)(*(byte *)(iVar1 + 2) >> ((byte)uStack292 & 0x1f));
									if (bVar5) {
										uStack292 = (uVar3 << (bVar12 + cVar11 & 0x1f) | uVar4 << (bVar12 & 0x1f) |
																uVar6) << 0x10;
									}
									else {
										uStack292 |= uVar3 << (cVar11 + bVar12 & 0x1f) | uVar4 << (bVar12 & 0x1f) |
																 uVar6;
										*(uint *)(iStack108 + uVar14 * iStack128 + (uVar10 + (uVar9 >> 1 & 1) * 2) * 2)
												 = uStack292;
									}
									uVar9 -= 1;
									bVar5 = (bool)(bVar5 ^ 1);
									iVar7 += -8;
								} while (-1 < iVar7);
								uVar10 += 4;
							} while (uVar10 < uStack256);
						}
						uVar14 += 1;
					} while (uVar14 < uStack260);
				}
			}
			(**(code **)(*piStack16 + 0x80))(piStack16,0);
			param_2 = piStack12;
		}
		(**(code **)(*param_2 + 0x80))(param_2,0);
	}
	return;
}



uint __cdecl lego::image::packNativeRGB(IDirectDrawSurface4 *ddSurface,uint rgbColor)
{
	IDirectDrawSurface4Vtbl *pIVar1;
	byte bVar2;
	int iVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	int iVar7;
	byte *pbVar8;
	uint unaff_EBP;
	int *unaff_ESI;
	DDPIXELFORMAT *pDVar9;
	DWORD *pDVar10;
	uint local_428;
	IDirectDrawPalette *ddPal;
	DDPIXELFORMAT pixFmt;
	D3DRMPALETTEENTRY palEntries [256];
	
	local_428 = rgbColor >> 0x10 & 0xff;
	uVar6 = rgbColor >> 8 & 0xff;
	pIVar1 = ddSurface->lpVtbl;
	pDVar9 = &pixFmt;
	for (iVar7 = 8; iVar7 != 0; iVar7 += -1) {
		pDVar9->dwSize = 0;
		pDVar9 = (DDPIXELFORMAT *)&pDVar9->dwFlags;
	}
	pixFmt.dwSize = 0x20;
	(*pIVar1->GetPixelFormat)(ddSurface,&pixFmt);
	if (((byte)ddPal & 0x40) == 0) {
		(*ddSurface->lpVtbl->GetPalette)(ddSurface,(IDirectDrawPalette **)&stack0xfffffbd4);
		pDVar10 = &pixFmt.dwRBitMask;
		(**(code **)(*unaff_ESI + 0x10))(unaff_ESI,0,0,0x100);
		uVar5 = 0;
		pbVar8 = (byte *)((int)&ddPal + 1);
		while ((((DWORD *)(uint)pbVar8[-1] != pDVar10 || (*pbVar8 != uVar6)) ||
					 ((uint)pbVar8[1] != (rgbColor & 0xff)))) {
			uVar5 += 1;
			pbVar8 = pbVar8 + 4;
			if (0xff < uVar5) {
				return 0;
			}
		}
		return uVar5;
	}
	iVar7 = countBits2(pixFmt.dwFourCC);
	iVar3 = countBits2(pixFmt.dwRGBBitCount);
	iVar4 = countBits2(pixFmt.dwRBitMask);
	bVar2 = (byte)iVar4;
	return (unaff_EBP >> (8U - (char)iVar7 & 0x1f)) << (bVar2 + (char)iVar3 & 0x1f) |
				 (uVar6 >> (8U - (char)iVar3 & 0x1f)) << (bVar2 & 0x1f) |
				 (rgbColor & 0xff) >> (8 - bVar2 & 0x1f);
}



int __cdecl lego::image::countBits2(uint value)
{
	int iVar1;
	
	iVar1 = 0;
	if (value != 0) {
		do {
			value &= value - 1;
			iVar1 += 1;
		} while (value != 0);
	}
	return iVar1;
}



void __cdecl lego::pool::ReservedPool_ImageBMP___Init(void)
{
	int iVar1;
	void **ppvVar2;
	
	ppvVar2 = globals::ReservedPool_ImageBMP___g_TABLE;
	for (iVar1 = 0x20; iVar1 != 0; iVar1 += -1) {
		*ppvVar2 = NULL;
		ppvVar2 = ppvVar2 + 1;
	}
	globals::ReservedPool_ImageBMP___g_ISINIT = 1;
	return;
}



void __cdecl lego::pool::ReservedPool_ImageBMP___Cleanup(void)
{
	void **ppvVar1;
	
	image::Image_Cleanup_FUN_0047e3f0();
	ppvVar1 = globals::ReservedPool_ImageBMP___g_TABLE;
	do {
		if (*ppvVar1 != NULL) {
			std::free(*ppvVar1);
		}
		ppvVar1 = ppvVar1 + 1;
	} while (ppvVar1 < &globals::ReservedPool_ImageBMP___g_NEXT);
	globals::ReservedPool_ImageBMP___g_NEXT = NULL;
	globals::ReservedPool_ImageBMP___g_ISINIT = 0;
	return;
}



void __cdecl lego::pool::ReservedPool_ImageBMP___Release(ImageBMP *image)
{
	(*image->ddSurface->lpVtbl->Release)((IUnknown *)image->ddSurface);
	image->pool_m_next = (ImageBMP *)globals::ReservedPool_ImageBMP___g_NEXT;
	globals::ReservedPool_ImageBMP___g_NEXT = image;
	return;
}



BOOL __cdecl
lego::image::Image_FUN_0047d750(IDirectDrawSurface4 *ddSurface,DDSURFACEDESC2 *surfaceDesc)
{
	DWORD DVar1;
	HRESULT HVar2;
	int iVar3;
	DWORD *pDVar4;
	DDSURFACEDESC2 local_7c;
	
	pDVar4 = &local_7c.dwFlags;
	for (iVar3 = 0x1e; iVar3 != 0; iVar3 += -1) {
		*pDVar4 = 0;
		pDVar4 = pDVar4 + 1;
	}
										// IDirectDrawSurface4::Lock(IDirectDrawSurface4* This, RECT* a, DDSURFACEDESC2*
										// b, DWORD c, HANDLE d)
										// DDLOCK_WRITEONLY | DDLOCK_WAIT (0x20 | 0x1)
	local_7c.dwSize = 0x7c;
	HVar2 = (*ddSurface->lpVtbl->Lock)(ddSurface,NULL,&local_7c,0x21,NULL);
	if (HVar2 == 0) {
		DVar1 = surfaceDesc->lPitch_dwLinearSize;
		if (7 < (int)DVar1) {
			if (DVar1 == 8) {
				Image_FUN_0047d7e0((int)&local_7c,surfaceDesc);
			}
			else {
				if ((DVar1 != 0x10) && (DVar1 == 0x18)) {
					Image_FUN_0047dac0((int)&local_7c,surfaceDesc);
				}
			}
		}
										// IDirectDrawSurface4::Unock(IDirectDrawSurface4* This, RECT* a)
		(*ddSurface->lpVtbl->Unlock)(ddSurface,NULL);
		return 1;
	}
	return 0;
}



BOOL __cdecl lego::image::Image_FUN_0047d7e0(int param_1,DDSURFACEDESC2 *surfaceDesc)
{
	DWORD DVar1;
	uint uVar2;
	uint uVar3;
	int iVar4;
	int iVar5;
	uint uVar6;
	int iVar7;
	int iVar8;
	int iVar9;
	uint uVar10;
	uint uVar11;
	uint uVar12;
	int iVar13;
	undefined2 *puVar14;
	undefined2 *puVar15;
	byte *pbVar16;
	int local_30;
	byte local_2c;
	byte local_18;
	byte local_10;
	
	iVar4 = *(int *)(param_1 + 0x54);
	if (iVar4 == 8) {
		return 0;
	}
	if (iVar4 == 0x10) {
		uVar10 = *(uint *)(param_1 + 0x5c);
		puVar15 = *(undefined2 **)(param_1 + 0x24);
		DVar1 = surfaceDesc->dwMipMapCount_RefreshRate_SrcVBHandle;
		uVar2 = (surfaceDesc->ddckCKSrcOverlay).dwColorSpaceLowValue;
		uVar3 = *(uint *)(param_1 + 0x10);
		pbVar16 = (byte *)surfaceDesc->dwAlphaBitDepth;
		uVar12 = *(uint *)(param_1 + 0x60);
		uVar11 = *(uint *)(param_1 + 0x58);
		iVar4 = countBits(uVar11);
		iVar5 = countBits(uVar10);
		uVar6 = countBits(uVar12);
		iVar7 = firstBit(uVar11);
		iVar8 = firstBit(uVar10);
		iVar9 = firstBit(uVar12);
		local_30 = 0;
		if (0 < (int)surfaceDesc->dwFlags) {
			do {
				iVar13 = 0;
				if (0 < (int)surfaceDesc->dwSize) {
					local_2c = 8 - (char)uVar6;
					local_10 = 8 - (char)iVar5;
					uVar10 = 8U - iVar4;
					uVar12 = uVar6;
					puVar14 = puVar15;
					do {
						uVar11 = (uint)*pbVar16;
						pbVar16 = pbVar16 + 1;
						puVar15 = puVar14 + 1;
						local_18 = (byte)(8U - iVar4);
						uVar12 = (uVar12 & 0xffff0000 |
										 (uint)(*(byte *)(uVar2 + 2 + uVar11 * 4) >> (local_2c & 0x1f))) <<
										 ((byte)iVar9 & 0x1f) |
										 (uVar2 & 0xffff0000 |
										 (uint)(*(byte *)(uVar2 + uVar11 * 4) >> (local_18 & 0x1f))) <<
										 ((byte)iVar7 & 0x1f) |
										 (uVar10 & 0xffff0000 |
										 (uint)(*(byte *)(uVar2 + 1 + uVar11 * 4) >> (local_10 & 0x1f))) <<
										 ((byte)iVar8 & 0x1f);
						iVar13 += 1;
						*puVar14 = (short)uVar12;
						uVar10 = surfaceDesc->dwSize;
						puVar14 = puVar15;
					} while (iVar13 < (int)uVar10);
				}
				pbVar16 = pbVar16 + (DVar1 - surfaceDesc->dwSize);
				puVar15 = puVar15 + ((uVar3 >> 1) - surfaceDesc->dwSize);
				local_30 += 1;
			} while (local_30 < (int)surfaceDesc->dwFlags);
		}
		Image_ReorderPixelsBPP((DDSURFACEDESC2 *)param_1);
		return 1;
	}
	if (iVar4 == 0x18) {
		return 0;
	}
	if (iVar4 != 0x20) {
		return 1;
	}
	return 0;
}



int __cdecl lego::image::countBits(uint value)
{
	int iVar1;
	uint uVar2;
	
	iVar1 = 0;
	uVar2 = 0;
	do {
		if ((value & 1 << ((byte)uVar2 & 0x1f)) != 0) {
			iVar1 += 1;
		}
		uVar2 += 1;
	} while (uVar2 < 0x20);
	return iVar1;
}



int __cdecl lego::image::firstBit(uint value)
{
	uint uVar1;
	
	uVar1 = 0;
	do {
		if ((value & 1 << ((byte)uVar1 & 0x1f)) != 0) {
			return uVar1;
		}
		uVar1 += 1;
	} while (uVar1 < 0x20);
	return 0xffffffff;
}



void __cdecl lego::image::Image_ReorderPixelsBPP(DDSURFACEDESC2 *surfaceDesc)
{
	uint length;
	int iVar1;
	undefined4 *buffer;
	uint uVar2;
	undefined4 *puVar3;
	undefined4 *puVar4;
	undefined4 *puVar5;
	undefined4 *local_8;
	uint local_4;
	
	puVar3 = (undefined4 *)surfaceDesc->lpSurface;
	iVar1 = (int)surfaceDesc->lPitch_dwLinearSize / 2;
	length = iVar1 * 2;
	local_8 = (undefined4 *)((int)puVar3 + (surfaceDesc->dwHeight - 1) * iVar1 * 2);
	buffer = (undefined4 *)std::malloc(length);
	local_4 = 0;
	if ((surfaceDesc->dwHeight & 0xfffffffe) != 0) {
		do {
			puVar4 = puVar3;
			puVar5 = buffer;
			for (uVar2 = length >> 2; uVar2 != 0; uVar2 -= 1) {
				*puVar5 = *puVar4;
				puVar4 = puVar4 + 1;
				puVar5 = puVar5 + 1;
			}
			for (uVar2 = length & 3; uVar2 != 0; uVar2 -= 1) {
				*(undefined *)puVar5 = *(undefined *)puVar4;
				puVar4 = (undefined4 *)((int)puVar4 + 1);
				puVar5 = (undefined4 *)((int)puVar5 + 1);
			}
			puVar4 = local_8;
			puVar5 = puVar3;
			for (uVar2 = length >> 2; uVar2 != 0; uVar2 -= 1) {
				*puVar5 = *puVar4;
				puVar4 = puVar4 + 1;
				puVar5 = puVar5 + 1;
			}
			for (uVar2 = length & 3; uVar2 != 0; uVar2 -= 1) {
				*(undefined *)puVar5 = *(undefined *)puVar4;
				puVar4 = (undefined4 *)((int)puVar4 + 1);
				puVar5 = (undefined4 *)((int)puVar5 + 1);
			}
			puVar4 = buffer;
			puVar5 = local_8;
			for (uVar2 = length >> 2; uVar2 != 0; uVar2 -= 1) {
				*puVar5 = *puVar4;
				puVar4 = puVar4 + 1;
				puVar5 = puVar5 + 1;
			}
			for (uVar2 = length & 3; uVar2 != 0; uVar2 -= 1) {
				*(undefined *)puVar5 = *(undefined *)puVar4;
				puVar4 = (undefined4 *)((int)puVar4 + 1);
				puVar5 = (undefined4 *)((int)puVar5 + 1);
			}
			local_4 += 1;
			puVar3 = (undefined4 *)((int)puVar3 + length);
			local_8 = (undefined4 *)((int)local_8 + iVar1 * -2);
		} while (local_4 < surfaceDesc->dwHeight >> 1);
	}
	std::free(buffer);
	return;
}



BOOL __cdecl lego::image::Image_FUN_0047dac0(int param_1,DDSURFACEDESC2 *surfaceDesc)
{
	byte *pbVar1;
	byte *pbVar2;
	byte bVar3;
	DWORD DVar4;
	uint uVar5;
	uint value;
	uint uVar6;
	uint uVar7;
	int iVar8;
	int iVar9;
	int iVar10;
	int iVar11;
	uint uVar12;
	uint uVar13;
	DDSURFACEDESC2 *pDVar14;
	int iVar15;
	byte *pbVar16;
	undefined2 *puVar17;
	undefined2 *puVar18;
	int local_2c;
	byte local_18;
	byte local_10;
	
	iVar8 = *(int *)(param_1 + 0x54);
	if (iVar8 == 8) {
		return 0;
	}
	if (iVar8 == 0x10) {
		uVar12 = *(uint *)(param_1 + 0x5c);
		uVar13 = *(uint *)(param_1 + 0x60);
		puVar18 = *(undefined2 **)(param_1 + 0x24);
		DVar4 = surfaceDesc->dwMipMapCount_RefreshRate_SrcVBHandle;
		pbVar16 = (byte *)surfaceDesc->dwAlphaBitDepth;
		uVar5 = *(uint *)(param_1 + 0x10);
		value = *(uint *)(param_1 + 0x58);
		uVar6 = countBits(value);
		uVar7 = countBits(uVar12);
		iVar8 = countBits(uVar13);
		iVar9 = firstBit(value);
		iVar10 = firstBit(uVar12);
		iVar11 = firstBit(uVar13);
		local_2c = 0;
		if (0 < (int)surfaceDesc->dwFlags) {
			do {
				iVar15 = 0;
				if (0 < (int)surfaceDesc->dwSize) {
					local_10 = 8 - (char)uVar6;
					local_18 = 8 - (char)iVar8;
					uVar12 = uVar7;
					uVar13 = uVar6;
					pDVar14 = surfaceDesc;
					puVar17 = puVar18;
					do {
						bVar3 = *pbVar16;
						pbVar1 = pbVar16 + 1;
						puVar18 = puVar17 + 1;
						pbVar2 = pbVar16 + 2;
						pbVar16 = pbVar16 + 3;
						uVar13 = (uVar13 & 0xffff0000 | (uint)(bVar3 >> (local_18 & 0x1f))) <<
										 ((byte)iVar11 & 0x1f);
						pDVar14 = (DDSURFACEDESC2 *)
											(((uint)pDVar14 & 0xffff0000 | (uint)(*pbVar1 >> (8U - (char)uVar7 & 0x1f)))
											 << ((byte)iVar10 & 0x1f) | uVar13 |
											(uVar12 & 0xffff0000 | (uint)(*pbVar2 >> (local_10 & 0x1f))) <<
											((byte)iVar9 & 0x1f));
						iVar15 += 1;
						*puVar17 = (short)pDVar14;
						uVar12 = surfaceDesc->dwSize;
						puVar17 = puVar18;
					} while (iVar15 < (int)uVar12);
				}
				pbVar16 = pbVar16 + DVar4 + surfaceDesc->dwSize * -3;
				local_2c += 1;
				puVar18 = puVar18 + ((uVar5 >> 1) - surfaceDesc->dwSize);
			} while (local_2c < (int)surfaceDesc->dwFlags);
		}
		Image_ReorderPixelsBPP((DDSURFACEDESC2 *)param_1);
		return 1;
	}
	if (iVar8 == 0x18) {
		return 0;
	}
	if (iVar8 != 0x20) {
		return 1;
	}
	return 0;
}



ImageBMP * __cdecl lego::image::Image_LoadBMP(char *filename,undefined4 param_2,undefined4 param_3)
{
	uint lastColor;
	BITMAP_FILE_INFO_STRUCT *bmpData;
	HRESULT HVar1;
	BOOL BVar2;
	ImageBMP *pIVar3;
	int iVar4;
	DWORD unaff_EBX;
	uint unaff_ESI;
	IDirectDrawSurface4 *unaff_EDI;
	int *piVar5;
	DWORD *pDVar6;
	DDSURFACEDESC2 *pDVar7;
	IDirectDrawSurface4 *local_4c4;
	uint local_4c0;
	uint length;
	D3DRMIMAGE local_4b8;
	DDSURFACEDESC2 surfaceDesc;
	char local_400 [1024];
	
	local_4b8.width = 0;
	piVar5 = &local_4b8.height;
	for (iVar4 = 0xe; iVar4 != 0; iVar4 += -1) {
		*piVar5 = 0;
		piVar5 = piVar5 + 1;
	}
	surfaceDesc.dwSize = 0;
	pDVar6 = &surfaceDesc.dwFlags;
	for (iVar4 = 0x1e; iVar4 != 0; iVar4 += -1) {
		*pDVar6 = 0;
		pDVar6 = pDVar6 + 1;
	}
	length = 0;
	local_4c4 = NULL;
	lastColor = packRGB(0,0,0);
	local_4c0 = lastColor;
	bmpData = (BITMAP_FILE_INFO_STRUCT *)lego::file::File_ReadAllBytes(filename,&length);
	if (bmpData != NULL) {
		draw::Image_LoadBMP__internal(bmpData,length,&local_4b8);
		if ((LPVOID)local_4b8.isRGB == NULL) {
			local_4c0 = packRGB((local_4b8.palette)->red,(local_4b8.palette)->green,
													(local_4b8.palette)->blue);
			if ((LPVOID)local_4b8.isRGB == NULL) {
				lastColor = packRGB(local_4b8.palette[0xff].red,local_4b8.palette[0xff].green,
														local_4b8.palette[0xff].blue);
			}
		}
		std::sprintf(local_400,"Data\\%s",filename);
		pDVar7 = &surfaceDesc;
		for (iVar4 = 0x1f; iVar4 != 0; iVar4 += -1) {
			pDVar7->dwSize = 0;
			pDVar7 = (DDSURFACEDESC2 *)&pDVar7->dwFlags;
		}
		surfaceDesc.dwWidth = local_4b8.width;
		surfaceDesc.dwHeight = local_4b8.height;
		surfaceDesc.dwSize = 0x7c;
		surfaceDesc.dwFlags = 7;
		surfaceDesc.ddsCaps.dwCaps = 0x840;
										// IDirectDraw4::CreateSurface(IDirectDraw4* This, DDSURFACEDESC2*
										// lpDDSurfaceDesc, IDirectDrawSurface4** lplpDDSurface, IUnknown* pUnkOuter)
		HVar1 = (*globals::g_IDirectDraw4->lpVtbl->CreateSurface)
											(globals::g_IDirectDraw4,&surfaceDesc,&local_4c4,NULL);
		if (HVar1 == 0) {
			BVar2 = Image_FUN_0047d750(unaff_EDI,(DDSURFACEDESC2 *)&stack0xfffffb38);
			if (BVar2 != 0) {
				pIVar3 = (ImageBMP *)
								 pool::ReservedPool_ImageBMP___NextImage
													 ((int *)unaff_EDI,unaff_EBX,(int)local_4c4,unaff_ESI,lastColor);
				if (pIVar3 != NULL) {
					draw::BMP_free((D3DRMIMAGE *)&stack0xfffffb38);
					std::free(bmpData);
					return pIVar3;
				}
			}
		}
		if (unaff_EDI != NULL) {
			(*unaff_EDI->lpVtbl->Release)((IUnknown *)unaff_EDI);
		}
		draw::BMP_free((D3DRMIMAGE *)&stack0xfffffb38);
		std::free(bmpData);
	}
	return NULL;
}



uint __cdecl lego::image::packRGB(byte red,byte green,byte blue)
{
	_red = (uint)CONCAT12(blue,CONCAT11(green,red));
	return _red;
}



void __cdecl lego::image::Image_SetFirstColorAsKey(ImageBMP *image)
{
	DDCOLORKEY colorKey;
	
	colorKey.dwColorSpaceLowValue = image->firstColor24;
	colorKey.dwColorSpaceHighValue = colorKey.dwColorSpaceLowValue;
	(*image->ddSurface->lpVtbl->SetColorKey)(image->ddSurface,8,&colorKey);
	image->flags = image->flags | 2;
	return;
}



void __cdecl
lego::image::Image_unkFogFromFloat__0047deb0
					(ImageBMP *image,float red_low,float green_low,float blue_low,float red_high,
					float green_high,float blue_high)
{
	byte bVar1;
	uint rgbColor;
	uint rgbColor_00;
	longlong lVar2;
	byte bVar3;
	DDCOLORKEY colorKey;
	
	lVar2 = __ftol((float10)blue_low * (float10)255.0);
	bVar3 = (byte)lVar2;
	lVar2 = __ftol((float10)green_low * (float10)255.0);
	bVar1 = (byte)lVar2;
	lVar2 = __ftol((float10)red_low * (float10)255.0);
	rgbColor = packRGB((byte)lVar2,bVar1,bVar3);
	lVar2 = __ftol((float10)blue_high * (float10)255.0);
	bVar3 = (byte)lVar2;
	lVar2 = __ftol((float10)green_high * (float10)255.0);
	bVar1 = (byte)lVar2;
	lVar2 = __ftol((float10)red_high * (float10)255.0);
	rgbColor_00 = packRGB((byte)lVar2,bVar1,bVar3);
	colorKey.dwColorSpaceLowValue = unpackNativeRGB(image->ddSurface,rgbColor);
	colorKey.dwColorSpaceHighValue = unpackNativeRGB(image->ddSurface,rgbColor_00);
										// IDirectDrawSurface4::SetColorKey(DWORD a, LPDDCOLORKEY b)
	(*image->ddSurface->lpVtbl->SetColorKey)(image->ddSurface,8,&colorKey);
	image->flags = image->flags | 2;
	return;
}



void __cdecl
lego::image::Image_Blt__0047df70(ImageBMP *bitmap,float *param_2,float *param_3,float *param_4)
{
	float fVar1;
	double dVar2;
	float10 fVar3;
	longlong lVar4;
	DWORD lpDDBltFx;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	if (param_2 != NULL) {
		fVar3 = FUN_0048e540(SUB84((double)*param_2,0),(uint)((ulonglong)(double)*param_2 >> 0x20));
		lVar4 = __ftol(fVar3);
		local_10 = (undefined4)lVar4;
		fVar3 = FUN_0048e540(SUB84((double)param_2[1],0),(uint)((ulonglong)(double)param_2[1] >> 0x20));
		lVar4 = __ftol(fVar3);
		local_c = (undefined4)lVar4;
		fVar3 = FUN_0048e540(SUB84((double)(param_2[2] + *param_2),0),
												 (uint)((ulonglong)(double)(param_2[2] + *param_2) >> 0x20));
		lVar4 = __ftol(fVar3);
		local_8 = (undefined4)lVar4;
		fVar3 = FUN_0048e540(SUB84((double)(param_2[3] + param_2[1]),0),
												 (uint)((ulonglong)(double)(param_2[3] + param_2[1]) >> 0x20));
		lVar4 = __ftol(fVar3);
		local_4 = (undefined4)lVar4;
	}
	if (param_3 != NULL) {
		fVar3 = FUN_0048e540(SUB84((double)*param_3,0),(uint)((ulonglong)(double)*param_3 >> 0x20));
		lVar4 = __ftol(fVar3);
		local_20 = (undefined4)lVar4;
		fVar3 = FUN_0048e540(SUB84((double)param_3[1],0),(uint)((ulonglong)(double)param_3[1] >> 0x20));
		lVar4 = __ftol(fVar3);
		local_1c = (undefined4)lVar4;
		if (param_4 == NULL) {
			if (param_2 == NULL) {
				dVar2 = (double)((float)(ulonglong)(uint)bitmap->width + *param_3);
				fVar3 = FUN_0048e540(SUB84(dVar2,0),(uint)((ulonglong)dVar2 >> 0x20));
				lVar4 = __ftol(fVar3);
				local_18 = (undefined4)lVar4;
				fVar1 = (float)(ulonglong)(uint)bitmap->height;
			}
			else {
				fVar3 = FUN_0048e540(SUB84((double)(param_2[2] + *param_3),0),
														 (uint)((ulonglong)(double)(param_2[2] + *param_3) >> 0x20));
				lVar4 = __ftol(fVar3);
				local_18 = (undefined4)lVar4;
				fVar1 = param_2[3];
			}
		}
		else {
			fVar3 = FUN_0048e540(SUB84((double)(*param_4 + *param_3),0),
													 (uint)((ulonglong)(double)(*param_4 + *param_3) >> 0x20));
			lVar4 = __ftol(fVar3);
			local_18 = (undefined4)lVar4;
			fVar1 = param_4[1];
		}
		fVar3 = FUN_0048e540(SUB84((double)(fVar1 + param_3[1]),0),
												 (uint)((ulonglong)(double)(fVar1 + param_3[1]) >> 0x20));
		lVar4 = __ftol(fVar3);
		local_14 = (undefined4)lVar4;
	}
	if ((*(byte *)&bitmap->flags & 2) == 0) {
		lpDDBltFx = 0x1000000;
	}
	else {
		lpDDBltFx = 0x1008000;
	}
	(*globals::g_IDirectDrawSurface4_DrawTarget->lpVtbl->Blt)
						(globals::g_IDirectDrawSurface4_DrawTarget,
						 (LPRECT)(-(uint)(param_3 != NULL) & (uint)&local_20),bitmap->ddSurface,
						 (LPRECT)(-(uint)(param_2 != NULL) & (uint)&local_10),lpDDBltFx,(void *)lpDDBltFx);
	return;
}



void * __cdecl lego::image::Image_Lock(ImageBMP *image,uint *out_length,uint *out_bitsPerPixel)
{
	DDSURFACEDESC2 *pDVar1;
	HRESULT HVar2;
	int iVar3;
	undefined4 unaff_EDI;
	DDSURFACEDESC2 s;
	
	pDVar1 = &s;
	for (iVar3 = 0x1f; iVar3 != 0; iVar3 += -1) {
		*(undefined4 *)pDVar1 = 0;
		pDVar1 = (DDSURFACEDESC2 *)((int)pDVar1 + 4);
	}
	s.dwSize = 0x7c;
	HVar2 = (*image->ddSurface->lpVtbl->Lock)(image->ddSurface,NULL,&s,1,NULL);
	if (HVar2 == 0) {
		*(undefined4 *)s.ddsCaps.dwCaps3 = unaff_EDI;
		*(DWORD *)s.ddsCaps.dwCaps4_VolumeDepth = s.ddckCKSrcBlt.dwColorSpaceLowValue;
		return (void *)s.lPitch_dwLinearSize;
	}
	return NULL;
}



void __cdecl lego::image::Image_Unlock(ImageBMP *image)
{
	(*image->ddSurface->lpVtbl->Unlock)(image->ddSurface,NULL);
	return;
}



uint __cdecl lego::image::Image_GetLastColor24(ImageBMP *image)
{
	uint uVar1;
	int iVar2;
	DDPIXELFORMAT *pDVar3;
	DDPIXELFORMAT pixelFmt;
	
	pDVar3 = &pixelFmt;
	for (iVar2 = 8; iVar2 != 0; iVar2 += -1) {
		pDVar3->dwSize = 0;
		pDVar3 = (DDPIXELFORMAT *)&pDVar3->dwFlags;
	}
	pixelFmt.dwSize = 0x20;
	uVar1 = (*image->ddSurface->lpVtbl->GetPixelFormat)(image->ddSurface,&pixelFmt);
	if (uVar1 == 0) {
		uVar1 = CONCAT13(*(undefined *)&image->lastColor24,
										 CONCAT12(*(undefined *)((int)&image->lastColor24 + 1),
															CONCAT11(*(undefined *)((int)&image->lastColor24 + 2),
																			 *(undefined *)((int)&image->lastColor24 + 3))));
	}
	return uVar1;
}



uint __cdecl lego::image::Image_GetUpperBitMask(ImageBMP *image)
{
	DDPIXELFORMAT *pDVar1;
	HRESULT HVar2;
	int iVar3;
	DDPIXELFORMAT pixelFmt;
	
	pDVar1 = &pixelFmt;
	for (iVar3 = 8; iVar3 != 0; iVar3 += -1) {
		*(undefined4 *)pDVar1 = 0;
		pDVar1 = (DDPIXELFORMAT *)((int)pDVar1 + 4);
	}
	pixelFmt.dwSize = 0x20;
	HVar2 = (*image->ddSurface->lpVtbl->GetPixelFormat)(image->ddSurface,&pixelFmt);
	if (HVar2 == 0) {
		return -1 << (0x20U - (char)pixelFmt.dwFlags & 0x1f);
	}
	return 0;
}



BOOL __cdecl lego::image::Image_FUN_0047e260(ImageBMP *image,int param_2,int param_3)
{
	HRESULT HVar1;
	int iVar2;
	int unaff_EBX;
	DDSURFACEDESC2 *pDVar3;
	DDSURFACEDESC2 local_7c;
	
	pDVar3 = &local_7c;
	for (iVar2 = 0x1f; iVar2 != 0; iVar2 += -1) {
		pDVar3->dwSize = 0;
		pDVar3 = (DDSURFACEDESC2 *)&pDVar3->dwFlags;
	}
	local_7c.dwSize = 0x7c;
	if (((uint)param_2 < (uint)image->width) && ((uint)param_3 < (uint)image->height)) {
		HVar1 = (*image->ddSurface->lpVtbl->Lock)(image->ddSurface,NULL,&local_7c,0x11,NULL);
		if (HVar1 == 0) {
			*(uint *)local_7c.dwTextureStage =
					 *(uint *)((local_7c.ddckCKSrcBlt.dwColorSpaceLowValue >> 3) * param_2 +
										local_7c.lPitch_dwLinearSize + unaff_EBX * param_3) >>
					 (0x20U - (char)local_7c.ddckCKSrcBlt.dwColorSpaceLowValue & 0x1f);
			(*image->ddSurface->lpVtbl->Unlock)(image->ddSurface,NULL);
			return 1;
		}
	}
	return 0;
}



int ** __cdecl
lego::pool::ReservedPool_ImageBMP___NextImage
					(int *directDrawSurface4,int width,int height,uint firstColor,uint lastColor)
{
	void *pvVar1;
	void *pvVar2;
	uint uVar3;
	
	if (globals::ReservedPool_ImageBMP___g_NEXT == NULL) {
		ReservedPool_ImageBMP___Alloc();
	}
	pvVar1 = globals::ReservedPool_ImageBMP___g_NEXT;
	pvVar2 = *(void **)((int)globals::ReservedPool_ImageBMP___g_NEXT + 0x1c);
	*(void **)((int)globals::ReservedPool_ImageBMP___g_NEXT + 0x1c) =
			 globals::ReservedPool_ImageBMP___g_NEXT;
	globals::ReservedPool_ImageBMP___g_NEXT = pvVar2;
	*(undefined4 *)((int)pvVar1 + 0x18) = 0;
	*(int *)((int)pvVar1 + 4) = width;
	*(int *)((int)pvVar1 + 8) = height;
	*(int **)pvVar1 = directDrawSurface4;
	*(uint *)((int)pvVar1 + 0x14) = firstColor;
	uVar3 = image::unpackNativeRGB((IDirectDrawSurface4 *)directDrawSurface4,firstColor);
	*(uint *)((int)pvVar1 + 0xc) = uVar3;
	uVar3 = image::unpackNativeRGB((IDirectDrawSurface4 *)directDrawSurface4,lastColor);
	*(uint *)((int)pvVar1 + 0x10) = uVar3;
	return (int **)pvVar1;
}



void __cdecl lego::pool::ReservedPool_ImageBMP___Alloc(void)
{
	void *pvVar1;
	void *pvVar2;
	int iVar3;
	uint uVar4;
	
	uVar4 = 1 << ((byte)globals::ReservedPool_ImageBMP___g_COUNT & 0x1f);
	pvVar2 = std::malloc(uVar4 * 0x20);
	globals::ReservedPool_ImageBMP___g_TABLE[globals::ReservedPool_ImageBMP___g_COUNT] = pvVar2;
	pvVar2 = globals::ReservedPool_ImageBMP___g_TABLE[globals::ReservedPool_ImageBMP___g_COUNT];
	if (pvVar2 != NULL) {
		globals::ReservedPool_ImageBMP___g_COUNT += 1;
		if (1 < uVar4) {
			iVar3 = uVar4 - 1;
			pvVar1 = pvVar2;
			do {
				*(void **)((int)pvVar1 + 0x1c) = (void *)((int)pvVar1 + 0x20);
				iVar3 += -1;
				pvVar1 = (void *)((int)pvVar1 + 0x20);
			} while (iVar3 != 0);
		}
		*(void **)((int)pvVar2 + (uVar4 * 0x20 - 4)) = globals::ReservedPool_ImageBMP___g_NEXT;
		globals::ReservedPool_ImageBMP___g_NEXT = pvVar2;
	}
	return;
}



void __cdecl lego::image::Image_Cleanup_FUN_0047e3f0(void)
{
	int iVar1;
	ImageBMP *image;
	void **ppvVar2;
	uint uVar3;
	int iVar4;
	
	uVar3 = 0;
	if (pool::globals::ReservedPool_ImageBMP___g_COUNT != 0) {
		ppvVar2 = pool::globals::ReservedPool_ImageBMP___g_TABLE;
		do {
			if ((*ppvVar2 != NULL) && (iVar1 = 1 << ((byte)uVar3 & 0x1f), iVar1 != 0)) {
				iVar4 = 0;
				do {
					image = (ImageBMP *)((int)*ppvVar2 + iVar4);
					if ((image != NULL) && (image->pool_m_next == image)) {
						pool::ReservedPool_ImageBMP___Release(image);
					}
					iVar4 += 0x20;
					iVar1 += -1;
				} while (iVar1 != 0);
			}
			uVar3 += 1;
			ppvVar2 = ppvVar2 + 1;
		} while (uVar3 < pool::globals::ReservedPool_ImageBMP___g_COUNT);
	}
	return;
}



uint __cdecl lego::image::unpackNativeRGB(IDirectDrawSurface4 *ddSurface,uint rgbColor)
{
	byte bVar1;
	HRESULT HVar2;
	int iVar3;
	int iVar5;
	uint unaff_ESI;
	uint uVar6;
	DWORD *pDVar7;
	DDSURFACEDESC2 *lpDDSurfaceDesc;
	char cVar8;
	char cVar9;
	byte out_red;
	byte out_blue;
	byte out_green;
	DDSURFACEDESC2 s;
	int iVar4;
	
	pDVar7 = &s.dwFlags;
	for (iVar5 = 0x1e; iVar5 != 0; iVar5 += -1) {
		*pDVar7 = 0;
		pDVar7 = pDVar7 + 1;
	}
	uVar6 = 0;
	s.dwSize = 0x7c;
	unpackRGB(rgbColor,&out_red,&out_green,&out_blue);
	lpDDSurfaceDesc = &s;
	HVar2 = (*ddSurface->lpVtbl->Lock)(ddSurface,NULL,lpDDSurfaceDesc,1,NULL);
	if (HVar2 == 0) {
		iVar5 = countBits(s.ddckCKSrcBlt.dwColorSpaceHighValue);
		iVar3 = countBits(s.ddpfPixelFormat.dwSize);
		cVar8 = (char)iVar3;
		iVar3 = countBits(s.ddpfPixelFormat.dwFlags);
		cVar9 = (char)iVar3;
		iVar3 = firstBit(s.ddckCKSrcBlt.dwColorSpaceHighValue);
		iVar4 = firstBit(s.ddpfPixelFormat.dwSize);
		bVar1 = (byte)iVar4;
		iVar4 = firstBit(s.ddpfPixelFormat.dwFlags);
		uVar6 = ((_out_red & 0xff) >> (8U - cVar8 & 0x1f)) << (bVar1 & 0x1f) |
						(((uint)lpDDSurfaceDesc & 0xff) >> (8U - (char)iVar5 & 0x1f)) << ((byte)iVar3 & 0x1f) |
						((unaff_ESI & 0xff) >> (8U - cVar9 & 0x1f)) << ((byte)iVar4 & 0x1f);
		if (s.ddckCKSrcBlt.dwColorSpaceLowValue < 0x20) {
			uVar6 &= (1 << ((byte)s.ddckCKSrcBlt.dwColorSpaceLowValue & 0x1f)) - 1U;
		}
		(**(code **)(*(int *)s.ddsCaps.dwCaps2 + 0x80))(s.ddsCaps.dwCaps2,0);
	}
	return uVar6;
}



void __cdecl lego::image::unpackRGB(uint rgbColor,byte *out_red,byte *out_green,byte *out_blue)
{
	if (out_red != NULL) {
		*out_red = (byte)rgbColor;
	}
	if (out_green != NULL) {
		*out_green = (byte)(rgbColor >> 8);
	}
	if (out_blue != NULL) {
		*out_blue = rgbColor._2_1_;
	}
	return;
}



// WARNING: Restarted to delay deadcode elimination for space: stack

void __cdecl lego::image::Image_CreateCapture(ImageBMP *image,int captureWidth,int captureHeight)
{
	HRESULT result;
	int iVar1;
	DDSURFACEDESC2 *pDVar2;
	IDirectDrawSurface4 *directDrawSurface;
	IDirectDrawSurface4 *local_90;
	tagRECT local_8c;
	DDSURFACEDESC2 local_7c;
	
	pDVar2 = &local_7c;
	for (iVar1 = 0x1f; iVar1 != 0; iVar1 += -1) {
		pDVar2->dwSize = 0;
		pDVar2 = (DDSURFACEDESC2 *)&pDVar2->dwFlags;
	}
	local_7c.dwSize = 0x7c;
	local_7c.dwWidth = captureWidth;
	local_7c.dwHeight = captureHeight;
	local_7c.ddsCaps.dwCaps = 0x840;
	local_7c.dwFlags = 7;
	result = (*globals::g_IDirectDraw4->lpVtbl->CreateSurface)
										 (globals::g_IDirectDraw4,&local_7c,&local_90,NULL);
	if (result != 0) {
		directx::D3DError(result,3,"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Images.c",1140);
		return;
	}
	local_8c.left = 0;
	local_8c.top = 0;
	local_8c.right = captureWidth;
	local_8c.bottom = captureHeight;
	directDrawSurface = globals::g_IDirectDrawSurface4_DrawTarget;
	(*local_90->lpVtbl->Blt)
						(local_90,(LPRECT)&local_8c,globals::g_IDirectDrawSurface4_DrawTarget,NULL,0,NULL);
	pool::ReservedPool_ImageBMP___NextCapture
						((ImageBMP *)local_7c.ddsCaps.dwCaps,(IUnknown *)directDrawSurface,captureWidth,
						 captureHeight,0,0);
	return;
}



void __cdecl
lego::pool::ReservedPool_ImageBMP___NextCapture
					(ImageBMP *image,IUnknown *directDrawSurface,int width,int height,uint firstColor,
					uint lastColor)
{
	uint uVar1;
	
	if (globals::ReservedPool_ImageBMP___g_NEXT == NULL) {
		ReservedPool_ImageBMP___Alloc();
	}
	image->width = width;
	image->pool_m_next = image;
	image->flags = 0;
	image->height = height;
	image->ddSurface = (IDirectDrawSurface4 *)directDrawSurface;
	image->firstColorNative = firstColor;
	uVar1 = lego::image::unpackNativeRGB((IDirectDrawSurface4 *)directDrawSurface,firstColor);
	image->firstColor24 = uVar1;
	uVar1 = lego::image::unpackNativeRGB((IDirectDrawSurface4 *)directDrawSurface,lastColor);
	image->lastColor24 = uVar1;
	return;
}



void __cdecl FUN_0047e700(int **param_1,char *param_2)
{
	lego::image::Image_FUN_0047cbb0(*param_1,param_2);
	return;
}



undefined4 * __thiscall FUN_0047e720(void *this,byte param_1)
{
	FUN_0047e740((undefined4 *)this);
	if ((param_1 & 1) != 0) {
		FUN_0045ddb0((undefined *)this);
	}
	return (undefined4 *)this;
}



void __fastcall FUN_0047e740(undefined4 *param_1)
{
	int *piVar1;
	
	*param_1 = &PTR_FUN_0049f9a0;
	piVar1 = (int *)param_1[6];
	if (piVar1 != NULL) {
		(**(code **)(*piVar1 + 8))(piVar1);
		param_1[6] = 0;
	}
	piVar1 = (int *)param_1[4];
	if (piVar1 != NULL) {
		(**(code **)(*piVar1 + 8))(piVar1);
		param_1[4] = 0;
	}
	return;
}



undefined4 * __thiscall FUN_0047e780(void *this,int param_1,int param_2,int param_3,char param_4)
{
	uint uVar1;
	
	*(undefined4 *)((int)this + 4) = 0;
	*(undefined *)((int)this + 0x15) = 0;
	*(undefined *)((int)this + 0x16) = 0;
	*(undefined4 *)((int)this + 0x18) = 0;
	*(undefined *)((int)this + 0x17) = 0;
	*(undefined ***)this = &PTR_FUN_0049f9a0;
	FUN_0047e9d0((int)this);
	uVar1 = FUN_0047e7d0(this,param_1,param_2,param_3,param_4);
	if ((char)uVar1 != '\0') {
		*(undefined *)((int)this + 0x17) = 1;
	}
	return (undefined4 *)this;
}



uint __thiscall FUN_0047e7d0(void *this,int param_1,int param_2,int param_3,char param_4)
{
	IDirectDrawSurface4 *This;
	undefined *puVar1;
	int iVar2;
	int iVar3;
	uint uVar4;
	
	uVar4 = *(uint *)((int)this + 0x20) | -(uint)(param_2 != 0) & 2 | -(uint)(param_1 != 0) & 4 | 1;
	*(uint *)((int)this + 0x20) = uVar4;
	*(int *)((int)this + 0xc) = param_3;
	if (param_1 != 0) {
		*(int *)((int)this + 0x28) = param_1;
	}
	if (param_2 != 0) {
		*(int *)((int)this + 0x24) = param_2;
	}
	if ((param_1 == 0) && (param_2 == 0)) {
		*(undefined4 *)((int)this + 0x84) = 0x200;
	}
	else {
		*(undefined4 *)((int)this + 0x84) = 0x40;
		*(uint *)((int)this + 0x84) = (-(uint)(param_4 != '\0') & 0x3800) + 0x840;
	}
	if (param_3 != 0) {
		*(uint *)((int)this + 0x20) = uVar4 | 0x1000;
		*(undefined4 *)((int)this + 100) = 0x20;
		iVar3 = 0x10;
		if (param_3 != 0xf) {
			iVar3 = param_3;
		}
		*(int *)((int)this + 0x70) = iVar3;
		if (param_3 == 0x18) {
			*(undefined4 *)((int)this + 0x74) = 0xff0000;
			*(undefined4 *)((int)this + 0x78) = 0xff00;
			*(undefined4 *)((int)this + 0x7c) = 0xff;
			*(undefined4 *)((int)this + 0x68) = 0x40;
		}
		else {
			if (param_3 == 0x10) {
				*(undefined4 *)((int)this + 0x74) = 0xf800;
				*(undefined4 *)((int)this + 0x78) = 0x7e0;
				*(undefined4 *)((int)this + 0x7c) = 0x1f;
				*(undefined4 *)((int)this + 0x68) = 0x40;
			}
			else {
				if (param_3 == 0xf) {
					*(undefined4 *)((int)this + 0x74) = 0x7c00;
					*(undefined4 *)((int)this + 0x78) = 0x3e0;
					*(undefined4 *)((int)this + 0x7c) = 0x1f;
					*(undefined4 *)((int)this + 0x68) = 0x40;
				}
				else {
					if (param_3 == 8) {
						*(undefined4 *)((int)this + 0x74) = 0xff0000;
						*(undefined4 *)((int)this + 0x78) = 0xff00;
						*(undefined4 *)((int)this + 0x7c) = 0xff;
						*(undefined4 *)((int)this + 0x68) = 0x60;
					}
				}
			}
		}
	}
	uVar4 = (*lego::globals::g_AVIFile_IDirectDraw4->lpVtbl->CreateSurface)
										(lego::globals::g_AVIFile_IDirectDraw4,(DDSURFACEDESC2 *)((int)this + 0x1c),
										 (IDirectDrawSurface4 **)((int)this + 0x18),NULL);
	if (uVar4 == 0) {
		FUN_0047ea20();
		uVar4 = FUN_0047ea70();
		if (*(int *)((int)this + 0x70) != 8) {
LAB_0047e975:
			if (*(int *)((int)this + 0x70) == 0x10) {
				iVar3 = FUN_0047eaa0(*(uint *)((int)this + 0x78));
				iVar2 = FUN_0047eaa0(*(uint *)((int)this + 0x7c));
				uVar4 = FUN_0047eaa0(*(uint *)((int)this + 0x74));
				if (iVar3 + iVar2 + uVar4 == 0xf) {
					*(undefined *)((int)this + 0x16) = 1;
				}
			}
			return CONCAT31((int3)(uVar4 >> 8),1);
		}
		puVar1 = &stack0xfffffbf1;
		iVar3 = 0x100;
		do {
			puVar1[-1] = 0;
			*puVar1 = 0;
			puVar1[1] = 0;
			puVar1[2] = 0;
			puVar1 = puVar1 + 4;
			iVar3 += -1;
		} while (iVar3 != 0);
		uVar4 = (*lego::globals::g_AVIFile_IDirectDraw4->lpVtbl->CreatePalette)
											(lego::globals::g_AVIFile_IDirectDraw4,4,(D3DRMPALETTEENTRY *)&stack0xfffffbf0
											 ,(IDirectDrawPalette **)((int)this + 0x10),NULL);
		if (uVar4 == 0) {
			This = *(IDirectDrawSurface4 **)((int)this + 0x18);
			uVar4 = (*This->lpVtbl->SetPalette)(This,*(IDirectDrawPalette **)((int)this + 0x10));
			if (uVar4 == 0) goto LAB_0047e975;
		}
	}
	return uVar4 & 0xffffff00;
}



void __fastcall FUN_0047e9d0(int param_1)
{
	int iVar1;
	undefined4 *puVar2;
	
	puVar2 = (undefined4 *)(param_1 + 0x1c);
	for (iVar1 = 0x1f; iVar1 != 0; iVar1 += -1) {
		*puVar2 = 0;
		puVar2 = puVar2 + 1;
	}
	*(undefined4 *)(param_1 + 0x1c) = 0x7c;
	*(undefined4 *)(param_1 + 0x18) = 0;
	*(undefined4 *)(param_1 + 0x10) = 0;
	*(undefined *)(param_1 + 8) = 0;
	*(undefined *)(param_1 + 0x14) = 0;
	return;
}



undefined4 __fastcall FUN_0047ea00(int param_1)
{
	return *(undefined4 *)(param_1 + 0x28);
}



undefined4 __fastcall FUN_0047ea10(int param_1)
{
	return *(undefined4 *)(param_1 + 0x24);
}



uint __fastcall FUN_0047ea20(int param_1)
{
	undefined4 *puVar1;
	uint in_EAX;
	uint uVar2;
	int iVar3;
	undefined4 *puVar4;
	
	uVar2 = in_EAX & 0xffffff00;
	if (*(char *)(param_1 + 8) == '\0') {
		puVar1 = (undefined4 *)(param_1 + 0x1c);
		puVar4 = puVar1;
		for (iVar3 = 0x1f; iVar3 != 0; iVar3 += -1) {
			*puVar4 = 0;
			puVar4 = puVar4 + 1;
		}
		iVar3 = **(int **)(param_1 + 0x18);
		*puVar1 = 0x7c;
		uVar2 = (**(code **)(iVar3 + 100))(*(int **)(param_1 + 0x18),0,puVar1,0x801,0);
		if (uVar2 == 0) {
			*(undefined *)(param_1 + 8) = 1;
			return 1;
		}
	}
	return uVar2 & 0xffffff00;
}



uint __fastcall FUN_0047ea70(int param_1)
{
	uint in_EAX;
	uint uVar1;
	
	uVar1 = in_EAX & 0xffffff00;
	if (*(char *)(param_1 + 8) != '\0') {
		uVar1 = (**(code **)(**(int **)(param_1 + 0x18) + 0x80))(*(int **)(param_1 + 0x18),0);
		if (uVar1 == 0) {
			*(undefined *)(param_1 + 8) = 0;
			return 1;
		}
	}
	return uVar1 & 0xffffff00;
}



int FUN_0047eaa0(uint param_1)
{
	int iVar1;
	uint uVar2;
	
	iVar1 = 0;
	uVar2 = 0;
	do {
		if ((param_1 & 1 << ((byte)uVar2 & 0x1f)) != 0) {
			iVar1 += 1;
		}
		uVar2 += 1;
	} while (uVar2 < 0x20);
	return iVar1;
}



undefined4 * __thiscall lego::video::Avi_FUN_0047eac0(void *this,char *param_1)
{
	IUnknown **lplpIAVIStream;
	char *szFile;
	HRESULT HVar1;
	IUnknown *pIVar2;
	DWORD DVar3;
	void *this_00;
	undefined4 *puVar4;
	int iVar5;
	undefined4 *in_FS_OFFSET;
	undefined4 local_c;
	undefined *puStack8;
	undefined4 local_4;
	
	local_c = *in_FS_OFFSET;
	local_4 = 0xffffffff;
	puStack8 = &LAB_0049e08b;
	*in_FS_OFFSET = &local_c;
	*(undefined *)((int)this + 0x98) = 0;
	*(undefined *)((int)this + 0x99) = 0;
	*(undefined4 *)((int)this + 0xc0) = 0;
	*(undefined ***)this = &PTR_FUN_0049f9b0;
	szFile = lego::file::Path_JoinDataDir(param_1);
	lplpIAVIStream = (IUnknown **)((int)this + 4);
	*(undefined4 *)((int)this + 8) = 0;
	*lplpIAVIStream = NULL;
	puVar4 = (undefined4 *)((int)this + 0xc);
	for (iVar5 = 0x23; iVar5 != 0; iVar5 += -1) {
		*puVar4 = 0;
		puVar4 = puVar4 + 1;
	}
	*(undefined4 *)((int)this + 0xa0) = 0;
	*(undefined4 *)((int)this + 0xa8) = 0;
	*(undefined4 *)((int)this + 0x9c) = 0;
	*(undefined4 *)((int)this + 0xa4) = 0;
	if (DAT_00534998 == '\0') {
		HVar1 = AVIStreamOpenFromFileA(lplpIAVIStream,szFile,1935960438,0,0,NULL);
		if (HVar1 == 0) {
			pIVar2 = AVIStreamGetFrameOpen(*lplpIAVIStream,(BITMAPINFOHEADER *)0x1);
			*(IUnknown **)((int)this + 8) = pIVar2;
			if (pIVar2 != NULL) {
				HVar1 = AVIStreamInfoA(*lplpIAVIStream,(void *)((int)this + 0xc),0x8c);
				if (HVar1 == 0) {
					DVar3 = timeGetTime();
					*(undefined4 *)((int)this + 0xa0) = *(undefined4 *)((int)this + 0x44);
					*(undefined *)((int)this + 0x99) = 1;
					*(undefined4 *)((int)this + 0xb8) = 0;
					*(undefined4 *)((int)this + 0xa8) = *(undefined4 *)((int)this + 0x4c);
					*(undefined4 *)((int)this + 0x9c) = *(undefined4 *)((int)this + 0x40);
					*(undefined4 *)((int)this + 0xa4) = *(undefined4 *)((int)this + 0x48);
					*(float *)((int)this + 0xac) = (float)(ulonglong)DVar3 * 0.001;
					this_00 = Avi__malloc_inernal(0x98);
					local_4 = 0;
					if (this_00 == NULL) {
						puVar4 = NULL;
					}
					else {
						puVar4 = FUN_0047e780(this_00,*(int *)((int)this + 0xa4) - *(int *)((int)this + 0x9c),
																	*(int *)((int)this + 0xa8) - *(int *)((int)this + 0xa0),0,'\0');
					}
					*(undefined4 **)((int)this + 0xc0) = puVar4;
				}
			}
		}
	}
	*in_FS_OFFSET = local_c;
	return (undefined4 *)this;
}



undefined4 * __thiscall FUN_0047ec40(void *this,byte param_1)
{
	FUN_0047ec60((undefined4 *)this);
	if ((param_1 & 1) != 0) {
		FUN_0045ddb0((undefined *)this);
	}
	return (undefined4 *)this;
}



void __fastcall FUN_0047ec60(undefined4 *param_1)
{
	*param_1 = &PTR_FUN_0049f9b0;
	if (DAT_00534998 == '\0') {
		if ((IUnknown *)param_1[1] != NULL) {
			AVIStreamRelease((IUnknown *)param_1[1]);
		}
		if ((code **)param_1[0x30] != NULL) {
			(***(code ***)(code **)param_1[0x30])(1);
		}
	}
	return;
}



void __thiscall FUN_0047eca0(void *this,int *param_1)
{
	uint uVar1;
	bool bVar2;
	char cVar3;
	int iVar4;
	int iVar5;
	uint uVar6;
	int iVar7;
	undefined4 *puVar8;
	int iVar9;
	undefined4 *puVar10;
	int iVar11;
	undefined4 *puVar12;
	undefined4 *puVar13;
	
	bVar2 = false;
	iVar11 = *(int *)((int)this + 0xc0);
	if ((*(char *)(iVar11 + 8) == '\0') && (cVar3 = FUN_0047ea20(), cVar3 != '\0')) {
		bVar2 = true;
	}
	puVar10 = *(undefined4 **)(iVar11 + 0x40);
	iVar9 = *(int *)((int)this + 0xa4) - *(int *)((int)this + 0x9c);
	iVar11 = *(int *)((int)this + 0xc0);
	iVar5 = *(int *)((int)this + 0xa8) - *(int *)((int)this + 0xa0);
	iVar4 = *(int *)(iVar11 + 0x2c) / 2;
	iVar7 = 0xf;
	if (*(char *)(iVar11 + 0x16) == '\0') {
		iVar7 = *(int *)(iVar11 + 0x70);
	}
	if (iVar7 == 0xf) {
		puVar8 = (undefined4 *)((int)param_1 + *param_1 + (iVar5 + -1) * iVar4 * 2);
		if (0 < iVar5) {
			uVar1 = iVar9 * 2;
			do {
				puVar12 = puVar8;
				puVar13 = puVar10;
				for (uVar6 = uVar1 >> 2; uVar6 != 0; uVar6 -= 1) {
					*puVar13 = *puVar12;
					puVar12 = puVar12 + 1;
					puVar13 = puVar13 + 1;
				}
				for (uVar6 = uVar1 & 3; uVar6 != 0; uVar6 -= 1) {
					*(undefined *)puVar13 = *(undefined *)puVar12;
					puVar12 = (undefined4 *)((int)puVar12 + 1);
					puVar13 = (undefined4 *)((int)puVar13 + 1);
				}
				puVar8 = (undefined4 *)((int)puVar8 + iVar4 * -2);
				puVar10 = (undefined4 *)((int)puVar10 + iVar4 * 2);
				iVar5 += -1;
			} while (iVar5 != 0);
		}
	}
	else {
		if (*(char *)(iVar11 + 0x16) == '\0') {
			iVar11 = *(int *)(iVar11 + 0x70);
		}
		else {
			iVar11 = 0xf;
		}
		if ((iVar11 == 0x10) &&
			 (puVar8 = (undefined4 *)((int)param_1 + *param_1 + (iVar5 + -1) * iVar4 * 2), 0 < iVar5)) {
			uVar1 = iVar9 * 2;
			do {
				puVar12 = puVar8;
				puVar13 = puVar10;
				for (uVar6 = uVar1 >> 2; uVar6 != 0; uVar6 -= 1) {
					*puVar13 = *puVar12;
					puVar12 = puVar12 + 1;
					puVar13 = puVar13 + 1;
				}
				for (uVar6 = uVar1 & 3; uVar6 != 0; uVar6 -= 1) {
					*(undefined *)puVar13 = *(undefined *)puVar12;
					puVar12 = (undefined4 *)((int)puVar12 + 1);
					puVar13 = (undefined4 *)((int)puVar13 + 1);
				}
				puVar8 = (undefined4 *)((int)puVar8 + iVar4 * -2);
				puVar10 = (undefined4 *)((int)puVar10 + iVar4 * 2);
				iVar5 += -1;
			} while (iVar5 != 0);
		}
	}
	if (bVar2) {
		FUN_0047ea70();
	}
	return;
}



undefined4 __fastcall FUN_0047ede0(void *param_1)
{
	int *piVar1;
	DWORD DVar2;
	float10 fVar3;
	longlong lVar4;
	
	if (*(char *)((int)param_1 + 0x99) == '\0') {
		return 0;
	}
	if (DAT_00534998 != '\0') {
		return 0;
	}
	piVar1 = (int *)AVIStreamGetFrame(*(IUnknown **)((int)param_1 + 8),*(LONG *)((int)param_1 + 0xb8))
	;
	if (piVar1 != NULL) {
		FUN_0047eca0(param_1,piVar1);
		DVar2 = timeGetTime();
		fVar3 = (float10)(ulonglong)*(uint *)((int)param_1 + 0x24) /
						(float10)(ulonglong)*(uint *)((int)param_1 + 0x20);
		*(float *)((int)param_1 + 0xb4) = (float)fVar3;
		*(float *)((int)param_1 + 0xb0) = (float)((float10)(ulonglong)DVar2 * (float10)0.001);
		lVar4 = __ftol(((float10)(ulonglong)DVar2 * (float10)0.001 -
									 (float10)*(float *)((int)param_1 + 0xac)) * fVar3);
		*(int *)((int)param_1 + 0xb8) = (int)lVar4;
	}
	return 1;
}



void __thiscall FUN_0047eeb0(void *this,undefined4 param_1)
{
	DWORD DVar1;
	
	if (DAT_00534998 == '\0') {
		*(undefined4 *)((int)this + 0xb8) = param_1;
		DVar1 = timeGetTime();
		*(float *)((int)this + 0xb0) = (float)(ulonglong)DVar1 * 0.001;
		*(float *)((int)this + 0xac) =
				 (float)(ulonglong)DVar1 * 0.001 -
				 (float)(ulonglong)*(uint *)((int)this + 0xb8) / *(float *)((int)this + 0xb4);
	}
	return;
}



void __cdecl lego::avi::InitAVIFile(IDirectDraw4 *ddraw)
{
	globals::g_AVIFile_IDirectDraw4 = ddraw;
										// WARNING: Could not recover jumptable at 0x0049b9ac. Too many branches
										// WARNING: Treating indirect jump as call
	AVIFileInit();
	return;
}



undefined4 * __cdecl lego::video::Avi_FUN_0047ef50(char *param_1)
{
	void *this;
	undefined4 *puVar1;
	undefined4 *in_FS_OFFSET;
	undefined4 local_c;
	undefined *puStack8;
	undefined4 local_4;
	
	local_4 = 0xffffffff;
	puStack8 = &LAB_0049e0ab;
	local_c = *in_FS_OFFSET;
	*in_FS_OFFSET = &local_c;
	this = Avi__malloc_inernal(0xc4);
	local_4 = 0;
	if (this != NULL) {
		puVar1 = Avi_FUN_0047eac0(this,param_1);
		*in_FS_OFFSET = local_c;
		return puVar1;
	}
	*in_FS_OFFSET = local_c;
	return NULL;
}



uint FUN_0047efb0(undefined4 param_1)
{
	uint uVar1;
	
	uVar1 = FUN_0047ede0();
	return uVar1 & 0xff;
}



void __cdecl FUN_0047efc0(int param_1,LPRECT param_2)
{
	IDirectDrawSurface4 *lpDDSrcSurface;
	IDirectDrawSurface4 *This;
	
	if (*(char *)(param_1 + 0x99) != '\0') {
		lpDDSrcSurface = *(IDirectDrawSurface4 **)(*(int *)(param_1 + 0xc0) + 0x18);
		This = lego::draw::Draw_GetDrawingSurface();
		(*This->lpVtbl->Blt)(This,param_2,lpDDSrcSurface,NULL,0x1000000,NULL);
	}
	return;
}



void __cdecl FUN_0047f000(void *param_1,undefined4 param_2)
{
	FUN_0047eeb0(param_1,param_2);
	return;
}



uint __cdecl FUN_0047f010(int param_1)
{
	return ~-(uint)(DAT_00534998 != '\0') & *(uint *)(param_1 + 0xb8);
}



undefined4 __cdecl FUN_0047f020(int param_1)
{
	if (DAT_00534998 != '\0') {
		return 0;
	}
	return *(undefined4 *)(param_1 + 0x2c);
}



void __cdecl FUN_0047f030(undefined **param_1)
{
	if (param_1 != NULL) {
		(**(code **)*param_1)(1);
	}
	return;
}



uint __cdecl FUN_0047f040(int param_1)
{
	return (uint)*(byte *)(param_1 + 0x99);
}



BOOL __cdecl lego::main::Main_DirectInputCreate(void)
{
	HRESULT HVar1;
	int iVar2;
	char *pcVar3;
	undefined4 uVar8;
	GUID guidSysKeyboard;
	
										// GUID_SysKeyboard {6F1D2B61-D5A0-11CF-BFC7-444553540000}
	guidSysKeyboard._4_4_ = 0x11cfd5a0;
	guidSysKeyboard._0_4_ = 0x6f1d2b61;
	guidSysKeyboard._8_4_ = 0x4544c7bf;
	guidSysKeyboard._12_4_ = 0x5453;
	HVar1 = DirectInputCreateA(globals::wnd::g_hInstance,0x500,(IUnknown **)&globals::g_IDirectInputA,
														 NULL);
	if (HVar1 != 0) {
		uVar8 = 118;
		pcVar3 = "C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Input.c";
		iVar2 = 2;
		HVar1 = DirectInputCreateA(globals::wnd::g_hInstance,0x500,
															 (IUnknown **)&globals::g_IDirectInputA,NULL);
		directx::D3DError(HVar1,iVar2,pcVar3,uVar8);
		return 0;
	}
	HVar1 = (*globals::g_IDirectInputA->lpVtbl->CreateDevice)
										(globals::g_IDirectInputA,(LPGUID)&guidSysKeyboard,
										 &globals::g_IDirectInputDeviceA,NULL);
	if (HVar1 != 0) {
		uVar8 = 121;
		pcVar3 = "C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Input.c";
		iVar2 = 2;
		HVar1 = (*globals::g_IDirectInputA->lpVtbl->CreateDevice)
											(globals::g_IDirectInputA,(LPGUID)&guidSysKeyboard,
											 &globals::g_IDirectInputDeviceA,NULL);
		directx::D3DError(HVar1,iVar2,pcVar3,uVar8);
		return 0;
	}
	HVar1 = (*globals::g_IDirectInputDeviceA->lpVtbl->SetDataFormat)
										(globals::g_IDirectInputDeviceA,&idl::c_dfDIKeyboard);
	if (HVar1 != 0) {
		uVar8 = 124;
		pcVar3 = "C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Input.c";
		iVar2 = 2;
		HVar1 = (*globals::g_IDirectInputDeviceA->lpVtbl->SetDataFormat)
											(globals::g_IDirectInputDeviceA,&idl::c_dfDIKeyboard);
		directx::D3DError(HVar1,iVar2,pcVar3,uVar8);
		return 0;
	}
										// DISCL_FOREGROUND | DISCL_NONEXCLUSIVE (0x4 | 0x2)
	HVar1 = (*globals::g_IDirectInputDeviceA->lpVtbl->SetCooperativeLevel)
										(globals::g_IDirectInputDeviceA,globals::wnd::g_hWnd,6);
	if (HVar1 != 0) {
		uVar8 = 127;
		pcVar3 = "C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Input.c";
		iVar2 = 2;
										// DISCL_FOREGROUND | DISCL_NONEXCLUSIVE (0x4 | 0x2)
		HVar1 = (*globals::g_IDirectInputDeviceA->lpVtbl->SetCooperativeLevel)
											(globals::g_IDirectInputDeviceA,globals::wnd::g_hWnd,6);
		directx::D3DError(HVar1,iVar2,pcVar3,uVar8);
		return 0;
	}
	HVar1 = (*globals::g_IDirectInputDeviceA->lpVtbl->Acquire)(globals::g_IDirectInputDeviceA);
	globals::g_IsDirectInputAcquired = (uint)(HVar1 == 0);
	return 1;
}



void __cdecl lego::input::Input_UpdateKeyboardState(void)
{
	IDirectInputDeviceA *This;
	HRESULT HVar1;
	int iVar2;
	undefined4 *puVar3;
	undefined4 *puVar4;
	
	This = globals::g_IDirectInputDeviceA;
	iVar2 = 1;
	if (((byte)globals::g_CMDLINE_FLAGS & CMD_FULLSCREEN) == 0) {
		iVar2 = globals::wnd::g_IsFocused;
	}
	if (iVar2 == 0) {
		puVar3 = (undefined4 *)globals::g_KeyboardState_Current_TABLE;
		for (iVar2 = 0x40; iVar2 != 0; iVar2 += -1) {
			*puVar3 = 0;
			puVar3 = puVar3 + 1;
		}
		puVar3 = (undefined4 *)globals::g_KeyboardState_Previous_TABLE;
		for (iVar2 = 0x40; iVar2 != 0; iVar2 += -1) {
			*puVar3 = 0;
			puVar3 = puVar3 + 1;
		}
		(*globals::g_IDirectInputDeviceA->lpVtbl->Unacquire)(globals::g_IDirectInputDeviceA);
		return;
	}
	if (globals::g_IDirectInputDeviceA != NULL) {
		if (globals::g_IsDirectInputAcquired == 0) {
			iVar2 = -0x7ff8ffe2;
		}
		else {
			puVar3 = (undefined4 *)globals::g_KeyboardState_Current_TABLE;
			puVar4 = (undefined4 *)globals::g_KeyboardState_Previous_TABLE;
			for (iVar2 = 0x40; iVar2 != 0; iVar2 += -1) {
				*puVar4 = *puVar3;
				puVar3 = puVar3 + 1;
				puVar4 = puVar4 + 1;
			}
			puVar3 = (undefined4 *)globals::g_KeyboardState_Current_TABLE;
			for (iVar2 = 0x40; iVar2 != 0; iVar2 += -1) {
				*puVar3 = 0;
				puVar3 = puVar3 + 1;
			}
			iVar2 = (*This->lpVtbl->GetDeviceState)(This,0x100,globals::g_KeyboardState_Current_TABLE);
		}
		if (iVar2 != 0) {
			globals::g_IsDirectInputAcquired = 0;
			HVar1 = (*globals::g_IDirectInputDeviceA->lpVtbl->Acquire)(globals::g_IDirectInputDeviceA);
			if (HVar1 == 0) {
				globals::g_IsDirectInputAcquired = 1;
			}
		}
	}
	return;
}



int __cdecl lego::input::Input_GetNumKeysPressed(void)
{
	int iVar1;
	byte *pbVar2;
	int iVar3;
	
	iVar1 = 0;
	pbVar2 = globals::g_KeyboardState_Current_TABLE;
	iVar3 = 0x100;
	do {
		if (*pbVar2 != 0) {
			iVar1 += 1;
		}
		pbVar2 = pbVar2 + 1;
		iVar3 += -1;
	} while (iVar3 != 0);
	return iVar1;
}



void __cdecl lego::input::Input_DirectInputCleanup(void)
{
	if (globals::g_IsDirectInputAcquired != 0) {
		(*globals::g_IDirectInputDeviceA->lpVtbl->Unacquire)(globals::g_IDirectInputDeviceA);
		globals::g_IsDirectInputAcquired = 0;
	}
	if (globals::g_IDirectInputDeviceA != NULL) {
		(*globals::g_IDirectInputDeviceA->lpVtbl->Release)((IUnknown *)globals::g_IDirectInputDeviceA);
	}
	if (globals::g_IDirectInputA != NULL) {
		(*globals::g_IDirectInputA->lpVtbl->Release)((IUnknown *)globals::g_IDirectInputA);
	}
	return;
}



void __cdecl lego::input::Input_UpdateMousePosition(void)
{
	BOOL BVar1;
	tagPOINT clientPos;
	tagPOINT mousePos;
	tagRECT clientRect;
	
	BVar1 = GetClientRect(globals::wnd::g_hWnd,(LPRECT)&clientRect);
	if (BVar1 != 0) {
		clientPos.y = 0;
		clientPos.x = 0;
		ClientToScreen(globals::wnd::g_hWnd,(LPPOINT)&clientPos);
		GetCursorPos((LPPOINT)&mousePos);
		mousePos.x -= clientPos.x;
		mousePos.y -= clientPos.y;
		if (globals::g_RESOLUTION.width <= mousePos.x) {
			mousePos.x = globals::g_RESOLUTION.width + -1;
		}
		if (globals::g_RESOLUTION.height <= mousePos.y) {
			mousePos.y = globals::g_RESOLUTION.height + -1;
		}
		if (mousePos.x < 0) {
			mousePos.x = 0;
		}
		if (mousePos.y < 0) {
			mousePos.y = 0;
		}
		globals::g_MouseDeltaPosition.x = mousePos.x - globals::g_MousePosition.x;
		globals::g_MouseDeltaPosition.y = mousePos.y - globals::g_MousePosition.y;
		globals::g_MousePosition.x = mousePos.x;
		globals::g_MousePosition.y = mousePos.y;
	}
	return;
}



void __cdecl lego::input::Input_SetMousePosition(int x,int y)
{
	tagPOINT client;
	
	client.y = 0;
	client.x = 0;
	ClientToScreen(globals::wnd::g_hWnd,(LPPOINT)&client);
	globals::g_MousePosition.y = y;
	globals::g_MousePosition.x = x;
	globals::g_MouseDeltaPosition.x = 0;
	globals::g_MouseDeltaPosition.y = 0;
	SetCursorPos(client.x + x,client.y + y);
	return;
}



// WARNING: Could not reconcile some variable overlaps

void __cdecl lego::file::InitFileSystem(char *gamename,BOOL insistOnCD,char *regKey)
{
	char cVar1;
	bool bVar2;
	int iVar3;
	BOOL BVar4;
	HANDLE handle;
	FILE *pFVar5;
	uint uVar6;
	uint uVar7;
	undefined4 *puVar8;
	char *pcVar9;
	char *pcVar10;
	char *pcVar11;
	undefined4 *puVar12;
	undefined4 local_f24;
	char currentDir [260];
	_finddata32_t fileinfo;
	char dataDir [260];
	char errorMessage [1024];
	char cdkeyFile [1024];
	char regValue [1024];
	
	bVar2 = false;
	local_f24 = 0;
	std::_getcwd(currentDir,MAX_PATH);
	uVar6 = 0xffffffff;
	pcVar10 = currentDir;
	do {
		if (uVar6 == 0) break;
		uVar6 -= 1;
		cVar1 = *pcVar10;
		pcVar10 = pcVar10 + 1;
	} while (cVar1 != '\0');
	if (currentDir[~uVar6 - 2] == '\\') {
		uVar6 = 0xffffffff;
		pcVar10 = currentDir;
		do {
			if (uVar6 == 0) break;
			uVar6 -= 1;
			cVar1 = *pcVar10;
			pcVar10 = pcVar10 + 1;
		} while (cVar1 != '\0');
		currentDir[~uVar6 - 2] = '\0';
	}
	std::sprintf(globals::g_FILEPATH_DATADIR_JOIN,"%s\\%s",currentDir,"Data");
	uVar6 = 0;
	do {
		std::sprintf((char *)&fileinfo,"%s%i.wad",gamename,uVar6);
		iVar3 = WAD_Open((char *)&fileinfo);
		if (iVar3 != -1) {
			bVar2 = true;
		}
		uVar6 += 1;
	} while (uVar6 < 10);
	std::_getcwd(dataDir,MAX_PATH);
	uVar6 = 0xffffffff;
	pcVar10 = "\\Data";
	do {
		pcVar9 = pcVar10;
		if (uVar6 == 0) break;
		uVar6 -= 1;
		pcVar9 = pcVar10 + 1;
		cVar1 = *pcVar10;
		pcVar10 = pcVar9;
	} while (cVar1 != '\0');
	uVar6 = ~uVar6;
	iVar3 = -1;
	pcVar10 = dataDir;
	do {
		pcVar11 = pcVar10;
		if (iVar3 == 0) break;
		iVar3 += -1;
		pcVar11 = pcVar10 + 1;
		cVar1 = *pcVar10;
		pcVar10 = pcVar11;
	} while (cVar1 != '\0');
	puVar8 = (undefined4 *)(pcVar9 + -uVar6);
	puVar12 = (undefined4 *)(pcVar11 + -1);
	for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
		*puVar12 = *puVar8;
		puVar8 = puVar8 + 1;
		puVar12 = puVar12 + 1;
	}
	for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
		*(undefined *)puVar12 = *(undefined *)puVar8;
		puVar8 = (undefined4 *)((int)puVar8 + 1);
		puVar12 = (undefined4 *)((int)puVar12 + 1);
	}
	Path_SetDataDir(dataDir);
	iVar3 = Path_CheckForCDROM();
	while ((iVar3 == 0 && (insistOnCD != 0))) {
		errorMessage._0_4_ = 0x6f727245;
		errorMessage._4_2_ = 0x72;
		puVar8 = (undefined4 *)(errorMessage + 6);
		for (iVar3 = 0xfe; iVar3 != 0; iVar3 += -1) {
			*puVar8 = 0;
			puVar8 = puVar8 + 1;
		}
		*(undefined2 *)puVar8 = 0;
		BVar4 = registry::Reg_QueryValue_OnLocalMachine
											(regKey,"CDMissing",REGISTRY_STRING,regValue,0x400);
		if (BVar4 == 0) {
LAB_0047f59b:
			std::exit(0);
		}
		else {
			registry::Reg_QueryValue_OnLocalMachine
								(regKey,"SetupError",REGISTRY_STRING,errorMessage,0x400);
			iVar3 = MessageBoxA(NULL,regValue,errorMessage,1);
			if (iVar3 == 2) goto LAB_0047f59b;
		}
		iVar3 = Path_CheckForCDROM();
	}
	if ((iVar3 == 0) && (!bVar2)) {
		local_f24 = 1;
		handle = std::_findfirst("*.*",&fileinfo);
		if (handle != (HANDLE)0xffffffff) {
			do {
				if ((((byte)fileinfo.attrib & 0x10) != 0) &&
					 (iVar3 = std::_stricmp(fileinfo.name,"Data"), iVar3 == 0)) {
					local_f24 = 0;
					break;
				}
				iVar3 = std::_findnext(handle,&fileinfo);
			} while (iVar3 == 0);
			std::_findclose(handle);
		}
	}
	if (insistOnCD != 0) {
		std::sprintf(cdkeyFile,"%s\\%s","Data","cd.key");
		pFVar5 = std::fopen(cdkeyFile,"r");
		if (pFVar5 != NULL) {
			std::fclose(pFVar5);
			local_f24 = 1;
		}
	}
	if (local_f24 == 0) {
		std::_mkdir("Data");
		std::sprintf(cdkeyFile,"%s\\%s","Data","delme.dat");
		pFVar5 = std::fopen(cdkeyFile,"r");
		if (pFVar5 != NULL) {
			std::fclose(pFVar5);
			std::_chmod(cdkeyFile,FILE_ATTRIBUTE_NORMAL);
			std::remove(cdkeyFile);
			return;
		}
	}
	else {
		errorMessage._0_4_ = 0x6f727245;
		errorMessage._4_2_ = 0x72;
		puVar8 = (undefined4 *)(errorMessage + 6);
		for (iVar3 = 0xfe; iVar3 != 0; iVar3 += -1) {
			*puVar8 = 0;
			puVar8 = puVar8 + 1;
		}
		*(undefined2 *)puVar8 = 0;
		BVar4 = registry::Reg_QueryValue_OnLocalMachine
											(regKey,"DataMissing",REGISTRY_STRING,regValue,0x400);
		if (BVar4 != 0) {
			registry::Reg_QueryValue_OnLocalMachine
								(regKey,"SetupError",REGISTRY_STRING,errorMessage,0x400);
			MessageBoxA(NULL,regValue,errorMessage,0);
		}
		std::exit(0);
	}
	return;
}



BOOL __cdecl lego::file::Path_CheckForCDROM(void)
{
	UINT driveType;
	FILE *file;
	char letter;
	uint rootName;
	char buffer [260];
	
	letter = 0x43;
	rootName = 0x5c3a41;
	do {
		rootName = rootName & 0xffffff00 | (uint)(byte)letter;
		driveType = GetDriveTypeA((LPCSTR)&rootName);
		if (driveType == DRIVE_CDROM) {
			std::sprintf(buffer,"%c:\\%s\\%s",letter,"Data","cd.key");
			file = std::fopen(buffer,"r");
			if (file != NULL) {
				std::fclose(file);
				g_CDROM_DriveLetter = letter;
				return 1;
			}
		}
		letter += 1;
	} while ((byte)letter < 0x5b);
	return 0;
}



BOOL __cdecl lego::file::Path_SetDataDir(char *dirname)
{
	char cVar1;
	uint uVar2;
	uint uVar3;
	int iVar4;
	undefined4 *puVar5;
	char *pcVar6;
	undefined4 *puVar7;
	
	if (dirname != NULL) {
		uVar2 = 0xffffffff;
		pcVar6 = dirname;
		do {
			if (uVar2 == 0) break;
			uVar2 -= 1;
			cVar1 = *pcVar6;
			pcVar6 = pcVar6 + 1;
		} while (cVar1 != '\0');
		if (((int)(~uVar2 - 1) < 0x401) && (~uVar2 != 1)) {
			uVar2 = 0xffffffff;
			do {
				pcVar6 = dirname;
				if (uVar2 == 0) break;
				uVar2 -= 1;
				pcVar6 = dirname + 1;
				cVar1 = *dirname;
				dirname = pcVar6;
			} while (cVar1 != '\0');
			uVar2 = ~uVar2;
			puVar5 = (undefined4 *)(pcVar6 + -uVar2);
			puVar7 = (undefined4 *)globals::g_FILEPATH_DATADIR_STRIP;
			for (uVar3 = uVar2 >> 2; uVar3 != 0; uVar3 -= 1) {
				*puVar7 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar7 = puVar7 + 1;
			}
			for (uVar2 &= 3; uVar2 != 0; uVar2 -= 1) {
				*(undefined *)puVar7 = *(undefined *)puVar5;
				puVar5 = (undefined4 *)((int)puVar5 + 1);
				puVar7 = (undefined4 *)((int)puVar7 + 1);
			}
			g_HAS_DATADIR = 1;
			return 1;
		}
	}
	g_HAS_DATADIR = 0;
	puVar5 = (undefined4 *)globals::g_FILEPATH_DATADIR_STRIP;
	for (iVar4 = 0x100; iVar4 != 0; iVar4 += -1) {
		*puVar5 = 0;
		puVar5 = puVar5 + 1;
	}
	return 0;
}



void __cdecl std::printf(char *format,...)
{
	char buffer [1024];
	
	vsprintf(buffer,format,&stack0x00000008);
	OutputDebugStringA(buffer);
	return;
}



int __cdecl lego::file::WAD_Open(char *filename)
{
	int iVar1;
	
	other::logf_removed(NULL);
	iVar1 = WAD_Open__internal(filename);
	return iVar1;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

BOOL __cdecl lego::file::Path_GetCDROMDataPath(char *out_filepath,char *filename)
{
	if ((char)_g_CDROM_DriveLetter != '\0') {
		std::sprintf(out_filepath,"%c:\\%s\\%s",_g_CDROM_DriveLetter & 0xff,"Data",filename);
		return 1;
	}
	return 0;
}



int __cdecl lego::file::Path_MakeDataSubdir(char *dirname)
{
	int iVar1;
	char buffer [260];
	
	std::sprintf(buffer,"%s\\%s","Data",dirname);
	iVar1 = std::_mkdir(buffer);
	return iVar1;
}



FileStream * __cdecl lego::file::File_Open(char *in_filename,char *mode)
{
	char *pcVar1;
	FileLocation FVar2;
	FileStream *file;
	FILE *pFVar3;
	char *pcVar4;
	BOOL BVar5;
	char buffer [260];
	
	pcVar1 = Path_JoinDataDir(in_filename);
	FVar2 = File_FindLocation(pcVar1,mode);
	if (FVar2 == FILELOC_WAD) {
		file = File__New(FILELOC_WAD);
		if (file == NULL) {
			return NULL;
		}
		pcVar4 = Path_StripDataDir(pcVar1);
		BVar5 = WAD_EntryOpen__internal((WADEntryStream *)file->stream,pcVar4);
		if (BVar5 != 0) {
			pcVar1 = Path_StripDataDir(pcVar1);
			other::logf_removed("WAD Load %s\n",pcVar1);
			return file;
		}
		pcVar1 = Path_StripDataDir(pcVar1);
		pcVar4 = "WAD Fail %s\n";
	}
	else {
		if (FVar2 != FILELOC_STD) {
			std::printf("%s(%i) : Error in call to %s\n",
									"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Files.c",330,"File_Open");
			return NULL;
		}
		file = File__New(FILELOC_STD);
		if (file == NULL) {
			return NULL;
		}
		pFVar3 = std::fopen(pcVar1,mode);
		file->stream = pFVar3;
		if (pFVar3 != NULL) {
			other::logf_removed("STD Load %s\n",pcVar1);
			return file;
		}
		pcVar4 = util::strstri(mode,"w");
		if ((pcVar4 == NULL) && (BVar5 = Path_GetCDROMDataPath(buffer,in_filename), BVar5 != 0)) {
			pFVar3 = std::fopen(buffer,mode);
			file->stream = pFVar3;
			if (pFVar3 != NULL) {
				return file;
			}
		}
		pcVar4 = "STD Fail %s\n";
	}
	other::logf_removed(pcVar4,pcVar1);
	File__Dispose(file);
	return NULL;
}



int __cdecl lego::file::File_Seek(FileStream *file,int offset,int origin)
{
	int *piVar1;
	FileLocation FVar2;
	int iVar3;
	uint uVar4;
	
	FVar2 = File_GetLocation(file);
	if (FVar2 != FILELOC_WAD) {
		if (FVar2 != FILELOC_STD) {
			std::printf("%s(%i) : Unknown file system in call to %s",
									"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Files.c",368,"File_Seek");
			return 0;
		}
		iVar3 = std::fseek((FILE *)file->stream,offset,origin);
		return iVar3;
	}
	if (origin == 0) {
		*(int *)(file->stream + 4) = offset;
		piVar1 = (int *)file->stream;
		uVar4 = WAD_SharedGetSize(*piVar1);
		if ((int)uVar4 < piVar1[1]) {
			uVar4 = WAD_SharedGetSize(*piVar1);
			*(uint *)(file->stream + 4) = uVar4;
		}
		if (*(int *)(file->stream + 4) < 0) {
			*(undefined4 *)(file->stream + 4) = 0;
		}
	}
	else {
		if (origin != 1) {
			if (origin != 2) {
				std::printf("Uknown seek mode (%i)",origin);
				return 0;
			}
			uVar4 = WAD_SharedGetSize(*(int *)file->stream);
			*(uint *)(file->stream + 4) = uVar4 + offset;
			return 0;
		}
		*(int *)(file->stream + 4) = *(int *)(file->stream + 4) + offset;
		piVar1 = (int *)file->stream;
		uVar4 = WAD_SharedGetSize(*piVar1);
		if ((int)uVar4 < piVar1[1]) {
			uVar4 = WAD_SharedGetSize(*piVar1);
			*(uint *)(file->stream + 4) = uVar4;
		}
		if (*(int *)(file->stream + 4) < 0) {
			*(undefined4 *)(file->stream + 4) = 0;
			return 0;
		}
	}
	return 0;
}



uint __cdecl lego::file::File_Read(byte *out_buffer,uint size,uint count,FileStream *file)
{
	int iVar1;
	FileLocation FVar2;
	uint uVar3;
	byte *pbVar4;
	uint uVar5;
	undefined4 *puVar6;
	
	FVar2 = File_GetLocation(file);
	if (FVar2 == FILELOC_WAD) {
		uVar3 = WAD_SharedGetSize(*(int *)file->stream);
		uVar5 = count * size;
		iVar1 = ((int *)file->stream)[1];
		if ((int)uVar3 < (int)(iVar1 + uVar5)) {
			uVar5 = uVar3 - iVar1;
		}
		pbVar4 = WAD_SharedGetData(*(int *)file->stream);
		puVar6 = (undefined4 *)(pbVar4 + *(int *)(file->stream + 4));
		for (uVar3 = uVar5 >> 2; uVar3 != 0; uVar3 -= 1) {
			*(undefined4 *)out_buffer = *puVar6;
			puVar6 = puVar6 + 1;
			out_buffer = (byte *)((int)out_buffer + 4);
		}
		for (uVar3 = uVar5 & 3; uVar3 != 0; uVar3 -= 1) {
			*out_buffer = *(undefined *)puVar6;
			puVar6 = (undefined4 *)((int)puVar6 + 1);
			out_buffer = (byte *)((int)out_buffer + 1);
		}
		*(uint *)(file->stream + 4) = *(int *)(file->stream + 4) + uVar5;
		return (int)uVar5 / (int)size;
	}
	if (FVar2 == FILELOC_STD) {
		uVar3 = std::_fread(out_buffer,size,count,(FILE *)file->stream);
		return uVar3;
	}
	std::printf("%s(%i) : Unknown file system in call to %s",
							"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Files.c",395,____EMPTYSTR__);
	return 0;
}



uint __cdecl lego::file::File_Write(byte *buffer,uint size,int count,FileStream *file)
{
	FileLocation FVar1;
	uint uVar2;
	
	FVar1 = File_GetLocation(file);
	if (FVar1 == FILELOC_WAD) {
		std::printf("Cannot write to a file stored in a Wad!");
		return 0;
	}
	if (FVar1 != FILELOC_STD) {
		std::printf("%s(%i) : Unknown file system in call to %s",
								"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Files.c",414,"File_Write");
		return 0;
	}
	uVar2 = std::fwrite(buffer,size,count,(FILE *)file->stream);
	return uVar2;
}



int __cdecl lego::file::File_Close(FileStream *file)
{
	FileLocation FVar1;
	
	FVar1 = File_GetLocation(file);
	if ((-1 < (int)FVar1) && ((int)FVar1 < 2)) {
		File__Dispose(file);
		return 0;
	}
	std::printf("%s(%i) : Unknown file system in call to %s",
							"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Files.c",431,"File_Close");
	return 0;
}



int __cdecl lego::file::File_Tell(FileStream *file)
{
	FileLocation FVar1;
	int iVar2;
	
	FVar1 = File_GetLocation(file);
	if (FVar1 == FILELOC_WAD) {
		return *(int *)(file->stream + 4);
	}
	if (FVar1 != FILELOC_STD) {
		std::printf("%s(%i) : Unknown file system in call to %s",
								"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Files.c",469,"File_Tell");
		return 0;
	}
	iVar2 = std::ftell((FILE *)file->stream);
	return iVar2;
}



BOOL __cdecl lego::file::File_Exist(char *in_filename)
{
	char *filename;
	FileLocation FVar1;
	FILE *pFVar2;
	BOOL BVar3;
	char local_104 [260];
	
	filename = Path_JoinDataDir(in_filename);
	FVar1 = File_FindLocation(filename,"r");
	if (FVar1 == FILELOC_STD) {
		pFVar2 = std::fopen(filename,"r");
		if (pFVar2 != NULL) {
			std::fclose(pFVar2);
			return 1;
		}
		BVar3 = Path_GetCDROMDataPath(local_104,in_filename);
		if (BVar3 != 0) {
			pFVar2 = std::fopen(local_104,"r");
			if (pFVar2 != NULL) {
				std::fclose(pFVar2);
				return 1;
			}
		}
	}
	else {
		if (FVar1 == FILELOC_WAD) {
			BVar3 = WAD_FindEntry(filename,-1);
			return BVar3;
		}
	}
	return 0;
}



int __cdecl lego::file::File_GetC(FileStream *file)
{
	int iVar1;
	int iVar2;
	FileLocation FVar3;
	int iVar4;
	uint uVar5;
	byte *pbVar6;
	
	FVar3 = File_GetLocation(file);
	if (FVar3 == FILELOC_WAD) {
		uVar5 = WAD_SharedGetSize(*(int *)file->stream);
		if ((int)(uVar5 - 1) <= ((int *)file->stream)[1]) {
			return -1;
		}
		iVar4 = file->stream;
		iVar1 = *(int *)(iVar4 + 4);
		pbVar6 = WAD_SharedGetData(*(int *)file->stream);
		iVar2 = *(int *)(pbVar6 + iVar1);
		*(int *)(iVar4 + 4) = iVar1 + 1;
		return iVar2;
	}
	if (FVar3 != FILELOC_STD) {
		std::printf("%s(%i) : Unknown file system in call to %s",
								"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Files.c",545,"File_GetC");
		return 0;
	}
	iVar4 = std::fgetc((FILE *)file->stream);
	return iVar4;
}



int __cdecl lego::file::File_GetLength(FileStream *file)
{
	int offset;
	int iVar1;
	
	offset = File_Tell(file);
	File_Seek(file,0,SEEK_END);
	iVar1 = File_Tell(file);
	File_Seek(file,offset,SEEK_SET);
	return iVar1;
}



char * __cdecl lego::file::WAD_GetS__internal(char *out_str,int num,FileStream *file)
{
	char cVar1;
	int iVar2;
	int iVar3;
	
	iVar3 = 0;
	iVar2 = File_GetC(file);
	cVar1 = (char)iVar2;
	*out_str = cVar1;
	while ((((cVar1 != '\0' && (out_str[iVar3] != '\n')) && (out_str[iVar3] != -1)) && (iVar3 != num))
				) {
		iVar3 += 1;
		iVar2 = File_GetC(file);
		cVar1 = (char)iVar2;
		out_str[iVar3] = cVar1;
	}
	out_str[iVar3 + 1] = '\0';
	return (char *)(-(uint)(iVar3 != 0) & (uint)out_str);
}



char * __cdecl lego::file::File_GetS(char *out_str,int num,FileStream *file)
{
	FileLocation FVar1;
	char *pcVar2;
	
	FVar1 = File_GetLocation(file);
	if (FVar1 == FILELOC_WAD) {
		pcVar2 = WAD_GetS__internal(out_str,num,file);
		return pcVar2;
	}
	if (FVar1 != FILELOC_STD) {
		std::printf("%s(%i) : Unknown file system in call to %s",
								"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Files.c",587,"File_GetS");
		return NULL;
	}
	pcVar2 = std::fgets(out_str,num,(FILE *)file->stream);
	return pcVar2;
}



int __cdecl lego::file::File_PrintF(FileStream *file,char *format,...)
{
	FileLocation FVar1;
	
	FVar1 = File_GetLocation(file);
	if (FVar1 == FILELOC_WAD) {
		std::printf("\"fprintf\" is unsupprted for wad files");
		return 0;
	}
	if (FVar1 != FILELOC_STD) {
		std::printf("%s(%i) : Unknown file system in call to %s",
								"C:\\Dev\\SourceSafe\\gods98_dx6\\gods98\\src\\Files.c",612,"File_PrintF");
		return 0;
	}
	FUN_00490190((char **)file->stream,(byte *)format,(undefined4 *)&stack0x0000000c);
	return 0;
}



FileLocation __cdecl lego::file::File_GetLocation(FileStream *file)
{
	return file->location;
}



FileLocation __cdecl lego::file::File_FindLocation(char *filename,char *mode)
{
	char cVar1;
	char *pcVar2;
	int iVar3;
	
	if ((filename != NULL) && (mode != NULL)) {
		iVar3 = -1;
		pcVar2 = filename;
		do {
			if (iVar3 == 0) break;
			iVar3 += -1;
			cVar1 = *pcVar2;
			pcVar2 = pcVar2 + 1;
		} while (cVar1 != '\0');
		if (iVar3 != -2) {
			iVar3 = -1;
			pcVar2 = mode;
			do {
				if (iVar3 == 0) break;
				iVar3 += -1;
				cVar1 = *pcVar2;
				pcVar2 = pcVar2 + 1;
			} while (cVar1 != '\0');
			if (iVar3 != -2) {
				if ((*mode != 'w') && (*mode != 'W')) {
					iVar3 = -1;
					pcVar2 = Path_StripDataDir(filename);
					iVar3 = WAD_FindEntry(pcVar2,iVar3);
					return (uint)(iVar3 == -1);
				}
				return FILELOC_STD;
			}
		}
	}
	return FILELOC_ERROR;
}



BOOL __cdecl lego::file::WAD_EntryOpen__internal(WADEntryStream *wadStream,char *filename)
{
	int iVar1;
	
	wadStream->field_8 = 0;
	wadStream->position = 0;
	iVar1 = WAD_SharedOpen(filename,-1);
	wadStream->sharedIndex = iVar1;
	return (uint)(iVar1 != -1);
}



FileStream * __cdecl lego::file::File__New(FileLocation location)
{
	FileStream *legoFile;
	WADEntryStream *wadStream;
	
	if (location == FILELOC_STD) {
		legoFile = (FileStream *)malloc(8);
		legoFile->location = FILELOC_STD;
		return legoFile;
	}
	if (location == FILELOC_WAD) {
		legoFile = (FileStream *)malloc(8);
		if (legoFile != NULL) {
			legoFile->location = FILELOC_WAD;
			wadStream = (WADEntryStream *)malloc(0xc);
			legoFile->stream = wadStream;
			if (wadStream != NULL) {
				return legoFile;
			}
			free(legoFile);
		}
	}
	return NULL;
}



void * __cdecl lego::file::malloc(uint size)
{
	void *pvVar1;
	
	pvVar1 = std::malloc(size);
	return pvVar1;
}



void __cdecl lego::file::free(void *ptr)
{
	std::free(ptr);
	return;
}



void __cdecl lego::file::File__Dispose(FileStream *file)
{
	FileLocation FVar1;
	
	if (file != NULL) {
		FVar1 = File_GetLocation(file);
		if (FVar1 == FILELOC_STD) {
			if ((FILE *)file->stream != NULL) {
				std::fclose((FILE *)file->stream);
				free(file);
				return;
			}
		}
		else {
			FVar1 = File_GetLocation(file);
			if (FVar1 != FILELOC_WAD) {
				return;
			}
			if ((int *)file->stream != NULL) {
				WAD_Shared__Dispose(*(int *)file->stream);
				free((void *)file->stream);
			}
		}
		free(file);
	}
	return;
}



char * __cdecl lego::file::Path_StripDataDir(char *filename)
{
	char cVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	int iVar5;
	char *pcVar6;
	
	if (g_HAS_DATADIR == 0) {
		return filename;
	}
	uVar3 = 0xffffffff;
	pcVar6 = filename;
	do {
		if (uVar3 == 0) break;
		uVar3 -= 1;
		cVar1 = *pcVar6;
		pcVar6 = pcVar6 + 1;
	} while (cVar1 != '\0');
	uVar4 = 0xffffffff;
	pcVar6 = globals::g_FILEPATH_DATADIR_STRIP;
	do {
		if (uVar4 == 0) break;
		uVar4 -= 1;
		cVar1 = *pcVar6;
		pcVar6 = pcVar6 + 1;
	} while (cVar1 != '\0');
	iVar5 = ~uVar4 - 1;
	if ((int)(~uVar3 - 1) <= iVar5) {
		return filename;
	}
	cVar1 = filename[iVar5];
	filename[iVar5] = '\0';
	iVar2 = std::_stricmp(filename,globals::g_FILEPATH_DATADIR_STRIP);
	if (iVar2 == 0) {
		std::sprintf(globals::temp::tmp_FILEPATH_STRIPDATADIR,"%s",filename + ~uVar4);
		filename[iVar5] = cVar1;
		return globals::temp::tmp_FILEPATH_STRIPDATADIR;
	}
	filename[iVar5] = cVar1;
	return filename;
}



char * __cdecl lego::file::File_GetS_StripLineEnd(char *out_str,int num,FileStream *file)
{
	char cVar1;
	char *pcVar2;
	uint uVar3;
	int iVar4;
	char *pcVar5;
	
	pcVar2 = File_GetS(out_str,num,file);
	uVar3 = 0xffffffff;
	pcVar5 = out_str;
	do {
		if (uVar3 == 0) break;
		uVar3 -= 1;
		cVar1 = *pcVar5;
		pcVar5 = pcVar5 + 1;
	} while (cVar1 != '\0');
	uVar3 = ~uVar3;
	iVar4 = uVar3 - 2;
	if (out_str[iVar4] == '\n') {
		out_str[iVar4] = '\0';
	}
	if ((iVar4 != 0) && (out_str[uVar3 - 3] == '\r')) {
		out_str[uVar3 - 3] = '\0';
	}
	return pcVar2;
}



byte * __cdecl lego::file::File_ReadAllBytes(char *filename,uint *out_length)
{
	byte *buffer;
	
	buffer = File_ReadAll(filename,out_length,TRUE);
	return buffer;
}



byte * __cdecl lego::file::File_ReadAll(char *filename,uint *out_length,BOOL isBinary)
{
	char *mode;
	FileStream *file;
	uint length;
	byte *out_buffer;
	
	mode = "rb";
	if (isBinary == 0) {
		mode = "r";
	}
	file = File_Open(filename,mode);
	if (file != NULL) {
		File_Seek(file,0,SEEK_END);
		length = File_Tell(file);
		if (g_FileOpenCallback != NULL) {
			(*g_FileOpenCallback)(filename,length,g_FileOpenCallback_CONTEXT);
		}
		out_buffer = (byte *)std::malloc(length);
		if (out_buffer != NULL) {
			File_Seek(file,0,0);
			File_Read(out_buffer,1,length,file);
			if (out_length != NULL) {
				*out_length = length;
			}
			File_Close(file);
			return out_buffer;
		}
		File_Close(file);
	}
	return NULL;
}



int __cdecl lego::file::File_SharedOpen(char *filename,uint *out_length)
{
	FileStream *file;
	uint size;
	int sharedIndex;
	byte *out_buffer;
	
	file = File_Open(filename,"rb");
	if (file != NULL) {
		File_Seek(file,0,SEEK_END);
		size = File_Tell(file);
		if (g_FileOpenCallback != NULL) {
			(*g_FileOpenCallback)(filename,size,g_FileOpenCallback_CONTEXT);
		}
		sharedIndex = File_SharedOpen__internal(size);
		if (sharedIndex != -1) {
			out_buffer = (byte *)File_SharedGetData(sharedIndex);
			File_Seek(file,0,SEEK_SET);
			File_Read(out_buffer,1,size,file);
			if (out_length != NULL) {
				*out_length = size;
			}
			File_Close(file);
			return sharedIndex;
		}
		File_Close(file);
	}
	return -1;
}



char * __cdecl lego::file::Path_JoinDataDir(char *filename)
{
	char cVar1;
	char *pcVar2;
	int iVar3;
	uint uVar4;
	char buffer [260];
	
	if (filename != NULL) {
		if (*filename == '\\') {
			filename = filename + 1;
		}
		std::sprintf(buffer,"%s\\%s",globals::g_FILEPATH_DATADIR_JOIN,filename);
		pcVar2 = std::_fullpath(globals::temp::tmp_FILEPATH_JOINDATADIR,buffer,MAX_PATH);
		if (pcVar2 != NULL) {
			uVar4 = 0xffffffff;
			pcVar2 = globals::g_FILEPATH_DATADIR_JOIN;
			do {
				if (uVar4 == 0) break;
				uVar4 -= 1;
				cVar1 = *pcVar2;
				pcVar2 = pcVar2 + 1;
			} while (cVar1 != '\0');
			iVar3 = std::strncmp(globals::temp::tmp_FILEPATH_JOINDATADIR,globals::g_FILEPATH_DATADIR_JOIN,
													 ~uVar4 - 1);
			if (iVar3 == 0) {
				return globals::temp::tmp_FILEPATH_JOINDATADIR;
			}
		}
	}
	return NULL;
}



void __cdecl lego::file::File_SetOpenCallback(FileOpenCallback *callback,void *lpValue)
{
	g_FileOpenCallback = callback;
	g_FileOpenCallback_CONTEXT = lpValue;
	return;
}



void __cdecl lego::file::scan::Scan_ReadDataDirList(char *listFilename)
{
	char cVar1;
	FILE *file;
	int iVar2;
	uint uVar3;
	uint uVar4;
	undefined4 *puVar5;
	char *pcVar6;
	char *pcVar7;
	char (*pacVar8) [1024];
	char buffer [1024];
	
	file = (FILE *)File_Open(listFilename,"r");
	if (file != NULL) {
		globals::g_ScanRealFiles_FilePaths_COUNT = 0;
		iVar2 = std::fscanf(file,"%s",buffer);
		while (iVar2 != -1) {
			uVar3 = 0xffffffff;
			pacVar8 = globals::g_ScanRealFiles_FilePaths_TABLE[globals::g_ScanRealFiles_FilePaths_COUNT];
			globals::g_ScanRealFiles_FilePaths_COUNT += 1;
			pcVar6 = buffer;
			do {
				pcVar7 = pcVar6;
				if (uVar3 == 0) break;
				uVar3 -= 1;
				pcVar7 = pcVar6 + 1;
				cVar1 = *pcVar6;
				pcVar6 = pcVar7;
			} while (cVar1 != '\0');
			uVar3 = ~uVar3;
			puVar5 = (undefined4 *)(pcVar7 + -uVar3);
			for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
				*(undefined4 *)*pacVar8 = *puVar5;
				puVar5 = puVar5 + 1;
				pacVar8 = (char (*) [1024])(*pacVar8 + 4);
			}
			for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
				(*pacVar8)[0] = *(char *)puVar5;
				puVar5 = (undefined4 *)((int)puVar5 + 1);
				pacVar8 = (char (*) [1024])(*pacVar8 + 1);
			}
			iVar2 = std::fscanf(file,"%s",buffer);
		}
		Scan_Directory(globals::g_FILEPATH_DATADIR_JOIN);
		std::fclose(file);
	}
	return;
}



void __cdecl lego::file::scan::Scan_Directory(char *dirname)
{
	char cVar1;
	byte bVar2;
	HANDLE handle;
	byte *pbVar3;
	uint uVar4;
	uint uVar5;
	int iVar6;
	char *pcVar7;
	undefined4 *puVar8;
	char *pcVar9;
	byte *pbVar10;
	undefined4 *puVar11;
	bool bVar12;
	byte local_518;
	byte local_504 [260];
	undefined4 local_400 [256];
	
	uVar4 = 0xffffffff;
	pcVar7 = dirname;
	do {
		pcVar9 = pcVar7;
		if (uVar4 == 0) break;
		uVar4 -= 1;
		pcVar9 = pcVar7 + 1;
		cVar1 = *pcVar7;
		pcVar7 = pcVar9;
	} while (cVar1 != '\0');
	uVar4 = ~uVar4;
	puVar8 = (undefined4 *)(pcVar9 + -uVar4);
	puVar11 = local_400;
	for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
		*puVar11 = *puVar8;
		puVar8 = puVar8 + 1;
		puVar11 = puVar11 + 1;
	}
	for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
		*(undefined *)puVar11 = *(undefined *)puVar8;
		puVar8 = (undefined4 *)((int)puVar8 + 1);
		puVar11 = (undefined4 *)((int)puVar11 + 1);
	}
	uVar4 = 0xffffffff;
	pcVar7 = "\\*.*";
	do {
		pcVar9 = pcVar7;
		if (uVar4 == 0) break;
		uVar4 -= 1;
		pcVar9 = pcVar7 + 1;
		cVar1 = *pcVar7;
		pcVar7 = pcVar9;
	} while (cVar1 != '\0');
	uVar4 = ~uVar4;
	iVar6 = -1;
	puVar8 = local_400;
	do {
		puVar11 = puVar8;
		if (iVar6 == 0) break;
		iVar6 += -1;
		puVar11 = (undefined4 *)((int)puVar8 + 1);
		cVar1 = *(char *)puVar8;
		puVar8 = puVar11;
	} while (cVar1 != '\0');
	puVar8 = (undefined4 *)(pcVar9 + -uVar4);
	puVar11 = (undefined4 *)((int)puVar11 + -1);
	for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
		*puVar11 = *puVar8;
		puVar8 = puVar8 + 1;
		puVar11 = puVar11 + 1;
	}
	for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
		*(undefined *)puVar11 = *(undefined *)puVar8;
		puVar8 = (undefined4 *)((int)puVar8 + 1);
		puVar11 = (undefined4 *)((int)puVar11 + 1);
	}
	handle = std::_findfirst((LPCSTR)local_400,(_finddata32_t *)&local_518);
	if (handle != (HANDLE)0xffffffff) {
		do {
			pcVar7 = ".";
			pbVar3 = local_504;
			do {
				bVar2 = *pbVar3;
				bVar12 = bVar2 < (byte)*pcVar7;
				if (bVar2 != *pcVar7) {
LAB_00480709:
					iVar6 = (1 - (uint)bVar12) - (uint)(bVar12 != 0);
					goto LAB_0048070e;
				}
				if (bVar2 == 0) break;
				bVar2 = pbVar3[1];
				bVar12 = bVar2 < ((byte *)pcVar7)[1];
				if (bVar2 != ((byte *)pcVar7)[1]) goto LAB_00480709;
				pbVar3 = pbVar3 + 2;
				pcVar7 = (char *)((byte *)pcVar7 + 2);
			} while (bVar2 != 0);
			iVar6 = 0;
LAB_0048070e:
			if (iVar6 != 0) {
				pcVar7 = "..";
				pbVar3 = local_504;
				do {
					bVar2 = *pbVar3;
					bVar12 = bVar2 < (byte)*pcVar7;
					if (bVar2 != *pcVar7) {
LAB_00480743:
						iVar6 = (1 - (uint)bVar12) - (uint)(bVar12 != 0);
						goto LAB_00480748;
					}
					if (bVar2 == 0) break;
					bVar2 = pbVar3[1];
					bVar12 = bVar2 < ((byte *)pcVar7)[1];
					if (bVar2 != ((byte *)pcVar7)[1]) goto LAB_00480743;
					pbVar3 = pbVar3 + 2;
					pcVar7 = (char *)((byte *)pcVar7 + 2);
				} while (bVar2 != 0);
				iVar6 = 0;
LAB_00480748:
				if (iVar6 != 0) {
					uVar4 = 0xffffffff;
					pcVar7 = dirname;
					do {
						pcVar9 = pcVar7;
						if (uVar4 == 0) break;
						uVar4 -= 1;
						pcVar9 = pcVar7 + 1;
						cVar1 = *pcVar7;
						pcVar7 = pcVar9;
					} while (cVar1 != '\0');
					uVar4 = ~uVar4;
					puVar8 = (undefined4 *)(pcVar9 + -uVar4);
					puVar11 = local_400;
					for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
						*puVar11 = *puVar8;
						puVar8 = puVar8 + 1;
						puVar11 = puVar11 + 1;
					}
					for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
						*(undefined *)puVar11 = *(undefined *)puVar8;
						puVar8 = (undefined4 *)((int)puVar8 + 1);
						puVar11 = (undefined4 *)((int)puVar11 + 1);
					}
					uVar4 = 0xffffffff;
					pcVar7 = "\\";
					do {
						pcVar9 = pcVar7;
						if (uVar4 == 0) break;
						uVar4 -= 1;
						pcVar9 = pcVar7 + 1;
						cVar1 = *pcVar7;
						pcVar7 = pcVar9;
					} while (cVar1 != '\0');
					uVar4 = ~uVar4;
					iVar6 = -1;
					puVar8 = local_400;
					do {
						puVar11 = puVar8;
						if (iVar6 == 0) break;
						iVar6 += -1;
						puVar11 = (undefined4 *)((int)puVar8 + 1);
						cVar1 = *(char *)puVar8;
						puVar8 = puVar11;
					} while (cVar1 != '\0');
					puVar8 = (undefined4 *)(pcVar9 + -uVar4);
					puVar11 = (undefined4 *)((int)puVar11 + -1);
					for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
						*puVar11 = *puVar8;
						puVar8 = puVar8 + 1;
						puVar11 = puVar11 + 1;
					}
					for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
						*(undefined *)puVar11 = *(undefined *)puVar8;
						puVar8 = (undefined4 *)((int)puVar8 + 1);
						puVar11 = (undefined4 *)((int)puVar11 + 1);
					}
					uVar4 = 0xffffffff;
					pbVar3 = local_504;
					do {
						pbVar10 = pbVar3;
						if (uVar4 == 0) break;
						uVar4 -= 1;
						pbVar10 = pbVar3 + 1;
						bVar2 = *pbVar3;
						pbVar3 = pbVar10;
					} while (bVar2 != 0);
					uVar4 = ~uVar4;
					iVar6 = -1;
					puVar8 = local_400;
					do {
						puVar11 = puVar8;
						if (iVar6 == 0) break;
						iVar6 += -1;
						puVar11 = (undefined4 *)((int)puVar8 + 1);
						cVar1 = *(char *)puVar8;
						puVar8 = puVar11;
					} while (cVar1 != '\0');
					puVar8 = (undefined4 *)(pbVar10 + -uVar4);
					puVar11 = (undefined4 *)((int)puVar11 + -1);
					for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
						*puVar11 = *puVar8;
						puVar8 = puVar8 + 1;
						puVar11 = puVar11 + 1;
					}
					for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
						*(undefined *)puVar11 = *(undefined *)puVar8;
						puVar8 = (undefined4 *)((int)puVar8 + 1);
						puVar11 = (undefined4 *)((int)puVar11 + 1);
					}
					if ((local_518 & 0x10) == 0) {
						Scan_File((char *)local_400);
					}
					else {
						Scan_Directory((char *)local_400);
					}
				}
			}
			iVar6 = std::_findnext(handle,(_finddata32_t *)&local_518);
		} while (iVar6 == 0);
		std::_findclose(handle);
	}
	return;
}



int __cdecl lego::file::scan::Scan_File(char *filename)
{
	int iVar1;
	uint uVar2;
	char (*_Str2) [1024];
	
	uVar2 = 0;
	if (globals::g_ScanRealFiles_FilePaths_COUNT != 0) {
		_Str2 = globals::g_ScanRealFiles_FilePaths_TABLE;
		do {
			iVar1 = std::_stricmp(filename,(char *)_Str2);
			if (iVar1 == 0) {
				return 0;
			}
			uVar2 += 1;
			_Str2 = _Str2[1];
		} while (uVar2 < globals::g_ScanRealFiles_FilePaths_COUNT);
	}
	return globals::g_ScanRealFiles_FilePaths_COUNT;
}



BOOL __cdecl lego::pool::ReservedPool_Struct_34___Init(char *sharedTextures)
{
	char cVar1;
	uint uVar2;
	uint uVar3;
	int iVar4;
	uint uVar5;
	undefined4 *puVar6;
	char *pcVar7;
	undefined4 *puVar8;
	Struct_34 **ppSVar9;
	
	lego::globals::g_UNKPTR_STRUCT48__005353c4 = NULL;
	unk::Lego_FreeUNKPTR_STRUCT48();
	if (sharedTextures != NULL) {
		uVar2 = 0xffffffff;
		pcVar7 = sharedTextures;
		do {
			if (uVar2 == 0) break;
			uVar2 -= 1;
			cVar1 = *pcVar7;
			pcVar7 = pcVar7 + 1;
		} while (cVar1 != '\0');
		uVar2 = ~uVar2;
		uVar5 = uVar2 - 1;
		if (sharedTextures[uVar2 - 2] != '\\') {
			uVar5 = uVar2;
		}
		lego::globals::g_SharedTextures2 = (char *)std::malloc(uVar5 + 1);
		uVar2 = 0xffffffff;
		do {
			pcVar7 = sharedTextures;
			if (uVar2 == 0) break;
			uVar2 -= 1;
			pcVar7 = sharedTextures + 1;
			cVar1 = *sharedTextures;
			sharedTextures = pcVar7;
		} while (cVar1 != '\0');
		uVar2 = ~uVar2;
		puVar6 = (undefined4 *)(pcVar7 + -uVar2);
		puVar8 = (undefined4 *)lego::globals::g_SharedTextures2;
		for (uVar3 = uVar2 >> 2; uVar3 != 0; uVar3 -= 1) {
			*puVar8 = *puVar6;
			puVar6 = puVar6 + 1;
			puVar8 = puVar8 + 1;
		}
		for (uVar2 &= 3; uVar2 != 0; uVar2 -= 1) {
			*(undefined *)puVar8 = *(undefined *)puVar6;
			puVar6 = (undefined4 *)((int)puVar6 + 1);
			puVar8 = (undefined4 *)((int)puVar8 + 1);
		}
		lego::globals::g_SharedTextures2[uVar5 - 1] = '\\';
		lego::globals::g_SharedTextures2[uVar5] = '\0';
	}
	ppSVar9 = globals::ReservedPool_Struct_34___g_TABLE;
	for (iVar4 = 0x14; iVar4 != 0; iVar4 += -1) {
		*ppSVar9 = NULL;
		ppSVar9 = ppSVar9 + 1;
	}
	globals::ReservedPool_Struct_34___g_NEXT = NULL;
	globals::ReservedPool_Struct_34___g_COUNT = 0;
	FUN_00480910();
	return 1;
}



BOOL __cdecl FUN_00480910(void)
{
	int iVar1;
	ULONG UVar2;
	IDirect3DDevice3 *This;
	IDirect3DDevice3 *pIStack104;
	IUnknown **ppIStack100;
	undefined4 uStack96;
	IDirect3DDevice3 *pIStack92;
	undefined *puStack88;
	undefined local_54 [4];
	undefined4 local_50;
	undefined4 local_4c;
	undefined4 local_48;
	undefined4 local_44;
	undefined4 local_40;
	undefined4 local_3c;
	undefined4 local_38;
	undefined4 local_34;
	undefined4 local_30;
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	puStack88 = local_54;
	local_50 = 0x50;
	local_4c = 0x3f800000;
	local_48 = 0x3f800000;
	local_44 = 0x3f800000;
	local_40 = 0x3f800000;
	local_3c = 0;
	local_38 = 0;
	local_34 = 0;
	local_30 = 0;
	local_2c = 0;
	local_28 = 0;
	local_24 = 0;
	local_20 = 0;
	local_1c = 0;
	local_18 = 0;
	local_14 = 0;
	local_10 = 0;
	local_c = 0;
	local_8 = 0;
	local_4 = 0;
	pIStack92 = lego::globals::g_IDirect3DDevice3;
	uStack96 = 0x4809c3;
	(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->GetDirect3D)();
	uStack96 = 0;
	ppIStack100 = &lego::globals::g_IDirect3DMaterial3;
	pIStack104 = pIStack92;
										// IDirect3D3::CreateMaterial -> IDirect3DMaterial3
	iVar1 = (*(code *)pIStack92->lpVtbl->AddViewport)();
	if (iVar1 == 0) {
										// IDirect3DMaterial3::GetHandle(IDirect3DDevice3, ID3DMaterialHandle (LPDWORD))
		This = lego::globals::g_IDirect3DDevice3;
		UVar2 = (*lego::globals::g_IDirect3DMaterial3->lpVtbl[1].Release)
											(lego::globals::g_IDirect3DMaterial3);
		if (UVar2 == 0) {
			FUN_00480a40(&stack0xffffff94);
			if (This != NULL) {
				(*This->lpVtbl->Release)((IUnknown *)This);
			}
			return 1;
		}
		if (This != NULL) {
			(*This->lpVtbl->Release)((IUnknown *)This);
		}
	}
	else {
		if (pIStack104 != NULL) {
			(*pIStack104->lpVtbl->Release)((IUnknown *)pIStack104);
			return 0;
		}
	}
	return 0;
}



uint __cdecl FUN_00480a40(IID *param_1)
{
	HRESULT HVar1;
	void **unaff_retaddr;
	
	HVar1 = (*lego::globals::g_IDirect3DMaterial3->lpVtbl[1].QueryInterface)
										(lego::globals::g_IDirect3DMaterial3,param_1,unaff_retaddr);
	return (uint)(HVar1 == 0);
}



Struct_34 * __cdecl lego::pool::ReservedPool_Struct_34___Next(void)
{
	Struct_34 *pSVar1;
	int iVar2;
	Struct_34 *pSVar3;
	
	if (globals::ReservedPool_Struct_34___g_NEXT == NULL) {
		ReservedPool_Struct_34___Alloc();
	}
	pSVar1 = globals::ReservedPool_Struct_34___g_NEXT;
	pSVar3 = globals::ReservedPool_Struct_34___g_NEXT;
	globals::ReservedPool_Struct_34___g_NEXT = globals::ReservedPool_Struct_34___g_NEXT->pool_m_next;
	for (iVar2 = 0xd; iVar2 != 0; iVar2 += -1) {
		pSVar3->count_0 = 0;
		pSVar3 = (Struct_34 *)&pSVar3->field_4;
	}
	pSVar1->pool_m_next = pSVar1;
	return pSVar1;
}



void __cdecl lego::pool::ReservedPool_Struct_34___Release(Struct_34 *param_1)
{
	param_1->pool_m_next = globals::ReservedPool_Struct_34___g_NEXT;
	globals::ReservedPool_Struct_34___g_NEXT = param_1;
	return;
}



void __cdecl lego::pool::ReservedPool_Struct_34___Alloc(void)
{
	Struct_34 *pSVar1;
	Struct_34 *pSVar2;
	int iVar3;
	uint uVar4;
	
	uVar4 = 1 << ((byte)globals::ReservedPool_Struct_34___g_COUNT & 0x1f);
	pSVar2 = (Struct_34 *)std::malloc(uVar4 * 0x34);
	globals::ReservedPool_Struct_34___g_TABLE[globals::ReservedPool_Struct_34___g_COUNT] = pSVar2;
	pSVar2 = globals::ReservedPool_Struct_34___g_TABLE[globals::ReservedPool_Struct_34___g_COUNT];
	if (pSVar2 != NULL) {
		globals::ReservedPool_Struct_34___g_COUNT += 1;
		if (1 < uVar4) {
			iVar3 = uVar4 - 1;
			pSVar1 = pSVar2;
			do {
				pSVar1->pool_m_next = pSVar1 + 1;
				iVar3 += -1;
				pSVar1 = pSVar1 + 1;
			} while (iVar3 != 0);
		}
		pSVar2[uVar4 - 1].pool_m_next = globals::ReservedPool_Struct_34___g_NEXT;
		globals::ReservedPool_Struct_34___g_NEXT = pSVar2;
	}
	return;
}



Struct_34 * __cdecl
lego::res::Res_Unk_CreateUserVisualStruct34
					(IDirect3DRMFrame3 *rmFrame3,undefined4 param_2,undefined4 unkFlags,undefined4 param_4,
					int unkMode)
{
	IDirect3DRMUserVisual *pIVar1;
	Struct_34 *pSVar2;
	IDirect3DRMFrame3 *unaff_EDI;
	IDirect3DRMFrame3 *pIVar3;
	
	pSVar2 = pool::ReservedPool_Struct_34___Next();
	GetRoot();
	pIVar1 = (IDirect3DRMUserVisual *)&pSVar2->userVisual_c;
										// IDirect3DRM3->CreateUserVisual(this, TD3DRMUserVisualCallback fn, void*
										// lpArg, IDirect3DRMUserVisual** lplpD3DRMUV)
	(*(code *)globals::g_IDirect3DRM3->lpVtbl->CreateUserVisual)(globals::g_IDirect3DRM3);
										// IDirect3DRMFrame3->AddVisual(this, IDirect3DRMVisual* lpD3DRMVisual)
	pIVar3 = unaff_EDI;
	(*(code *)unaff_EDI->lpVtbl->AddVisual)(unaff_EDI,pIVar1->lpVtbl);
										// IDirect3DRMUserVisual->SetAppData(this, Struct_34* ulData)
	(**(code **)(pIVar1->lpVtbl->QueryInterface + 0x18))(pIVar1->lpVtbl,pSVar2);
	pSVar2->param4_14 = pIVar1;
	pSVar2->frame_28 = unaff_EDI;
	pSVar2->viewport_10 = (IDirect3DRMViewport2 *)Res_D3DRMUserVisualCallback;
	pSVar2->unkFlags3_18 = pSVar2;
	if (pIVar3 == (IDirect3DRMFrame3 *)0x1) {
		pSVar2->refCount_20 = 1;
		pSVar2->flags = pSVar2->flags | 2;
		return pSVar2;
	}
	if (pIVar3 == (IDirect3DRMFrame3 *)0x2) {
		pSVar2->flags = pSVar2->flags | 4;
	}
	pSVar2->refCount_20 = 1;
	return pSVar2;
}



Struct_34 * __cdecl
lego::pool::ReservedPool_Struct_34___Next_2(Struct_34 *param_1,IDirect3DRMFrame3 *rmFrame3)
{
	IDirect3DRMUserVisual **ppIVar1;
	Struct_34 *data;
	LwoFrame *pLVar2;
	int iVar3;
	uint uVar4;
	IDirect3DRMFrame3 *unaff_EBP;
	Struct_34 *pSVar5;
	LwoFrame *pLVar6;
	Struct_34 *pSVar7;
	
	data = ReservedPool_Struct_34___Next();
	if (param_1->struct34_24 != NULL) {
		param_1 = param_1->struct34_24;
	}
	pSVar5 = param_1;
	pSVar7 = data;
	for (iVar3 = 0xd; iVar3 != 0; iVar3 += -1) {
		pSVar7->count_0 = pSVar5->count_0;
		pSVar5 = (Struct_34 *)&pSVar5->field_4;
		pSVar7 = (Struct_34 *)&pSVar7->field_4;
	}
	data->struct34_24 = param_1;
	data->field_4 = data->count_0;
	pLVar2 = (LwoFrame *)std::malloc(data->count_0 * 0x70);
	data->lwoTable_8 = pLVar2;
	pLVar6 = param_1->lwoTable_8;
	for (uVar4 = data->count_0 * 0x70 >> 2; uVar4 != 0; uVar4 -= 1) {
		pLVar2->dwSize = pLVar6->dwSize;
		pLVar6 = (LwoFrame *)&pLVar6->field_0x4;
		pLVar2 = (LwoFrame *)&pLVar2->field_0x4;
	}
	for (iVar3 = 0; iVar3 != 0; iVar3 += -1) {
		*(undefined *)&pLVar2->dwSize = *(undefined *)&pLVar6->dwSize;
		pLVar6 = (LwoFrame *)((int)&pLVar6->dwSize + 1);
		pLVar2 = (LwoFrame *)((int)&pLVar2->dwSize + 1);
	}
	uVar4 = 0;
	if (data->count_0 != 0) {
		iVar3 = 0;
		do {
			res::Res_Struct34_InitTable10_Item50Default(data,uVar4);
			FUN_00483500(data,uVar4,(undefined4 *)(&param_1->lwoTable_8->field_0x10 + iVar3));
			uVar4 += 1;
			iVar3 += 0x70;
		} while (uVar4 < data->count_0);
	}
	ppIVar1 = &data->userVisual_c;
										// IDirect3DRM3->CreateUserVisual(this, TD3DRMUserVisualCallback fn, void*
										// lpArg, IDirect3DRMUserVisual** lplpD3DRMUV)
	(*(code *)lego::globals::g_IDirect3DRM3->lpVtbl->CreateUserVisual)
						(lego::globals::g_IDirect3DRM3,res::Res_D3DRMUserVisualCallback,data,ppIVar1);
										// IDirect3DRMFrame3->AddVisual(this, IDirect3DRMVisual* lpD3DRMVisual)
	(*(code *)unaff_EBP->lpVtbl->AddVisual)(unaff_EBP,*ppIVar1);
										// IDirect3DRMUserVisual->SetAppData(this, Struct_3c* ulData)
	(*(*ppIVar1)->lpVtbl->SetAppData)((IUnknown *)*ppIVar1,(DWORD)data);
	data->frame_28 = unaff_EBP;
	param_1->refCount_20 = param_1->refCount_20 + 1;
	param_1->flags = param_1->flags | 0x200000;
	data->refCount_20 = 0;
	return data;
}



int * __cdecl lego::res::Res_CreateLWO(char *filename,IDirect3DRMFrame3 *rmFrame3,BOOL isNoTexture)
{
	char *pcVar1;
	char cVar2;
	BOOL BVar3;
	Struct_34 *struct34;
	uint uVar4;
	uint uVar5;
	char *pcVar6;
	char *pcVar7;
	undefined4 *puVar8;
	undefined4 *puVar9;
	void *struct20;
	char filenameBuffer [260];
	
	uVar4 = 0xffffffff;
	pcVar7 = filename;
	do {
		pcVar6 = pcVar7;
		if (uVar4 == 0) break;
		uVar4 -= 1;
		pcVar6 = pcVar7 + 1;
		cVar2 = *pcVar7;
		pcVar7 = pcVar6;
	} while (cVar2 != '\0');
	uVar4 = ~uVar4;
	pcVar7 = filenameBuffer;
	puVar8 = (undefined4 *)(pcVar6 + -uVar4);
	puVar9 = (undefined4 *)filenameBuffer;
	for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
		*puVar9 = *puVar8;
		puVar8 = puVar8 + 1;
		puVar9 = puVar9 + 1;
	}
	for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
		*(undefined *)puVar9 = *(undefined *)puVar8;
		puVar8 = (undefined4 *)((int)puVar8 + 1);
		puVar9 = (undefined4 *)((int)puVar9 + 1);
	}
	pcVar6 = filenameBuffer;
	while (filenameBuffer[0] != '\0') {
		if (filenameBuffer[0] == '\\') {
			pcVar7 = pcVar6;
		}
		pcVar1 = pcVar6 + 1;
		pcVar6 = pcVar6 + 1;
		filenameBuffer[0] = *pcVar1;
	}
	pcVar7[pcVar7 != filenameBuffer] = '\0';
	BVar3 = Res_Unk_CreateMeshStruct20(filename,(int *)&struct20,0);
	if (BVar3 == 0) {
		return (int *)NULL;
	}
	struct34 = Res_Unk_CreateUserVisualStruct34(rmFrame3,0,0x3000,0,2);
	FUN_00480d80(filenameBuffer,struct34,(undefined4 *)struct20,isNoTexture);
	FUN_0048db30((undefined4 *)struct20);
	return (int *)struct34;
}



BOOL __cdecl FUN_00480d80(char *filename,Struct_34 *struct34,undefined4 *struct20,BOOL isNoTexture)
{
	float *pfVar1;
	float r;
	int iVar2;
	int iVar3;
	void *pvVar4;
	void *buffer;
	Vector3F **buffer_00;
	int *buffer_01;
	undefined4 *buffer_02;
	undefined2 *buffer_03;
	int *buffer_04;
	void *buffer_05;
	undefined4 *buffer_06;
	undefined4 *puVar5;
	undefined **ppuVar6;
	uint uVar7;
	int iVar8;
	int iVar9;
	float *pfVar10;
	int *piVar11;
	int iVar12;
	int iVar13;
	int iVar14;
	int iVar15;
	uint uVar16;
	float g;
	float fVar17;
	Point2I *pPVar18;
	Point2I *local_ac;
	uint local_a8;
	uint local_a4;
	int *local_a0;
	int *local_9c;
	void *local_98;
	undefined2 *local_8c;
	Vector3F **local_88;
	Point2I *local_78;
	void *local_74;
	int local_3c [4];
	undefined4 local_2c;
	undefined4 local_28;
	Vector3F local_24;
	Vector3F local_18;
	Vector3F local_c;
	
	iVar8 = struct20[1];
	local_3c[2] = 2;
	local_2c = 2;
	iVar2 = struct20[2];
	iVar12 = iVar8 * 2;
	iVar15 = iVar2 * 6;
	local_3c[0] = 0;
	local_3c[1] = 1;
	local_3c[3] = 0;
	local_28 = 3;
	local_74 = NULL;
	if (struct20[7] == 0) {
		local_78 = (Point2I *)std::malloc(iVar8 * 0x10);
	}
	else {
		local_74 = std::malloc(iVar8 * 0x140);
		FUN_00481f10((int)struct20,(int)local_74);
		iVar12 = struct20[1] * 2;
		local_78 = (Point2I *)std::malloc(struct20[3] * iVar12 * 8);
	}
	uVar16 = iVar12 * struct20[3];
	buffer = std::malloc(uVar16 * 0xc);
	buffer_00 = (Vector3F **)std::malloc(uVar16 * 4);
	buffer_01 = (int *)std::malloc(struct20[3] << 2);
	buffer_02 = (undefined4 *)std::malloc(uVar16 * 4);
	buffer_03 = (undefined2 *)std::malloc(iVar15 * struct20[3] * 4);
	buffer_04 = (int *)std::malloc(struct20[3] << 2);
	buffer_05 = std::malloc(struct20[2] * 0xc);
	buffer_06 = (undefined4 *)std::malloc(iVar12 * 0xc);
	piVar11 = buffer_01;
	for (uVar7 = struct20[3] & 0x3fffffff; uVar7 != 0; uVar7 -= 1) {
		*piVar11 = 0;
		piVar11 = piVar11 + 1;
	}
	for (iVar8 = 0; iVar8 != 0; iVar8 += -1) {
		*(undefined *)piVar11 = 0;
		piVar11 = (int *)((int)piVar11 + 1);
	}
	puVar5 = buffer_02;
	for (uVar16 &= 0x3fffffff; uVar16 != 0; uVar16 -= 1) {
		*puVar5 = 0xffffffff;
		puVar5 = puVar5 + 1;
	}
	for (iVar8 = 0; iVar8 != 0; iVar8 += -1) {
		*(undefined *)puVar5 = 0xff;
		puVar5 = (undefined4 *)((int)puVar5 + 1);
	}
	piVar11 = buffer_04;
	for (uVar7 = struct20[3] & 0x3fffffff; uVar7 != 0; uVar7 -= 1) {
		*piVar11 = 0;
		piVar11 = piVar11 + 1;
	}
	for (iVar8 = 0; iVar8 != 0; iVar8 += -1) {
		*(undefined *)piVar11 = 0;
		piVar11 = (int *)((int)piVar11 + 1);
	}
	puVar5 = buffer_06;
	for (uVar7 = iVar12 * 3 & 0x3fffffff; uVar7 != 0; uVar7 -= 1) {
		*puVar5 = 0;
		puVar5 = puVar5 + 1;
	}
	for (iVar8 = 0; iVar8 != 0; iVar8 += -1) {
		*(undefined *)puVar5 = 0;
		puVar5 = (undefined4 *)((int)puVar5 + 1);
	}
	puVar5 = (undefined4 *)std::malloc(struct20[3] * 0x3c);
	struct34->ptr_1c = puVar5;
	for (uVar7 = struct20[3] * 0xf & 0x3fffffff; uVar7 != 0; uVar7 -= 1) {
		*puVar5 = 0;
		puVar5 = puVar5 + 1;
	}
	for (iVar8 = 0; iVar8 != 0; iVar8 += -1) {
		*(undefined *)puVar5 = 0;
		puVar5 = (undefined4 *)((int)puVar5 + 1);
	}
	local_8c = NULL;
	if (struct20[2] != 0) {
		local_9c = NULL;
		do {
			iVar8 = struct20[5];
			iVar9 = struct20[4];
			pfVar10 = &local_24.y;
			uVar7 = 0;
			do {
				uVar16 = uVar7 + 2;
				uVar7 = (uint)*(ushort *)(uVar7 + *(int *)((int)local_9c + 8 + iVar8));
				pfVar10[-1] = *(float *)(iVar9 + uVar7 * 0xc);
				*pfVar10 = *(float *)(iVar9 + 4 + uVar7 * 0xc);
				pfVar10[1] = *(float *)(iVar9 + 8 + uVar7 * 0xc);
				pfVar10 = pfVar10 + 3;
				uVar7 = uVar16;
			} while (uVar16 < 6);
			lego::math::Vector3_VectorSqrtUnk
								((Vector3F *)((int)buffer_05 + (int)local_9c),&local_24,&local_18,&local_c);
			local_8c = (undefined2 *)((int)local_8c + 1);
			local_9c = (int *)((int)local_9c + 0xc);
		} while (local_8c < (uint)struct20[2]);
	}
	FUN_00481ae0(filename,(int)struct20,(int)struct34->ptr_1c,isNoTexture);
	iVar8 = 0;
	local_8c = NULL;
	if (struct20[2] != 0) {
		pfVar10 = (float *)((int)buffer_05 + 8);
		do {
			iVar9 = *(int *)(iVar8 + 4 + struct20[5]);
			iVar13 = iVar15 * iVar9;
			iVar9 = iVar12 * iVar9;
			if (*(int *)(iVar8 + struct20[5]) == 3) {
				local_a4 = 0;
				do {
					uVar7 = (uint)*(ushort *)(*(int *)(struct20[5] + iVar8 + 8) + local_a4);
					if (buffer_02[uVar7 + iVar9] == -1) {
						*(undefined4 *)
						 ((int)buffer + (buffer_01[*(int *)(struct20[5] + iVar8 + 4)] + iVar9) * 0xc) =
								 *(undefined4 *)(struct20[4] + uVar7 * 0xc);
						*(undefined4 *)
						 ((int)buffer + (buffer_01[*(int *)(iVar8 + 4 + struct20[5])] + iVar9) * 0xc + 4) =
								 *(undefined4 *)(struct20[4] + 4 + uVar7 * 0xc);
						*(undefined4 *)
						 ((int)buffer + (buffer_01[*(int *)(iVar8 + 4 + struct20[5])] + iVar9) * 0xc + 8) =
								 *(undefined4 *)(struct20[4] + 8 + uVar7 * 0xc);
						if (struct20[7] != 0) {
							uVar7 = (uint)*(ushort *)(*(int *)(struct20[5] + iVar8 + 8) + local_a4);
							iVar14 = buffer_01[*(int *)(struct20[5] + iVar8 + 4)];
							local_78[iVar14 + iVar9].x = *(int *)((int)local_74 + uVar7 * 8);
							local_78[iVar14 + iVar9].y = *(int *)((int)local_74 + uVar7 * 8 + 4);
						}
						uVar7 = (uint)*(ushort *)(*(int *)(iVar8 + 8 + struct20[5]) + local_a4);
						pfVar1 = (float *)(buffer_06 + uVar7 * 3);
						*pfVar1 = pfVar10[-2] + (float)buffer_06[uVar7 * 3];
						pfVar1[1] = pfVar1[1] + pfVar10[-1];
						pfVar1[2] = pfVar1[2] + *pfVar10;
						uVar7 = (uint)*(ushort *)(*(int *)(iVar8 + 8 + struct20[5]) + local_a4);
						pfVar1 = (float *)(buffer_06 + uVar7 * 3);
						fVar17 = 1.0 / SQRT(*pfVar1 * *pfVar1 +
																pfVar1[2] * pfVar1[2] +
																(float)buffer_06[uVar7 * 3 + 1] * (float)buffer_06[uVar7 * 3 + 1]);
						*pfVar1 = fVar17 * *pfVar1;
						pfVar1[1] = fVar17 * pfVar1[1];
						pfVar1[2] = fVar17 * pfVar1[2];
						buffer_00[buffer_01[*(int *)(struct20[5] + iVar8 + 4)] + iVar9] =
								 (Vector3F *)
								 (buffer_06 + (uint)*(ushort *)(*(int *)(struct20[5] + iVar8 + 8) + local_a4) * 3);
						iVar14 = *(int *)(iVar8 + 4 + struct20[5]);
						*(int *)(buffer_03 + (buffer_04[iVar14] + iVar13) * 2) = buffer_01[iVar14];
						buffer_04[*(int *)(iVar8 + 4 + struct20[5])] =
								 buffer_04[*(int *)(iVar8 + 4 + struct20[5])] + 1;
						buffer_02[(uint)*(ushort *)(*(int *)(struct20[5] + iVar8 + 8) + local_a4) + iVar9] =
								 buffer_01[*(int *)(struct20[5] + iVar8 + 4)];
						iVar14 = *(int *)(iVar8 + 4 + struct20[5]);
						piVar11 = buffer_01;
					}
					else {
						pfVar1 = (float *)(buffer_06 + uVar7 * 3);
						*pfVar1 = pfVar10[-2] + (float)buffer_06[uVar7 * 3];
						pfVar1[1] = pfVar1[1] + pfVar10[-1];
						pfVar1[2] = pfVar1[2] + *pfVar10;
						pfVar1 = (float *)(buffer_06 +
															(uint)*(ushort *)(*(int *)(iVar8 + 8 + struct20[5]) + local_a4) * 3);
						fVar17 = 1.0 / SQRT(*pfVar1 * *pfVar1 + pfVar1[2] * pfVar1[2] + pfVar1[1] * pfVar1[1]);
						*pfVar1 = fVar17 * *pfVar1;
						pfVar1[1] = fVar17 * pfVar1[1];
						pfVar1[2] = fVar17 * pfVar1[2];
						*(undefined4 *)(buffer_03 + (buffer_04[*(int *)(struct20[5] + iVar8 + 4)] + iVar13) * 2)
								 = buffer_02[(uint)*(ushort *)(*(int *)(struct20[5] + iVar8 + 8) + local_a4) + iVar9
														];
						iVar14 = *(int *)(iVar8 + 4 + struct20[5]);
						piVar11 = buffer_04;
					}
					local_a4 += 2;
					piVar11[iVar14] = piVar11[iVar14] + 1;
				} while (local_a4 < 6);
			}
			else {
				local_9c = local_3c;
				local_a8 = 6;
				do {
					iVar14 = *local_9c * 2;
					uVar7 = (uint)*(ushort *)(*(int *)(struct20[5] + iVar8 + 8) + iVar14);
					if (buffer_02[iVar9 + uVar7] == -1) {
						*(undefined4 *)
						 ((int)buffer + (buffer_01[*(int *)(struct20[5] + iVar8 + 4)] + iVar9) * 0xc) =
								 *(undefined4 *)(struct20[4] + uVar7 * 0xc);
						*(undefined4 *)
						 ((int)buffer + (buffer_01[*(int *)(iVar8 + 4 + struct20[5])] + iVar9) * 0xc + 4) =
								 *(undefined4 *)(struct20[4] + 4 + uVar7 * 0xc);
						*(undefined4 *)
						 ((int)buffer + (buffer_01[*(int *)(iVar8 + 4 + struct20[5])] + iVar9) * 0xc + 8) =
								 *(undefined4 *)(struct20[4] + 8 + uVar7 * 0xc);
						if (struct20[7] != 0) {
							uVar7 = (uint)*(ushort *)(*(int *)(struct20[5] + iVar8 + 8) + iVar14);
							iVar3 = buffer_01[*(int *)(struct20[5] + iVar8 + 4)];
							local_78[iVar3 + iVar9].x = *(int *)((int)local_74 + uVar7 * 8);
							local_78[iVar3 + iVar9].y = *(int *)((int)local_74 + uVar7 * 8 + 4);
						}
						uVar7 = (uint)*(ushort *)(*(int *)(iVar8 + 8 + struct20[5]) + iVar14);
						pfVar1 = (float *)(buffer_06 + uVar7 * 3);
						*pfVar1 = pfVar10[-2] + (float)buffer_06[uVar7 * 3];
						pfVar1[1] = pfVar1[1] + pfVar10[-1];
						pfVar1[2] = pfVar1[2] + *pfVar10;
						uVar7 = (uint)*(ushort *)(*(int *)(iVar8 + 8 + struct20[5]) + iVar14);
						pfVar1 = (float *)(buffer_06 + uVar7 * 3);
						fVar17 = 1.0 / SQRT(*pfVar1 * *pfVar1 +
																(float)buffer_06[uVar7 * 3 + 2] * (float)buffer_06[uVar7 * 3 + 2] +
																(float)buffer_06[uVar7 * 3 + 1] * (float)buffer_06[uVar7 * 3 + 1]);
						*pfVar1 = fVar17 * *pfVar1;
						pfVar1[1] = fVar17 * pfVar1[1];
						pfVar1[2] = fVar17 * pfVar1[2];
						buffer_00[buffer_01[*(int *)(struct20[5] + iVar8 + 4)] + iVar9] =
								 (Vector3F *)
								 (buffer_06 + (uint)*(ushort *)(*(int *)(struct20[5] + iVar8 + 8) + iVar14) * 3);
						iVar3 = *(int *)(iVar8 + 4 + struct20[5]);
						*(int *)(buffer_03 + (buffer_04[iVar3] + iVar13) * 2) = buffer_01[iVar3];
						buffer_04[*(int *)(iVar8 + 4 + struct20[5])] =
								 buffer_04[*(int *)(iVar8 + 4 + struct20[5])] + 1;
						buffer_02[(uint)*(ushort *)(*(int *)(struct20[5] + iVar8 + 8) + iVar14) + iVar9] =
								 buffer_01[*(int *)(struct20[5] + iVar8 + 4)];
						piVar11 = buffer_01;
					}
					else {
						pfVar1 = (float *)(buffer_06 + uVar7 * 3);
						*pfVar1 = pfVar10[-2] + (float)buffer_06[uVar7 * 3];
						pfVar1[1] = pfVar1[1] + pfVar10[-1];
						pfVar1[2] = pfVar1[2] + *pfVar10;
						pfVar1 = (float *)(buffer_06 +
															(uint)*(ushort *)(*(int *)(iVar8 + 8 + struct20[5]) + iVar14) * 3);
						fVar17 = 1.0 / SQRT(*pfVar1 * *pfVar1 + pfVar1[2] * pfVar1[2] + pfVar1[1] * pfVar1[1]);
						*pfVar1 = *pfVar1 * fVar17;
						pfVar1[1] = fVar17 * pfVar1[1];
						pfVar1[2] = fVar17 * pfVar1[2];
						*(undefined4 *)(buffer_03 + (buffer_04[*(int *)(struct20[5] + iVar8 + 4)] + iVar13) * 2)
								 = buffer_02[(uint)*(ushort *)(*(int *)(struct20[5] + iVar8 + 8) + iVar14) + iVar9];
						piVar11 = buffer_04;
					}
					piVar11[*(int *)(iVar8 + 4 + struct20[5])] =
							 piVar11[*(int *)(iVar8 + 4 + struct20[5])] + 1;
					local_9c = local_9c + 1;
					local_a8 += -1;
				} while (local_a8 != 0);
			}
			local_8c = (undefined2 *)((int)local_8c + 1);
			iVar8 += 0xc;
			pfVar10 = pfVar10 + 3;
		} while (local_8c < (uint)struct20[2]);
	}
	iVar8 = 0;
	local_a8 = 0;
	if (struct20[3] != 0) {
		local_a4 = 0;
		local_ac = local_78;
		local_a0 = buffer_01;
		local_98 = buffer;
		local_8c = buffer_03;
		local_88 = buffer_00;
		do {
			uVar7 = *(uint *)((int)((int)buffer_04 - (int)buffer_01) + (int)local_a0);
			iVar15 = FUN_004824e0(struct34,uVar7,uVar7 / 3,3,local_8c);
			if (struct20[7] == 0) {
				iVar9 = struct20[6] + local_a4;
				FUN_00482260(*local_a0,(int)local_98,(float *)local_78,*(float *)(iVar9 + 0x24),
										 *(float *)(iVar9 + 0x28),*(float *)(iVar9 + 0x2c),*(float *)(iVar9 + 0x30),
										 *(float *)(iVar9 + 0x34),*(float *)(iVar9 + 0x38),*(uint *)(iVar9 + 0x14));
				iVar9 = *local_a0;
				pPVar18 = local_78;
			}
			else {
				iVar9 = *local_a0;
				pPVar18 = local_ac;
			}
			FUN_00482980(struct34,iVar15,0,iVar9,(int)local_98,local_88,pPVar18);
			if ((*(uint *)(iVar8 + 0x30 + (int)struct34->ptr_1c) & 0x200) == 0) {
				uVar7 = 0x3000;
			}
			else {
				lego::res::Res_Struct34_SetTable10_Field64(struct34,iVar15,0x2800);
				uVar7 = 0x2800;
			}
			if ((*(uint *)(iVar8 + 0x30 + (int)struct34->ptr_1c) & 0x100) != 0) {
				uVar7 |= 0x4000000;
				lego::res::Res_Struct34_SetTable10_Field64(struct34,iVar15,uVar7);
			}
			if ((*(byte *)(iVar8 + 0x34 + (int)struct34->ptr_1c) & 0x20) == 0) {
				lego::res::Res_Struct34_SetTable10_Field64(struct34,iVar15,uVar7 | 0x800000);
			}
			if ((*(byte *)(local_a4 + 0x14 + struct20[6]) & 0x80) == 0) {
				ppuVar6 = *(undefined ***)(iVar8 + 4 + (int)struct34->ptr_1c);
				if (ppuVar6 != NULL) goto LAB_004818c5;
			}
			else {
				ppuVar6 = *(undefined ***)(iVar8 + (int)struct34->ptr_1c);
				if (ppuVar6 != NULL) {
					ppuVar6 = (undefined **)*ppuVar6;
LAB_004818c5:
					FUN_00483380(struct34,iVar15,ppuVar6);
				}
			}
			pvVar4 = struct34->ptr_1c;
			iVar9 = iVar8 + (int)pvVar4;
			FUN_00483530(struct34,iVar15,*(float *)(iVar9 + 0xc) * *(float *)(iVar9 + 0x1c),
									 *(float *)(iVar9 + 0x10) * *(float *)(iVar9 + 0x1c),
									 *(float *)(iVar8 + 0x14 + (int)pvVar4) * *(float *)(iVar8 + 0x1c + (int)pvVar4),0
									);
			iVar9 = (int)struct34->ptr_1c + iVar8;
			FUN_00483530(struct34,iVar15,*(float *)(iVar9 + 0xc) * *(float *)(iVar9 + 0x20),
									 *(float *)(iVar9 + 0x10) * *(float *)(iVar9 + 0x20),
									 *(float *)(iVar9 + 0x14) * *(float *)(iVar9 + 0x20),3);
			iVar9 = iVar8 + (int)struct34->ptr_1c;
			if ((*(byte *)(iVar8 + 0x30 + (int)struct34->ptr_1c) & 8) == 0) {
				fVar17 = *(float *)(iVar9 + 0x24);
				g = *(float *)(iVar9 + 0x24);
				r = *(float *)(iVar9 + 0x24);
			}
			else {
				fVar17 = *(float *)(iVar9 + 0x14) * *(float *)(iVar9 + 0x24);
				g = *(float *)(iVar9 + 0x10) * *(float *)(iVar9 + 0x24);
				r = *(float *)(iVar9 + 0xc) * *(float *)(iVar9 + 0x24);
			}
			FUN_00483530(struct34,iVar15,r,g,fVar17,2);
			FUN_004836e0(struct34,iVar15,*(float *)(iVar8 + 0x28 + (int)struct34->ptr_1c) * 10.0,5);
			FUN_004836e0(struct34,iVar15,1.0 - *(float *)(iVar8 + 0x2c + (int)struct34->ptr_1c),4);
			iVar9 = iVar8 + (int)struct34->ptr_1c;
			iVar8 += 0x3c;
			*(int *)&struct34->lwoTable_8[iVar15].field_0x68 = iVar9;
			local_ac = local_ac + iVar12;
			local_88 = local_88 + iVar12;
			local_98 = (void *)((int)local_98 + iVar12 * 0xc);
			local_8c = local_8c + iVar2 * 0xc;
			local_a0 = local_a0 + 1;
			local_a8 += 1;
			local_a4 += 0x54;
		} while (local_a8 < (uint)struct20[3]);
	}
	std::free(buffer);
	std::free(buffer_00);
	std::free(local_78);
	std::free(buffer_01);
	std::free(buffer_02);
	std::free(buffer_03);
	std::free(buffer_04);
	std::free(buffer_05);
	std::free(buffer_06);
	if (local_74 != NULL) {
		std::free(local_74);
	}
	return 1;
}



void __cdecl FUN_00481ae0(char *param_1,int param_2,int param_3,int param_4)
{
	byte bVar1;
	char *pcVar2;
	int *piVar3;
	void *pvVar4;
	int **ppiVar5;
	float fVar6;
	float *pfVar7;
	int iVar8;
	uint local_618;
	uint local_614;
	int local_610;
	int local_60c;
	undefined4 local_608;
	char local_604 [260];
	char local_500 [256];
	char local_400 [256];
	char local_300 [256];
	char local_200 [256];
	char local_100 [256];
	
	local_614 = 0;
	if (*(int *)(param_2 + 0xc) != 0) {
		pfVar7 = (float *)(param_3 + 0xc);
		iVar8 = 0;
		do {
			pcVar2 = *(char **)(iVar8 + 8 + *(int *)(param_2 + 0x18));
			if ((pcVar2 == NULL) || (param_4 != 0)) {
				*pfVar7 = (float)(uint)*(byte *)(iVar8 + *(int *)(param_2 + 0x18) + 0xc) * 0.00390625;
				pfVar7[1] = (float)(uint)*(byte *)(iVar8 + 0xd + *(int *)(param_2 + 0x18)) * 0.00390625;
				bVar1 = *(byte *)(iVar8 + 0xe + *(int *)(param_2 + 0x18));
LAB_00481d09:
				local_618 = (uint)bVar1;
				pfVar7[2] = (float)local_618 * 0.00390625;
			}
			else {
				FUN_00490350(pcVar2,&local_608,(undefined4 *)local_100,(undefined4 *)local_400,
										 (undefined4 *)local_500);
				if ((*(byte *)(iVar8 + 0x14 + *(int *)(param_2 + 0x18)) & 0x80) == 0) {
					std::sprintf(local_604,"%s%s",local_400,local_500);
					ppiVar5 = lego::draw::Draw_LoadAnimFrame(param_1,local_604,0,0);
					pfVar7[-2] = (float)ppiVar5;
				}
				else {
					piVar3 = FUN_00481d80(local_400,local_200,&local_60c,&local_610);
					if (piVar3 != NULL) {
						pvVar4 = std::malloc(400);
						pfVar7[-3] = (float)pvVar4;
						fVar6 = 0.0;
						do {
							FUN_00481e40(local_200,local_300,&local_60c,local_610);
							std::sprintf(local_604,"%s%s",local_300,local_500);
							ppiVar5 = lego::draw::Draw_LoadAnimFrame(param_1,local_604,0,0);
							*(int ***)((int)pfVar7[-3] + (int)fVar6 * 4) = ppiVar5;
							if (*(int *)((int)pfVar7[-3] + (int)fVar6 * 4) == 0) break;
							fVar6 = (float)((int)fVar6 + 1);
						} while ((uint)fVar6 < 100);
						pfVar7[-1] = fVar6;
						piVar3 = FUN_0048df40((LwoFrame *)pfVar7[-3],(int)fVar6 * 4);
						pfVar7[-3] = (float)piVar3;
					}
				}
				if ((*(byte *)(iVar8 + 0x18 + *(int *)(param_2 + 0x18)) & 0x80) != 0) {
					*pfVar7 = (float)(uint)*(byte *)(iVar8 + *(int *)(param_2 + 0x18) + 0xc) * 0.00390625;
					pfVar7[1] = (float)(uint)*(byte *)(iVar8 + 0xd + *(int *)(param_2 + 0x18)) * 0.00390625;
					bVar1 = *(byte *)(iVar8 + 0xe + *(int *)(param_2 + 0x18));
					goto LAB_00481d09;
				}
				*pfVar7 = 1.0;
				pfVar7[1] = 1.0;
				pfVar7[2] = 1.0;
			}
			pfVar7[5] = *(float *)(iVar8 + 0x3c + *(int *)(param_2 + 0x18));
			pfVar7[8] = *(float *)(iVar8 + 0x40 + *(int *)(param_2 + 0x18));
			pfVar7[4] = *(float *)(iVar8 + 0x44 + *(int *)(param_2 + 0x18));
			pfVar7[6] = *(float *)(iVar8 + 0x4c + *(int *)(param_2 + 0x18));
			pfVar7[7] = *(float *)(iVar8 + 0x50 + *(int *)(param_2 + 0x18));
			pfVar7[9] = *(float *)(iVar8 + 0x18 + *(int *)(param_2 + 0x18));
			pfVar7[10] = *(float *)(iVar8 + 0x14 + *(int *)(param_2 + 0x18));
			local_614 += 1;
			pfVar7 = pfVar7 + 0xf;
			iVar8 = iVar8 + 0x54;
		} while (local_614 < *(uint *)(param_2 + 0xc));
	}
	return;
}



int * __cdecl FUN_00481d80(char *str,char *out_str,int *out_value,int *out_unkposition)
{
	char cVar1;
	byte bVar2;
	uint uVar3;
	uint uVar4;
	uint uVar5;
	int iVar6;
	int iVar7;
	undefined4 *puVar8;
	char *pcVar9;
	char *pcVar10;
	undefined4 *puVar11;
	bool bVar12;
	int local_4;
	
	pcVar9 = str;
	uVar3 = 0xffffffff;
	pcVar10 = str;
	do {
		if (uVar3 == 0) break;
		uVar3 -= 1;
		cVar1 = *pcVar10;
		pcVar10 = pcVar10 + 1;
	} while (cVar1 != '\0');
	uVar3 = ~uVar3;
	iVar6 = 1;
	local_4 = 0;
	if ((0x2f < (byte)str[uVar3 - 2]) && ((byte)str[uVar3 - 2] < 0x3a)) {
		iVar7 = uVar3 - 2;
		bVar12 = iVar7 == 0;
		if (!bVar12) {
			do {
				bVar2 = pcVar9[iVar7];
				str = (char *)(uint)bVar2;
				if ((bVar2 < 0x30) || (0x39 < bVar2)) break;
				local_4 += (int)(str + -0x30) * iVar6;
				iVar6 *= 10;
				iVar7 += -1;
			} while (iVar7 != 0);
			bVar12 = iVar7 == 0;
		}
		if (!bVar12) {
			uVar4 = 0xffffffff;
			do {
				pcVar10 = pcVar9;
				if (uVar4 == 0) break;
				uVar4 -= 1;
				pcVar10 = pcVar9 + 1;
				cVar1 = *pcVar9;
				pcVar9 = pcVar10;
			} while (cVar1 != '\0');
			uVar4 = ~uVar4;
			puVar8 = (undefined4 *)(pcVar10 + -uVar4);
			puVar11 = (undefined4 *)out_str;
			for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
				*puVar11 = *puVar8;
				puVar8 = puVar8 + 1;
				puVar11 = puVar11 + 1;
			}
			for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
				*(undefined *)puVar11 = *(undefined *)puVar8;
				puVar8 = (undefined4 *)((int)puVar8 + 1);
				puVar11 = (undefined4 *)((int)puVar11 + 1);
			}
			out_str[iVar7 + 1] = '\0';
			*out_unkposition = (uVar3 - iVar7) + -2;
			*out_value = local_4;
			return out_unkposition;
		}
	}
	return NULL;
}



void __cdecl FUN_00481e40(char *param_1,char *param_2,int *param_3,int param_4)
{
	char cVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	int iVar5;
	undefined4 *puVar6;
	char *pcVar7;
	char *pcVar8;
	char *pcVar9;
	undefined4 *puVar10;
	char local_10 [16];
	
	uVar3 = 0xffffffff;
	do {
		pcVar8 = param_1;
		if (uVar3 == 0) break;
		uVar3 -= 1;
		pcVar8 = param_1 + 1;
		cVar1 = *param_1;
		param_1 = pcVar8;
	} while (cVar1 != '\0');
	uVar3 = ~uVar3;
	puVar6 = (undefined4 *)(pcVar8 + -uVar3);
	puVar10 = (undefined4 *)param_2;
	for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
		*puVar10 = *puVar6;
		puVar6 = puVar6 + 1;
		puVar10 = puVar10 + 1;
	}
	for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
		*(undefined *)puVar10 = *(undefined *)puVar6;
		puVar6 = (undefined4 *)((int)puVar6 + 1);
		puVar10 = (undefined4 *)((int)puVar10 + 1);
	}
	std::sprintf(local_10,&DAT_004aa4c4,*param_3);
	uVar3 = 0xffffffff;
	pcVar8 = local_10;
	do {
		if (uVar3 == 0) break;
		uVar3 -= 1;
		cVar1 = *pcVar8;
		pcVar8 = pcVar8 + 1;
	} while (cVar1 != '\0');
	iVar2 = param_4 - (~uVar3 - 1);
	while (iVar2 != 0) {
		uVar3 = 0xffffffff;
		pcVar8 = "0";
		do {
			pcVar7 = pcVar8;
			if (uVar3 == 0) break;
			uVar3 -= 1;
			pcVar7 = pcVar8 + 1;
			cVar1 = *pcVar8;
			pcVar8 = pcVar7;
		} while (cVar1 != '\0');
		uVar3 = ~uVar3;
		iVar5 = -1;
		pcVar8 = param_2;
		do {
			pcVar9 = pcVar8;
			if (iVar5 == 0) break;
			iVar5 += -1;
			pcVar9 = pcVar8 + 1;
			cVar1 = *pcVar8;
			pcVar8 = pcVar9;
		} while (cVar1 != '\0');
		puVar6 = (undefined4 *)(pcVar7 + -uVar3);
		puVar10 = (undefined4 *)(pcVar9 + -1);
		for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
			*puVar10 = *puVar6;
			puVar6 = puVar6 + 1;
			puVar10 = puVar10 + 1;
		}
		iVar2 += -1;
		for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
			*(undefined *)puVar10 = *(undefined *)puVar6;
			puVar6 = (undefined4 *)((int)puVar6 + 1);
			puVar10 = (undefined4 *)((int)puVar10 + 1);
		}
	}
	uVar3 = 0xffffffff;
	*param_3 = *param_3 + 1;
	pcVar8 = local_10;
	do {
		pcVar7 = pcVar8;
		if (uVar3 == 0) break;
		uVar3 -= 1;
		pcVar7 = pcVar8 + 1;
		cVar1 = *pcVar8;
		pcVar8 = pcVar7;
	} while (cVar1 != '\0');
	uVar3 = ~uVar3;
	iVar2 = -1;
	do {
		pcVar8 = param_2;
		if (iVar2 == 0) break;
		iVar2 += -1;
		pcVar8 = param_2 + 1;
		cVar1 = *param_2;
		param_2 = pcVar8;
	} while (cVar1 != '\0');
	puVar6 = (undefined4 *)(pcVar7 + -uVar3);
	puVar10 = (undefined4 *)(pcVar8 + -1);
	for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
		*puVar10 = *puVar6;
		puVar6 = puVar6 + 1;
		puVar10 = puVar10 + 1;
	}
	for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
		*(undefined *)puVar10 = *(undefined *)puVar6;
		puVar6 = (undefined4 *)((int)puVar6 + 1);
		puVar10 = (undefined4 *)((int)puVar10 + 1);
	}
	return;
}



void __cdecl FUN_00481f10(int param_1,int param_2)
{
	int iVar1;
	float fVar2;
	float fVar3;
	char cVar4;
	FileStream *file;
	bool bVar5;
	undefined4 *buffer;
	char *pcVar6;
	int *piVar7;
	uint uVar8;
	int iVar9;
	uint uVar10;
	undefined4 *puVar11;
	char *pcVar12;
	undefined4 *puVar13;
	float10 fVar14;
	int local_840;
	int local_83c;
	int local_838;
	uint local_834;
	int local_830;
	int local_820;
	byte *local_814;
	char *local_810;
	char local_800 [1024];
	undefined4 local_400 [256];
	
	file = *(FileStream **)(param_1 + 0x1c);
	local_838 = -1;
	local_83c = -1;
	local_830 = 0;
	local_840 = -2;
	local_834 = 0;
	buffer = (undefined4 *)std::malloc(*(int *)(param_1 + 4) << 3);
	puVar11 = buffer;
	for (uVar8 = (uint)(*(int *)(param_1 + 4) << 3) >> 2; uVar8 != 0; uVar8 -= 1) {
		*puVar11 = 0;
		puVar11 = puVar11 + 1;
	}
	for (iVar9 = 0; iVar9 != 0; iVar9 += -1) {
		*(undefined *)puVar11 = 0;
		puVar11 = (undefined4 *)((int)puVar11 + 1);
	}
	pcVar6 = lego::file::File_GetS_StripLineEnd(local_800,0x400,file);
	do {
		if (pcVar6 == NULL) {
			std::free(buffer);
			return;
		}
		uVar8 = 0xffffffff;
		pcVar6 = local_800;
		do {
			pcVar12 = pcVar6;
			if (uVar8 == 0) break;
			uVar8 -= 1;
			pcVar12 = pcVar6 + 1;
			cVar4 = *pcVar6;
			pcVar6 = pcVar12;
		} while (cVar4 != '\0');
		uVar8 = ~uVar8;
		puVar11 = (undefined4 *)(pcVar12 + -uVar8);
		puVar13 = local_400;
		for (uVar10 = uVar8 >> 2; uVar10 != 0; uVar10 -= 1) {
			*puVar13 = *puVar11;
			puVar11 = puVar11 + 1;
			puVar13 = puVar13 + 1;
		}
		for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
			*(undefined *)puVar13 = *(undefined *)puVar11;
			puVar11 = (undefined4 *)((int)puVar11 + 1);
			puVar13 = (undefined4 *)((int)puVar13 + 1);
		}
		iVar9 = FUN_00477770((char *)local_400,&local_814);
		if (iVar9 != 0) {
			if (local_830 == 2) {
				local_838 = 0;
			}
			if (local_838 != -1) {
				if (local_838 < *(int *)(param_1 + 0xc) * 2) {
					if (*(int *)(param_1 + 0xc) <= local_838) {
						pcVar6 = std::_strdup((char *)local_814);
						*(char **)(*(int *)(param_1 + 0x18) + 8 + (local_838 - *(int *)(param_1 + 0xc)) * 0x54)
								 = pcVar6;
					}
					local_838 += 1;
				}
				else {
					local_838 = -1;
					local_840 = -1;
				}
			}
			if (local_840 != -2) {
				if (local_840 == -1) {
					local_840 = 0;
				}
				else {
					if (*(int *)(param_1 + 8) <= local_840) {
						return;
					}
					if ((local_83c == -1) ||
						 (iVar9 = local_820 * 0xc, *(int *)(iVar9 + *(int *)(param_1 + 0x14)) <= local_83c)) {
						if (local_840 < *(int *)(param_1 + 8) + -1) {
							local_820 = std::atoi((char *)local_814);
							if (local_83c != -1) {
								local_840 += 1;
							}
							local_83c = 0;
						}
					}
					else {
						fVar14 = std::atof((char *)local_814);
						fVar2 = (float)fVar14;
						fVar14 = std::atof(local_810);
						fVar3 = (float)-fVar14;
						uVar8 = (uint)*(ushort *)
													 (*(int *)(iVar9 + 8 + *(int *)(param_1 + 0x14)) + local_83c * 2);
						if ((*(float *)(param_2 + uVar8 * 8) == fVar2) &&
							 (*(float *)(param_2 + 4 + uVar8 * 8) == fVar3)) {
							bVar5 = false;
						}
						else {
							bVar5 = true;
						}
						if (buffer[uVar8] == 0) {
							*(float *)(param_2 + uVar8 * 8) = fVar2;
							*(float *)(param_2 + 4 +
												(uint)*(ushort *)
															 (*(int *)(iVar9 + 8 + *(int *)(param_1 + 0x14)) + local_83c * 2) * 8)
									 = fVar3;
							iVar1 = local_83c * 2;
							local_83c += 1;
							buffer[*(ushort *)(*(int *)(iVar9 + 8 + *(int *)(param_1 + 0x14)) + iVar1)] = 1;
						}
						else {
							if (bVar5) {
								if (local_834 == 0) {
									piVar7 = FUN_0048df40(*(LwoFrame **)(param_1 + 0x10),
																				(*(int *)(param_1 + 4) + 0xb) * 0xc);
									*(int **)(param_1 + 0x10) = piVar7;
								}
								uVar8 = (uint)*(ushort *)
															 (*(int *)(iVar9 + 8 + *(int *)(param_1 + 0x14)) + local_83c * 2);
								iVar1 = *(int *)(param_1 + 4);
								*(undefined4 *)(*(int *)(param_1 + 0x10) + iVar1 * 0xc) =
										 *(undefined4 *)(*(int *)(param_1 + 0x10) + uVar8 * 0xc);
								*(undefined4 *)(*(int *)(param_1 + 0x10) + 4 + iVar1 * 0xc) =
										 *(undefined4 *)(*(int *)(param_1 + 0x10) + 4 + uVar8 * 0xc);
								*(undefined4 *)(*(int *)(param_1 + 0x10) + 8 + iVar1 * 0xc) =
										 *(undefined4 *)(*(int *)(param_1 + 0x10) + 8 + uVar8 * 0xc);
								*(undefined2 *)(*(int *)(iVar9 + 8 + *(int *)(param_1 + 0x14)) + local_83c * 2) =
										 *(undefined2 *)(param_1 + 4);
								*(float *)(param_2 +
													(uint)*(ushort *)
																 (*(int *)(iVar9 + 8 + *(int *)(param_1 + 0x14)) + local_83c * 2) *
													8) = fVar2;
								*(float *)(param_2 + 4 +
													(uint)*(ushort *)
																 (*(int *)(iVar9 + 8 + *(int *)(param_1 + 0x14)) + local_83c * 2) *
													8) = fVar3;
								local_834 += 1;
								*(int *)(param_1 + 4) = *(int *)(param_1 + 4) + 1;
								if (9 < local_834) {
									local_834 = 0;
								}
							}
							local_83c += 1;
						}
					}
				}
			}
			local_830 += 1;
		}
		pcVar6 = lego::file::File_GetS_StripLineEnd(local_800,0x400,file);
	} while( true );
}



void __cdecl
FUN_00482260(int param_1,int param_2,float *param_3,float param_4,float param_5,float param_6,
						float param_7,float param_8,float param_9,uint param_10)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float *pfVar4;
	
	if (param_1 != 0) {
		pfVar4 = (float *)(param_2 + 8);
		do {
			fVar1 = pfVar4[-1];
			fVar2 = *pfVar4;
			if ((param_10 & 1) == 0) {
				fVar3 = (pfVar4[-2] - param_7) / param_4;
			}
			else {
				fVar3 = (fVar2 - param_9) / param_6;
			}
			*param_3 = fVar3 - -0.5;
			if ((param_10 & 2) == 0) {
				fVar1 = (fVar1 - param_8) / param_5;
			}
			else {
				fVar1 = (fVar2 - param_9) / param_6;
			}
			pfVar4 = pfVar4 + 3;
			param_1 += -1;
			param_3[1] = fVar1 - -0.5;
			param_3 = param_3 + 2;
		} while (param_1 != 0);
	}
	return;
}



undefined4 __cdecl FUN_00482300(uint *param_1,float param_2)
{
	int *piVar1;
	int iVar2;
	int iVar3;
	uint index;
	float10 fVar4;
	longlong lVar5;
	
	fVar4 = (float10)FUN_0048e46a();
	lVar5 = __ftol((float10)param_2 - fVar4);
	if ((*(byte *)(param_1 + 0xb) & 4) == 0) {
		return 0;
	}
	index = 0;
	if (*param_1 != 0) {
		iVar3 = 0;
		do {
			piVar1 = *(int **)(param_1[2] + iVar3 + 0x68);
			if (((*(byte *)(piVar1 + 0xd) & 0x80) != 0) && (piVar1[2] != 0)) {
				iVar2 = (piVar1[0xe] + (int)lVar5) % piVar1[2];
				if (iVar2 < 0) {
					iVar2 = 0;
				}
				FUN_00483380((Struct_34 *)param_1,index,*(undefined ***)(*piVar1 + iVar2 * 4));
			}
			index += 1;
			iVar3 += 0x70;
		} while (index < *param_1);
	}
	return 1;
}



void __cdecl FUN_00482390(Struct_34 *struct34,IDirect3DRMFrame3 *rmFrame3)
{
	Struct_34 *pSVar1;
	IDirect3DRMUserVisual *pIVar2;
	uint uVar3;
	uint index;
	int iVar4;
	int iVar5;
	
	(*(code *)rmFrame3->lpVtbl->DeleteVisual)(rmFrame3,struct34->userVisual_c);
	pSVar1 = struct34->struct34_24;
	index = 0;
	if (pSVar1 != NULL) {
		pIVar2 = struct34->userVisual_c;
		if (pIVar2 != NULL) {
			(*pIVar2->lpVtbl->Release)((IUnknown *)pIVar2);
			struct34->userVisual_c = NULL;
		}
		std::free(struct34->lwoTable_8);
		lego::pool::ReservedPool_Struct_34___Release(struct34);
		struct34 = pSVar1;
	}
	uVar3 = struct34->refCount_20 - 1;
	struct34->refCount_20 = uVar3;
	if (uVar3 == 0) {
		pIVar2 = struct34->userVisual_c;
		if (pIVar2 != NULL) {
			(*pIVar2->lpVtbl->Release)((IUnknown *)pIVar2);
			struct34->userVisual_c = NULL;
		}
		if (struct34->count_0 != 0) {
			iVar4 = 0;
			do {
				iVar5 = (int)&struct34->lwoTable_8->dwSize + iVar4;
				FUN_00483400(struct34,index);
				std::free(*(void **)(iVar5 + 8));
				std::free(*(void **)(iVar5 + 0xc));
				index += 1;
				iVar4 += 0x70;
			} while (index < struct34->count_0);
		}
		if (struct34->ptr_1c != NULL) {
			std::free(struct34->ptr_1c);
		}
		std::free(struct34->lwoTable_8);
		lego::pool::ReservedPool_Struct_34___Release(struct34);
	}
	return;
}



void __cdecl
FUN_00482460(Struct_34 *struct34,int param_2,uint *param_3,undefined4 param_4,undefined4 *param_5,
						uint *param_6,uint *param_7)
{
	int iVar1;
	LwoFrame *pLVar2;
	uint uVar3;
	
	pLVar2 = struct34->lwoTable_8 + param_2;
	if (param_3 != NULL) {
		*param_3 = *(uint *)&pLVar2->field_0x4;
	}
	if (param_5 != NULL) {
		*param_5 = 3;
	}
	if (param_6 != NULL) {
		*param_6 = pLVar2->dwSize;
	}
	if ((param_7 != NULL) && (uVar3 = 0, pLVar2->dwSize != 0)) {
		do {
			iVar1 = uVar3 * 2;
			uVar3 += 1;
			*param_7 = (uint)*(ushort *)(*(int *)&pLVar2->field_0x8 + iVar1);
			param_7 = param_7 + 1;
		} while (uVar3 < pLVar2->dwSize);
	}
	return;
}



uint __cdecl lego::res::Res_Struct34_GetField0(Struct_34 *param_1)
{
	return param_1->count_0;
}



int __cdecl
FUN_004824e0(Struct_34 *param_1,uint param_2,int param_3,int param_4,undefined2 *param_5)
{
	undefined2 uVar1;
	LwoFrame *pLVar2;
	void *pvVar3;
	uint uVar4;
	undefined4 *puVar5;
	int iVar6;
	LwoFrame *pLVar7;
	uint uVar8;
	
	if (param_1->lwoTable_8 == NULL) {
		param_1->field_4 = 10;
		param_1->count_0 = 1;
		pLVar2 = (LwoFrame *)std::malloc(0x460);
		param_1->lwoTable_8 = pLVar2;
	}
	else {
		uVar4 = param_1->count_0;
		param_1->count_0 = uVar4 + 1;
		if (uVar4 == param_1->field_4) {
			uVar4 = (uint)(param_1->field_4 * 0x96) / 100;
			pLVar2 = (LwoFrame *)FUN_0048df40(param_1->lwoTable_8,uVar4 * 0x70);
			if (pLVar2 == NULL) {
				return -1;
			}
			param_1->lwoTable_8 = pLVar2;
			param_1->field_4 = uVar4;
		}
	}
	pLVar2 = param_1->lwoTable_8 + (param_1->count_0 - 1);
	pLVar7 = pLVar2;
	for (iVar6 = 0x1c; iVar6 != 0; iVar6 += -1) {
		pLVar7->dwSize = 0;
		pLVar7 = (LwoFrame *)&pLVar7->field_0x4;
	}
	uVar8 = param_4 * param_3;
	pvVar3 = std::malloc(uVar8 * 2);
	*(void **)&pLVar2->field_0x8 = pvVar3;
	uVar4 = 0;
	pLVar2->dwSize = uVar8;
	if (uVar8 != 0) {
		do {
			uVar1 = *param_5;
			param_5 = param_5 + 2;
			*(undefined2 *)(*(int *)&pLVar2->field_0x8 + uVar4 * 2) = uVar1;
			uVar4 += 1;
		} while (uVar4 < pLVar2->dwSize);
	}
	puVar5 = (undefined4 *)std::malloc(param_2 << 5);
	*(undefined4 **)&pLVar2->field_0xc = puVar5;
	for (uVar4 = (param_2 << 5) >> 2; uVar4 != 0; uVar4 -= 1) {
		*puVar5 = 0;
		puVar5 = puVar5 + 1;
	}
	for (iVar6 = 0; iVar6 != 0; iVar6 += -1) {
		*(undefined *)puVar5 = 0;
		puVar5 = (undefined4 *)((int)puVar5 + 1);
	}
	*(uint *)&pLVar2->field_0x4 = param_2;
	pLVar2->flags = 0;
	lego::res::Res_Struct34_InitTable10_Item50Default(param_1,param_1->count_0 - 1);
	return param_1->count_0 - 1;
}



void __cdecl
lego::res::Res_Struct34_SetTable10_Field64(Struct_34 *param_1,int index,undefined4 param_3)
{
	param_1->lwoTable_8[index].field_64 = param_3;
	return;
}



void __cdecl FUN_00482630(uint *param_1,float param_2,float param_3,float param_4)
{
	float *pfVar1;
	float *pfVar2;
	int iVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	int iVar7;
	
	uVar5 = 0;
	if (*param_1 != 0) {
		iVar7 = 0;
		do {
			uVar6 = 0;
			iVar3 = param_1[2] + iVar7;
			if (*(int *)(iVar3 + 4) != 0) {
				iVar4 = 0;
				do {
					uVar6 += 1;
					*(float *)(*(int *)(iVar3 + 0xc) + iVar4) =
							 param_2 * *(float *)(*(int *)(iVar3 + 0xc) + iVar4);
					*(float *)(*(int *)(iVar3 + 0xc) + 4 + iVar4) =
							 param_3 * *(float *)(*(int *)(iVar3 + 0xc) + 4 + iVar4);
					pfVar1 = (float *)(*(int *)(iVar3 + 0xc) + 8 + iVar4);
					pfVar2 = (float *)(*(int *)(iVar3 + 0xc) + 8 + iVar4);
					iVar4 += 0x20;
					*pfVar2 = param_4 * *pfVar1;
				} while (uVar6 < *(uint *)(iVar3 + 4));
			}
			uVar5 += 1;
			iVar7 += 0x70;
		} while (uVar5 < *param_1);
	}
	return;
}



void __cdecl FUN_004826a0(int param_1,int param_2,int param_3,int param_4,int param_5)
{
	int iVar1;
	undefined4 *puVar2;
	int iVar3;
	undefined4 *puVar4;
	
	iVar3 = *(int *)(param_1 + 8) + param_2 * 0x70;
	if (param_4 != 0) {
		iVar1 = param_3 << 5;
		puVar2 = (undefined4 *)(param_5 + 0x18);
		do {
			puVar4 = (undefined4 *)(*(int *)(iVar3 + 0xc) + iVar1);
			*puVar4 = puVar2[-6];
			puVar4[1] = puVar2[-5];
			puVar4[2] = puVar2[-4];
			puVar4 = (undefined4 *)(*(int *)(iVar3 + 0xc) + 0xc + iVar1);
			iVar1 += 0x20;
			param_4 += -1;
			*puVar4 = puVar2[-3];
			puVar4[1] = puVar2[-2];
			puVar4[2] = puVar2[-1];
			*(undefined4 *)(*(int *)(iVar3 + 0xc) + -8 + iVar1) = *puVar2;
			*(undefined4 *)(*(int *)(iVar3 + 0xc) + -4 + iVar1) = puVar2[1];
			puVar2 = puVar2 + 9;
		} while (param_4 != 0);
	}
	return;
}



void __cdecl
FUN_00482730_internal(Struct_34 *struct34,int index,int param_3,int param_4,int out_table)
{
	int iVar1;
	undefined4 *puVar2;
	LwoFrame *pLVar3;
	undefined4 *puVar4;
	
	pLVar3 = struct34->lwoTable_8 + index;
	if (param_4 != 0) {
		iVar1 = param_3 << 5;
		puVar2 = (undefined4 *)(out_table + 0x18);
		do {
			puVar4 = (undefined4 *)(*(int *)&pLVar3->field_0xc + iVar1);
			puVar2[-6] = *puVar4;
			puVar2[-5] = puVar4[1];
			puVar2[-4] = puVar4[2];
			puVar4 = (undefined4 *)(*(int *)&pLVar3->field_0xc + 0xc + iVar1);
			iVar1 += 0x20;
			param_4 += -1;
			puVar2[-3] = *puVar4;
			puVar2[-2] = puVar4[1];
			puVar2[-1] = puVar4[2];
			*puVar2 = *(undefined4 *)(*(int *)&pLVar3->field_0xc + -8 + iVar1);
			puVar2[1] = *(undefined4 *)(*(int *)&pLVar3->field_0xc + -4 + iVar1);
			puVar2 = puVar2 + 9;
		} while (param_4 != 0);
	}
	return;
}



void __cdecl
FUN_004827c0(int param_1,int param_2,int param_3,int param_4,int param_5,float *param_6,
						undefined4 *param_7)
{
	float *pfVar1;
	float fVar2;
	float *pfVar3;
	int iVar4;
	int iVar5;
	int iVar6;
	undefined4 *puVar7;
	
	pfVar3 = param_6;
	iVar6 = *(int *)(param_1 + 8) + param_2 * 0x70;
	if (param_4 != 0) {
		param_6 = (float *)param_4;
		iVar5 = param_3 << 5;
		puVar7 = (undefined4 *)(param_5 + 8);
		do {
			*(undefined4 *)(iVar5 + *(int *)(iVar6 + 0xc)) = puVar7[-2];
			*(undefined4 *)(iVar5 + 4 + *(int *)(iVar6 + 0xc)) = puVar7[-1];
			*(undefined4 *)(iVar5 + 8 + *(int *)(iVar6 + 0xc)) = *puVar7;
			iVar4 = *(int *)(iVar6 + 0xc) + iVar5;
			*(float *)(iVar4 + 0xc) = *pfVar3 - *(float *)(*(int *)(iVar6 + 0xc) + iVar5);
			*(float *)(iVar4 + 0x10) = pfVar3[1] - *(float *)(iVar4 + 4);
			*(float *)(iVar4 + 0x14) = pfVar3[2] - *(float *)(iVar4 + 8);
			fVar2 = *(float *)(iVar5 + 0x10 + *(int *)(iVar6 + 0xc));
			pfVar1 = (float *)(iVar5 + 0xc + *(int *)(iVar6 + 0xc));
			fVar2 = 1.0 / SQRT(*pfVar1 * *pfVar1 + pfVar1[2] * pfVar1[2] + fVar2 * fVar2);
			*pfVar1 = *pfVar1 * fVar2;
			pfVar1[1] = fVar2 * pfVar1[1];
			pfVar1[2] = fVar2 * pfVar1[2];
			*(undefined4 *)(iVar5 + 0x18 + *(int *)(iVar6 + 0xc)) = *param_7;
			*(undefined4 *)(iVar5 + 0x1c + *(int *)(iVar6 + 0xc)) = param_7[1];
			param_6 = (float *)((int)param_6 + -1);
			iVar5 = iVar5 + 0x20;
			param_7 = param_7 + 2;
			puVar7 = puVar7 + 3;
		} while (param_6 != NULL);
	}
	return;
}



void __cdecl
FUN_004828e0(int param_1,int param_2,int param_3,int param_4,int param_5,undefined4 *param_6,
						undefined4 *param_7)
{
	undefined4 *puVar1;
	int iVar2;
	int iVar3;
	undefined4 *puVar4;
	
	iVar3 = param_2 * 0x70 + *(int *)(param_1 + 8);
	if (param_4 != 0) {
		iVar2 = param_3 << 5;
		param_2 = param_4;
		puVar4 = (undefined4 *)(param_5 + 8);
		do {
			*(undefined4 *)(*(int *)(iVar3 + 0xc) + iVar2) = puVar4[-2];
			*(undefined4 *)(*(int *)(iVar3 + 0xc) + 4 + iVar2) = puVar4[-1];
			*(undefined4 *)(*(int *)(iVar3 + 0xc) + 8 + iVar2) = *puVar4;
			puVar1 = (undefined4 *)(*(int *)(iVar3 + 0xc) + 0xc + iVar2);
			iVar2 += 0x20;
			*puVar1 = *param_6;
			puVar1[1] = param_6[1];
			puVar1[2] = param_6[2];
			*(undefined4 *)(*(int *)(iVar3 + 0xc) + -8 + iVar2) = *param_7;
			*(undefined4 *)(*(int *)(iVar3 + 0xc) + -4 + iVar2) = param_7[1];
			param_2 += -1;
			puVar4 = puVar4 + 3;
			param_7 = param_7 + 2;
		} while (param_2 != 0);
	}
	return;
}



void __cdecl
FUN_00482980(Struct_34 *param_1,int index,int param_3,int param_4,int param_5,Vector3F **param_6,
						Point2I *param_7)
{
	int iVar1;
	LwoFrame *pLVar2;
	undefined4 *puVar3;
	
	pLVar2 = param_1->lwoTable_8 + index;
	if (param_4 != 0) {
		index = param_4;
		iVar1 = param_3 << 5;
		puVar3 = (undefined4 *)(param_5 + 8);
		do {
			*(undefined4 *)(iVar1 + *(int *)&pLVar2->field_0xc) = puVar3[-2];
			*(undefined4 *)(iVar1 + 4 + *(int *)&pLVar2->field_0xc) = puVar3[-1];
			*(undefined4 *)(iVar1 + 8 + *(int *)&pLVar2->field_0xc) = *puVar3;
			*(float *)(iVar1 + 0xc + *(int *)&pLVar2->field_0xc) = (*param_6)->x;
			*(float *)(iVar1 + 0x10 + *(int *)&pLVar2->field_0xc) = (*param_6)->y;
			*(float *)(iVar1 + 0x14 + *(int *)&pLVar2->field_0xc) = (*param_6)->z;
			*(int *)(iVar1 + 0x18 + *(int *)&pLVar2->field_0xc) = param_7->x;
			*(int *)(iVar1 + 0x1c + *(int *)&pLVar2->field_0xc) = param_7->y;
			index += -1;
			iVar1 = iVar1 + 0x20;
			puVar3 = puVar3 + 3;
			param_6 = param_6 + 1;
			param_7 = param_7 + 1;
		} while (index != 0);
	}
	return;
}



BOOL __cdecl FUN_00482a40(Struct_34 *struct34,int index)
{
	return struct34->lwoTable_8[index].flags & 1;
}



void __cdecl FUN_00482a60(Struct_34 *struct34,int index,BOOL state)
{
	LwoFrame *pLVar1;
	
	pLVar1 = struct34->lwoTable_8 + index;
	if (state != 0) {
		pLVar1->flags = pLVar1->flags | 1;
		return;
	}
	pLVar1->flags = pLVar1->flags & 0xfffffffe;
	return;
}



void __cdecl FUN_00482a90(int param_1,int param_2)
{
	if (param_2 != 0) {
		*(uint *)(param_1 + 0x2c) = *(uint *)(param_1 + 0x2c) | 1;
		return;
	}
	*(uint *)(param_1 + 0x2c) = *(uint *)(param_1 + 0x2c) & 0xfffffffe;
	return;
}



BOOL __cdecl
lego::res::Res_D3DRMUserVisualCallback
					(IDirect3DRMUserVisual *lpD3DRMUV,Struct_34 *lpArg,D3DRMUserVisualReason lpD3DRMUVreason,
					IUnknown *lpD3DRMDev,IDirect3DRMViewport *lpD3DRMview)
{
	int iVar1;
	DWORD DVar2;
	undefined4 uVar3;
	int iVar4;
	bool bVar5;
	uint uVar6;
	undefined4 *puVar7;
	IDirect3DDevice3 *This;
	int *piVar8;
	IDirect3DRMViewport2 *rmView2;
	uint uStack20;
	int iStack16;
	undefined4 uStack8;
	
	uVar6 = 0;
	if (lpD3DRMUVreason == D3DRMUSERVISUAL_CANSEE) {
		if (((globals::g_IDirect3DDevice3 != NULL) && ((*(byte *)&lpArg->flags & 1) == 0)) &&
			 ((iVar1 = FUN_00475af0(lpArg->frame_28), iVar1 == 0 ||
				((*(byte *)(iVar1 + 0x14) & 0x80) == 0)))) {
			if ((lpArg->flags & 0x1000000) == 0) {
				return 1;
			}
			if ((lpArg->flags & 0x2000000) != 0) {
				return 1;
			}
										// DWORD IDirect3DRMViewport->GetAppData(this)
										// struct with field_28 -> IDirect3DRMFrame3*
			DVar2 = (*lpD3DRMview->lpVtbl->GetAppData)((IUnknown *)lpD3DRMview);
			if (*(int *)(DVar2 + 0x18) == 0) {
				return 1;
			}
										// IDirect3DRMFrame3->GetScene(this, IDirect3DRMFrame3** lplpRoot)
			(*(code *)lpArg->frame_28->lpVtbl->GetScene)();
										// IDirect3DRMViewport2->GetCamera(this, IDirect3DRMFrame3** lplpCamera)
			(**(code **)(**(int **)(DVar2 + 0x10) + 100))(*(int **)(DVar2 + 0x10),&lpD3DRMUVreason);
										// IDirect3DRMFrame3->LookAt(this, IDirect3DRMFrame3* lpTarget,
										// IDirect3DRMFrame3* lpRef, TD3DRMFrameConstraint rfcConstraint)
			(*(code *)lpArg->frame_28->lpVtbl->LookAt)(lpArg->frame_28,lpD3DRMUV,uStack8,0);
			lpArg->flags = lpArg->flags | 0x2000000;
			return 1;
		}
	}
	else {
		if (lpD3DRMUVreason == D3DRMUSERVISUAL_RENDER) {
			if (globals::g_IDirect3DDevice3 != NULL) {
				piVar8 = (int *)0x1;
				lpD3DRMUVreason = D3DRMUSERVISUAL_CANSEE;
				bVar5 = false;
				lpArg->flags = lpArg->flags & 0xfdffffff;
										// IDirect3DDevice3->GetTransform(this, TD3DTransformStateType
										// dtstTransformStateType, TD3DMatrix* lpD3DMatrix)
				This = globals::g_IDirect3DDevice3;
				(*(code *)globals::g_IDirect3DDevice3->lpVtbl->GetTransform)();
				FUN_00483840((int *)lpArg);
										// IDirect3DRMViewport->QueryInterface(this, IID_IDirect3DRMViewport2,
										// IDirect3DRMViewport2** lplpOut)
				(**(code **)lpArg->count_0)(lpArg,&idl::IID_IDirect3DRMViewport2,&stack0xffffffb0);
										// DWORD IDirect3DRMViewport2->GetAppData(this)
				uVar3 = (**(code **)(*piVar8 + 0x1c))(piVar8);
				uStack8 = uVar3;
				if ((*(byte *)&lpArg->flags & 2) == 0) {
					if ((lpArg->unkFlags3_18 & 0x1c00) == 0) {
						draw::Draw_UnkRenderTextureManagement__00483b70();
						FUN_00482d80((int)lpArg,uVar3,(float *)&stack0xffffffa4,0);
						bVar5 = true;
						FUN_00483c80((uint *)lpArg,(float *)&stack0xffffffa4,0);
					}
					else {
						if (lpArg->count_0 != 0) {
							uStack20 = 0;
							do {
								puVar7 = (undefined4 *)((int)&lpArg->lwoTable_8->dwSize + uStack20);
								iVar1 = FUN_00483d30((int)puVar7);
								if (iVar1 != 0) {
									if ((puVar7[0x1b] & 0x80000) == 0) {
										if (puVar7[0x19] == 0) {
											if (!bVar5) {
												draw::Draw_UnkRenderTextureManagement__00483b70();
												FUN_00482d80((int)lpArg,uStack8,(float *)&stack0xffffffa4,0);
												bVar5 = true;
											}
											FUN_00483d50(lpArg,puVar7,(float *)&stack0xffffffa4,0);
										}
									}
									else {
										iStack16 = 1;
									}
								}
								uVar6 += 1;
								uStack20 += 0x70;
							} while (uVar6 < lpArg->count_0);
						}
						iVar1 = 0;
						uStack20 = 0;
						if (lpArg->count_0 != 0) {
							do {
								puVar7 = (undefined4 *)((int)&lpArg->lwoTable_8->dwSize + iVar1);
								iVar4 = FUN_00483d30((int)puVar7);
								if (iVar4 != 0) {
									if ((puVar7[0x1b] & 0x80000) == 0) {
										if (puVar7[0x19] != 0) {
											if (!bVar5) {
												draw::Draw_UnkRenderTextureManagement__00483b70();
												FUN_00482d80((int)lpArg,uStack8,(float *)&stack0xffffffa4,0);
												bVar5 = true;
											}
											FUN_00483d50(lpArg,puVar7,(float *)&stack0xffffffa4,0);
										}
									}
									else {
										iStack16 = 1;
									}
								}
								uStack20 += 1;
								iVar1 += 0x70;
							} while (uStack20 < lpArg->count_0);
						}
						if (iStack16 != 0) {
							FUN_00482fa0(lpArg,(undefined4 *)&stack0xffffffa4);
						}
					}
				}
				else {
					FUN_00482fa0(lpArg,(undefined4 *)&stack0xffffffa4);
				}
				if (bVar5) {
					draw::Draw_CleanupRenderStates();
					draw::Draw_UnkRenderTextureManagement__00483c00();
				}
				if (This != NULL) {
										// IDirect3DRMViewport2->Release(this)
					(*This->lpVtbl->Release)((IUnknown *)This);
				}
			}
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_00482d80(int param_1,undefined4 param_2,float *param_3,int param_4)
{
	if (*(code **)(param_1 + 0x10) != NULL) {
		(**(code **)(param_1 + 0x10))(param_1,*(undefined4 *)(param_1 + 0x14),param_2);
	}
	lego::draw::Draw_SetRenderState(0x1d,0);
	lego::draw::Draw_SetRenderState(9,2);
	lego::draw::Draw_SetRenderState(0x1a,1);
	if (((byte)lego::globals::g_CMDLINE_FLAGS & CMD_NM) == 0) {
		FUN_00483ad0(2,2);
		FUN_00483ad0(3,0);
		FUN_00483ad0(5,2);
		FUN_00483ad0(6,0);
	}
	FUN_00482e10(*(uint *)(param_1 + 0x18),param_3,param_4);
	return;
}



void __cdecl FUN_00482e10(uint param_1,float *param_2,int param_3)
{
	uint uVar1;
	undefined4 uVar2;
	float local_40 [16];
	
	uVar1 = param_1 & 0x1c00;
	if ((uVar1 != 0) && (param_3 != 0)) {
		lego::draw::Draw_SetRenderState(0x1c,0);
	}
	if ((uVar1 == 0) || (param_3 != 0)) {
		if ((param_1 & 0x400) == 0) {
			if ((param_1 & 0x800) == 0) {
				if ((param_1 & 0x1000) == 0) goto LAB_00482e79;
				FUN_00482f70(5,6);
			}
			else {
				FUN_00482f70(5,2);
			}
		}
		else {
			FUN_00482f70(2,2);
		}
	}
	else {
LAB_00482e79:
		lego::draw::Draw_SetRenderState(0x1b,0);
	}
	if ((param_1 & 0x4000000) == 0) {
		uVar2 = 3;
	}
	else {
		uVar2 = 1;
	}
	lego::draw::Draw_SetRenderState(0x16,uVar2);
	if (((byte)lego::globals::g_CMDLINE_FLAGS & CMD_NM) == 0) {
		if ((param_1 & 0x20000) == 0) {
			if ((param_1 & 0x40000) == 0) {
				uVar2 = 4;
			}
			else {
				uVar2 = 3;
			}
		}
		else {
			uVar2 = 2;
		}
		FUN_00483ad0(4,uVar2);
	}
	lego::draw::Draw_SetRenderState(7,1);
	if ((uVar1 == 0) || (param_3 == 0)) {
		uVar2 = 1;
	}
	else {
		uVar2 = 0;
	}
	lego::draw::Draw_SetRenderState(0xe,uVar2);
	if ((param_1 & 0x2000) == 0) {
		if ((param_1 & 0x4000) == 0) goto LAB_00482f21;
		FUN_00483800(local_40);
		param_2 = local_40;
	}
	FUN_00483950(1,param_2);
LAB_00482f21:
	if ((param_1 & 0x800000) == 0) {
		lego::draw::Draw_SetRenderState(0x11,2);
		lego::draw::Draw_SetRenderState(0x12,4);
		return;
	}
	lego::draw::Draw_SetRenderState(0x11,1);
	lego::draw::Draw_SetRenderState(0x12,1);
	return;
}



void FUN_00482f70(undefined4 param_1,undefined4 param_2)
{
	lego::draw::Draw_SetRenderState(0x1b,1);
	lego::draw::Draw_SetRenderState(0x13,param_1);
	lego::draw::Draw_SetRenderState(0x14,param_2);
	return;
}



void __cdecl FUN_00482fa0(undefined4 param_1,undefined4 *param_2)
{
	undefined4 *puVar1;
	int iVar2;
	undefined4 *puVar3;
	
	puVar1 = (undefined4 *)std::malloc(0x48);
	puVar3 = puVar1;
	for (iVar2 = 0x12; iVar2 != 0; iVar2 += -1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	*puVar1 = param_1;
	if (param_2 != NULL) {
		puVar3 = puVar1;
		for (iVar2 = 0x10; puVar3 = puVar3 + 1, iVar2 != 0; iVar2 += -1) {
			*puVar3 = *param_2;
			param_2 = param_2 + 1;
		}
	}
	puVar1[0x11] = lego::globals::g_UNKPTR_STRUCT48__005353c4;
	lego::globals::g_UNKPTR_STRUCT48__005353c4 = puVar1;
	return;
}



void __cdecl lego::unk::Lego_FreeUNKPTR_STRUCT48(void)
{
	void *pvVar1;
	void *buffer;
	
	buffer = globals::g_UNKPTR_STRUCT48__005353c4;
	if (globals::g_UNKPTR_STRUCT48__005353c4 != NULL) {
		do {
			pvVar1 = *(void **)((int)buffer + 0x44);
			std::free(buffer);
			buffer = pvVar1;
		} while (pvVar1 != NULL);
	}
	globals::g_UNKPTR_STRUCT48__005353c4 = NULL;
	return;
}



void __cdecl FUN_00483020(int param_1)
{
	int iVar1;
	uint *puVar2;
	int iVar3;
	uint uVar4;
	uint **ppuVar5;
	undefined4 *puVar6;
	
	ppuVar5 = (uint **)lego::globals::g_UNKPTR_STRUCT48__005353c4;
	if (lego::globals::g_UNKPTR_STRUCT48__005353c4 != NULL) {
		FUN_004838c0(param_1);
		lego::draw::Draw_UnkRenderTextureManagement__00483b70();
		do {
			if ((*(byte *)(*ppuVar5 + 0xb) & 1) == 0) {
				FUN_00482d80((int)*ppuVar5,param_1,(float *)(ppuVar5 + 1),1);
				puVar2 = *ppuVar5;
				if ((*(byte *)(puVar2 + 0xb) & 2) == 0) {
					uVar4 = 0;
					if (*puVar2 != 0) {
						iVar3 = 0;
						do {
							puVar6 = (undefined4 *)(puVar2[2] + iVar3);
							iVar1 = FUN_00483d30((int)puVar6);
							if (((iVar1 != 0) && ((puVar6[0x1b] & 0x80000) != 0)) && (puVar6[0x19] == 0)) {
								FUN_00483d50(*ppuVar5,puVar6,(float *)(ppuVar5 + 1),1);
							}
							puVar2 = *ppuVar5;
							uVar4 += 1;
							iVar3 += 0x70;
						} while (uVar4 < *puVar2);
					}
					puVar2 = *ppuVar5;
					uVar4 = 0;
					if (*puVar2 != 0) {
						iVar3 = 0;
						do {
							puVar6 = (undefined4 *)(puVar2[2] + iVar3);
							iVar1 = FUN_00483d30((int)puVar6);
							if (((iVar1 != 0) && ((puVar6[0x1b] & 0x80000) != 0)) && (puVar6[0x19] != 0)) {
								FUN_00483d50(*ppuVar5,puVar6,(float *)(ppuVar5 + 1),1);
							}
							puVar2 = *ppuVar5;
							uVar4 += 1;
							iVar3 += 0x70;
						} while (uVar4 < *puVar2);
					}
				}
				else {
					FUN_00483c80(puVar2,(float *)(ppuVar5 + 1),1);
				}
			}
			ppuVar5 = (uint **)ppuVar5[0x11];
		} while (ppuVar5 != NULL);
		lego::unk::Lego_FreeUNKPTR_STRUCT48();
		lego::draw::Draw_CleanupRenderStates();
		lego::draw::Draw_UnkRenderTextureManagement__00483c00();
	}
	return;
}



int ** __cdecl
lego::draw::Draw_LoadAnimFrame(char *dirname,char *filename,uint *out_width,uint *out_height)
{
	char cVar1;
	IDirectDrawSurface4 **ppIVar2;
	IDirectDrawSurface4 *This;
	uint uVar3;
	uint uVar4;
	undefined4 *puVar5;
	char *pcVar6;
	char *pcVar7;
	undefined4 *puVar8;
	undefined *puVar9;
	uint *puVar10;
	IDirectDrawSurface4 *local_10c;
	IDirectDrawSurface4 **local_108;
	char local_104 [260];
	
	local_108 = (IDirectDrawSurface4 **)std::malloc(0xc);
	if (dirname == NULL) {
		uVar3 = 0xffffffff;
		pcVar6 = filename;
		do {
			pcVar7 = pcVar6;
			if (uVar3 == 0) break;
			uVar3 -= 1;
			pcVar7 = pcVar6 + 1;
			cVar1 = *pcVar6;
			pcVar6 = pcVar7;
		} while (cVar1 != '\0');
		uVar3 = ~uVar3;
		puVar5 = (undefined4 *)(pcVar7 + -uVar3);
		puVar8 = (undefined4 *)local_104;
		for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
			*puVar8 = *puVar5;
			puVar5 = puVar5 + 1;
			puVar8 = puVar8 + 1;
		}
		for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
			*(undefined *)puVar8 = *(undefined *)puVar5;
			puVar5 = (undefined4 *)((int)puVar5 + 1);
			puVar8 = (undefined4 *)((int)puVar8 + 1);
		}
	}
	else {
		std::sprintf(local_104,"%s%s",dirname,filename);
	}
	ppIVar2 = (IDirectDrawSurface4 **)FUN_004832f0((int)&DAT_0053555c,COUNT_0054155c,local_104);
	if (ppIVar2 != NULL) {
		This = *ppIVar2;
		if (This != NULL) {
			(*This->lpVtbl->AddRef)((IUnknown *)This);
		}
		local_10c = ppIVar2[2];
		goto LAB_004832a8;
	}
	This = FUN_00474310(local_104,1,out_width,out_height,(BOOL *)&local_10c);
	if (This == NULL) {
		if (lego::globals::g_SharedTextures2 == NULL) goto LAB_004832a8;
		std::sprintf(local_104,"%s%s",lego::globals::g_SharedTextures2,filename);
		ppIVar2 = (IDirectDrawSurface4 **)FUN_004832f0((int)&DAT_0053b55c,COUNT_00541560,local_104);
		if (ppIVar2 != NULL) {
			This = *ppIVar2;
			if (This != NULL) {
				(*This->lpVtbl->AddRef)((IUnknown *)This);
			}
			local_10c = ppIVar2[2];
			goto LAB_004832a8;
		}
		This = FUN_00474310(local_104,1,out_width,out_height,(BOOL *)&local_10c);
		if (This == NULL) goto LAB_004832a8;
		puVar10 = &COUNT_00541560;
		puVar9 = &DAT_0053b55c;
	}
	else {
		puVar10 = &COUNT_0054155c;
		puVar9 = &DAT_0053555c;
	}
	FUN_00483340((int)puVar9,(int *)puVar10,local_104,This,local_10c);
LAB_004832a8:
	if (This != NULL) {
		local_108[1] = NULL;
		*local_108 = This;
		local_108[2] = local_10c;
		return (int **)local_108;
	}
	std::free(local_108);
	return (int **)NULL;
}



int __cdecl FUN_004832f0(int param_1,uint count,char *param_3)
{
	int iVar1;
	uint uVar2;
	char **ppcVar3;
	
	uVar2 = 0;
	if (count == 0) {
		return 0;
	}
	ppcVar3 = (char **)(param_1 + 4);
	do {
		iVar1 = std::_stricmp(param_3,*ppcVar3);
		if (iVar1 == 0) {
			return param_1 + uVar2 * 0xc;
		}
		uVar2 += 1;
		ppcVar3 = ppcVar3 + 3;
	} while (uVar2 < count);
	return 0;
}



void __cdecl
FUN_00483340(int param_1,int *param_2,char *param_3,undefined4 param_4,undefined4 param_5)
{
	char *pcVar1;
	
	pcVar1 = std::_strdup(param_3);
	*(char **)(param_1 + 4 + *param_2 * 0xc) = pcVar1;
	*(undefined4 *)(param_1 + *param_2 * 0xc) = param_4;
	*(undefined4 *)(param_1 + 8 + *param_2 * 0xc) = param_5;
	*param_2 = *param_2 + 1;
	return;
}



void __cdecl FUN_00483380(Struct_34 *param_1,int index,undefined **param_3)
{
	uint *puVar1;
	code **ppcVar2;
	
	if (param_3 != NULL) {
		ppcVar2 = (code **)*param_3;
		if (ppcVar2 != NULL) {
			(**(code **)*ppcVar2)
								(ppcVar2,&idl::IID_IDirect3DTexture2,&param_1->lwoTable_8[index].field_0x60);
		}
		if (param_3[2] != NULL) {
			puVar1 = &param_1->lwoTable_8[index].flags;
			*puVar1 = *puVar1 | 0x400000;
			return;
		}
		param_1->lwoTable_8[index].flags = param_1->lwoTable_8[index].flags & 0xffbfffff;
	}
	return;
}



void __cdecl FUN_00483400(Struct_34 *param_1,int index)
{
	LwoFrame *pLVar1;
	int *piVar2;
	
	pLVar1 = param_1->lwoTable_8;
	piVar2 = *(int **)&pLVar1[index].field_0x60;
	if (piVar2 != NULL) {
		(**(code **)(*piVar2 + 8))(piVar2);
		*(undefined4 *)&pLVar1[index].field_0x60 = 0;
	}
	return;
}



BOOL __cdecl lego::res::Res_Struct34_InitTable10_Item50Default(Struct_34 *param_1,int index)
{
	int iVar1;
	undefined4 *puVar2;
	undefined4 *puVar3;
	undefined4 local_50 [4];
	undefined4 local_40;
	undefined4 local_3c;
	undefined4 local_38;
	undefined4 local_34;
	undefined4 local_30;
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 local_4;
	
	local_8 = 0;
	local_4 = 0;
	local_50[0] = 0x50;
	local_50[1] = 1065353216;
	local_50[2] = 1065353216;
	local_50[3] = 1065353216;
	local_40 = 1065353216;
	local_3c = 0;
	local_38 = 0;
	local_34 = 0;
	local_30 = 0;
	local_2c = 0;
	local_28 = 0;
	local_24 = 0;
	local_20 = 0;
	local_1c = 0;
	local_18 = 0;
	local_14 = 0;
	local_10 = 0;
	local_c = 0;
	puVar2 = local_50;
	puVar3 = (undefined4 *)&param_1->lwoTable_8[index].field_0x10;
	for (iVar1 = 0x14; iVar1 != 0; iVar1 += -1) {
		*puVar3 = *puVar2;
		puVar2 = puVar2 + 1;
		puVar3 = puVar3 + 1;
	}
	return 1;
}



BOOL __cdecl FUN_00483500(Struct_34 *param_1,int index,undefined4 *param_3)
{
	int iVar1;
	undefined4 *puVar2;
	
	puVar2 = (undefined4 *)&param_1->lwoTable_8[index].field_0x10;
	for (iVar1 = 0x14; iVar1 != 0; iVar1 += -1) {
		*puVar2 = *param_3;
		param_3 = param_3 + 1;
		puVar2 = puVar2 + 1;
	}
	return 1;
}



BOOL __cdecl FUN_00483530(Struct_34 *param_1,int index,float r,float g,float b,int unkMode)
{
	int iVar1;
	LwoFrame *pLVar2;
	
	pLVar2 = param_1->lwoTable_8 + index;
	iVar1 = lego::res::Res_Struct34_GetTable8_Struct70_Field10(param_1,index);
	if (r < 0.0) {
		r = 0.0;
	}
	if (g < 0.0) {
		g = 0.0;
	}
	if (b < 0.0) {
		b = 0.0;
	}
	if ((ushort)((ushort)(r < 1.0) << 8 | (ushort)(r == 1.0) << 0xe) == 0) {
		r = 1.0;
	}
	if ((ushort)((ushort)(g < 1.0) << 8 | (ushort)(g == 1.0) << 0xe) == 0) {
		g = 1.0;
	}
	if ((ushort)((ushort)(b < 1.0) << 8 | (ushort)(b == 1.0) << 0xe) == 0) {
		b = 1.0;
	}
	if (unkMode == 0) {
		*(float *)(iVar1 + 4) = r;
		*(float *)(iVar1 + 8) = g;
		*(float *)(iVar1 + 0xc) = b;
		if (((r == 1.0) && (g == 1.0)) && (b == 1.0)) {
			pLVar2->flags = pLVar2->flags | 0x100000;
			return 1;
		}
		pLVar2->flags = pLVar2->flags & 0xffefffff;
		return 1;
	}
	if (unkMode == 1) {
		*(float *)(iVar1 + 0x18) = g;
		*(float *)(iVar1 + 0x14) = r;
		*(float *)(iVar1 + 0x1c) = b;
		return 1;
	}
	if (unkMode != 3) {
		if (unkMode != 2) {
			return 1;
		}
		*(float *)(iVar1 + 0x28) = g;
		*(float *)(iVar1 + 0x24) = r;
		*(float *)(iVar1 + 0x2c) = b;
		return 1;
	}
	*(float *)(iVar1 + 0x38) = g;
	*(float *)(iVar1 + 0x34) = r;
	*(float *)(iVar1 + 0x3c) = b;
	return 1;
}



int __cdecl lego::res::Res_Struct34_GetTable8_Struct70_Field10(Struct_34 *param_1,int index)
{
	return &param_1->lwoTable_8[index].field_0x10;
}



BOOL __cdecl FUN_004836e0(Struct_34 *param_1,int index,float unkMultiplier,int unkMode)
{
	int iVar1;
	uint uVar2;
	LwoFrame *pLVar3;
	
	pLVar3 = param_1->lwoTable_8 + index;
	iVar1 = lego::res::Res_Struct34_GetTable8_Struct70_Field10(param_1,index);
	if (unkMultiplier < 0.0) {
		unkMultiplier = 0.0;
	}
	if ((ushort)((ushort)(unkMultiplier < 1.0) << 8 | (ushort)(unkMultiplier == 1.0) << 0xe) == 0) {
		unkMultiplier = 1.0;
	}
	if (unkMode != 4) {
		if (unkMode == 5) {
			*(float *)(iVar1 + 0x44) = unkMultiplier;
			return 1;
		}
		return 1;
	}
	uVar2 = pLVar3->flags & 0xeff7ffff;
	pLVar3->flags = uVar2;
	if (unkMultiplier == 0.0) {
		if (pLVar3->field_64 == 0) {
			if ((param_1->unkFlags3_18 & 0x1c00) == 0) goto LAB_004837a4;
			uVar2 |= 0x10000000;
		}
		else {
			uVar2 |= 0x10000000;
		}
	}
	else {
		if ((unkMultiplier == 1.0) ||
			 ((pLVar3->field_64 == 0 && ((param_1->unkFlags3_18 & 0x1c00) == 0)))) goto LAB_004837a4;
		uVar2 |= 0x80000;
	}
	pLVar3->flags = uVar2;
LAB_004837a4:
	if (pLVar3->field_64 == 0) {
		if ((param_1->unkFlags3_18 & 0xc00) != 0) {
			pLVar3->flags = pLVar3->flags | 0x80000;
		}
	}
	else {
		if ((pLVar3->field_64 & 0xc00) != 0) {
			pLVar3->flags = pLVar3->flags | 0x80000;
			*(float *)(iVar1 + 0x10) = unkMultiplier;
			return 1;
		}
	}
	*(float *)(iVar1 + 0x10) = unkMultiplier;
	return 1;
}



void __cdecl FUN_00483800(undefined4 *param_1)
{
	param_1[7] = 0;
	param_1[6] = 0;
	param_1[4] = 0;
	param_1[3] = 0;
	param_1[2] = 0;
	param_1[1] = 0;
	param_1[0xe] = 0;
	param_1[0xd] = 0;
	param_1[0xc] = 0;
	param_1[0xb] = 0;
	param_1[9] = 0;
	param_1[8] = 0;
	param_1[0xf] = 0x3f800000;
	param_1[10] = 0x3f800000;
	param_1[5] = 0x3f800000;
	*param_1 = 0x3f800000;
	return;
}



undefined4 __cdecl FUN_00483840(int *param_1)
{
	int iVar1;
	int **ppiVar2;
	GUID *pGVar3;
	code **ppcVar4;
	int *piStack12;
	int **ppiStack8;
	code **ppcStack4;
	
	ppiStack8 = &param_1;
	piStack12 = param_1;
	ppiVar2 = &piStack12;
	iVar1 = (**(code **)(*param_1 + 0x98))();
	if (iVar1 != 0) {
		return 0;
	}
	pGVar3 = &idl::IID_IDirect3DViewport3;
	iVar1 = (**(code **)*ppcStack4)(ppcStack4,&idl::IID_IDirect3DViewport3);
	if (iVar1 == 0) {
		ppcVar4 = (code **)ppiVar2;
		if (ppiVar2 != NULL) {
			(**(code **)((int)*ppiVar2 + 8))(ppiVar2);
			ppcVar4 = NULL;
		}
		ppiVar2 = (int **)ppcStack4;
		iVar1 = (*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetCurrentViewport)
											(lego::globals::g_IDirect3DDevice3,ppiVar2,ppiVar2,pGVar3,ppcVar4);
		if (iVar1 == 0) {
			if (ppiVar2 != NULL) {
				(**(code **)((int)*ppiVar2 + 8))(ppiVar2);
			}
			return 1;
		}
	}
	if (ppiVar2 != NULL) {
		(**(code **)((int)*ppiVar2 + 8))(ppiVar2);
	}
	return 0;
}



undefined4 __cdecl FUN_004838c0(int param_1)
{
	int iVar1;
	int **ppiVar2;
	GUID *pGVar3;
	code **ppcVar4;
	int *piStack12;
	int *piStack8;
	code **ppcStack4;
	
	piStack8 = &param_1;
	piStack12 = *(int **)(param_1 + 0x10);
	ppiVar2 = &piStack12;
	iVar1 = (**(code **)(*piStack12 + 0x98))();
	if (iVar1 != 0) {
		return 0;
	}
	pGVar3 = &idl::IID_IDirect3DViewport3;
	iVar1 = (**(code **)*ppcStack4)(ppcStack4,&idl::IID_IDirect3DViewport3);
	if (iVar1 == 0) {
		ppcVar4 = (code **)ppiVar2;
		if (ppiVar2 != NULL) {
			(**(code **)((int)*ppiVar2 + 8))(ppiVar2);
			ppcVar4 = NULL;
		}
		ppiVar2 = (int **)ppcStack4;
		iVar1 = (*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetCurrentViewport)
											(lego::globals::g_IDirect3DDevice3,ppiVar2,ppiVar2,pGVar3,ppcVar4);
		if (iVar1 == 0) {
			if (ppiVar2 != NULL) {
				(**(code **)((int)*ppiVar2 + 8))(ppiVar2);
			}
			return 1;
		}
	}
	if (ppiVar2 != NULL) {
		(**(code **)((int)*ppiVar2 + 8))(ppiVar2);
	}
	return 0;
}



undefined4 __cdecl FUN_00483950(undefined4 param_1,float *param_2)
{
	int iVar1;
	float unaff_EBX;
	float unaff_ESI;
	float *pfVar2;
	float unaff_EDI;
	float *pfVar3;
	float local_80;
	float fStack124;
	float fStack120;
	float fStack116;
	float fStack112;
	float fStack108;
	float fStack104;
	float fStack100;
	float fStack96;
	float fStack92;
	float fStack88;
	float fStack84;
	float fStack80;
	float fStack76;
	float fStack72;
	float fStack68;
	float local_40 [4];
	float fStack48;
	float fStack44;
	float fStack40;
	float fStack36;
	float fStack32;
	float fStack28;
	float fStack24;
	float fStack20;
	float fStack16;
	
	pfVar2 = param_2;
	pfVar3 = local_40;
	for (iVar1 = 0x10; iVar1 != 0; iVar1 += -1) {
		*pfVar3 = *pfVar2;
		pfVar2 = pfVar2 + 1;
		pfVar3 = pfVar3 + 1;
	}
	(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->GetTransform)
						(lego::globals::g_IDirect3DDevice3,param_1,&local_80);
	if (((((unaff_EDI != fStack76) || (unaff_ESI != fStack72)) || (unaff_EBX != fStack68)) ||
			(((local_80 != local_40[0] || (fStack124 != local_40[1])) ||
			 ((fStack120 != local_40[2] || ((fStack116 != local_40[3] || (fStack112 != fStack48)))))))) ||
		 ((fStack108 != fStack44 ||
			(((((fStack104 != fStack40 || (fStack100 != fStack36)) || (fStack96 != fStack32)) ||
				((fStack92 != fStack28 || (fStack88 != fStack24)))) ||
			 ((fStack84 != fStack20 || (fStack80 != fStack16)))))))) {
		iVar1 = (*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetTransform)
											(lego::globals::g_IDirect3DDevice3,param_1,param_2);
		if (iVar1 != 0) {
			return 0;
		}
	}
	return 1;
}



BOOL __cdecl FUN_00483ad0(int param_1,undefined4 param_2)
{
	int iVar1;
	int iVar2;
	int iVar3;
	int *piStack12;
	
	iVar1 = param_1;
	piStack12 = (int *)param_1;
	iVar2 = (*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->GetTextureStageState)
										(lego::globals::g_IDirect3DDevice3,0);
	if (iVar2 != 0) {
		piStack12 = (int *)0xffffffff;
	}
	if (piStack12 != &param_1) {
		iVar2 = iVar1;
		iVar3 = (*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetTextureStageState)
											(lego::globals::g_IDirect3DDevice3,0,iVar1,&param_1);
		if (iVar3 != 0) {
			return 0;
		}
		if (*(int *)(&DAT_005353cc + iVar1 * 8) == 0) {
			*(undefined4 *)(&DAT_005353cc + iVar1 * 8) = 1;
			*(int *)(&DAT_005353c8 + iVar1 * 8) = iVar2;
		}
		else {
			if (*(int *)(&DAT_005353c8 + iVar1 * 8) == iVar2) {
				*(undefined4 *)(&DAT_005353cc + iVar1 * 8) = 0;
				return 1;
			}
		}
	}
	return 1;
}



void __cdecl lego::draw::Draw_UnkRenderTextureManagement__00483b70(void)
{
	(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->GetLightState)
						(lego::globals::g_IDirect3DDevice3,1,&lego::globals::g_Direct3D_LightState_New);
	lego::globals::g_Direct3D_LightState_Old = lego::globals::g_Direct3D_LightState_New;
	if (((byte)lego::globals::g_CMDLINE_FLAGS & CMD_NM) == 0) {
		(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->GetTexture)
							(lego::globals::g_IDirect3DDevice3,0,&lego::globals::g_IDirect3DTexture2_New);
		lego::globals::g_IDirect3DTexture2_Old = lego::globals::g_IDirect3DTexture2_New;
		(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->GetRenderState)
							(lego::globals::g_IDirect3DDevice3,1,&lego::globals::g_Direct3D_TextureHandle_New);
		if (lego::globals::g_Direct3D_TextureHandle_New != 0) {
			(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetRenderState)
								(lego::globals::g_IDirect3DDevice3,1,0);
			return;
		}
	}
	else {
		(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->GetRenderState)
							(lego::globals::g_IDirect3DDevice3,1,&lego::globals::g_Direct3D_TextureHandle_New);
		lego::globals::g_Direct3D_TextureHandle_Old = lego::globals::g_Direct3D_TextureHandle_New;
	}
	return;
}



void __cdecl lego::draw::Draw_UnkRenderTextureManagement__00483c00(void)
{
	if (lego::globals::g_Direct3D_LightState_Old != lego::globals::g_Direct3D_LightState_New) {
		(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetLightState)
							(lego::globals::g_IDirect3DDevice3,1,lego::globals::g_Direct3D_LightState_New);
	}
	if (((byte)lego::globals::g_CMDLINE_FLAGS & CMD_NM) == 0) {
		if (lego::globals::g_IDirect3DTexture2_Old != lego::globals::g_IDirect3DTexture2_New) {
			(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetTexture)
								(lego::globals::g_IDirect3DDevice3,0,lego::globals::g_IDirect3DTexture2_New);
		}
		if (lego::globals::g_Direct3D_TextureHandle_New != 0) {
			(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetRenderState)
								(lego::globals::g_IDirect3DDevice3,1,lego::globals::g_Direct3D_TextureHandle_New);
			return;
		}
	}
	else {
		(*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetRenderState)
							(lego::globals::g_IDirect3DDevice3,1,lego::globals::g_Direct3D_TextureHandle_New);
	}
	return;
}



uint __cdecl FUN_00483c80(uint *param_1,float *param_2,int param_3)
{
	int iVar1;
	uint uVar2;
	uint uVar3;
	int iVar4;
	undefined4 *puVar5;
	uint local_4;
	
	uVar3 = 0;
	local_4 = 1;
	if (*param_1 != 0) {
		iVar4 = 0;
		do {
			puVar5 = (undefined4 *)(param_1[2] + iVar4);
			iVar1 = FUN_00483d30((int)puVar5);
			if ((iVar1 != 0) && (puVar5[0x19] == 0)) {
				uVar2 = FUN_00483d50(param_1,puVar5,param_2,param_3);
				if (uVar2 == 0) {
					local_4 = uVar2;
				}
			}
			uVar3 += 1;
			iVar4 += 0x70;
		} while (uVar3 < *param_1);
	}
	uVar3 = 0;
	if (*param_1 != 0) {
		iVar4 = 0;
		do {
			puVar5 = (undefined4 *)(param_1[2] + iVar4);
			iVar1 = FUN_00483d30((int)puVar5);
			if ((iVar1 != 0) && (puVar5[0x19] != 0)) {
				uVar2 = FUN_00483d50(param_1,puVar5,param_2,param_3);
				if (uVar2 == 0) {
					local_4 = uVar2;
				}
			}
			uVar3 += 1;
			iVar4 += 0x70;
		} while (uVar3 < *param_1);
	}
	return local_4;
}



undefined4 __cdecl FUN_00483d30(int param_1)
{
	if (((*(uint *)(param_1 + 0x6c) & 1) == 0) && ((*(uint *)(param_1 + 0x6c) & 0x10000000) == 0)) {
		return 1;
	}
	return 0;
}



uint __cdecl FUN_00483d50(undefined4 param_1,undefined4 *param_2,float *param_3,int param_4)
{
	uint uVar1;
	int iVar2;
	
	FUN_00483dc0(param_1,(int)param_2,param_3,param_4);
	uVar1 = FUN_00480a40(param_2 + 4);
	uVar1 = (uint)(uVar1 != 0);
	iVar2 = FUN_00483e30((void *)param_2[3],(int *)lego::globals::g_Direct3D_MaterialHandle,
											 (int *)param_2[0x18],0x112,(void *)param_2[3],param_2[1],param_2[2],*param_2)
	;
	if (iVar2 == 0) {
		uVar1 = 0;
	}
	return uVar1;
}



BOOL __cdecl FUN_00483dc0(undefined4 param_1,int param_2,float *param_3,int param_4)
{
	undefined4 uVar1;
	
	if (((byte)lego::globals::g_CMDLINE_FLAGS & CMD_NM) == 0) {
		if (((*(uint *)(param_2 + 0x6c) & 0x100000) == 0) || (*(int *)(param_2 + 0x60) == 0)) {
			uVar1 = 4;
		}
		else {
			uVar1 = 2;
		}
		FUN_00483ad0(1,uVar1);
	}
	lego::draw::Draw_SetRenderState(0x29,(uint)((*(uint *)(param_2 + 0x6c) & 0x400000) != 0));
	if (*(uint *)(param_2 + 100) != 0) {
		FUN_00482e10(*(uint *)(param_2 + 100),param_3,param_4);
		return 1;
	}
	return 0;
}



undefined4 __thiscall
FUN_00483e30(void *this,int *param_1,int *param_2,undefined4 param_3,undefined4 param_4,
						undefined4 param_5,undefined4 param_6,undefined4 param_7)
{
	int iVar1;
	undefined4 uVar2;
	void *local_4;
	
	uVar2 = 1;
	if (((byte)lego::globals::g_CMDLINE_FLAGS & CMD_NM) == 0) {
		local_4 = this;
		if ((IDirect3DTexture2 *)param_2 != lego::globals::g_IDirect3DTexture2_Old) {
			iVar1 = (*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetTexture)
												(lego::globals::g_IDirect3DDevice3,0,param_2);
			if (iVar1 == 0) {
				lego::globals::g_IDirect3DTexture2_Old = (IDirect3DTexture2 *)param_2;
			}
			else {
				uVar2 = 0;
			}
		}
	}
	else {
		local_4 = NULL;
		if (param_2 != NULL) {
			(*lego::globals::g_IDirect3DDevice3->lpVtbl->QueryInterface)
								((IUnknown *)lego::globals::g_IDirect3DDevice3,(IID *)&idl::IID_IDirect3DDevice2,
								 &param_2);
			(**(code **)(*param_2 + 0xc))(param_2,param_2,&local_4);
			if (param_2 != NULL) {
				(**(code **)(*param_2 + 8))(param_2);
			}
		}
		if (local_4 != (void *)lego::globals::g_Direct3D_TextureHandle_Old) {
			lego::draw::Draw_SetRenderState(1,local_4);
			lego::globals::g_Direct3D_TextureHandle_Old = (DWORD)local_4;
		}
	}
	if (param_1 != (int *)lego::globals::g_Direct3D_LightState_Old) {
		iVar1 = (*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->SetLightState)
											(lego::globals::g_IDirect3DDevice3,1,param_1);
		if (iVar1 == 0) {
			lego::globals::g_Direct3D_LightState_Old = (uint)param_1;
		}
		else {
			uVar2 = 0;
		}
	}
	iVar1 = (*(code *)lego::globals::g_IDirect3DDevice3->lpVtbl->DrawIndexedPrimitive)
										(lego::globals::g_IDirect3DDevice3,4,param_3,param_4,param_5,param_6,param_7,0);
	if (iVar1 != 0) {
		uVar2 = 0;
	}
	return uVar2;
}



BOOL __cdecl lego::unk::Lego_CrashesFunc_00483f40(char *param_1,int *param_2)
{
	char cVar1;
	IDirectDraw4 *This;
	undefined4 *puVar2;
	BOOL BVar3;
	void *pvVar4;
	FileStream *pFVar5;
	int iVar6;
	int iVar7;
	uint uVar8;
	uint uVar9;
	char *pcVar10;
	char *pcVar11;
	undefined4 *puVar12;
	undefined4 local_400;
	undefined local_3fc [104];
	DWORD local_394;
	undefined4 local_300 [64];
	undefined4 local_200 [64];
	undefined4 local_100 [58];
	char *pcStack24;
	undefined4 uStack16;
	
	This = globals::g_IDirectDraw4;
	puVar2 = (undefined4 *)std::malloc(0x6e8);
	*param_2 = (int)puVar2;
	for (iVar6 = 0x1ba; iVar6 != 0; iVar6 += -1) {
		*puVar2 = 0;
		puVar2 = puVar2 + 1;
	}
	*(undefined4 *)(*param_2 + 0x6d4) = 4;
	FUN_00490350(param_1,&local_400,local_100,local_300,local_200);
	BVar3 = bin::Flic_OpenRead__00484220(param_1,param_2);
	if (BVar3 == 0) {
		return 0;
	}
	iVar6 = *param_2;
	puVar2 = (undefined4 *)local_3fc;
	for (iVar7 = 0x1f; iVar7 != 0; iVar7 += -1) {
		*puVar2 = 0;
		puVar2 = puVar2 + 1;
	}
	local_3fc._0_4_ = 0x7c;
	local_3fc._4_4_ = 7;
	local_394 = 0x840;
	local_3fc._12_4_ = (uint)*(ushort *)(iVar6 + 0x648);
	local_3fc._8_4_ = (uint)*(ushort *)(iVar6 + 0x64a);
	*(uint *)(iVar6 + 0xc) = local_3fc._12_4_;
	*(uint *)(*param_2 + 0x10) = local_3fc._8_4_;
	(*This->lpVtbl->CreateSurface)
						(This,(DDSURFACEDESC2 *)local_3fc,(IDirectDrawSurface4 **)(*param_2 + 0x63c),NULL);
										// POINT OF FAILURE (pointer evaluated to -1)
	(**(code **)(**(int **)(*param_2 + 0x63c) + 0x74))(*(int **)(*param_2 + 0x63c),8,&stack0xfffffbe8)
	;
	*(undefined4 *)*param_2 = uStack16;
	uVar8 = 0xffffffff;
	pcVar10 = pcStack24;
	do {
		pcVar11 = pcVar10;
		if (uVar8 == 0) break;
		uVar8 -= 1;
		pcVar11 = pcVar10 + 1;
		cVar1 = *pcVar10;
		pcVar10 = pcVar11;
	} while (cVar1 != '\0');
	uVar8 = ~uVar8;
	puVar2 = (undefined4 *)(pcVar11 + -uVar8);
	puVar12 = (undefined4 *)(*param_2 + 0x1c);
	for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
		*puVar12 = *puVar2;
		puVar2 = puVar2 + 1;
		puVar12 = puVar12 + 1;
	}
	for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
		*(undefined *)puVar12 = *(undefined *)puVar2;
		puVar2 = (undefined4 *)((int)puVar2 + 1);
		puVar12 = (undefined4 *)((int)puVar12 + 1);
	}
	*(undefined4 *)(*param_2 + 4) = 0;
	*(undefined4 *)(*param_2 + 8) = 0;
	*(undefined4 *)(*param_2 + 0x624) = 0;
	*(undefined4 *)(*param_2 + 0x628) = 0;
	*(undefined4 *)(*param_2 + 0x61c) = 0x190000;
	puVar2 = (undefined4 *)*param_2;
	if (((byte)*puVar2 & 1) == 1) {
		puVar2[0x18d] = 0;
		pvVar4 = std::malloc(*(uint *)(*param_2 + 0x640));
		*(void **)(*param_2 + 0x14) = pvVar4;
		pFVar5 = lego::file::File_Open(pcStack24,"rb");
		*(FileStream **)(*param_2 + 0x6c8) = pFVar5;
		lego::file::File_Seek(*(FileStream **)(*param_2 + 0x6c8),0x80,0);
		iVar6 = *param_2;
		lego::file::File_Read
							(*(byte **)(iVar6 + 0x14),*(uint *)(iVar6 + 0x640),1,*(FileStream **)(iVar6 + 0x6c8));
		lego::file::File_Close(*(FileStream **)(*param_2 + 0x6c8));
	}
	else {
		puVar2[0x18d] = 0x80;
		pFVar5 = lego::file::File_Open(pcStack24,"rb");
		*(FileStream **)(*param_2 + 0x6c8) = pFVar5;
		if (*(FileStream **)(*param_2 + 0x6c8) == NULL) {
			std::sprintf(local_3fc + 0x60,"Not Enough Memory > %s",pcStack24);
			return 0;
		}
		lego::file::File_Seek(*(FileStream **)(*param_2 + 0x6c8),0x80,0);
	}
	pvVar4 = std::malloc(20000);
	*(void **)(*param_2 + 0x6e0) = pvVar4;
	return 1;
}



undefined4 __cdecl FUN_004841c0(undefined4 *param_1)
{
	if (param_1 == NULL) {
		return 0;
	}
	if (((byte)*param_1 & 1) == 1) {
		std::free((void *)param_1[5]);
	}
	else {
		lego::file::File_Close((FileStream *)param_1[0x1b2]);
	}
	if ((void *)param_1[0x1b8] != NULL) {
		std::free((void *)param_1[0x1b8]);
		param_1[0x1b8] = 0;
	}
	return 1;
}



BOOL __cdecl lego::bin::Flic_OpenRead__00484220(char *filename,int *param_2)
{
	ushort uVar1;
	int iVar2;
	FileStream *file;
	int iVar3;
	char *format;
	char local_80 [128];
	
	file = lego::file::File_Open(filename,"rb");
	if (file == NULL) {
		format = "Flic File Not Found %s";
	}
	else {
		lego::file::File_Seek(file,0,0);
		lego::file::File_Read((byte *)(*param_2 + 0x640),0x88,1,file);
		iVar2 = *param_2;
		iVar3 = lego::file::File_GetLength(file);
		if (*(int *)(iVar2 + 0x640) != iVar3) {
			lego::file::File_Close(file);
			std::sprintf(local_80,"Flic File Invalid",filename);
			return 0;
		}
		uVar1 = *(ushort *)(iVar2 + 0x644);
		if (uVar1 < 0x911a) {
			if ((uVar1 == 0x9119) || (uVar1 == 0x1234)) {
LAB_004842d2:
				lego::file::File_Close(file);
				return 1;
			}
		}
		else {
			if (((uVar1 == 0xaf11) || (uVar1 == 0xaf12)) || (uVar1 == 0xaf43)) goto LAB_004842d2;
		}
		lego::file::File_Close(file);
		format = "Flic File Invalid %s";
	}
	std::sprintf(local_80,format,filename);
	return 0;
}



uint __cdecl
FUN_00484330(uint *param_1,float *param_2,undefined4 param_3,undefined4 param_4,undefined4 param_5)
{
	IDirectDrawSurface4 *This;
	int iVar1;
	int iVar2;
	undefined4 *puVar3;
	longlong lVar4;
	longlong lVar5;
	longlong lVar6;
	undefined4 *puStack268;
	LONG LStack264;
	LONG LStack260;
	int local_f0;
	int local_ec;
	int local_e8;
	uint local_e4;
	undefined4 local_e0 [4];
	uint uStack208;
	int iStack152;
	undefined4 auStack128 [20];
	undefined4 uStack48;
	int iStack12;
	int iStack8;
	
	This = lego::globals::g_IDirectDrawSurface4_DrawTarget;
	LStack260 = 0x48434e;
	lVar4 = __ftol((float10)*param_2);
	LStack260 = 0x48435c;
	local_f0 = (int)lVar4;
	lVar5 = __ftol((float10)param_2[1]);
	LStack260 = 0x48436a;
	local_ec = (int)lVar5;
	lVar6 = __ftol((float10)param_2[2]);
	local_e8 = (int)lVar6 + (int)lVar4;
	LStack260 = 0x484378;
	lVar4 = __ftol((float10)param_2[3]);
	local_e4 = (int)lVar4 + (int)lVar5;
	iVar2 = 0;
	puStack268 = local_e0;
	puVar3 = local_e0;
	for (iVar1 = 0x1f; iVar1 != 0; iVar1 += -1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	LStack260 = 0;
	LStack264 = 1;
	local_e0[0] = 0x7c;
	(**(code **)(*(int *)param_1[399] + 100))((int *)param_1[399],0);
	param_1[0x18e] = local_e4;
	param_1[0x1b3] = uStack208;
	param_1[0x1b9] = (uint)(iStack152 == 0x3e0);
	iVar1 = 1;
	if (param_1[0x189] != 0) {
		iVar1 = iStack8;
	}
	if (iVar1 != 0) {
		if (((byte)*param_1 & 1) == 1) {
			iVar2 = FUN_00484490(param_1);
		}
		else {
			iVar2 = FUN_00484520(param_1);
		}
	}
	(**(code **)(*(int *)param_1[399] + 0x80))((int *)param_1[399],0);
	puVar3 = auStack128;
	for (iVar1 = 0x19; iVar1 != 0; iVar1 += -1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	auStack128[0] = 100;
	uStack48 = 0xff00;
	(*This->lpVtbl->Blt)
						(This,(LPRECT)&puStack268,(IDirectDrawSurface4 *)param_1[399],NULL,
						 -(uint)(iStack12 != 0) & 0x8000 | 0x1000000,auStack128);
	return (uint)(iVar2 == 0);
}



undefined4 __cdecl FUN_00484490(uint *param_1)
{
	uint uVar1;
	undefined4 uVar2;
	
	uVar2 = 0;
	FUN_004845e0(param_1);
	if (param_1[0x189] == 0) {
		param_1[0x18c] = param_1[0x18d];
	}
	uVar1 = param_1[0x189] + 1;
	param_1[0x189] = uVar1;
	param_1[0x18a] = param_1[0x18a] + 1;
	if (((byte)*param_1 & 2) == 2) {
		if (uVar1 == *(ushort *)((int)param_1 + 0x646) + 1) {
			param_1[0x189] = 1;
			param_1[0x18d] = param_1[0x18c];
			return 0;
		}
	}
	else {
		if (uVar1 == *(ushort *)((int)param_1 + 0x646) + 1) {
			uVar2 = 1;
		}
	}
	return uVar2;
}



undefined4 __cdecl FUN_00484520(uint *param_1)
{
	uint uVar1;
	undefined4 uVar2;
	
	uVar2 = 0;
	if (param_1[0x189] == 0) {
		param_1[0x18c] = param_1[0x18d];
	}
	lego::file::File_Read((byte *)param_1[0x1b8],0x10,1,(FileStream *)param_1[0x1b2]);
	FUN_004845e0(param_1);
	uVar1 = param_1[0x189] + 1;
	param_1[0x189] = uVar1;
	param_1[0x18a] = param_1[0x18a] + 1;
	if (((byte)*param_1 & 2) == 2) {
		if ((int)(uint)*(ushort *)((int)param_1 + 0x646) < (int)uVar1) {
			lego::file::File_Seek((FileStream *)param_1[0x1b2],param_1[0x18c],0);
			param_1[0x18d] = param_1[0x18c];
			param_1[0x189] = 0;
			return 0;
		}
	}
	else {
		if ((int)(uint)*(ushort *)((int)param_1 + 0x646) < (int)uVar1) {
			uVar2 = 1;
		}
	}
	return uVar2;
}



undefined4 __cdecl FUN_004845e0(uint *param_1)
{
	short sVar1;
	uint uVar2;
	bool bVar3;
	uint uVar4;
	int iVar5;
	int *piVar6;
	
	if ((*param_1 & 1) == 1) {
		piVar6 = (int *)param_1[5];
	}
	else {
		piVar6 = (int *)param_1[0x1b8];
	}
	uVar2 = param_1[0x18d];
	if ((*param_1 & 1) == 1) {
		iVar5 = *(int *)((int)piVar6 + uVar2);
		piVar6 = (int *)((int)piVar6 + uVar2);
		bVar3 = false;
		while ((int)param_1[0x18d] < (int)param_1[400]) {
			sVar1 = *(short *)(piVar6 + 1);
			if (sVar1 == 0xb) {
				FUN_00484a90(param_1);
				uVar4 = param_1[0x18d] + *piVar6;
LAB_00484688:
				param_1[0x18d] = uVar4;
LAB_0048468e:
				piVar6 = (int *)((int)piVar6 + *piVar6);
				iVar5 += *piVar6;
			}
			else {
				if (sVar1 == 0x4b4c) {
					FUN_004849e0(param_1);
					param_1[0x18d] = param_1[0x18d] + *piVar6;
					goto LAB_0048468e;
				}
				if (sVar1 != -0xe06) {
					uVar4 = *piVar6 + param_1[0x18d];
					goto LAB_00484688;
				}
				FUN_00484770(param_1);
				bVar3 = true;
			}
			if (bVar3) {
				param_1[0x18d] = uVar2 + iVar5;
				return 0;
			}
		}
	}
	else {
		iVar5 = *piVar6;
		bVar3 = false;
		do {
			if ((int)param_1[400] <= (int)param_1[0x18d]) break;
			sVar1 = *(short *)(piVar6 + 1);
			if (sVar1 == 0xb) {
				FUN_00484a90(param_1);
LAB_00484704:
				uVar4 = param_1[0x18d] + *piVar6;
				param_1[0x18d] = uVar4;
LAB_00484719:
				lego::file::File_Seek((FileStream *)param_1[0x1b2],uVar4,0);
				piVar6 = (int *)param_1[0x1b8];
				lego::file::File_Read((byte *)piVar6,0x10,1,(FileStream *)param_1[0x1b2]);
				iVar5 += *piVar6;
			}
			else {
				if (sVar1 == 0x4b4c) {
					FUN_004849e0(param_1);
					goto LAB_00484704;
				}
				if (sVar1 != -0xe06) {
					uVar4 = *piVar6 + param_1[0x18d];
					param_1[0x18d] = uVar4;
					goto LAB_00484719;
				}
				FUN_00484770(param_1);
				bVar3 = true;
			}
		} while (!bVar3);
	}
	param_1[0x18d] = uVar2 + iVar5;
	return 0;
}



undefined4 __cdecl FUN_00484770(undefined4 *param_1)
{
	char cVar1;
	uint length;
	int iVar2;
	int *piVar3;
	char local_80 [128];
	
	if (((byte)*param_1 & 1) == 1) {
		iVar2 = param_1[5] + param_1[0x18d];
		cVar1 = *(char *)(iVar2 + 6);
		piVar3 = (int *)(iVar2 + 0x10);
		param_1[0x18d] = param_1[0x18d] + 0x10;
		if ('\0' < cVar1) {
			while ((int)param_1[0x18d] < (int)param_1[400]) {
				param_1[0x1b4] = piVar3;
				FUN_004848d0((uint)param_1);
				param_1[0x18d] = param_1[0x18d] + *piVar3;
				piVar3 = (int *)((int)piVar3 + *piVar3);
				cVar1 += -1;
				if (cVar1 < '\x01') {
					return 1;
				}
			}
		}
	}
	else {
		piVar3 = (int *)param_1[0x1b8];
		cVar1 = *(char *)((int)piVar3 + 6);
		length = *piVar3 - 0x10;
		if ((int)param_1[0x1b7] < (int)length) {
			if (piVar3 != NULL) {
				std::free(piVar3);
			}
			param_1[0x1b7] = length;
			piVar3 = (int *)std::malloc(length);
			param_1[0x1b8] = piVar3;
			if (piVar3 == NULL) {
				std::sprintf(local_80,"Flic Not Enough Memory");
				return 0;
			}
		}
		lego::file::File_Read((byte *)piVar3,length,1,(FileStream *)param_1[0x1b2]);
		param_1[0x18d] = param_1[0x18d] + 0x10;
		while (('\0' < cVar1 && ((int)param_1[0x18d] < (int)param_1[400]))) {
			param_1[0x1b4] = piVar3;
			FUN_004848d0((uint)param_1);
			param_1[0x18d] = param_1[0x18d] + *piVar3;
			piVar3 = (int *)((int)piVar3 + *piVar3);
			cVar1 += -1;
		}
	}
	return 1;
}



undefined4 __cdecl FUN_004848d0(uint param_1)
{
	undefined4 uVar1;
	int iVar2;
	
	uVar1 = 0;
	iVar2 = (int)*(short *)(*(int *)(param_1 + 0x6d0) + 4);
	if (iVar2 < 8) {
		if (iVar2 == 7) {
switchD_0048492b_caseD_1b:
			FUN_004852f0(param_1);
			return 1;
		}
		if (iVar2 == 4) {
			FUN_00484ec0(param_1);
			return 1;
		}
	}
	else {
		if (iVar2 < 0x5345) {
			if (iVar2 != 0x5344) {
				if (false) {
					return 0;
				}
				switch(iVar2) {
				case 0xb:
					lego::nerps::funcs::NERPFunc__True((int *)param_1);
					return 1;
				case 0xc:
					lego::nerps::funcs::NERPFunc__True((int *)param_1);
					return 1;
				case 0xd:
					lego::nerps::funcs::NERPFunc__True((int *)param_1);
					return 1;
				default:
					return 0;
				case 0xf:
				case 0x19:
					FUN_00484de0(param_1);
					return 1;
				case 0x10:
					FUN_00484b40(param_1);
					return 1;
				case 0x1b:
					goto switchD_0048492b_caseD_1b;
				}
			}
		}
		else {
			if (iVar2 != 0x5555) {
				return 0;
			}
			lego::nerps::funcs::NERPFunc__False((int *)param_1);
		}
		uVar1 = 1;
	}
	return uVar1;
}



undefined4 __cdecl FUN_004849e0(undefined4 *param_1)
{
	uint length;
	uint *out_buffer;
	char local_100 [256];
	
	if (((byte)*param_1 & 1) != 1) {
		out_buffer = (uint *)param_1[0x1b8];
		length = *out_buffer;
		if ((int)param_1[0x1b7] < (int)length) {
			if (out_buffer != NULL) {
				std::free(out_buffer);
			}
			param_1[0x1b7] = length;
			out_buffer = (uint *)std::malloc(length);
			param_1[0x1b8] = out_buffer;
			if (out_buffer == NULL) {
				std::sprintf(local_100,"Flic Not Enough Memory");
				return 0;
			}
		}
		lego::file::File_Seek((FileStream *)param_1[0x1b2],param_1[0x18d],0);
		lego::file::File_Read((byte *)out_buffer,length,1,(FileStream *)param_1[0x1b2]);
	}
	return 0;
}



undefined4 __cdecl FUN_00484a90(undefined4 *param_1)
{
	uint length;
	uint *out_buffer;
	char local_80 [128];
	
	if (((byte)*param_1 & 1) != 1) {
		out_buffer = (uint *)param_1[0x1b8];
		length = *out_buffer;
		if ((int)param_1[0x1b7] < (int)length) {
			if (out_buffer != NULL) {
				std::free(out_buffer);
			}
			param_1[0x1b7] = length;
			out_buffer = (uint *)std::malloc(length);
			param_1[0x1b8] = out_buffer;
			if (out_buffer == NULL) {
				std::sprintf(local_80,"Flic Not Enough Memory");
				return 1;
			}
		}
		lego::file::File_Seek((FileStream *)param_1[0x1b2],param_1[0x18d],0);
		lego::file::File_Read((byte *)out_buffer,length,1,(FileStream *)param_1[0x1b2]);
	}
	return 0;
}



undefined4 __cdecl FUN_00484b40(int param_1)
{
	if (*(int *)(param_1 + 0x6d8) == 0x10) {
		lego::other::logf_removed((char *)param_1);
		return 1;
	}
	if (*(int *)(param_1 + 0x6d4) == 0) {
		lego::other::logf_removed((char *)param_1);
	}
	if (*(int *)(param_1 + 0x6d4) == 4) {
		lego::other::logf_removed((char *)param_1);
	}
	return 1;
}



undefined4 __cdecl FUN_00484b90(uint param_1)
{
	byte bVar1;
	byte bVar2;
	uint uVar3;
	uint uVar4;
	ushort uVar5;
	uint uVar6;
	uint uVar7;
	undefined2 *puVar8;
	byte *pbVar9;
	byte *pbVar10;
	int local_8;
	uint local_4;
	
	uVar3 = param_1;
	pbVar9 = (byte *)(*(int *)(param_1 + 0x6d0) + 7);
	if (*(ushort *)(param_1 + 0x10) != 0) {
		local_4 = (uint)*(ushort *)(param_1 + 0x10);
		local_8 = 0;
		do {
			uVar5 = *(ushort *)(uVar3 + 0xc);
			uVar6 = (uint)uVar5;
			puVar8 = (undefined2 *)
							 (*(int *)(uVar3 + 0x6cc) + (*(uint *)(uVar3 + 0x638) >> 1) * local_8 * 2);
			while (uVar5 != 0) {
				bVar2 = *pbVar9;
				uVar7 = (uint)bVar2;
				pbVar10 = pbVar9 + 1;
				if (bVar2 < 0x80) {
					bVar1 = *pbVar10;
					uVar6 -= uVar7;
					pbVar10 = pbVar9 + 2;
					param_1 = param_1 & 0xffffff00 | (uint)bVar1;
					if (bVar2 != 0) {
						do {
							uVar4 = FUN_00485380(param_1,uVar3);
							*puVar8 = (short)uVar4;
							puVar8 = puVar8 + 1;
							uVar7 -= 1;
						} while (uVar7 != 0);
					}
				}
				else {
					uVar7 = 0x100 - uVar7;
					uVar6 -= uVar7;
					if ((short)uVar7 != 0) {
						uVar7 &= 0xffff;
						do {
							param_1 = param_1 & 0xffffff00 | (uint)*pbVar10;
							pbVar10 = pbVar10 + 1;
							uVar4 = FUN_00485380(param_1,uVar3);
							*puVar8 = (short)uVar4;
							puVar8 = puVar8 + 1;
							uVar7 -= 1;
						} while (uVar7 != 0);
					}
				}
				pbVar9 = pbVar10;
				uVar5 = (ushort)uVar6;
			}
			local_8 += 1;
			pbVar9 = pbVar9 + 1;
			local_4 -= 1;
		} while (local_4 != 0);
	}
	return 1;
}



undefined4 __cdecl FUN_00484c90(uint param_1)
{
	ushort uVar1;
	short sVar2;
	uint uVar3;
	ushort uVar4;
	uint uVar5;
	uint uVar6;
	ushort *puVar7;
	ushort *puVar8;
	ushort *puVar9;
	short sVar10;
	
	uVar3 = param_1;
	param_1 = 0;
	sVar2 = *(short *)(uVar3 + 0x10);
	puVar8 = (ushort *)(*(int *)(uVar3 + 0x6d0) + 7);
	if (0 < sVar2) {
		uVar5 = 0;
		do {
			sVar10 = *(short *)(uVar3 + 0xc);
			puVar7 = (ushort *)(*(int *)(uVar3 + 0x6cc) + (*(uint *)(uVar3 + 0x638) >> 1) * uVar5 * 2);
			while (0 < sVar10) {
				uVar4 = (ushort)*(byte *)puVar8;
				puVar9 = (ushort *)((int)puVar8 + 1);
				if (uVar4 < 0x80) {
					uVar1 = *puVar9;
					sVar10 -= uVar4;
					puVar8 = (ushort *)((int)puVar8 + 3);
					uVar5 = (uVar1 & 0xffe0) << 1;
					if (uVar4 != 0) {
						uVar6 = (uint)uVar4;
						do {
							if (*(int *)(uVar3 + 0x6e4) == 0) {
								uVar4 = (ushort)uVar5;
							}
							else {
								uVar4 = (ushort)((uVar5 & 0xffff) >> 1);
							}
							*puVar7 = uVar4 | uVar1 & 0x1f;
							puVar7 = puVar7 + 1;
							uVar6 -= 1;
						} while (uVar6 != 0);
					}
				}
				else {
					uVar4 = 0x100 - uVar4;
					sVar10 -= uVar4;
					puVar8 = puVar9;
					if (uVar4 != 0) {
						uVar5 = (uint)uVar4;
						do {
							uVar4 = *puVar9;
							puVar9 = puVar9 + 1;
							uVar6 = (uVar4 & 0xffe0) << 1;
							if (*(int *)(uVar3 + 0x6e4) == 0) {
								uVar1 = (ushort)uVar6;
							}
							else {
								uVar1 = (ushort)((uVar6 & 0xffff) >> 1);
							}
							*puVar7 = uVar1 | uVar4 & 0x1f;
							puVar7 = puVar7 + 1;
							uVar5 -= 1;
							puVar8 = puVar9;
						} while (uVar5 != 0);
					}
				}
			}
			puVar8 = (ushort *)((int)puVar8 + 1);
			param_1 += 1;
			uVar5 = param_1 & 0xffff;
		} while ((int)uVar5 < (int)sVar2);
	}
	return 1;
}



undefined4 __cdecl FUN_00484de0(uint param_1)
{
	if (*(short *)(param_1 + 0x64c) == 8) {
		if (*(int *)(param_1 + 0x6d4) == 0) {
			lego::nerps::funcs::NERPFunc__True((int *)param_1);
		}
		if (*(int *)(param_1 + 0x6d4) == 4) {
			FUN_00484b90(param_1);
			return 1;
		}
	}
	else {
		if (*(short *)(param_1 + 0x64c) == 0x10) {
			if (*(short *)(param_1 + 0x644) == -0x50bd) {
				FUN_00484c90(param_1);
				return 1;
			}
			lego::nerps::funcs::NERPFunc__True((int *)param_1);
		}
	}
	return 1;
}



int __cdecl lego::nerps::funcs::NERPFunc__True(int *stack)
{
	return 1;
}



void __cdecl FUN_00484e60(int param_1)
{
	byte *pbVar1;
	ushort *puVar2;
	int iVar3;
	
	iVar3 = 0x100;
	pbVar1 = (byte *)(param_1 + 0x11c);
	puVar2 = (ushort *)(param_1 + 0x41c);
	do {
		iVar3 += -1;
		*puVar2 = (ushort)(((uint)pbVar1[1] | (*pbVar1 & 0xffff003e) << 5) << 5) |
							(ushort)(pbVar1[2] >> 1);
		pbVar1 = pbVar1 + 3;
		puVar2 = puVar2 + 1;
	} while (iVar3 != 0);
	*(ushort *)(param_1 + 0x41c) = 0;
	return;
}



undefined4 __cdecl FUN_00484ec0(int param_1)
{
	byte bVar1;
	byte *pbVar2;
	byte *pbVar3;
	byte *pbVar4;
	uint uVar5;
	int iVar6;
	short sVar7;
	
	pbVar4 = (byte *)(param_1 + 0x11c);
	pbVar2 = (byte *)(*(int *)(param_1 + 0x6d0) + 8);
	for (sVar7 = *(short *)(*(int *)(param_1 + 0x6d0) + 6); sVar7 != 0; sVar7 += -1) {
		pbVar3 = pbVar2 + 2;
		uVar5 = (uint)pbVar2[1];
		pbVar4 = pbVar4 + (uint)*pbVar2 * 3;
		if (pbVar2[1] == 0) {
			sVar7 = 1;
			uVar5 = 0x100;
			pbVar4 = (byte *)(param_1 + 0x11c);
		}
		iVar6 = uVar5 * 3;
		if ((short)iVar6 != 0) {
			do {
				bVar1 = *pbVar3;
				pbVar3 = pbVar3 + 1;
				*pbVar4 = bVar1 >> 2;
				pbVar4 = pbVar4 + 1;
				iVar6 += -1;
			} while (iVar6 != 0);
		}
		pbVar2 = pbVar3;
	}
	if (*(int *)(param_1 + 0x6d4) == 4) {
		FUN_00484e60(param_1);
	}
	return 1;
}



void __cdecl lego::other::logf_removed(char *message,...)
{
	return;
}



void __cdecl FUN_00484f60(uint param_1)
{
	int *piVar1;
	byte bVar2;
	ushort uVar3;
	uint uVar4;
	ushort uVar5;
	uint uVar6;
	uint uVar7;
	short sVar8;
	short sVar9;
	undefined2 *puVar10;
	ushort *puVar11;
	ushort *puVar12;
	uint local_18;
	uint local_14;
	uint local_10;
	uint local_4;
	
	uVar4 = param_1;
	piVar1 = (int *)(param_1 + 0x6d0);
	param_1 = 0;
	sVar9 = *(short *)(*piVar1 + 6);
	puVar11 = (ushort *)(*piVar1 + 8);
	sVar8 = sVar9;
	while( true ) {
		while( true ) {
			if (sVar8 == 0) {
				return;
			}
			uVar3 = *puVar11;
			puVar10 = (undefined2 *)
								((param_1 & 0xffff) * *(int *)(uVar4 + 0x638) + *(int *)(uVar4 + 0x6cc));
			uVar5 = uVar3 >> 0xc & 0xc;
			if (uVar5 != 0xc) break;
			puVar11 = puVar11 + 1;
			param_1 -= uVar3;
		}
		if (uVar5 == 4) break;
		if (uVar5 == 8) {
			bVar2 = *(byte *)puVar11;
			puVar11 = puVar11 + 1;
			local_4 = local_4 & 0xffffff00 | (uint)bVar2;
		}
		uVar3 = *puVar11;
		puVar11 = puVar11 + 1;
		if (uVar3 != 0) {
			local_10 = (uint)uVar3;
			puVar12 = puVar11;
			do {
				bVar2 = *(byte *)((int)puVar12 + 1);
				uVar6 = (uint)bVar2;
				puVar11 = puVar12 + 1;
				puVar10 = puVar10 + *(byte *)puVar12;
				if ((bVar2 & 0x80) == 0) {
					if (bVar2 != 0) {
						do {
							local_18 = local_18 & 0xffffff00 | (uint)*(byte *)puVar11;
							local_14 = local_14 & 0xffffff00 | (uint)*(byte *)((int)puVar11 + 1);
							puVar11 = puVar11 + 1;
							uVar7 = FUN_00485380(local_18,uVar4);
							*puVar10 = (short)uVar7;
							uVar7 = FUN_00485380(local_14,uVar4);
							puVar10[1] = (short)uVar7;
							puVar10 = puVar10 + 2;
							uVar6 -= 1;
						} while (uVar6 != 0);
					}
				}
				else {
					local_18 = local_18 & 0xffffff00 | (uint)*(byte *)puVar11;
					puVar11 = puVar12 + 2;
					local_14 = local_14 & 0xffffff00 | (uint)*(byte *)((int)puVar12 + 3);
					if ((short)(0x100 - uVar6) != 0) {
						uVar6 = 0x100 - uVar6 & 0xffff;
						do {
							uVar7 = FUN_00485380(local_18,uVar4);
							*puVar10 = (short)uVar7;
							uVar7 = FUN_00485380(local_14,uVar4);
							puVar10[1] = (short)uVar7;
							puVar10 = puVar10 + 2;
							uVar6 -= 1;
						} while (uVar6 != 0);
					}
				}
				local_10 -= 1;
				puVar12 = puVar11;
				sVar8 = sVar9;
			} while (local_10 != 0);
		}
		if (uVar5 == 8) {
			uVar6 = FUN_00485380(local_4,uVar4);
			*puVar10 = (short)uVar6;
		}
		sVar9 = sVar8 + -1;
		param_1 += 1;
		sVar8 = sVar9;
	}
	return;
}



// WARNING: Could not reconcile some variable overlaps

void __cdecl FUN_00485110(uint param_1)
{
	int *piVar1;
	byte bVar2;
	ushort uVar3;
	bool bVar4;
	short sVar5;
	uint uVar6;
	ushort uVar7;
	uint uVar8;
	short sVar9;
	uint uVar10;
	ushort *puVar11;
	ushort *puVar12;
	ushort *puVar13;
	uint local_10;
	uint local_8;
	
	uVar6 = param_1;
	piVar1 = (int *)(param_1 + 0x6d0);
	param_1 = 0;
	sVar9 = *(short *)(*piVar1 + 6);
	puVar11 = (ushort *)(*piVar1 + 8);
	sVar5 = sVar9;
	while( true ) {
		while( true ) {
			if (sVar9 == 0) {
				return;
			}
			uVar3 = *puVar11;
			uVar8 = (uint)uVar3;
			puVar13 = (ushort *)((param_1 & 0xffff) * *(int *)(uVar6 + 0x638) + *(int *)(uVar6 + 0x6cc));
			uVar7 = uVar3 >> 0xc & 0xc;
			if (uVar7 != 0xc) break;
			puVar11 = puVar11 + 1;
			param_1 -= uVar8;
		}
		if (uVar7 == 4) break;
		bVar4 = false;
		if (uVar7 == 8) {
			if (*(int *)(uVar6 + 0x6e4) != 0) {
				uVar8 = uVar3 >> 1 & 0x7ff0 | uVar8 & 0x1f;
			}
			puVar11 = puVar11 + 1;
			bVar4 = true;
			local_8 = uVar8;
		}
		uVar3 = *puVar11;
		puVar11 = puVar11 + 1;
		if (uVar3 != 0) {
			local_10 = (uint)uVar3;
			puVar12 = puVar11;
			do {
				bVar2 = *(byte *)((int)puVar12 + 1);
				uVar8 = (uint)bVar2;
				puVar11 = puVar12 + 1;
				puVar13 = puVar13 + *(byte *)puVar12;
				if ((bVar2 & 0x80) == 0) {
					if (bVar2 != 0) {
						do {
							uVar3 = *puVar11;
							puVar11 = puVar11 + 1;
							uVar10 = (uVar3 & 0xffe0) << 1;
							if (*(int *)(uVar6 + 0x6e4) == 0) {
								uVar7 = (ushort)uVar10;
							}
							else {
								uVar7 = (ushort)((uVar10 & 0xffff) >> 1);
							}
							*puVar13 = uVar7 | uVar3 & 0x1f;
							puVar13 = puVar13 + 1;
							uVar8 -= 1;
						} while (uVar8 != 0);
					}
				}
				else {
					uVar3 = *puVar11;
					puVar11 = puVar12 + 2;
					uVar10 = (uVar3 & 0xffe0) << 1;
					if ((short)(0x100 - uVar8) != 0) {
						uVar8 = 0x100 - uVar8 & 0xffff;
						do {
							if (*(int *)(uVar6 + 0x6e4) == 0) {
								uVar7 = (ushort)uVar10;
							}
							else {
								uVar7 = (ushort)((uVar10 & 0xffff) >> 1);
							}
							*puVar13 = uVar7 | uVar3 & 0x1f;
							puVar13 = puVar13 + 1;
							uVar8 -= 1;
						} while (uVar8 != 0);
					}
				}
				local_10 -= 1;
				puVar12 = puVar11;
				sVar9 = sVar5;
			} while (local_10 != 0);
		}
		if (bVar4) {
			*(undefined *)puVar13 = (undefined)local_8;
		}
		param_1 += 1;
		sVar9 += -1;
		sVar5 = sVar9;
	}
	return;
}



undefined4 __cdecl FUN_004852f0(uint param_1)
{
	if (*(short *)(param_1 + 0x64c) == 8) {
		if (*(int *)(param_1 + 0x6d4) == 0) {
			lego::other::logf_removed((char *)param_1);
		}
		if (*(int *)(param_1 + 0x6d4) == 4) {
			FUN_00484f60(param_1);
			return 1;
		}
	}
	else {
		if (*(short *)(param_1 + 0x64c) == 0x10) {
			if (*(short *)(param_1 + 0x644) == 0x1234) {
				lego::other::logf_removed((char *)param_1);
				return 1;
			}
			if (*(short *)(param_1 + 0x644) == -0x50bd) {
				FUN_00485110(param_1);
				return 1;
			}
			lego::other::logf_removed((char *)param_1);
		}
	}
	return 1;
}



uint __cdecl FUN_00485380(uint param_1,int param_2)
{
	return (uint)*(ushort *)(param_2 + 0x41c + (param_1 & 0xff) * 2);
}



undefined4 __cdecl FUN_004853a0(int param_1)
{
	return *(undefined4 *)(param_1 + 0x10);
}



Struct_830 * __cdecl
lego::unk::Lego_unkMakeDrawRegion__004853b0(ImageFont *font,Rect2F *area,uint size)
{
	Struct_830 *pSVar1;
	void *pvVar2;
	int iVar3;
	Struct_830 *pSVar4;
	
	pSVar1 = (Struct_830 *)std::malloc(0x830);
	if (pSVar1 != NULL) {
		pSVar4 = pSVar1;
		for (iVar3 = 0x20c; iVar3 != 0; iVar3 += -1) {
			pSVar4->font = NULL;
			pSVar4 = (Struct_830 *)&pSVar4->area;
		}
		pSVar1->font = font;
		(pSVar1->area).x = area->x;
		(pSVar1->area).y = area->y;
		(pSVar1->area).width = area->width;
		(pSVar1->area).height = area->height;
		pvVar2 = std::malloc(size);
		pSVar1->allocData = pvVar2;
		pSVar1->allocSize = size;
		draw::Draw_SetStruct830_Flag4(pSVar1,1);
	}
	return pSVar1;
}



void __cdecl lego::draw::Draw_SetStruct830_Flag4(Struct_830 *param_1,BOOL state)
{
	if (state != 0) {
		param_1->flags = param_1->flags | 4;
		return;
	}
	param_1->flags = param_1->flags & 0xfffffffb;
	return;
}



void __cdecl FUN_00485450(undefined *param_1)
{
	std::free(*(void **)(param_1 + 0x14));
	std::free(param_1);
	return;
}



void __cdecl FUN_00485470(void *param_1,int param_2,int param_3)
{
	*(float *)((int)param_1 + 4) = (float)param_2;
	*(float *)((int)param_1 + 8) = (float)param_3;
	return;
}



void __cdecl FUN_00485490(void *param_1,uint param_2,uint param_3)
{
	*(float *)((int)param_1 + 0xc) = (float)(ulonglong)param_2;
	*(float *)((int)param_1 + 0x10) = (float)(ulonglong)param_3;
	return;
}



void __cdecl FUN_004854d0(int param_1,int param_2,byte *param_3)
{
	FUN_00485510((Struct_830 *)param_1,param_2,(char *)param_3,(undefined4 *)&stack0x00000010);
	return;
}



void __cdecl lego::game::Game_DisplayInfoMessage(Struct_830 *param_1,char *param_2,...)
{
	FUN_00485510(param_1,0,param_2,(undefined4 *)&stack0x0000000c);
	return;
}



void __cdecl FUN_00485510(Struct_830 *param_1,int param_2,char *format,undefined4 *args)
{
	uint uVar1;
	uint uVar2;
	int iVar3;
	uint uVar4;
	char local_400 [1024];
	
	iVar3 = 0;
	uVar1 = std::vsprintf(local_400,format,args);
	uVar2 = 0;
	if (uVar1 != 0) {
		do {
			if (iVar3 == param_2) break;
			if (local_400[uVar2] == '\a') {
				iVar3 += 1;
			}
			uVar2 += 1;
		} while (uVar2 < uVar1);
	}
	if (uVar2 != uVar1) {
		for (; uVar2 < uVar1; uVar2 += 1) {
			*(char *)((int)param_1->allocData + *(int *)&param_1->field_0x41c) = local_400[uVar2];
			uVar4 = *(int *)&param_1->field_0x41c + 1;
			*(uint *)&param_1->field_0x41c = uVar4;
			if (uVar4 == param_1->allocSize) {
				*(undefined4 *)&param_1->field_0x41c = 0;
				param_1->flags = param_1->flags | 1;
			}
		}
	}
	return;
}



void __cdecl FUN_004855c0(int param_1,int param_2,byte *param_3)
{
	char cVar1;
	uint uVar2;
	uint uVar3;
	undefined4 *puVar4;
	char *pcVar5;
	char *pcVar6;
	undefined4 *puVar7;
	char local_400 [1024];
	
	std::vsprintf(local_400,(char *)param_3,&stack0x00000010);
	uVar2 = 0xffffffff;
	pcVar5 = local_400;
	do {
		pcVar6 = pcVar5;
		if (uVar2 == 0) break;
		uVar2 -= 1;
		pcVar6 = pcVar5 + 1;
		cVar1 = *pcVar5;
		pcVar5 = pcVar6;
	} while (cVar1 != '\0');
	uVar2 = ~uVar2;
	puVar4 = (undefined4 *)(pcVar6 + -uVar2);
	puVar7 = (undefined4 *)(param_1 + 0x18);
	for (uVar3 = uVar2 >> 2; uVar3 != 0; uVar3 -= 1) {
		*puVar7 = *puVar4;
		puVar4 = puVar4 + 1;
		puVar7 = puVar7 + 1;
	}
	for (uVar2 &= 3; uVar2 != 0; uVar2 -= 1) {
		*(undefined *)puVar7 = *(undefined *)puVar4;
		puVar4 = (undefined4 *)((int)puVar4 + 1);
		puVar7 = (undefined4 *)((int)puVar7 + 1);
	}
	if (param_2 == 0) {
		*(undefined4 *)(param_1 + 0x828) = 0x41c80000;
	}
	else {
		*(undefined4 *)(param_1 + 0x828) = 0;
	}
	*(uint *)(param_1 + 0x82c) = *(uint *)(param_1 + 0x82c) | 2;
	return;
}



undefined4 __cdecl FUN_00485650(int *param_1,uint param_2,float param_3,int *param_4)
{
	byte c;
	float fVar1;
	int iVar2;
	uint uVar3;
	int iVar4;
	undefined4 uVar5;
	uint *puVar6;
	uint uVar7;
	uint uVar8;
	int iVar9;
	ulonglong uVar10;
	longlong lVar11;
	uint local_414;
	int *local_410;
	uint *local_40c;
	uint auStack1028 [257];
	
	uVar7 = 0;
	local_414 = 0;
	local_410 = NULL;
	if (param_4 != NULL) {
		*param_4 = 0;
	}
	uVar10 = __ftol((float10)(float)param_1[4]);
	param_1[0x209] = (int)((uVar10 & 0xffffffff) / (ulonglong)*(uint *)(*param_1 + 0xbe4));
	if ((param_1[0x20b] & 2U) != 0) {
		uVar5 = FUN_004859d0(param_1,param_3,param_4);
		return uVar5;
	}
	iVar9 = param_1[0x106];
	if (((param_1[0x20b] & 1U) != 0) && (local_40c = (uint *)param_1[0x208], local_40c != NULL)) {
		puVar6 = (uint *)(param_1 + 0x108);
		do {
			iVar2 = *puVar6 - param_1[0x107];
			if ((0 < iVar2) && (iVar2 < iVar9)) {
				iVar9 = iVar2;
				local_414 = *puVar6;
			}
			puVar6 = puVar6 + 1;
			local_40c = (uint *)((int)local_40c + -1);
		} while (local_40c != NULL);
	}
	param_1[0x208] = 0;
	param_1[0x108] = local_414;
	param_1[0x208] = param_1[0x208] + 1;
	if (local_414 != param_1[0x107]) {
		do {
			c = *(byte *)(local_414 + param_1[5]);
			if (c == 7) break;
			if (c == 10) {
				param_1[param_1[0x208] + 0x108] = local_414 + 1;
				iVar9 = param_1[0x208];
				auStack1028[iVar9] = uVar7;
				param_1[0x208] = iVar9 + 1;
				local_410 = NULL;
				uVar7 = 0;
			}
			else {
				if (std::globals::g_CharWidth_1__004b0f74 < 2) {
					uVar3 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + (uint)c * 2) & 8;
				}
				else {
					uVar3 = std::_unk_FUN_0048f490((uint)c,8);
				}
				if (uVar3 != 0) {
					local_410 = NULL;
					param_1[param_1[0x208] + 0x108] = local_414 + 1;
					auStack1028[param_1[0x208]] = uVar7;
				}
				iVar9 = lego::draw::Font_MeasureCharWidth((ImageFont *)*param_1,c);
				local_410 = (int *)((int)local_410 + iVar9);
				fVar1 = (float)(uVar7 + iVar9);
				uVar7 = uVar7 + iVar9;
				if ((ushort)((ushort)(fVar1 < (float)param_1[3]) << 8 |
										(ushort)(fVar1 == (float)param_1[3]) << 0xe) == 0) {
					param_1[0x208] = param_1[0x208] + 1;
					uVar7 = (uint)local_410;
				}
			}
			local_414 += 1;
			if ((uint)param_1[0x106] <= local_414) {
				local_414 = 0;
			}
		} while (local_414 != param_1[0x107]);
	}
	param_1[param_1[0x208] + 0x108] = local_414;
	uVar3 = param_1[0x208];
	iVar9 = param_1[0x209];
	auStack1028[uVar3] = uVar7;
	uVar7 = (uVar3 - iVar9) + 1;
	uVar8 = 0;
	if (uVar7 == 0) {
		param_2 = 0;
	}
	else {
		param_2 %= uVar7;
	}
	if (uVar3 != 0) {
		local_40c = auStack1028;
		local_410 = param_1 + 0x109;
		do {
			local_40c = local_40c + 1;
			lVar11 = __ftol((float10)(float)param_1[1]);
			local_414 = (uint)lVar11;
			if ((*(byte *)(param_1 + 0x20b) & 4) != 0) {
				auStack1028[0] = 0;
				lVar11 = __ftol(((float10)(float)param_1[3] - (float10)(ulonglong)*local_40c) * (float10)0.5
											 );
				local_414 += (int)lVar11;
			}
			uVar7 = param_1[0x209];
			if (uVar7 < uVar3) {
				if ((uVar8 < (uVar3 - param_2) - uVar7) || (uVar3 - param_2 <= uVar8)) {
					if (uVar3 <= uVar7) goto LAB_004858e9;
					iVar9 = 0;
				}
				else {
					iVar9 = *(int *)(*param_1 + 0xbe4);
					lVar11 = __ftol((float10)(float)param_1[2]);
					iVar9 = ((param_2 + uVar8 + uVar7) - uVar3) * iVar9 + (int)lVar11;
				}
			}
			else {
LAB_004858e9:
				iVar9 = *(int *)(*param_1 + 0xbe4);
				lVar11 = __ftol((float10)(float)param_1[2]);
				iVar9 = iVar9 * uVar8 + (int)lVar11;
			}
			if ((param_4 != NULL) && (*param_4 < iVar9)) {
				*param_4 = iVar9;
			}
			if ((iVar9 != 0) && (iVar2 = local_410[-1], iVar2 != *local_410)) {
				do {
					iVar4 = lego::draw::Font_MeasureCharWidthEx
														((ImageFont *)*param_1,local_414,iVar9,*(char *)(iVar2 + param_1[5]),1);
					local_414 += iVar4;
					iVar2 += 1;
					if (iVar2 == param_1[0x106] + 1) {
						iVar2 = 0;
					}
				} while (iVar2 != *local_410);
			}
			uVar3 = param_1[0x208];
			uVar8 += 1;
			local_410 = local_410 + 1;
		} while (uVar8 < uVar3);
	}
	if (param_4 != NULL) {
		*param_4 = *param_4 + *(int *)(*param_1 + 0xbe4);
	}
	return 0;
}



undefined4 __cdecl FUN_004859d0(int *param_1,float param_2,int *param_3)
{
	float fVar1;
	byte c;
	uint uVar2;
	int iVar3;
	int iVar4;
	int iVar5;
	undefined *puVar6;
	int iVar7;
	longlong lVar8;
	int *local_820;
	uint local_81c;
	int local_818;
	uint local_810;
	int *local_80c;
	undefined4 local_804;
	int local_800 [255];
	int aiStack1028 [2];
	undefined local_3fc [1020];
	
	iVar4 = 0;
	iVar7 = 0;
	iVar5 = 0;
	c = *(byte *)(param_1 + 6);
	local_810 = 0;
	local_804 = 0;
	local_800[0] = 0;
	local_81c = 1;
	if (c != 0) {
		local_80c = local_800 + 1;
		local_820 = (int *)0x1;
		puVar6 = local_3fc;
		do {
			if (c == 10) {
				*(int *)(puVar6 + -4) = iVar7;
				local_81c += 1;
				*local_80c = (int)local_820;
				local_80c = local_80c + 1;
				puVar6 = puVar6 + 4;
				iVar5 = 0;
				iVar7 = 0;
			}
			else {
				if (std::globals::g_CharWidth_1__004b0f74 < 2) {
					uVar2 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + (uint)c * 2) & 8;
				}
				else {
					uVar2 = std::_unk_FUN_0048f490((uint)c,8);
				}
				if (uVar2 != 0) {
					*(int *)(puVar6 + -4) = iVar7;
					iVar5 = 0;
					*local_80c = (int)local_820;
				}
				iVar4 = lego::draw::Font_MeasureCharWidth((ImageFont *)*param_1,c);
				iVar5 += iVar4;
				fVar1 = (float)(iVar7 + iVar4);
				iVar7 = iVar7 + iVar4;
				if ((ushort)((ushort)(fVar1 < (float)param_1[3]) << 8 |
										(ushort)(fVar1 == (float)param_1[3]) << 0xe) == 0) {
					local_81c += 1;
					puVar6 = puVar6 + 4;
					local_80c = local_80c + 1;
					iVar7 = iVar5;
				}
			}
			iVar4 = local_810 + 1;
			local_820 = (int *)((int)local_820 + 1);
			c = *(byte *)(local_810 + 0x19 + (int)param_1);
			local_810 = iVar4;
		} while (c != 0);
	}
	aiStack1028[local_81c] = iVar7;
	local_800[local_81c] = iVar4;
	local_810 = 0;
	if (local_81c != 0) {
		local_820 = local_800;
		do {
			local_820 = local_820 + 1;
			lVar8 = __ftol((float10)(float)param_1[1]);
			local_818 = (int)lVar8;
			if ((*(byte *)(param_1 + 0x20b) & 4) != 0) {
				lVar8 = __ftol(((float10)(float)param_1[3] -
											 (float10)(ulonglong)*(uint *)(local_3fc + local_810 * 4 + -4)) * (float10)0.5
											);
				local_818 += (int)lVar8;
			}
			uVar2 = param_1[0x209];
			if (uVar2 < local_81c) {
				if ((local_810 < local_81c - uVar2) || (local_81c <= local_810)) {
					if (local_81c <= uVar2) goto LAB_00485b9f;
					iVar7 = 0;
				}
				else {
					iVar7 = *(int *)(*param_1 + 0xbe4);
					lVar8 = __ftol((float10)(float)param_1[2]);
					iVar7 = ((local_810 - local_81c) + uVar2) * iVar7 + (int)lVar8;
					local_804 = 1;
				}
			}
			else {
LAB_00485b9f:
				iVar7 = *(int *)(*param_1 + 0xbe4);
				lVar8 = __ftol((float10)(float)param_1[2]);
				iVar7 = iVar7 * local_810 + (int)lVar8;
			}
			if ((param_3 != NULL) && (*param_3 < iVar7)) {
				*param_3 = iVar7;
			}
			if (iVar7 != 0) {
				iVar5 = *local_820;
				for (iVar4 = local_800[local_810]; iVar4 != iVar5; iVar4 += 1) {
					iVar3 = lego::draw::Font_MeasureCharWidthEx
														((ImageFont *)*param_1,local_818,iVar7,
														 *(char *)(iVar4 + 0x18 + (int)param_1),1);
					local_818 += iVar3;
				}
			}
			local_810 += 1;
		} while (local_810 < local_81c);
	}
	fVar1 = (float)param_1[0x20a];
	param_1[0x20a] = (int)(fVar1 - param_2);
	if (fVar1 - param_2 < 0.0) {
		param_1[0x20b] = param_1[0x20b] & 0xfffffffd;
	}
	return local_804;
}



void __cdecl FUN_00485c70(Struct_830 *param_1)
{
	uint uVar1;
	uint uVar2;
	int iVar3;
	undefined4 *puVar4;
	
	uVar2 = param_1->allocSize;
	puVar4 = (undefined4 *)param_1->allocData;
	for (uVar1 = uVar2 >> 2; uVar1 != 0; uVar1 -= 1) {
		*puVar4 = 0;
		puVar4 = puVar4 + 1;
	}
	for (uVar2 &= 3; uVar2 != 0; uVar2 -= 1) {
		*(undefined *)puVar4 = 0;
		puVar4 = (undefined4 *)((int)puVar4 + 1);
	}
	puVar4 = (undefined4 *)&param_1->field_0x18;
	for (iVar3 = 0x100; iVar3 != 0; iVar3 += -1) {
		*puVar4 = 0;
		puVar4 = puVar4 + 1;
	}
	*(undefined4 *)&param_1->field_0x820 = 0;
	*(undefined4 *)&param_1->field_0x41c = 0;
	param_1->flags = param_1->flags & 0xfffffffe;
	return;
}



void __cdecl FUN_00485cc0(int param_1,undefined4 *param_2,undefined4 *param_3)
{
	*param_2 = *(undefined4 *)(param_1 + 0x820);
	*param_3 = *(undefined4 *)(param_1 + 0x824);
	return;
}



void __cdecl lego::input::Input_Init_KeyNames(void)
{
	int iVar1;
	char **ppcVar2;
	
	ppcVar2 = globals::g_KEYS_TABLE;
	for (iVar1 = 0x100; iVar1 != 0; iVar1 += -1) {
		*ppcVar2 = NULL;
		ppcVar2 = ppcVar2 + 1;
	}
	globals::g_KEYS_TABLE[1] = "KEY_ESCAPE";
	globals::g_KEYS_TABLE[2] = "KEY_ONE";
	globals::g_KEYS_TABLE[3] = "KEY_TWO";
	globals::g_KEYS_TABLE[4] = "KEY_THREE";
	globals::g_KEYS_TABLE[5] = "KEY_FOUR";
	globals::g_KEYS_TABLE[6] = "KEY_FIVE";
	globals::g_KEYS_TABLE[7] = "KEY_SIX";
	globals::g_KEYS_TABLE[8] = "KEY_SEVEN";
	globals::g_KEYS_TABLE[9] = "KEY_EIGHT";
	globals::g_KEYS_TABLE[10] = "KEY_NINE";
	globals::g_KEYS_TABLE[11] = "KEY_ZERO";
	globals::g_KEYS_TABLE[12] = "KEY_MINUS";
	globals::g_KEYS_TABLE[13] = "KEY_EQUALS";
	globals::g_KEYS_TABLE[14] = "KEY_BACKSPACE";
	globals::g_KEYS_TABLE[15] = "KEY_TAB";
	globals::g_KEYS_TABLE[16] = "KEY_Q";
	globals::g_KEYS_TABLE[17] = "KEY_W";
	globals::g_KEYS_TABLE[18] = "KEY_E";
	globals::g_KEYS_TABLE[19] = "KEY_R";
	globals::g_KEYS_TABLE[20] = "KEY_T";
	globals::g_KEYS_TABLE[21] = "KEY_Y";
	globals::g_KEYS_TABLE[22] = "KEY_U";
	globals::g_KEYS_TABLE[23] = "KEY_I";
	globals::g_KEYS_TABLE[24] = "KEY_O";
	globals::g_KEYS_TABLE[25] = "KEY_P";
	globals::g_KEYS_TABLE[26] = "KEY_LEFTBRACE";
	globals::g_KEYS_TABLE[27] = "KEY_RIGHTBRACE";
	globals::g_KEYS_TABLE[28] = "KEY_RETURN";
	globals::g_KEYS_TABLE[29] = "KEY_LEFTCTRL";
	globals::g_KEYS_TABLE[30] = "KEY_A";
	globals::g_KEYS_TABLE[31] = "KEY_S";
	globals::g_KEYS_TABLE[32] = "KEY_D";
	globals::g_KEYS_TABLE[33] = "KEY_F";
	globals::g_KEYS_TABLE[34] = "KEY_G";
	globals::g_KEYS_TABLE[35] = "KEY_H";
	globals::g_KEYS_TABLE[36] = "KEY_J";
	globals::g_KEYS_TABLE[37] = "KEY_K";
	globals::g_KEYS_TABLE[38] = "KEY_L";
	globals::g_KEYS_TABLE[39] = "KEY_SEMICOLON";
	globals::g_KEYS_TABLE[40] = "KEY_AT";
	globals::g_KEYS_TABLE[41] = "KEY_RSINGLEQUOTE";
	globals::g_KEYS_TABLE[42] = "KEY_LEFTSHIFT";
	globals::g_KEYS_TABLE[43] = "KEY_HASH";
	globals::g_KEYS_TABLE[44] = "KEY_Z";
	globals::g_KEYS_TABLE[45] = "KEY_X";
	globals::g_KEYS_TABLE[46] = "KEY_C";
	globals::g_KEYS_TABLE[47] = "KEY_V";
	globals::g_KEYS_TABLE[48] = "KEY_B";
	globals::g_KEYS_TABLE[49] = "KEY_N";
	globals::g_KEYS_TABLE[50] = "KEY_M";
	globals::g_KEYS_TABLE[51] = "KEY_LEFTARROW";
	globals::g_KEYS_TABLE[52] = "KEY_RIGHTARROW";
	globals::g_KEYS_TABLE[53] = "KEY_QUESTIONMARK";
	globals::g_KEYS_TABLE[54] = "KEY_RIGHTSHIFT";
	globals::g_KEYS_TABLE[55] = "KEYPAD_ASTERISK";
	globals::g_KEYS_TABLE[56] = "KEY_ALT";
	globals::g_KEYS_TABLE[57] = "KEY_SPACE";
	globals::g_KEYS_TABLE[58] = "KEY_CAPLOCK";
	globals::g_KEYS_TABLE[59] = "KEY_F1";
	globals::g_KEYS_TABLE[60] = "KEY_F2";
	globals::g_KEYS_TABLE[61] = "KEY_F3";
	globals::g_KEYS_TABLE[62] = "KEY_F4";
	globals::g_KEYS_TABLE[63] = "KEY_F5";
	globals::g_KEYS_TABLE[64] = "KEY_F6";
	globals::g_KEYS_TABLE[65] = "KEY_F7";
	globals::g_KEYS_TABLE[66] = "KEY_F8";
	globals::g_KEYS_TABLE[67] = "KEY_F9";
	globals::g_KEYS_TABLE[68] = "KEY_F10";
	globals::g_KEYS_TABLE[69] = "KEYPAD_NUMLOCK";
	globals::g_KEYS_TABLE[70] = "KEY_SCROLLLOCK";
	globals::g_KEYS_TABLE[71] = "KEYPAD_7";
	globals::g_KEYS_TABLE[72] = "KEYPAD_8";
	globals::g_KEYS_TABLE[73] = "KEYPAD_9";
	globals::g_KEYS_TABLE[74] = "KEYPAD_MINUS";
	globals::g_KEYS_TABLE[75] = "KEYPAD_4";
	globals::g_KEYS_TABLE[76] = "KEYPAD_5";
	globals::g_KEYS_TABLE[77] = "KEYPAD_6";
	globals::g_KEYS_TABLE[78] = "KEYPAD_PLUS";
	globals::g_KEYS_TABLE[79] = "KEYPAD_1";
	globals::g_KEYS_TABLE[80] = "KEYPAD_2";
	globals::g_KEYS_TABLE[81] = "KEYPAD_3";
	globals::g_KEYS_TABLE[82] = "KEYPAD_0";
	globals::g_KEYS_TABLE[83] = "KEYPAD_DELETE";
	globals::g_KEYS_TABLE[86] = "KEY_BACKSLASH";
	globals::g_KEYS_TABLE[87] = "KEY_F11";
	globals::g_KEYS_TABLE[88] = "KEY_F12";
	globals::g_KEYS_TABLE[156] = "KEYPAD_ENTER";
	globals::g_KEYS_TABLE[157] = "KEY_RIGHTCTRL";
	globals::g_KEYS_TABLE[181] = "KEYPAD_FORWARDSLASH";
	globals::g_KEYS_TABLE[183] = "KEY_PRINTSCREEN";
	globals::g_KEYS_TABLE[184] = "KEY_ALTGR";
	globals::g_KEYS_TABLE[199] = "KEY_HOME";
	globals::g_KEYS_TABLE[200] = "KEY_CURSORUP";
	globals::g_KEYS_TABLE[201] = "KEY_PGUP";
	globals::g_KEYS_TABLE[203] = "KEY_CURSORLEFT";
	globals::g_KEYS_TABLE[205] = "KEY_CURSORRIGHT";
	globals::g_KEYS_TABLE[207] = "KEY_END";
	globals::g_KEYS_TABLE[208] = "KEY_CURSORDOWN";
	globals::g_KEYS_TABLE[209] = "KEY_PGDN";
	globals::g_KEYS_TABLE[210] = "KEY_INSERT";
	globals::g_KEYS_TABLE[211] = "KEY_DELETE";
	return;
}



BOOL __cdecl lego::input::Input_ParseKey(char *keyName,byte *out_keyCode)
{
	int iVar1;
	byte bVar2;
	char **ppcVar3;
	
	bVar2 = 0;
	ppcVar3 = globals::g_KEYS_TABLE;
	do {
		if (*ppcVar3 != NULL) {
			iVar1 = std::_stricmp(*ppcVar3,keyName);
			if (iVar1 == 0) {
				*out_keyCode = bVar2;
				return 1;
			}
		}
		ppcVar3 = (char **)((char *)ppcVar3 + 4);
		bVar2 += 1;
	} while (ppcVar3 < globals::g_ScanRealFiles_FilePaths_TABLE);
	return 0;
}



void __cdecl lego::main::Main_LockSurfaceRect(Rect2F *surfaceRect)
{
	FLAGS_00541830 |= 1;
	draw::Draw_SurfaceLock_Translate(surfaceRect);
	return;
}



void __cdecl lego::draw::Draw_SurfaceLock_Translate(Rect2F *translation)
{
	float fVar1;
	int iVar2;
	uint *puVar3;
	uint local_7c [31];
	
	globals::g_SurfaceLock_Translation.x = 0.0;
	globals::g_SurfaceLock_Translation.y = 0.0;
	if (translation != NULL) {
		if ((ushort)((ushort)(translation->x < 0.0) << 8 | (ushort)(translation->x == 0.0) << 0xe) == 0)
		{
			globals::g_SurfaceLock_Translation.x = translation->x;
		}
		if ((ushort)((ushort)(translation->y < 0.0) << 8 | (ushort)(translation->y == 0.0) << 0xe) == 0)
		{
			globals::g_SurfaceLock_Translation.y = translation->y;
		}
	}
	puVar3 = local_7c;
	for (iVar2 = 0x1f; iVar2 != 0; iVar2 += -1) {
		*puVar3 = 0;
		puVar3 = puVar3 + 1;
	}
	local_7c[0] = 0x7c;
	iVar2 = (*(code *)lego::globals::g_IDirectDrawSurface4_DrawTarget->lpVtbl->GetSurfaceDesc)
										(lego::globals::g_IDirectDrawSurface4_DrawTarget,local_7c);
	if (iVar2 == 0) {
		globals::g_SurfaceLock_Translation.width = (float)(ulonglong)local_7c[1];
		globals::g_SurfaceLock_Translation.height = (float)(ulonglong)local_7c[0];
		if (translation != NULL) {
			fVar1 = translation->width + translation->x;
			if (fVar1 < globals::g_SurfaceLock_Translation.width) {
				globals::g_SurfaceLock_Translation.width = fVar1;
			}
			fVar1 = translation->height + translation->y;
			if (fVar1 < globals::g_SurfaceLock_Translation.height) {
				globals::g_SurfaceLock_Translation.height = fVar1;
				return;
			}
		}
	}
	return;
}



void __cdecl lego::draw::Draw_SurfaceLock_GetTranslation(Rect2F *translation)
{
	translation->x = globals::g_SurfaceLock_Translation.x;
	translation->y = globals::g_SurfaceLock_Translation.y;
	translation->width =
			 globals::g_SurfaceLock_Translation.width - globals::g_SurfaceLock_Translation.x;
	translation->height =
			 globals::g_SurfaceLock_Translation.height - globals::g_SurfaceLock_Translation.y;
	return;
}



void __cdecl
lego::draw::Draw_SurfaceLock_FUN_004862b0
					(int param_1,float *param_2,int param_3,float param_4,float param_5,float param_6,
					int param_7)
{
	IDirectDrawSurface4 *ddSurface;
	BOOL BVar1;
	uint uVar2;
	int y;
	int x;
	uint uVar3;
	float *pfVar4;
	float *pfVar5;
	longlong lVar6;
	uint nativeColor;
	
	ddSurface = lego::globals::g_IDirectDrawSurface4_DrawTarget;
	BVar1 = Draw_SurfaceLock(lego::globals::g_IDirectDrawSurface4_DrawTarget,param_7);
	if (BVar1 != 0) {
		uVar2 = Draw_SurfaceFloatToRGB(param_4,param_5,param_6);
		if (param_3 != 0) {
			pfVar5 = (float *)(param_1 + 4);
			pfVar4 = (float *)((int)param_2 - param_1);
			do {
				nativeColor = uVar2;
				lVar6 = __ftol((float10)*(float *)((int)pfVar4 + (int)pfVar5));
				y = (int)lVar6;
				lVar6 = __ftol((float10)*param_2);
				x = (int)lVar6;
				lVar6 = __ftol((float10)*pfVar5);
				uVar3 = (uint)lVar6;
				lVar6 = __ftol((float10)pfVar5[-1]);
				Draw_SurfaceLock_FUN_004869e0((uint)lVar6,uVar3,x,y,nativeColor);
				pfVar5 = pfVar5 + 2;
				param_2 = param_2 + 2;
				param_3 += -1;
			} while (param_3 != 0);
		}
		Draw_SurfaceUnlock(ddSurface);
	}
	return;
}



float10 __cdecl
lego::draw::Draw_SurfaceLock_FUN_00486350
					(float *param_1,int param_2,undefined4 param_3,undefined4 param_4,int param_5,
					float *param_6)
{
	int iVar1;
	IDirectDrawSurface4 *ddSurface;
	BOOL BVar2;
	uint uVar3;
	int iVar4;
	float10 extraout_ST0;
	float10 extraout_ST0_00;
	float10 extraout_ST0_01;
	float10 fVar5;
	longlong lVar6;
	longlong lVar7;
	longlong lVar8;
	float local_18;
	float local_10;
	float local_c;
	
	ddSurface = lego::globals::g_IDirectDrawSurface4_DrawTarget;
	BVar2 = Draw_SurfaceLock(lego::globals::g_IDirectDrawSurface4_DrawTarget,(int)param_6);
	fVar5 = extraout_ST0;
	if (BVar2 != 0) {
		uVar3 = Draw_SurfaceFloatToRGB(param_3,param_4,param_5);
		if (param_2 != 0) {
			param_6 = param_1;
			param_5 = param_2;
			do {
				local_10 = *param_6;
				local_c = param_6[1];
				local_18 = local_10 + param_6[2];
				if (local_10 < globals::g_SurfaceLock_Translation.x) {
					local_10 = globals::g_SurfaceLock_Translation.x;
				}
				if (local_c < globals::g_SurfaceLock_Translation.y) {
					local_c = globals::g_SurfaceLock_Translation.y;
				}
				if (globals::g_SurfaceLock_Translation.width <= local_18) {
					local_18 = globals::g_SurfaceLock_Translation.width - 1.0;
				}
				lVar6 = __ftol((float10)local_18);
				lVar7 = __ftol(extraout_ST0_00);
				lVar8 = __ftol((float10)local_c);
				iVar4 = (int)lVar8;
				if (iVar4 < (int)lVar7) {
					lVar8 = __ftol((float10)local_10);
					iVar1 = (int)lVar8;
					do {
						for (; iVar1 < (int)lVar6; iVar1 = iVar1 + 1) {
							(*(code *)globals::g_SurfaceLock_SetPixelFunction)(iVar1,iVar4,uVar3);
						}
						iVar4 += 1;
						iVar1 = (int)lVar8;
					} while (iVar4 < (int)lVar7);
				}
				param_6 = param_6 + 4;
				param_5 += -1;
			} while (param_5 != 0);
		}
		Draw_SurfaceUnlock(ddSurface);
		fVar5 = extraout_ST0_01;
	}
	return fVar5;
}



void __cdecl lego::draw::Draw_SurfaceLock_FUN_004864d0(int param_1,int param_2,int param_3)
{
	int iVar1;
	IDirectDrawSurface4 *ddSurface;
	BOOL BVar2;
	uint uVar3;
	undefined4 *puVar4;
	int iVar5;
	float10 extraout_ST0;
	longlong lVar6;
	longlong lVar7;
	longlong lVar8;
	float local_18;
	float local_10;
	float local_c;
	
	ddSurface = lego::globals::g_IDirectDrawSurface4_DrawTarget;
	BVar2 = Draw_SurfaceLock(lego::globals::g_IDirectDrawSurface4_DrawTarget,param_3);
	if (BVar2 != 0) {
		if (param_2 != 0) {
			puVar4 = (undefined4 *)(param_1 + 0x14);
			param_1 = param_2;
			do {
				local_10 = (float)puVar4[-5];
				local_c = (float)puVar4[-4];
				local_18 = (float)puVar4[-3];
				uVar3 = Draw_SurfaceFloatToRGB(puVar4[-1],*puVar4,puVar4[1]);
				local_18 = local_10 + local_18;
				if (local_10 < globals::g_SurfaceLock_Translation.x) {
					local_10 = globals::g_SurfaceLock_Translation.x;
				}
				if (local_c < globals::g_SurfaceLock_Translation.y) {
					local_c = globals::g_SurfaceLock_Translation.y;
				}
				if (globals::g_SurfaceLock_Translation.width <= local_18) {
					local_18 = globals::g_SurfaceLock_Translation.width - 1.0;
				}
				lVar6 = __ftol((float10)local_18);
				lVar7 = __ftol(extraout_ST0);
				lVar8 = __ftol((float10)local_c);
				iVar5 = (int)lVar8;
				if (iVar5 < (int)lVar7) {
					lVar8 = __ftol((float10)local_10);
					iVar1 = (int)lVar8;
					do {
						for (; iVar1 < (int)lVar6; iVar1 = iVar1 + 1) {
							(*(code *)globals::g_SurfaceLock_SetPixelFunction)(iVar1,iVar5,uVar3);
						}
						iVar5 += 1;
						iVar1 = (int)lVar8;
					} while (iVar5 < (int)lVar7);
				}
				puVar4 = puVar4 + 7;
				param_1 += -1;
			} while (param_1 != 0);
		}
		Draw_SurfaceUnlock(ddSurface);
	}
	return;
}



float10 __cdecl
lego::draw::Draw_SurfaceLock_FUN_00486650
					(float *param_1,uint param_2,uint param_3,undefined4 param_4,undefined4 param_5,
					undefined4 param_6,int param_7)
{
	IDirectDrawSurface4 *ddSurface;
	BOOL BVar1;
	uint uVar2;
	uint uVar3;
	float10 extraout_ST0;
	float10 fVar4;
	unkbyte10 extraout_ST0_00;
	float10 extraout_ST0_01;
	ulonglong uVar5;
	ulonglong uVar6;
	
	ddSurface = lego::globals::g_IDirectDrawSurface4_DrawTarget;
	BVar1 = Draw_SurfaceLock(lego::globals::g_IDirectDrawSurface4_DrawTarget,param_7);
	fVar4 = extraout_ST0;
	if (BVar1 != 0) {
		uVar2 = Draw_SurfaceFloatToRGB(param_4,param_5,param_6);
		uVar3 = 0;
		if (param_3 != 0) {
			do {
				fVar4 = (float10)fsin((float10)(ulonglong)uVar3 *
															(float10)(6.283185 / (float)(ulonglong)param_3));
				uVar5 = __ftol(fVar4 * (float10)(ulonglong)param_2 + (float10)*param_1);
				fVar4 = (float10)fcos(extraout_ST0_00);
				uVar6 = __ftol(fVar4 * (float10)(ulonglong)param_2 + (float10)param_1[1]);
				if ((((globals::g_SurfaceLock_Translation.x <= (float)(uVar5 & 0xffffffff)) &&
						 (globals::g_SurfaceLock_Translation.y <= (float)(uVar6 & 0xffffffff))) &&
						((float)(uVar5 & 0xffffffff) < globals::g_SurfaceLock_Translation.width)) &&
					 ((float)(uVar6 & 0xffffffff) < globals::g_SurfaceLock_Translation.height)) {
					(*(code *)globals::g_SurfaceLock_SetPixelFunction)((int)uVar5,(int)uVar6,uVar2);
				}
				uVar3 += 1;
			} while (uVar3 < param_3);
		}
		Draw_SurfaceUnlock(ddSurface);
		fVar4 = extraout_ST0_01;
	}
	return fVar4;
}



uint __cdecl lego::draw::Draw_SurfaceFloatToRGB(float red,float green,float blue)
{
	char cVar1;
	char cVar2;
	byte bVar3;
	uint uVar4;
	longlong lVar5;
	longlong lVar6;
	longlong lVar7;
	
	uVar4 = 0;
	if (globals::g_SurfaceLock_BPP != 8) {
		lVar5 = __ftol((float10)red * (float10)255.0);
		cVar1 = (char)globals::g_SurfaceLock_RBitCount;
		cVar2 = (char)globals::g_SurfaceLock_GBitCount;
		bVar3 = (byte)globals::g_SurfaceLock_BBitCount;
		lVar6 = __ftol((float10)green * (float10)255.0);
		lVar7 = __ftol((float10)blue * (float10)255.0);
		uVar4 = ((uint)lVar5 >> (8U - cVar1 & 0x1f)) << (cVar2 + bVar3 & 0x1f) |
						((uint)lVar6 >> (8U - cVar2 & 0x1f)) << (bVar3 & 0x1f) |
						(uint)lVar7 >> (8 - bVar3 & 0x1f);
	}
	return uVar4;
}



BOOL __cdecl lego::draw::Draw_SurfaceLock(IDirectDrawSurface4 *ddSurface,int mode)
{
	HRESULT HVar1;
	uint uVar2;
	BOOL BVar3;
	int iVar4;
	uint uVar5;
	uint unaff_EBX;
	DDSURFACEDESC2 *pDVar6;
	DDSURFACEDESC2 s;
	
	pDVar6 = &s;
	for (iVar4 = 0x1f; iVar4 != 0; iVar4 += -1) {
		pDVar6->dwSize = 0;
		pDVar6 = (DDSURFACEDESC2 *)&pDVar6->dwFlags;
	}
	s.dwSize = 0x7c;
	HVar1 = (*ddSurface->lpVtbl->Lock)(ddSurface,NULL,&s,1,NULL);
	if (HVar1 == 0) {
		globals::g_SurfaceLock_Pixels = (byte *)s.lPitch_dwLinearSize;
		uVar5 = 0;
		globals::g_SurfaceLock_RBitMask = s.ddckCKSrcBlt.dwColorSpaceHighValue;
		globals::g_SurfaceLock_GBitMask = s.ddpfPixelFormat.dwSize;
		globals::g_SurfaceLock_BBitMask = s.ddpfPixelFormat.dwFlags;
		globals::g_SurfaceLock_BPP = s.ddckCKSrcBlt.dwColorSpaceLowValue;
		globals::g_SurfaceLock_BBitCount = 0;
		globals::g_SurfaceLock_GBitCount = 0;
		globals::g_SurfaceLock_RBitCount = 0;
		if (s.ddckCKSrcBlt.dwColorSpaceLowValue != 0) {
			do {
				uVar2 = 1 << ((byte)uVar5 & 0x1f);
				if ((uVar2 & s.ddckCKSrcBlt.dwColorSpaceHighValue) != 0) {
					globals::g_SurfaceLock_RBitCount += 1;
				}
				if ((uVar2 & s.ddpfPixelFormat.dwSize) != 0) {
					globals::g_SurfaceLock_GBitCount += 1;
				}
				if ((uVar2 & s.ddpfPixelFormat.dwFlags) != 0) {
					globals::g_SurfaceLock_BBitCount += 1;
				}
				uVar5 += 1;
				ddSurface = (IDirectDrawSurface4 *)s.ddsCaps.dwCaps2;
			} while (uVar5 < s.ddckCKSrcBlt.dwColorSpaceLowValue);
		}
		globals::g_SurfaceLock_Stride = unaff_EBX;
		BVar3 = Draw_SurfaceSetPixelFunction(s.ddsCaps.dwCaps3);
		if (BVar3 != 0) {
			return 1;
		}
		Draw_SurfaceUnlock(ddSurface);
	}
	return 0;
}



void __cdecl lego::draw::Draw_SurfaceUnlock(IDirectDrawSurface4 *ddSurface)
{
	(*ddSurface->lpVtbl->Unlock)(ddSurface,NULL);
	globals::g_SurfaceLock_SetPixelFunction = 0;
	globals::g_SurfaceLock_Pixels = NULL;
	globals::g_SurfaceLock_Stride = 0;
	globals::g_SurfaceLock_BPP = 0;
	globals::g_SurfaceLock_RBitMask = 0;
	globals::g_SurfaceLock_GBitMask = 0;
	globals::g_SurfaceLock_BBitMask = 0;
	return;
}



BOOL __cdecl lego::draw::Draw_SurfaceSetPixelFunction(int mode)
{
	if (globals::g_SurfaceLock_BPP == 8) {
		globals::g_SurfaceLock_SetPixelFunction = Draw_SetPixel8;
		return 1;
	}
	if (globals::g_SurfaceLock_BPP != 0x10) {
		if (globals::g_SurfaceLock_BPP == 0x18) {
			globals::g_SurfaceLock_SetPixelFunction = Draw_SetPixel24;
			return 1;
		}
		if (globals::g_SurfaceLock_BPP == 0x20) {
			globals::g_SurfaceLock_SetPixelFunction = Draw_SetPixel32;
			return 1;
		}
		globals::g_SurfaceLock_SetPixelFunction = NULL;
		return 0;
	}
	if (mode == 1) {
		globals::g_SurfaceLock_SetPixelFunction = Draw_SetPixel16_Mode1;
		return mode;
	}
	if (mode == 2) {
		globals::g_SurfaceLock_SetPixelFunction = Draw_SetPixel16_Mode2;
		return 1;
	}
	globals::g_SurfaceLock_SetPixelFunction = Draw_SetPixel16_Mode0;
	return 1;
}



void __cdecl
lego::draw::Draw_SurfaceLock_FUN_004869e0
					(uint param_1,uint param_2,int x,int y,undefined4 nativeColor)
{
	bool bVar1;
	uint uVar2;
	uint uVar3;
	int iVar4;
	int iVar5;
	int iVar6;
	uint uVar7;
	int iVar8;
	uint local_10;
	int local_4;
	
	uVar3 = param_2;
	uVar2 = param_1;
	uVar7 = (int)(x - param_1) >> 0x1f;
	iVar6 = (x - param_1 ^ uVar7) - uVar7;
	uVar7 = (int)(y - param_2) >> 0x1f;
	iVar4 = (y - param_2 ^ uVar7) - uVar7;
	bVar1 = iVar6 < iVar4;
	if (bVar1) {
		iVar5 = iVar6 - iVar4;
		iVar8 = iVar6 * 2 - iVar4;
		local_4 = iVar4;
	}
	else {
		iVar5 = iVar4 - iVar6;
		iVar8 = iVar4 * 2 - iVar6;
		local_4 = iVar6;
		iVar6 = iVar4;
	}
	local_10 = 1;
	param_2 = 1;
	param_1 = (uint)!bVar1;
	local_4 += 1;
	uVar7 = (uint)bVar1;
	if (x < (int)uVar2) {
		param_2 = 0xffffffff;
		param_1 = -param_1;
	}
	if (y < (int)uVar3) {
		uVar7 = -uVar7;
		local_10 = 0xffffffff;
	}
	x = uVar2;
	y = uVar3;
	if (0 < local_4) {
		do {
			if ((((globals::g_SurfaceLock_Translation.x <= (float)x) &&
					 (globals::g_SurfaceLock_Translation.y <= (float)y)) &&
					((float)x < globals::g_SurfaceLock_Translation.width)) &&
				 ((float)y < globals::g_SurfaceLock_Translation.height)) {
				(*(code *)globals::g_SurfaceLock_SetPixelFunction)(x,y,nativeColor);
			}
			uVar2 = local_10;
			uVar3 = param_2;
			iVar4 = iVar5;
			if (iVar8 < 0) {
				uVar2 = uVar7;
				uVar3 = param_1;
				iVar4 = iVar6;
			}
			x += uVar3;
			iVar8 += iVar4 * 2;
			y += uVar2;
			local_4 += -1;
		} while (local_4 != 0);
	}
	return;
}



void __cdecl lego::draw::Draw_SetPixel8(int x,int y,uint color)
{
	globals::g_SurfaceLock_Pixels[y * globals::g_SurfaceLock_Stride + x] = (byte)color;
	return;
}



void __cdecl lego::draw::Draw_SetPixel16_Mode0(int x,int y,uint color)
{
	*(undefined2 *)(globals::g_SurfaceLock_Pixels + x * 2 + y * globals::g_SurfaceLock_Stride) =
			 (undefined2)color;
	return;
}



void __cdecl lego::draw::Draw_SetPixel16_Mode1(int x,int y,uint color)
{
	*(ushort *)(globals::g_SurfaceLock_Pixels + x * 2 + y * globals::g_SurfaceLock_Stride) =
			 *(ushort *)(globals::g_SurfaceLock_Pixels + x * 2 + y * globals::g_SurfaceLock_Stride) ^
			 (ushort)color;
	return;
}



void __cdecl lego::draw::Draw_SetPixel16_Mode2(int x,int y,uint color)
{
	ushort uVar1;
	ushort uVar2;
	
	uVar1 = *(ushort *)(globals::g_SurfaceLock_Pixels + x * 2 + y * globals::g_SurfaceLock_Stride);
	uVar2 = (ushort)color;
	*(ushort *)(globals::g_SurfaceLock_Pixels + x * 2 + y * globals::g_SurfaceLock_Stride) =
			 (((ushort)globals::g_SurfaceLock_GBitMask & uVar1) >> 1 & 0x7fe0) +
			 (((ushort)globals::g_SurfaceLock_GBitMask & uVar2) >> 1 & 0x7fe0) &
			 (ushort)globals::g_SurfaceLock_GBitMask |
			 ((uVar2 & (ushort)globals::g_SurfaceLock_BBitMask) >> 1) +
			 ((uVar1 & (ushort)globals::g_SurfaceLock_BBitMask) >> 1) &
			 (ushort)globals::g_SurfaceLock_BBitMask |
			 (uVar2 >> 1 & 0x7800) + (uVar1 >> 1 & 0x7800) & (ushort)globals::g_SurfaceLock_RBitMask;
	return;
}



void __cdecl lego::draw::Draw_SetPixel24(int x,int y,uint color)
{
	*(uint *)(globals::g_SurfaceLock_Pixels + x * 3 + y * globals::g_SurfaceLock_Stride) =
			 color << 8 |
			 *(uint *)(globals::g_SurfaceLock_Pixels + x * 3 + y * globals::g_SurfaceLock_Stride) & 0xff;
	return;
}



void __cdecl lego::draw::Draw_SetPixel32(int x,int y,uint color)
{
	*(uint *)(globals::g_SurfaceLock_Pixels + x * 4 + y * globals::g_SurfaceLock_Stride) = color;
	return;
}



undefined4 * __cdecl lego::res::Res_OpenLWS(char *filename,BOOL isLooping)
{
	char *pcVar1;
	int iVar2;
	ushort *puVar3;
	float fVar4;
	char cVar5;
	byte bVar6;
	ushort uVar7;
	FileStream *file;
	byte *pbVar8;
	int iVar9;
	byte *pbVar10;
	char *pcVar11;
	void *pvVar12;
	int *piVar13;
	int iVar14;
	int iVar15;
	uint uVar16;
	uint uVar17;
	byte **ppbVar18;
	undefined4 *puVar19;
	byte **ppbVar20;
	char *pcVar21;
	undefined4 *puVar22;
	undefined4 *puVar23;
	LwoFrame *pLVar24;
	bool bVar25;
	float10 fVar26;
	LwoFrame *local_968;
	uint local_964;
	uint local_960;
	byte **local_958;
	byte *local_954;
	byte *local_950;
	char *local_94c;
	char *local_948;
	char *local_944;
	char *local_940;
	char *local_93c;
	char *local_938;
	char *local_934;
	char *local_930;
	char local_904 [260];
	char local_800 [1024];
	char local_400 [1024];
	
	puVar19 = NULL;
	std::sprintf(local_904,"%s.%s",filename,"lws");
	file = lego::file::File_Open(local_904,"r");
	if (file != NULL) {
		lego::file::File_GetS_StripLineEnd(local_800,0x400,file);
		uVar16 = 0xffffffff;
		pcVar21 = local_800;
		do {
			if (uVar16 == 0) break;
			uVar16 -= 1;
			cVar5 = *pcVar21;
			pcVar21 = pcVar21 + 1;
		} while (cVar5 != '\0');
		pbVar10 = (byte *)(local_800 + (~uVar16 & 0xffff));
		lego::file::File_GetS_StripLineEnd((char *)pbVar10,0x400 - (~uVar16 & 0xffff),file);
		pcVar21 = "LWSC";
		pbVar8 = (byte *)local_800;
		do {
			bVar6 = *pbVar8;
			bVar25 = bVar6 < (byte)*pcVar21;
			if (bVar6 != *pcVar21) {
LAB_00486d70:
				iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
				goto LAB_00486d75;
			}
			if (bVar6 == 0) break;
			bVar6 = pbVar8[1];
			bVar25 = bVar6 < ((byte *)pcVar21)[1];
			if (bVar6 != ((byte *)pcVar21)[1]) goto LAB_00486d70;
			pbVar8 = pbVar8 + 2;
			pcVar21 = (char *)((byte *)pcVar21 + 2);
		} while (bVar6 != 0);
		iVar9 = 0;
LAB_00486d75:
		if (iVar9 == 0) {
			pcVar21 = "1";
			do {
				bVar6 = *pbVar10;
				bVar25 = bVar6 < (byte)*pcVar21;
				if (bVar6 != *pcVar21) {
LAB_00486da8:
					iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
					goto LAB_00486dad;
				}
				if (bVar6 == 0) break;
				bVar6 = pbVar10[1];
				bVar25 = bVar6 < ((byte *)pcVar21)[1];
				if (bVar6 != ((byte *)pcVar21)[1]) goto LAB_00486da8;
				pbVar10 = pbVar10 + 2;
				pcVar21 = (char *)((byte *)pcVar21 + 2);
			} while (bVar6 != 0);
			iVar9 = 0;
LAB_00486dad:
			if (iVar9 == 0) {
				local_964 = 0;
				local_960 = 0;
				ppbVar18 = NULL;
				pcVar21 = local_904;
				pcVar11 = local_904;
				cVar5 = local_904[0];
				while (cVar5 != '\0') {
					if (cVar5 == '\\') {
						pcVar21 = pcVar11;
					}
					pcVar1 = pcVar11 + 1;
					pcVar11 = pcVar11 + 1;
					cVar5 = *pcVar1;
				}
				pcVar21[pcVar21 != local_904] = '\0';
				puVar19 = (undefined4 *)std::malloc(0x38);
				puVar22 = puVar19;
				for (iVar9 = 0xe; iVar9 != 0; iVar9 += -1) {
					*puVar22 = 0;
					puVar22 = puVar22 + 1;
				}
				if (local_904[0] == '\0') {
					puVar19[2] = 0;
				}
				else {
					pcVar21 = std::_strdup(local_904);
					puVar19[2] = pcVar21;
				}
				*(undefined2 *)((int)puVar19 + 0x26) = 10;
				puVar19[0xc] = 1;
				if (isLooping != 0) {
					*(byte *)(puVar19 + 0xd) = *(byte *)(puVar19 + 0xd) | 1;
				}
				pvVar12 = std::malloc(0x208);
				puVar19[8] = pvVar12;
				local_968 = (LwoFrame *)std::malloc((uint)*(ushort *)((int)puVar19 + 0x26) << 1);
				pcVar21 = lego::file::File_GetS_StripLineEnd(local_800,0x400,file);
				while (pcVar21 != NULL) {
					uVar16 = 0xffffffff;
					pcVar21 = local_800;
					do {
						pcVar11 = pcVar21;
						if (uVar16 == 0) break;
						uVar16 -= 1;
						pcVar11 = pcVar21 + 1;
						cVar5 = *pcVar21;
						pcVar21 = pcVar11;
					} while (cVar5 != '\0');
					uVar16 = ~uVar16;
					puVar22 = (undefined4 *)(pcVar11 + -uVar16);
					puVar23 = (undefined4 *)local_400;
					for (uVar17 = uVar16 >> 2; uVar17 != 0; uVar17 -= 1) {
						*puVar23 = *puVar22;
						puVar22 = puVar22 + 1;
						puVar23 = puVar23 + 1;
					}
					for (uVar16 &= 3; uVar16 != 0; uVar16 -= 1) {
						*(undefined *)puVar23 = *(undefined *)puVar22;
						puVar22 = (undefined4 *)((int)puVar22 + 1);
						puVar23 = (undefined4 *)((int)puVar23 + 1);
					}
					iVar9 = FUN_00477770(local_400,&local_954);
					if (iVar9 != 0) {
						if (ppbVar18 == NULL) {
							pcVar21 = "FirstFrame";
							pbVar10 = local_954;
							do {
								bVar6 = *pcVar21;
								bVar25 = bVar6 < *pbVar10;
								if (bVar6 != *pbVar10) {
LAB_00486f0b:
									iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
									goto LAB_00486f10;
								}
								if (bVar6 == 0) break;
								bVar6 = ((byte *)pcVar21)[1];
								bVar25 = bVar6 < pbVar10[1];
								if (bVar6 != pbVar10[1]) goto LAB_00486f0b;
								pcVar21 = (char *)((byte *)pcVar21 + 2);
								pbVar10 = pbVar10 + 2;
							} while (bVar6 != 0);
							iVar9 = 0;
LAB_00486f10:
							if (iVar9 == 0) {
								iVar9 = std::atoi((char *)local_950);
								*(short *)puVar19 = (short)iVar9;
							}
							pcVar21 = "LastFrame";
							pbVar10 = local_954;
							do {
								bVar6 = *pcVar21;
								bVar25 = bVar6 < *pbVar10;
								if (bVar6 != *pbVar10) {
LAB_00486f55:
									iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
									goto LAB_00486f5a;
								}
								if (bVar6 == 0) break;
								bVar6 = ((byte *)pcVar21)[1];
								bVar25 = bVar6 < pbVar10[1];
								if (bVar6 != pbVar10[1]) goto LAB_00486f55;
								pcVar21 = (char *)((byte *)pcVar21 + 2);
								pbVar10 = pbVar10 + 2;
							} while (bVar6 != 0);
							iVar9 = 0;
LAB_00486f5a:
							if (iVar9 == 0) {
								iVar9 = std::atoi((char *)local_950);
								*(short *)((int)puVar19 + 2) = (short)iVar9;
							}
							if (*(short *)((int)puVar19 + 2) == 0) {
								*(undefined2 *)((int)puVar19 + 2) = 1;
							}
							pcVar21 = "FramesPerSecond";
							pbVar10 = local_954;
							do {
								bVar6 = *pcVar21;
								bVar25 = bVar6 < *pbVar10;
								if (bVar6 != *pbVar10) {
LAB_00486fb3:
									iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
									goto LAB_00486fb8;
								}
								if (bVar6 == 0) break;
								bVar6 = ((byte *)pcVar21)[1];
								bVar25 = bVar6 < pbVar10[1];
								if (bVar6 != pbVar10[1]) goto LAB_00486fb3;
								pcVar21 = (char *)((byte *)pcVar21 + 2);
								pbVar10 = pbVar10 + 2;
							} while (bVar6 != 0);
							iVar9 = 0;
LAB_00486fb8:
							if (iVar9 == 0) {
								fVar26 = std::atof((char *)local_950);
								puVar19[1] = (float)fVar26;
							}
							pcVar21 = "AddNullObject";
							pbVar10 = local_954;
							do {
								bVar6 = *pcVar21;
								bVar25 = bVar6 < *pbVar10;
								if (bVar6 != *pbVar10) {
LAB_00486fff:
									iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
									goto LAB_00487004;
								}
								if (bVar6 == 0) break;
								bVar6 = ((byte *)pcVar21)[1];
								bVar25 = bVar6 < pbVar10[1];
								if (bVar6 != pbVar10[1]) goto LAB_00486fff;
								pcVar21 = (char *)((byte *)pcVar21 + 2);
								pbVar10 = pbVar10 + 2;
							} while (bVar6 != 0);
							iVar9 = 0;
LAB_00487004:
							if (iVar9 != 0) {
								pcVar21 = "LoadObject";
								pbVar10 = local_954;
								do {
									bVar6 = *pcVar21;
									bVar25 = bVar6 < *pbVar10;
									if (bVar6 != *pbVar10) {
LAB_00487033:
										iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
										goto LAB_00487038;
									}
									if (bVar6 == 0) break;
									bVar6 = ((byte *)pcVar21)[1];
									bVar25 = bVar6 < pbVar10[1];
									if (bVar6 != pbVar10[1]) goto LAB_00487033;
									pcVar21 = (char *)((byte *)pcVar21 + 2);
									pbVar10 = pbVar10 + 2;
								} while (bVar6 != 0);
								iVar9 = 0;
LAB_00487038:
								if (iVar9 != 0) goto LAB_004877aa;
							}
							if (*(short *)(puVar19 + 9) == *(short *)((int)puVar19 + 0x26)) {
								uVar7 = *(short *)((int)puVar19 + 0x26) + 10;
								*(ushort *)((int)puVar19 + 0x26) = uVar7;
								piVar13 = FUN_0048df40((LwoFrame *)puVar19[8],(uint)uVar7 * 0x34);
								puVar19[8] = piVar13;
								local_968 = (LwoFrame *)
														FUN_0048df40(local_968,(uint)*(ushort *)((int)puVar19 + 0x26) << 1);
							}
							*(undefined2 *)((int)&local_968->dwSize + (uint)*(ushort *)(puVar19 + 9) * 2) = 0;
							ppbVar18 = (byte **)(puVar19[8] + (uint)*(ushort *)(puVar19 + 9) * 0x34);
							local_958 = ppbVar18;
							ppbVar20 = ppbVar18;
							for (iVar9 = 0xd; iVar9 != 0; iVar9 += -1) {
								*ppbVar20 = NULL;
								ppbVar20 = ppbVar20 + 1;
							}
							pcVar21 = "AddNullObject";
							pbVar10 = local_954;
							do {
								bVar6 = *pcVar21;
								bVar25 = bVar6 < *pbVar10;
								if (bVar6 != *pbVar10) {
LAB_004870eb:
									iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
									goto LAB_004870f0;
								}
								if (bVar6 == 0) break;
								bVar6 = ((byte *)pcVar21)[1];
								bVar25 = bVar6 < pbVar10[1];
								if (bVar6 != pbVar10[1]) goto LAB_004870eb;
								pcVar21 = (char *)((byte *)pcVar21 + 2);
								pbVar10 = pbVar10 + 2;
							} while (bVar6 != 0);
							iVar9 = 0;
LAB_004870f0:
							if (iVar9 == 0) {
								*(byte *)(ppbVar18 + 10) = *(byte *)(ppbVar18 + 10) | 1;
								pbVar10 = (byte *)std::_strdup(local_800 + 0xe);
								*ppbVar18 = pbVar10;
								iVar9 = std::_strnicmp((char *)pbVar10,"SFX",3);
								if ((iVar9 == 0) &&
									 (iVar9 = std::_strnicmp((char *)(*ppbVar18 + 3),",",1), iVar9 == 0)) {
									*(byte *)(ppbVar18 + 10) = *(byte *)(ppbVar18 + 10) | 2;
									*(short *)(puVar19 + 10) = *(short *)(puVar19 + 10) + 1;
								}
							}
							else {
								uVar16 = 0xffffffff;
								pcVar21 = local_800;
								do {
									pcVar11 = pcVar21;
									if (uVar16 == 0) break;
									uVar16 -= 1;
									pcVar11 = pcVar21 + 1;
									cVar5 = *pcVar21;
									pcVar21 = pcVar11;
								} while (cVar5 != '\0');
								uVar16 = ~uVar16;
								puVar22 = (undefined4 *)(pcVar11 + -uVar16);
								puVar23 = (undefined4 *)local_400;
								for (uVar17 = uVar16 >> 2; uVar17 != 0; uVar17 -= 1) {
									*puVar23 = *puVar22;
									puVar22 = puVar22 + 1;
									puVar23 = puVar23 + 1;
								}
								for (uVar16 &= 3; uVar16 != 0; uVar16 -= 1) {
									*(undefined *)puVar23 = *(undefined *)puVar22;
									puVar22 = (undefined4 *)((int)puVar22 + 1);
									puVar23 = (undefined4 *)((int)puVar23 + 1);
								}
								iVar9 = util::stringSplit(local_800,(char **)&local_954,"\\");
								pcVar21 = util::strstri((char *)(&local_958)[iVar9],".lwo");
								if (pcVar21 != NULL) {
									*pcVar21 = '\0';
								}
								pbVar10 = (byte *)std::_strdup((char *)(&local_958)[iVar9]);
								*ppbVar18 = pbVar10;
							}
							iVar9 = *(ushort *)(puVar19 + 9) - 1;
							if (-1 < iVar9) {
								ppbVar20 = (byte **)(puVar19[8] + iVar9 * 0x34);
								do {
									if ((((*(byte *)(ppbVar20 + 10) & 1) != 0) &&
											((*(byte *)(ppbVar18 + 10) & 1) != 0)) ||
										 (((*(byte *)(ppbVar20 + 10) & 1) == 0 && ((*(byte *)(ppbVar18 + 10) & 1) == 0))
										 )) {
										pbVar10 = *ppbVar20;
										pbVar8 = *ppbVar18;
										do {
											bVar6 = *pbVar8;
											bVar25 = bVar6 < *pbVar10;
											if (bVar6 != *pbVar10) {
LAB_00487222:
												iVar14 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
												goto LAB_00487227;
											}
											if (bVar6 == 0) break;
											bVar6 = pbVar8[1];
											bVar25 = bVar6 < pbVar10[1];
											if (bVar6 != pbVar10[1]) goto LAB_00487222;
											pbVar8 = pbVar8 + 2;
											pbVar10 = pbVar10 + 2;
										} while (bVar6 != 0);
										iVar14 = 0;
LAB_00487227:
										ppbVar18 = local_958;
										if (iVar14 == 0) {
											*(short *)(local_958 + 1) = *(short *)(puVar19[8] + 4 + iVar9 * 0x34) + 1;
											break;
										}
									}
									iVar9 += -1;
									ppbVar20 = ppbVar20 + -0xd;
								} while (-1 < iVar9);
							}
						}
						else {
							if (local_964 == 0) {
								if (local_960 == 0) {
									pcVar21 = "ObjectMotion";
									pbVar10 = local_954;
									do {
										bVar6 = *pbVar10;
										bVar25 = bVar6 < (byte)*pcVar21;
										if (bVar6 != *pcVar21) {
LAB_00487586:
											iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
											goto LAB_0048758b;
										}
										if (bVar6 == 0) break;
										bVar6 = pbVar10[1];
										bVar25 = bVar6 < ((byte *)pcVar21)[1];
										if (bVar6 != ((byte *)pcVar21)[1]) goto LAB_00487586;
										pbVar10 = pbVar10 + 2;
										pcVar21 = (char *)((byte *)pcVar21 + 2);
									} while (bVar6 != 0);
									iVar9 = 0;
LAB_0048758b:
									if (iVar9 == 0) {
										local_964 = 1;
									}
									else {
										pcVar21 = "ObjDissolve";
										pbVar10 = local_954;
										do {
											bVar6 = *pbVar10;
											bVar25 = bVar6 < (byte)*pcVar21;
											if (bVar6 != *pcVar21) {
LAB_004875c7:
												iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
												goto LAB_004875cc;
											}
											if (bVar6 == 0) break;
											bVar6 = pbVar10[1];
											bVar25 = bVar6 < ((byte *)pcVar21)[1];
											if (bVar6 != ((byte *)pcVar21)[1]) goto LAB_004875c7;
											pbVar10 = pbVar10 + 2;
											pcVar21 = (char *)((byte *)pcVar21 + 2);
										} while (bVar6 != 0);
										iVar9 = 0;
LAB_004875cc:
										if (iVar9 == 0) {
											pcVar21 = "(envelope)";
											pbVar10 = local_950;
											do {
												bVar6 = *pbVar10;
												bVar25 = bVar6 < (byte)*pcVar21;
												if (bVar6 != *pcVar21) {
LAB_00487603:
													iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
													goto LAB_00487608;
												}
												if (bVar6 == 0) break;
												bVar6 = pbVar10[1];
												bVar25 = bVar6 < ((byte *)pcVar21)[1];
												if (bVar6 != ((byte *)pcVar21)[1]) goto LAB_00487603;
												pbVar10 = pbVar10 + 2;
												pcVar21 = (char *)((byte *)pcVar21 + 2);
											} while (bVar6 != 0);
											iVar9 = 0;
LAB_00487608:
											if (iVar9 == 0) {
												local_960 = 1;
											}
											else {
												fVar26 = std::atof((char *)local_950);
												*(float *)(&DAT_005456c4 + UINT_00545854 * 4) = (float)fVar26;
												ppbVar18[7] = &DAT_005456c4 + UINT_00545854 * 4;
												UINT_00545854 += 1;
												ppbVar18[7] = NULL;
											}
										}
										else {
											pcVar21 = "ParentObject";
											pbVar10 = local_954;
											do {
												bVar6 = *pbVar10;
												bVar25 = bVar6 < (byte)*pcVar21;
												if (bVar6 != *pcVar21) {
LAB_00487680:
													iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
													goto LAB_00487685;
												}
												if (bVar6 == 0) break;
												bVar6 = pbVar10[1];
												bVar25 = bVar6 < ((byte *)pcVar21)[1];
												if (bVar6 != ((byte *)pcVar21)[1]) goto LAB_00487680;
												pbVar10 = pbVar10 + 2;
												pcVar21 = (char *)((byte *)pcVar21 + 2);
											} while (bVar6 != 0);
											iVar9 = 0;
LAB_00487685:
											if (iVar9 == 0) {
												iVar9 = std::atoi((char *)local_950);
												*(short *)((int)&local_968->dwSize + (uint)*(ushort *)(puVar19 + 9) * 2) =
														 (short)iVar9;
											}
											else {
												pcVar21 = "PivotPoint";
												pbVar10 = local_954;
												do {
													bVar6 = *pbVar10;
													bVar25 = bVar6 < (byte)*pcVar21;
													if (bVar6 != *pcVar21) {
LAB_004876d8:
														iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
														goto LAB_004876dd;
													}
													if (bVar6 == 0) break;
													bVar6 = pbVar10[1];
													bVar25 = bVar6 < ((byte *)pcVar21)[1];
													if (bVar6 != ((byte *)pcVar21)[1]) goto LAB_004876d8;
													pbVar10 = pbVar10 + 2;
													pcVar21 = (char *)((byte *)pcVar21 + 2);
												} while (bVar6 != 0);
												iVar9 = 0;
LAB_004876dd:
												if (iVar9 == 0) {
													fVar26 = std::atof((char *)local_950);
													ppbVar18[3] = (byte *)(float)-fVar26;
													fVar26 = std::atof(local_94c);
													ppbVar18[4] = (byte *)(float)-fVar26;
													fVar26 = std::atof(local_948);
													ppbVar18[5] = (byte *)(float)-fVar26;
												}
												else {
													pcVar21 = "UnseenByCamera";
													pbVar10 = local_954;
													do {
														bVar6 = *pbVar10;
														bVar25 = bVar6 < (byte)*pcVar21;
														if (bVar6 != *pcVar21) {
LAB_00487747:
															iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
															goto LAB_0048774c;
														}
														if (bVar6 == 0) break;
														bVar6 = pbVar10[1];
														bVar25 = bVar6 < ((byte *)pcVar21)[1];
														if (bVar6 != ((byte *)pcVar21)[1]) goto LAB_00487747;
														pbVar10 = pbVar10 + 2;
														pcVar21 = (char *)((byte *)pcVar21 + 2);
													} while (bVar6 != 0);
													iVar9 = 0;
LAB_0048774c:
													if ((iVar9 == 0) && (iVar9 = std::atoi((char *)local_950), iVar9 == 1)) {
														*(byte *)(ppbVar18 + 10) = *(byte *)(ppbVar18 + 10) | 4;
													}
													else {
														pcVar21 = "ShadowOptions";
														pbVar10 = local_954;
														do {
															bVar6 = *pbVar10;
															bVar25 = bVar6 < (byte)*pcVar21;
															if (bVar6 != *pcVar21) {
LAB_00487797:
																iVar9 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
																goto LAB_0048779c;
															}
															if (bVar6 == 0) break;
															bVar6 = pbVar10[1];
															bVar25 = bVar6 < ((byte *)pcVar21)[1];
															if (bVar6 != ((byte *)pcVar21)[1]) goto LAB_00487797;
															pbVar10 = pbVar10 + 2;
															pcVar21 = (char *)((byte *)pcVar21 + 2);
														} while (bVar6 != 0);
														iVar9 = 0;
LAB_0048779c:
														if (iVar9 == 0) {
															ppbVar18 = NULL;
															*(short *)(puVar19 + 9) = *(short *)(puVar19 + 9) + 1;
														}
													}
												}
											}
										}
									}
								}
								else {
									if (local_960 != 1) {
										if (local_960 == 2) {
											uVar16 = std::atoi((char *)local_950);
											*(short *)((int)ppbVar18 + 0x26) = (short)uVar16;
											pbVar10 = (byte *)std::malloc((uVar16 & 0xffff) * 4 + 4);
											ppbVar18[7] = pbVar10;
											pbVar10 = (byte *)std::malloc((uint)*(ushort *)((int)ppbVar18 + 0x26) * 2 + 2)
											;
											ppbVar18[8] = pbVar10;
										}
										else {
											uVar16 = (int)(local_960 - 3) / 2;
											if ((ushort)uVar16 < *(ushort *)((int)ppbVar18 + 0x26)) {
												uVar17 = (int)local_960 >> 0x1f;
												if (((local_960 ^ uVar17) - uVar17 & 1 ^ uVar17) == uVar17) {
													iVar9 = std::atoi((char *)local_950);
													*(short *)(ppbVar18[8] + (uVar16 & 0xffff) * 2) = (short)iVar9;
												}
												else {
													iVar9 = (uVar16 & 0xffff) * 4;
													fVar26 = std::atof((char *)local_950);
													*(float *)(ppbVar18[7] + iVar9) = (float)fVar26;
													if (*(float *)(ppbVar18[7] + iVar9) < 0.0) {
														*(undefined4 *)(ppbVar18[7] + iVar9) = 0;
													}
													fVar4 = *(float *)(ppbVar18[7] + iVar9);
													if ((ushort)((ushort)(fVar4 < 1.0) << 8 | (ushort)(fVar4 == 1.0) << 0xe)
															== 0) {
														*(undefined4 *)(ppbVar18[7] + iVar9) = 0x3f800000;
													}
													*(float *)(ppbVar18[7] + iVar9) = 1.0 - *(float *)(ppbVar18[7] + iVar9);
												}
											}
										}
									}
									pcVar21 = "EndBehavior";
									pbVar10 = local_954;
									do {
										bVar6 = *pbVar10;
										bVar25 = bVar6 < (byte)*pcVar21;
										if (bVar6 != *pcVar21) {
LAB_00487541:
											uVar16 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
											goto LAB_00487546;
										}
										if (bVar6 == 0) break;
										bVar6 = pbVar10[1];
										bVar25 = bVar6 < ((byte *)pcVar21)[1];
										if (bVar6 != ((byte *)pcVar21)[1]) goto LAB_00487541;
										pbVar10 = pbVar10 + 2;
										pcVar21 = (char *)((byte *)pcVar21 + 2);
									} while (bVar6 != 0);
									uVar16 = 0;
LAB_00487546:
									local_960 = local_960 + 1;
									if (uVar16 == 0) {
										local_960 = uVar16;
									}
								}
							}
							else {
								if (local_964 != 1) {
									if (local_964 == 2) {
										uVar16 = std::atoi((char *)local_950);
										*(short *)(ppbVar18 + 9) = (short)uVar16;
										pbVar10 = (byte *)std::malloc(((uVar16 & 0xffff) + 1) * 0x28);
										ppbVar18[6] = pbVar10;
									}
									else {
										uVar16 = (int)(local_964 - 3) / 2;
										if ((ushort)uVar16 < *(ushort *)(ppbVar18 + 9)) {
											uVar17 = (int)local_964 >> 0x1f;
											if (((local_964 ^ uVar17) - uVar17 & 1 ^ uVar17) == uVar17) {
												iVar9 = std::atoi((char *)local_950);
												*(short *)(ppbVar18[6] + (uVar16 & 0xffff) * 0x28 + 0x24) = (short)iVar9;
											}
											else {
												iVar9 = (uVar16 & 0xffff) * 0x28;
												fVar26 = std::atof((char *)local_950);
												*(float *)(ppbVar18[6] + iVar9) = (float)fVar26;
												fVar26 = std::atof(local_94c);
												*(float *)(ppbVar18[6] + iVar9 + 4) = (float)fVar26;
												fVar26 = std::atof(local_948);
												*(float *)(ppbVar18[6] + iVar9 + 8) = (float)fVar26;
												fVar26 = std::atof(local_944);
												*(float *)(ppbVar18[6] + iVar9 + 0xc) =
														 (float)(fVar26 * (float10)0.005555556 * (float10)3.141593);
												fVar26 = std::atof(local_940);
												*(float *)(ppbVar18[6] + iVar9 + 0x10) =
														 (float)(fVar26 * (float10)0.005555556 * (float10)3.141593);
												fVar26 = std::atof(local_93c);
												*(float *)(ppbVar18[6] + iVar9 + 0x14) =
														 (float)(fVar26 * (float10)0.005555556 * (float10)3.141593);
												fVar26 = std::atof(local_938);
												*(float *)(ppbVar18[6] + iVar9 + 0x18) = (float)fVar26;
												fVar26 = std::atof(local_934);
												*(float *)(ppbVar18[6] + iVar9 + 0x1c) = (float)fVar26;
												fVar26 = std::atof(local_930);
												*(float *)(ppbVar18[6] + iVar9 + 0x20) = (float)fVar26;
											}
										}
									}
								}
								pcVar21 = "EndBehavior";
								pbVar10 = local_954;
								do {
									bVar6 = *pbVar10;
									bVar25 = bVar6 < (byte)*pcVar21;
									if (bVar6 != *pcVar21) {
LAB_004873f6:
										uVar16 = (1 - (uint)bVar25) - (uint)(bVar25 != 0);
										goto LAB_004873fb;
									}
									if (bVar6 == 0) break;
									bVar6 = pbVar10[1];
									bVar25 = bVar6 < ((byte *)pcVar21)[1];
									if (bVar6 != ((byte *)pcVar21)[1]) goto LAB_004873f6;
									pbVar10 = pbVar10 + 2;
									pcVar21 = (char *)((byte *)pcVar21 + 2);
								} while (bVar6 != 0);
								uVar16 = 0;
LAB_004873fb:
								local_964 = local_964 + 1;
								if (uVar16 == 0) {
									local_964 = uVar16;
								}
							}
						}
					}
LAB_004877aa:
					pcVar21 = lego::file::File_GetS_StripLineEnd(local_800,0x400,file);
				}
				iVar9 = 0;
				if (*(short *)(puVar19 + 9) != 0) {
					iVar14 = 0;
					do {
						iVar15 = iVar14 + puVar19[8];
						if (*(ushort *)(iVar15 + 0x24) != 1) {
							iVar2 = *(int *)(iVar15 + 0x18) + (uint)*(ushort *)(iVar15 + 0x24) * 0x28;
							if (*(ushort *)(iVar2 + -4) < *(ushort *)((int)puVar19 + 2)) {
								*(ushort *)(iVar2 + 0x24) = *(ushort *)((int)puVar19 + 2);
								puVar22 = (undefined4 *)
													(*(int *)(iVar15 + 0x18) + (uint)*(ushort *)(iVar15 + 0x24) * 0x28);
								*puVar22 = puVar22[-10];
								puVar22[1] = puVar22[-9];
								puVar22[2] = puVar22[-8];
								iVar2 = *(int *)(iVar15 + 0x18) + (uint)*(ushort *)(iVar15 + 0x24) * 0x28;
								*(undefined4 *)(iVar2 + 0xc) = *(undefined4 *)(iVar2 + -0x1c);
								*(undefined4 *)(iVar2 + 0x10) = *(undefined4 *)(iVar2 + -0x18);
								*(undefined4 *)(iVar2 + 0x14) = *(undefined4 *)(iVar2 + -0x14);
								iVar2 = *(int *)(iVar15 + 0x18) + (uint)*(ushort *)(iVar15 + 0x24) * 0x28;
								*(undefined4 *)(iVar2 + 0x18) = *(undefined4 *)(iVar2 + -0x10);
								*(undefined4 *)(iVar2 + 0x1c) = *(undefined4 *)(iVar2 + -0xc);
								*(undefined4 *)(iVar2 + 0x20) = *(undefined4 *)(iVar2 + -8);
								*(short *)(iVar15 + 0x24) = *(short *)(iVar15 + 0x24) + 1;
							}
						}
						iVar9 += 1;
						iVar14 += 0x34;
					} while (iVar9 < (int)(uint)*(ushort *)(puVar19 + 9));
				}
				iVar9 = 0;
				if (*(short *)(puVar19 + 9) != 0) {
					iVar14 = 0;
					do {
						iVar15 = iVar14 + puVar19[8];
						if (*(ushort *)(iVar15 + 0x26) != 0) {
							puVar3 = (ushort *)(*(int *)(iVar15 + 0x20) + (uint)*(ushort *)(iVar15 + 0x26) * 2);
							if (puVar3[-1] < *(ushort *)((int)puVar19 + 2)) {
								*puVar3 = *(ushort *)((int)puVar19 + 2);
								puVar22 = (undefined4 *)
													(*(int *)(iVar15 + 0x1c) + (uint)*(ushort *)(iVar15 + 0x26) * 4);
								*puVar22 = puVar22[-1];
								*(short *)(iVar15 + 0x26) = *(short *)(iVar15 + 0x26) + 1;
							}
						}
						iVar9 += 1;
						iVar14 += 0x34;
					} while (iVar9 < (int)(uint)*(ushort *)(puVar19 + 9));
				}
				uVar16 = (uint)*(ushort *)(puVar19 + 9);
				iVar9 = uVar16 - 1;
				if (-1 < iVar9) {
					pLVar24 = (LwoFrame *)((int)local_968 + iVar9 * 2);
					iVar9 *= 0x34;
					do {
						iVar14 = iVar9 + puVar19[8];
						if (*(ushort *)&pLVar24->dwSize == 0) {
							*(undefined4 *)(iVar14 + 0x30) = puVar19[7];
							puVar19[7] = iVar14;
						}
						else {
							iVar15 = puVar19[8] + -0x34 + (uint)*(ushort *)&pLVar24->dwSize * 0x34;
							*(undefined4 *)(iVar14 + 0x30) = *(undefined4 *)(iVar15 + 0x2c);
							*(int *)(iVar15 + 0x2c) = iVar14;
						}
						iVar9 += -0x34;
						pLVar24 = (LwoFrame *)((int)&pLVar24[-1].flags + 2);
						uVar16 -= 1;
					} while (uVar16 != 0);
				}
				std::free(local_968);
				FUN_00487aa0((int)puVar19);
			}
		}
		lego::file::File_Close(file);
	}
	return puVar19;
}



void __cdecl
lego::main::Main_SetSharedObjects
					(char *dirname,undefined *getSfxCallback,Sound3DInstance *playOrInitCallback,
					undefined *getSfxFlag1)
{
	char cVar1;
	uint uVar2;
	uint uVar3;
	uint uVar4;
	undefined4 *puVar5;
	char *pcVar6;
	undefined4 *puVar7;
	
	if (dirname != NULL) {
		uVar2 = 0xffffffff;
		pcVar6 = dirname;
		do {
			if (uVar2 == 0) break;
			uVar2 -= 1;
			cVar1 = *pcVar6;
			pcVar6 = pcVar6 + 1;
		} while (cVar1 != '\0');
		uVar3 = ~uVar2 - 1;
		if (dirname[(uVar3 & 0xffff) - 1] != '\\') {
			uVar3 = ~uVar2;
		}
		uVar3 &= 0xffff;
		globals::g_SharedObjects_dir = (char *)std::malloc(uVar3 + 1);
		uVar2 = 0xffffffff;
		do {
			pcVar6 = dirname;
			if (uVar2 == 0) break;
			uVar2 -= 1;
			pcVar6 = dirname + 1;
			cVar1 = *dirname;
			dirname = pcVar6;
		} while (cVar1 != '\0');
		uVar2 = ~uVar2;
		puVar5 = (undefined4 *)(pcVar6 + -uVar2);
		puVar7 = (undefined4 *)globals::g_SharedObjects_dir;
		for (uVar4 = uVar2 >> 2; uVar4 != 0; uVar4 -= 1) {
			*puVar7 = *puVar5;
			puVar5 = puVar5 + 1;
			puVar7 = puVar7 + 1;
		}
		for (uVar2 &= 3; uVar2 != 0; uVar2 -= 1) {
			*(undefined *)puVar7 = *(undefined *)puVar5;
			puVar5 = (undefined4 *)((int)puVar5 + 1);
			puVar7 = (undefined4 *)((int)puVar7 + 1);
		}
		globals::g_SharedObjects_dir[uVar3 - 1] = '\\';
		globals::g_SharedObjects_dir[uVar3] = '\0';
	}
	globals::g_SharedObjects_Callback1 = getSfxCallback;
	globals::g_SharedObjects_Callback2 = getSfxFlag1;
	globals::g_SharedObjects_UnkStruct18 = playOrInitCallback;
	return;
}



void __cdecl lego::res::Res_CleanupSharedObjects(void)
{
	uint uVar1;
	uint uVar2;
	
	uVar2 = 0;
	if (globals::g_SharedObjects_Unk1_COUNT != 0) {
		uVar1 = 0;
		do {
			std::free(globals::g_SharedObjects_Unk1_TABLE[uVar1].resName);
			uVar2 += 1;
			uVar1 = uVar2 & 0xffff;
		} while (uVar1 < globals::g_SharedObjects_Unk1_COUNT);
	}
	uVar2 = 0;
	if (globals::g_SharedObjects_Unk2_COUNT != 0) {
		uVar1 = 0;
		do {
			std::free(globals::g_SharedObjects_Unk2_TABLE[uVar1].resName);
			uVar2 += 1;
			uVar1 = uVar2 & 0xffff;
		} while (uVar1 < globals::g_SharedObjects_Unk2_COUNT);
	}
	return;
}



uint __cdecl lego::unk::Lego_GetFieldByte2(int param_1)
{
	return (uint)*(ushort *)(param_1 + 2);
}



void __cdecl FUN_00487aa0(int param_1)
{
	char cVar1;
	byte bVar2;
	undefined2 uVar3;
	ushort uVar4;
	void *pvVar5;
	int iVar6;
	char *pcVar7;
	uint uVar8;
	uint uVar9;
	undefined4 *puVar10;
	undefined4 *puVar11;
	undefined2 *puVar12;
	char *pcVar13;
	undefined4 *puVar14;
	char **ppcVar15;
	uint uStack2052;
	char *local_800;
	undefined4 local_7fc;
	char *apcStack2040 [254];
	undefined4 local_400 [256];
	
	if (lego::globals::g_SharedObjects_Callback1 == NULL) {
		*(undefined2 *)(param_1 + 0x28) = 0;
	}
	else {
		bVar2 = 0;
		if (*(ushort *)(param_1 + 0x28) != 0) {
			pvVar5 = std::malloc((uint)*(ushort *)(param_1 + 0x28) * 0xd0);
			*(void **)(param_1 + 0x18) = pvVar5;
			uVar4 = 0;
			if (*(short *)(param_1 + 0x24) != 0) {
				do {
					ppcVar15 = (char **)(*(int *)(param_1 + 0x20) + (uint)uVar4 * 0x34);
					if ((*(byte *)(*(int *)(param_1 + 0x20) + 0x28 + (uint)uVar4 * 0x34) & 2) != 0) {
						puVar10 = (undefined4 *)((uint)bVar2 * 0xd0 + *(int *)(param_1 + 0x18));
						*(byte *)(ppcVar15 + 2) = bVar2;
						bVar2 += 1;
						uVar8 = 0xffffffff;
						pcVar7 = *ppcVar15;
						do {
							pcVar13 = pcVar7;
							if (uVar8 == 0) break;
							uVar8 -= 1;
							pcVar13 = pcVar7 + 1;
							cVar1 = *pcVar7;
							pcVar7 = pcVar13;
						} while (cVar1 != '\0');
						uVar8 = ~uVar8;
						puVar11 = (undefined4 *)(pcVar13 + -uVar8);
						puVar14 = local_400;
						for (uVar9 = uVar8 >> 2; uVar9 != 0; uVar9 -= 1) {
							*puVar14 = *puVar11;
							puVar11 = puVar11 + 1;
							puVar14 = puVar14 + 1;
						}
						for (uVar8 &= 3; uVar8 != 0; uVar8 -= 1) {
							*(undefined *)puVar14 = *(undefined *)puVar11;
							puVar11 = (undefined4 *)((int)puVar11 + 1);
							puVar14 = (undefined4 *)((int)puVar14 + 1);
						}
						iVar6 = lego::util::stringSplit((char *)local_400,&local_800,",");
						*(short *)(puVar10 + 0x33) = (short)iVar6 + -2;
						iVar6 = (*(code *)lego::globals::g_SharedObjects_Callback1)(local_7fc,puVar10);
						if (((lego::globals::g_CMDLINE_FLAGS & CMD_REDUCESAMPLES) != CMD_NONE) && (iVar6 == 0))
						{
							*puVar10 = 0;
						}
						uStack2052 = 0;
						if (*(short *)(puVar10 + 0x33) != 0) {
							ppcVar15 = apcStack2040;
							puVar12 = (undefined2 *)((int)puVar10 + 0x36);
							do {
								pcVar7 = std::strstr(*ppcVar15,"-");
								iVar6 = std::atoi(*ppcVar15);
								uVar3 = (undefined2)iVar6;
								puVar12[-0x19] = uVar3;
								if (pcVar7 != NULL) {
									iVar6 = std::atoi(pcVar7 + 1);
									uVar3 = (undefined2)iVar6;
								}
								*puVar12 = uVar3;
								uStack2052 += 1;
								puVar12 = puVar12 + 1;
								ppcVar15 = ppcVar15 + 1;
							} while (uStack2052 < *(ushort *)(puVar10 + 0x33));
						}
					}
					uVar4 += 1;
					if (*(ushort *)(param_1 + 0x24) <= uVar4) {
						return;
					}
				} while( true );
			}
		}
	}
	return;
}



void __cdecl FUN_00487c50(ushort *param_1,undefined4 param_2)
{
	char **ppcVar1;
	void *pvVar2;
	
	pvVar2 = std::malloc((uint)param_1[0x12] << 2);
	ppcVar1 = *(char ***)(param_1 + 0xe);
	*(void **)(param_1 + 10) = pvVar2;
	for (; ppcVar1 != NULL; ppcVar1 = (char **)ppcVar1[0xc]) {
		FUN_00488a80(param_1,ppcVar1,param_2);
		FUN_00488bc0((int)param_1,ppcVar1);
	}
	FUN_00487e60(param_1,0.0);
	return;
}



void * __cdecl lego::res::Res_LoadActFrame_Struct38(void *struct38,IDirect3DRMFrame3 *rmFrame3)
{
	int iVar1;
	undefined4 *puVar2;
	void *pvVar3;
	Struct_34 *pSVar4;
	int iVar5;
	undefined4 *puVar6;
	undefined4 unaff_EBP;
	undefined4 *puVar7;
	undefined4 *puVar8;
	int *piVar9;
	int *piVar10;
	int local_50 [2];
	undefined4 local_48;
	undefined auStack68 [40];
	int *piStack28;
	code **ppcStack16;
	undefined auStack4 [4];
	
	puVar2 = (undefined4 *)std::malloc(0x38);
	local_48 = 0;
	puVar6 = (undefined4 *)struct38;
	if (*(undefined4 **)((int)struct38 + 0x2c) != NULL) {
		puVar6 = *(undefined4 **)((int)struct38 + 0x2c);
	}
	puVar7 = puVar2;
	for (iVar5 = 0xe; iVar5 != 0; iVar5 += -1) {
		*puVar7 = 0;
		puVar7 = puVar7 + 1;
	}
	puVar7 = puVar6;
	puVar8 = puVar2;
	for (iVar5 = 0xe; iVar5 != 0; iVar5 += -1) {
		*puVar8 = *puVar7;
		puVar7 = puVar7 + 1;
		puVar8 = puVar8 + 1;
	}
	puVar2[0xc] = 1;
	pvVar3 = std::malloc((uint)*(ushort *)(puVar2 + 9) << 2);
	iVar5 = puVar2[7];
	puVar2[5] = pvVar3;
	for (; iVar5 != 0; iVar5 = *(int *)(iVar5 + 0x30)) {
		FUN_00488a80((ushort *)puVar2,iVar5,rmFrame3);
	}
	struct38 = NULL;
	if (*(short *)(puVar2 + 9) != 0) {
		do {
			iVar1 = ((uint)struct38 & 0xffff) * 4;
			iVar5 = puVar2[8] + ((uint)struct38 & 0xffff) * 0x34;
			piVar10 = local_50;
			(**(code **)(**(int **)(iVar1 + puVar6[5]) + 0x5c))(*(int **)(iVar1 + puVar6[5]));
			(**(code **)(**(int **)(iVar1 + puVar6[5]) + 0x74))
								(*(int **)(iVar1 + puVar6[5]),unaff_EBP,&local_48);
			(**(code **)(*piVar10 + 8))(piVar10);
			(**(code **)(**(int **)(iVar1 + puVar2[5]) + 0x38))
								(*(int **)(iVar1 + puVar2[5]),0,&stack0xffffffa8);
			if ((*(byte *)(iVar5 + 0x28) & 1) == 0) {
				piVar9 = *(int **)(puVar6[5] + (uint)*(ushort *)(iVar5 + 6) * 4);
				(**(code **)(*piVar9 + 0x80))(piVar9,auStack68);
				piVar10 = local_50;
				(**(code **)(*piVar9 + 0x80))(piVar9,piVar10,auStack4);
				(**(code **)*ppcStack16)(ppcStack16,&idl::IID_IDirect3DRMUserVisual,&stack0xffffff9c);
				(**(code **)(*piStack28 + 8))(piStack28);
				pSVar4 = (Struct_34 *)(**(code **)(*piVar10 + 0x1c))(piVar10);
				(**(code **)(*piVar9 + 8))(piVar9);
				pool::ReservedPool_Struct_34___Next_2
									(pSVar4,*(IDirect3DRMFrame3 **)(puVar2[5] + (uint)*(ushort *)(iVar5 + 6) * 4));
			}
			struct38 = (void *)((int)struct38 + 1);
		} while ((ushort)struct38 < *(ushort *)(puVar2 + 9));
	}
	puVar2[0xb] = puVar6;
	puVar6[0xc] = puVar6[0xc] + 1;
	FUN_00487e60(puVar2,0.0);
	return puVar2;
}



void __cdecl FUN_00487e60(void *param_1,float param_2)
{
	float fVar1;
	void *pvVar2;
	void *pvVar3;
	ushort uVar4;
	float10 fVar5;
	
	pvVar2 = param_1;
	*(undefined4 *)((int)param_1 + 0xc) = *(undefined4 *)((int)param_1 + 0x10);
	if ((*(byte *)((int)param_1 + 0x34) & 1) == 0) {
		pvVar3 = (void *)(uint)*(ushort *)((int)param_1 + 2);
		fVar1 = (float)(int)pvVar3;
		if ((ushort)((ushort)(param_2 < fVar1) << 8 | (ushort)(param_2 == fVar1) << 0xe) == 0) {
			*(float *)((int)param_1 + 0x10) = fVar1;
			param_1 = pvVar3;
		}
		else {
			*(float *)((int)param_1 + 0x10) = param_2;
			param_1 = pvVar3;
		}
	}
	else {
		param_2 = (float)(uint)*(ushort *)((int)param_1 + 2);
		fVar5 = (float10)FUN_0048e46a();
		*(float *)((int)pvVar2 + 0x10) = (float)fVar5;
	}
	uVar4 = 0;
	if (*(short *)((int)pvVar2 + 0x24) != 0) {
		do {
			fVar1 = (float)(*(int *)((int)pvVar2 + 0x20) + (uint)uVar4 * 0x34);
			if (1 < *(ushort *)(*(int *)((int)pvVar2 + 0x20) + 0x24 + (uint)uVar4 * 0x34)) {
				fVar5 = FUN_00487f70((int)fVar1,*(float *)((int)pvVar2 + 0x10),(short *)&param_1);
				param_2 = (float)fVar5;
				FUN_00488430((int)pvVar2,fVar1,(uint)param_1,param_2);
			}
			if (1 < *(ushort *)((int)fVar1 + 0x26)) {
				fVar5 = FUN_00488280((int)fVar1,*(float *)((int)pvVar2 + 0x10),(ushort *)&param_1);
				param_2 = (float)fVar5;
				FUN_00488330((int)pvVar2,(int)fVar1,(uint)param_1);
			}
			FUN_00488010((int)pvVar2,(int)fVar1);
			FUN_004880a0((float)pvVar2,(int)fVar1);
			uVar4 += 1;
		} while (uVar4 < *(ushort *)((int)pvVar2 + 0x24));
	}
	return;
}



float10 __cdecl FUN_00487f70(int param_1,float param_2,short *param_3)
{
	float fVar1;
	uint uVar2;
	uint uVar3;
	uint uVar4;
	uint uVar5;
	float10 fVar6;
	
	uVar2 = 0;
	uVar5 = (uint)*(ushort *)(param_1 + 0x24);
	while( true ) {
		uVar4 = uVar2;
		uVar3 = (uVar5 + uVar4) / 2;
		uVar2 = (uint)*(ushort *)(*(int *)(param_1 + 0x18) + 0x24 + uVar3 * 0x28);
		if ((short)uVar3 == (short)uVar4) break;
		fVar1 = (float)uVar2;
		uVar2 = uVar3;
		if ((ushort)((ushort)(fVar1 < param_2) << 8 | (ushort)(fVar1 == param_2) << 0xe) == 0) {
			uVar2 = uVar4;
			uVar5 = uVar3;
		}
	}
	fVar6 = (float10)uVar2;
	*param_3 = (short)uVar3;
	return ((float10)param_2 - fVar6) /
				 ((float10)(uint)*(ushort *)(*(int *)(param_1 + 0x18) + 0x4c + uVar3 * 0x28) - fVar6);
}



void __cdecl FUN_00488010(int param_1,int param_2)
{
	uint *puVar1;
	int **ppiVar2;
	int *piVar3;
	int *piVar4;
	int *piStack20;
	code **ppcStack16;
	int local_4;
	
	if ((*(byte *)(param_2 + 0x28) & 1) == 0) {
		ppcStack16 = NULL;
		piVar3 = *(int **)(*(int *)(param_1 + 0x14) + (uint)*(ushort *)(param_2 + 6) * 4);
		piStack20 = &local_4;
		(**(code **)(*piVar3 + 0x80))(piVar3);
		piVar4 = &local_4;
		(**(code **)(*piVar3 + 0x80))(piVar3,&ppcStack16);
		ppiVar2 = &piStack20;
		(**(code **)*ppcStack16)(ppcStack16,&idl::IID_IDirect3DRMUserVisual);
		(**(code **)(*piVar4 + 8))(piVar4);
		puVar1 = (uint *)(**(code **)(*piVar3 + 0x1c))(piVar3);
		(*(code *)(*ppiVar2)[2])(ppiVar2);
		FUN_00482300(puVar1,*(undefined4 *)(param_1 + 0x10));
	}
	return;
}



void __cdecl FUN_004880a0(float param_1,int param_2)
{
	ushort *puVar1;
	ushort uVar2;
	undefined4 uVar3;
	int iVar4;
	undefined4 uVar5;
	undefined4 *puVar6;
	uint uVar7;
	bool bVar8;
	
	iVar4 = param_2;
	if ((*(byte *)(param_2 + 0x28) & 2) != 0) {
		puVar1 = (ushort *)(param_2 + 6);
		param_2 = 0;
		uVar3 = *(undefined4 *)(*(int *)((int)param_1 + 0x14) + (uint)*puVar1 * 4);
		puVar6 = (undefined4 *)(*(int *)((int)param_1 + 0x18) + (uint)*(byte *)(iVar4 + 8) * 0xd0);
		if (*(short *)(puVar6 + 0x33) != 0) {
			do {
				uVar7 = param_2 & 0xffff;
				uVar2 = *(ushort *)((int)puVar6 + uVar7 * 2 + 4);
				bVar8 = uVar2 != *(ushort *)((int)puVar6 + uVar7 * 2 + 0x36);
				iVar4 = FUN_00488190(param_1,(uint)uVar2);
				if ((iVar4 != 0) &&
					 (iVar4 = (*(code *)lego::globals::g_SharedObjects_Callback2)(), iVar4 != 0)) {
					uVar5 = (*(code *)lego::globals::g_SharedObjects_UnkStruct18)(uVar3,*puVar6,bVar8,1,0);
					puVar6[uVar7 + 0x1a] = uVar5;
				}
				if ((bVar8) &&
					 (iVar4 = FUN_00488190(param_1,(uint)*(ushort *)((int)puVar6 + uVar7 * 2 + 0x36)),
					 iVar4 != 0)) {
					lego::snd::Sample_StopSoundBufferInstance_internal(puVar6[uVar7 + 0x1a]);
				}
				param_2 += 1;
			} while ((ushort)param_2 < *(ushort *)(puVar6 + 0x33));
		}
	}
	return;
}



undefined4 __cdecl FUN_00488190(float param_1,uint param_2)
{
	float fVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	uint uVar5;
	
	fVar1 = *(float *)((int)param_1 + 0xc);
	fVar2 = *(float *)((int)param_1 + 0x10);
	fVar3 = (float)(ulonglong)param_2;
	uVar5 = lego::unk::Lego_GetFieldByte2((int)param_1);
	fVar4 = fVar2;
	if ((ushort)((ushort)(fVar1 < fVar2) << 8 | (ushort)(fVar1 == fVar2) << 0xe) == 0) {
		fVar4 = fVar1;
	}
	param_1 = fVar2;
	if (fVar1 < fVar2) {
		param_1 = fVar1;
	}
	if (0.5 <= (fVar4 - param_1) / (float)(ulonglong)uVar5) {
		if ((fVar3 >= fVar4) ||
			 ((ushort)((ushort)(fVar3 < param_1) << 8 | (ushort)(fVar3 == param_1) << 0xe) != 0)) {
			return 1;
		}
	}
	else {
		if (((ushort)((ushort)(fVar3 < fVar4) << 8 | (ushort)(fVar3 == fVar4) << 0xe) != 0) &&
			 (param_1 <= fVar3)) {
			return 1;
		}
	}
	return 0;
}



float10 __cdecl FUN_00488280(int param_1,float param_2,ushort *param_3)
{
	ushort uVar1;
	uint uVar2;
	ushort uVar3;
	float10 fVar4;
	
	uVar1 = *(ushort *)(param_1 + 0x26);
	uVar3 = 1;
	if (uVar1 < 2) {
		*param_3 = uVar1 - 1;
		return (float10)0.0;
	}
	do {
		uVar2 = (uint)*(ushort *)(*(int *)(param_1 + 0x20) + (uint)uVar3 * 2);
		if (param_2 <= (float)uVar2) {
			*param_3 = uVar3 - 1;
			fVar4 = (float10)(uint)*(ushort *)(*(int *)(param_1 + 0x20) + (uint)(ushort)(uVar3 - 1) * 2);
			return ((float10)param_2 - fVar4) / ((float10)uVar2 - fVar4);
		}
		uVar3 += 1;
	} while (uVar3 < uVar1);
	*param_3 = uVar1 - 1;
	return (float10)0.0;
}



void __cdecl FUN_00488330(int param_1,int param_2,uint param_3)
{
	if ((param_3 & 0xffff) == *(ushort *)(param_2 + 0x26) - 1) {
		FUN_00488390(param_1,param_2);
		return;
	}
	FUN_00488390(param_1,param_2);
	return;
}



void __cdecl FUN_00488390(int param_1,int param_2)
{
	Struct_34 *pSVar1;
	uint uVar2;
	uint index;
	code **unaff_EDI;
	int *piVar3;
	int *unkMultiplier;
	int *piVar4;
	undefined4 uStack20;
	undefined local_4 [4];
	
	piVar3 = *(int **)(*(int *)(param_1 + 0x14) + (uint)*(ushort *)(param_2 + 6) * 4);
	uStack20 = 0;
	piVar4 = piVar3;
	(**(code **)(*piVar3 + 0x80))(piVar3,local_4);
	unkMultiplier = (int *)&stack0xfffffff0;
	(**(code **)(*piVar3 + 0x80))(piVar3,unkMultiplier,local_4);
	(**(code **)*unaff_EDI)(unaff_EDI,&idl::IID_IDirect3DRMUserVisual,&uStack20);
	(**(code **)(*piVar4 + 8))(piVar4);
	pSVar1 = (Struct_34 *)(**(code **)(*unkMultiplier + 0x1c))(unkMultiplier);
	(**(code **)(*piVar3 + 8))(piVar3);
	uVar2 = lego::res::Res_Struct34_GetField0(pSVar1);
	index = 0;
	if (uVar2 != 0) {
		do {
			FUN_004836e0(pSVar1,index,(float)unkMultiplier,4);
			index += 1;
		} while (index < uVar2);
	}
	return;
}



void __cdecl FUN_00488430(int param_1,float param_2,uint param_3,float param_4)
{
	int iVar1;
	float *pfVar2;
	int iVar3;
	int iVar4;
	float local_24;
	float local_20;
	float local_1c;
	float local_18;
	float local_14;
	float local_10;
	float local_c;
	float local_8;
	float local_4;
	
	iVar4 = *(int *)((int)param_2 + 0x18);
	iVar1 = (param_3 & 0xffff) + 1;
	pfVar2 = (float *)(iVar4 + (param_3 & 0xffff) * 0x28);
	iVar3 = iVar4 + iVar1 * 0x28;
	local_18 = *pfVar2 + (*(float *)(iVar4 + iVar1 * 0x28) - *pfVar2) * param_4;
	local_14 = (*(float *)(iVar3 + 4) - pfVar2[1]) * param_4 + pfVar2[1];
	local_10 = (*(float *)(iVar3 + 8) - pfVar2[2]) * param_4 + pfVar2[2];
	local_24 = pfVar2[6] + (pfVar2[0x10] - pfVar2[6]) * param_4;
	local_20 = (pfVar2[0x11] - pfVar2[7]) * param_4 + pfVar2[7];
	local_1c = (pfVar2[0x12] - pfVar2[8]) * param_4 + pfVar2[8];
	local_c = pfVar2[3] + (pfVar2[0xd] - pfVar2[3]) * param_4;
	local_8 = (pfVar2[0xe] - pfVar2[4]) * param_4 + pfVar2[4];
	local_4 = (pfVar2[0xf] - pfVar2[5]) * param_4 + pfVar2[5];
	FUN_004885a0(param_1,param_2,&local_18,&local_c,&local_24);
	return;
}



void __cdecl FUN_004885a0(int param_1,float param_2,float *param_3,float *param_4,float *param_5)
{
	float *pfVar1;
	float fVar2;
	float fVar3;
	float fVar4;
	int *piVar5;
	float fVar6;
	float fVar7;
	float fVar8;
	float fVar9;
	float fVar10;
	float10 fVar11;
	float10 fVar12;
	float10 fVar13;
	float10 fVar14;
	float10 fVar15;
	float10 fVar16;
	undefined4 unaff_retaddr;
	float local_48;
	float local_44;
	float local_40;
	float local_3c;
	float local_38;
	undefined4 local_34;
	float local_30;
	float local_2c;
	float local_28;
	undefined4 local_24;
	float local_20;
	float local_1c;
	float local_18;
	undefined4 local_14;
	float local_10;
	int *local_c;
	float local_8;
	undefined4 local_4;
	
	piVar5 = *(int **)(*(int *)(param_1 + 0x14) + (uint)*(ushort *)((int)param_2 + 6) * 4);
	if ((*(byte *)((int)param_2 + 0x28) & 4) == 0) {
		fVar11 = (float10)fsin((float10)param_4[2]);
		fVar12 = (float10)fsin((float10)param_4[1]);
		fVar13 = (float10)fcos((float10)param_4[2]);
		fVar14 = (float10)fsin((float10)*param_4);
		fVar6 = *(float *)((int)param_2 + 0xc);
		fVar15 = (float10)fcos((float10)*param_4);
		fVar16 = (float10)fcos((float10)param_4[1]);
		local_3c = *param_5 * (float)fVar11;
		fVar9 = *param_5 * (float)fVar13;
		fVar2 = (float)fVar14;
		fVar3 = (float)fVar15;
		local_44 = param_5[1] * (float)fVar13;
		fVar4 = (float)(fVar12 * (float10)local_3c);
		param_4 = (float *)(float)fVar16;
		local_3c = (float)param_4 * local_3c;
		local_48 = (float)fVar12 * local_44;
		fVar7 = *(float *)((int)param_2 + 0x10);
		fVar8 = *(float *)((int)param_2 + 0x14);
		fVar10 = -(param_5[1] * (float)fVar11);
		local_40 = (float)((float10)fVar2 * (float10)fVar4 + fVar15 * (float10)fVar9);
		local_38 = (float)((float10)fVar3 * (float10)fVar4 + -(fVar14 * (float10)fVar9));
		pfVar1 = param_5 + 2;
		param_5 = (float *)(param_5[2] * (float)param_4);
		local_1c = -(*pfVar1 * (float)fVar12);
		local_20 = fVar2 * (float)param_5;
		local_18 = fVar3 * (float)param_5;
		local_2c = (float)param_4 * local_44;
		local_30 = fVar2 * local_48 + fVar3 * fVar10;
		local_28 = -(fVar2 * fVar10) + fVar3 * local_48;
		local_34 = 0;
		local_24 = 0;
		local_10 = fVar7 * local_30 + fVar6 * local_40 + fVar8 * local_20 + *param_3;
		local_c = (int *)(fVar7 * local_2c + fVar6 * local_3c + fVar8 * local_1c + param_3[1]);
		local_8 = fVar7 * local_28 + fVar6 * local_38 + fVar8 * local_18 + param_3[2];
		local_14 = 0;
		local_4 = 0x3f800000;
		param_2 = fVar3;
	}
	else {
		(**(code **)(*piVar5 + 0x5c))(piVar5,&param_2);
		(**(code **)(*piVar5 + 0x74))(piVar5,unaff_retaddr,&local_48);
		(**(code **)(*local_c + 8))(local_c);
		param_2 = 0.0;
		local_40 = local_40 * *param_5;
		local_2c = param_5[1] * local_2c;
		local_18 = param_5[2] * local_18;
		local_10 = *param_3;
		local_c = (int *)param_3[1];
		local_8 = param_3[2];
	}
	(**(code **)(*piVar5 + 0x38))(piVar5,0,&local_40);
	return;
}



Struct_34 * __cdecl FUN_00488880(int param_1,char *param_2,IDirect3DRMFrame3 *rmFrame3,int param_4)
{
	char cVar1;
	Struct_34 *pSVar2;
	uint uVar3;
	uint uVar4;
	undefined4 *puVar5;
	char *pcVar6;
	char *pcVar7;
	undefined4 *puVar8;
	char filename [260];
	
	if (param_1 == 0) {
		uVar3 = 0xffffffff;
		pcVar6 = param_2;
		do {
			pcVar7 = pcVar6;
			if (uVar3 == 0) break;
			uVar3 -= 1;
			pcVar7 = pcVar6 + 1;
			cVar1 = *pcVar6;
			pcVar6 = pcVar7;
		} while (cVar1 != '\0');
		uVar3 = ~uVar3;
		puVar5 = (undefined4 *)(pcVar7 + -uVar3);
		puVar8 = (undefined4 *)filename;
		for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
			*puVar8 = *puVar5;
			puVar5 = puVar5 + 1;
			puVar8 = puVar8 + 1;
		}
		for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
			*(undefined *)puVar8 = *(undefined *)puVar5;
			puVar5 = (undefined4 *)((int)puVar5 + 1);
			puVar8 = (undefined4 *)((int)puVar8 + 1);
		}
	}
	else {
		std::sprintf(filename,"%s%s",param_1,param_2);
	}
	pSVar2 = (Struct_34 *)
					 lego::res::Res_LookupSharedObject
										 (lego::globals::g_SharedObjects_Unk1_TABLE,
											lego::globals::g_SharedObjects_Unk1_COUNT,filename);
	if (pSVar2 != NULL) {
		lego::pool::ReservedPool_Struct_34___Next_2(pSVar2,rmFrame3);
		return pSVar2;
	}
	pSVar2 = (Struct_34 *)lego::res::Res_CreateLWO(filename,rmFrame3,param_4);
	if (pSVar2 != NULL) {
		lego::res::Res_AddSharedObject
							(lego::globals::g_SharedObjects_Unk1_TABLE,
							 (int *)&lego::globals::g_SharedObjects_Unk1_COUNT,filename,pSVar2);
		return pSVar2;
	}
	if (lego::globals::g_SharedObjects_dir != NULL) {
		std::sprintf(filename,"%s%s",lego::globals::g_SharedObjects_dir,param_2);
		pSVar2 = (Struct_34 *)
						 lego::res::Res_LookupSharedObject
											 (lego::globals::g_SharedObjects_Unk2_TABLE,
												lego::globals::g_SharedObjects_Unk2_COUNT,param_2);
		if (pSVar2 != NULL) {
			lego::pool::ReservedPool_Struct_34___Next_2(pSVar2,rmFrame3);
			return pSVar2;
		}
		pSVar2 = (Struct_34 *)lego::res::Res_CreateLWO(filename,rmFrame3,param_4);
		if (pSVar2 != NULL) {
			lego::res::Res_AddSharedObject
								(lego::globals::g_SharedObjects_Unk2_TABLE,
								 (int *)&lego::globals::g_SharedObjects_Unk2_COUNT,param_2,pSVar2);
			return pSVar2;
		}
	}
	return NULL;
}



Struct_34 * __cdecl
lego::res::Res_LookupSharedObject(SharedObjectResource *table,uint count,char *resName)
{
	uint uVar1;
	int iVar2;
	uint uVar3;
	
	uVar3 = 0;
	if (count == 0) {
		return NULL;
	}
	uVar1 = 0;
	do {
		iVar2 = std::_stricmp(resName,table[uVar1].resName);
		if (iVar2 == 0) {
			return table[uVar3 & 0xffff].lwoStruct34;
		}
		uVar3 += 1;
		uVar1 = uVar3 & 0xffff;
	} while (uVar1 < count);
	return NULL;
}



void __cdecl
lego::res::Res_AddSharedObject
					(SharedObjectResource *table,int *ref_count,char *resName,Struct_34 *struct34)
{
	char *pcVar1;
	
	pcVar1 = std::_strdup(resName);
	table[*ref_count].resName = pcVar1;
	table[*ref_count].lwoStruct34 = struct34;
	*ref_count = *ref_count + 1;
	return;
}



void __cdecl FUN_00488a80(ushort *param_1,undefined4 *param_2,IDirect3DRMFrame3 *param_3)
{
	byte *pbVar1;
	uint uVar2;
	int iVar3;
	undefined4 unaff_EBP;
	byte *pbVar4;
	undefined4 *puVar5;
	ushort *in_stack_00000010;
	IDirect3DRMFrame3 *local_444;
	undefined4 auStack1088 [5];
	undefined4 uStack1068;
	undefined4 uStack1048;
	undefined4 uStack1040;
	undefined4 uStack1036;
	undefined4 uStack1032;
	undefined4 uStack1028;
	byte abStack1024 [1024];
	
	(*lego::globals::g_IDirect3DRM3->lpVtbl->CreateFrame)
						(lego::globals::g_IDirect3DRM3,param_3,&local_444);
	if ((*(byte *)(param_2 + 10) & 4) != 0) {
		puVar5 = auStack1088;
		for (iVar3 = 0x10; iVar3 != 0; iVar3 += -1) {
			*puVar5 = 0;
			puVar5 = puVar5 + 1;
		}
		uStack1032 = 0;
		uStack1036 = 0;
		uStack1040 = 0;
		uStack1028 = 0x3f800000;
		uStack1048 = 0x3f800000;
		uStack1068 = 0x3f800000;
		auStack1088[0] = 0x3f800000;
		(*(code *)local_444->lpVtbl->AddTransform)((IUnknown *)local_444);
	}
	*(IDirect3DRMFrame3 **)(*(int *)(param_1 + 10) + (uint)*in_stack_00000010 * 4) = local_444;
	*(ushort *)((int)param_2 + 6) = *in_stack_00000010;
	*in_stack_00000010 = *in_stack_00000010 + 1;
	std::sprintf((char *)abStack1024,"%s_%0.2i",*param_2,(uint)*(ushort *)(param_2 + 1));
	pbVar4 = abStack1024;
	while (abStack1024[0] != 0) {
		if (std::globals::g_CharWidth_1__004b0f74 < 2) {
			uVar2 = *(ushort *)(std::globals::g_CharTranslate_TABLE._0_4_ + (uint)*pbVar4 * 2) & 0x157;
		}
		else {
			uVar2 = std::_unk_FUN_0048f490((uint)*pbVar4,0x157);
		}
		if (uVar2 == 0) {
			*pbVar4 = 0x5f;
		}
		pbVar1 = pbVar4 + 1;
		pbVar4 = pbVar4 + 1;
		abStack1024[0] = *pbVar1;
	}
	(*local_444->lpVtbl->SetName)((IUnknown *)local_444,(LPCSTR)abStack1024);
	for (iVar3 = param_2[0xb]; iVar3 != 0; iVar3 = *(int *)(iVar3 + 0x30)) {
		FUN_00488a80(param_1,(undefined4 *)iVar3,(IDirect3DRMFrame3 *)unaff_EBP);
	}
	return;
}



void __cdecl FUN_00488bc0(int param_1,char **param_2)
{
	undefined4 rmFrame3;
	char **ppcVar1;
	Struct_34 *pSVar2;
	
	rmFrame3 = *(undefined4 *)(*(int *)(param_1 + 0x14) + (uint)*(ushort *)((int)param_2 + 6) * 4);
	if (*(short *)(param_2 + 9) == 1) {
		FUN_00488c60(param_1,(float)param_2,0);
	}
	if (((*(byte *)(param_2 + 10) & 1) == 0) &&
		 (pSVar2 = FUN_00488880(*(int *)(param_1 + 8),*param_2,rmFrame3,0), pSVar2 != NULL)) {
		if ((*(byte *)(param_2 + 10) & 4) != 0) {
			pSVar2->flags = pSVar2->flags | 0x1000000;
		}
		if ((param_2[7] != NULL) && (*(short *)((int)param_2 + 0x26) == 0)) {
			FUN_00488390(param_1,(int)param_2);
			param_2[7] = NULL;
		}
	}
	for (ppcVar1 = (char **)param_2[0xb]; ppcVar1 != NULL; ppcVar1 = (char **)ppcVar1[0xc]) {
		FUN_00488bc0(param_1,ppcVar1);
	}
	return;
}



void __cdecl FUN_00488c60(int param_1,float param_2,uint param_3)
{
	float *pfVar1;
	
	pfVar1 = (float *)(*(int *)((int)param_2 + 0x18) + (param_3 & 0xffff) * 0x28);
	FUN_004885a0(param_1,param_2,pfVar1,pfVar1 + 3,pfVar1 + 6);
	return;
}



void __cdecl lego::res::Res_FreeActFrameResource_Field4_Struct38(void *struct38)
{
	void *pvVar1;
	int iVar2;
	ushort uVar3;
	
	do {
		pvVar1 = *(void **)((int)struct38 + 0x2c);
		iVar2 = *(int *)((int)struct38 + 0x30) + -1;
		*(int *)((int)struct38 + 0x30) = iVar2;
		if (iVar2 == 0) {
			uVar3 = 0;
			if (*(short *)((int)struct38 + 0x24) != 0) {
				do {
					Res_FreeStruct38_Item_internal
										(struct38,(undefined4 *)(*(int *)((int)struct38 + 0x20) + (uint)uVar3 * 0x34));
					uVar3 += 1;
				} while (uVar3 < *(ushort *)((int)struct38 + 0x24));
			}
			if (*(int *)((int)struct38 + 0x2c) == 0) {
				std::free(*(void **)((int)struct38 + 0x20));
				std::free(*(void **)((int)struct38 + 8));
				if (*(short *)((int)struct38 + 0x28) != 0) {
					std::free(*(void **)((int)struct38 + 0x18));
				}
			}
			std::free(*(void **)((int)struct38 + 0x14));
			std::free(struct38);
		}
		struct38 = pvVar1;
	} while (pvVar1 != NULL);
	return;
}



void __cdecl lego::res::Res_FreeStruct38_Item_internal(void *struct38,undefined4 *item)
{
	Struct_34 *struct34;
	code **unaff_EDI;
	int *piVar1;
	int *piVar2;
	int *piVar3;
	undefined local_4 [4];
	
	if ((*(byte *)(item + 10) & 1) == 0) {
		piVar1 = *(int **)(*(int *)((int)struct38 + 0x14) + (uint)*(ushort *)((int)item + 6) * 4);
		piVar3 = piVar1;
		(**(code **)(*piVar1 + 0x80))(piVar1,local_4);
		piVar2 = (int *)&stack0xfffffff0;
		(**(code **)(*piVar1 + 0x80))(piVar1,piVar2,local_4);
		(**(code **)*unaff_EDI)(unaff_EDI,&idl::IID_IDirect3DRMUserVisual,&stack0xffffffec);
		(**(code **)(*piVar3 + 8))(piVar3);
		struct34 = (Struct_34 *)(**(code **)(*piVar2 + 0x1c))(piVar2);
		(**(code **)(*piVar1 + 8))(piVar1);
		FUN_00482390(struct34,*(IDirect3DRMFrame3 **)
													 (*(int *)((int)struct38 + 0x14) + (uint)*(ushort *)((int)item + 6) * 4));
	}
	if ((*(int *)((int)struct38 + 0x2c) == 0) && (*(int *)((int)struct38 + 0x30) == 0)) {
		std::free((void *)*item);
		std::free((void *)item[6]);
		if (*(short *)((int)item + 0x26) != 0) {
			std::free((void *)item[7]);
			std::free((void *)item[8]);
		}
	}
	return;
}



BOOL __cdecl lego::snd::InitSoundSystem(BOOL nosound)
{
	BOOL BVar1;
	
	globals::snd::g_SoundEnabled = ZEXT14(nosound == 0);
	globals::snd::g_MusicState = -1;
	if (nosound != 0) {
		globals::snd::g_MusicState = -1;
		return 1;
	}
	BVar1 = InitDirectSound(globals::wnd::g_hWnd);
	return (uint)(BVar1 != 0);
}



BOOL __cdecl lego::main::Main_IsSoundEnabled(void)
{
	if ((globals::snd::g_SoundEnabled != 0) && (globals::g_DirectSoundEnabled != 0)) {
		return 1;
	}
	return 0;
}



void __cdecl lego::snd::Music_PlayTrack(int trackIndex,int musicState,MusicCallback *callback)
{
	if (globals::snd::g_SoundEnabled != 0) {
		if (musicState == 1) {
			globals::snd::g_MusicState = 1;
		}
		globals::snd::g_MusicTrackIndex = trackIndex;
		globals::snd::g_MusicCallback = callback;
		Music_CDAudio_Open(trackIndex);
	}
	return;
}



BOOL __cdecl lego::snd::Music_CDAudio_Close(void)
{
	if (globals::snd::g_SoundEnabled == 0) {
		return 0;
	}
	globals::snd::g_mciLastError =
			 mciSendStringA("stop cdaudio",globals::snd::g_mciErrorText,200,NULL);
	if (globals::snd::g_mciLastError == 0) {
		globals::snd::g_mciLastError =
				 mciSendStringA("close cdaudio",globals::snd::g_mciErrorText,200,NULL);
		if (globals::snd::g_mciLastError == 0) {
			return 1;
		}
	}
	Music_UpdateErrorString();
	return 0;
}



void __cdecl lego::snd::Music_Update(BOOL isMusicOn)
{
	uint uVar1;
	DWORD DVar2;
	BOOL BVar3;
	
	uVar1 = globals::snd::g_MusicUpdateTime;
	if ((((globals::snd::g_SoundEnabled != 0) &&
			 (DVar2 = timeGetTime(), uVar1 = globals::snd::g_MusicUpdateTime,
			 globals::snd::g_MusicUpdateTime + 4000 < DVar2)) && (uVar1 = DVar2, isMusicOn != 0)) &&
		 (BVar3 = Music_IsTrackPlaying(globals::snd::g_MusicTrackIndex), BVar3 == 0)) {
		if (globals::snd::g_MusicState != 0) {
			Music_CDAudio_Play(globals::snd::g_MusicTrackIndex);
		}
		if (globals::snd::g_MusicCallback != NULL) {
			(*globals::snd::g_MusicCallback)();
		}
	}
	globals::snd::g_MusicUpdateTime = uVar1;
	return;
}



// WARNING: Could not reconcile some variable overlaps

MMRESULT __cdecl
lego::snd::RIFF_OpenInMemory
					(HPSTR fileData,LONG fileSize,HMMIO *out_hmmio,HGLOBAL *out_hGlobal,LPMMCKINFO riffTag)
{
	HGLOBAL *ppvVar1;
	LPMMCKINFO pmmckiParent;
	HMMIO hmmio;
	LONG LVar2;
	undefined4 *puVar3;
	uint uVar4;
	int iVar5;
	MMRESULT MVar6;
	_MMIOINFO *p_Var7;
	undefined4 local_6c;
	undefined4 local_68;
	undefined4 local_64;
	undefined4 local_60;
	_MMCKINFO local_5c;
	_MMIOINFO local_48;
	
	*out_hGlobal = NULL;
	p_Var7 = &local_48;
	for (iVar5 = 0x12; iVar5 != 0; iVar5 += -1) {
		p_Var7->dwFlags = 0;
		p_Var7 = (_MMIOINFO *)&p_Var7->fccIOProc;
	}
										// "MEM "
	local_48.fccIOProc = 0x204d454d;
	local_48.pchBuffer = fileData;
	local_48.cchBuffer = fileSize;
	hmmio = mmioOpenA(NULL,(LPMMIOINFO)&local_48,0x10000);
	pmmckiParent = riffTag;
	if (hmmio == NULL) {
		MVar6 = 0xe100;
	}
	else {
		MVar6 = mmioDescend(hmmio,riffTag,NULL,0);
		if (MVar6 == 0) {
			if ((pmmckiParent->ckid == 0x46464952) && (pmmckiParent->fccType == 0x45564157)) {
				local_5c.ckid = 0x20746d66;
				MVar6 = mmioDescend(hmmio,(LPMMCKINFO)&local_5c,(MMCKINFO *)pmmckiParent,0x10);
				if (MVar6 != 0) goto LAB_004890e9;
				if (0xf < local_5c.cksize) {
					LVar2 = mmioRead(hmmio,(HPSTR)&local_6c,0x10);
					if (LVar2 != 0x10) {
						MVar6 = 0xe102;
						goto LAB_004890e9;
					}
					if ((short)local_6c == 1) {
						fileData = NULL;
					}
					else {
						LVar2 = mmioRead(hmmio,(HPSTR)&fileData,2);
						if (LVar2 != 2) {
							MVar6 = 0xe102;
							goto LAB_004890e9;
						}
					}
					puVar3 = (undefined4 *)GlobalAlloc(0,((uint)fileData & 0xffff) + 0x12);
					*out_hGlobal = puVar3;
					if (puVar3 == NULL) {
						MVar6 = 0xe000;
						goto LAB_004890e9;
					}
					*puVar3 = local_6c;
					puVar3[1] = local_68;
					puVar3[2] = local_64;
					puVar3[3] = local_60;
					*(short *)((int)*out_hGlobal + 0x10) = (short)fileData;
					if (((short)fileData == 0) ||
						 (uVar4 = mmioRead(hmmio,(HPSTR)((int)*out_hGlobal + 0x12),(uint)fileData & 0xffff),
						 uVar4 == ((uint)fileData & 0xffff))) {
						MVar6 = mmioAscend(hmmio,(LPMMCKINFO)&local_5c,0);
						if (MVar6 == 0) {
							*out_hmmio = hmmio;
							return 0;
						}
						goto LAB_004890e9;
					}
				}
			}
			MVar6 = 0xe101;
		}
	}
LAB_004890e9:
	ppvVar1 = out_hGlobal;
	if (*out_hGlobal != NULL) {
		GlobalFree(*out_hGlobal);
		*ppvVar1 = NULL;
	}
	if (hmmio != NULL) {
		mmioClose(hmmio,0);
		hmmio = NULL;
	}
	*out_hmmio = hmmio;
	return MVar6;
}



DWORD __cdecl lego::snd::RIFF_OpenStreamed(LPSTR filename)
{
	HMMIO hmmio;
	MMRESULT MVar1;
	LONG LVar2;
	DWORD DVar3;
	PCMWAVEFORMAT local_38;
	_MMCKINFO local_28;
	_MMCKINFO local_14;
	
	DVar3 = 0;
	hmmio = mmioOpenA(filename,NULL,0);
	if (hmmio != NULL) {
		MVar1 = mmioDescend(hmmio,(LPMMCKINFO)&local_28,NULL,0);
										// "RIFF", "WAVE"
		if (((MVar1 == 0) && (local_28.ckid == 1179011410)) && (local_28.fccType == 1163280727)) {
										// "fmt "
			local_14.ckid = 544501094;
			MVar1 = mmioDescend(hmmio,(LPMMCKINFO)&local_14,(MMCKINFO *)&local_28,0x10);
			if ((MVar1 == 0) && (0xf < local_14.cksize)) {
				LVar2 = mmioRead(hmmio,(HPSTR)&local_38,0x10);
				if (LVar2 == 0x10) {
					DVar3 = local_38.wf.nAvgBytesPerSec;
				}
			}
		}
		if (hmmio != NULL) {
			mmioClose(hmmio,0);
		}
	}
	return DVar3;
}



// WARNING: Could not reconcile some variable overlaps

MMRESULT __cdecl
lego::snd::AudioPlayback_OpenMem
					(LPSTR filename,HMMIO *out_hmmio,HGLOBAL *out_hglobal,LPMMCKINFO mmckinfo)
{
	HGLOBAL *ppvVar1;
	LPMMCKINFO pmmckiParent;
	HMMIO hmmio;
	LONG LVar2;
	undefined4 *puVar3;
	uint uVar4;
	MMRESULT MVar5;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	_MMCKINFO local_14;
	
	*out_hglobal = NULL;
	hmmio = mmioOpenA(filename,NULL,0x10000);
	pmmckiParent = mmckinfo;
	if (hmmio == NULL) {
		MVar5 = 0xe100;
	}
	else {
		MVar5 = mmioDescend(hmmio,mmckinfo,NULL,0);
		if (MVar5 == 0) {
			if ((pmmckiParent->ckid == 1179011410) && (pmmckiParent->fccType == 1163280727)) {
				local_14.ckid = 544501094;
				MVar5 = mmioDescend(hmmio,(LPMMCKINFO)&local_14,(MMCKINFO *)pmmckiParent,0x10);
				if (MVar5 != 0) goto LAB_00489343;
				if (0xf < local_14.cksize) {
					LVar2 = mmioRead(hmmio,(HPSTR)&local_24,0x10);
					if (LVar2 != 0x10) {
						MVar5 = 0xe102;
						goto LAB_00489343;
					}
					if ((short)local_24 == 1) {
						filename = NULL;
					}
					else {
						LVar2 = mmioRead(hmmio,(HPSTR)&filename,2);
						if (LVar2 != 2) {
							MVar5 = 0xe102;
							goto LAB_00489343;
						}
					}
					puVar3 = (undefined4 *)GlobalAlloc(0,((uint)filename & 0xffff) + 0x12);
					*out_hglobal = puVar3;
					if (puVar3 == NULL) {
						MVar5 = 0xe000;
						goto LAB_00489343;
					}
					*puVar3 = local_24;
					puVar3[1] = local_20;
					puVar3[2] = local_1c;
					puVar3[3] = local_18;
					*(short *)((int)*out_hglobal + 0x10) = (short)filename;
					if (((short)filename == 0) ||
						 (uVar4 = mmioRead(hmmio,(HPSTR)((int)*out_hglobal + 0x12),(uint)filename & 0xffff),
						 uVar4 == ((uint)filename & 0xffff))) {
						MVar5 = mmioAscend(hmmio,(LPMMCKINFO)&local_14,0);
						if (MVar5 == 0) {
							*out_hmmio = hmmio;
							return 0;
						}
						goto LAB_00489343;
					}
				}
			}
			MVar5 = 0xe101;
		}
	}
LAB_00489343:
	ppvVar1 = out_hglobal;
	if (*out_hglobal != NULL) {
		GlobalFree(*out_hglobal);
		*ppvVar1 = NULL;
	}
	if (hmmio != NULL) {
		mmioClose(hmmio,0);
		hmmio = NULL;
	}
	*out_hmmio = hmmio;
	return MVar5;
}



void __cdecl lego::snd::RIFF_SeekData(HMMIO *param_1,LPMMCKINFO param_2,MMCKINFO *param_3)
{
	mmioSeek(*param_1,param_3->dwDataOffset + 4,0);
	param_2->ckid = 1635017060;
	mmioDescend(*param_1,param_2,param_3,0x10);
	return;
}



uint __cdecl
lego::snd::RIFF_GetSetInfo(HMMIO param_1,uint param_2,int param_3,int param_4,uint *param_5)
{
	char cVar1;
	MMRESULT MVar2;
	uint uVar3;
	HPSTR pcVar4;
	uint uVar5;
	_MMIOINFO local_48;
	
	MVar2 = mmioGetInfo(param_1,(LPMMIOINFO)&local_48,0);
	uVar3 = (uint)(MVar2 != 0);
	if (uVar3 == 0) {
		uVar3 = *(uint *)(param_4 + 4);
		if (uVar3 < param_2) {
			param_2 = uVar3;
		}
		uVar5 = 0;
		*(uint *)(param_4 + 4) = uVar3 - param_2;
		pcVar4 = local_48.pchEndRead;
		if (param_2 != 0) {
			do {
				if (local_48.pchNext == pcVar4) {
					uVar3 = mmioAdvance(param_1,(LPMMIOINFO)&local_48,0);
					if (uVar3 != 0) goto LAB_00489456;
					pcVar4 = local_48.pchEndRead;
					if (local_48.pchNext == local_48.pchEndRead) {
						*param_5 = 0;
						return 0xe103;
					}
				}
				cVar1 = *local_48.pchNext;
				local_48.pchNext = local_48.pchNext + 1;
				*(char *)(uVar5 + param_3) = cVar1;
				uVar5 += 1;
			} while (uVar5 < param_2);
		}
		uVar3 = mmioSetInfo(param_1,(LPCMMIOINFO)&local_48,0);
		if (uVar3 == 0) {
			*param_5 = param_2;
			return 0;
		}
	}
LAB_00489456:
	*param_5 = 0;
	return uVar3;
}



int __cdecl lego::snd::AudioPlayback_FreeMem(HMMIO *hMmio,HGLOBAL *hGlobal)
{
	if (*hGlobal != NULL) {
		GlobalFree(*hGlobal);
		*hGlobal = NULL;
	}
	if (*hMmio != NULL) {
		mmioClose(*hMmio,0);
		*hMmio = NULL;
	}
	return 0;
}



BOOL __cdecl lego::snd::Music_CDAudio_Play(int trackIndex)
{
	CHAR local_64 [100];
	
	wsprintfA(local_64,"play cdaudio from %i",trackIndex + 1);
	globals::snd::g_mciLastError = mciSendStringA(local_64,globals::snd::g_mciErrorText,200,NULL);
	if (globals::snd::g_mciLastError != 0) {
		Music_UpdateErrorString();
		return 0;
	}
	return 1;
}



BOOL __cdecl lego::snd::Music_UpdateErrorString(void)
{
	BOOL BVar1;
	
	BVar1 = mciGetErrorStringA(globals::snd::g_mciLastError,globals::snd::g_mciErrorText,200);
	return BVar1;
}



BOOL __cdecl lego::snd::Music_IsTrackPlaying(int trackIndex)
{
	int iVar1;
	char local_64 [100];
	
	std::sprintf(local_64,"status cdaudio mode");
	globals::snd::g_mciLastError = mciSendStringA(local_64,globals::snd::g_mciErrorText,200,NULL);
	iVar1 = std::_stricmp(globals::snd::g_mciErrorText,"stopped");
	if (iVar1 != 0) {
		std::sprintf(local_64,"status cdaudio current track");
		globals::snd::g_mciLastError = mciSendStringA(local_64,globals::snd::g_mciErrorText,200,NULL);
		iVar1 = std::atoi(globals::snd::g_mciErrorText);
		if (iVar1 <= trackIndex + 1) {
			return 1;
		}
	}
	Music_UpdateErrorString();
	return 0;
}



BOOL __cdecl lego::snd::Music_CDAudio_Open(int trackIndex)
{
	globals::snd::g_mciLastError =
			 mciSendStringA("open cdaudio",globals::snd::g_mciErrorText,200,NULL);
	if (globals::snd::g_mciLastError == 0) {
		globals::snd::g_mciLastError =
				 mciSendStringA("set cdaudio time format tmsf",globals::snd::g_mciErrorText,200,NULL);
		if (globals::snd::g_mciLastError == 0) {
			Music_CDAudio_Play(trackIndex);
			if (globals::snd::g_mciLastError == 0) {
				return 1;
			}
		}
	}
	Music_UpdateErrorString();
	return 0;
}



void __cdecl lego::file::InitSharedFileBuffers(void)
{
	FileBufferFlags *pFVar1;
	
	pFVar1 = &globals::g_SHARED_FILEBUFFERS_TABLE[0].flags;
	do {
		pFVar1[-1] = FILEBUFFER_NONE;
		*pFVar1 = FILEBUFFER_NONE;
		pFVar1 = pFVar1 + 2;
	} while (pFVar1 < &DAT_005498a4);
	return;
}



int __cdecl lego::file::File_SharedOpen__internal(uint size)
{
	FileBufferFlags *pFVar1;
	void *pvVar2;
	int iVar3;
	
	iVar3 = 0;
	pFVar1 = &globals::g_SHARED_FILEBUFFERS_TABLE[0].flags;
	do {
		if ((*(byte *)pFVar1 & FILEBUFFER_ISUSED) == 0) {
			pvVar2 = std::malloc(size);
			globals::g_SHARED_FILEBUFFERS_TABLE[iVar3].fileData = pvVar2;
			globals::g_SHARED_FILEBUFFERS_TABLE[iVar3].flags =
					 globals::g_SHARED_FILEBUFFERS_TABLE[iVar3].flags | 1;
			return iVar3;
		}
		pFVar1 = pFVar1 + 2;
		iVar3 += 1;
	} while (pFVar1 < &DAT_005498a4);
	return -1;
}



void __cdecl lego::file::File_SharedClose(uint sharedIndex)
{
	if ((sharedIndex < 2000) &&
		 ((*(byte *)&globals::g_SHARED_FILEBUFFERS_TABLE[sharedIndex].flags & 1) != 0)) {
		std::free(globals::g_SHARED_FILEBUFFERS_TABLE[sharedIndex].fileData);
		globals::g_SHARED_FILEBUFFERS_TABLE[sharedIndex].fileData = NULL;
		globals::g_SHARED_FILEBUFFERS_TABLE[sharedIndex].flags = FILEBUFFER_NONE;
	}
	return;
}



void * __cdecl lego::file::File_SharedGetData(uint sharedIndex)
{
	if ((sharedIndex < 2000) &&
		 ((*(byte *)&globals::g_SHARED_FILEBUFFERS_TABLE[sharedIndex].flags & 1) != 0)) {
		return globals::g_SHARED_FILEBUFFERS_TABLE[sharedIndex].fileData;
	}
	return NULL;
}



int * __cdecl
FUN_00489780(float param_1,float param_2,float param_3,int *param_4,undefined4 param_5,
						undefined4 param_6,undefined4 param_7)
{
	int iVar1;
	int *unaff_retaddr;
	int *piVar2;
	IDirect3DRM3 *pIVar3;
	undefined4 uVar4;
	undefined4 *puVar5;
	
	puVar5 = &param_7;
	pIVar3 = lego::globals::g_IDirect3DRM3;
	uVar4 = param_7;
	iVar1 = (*(code *)lego::globals::g_IDirect3DRM3->lpVtbl->CreateMaterial)
										(lego::globals::g_IDirect3DRM3,param_7,puVar5);
	if (iVar1 == 0) {
		piVar2 = unaff_retaddr;
		(**(code **)(*param_4 + 0x34))(param_4,uVar4,puVar5);
		(**(code **)(*unaff_retaddr + 0x30))(unaff_retaddr,pIVar3,uVar4,puVar5);
		return piVar2;
	}
	return NULL;
}



ActFrameResource * __cdecl
lego::res::Res_AllocActFrameResource_Mode0
					(IDirect3DRMAnimationSet2 *rmAnimSet2,IDirect3DRMFrame3 *rmFrame3,int field1c)
{
	uint *puVar1;
	ActFrameResource *actFrame;
	ActFrameResource dummyActFrame;
	
	actFrame = (ActFrameResource *)std::malloc(0x20);
	actFrame->previous = NULL;
	actFrame->animSet = rmAnimSet2;
	actFrame->lwsStruct38 = NULL;
	actFrame->isLWSFile = 0;
	actFrame->rootFrame = rmFrame3;
	(*rmFrame3->lpVtbl->AddRef)((IUnknown *)rmFrame3);
	puVar1 = &actFrame->framesCount;
	*puVar1 = 0;
	actFrame->field_1c = rmFrame3;
	FUN_00489bd0(rmFrame3,0,Res_IncActFrameTableCount,puVar1);
	dummyActFrame.rootFrame = (IDirect3DRMFrame3 *)std::malloc(*puVar1 << 2);
	actFrame->framesTable = (IDirect3DRMFrame3 **)dummyActFrame.rootFrame;
	dummyActFrame.framesTable = NULL;
	FUN_00489bd0(rmFrame3,0,Res_AddToActFrameTable,&stack0xffffffdc);
	return actFrame;
}



ActFrameResource * __cdecl
lego::res::Res_AllocActFrameResource_Mode1
					(void *struct38,IDirect3DRMFrame3 *rmFrame3,undefined4 field1c)
{
	uint *puVar1;
	ActFrameResource *pAVar2;
	ActFrameResource dummyActFrame;
	
	pAVar2 = (ActFrameResource *)std::malloc(0x20);
	pAVar2->previous = NULL;
	pAVar2->animSet = NULL;
	pAVar2->lwsStruct38 = struct38;
	pAVar2->isLWSFile = 1;
	pAVar2->rootFrame = rmFrame3;
	(*rmFrame3->lpVtbl->AddRef)((IUnknown *)rmFrame3);
	puVar1 = &pAVar2->framesCount;
	*puVar1 = 0;
	pAVar2->field_1c = rmFrame3;
	FUN_00489bd0(rmFrame3,0,Res_IncActFrameTableCount,puVar1);
	dummyActFrame.rootFrame = (IDirect3DRMFrame3 *)std::malloc(*puVar1 << 2);
	pAVar2->framesTable = (IDirect3DRMFrame3 **)dummyActFrame.rootFrame;
	dummyActFrame.framesTable = NULL;
	FUN_00489bd0(rmFrame3,0,Res_AddToActFrameTable,&stack0xffffffdc);
	return pAVar2;
}



ActFrameResource * __cdecl
lego::res::Res_InitActFrameResource
					(ActFrameResource *lastActFrameRes,IDirect3DRMFrame3 *rmFrame3,undefined4 *out_param_3)
{
	IDirect3DRMFrame3 **lplpD3DRMFrame;
	ActFrameResource *pAVar1;
	void *pvVar2;
	IDirect3DRMFrame3 **ppIVar3;
	int iVar4;
	ActFrameResource *pAVar5;
	ActFrameResource *pAVar6;
	undefined4 *unaff_retaddr;
	IDirect3DRMFrame3 **ppIStack24;
	undefined4 uStack20;
	
	pAVar1 = (ActFrameResource *)std::malloc(0x20);
	iVar4 = 8;
	pAVar5 = lastActFrameRes;
	pAVar6 = pAVar1;
	if (lastActFrameRes->isLWSFile == 0) {
		for (; iVar4 != 0; iVar4 += -1) {
			pAVar6->previous = NULL;
			pAVar6 = (ActFrameResource *)&pAVar6->lwsStruct38;
		}
										// IDirect3DRMAnimationSet2->SetTime(IDirect3DRMAnimationSet2* this, float
										// rvTime)
		(*(code *)lastActFrameRes->animSet->lpVtbl->SetTime)(lastActFrameRes->animSet,0.0);
		pAVar1->animSet = NULL;
		pAVar1->previous = lastActFrameRes;
		lplpD3DRMFrame = &pAVar1->rootFrame;
										// IDirect3DRM3->CreateFrame(this, IDirect3DRMFrame3* lpD3DRMFrame,
										// IDirect3DRMFrame3** lplpD3DRMFrame)
		(*globals::g_IDirect3DRM3->lpVtbl->CreateFrame)(globals::g_IDirect3DRM3,rmFrame3,lplpD3DRMFrame)
		;
		ppIVar3 = (IDirect3DRMFrame3 **)std::malloc(lastActFrameRes->framesCount << 2);
		pAVar1->framesTable = ppIVar3;
		FUN_00489cb0(lastActFrameRes->rootFrame,(int *)*lplpD3DRMFrame,lastActFrameRes->isLWSFile);
		pAVar1->framesCount = lastActFrameRes->framesCount;
		if (unaff_retaddr != NULL) {
			*unaff_retaddr = lastActFrameRes->field_1c;
		}
		ppIStack24 = pAVar1->framesTable;
		uStack20 = 0;
		FUN_00489bd0(*lplpD3DRMFrame,0,Res_AddToActFrameTable,&stack0xffffffd4);
	}
	else {
		for (; iVar4 != 0; iVar4 += -1) {
			pAVar6->previous = pAVar5->previous;
			pAVar5 = (ActFrameResource *)&pAVar5->lwsStruct38;
			pAVar6 = (ActFrameResource *)&pAVar6->lwsStruct38;
		}
		pvVar2 = Res_LoadActFrame_Struct38(lastActFrameRes->lwsStruct38,rmFrame3);
		pAVar1->lwsStruct38 = pvVar2;
		pAVar1->previous = NULL;
		if (out_param_3 != NULL) {
			*out_param_3 = lastActFrameRes->field_1c;
			return pAVar1;
		}
	}
	return pAVar1;
}



void __cdecl lego::res::Res_FreeActFrameResource(ActFrameResource *actFrameRes)
{
	uint uVar1;
	
	if (actFrameRes != NULL) {
		if (actFrameRes->previous == NULL) {
			if (actFrameRes->isLWSFile == 0) {
				(*actFrameRes->animSet->lpVtbl->Release)((IUnknown *)actFrameRes->animSet);
				(*actFrameRes->rootFrame->lpVtbl->Release)((IUnknown *)actFrameRes->rootFrame);
			}
			else {
				Res_FreeActFrameResource_Field4_Struct38(actFrameRes->lwsStruct38);
			}
		}
		if (actFrameRes->isLWSFile == 0) {
			uVar1 = 0;
			if (actFrameRes->framesCount != 0) {
				do {
					(*actFrameRes->framesTable[uVar1]->lpVtbl->Release)
										((IUnknown *)actFrameRes->framesTable[uVar1]);
					uVar1 += 1;
				} while (uVar1 < actFrameRes->framesCount);
			}
			std::free(actFrameRes->framesTable);
		}
		std::free(actFrameRes);
	}
	return;
}



BOOL __cdecl lego::res::Res_GetActFrameIsLWSFile(ActFrameResource *actFrameRes)
{
	return actFrameRes->isLWSFile;
}



void __cdecl lego::res::Res_SetAnimTime(ActFrameResource *actFrameRes,float time,float *opt_float)
{
	ActFrameResource *pAVar1;
	uint uVar2;
	Matrix4F local_40;
	
	pAVar1 = actFrameRes->previous;
	if (pAVar1 == NULL) {
		if (actFrameRes->isLWSFile != 0) {
			FUN_00487e60(actFrameRes->lwsStruct38,time);
			return;
		}
		(*(code *)actFrameRes->animSet->lpVtbl->SetTime)(actFrameRes->animSet,time);
	}
	else {
		if (pAVar1->isLWSFile == 0) {
			(*(code *)pAVar1->animSet->lpVtbl->SetTime)(pAVar1->animSet,time);
		}
		else {
			FUN_00487e60(pAVar1->lwsStruct38,time);
		}
		uVar2 = 0;
		if (actFrameRes->framesCount != 0) {
			do {
				(*(code *)pAVar1->framesTable[uVar2]->lpVtbl->GetParent)
									(pAVar1->framesTable[uVar2],(IDirect3DRMFrame3 **)&time);
				(*(code *)pAVar1->framesTable[uVar2]->lpVtbl->GetTransform)
									(pAVar1->framesTable[uVar2],(IDirect3DRMFrame3 *)time,&local_40);
				(**(code **)((int)*(IDirect3DRMFrame3 *)time + 8))((IUnknown *)time);
				(*(code *)actFrameRes->framesTable[uVar2]->lpVtbl->AddTransform)
									(actFrameRes->framesTable[uVar2],D3DRMCOMBINE_REPLACE,&local_40);
				uVar2 += 1;
			} while (uVar2 < actFrameRes->framesCount);
		}
		if (opt_float != NULL) {
			if (pAVar1->isLWSFile != 0) {
				FUN_00487e60(pAVar1->lwsStruct38,*opt_float);
				return;
			}
			(*(code *)pAVar1->animSet->lpVtbl->SetTime)(pAVar1->animSet,*opt_float);
			return;
		}
	}
	return;
}



BOOL __cdecl lego::res::Res_IncActFrameTableCount(IDirect3DRMFrame3 *rmFrame3,int *lpFramesCount)
{
	*lpFramesCount = *lpFramesCount + 1;
	return 0;
}



BOOL __cdecl
lego::res::Res_AddToActFrameTable(IDirect3DRMFrame3 *rmFrame3,ActFrameResource *actFrameRes)
{
	actFrameRes->framesTable[actFrameRes->framesCount] = rmFrame3;
	actFrameRes->framesCount = actFrameRes->framesCount + 1;
	return 0;
}



BOOL __cdecl
FUN_00489bd0(IDirect3DRMFrame3 *rmFrame3,int param_2,undefined *param_3,IDirect3DRMFrame3 *param_4)
{
	IDirect3DRMFrame3 *pIVar1;
	undefined *puVar2;
	IDirect3DRMFrame3 *pIVar3;
	int iVar4;
	HRESULT HVar5;
	uint uVar6;
	BOOL BVar7;
	uint index;
	BOOL local_8;
	
	pIVar3 = param_4;
	puVar2 = param_3;
	pIVar1 = rmFrame3;
	local_8 = 0;
	iVar4 = (*(code *)param_3)(rmFrame3,param_4);
	if (iVar4 != 0) {
		return 1;
	}
										// IDirect3DRMFrame3->GetChildren(this, IDirect3DRMFrameArray** lplpChildren)
	HVar5 = (*(code *)pIVar1->lpVtbl->GetChildren)(pIVar1,(IDirect3DRMFrameArray **)&rmFrame3);
	if (HVar5 == 0) {
										// DWORD IDirect3DRMFrameArray->GetSize(this)
		uVar6 = (*rmFrame3->lpVtbl->Clone)((IDirect3DRMFrameArray *)rmFrame3);
		index = 0;
		if (uVar6 != 0) {
			iVar4 = param_2 + 1;
			do {
										// IDirect3DRMFrameArray->GetElement(this, DWORD index, IDirect3DRMFrame**
										// lplpD3DRMFrame)
				(*rmFrame3->lpVtbl->AddDestroyCallback)
									((IDirect3DRMFrameArray *)rmFrame3,index,(IUnknown **)&param_3);
										// IDirect3DRMFrame->QueryInterface(this, IID_IDirect3DRMFrame3,
										// IDirect3DRMFrame3** lplpOut)
				(**(code **)*(IUnknown *)param_3)((IUnknown *)param_3,&idl::IID_IDirect3DRMFrame3,&param_4);
										// IDirect3DRMFrame->Release(this)
				(**(code **)((int)*(IUnknown *)param_3 + 8))((IUnknown *)param_3);
				BVar7 = FUN_00489bd0(param_4,iVar4,puVar2,pIVar3);
				if (BVar7 != 0) {
					local_8 = 1;
					(*param_4->lpVtbl->Release)((IUnknown *)param_4);
					break;
				}
				(*param_4->lpVtbl->Release)((IUnknown *)param_4);
				index += 1;
			} while (index < uVar6);
		}
		(*rmFrame3->lpVtbl->Release)((IUnknown *)rmFrame3);
	}
	return local_8;
}



void __cdecl FUN_00489cb0(IDirect3DRMFrame3 *rmFrame3,int *param_2,BOOL param_3)
{
	IDirect3DRMFrame3 *this;
	int *this_00;
	BOOL BVar1;
	LPCSTR lpName;
	HRESULT HVar2;
	uint uVar3;
	IDirect3DRMFrame3 *unaff_EBX;
	DWORD index;
	IDirect3DRMFrame3 *local_4c;
	IDirect3DRMFrame3 *local_48 [2];
	Matrix4F local_40;
	
	BVar1 = param_3;
	this_00 = param_2;
	this = rmFrame3;
	if ((IDirect3DRMFrame3 *)param_3 == NULL) {
		FUN_00489e80(rmFrame3,param_2);
	}
	else {
		FUN_00489df0(rmFrame3,param_2);
	}
										// IDirect3DRMFrame3->GetName(this, DWORD* lpdwSize, LPSTR lpName)
	(*this->lpVtbl->GetName)(this,(LPDWORD)&rmFrame3,NULL);
	if (rmFrame3 != NULL) {
		lpName = (LPCSTR)std::malloc((uint)rmFrame3);
										// IDirect3DRMFrame3->GetName(this, DWORD* lpdwSize, LPSTR lpName)
		(*this->lpVtbl->GetName)(this,(LPDWORD)&rmFrame3,lpName);
										// IDirect3DRMFrame3->SetName(this, LPCSTR lpName)
		(**(code **)(*this_00 + 0x20))((IDirect3DRMFrame3 *)this_00,lpName);
		std::free(lpName);
	}
										// IDirect3DRMFrame3->GetParent(this, IDirect3DRMFrame3** lplpParent)
	(*(code *)this->lpVtbl->GetParent)(this,(IDirect3DRMFrame3 **)&param_3);
										// IDirect3DRMFrame3->GetTransform(this, IDirect3DRMFrame3* lpRefFrame,
										// Matrix4F** rmMatrix)
	(*(code *)this->lpVtbl->GetTransform)(this,(IDirect3DRMFrame3 *)param_3,(Matrix4F **)&local_40);
										// IDirect3DRMFrame3->Release(this)
										//  (this = GetParent)
	(**(code **)((int)*(IDirect3DRMFrame3 *)param_3 + 8))((IDirect3DRMFrame3 *)param_3);
										// IDirect3DRMFrame3->AddTransform(this, TD3DRMCombineType rctCombine, Matrix4F*
										// rmMatrix)
	(**(code **)(*this_00 + 0x38))((IDirect3DRMFrame3 *)this_00,D3DRMCOMBINE_REPLACE,&local_40);
										// IDirect3DRMFrame3->GetChildren(this, IDirect3DRMFrameArray** lplpChildren)
	HVar2 = (*(code *)this->lpVtbl->GetChildren)(this,(IDirect3DRMFrameArray **)&param_2);
	if (HVar2 == 0) {
										// DWORD IDirect3DRMFrameArray->GetSize(this)
		uVar3 = (**(code **)(*param_2 + 0xc))(param_2);
		index = 0;
		if (uVar3 != 0) {
			do {
										// IDirect3DRMFrameArray->GetElement(this, DWORD index, IDirect3DRMFrame**
										// lplpD3DRMFrame)
				(*rmFrame3->lpVtbl->AddDestroyCallback)
									((IDirect3DRMFrameArray *)rmFrame3,index,(IUnknown **)&stack0xffffffb0);
										// IDirect3DRMFrame->QueryInterface(this, IID_IDirect3DRMFrame3,
										// IDirect3DRMFrame3** lplpOut)
				(*unaff_EBX->lpVtbl->QueryInterface)
									((IUnknown *)unaff_EBX,&idl::IID_IDirect3DRMFrame3,local_48);
										// IDirect3DRMFrame->Release(this)
				(*unaff_EBX->lpVtbl->Release)((IUnknown *)unaff_EBX);
										// IDirect3DRM3->CreateFrame(this, IDirect3DRMFrame3* lpD3DRMFrame,
										// IDirect3DRMFrame3** lplpD3DRMFrame)
				(*lego::globals::g_IDirect3DRM3->lpVtbl->CreateFrame)
									(lego::globals::g_IDirect3DRM3,(IDirect3DRMFrame3 *)this_00,
									 (IDirect3DRMFrame3 **)&stack0xffffffb0);
				FUN_00489cb0(local_4c,(int *)unaff_EBX,BVar1);
				(*unaff_EBX->lpVtbl->Release)((IUnknown *)unaff_EBX);
				(*local_4c->lpVtbl->Release)((IUnknown *)local_4c);
				index += 1;
			} while (index < uVar3);
		}
		(*rmFrame3->lpVtbl->Release)((IUnknown *)rmFrame3);
	}
	return;
}



void __cdecl FUN_00489df0(IDirect3DRMFrame3 *rmFrame3,IDirect3DRMFrame3 *param_2)
{
	IDirect3DRMFrame3 *pIVar1;
	int iVar2;
	Struct_34 *pSVar3;
	code **ppcVar4;
	IDirect3DRMFrame3 *pIVar5;
	int *local_14;
	code *local_10 [4];
	
	pIVar1 = rmFrame3;
										// IDirect3DRMFrame3->GetVisuals(this, DWORD* lpdwCount,
										// IDirect3DRMVisualArray** lplpVisuals)
										//  (NOTE: lightalloy's implementation is missing an argument)
	(*(code *)rmFrame3->lpVtbl->GetVisuals)(rmFrame3,(DWORD *)&rmFrame3,0);
	if (rmFrame3 != NULL) {
										// IDirect3DRMFrame3->GetVisuals(this, DWORD* lpdwCount,
										// IDirect3DRMVisualArray** lplpVisuals)
										//  (NOTE: lightalloy's implementation is missing an argument)
		(*(code *)pIVar1->lpVtbl->GetVisuals)(pIVar1,&rmFrame3,local_10);
		pIVar1 = param_2;
		pIVar5 = NULL;
		if (rmFrame3 != NULL) {
			ppcVar4 = local_10;
			do {
				iVar2 = (***(code ***)*ppcVar4)(*ppcVar4,&idl::IID_IDirect3DRMUserVisual,&local_14);
				if (iVar2 == 0) {
					pSVar3 = (Struct_34 *)(**(code **)(*local_14 + 0x1c))(local_14);
					lego::pool::ReservedPool_Struct_34___Next_2(pSVar3,pIVar1);
				}
				pIVar5 = (IDirect3DRMFrame3 *)((int)&pIVar5->lpVtbl + 1);
				ppcVar4 = ppcVar4 + 1;
			} while (pIVar5 < rmFrame3);
		}
	}
	return;
}



void __cdecl FUN_00489e80(IDirect3DRMFrame3 *rmFrame3,undefined4 param_2)
{
	IDirect3DRMFrame3 **ppIVar1;
	uint unaff_ESI;
	uint uVar2;
	IDirect3DRMFrame3 *pIStack44;
	int *piStack40;
	IDirect3DRMFrame3 ***pppIStack36;
	IDirect3DRMFrame3 *pIStack32;
	IDirect3DRMFrame3 **ppIStack28;
	undefined4 uStack24;
	int *local_10;
	int aiStack8 [2];
	
	pIStack44 = rmFrame3;
	ppIStack28 = &rmFrame3;
	uStack24 = 0;
	pIStack32 = rmFrame3;
	pppIStack36 = (IDirect3DRMFrame3 ***)0x489e98;
	(*(code *)rmFrame3->lpVtbl->GetVisuals)();
	if (aiStack8[0] != 0) {
		pppIStack36 = &ppIStack28;
		piStack40 = aiStack8;
		ppIVar1 = &pIStack44;
		(*(code *)pIStack44->lpVtbl->GetVisuals)();
		uVar2 = 0;
		if (unaff_ESI != 0) {
			do {
				ppIVar1 = ppIVar1 + 1;
				(**(code **)(*local_10 + 0x48))(local_10,*ppIVar1);
				uVar2 += 1;
			} while (uVar2 < unaff_ESI);
		}
	}
	return;
}



void * __cdecl
lego::draw::Image_LoadBMP__internal
					(BITMAP_FILE_INFO_STRUCT *bmpData,uint length,D3DRMIMAGE *d3drmImage)
{
	byte bVar1;
	D3DRMPALETTEENTRY *pDVar2;
	int iVar3;
	DWORD DVar4;
	D3DRMPALETTEENTRY *pDVar5;
	uint uVar6;
	DWORD DVar7;
	D3DRMPALETTEENTRY *pDVar8;
	
	if ((bmpData->bmi).biBitCount == 8) {
		DVar7 = (bmpData->bmi).biClrUsed;
		if (DVar7 == 0) {
			DVar7 = 0x100;
		}
		pDVar2 = (D3DRMPALETTEENTRY *)std::malloc(0x400);
		pDVar5 = pDVar2;
		for (iVar3 = 0x100; iVar3 != 0; iVar3 += -1) {
			*pDVar5 = (D3DRMPALETTEENTRY)0x0;
			pDVar5 = pDVar5 + 1;
		}
		pDVar5 = (D3DRMPALETTEENTRY *)bmpData->bmiColors;
		pDVar8 = pDVar2;
		for (DVar4 = DVar7; DVar4 != 0; DVar4 -= 1) {
			*pDVar8 = *pDVar5;
			pDVar5 = pDVar5 + 1;
			pDVar8 = pDVar8 + 1;
		}
		d3drmImage->isRGB = 0;
		d3drmImage->red_mask = 0xfc;
		d3drmImage->green_mask = 0xfc;
		d3drmImage->blue_mask = 0xfc;
		d3drmImage->alpha_mask = 0xfc;
		d3drmImage->palette_size = DVar7;
		pDVar5 = pDVar2;
		if (0 < (int)DVar7) {
			do {
				bVar1 = pDVar5->red;
				pDVar5->red = pDVar5->blue;
				pDVar5->blue = bVar1;
				DVar7 -= 1;
				pDVar5 = pDVar5 + 1;
			} while (DVar7 != 0);
		}
		d3drmImage->palette = pDVar2;
	}
	else {
		d3drmImage->isRGB = 1;
		d3drmImage->palette_size = 0;
		d3drmImage->palette = NULL;
	}
	d3drmImage->width = (bmpData->bmi).biWidth;
	d3drmImage->height = (bmpData->bmi).biHeight;
	uVar6 = (uint)(bmpData->bmi).biBitCount;
	d3drmImage->bitsPerPixel = uVar6;
	if (false) {
switchD_00489faf_caseD_9:
		iVar3 = 0;
	}
	else {
		switch(uVar6) {
		case 8:
			iVar3 = 1;
			break;
		default:
			goto switchD_00489faf_caseD_9;
		case 0xf:
		case 0x10:
			iVar3 = 2;
			break;
		case 0x18:
			iVar3 = 3;
			break;
		case 0x20:
			iVar3 = 4;
		}
	}
	d3drmImage->stride = iVar3 * d3drmImage->width + 3U & 0xfffffffc;
	DVar7 = (bmpData->hdr).bfOffBits;
	d3drmImage->aspecty = 1;
	d3drmImage->aspectx = 1;
	d3drmImage->buffer1 = (byte *)((int)bmpData->bmiColors + (DVar7 - 0x36));
	d3drmImage->buffer2 = NULL;
	return d3drmImage;
}



void __cdecl lego::draw::BMP_free(D3DRMIMAGE *d3dImage)
{
	if (d3dImage->palette != NULL) {
		std::free(d3dImage->palette);
	}
	return;
}



void __cdecl directx::DirectX_FormatError(char *name,char *description)
{
	std::sprintf(globals::g_DirectX_ErrorMessage,
							 "A DirectX error was set in module %s at line no %i.\nError : %s (code %i)\nDX Module : %s\nError Description : %s\n"
							 ,globals::g_DirectX_ErrorSourceFile,globals::g_DirectX_ErrorLineNumber,name,
							 globals::g_DirectX_ErrorCode,
							 globals::g_DirectX_Modules_TABLE[globals::g_DirectX_ErrorModuleIndex],description);
	return;
}



uint __cdecl directx::D3DError(HRESULT result,int moduleIndex,char *sourceFile,int lineNumber)
{
	globals::g_DirectX_ErrorCode = result;
	if ((moduleIndex < 1) || (globals::g_DirectX_ErrorModuleIndex = moduleIndex, 7 < moduleIndex)) {
		globals::g_DirectX_ErrorModuleIndex = 0;
	}
	globals::g_DirectX_ErrorLineNumber = lineNumber;
	globals::g_DirectX_ErrorCount += 1;
	globals::g_DirectX_ErrorSourceFile = sourceFile;
	switch(moduleIndex) {
	case 2:
		if (result < -0x7fffbffe) {
			if (result == -0x7fffbfff) {
				DirectX_FormatError("DIERR_UNSUPPORTED",
														"The function called is not supported at this time.\nThis value is equal to the E_NOTIMPL\nstandard COM return value."
													 );
				return 0x80004001;
			}
			if (result == -0x7ffffff6) {
				DirectX_FormatError("E_PENDING","Data is not yet availabe.");
				return 0x8000000a;
			}
		}
		else {
			if (result < -0x7fffbffa) {
				if (result == -0x7fffbffb) {
					DirectX_FormatError("DIERR_GENERIC",
															"An undetermined error occurred inside the DirectInput subsystem.\nThis value is equal to the E_FAIL standard\nCOM return value."
														 );
					return 0x80004005;
				}
				if (result == -0x7fffbffe) {
					DirectX_FormatError("DIERR_NOINTERFACE",
															"The specified interface is not supported by\nthe object. This value is equal to the E_NOINTERFACE\nstandard COM return value."
														 );
					return 0x80004002;
				}
			}
			else {
				if (result < -0x7ffbfeab) {
					if (result == -0x7ffbfeac) {
						DirectX_FormatError("DIERR_DEVICENOTREG",
																"The device or device instance is not registered with\nDirectInput. This value is equal to the\nREGDB_E_CLASSNOTREG standard COM return value."
															 );
						return 0x80040154;
					}
					if (result == -0x7ffbfef0) {
						DirectX_FormatError("DIERR_NOAGGREGATION","This object does not support aggregation.");
						return 0x80040110;
					}
				}
				else {
					if (result < -0x7ff8fffd) {
						if (result == -0x7ff8fffe) {
							DirectX_FormatError("DIERR_NOTFOUND","The requested object does not exist.");
							return 0x80070002;
						}
						switch(result) {
						case -0x7ffbfdff:
							DirectX_FormatError("DIERR_DEVICEFULL","The device is full.");
							return result;
						case -0x7ffbfdfe:
							DirectX_FormatError("DIERR_MOREDATA",
																	"Not all the requested information fitted into the buffer");
							return result;
						case -0x7ffbfdfd:
							DirectX_FormatError("DIERR_NOTDOWNLOADED","The effect is not downloaded");
							return result;
						case -0x7ffbfdfc:
							DirectX_FormatError("DIERR_HASEFFECTS",
																	"The device cannot be reinitialized because there\nare still effects attached to it"
																 );
							return result;
						case -0x7ffbfdfb:
							DirectX_FormatError("DIERR_NOTEXCLUSIVEACQUIRED",
																	"The operation cannot be performed unless the device\nis acquired in DISCL_EXCLUSIVE mode."
																 );
							return result;
						case -0x7ffbfdfa:
							DirectX_FormatError("DIERR_INCOMPLETEEFFECT",
																	"The effect could not be downloaded because essential\ninformation is missing. For example, no axes have\nbeen associated with the effect, or no type-specific\ninformation has been supplied"
																 );
							return result;
						case -0x7ffbfdf9:
							DirectX_FormatError("DIERR_NOTBUFFERED",
																	"The device is not buffered.\nSet the DIPROP_BUFFERSIZE property to enable buffering"
																 );
							return result;
						case -0x7ffbfdf8:
							DirectX_FormatError("DIERR_EFFECTPLAYING",
																	"The parameters were updated in memory but were not\ndownloaded to the device because the device does not\nsupport updating an effect while it is still playing."
																 );
							return result;
						}
					}
					else {
						if (result < -0x7ff8fff3) {
							if (result == -0x7ff8fff4) {
								DirectX_FormatError("DIERR_NOTACQUIRED",
																		"The operation cannot be performed unless\nthe device is acquired."
																	 );
								return 0x8007000c;
							}
							if (result == -0x7ff8fffb) {
								DirectX_FormatError("DIERR_HANDLEEXISTS",
																		"The device already has an event notification associated\nwith it. This value is equal to the E_ACCESSDENIED\nstandard COM return value."
																	 );
								return 0x80070005;
							}
						}
						else {
							if (result < -0x7ff8ffea) {
								if (result == -0x7ff8ffeb) {
									DirectX_FormatError("DIERR_NOTINITIALIZED","This object has not been initialized."
																		 );
									return 0x80070015;
								}
								if (result == -0x7ff8fff2) {
									DirectX_FormatError("DIERR_OUTOFMEMORY",
																			"The DirectInput subsystem couldn\'t allocate\nsufficient memory to complete the call.\nThis value is equal to the E_OUTOFMEMORY\nstandard COM return value."
																		 );
									return 0x8007000e;
								}
							}
							else {
								if (result < -0x7ff8ffa8) {
									if (result == -0x7ff8ffa9) {
										DirectX_FormatError("DIERR_INVALIDPARAM",
																				"An invalid parameter was passed to the returning function, or the object was not in a state that permitted the function to be called. This value is equal to the E_INVALIDARG standard COM return value."
																			 );
										return 0x80070057;
									}
									if (result == -0x7ff8ffe2) {
										DirectX_FormatError("DIERR_INPUTLOST",
																				"Access to the input device has been lost. It must be reacquired."
																			 );
										return 0x8007001e;
									}
								}
								else {
									if (result < -0x7ff8ff55) {
										if (result == -0x7ff8ff56) {
											DirectX_FormatError("DIERR_ACQUIRED",
																					"The operation cannot be performed while\nthe device is acquired."
																				 );
											return 0x800700aa;
										}
										if (result == -0x7ff8ff89) {
											DirectX_FormatError("DIERR_BADDRIVERVER",
																					"The object could not be created due to an\nincompatible driver version or mismatched or\nincomplete driver components."
																				 );
											return 0x80070077;
										}
									}
									else {
										if (result < -0x7ff8fb7e) {
											if (result == -0x7ff8fb7f) {
												DirectX_FormatError("DIERR_BETADIRECTINPUTVERSION",
																						"The application was written for an unsupported\nprerelease version of DirectInput."
																					 );
												return 0x80070481;
											}
											if (result == -0x7ff8fb82) {
												DirectX_FormatError("DIERR_OLDDIRECTINPUTVERSION",
																						"The application requires a newer version of DirectInput."
																					 );
												return 0x8007047e;
											}
										}
										else {
											if (result < 1) {
												if (result == 0) {
													DirectX_FormatError("DI_OK",
																							"The operation completed successfully.\nThis value is equal to the S_OK standard\nCOM return value."
																						 );
													return 0;
												}
												if (result == -0x7ff8fb21) {
													DirectX_FormatError("DIERR_ALREADYINITIALIZED",
																							"This object is already initialized");
													return 0x800704df;
												}
											}
											else {
												if (true) {
													switch(result) {
													case 1:
														DirectX_FormatError("DI_BUFFEROVERFLOW",
																								"The device buffer overflowed and some input was lost.\nThis value is equal to the S_FALSE\nstandard COM return value."
																							 );
														return result;
													case 2:
														DirectX_FormatError("DI_POLLEDDEVICE",
																								"The device is a polled device.\nAs a result, device buffering will not collect\nany data and event notifications will not be signaled\nuntil the IDirectInputDevice2::Poll method is called."
																							 );
														return result;
													case 3:
														DirectX_FormatError("DI_DOWNLOADSKIPPED",
																								"The parameters of the effect were successfully updated,\nbut the effect could not be downloaded because the associated\ndevice was not acquired in exclusive mode."
																							 );
														return result;
													case 4:
														DirectX_FormatError("DI_EFFECTRESTARTED",
																								"The effect was stopped,\nthe parameters were updated,\nand the effect was restarted."
																							 );
														return result;
													case 8:
														DirectX_FormatError("DI_TRUNCATED",
																								"The parameters of the effect were successfully updated,\nbut some of them were beyond the capabilities of the\ndevice and were truncated to the nearest supported value."
																							 );
														return result;
													case 0xc:
														DirectX_FormatError("DI_TRUNCATEDANDRESTARTED",
																								"Equal to DI_EFFECTRESTARTED | DI_TRUNCATED");
														return result;
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
		break;
	case 3:
		if (result < -0x7fffbffa) {
			if (result == -0x7fffbffb) {
				DirectX_FormatError("DDERR_GENERIC","There is an undefined error condition.");
				return 0x80004005;
			}
			if (result == -0x7fffbfff) {
				DirectX_FormatError("DDERR_UNSUPPORTED","The operation is not supported.");
				return 0x80004001;
			}
		}
		else {
			if (result < -0x7ff8fff1) {
				if (result == -0x7ff8fff2) {
					DirectX_FormatError("DDERR_OUTOFMEMORY",
															"DirectDraw does not have enough\nmemory to perform the operation.");
					return 0x8007000e;
				}
				if (result == -0x7ffbfe10) {
					DirectX_FormatError("DDERR_NOTINITIALIZED",
															"An attempt was made to call an interface method\nof a DirectDraw object created by CoCreateInstance before\nthe object was initialized."
														 );
					return 0x800401f0;
				}
			}
			else {
				if (result < -0x7789fffa) {
					if (result == -0x7789fffb) {
						DirectX_FormatError("DDERR_ALREADYINITIALIZED",
																"The object has already been initialized.");
						return 0x88760005;
					}
					if (result == -0x7ff8ffa9) {
						DirectX_FormatError("DDERR_INVALIDPARAMS",
																"One or more of the parameters passed to the\nmethod are incorrect."
															 );
						return 0x80070057;
					}
				}
				else {
					if (result < -0x7789ffeb) {
						if (result == -0x7789ffec) {
							DirectX_FormatError("DDERR_CANNOTDETACHSURFACE",
																	"A surface cannot be detached from another\nrequested surface.");
							return 0x88760014;
						}
						if (result == -0x7789fff6) {
							DirectX_FormatError("DDERR_CANNOTATTACHSURFACE",
																	"A surface cannot be attached to\nanother requested surface.");
							return 0x8876000a;
						}
					}
					else {
						if (result < -0x7789ffc8) {
							if (result == -0x7789ffc9) {
								DirectX_FormatError("DDERR_EXCEPTION",
																		"An exception was encountered while performing the requested operation."
																	 );
								return 0x88760037;
							}
							if (result == -0x7789ffd8) {
								DirectX_FormatError("DDERR_CURRENTLYNOTAVAIL","No support is currently available.");
								return 0x88760028;
							}
						}
						else {
							if (result < -0x7789ffa0) {
								if (result == -0x7789ffa1) {
									DirectX_FormatError("DDERR_INCOMPATIBLEPRIMARY",
																			"The primary surface creation request does\nnot match with the existing primary surface."
																		 );
									return 0x8876005f;
								}
								if (result == -0x7789ffa6) {
									DirectX_FormatError("DDERR_HEIGHTALIGN",
																			"The height of the provided rectangle is not\na multiple of the required alignment."
																		 );
									return 0x8876005a;
								}
							}
							else {
								if (result < -0x7789ff91) {
									if (result == -0x7789ff92) {
										DirectX_FormatError("DDERR_INVALIDCLIPLIST",
																				"DirectDraw does not support the provided clip list.");
										return 0x8876006e;
									}
									if (result == -0x7789ff9c) {
										DirectX_FormatError("DDERR_INVALIDCAPS",
																				"One or more of the capability bits passed to\nthe callback function are incorrect."
																			 );
										return 0x88760064;
									}
								}
								else {
									if (result < -0x7789ff7d) {
										if (result == -0x7789ff7e) {
											DirectX_FormatError("DDERR_INVALIDOBJECT",
																					"DirectDraw received a pointer that was an\ninvalid DirectDraw object."
																				 );
											return 0x88760082;
										}
										if (result == -0x7789ff88) {
											DirectX_FormatError("DDERR_INVALIDMODE",
																					"DirectDraw does not support the requested mode.");
											return 0x88760078;
										}
									}
									else {
										if (result < -0x7789ff69) {
											if (result == -0x7789ff6a) {
												DirectX_FormatError("DDERR_INVALIDRECT",
																						"The provided rectangle was invalid.");
												return 0x88760096;
											}
											if (result == -0x7789ff6f) {
												DirectX_FormatError("DDERR_INVALIDPIXELFORMAT",
																						"The pixel format was invalid as specified.");
												return 0x88760091;
											}
										}
										else {
											if (result < -0x7789ff55) {
												if (result == -0x7789ff56) {
													DirectX_FormatError("DDERR_NO3D",
																							"No 3-D hardware or emulation is present.");
													return 0x887600aa;
												}
												if (result == -0x7789ff60) {
													DirectX_FormatError("DDERR_LOCKEDSURFACES",
																							"One or more surfaces are locked, causing the failure of\nthe requested operation."
																						 );
													return 0x887600a0;
												}
											}
											else {
												if (result < -0x7789ff32) {
													if (result == -0x7789ff33) {
														DirectX_FormatError("DDERR_NOCLIPLIST","No clip list is available.");
														return 0x887600cd;
													}
													if (result == -0x7789ff4c) {
														DirectX_FormatError("DDERR_NOALPHAHW",
																								"No alpha acceleration hardware is present or\navailable, causing the failure of\nthe requested operation."
																							 );
														return 0x887600b4;
													}
												}
												else {
													if (result < -0x7789ff23) {
														if (result == -0x7789ff24) {
															DirectX_FormatError("DDERR_NOCOLORKEYHW",
																									"The operation cannot be carried out because there is\nno hardware support for the destination color key."
																								 );
															return 0x887600dc;
														}
														if (result == -0x7789ff2e) {
															DirectX_FormatError("DDERR_NOCOLORCONVHW",
																									"The operation cannot be carried out because no\ncolor-conversion hardware is present or available."
																								 );
															return 0x887600d2;
														}
														if (result == -0x7789ff2c) {
															DirectX_FormatError("DDERR_NOCOOPERATIVELEVELSET",
																									"A create function is called without the\nIDirectDraw2::SetCooperativeLevel method being called."
																								 );
															return 0x887600d4;
														}
														if (result == -0x7789ff29) {
															DirectX_FormatError("DDERR_NOCOLORKEY",
																									"The surface does not currently have a color key."
																								 );
															return 0x887600d7;
														}
													}
													else {
														if (result < -0x7789ff1e) {
															if (result == -0x7789ff1f) {
																DirectX_FormatError("DDERR_NOEXCLUSIVEMODE",
																																																				
																									"The operation requires the application to have exclusive mode,\nbut the application does not have exclusive mode."
																									);
																return 0x887600e1;
															}
															if (result == -0x7789ff22) {
																DirectX_FormatError("DDERR_NODIRECTDRAWSUPPORT",
																																																				
																									"DirectDraw support is not possible\nwith the current display driver."
																									);
																return 0x887600de;
															}
														}
														else {
															if (result < -0x7789ff0f) {
																if (result == -0x7789ff10) {
																	DirectX_FormatError("DDERR_NOGDI","No GDI is present.");
																	return 0x887600f0;
																}
																if (result == -0x7789ff1a) {
																	DirectX_FormatError("DDERR_NOFLIPHW",
																											"Flipping visible surfaces is not supported.")
																	;
																	return 0x887600e6;
																}
															}
															else {
																if (result < -0x7789ff00) {
																	if (result == -0x7789ff01) {
																		DirectX_FormatError("DDERR_NOTFOUND",
																												"The requested item was not found.");
																		return 0x887600ff;
																	}
																	if (result == -0x7789ff06) {
																		DirectX_FormatError("DDERR_NOMIRRORHW",
																																																								
																									"The operation cannot be carried out because no mirroring\nhardware is present or available."
																									);
																		return 0x887600fa;
																	}
																}
																else {
																	if (result < -0x7789fee7) {
																		if (result == -0x7789fee8) {
																			DirectX_FormatError("DDERR_NORASTEROPHW",
																																																										
																									"The operation cannot be carried out because no appropriate\nraster operation hardware is present or available."
																									);
																			return 0x88760118;
																		}
																		if (result == -0x7789fefc) {
																			DirectX_FormatError("DDERR_NOOVERLAYHW",
																																																										
																									"The operation cannot be carried out because no\noverlay hardware is present or available."
																									);
																			return 0x88760104;
																		}
																	}
																	else {
																		if (result < -0x7789fec9) {
																			if (result == -0x7789feca) {
																				DirectX_FormatError("DDERR_NOSTRETCHHW",
																																																												
																									"The operation cannot be carried out because\nthere is no hardware support for stretching."
																									);
																				return 0x88760136;
																			}
																			if (result == -0x7789fede) {
																				DirectX_FormatError("DDERR_NOROTATIONHW",
																																																												
																									"The operation cannot be carried out because\nno rotation hardware is present or available."
																									);
																				return 0x88760122;
																			}
																		}
																		else {
																			if (result < -0x7789feb5) {
																				if (result == -0x7789feb6) {
																					DirectX_FormatError("DDERR_NOTEXTUREHW",
																																																														
																									"The operation cannot be carried out because no\ntexture-mapping hardware is present or available."
																									);
																					return 0x8876014a;
																				}
																				if (result == -0x7789fec4) {
																					DirectX_FormatError("DDERR_NOT4BITCOLOR",
																																																														
																									"The DirectDrawSurface object is not using a 4-bit color palette\nand the requested operation requires a 4-bit color palette."
																									);
																					return 0x8876013c;
																				}
																				if (result == -0x7789fec3) {
																					DirectX_FormatError("DDERR_NOT4BITCOLORINDEX",
																																																														
																									"The DirectDrawSurface object is not using a 4-bit color index\npalette and the requested operation requires a\n4-bit color index palette."
																									);
																					return 0x8876013d;
																				}
																				if (result == -0x7789fec0) {
																					DirectX_FormatError("DDERR_NOT8BITCOLOR",
																																																														
																									"The DirectDrawSurface object is not using an 8-bit color\npalette and the requested operation requires\nan 8-bit color palette."
																									);
																					return 0x88760140;
																				}
																			}
																			else {
																				if (result < -0x7789feab) {
																					if (result == -0x7789feac) {
																						DirectX_FormatError("DDERR_NOZBUFFERHW",
																																																																
																									"The operation to create a z-buffer in display memory\nor to perform a blit using a z-buffer cannot be\ncarried out because there is no hardware support\nfor z-buffers."
																									);
																						return 0x88760154;
																					}
																					if (result == -0x7789feb1) {
																						DirectX_FormatError("DDERR_NOVSYNCHW",
																																																																
																									"The operation cannot be carried out because\nthere is no hardware support for vertical\nblank synchronized operations."
																									);
																						return 0x8876014f;
																					}
																				}
																				else {
																					if (result < -0x7789fe97) {
																						if (result == -0x7789fe98) {
																							DirectX_FormatError("DDERR_OUTOFCAPS",
																																																																		
																									"The hardware needed for the requested\noperation has already been allocated."
																									);
																							return 0x88760168;
																						}
																						if (result == -0x7789fea2) {
																							DirectX_FormatError("DDERR_NOZOVERLAYHW",
																																																																		
																									"The overlay surfaces cannot be z-layered based on the\nz-order because the hardware does not support\nz-ordering of overlays."
																									);
																							return 0x8876015e;
																						}
																					}
																					else {
																						if (result < -0x7789fe6f) {
																							if (result == -0x7789fe70) {
																								DirectX_FormatError("DDERR_COLORKEYNOTSET",
																																																																				
																									"No source color key is specified for this operation."
																									);
																								return 0x88760190;
																							}
																							if (true) {
																								switch(result) {
																								case -0x7789fe84:
																									DirectX_FormatError("DDERR_OUTOFVIDEOMEMORY",
																																																																						
																									"DirectDraw does not have enough display\nmemory to perform the operation."
																									);
																									return result;
																								case -0x7789fe82:
																									DirectX_FormatError("DDERR_OVERLAYCANTCLIP",
																																																																						
																									"The hardware does not support clipped overlays.")
																									;
																									return result;
																								case -0x7789fe80:
																									DirectX_FormatError(
																									"DDERR_OVERLAYCOLORKEYONLYONEACTIVE",
																									"An attempt was made to have more than one\ncolor key active on an overlay."
																									);
																									return result;
																								case -0x7789fe7d:
																									DirectX_FormatError("DDERR_PALETTEBUSY",
																																																																						
																									"Access to this palette is refused because\nthe palette is locked by another thread."
																									);
																									return result;
																								}
																							}
																						}
																						else {
																							if (result < -0x7789fe5b) {
																								if (result == -0x7789fe5c) {
																									DirectX_FormatError(
																									"DDERR_SURFACEALREADYDEPENDENT",
																									"An attempt was made to make a surface a dependency\nof another surface to which it is\nalready dependent."
																									);
																									return 0x887601a4;
																								}
																								if (result == -0x7789fe66) {
																									DirectX_FormatError("DDERR_SURFACEALREADYATTACHED"
																																			,
																									"An attempt was made to attach a surface to another\nsurface to which it is already attached."
																									);
																									return 0x8876019a;
																								}
																							}
																							else {
																								if (result < -0x7789fe4c) {
																									if (result == -0x7789fe4d) {
																										DirectX_FormatError("DDERR_CANTLOCKSURFACE",
																																																																								
																									"Access to this surface is refused because an\nattempt was made to lock the primary\nsurface without DCI support."
																									);
																									return 0x887601b3;
																									}
																									if (result == -0x7789fe52) {
																										DirectX_FormatError("DDERR_SURFACEBUSY",
																																																																								
																									"Access to the surface is refused because\nthe surface is locked by another thread."
																									);
																									return 0x887601ae;
																									}
																								}
																								else {
																									if (result < -0x7789fe3d) {
																										if (result == -0x7789fe3e) {
																											DirectX_FormatError("DDERR_SURFACELOST",
																																																																										
																									"Access to the surface is refused because the surface\nmemory is gone. The DirectDrawSurface object representing this\nsurface should have the IDirectDrawSurface3::Restore\nmethod called on it."
																									);
																									return 0x887601c2;
																									}
																									if (result == -0x7789fe48) {
																										DirectX_FormatError("DDERR_SURFACEISOBSCURED",
																																																																								
																									"Access to the surface is refused\nbecause the surface is obscured."
																									);
																									return 0x887601b8;
																									}
																									}
																									else {
																										if (result < -0x7789fe29) {
																											if (result == -0x7789fe2a) {
																												DirectX_FormatError("DDERR_TOOBIGHEIGHT",
																																																																												
																									"The height requested by DirectDraw is too large."
																									);
																									return 0x887601d6;
																									}
																									if (result == -0x7789fe34) {
																										DirectX_FormatError("DDERR_SURFACENOTATTACHED",
																																																																								
																									"The requested surface is not attached.");
																									return 0x887601cc;
																									}
																									}
																									else {
																										if (result < -0x7789fe15) {
																											if (result == -0x7789fe16) {
																												DirectX_FormatError("DDERR_TOOBIGWIDTH",
																																																																												
																									"The width requested by DirectDraw\nis too large."
																									);
																									return 0x887601ea;
																									}
																									if (result == -0x7789fe20) {
																										DirectX_FormatError("DDERR_TOOBIGSIZE",
																																																																								
																									"The size requested by DirectDraw is too large.\nHowever, the individual height and\nwidth are OK."
																									);
																									return 0x887601e0;
																									}
																									}
																									else {
																										if (result < -0x7789fdf7) {
																											if (result == -0x7789fdf8) {
																												DirectX_FormatError("DDERR_UNSUPPORTEDMASK",
																																																																												
																									"The bitmask in the pixel format requested\nis not supported by DirectDraw."
																									);
																									return 0x88760208;
																									}
																									if (result == -0x7789fe02) {
																										DirectX_FormatError("DDERR_UNSUPPORTEDFORMAT",
																																																																								
																									"The FourCC format requested is\nnot supported by DirectDraw."
																									);
																									return 0x887601fe;
																									}
																									}
																									else {
																										if (result < -0x7789fde3) {
																											if (result == -0x7789fde4) {
																												DirectX_FormatError("DDERR_WASSTILLDRAWING",
																																																																												
																									"The previous blit operation that is transferring\ninformation to or from this\nsurface is incomplete."
																									);
																									return 0x8876021c;
																									}
																									if (result == -0x7789fde7) {
																										DirectX_FormatError(
																									"DDERR_VERTICALBLANKINPROGRESS",
																									"A vertical blank is in progress.");
																									return 0x88760219;
																									}
																									}
																									else {
																										if (result < -0x7789fd89) {
																											if (result == -0x7789fd8a) {
																												DirectX_FormatError("DDERR_NONONLOCALVIDME",
																																																																												
																									"An attempt was made to allocate non-local video\nmemory from a device that does not support non-local\nvideo memory"
																									);
																									return 0x88760276;
																									}
																									if (true) {
																										switch(result) {
																										case -0x7789fdd0:
																											DirectX_FormatError("DDERR_XALIGN",
																																																																										
																									"The provided rectangle was not horizontally\naligned on a required boundary."
																									);
																									return result;
																									case -0x7789fdcf:
																										DirectX_FormatError(
																									"DDERR_INVALIDDIRECTDRAWGUID",
																									"The globally unique identifier (GUID) passed to the\nDirectDrawCreate function is not a valid DirectDraw\ndriver identifier."
																									);
																									return result;
																									case -0x7789fdce:
																										DirectX_FormatError(
																									"DDERR_DIRECTDRAWALREADYCREATED",
																									"A DirectDraw object representing this driver\nhas already been created for this process."
																									);
																									return result;
																									case -0x7789fdcd:
																										DirectX_FormatError("DDERR_NODIRECTDRAWHW",
																																																																								
																									"Hardware-only DirectDraw object creation is not possible;\nthe driver does not support any hardware."
																									);
																									return result;
																									case -0x7789fdcc:
																										DirectX_FormatError(
																									"DDERR_PRIMARYSURFACEALREADYEXISTS",
																									"This process has already created a primary surface."
																									);
																									return result;
																									case -0x7789fdcb:
																										DirectX_FormatError("DDERR_NOEMULATION",
																																																																								
																									"Software emulation is not available.");
																									return result;
																									case -0x7789fdca:
																										DirectX_FormatError("DDERR_REGIONTOOSMALL",
																																																																								
																									"The region passed to the\nIDirectDrawClipper::GetClipList\nmethod is too small."
																									);
																									return result;
																									case -0x7789fdc9:
																										DirectX_FormatError("DDERR_CLIPPERISUSINGHWND",
																																																																								
																									"An attempt was made to set a clip list for a\nDirectDrawClipper object that is already monitoring\na window handle."
																									);
																									return result;
																									case -0x7789fdc8:
																										DirectX_FormatError("DDERR_NOCLIPPERATTACHED",
																																																																								
																									"No DirectDrawClipper object is attached\nto the surface object."
																									);
																									return result;
																									case -0x7789fdc7:
																										DirectX_FormatError("DDERR_NOHWND",
																																																																								
																									"Clipper notification requires a window handle,\nor no window handle has been previously set as\nthe cooperative level window handle."
																									);
																									return result;
																									case -0x7789fdc6:
																										DirectX_FormatError("DDERR_HWNDSUBCLASSED",
																																																																								
																									"DirectDraw is prevented from restoring state\nbecause the DirectDraw cooperative level window\nhandle has been subclassed."
																									);
																									return result;
																									case -0x7789fdc5:
																										DirectX_FormatError("DDERR_HWNDALREADYSET",
																																																																								
																									"The DirectDraw cooperative level window handle\nhas already been set. It cannot be reset while the process\nhas surfaces or palettes created."
																									);
																									return result;
																									case -0x7789fdc4:
																										DirectX_FormatError("DDERR_NOPALETTEATTACHED",
																																																																								
																									"No palette object is attached to this surface.");
																									return result;
																									case -0x7789fdc3:
																										DirectX_FormatError("DDERR_NOPALETTEHW",
																																																																								
																									"There is no hardware support for 16- or 256-color palettes."
																									);
																									return result;
																									case -0x7789fdc2:
																										DirectX_FormatError("DDERR_BLTFASTCANTCLIP",
																																																																								
																									"A DirectDrawClipper object is attached to a source\nsurface that has passed into a call to the\nIDirectDrawSurface3::BltFast method."
																									);
																									return result;
																									case -0x7789fdc1:
																										DirectX_FormatError("DDERR_NOBLTHW",
																																																																								
																									"No blitter hardware is present.");
																									return result;
																									case -0x7789fdc0:
																										DirectX_FormatError("DDERR_NODDROPSHW",
																																																																								
																									"No DirectDraw raster operation (ROP) hardware is available."
																									);
																									return result;
																									case -0x7789fdbf:
																										DirectX_FormatError("DDERR_OVERLAYNOTVISIBLE",
																																																																								
																									"The IDirectDrawSurface3::GetOverlayPosition method\nis called on a hidden overlay."
																									);
																									return result;
																									case -0x7789fdbe:
																										DirectX_FormatError("DDERR_NOOVERLAYDEST",
																																																																								
																									"The IDirectDrawSurface3::GetOverlayPosition method is called\non an overlay that the IDirectDrawSurface3::UpdateOverlay method\nhas not been called on to establish a destination."
																									);
																									return result;
																									case -0x7789fdbd:
																										DirectX_FormatError("DDERR_INVALIDPOSITION",
																																																																								
																									"The position of the overlay on the destination is no longer legal."
																									);
																									return result;
																									case -0x7789fdbc:
																										DirectX_FormatError("DDERR_NOTAOVERLAYSURFACE",
																																																																								
																									"An overlay component is called for a non-overlay surface."
																									);
																									return result;
																									case -0x7789fdbb:
																										DirectX_FormatError(
																									"DDERR_EXCLUSIVEMODEALREADYSET",
																									"An attempt was made to set the cooperative level\nwhen it was already set to exclusive."
																									);
																									return result;
																									case -0x7789fdba:
																										DirectX_FormatError("DDERR_NOTFLIPPABLE",
																																																																								
																									"An attempt has been made to flip\na surface that cannot be flipped."
																									);
																									return result;
																									case -0x7789fdb9:
																										DirectX_FormatError("DDERR_CANTDUPLICATE",
																																																																								
																									"Primary and 3-D surfaces, or surfaces that\nare implicitly created, cannot be duplicated."
																									);
																									return result;
																									case -0x7789fdb8:
																										DirectX_FormatError("DDERR_NOTLOCKED",
																																																																								
																									"An attempt is made to unlock a\nsurface that was not locked."
																									);
																									return result;
																									case -0x7789fdb7:
																										DirectX_FormatError("DDERR_CANTCREATEDC",
																																																																								
																									"Windows cannot create any more device\ncontexts (DCs)."
																									);
																									return result;
																									case -0x7789fdb6:
																										DirectX_FormatError("DDERR_NODC",
																																																																								
																									"No DC has ever been created for this surface.");
																									return result;
																									case -0x7789fdb5:
																										DirectX_FormatError("DDERR_WRONGMODE",
																																																																								
																									"This surface cannot be restored because it\nwas created in a different mode."
																									);
																									return result;
																									case -0x7789fdb4:
																										DirectX_FormatError("DDERR_IMPLICITLYCREATED",
																																																																								
																									"The surface cannot be restored because\nit is an implicitly created surface."
																									);
																									return result;
																									case -0x7789fdb3:
																										DirectX_FormatError("DDERR_NOTPALETTIZED",
																																																																								
																									"The surface being used is not a\npalette-based surface."
																									);
																									return result;
																									case -0x7789fdb2:
																										DirectX_FormatError("DDERR_UNSUPPORTEDMODE",
																																																																								
																									"The display is currently in\nan unsupported mode."
																									);
																									return result;
																									case -0x7789fdb1:
																										DirectX_FormatError("DDERR_NOMIPMAPHW",
																																																																								
																									"The operation cannot be carried out because no mipmap\ntexture mapping hardware is present or available."
																									);
																									return result;
																									case -0x7789fdb0:
																										DirectX_FormatError("DDERR_INVALIDSURFACETYPE",
																																																																								
																									"The requested operation could not be performed\nbecause the surface was of the wrong type."
																									);
																									return result;
																									case -0x7789fda8:
																										DirectX_FormatError("DDERR_NOOPTIMIZEH",
																																																																								
																									"The device does not support optimized surfaces");
																									return result;
																									case -0x7789fda7:
																										DirectX_FormatError("DDERR_NOTLOADE",
																																																																								
																									"The surface is an optimized surface,\nbut it has not yet been allocated any memory"
																									);
																									return result;
																									case -0x7789fd94:
																										DirectX_FormatError("DDERR_DCALREADYCREATED",
																																																																								
																									"A device context (DC) has already been returned\nfor this surface. Only one DC can be retrieved for each surface."
																									);
																									return result;
																									}
																									}
																									}
																									else {
																										if (result < -0x7789fd6b) {
																											if (result == -0x7789fd6c) {
																												DirectX_FormatError("DDERR_CANTPAGEUNLOCK",
																																																																												
																									"An attempt to page unlock a surface failed.\nPage unlock will not work on a display-memory\nsurface or an emulated primary surface."
																									);
																									return 0x88760294;
																									}
																									if (result == -0x7789fd80) {
																										DirectX_FormatError("DDERR_CANTPAGELOCK",
																																																																								
																									"An attempt to page lock a surface failed.\nPage lock will not work on a display-memory surface or\nan emulated primary surface."
																									);
																									return 0x88760280;
																									}
																									}
																									else {
																										if (result < -0x7789fd4d) {
																											if (result == -0x7789fd4e) {
																												DirectX_FormatError("DDERR_MOREDAT",
																																																																												
																									"There is more data available than the\nspecified buffer size can hold"
																									);
																									return 0x887602b2;
																									}
																									if (result == -0x7789fd58) {
																										DirectX_FormatError("DDERR_NOTPAGELOCKED",
																																																																								
																									"An attempt is made to page unlock a\nsurface with no outstanding page locks."
																									);
																									return 0x887602a8;
																									}
																									}
																									else {
																										if (result == -0x7789fd49) {
																											DirectX_FormatError("DDERR_VIDEONOTACTIV",
																																																																										
																									"The video port is not active");
																									return 0x887602b7;
																									}
																									if (result == -0x7789fd45) {
																										DirectX_FormatError(
																									"DDERR_DEVICEDOESNTOWNSURFAC",
																									"Surfaces created by one direct draw device cannot\nbe used directly by another direct draw device"
																									);
																									return 0x887602bb;
																									}
																									if (result == 0) {
																										DirectX_FormatError("DD_OK",
																									"The request completed successfully.");
																									return 0;
																									}
																									}
																									}
																									}
																									}
																									}
																									}
																									}
																									}
																								}
																							}
																						}
																					}
																				}
																			}
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
		break;
	case 4:
		DirectX_FormatError("Unknown","Error handling is unsupported in this module");
	case 5:
		DirectX_FormatError("Unknown","Error handling is unsupported in this module");
	case 6:
		DirectX_FormatError("Unknown","Error handling is unsupported in this module");
	case 1:
		if (result < 1) {
			if (result == 0) {
				DirectX_FormatError("D3DRM_OK","No error.");
				return 0;
			}
			if (true) {
				switch(result) {
				case -0x7789fcf3:
					DirectX_FormatError("D3DRMERR_BADOBJECT","Object expected in argument.");
					return result;
				case -0x7789fcf2:
					DirectX_FormatError("D3DRMERR_BADTYPE","Bad argument type passed.");
					return result;
				case -0x7789fcf1:
					DirectX_FormatError("D3DRMERR_BADALLOC","Out of memory.");
					return result;
				case -0x7789fcf0:
					DirectX_FormatError("D3DRMERR_FACEUSED","Face already used in a mesh.");
					return result;
				case -0x7789fcef:
					DirectX_FormatError("D3DRMERR_NOTFOUND","Object not found in specified place.");
					return result;
				case -0x7789fcee:
					DirectX_FormatError("D3DRMERR_NOTDONEYET","Unimplemented.");
					return result;
				case -0x7789fced:
					DirectX_FormatError("D3DRMERR_FILENOTFOUND","File cannot be opened.");
					return result;
				case -0x7789fcec:
					DirectX_FormatError("D3DRMERR_BADFILE","Data file is corrupt.");
					return result;
				case -0x7789fceb:
					DirectX_FormatError("D3DRMERR_BADDEVICE","Device is not compatible with renderer.");
					return result;
				case -0x7789fcea:
					DirectX_FormatError("D3DRMERR_BADVALUE","Bad argument value passed.");
					return result;
				case -0x7789fce9:
					DirectX_FormatError("D3DRMERR_BADMAJORVERSION","Bad DLL major version.");
					return result;
				case -0x7789fce8:
					DirectX_FormatError("D3DRMERR_BADMINORVERSION","Bad DLL minor version.");
					return result;
				case -0x7789fce7:
					DirectX_FormatError("D3DRMERR_UNABLETOEXECUTE","Unable to carry out procedure.");
					return result;
				case -0x7789fce4:
					DirectX_FormatError("D3DRMERR_PENDING",
															"The data required to supply the requested\ninformation has not finished loading."
														 );
					return result;
				case -0x7789fce3:
					DirectX_FormatError("D3DRMERR_NOTENOUGHDATA",
															"Not enough data has been loaded to\nperform the requested operation."
														 );
					return result;
				case -0x7789fce2:
					DirectX_FormatError("D3DRMERR_REQUESTTOOLARGE",
															"An attempt was made to set a level\nof detail in a progressive mesh greater than the maximum available."
														 );
					return result;
				case -0x7789fce1:
					DirectX_FormatError("D3DRMERR_REQUESTTOOSMALL",
															"An attempt was made to set the minimum\nrendering detail of a progressive mesh smaller than\nthe detail in the base mesh\n(the minimum for rendering)."
														 );
					return result;
				case -0x7789fce0:
					DirectX_FormatError("D3DRMERR_CONNECTIONLOST",
															"Data connection was lost during a load,\nclone, or duplicate.");
					return result;
				case -0x7789fcdc:
					DirectX_FormatError("D3DRMERR_BOXNOTSET",
															"An attempt was made to access a bounding box\n(for example, with IDirect3DRMFrame2::GetBox)\nwhen no bounding box was set on the frame."
														 );
					return result;
				case -0x7789fcdb:
					DirectX_FormatError("D3DRMERR_BADPMDATA",
															"The data in the X File is corrupted.\nThe conversion to a progressive mesh succeeded but\nproduced an invalid progressive mesh in\nthe X File."
														 );
					return result;
				}
			}
		}
		break;
	case 7:
		DirectX_FormatError("QUERY_INTERFACE","The requested interface could not be obtained");
		return result;
	default:
		DirectX_FormatError("Unknown","An error in an unknown DirectX module/object was raised");
		return result;
	}
	DirectX_FormatError("UNKNOWN ERROR","Invalid error code specified");
	return result;
}



void __cdecl lego::file::scan::Scan_Init(void)
{
	globals::scan::g_ScanFileStream_1 = NULL;
	globals::scan::g_ScanFileStream_2 = NULL;
	globals::scan::g_ScanFileStream_3 = NULL;
	globals::scan::g_ScanFileStream_OutputList = NULL;
	globals::scan::g_ScanIsFullScreen = 0;
	return;
}



void __cdecl lego::file::scan::Scan_SetIsFullScreen(BOOL isFullScreen)
{
	globals::scan::g_ScanIsFullScreen = isFullScreen;
	return;
}



void __cdecl lego::file::scan::Scan_Cleanup(void)
{
	if (globals::scan::g_ScanFileStream_1 != NULL) {
		File_Close(globals::scan::g_ScanFileStream_1);
	}
	if (globals::scan::g_ScanFileStream_2 != NULL) {
		File_Close(globals::scan::g_ScanFileStream_2);
	}
	if (globals::scan::g_ScanFileStream_3 != NULL) {
		File_Close(globals::scan::g_ScanFileStream_3);
	}
	globals::scan::g_ScanFileStream_1 = NULL;
	globals::scan::g_ScanFileStream_2 = NULL;
	globals::scan::g_ScanFileStream_3 = NULL;
	return;
}



void __cdecl lego::file::scan::Scan_WriteDataDirList(void)
{
	Scan_Cleanup();
	globals::scan::g_ScanFileStream_OutputList =
			 File_Open(globals::scan::g_ScanFilename_OutputList,"w");
	if (globals::scan::g_ScanFileStream_OutputList != NULL) {
		Scan_ReadDataDirList(globals::scan::g_ScanFilename_InputList);
		File_Close(globals::scan::g_ScanFileStream_OutputList);
	}
	return;
}



char * __cdecl lego::registry::Reg_SplitRootKey(char *fullKey,char *out_rootKey)
{
	char cVar1;
	
	*out_rootKey = '\0';
	cVar1 = *fullKey;
	while ((cVar1 != '\0' && (cVar1 != '\\'))) {
		fullKey = fullKey + 1;
		*out_rootKey = cVar1;
		out_rootKey = out_rootKey + 1;
		cVar1 = *fullKey;
	}
	if (*fullKey == '\\') {
		fullKey = fullKey + 1;
	}
	*out_rootKey = '\0';
	return fullKey;
}



BOOL __cdecl
lego::registry::Reg_QueryValue_OnLocalMachine
					(char *regSubKey,char *regValueName,RegistryType valueType,char *out_buffer,
					uint bufferSize)
{
	BOOL BVar1;
	
	BVar1 = Reg_QueryValue((HKEY)HKEY_LOCAL_MACHINE,regSubKey,regValueName,valueType,out_buffer,
												 bufferSize);
	return BVar1;
}



BOOL __cdecl
lego::registry::Reg_QueryValue
					(HKEY hKey,char *subKey,char *valueName,RegistryType valueType,char *out_buffer,
					uint bufferSize)
{
	char *subKey_00;
	LSTATUS LVar1;
	HKEY pHVar2;
	HKEY local_68;
	char rootKey [100];
	
	subKey_00 = Reg_SplitRootKey(subKey,rootKey);
	if (rootKey[0] != '\0') {
		RegCreateKeyA(hKey,rootKey,(PHKEY)&local_68);
		if (local_68 == NULL) {
			return (BOOL)local_68;
		}
		pHVar2 = (HKEY)Reg_QueryValue(local_68,subKey_00,valueName,valueType,out_buffer,bufferSize);
		RegCloseKey(local_68);
		return (BOOL)pHVar2;
	}
	subKey = NULL;
										// REG_NONE (0x0)
	if (valueType != REGISTRY_STRING) {
										// REG_SZ (0x1)
		if (valueType != REGISTRY_NUMBER) {
			return (BOOL)NULL;
		}
		LVar1 = RegQueryValueExA(hKey,valueName,NULL,(LPDWORD)&subKey,(LPBYTE)out_buffer,&bufferSize);
		return (BOOL)(HKEY)(uint)(LVar1 == 0);
	}
	LVar1 = RegQueryValueExA(hKey,valueName,NULL,(LPDWORD)&subKey,(LPBYTE)out_buffer,&bufferSize);
	return (BOOL)(HKEY)(uint)(LVar1 == 0);
}



BOOL __cdecl lego::util::freadstr(FILE *file,char *out_str)
{
	char cVar1;
	int iVar2;
	
	iVar2 = std::fgetc(file);
	cVar1 = (char)iVar2;
	while (cVar1 != '\0') {
		*out_str = (char)iVar2;
		out_str = out_str + 1;
		iVar2 = std::fgetc(file);
		cVar1 = (char)iVar2;
	}
	*out_str = '\0';
	return 1;
}



// WARNING: Function: _alloca4k replaced with injection: alloca_probe

int __cdecl lego::file::WAD_Open__internal(LPCSTR filename)
{
	char cVar1;
	int index;
	FILE *file;
	WADFile *pWVar2;
	uint uVar3;
	char **ppcVar4;
	BOOL BVar5;
	char *pcVar6;
	WADEntry *pWVar7;
	int iVar8;
	int iVar9;
	byte *pbVar10;
	undefined4 *puVar11;
	byte *pbVar12;
	char *pcVar13;
	undefined4 *puVar14;
	bool bVar15;
	uint uVar16;
	FILE *pFVar17;
	byte abStack4100 [4];
	char acStack4096 [4092];
	undefined4 uStack4;
	
	uStack4 = 0x48b7aa;
	iVar9 = 0;
	index = WAD__Next();
	if (index != -1) {
		file = std::fopen(filename,"rb");
		pWVar2 = WAD_Get(index);
		pWVar2->file = file;
		if (file != NULL) {
			pWVar2 = WAD_Get(index);
			pWVar2->isUsed = 1;
			uVar3 = std::_fread(abStack4100,1,4,file);
			if (uVar3 != 4) {
				std::fclose(file);
				return -1;
			}
			iVar8 = 4;
			bVar15 = true;
			pbVar10 = abStack4100;
			pbVar12 = (byte *)"WWAD";
			do {
				if (iVar8 == 0) break;
				iVar8 += -1;
				bVar15 = *pbVar10 == *pbVar12;
				pbVar10 = pbVar10 + 1;
				pbVar12 = pbVar12 + 1;
			} while (bVar15);
			if (!bVar15) {
				std::fclose(file);
				return -1;
			}
			uVar16 = 4;
			uVar3 = 1;
			pFVar17 = file;
			pWVar2 = WAD_Get(index);
			uVar3 = std::_fread((byte *)&pWVar2->count,uVar3,uVar16,pFVar17);
			if (uVar3 != 4) {
				std::fclose(file);
				return -1;
			}
			pWVar2 = WAD_Get(index);
			ppcVar4 = (char **)std::malloc(pWVar2->count << 2);
			pWVar2 = WAD_Get(index);
			pWVar2->reldirs = ppcVar4;
			pWVar2 = WAD_Get(index);
			ppcVar4 = (char **)std::malloc(pWVar2->count << 2);
			pWVar2 = WAD_Get(index);
			pWVar2->absdirs = ppcVar4;
			pWVar2 = WAD_Get(index);
			if ((pWVar2->reldirs != NULL) && (pWVar2 = WAD_Get(index), pWVar2->absdirs != NULL)) {
				pWVar2 = WAD_Get(index);
				uVar3 = pWVar2->count;
				pWVar2 = WAD_Get(index);
				ppcVar4 = pWVar2->reldirs;
				for (uVar3 &= 0x3fffffff; uVar3 != 0; uVar3 -= 1) {
					*ppcVar4 = NULL;
					ppcVar4 = ppcVar4 + 1;
				}
				for (iVar8 = 0; iVar8 != 0; iVar8 += -1) {
					*(undefined *)ppcVar4 = 0;
					ppcVar4 = (char **)((int)ppcVar4 + 1);
				}
				pWVar2 = WAD_Get(index);
				uVar3 = pWVar2->count;
				pWVar2 = WAD_Get(index);
				ppcVar4 = pWVar2->absdirs;
				for (uVar3 &= 0x3fffffff; uVar3 != 0; uVar3 -= 1) {
					*ppcVar4 = NULL;
					ppcVar4 = ppcVar4 + 1;
				}
				for (iVar8 = 0; iVar8 != 0; iVar8 += -1) {
					*(undefined *)ppcVar4 = 0;
					ppcVar4 = (char **)((int)ppcVar4 + 1);
				}
				pWVar2 = WAD_Get(index);
				if (0 < (int)pWVar2->count) {
					do {
						BVar5 = util::freadstr(file,acStack4096);
						if (BVar5 == 0) {
							pWVar2 = WAD_Get(index);
							if (pWVar2->reldirs != NULL) {
								iVar9 = 0;
								pWVar2 = WAD_Get(index);
								if (0 < (int)pWVar2->count) {
									do {
										pWVar2 = WAD_Get(index);
										if (pWVar2->reldirs[iVar9] != NULL) {
											pWVar2 = WAD_Get(index);
											std::free(pWVar2->reldirs[iVar9]);
										}
										iVar9 += 1;
										pWVar2 = WAD_Get(index);
									} while (iVar9 < (int)pWVar2->count);
								}
								pWVar2 = WAD_Get(index);
								std::free(pWVar2->reldirs);
							}
							pWVar2 = WAD_Get(index);
							if (pWVar2->absdirs != NULL) {
								pWVar2 = WAD_Get(index);
								std::free(pWVar2->absdirs);
							}
							std::fclose(file);
							return -1;
						}
						uVar3 = 0xffffffff;
						pcVar6 = acStack4096;
						do {
							if (uVar3 == 0) break;
							uVar3 -= 1;
							cVar1 = *pcVar6;
							pcVar6 = pcVar6 + 1;
						} while (cVar1 != '\0');
						pcVar6 = (char *)std::malloc(~uVar3);
						pWVar2 = WAD_Get(index);
						pWVar2->reldirs[iVar9] = pcVar6;
						pWVar2 = WAD_Get(index);
						uVar3 = 0xffffffff;
						pcVar6 = acStack4096;
						do {
							pcVar13 = pcVar6;
							if (uVar3 == 0) break;
							uVar3 -= 1;
							pcVar13 = pcVar6 + 1;
							cVar1 = *pcVar6;
							pcVar6 = pcVar13;
						} while (cVar1 != '\0');
						uVar3 = ~uVar3;
						puVar11 = (undefined4 *)(pcVar13 + -uVar3);
						puVar14 = (undefined4 *)pWVar2->reldirs[iVar9];
						for (uVar16 = uVar3 >> 2; uVar16 != 0; uVar16 -= 1) {
							*puVar14 = *puVar11;
							puVar11 = puVar11 + 1;
							puVar14 = puVar14 + 1;
						}
						for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
							*(undefined *)puVar14 = *(undefined *)puVar11;
							puVar11 = (undefined4 *)((int)puVar11 + 1);
							puVar14 = (undefined4 *)((int)puVar14 + 1);
						}
						pWVar2 = WAD_Get(index);
						std::printf("%s\n",pWVar2->reldirs[iVar9]);
						iVar9 += 1;
						pWVar2 = WAD_Get(index);
					} while (iVar9 < (int)pWVar2->count);
				}
				iVar9 = 0;
				pWVar2 = WAD_Get(index);
				if (0 < (int)pWVar2->count) {
					do {
						BVar5 = util::freadstr(file,acStack4096);
						if (BVar5 == 0) {
							pWVar2 = WAD_Get(index);
							if (pWVar2->absdirs != NULL) {
								iVar9 = 0;
								pWVar2 = WAD_Get(index);
								if (0 < (int)pWVar2->count) {
									do {
										pWVar2 = WAD_Get(index);
										if (pWVar2->reldirs[iVar9] != NULL) {
											pWVar2 = WAD_Get(index);
											std::free(pWVar2->reldirs[iVar9]);
										}
										iVar9 += 1;
										pWVar2 = WAD_Get(index);
									} while (iVar9 < (int)pWVar2->count);
								}
								pWVar2 = WAD_Get(index);
								std::free(pWVar2->reldirs);
							}
							pWVar2 = WAD_Get(index);
							if (pWVar2->absdirs != NULL) {
								iVar9 = 0;
								pWVar2 = WAD_Get(index);
								if (0 < (int)pWVar2->count) {
									do {
										pWVar2 = WAD_Get(index);
										if (pWVar2->absdirs[iVar9] != NULL) {
											pWVar2 = WAD_Get(index);
											std::free(pWVar2->absdirs[iVar9]);
										}
										iVar9 += 1;
										pWVar2 = WAD_Get(index);
									} while (iVar9 < (int)pWVar2->count);
								}
								pWVar2 = WAD_Get(index);
								std::free(pWVar2->absdirs);
								std::fclose(file);
								return -1;
							}
							goto LAB_0048be6d;
						}
						uVar3 = 0xffffffff;
						pcVar6 = acStack4096;
						do {
							if (uVar3 == 0) break;
							uVar3 -= 1;
							cVar1 = *pcVar6;
							pcVar6 = pcVar6 + 1;
						} while (cVar1 != '\0');
						pcVar6 = (char *)std::malloc(~uVar3);
						pWVar2 = WAD_Get(index);
						pWVar2->absdirs[iVar9] = pcVar6;
						pWVar2 = WAD_Get(index);
						uVar3 = 0xffffffff;
						pcVar6 = acStack4096;
						do {
							pcVar13 = pcVar6;
							if (uVar3 == 0) break;
							uVar3 -= 1;
							pcVar13 = pcVar6 + 1;
							cVar1 = *pcVar6;
							pcVar6 = pcVar13;
						} while (cVar1 != '\0');
						uVar3 = ~uVar3;
						puVar11 = (undefined4 *)(pcVar13 + -uVar3);
						puVar14 = (undefined4 *)pWVar2->absdirs[iVar9];
						for (uVar16 = uVar3 >> 2; uVar16 != 0; uVar16 -= 1) {
							*puVar14 = *puVar11;
							puVar11 = puVar11 + 1;
							puVar14 = puVar14 + 1;
						}
						for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
							*(undefined *)puVar14 = *(undefined *)puVar11;
							puVar11 = (undefined4 *)((int)puVar11 + 1);
							puVar14 = (undefined4 *)((int)puVar14 + 1);
						}
						pWVar2 = WAD_Get(index);
						std::printf("%s\n",pWVar2->absdirs[iVar9]);
						iVar9 += 1;
						pWVar2 = WAD_Get(index);
					} while (iVar9 < (int)pWVar2->count);
				}
				pWVar2 = WAD_Get(index);
				pWVar7 = (WADEntry *)std::malloc(pWVar2->count << 4);
				pWVar2 = WAD_Get(index);
				pWVar2->entries = pWVar7;
				pWVar2 = WAD_Get(index);
				if (pWVar2->entries == NULL) {
					pWVar2 = WAD_Get(index);
					if (pWVar2->absdirs != NULL) {
						iVar9 = 0;
						pWVar2 = WAD_Get(index);
						if (0 < (int)pWVar2->count) {
							do {
								pWVar2 = WAD_Get(index);
								if (pWVar2->reldirs[iVar9] != NULL) {
									pWVar2 = WAD_Get(index);
									std::free(pWVar2->reldirs[iVar9]);
								}
								iVar9 += 1;
								pWVar2 = WAD_Get(index);
							} while (iVar9 < (int)pWVar2->count);
						}
						pWVar2 = WAD_Get(index);
						std::free(pWVar2->reldirs);
					}
					pWVar2 = WAD_Get(index);
					if (pWVar2->absdirs != NULL) {
						iVar9 = 0;
						pWVar2 = WAD_Get(index);
						if (0 < (int)pWVar2->count) {
							do {
								pWVar2 = WAD_Get(index);
								if (pWVar2->absdirs[iVar9] != NULL) {
									pWVar2 = WAD_Get(index);
									std::free(pWVar2->absdirs[iVar9]);
								}
								iVar9 += 1;
								pWVar2 = WAD_Get(index);
							} while (iVar9 < (int)pWVar2->count);
						}
						pWVar2 = WAD_Get(index);
						std::free(pWVar2->absdirs);
					}
					std::fclose(file);
					return -1;
				}
				pFVar17 = file;
				pWVar2 = WAD_Get(index);
				uVar3 = pWVar2->count << 4;
				uVar16 = 1;
				pWVar2 = WAD_Get(index);
				uVar3 = std::_fread((byte *)pWVar2->entries,uVar16,uVar3,pFVar17);
				pWVar2 = WAD_Get(index);
				if (uVar3 == pWVar2->count << 4) {
					return index;
				}
				pWVar2 = WAD_Get(index);
				if (pWVar2->absdirs != NULL) {
					iVar9 = 0;
					pWVar2 = WAD_Get(index);
					if (0 < (int)pWVar2->count) {
						do {
							pWVar2 = WAD_Get(index);
							if (pWVar2->reldirs[iVar9] != NULL) {
								pWVar2 = WAD_Get(index);
								std::free(pWVar2->reldirs[iVar9]);
							}
							iVar9 += 1;
							pWVar2 = WAD_Get(index);
						} while (iVar9 < (int)pWVar2->count);
					}
					pWVar2 = WAD_Get(index);
					std::free(pWVar2->reldirs);
				}
				pWVar2 = WAD_Get(index);
				if (pWVar2->absdirs != NULL) {
					iVar9 = 0;
					pWVar2 = WAD_Get(index);
					if (0 < (int)pWVar2->count) {
						do {
							pWVar2 = WAD_Get(index);
							if (pWVar2->absdirs[iVar9] != NULL) {
								pWVar2 = WAD_Get(index);
								std::free(pWVar2->absdirs[iVar9]);
							}
							iVar9 += 1;
							pWVar2 = WAD_Get(index);
						} while (iVar9 < (int)pWVar2->count);
					}
					pWVar2 = WAD_Get(index);
					std::free(pWVar2->absdirs);
				}
				pWVar2 = WAD_Get(index);
				if (pWVar2->entries != NULL) {
					pWVar2 = WAD_Get(index);
					std::free(pWVar2->entries);
				}
LAB_0048be6d:
				std::fclose(file);
				return -1;
			}
			std::fclose(file);
			pWVar2 = WAD_Get(index);
			if (pWVar2->reldirs != NULL) {
				pWVar2 = WAD_Get(index);
				std::free(pWVar2->reldirs);
			}
			pWVar2 = WAD_Get(index);
			if (pWVar2->absdirs != NULL) {
				pWVar2 = WAD_Get(index);
				std::free(pWVar2->absdirs);
			}
		}
	}
	return -1;
}



WADFile * __cdecl lego::file::WAD_Get(int index)
{
	return globals::g_WADFILES_TABLE + index;
}



uint __cdecl lego::file::WAD_GetEntrySize(int wadIndex,int entryIndex)
{
	WADFile *pWVar1;
	
	pWVar1 = WAD_Get(wadIndex);
	return pWVar1->entries[entryIndex].origSize;
}



uint __cdecl lego::file::WAD_GetEntryPackedSize(int wadIndex,int entryIndex)
{
	WADFile *pWVar1;
	
	pWVar1 = WAD_Get(wadIndex);
	return pWVar1->entries[entryIndex].packedSize;
}



int __cdecl lego::file::WAD_Shared__Next(void)
{
	int iVar1;
	int *piVar2;
	
	iVar1 = 0;
	piVar2 = &globals::g_SHARED_WADENTRIES_TABLE[0].isUsed;
	do {
		if (*piVar2 == 0) {
			return iVar1;
		}
		piVar2 = piVar2 + 4;
		iVar1 += 1;
	} while ((int)piVar2 < 0x576ce4);
	return -1;
}



int __cdecl lego::file::WAD_FindEntry(char *filename,int opt_wadIndex)
{
	WADFile *pWVar1;
	int iVar2;
	int iVar3;
	
	if (opt_wadIndex != -1) {
		iVar3 = WAD_FindEntry__InWAD(filename,opt_wadIndex);
		return iVar3;
	}
	iVar3 = 9;
	while ((pWVar1 = WAD_Get(iVar3), pWVar1->isUsed == 0 ||
				 (iVar2 = WAD_FindEntry__InWAD(filename,iVar3), iVar2 == -1))) {
		iVar3 += -1;
		if (iVar3 < 0) {
			return -1;
		}
	}
	return iVar2;
}



int __cdecl lego::file::WAD_FindEntry__InWAD(char *filename,int wadIndex)
{
	int iVar1;
	int iVar2;
	
	iVar2 = 0;
	if ((int)globals::g_WADFILES_TABLE[wadIndex].count < 1) {
		return -1;
	}
	do {
		iVar1 = std::_stricmp(globals::g_WADFILES_TABLE[wadIndex].reldirs[iVar2],filename);
		if (iVar1 == 0) {
			return iVar2;
		}
		iVar2 += 1;
	} while (iVar2 < (int)globals::g_WADFILES_TABLE[wadIndex].count);
	return -1;
}



int __cdecl lego::file::WAD__Next(void)
{
	int *piVar1;
	int iVar2;
	int iVar3;
	WADFile *pWVar4;
	
	iVar3 = 0;
	piVar1 = &globals::g_WADFILES_TABLE[0].isUsed;
	do {
		if (*piVar1 == 0) {
			pWVar4 = globals::g_WADFILES_TABLE + iVar3;
			for (iVar2 = 9; iVar2 != 0; iVar2 += -1) {
				pWVar4->field_0 = 0;
				pWVar4 = (WADFile *)&pWVar4->isUsed;
			}
			return iVar3;
		}
		piVar1 = piVar1 + 9;
		iVar3 += 1;
	} while ((int)piVar1 < 0x57666c);
	return -1;
}



int __cdecl lego::file::WAD_SharedOpen__InWAD(char *filename,int in_wadIndex)
{
	int wadIndex;
	int iVar1;
	int entryIndex;
	uint uVar2;
	byte *out_buffer;
	WADFile *pWVar3;
	uint count;
	int origin;
	FILE *file;
	
	iVar1 = WAD_Shared__Next();
	wadIndex = in_wadIndex;
	if (iVar1 == -1) {
		return -1;
	}
	entryIndex = WAD_FindEntry(filename,in_wadIndex);
	if (entryIndex == -1) {
		return -1;
	}
	uVar2 = WAD_GetEntryPackedSize(wadIndex,entryIndex);
	out_buffer = (byte *)std::malloc(uVar2);
	if (out_buffer == NULL) {
		return -1;
	}
	origin = 0;
	pWVar3 = WAD_Get(wadIndex);
	uVar2 = pWVar3->entries[entryIndex].offset;
	pWVar3 = WAD_Get(wadIndex);
	std::fseek(pWVar3->file,uVar2,origin);
	pWVar3 = WAD_Get(wadIndex);
	file = pWVar3->file;
	count = 1;
	uVar2 = WAD_GetEntryPackedSize(wadIndex,entryIndex);
	uVar2 = std::_fread(out_buffer,uVar2,count,file);
	if (uVar2 != 1) {
		std::free(out_buffer);
		return -1;
	}
	pWVar3 = WAD_Get(wadIndex);
	in_wadIndex = (int)out_buffer;
	if ((pWVar3->entries[entryIndex].flags & WADENTRY_RNC_COMPRESSION) != WADENTRY_NONE) {
		in_wadIndex = 0;
		rnc::Rnc_Decompress(out_buffer,(byte **)&in_wadIndex);
		std::free(out_buffer);
	}
	globals::g_SHARED_WADENTRIES_TABLE[iVar1].fileData = (void *)in_wadIndex;
	globals::g_SHARED_WADENTRIES_TABLE[iVar1].isUsed = 1;
	globals::g_SHARED_WADENTRIES_TABLE[iVar1].wadIndex = wadIndex;
	globals::g_SHARED_WADENTRIES_TABLE[iVar1].entryIndex = entryIndex;
	return iVar1;
}



int __cdecl lego::file::WAD_SharedOpen(char *filename,int opt_wadIndex)
{
	WADFile *pWVar1;
	int iVar2;
	int iVar3;
	
	if (opt_wadIndex != -1) {
		iVar3 = WAD_SharedOpen__InWAD(filename,opt_wadIndex);
		return iVar3;
	}
	iVar3 = 9;
	while ((pWVar1 = WAD_Get(iVar3), pWVar1->isUsed == 0 ||
				 (iVar2 = WAD_SharedOpen__InWAD(filename,iVar3), iVar2 == -1))) {
		iVar3 += -1;
		if (iVar3 < 0) {
			return -1;
		}
	}
	return iVar2;
}



void __cdecl lego::file::WAD_Shared__Dispose(int sharedIndex)
{
	if (globals::g_SHARED_WADENTRIES_TABLE[sharedIndex].isUsed != 0) {
		std::free(globals::g_SHARED_WADENTRIES_TABLE[sharedIndex].fileData);
		globals::g_SHARED_WADENTRIES_TABLE[sharedIndex].isUsed = 0;
	}
	return;
}



void * __cdecl lego::file::WAD_SharedGetData__internal(int sharedIndex)
{
	if (globals::g_SHARED_WADENTRIES_TABLE[sharedIndex].isUsed != 0) {
		return globals::g_SHARED_WADENTRIES_TABLE[sharedIndex].fileData;
	}
	return NULL;
}



uint __cdecl lego::file::WAD_SharedGetSize(int sharedIndex)
{
	uint uVar1;
	
	uVar1 = WAD_GetEntrySize(globals::g_SHARED_WADENTRIES_TABLE[sharedIndex].wadIndex,
													 globals::g_SHARED_WADENTRIES_TABLE[sharedIndex].entryIndex);
	return uVar1;
}



byte * __cdecl lego::file::WAD_SharedGetData(int sharedIndex)
{
	byte *pbVar1;
	
	pbVar1 = (byte *)WAD_SharedGetData__internal(sharedIndex);
	return pbVar1;
}



char * __cdecl FUN_0048c300(char *param_1,char *param_2,uint *param_3,size_t *param_4)
{
	char cVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	size_t _MaxCount;
	char *pcVar5;
	
	uVar3 = 0xffffffff;
	pcVar5 = param_1;
	do {
		if (uVar3 == 0) break;
		uVar3 -= 1;
		cVar1 = *pcVar5;
		pcVar5 = pcVar5 + 1;
	} while (cVar1 != '\0');
	uVar3 = ~uVar3;
	uVar4 = 0xffffffff;
	pcVar5 = param_2;
	do {
		if (uVar4 == 0) break;
		uVar4 -= 1;
		cVar1 = *pcVar5;
		pcVar5 = pcVar5 + 1;
	} while (cVar1 != '\0');
	_MaxCount = ~uVar4 - 1;
	if (((uVar3 != 1) && (_MaxCount != 0)) && (uVar4 = 0, uVar3 != 1)) {
		do {
			iVar2 = std::_strnicmp(param_1,param_2,_MaxCount);
			if (iVar2 == 0) {
				if (param_3 != NULL) {
					*param_3 = uVar4;
				}
				if (param_4 != NULL) {
					*param_4 = _MaxCount;
				}
				return param_1;
			}
			uVar4 += 1;
			param_1 = param_1 + 1;
		} while (uVar4 < uVar3 - 1);
		return NULL;
	}
	return NULL;
}



undefined4 * __cdecl FUN_0048c380(char *param_1)
{
	char cVar1;
	undefined4 *puVar2;
	uint uVar3;
	uint uVar4;
	undefined4 *puVar5;
	char *pcVar6;
	undefined4 *puVar7;
	
	uVar3 = 0xffffffff;
	pcVar6 = param_1;
	do {
		if (uVar3 == 0) break;
		uVar3 -= 1;
		cVar1 = *pcVar6;
		pcVar6 = pcVar6 + 1;
	} while (cVar1 != '\0');
	uVar4 = ~uVar3 + (~uVar3 & 1);
	puVar2 = (undefined4 *)std::malloc(uVar4);
	puVar5 = puVar2;
	for (uVar3 = uVar4 >> 2; uVar3 != 0; uVar3 -= 1) {
		*puVar5 = 0;
		puVar5 = puVar5 + 1;
	}
	for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
		*(undefined *)puVar5 = 0;
		puVar5 = (undefined4 *)((int)puVar5 + 1);
	}
	uVar3 = 0xffffffff;
	do {
		pcVar6 = param_1;
		if (uVar3 == 0) break;
		uVar3 -= 1;
		pcVar6 = param_1 + 1;
		cVar1 = *param_1;
		param_1 = pcVar6;
	} while (cVar1 != '\0');
	uVar3 = ~uVar3;
	puVar5 = (undefined4 *)(pcVar6 + -uVar3);
	puVar7 = puVar2;
	for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
		*puVar7 = *puVar5;
		puVar5 = puVar5 + 1;
		puVar7 = puVar7 + 1;
	}
	for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
		*(undefined *)puVar7 = *(undefined *)puVar5;
		puVar5 = (undefined4 *)((int)puVar5 + 1);
		puVar7 = (undefined4 *)((int)puVar7 + 1);
	}
	return puVar2;
}



uint __cdecl FUN_0048c3e0(char *param_1)
{
	char cVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	char **ppcVar5;
	char *pcVar6;
	char *local_c [3];
	
	local_c[0] = "PLANAR";
	local_c[1] = "CYLINDRICAL";
	local_c[2] = "SPHERICAL";
	uVar4 = 0;
	ppcVar5 = local_c;
	do {
		uVar3 = 0xffffffff;
		pcVar6 = *ppcVar5;
		do {
			if (uVar3 == 0) break;
			uVar3 -= 1;
			cVar1 = *pcVar6;
			pcVar6 = pcVar6 + 1;
		} while (cVar1 != '\0');
		iVar2 = std::_strnicmp(param_1,*ppcVar5,~uVar3 - 1);
		if (iVar2 == 0) break;
		uVar4 += 1;
		ppcVar5 = ppcVar5 + 1;
	} while (uVar4 < 3);
	if (uVar4 == 3) {
		uVar4 = 0;
	}
	return uVar4;
}



void __cdecl FUN_0048c440(undefined4 *param_1,int param_2)
{
	if ((void *)*param_1 != NULL) {
		std::free((void *)*param_1);
	}
	if ((void *)param_1[2] != NULL) {
		std::free((void *)param_1[2]);
	}
	if ((undefined4 *)param_1[1] != NULL) {
		FUN_0048c440((undefined4 *)param_1[1],1);
	}
	if (param_2 != 0) {
		std::free(param_1);
	}
	return;
}



undefined4 __cdecl FUN_0048c490(int *param_1,undefined *param_2)
{
	int iVar1;
	
	param_2[3] = *(undefined *)*param_1;
	iVar1 = *param_1;
	*param_1 = (int)(undefined *)(iVar1 + 1);
	param_2[2] = *(undefined *)(iVar1 + 1);
	iVar1 = *param_1;
	*param_1 = (int)(undefined *)(iVar1 + 1);
	param_2[1] = *(undefined *)(iVar1 + 1);
	iVar1 = *param_1;
	*param_1 = (int)(undefined *)(iVar1 + 1);
	*param_2 = *(undefined *)(iVar1 + 1);
	*param_1 = *param_1 + 1;
	return 1;
}



// WARNING: Could not reconcile some variable overlaps

undefined4 __cdecl
FUN_0048c4d0(undefined4 *param_1,int *param_2,uint param_3,uint **param_4,int param_5)
{
	float *pfVar1;
	int iVar2;
	float local_120;
	float fStack284;
	undefined uStack280;
	undefined local_117;
	undefined2 uStack278;
	byte *local_114;
	byte *local_110;
	uint local_10c;
	char local_108 [260];
	
	iVar2 = 0;
	local_120 = (float)(uint)local_120._0_1_;
	fStack284 = 0.0;
	uStack280 = 0;
	local_117 = 0;
	local_114 = (byte *)std::malloc(param_3 + 0x10);
	local_110 = local_114;
	lego::file::File_Read(local_114,param_3,1,(FileStream *)param_1);
	*param_2 = (int)param_3 / 0xc;
	if (param_4 != NULL) {
		pfVar1 = (float *)std::malloc(param_3 + 4);
		*param_4 = (uint *)pfVar1;
		if (0 < (int)param_3) {
			local_10c = (param_3 + 0xb) / 0xc;
			do {
				FUN_0048c490((int *)&local_114,(undefined *)&local_120);
				FUN_0048c490((int *)&local_114,(undefined *)&fStack284);
				FUN_0048c490((int *)&local_114,&uStack280);
				*pfVar1 = local_120;
				pfVar1[1] = fStack284;
				pfVar1[2] = (float)CONCAT22(uStack278,CONCAT11(local_117,uStack280));
				pfVar1 = pfVar1 + 3;
				if (param_5 != 0) {
					std::sprintf(local_108,"Point %d > %f %f %f\n",iVar2,(double)local_120,(double)fStack284);
				}
				iVar2 += 1;
				local_10c -= 1;
			} while (local_10c != 0);
		}
	}
	std::free(local_110);
	return 1;
}



undefined4 __cdecl FUN_0048c620(undefined4 *param_1,uint param_2)
{
	ushort uVar1;
	ushort *out_buffer;
	uint uVar2;
	ushort *puVar3;
	int iVar4;
	
	out_buffer = (ushort *)std::malloc(param_2 + 0x10);
	lego::file::File_Read((byte *)out_buffer,param_2,1,(FileStream *)param_1);
	puVar3 = out_buffer;
	if (0 < (int)param_2) {
		do {
			uVar1 = *puVar3 * 0x100 + (*puVar3 >> 8);
			puVar3 = puVar3 + 1;
			iVar4 = param_2 - 2;
			if (uVar1 != 0) {
				uVar2 = (uint)uVar1;
				puVar3 = puVar3 + uVar2;
				do {
					iVar4 += -2;
					uVar2 -= 1;
				} while (uVar2 != 0);
			}
			param_2 = iVar4 - 4;
			puVar3 = puVar3 + 2;
		} while (0 < (int)param_2);
	}
	std::free(out_buffer);
	return 1;
}



undefined4 __cdecl
FUN_0048c6a0(undefined4 *param_1,int param_2,uint **param_3,uint param_4,int param_5)
{
	char cVar1;
	ushort *out_buffer;
	uint *puVar2;
	ushort *puVar3;
	uint uVar4;
	int iVar5;
	uint uVar6;
	ushort uVar7;
	ushort uVar8;
	uint *puVar9;
	undefined4 *puVar10;
	uint *puVar11;
	char *pcVar12;
	char *pcVar13;
	char *pcVar14;
	undefined4 *puVar15;
	ushort *local_150;
	uint local_14c;
	char local_140 [64];
	char local_100 [256];
	
	out_buffer = (ushort *)std::malloc(param_4 + 0x10);
	lego::file::File_Read((byte *)out_buffer,param_4,1,(FileStream *)param_1);
	uVar8 = 0;
	local_150 = out_buffer;
	uVar7 = 0;
	if (0 < (int)param_4) {
		do {
			uVar7 = *local_150 * 0x100 + (*local_150 >> 8);
			local_150 = local_150 + 1;
			param_4 -= 2;
			if (param_3 != NULL) {
				if (uVar8 == 0) {
					puVar2 = (uint *)std::malloc(0xc);
					*param_3 = puVar2;
				}
				else {
					uVar4 = (uint)uVar8;
					puVar2 = (uint *)std::malloc((uVar4 + 1) * 0xc);
					puVar9 = *param_3;
					puVar11 = puVar2;
					for (iVar5 = uVar4 * 3; iVar5 != 0; iVar5 += -1) {
						*puVar11 = *puVar9;
						puVar9 = puVar9 + 1;
						puVar11 = puVar11 + 1;
					}
					for (iVar5 = 0; iVar5 != 0; iVar5 += -1) {
						*(undefined *)puVar11 = *(undefined *)puVar9;
						puVar9 = (uint *)((int)puVar9 + 1);
						puVar11 = (uint *)((int)puVar11 + 1);
					}
					std::free(*param_3);
					*param_3 = puVar2;
					puVar2 = puVar2 + uVar4 * 3;
				}
				local_14c = (uint)uVar7;
				puVar3 = (ushort *)std::malloc(local_14c * 2);
				if (param_5 != 0) {
					std::sprintf(local_100,"Poly %d, Vertex Count %d > ",(uint)uVar8,local_14c);
				}
				*puVar2 = local_14c;
				puVar2[2] = (uint)puVar3;
				if (uVar7 != 0) {
					do {
						uVar7 = *local_150 * 0x100 + (*local_150 >> 8);
						if (param_5 != 0) {
							std::sprintf(local_140,"%d ",(uint)uVar7);
							uVar4 = 0xffffffff;
							pcVar13 = local_140;
							do {
								pcVar12 = pcVar13;
								if (uVar4 == 0) break;
								uVar4 -= 1;
								pcVar12 = pcVar13 + 1;
								cVar1 = *pcVar13;
								pcVar13 = pcVar12;
							} while (cVar1 != '\0');
							uVar4 = ~uVar4;
							iVar5 = -1;
							pcVar13 = local_100;
							do {
								pcVar14 = pcVar13;
								if (iVar5 == 0) break;
								iVar5 += -1;
								pcVar14 = pcVar13 + 1;
								cVar1 = *pcVar13;
								pcVar13 = pcVar14;
							} while (cVar1 != '\0');
							puVar10 = (undefined4 *)(pcVar12 + -uVar4);
							puVar15 = (undefined4 *)(pcVar14 + -1);
							for (uVar6 = uVar4 >> 2; uVar6 != 0; uVar6 -= 1) {
								*puVar15 = *puVar10;
								puVar10 = puVar10 + 1;
								puVar15 = puVar15 + 1;
							}
							for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
								*(undefined *)puVar15 = *(undefined *)puVar10;
								puVar10 = (undefined4 *)((int)puVar10 + 1);
								puVar15 = (undefined4 *)((int)puVar15 + 1);
							}
						}
						*puVar3 = uVar7;
						puVar3 = puVar3 + 1;
						local_150 = local_150 + 1;
						param_4 -= 2;
						local_14c -= 1;
					} while (local_14c != 0);
				}
				uVar4 = (uint)(byte)*local_150 * 0x100 + -1 + (uint)(*local_150 >> 8) & 0xffff;
				puVar2[1] = uVar4;
				if (param_5 != 0) {
					std::sprintf(local_140,"Surface :- %d\n",uVar4);
					uVar4 = 0xffffffff;
					pcVar13 = local_140;
					do {
						pcVar12 = pcVar13;
						if (uVar4 == 0) break;
						uVar4 -= 1;
						pcVar12 = pcVar13 + 1;
						cVar1 = *pcVar13;
						pcVar13 = pcVar12;
					} while (cVar1 != '\0');
					uVar4 = ~uVar4;
					iVar5 = -1;
					pcVar13 = local_100;
					do {
						pcVar14 = pcVar13;
						if (iVar5 == 0) break;
						iVar5 += -1;
						pcVar14 = pcVar13 + 1;
						cVar1 = *pcVar13;
						pcVar13 = pcVar14;
					} while (cVar1 != '\0');
					puVar10 = (undefined4 *)(pcVar12 + -uVar4);
					puVar15 = (undefined4 *)(pcVar14 + -1);
					for (uVar6 = uVar4 >> 2; uVar6 != 0; uVar6 -= 1) {
						*puVar15 = *puVar10;
						puVar10 = puVar10 + 1;
						puVar15 = puVar15 + 1;
					}
					for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
						*(undefined *)puVar15 = *(undefined *)puVar10;
						puVar10 = (undefined4 *)((int)puVar10 + 1);
						puVar15 = (undefined4 *)((int)puVar15 + 1);
					}
				}
			}
			param_4 -= 2;
			uVar8 += 1;
			local_150 = local_150 + 1;
			uVar7 = uVar8;
		} while (0 < (int)param_4);
	}
	*(uint *)(param_2 + 4) = (uint)uVar7;
	std::free(out_buffer);
	return 1;
}



undefined4 __cdecl
FUN_0048c950(undefined4 *param_1,undefined4 param_2,int **param_3,uint param_4,int *param_5,
						int param_6)
{
	char cVar1;
	undefined4 *out_buffer;
	undefined4 *puVar2;
	undefined4 *puVar3;
	uint uVar4;
	uint uVar5;
	int iVar6;
	uint uVar7;
	undefined4 *puVar8;
	undefined4 *puVar9;
	undefined4 *puVar10;
	int local_224;
	int *local_220;
	char local_200 [512];
	
	uVar7 = 0;
	local_224 = 0;
	out_buffer = (undefined4 *)std::malloc(param_4 + 0x10);
	lego::file::File_Read((byte *)out_buffer,param_4,1,(FileStream *)param_1);
	if (param_3 != NULL) {
		local_220 = (int *)std::malloc(8);
		*local_220 = 0;
		local_220[1] = 0;
	}
	puVar9 = out_buffer;
	if (0 < (int)param_4) {
		do {
			if (param_6 != 0) {
				std::sprintf(local_200,"Surface %d > %s\n",local_224,puVar9);
			}
			uVar4 = 0xffffffff;
			puVar8 = puVar9;
			do {
				if (uVar4 == 0) break;
				uVar4 -= 1;
				cVar1 = *(char *)puVar8;
				puVar8 = (undefined4 *)((int)puVar8 + 1);
			} while (cVar1 != '\0');
			uVar4 = ~uVar4;
			if ((uVar4 & 1) != 0) {
				uVar4 += 1;
			}
			if (param_3 != NULL) {
				puVar2 = (undefined4 *)std::malloc(uVar4);
				puVar3 = (undefined4 *)std::malloc(uVar7 + 4);
				puVar8 = puVar9;
				puVar10 = puVar2;
				for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
					*puVar10 = *puVar8;
					puVar8 = puVar8 + 1;
					puVar10 = puVar10 + 1;
				}
				for (uVar5 = uVar4 & 3; uVar5 != 0; uVar5 -= 1) {
					*(undefined *)puVar10 = *(undefined *)puVar8;
					puVar8 = (undefined4 *)((int)puVar8 + 1);
					puVar10 = (undefined4 *)((int)puVar10 + 1);
				}
				if (uVar7 != 0) {
					puVar8 = (undefined4 *)local_220[1];
					puVar10 = puVar3;
					for (uVar5 = uVar7 >> 2; uVar5 != 0; uVar5 -= 1) {
						*puVar10 = *puVar8;
						puVar8 = puVar8 + 1;
						puVar10 = puVar10 + 1;
					}
					for (iVar6 = 0; iVar6 != 0; iVar6 += -1) {
						*(undefined *)puVar10 = *(undefined *)puVar8;
						puVar8 = (undefined4 *)((int)puVar8 + 1);
						puVar10 = (undefined4 *)((int)puVar10 + 1);
					}
					std::free((void *)local_220[1]);
				}
				*(undefined4 **)((int)puVar3 + uVar7) = puVar2;
				local_220[1] = (int)puVar3;
				*param_3 = local_220;
				*local_220 = local_224 + 1;
			}
			local_224 += 1;
			uVar7 += 4;
			*param_5 = local_224;
			puVar9 = (undefined4 *)((int)puVar9 + uVar4);
			param_4 -= uVar4;
		} while (0 < (int)param_4);
	}
	std::free(out_buffer);
	return 1;
}



// WARNING: Could not reconcile some variable overlaps

undefined4 __cdecl
FUN_0048cae0(undefined4 *param_1,int param_2,undefined4 *param_3,uint param_4,int param_5)
{
	byte bVar1;
	char cVar2;
	float fVar3;
	byte *pbVar4;
	undefined4 *puVar5;
	undefined4 *puVar6;
	int iVar7;
	char *pcVar8;
	int iVar9;
	uint uVar10;
	uint uVar11;
	uint uVar12;
	char **ppcVar13;
	char **ppcVar14;
	int iVar15;
	byte *pbVar16;
	char **ppcVar17;
	char *pcVar18;
	char *pcVar19;
	undefined4 *puVar20;
	char **local_50c;
	undefined4 *local_508;
	uint local_504;
	char local_500;
	undefined4 local_4ff;
	undefined4 local_4fb;
	undefined local_4f7;
	char **local_4f4;
	int local_4f0;
	byte *local_4ec;
	undefined4 local_4e8;
	undefined4 local_4e4;
	undefined4 local_4e0;
	undefined4 local_4dc;
	undefined4 local_4d8;
	undefined4 local_4d4;
	uint local_4d0;
	int local_4cc;
	char *local_4c8 [4];
	char *local_4b8;
	char *local_4b4;
	char *local_4b0;
	char *local_4ac [4];
	char *local_49c;
	char *local_498;
	char *local_494;
	char *local_490;
	char *local_48c;
	char *local_488;
	size_t local_484;
	char local_480 [511];
	undefined uStack641;
	char *local_280 [32];
	char local_200 [512];
	
	local_4ff = 0;
	local_4fb = 0;
	local_500 = '\0';
	local_4f7 = 0;
	pbVar4 = (byte *)std::malloc(param_4 + 0x10);
	local_4ec = pbVar4;
	lego::file::File_Read(pbVar4,param_4,1,(FileStream *)param_1);
	uVar10 = *(uint *)(param_2 + 8);
	puVar5 = local_508;
	local_504 = uVar10;
	if (param_3 != NULL) {
		if (uVar10 == 0) {
			puVar5 = (undefined4 *)std::malloc(0x54);
			*param_3 = puVar5;
			puVar6 = puVar5;
			for (iVar9 = 0x15; iVar9 != 0; iVar9 += -1) {
				*puVar6 = 0;
				puVar6 = puVar6 + 1;
			}
			local_508 = puVar5;
			puVar6 = FUN_0048c380((char *)pbVar4);
			*puVar5 = puVar6;
		}
		else {
			puVar5 = (undefined4 *)std::malloc((uVar10 + 1) * 0x54);
			puVar6 = (undefined4 *)*param_3;
			puVar20 = puVar5;
			for (uVar11 = uVar10 * 0x15 & 0x3fffffff; uVar11 != 0; uVar11 -= 1) {
				*puVar20 = *puVar6;
				puVar6 = puVar6 + 1;
				puVar20 = puVar20 + 1;
			}
			for (iVar9 = 0; iVar9 != 0; iVar9 += -1) {
				*(undefined *)puVar20 = *(undefined *)puVar6;
				puVar6 = (undefined4 *)((int)puVar6 + 1);
				puVar20 = (undefined4 *)((int)puVar20 + 1);
			}
			std::free((void *)*param_3);
			*param_3 = puVar5;
			puVar5 = puVar5 + uVar10 * 0x15;
			puVar6 = puVar5;
			for (iVar9 = 0x15; iVar9 != 0; iVar9 += -1) {
				*puVar6 = 0;
				puVar6 = puVar6 + 1;
			}
			local_508 = puVar5;
			puVar6 = FUN_0048c380((char *)local_4ec);
			*puVar5 = puVar6;
			pbVar4 = local_4ec;
		}
	}
	if (param_5 != 0) {
		std::sprintf(local_200,"Surface %d :- %s");
	}
	uVar10 = 0xffffffff;
	pbVar16 = pbVar4;
	do {
		if (uVar10 == 0) break;
		uVar10 -= 1;
		bVar1 = *pbVar16;
		pbVar16 = pbVar16 + 1;
	} while (bVar1 != 0);
	uVar10 = ~uVar10;
	if ((uVar10 & 1) != 0) {
		uVar10 += 1;
	}
	iVar9 = param_4 - uVar10;
	pbVar4 = pbVar4 + uVar10;
	do {
		if (iVar9 < 1) {
			*(int *)(param_2 + 8) = *(int *)(param_2 + 8) + 1;
			std::free(local_4ec);
			return 1;
		}
		std::_strncpy(&local_500,(char *)pbVar4,4);
		local_4cc = (*(ushort *)(pbVar4 + 4) & 0xff) * 0x100 + (uint)(*(ushort *)(pbVar4 + 4) >> 8);
		std::sprintf(local_200," %s (%d)");
		ppcVar13 = (char **)(pbVar4 + 6);
		iVar7 = std::_strnicmp(&local_500,"TIMG",4);
		if (iVar7 == 0) {
			uVar10 = 0xffffffff;
			ppcVar14 = ppcVar13;
			do {
				ppcVar17 = ppcVar14;
				if (uVar10 == 0) break;
				uVar10 -= 1;
				ppcVar17 = (char **)((int)ppcVar14 + 1);
				cVar2 = *(char *)ppcVar14;
				ppcVar14 = ppcVar17;
			} while (cVar2 != '\0');
			uVar10 = ~uVar10;
			iVar7 = -1;
			pcVar8 = local_200;
			do {
				pcVar18 = pcVar8;
				if (iVar7 == 0) break;
				iVar7 += -1;
				pcVar18 = pcVar8 + 1;
				cVar2 = *pcVar8;
				pcVar8 = pcVar18;
			} while (cVar2 != '\0');
			ppcVar14 = (char **)((int)ppcVar17 - uVar10);
			ppcVar17 = (char **)(pcVar18 + -1);
			for (uVar11 = uVar10 >> 2; uVar11 != 0; uVar11 -= 1) {
				*ppcVar17 = *ppcVar14;
				ppcVar14 = ppcVar14 + 1;
				ppcVar17 = ppcVar17 + 1;
			}
			for (uVar10 &= 3; uVar10 != 0; uVar10 -= 1) {
				*(undefined *)ppcVar17 = *(undefined *)ppcVar14;
				ppcVar14 = (char **)((int)ppcVar14 + 1);
				ppcVar17 = (char **)((int)ppcVar17 + 1);
			}
			if (param_3 != NULL) {
				uVar10 = 0xffffffff;
				ppcVar14 = ppcVar13;
				do {
					ppcVar17 = ppcVar14;
					if (uVar10 == 0) break;
					uVar10 -= 1;
					ppcVar17 = (char **)((int)ppcVar14 + 1);
					cVar2 = *(char *)ppcVar14;
					ppcVar14 = ppcVar17;
				} while (cVar2 != '\0');
				uVar10 = ~uVar10;
				ppcVar14 = (char **)((int)ppcVar17 - uVar10);
				ppcVar17 = local_280;
				for (uVar11 = uVar10 >> 2; uVar11 != 0; uVar11 -= 1) {
					*ppcVar17 = *ppcVar14;
					ppcVar14 = ppcVar14 + 1;
					ppcVar17 = ppcVar17 + 1;
				}
				for (uVar10 &= 3; uVar10 != 0; uVar10 -= 1) {
					*(undefined *)ppcVar17 = *(undefined *)ppcVar14;
					ppcVar14 = (char **)((int)ppcVar14 + 1);
					ppcVar17 = (char **)((int)ppcVar17 + 1);
				}
				pcVar8 = FUN_0048c300((char *)local_280,"(sequence)",&local_4d0,&local_484);
				if (pcVar8 != NULL) {
					uVar10 = puVar5[5];
					*(undefined *)((int)local_280 + (local_4d0 - 1)) = 0;
					puVar5[5] = uVar10 | 0x80;
				}
				puVar6 = FUN_0048c380((char *)local_280);
				puVar5[2] = puVar6;
			}
		}
		else {
			iVar7 = std::_strnicmp(&local_500,"COLR",4);
			if (iVar7 == 0) {
				std::sprintf(local_480," RGBA %d,%d,%d,%d");
				uVar10 = 0xffffffff;
				pcVar8 = local_480;
				do {
					pcVar18 = pcVar8;
					if (uVar10 == 0) break;
					uVar10 -= 1;
					pcVar18 = pcVar8 + 1;
					cVar2 = *pcVar8;
					pcVar8 = pcVar18;
				} while (cVar2 != '\0');
				uVar10 = ~uVar10;
				iVar7 = -1;
				pcVar8 = local_200;
				do {
					pcVar19 = pcVar8;
					if (iVar7 == 0) break;
					iVar7 += -1;
					pcVar19 = pcVar8 + 1;
					cVar2 = *pcVar8;
					pcVar8 = pcVar19;
				} while (cVar2 != '\0');
				puVar6 = (undefined4 *)(pcVar18 + -uVar10);
				puVar20 = (undefined4 *)(pcVar19 + -1);
				for (uVar11 = uVar10 >> 2; uVar11 != 0; uVar11 -= 1) {
					*puVar20 = *puVar6;
					puVar6 = puVar6 + 1;
					puVar20 = puVar20 + 1;
				}
				for (uVar10 &= 3; uVar10 != 0; uVar10 -= 1) {
					*(undefined *)puVar20 = *(undefined *)puVar6;
					puVar6 = (undefined4 *)((int)puVar6 + 1);
					puVar20 = (undefined4 *)((int)puVar20 + 1);
				}
				if (param_3 != NULL) {
					*(undefined *)(puVar5 + 3) = *(undefined *)ppcVar13;
					*(byte *)((int)puVar5 + 0xd) = pbVar4[7];
					*(byte *)((int)puVar5 + 0xe) = pbVar4[8];
					*(byte *)((int)puVar5 + 0xf) = pbVar4[9];
				}
			}
			else {
				iVar7 = std::_strnicmp(&local_500,"CTEX",4);
				if (iVar7 == 0) {
					uVar10 = 0xffffffff;
					ppcVar14 = ppcVar13;
					do {
						ppcVar17 = ppcVar14;
						if (uVar10 == 0) break;
						uVar10 -= 1;
						ppcVar17 = (char **)((int)ppcVar14 + 1);
						cVar2 = *(char *)ppcVar14;
						ppcVar14 = ppcVar17;
					} while (cVar2 != '\0');
					uVar10 = ~uVar10;
					iVar7 = -1;
					pcVar8 = local_200;
					do {
						pcVar18 = pcVar8;
						if (iVar7 == 0) break;
						iVar7 += -1;
						pcVar18 = pcVar8 + 1;
						cVar2 = *pcVar8;
						pcVar8 = pcVar18;
					} while (cVar2 != '\0');
					ppcVar14 = (char **)((int)ppcVar17 - uVar10);
					ppcVar17 = (char **)(pcVar18 + -1);
					for (uVar11 = uVar10 >> 2; uVar11 != 0; uVar11 -= 1) {
						*ppcVar17 = *ppcVar14;
						ppcVar14 = ppcVar14 + 1;
						ppcVar17 = ppcVar17 + 1;
					}
					for (uVar10 &= 3; uVar10 != 0; uVar10 -= 1) {
						*(undefined *)ppcVar17 = *(undefined *)ppcVar14;
						ppcVar14 = (char **)((int)ppcVar14 + 1);
						ppcVar17 = (char **)((int)ppcVar17 + 1);
					}
					if (param_3 != NULL) {
						uVar10 = FUN_0048c3e0((char *)ppcVar13);
						puVar5[7] = uVar10;
					}
				}
				else {
					iVar7 = std::_strnicmp(&local_500,"TTEX",4);
					if (iVar7 == 0) {
						uVar10 = 0xffffffff;
						ppcVar14 = ppcVar13;
						do {
							ppcVar17 = ppcVar14;
							if (uVar10 == 0) break;
							uVar10 -= 1;
							ppcVar17 = (char **)((int)ppcVar14 + 1);
							cVar2 = *(char *)ppcVar14;
							ppcVar14 = ppcVar17;
						} while (cVar2 != '\0');
						uVar10 = ~uVar10;
						iVar7 = -1;
						pcVar8 = local_200;
						do {
							pcVar18 = pcVar8;
							if (iVar7 == 0) break;
							iVar7 += -1;
							pcVar18 = pcVar8 + 1;
							cVar2 = *pcVar8;
							pcVar8 = pcVar18;
						} while (cVar2 != '\0');
						ppcVar14 = (char **)((int)ppcVar17 - uVar10);
						ppcVar17 = (char **)(pcVar18 + -1);
						for (uVar11 = uVar10 >> 2; uVar11 != 0; uVar11 -= 1) {
							*ppcVar17 = *ppcVar14;
							ppcVar14 = ppcVar14 + 1;
							ppcVar17 = ppcVar17 + 1;
						}
						for (uVar10 &= 3; uVar10 != 0; uVar10 -= 1) {
							*(undefined *)ppcVar17 = *(undefined *)ppcVar14;
							ppcVar14 = (char **)((int)ppcVar14 + 1);
							ppcVar17 = (char **)((int)ppcVar17 + 1);
						}
						if (param_3 != NULL) {
							puVar6 = (undefined4 *)std::malloc(0x54);
							puVar5[1] = puVar6;
							puVar5 = puVar6;
							for (iVar7 = 0x15; iVar7 != 0; iVar7 += -1) {
								*puVar5 = 0;
								puVar5 = puVar5 + 1;
							}
							local_508 = puVar6;
							uVar10 = FUN_0048c3e0((char *)ppcVar13);
							puVar6[7] = uVar10;
							puVar5 = puVar6;
						}
					}
					else {
						iVar7 = std::_strnicmp(&local_500,"TFLG",4);
						if (iVar7 == 0) {
							local_4f4 = NULL;
							if (param_3 != NULL) {
								uVar10 = (uint)(*(ushort *)ppcVar13 >> 8) + (*(ushort *)ppcVar13 & 0xff) * 0x100 &
												 0xffff;
								local_4c8[0] = "Axis_x";
								local_508[5] = local_508[5] | uVar10;
								local_4c8[1] = "Axis_y";
								local_4c8[2] = "Axis_z";
								local_4c8[3] = "World Coord";
								local_4b8 = "Negative Image";
								local_4b4 = "Pixel Blending";
								local_4b0 = "Anti Aliasing";
								std::sprintf(local_480,"%xH - ");
								local_50c = local_4c8;
								local_4f0 = 0;
								local_504 = 8;
								do {
									if ((uVar10 & 1 << ((byte)local_4f0 & 0x1f)) != 0) {
										if ((short)local_4f4 != 0) {
											uVar11 = 0xffffffff;
											pcVar8 = ",";
											do {
												pcVar18 = pcVar8;
												if (uVar11 == 0) break;
												uVar11 -= 1;
												pcVar18 = pcVar8 + 1;
												cVar2 = *pcVar8;
												pcVar8 = pcVar18;
											} while (cVar2 != '\0');
											uVar11 = ~uVar11;
											iVar7 = -1;
											pcVar8 = local_480;
											do {
												pcVar19 = pcVar8;
												if (iVar7 == 0) break;
												iVar7 += -1;
												pcVar19 = pcVar8 + 1;
												cVar2 = *pcVar8;
												pcVar8 = pcVar19;
											} while (cVar2 != '\0');
											puVar5 = (undefined4 *)(pcVar18 + -uVar11);
											puVar6 = (undefined4 *)(pcVar19 + -1);
											for (uVar12 = uVar11 >> 2; uVar12 != 0; uVar12 -= 1) {
												*puVar6 = *puVar5;
												puVar5 = puVar5 + 1;
												puVar6 = puVar6 + 1;
											}
											for (uVar11 &= 3; uVar11 != 0; uVar11 -= 1) {
												*(undefined *)puVar6 = *(undefined *)puVar5;
												puVar5 = (undefined4 *)((int)puVar5 + 1);
												puVar6 = (undefined4 *)((int)puVar6 + 1);
											}
										}
										local_4f4 = (char **)((int)local_4f4 + 1);
										uVar11 = 0xffffffff;
										pcVar8 = *local_50c;
										do {
											pcVar18 = pcVar8;
											if (uVar11 == 0) break;
											uVar11 -= 1;
											pcVar18 = pcVar8 + 1;
											cVar2 = *pcVar8;
											pcVar8 = pcVar18;
										} while (cVar2 != '\0');
										uVar11 = ~uVar11;
										iVar7 = -1;
										pcVar8 = local_480;
										do {
											pcVar19 = pcVar8;
											if (iVar7 == 0) break;
											iVar7 += -1;
											pcVar19 = pcVar8 + 1;
											cVar2 = *pcVar8;
											pcVar8 = pcVar19;
										} while (cVar2 != '\0');
										puVar5 = (undefined4 *)(pcVar18 + -uVar11);
										puVar6 = (undefined4 *)(pcVar19 + -1);
										for (uVar12 = uVar11 >> 2; uVar12 != 0; uVar12 -= 1) {
											*puVar6 = *puVar5;
											puVar5 = puVar5 + 1;
											puVar6 = puVar6 + 1;
										}
										for (uVar11 &= 3; uVar11 != 0; uVar11 -= 1) {
											*(undefined *)puVar6 = *(undefined *)puVar5;
											puVar5 = (undefined4 *)((int)puVar5 + 1);
											puVar6 = (undefined4 *)((int)puVar6 + 1);
										}
									}
									local_4f0 += 1;
									local_50c = local_50c + 1;
									local_504 -= 1;
								} while (local_504 != 0);
LAB_0048d1d2:
								uVar10 = 0xffffffff;
								pcVar8 = local_480;
								do {
									pcVar18 = pcVar8;
									if (uVar10 == 0) break;
									uVar10 -= 1;
									pcVar18 = pcVar8 + 1;
									cVar2 = *pcVar8;
									pcVar8 = pcVar18;
								} while (cVar2 != '\0');
								uVar10 = ~uVar10;
								iVar7 = -1;
								pcVar8 = local_200;
								do {
									pcVar19 = pcVar8;
									if (iVar7 == 0) break;
									iVar7 += -1;
									pcVar19 = pcVar8 + 1;
									cVar2 = *pcVar8;
									pcVar8 = pcVar19;
								} while (cVar2 != '\0');
								puVar6 = (undefined4 *)(pcVar18 + -uVar10);
								puVar20 = (undefined4 *)(pcVar19 + -1);
								for (uVar11 = uVar10 >> 2; uVar11 != 0; uVar11 -= 1) {
									*puVar20 = *puVar6;
									puVar6 = puVar6 + 1;
									puVar20 = puVar20 + 1;
								}
								for (uVar10 &= 3; puVar5 = local_508, uVar10 != 0; uVar10 -= 1) {
									*(undefined *)puVar20 = *(undefined *)puVar6;
									puVar6 = (undefined4 *)((int)puVar6 + 1);
									puVar20 = (undefined4 *)((int)puVar20 + 1);
								}
							}
						}
						else {
							iVar7 = std::_strnicmp(&local_500,"FLAG",4);
							if (iVar7 == 0) {
								local_50c = NULL;
								if (param_3 != NULL) {
									local_4ac[0] = "Luminous";
									uVar10 = (uint)(*(ushort *)ppcVar13 >> 8) + (*(ushort *)ppcVar13 & 0xff) * 0x100 &
													 0xffff;
									local_4ac[1] = "Outline";
									local_4ac[2] = "Smoothing";
									local_4ac[3] = "Color Highlights";
									local_49c = "Color Filter";
									local_498 = "Opaque Edge";
									local_494 = "Transparent Edge";
									local_490 = "Sharp Terminator";
									local_48c = "Double Sided";
									local_488 = "Additive";
									local_508[6] = uVar10;
									std::sprintf(local_480,"%xH - ");
									local_4f4 = local_4ac;
									local_504 = 0;
									local_4f0 = 10;
									do {
										if ((uVar10 & 1 << ((byte)local_504 & 0x1f)) != 0) {
											if ((short)local_50c != 0) {
												uVar11 = 0xffffffff;
												pcVar8 = ",";
												do {
													pcVar18 = pcVar8;
													if (uVar11 == 0) break;
													uVar11 -= 1;
													pcVar18 = pcVar8 + 1;
													cVar2 = *pcVar8;
													pcVar8 = pcVar18;
												} while (cVar2 != '\0');
												uVar11 = ~uVar11;
												iVar7 = -1;
												pcVar8 = local_480;
												do {
													pcVar19 = pcVar8;
													if (iVar7 == 0) break;
													iVar7 += -1;
													pcVar19 = pcVar8 + 1;
													cVar2 = *pcVar8;
													pcVar8 = pcVar19;
												} while (cVar2 != '\0');
												puVar5 = (undefined4 *)(pcVar18 + -uVar11);
												puVar6 = (undefined4 *)(pcVar19 + -1);
												for (uVar12 = uVar11 >> 2; uVar12 != 0; uVar12 -= 1) {
													*puVar6 = *puVar5;
													puVar5 = puVar5 + 1;
													puVar6 = puVar6 + 1;
												}
												for (uVar11 &= 3; uVar11 != 0; uVar11 -= 1) {
													*(undefined *)puVar6 = *(undefined *)puVar5;
													puVar5 = (undefined4 *)((int)puVar5 + 1);
													puVar6 = (undefined4 *)((int)puVar6 + 1);
												}
											}
											local_50c = (char **)((int)local_50c + 1);
											uVar11 = 0xffffffff;
											pcVar8 = *local_4f4;
											do {
												pcVar18 = pcVar8;
												if (uVar11 == 0) break;
												uVar11 -= 1;
												pcVar18 = pcVar8 + 1;
												cVar2 = *pcVar8;
												pcVar8 = pcVar18;
											} while (cVar2 != '\0');
											uVar11 = ~uVar11;
											iVar7 = -1;
											pcVar8 = local_480;
											do {
												pcVar19 = pcVar8;
												if (iVar7 == 0) break;
												iVar7 += -1;
												pcVar19 = pcVar8 + 1;
												cVar2 = *pcVar8;
												pcVar8 = pcVar19;
											} while (cVar2 != '\0');
											puVar5 = (undefined4 *)(pcVar18 + -uVar11);
											puVar6 = (undefined4 *)(pcVar19 + -1);
											for (uVar12 = uVar11 >> 2; uVar12 != 0; uVar12 -= 1) {
												*puVar6 = *puVar5;
												puVar5 = puVar5 + 1;
												puVar6 = puVar6 + 1;
											}
											for (uVar11 &= 3; uVar11 != 0; uVar11 -= 1) {
												*(undefined *)puVar6 = *(undefined *)puVar5;
												puVar5 = (undefined4 *)((int)puVar5 + 1);
												puVar6 = (undefined4 *)((int)puVar6 + 1);
											}
										}
										local_504 += 1;
										local_4f4 = local_4f4 + 1;
										local_4f0 += -1;
									} while (local_4f0 != 0);
									goto LAB_0048d1d2;
								}
							}
							else {
								iVar7 = std::_strnicmp(&local_500,"TSIZ",4);
								if (iVar7 == 0) {
									if (param_3 != NULL) {
										local_50c = ppcVar13;
										FUN_0048c490((int *)&local_50c,(undefined *)&local_4dc);
										FUN_0048c490((int *)&local_50c,(undefined *)&local_4d8);
										FUN_0048c490((int *)&local_50c,(undefined *)&local_4d4);
										std::sprintf(local_480," (%f,%f,%f)");
										puVar5[9] = local_4dc;
										puVar5[10] = local_4d8;
										puVar5[0xb] = local_4d4;
LAB_0048d369:
										uVar10 = 0xffffffff;
										pcVar8 = local_480;
										do {
											pcVar18 = pcVar8;
											if (uVar10 == 0) break;
											uVar10 -= 1;
											pcVar18 = pcVar8 + 1;
											cVar2 = *pcVar8;
											pcVar8 = pcVar18;
										} while (cVar2 != '\0');
										uVar10 = ~uVar10;
										iVar7 = -1;
										pcVar8 = local_200;
										do {
											pcVar19 = pcVar8;
											if (iVar7 == 0) break;
											iVar7 += -1;
											pcVar19 = pcVar8 + 1;
											cVar2 = *pcVar8;
											pcVar8 = pcVar19;
										} while (cVar2 != '\0');
										puVar6 = (undefined4 *)(pcVar18 + -uVar10);
										puVar20 = (undefined4 *)(pcVar19 + -1);
										for (uVar11 = uVar10 >> 2; uVar11 != 0; uVar11 -= 1) {
											*puVar20 = *puVar6;
											puVar6 = puVar6 + 1;
											puVar20 = puVar20 + 1;
										}
										for (uVar10 &= 3; uVar10 != 0; uVar10 -= 1) {
											*(undefined *)puVar20 = *(undefined *)puVar6;
											puVar6 = (undefined4 *)((int)puVar6 + 1);
											puVar20 = (undefined4 *)((int)puVar20 + 1);
										}
									}
								}
								else {
									iVar7 = std::_strnicmp(&local_500,"TCTR",4);
									if ((iVar7 == 0) && (param_3 != NULL)) {
										local_50c = ppcVar13;
										FUN_0048c490((int *)&local_50c,(undefined *)&local_4e8);
										FUN_0048c490((int *)&local_50c,(undefined *)&local_4e4);
										FUN_0048c490((int *)&local_50c,(undefined *)&local_4e0);
										std::sprintf(local_480," (%f,%f,%f)");
										puVar5[0xc] = local_4e8;
										puVar5[0xd] = local_4e4;
										puVar5[0xe] = local_4e0;
										goto LAB_0048d369;
									}
								}
							}
						}
					}
				}
			}
		}
		iVar15 = 0;
		iVar7 = std::_strnicmp(&local_500,"TRAN",4);
		if (iVar7 == 0) {
			iVar15 = 1;
		}
		else {
			iVar7 = std::_strnicmp(&local_500,"DIFF",4);
			if (iVar7 == 0) {
				iVar15 = 2;
			}
			else {
				iVar7 = std::_strnicmp(&local_500,"LUMI",4);
				if (iVar7 == 0) {
					iVar15 = 3;
				}
				else {
					iVar7 = std::_strnicmp(&local_500,"REFL",4);
					if (iVar7 == 0) {
						iVar15 = 4;
					}
					else {
						iVar7 = std::_strnicmp(&local_500,"SPEC",4);
						if (iVar7 == 0) {
							iVar15 = 5;
						}
						else {
							iVar7 = std::_strnicmp(&local_500,"GLOS",4);
							if (iVar7 == 0) {
								iVar15 = 6;
							}
						}
					}
				}
			}
		}
		if ((iVar15 != 0) && (param_3 != NULL)) {
			local_504 = (uint)(*(ushort *)ppcVar13 >> 8) + (*(ushort *)ppcVar13 & 0xff) * 0x100 & 0xffff;
			fVar3 = (float)local_504 * 0.00390625;
			switch(iVar15) {
			case 1:
				puVar5[0x10] = fVar3;
				break;
			case 2:
				puVar5[0x11] = fVar3;
				break;
			case 3:
				puVar5[0xf] = fVar3;
				break;
			case 4:
				puVar5[0x12] = fVar3;
				break;
			case 5:
				puVar5[0x13] = fVar3;
				break;
			case 6:
				puVar5[0x14] = fVar3;
			}
			std::sprintf(local_480,"%f");
			uVar10 = 0xffffffff;
			pcVar8 = local_480;
			do {
				pcVar18 = pcVar8;
				if (uVar10 == 0) break;
				uVar10 -= 1;
				pcVar18 = pcVar8 + 1;
				cVar2 = *pcVar8;
				pcVar8 = pcVar18;
			} while (cVar2 != '\0');
			uVar10 = ~uVar10;
			iVar7 = -1;
			pcVar8 = local_200;
			do {
				pcVar19 = pcVar8;
				if (iVar7 == 0) break;
				iVar7 += -1;
				pcVar19 = pcVar8 + 1;
				cVar2 = *pcVar8;
				pcVar8 = pcVar19;
			} while (cVar2 != '\0');
			puVar6 = (undefined4 *)(pcVar18 + -uVar10);
			puVar20 = (undefined4 *)(pcVar19 + -1);
			for (uVar11 = uVar10 >> 2; uVar11 != 0; uVar11 -= 1) {
				*puVar20 = *puVar6;
				puVar6 = puVar6 + 1;
				puVar20 = puVar20 + 1;
			}
			for (uVar10 &= 3; uVar10 != 0; uVar10 -= 1) {
				*(undefined *)puVar20 = *(undefined *)puVar6;
				puVar6 = (undefined4 *)((int)puVar6 + 1);
				puVar20 = (undefined4 *)((int)puVar20 + 1);
			}
		}
		pbVar4 = (byte *)((int)ppcVar13 + local_4cc);
		iVar9 += -6 - local_4cc;
	} while( true );
}



undefined4 __cdecl
FUN_0048d580(undefined4 param_1,int *param_2,uint **param_3,uint **param_4,int *param_5,
						undefined4 *param_6,int param_7)
{
	FileStream *file;
	int *buffer;
	BOOL BVar1;
	FileStream *pFVar2;
	int iVar3;
	int iVar4;
	undefined4 *puVar5;
	uint uVar6;
	undefined *puVar7;
	undefined4 *puVar8;
	uint local_534;
	uint local_530;
	int *local_52c;
	uint local_528;
	byte local_524;
	undefined4 local_523;
	undefined4 local_51f;
	undefined local_51b;
	uint local_518;
	uint local_514;
	char *local_510;
	FileStream *local_50c;
	int *local_508;
	undefined4 *local_504;
	char local_500 [256];
	char local_400 [1024];
	
	local_523 = 0;
	local_51f = 0;
	local_524 = 0;
	local_51b = 0;
	local_530 = 0;
	std::sprintf(local_500,"%s.lwo",param_1);
	file = lego::file::File_Open(local_500,"rb");
	if (file == NULL) {
		return 0;
	}
	local_50c = file;
	buffer = (int *)std::malloc(0xc);
	buffer[2] = 0;
	buffer[1] = 0;
	*buffer = 0;
	local_508 = buffer;
	if (param_6 != NULL) {
		std::sprintf(local_500,"%s.uv",param_1);
		BVar1 = lego::file::File_Exist(local_500);
		if (BVar1 == 0) {
			*param_6 = 0;
		}
		else {
			pFVar2 = lego::file::File_Open(local_500,"rb");
			*param_6 = pFVar2;
		}
	}
	lego::file::File_Read(&local_524,4,1,file);
	iVar3 = std::_stricmp((char *)&local_524,"FORM");
	if (iVar3 == 0) {
		lego::file::File_Read((byte *)&local_518,4,1,file);
		local_518 = ((local_518 & 0xff00) + (local_518 & 0xff) * 0x10000) * 0x100 +
								(local_518 >> 0x10 & 0xff) * 0x100 + (local_518 >> 0x18);
		lego::file::File_Read(&local_524,4,1,file);
		iVar3 = std::_stricmp((char *)&local_524,"LWOB");
		if (iVar3 == 0) {
			for (iVar3 = local_518 - 4; 0 < iVar3; iVar3 += -8 - local_534) {
				lego::file::File_Read(&local_524,4,1,file);
				lego::file::File_Read((byte *)&local_534,4,1,file);
				local_534 = ((local_534 & 0xff00) + (local_534 & 0xff) * 0x10000) * 0x100 +
										(local_534 >> 0x10 & 0xff) * 0x100 + (local_534 >> 0x18);
				if (param_7 != 0) {
					std::sprintf(local_400,"LW OBJECT %s %d\n",&local_524,local_534);
				}
				iVar4 = std::_stricmp((char *)&local_524,"PNTS");
				if (iVar4 == 0) {
					FUN_0048c4d0((undefined4 *)file,buffer,local_534,param_3,param_7);
				}
				else {
					iVar4 = std::_stricmp((char *)&local_524,"SRFS");
					if (iVar4 == 0) {
						FUN_0048c950((undefined4 *)file,buffer,&local_52c,local_534,(int *)&local_530,param_7);
					}
					else {
						iVar4 = std::_stricmp((char *)&local_524,"SURF");
						if (iVar4 == 0) {
							FUN_0048cae0((undefined4 *)file,(int)buffer,param_5,local_534,param_7);
						}
						else {
							iVar4 = std::_stricmp((char *)&local_524,"CRVS");
							if (iVar4 == 0) {
								FUN_0048c620((undefined4 *)file,local_534);
							}
							else {
								iVar4 = std::_stricmp((char *)&local_524,"POLS");
								if (iVar4 == 0) {
									FUN_0048c6a0((undefined4 *)file,(int)buffer,param_4,local_534,param_7);
								}
								else {
									lego::file::File_Seek(file,local_534,1);
								}
							}
						}
					}
				}
			}
			local_528 = buffer[2];
			if (((param_5 != NULL) && (local_52c != NULL)) && (buffer != NULL)) {
				local_504 = (undefined4 *)std::malloc(local_530 * 0x54);
				puVar5 = local_504;
				for (uVar6 = local_530 * 0x15 & 0x3fffffff; uVar6 != 0; uVar6 -= 1) {
					*puVar5 = 0;
					puVar5 = puVar5 + 1;
				}
				for (iVar3 = 0; iVar3 != 0; iVar3 += -1) {
					*(undefined *)puVar5 = 0;
					puVar5 = (undefined4 *)((int)puVar5 + 1);
				}
				local_514 = 0;
				if (local_530 != 0) {
					puVar7 = (undefined *)((int)local_504 + 0xd);
					do {
						uVar6 = 0;
						local_510 = *(char **)(local_52c[1] + local_514 * 4);
						if (local_528 != 0) {
							iVar3 = 0;
LAB_0048d940:
							iVar4 = std::_stricmp(*(char **)(*param_5 + iVar3),local_510);
							if (iVar4 != 0) goto code_r0x0048d95e;
							puVar5 = (undefined4 *)(*param_5 + uVar6 * 0x54);
							puVar8 = (undefined4 *)(puVar7 + -0xd);
							for (iVar3 = 0x15; file = local_50c, iVar3 != 0; iVar3 += -1) {
								*puVar8 = *puVar5;
								puVar5 = puVar5 + 1;
								puVar8 = puVar8 + 1;
							}
						}
LAB_0048d990:
						if (uVar6 == local_528) {
							puVar5 = FUN_0048c380("Default");
							*(undefined4 **)(puVar7 + -0xd) = puVar5;
							puVar7[-1] = 0xff;
							*puVar7 = 0xff;
							puVar7[1] = 0xff;
							local_528 = local_530;
						}
						puVar7 = puVar7 + 0x54;
						local_514 += 1;
						buffer = local_508;
					} while (local_514 < local_530);
				}
				puVar5 = local_504;
				std::free((void *)*param_5);
				*param_5 = (int)puVar5;
			}
			buffer[2] = local_528;
			if (param_2 != NULL) {
				*param_2 = *buffer;
				param_2[1] = buffer[1];
				param_2[2] = buffer[2];
			}
			std::free(buffer);
			if (local_530 != 0) {
				uVar6 = 0;
				if (local_530 != 0) {
					do {
						std::free(*(void **)(local_52c[1] + uVar6 * 4));
						uVar6 += 1;
					} while (uVar6 < local_530);
				}
				std::free((void *)local_52c[1]);
				std::free(local_52c);
			}
			lego::file::File_Close(file);
			return 1;
		}
	}
	std::free(buffer);
	lego::file::File_Close(file);
	std::sprintf(local_400,"Error in Lightwave file %s",param_1);
	return 0;
code_r0x0048d95e:
	uVar6 += 1;
	iVar3 += 0x54;
	if (local_528 <= uVar6) goto LAB_0048d990;
	goto LAB_0048d940;
}



BOOL __cdecl lego::res::Res_Unk_CreateMeshStruct20(char *filename,int *out_struct20,int param_3)
{
	undefined4 *puVar1;
	int iVar2;
	undefined4 local_80 [32];
	
	puVar1 = (undefined4 *)std::malloc(0x20);
	*out_struct20 = (int)puVar1;
	for (iVar2 = 8; iVar2 != 0; iVar2 += -1) {
		*puVar1 = 0;
		puVar1 = puVar1 + 1;
	}
	FUN_00490350(filename,NULL,local_80,NULL,NULL);
	puVar1 = FUN_0048c380((char *)local_80);
	*(undefined4 **)*out_struct20 = puVar1;
	iVar2 = *out_struct20;
	iVar2 = FUN_0048d580(filename,(int *)(iVar2 + 4),(uint **)(iVar2 + 0x10),(uint **)(iVar2 + 0x14),
											 (int *)(iVar2 + 0x18),(undefined4 *)(iVar2 + 0x1c),param_3);
	if (iVar2 != 0) {
		return 1;
	}
	std::free(*(void **)*out_struct20);
	std::free((void *)*out_struct20);
	return 0;
}



undefined4 __cdecl FUN_0048db30(undefined4 *param_1)
{
	int iVar1;
	undefined4 *puVar2;
	int iVar3;
	
	if (param_1 != NULL) {
		if ((FileStream *)param_1[7] != NULL) {
			lego::file::File_Close((FileStream *)param_1[7]);
		}
		puVar2 = (undefined4 *)param_1[6];
		if (puVar2 != NULL) {
			for (iVar1 = param_1[3]; iVar1 != 0; iVar1 += -1) {
				FUN_0048c440(puVar2,0);
				puVar2 = puVar2 + 0x15;
			}
			std::free((void *)param_1[6]);
		}
		if (param_1[5] != 0) {
			iVar1 = param_1[2];
			if (iVar1 != 0) {
				iVar3 = 0;
				do {
					std::free(*(void **)(param_1[5] + 8 + iVar3));
					iVar3 += 0xc;
					iVar1 += -1;
				} while (iVar1 != 0);
			}
			std::free((void *)param_1[5]);
		}
		std::free((void *)param_1[4]);
		std::free((void *)*param_1);
		std::free(param_1);
		return 1;
	}
	return 0;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address
// Library Function - Single Match
// Name: __fpmath
// Library: Visual Studio 1998 Release

void __cdecl __fpmath(int param_1)
{
	FUN_0048dc00();
	_DAT_0054a0cc = FUN_00490540();
	__setdefaultprecision();
	return;
}



void FUN_0048dc00(void)
{
	PTR_FUN_004b0f80 = &LAB_00490a10;
	PTR_FUN_004b0f84 = FUN_004905d0;
	PTR_FUN_004b0f88 = FUN_00490660;
	PTR_FUN_004b0f8c = FUN_00490570;
	PTR_FUN_004b0f90 = FUN_00490640;
	PTR_FUN_004b0f94 = &LAB_00490a10;
	return;
}



float10 __cdecl std::atof(char *text)
{
	byte bVar1;
	uint uVar2;
	undefined *puVar3;
	int iVar4;
	byte *pbVar5;
	
	while( true ) {
		if (globals::g_CharWidth_1__004b0f74 < 2) {
			uVar2 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + (uint)(byte)*text * 2) & 8;
		}
		else {
			uVar2 = _unk_FUN_0048f490((uint)(byte)*text,8);
		}
		if (uVar2 == 0) break;
		text = (char *)((byte *)text + 1);
	}
	iVar4 = -1;
	pbVar5 = (byte *)text;
	do {
		if (iVar4 == 0) break;
		iVar4 += -1;
		bVar1 = *pbVar5;
		pbVar5 = pbVar5 + 1;
	} while (bVar1 != 0);
	puVar3 = FUN_00490ab0((byte *)text);
	return (float10)*(double *)(puVar3 + 0x10);
}



int __cdecl std::sprintf(char *out_buffer,char *format,...)
{
	int iVar1;
	char *local_20;
	int local_1c;
	char *local_18;
	undefined4 local_14;
	
	local_18 = out_buffer;
	local_20 = out_buffer;
	local_14 = 0x42;
	local_1c = 0x7fffffff;
	iVar1 = _sprintf_internal_2__00490c90(&local_20,format,&stack0x0000000c);
	local_1c += -1;
	if (-1 < local_1c) {
		*local_20 = '\0';
		return iVar1;
	}
	FUN_00490b60(0,&local_20);
	return iVar1;
}



char * __cdecl std::strstr(char *str,char *strSearch)
{
	char *pcVar1;
	char *pcVar2;
	char cVar3;
	uint uVar4;
	char cVar5;
	uint uVar6;
	char *pcVar7;
	uint uVar8;
	uint *puVar9;
	char *pcVar10;
	
	cVar3 = *strSearch;
	if (cVar3 == '\0') {
		return (char *)(uint *)str;
	}
	if (strSearch[1] == '\0') {
		uVar4 = (uint)str & 3;
		while (uVar4 != 0) {
			if (*str == cVar3) {
				return (char *)(uint *)str;
			}
			if (*str == '\0') {
				return (char *)NULL;
			}
			uVar4 = (uint)(uint *)((int)str + 1) & 3;
			str = (char *)(uint *)((int)str + 1);
		}
		while( true ) {
			while( true ) {
				uVar4 = *(uint *)str;
				uVar8 = uVar4 ^ CONCAT22(CONCAT11(cVar3,cVar3),CONCAT11(cVar3,cVar3));
				uVar6 = uVar4 ^ 0xffffffff ^ uVar4 + 0x7efefeff;
				puVar9 = (uint *)((int)str + 4);
				if (((uVar8 ^ 0xffffffff ^ uVar8 + 0x7efefeff) & 0x81010100) != 0) break;
				str = (char *)puVar9;
				if ((uVar6 & 0x81010100) != 0) {
					if ((uVar6 & 0x1010100) != 0) {
						return (char *)NULL;
					}
					if ((uVar4 + 0x7efefeff & 0x80000000) == 0) {
						return (char *)NULL;
					}
				}
			}
			uVar4 = *(uint *)str;
			if ((char)uVar4 == cVar3) {
				return (char *)(uint *)str;
			}
			if ((char)uVar4 == '\0') {
				return (char *)NULL;
			}
			cVar5 = (char)(uVar4 >> 8);
			if (cVar5 == cVar3) {
				return (char *)(uint *)((int)str + 1);
			}
			if (cVar5 == '\0') break;
			cVar5 = (char)(uVar4 >> 0x10);
			if (cVar5 == cVar3) {
				return (char *)(uint *)((int)str + 2);
			}
			if (cVar5 == '\0') {
				return (char *)NULL;
			}
			cVar5 = (char)(uVar4 >> 0x18);
			if (cVar5 == cVar3) {
				return (char *)(uint *)((int)str + 3);
			}
			str = (char *)puVar9;
			if (cVar5 == '\0') {
				return (char *)NULL;
			}
		}
		return (char *)NULL;
	}
	do {
		cVar5 = *str;
		do {
			while (str = str + 1, cVar5 != cVar3) {
				if (cVar5 == '\0') {
					return (char *)NULL;
				}
				cVar5 = *str;
			}
			cVar5 = *str;
			pcVar10 = str + 1;
			pcVar7 = strSearch;
		} while (cVar5 != strSearch[1]);
		do {
			if (pcVar7[2] == '\0') {
LAB_0048dd83:
				return (char *)(uint *)(str + -1);
			}
			if (*pcVar10 != pcVar7[2]) break;
			pcVar1 = pcVar7 + 3;
			if (*pcVar1 == '\0') goto LAB_0048dd83;
			pcVar2 = pcVar10 + 1;
			pcVar7 = pcVar7 + 2;
			pcVar10 = pcVar10 + 2;
		} while (*pcVar1 == *pcVar2);
	} while( true );
}



int __cdecl std::__atoi_internal(byte *text)
{
	byte bVar1;
	uint uVar2;
	uint uVar3;
	uint c;
	int iVar4;
	byte *pbVar5;
	
	while( true ) {
		if (globals::g_CharWidth_1__004b0f74 < 2) {
			uVar2 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + (uint)*text * 2) & 8;
		}
		else {
			uVar2 = _unk_FUN_0048f490((uint)*text,8);
		}
		if (uVar2 == 0) break;
		text = text + 1;
	}
	uVar2 = (uint)*text;
	pbVar5 = text + 1;
	if ((uVar2 == '-') || (c = uVar2, uVar2 == '+')) {
		c = (uint)*pbVar5;
		pbVar5 = text + 2;
	}
	iVar4 = 0;
	while( true ) {
		if (globals::g_CharWidth_1__004b0f74 < 2) {
			uVar3 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + c * 2) & 4;
		}
		else {
			uVar3 = _unk_FUN_0048f490(c,4);
		}
		if (uVar3 == 0) break;
		bVar1 = *pbVar5;
		pbVar5 = pbVar5 + 1;
		iVar4 = (c - 0x30) + iVar4 * 10;
		c = (uint)bVar1;
	}
	if (uVar2 == '-') {
		iVar4 = -iVar4;
	}
	return iVar4;
}



int __cdecl std::atoi(char *text)
{
	int iVar1;
	
	iVar1 = __atoi_internal((byte *)text);
	return iVar1;
}



void __cdecl std::free(void *buffer)
{
	void *lpMem;
	byte *pbVar1;
	int *local_4;
	
	lpMem = buffer;
	if (buffer != NULL) {
		pbVar1 = (byte *)FUN_00491b00((undefined *)buffer,&local_4,(uint *)&buffer);
		if (pbVar1 != NULL) {
			FUN_00491b60((int)local_4,(int)buffer,pbVar1);
			return;
		}
		HeapFree(DAT_0076eec4,0,lpMem);
	}
	return;
}



void * __cdecl std::malloc(uint length)
{
	void *buffer;
	
	buffer = __malloc_internal(length,DAT_0054a154);
	return buffer;
}



void * __cdecl std::__malloc_internal(uint length,BOOL retry)
{
	void *pvVar1;
	BOOL BVar2;
	
	if (length < 0xffffffe1) {
		if (length == 0) {
			length = 1;
		}
		do {
			if (length < 0xffffffe1) {
				pvVar1 = FUN_0048df00(length);
			}
			else {
				pvVar1 = NULL;
			}
			if (pvVar1 != NULL) {
				return pvVar1;
			}
			if (retry == 0) {
				return NULL;
			}
			BVar2 = FUN_00492050(length);
		} while (BVar2 != 0);
	}
	return NULL;
}



void * __cdecl FUN_0048df00(uint length)
{
	int *piVar1;
	uint dwBytes;
	
	dwBytes = length + 0xf & 0xfffffff0;
	if ((dwBytes <= UINT_004b2fdc) &&
		 (piVar1 = FUN_00491bc0((int *)(length + 0xf >> 4)), piVar1 != NULL)) {
		return piVar1;
	}
	piVar1 = (int *)HeapAlloc(DAT_0076eec4,0,dwBytes);
	return piVar1;
}



int * __cdecl FUN_0048df40(LwoFrame *param_1,uint param_2)
{
	LwoFrame *pLVar1;
	int **ppiVar2;
	int iVar3;
	BOOL BVar4;
	uint uVar5;
	uint uVar6;
	LwoFrame *pLVar7;
	LwoFrame *pLVar8;
	int **local_8;
	int *local_4;
	
	if (param_1 == NULL) {
		pLVar1 = (LwoFrame *)std::malloc(param_2);
		return (int *)pLVar1;
	}
	if (param_2 == 0) {
		std::free(param_1);
		return (int *)NULL;
	}
	if (param_2 < 0xffffffe1) {
		if (param_2 == 0) {
			param_2 = 0x10;
		}
		else {
			param_2 = param_2 + 0xf & 0xfffffff0;
		}
	}
	do {
		pLVar1 = NULL;
		if (param_2 < 0xffffffe1) {
			ppiVar2 = (int **)FUN_00491b00((undefined *)param_1,&local_4,(uint *)&local_8);
			if (ppiVar2 == NULL) {
				pLVar1 = (LwoFrame *)HeapReAlloc(DAT_0076eec4,0,param_1,param_2);
				goto LAB_0048e0aa;
			}
			if (param_2 < UINT_004b2fdc) {
				iVar3 = FUN_00491f80((int)local_4,local_8,ppiVar2,(uint)(int *)(param_2 >> 4));
				pLVar1 = param_1;
				if (iVar3 != 0) goto LAB_0048e03f;
				pLVar1 = (LwoFrame *)FUN_00491bc0((int *)(param_2 >> 4));
				if (pLVar1 != NULL) {
					uVar6 = (uint)*(byte *)ppiVar2 << 4;
					if (param_2 <= (uint)*(byte *)ppiVar2 << 4) {
						uVar6 = param_2;
					}
					pLVar7 = param_1;
					pLVar8 = pLVar1;
					for (uVar5 = uVar6 >> 2; uVar5 != 0; uVar5 -= 1) {
						pLVar8->dwSize = pLVar7->dwSize;
						pLVar7 = (LwoFrame *)&pLVar7->field_0x4;
						pLVar8 = (LwoFrame *)&pLVar8->field_0x4;
					}
					for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
						*(undefined *)&pLVar8->dwSize = *(undefined *)&pLVar7->dwSize;
						pLVar7 = (LwoFrame *)((int)&pLVar7->dwSize + 1);
						pLVar8 = (LwoFrame *)((int)&pLVar8->dwSize + 1);
					}
					FUN_00491b60((int)local_4,(int)local_8,(byte *)ppiVar2);
					goto LAB_0048e03f;
				}
			}
			else {
LAB_0048e03f:
				if (pLVar1 != NULL) {
					return (int *)pLVar1;
				}
			}
			pLVar1 = (LwoFrame *)HeapAlloc(DAT_0076eec4,0,param_2);
			if (pLVar1 != NULL) {
				uVar6 = (uint)*(byte *)ppiVar2 << 4;
				if (param_2 <= (uint)*(byte *)ppiVar2 << 4) {
					uVar6 = param_2;
				}
				pLVar7 = param_1;
				pLVar8 = pLVar1;
				for (uVar5 = uVar6 >> 2; uVar5 != 0; uVar5 -= 1) {
					pLVar8->dwSize = pLVar7->dwSize;
					pLVar7 = (LwoFrame *)&pLVar7->field_0x4;
					pLVar8 = (LwoFrame *)&pLVar8->field_0x4;
				}
				for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
					*(undefined *)&pLVar8->dwSize = *(undefined *)&pLVar7->dwSize;
					pLVar7 = (LwoFrame *)((int)&pLVar7->dwSize + 1);
					pLVar8 = (LwoFrame *)((int)&pLVar8->dwSize + 1);
				}
				FUN_00491b60((int)local_4,(int)local_8,(byte *)ppiVar2);
				goto LAB_0048e0aa;
			}
		}
		else {
LAB_0048e0aa:
			if (pLVar1 != NULL) {
				return (int *)pLVar1;
			}
		}
		if (DAT_0054a154 == 0) {
			return (int *)pLVar1;
		}
		BVar4 = FUN_00492050(param_2);
		if (BVar4 == 0) {
			return NULL;
		}
	} while( true );
}



void __cdecl std::qsort(void *base,uint number,uint width,CompareCallback *compare)
{
	uint uVar1;
	int iVar2;
	byte *a;
	byte *b;
	byte *local_100;
	byte **local_fc;
	byte **local_f8;
	int local_f4;
	byte *local_f0 [30];
	byte *local_78 [30];
	
	if ((number < 2) || (width == 0)) {
		return;
	}
	local_100 = (byte *)((number - 1) * width + (int)base);
	local_fc = local_f0;
	local_f8 = local_78;
	local_f4 = 0;
LAB_0048e134:
	uVar1 = (uint)(local_100 + -(int)base) / width + 1;
	if (8 < uVar1) {
		__memswap((byte *)((int)base + (uVar1 >> 1) * width),(byte *)base,width);
		b = local_100 + width;
		a = (byte *)base;
LAB_0048e1ae:
		a = a + width;
		if (a <= local_100) goto code_r0x0048e1b8;
		goto LAB_0048e1c8;
	}
	internal::__qsort((byte *)base,local_100,width,compare);
	goto LAB_0048e155;
code_r0x0048e1b8:
	iVar2 = (*compare)(a,base);
	if (iVar2 < 1) goto LAB_0048e1ae;
LAB_0048e1c8:
	do {
		b = b + -width;
		if (b <= base) break;
		iVar2 = (*compare)(b,base);
	} while (-1 < iVar2);
	if (a <= b) {
		__memswap(a,b,width);
		goto LAB_0048e1ae;
	}
	__memswap((byte *)base,b,width);
	if ((int)(b + (-1 - (int)base)) < (int)(local_100 + -(int)a)) {
		if (a < local_100) {
			*local_f8 = a;
			*local_fc = local_100;
			local_f4 += 1;
			local_f8 = local_f8 + 1;
			local_fc = local_fc + 1;
		}
		if ((byte *)((int)base + width) < b) {
			local_100 = b + -width;
			goto LAB_0048e134;
		}
	}
	else {
		if ((byte *)((int)base + width) < b) {
			*local_f8 = (byte *)base;
			*local_fc = b + -width;
			local_f4 += 1;
			local_f8 = local_f8 + 1;
			local_fc = local_fc + 1;
		}
		base = a;
		if (a < local_100) goto LAB_0048e134;
	}
LAB_0048e155:
	local_f4 += -1;
	local_f8 = local_f8 + -1;
	local_fc = local_fc + -1;
	if (local_f4 < 0) {
		return;
	}
	local_100 = *local_fc;
	base = *local_f8;
	goto LAB_0048e134;
}



void __cdecl std::internal::__qsort(byte *a,byte *b,uint width,CompareCallback *compare)
{
	int result;
	byte *dest;
	byte *item;
	
	if (a < b) {
		item = a + width;
		dest = a;
		do {
			for (; item <= b; item = item + width) {
				result = (*compare)(item,dest);
				if (0 < result) {
					dest = item;
				}
			}
			__memswap(dest,b,width);
			b = b + -width;
			item = a + width;
			dest = a;
		} while (a < b);
	}
	return;
}



void __cdecl std::__memswap(byte *a,byte *b,uint count)
{
	byte bVar1;
	
	if ((a != b) && (count != 0)) {
		do {
			bVar1 = *a;
			*a = *b;
			a = a + 1;
			*b = bVar1;
			b = b + 1;
			count -= 1;
		} while (count != 0);
	}
	return;
}



// Library Function - Single Match
// Name: __ftol
// Library: Visual Studio

longlong __ftol(float10 param_1)
{
	return (longlong)ROUND(param_1);
}



void FUN_0048e350(void)
{
	float10 in_ST0;
	
	FUN_00492328(SUB84((double)in_ST0,0),(uint)((ulonglong)(double)in_ST0 >> 0x20));
	FUN_0048e36d();
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

float10 __fastcall FUN_0048e36d(undefined4 param_1_00,uint param_2_00,uint param_1,uint param_2)
{
	uint in_EAX;
	bool in_ZF;
	float10 in_ST0;
	float10 extraout_ST0;
	float10 fVar1;
	ushort in_FPUControlWord;
	ushort in_FPUStatusWord;
	uint uVar2;
	
	uVar2 = param_2_00 & 0xffff0000 | (uint)in_FPUControlWord;
	if (in_ZF) {
		if (((in_EAX & 0xfffff) != 0) || (fVar1 = _DAT_004b2fe0, param_1 != 0)) {
			fVar1 = (float10)FUN_004922cc();
		}
LAB_0048e3fc:
		if (_DAT_0054a0c8 == 0) {
			fVar1 = (float10)__startOneArgErrorHandling();
			return fVar1;
		}
	}
	else {
		if (in_FPUControlWord != 0x27f) {
			in_EAX = FUN_004922b5(uVar2);
			in_ST0 = extraout_ST0;
		}
		if (in_EAX < 0x3ff00000) {
			fVar1 = (float10)fpatan(SQRT(((float10)1 - in_ST0) * ((float10)1 + in_ST0)),in_ST0);
		}
		else {
			fVar1 = _DAT_004b2fe0;
			if ((0x3ff00000 < in_EAX) || ((param_2 & 0xfffff | param_1) != 0)) goto LAB_0048e3fc;
			if ((param_2 & 0x80000000) == 0) {
				fVar1 = (float10)0;
			}
			else {
				fVar1 = (float10)3.141592653589793;
			}
		}
		if (_DAT_0054a0c8 == 0) {
			if ((((short)uVar2 != 0x27f) && ((uVar2 & 0x20) != 0)) && ((in_FPUStatusWord & 0x20) != 0)) {
				fVar1 = (float10)__startOneArgErrorHandling();
				return fVar1;
			}
			return fVar1;
		}
	}
	return fVar1;
}



void __cdecl lego::util::randomSeed(uint seed)
{
	globals::g_RAND = seed;
	return;
}



short __cdecl lego::util::randomInt16(void)
{
	globals::g_RAND = globals::g_RAND * 0x343fd + 0x269ec3;
	return (short)((ushort)(globals::g_RAND >> 0x10) & 0x7fff);
}



void FUN_0048e46a(void)
{
	__cintrindisp2();
	return;
}



int __cdecl std::vsprintf(char *param_1,char *param_2,...)
{
	int iVar1;
	char *in_stack_0000000c;
	char *local_20;
	int local_1c;
	char *local_18;
	undefined4 local_14;
	
	local_18 = param_1;
	local_20 = param_1;
	local_14 = 0x42;
	local_1c = 0x7fffffff;
	iVar1 = _sprintf_internal_2__00490c90(&local_20,param_2,in_stack_0000000c);
	local_1c += -1;
	if (-1 < local_1c) {
		*local_20 = '\0';
		return iVar1;
	}
	FUN_00490b60(0,&local_20);
	return iVar1;
}



// WARNING: This is an inlined function
// WARNING: Unable to track spacebase fully for stack

void * std::_alloca4k(uint size)
{
	undefined *puVar1;
	void *unaff_retaddr;
	
	puVar1 = &stack0x00000004;
	if (0xfff < size) {
		do {
			puVar1 = puVar1 + -0x1000;
			size -= 0x1000;
		} while (0xfff < size);
	}
	*(void **)(puVar1 + (-4 - size)) = unaff_retaddr;
	return unaff_retaddr;
}



float10 __cdecl FUN_0048e540(uint param_1,uint param_2)
{
	double dVar1;
	uint uVar2;
	int iVar3;
	float10 fVar4;
	uint local_8;
	undefined4 uStack4;
	
	uVar2 = std::__unk_math__00493ed0(DAT_004b0d20,0xffff);
	if ((param_2._2_2_ & 0x7ff0) != 0x7ff0) {
		fVar4 = FUN_00493410((double)CONCAT44(param_2,param_1));
		dVar1 = (double)fVar4;
		if ((dVar1 != (double)CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1))) &&
			 ((uVar2 & 0x20) == 0)) {
			uStack4 = (undefined4)((ulonglong)dVar1 >> 0x20);
			local_8 = SUB84(dVar1,0);
			fVar4 = FUN_00493480(0x10,0xb,param_1,param_2,local_8,uStack4,uVar2);
			return fVar4;
		}
		std::__unk_math__00493ed0(uVar2,0xffff);
		return (float10)dVar1;
	}
	iVar3 = FUN_00493d40(param_1,param_2);
	if (0 < iVar3) {
		if (iVar3 < 3) {
			std::__unk_math__00493ed0(uVar2,0xffff);
			return (float10)(double)CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1));
		}
		if (iVar3 == 3) {
			fVar4 = std::__unk_math__00493430(0xb,param_1,param_2,uVar2);
			return fVar4;
		}
	}
	dVar1 = (double)CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1)) - -1.0;
	fVar4 = FUN_00493480(8,0xb,param_1,param_2,SUB84(dVar1,0),(int)((ulonglong)dVar1 >> 0x20),uVar2);
	return fVar4;
}



int __cdecl std::toupper(int c)
{
	int iVar1;
	uint uVar2;
	LPCWSTR pWVar3;
	int iVar4;
	uint local_8 [2];
	
	iVar1 = c;
	if (DAT_0054a180 == 0) {
		if ((0x60 < c) && (c < 0x7b)) {
			return c - 0x20;
		}
	}
	else {
		if (c < 0x100) {
			if (globals::g_CharWidth_1__004b0f74 < 2) {
				uVar2 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + c * 2) & 2;
			}
			else {
				uVar2 = _unk_FUN_0048f490(c,2);
			}
			if (uVar2 == 0) {
				return iVar1;
			}
		}
		if ((*(byte *)(globals::g_CharTranslate_TABLE._0_4_ + 1 + (iVar1 >> 8 & 0xffU) * 2) & 0x80) == 0
			 ) {
			c = c & 0xffff0000U | iVar1 & 0xffU;
			pWVar3 = (LPCWSTR)0x1;
		}
		else {
			c = c & 0xff000000U | (uint)CONCAT11((char)iVar1,(char)((uint)iVar1 >> 8));
			pWVar3 = (LPCWSTR)0x2;
		}
		iVar4 = FUN_00493f60(DAT_0054a180,0x200,(char *)&c,pWVar3,(LPWSTR)local_8,3,0);
		if (iVar4 == 0) {
			return iVar1;
		}
		if (iVar4 == 1) {
			return local_8[0] & 0xff;
		}
		c = (local_8[0] >> 8 & 0xff) << 8 | local_8[0] & 0xff;
	}
	return c;
}



void __cdecl FUN_0048e740(void)
{
	if (PTR___fpmath_004b0ca8 != NULL) {
		(*(code *)PTR___fpmath_004b0ca8)();
	}
	FUN_0048e860((undefined **)&DAT_004a2008,(undefined **)&DAT_004a2014);
	FUN_0048e860((undefined **)&DAT_004a2000,(undefined **)&DAT_004a2004);
	return;
}



void __cdecl std::exit(int status)
{
	FUN_0048e7b0(status,0,0);
	return;
}



// Library Function - Single Match
// Name: __exit
// Library: Visual Studio 1998 Release

void __cdecl std::quick_exit(int _Code)
{
	FUN_0048e7b0(_Code,1,0);
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl FUN_0048e7b0(UINT param_1,int param_2,int param_3)
{
	HANDLE hProcess;
	code **ppcVar1;
	code **ppcVar2;
	UINT uExitCode;
	
	if (DAT_0054a118 == 1) {
		uExitCode = param_1;
		hProcess = GetCurrentProcess();
		TerminateProcess(hProcess,uExitCode);
	}
	_DAT_0054a114 = 1;
	DAT_0054a110 = (undefined)param_3;
	if (param_2 == 0) {
		if ((DAT_0076eed0 != NULL) &&
			 (ppcVar2 = (code **)(DAT_0076eecc + -4), ppcVar1 = DAT_0076eed0, DAT_0076eed0 <= ppcVar2)) {
			do {
				if (*ppcVar2 != NULL) {
					(**ppcVar2)();
					ppcVar1 = DAT_0076eed0;
				}
				ppcVar2 = ppcVar2 + -1;
			} while (ppcVar1 <= ppcVar2);
		}
		FUN_0048e860((undefined **)&DAT_004a2018,(undefined **)&DAT_004a2020);
	}
	FUN_0048e860((undefined **)&DAT_004a2024,(undefined **)&DAT_004a202c);
	if (param_3 == 0) {
		DAT_0054a118 = 1;
		ExitProcess(param_1);
	}
	return;
}



void __cdecl FUN_0048e860(undefined **param_1,undefined **param_2)
{
	if (param_1 < param_2) {
		do {
			if ((code *)*param_1 != NULL) {
				(*(code *)*param_1)();
			}
			param_1 = (code **)param_1 + 1;
		} while (param_1 < param_2);
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

undefined8 __thiscall FUN_0048e894(undefined4 param_1_00,uint param_1,uint param_2)
{
	uint uVar1;
	uint uVar2;
	undefined4 uVar3;
	uint extraout_EDX;
	undefined in_ZF;
	ushort in_FPUControlWord;
	ushort in_FPUStatusWord;
	uint uVar4;
	
	__fload_withFB(param_1_00,(int)&param_1);
	uVar4 = extraout_EDX & 0xffff0000 | (uint)in_FPUControlWord;
	if ((bool)in_ZF) {
		if (((param_2 & 0xfffff) != 0) || (param_1 != 0)) {
			uVar1 = FUN_004922cc();
			goto LAB_0048e91b;
		}
		uVar1 = param_2 & 0x80000000;
		uVar2 = uVar1;
joined_r0x0048e90c:
		if (uVar2 != 0) goto LAB_0048e90e;
	}
	else {
		uVar1 = param_2;
		if (in_FPUControlWord != 0x27f) {
			uVar1 = FUN_004922b5(uVar4);
		}
		if ((uVar1 & 0x80000000) != 0) {
			if (((uVar1 & 0x7ff00000) == 0) && (uVar2 = param_1, (uVar1 & 0xfffff) == 0))
			goto joined_r0x0048e90c;
LAB_0048e90e:
			uVar1 = 1;
LAB_0048e91b:
			if (_DAT_0054a0c8 == 0) {
				uVar3 = __startOneArgErrorHandling();
				return CONCAT44(uVar4,uVar3);
			}
			goto LAB_0049233e;
		}
	}
	if (_DAT_0054a0c8 == 0) {
		uVar2 = uVar1 & 0xffff0000 | uVar4 & 0xffff;
		if ((short)(uVar4 & 0xffff) != 0x27f) {
			if (((uVar4 & 0x20) != 0) &&
				 (uVar2 = uVar1 & 0xffff0000 | (uint)in_FPUStatusWord, (in_FPUStatusWord & 0x20) != 0)) {
				uVar3 = __startOneArgErrorHandling();
				return CONCAT44(uVar4,uVar3);
			}
			uVar2 &= 0xffff0020;
		}
		return CONCAT44(uVar4,uVar2);
	}
LAB_0049233e:
	return CONCAT44(uVar4,uVar1);
}



float10 __cdecl FUN_0048e940(uint param_1,uint param_2)
{
	double dVar1;
	uint uVar2;
	int iVar3;
	float10 fVar4;
	
	uVar2 = std::__unk_math__00493ed0();
	if ((param_2._2_2_ & 0x7ff0) != 0x7ff0) {
		std::__unk_math__00493ed0();
		return (float10)(double)(CONCAT44(param_2,param_1) & 0x7fffffffffffffff);
	}
	iVar3 = FUN_00493d40(param_1,param_2);
	if (iVar3 == 1) {
		std::__unk_math__00493ed0();
		return (float10)(double)CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1));
	}
	if (iVar3 == 2) {
		std::__unk_math__00493ed0();
		return -(float10)(double)CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1));
	}
	if (iVar3 != 3) {
		dVar1 = (double)CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1)) - -1.0;
		fVar4 = FUN_00493480(8,0x15,param_1,param_2,SUB84(dVar1,0),(int)((ulonglong)dVar1 >> 0x20),uVar2
												);
		return fVar4;
	}
	fVar4 = std::__unk_math__00493430(0x15,param_1,param_2,uVar2);
	return fVar4;
}



// Library Function - Single Match
// Name: _strncpy
// Library: Visual Studio 1998 Release

char * __cdecl std::_strncpy(char *_Dest,char *_Source,size_t _Count)
{
	uint uVar1;
	uint uVar2;
	char cVar3;
	uint uVar4;
	uint *puVar5;
	
	if (_Count == 0) {
		return _Dest;
	}
	puVar5 = (uint *)_Dest;
	if (((uint)_Source & 3) != 0) {
		while( true ) {
			cVar3 = *_Source;
			_Source = (char *)((int)_Source + 1);
			*(char *)puVar5 = cVar3;
			puVar5 = (uint *)((int)puVar5 + 1);
			_Count -= 1;
			if (_Count == 0) {
				return _Dest;
			}
			if (cVar3 == '\0') break;
			if (((uint)_Source & 3) == 0) {
				uVar4 = _Count >> 2;
				goto joined_r0x0048ea6e;
			}
		}
		do {
			if (((uint)puVar5 & 3) == 0) {
				uVar4 = _Count >> 2;
				if (uVar4 == 0) goto LAB_0048eaab;
				goto LAB_0048eb19;
			}
			*(undefined *)puVar5 = 0;
			puVar5 = (uint *)((int)puVar5 + 1);
			_Count -= 1;
		} while (_Count != 0);
		return _Dest;
	}
	uVar4 = _Count >> 2;
	if (uVar4 != 0) {
		do {
			uVar1 = *(uint *)_Source;
			uVar2 = *(uint *)_Source;
			_Source = (char *)((int)_Source + 4);
			if (((uVar1 ^ 0xffffffff ^ uVar1 + 0x7efefeff) & 0x81010100) != 0) {
				if ((char)uVar2 == '\0') {
					*puVar5 = 0;
joined_r0x0048eb15:
					while( true ) {
						uVar4 -= 1;
						puVar5 = puVar5 + 1;
						if (uVar4 == 0) break;
LAB_0048eb19:
						*puVar5 = 0;
					}
					cVar3 = '\0';
					_Count &= 3;
					if (_Count != 0) goto LAB_0048eaab;
					return _Dest;
				}
				if ((char)(uVar2 >> 8) == '\0') {
					*puVar5 = uVar2 & 0xff;
					goto joined_r0x0048eb15;
				}
				if ((uVar2 & 0xff0000) == 0) {
					*puVar5 = uVar2 & 0xffff;
					goto joined_r0x0048eb15;
				}
				if ((uVar2 & 0xff000000) == 0) {
					*puVar5 = uVar2;
					goto joined_r0x0048eb15;
				}
			}
			*puVar5 = uVar2;
			puVar5 = puVar5 + 1;
			uVar4 -= 1;
joined_r0x0048ea6e:
		} while (uVar4 != 0);
		_Count &= 3;
		if (_Count == 0) {
			return _Dest;
		}
	}
	do {
		cVar3 = *_Source;
		_Source = (char *)((int)_Source + 1);
		*(char *)puVar5 = cVar3;
		puVar5 = (uint *)((int)puVar5 + 1);
		if (cVar3 == '\0') {
			while (_Count -= 1, _Count != 0) {
LAB_0048eaab:
				*(char *)puVar5 = cVar3;
				puVar5 = (uint *)((int)puVar5 + 1);
			}
			return _Dest;
		}
		_Count -= 1;
	} while (_Count != 0);
	return _Dest;
}



uint __cdecl FUN_0048eb30(undefined4 param_1,undefined8 param_2)
{
	return (uint)((param_2._2_4_ & 0x7ff0) != 0x7ff0);
}



void __cdecl std::sscanf(char *buffer,char *format,...)
{
	char cVar1;
	uint uVar2;
	FILE file;
	
	uVar2 = 0xffffffff;
	file._base = buffer;
	file._ptr = buffer;
	do {
		if (uVar2 == 0) break;
		uVar2 -= 1;
		cVar1 = *buffer;
		buffer = buffer + 1;
	} while (cVar1 != '\0');
	file._cnt = ~uVar2 - 1;
	file._flag = 0x49;
	vfscanf(&file,format,(int **)&stack0x0000000c);
	return;
}



float10 __cdecl FUN_0048eba0(uint param_1,uint param_2)
{
	double dVar1;
	uint uVar2;
	int iVar3;
	float10 fVar4;
	uint local_8;
	undefined4 uStack4;
	
	uVar2 = std::__unk_math__00493ed0(DAT_004b0d40,0xffff);
	if ((param_2._2_2_ & 0x7ff0) != 0x7ff0) {
		fVar4 = FUN_00493410((double)CONCAT44(param_2,param_1));
		dVar1 = (double)fVar4;
		if ((dVar1 != (double)CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1))) &&
			 ((uVar2 & 0x20) == 0)) {
			uStack4 = (undefined4)((ulonglong)dVar1 >> 0x20);
			local_8 = SUB84(dVar1,0);
			fVar4 = FUN_00493480(0x10,0xc,param_1,param_2,local_8,uStack4,uVar2);
			return fVar4;
		}
		std::__unk_math__00493ed0(uVar2,0xffff);
		return (float10)dVar1;
	}
	iVar3 = FUN_00493d40(param_1,param_2);
	if (0 < iVar3) {
		if (iVar3 < 3) {
			std::__unk_math__00493ed0(uVar2,0xffff);
			return (float10)(double)CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1));
		}
		if (iVar3 == 3) {
			fVar4 = std::__unk_math__00493430(0xc,param_1,param_2,uVar2);
			return fVar4;
		}
	}
	dVar1 = (double)CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1)) - -1.0;
	fVar4 = FUN_00493480(8,0xc,param_1,param_2,SUB84(dVar1,0),(int)((ulonglong)dVar1 >> 0x20),uVar2);
	return fVar4;
}



// Library Function - Single Match
// Name: __alldiv
// Library: Visual Studio

undefined8 __alldiv(uint param_1,uint param_2,uint param_3,uint param_4)
{
	ulonglong uVar1;
	longlong lVar2;
	uint uVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	uint uVar7;
	uint uVar8;
	bool bVar10;
	char cVar11;
	uint uVar9;
	
	cVar11 = (int)param_2 < 0;
	if ((bool)cVar11) {
		bVar10 = param_1 != 0;
		param_1 = -param_1;
		param_2 = -(uint)bVar10 - param_2;
	}
	if ((int)param_4 < 0) {
		cVar11 += '\x01';
		bVar10 = param_3 != 0;
		param_3 = -param_3;
		param_4 = -(uint)bVar10 - param_4;
	}
	uVar3 = param_1;
	uVar5 = param_3;
	uVar6 = param_2;
	uVar9 = param_4;
	if (param_4 == 0) {
		uVar3 = param_2 / param_3;
		iVar4 = (int)(((ulonglong)param_2 % (ulonglong)param_3 << 0x20 | (ulonglong)param_1) /
								 (ulonglong)param_3);
	}
	else {
		do {
			uVar8 = uVar9 >> 1;
			uVar5 = uVar5 >> 1 | (uint)((uVar9 & 1) != 0) << 0x1f;
			uVar7 = uVar6 >> 1;
			uVar3 = uVar3 >> 1 | (uint)((uVar6 & 1) != 0) << 0x1f;
			uVar6 = uVar7;
			uVar9 = uVar8;
		} while (uVar8 != 0);
		uVar1 = CONCAT44(uVar7,uVar3) / (ulonglong)uVar5;
		iVar4 = (int)uVar1;
		lVar2 = (ulonglong)param_3 * (uVar1 & 0xffffffff);
		uVar3 = (uint)((ulonglong)lVar2 >> 0x20);
		uVar5 = uVar3 + iVar4 * param_4;
		if (((CARRY4(uVar3,iVar4 * param_4)) || (param_2 < uVar5)) ||
			 ((param_2 <= uVar5 && (param_1 < (uint)lVar2)))) {
			iVar4 += -1;
		}
		uVar3 = 0;
	}
	if (cVar11 == '\x01') {
		bVar10 = iVar4 != 0;
		iVar4 = -iVar4;
		uVar3 = -(uint)bVar10 - uVar3;
	}
	return CONCAT44(uVar3,iVar4);
}



// Library Function - Single Match
// Name: __allmul
// Library: Visual Studio

ulonglong __allmul(uint param_1,uint param_2,uint param_3,uint param_4)
{
	if ((param_4 | param_2) == 0) {
		return (ulonglong)param_1 * (ulonglong)param_3;
	}
	return (ulonglong)param_1 * (ulonglong)param_3 & 0xffffffff |
				 (ulonglong)
				 ((int)((ulonglong)param_1 * (ulonglong)param_3 >> 0x20) +
				 param_2 * param_3 + param_1 * param_4) << 0x20;
}



void * __cdecl lego::video::Avi__malloc_inernal(uint param_1)
{
	void *pvVar1;
	
	pvVar1 = std::__malloc_internal(param_1,1);
	return pvVar1;
}



int __cdecl std::fclose(FILE *file)
{
	int iVar1;
	int iVar2;
	
	iVar2 = -1;
	if ((file->_flag & 0x40U) != 0) {
		file->_flag = 0;
		return -1;
	}
	if ((file->_flag & 0x83U) != 0) {
		iVar2 = __fflush__0048ffe0(file);
		__ffree__004950b0(file);
		iVar1 = __fdclose__00494fd0(file->_file);
		if (iVar1 < 0) {
			file->_flag = 0;
			return -1;
		}
		if (file->_tmpfname != NULL) {
			free(file->_tmpfname);
			file->_tmpfname = NULL;
		}
	}
	file->_flag = 0;
	return iVar2;
}



FILE * __cdecl std::_fsopen(LPCSTR filename,char *mode,int shflag)
{
	undefined4 *puVar1;
	FILE *pFVar2;
	
	puVar1 = __unk__004952c0();
	if (puVar1 == NULL) {
		return NULL;
	}
	pFVar2 = (FILE *)__fsopen_FUN_004950f0(filename,mode,shflag,puVar1);
	return pFVar2;
}



FILE * __cdecl std::fopen(LPCSTR filename,char *mode)
{
	FILE *pFVar1;
	
	pFVar1 = _fsopen(filename,mode,SH_DENYNO);
	return pFVar1;
}



void FUN_0048ee70(undefined *UNRECOVERED_JUMPTABLE)
{
	undefined4 *in_FS_OFFSET;
	
	*in_FS_OFFSET = *(undefined4 *)*in_FS_OFFSET;
										// WARNING: Could not recover jumptable at 0x0048ee9b. Too many branches
										// WARNING: Treating indirect jump as call
	(*(code *)UNRECOVERED_JUMPTABLE)();
	return;
}



void FUN_0048eeb0(undefined4 param_1,undefined *UNRECOVERED_JUMPTABLE)
{
										// WARNING: Could not recover jumptable at 0x0048eeb5. Too many branches
										// WARNING: Treating indirect jump as call
	(*(code *)UNRECOVERED_JUMPTABLE)();
	return;
}



void FUN_0048eec0(PVOID param_1,PEXCEPTION_RECORD param_2)
{
	undefined4 *puVar1;
	undefined4 *in_FS_OFFSET;
	
	puVar1 = (undefined4 *)*in_FS_OFFSET;
	RtlUnwind(param_1,(PVOID)0x48eeec,param_2,NULL);
	param_2->ExceptionFlags = param_2->ExceptionFlags & 0xfffffffd;
	*puVar1 = *in_FS_OFFSET;
	*in_FS_OFFSET = puVar1;
	return;
}



undefined4
FUN_0048ef20(PEXCEPTION_RECORD param_1,PVOID param_2,undefined4 param_3,undefined4 param_4)
{
	int *in_EAX;
	undefined4 uVar1;
	
	uVar1 = FUN_00495350(param_1,param_2,param_3,param_4,in_EAX,NULL,NULL,0);
	return uVar1;
}



undefined4 __cdecl
FUN_0048ef60(undefined4 param_1,undefined4 param_2,undefined4 param_3,int param_4,int param_5)
{
	undefined4 uVar1;
	int **in_FS_OFFSET;
	int *local_18;
	code *local_14;
	undefined4 local_10;
	undefined4 local_c;
	int local_8;
	
	local_8 = param_4 + 1;
	local_14 = FUN_0048efc0;
	local_10 = param_2;
	local_c = param_1;
	local_18 = *in_FS_OFFSET;
	*in_FS_OFFSET = (int *)&local_18;
	uVar1 = __CallSettingFrame_12(param_3,param_1,param_5);
	*in_FS_OFFSET = local_18;
	return uVar1;
}



void __cdecl FUN_0048efc0(PEXCEPTION_RECORD param_1,PVOID param_2,undefined4 param_3)
{
	FUN_00495350(param_1,*(PVOID *)((int)param_2 + 0xc),param_3,0,*(int **)((int)param_2 + 8),
							 *(PVOID *)((int)param_2 + 0x10),param_2,0);
	return;
}



undefined4 __cdecl
FUN_0048eff0(undefined4 *param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4,
						undefined4 param_5,undefined4 param_6,undefined4 param_7)
{
	undefined4 **in_FS_OFFSET;
	undefined4 local_38;
	undefined4 *local_34;
	undefined4 local_30;
	undefined4 *local_2c;
	code *local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined4 local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined *local_10;
	undefined *local_c;
	int local_8;
	
	local_c = &stack0xfffffffc;
	local_10 = &stack0xffffffbc;
	local_28 = FUN_0048f0c0;
	local_24 = param_5;
	local_20 = param_2;
	local_1c = param_6;
	local_18 = param_7;
	local_8 = 0;
	local_14 = 0x48f08a;
	local_2c = *in_FS_OFFSET;
	*in_FS_OFFSET = &local_2c;
	local_38 = 1;
	local_34 = param_1;
	local_30 = param_3;
	(*DAT_0054a19c)(*param_1,&local_34);
	if (local_8 == 0) {
		*in_FS_OFFSET = local_2c;
	}
	else {
		*local_2c = **in_FS_OFFSET;
		*in_FS_OFFSET = local_2c;
	}
	return 0;
}



undefined4 __cdecl FUN_0048f0c0(PEXCEPTION_RECORD param_1,PVOID param_2,undefined4 param_3)
{
	undefined4 uVar1;
	
	if ((param_1->ExceptionFlags & 0x66) != 0) {
		*(undefined4 *)((int)param_2 + 0x24) = 1;
		return 1;
	}
	FUN_00495350(param_1,*(PVOID *)((int)param_2 + 0xc),param_3,0,*(int **)((int)param_2 + 8),
							 *(PVOID *)((int)param_2 + 0x10),*(PVOID *)((int)param_2 + 0x14),1);
	if (*(int *)((int)param_2 + 0x24) == 0) {
		FUN_0048eec0(param_2,param_1);
	}
										// WARNING: Could not recover jumptable at 0x0048f134. Too many branches
										// WARNING: Treating indirect jump as call
	uVar1 = (**(code **)((int)param_2 + 0x18))();
	return uVar1;
}



int __cdecl FUN_0048f150(int param_1,int param_2,int param_3,uint *param_4,uint *param_5)
{
	int iVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	uint uVar5;
	
	iVar2 = *(int *)(param_1 + 0x10);
	uVar3 = *(uint *)(param_1 + 0xc);
	uVar4 = uVar3;
	uVar5 = uVar3;
	if (-1 < param_2) {
		do {
			if (uVar4 == 0xffffffff) {
				FUN_00495e30();
			}
			uVar4 -= 1;
			iVar1 = iVar2 + uVar4 * 0x14;
			if (((*(int *)(iVar1 + 4) < param_3) && (param_3 <= *(int *)(iVar1 + 8))) ||
				 (uVar4 == 0xffffffff)) {
				param_2 += -1;
				uVar3 = uVar5;
				uVar5 = uVar4;
			}
		} while (-1 < param_2);
	}
	uVar4 += 1;
	*param_4 = uVar4;
	*param_5 = uVar3;
	if ((*(uint *)(param_1 + 0xc) <= uVar3 && uVar3 != *(uint *)(param_1 + 0xc)) || (uVar3 < uVar4)) {
		FUN_00495e30();
	}
	return iVar2 + uVar4 * 0x14;
}



// Library Function - Single Match
// Name: __global_unwind2
// Library: Visual Studio

void __cdecl __global_unwind2(PVOID param_1)
{
	RtlUnwind(param_1,(PVOID)0x48f1e8,NULL,NULL);
	return;
}



// Library Function - Single Match
// Name: __local_unwind2
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release, Visual Studio 2003 Debug, Visual
// Studio 2003 Release

void __cdecl __local_unwind2(int param_1,int param_2)
{
	int iVar1;
	int iVar2;
	undefined4 *in_FS_OFFSET;
	undefined4 uStack28;
	undefined *puStack24;
	undefined4 local_14;
	int iStack16;
	
	iStack16 = param_1;
	puStack24 = &LAB_0048f1f0;
	uStack28 = *in_FS_OFFSET;
	*in_FS_OFFSET = &uStack28;
	while( true ) {
		iVar1 = *(int *)(param_1 + 8);
		iVar2 = *(int *)(param_1 + 0xc);
		if ((iVar2 == -1) || (iVar2 == param_2)) break;
		local_14 = *(undefined4 *)(iVar1 + iVar2 * 0xc);
		*(undefined4 *)(param_1 + 0xc) = local_14;
		if (*(int *)(iVar1 + 4 + iVar2 * 0xc) == 0) {
			__NLG_Notify(0x101);
			(**(code **)(iVar1 + 8 + iVar2 * 0xc))();
		}
	}
	*in_FS_OFFSET = uStack28;
	return;
}



// Library Function - Single Match
// Name: __abnormal_termination
// Library: Visual Studio

int __cdecl __abnormal_termination(void)
{
	int iVar1;
	int iVar2;
	int *in_FS_OFFSET;
	
	iVar2 = 0;
	iVar1 = *in_FS_OFFSET;
	if ((*(undefined **)(iVar1 + 4) == &LAB_0048f1f0) &&
		 (*(int *)(iVar1 + 8) == *(int *)(*(int *)(iVar1 + 0xc) + 0xc))) {
		iVar2 = 1;
	}
	return iVar2;
}



// Library Function - Single Match
// Name: __NLG_Notify1
// Libraries: Visual Studio 2003 Debug, Visual Studio 2003 Release

void __fastcall __NLG_Notify1(undefined4 param_1)
{
	undefined4 in_EAX;
	undefined4 unaff_EBP;
	
	DAT_004b0d54 = in_EAX;
	DAT_004b0d58 = param_1;
	DAT_004b0d5c = unaff_EBP;
	return;
}



// Library Function - Single Match
// Name: __NLG_Notify
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release, Visual Studio 2003 Debug, Visual
// Studio 2003 Release

void __NLG_Notify(ulong param_1)
{
	undefined4 in_EAX;
	int unaff_EBP;
	
	DAT_004b0d54 = in_EAX;
	DAT_004b0d58 = *(undefined4 *)(unaff_EBP + 8);
	DAT_004b0d5c = unaff_EBP;
	return;
}



void entry(void)
{
	byte bVar1;
	DWORD DVar2;
	int iVar3;
	uint nShowCmd;
	HINSTANCE hInstance;
	LPSTR *ppCVar4;
	undefined4 *in_FS_OFFSET;
	HINSTANCE hPrevInstance;
	LPSTR lpCmdLine;
	STARTUPINFOA startupInfo;
	undefined4 local_14;
	undefined *puStack16;
	undefined *puStack12;
	undefined4 local_8;
	
	local_8 = 0xffffffff;
	puStack12 = &DAT_0049fb20;
	puStack16 = &LAB_00496a98;
	local_14 = *in_FS_OFFSET;
	*in_FS_OFFSET = &local_14;
	DVar2 = GetVersion();
	std::globals::g_dwMajorVersion = DVar2 >> 8 & 0xff;
	std::globals::g_dwMinorVersion = DVar2 & 0xff;
	std::globals::g_dwMajorMinorVersion =
			 std::globals::g_dwMinorVersion * 0x100 + std::globals::g_dwMajorVersion;
	std::globals::g_dwBuildNumber = DVar2 >> 0x10;
	iVar3 = FUN_00491820();
	if (iVar3 == 0) {
		__amsg_exit(0x1c);
	}
	local_8 = 0;
	FUN_00496890();
	FUN_00496880();
	std::globals::g_CommandLineA = (LPSTR *)GetCommandLineA();
	std::globals::g_EnvironmentStringsA = std::GetEnvironmentStringsA();
	if ((std::globals::g_EnvironmentStringsA == NULL) || (std::globals::g_CommandLineA == NULL)) {
		std::exit(-1);
	}
	FUN_004961a0();
	FUN_004960b0();
	FUN_0048e740();
	lpCmdLine = (LPSTR)std::globals::g_CommandLineA;
	if (*(char *)std::globals::g_CommandLineA == '\"') {
		while( true ) {
			ppCVar4 = (LPSTR *)lpCmdLine;
			lpCmdLine = (LPSTR)((int)ppCVar4 + 1);
			bVar1 = *lpCmdLine;
			if ((bVar1 == '\"') || (bVar1 == 0)) break;
			iVar3 = FUN_00496050((uint)bVar1);
			if (iVar3 != 0) {
				lpCmdLine = (LPSTR)((int)ppCVar4 + 2);
			}
		}
		if (*lpCmdLine == '\"') {
			lpCmdLine = (LPSTR)((int)ppCVar4 + 2);
		}
	}
	else {
		for (; 0x20 < (byte)*lpCmdLine; lpCmdLine = (LPSTR)((int)lpCmdLine + 1)) {
		}
	}
	for (; (*lpCmdLine != 0 && ((byte)*lpCmdLine < 0x21)); lpCmdLine = lpCmdLine + 1) {
	}
	startupInfo.dwFlags = 0;
	GetStartupInfoA((LPSTARTUPINFOA)&startupInfo);
	if ((startupInfo.dwFlags & 1) == 0) {
										// STARTF_USECOUNTCHARS (0x8) | STARTF_USESIZE (0x2)
		nShowCmd = 10;
	}
	else {
										// WORD wShowWindow
		nShowCmd = startupInfo._48_4_ & 0xffff;
	}
	hPrevInstance = NULL;
	hInstance = (HINSTANCE)GetModuleHandleA(NULL);
	iVar3 = lego::WinMain(hInstance,hPrevInstance,lpCmdLine,nShowCmd);
	std::exit(iVar3);
	*in_FS_OFFSET = local_14;
	return;
}



// Library Function - Single Match
// Name: __amsg_exit
// Library: Visual Studio 1998 Release

void __cdecl __amsg_exit(int param_1)
{
	if (DAT_0054a124 == 1) {
		FUN_00496b70();
	}
	FUN_00496bb0(param_1);
	(*(code *)PTR_quick_exit_004b0d60)(0xff);
	return;
}



uint __cdecl std::_unk_FUN_0048f490(uint c,uint charMask)
{
	int iVar1;
	LCID LVar2;
	uint local_4;
	
	if (c + 1 < 0x101) {
		return *(ushort *)(globals::g_CharTranslate_TABLE._0_4_ + c * 2) & charMask;
	}
	if ((*(byte *)(globals::g_CharTranslate_TABLE._0_4_ + 1 + ((int)c >> 8 & 0xffU) * 2) & 0x80) == 0)
	{
		c &= 0xffff00ff;
		iVar1 = 1;
	}
	else {
		c = c & 0xff000000 | (uint)CONCAT11((char)c,(char)(c >> 8));
		iVar1 = 2;
	}
	LVar2 = _unk_FUN_00496d90(1,(LPCSTR)&c,iVar1,(LPWORD)&local_4,0,0);
	if (LVar2 == 0) {
		return 0;
	}
	return local_4 & 0xffff & charMask;
}



// Library Function - Single Match
// Name: _strncmp
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release

int __cdecl std::strncmp(char *_Str1,char *_Str2,size_t _MaxCount)
{
	char cVar1;
	char cVar2;
	byte bVar3;
	size_t sVar4;
	int iVar5;
	uint uVar6;
	char *pcVar7;
	char *pcVar8;
	bool bVar9;
	
	sVar4 = _MaxCount;
	pcVar7 = _Str1;
	if (_MaxCount != 0) {
		do {
			if (sVar4 == 0) break;
			sVar4 -= 1;
			cVar1 = *pcVar7;
			pcVar7 = pcVar7 + 1;
		} while (cVar1 != '\0');
		iVar5 = _MaxCount - sVar4;
		do {
			pcVar7 = _Str2;
			pcVar8 = _Str1;
			if (iVar5 == 0) break;
			iVar5 += -1;
			pcVar8 = _Str1 + 1;
			pcVar7 = _Str2 + 1;
			cVar1 = *_Str2;
			cVar2 = *_Str1;
			_Str2 = pcVar7;
			_Str1 = pcVar8;
		} while (cVar1 == cVar2);
		bVar3 = pcVar7[-1];
		uVar6 = 0;
		bVar9 = bVar3 == pcVar8[-1];
		if (bVar3 < (byte)pcVar8[-1] || bVar9) {
			if (bVar9) {
				return 0;
			}
			uVar6 = 0xfffffffe;
		}
		_MaxCount = ~uVar6;
	}
	return _MaxCount;
}



int __cdecl std::ftell(FILE *file)
{
	uint uVar1;
	uint uVar2;
	int iVar3;
	char *pcVar4;
	char *pcVar5;
	int iVar6;
	char *pcVar7;
	char *local_8;
	char *local_4;
	
	uVar1 = file->_file;
	if (file->_cnt < 0) {
		file->_cnt = 0;
	}
	local_4 = (char *)FUN_00496ec0(uVar1,0,1);
	if ((int)local_4 < 0) {
		return (int)(char *)0xffffffff;
	}
	uVar2 = file->_flag;
	if ((uVar2 & 0x108) == 0) {
		return (int)(local_4 + -file->_cnt);
	}
	pcVar7 = file->_ptr;
	pcVar4 = file->_base;
	local_8 = pcVar7 + -(int)pcVar4;
	iVar3 = (int)uVar1 >> 5;
	if ((uVar2 & 3) == 0) {
		if ((uVar2 & 0x80) == 0) {
			globals::g_msvc_errno = 0x16;
			return (int)(char *)0xffffffff;
		}
	}
	else {
		pcVar5 = pcVar4;
		if ((*(byte *)((&DAT_0076edc0)[iVar3] + 4 + (uVar1 & 0x1f) * 8) & 0x80) != 0) {
			for (; pcVar5 < pcVar7; pcVar5 = pcVar5 + 1) {
				if (*pcVar5 == '\n') {
					local_8 = local_8 + 1;
				}
			}
		}
	}
	if (local_4 == NULL) {
		return (int)local_8;
	}
	if ((*(byte *)&file->_flag & 1) == 0) goto LAB_0048f6e5;
	if (file->_cnt == 0) {
		return (int)local_4;
	}
	pcVar7 = pcVar7 + (file->_cnt - (int)pcVar4);
	iVar6 = (uVar1 & 0x1f) * 8;
	if ((*(byte *)(iVar6 + 4 + (&DAT_0076edc0)[iVar3]) & 0x80) != 0) {
		pcVar4 = (char *)FUN_00496ec0(uVar1,0,2);
		if (pcVar4 == local_4) {
			pcVar5 = file->_base;
			pcVar4 = pcVar5 + (int)pcVar7;
			for (; pcVar5 < pcVar4; pcVar5 = pcVar5 + 1) {
				if (*pcVar5 == '\n') {
					pcVar7 = pcVar7 + 1;
				}
			}
			if ((file->_flag & 0x2000U) != 0) {
LAB_0048f6dc:
				pcVar7 = pcVar7 + 1;
			}
		}
		else {
			FUN_00496ec0(uVar1,(LONG)local_4,0);
			if (((pcVar7 < (char *)0x201) && ((file->_flag & 8U) != 0)) && ((file->_flag & 0x400U) == 0))
			{
				pcVar7 = (char *)0x200;
			}
			else {
				pcVar7 = (char *)file->_bufsiz;
			}
			if ((*(byte *)(iVar6 + 4 + (&DAT_0076edc0)[iVar3]) & 4) != 0) goto LAB_0048f6dc;
		}
	}
	local_4 = local_4 + -(int)pcVar7;
LAB_0048f6e5:
	return (int)(local_4 + (int)local_8);
}



int __cdecl std::fseek(FILE *file,int offset,int origin)
{
	uint uVar1;
	int iVar2;
	DWORD DVar3;
	
	if (((file->_flag & 0x83U) != 0) && (((origin == 0 || (origin == 1)) || (origin == 2)))) {
		file->_flag = file->_flag & 0xffffffef;
		if (origin == 1) {
			iVar2 = ftell(file);
			offset += iVar2;
			origin = 0;
		}
		__fflush__0048ffe0(file);
		uVar1 = file->_flag;
		if ((uVar1 & 0x80) == 0) {
			if ((((uVar1 & 1) != 0) && ((uVar1 & 8) != 0)) && ((uVar1 & 0x400) == 0)) {
				file->_bufsiz = 0x200;
			}
		}
		else {
			file->_flag = uVar1 & 0xfffffffc;
		}
		DVar3 = FUN_00496ec0(file->_file,offset,origin);
		return (DVar3 != 0xffffffff) - 1;
	}
	globals::g_msvc_errno = EINVAL;
	return -1;
}



uint __cdecl std::fwrite(void *out_buffer,uint size,int count,FILE *in_file)
{
	FILE *file;
	FILE *pFVar1;
	int iVar2;
	FILE *pFVar3;
	uint uVar4;
	FILE *pFVar5;
	FILE *pFVar6;
	undefined4 *puVar7;
	undefined4 *puVar8;
	
	file = in_file;
	pFVar5 = (FILE *)(count * size);
	if (pFVar5 == NULL) {
		return 0;
	}
	pFVar6 = pFVar5;
	if ((in_file->_flag & 0x10cU) == 0) {
		in_file = (FILE *)0x1000;
	}
	else {
		in_file = (FILE *)in_file->_bufsiz;
	}
	do {
		uVar4 = file->_flag & 0x108;
		if ((uVar4 == 0) || (pFVar1 = (FILE *)file->_cnt, pFVar1 == NULL)) {
			if (pFVar6 < in_file) {
										// WARNING: Load size is inaccurate
				uVar4 = FUN_00490b60((int)*out_buffer,(char **)file);
				if (uVar4 == 0xffffffff) goto LAB_0048f8f4;
				in_file = (FILE *)file->_bufsiz;
				out_buffer = (void *)((int)out_buffer + 1);
				pFVar6 = (FILE *)((int)&pFVar6[-1]._tmpfname + 3);
				if ((int)in_file < 1) {
					in_file = (FILE *)0x1;
				}
			}
			else {
				if ((uVar4 != 0) && (iVar2 = __fflush__0048ffe0(file), iVar2 != 0)) {
LAB_0048f8f4:
					return (uint)((int)pFVar5 - (int)pFVar6) / size;
				}
				pFVar1 = pFVar6;
				if (in_file != NULL) {
					pFVar1 = (FILE *)((int)pFVar6 - (uint)pFVar6 % (uint)in_file);
				}
				pFVar3 = (FILE *)__fdwrite__00496f80(file->_file,(char *)out_buffer,(char *)pFVar1);
				if (pFVar3 == (FILE *)0xffffffff) {
LAB_0048f8d9:
					file->_flag = file->_flag | 0x20;
					return (uint)((int)pFVar5 - (int)pFVar6) / size;
				}
				pFVar6 = (FILE *)((int)pFVar6 - (int)pFVar3);
				out_buffer = (void *)((int)out_buffer + (int)pFVar3);
				if (pFVar3 < pFVar1) goto LAB_0048f8d9;
			}
		}
		else {
			if (pFVar6 < pFVar1) {
				pFVar1 = pFVar6;
			}
			pFVar6 = (FILE *)((int)pFVar6 - (int)pFVar1);
			puVar7 = (undefined4 *)out_buffer;
			puVar8 = (undefined4 *)file->_ptr;
			for (uVar4 = (uint)pFVar1 >> 2; uVar4 != 0; uVar4 -= 1) {
				*puVar8 = *puVar7;
				puVar7 = puVar7 + 1;
				puVar8 = puVar8 + 1;
			}
			for (uVar4 = (uint)pFVar1 & 3; uVar4 != 0; uVar4 -= 1) {
				*(undefined *)puVar8 = *(undefined *)puVar7;
				puVar7 = (undefined4 *)((int)puVar7 + 1);
				puVar8 = (undefined4 *)((int)puVar8 + 1);
			}
			out_buffer = (void *)((int)out_buffer + (int)pFVar1);
			file->_cnt = file->_cnt - (int)pFVar1;
			file->_ptr = (char *)((int)&pFVar1->_ptr + (int)file->_ptr);
		}
		if (pFVar6 == NULL) {
			return count;
		}
	} while( true );
}



int __cdecl std::remove(LPCSTR filename)
{
	BOOL BVar1;
	uint error_value;
	
	BVar1 = DeleteFileA(filename);
	if (BVar1 == 0) {
		error_value = GetLastError();
	}
	else {
		error_value = 0;
	}
	if (error_value != 0) {
		__set_doserrno(error_value);
		return -1;
	}
	return 0;
}



int __cdecl std::_chmod(LPCSTR filename,int pmode)
{
	DWORD DVar1;
	BOOL BVar2;
	
	DVar1 = GetFileAttributesA(filename);
	if (DVar1 != INVALID_FILE_ATTRIBUTES) {
		if ((pmode & FILE_ATTRIBUTE_NORMAL) == 0) {
			DVar1 |= 1;
		}
		else {
			DVar1 &= 0xfffffffe;
		}
		BVar2 = SetFileAttributesA(filename,DVar1);
		if (BVar2 != 0) {
			return 0;
		}
	}
	DVar1 = GetLastError();
	__set_doserrno(DVar1);
	return -1;
}



int __cdecl std::_mkdir(LPCSTR dirname)
{
	BOOL BVar1;
	uint error_value;
	
	BVar1 = CreateDirectoryA(dirname,NULL);
	if (BVar1 == 0) {
		error_value = GetLastError();
	}
	else {
		error_value = 0;
	}
	if (error_value != 0) {
		__set_doserrno(error_value);
		return -1;
	}
	return 0;
}



HANDLE __cdecl std::_findfirst(LPCSTR filename,_finddata32_t *fileinfo)
{
	char cVar1;
	HANDLE pvVar2;
	DWORD DVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	undefined4 *puVar7;
	char *pcVar8;
	char *pcVar9;
	undefined4 *puVar10;
	_WIN32_FIND_DATAA local_140;
	
	pvVar2 = FindFirstFileA(filename,(LPWIN32_FIND_DATAA)&local_140);
	if (pvVar2 == (HANDLE)0xffffffff) {
		DVar3 = GetLastError();
		if (true) {
			switch(DVar3) {
			case 2:
			case 3:
			case 0x12:
				globals::g_msvc_errno = 2;
				return (HANDLE)0xffffffff;
			case 8:
				globals::g_msvc_errno = 0xc;
				return (HANDLE)0xffffffff;
			}
		}
		globals::g_msvc_errno = 0x16;
		return (HANDLE)0xffffffff;
	}
	fileinfo->attrib = -(uint)(local_140.dwFileAttributes != 0x80) & local_140.dwFileAttributes;
	iVar4 = __unk_ftime__0048fc30(&local_140.ftCreationTime);
	fileinfo->time_create = iVar4;
	iVar4 = __unk_ftime__0048fc30(&local_140.ftLastAccessTime);
	fileinfo->time_access = iVar4;
	iVar4 = __unk_ftime__0048fc30(&local_140.ftLastWriteTime);
	fileinfo->time_write = iVar4;
	uVar5 = 0xffffffff;
	pcVar8 = local_140.cFileName;
	do {
		pcVar9 = pcVar8;
		if (uVar5 == 0) break;
		uVar5 -= 1;
		pcVar9 = pcVar8 + 1;
		cVar1 = *pcVar8;
		pcVar8 = pcVar9;
	} while (cVar1 != '\0');
	uVar5 = ~uVar5;
	fileinfo->size = local_140.nFileSizeLow;
	puVar7 = (undefined4 *)(pcVar9 + -uVar5);
	puVar10 = (undefined4 *)fileinfo->name;
	for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
		*puVar10 = *puVar7;
		puVar7 = puVar7 + 1;
		puVar10 = puVar10 + 1;
	}
	for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
		*(undefined *)puVar10 = *(undefined *)puVar7;
		puVar7 = (undefined4 *)((int)puVar7 + 1);
		puVar10 = (undefined4 *)((int)puVar10 + 1);
	}
	return pvVar2;
}



int __cdecl std::_findnext(HANDLE handle,_finddata32_t *fileinfo)
{
	char cVar1;
	BOOL BVar2;
	DWORD DVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	undefined4 *puVar7;
	char *pcVar8;
	char *pcVar9;
	undefined4 *puVar10;
	_WIN32_FIND_DATAA local_140;
	
	BVar2 = FindNextFileA(handle,(LPWIN32_FIND_DATAA)&local_140);
	if (BVar2 == 0) {
		DVar3 = GetLastError();
		if (true) {
			switch(DVar3) {
			case 2:
			case 3:
			case 0x12:
				globals::g_msvc_errno = ENOENT;
				return -1;
			case 8:
				globals::g_msvc_errno = ENOMEM;
				return -1;
			}
		}
		globals::g_msvc_errno = EINVAL;
		return -1;
	}
	fileinfo->attrib = -(uint)(local_140.dwFileAttributes != 0x80) & local_140.dwFileAttributes;
	iVar4 = __unk_ftime__0048fc30(&local_140.ftCreationTime);
	fileinfo->time_create = iVar4;
	iVar4 = __unk_ftime__0048fc30(&local_140.ftLastAccessTime);
	fileinfo->time_access = iVar4;
	iVar4 = __unk_ftime__0048fc30(&local_140.ftLastWriteTime);
	fileinfo->time_write = iVar4;
	uVar5 = 0xffffffff;
	pcVar8 = local_140.cFileName;
	do {
		pcVar9 = pcVar8;
		if (uVar5 == 0) break;
		uVar5 -= 1;
		pcVar9 = pcVar8 + 1;
		cVar1 = *pcVar8;
		pcVar8 = pcVar9;
	} while (cVar1 != '\0');
	uVar5 = ~uVar5;
	fileinfo->size = local_140.nFileSizeLow;
	puVar7 = (undefined4 *)(pcVar9 + -uVar5);
	puVar10 = (undefined4 *)fileinfo->name;
	for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
		*puVar10 = *puVar7;
		puVar7 = puVar7 + 1;
		puVar10 = puVar10 + 1;
	}
	for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
		*(undefined *)puVar10 = *(undefined *)puVar7;
		puVar7 = (undefined4 *)((int)puVar7 + 1);
		puVar10 = (undefined4 *)((int)puVar10 + 1);
	}
	return 0;
}



int __cdecl std::_findclose(HANDLE handle)
{
	BOOL BVar1;
	
	BVar1 = FindClose(handle);
	if (BVar1 == 0) {
		globals::g_msvc_errno = 0x16;
		return -1;
	}
	return 0;
}



int __cdecl std::__unk_ftime__0048fc30(FILETIME *param_1)
{
	BOOL BVar1;
	int iVar2;
	_FILETIME local_18;
	_SYSTEMTIME local_10;
	
	if ((param_1->dwLowDateTime != 0) || (param_1->dwHighDateTime != 0)) {
		BVar1 = FileTimeToLocalFileTime(param_1,(LPFILETIME)&local_18);
		if (BVar1 != 0) {
			BVar1 = FileTimeToSystemTime((FILETIME *)&local_18,(LPSYSTEMTIME)&local_10);
			if (BVar1 != 0) {
				iVar2 = FUN_00497210((uint)local_10.wYear,(uint)local_10.wMonth,(uint)local_10.wDay,
														 (uint)local_10.wHour,(uint)local_10.wMinute,(uint)local_10.wSecond,-1);
				return iVar2;
			}
		}
	}
	return -1;
}



char * __cdecl std::_getcwd(char *out_buffer,int maxlen)
{
	char *pcVar1;
	
	pcVar1 = _getdcwd(0,out_buffer,maxlen);
	return pcVar1;
}



char * __cdecl std::_getdcwd(int drive,char *out_buffer,int maxlen)
{
	char cVar1;
	BOOL BVar2;
	DWORD DVar3;
	uint uVar4;
	uint uVar5;
	undefined4 *puVar6;
	char *pcVar7;
	char *pcVar8;
	undefined4 *puVar9;
	char local_10c;
	undefined local_10b;
	undefined local_10a;
	undefined local_109;
	LPSTR local_108;
	CHAR local_104 [260];
	
	if (drive == 0) {
		DVar3 = GetCurrentDirectoryA(MAX_PATH,local_104);
	}
	else {
		BVar2 = __dcwd_exists(drive);
		if (BVar2 == 0) {
			globals::g_msvc_errno = EACCES;
			globals::g_msvc_doserrno = 0xf;
			return NULL;
		}
		local_10c = (char)drive + '@';
		local_10b = 0x3a;
		local_10a = 0x2e;
		local_109 = 0;
		DVar3 = GetFullPathNameA(&local_10c,MAX_PATH,local_104,&local_108);
	}
	if ((DVar3 == 0) || (uVar4 = DVar3 + 1, MAX_PATH < uVar4)) {
		return (char *)NULL;
	}
	if (out_buffer == NULL) {
		if ((int)uVar4 <= maxlen) {
			uVar4 = maxlen;
		}
		out_buffer = (char *)malloc(uVar4);
		if ((undefined4 *)out_buffer == NULL) {
			globals::g_msvc_errno = ENOMEM;
			return NULL;
		}
	}
	else {
		if (maxlen < (int)uVar4) {
			globals::g_msvc_errno = ERANGE;
			return (char *)NULL;
		}
	}
	uVar4 = 0xffffffff;
	pcVar7 = local_104;
	do {
		pcVar8 = pcVar7;
		if (uVar4 == 0) break;
		uVar4 -= 1;
		pcVar8 = pcVar7 + 1;
		cVar1 = *pcVar7;
		pcVar7 = pcVar8;
	} while (cVar1 != '\0');
	uVar4 = ~uVar4;
	puVar6 = (undefined4 *)(pcVar8 + -uVar4);
	puVar9 = (undefined4 *)out_buffer;
	for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
		*puVar9 = *puVar6;
		puVar6 = puVar6 + 1;
		puVar9 = puVar9 + 1;
	}
	for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
		*(undefined *)puVar9 = *(undefined *)puVar6;
		puVar6 = (undefined4 *)((int)puVar6 + 1);
		puVar9 = (undefined4 *)((int)puVar9 + 1);
	}
	return (char *)(undefined4 *)out_buffer;
}



BOOL __cdecl std::__dcwd_exists(int drive)
{
	UINT UVar1;
	
	if (drive == 0) {
		return 1;
	}
	drive = ZEXT34(CONCAT12('\\',CONCAT11(':',(char)drive + '@')));
	UVar1 = GetDriveTypeA((LPCSTR)&drive);
	if ((UVar1 != 0) && (UVar1 != DRIVE_NO_ROOT_DIR)) {
		return 1;
	}
	return 0;
}



uint __cdecl std::_fread(byte *out_buffer,uint size,uint count,FILE *file)
{
	int iVar1;
	FILE *file_00;
	FILE *pFVar2;
	char *pcVar3;
	uint uVar4;
	FILE *pFVar5;
	FILE *pFVar6;
	undefined4 *puVar7;
	FILE *pFVar8;
	undefined4 *puVar9;
	
	file_00 = file;
	pFVar5 = (FILE *)(count * size);
	if (pFVar5 == NULL) {
		return 0;
	}
	pFVar6 = pFVar5;
	if ((file->_flag & 0x10cU) == 0) {
		file = (FILE *)0x1000;
		pFVar8 = (FILE *)0x1000;
	}
	else {
		pFVar8 = (FILE *)file->_bufsiz;
		file = pFVar8;
	}
	do {
		if (((file_00->_flag & 0x10cU) == 0) || (pFVar2 = (FILE *)file_00->_cnt, pFVar2 == NULL)) {
			if (pFVar6 < pFVar8) {
				uVar4 = __fread_internal__00497300(file_00);
				if (uVar4 == 0xffffffff) {
					return (uint)((int)pFVar5 - (int)pFVar6) / size;
				}
				*out_buffer = (byte)uVar4;
				pFVar8 = (FILE *)file_00->_bufsiz;
				out_buffer = out_buffer + 1;
				iVar1 = -1;
				file = pFVar8;
			}
			else {
				pFVar2 = pFVar6;
				if (pFVar8 != NULL) {
					pFVar2 = (FILE *)((int)pFVar6 - (uint)pFVar6 % (uint)pFVar8);
				}
				pcVar3 = FUN_004973f0(file_00->_file,(char *)out_buffer,(DWORD)pFVar2);
				if (pcVar3 == NULL) {
					file_00->_flag = file_00->_flag | 0x10;
					return (uint)((int)pFVar5 - (int)pFVar6) / size;
				}
				if (pcVar3 == (char *)0xffffffff) {
					file_00->_flag = file_00->_flag | 0x20;
					return (uint)((int)pFVar5 - (int)pFVar6) / size;
				}
				iVar1 = -(int)pcVar3;
				out_buffer = out_buffer + (int)pcVar3;
			}
		}
		else {
			if (pFVar6 < pFVar2) {
				pFVar2 = pFVar6;
			}
			iVar1 = -(int)pFVar2;
			puVar7 = (undefined4 *)file_00->_ptr;
			puVar9 = (undefined4 *)out_buffer;
			for (uVar4 = (uint)pFVar2 >> 2; uVar4 != 0; uVar4 -= 1) {
				*puVar9 = *puVar7;
				puVar7 = puVar7 + 1;
				puVar9 = puVar9 + 1;
			}
			for (uVar4 = (uint)pFVar2 & 3; uVar4 != 0; uVar4 -= 1) {
				*(undefined *)puVar9 = *(undefined *)puVar7;
				puVar7 = (undefined4 *)((int)puVar7 + 1);
				puVar9 = (undefined4 *)((int)puVar9 + 1);
			}
			out_buffer = out_buffer + (int)pFVar2;
			file_00->_cnt = file_00->_cnt - (int)pFVar2;
			file_00->_ptr = (char *)((int)&pFVar2->_ptr + (int)file_00->_ptr);
			pFVar8 = file;
		}
		pFVar6 = (FILE *)((int)&pFVar6->_ptr + iVar1);
		if (pFVar6 == NULL) {
			return count;
		}
	} while( true );
}



int __cdecl FUN_0048ff90(FILE *param_1)
{
	int iVar1;
	
	if (param_1 == NULL) {
		iVar1 = FUN_00490060(0);
		return iVar1;
	}
	iVar1 = std::__fflush__0048ffe0(param_1);
	if (iVar1 != 0) {
		return -1;
	}
	if ((param_1->_flag & 0x4000U) != 0) {
		iVar1 = FUN_00497650(param_1->_file);
		return -(uint)(iVar1 != 0);
	}
	return 0;
}



int __cdecl std::__fflush__0048ffe0(FILE *file)
{
	uint uVar1;
	char *pcVar2;
	int iVar3;
	char *pcVar4;
	
	iVar3 = 0;
	if ((((byte)file->_flag & 3) == 2) && ((file->_flag & 0x108U) != 0)) {
		pcVar4 = file->_ptr + -(int)file->_base;
		if (0 < (int)pcVar4) {
			pcVar2 = (char *)__fdwrite__00496f80(file->_file,file->_base,pcVar4);
			uVar1 = file->_flag;
			if (pcVar2 == pcVar4) {
				if ((uVar1 & 0x80) != 0) {
					file->_cnt = 0;
					file->_flag = uVar1 & 0xfffffffd;
					file->_ptr = file->_base;
					return 0;
				}
			}
			else {
				iVar3 = -1;
				file->_flag = uVar1 | 0x20;
			}
		}
	}
	file->_cnt = 0;
	file->_ptr = file->_base;
	return iVar3;
}



void FUN_00490050(void)
{
	FUN_00490060(1);
	return;
}



int __cdecl FUN_00490060(int param_1)
{
	FILE *pFVar1;
	int iVar2;
	int iVar3;
	int iVar4;
	int iVar5;
	
	iVar3 = 0;
	iVar5 = 0;
	iVar4 = 0;
	if (0 < DAT_0076eda0) {
		do {
			pFVar1 = *(FILE **)(DAT_0076dd98 + iVar4 * 4);
			if ((pFVar1 != NULL) && ((pFVar1->_flag & 0x83U) != 0)) {
				if (param_1 == 1) {
					iVar2 = FUN_0048ff90(pFVar1);
					if (iVar2 != -1) {
						iVar3 += 1;
					}
				}
				else {
					if ((param_1 == 0) && ((pFVar1->_flag & 2U) != 0)) {
						iVar2 = FUN_0048ff90(pFVar1);
						if (iVar2 == -1) {
							iVar5 = -1;
						}
					}
				}
			}
			iVar4 += 1;
		} while (iVar4 < DAT_0076eda0);
	}
	if (param_1 != 1) {
		iVar3 = iVar5;
	}
	return iVar3;
}



int __cdecl std::fgetc(FILE *file)
{
	byte bVar1;
	int iVar2;
	uint uVar3;
	
	iVar2 = file->_cnt + -1;
	file->_cnt = iVar2;
	if (-1 < iVar2) {
		bVar1 = *file->_ptr;
		file->_ptr = file->_ptr + 1;
		return (uint)bVar1;
	}
	uVar3 = __fread_internal__00497300(file);
	return uVar3;
}



char * __cdecl std::fgets(char *str,int numChars,FILE *stream)
{
	int iVar1;
	uint uVar2;
	int iVar3;
	char *pcVar4;
	
	if (numChars < 1) {
		return NULL;
	}
	iVar3 = numChars + -1;
	pcVar4 = str;
	if (iVar3 != 0) {
		while( true ) {
			iVar1 = stream->_cnt + -1;
			stream->_cnt = iVar1;
			if (iVar1 < 0) {
				uVar2 = __fread_internal__00497300(stream);
			}
			else {
				uVar2 = (uint)(byte)*stream->_ptr;
				stream->_ptr = stream->_ptr + 1;
			}
			if (uVar2 == 0xffffffff) break;
			*pcVar4 = (char)uVar2;
			pcVar4 = pcVar4 + 1;
			if ((char)uVar2 == '\n') goto LAB_00490176;
			iVar3 += -1;
			if (iVar3 == 0) {
				*pcVar4 = '\0';
				return str;
			}
		}
		if (pcVar4 == str) {
			return NULL;
		}
	}
LAB_00490176:
	*pcVar4 = '\0';
	return str;
}



int __cdecl FUN_00490190(char **param_1,byte *param_2,undefined4 *param_3)
{
	int iVar1;
	int iVar2;
	
	iVar1 = FUN_00497790(param_1);
	iVar2 = std::_sprintf_internal_2__00490c90(param_1,(char *)param_2,(char *)param_3);
	FUN_00497830(iVar1,(int *)param_1);
	return iVar2;
}



// Library Function - Single Match
// Name: __strcmpi
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release

int __cdecl std::_stricmp(char *_Str1,char *_Str2)
{
	char cVar1;
	char cVar2;
	byte bVar3;
	byte bVar5;
	uint uVar4;
	uint uVar6;
	
	if (DAT_0054a180 == 0) {
		uVar4 = 0xff;
		do {
			do {
				cVar2 = (char)uVar4;
				if (cVar2 == '\0') goto LAB_0049021e;
				cVar2 = *_Str2;
				_Str2 = _Str2 + 1;
				cVar1 = *_Str1;
				uVar4 = (uint)CONCAT11(cVar1,cVar2);
				_Str1 = _Str1 + 1;
			} while ((char)(uVar4 >> 8) == cVar2);
			bVar3 = cVar1 + 0xbf;
			bVar3 = bVar3 + (-(bVar3 < 0x1a) & 0x20U) + 0x41;
			uVar4 = (uint)CONCAT11(cVar2 + 0xbfU + (-((byte)(cVar2 + 0xbfU) < 0x1a) & 0x20U) + 'A',bVar3);
			bVar5 = (byte)(uVar4 >> 8);
		} while (bVar3 == bVar5);
		cVar2 = (bVar3 < bVar5) * -2 + '\x01';
LAB_0049021e:
		uVar4 = SEXT14(cVar2);
	}
	else {
		uVar6 = 0;
		uVar4 = 0xff;
		do {
			do {
				if ((char)uVar4 == '\0') {
					return uVar4;
				}
				bVar3 = *_Str2;
				uVar4 = uVar4 & 0xffffff00 | (uint)bVar3;
				_Str2 = (char *)((byte *)_Str2 + 1);
				bVar5 = *_Str1;
				uVar6 = uVar6 & 0xffffff00 | (uint)bVar5;
				_Str1 = (char *)((byte *)_Str1 + 1);
			} while (bVar3 == bVar5);
			uVar6 = FUN_00497890(uVar6);
			uVar4 = FUN_00497890(uVar4);
		} while ((byte)uVar6 == (byte)uVar4);
		uVar4 = (uint)((byte)uVar6 < (byte)uVar4);
		uVar4 = (1 - uVar4) - (uint)(uVar4 != 0);
	}
	return uVar4;
}



char * __cdecl std::_fullpath(char *out_absPath,LPCSTR relPath,uint maxLength)
{
	LPSTR lpBuffer;
	LPSTR pCVar1;
	DWORD error_value;
	char *pcVar2;
	LPSTR nBufferLength;
	
	if ((relPath == NULL) || (*relPath == '\0')) {
		pcVar2 = _getcwd(out_absPath,maxLength);
		return pcVar2;
	}
	lpBuffer = out_absPath;
	nBufferLength = (LPSTR)maxLength;
	if (out_absPath == NULL) {
		lpBuffer = (LPSTR)malloc(MAX_PATH);
		if (lpBuffer == NULL) {
			globals::g_msvc_errno = ENOMEM;
			return NULL;
		}
		nBufferLength = (LPSTR)MAX_PATH;
	}
	pCVar1 = (LPSTR)GetFullPathNameA(relPath,(DWORD)nBufferLength,lpBuffer,(LPSTR *)&maxLength);
	if (pCVar1 < nBufferLength) {
		if (pCVar1 != NULL) {
			return lpBuffer;
		}
		if (out_absPath == NULL) {
			free(lpBuffer);
		}
		error_value = GetLastError();
		__set_doserrno(error_value);
		return NULL;
	}
	if (out_absPath == NULL) {
		free(lpBuffer);
	}
	globals::g_msvc_errno = ERANGE;
	return NULL;
}



int __cdecl std::fscanf(FILE *file,char *format,...)
{
	int iVar1;
	
	iVar1 = vfscanf(file,format,(int **)&stack0x0000000c);
	return iVar1;
}



void __cdecl
FUN_00490350(char *param_1,undefined4 *param_2,undefined4 *param_3,undefined4 *param_4,
						undefined4 *param_5)
{
	byte *pbVar1;
	char cVar2;
	byte bVar3;
	undefined4 *puVar4;
	int iVar5;
	undefined4 *puVar6;
	char *pcVar7;
	undefined4 *local_4;
	
	iVar5 = -1;
	pcVar7 = param_1;
	do {
		if (iVar5 == 0) break;
		iVar5 += -1;
		cVar2 = *pcVar7;
		pcVar7 = pcVar7 + 1;
	} while (cVar2 != '\0');
	local_4 = NULL;
	if ((iVar5 == -2) || (param_1[1] != ':')) {
		if (param_2 != NULL) {
			*(undefined *)param_2 = 0;
		}
	}
	else {
		if (param_2 != NULL) {
			FUN_00497990(param_2,(byte *)param_1,2);
			*(undefined *)((int)param_2 + 2) = 0;
		}
		param_1 = param_1 + 2;
	}
	bVar3 = *param_1;
	param_2 = NULL;
	puVar6 = (undefined4 *)param_1;
	while (bVar3 != 0) {
		bVar3 = *(byte *)puVar6;
		if ((*(byte *)((int)&DAT_0054a2b8 + bVar3 + 1) & 4) == 0) {
			if ((bVar3 == 0x2f) || (bVar3 == 0x5c)) {
				param_2 = (undefined4 *)((int)puVar6 + 1);
			}
			else {
				if (bVar3 == 0x2e) {
					local_4 = puVar6;
				}
			}
		}
		else {
			puVar6 = (undefined4 *)((int)puVar6 + 1);
		}
		pbVar1 = (byte *)((int)puVar6 + 1);
		puVar6 = (undefined4 *)((int)puVar6 + 1);
		bVar3 = *pbVar1;
	}
	if (param_2 == NULL) {
		param_2 = (undefined4 *)param_1;
		if (param_3 != NULL) {
			*(undefined *)param_3 = 0;
		}
	}
	else {
		if (param_3 != NULL) {
			puVar4 = (undefined4 *)((int)param_2 - (int)param_1);
			if ((undefined4 *)0xfe < puVar4) {
				puVar4 = (undefined4 *)0xff;
			}
			FUN_00497990(param_3,(byte *)param_1,(uint)puVar4);
			*(undefined *)((int)puVar4 + (int)param_3) = 0;
		}
	}
	if ((local_4 == NULL) || (local_4 < param_2)) {
		if (param_4 != NULL) {
			puVar6 = (undefined4 *)((int)puVar6 - (int)param_2);
			if ((undefined4 *)0xfe < puVar6) {
				puVar6 = (undefined4 *)0xff;
			}
			FUN_00497990(param_4,(byte *)param_2,(uint)puVar6);
			*(undefined *)((int)puVar6 + (int)param_4) = 0;
		}
		if (param_5 != NULL) {
			*(undefined *)param_5 = 0;
		}
	}
	else {
		if (param_4 != NULL) {
			puVar4 = (undefined4 *)((int)local_4 - (int)param_2);
			if ((undefined4 *)0xfe < puVar4) {
				puVar4 = (undefined4 *)0xff;
			}
			FUN_00497990(param_4,(byte *)param_2,(uint)puVar4);
			*(undefined *)((int)puVar4 + (int)param_4) = 0;
		}
		if (param_5 != NULL) {
			puVar6 = (undefined4 *)((int)puVar6 - (int)local_4);
			if ((undefined4 *)0xfe < puVar6) {
				puVar6 = (undefined4 *)0xff;
			}
			FUN_00497990(param_5,(byte *)local_4,(uint)puVar6);
			*(undefined *)((int)puVar6 + (int)param_5) = 0;
			return;
		}
	}
	return;
}



// Library Function - Single Match
// Name: __setdefaultprecision
// Library: Visual Studio 1998 Release

void __setdefaultprecision(void)
{
	FUN_00497a70(0x10000,0x30000);
	return;
}



undefined4 FUN_004904f0(void)
{
	if (false) {
		return 1;
	}
	return 0;
}



void FUN_00490540(void)
{
	HMODULE hModule;
	FARPROC pFVar1;
	
	hModule = GetModuleHandleA("KERNEL32");
	if (hModule != NULL) {
		pFVar1 = GetProcAddress(hModule,"IsProcessorFeaturePresent");
		if (pFVar1 != NULL) {
			(*pFVar1)(0);
			return;
		}
	}
	FUN_004904f0();
	return;
}



void __cdecl FUN_00490570(char *param_1)
{
	char cVar1;
	char cVar2;
	uint uVar3;
	
	uVar3 = FUN_00497890((int)*param_1);
	if (uVar3 != 0x65) {
		do {
			param_1 = param_1 + 1;
			if (std::globals::g_CharWidth_1__004b0f74 < 2) {
				uVar3 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + *param_1 * 2) & 4;
			}
			else {
				uVar3 = std::_unk_FUN_0048f490((int)*param_1,4);
			}
		} while (uVar3 != 0);
	}
	cVar2 = *param_1;
	*param_1 = DAT_004b0f78;
	do {
		param_1 = param_1 + 1;
		cVar1 = *param_1;
		*param_1 = cVar2;
		cVar2 = cVar1;
	} while (*param_1 != '\0');
	return;
}



void __cdecl FUN_004905d0(char *param_1)
{
	char cVar1;
	char *pcVar2;
	char *pcVar3;
	char *pcVar4;
	
	cVar1 = *param_1;
	while ((cVar1 != '\0' && (cVar1 != DAT_004b0f78))) {
		pcVar2 = param_1 + 1;
		param_1 = param_1 + 1;
		cVar1 = *pcVar2;
	}
	pcVar2 = param_1 + 1;
	if (*param_1 != '\0') {
		cVar1 = *pcVar2;
		while (((cVar1 != '\0' && (cVar1 != 'e')) && (cVar1 != 'E'))) {
			pcVar3 = pcVar2 + 1;
			pcVar2 = pcVar2 + 1;
			cVar1 = *pcVar3;
		}
		cVar1 = pcVar2[-1];
		pcVar3 = pcVar2;
		while (pcVar4 = pcVar3 + -1, cVar1 == '0') {
			cVar1 = pcVar3[-2];
			pcVar3 = pcVar4;
		}
		if (*pcVar4 == DAT_004b0f78) {
			pcVar4 = pcVar3 + -2;
		}
		cVar1 = *pcVar2;
		pcVar4 = pcVar4 + 1;
		*pcVar4 = cVar1;
		while (cVar1 != '\0') {
			pcVar2 = pcVar2 + 1;
			cVar1 = *pcVar2;
			pcVar4 = pcVar4 + 1;
			*pcVar4 = cVar1;
		}
	}
	return;
}



undefined4 __cdecl FUN_00490640(double *param_1)
{
	if (0.0 <= *param_1) {
		return 1;
	}
	return 0;
}



void __cdecl FUN_00490660(int param_1,byte **param_2,byte *param_3)
{
	byte *local_8;
	byte *local_4;
	
	if (param_1 != 0) {
		FUN_00498060((uint *)&local_8,param_3);
		*param_2 = local_8;
		param_2[1] = local_4;
		return;
	}
	FUN_004980a0((uint *)&param_3,param_3);
	*param_2 = param_3;
	return;
}



undefined * __cdecl FUN_004906c0(undefined4 *param_1,undefined *param_2,int param_3,int param_4)
{
	int *piVar1;
	undefined *puVar2;
	int iVar3;
	undefined4 *puVar4;
	
	piVar1 = DAT_0054a128;
	if (DAT_0054a12c == '\0') {
		piVar1 = (int *)FUN_00498180((char)*param_1);
		FUN_004980e0((undefined4 *)(param_2 + (uint)(*piVar1 == 0x2d) + (uint)(0 < param_3)),param_3 + 1
								 ,(int)piVar1);
	}
	else {
		FUN_00490a80((undefined4 *)(param_2 + (*DAT_0054a128 == 0x2d)),(uint)(0 < param_3));
	}
	puVar2 = param_2;
	if (*piVar1 == 0x2d) {
		*param_2 = 0x2d;
		puVar2 = param_2 + 1;
	}
	if (0 < param_3) {
		*puVar2 = puVar2[1];
		puVar2 = puVar2 + 1;
		*puVar2 = DAT_004b0f78;
	}
	puVar4 = (undefined4 *)(puVar2 + param_3 + (uint)(DAT_0054a12c == '\0'));
	*puVar4 = 0x30302b65;
	*(undefined2 *)(puVar4 + 1) = 0x30;
	if (param_4 != 0) {
		*(undefined *)puVar4 = 0x45;
	}
	if (*(char *)piVar1[3] != '0') {
		iVar3 = piVar1[1] + -1;
		if (iVar3 < 0) {
			iVar3 = -iVar3;
			*(undefined *)((int)puVar4 + 1) = 0x2d;
		}
		if (99 < iVar3) {
			*(char *)((int)puVar4 + 2) = *(char *)((int)puVar4 + 2) + (char)(iVar3 / 100);
			iVar3 %= 100;
		}
		if (9 < iVar3) {
			*(char *)((int)puVar4 + 3) = *(char *)((int)puVar4 + 3) + (char)(iVar3 / 10);
			iVar3 %= 10;
		}
		*(char *)(puVar4 + 1) = *(char *)(puVar4 + 1) + (char)iVar3;
	}
	return param_2;
}



undefined4 * __cdecl FUN_00490800(undefined4 *param_1,undefined4 *param_2,uint param_3)
{
	int iVar1;
	undefined *puVar2;
	int *piVar3;
	uint uVar4;
	undefined4 *puVar5;
	
	piVar3 = DAT_0054a128;
	if (DAT_0054a12c == '\0') {
		piVar3 = (int *)FUN_00498180((char)*param_1);
		FUN_004980e0((undefined4 *)((uint)(*piVar3 == 0x2d) + (int)param_2),piVar3[1] + param_3,
								 (int)piVar3);
	}
	else {
		if (DAT_0054a130 == param_3) {
			puVar2 = (undefined *)((int)param_2 + DAT_0054a130 + (*DAT_0054a128 == 0x2d));
			*puVar2 = 0x30;
			puVar2[1] = 0;
		}
	}
	puVar5 = param_2;
	if (*piVar3 == 0x2d) {
		*(undefined *)param_2 = 0x2d;
		puVar5 = (undefined4 *)((int)param_2 + 1);
	}
	if (piVar3[1] < 1) {
		FUN_00490a80(puVar5,1);
		*(undefined *)puVar5 = 0x30;
		puVar5 = (undefined4 *)((int)puVar5 + 1);
	}
	else {
		puVar5 = (undefined4 *)((int)puVar5 + piVar3[1]);
	}
	if (0 < (int)param_3) {
		FUN_00490a80(puVar5,1);
		*(undefined *)puVar5 = DAT_004b0f78;
		iVar1 = piVar3[1];
		if (iVar1 < 0) {
			if ((DAT_0054a12c != '\0') || (SBORROW4(param_3,-iVar1) == (int)(param_3 + iVar1) < 0)) {
				param_3 = -iVar1;
			}
			FUN_00490a80((undefined4 *)((int)puVar5 + 1),param_3);
			puVar5 = (undefined4 *)((int)puVar5 + 1);
			for (uVar4 = param_3 >> 2; uVar4 != 0; uVar4 -= 1) {
				*puVar5 = 0x30303030;
				puVar5 = puVar5 + 1;
			}
			for (uVar4 = param_3 & 3; uVar4 != 0; uVar4 -= 1) {
				*(undefined *)puVar5 = 0x30;
				puVar5 = (undefined4 *)((int)puVar5 + 1);
			}
		}
	}
	return param_2;
}



void __cdecl FUN_00490900(undefined4 *param_1,undefined4 *param_2,uint param_3,int param_4)
{
	char cVar1;
	undefined4 *puVar2;
	
	DAT_0054a128 = (int *)FUN_00498180((char)*param_1);
	DAT_0054a130 = DAT_0054a128[1] + -1;
	puVar2 = (undefined4 *)((uint)(*DAT_0054a128 == 0x2d) + (int)param_2);
	FUN_004980e0(puVar2,param_3,(int)DAT_0054a128);
	DAT_0054a134 = DAT_0054a130 < DAT_0054a128[1] + -1;
	DAT_0054a130 = DAT_0054a128[1] + -1;
	if ((-5 < DAT_0054a130) && (DAT_0054a130 < (int)param_3)) {
		if ((bool)DAT_0054a134) {
			cVar1 = *(char *)puVar2;
			while (cVar1 != '\0') {
				cVar1 = *(char *)(undefined4 *)((int)puVar2 + 1);
				puVar2 = (undefined4 *)((int)puVar2 + 1);
			}
			*(undefined *)((int)puVar2 + -1) = 0;
		}
		FUN_004909e0(param_1,param_2,param_3);
		return;
	}
	FUN_004909b0(param_1,(undefined *)param_2,param_3,param_4);
	return;
}



void __cdecl FUN_004909b0(undefined4 param_1,undefined *param_2,int param_3,int param_4)
{
	DAT_0054a12c = 1;
	FUN_004906c0(param_1,param_2,param_3,param_4);
	DAT_0054a12c = 0;
	return;
}



void __cdecl FUN_004909e0(undefined4 param_1,undefined4 *param_2,uint param_3)
{
	DAT_0054a12c = 1;
	FUN_00490800(param_1,param_2,param_3);
	DAT_0054a12c = 0;
	return;
}



void __cdecl FUN_00490a80(undefined4 *param_1,int param_2)
{
	char cVar1;
	uint uVar2;
	undefined4 *puVar3;
	
	if (param_2 != 0) {
		uVar2 = 0xffffffff;
		puVar3 = param_1;
		do {
			if (uVar2 == 0) break;
			uVar2 -= 1;
			cVar1 = *(char *)puVar3;
			puVar3 = (undefined4 *)((int)puVar3 + 1);
		} while (cVar1 != '\0');
		FUN_004982c0((undefined4 *)(param_2 + (int)param_1),param_1,~uVar2);
	}
	return;
}



undefined * __cdecl FUN_00490ab0(byte *param_1)
{
	byte *pbVar1;
	uint uVar2;
	int iVar3;
	uint uVar4;
	uint local_14;
	undefined4 uStack16;
	ushort local_c [6];
	
	pbVar1 = param_1;
	uVar4 = 0;
	uVar2 = FUN_00498610(local_c,&param_1,param_1,0,0,0,0);
	if ((uVar2 & 4) == 0) {
		iVar3 = FUN_00498020(local_c,&local_14);
		if (((uVar2 & 2) != 0) || (iVar3 == 1)) {
			uVar4 = 0x80;
		}
		if (((uVar2 & 1) != 0) || (iVar3 == 2)) {
			uVar4 |= 0x100;
		}
	}
	else {
		uVar4 = 0x200;
		local_14 = 0;
		uStack16 = 0;
	}
	*(uint *)PTR_DAT_004b0f98 = uVar4;
	*(byte **)(PTR_DAT_004b0f98 + 4) = param_1 + -(int)pbVar1;
	*(ulonglong *)(PTR_DAT_004b0f98 + 0x10) = CONCAT44(uStack16,local_14);
	return PTR_DAT_004b0f98;
}



uint __cdecl FUN_00490b60(uint param_1,char **param_2)
{
	char *pcVar1;
	char *pcVar2;
	char **ppcVar3;
	uint uVar4;
	undefined *puVar5;
	char *pcVar6;
	char *pcVar7;
	
	ppcVar3 = param_2;
	pcVar7 = param_2[3];
	pcVar1 = param_2[4];
	if ((((uint)pcVar7 & 0x82) == 0) || (((uint)pcVar7 & 0x40) != 0)) {
LAB_00490c80:
		param_2[3] = (char *)((uint)pcVar7 | 0x20);
		return 0xffffffff;
	}
	pcVar6 = NULL;
	if (((uint)pcVar7 & 1) != 0) {
		param_2[1] = NULL;
		if (((uint)pcVar7 & 0x10) == 0) goto LAB_00490c80;
		*param_2 = param_2[2];
		param_2[3] = (char *)((uint)pcVar7 & 0xfffffffe);
	}
	pcVar7 = param_2[3];
	param_2[1] = NULL;
	param_2[3] = (char *)((uint)pcVar7 & 0xffffffef | 2);
	if (((uint)pcVar7 & 0x10c) == 0) {
		if ((param_2 == (char **)&DAT_004b3648) || (param_2 == (char **)&DAT_004b3668)) {
			uVar4 = FUN_00498e00((uint)pcVar1);
			if (uVar4 != 0) goto LAB_00490bd3;
		}
		FUN_00498da0((int *)ppcVar3);
	}
LAB_00490bd3:
	if (((uint)ppcVar3[3] & 0x108) == 0) {
		pcVar7 = (char *)0x1;
		pcVar6 = (char *)std::__fdwrite__00496f80((uint)pcVar1,(char *)&param_1,(char *)0x1);
	}
	else {
		pcVar2 = ppcVar3[2];
		pcVar7 = *ppcVar3 + -(int)pcVar2;
		*ppcVar3 = pcVar2 + 1;
		ppcVar3[1] = ppcVar3[6] + -1;
		if ((int)pcVar7 < 1) {
			if (pcVar1 == (char *)0xffffffff) {
				puVar5 = &DAT_004b3428;
			}
			else {
				puVar5 = (undefined *)((&DAT_0076edc0)[(int)pcVar1 >> 5] + ((uint)pcVar1 & 0x1f) * 8);
			}
			if ((puVar5[4] & 0x20) != 0) {
				FUN_00496ec0((uint)pcVar1,0,2);
			}
			*ppcVar3[2] = (char)param_1;
		}
		else {
			pcVar6 = (char *)std::__fdwrite__00496f80((uint)pcVar1,pcVar2,pcVar7);
			*ppcVar3[2] = (char)param_1;
		}
	}
	if (pcVar6 != pcVar7) {
		ppcVar3[3] = (char *)((uint)ppcVar3[3] | 0x20);
		return 0xffffffff;
	}
	return param_1 & 0xff;
}



// WARNING: Could not reconcile some variable overlaps

int __cdecl std::_sprintf_internal_2__00490c90(char **param_1,char *param_2,char *param_3,...)
{
	char cVar1;
	char **ppcVar2;
	uint uVar3;
	short *psVar4;
	int *piVar5;
	undefined4 uVar6;
	LPSTR pCVar7;
	byte bVar8;
	ushort *puVar9;
	ushort *puVar10;
	ushort *puVar11;
	byte *pbVar12;
	char *pcVar13;
	uint uVar14;
	int iVar15;
	ulonglong uVar16;
	undefined8 uVar17;
	ulonglong uVar18;
	uint local_24c;
	ushort *local_248;
	int local_244;
	int local_240;
	char local_23a;
	char local_239;
	int local_238;
	int local_234;
	int local_230;
	uint local_22c;
	int local_228;
	int local_224;
	int local_220;
	uint local_21c;
	undefined4 local_218;
	CHAR local_214 [4];
	undefined4 local_210;
	undefined4 local_20c;
	uint local_204;
	undefined local_200 [512];
	
	local_220 = 0;
	puVar10 = NULL;
	local_240 = 0;
	bVar8 = *param_2;
	pbVar12 = (byte *)(param_2 + 1);
	local_21c = local_21c & 0xffffff00 | (uint)bVar8;
	do {
		if ((bVar8 == 0) || (local_240 < 0)) {
			return local_240;
		}
		if (((char)bVar8 < ' ') || ('x' < (char)bVar8)) {
			uVar3 = 0;
		}
		else {
			uVar3 = (byte)"IsProcessorFeaturePresent"[(char)bVar8 + 0x18] & 0xf;
		}
		local_220 = (int)(char)(&DAT_0049fb70)[uVar3 * 8 + local_220] >> 4;
		param_2 = (char *)pbVar12;
		switch(local_220) {
		case 0:
switchD_00490d0d_caseD_0:
			local_230 = 0;
			if ((*(byte *)(globals::g_CharTranslate_TABLE._0_4_ + 1 + (local_21c & 0xff) * 2) & 0x80) != 0
				 ) {
				FUN_00491620((int)(char)bVar8,param_1,&local_240);
				bVar8 = *pbVar12;
				param_2 = (char *)(pbVar12 + 1);
			}
			FUN_00491620((int)(char)bVar8,param_1,&local_240);
			break;
		case 1:
			local_218 = 0;
			local_228 = 0;
			local_234 = 0;
			local_238 = 0;
			local_24c = 0;
			local_244 = -1;
			local_230 = 0;
			break;
		case 2:
			if (true) {
				switch(bVar8) {
				case 0x20:
					local_24c |= 2;
					break;
				case 0x23:
					local_24c |= 0x80;
					break;
				case 0x2b:
					local_24c |= 1;
					break;
				case 0x2d:
					local_24c |= 4;
					break;
				case 0x30:
					local_24c |= 8;
				}
			}
			break;
		case 3:
			if (bVar8 == 0x2a) {
				local_234 = FUN_004916f0((int *)&param_3);
				if (local_234 < 0) {
					local_24c |= 4;
					local_234 = -local_234;
				}
			}
			else {
				local_234 = (char)bVar8 + -0x30 + local_234 * 10;
			}
			break;
		case 4:
			local_244 = 0;
			break;
		case 5:
			if (bVar8 == 0x2a) {
				local_244 = FUN_004916f0((int *)&param_3);
				if (local_244 < 0) {
					local_244 = -1;
				}
			}
			else {
				local_244 = (char)bVar8 + -0x30 + local_244 * 10;
			}
			break;
		case 6:
			if (true) {
				switch(bVar8) {
				case 0x49:
					if ((*pbVar12 != 0x36) || (pbVar12[1] != 0x34)) {
						local_220 = 0;
						goto switchD_00490d0d_caseD_0;
					}
					param_2 = (char *)(pbVar12 + 2);
					local_24c |= 0x8000;
					break;
				case 0x68:
					local_24c |= 0x20;
					break;
				case 0x6c:
					local_24c |= 0x10;
					break;
				case 0x77:
					local_24c |= 0x800;
				}
			}
			break;
		case 7:
			if (false) goto switchD_00490f21_caseD_44;
			switch(bVar8) {
			case 0x43:
				if ((local_24c & 0x830) == 0) {
					local_24c |= 0x800;
				}
			case 99:
				if ((local_24c & 0x810) == 0) {
					uVar6 = FUN_004916f0((int *)&param_3);
					local_200[0] = (char)uVar6;
					puVar10 = (ushort *)0x1;
				}
				else {
					uVar3 = FUN_00491730((ushort **)&param_3);
					puVar10 = (ushort *)FUN_00498e30(local_200,(ushort)uVar3);
					if ((int)puVar10 < 0) {
						local_248 = (ushort *)local_200;
						local_228 = 1;
						break;
					}
				}
				local_248 = (ushort *)local_200;
				break;
			case 0x45:
			case 0x47:
				local_218 = 1;
				bVar8 += 0x20;
			case 0x65:
			case 0x66:
			case 0x67:
				local_248 = (ushort *)local_200;
				if (local_244 < 0) {
					local_244 = 6;
				}
				else {
					if ((local_244 == 0) && (bVar8 == 0x67)) {
						local_244 = 1;
					}
				}
				local_210 = *(undefined4 *)param_3;
				local_20c = *(undefined4 *)((int)param_3 + 4);
				param_3 = (char *)((int)param_3 + 8);
				(*(code *)PTR_FUN_004b0f80)(&local_210,local_200,(int)(char)bVar8,local_244,local_218);
				if (((local_24c & 0x80) != 0) && (local_244 == 0)) {
					(*(code *)PTR_FUN_004b0f8c)(local_200);
				}
				if ((bVar8 == 0x67) && ((local_24c & 0x80) == 0)) {
					(*(code *)PTR_FUN_004b0f84)(local_200);
				}
				uVar3 = local_24c | 0x40;
				if (local_200[0] == '-') {
					local_248 = (ushort *)(local_200 + 1);
					uVar3 = local_24c | 0x140;
				}
				local_24c = uVar3;
				uVar3 = 0xffffffff;
				puVar10 = local_248;
				do {
					if (uVar3 == 0) break;
					uVar3 -= 1;
					cVar1 = *(char *)puVar10;
					puVar10 = (ushort *)((int)puVar10 + 1);
				} while (cVar1 != '\0');
				puVar10 = (ushort *)(~uVar3 - 1);
				break;
			case 0x53:
				if ((local_24c & 0x830) == 0) {
					local_24c |= 0x800;
				}
			case 0x73:
				iVar15 = 0x7fffffff;
				if (local_244 != -1) {
					iVar15 = local_244;
				}
				local_248 = (ushort *)FUN_004916f0((int *)&param_3);
				if ((local_24c & 0x810) == 0) {
					puVar10 = local_248;
					if (local_248 == NULL) {
						puVar10 = (ushort *)PTR_s__null__004b0f9c;
						local_248 = (ushort *)PTR_s__null__004b0f9c;
					}
					for (; (iVar15 != 0 && (iVar15 += -1, *(char *)puVar10 != '\0'));
							puVar10 = (ushort *)((int)puVar10 + 1)) {
					}
					puVar10 = (ushort *)((int)puVar10 - (int)local_248);
				}
				else {
					if (local_248 == NULL) {
						local_248 = (ushort *)PTR_u__null__004b0fa0;
					}
					local_230 = 1;
					for (puVar10 = local_248; (iVar15 != 0 && (iVar15 += -1, *puVar10 != 0));
							puVar10 = puVar10 + 1) {
					}
					puVar10 = (ushort *)((int)((int)puVar10 - (int)local_248) >> 1);
				}
				break;
			case 0x58:
				goto switchD_00490f21_caseD_58;
			case 0x5a:
				psVar4 = (short *)FUN_004916f0((int *)&param_3);
				if ((psVar4 == NULL) || (local_248 = *(ushort **)(psVar4 + 2), local_248 == NULL)) {
					uVar3 = 0xffffffff;
					local_248 = (ushort *)PTR_s__null__004b0f9c;
					pcVar13 = PTR_s__null__004b0f9c;
					do {
						if (uVar3 == 0) break;
						uVar3 -= 1;
						cVar1 = *pcVar13;
						pcVar13 = pcVar13 + 1;
					} while (cVar1 != '\0');
					puVar10 = (ushort *)(~uVar3 - 1);
				}
				else {
					if ((local_24c & 0x800) == 0) {
						puVar10 = (ushort *)(int)*psVar4;
						local_230 = 0;
					}
					else {
						local_230 = 1;
						puVar10 = (ushort *)((uint)(int)*psVar4 >> 1);
					}
				}
				break;
			case 100:
			case 0x69:
				local_22c = 10;
				local_24c |= 0x40;
				goto LAB_00491257;
			case 0x6e:
				piVar5 = (int *)FUN_004916f0((int *)&param_3);
				if ((local_24c & 0x20) == 0) {
					local_228 = 1;
					*piVar5 = local_240;
				}
				else {
					local_228 = 1;
					*(undefined2 *)piVar5 = (undefined2)local_240;
				}
				break;
			case 0x6f:
				local_22c = 8;
				if ((local_24c & 0x80) != 0) {
					local_24c |= 0x200;
				}
				goto LAB_00491257;
			case 0x70:
				local_244 = 8;
switchD_00490f21_caseD_58:
				local_224 = 7;
LAB_00491212:
				local_22c = 0x10;
				if ((local_24c & 0x80) != 0) {
					local_23a = '0';
					local_239 = (char)local_224 + 'Q';
					local_238 = 2;
				}
				goto LAB_00491257;
			case 0x75:
				local_22c = 10;
LAB_00491257:
				if ((local_24c & 0x8000) == 0) {
					if ((local_24c & 0x20) == 0) {
						if ((local_24c & 0x40) == 0) {
							uVar3 = FUN_004916f0((int *)&param_3);
							uVar16 = (ulonglong)uVar3;
						}
						else {
							iVar15 = FUN_004916f0((int *)&param_3);
							uVar16 = SEXT48(iVar15);
						}
					}
					else {
						if ((local_24c & 0x40) == 0) {
							uVar3 = FUN_004916f0((int *)&param_3);
							uVar16 = (ulonglong)uVar3 & 0xffffffff0000ffff;
						}
						else {
							uVar6 = FUN_004916f0((int *)&param_3);
							uVar16 = SEXT48((int)(short)uVar6);
						}
					}
				}
				else {
					uVar16 = FUN_00491710((int *)&param_3);
				}
				iVar15 = (int)(uVar16 >> 0x20);
				if ((((local_24c & 0x40) != 0) && (iVar15 == 0 || (longlong)uVar16 < 0)) &&
					 (((longlong)uVar16 < 0 || (false)))) {
					local_24c |= 0x100;
					uVar16 = CONCAT44(-(iVar15 + (uint)((int)uVar16 != 0)),-(int)uVar16);
				}
				uVar3 = (uint)(uVar16 >> 0x20);
				if ((local_24c & 0x8000) == 0) {
					uVar3 = 0;
				}
				uVar18 = uVar16 & 0xffffffff | (ulonglong)uVar3 << 0x20;
				if (local_244 < 0) {
					local_244 = 1;
				}
				else {
					local_24c &= 0xfffffff7;
				}
				if (((uint)uVar16 | uVar3) == 0) {
					local_238 = 0;
				}
				puVar9 = (ushort *)(local_200 + 0x1ff);
				iVar15 = local_244;
				while( true ) {
					uVar3 = local_22c;
					uVar14 = (uint)(uVar18 >> 0x20);
					local_244 = iVar15 + -1;
					if ((iVar15 < 1) && (uVar18 == 0)) break;
					local_204 = (int)local_22c >> 0x1f;
					uVar17 = __aullrem((uint)uVar18,uVar14,local_22c,local_204);
					iVar15 = (int)uVar17 + 0x30;
					uVar18 = __aulldiv((uint)uVar18,uVar14,uVar3,local_204);
					if (0x39 < iVar15) {
						iVar15 += local_224;
					}
					*(char *)puVar9 = (char)iVar15;
					puVar9 = (ushort *)((int)puVar9 + -1);
					iVar15 = local_244;
				}
				puVar10 = (ushort *)(local_200 + -(int)puVar9 + 0x1ff);
				local_248 = (ushort *)((int)puVar9 + 1);
				if (((local_24c & 0x200) != 0) && ((*(char *)local_248 != '0' || (puVar10 == NULL)))) {
					puVar10 = (ushort *)(&stack0x00000000 + -(int)puVar9);
					*(undefined *)puVar9 = 0x30;
					local_248 = puVar9;
				}
				break;
			case 0x78:
				local_224 = 0x27;
				goto LAB_00491212;
			}
switchD_00490f21_caseD_44:
			ppcVar2 = param_1;
			if (local_228 == 0) {
				if ((local_24c & 0x40) != 0) {
					if ((local_24c & 0x100) == 0) {
						if ((local_24c & 1) == 0) {
							if ((local_24c & 2) == 0) goto LAB_004913ef;
							local_23a = ' ';
						}
						else {
							local_23a = '+';
						}
					}
					else {
						local_23a = '-';
					}
					local_238 = 1;
				}
LAB_004913ef:
				iVar15 = (local_234 - local_238) - (int)puVar10;
				if ((local_24c & 0xc) == 0) {
					FUN_00491670(0x20,iVar15,param_1,&local_240);
				}
				FUN_004916b0(&local_23a,local_238,ppcVar2,&local_240);
				if (((local_24c & 8) != 0) && ((local_24c & 4) == 0)) {
					FUN_00491670(0x30,iVar15,ppcVar2,&local_240);
				}
				if ((local_230 == 0) || (puVar11 = local_248, puVar9 = puVar10, (int)puVar10 < 1)) {
					FUN_004916b0((char *)local_248,(int)puVar10,ppcVar2,&local_240);
				}
				else {
					do {
						puVar9 = (ushort *)((int)puVar9 + -1);
						pCVar7 = FUN_00498e30(local_214,*puVar11);
						if ((int)pCVar7 < 1) break;
						FUN_004916b0(local_214,(int)pCVar7,param_1,&local_240);
						puVar11 = puVar11 + 1;
					} while (puVar9 != NULL);
				}
				if ((local_24c & 4) != 0) {
					FUN_00491670(0x20,iVar15,param_1,&local_240);
				}
			}
		}
		bVar8 = *param_2;
		pbVar12 = (byte *)(param_2 + 1);
		local_21c = local_21c & 0xffffff00 | (uint)bVar8;
	} while( true );
}



void __cdecl FUN_00491620(uint param_1,char **param_2,int *param_3)
{
	char *pcVar1;
	uint uVar2;
	
	pcVar1 = param_2[1];
	param_2[1] = pcVar1 + -1;
	if ((int)(pcVar1 + -1) < 0) {
		uVar2 = FUN_00490b60(param_1,param_2);
	}
	else {
		**param_2 = (char)param_1;
		uVar2 = param_1 & 0xff;
		*param_2 = *param_2 + 1;
	}
	if (uVar2 == 0xffffffff) {
		*param_3 = -1;
		return;
	}
	*param_3 = *param_3 + 1;
	return;
}



void __cdecl FUN_00491670(uint param_1,int param_2,char **param_3,int *param_4)
{
	if (0 < param_2) {
		do {
			param_2 += -1;
			FUN_00491620(param_1,param_3,param_4);
			if (*param_4 == -1) {
				return;
			}
		} while (0 < param_2);
	}
	return;
}



void __cdecl FUN_004916b0(char *param_1,int param_2,char **param_3,int *param_4)
{
	char cVar1;
	
	if (0 < param_2) {
		do {
			param_2 += -1;
			cVar1 = *param_1;
			param_1 = param_1 + 1;
			FUN_00491620((int)cVar1,param_3,param_4);
			if (*param_4 == -1) {
				return;
			}
		} while (0 < param_2);
	}
	return;
}



undefined4 __cdecl FUN_004916f0(int *param_1)
{
	undefined4 *puVar1;
	
	puVar1 = (undefined4 *)*param_1;
	*param_1 = (int)(puVar1 + 1);
	return *puVar1;
}



undefined8 __cdecl FUN_00491710(int *param_1)
{
	undefined8 *puVar1;
	
	puVar1 = (undefined8 *)*param_1;
	*param_1 = (int)(puVar1 + 1);
	return *puVar1;
}



uint __cdecl FUN_00491730(ushort **param_1)
{
	ushort *puVar1;
	ushort *puVar2;
	
	puVar1 = *param_1;
	puVar2 = puVar1 + 2;
	*param_1 = puVar2;
	return (uint)puVar2 & 0xffff0000 | (uint)*puVar1;
}



uint * __cdecl FUN_00491760(uint *param_1,char param_2)
{
	uint uVar1;
	char cVar2;
	uint uVar3;
	uint uVar4;
	uint *puVar5;
	
	uVar1 = (uint)param_1 & 3;
	while (uVar1 != 0) {
		if (*(char *)param_1 == param_2) {
			return param_1;
		}
		if (*(char *)param_1 == '\0') {
			return NULL;
		}
		uVar1 = (uint)(uint *)((int)param_1 + 1) & 3;
		param_1 = (uint *)((int)param_1 + 1);
	}
	while( true ) {
		while( true ) {
			uVar1 = *param_1;
			uVar4 = uVar1 ^ CONCAT22(CONCAT11(param_2,param_2),CONCAT11(param_2,param_2));
			uVar3 = uVar1 ^ 0xffffffff ^ uVar1 + 0x7efefeff;
			puVar5 = param_1 + 1;
			if (((uVar4 ^ 0xffffffff ^ uVar4 + 0x7efefeff) & 0x81010100) != 0) break;
			param_1 = puVar5;
			if ((uVar3 & 0x81010100) != 0) {
				if ((uVar3 & 0x1010100) != 0) {
					return NULL;
				}
				if ((uVar1 + 0x7efefeff & 0x80000000) == 0) {
					return NULL;
				}
			}
		}
		uVar1 = *param_1;
		if ((char)uVar1 == param_2) {
			return param_1;
		}
		if ((char)uVar1 == '\0') {
			return NULL;
		}
		cVar2 = (char)(uVar1 >> 8);
		if (cVar2 == param_2) {
			return (uint *)((int)param_1 + 1);
		}
		if (cVar2 == '\0') break;
		cVar2 = (char)(uVar1 >> 0x10);
		if (cVar2 == param_2) {
			return (uint *)((int)param_1 + 2);
		}
		if (cVar2 == '\0') {
			return NULL;
		}
		cVar2 = (char)(uVar1 >> 0x18);
		if (cVar2 == param_2) {
			return (uint *)((int)param_1 + 3);
		}
		param_1 = puVar5;
		if (cVar2 == '\0') {
			return NULL;
		}
	}
	return NULL;
}



undefined4 FUN_00491820(void)
{
	undefined **ppuVar1;
	
	DAT_0076eec4 = HeapCreate(1,0x1000,0);
	if (DAT_0076eec4 == NULL) {
		return 0;
	}
	ppuVar1 = FUN_00491860();
	if (ppuVar1 == NULL) {
		HeapDestroy(DAT_0076eec4);
		return 0;
	}
	return 1;
}



undefined ** FUN_00491860(void)
{
	bool bVar1;
	undefined4 *lpAddress;
	LPVOID pvVar2;
	int iVar3;
	undefined **ppuVar4;
	undefined **lpMem;
	undefined4 *puVar5;
	
	if (DAT_004b0fc8 == -1) {
		lpMem = &PTR_LOOP_004b0fb8;
	}
	else {
		lpMem = (undefined **)HeapAlloc(DAT_0076eec4,0,0x2020);
		if (lpMem == NULL) {
			return NULL;
		}
	}
	lpAddress = (undefined4 *)VirtualAlloc(NULL,0x400000,0x2000,4);
	if (lpAddress != NULL) {
		pvVar2 = VirtualAlloc(lpAddress,0x10000,0x1000,4);
		if (pvVar2 != NULL) {
			if (lpMem == &PTR_LOOP_004b0fb8) {
				if (PTR_LOOP_004b0fb8 == NULL) {
					PTR_LOOP_004b0fb8 = &PTR_LOOP_004b0fb8;
				}
				if (PTR_LOOP_004b0fbc == NULL) {
					PTR_LOOP_004b0fbc = &PTR_LOOP_004b0fb8;
				}
			}
			else {
				*lpMem = (undefined *)&PTR_LOOP_004b0fb8;
				lpMem[1] = (undefined *)PTR_LOOP_004b0fbc;
				PTR_LOOP_004b0fbc = lpMem;
				*(undefined ***)lpMem[1] = lpMem;
			}
			lpMem[5] = (undefined *)(lpAddress + 0x100000);
			lpMem[4] = (undefined *)lpAddress;
			lpMem[2] = (undefined *)(lpMem + 6);
			lpMem[3] = (undefined *)(lpMem + 0x26);
			iVar3 = 0;
			ppuVar4 = lpMem + 6;
			do {
				bVar1 = 0xf < iVar3;
				iVar3 += 1;
				*ppuVar4 = (undefined *)((bVar1 - 1 & 0xf1) - 1);
				ppuVar4[1] = (undefined *)0xf1;
				ppuVar4 = ppuVar4 + 2;
			} while (iVar3 < 0x400);
			puVar5 = lpAddress;
			for (iVar3 = 0x4000; iVar3 != 0; iVar3 += -1) {
				*puVar5 = 0;
				puVar5 = puVar5 + 1;
			}
			if (lpAddress < lpMem[4] + 0x10000) {
				do {
					lpAddress[1] = 0xf0;
					*lpAddress = lpAddress + 2;
					*(undefined *)(lpAddress + 0x3e) = 0xff;
					lpAddress = lpAddress + 0x400;
				} while (lpAddress < lpMem[4] + 0x10000);
			}
			return lpMem;
		}
		VirtualFree(lpAddress,0,0x8000);
	}
	if (lpMem != &PTR_LOOP_004b0fb8) {
		HeapFree(DAT_0076eec4,0,lpMem);
	}
	return NULL;
}



void __cdecl FUN_004919d0(undefined **param_1)
{
	VirtualFree(param_1[4],0,0x8000);
	if ((undefined **)PTR_LOOP_004b2fd8 == param_1) {
		PTR_LOOP_004b2fd8 = param_1[1];
	}
	if (param_1 != &PTR_LOOP_004b0fb8) {
		*(undefined **)param_1[1] = *param_1;
		*(undefined **)(*param_1 + 4) = param_1[1];
		HeapFree(DAT_0076eec4,0,param_1);
		return;
	}
	DAT_004b0fc8 = 0xffffffff;
	return;
}



void __cdecl FUN_00491a30(int param_1)
{
	BOOL BVar1;
	undefined **ppuVar2;
	int iVar3;
	int iVar4;
	undefined **ppuVar5;
	undefined **ppuVar6;
	
	ppuVar6 = (undefined **)PTR_LOOP_004b0fbc;
	do {
		ppuVar5 = ppuVar6;
		if (ppuVar6[4] != (undefined *)0xffffffff) {
			iVar4 = 0;
			ppuVar5 = ppuVar6 + 0x804;
			iVar3 = 0x3ff000;
			do {
				if (*ppuVar5 == (undefined *)0xf0) {
					BVar1 = VirtualFree(ppuVar6[4] + iVar3,0x1000,0x4000);
					if (BVar1 != 0) {
						*ppuVar5 = (undefined *)0xffffffff;
						DAT_0054a150 += -1;
						if (((undefined **)ppuVar6[3] == NULL) || (ppuVar5 < ppuVar6[3])) {
							ppuVar6[3] = (undefined *)ppuVar5;
						}
						iVar4 += 1;
						param_1 += -1;
						if (param_1 == 0) break;
					}
				}
				iVar3 += -0x1000;
				ppuVar5 = ppuVar5 + -2;
			} while (-1 < iVar3);
			ppuVar5 = (undefined **)ppuVar6[1];
			if ((iVar4 != 0) && (ppuVar6[6] == (undefined *)0xffffffff)) {
				iVar3 = 1;
				ppuVar2 = ppuVar6 + 8;
				do {
					if (*ppuVar2 != (undefined *)0xffffffff) break;
					iVar3 += 1;
					ppuVar2 = ppuVar2 + 2;
				} while (iVar3 < 0x400);
				if (iVar3 == 0x400) {
					FUN_004919d0(ppuVar6);
				}
			}
		}
		if ((ppuVar5 == (undefined **)PTR_LOOP_004b0fbc) || (ppuVar6 = ppuVar5, param_1 < 1)) {
			return;
		}
	} while( true );
}



int __cdecl FUN_00491b00(undefined *param_1,int **param_2,uint *param_3)
{
	undefined **ppuVar1;
	uint uVar2;
	
	ppuVar1 = &PTR_LOOP_004b0fb8;
	while ((param_1 < ppuVar1[4] || param_1 == ppuVar1[4] || (ppuVar1[5] <= param_1))) {
		ppuVar1 = (undefined **)*ppuVar1;
		if (ppuVar1 == &PTR_LOOP_004b0fb8) {
			return 0;
		}
	}
	if (((uint)param_1 & 0xf) != 0) {
		return 0;
	}
	if (((uint)param_1 & 0xfff) < 0x100) {
		return 0;
	}
	*param_2 = (int *)ppuVar1;
	uVar2 = (uint)param_1 & 0xfffff000;
	*param_3 = uVar2;
	return ((int)(param_1 + (-0x100 - uVar2)) >> 4) + 8 + uVar2;
}



void __cdecl FUN_00491b60(int param_1,int param_2,byte *param_3)
{
	int *piVar1;
	int iVar2;
	
	iVar2 = param_2 - *(int *)(param_1 + 0x10) >> 0xc;
	piVar1 = (int *)(param_1 + 0x18 + iVar2 * 8);
	*piVar1 = *(int *)(param_1 + 0x18 + iVar2 * 8) + (uint)*param_3;
	*param_3 = 0;
	piVar1[1] = 0xf1;
	if ((*piVar1 == 0xf0) && (DAT_0054a150 += 1, DAT_0054a150 == 0x20)) {
		FUN_00491a30(0x10);
	}
	return;
}



int * __cdecl FUN_00491bc0(int *param_1)
{
	undefined **ppuVar1;
	undefined **ppuVar2;
	undefined *puVar3;
	int *piVar4;
	int *piVar5;
	undefined **ppuVar6;
	undefined **ppuVar7;
	int **ppiVar8;
	int iVar9;
	int **ppiVar10;
	int **ppiVar11;
	bool bVar12;
	int *local_4;
	
	local_4 = (int *)PTR_LOOP_004b2fd8;
	do {
		if (local_4[4] != -1) {
			ppiVar10 = (int **)local_4[2];
			ppiVar8 = (int **)(((int)ppiVar10 + (-0x18 - (int)local_4) >> 3) * 0x1000 + local_4[4]);
			for (; ppiVar10 < local_4 + 0x806; ppiVar10 = ppiVar10 + 2) {
				if (((int)param_1 <= (int)*ppiVar10) && (param_1 <= ppiVar10[1] && ppiVar10[1] != param_1))
				{
					piVar4 = (int *)FUN_00491e00(ppiVar8,*ppiVar10,param_1);
					if (piVar4 != NULL) {
						PTR_LOOP_004b2fd8 = (undefined *)local_4;
						*ppiVar10 = (int *)((int)*ppiVar10 - (int)param_1);
						local_4[2] = (int)ppiVar10;
						return piVar4;
					}
					ppiVar10[1] = param_1;
				}
				ppiVar8 = ppiVar8 + 0x400;
			}
			ppiVar8 = (int **)local_4[2];
			ppiVar11 = (int **)local_4[4];
			for (ppiVar10 = (int **)(local_4 + 6); ppiVar10 < ppiVar8; ppiVar10 = ppiVar10 + 2) {
				if (((int)param_1 <= (int)*ppiVar10) && (param_1 <= ppiVar10[1] && ppiVar10[1] != param_1))
				{
					piVar4 = (int *)FUN_00491e00(ppiVar11,*ppiVar10,param_1);
					if (piVar4 != NULL) {
						PTR_LOOP_004b2fd8 = (undefined *)local_4;
						*ppiVar10 = (int *)((int)*ppiVar10 - (int)param_1);
						local_4[2] = (int)ppiVar10;
						return piVar4;
					}
					ppiVar10[1] = param_1;
				}
				ppiVar11 = ppiVar11 + 0x400;
			}
		}
		local_4 = (int *)*local_4;
	} while (local_4 != (int *)PTR_LOOP_004b2fd8);
	ppuVar7 = &PTR_LOOP_004b0fb8;
	while ((ppuVar7[4] == (undefined *)0xffffffff || (ppuVar7[3] == NULL))) {
		ppuVar7 = (undefined **)*ppuVar7;
		if (ppuVar7 == &PTR_LOOP_004b0fb8) {
			ppuVar7 = FUN_00491860();
			if (ppuVar7 == NULL) {
				return NULL;
			}
			piVar4 = (int *)ppuVar7[4];
			*(char *)(piVar4 + 2) = (char)param_1;
			PTR_LOOP_004b2fd8 = (undefined *)ppuVar7;
			*piVar4 = (int)((int)piVar4 + 8) + (int)param_1;
			piVar4[1] = 0xf0 - (int)param_1;
			ppuVar7[6] = ppuVar7[6] + -((uint)param_1 & 0xff);
			return piVar4 + 0x40;
		}
	}
	ppuVar2 = (undefined **)ppuVar7[3];
	puVar3 = *ppuVar2;
	piVar4 = (int *)(ppuVar7[4] + ((int)ppuVar2 + (-0x18 - (int)ppuVar7) >> 3) * 0x1000);
	ppuVar6 = ppuVar2;
	for (iVar9 = 0; (puVar3 == (undefined *)0xffffffff && (iVar9 < 0x10)); iVar9 += 1) {
		puVar3 = ppuVar6[2];
		ppuVar6 = ppuVar6 + 2;
	}
	piVar5 = (int *)VirtualAlloc(piVar4,iVar9 << 0xc,0x1000,4);
	if (piVar5 != piVar4) {
		return NULL;
	}
	ppuVar6 = ppuVar2;
	if (0 < iVar9) {
		piVar5 = piVar4 + 1;
		do {
			*piVar5 = 0xf0;
			piVar5[-1] = (int)(piVar5 + 1);
			*(undefined *)(piVar5 + 0x3d) = 0xff;
			*ppuVar6 = (undefined *)0xf0;
			ppuVar6[1] = (undefined *)0xf1;
			piVar5 = piVar5 + 0x400;
			ppuVar6 = ppuVar6 + 2;
			iVar9 += -1;
		} while (iVar9 != 0);
	}
	ppuVar1 = ppuVar7 + 0x806;
	bVar12 = ppuVar6 < ppuVar1;
	if (bVar12) {
		do {
			if (*ppuVar6 == (undefined *)0xffffffff) break;
			ppuVar6 = ppuVar6 + 2;
		} while (ppuVar6 < ppuVar1);
		bVar12 = ppuVar6 < ppuVar1;
	}
	PTR_LOOP_004b2fd8 = (undefined *)ppuVar7;
	ppuVar7[3] = (undefined *)(-(uint)bVar12 & (uint)ppuVar6);
	*(char *)(piVar4 + 2) = (char)param_1;
	ppuVar7[2] = (undefined *)ppuVar2;
	*ppuVar2 = *ppuVar2 + -(int)param_1;
	piVar4[1] = piVar4[1] - (int)param_1;
	*piVar4 = (int)((int)piVar4 + 8) + (int)param_1;
	return piVar4 + 0x40;
}



int __cdecl FUN_00491e00(int **param_1,int *param_2,int *param_3)
{
	byte bVar1;
	int **ppiVar2;
	int **ppiVar3;
	int **ppiVar4;
	int *piVar5;
	int **ppiVar6;
	
	ppiVar2 = (int **)*param_1;
	if (param_3 <= param_1[1]) {
		*(byte *)ppiVar2 = (byte)param_3;
		if ((int **)((int)ppiVar2 + (int)param_3) < param_1 + 0x3e) {
			*param_1 = (int *)((int)*param_1 + (int)param_3);
			param_1[1] = (int *)((int)param_1[1] - (int)param_3);
		}
		else {
			param_1[1] = NULL;
			*param_1 = (int *)(param_1 + 2);
		}
		return (int)(ppiVar2 + 2) * 0x10 + (int)param_1 * -0xf;
	}
	ppiVar3 = (int **)((int)param_1[1] + (int)ppiVar2);
	ppiVar6 = ppiVar2;
	if (*(byte *)ppiVar3 != 0) {
		ppiVar6 = ppiVar3;
	}
	if ((int **)((int)ppiVar6 + (int)param_3) < param_1 + 0x3e) {
		do {
			if (*(byte *)ppiVar6 == 0) {
				ppiVar3 = (int **)((int)ppiVar6 + 1);
				piVar5 = (int *)0x1;
				bVar1 = *(byte *)((int)ppiVar6 + 1);
				while (bVar1 == 0) {
					ppiVar3 = (int **)((int)ppiVar3 + 1);
					piVar5 = (int *)((int)piVar5 + 1);
					bVar1 = *(byte *)ppiVar3;
				}
				if (param_3 <= piVar5) {
					if (param_1 + 0x3e <= (int **)((int)ppiVar6 + (int)param_3)) {
						*param_1 = (int *)(param_1 + 2);
						goto LAB_00491f4f;
					}
					*param_1 = (int *)(int **)((int)ppiVar6 + (int)param_3);
					param_1[1] = (int *)((int)piVar5 - (int)param_3);
					goto LAB_00491f56;
				}
				if (ppiVar6 == ppiVar2) {
					param_1[1] = piVar5;
				}
				else {
					param_2 = (int *)((int)param_2 - (int)piVar5);
					if (param_2 < param_3) {
						return 0;
					}
				}
			}
			else {
				ppiVar3 = (int **)((int)ppiVar6 + (uint)*(byte *)ppiVar6);
			}
			ppiVar6 = ppiVar3;
		} while ((int **)((int)ppiVar3 + (int)param_3) < param_1 + 0x3e);
	}
	ppiVar3 = param_1 + 2;
	ppiVar6 = ppiVar3;
	if (ppiVar3 < ppiVar2) {
		while ((int **)((int)ppiVar6 + (int)param_3) < param_1 + 0x3e) {
			if (*(byte *)ppiVar6 == 0) {
				ppiVar4 = (int **)((int)ppiVar6 + 1);
				piVar5 = (int *)0x1;
				bVar1 = *(byte *)((int)ppiVar6 + 1);
				while (bVar1 == 0) {
					ppiVar4 = (int **)((int)ppiVar4 + 1);
					piVar5 = (int *)((int)piVar5 + 1);
					bVar1 = *(byte *)ppiVar4;
				}
				if (param_3 <= piVar5) {
					if ((int **)((int)ppiVar6 + (int)param_3) < param_1 + 0x3e) {
						*param_1 = (int *)(int **)((int)ppiVar6 + (int)param_3);
						param_1[1] = (int *)((int)piVar5 - (int)param_3);
					}
					else {
						*param_1 = (int *)ppiVar3;
LAB_00491f4f:
						param_1[1] = NULL;
					}
LAB_00491f56:
					*(byte *)ppiVar6 = (byte)param_3;
					return (int)(ppiVar6 + 2) * 0x10 + (int)param_1 * -0xf;
				}
				param_2 = (int *)((int)param_2 - (int)piVar5);
				if (param_2 < param_3) {
					return 0;
				}
			}
			else {
				ppiVar4 = (int **)((int)ppiVar6 + (uint)*(byte *)ppiVar6);
			}
			ppiVar6 = ppiVar4;
			if (ppiVar2 <= ppiVar4) {
				return 0;
			}
		}
	}
	return 0;
}



undefined4 __cdecl FUN_00491f80(int param_1,int **param_2,int **param_3,uint param_4)
{
	int **ppiVar1;
	int iVar2;
	int *piVar3;
	char cVar4;
	undefined4 uVar5;
	int *piVar6;
	uint uVar7;
	int **ppiVar8;
	
	uVar5 = 0;
	piVar3 = (int *)(param_1 + 0x18 + ((int)((int)param_2 - *(int *)(param_1 + 0x10)) >> 0xc) * 8);
	uVar7 = (uint)*(byte *)param_3;
	if (uVar7 <= param_4) {
		if ((uVar7 < param_4) && (ppiVar1 = (int **)(param_4 + (int)param_3), ppiVar1 <= param_2 + 0x3e)
			 ) {
			for (ppiVar8 = (int **)(uVar7 + (int)param_3);
					(ppiVar8 < ppiVar1 && (*(char *)ppiVar8 == '\0')); ppiVar8 = (int **)((int)ppiVar8 + 1)) {
			}
			if (ppiVar8 == ppiVar1) {
				*(char *)param_3 = (char)param_4;
				if ((param_3 <= *param_2) && (*param_2 < ppiVar1)) {
					if (ppiVar1 < param_2 + 0x3e) {
						*param_2 = (int *)ppiVar1;
						piVar6 = NULL;
						cVar4 = *(char *)ppiVar1;
						while (cVar4 == '\0') {
							iVar2 = (int)piVar6 + 1;
							piVar6 = (int *)((int)piVar6 + 1);
							cVar4 = *(char *)(iVar2 + (int)ppiVar1);
						}
						param_2[1] = piVar6;
					}
					else {
						param_2[1] = NULL;
						*param_2 = (int *)(param_2 + 2);
					}
				}
				*piVar3 = *piVar3 + (uVar7 - param_4);
				uVar5 = 1;
			}
		}
		return uVar5;
	}
	*(char *)param_3 = (char)param_4;
	piVar3[1] = 0xf1;
	*piVar3 = *piVar3 + (uVar7 - param_4);
	return 1;
}



BOOL __cdecl FUN_00492050(uint length)
{
	int iVar1;
	
	if (DAT_0054a158 != NULL) {
		iVar1 = (*DAT_0054a158)(length);
		if (iVar1 != 0) {
			return 1;
		}
	}
	return 0;
}



// Library Function - Single Match
// Name: __trandisp1
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release, Visual Studio 2003 Debug, Visual
// Studio 2003 Release

void __fastcall __trandisp1(undefined4 param_1,int param_2)
{
	float10 fVar1;
	byte bVar2;
	undefined2 uVar3;
	int unaff_EBP;
	float10 in_ST0;
	
	if (*(char *)(param_2 + 0xe) == '\x05') {
		uVar3 = (undefined2)
						CONCAT31((uint3)((byte)((uint)*(ushort *)(unaff_EBP + -0xa4) >> 8) & 0xfe | 2),0x3f);
	}
	else {
		uVar3 = 0x133f;
	}
	*(undefined2 *)(unaff_EBP + -0xa2) = uVar3;
	fVar1 = (float10)0;
	*(int *)(unaff_EBP + -0x94) = param_2;
	*(ushort *)(unaff_EBP + -0xa0) =
			 (ushort)(in_ST0 < fVar1) << 9 | (ushort)(in_ST0 != fVar1) << 10 |
			 (ushort)(in_ST0 == fVar1) << 0xe;
	*(undefined *)(unaff_EBP + -0x90) = 0;
	bVar2 = (char)(*(char *)(unaff_EBP + -0x9f) << 1) >> 1;
										// WARNING: Could not recover jumptable at 0x004920d5. Too many branches
										// WARNING: Treating indirect jump as call
	(**(code **)(param_2 + (char)(&DAT_004b2ffd)[(byte)((bVar2 & 7) << 1 | (char)bVar2 < '\0')] + 0x10
							))();
	return;
}



// Library Function - Single Match
// Name: __trandisp2
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release, Visual Studio 2003 Debug, Visual
// Studio 2003 Release

void __fastcall __trandisp2(undefined4 param_1,int param_2)
{
	float10 fVar1;
	char cVar2;
	byte bVar3;
	undefined2 uVar4;
	int unaff_EBP;
	float10 in_ST0;
	float10 in_ST1;
	
	if (*(char *)(param_2 + 0xe) == '\x05') {
		uVar4 = (undefined2)
						CONCAT31((uint3)((byte)((uint)*(ushort *)(unaff_EBP + -0xa4) >> 8) & 0xfe | 2),0x3f);
	}
	else {
		uVar4 = 0x133f;
	}
	*(undefined2 *)(unaff_EBP + -0xa2) = uVar4;
	fVar1 = (float10)0;
	*(int *)(unaff_EBP + -0x94) = param_2;
	*(ushort *)(unaff_EBP + -0xa0) =
			 (ushort)(in_ST0 < fVar1) << 9 | (ushort)(in_ST0 != fVar1) << 10 |
			 (ushort)(in_ST0 == fVar1) << 0xe;
	*(undefined *)(unaff_EBP + -0x90) = 0;
	fVar1 = (float10)0;
	*(ushort *)(unaff_EBP + -0xa0) =
			 (ushort)(in_ST1 < fVar1) << 9 | (ushort)(in_ST1 != fVar1) << 10 |
			 (ushort)(in_ST1 == fVar1) << 0xe;
	bVar3 = (char)(*(char *)(unaff_EBP + -0x9f) << 1) >> 1;
	cVar2 = (char)(*(char *)(unaff_EBP + -0x9f) << 1) >> 1;
										// WARNING: Could not recover jumptable at 0x00492161. Too many branches
										// WARNING: Treating indirect jump as call
	(**(code **)(param_2 + (char)((&DAT_004b2ffd)[(byte)(cVar2 << 1 | cVar2 < '\0') & 0xf] |
															 (&DAT_004b2ffd)[(byte)((bVar3 & 7) << 1 | (char)bVar3 < '\0')] << 2)
							+ 0x10))();
	return;
}



float10 __fastcall
FUN_00492240(undefined4 param_1_00,uint param_2_00,ushort param_1,undefined4 param_2,
						undefined4 param_3,undefined4 param_4,undefined4 param_5,undefined4 param_6)
{
	float10 in_ST0;
	int local_24 [2];
	undefined4 uStack28;
	undefined4 uStack24;
	undefined4 local_14;
	undefined4 local_10;
	double dStack12;
	
	local_14 = param_5;
	local_10 = param_6;
	dStack12 = (double)in_ST0;
	uStack28 = param_3;
	uStack24 = param_4;
	std::__unk__00498fa0(param_2_00,local_24,&param_1);
	return (float10)dStack12;
}



// Library Function - Single Match
// Name: __startOneArgErrorHandling
// Library: Visual Studio

float10 __fastcall
__startOneArgErrorHandling
					(undefined4 param_1_00,uint param_2_00,ushort param_1,undefined4 param_2,
					undefined4 param_3,undefined4 param_4)
{
	float10 in_ST0;
	int local_24 [2];
	undefined4 local_1c;
	undefined4 local_18;
	double local_c;
	
	local_c = (double)in_ST0;
	local_1c = param_3;
	local_18 = param_4;
	std::__unk__00498fa0(param_2_00,local_24,&param_1);
	return (float10)local_c;
}



void FUN_004922b5(undefined4 param_1)
{
	return;
}



undefined4 FUN_004922cc(void)
{
	uint in_EAX;
	
	if ((in_EAX & 0x80000) != 0) {
		return 7;
	}
	return 1;
}



// Library Function - Single Match
// Name: __fload_withFB
// Library: Visual Studio

uint __fastcall __fload_withFB(undefined4 param_1,int param_2)
{
	uint uVar1;
	
	uVar1 = *(uint *)(param_2 + 4) & 0x7ff00000;
	if (uVar1 != 0x7ff00000) {
		return uVar1;
	}
	return *(uint *)(param_2 + 4);
}



uint __cdecl FUN_00492328(undefined4 param_1,uint param_2)
{
	if ((param_2 & 0x7ff00000) != 0x7ff00000) {
		return param_2 & 0x7ff00000;
	}
	return param_2;
}



// Library Function - Single Match
// Name: __cintrindisp2
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release, Visual Studio 2003 Debug, Visual
// Studio 2003 Release

void __cintrindisp2(void)
{
	__trandisp2();
	DAT_0054a168 = 1;
	FUN_004924e5();
	return;
}



// Library Function - Single Match
// Name: __cintrindisp1
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release, Visual Studio 2003 Debug, Visual
// Studio 2003 Release

void __cintrindisp1(void)
{
	__trandisp1();
	DAT_0054a168 = 1;
	FUN_004924e5();
	return;
}



// Library Function - Single Match
// Name: __ctrandisp2
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release, Visual Studio 2003 Debug, Visual
// Studio 2003 Release

void __cdecl __ctrandisp2(uint param_1,int param_2,uint param_3,int param_4)
{
	__fload(param_1,param_2);
	__fload(param_3,param_4);
	__trandisp2();
	FUN_004924de();
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void FUN_004924de(void)
{
	char cVar1;
	int unaff_EBP;
	float10 in_ST0;
	ushort in_FPUStatusWord;
	
	DAT_0054a168 = '\0';
	if (_DAT_0054a0c8 != 0) {
		DAT_0054a168 = 0;
		return;
	}
	_DAT_0054a160 = (double)in_ST0;
	cVar1 = *(char *)(unaff_EBP + -0x90);
	if (cVar1 != '\0') {
		if ((cVar1 != -1) && (cVar1 != -2)) {
			if (cVar1 == '\0') {
				DAT_0054a168 = 0;
				return;
			}
			*(int *)(unaff_EBP + -0x8e) = (int)cVar1;
			goto LAB_004925b3;
		}
		if (((ulonglong)_DAT_0054a160 & 0x7ff0000000000000) == 0) {
			*(undefined4 *)(unaff_EBP + -0x8e) = 4;
			in_ST0 = (float10)fscale(in_ST0,(float10)1536.0);
			if (ABS(in_ST0) < (float10)2.225073858507201e-308) {
				in_ST0 = in_ST0 * (float10)0.0;
			}
			goto LAB_004925b3;
		}
		if ((DAT_0054a166 & 0x7ff0) == 0x7ff0) {
			*(undefined4 *)(unaff_EBP + -0x8e) = 3;
			in_ST0 = (float10)fscale(in_ST0,(float10)-1536.0);
			if ((float10)1.797693134862316e+308 < ABS(in_ST0)) {
				in_ST0 = in_ST0 * (float10)INFINITY;
			}
			goto LAB_004925b3;
		}
	}
	if ((*(ushort *)(unaff_EBP + -0xa4) & 0x20) != 0) {
		DAT_0054a168 = 0;
		return;
	}
	if ((in_FPUStatusWord & 0x20) == 0) {
		DAT_0054a168 = 0;
		return;
	}
	*(undefined4 *)(unaff_EBP + -0x8e) = 8;
LAB_004925b3:
	*(int *)(unaff_EBP + -0x8a) = *(int *)(unaff_EBP + -0x94) + 1;
	if (DAT_0054a168 == '\0') {
		*(undefined4 *)(unaff_EBP + -0x86) = *(undefined4 *)(unaff_EBP + 8);
		*(undefined4 *)(unaff_EBP + -0x82) = *(undefined4 *)(unaff_EBP + 0xc);
		if (*(char *)(*(int *)(unaff_EBP + -0x94) + 0xd) != '\x01') {
			*(undefined4 *)(unaff_EBP + -0x7e) = *(undefined4 *)(unaff_EBP + 0x10);
			*(undefined4 *)(unaff_EBP + -0x7a) = *(undefined4 *)(unaff_EBP + 0x14);
		}
	}
	*(double *)(unaff_EBP + -0x76) = (double)in_ST0;
	std::__unk__00498fa0
						((int)*(char *)(*(int *)(unaff_EBP + -0x94) + 0xe),(int *)(unaff_EBP + -0x8e),
						 (ushort *)(unaff_EBP + -0xa4));
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void FUN_004924e5(void)
{
	char cVar1;
	int unaff_EBP;
	float10 in_ST0;
	ushort in_FPUStatusWord;
	
	if (_DAT_0054a0c8 != 0) {
		return;
	}
	_DAT_0054a160 = (double)in_ST0;
	cVar1 = *(char *)(unaff_EBP + -0x90);
	if (cVar1 != '\0') {
		if ((cVar1 != -1) && (cVar1 != -2)) {
			if (cVar1 == '\0') {
				return;
			}
			*(int *)(unaff_EBP + -0x8e) = (int)cVar1;
			goto LAB_004925b3;
		}
		if (((ulonglong)_DAT_0054a160 & 0x7ff0000000000000) == 0) {
			*(undefined4 *)(unaff_EBP + -0x8e) = 4;
			in_ST0 = (float10)fscale(in_ST0,(float10)1536.0);
			if (ABS(in_ST0) < (float10)2.225073858507201e-308) {
				in_ST0 = in_ST0 * (float10)0.0;
			}
			goto LAB_004925b3;
		}
		if ((DAT_0054a166 & 0x7ff0) == 0x7ff0) {
			*(undefined4 *)(unaff_EBP + -0x8e) = 3;
			in_ST0 = (float10)fscale(in_ST0,(float10)-1536.0);
			if ((float10)1.797693134862316e+308 < ABS(in_ST0)) {
				in_ST0 = in_ST0 * (float10)INFINITY;
			}
			goto LAB_004925b3;
		}
	}
	if ((*(ushort *)(unaff_EBP + -0xa4) & 0x20) != 0) {
		return;
	}
	if ((in_FPUStatusWord & 0x20) == 0) {
		return;
	}
	*(undefined4 *)(unaff_EBP + -0x8e) = 8;
LAB_004925b3:
	*(int *)(unaff_EBP + -0x8a) = *(int *)(unaff_EBP + -0x94) + 1;
	if (DAT_0054a168 == '\0') {
		*(undefined4 *)(unaff_EBP + -0x86) = *(undefined4 *)(unaff_EBP + 8);
		*(undefined4 *)(unaff_EBP + -0x82) = *(undefined4 *)(unaff_EBP + 0xc);
		if (*(char *)(*(int *)(unaff_EBP + -0x94) + 0xd) != '\x01') {
			*(undefined4 *)(unaff_EBP + -0x7e) = *(undefined4 *)(unaff_EBP + 0x10);
			*(undefined4 *)(unaff_EBP + -0x7a) = *(undefined4 *)(unaff_EBP + 0x14);
		}
	}
	*(double *)(unaff_EBP + -0x76) = (double)in_ST0;
	std::__unk__00498fa0
						((int)*(char *)(*(int *)(unaff_EBP + -0x94) + 0xe),(int *)(unaff_EBP + -0x8e),
						 (ushort *)(unaff_EBP + -0xa4));
	return;
}



// Library Function - Single Match
// Name: __ctrandisp1
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release, Visual Studio 2003 Debug, Visual
// Studio 2003 Release

void __cdecl __ctrandisp1(uint param_1,int param_2)
{
	__fload(param_1,param_2);
	__trandisp1();
	FUN_004924de();
	return;
}



// Library Function - Single Match
// Name: __fload
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release, Visual Studio 2003 Debug, Visual
// Studio 2003 Release

float10 __cdecl __fload(uint param_1,int param_2)
{
	float10 fVar1;
	
	if ((param_2._2_2_ & 0x7ff0) == 0x7ff0) {
		fVar1 = (float10)(CONCAT28(param_2._2_2_,CONCAT44(param_2 << 0xb | param_1 >> 0x15,param_1)) |
										 0x7fff);
	}
	else {
		fVar1 = (float10)(double)CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1));
	}
	return fVar1;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

undefined4 FUN_00492e86(undefined4 param_1,uint param_2,ushort param_3)
{
	undefined4 in_EAX;
	int iVar1;
	float10 fVar2;
	float10 fVar3;
	undefined4 in_stack_0000001c;
	undefined2 uStack00000020;
	uint in_stack_00000020;
	undefined2 uStack00000022;
	ushort in_stack_00000024;
	
	if ((((((CONCAT22(param_3,param_2._2_2_) ^ 0x700) & 0x700) == 0) &&
			 ((&DAT_004b302c)[(param_2._2_2_ & 0x7800) >> 0xb] != '\0')) && ((param_3 & 0x7fff) != 0x7fff)
			) && ((((in_stack_00000024 & 0x7fff) != 0 && ((in_stack_00000024 & 0x7fff) != 0x7fff)) &&
						(((in_stack_00000020 & 0x7fffffff) == 0 && ((param_2 & 0x7fffffff) == 0)))))) {
		if ((ushort)((param_3 & 0x7fff) + 0x3f) < (in_stack_00000024 & 0x7fff)) {
			iVar1 = ((in_stack_00000024 & 0x7fff) - (param_3 & 0x7fff) & 0x3f | 0x20) + 1;
			fVar3 = ABS((float10)CONCAT28(in_stack_00000024 & 0x7fff | param_3 & 0x8000,
																		CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1))));
			fVar2 = ABS((float10)CONCAT28(in_stack_00000024,
																		CONCAT26(uStack00000022,
																						 CONCAT24(uStack00000020,in_stack_0000001c))));
			do {
				if (fVar3 <= fVar2) {
					fVar2 = fVar2 - fVar3;
				}
				fVar3 = fVar3 * (float10)_DAT_004b305c;
				iVar1 += -1;
			} while (iVar1 != 0);
		}
		else {
			while (-1 < (int)((in_stack_00000024 & 0x7fff) - ((param_3 & 0x7fff) + 10))) {
				fVar2 = (float10)CONCAT28(in_stack_00000024,
																	CONCAT26(uStack00000022,CONCAT24(uStack00000020,in_stack_0000001c)
																					));
				fVar3 = (float10)CONCAT28((in_stack_00000024 & 0x7fff) -
																	((in_stack_00000024 & 0x7fff) - param_3 & 7 | 4) |
																	param_3 & 0x8000,
																	CONCAT26(param_2._2_2_,CONCAT24((undefined2)param_2,param_1)));
				fVar2 = fVar2 - (fVar2 / fVar3) * fVar3;
				in_stack_0000001c = SUB104(fVar2,0);
				uStack00000020 = (undefined2)((unkuint10)fVar2 >> 0x20);
				uStack00000022 = (undefined2)((unkuint10)fVar2 >> 0x30);
				in_stack_00000024 = (ushort)((unkuint10)fVar2 >> 0x40);
			}
		}
	}
	return in_EAX;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

float10 FUN_0049308c(void)
{
	float10 in_ST0;
	float10 fVar1;
	float10 in_ST1;
	
	if (((unkuint10)in_ST1 & 0) != 0) {
		fVar1 = (float10)FUN_00492e86();
		return fVar1;
	}
	if ((SUB104(in_ST1,0) | (uint)((unkuint10)in_ST1 >> 0x20)) != 0) {
		fVar1 = (float10)FUN_00492e86(in_ST1 * (float10)_DAT_004b3044);
		return fVar1;
	}
	return in_ST0 - (in_ST0 / in_ST1) * in_ST1;
}



float10 __cdecl FUN_00493410(double param_1)
{
	return (float10)ROUND(param_1);
}



float10 __cdecl
std::__unk_math__00493430(int param_1,undefined4 param_2,undefined4 param_3,undefined4 param_4)
{
	float10 fVar1;
	
	if (DAT_004b38e0 == 0) {
		fVar1 = __unk_math__00493bb0(1,param_1,param_2,param_3,0,0,param_2,param_3,param_4);
		return fVar1;
	}
	globals::g_msvc_errno = 0x21;
	__unk_math__00493ed0(param_4,0xffff);
	return (float10)(double)CONCAT44(param_3,param_2);
}



float10 __cdecl
FUN_00493480(uint param_1,uint param_2,uint param_3,undefined4 param_4,uint param_5,
						undefined4 param_6,uint param_7)
{
	uint uVar1;
	int iVar2;
	float10 fVar3;
	uint local_58 [14];
	uint local_20;
	
	uVar1 = FUN_00493880(param_1,(double *)&param_5,param_7);
	if (uVar1 == 0) {
		local_20 &= 0xfffffffe;
		FUN_00493540(local_58,&param_7,(byte)param_1,param_2,&param_3,&param_5);
	}
	iVar2 = FUN_00493cc0(param_1);
	if ((DAT_004b38e0 == 0) && (iVar2 != 0)) {
		fVar3 = std::__unk_math__00493bb0(iVar2,param_2,param_3,param_4,0,0,param_5,param_6,param_7);
		return fVar3;
	}
	FUN_00493c60(iVar2);
	std::__unk_math__00493ed0(param_7,0xffff);
	return (float10)(double)CONCAT44(param_6,param_5);
}



void __cdecl
FUN_00493540(uint *param_1,uint *param_2,byte param_3,uint param_4,uint *param_5,uint *param_6)
{
	uint *puVar1;
	uint *puVar2;
	byte bVar3;
	uint uVar4;
	uint *dwExceptionCode;
	
	puVar1 = param_2;
	param_1[1] = 0;
	param_1[2] = 0;
	param_1[3] = 0;
	dwExceptionCode = param_1;
	if ((param_3 & 0x10) != 0) {
		param_1[1] = param_1[1] | 1;
		dwExceptionCode = (uint *)0xc000008f;
	}
	if ((param_3 & 2) != 0) {
		dwExceptionCode = (uint *)0xc0000093;
		param_1[1] = param_1[1] | 2;
	}
	if ((param_3 & 1) != 0) {
		dwExceptionCode = (uint *)0xc0000091;
		param_1[1] = param_1[1] | 4;
	}
	if ((param_3 & 4) != 0) {
		dwExceptionCode = (uint *)0xc000008e;
		param_1[1] = param_1[1] | 8;
	}
	if ((param_3 & 8) != 0) {
		dwExceptionCode = (uint *)0xc0000090;
		param_1[1] = param_1[1] | 0x10;
	}
	param_1[2] = (~*param_2 & 1) << 4 | param_1[2] & 0xffffffef;
	param_1[2] = (~*param_2 & 4) << 1 | param_1[2] & 0xfffffff7;
	param_1[2] = ~*param_2 >> 1 & 4 | param_1[2] & 0xfffffffb;
	param_1[2] = ~*param_2 >> 3 & 2 | param_1[2] & 0xfffffffd;
	param_1[2] = ~*param_2 >> 5 & 1 | param_1[2] & 0xfffffffe;
	bVar3 = FUN_00493ea0();
	puVar2 = param_6;
	if ((bVar3 & 1) != 0) {
		param_1[3] = param_1[3] | 0x10;
	}
	if ((bVar3 & 4) != 0) {
		param_1[3] = param_1[3] | 8;
	}
	if ((bVar3 & 8) != 0) {
		param_1[3] = param_1[3] | 4;
	}
	if ((bVar3 & 0x10) != 0) {
		param_1[3] = param_1[3] | 2;
	}
	if ((bVar3 & 0x20) != 0) {
		param_1[3] = param_1[3] | 1;
	}
	uVar4 = *puVar1 & 0xc00;
	if (uVar4 < 0x401) {
		if (uVar4 == 0x400) {
			*param_1 = *param_1 & 0xfffffffd | 1;
		}
		else {
			if (uVar4 == 0) {
				*param_1 = *param_1 & 0xfffffffc;
			}
		}
	}
	else {
		if (uVar4 == 0x800) {
			*param_1 = *param_1 & 0xfffffffe | 2;
		}
		else {
			if (uVar4 == 0xc00) {
				*param_1 = *param_1 | 3;
			}
		}
	}
	uVar4 = *puVar1 & 0x300;
	if (uVar4 == 0) {
		*param_1 = *param_1 & 0xffffffeb | 8;
	}
	else {
		if (uVar4 == 0x200) {
			*param_1 = *param_1 & 0xffffffe7 | 4;
		}
		else {
			if (uVar4 == 0x300) {
				*param_1 = *param_1 & 0xffffffe3;
			}
		}
	}
	*param_1 = *param_1 & 0xfffe001f | (param_4 & 0xfff) << 5;
	param_1[8] = param_1[8] | 1;
	param_1[8] = param_1[8] & 0xffffffe3 | 2;
	param_1[4] = *param_5;
	param_1[5] = param_5[1];
	param_1[0x14] = param_1[0x14] | 1;
	param_1[0x14] = param_1[0x14] & 0xffffffe3 | 2;
	param_1[0x10] = *param_6;
	param_1[0x11] = param_6[1];
	FUN_00493eb0();
	RaiseException((DWORD)dwExceptionCode,0,1,(ULONG_PTR *)&param_1);
	if ((*(byte *)(param_1 + 2) & 0x10) != 0) {
		*puVar1 = *puVar1 & 0xfffffffe;
	}
	if ((*(byte *)(param_1 + 2) & 8) != 0) {
		*puVar1 = *puVar1 & 0xfffffffb;
	}
	if ((*(byte *)(param_1 + 2) & 4) != 0) {
		*puVar1 = *puVar1 & 0xfffffff7;
	}
	if ((*(byte *)(param_1 + 2) & 2) != 0) {
		*puVar1 = *puVar1 & 0xffffffef;
	}
	if ((*(byte *)(param_1 + 2) & 1) != 0) {
		*puVar1 = *puVar1 & 0xffffffdf;
	}
	switch(*param_1 & 3) {
	case 0:
		uVar4 = *puVar1 & 0xfffff3ff;
		break;
	case 1:
		*puVar1 = *puVar1 & 0xfffff7ff | 0x400;
		goto switchD_004937db_caseD_4;
	case 2:
		uVar4 = *puVar1 & 0xfffffbff | 0x800;
		break;
	case 3:
		uVar4 = *puVar1 | 0xc00;
		break;
	default:
		goto switchD_004937db_caseD_4;
	}
	*puVar1 = uVar4;
switchD_004937db_caseD_4:
	uVar4 = *param_1 >> 2 & 7;
	if (uVar4 == 0) {
		*puVar1 = *puVar1 & 0xfffff3ff | 0x300;
	}
	else {
		if (uVar4 == 1) {
			*puVar1 = *puVar1 & 0xfffff3ff | 0x200;
			*puVar2 = param_1[0x10];
			puVar2[1] = param_1[0x11];
			return;
		}
		if (uVar4 == 2) {
			*puVar1 = *puVar1 & 0xfffff3ff;
			*puVar2 = param_1[0x10];
			puVar2[1] = param_1[0x11];
			return;
		}
	}
	*puVar2 = param_1[0x10];
	puVar2[1] = param_1[0x11];
	return;
}



// WARNING: Could not reconcile some variable overlaps

uint __cdecl FUN_00493880(uint param_1,double *param_2,uint param_3)
{
	undefined4 uVar1;
	undefined4 uVar2;
	double dVar3;
	uint uVar4;
	bool bVar5;
	float10 fVar6;
	int local_14;
	undefined8 local_10;
	
	uVar4 = param_1 & 0x1f;
	if (((param_1 & 8) == 0) || ((param_3 & 1) == 0)) {
		if (((param_1 & 4) == 0) || ((param_3 & 4) == 0)) {
			if (((param_1 & 1) == 0) || ((param_3 & 8) == 0)) {
				if (((param_1 & 2) != 0) && ((param_3 & 0x10) != 0)) {
					bVar5 = (param_1 & 0x10) != 0;
					local_10 = *param_2;
					if (local_10 == 0.0) {
						bVar5 = true;
					}
					else {
						fVar6 = FUN_00493da0(*(uint *)param_2,*(uint *)((int)param_2 + 4),&local_14);
						local_14 += -0x600;
						if (local_14 < -0x432) {
							bVar5 = true;
							*(undefined4 *)param_2 = 0;
							local_10 = 0.0;
							*(undefined4 *)((int)param_2 + 4) = 0;
						}
						else {
							local_10 = (double)(ulonglong)
																 (SUB87((double)fVar6,0) & 0xfffffffffffff | 0x10000000000000);
							if (local_14 < -0x3fd) {
								local_14 = -0x3fd - local_14;
								do {
									dVar3 = local_10;
									if ((((ulonglong)local_10 & 1) != 0) && (!bVar5)) {
										bVar5 = true;
									}
									local_10 = (double)((ulonglong)local_10 & 0xffffffff00000000 |
																		 (ulonglong)local_10 >> 1 & 0x7fffffff);
									if (((ulonglong)dVar3 & 0x100000000) != 0) {
										local_10 = (double)((ulonglong)local_10 | 0x80000000);
									}
									local_14 += -1;
									local_10 = (double)((ulonglong)local_10 & 0xffffffff |
																		 ((ulonglong)local_10 >> 0x21) << 0x20);
								} while (local_14 != 0);
							}
							if ((double)fVar6 < 0.0) {
								local_10 = -local_10;
							}
							*(undefined4 *)param_2 = (undefined4)local_10;
							*(undefined4 *)((int)param_2 + 4) = local_10._4_4_;
						}
					}
					if (bVar5) {
						FUN_00493f00(0x10);
					}
					uVar4 = param_1 & 0x1d;
				}
			}
			else {
				FUN_00493f00(8);
				uVar2 = DAT_004b325c;
				uVar1 = DAT_004b324c;
				uVar4 = param_3 & 0xc00;
				if (uVar4 < 0x401) {
					if (uVar4 == 0x400) {
						if ((ushort)((ushort)(*param_2 < 0.0) << 8 | (ushort)(*param_2 == 0.0) << 0xe) == 0) {
							*(undefined4 *)param_2 = DAT_004b3258;
							*(undefined4 *)((int)param_2 + 4) = uVar2;
							uVar4 = param_1 & 0x1e;
						}
						else {
							local_10 = -(double)CONCAT44(DAT_004b324c,DAT_004b3248);
							local_10._4_4_ = (undefined4)((ulonglong)local_10 >> 0x20);
							*(undefined4 *)param_2 = (undefined4)local_10;
							*(undefined4 *)((int)param_2 + 4) = local_10._4_4_;
							uVar4 = param_1 & 0x1e;
						}
						goto LAB_00493b8b;
					}
					if (uVar4 == 0) {
						if ((ushort)((ushort)(*param_2 < 0.0) << 8 | (ushort)(*param_2 == 0.0) << 0xe) == 0) {
							*(undefined4 *)param_2 = DAT_004b3248;
							*(undefined4 *)((int)param_2 + 4) = uVar1;
							uVar4 = param_1 & 0x1e;
						}
						else {
							local_10 = -(double)CONCAT44(DAT_004b324c,DAT_004b3248);
							local_10._4_4_ = (undefined4)((ulonglong)local_10 >> 0x20);
							*(undefined4 *)param_2 = (undefined4)local_10;
							*(undefined4 *)((int)param_2 + 4) = local_10._4_4_;
							uVar4 = param_1 & 0x1e;
						}
						goto LAB_00493b8b;
					}
				}
				else {
					if (uVar4 == 0x800) {
						if ((ushort)((ushort)(*param_2 < 0.0) << 8 | (ushort)(*param_2 == 0.0) << 0xe) == 0) {
							*(undefined4 *)param_2 = DAT_004b3248;
							*(undefined4 *)((int)param_2 + 4) = uVar1;
							uVar4 = param_1 & 0x1e;
							goto LAB_00493b8b;
						}
						local_10 = -(double)CONCAT44(DAT_004b325c,DAT_004b3258);
						local_10._4_4_ = (undefined4)((ulonglong)local_10 >> 0x20);
						*(undefined4 *)param_2 = (undefined4)local_10;
						*(undefined4 *)((int)param_2 + 4) = local_10._4_4_;
					}
					else {
						if (uVar4 == 0xc00) {
							if ((ushort)((ushort)(*param_2 < 0.0) << 8 | (ushort)(*param_2 == 0.0) << 0xe) == 0) {
								*(undefined4 *)param_2 = DAT_004b3258;
								*(undefined4 *)((int)param_2 + 4) = uVar2;
								uVar4 = param_1 & 0x1e;
							}
							else {
								local_10 = -(double)CONCAT44(DAT_004b325c,DAT_004b3258);
								local_10._4_4_ = (undefined4)((ulonglong)local_10 >> 0x20);
								*(undefined4 *)param_2 = (undefined4)local_10;
								*(undefined4 *)((int)param_2 + 4) = local_10._4_4_;
								uVar4 = param_1 & 0x1e;
							}
							goto LAB_00493b8b;
						}
					}
				}
				uVar4 = param_1 & 0x1e;
			}
		}
		else {
			FUN_00493f00(4);
			uVar4 = param_1 & 0x1b;
		}
	}
	else {
		FUN_00493f00(1);
		uVar4 = param_1 & 0x17;
	}
LAB_00493b8b:
	if (((param_1 & 0x10) != 0) && ((param_3 & 0x20) != 0)) {
		FUN_00493f00(0x20);
		uVar4 &= 0xffffffef;
	}
	return (uint)(uVar4 == 0);
}



float10 __cdecl
std::__unk_math__00493bb0
					(int param_1,int param_2,undefined4 param_3,undefined4 param_4,undefined4 param_5,
					undefined4 param_6,undefined4 param_7,undefined4 param_8,undefined4 param_9)
{
	int iVar1;
	int local_20;
	undefined *local_1c;
	undefined4 local_18;
	undefined4 local_14;
	undefined4 local_10;
	undefined4 local_c;
	undefined4 local_8;
	undefined4 uStack4;
	
	local_1c = FUN_00493c90(param_2);
	if (local_1c != NULL) {
		local_18 = param_3;
		local_c = param_6;
		local_14 = param_4;
		local_10 = param_5;
		local_20 = param_1;
		local_8 = param_7;
		uStack4 = param_8;
		__unk_math__00493ed0(param_9,0xffff);
		iVar1 = lego::nerps::funcs::NERPFunc__False(&local_20);
		if (iVar1 == 0) {
			FUN_00493c60(param_1);
		}
		return (float10)(double)CONCAT44(uStack4,local_8);
	}
	__unk_math__00493ed0(param_9,0xffff);
	FUN_00493c60(param_1);
	return (float10)(double)CONCAT44(param_8,param_7);
}



void __cdecl FUN_00493c60(int param_1)
{
	if (param_1 == 1) {
		std::globals::g_msvc_errno = 0x21;
	}
	else {
		if ((1 < param_1) && (param_1 < 4)) {
			std::globals::g_msvc_errno = 0x22;
			return;
		}
	}
	return;
}



undefined * __cdecl FUN_00493c90(int param_1)
{
	int *piVar1;
	int iVar2;
	
	iVar2 = 0;
	piVar1 = &DAT_004b3170;
	do {
		if (*piVar1 == param_1) {
			return (&PTR_s_exp_004b3174)[iVar2 * 2];
		}
		piVar1 = piVar1 + 2;
		iVar2 += 1;
	} while ((int)piVar1 < 0x4b3248);
	return NULL;
}



int __cdecl FUN_00493cc0(uint param_1)
{
	if ((param_1 & 0x20) != 0) {
		return 5;
	}
	if ((param_1 & 8) != 0) {
		return 1;
	}
	if ((param_1 & 4) != 0) {
		return 2;
	}
	if ((param_1 & 1) != 0) {
		return 3;
	}
	return (param_1 & 2) << 1;
}



float10 __cdecl FUN_00493d00(undefined4 param_1,undefined4 param_2,short param_3)
{
	undefined2 uStack4;
	
	uStack4 = (undefined2)param_2;
	return (float10)(double)CONCAT26(param_2._2_2_ & 0x800f | (param_3 + 0x3fe) * 0x10,
																	 CONCAT24(uStack4,param_1));
}



undefined4 __cdecl FUN_00493d40(int param_1,uint param_2)
{
	if ((param_2 == 0x7ff00000) && (param_1 == 0)) {
		return 1;
	}
	if ((param_2 == 0xfff00000) && (param_1 == 0)) {
		return 2;
	}
	if ((param_2._2_2_ & 0x7ff8) == 0x7ff8) {
		return 3;
	}
	if (((param_2._2_2_ & 0x7ff8) == 0x7ff0) && (((param_2 & 0x7ffff) != 0 || (param_1 != 0)))) {
		return 4;
	}
	return 0;
}



float10 __cdecl FUN_00493da0(uint param_1,uint param_2,int *param_3)
{
	ushort uVar1;
	double dVar2;
	uint uVar3;
	int iVar4;
	float10 fVar5;
	
	if ((double)CONCAT17(param_2._3_1_,CONCAT16(param_2._2_1_,CONCAT24((undefined2)param_2,param_1)))
			== 0.0) {
		*param_3 = 0;
		return (float10)0.0;
	}
	if (((param_2 & 0x7ff00000) == 0) && (((param_2 & 0xfffff) != 0 || (param_1 != 0)))) {
		dVar2 = (double)CONCAT17(param_2._3_1_,
														 CONCAT16(param_2._2_1_,CONCAT24((undefined2)param_2,param_1)));
		iVar4 = -0x3fd;
		for (uVar3 = param_2 & 0x100000; uVar3 == 0; uVar3 &= 0x100000) {
			uVar3 = param_2 << 1;
			param_2._0_2_ = (undefined2)uVar3;
			param_2._2_1_ = (undefined)(uVar3 >> 0x10);
			param_2._3_1_ = (byte)(uVar3 >> 0x18);
			param_2 = uVar3;
			if ((param_1 & 0x80000000) != 0) {
				param_2 = uVar3 | 1;
			}
			param_1 <<= 1;
			iVar4 += -1;
		}
		uVar1 = CONCAT11(param_2._3_1_,param_2._2_1_) & 0xffef;
		param_2._2_1_ = (undefined)uVar1;
		param_2._3_1_ = (byte)(uVar1 >> 8);
		if (dVar2 < 0.0) {
			param_2._3_1_ |= 0x80;
		}
		fVar5 = FUN_00493d00(param_1,CONCAT13(param_2._3_1_,CONCAT12(param_2._2_1_,(undefined2)param_2))
												 ,0);
		*param_3 = iVar4;
		return (float10)(double)fVar5;
	}
	fVar5 = FUN_00493d00(param_1,param_2,0);
	*param_3 = ((param_2 >> 0x10 & 0x7ff0) >> 4) - 0x3fe;
	return (float10)(double)fVar5;
}



int FUN_00493ea0(void)
{
	short in_FPUStatusWord;
	
	return (int)in_FPUStatusWord;
}



int FUN_00493eb0(void)
{
	short in_FPUStatusWord;
	
	return (int)in_FPUStatusWord;
}



int std::__unk_math__00493ed0(void)
{
	short in_FPUControlWord;
	
	return (int)in_FPUControlWord;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void FUN_00493f00(undefined4 param_1)
{
	return;
}



int __cdecl
FUN_00493f60(LCID param_1,uint param_2,char *param_3,LPCWSTR param_4,LPWSTR param_5,int param_6,
						UINT param_7)
{
	int iVar1;
	LPCWSTR cbMultiByte;
	LPCWSTR lpWideCharStr;
	int iVar2;
	
	if (DAT_0054a170 == 0) {
		iVar1 = LCMapStringA(0,0x100,(LPCSTR)&lpSrcStr_0049fd38,1,NULL,0);
		if (iVar1 == 0) {
			iVar1 = LCMapStringW(0,0x100,(LPCWSTR)&lpSrcStr_0049fd3c,1,NULL,0);
			if (iVar1 == 0) {
				return 0;
			}
			DAT_0054a170 = 1;
		}
		else {
			DAT_0054a170 = 2;
		}
	}
	cbMultiByte = param_4;
	if (0 < (int)param_4) {
		cbMultiByte = (LPCWSTR)FUN_00494180(param_3,(int)param_4);
	}
	if (DAT_0054a170 == 2) {
		iVar1 = LCMapStringA(param_1,param_2,param_3,(int)cbMultiByte,(LPSTR)param_5,param_6);
		return iVar1;
	}
	if (DAT_0054a170 != 1) {
		return DAT_0054a170;
	}
	param_4 = NULL;
	if (param_7 == 0) {
		param_7 = DAT_0054a190;
	}
	iVar1 = MultiByteToWideChar(param_7,9,param_3,(int)cbMultiByte,NULL,0);
	if (iVar1 == 0) {
		return 0;
	}
	lpWideCharStr = (LPCWSTR)std::malloc(iVar1 * 2);
	if (lpWideCharStr == NULL) {
		return 0;
	}
	iVar2 = MultiByteToWideChar(param_7,1,param_3,(int)cbMultiByte,lpWideCharStr,iVar1);
	if ((iVar2 != 0) && (iVar2 = LCMapStringW(param_1,param_2,lpWideCharStr,iVar1,NULL,0), iVar2 != 0)
		 ) {
		if ((param_2 & 0x400) == 0) {
			param_4 = (LPCWSTR)std::malloc(iVar2 * 2);
			if ((param_4 == NULL) ||
				 (iVar1 = LCMapStringW(param_1,param_2,lpWideCharStr,iVar1,param_4,iVar2), iVar1 == 0))
			goto LAB_0049415f;
			if (param_6 == 0) {
				iVar2 = WideCharToMultiByte(param_7,0x220,param_4,iVar2,NULL,0,NULL,NULL);
				iVar1 = iVar2;
			}
			else {
				iVar2 = WideCharToMultiByte(param_7,0x220,param_4,iVar2,(LPSTR)param_5,param_6,NULL,NULL);
				iVar1 = iVar2;
			}
		}
		else {
			if (param_6 == 0) goto LAB_004940c4;
			if (param_6 < iVar2) goto LAB_0049415f;
			iVar1 = LCMapStringW(param_1,param_2,lpWideCharStr,iVar1,param_5,param_6);
		}
		if (iVar1 != 0) {
LAB_004940c4:
			std::free(lpWideCharStr);
			std::free(param_4);
			return iVar2;
		}
	}
LAB_0049415f:
	std::free(lpWideCharStr);
	std::free(param_4);
	return 0;
}



char * __cdecl FUN_00494180(char *param_1,int param_2)
{
	char *pcVar1;
	int iVar2;
	
	pcVar1 = param_1;
	iVar2 = param_2;
	if (param_2 != 0) {
		do {
			iVar2 += -1;
			if (*pcVar1 == '\0') break;
			pcVar1 = pcVar1 + 1;
		} while (iVar2 != 0);
	}
	if (*pcVar1 == '\0') {
		return pcVar1 + -(int)param_1;
	}
	return (char *)param_2;
}



// WARNING: Could not reconcile some variable overlaps

int __cdecl std::vfscanf(FILE *file,char *format,int **argptr)
{
	byte *pbVar1;
	byte bVar2;
	int **ppiVar3;
	int *piVar4;
	uint uVar5;
	uint uVar6;
	int **c;
	uint uVar7;
	int iVar8;
	byte bVar9;
	byte *pbVar10;
	char *pcVar11;
	int *piVar12;
	char *pcVar13;
	int iVar14;
	undefined4 *puVar15;
	int *piVar16;
	bool bVar17;
	ulonglong uVar18;
	FILE *pFVar19;
	char local_1cd;
	int local_1cc;
	char local_1c7;
	char local_1c6;
	char local_1c5;
	int local_1c4;
	char local_1c0;
	char local_1bf;
	char local_1be;
	byte local_1bd;
	uint local_1bc;
	int *local_1b8;
	undefined4 local_1b4;
	int local_1b0;
	int local_1ac;
	int local_1a8;
	int local_1a4;
	byte local_19e;
	undefined local_19d;
	undefined8 local_19c;
	uint local_194;
	ushort local_18e;
	int **local_18c;
	int local_188;
	uint local_184;
	undefined4 local_180 [2];
	undefined local_175;
	char local_160;
	char local_15f [351];
	
	local_1bf = '\0';
	local_1cc = 0;
	local_1ac = 0;
	bVar2 = *format;
	c = local_18c;
	do {
		if (bVar2 == 0) {
LAB_00494e06:
			if ((c == (int **)0xffffffff) && ((local_1ac == 0 && (local_1bf == '\0')))) {
				local_1ac = -1;
			}
			return local_1ac;
		}
		iVar14 = 0;
		if (globals::g_CharWidth_1__004b0f74 < 2) {
			uVar5 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + (uint)bVar2 * 2) & 8;
		}
		else {
			uVar5 = _unk_FUN_0048f490((uint)bVar2,8);
		}
		if (uVar5 != 0) {
			local_1cc += -1;
			pFVar19 = file;
			uVar5 = FUN_00494f80(&local_1cc,(byte **)file);
			FUN_00494f60(uVar5,(char **)pFVar19);
			format = format + 1;
			uVar5 = FUN_004991c0((uint)(byte)*format);
			while (uVar5 != 0) {
				format = (char *)((byte *)format + 1);
				uVar5 = FUN_004991c0((uint)(byte)*format);
			}
		}
		if (*format != '%') {
			local_1cc += 1;
			c = (int **)FUN_00494f30((byte **)file);
			if ((int **)(uint)(byte)*format != c) goto LAB_00494ded;
			pbVar10 = (byte *)(format + 1);
			if ((*(byte *)(globals::g_CharTranslate_TABLE._0_4_ + 1 + ((uint)c & 0xff) * 2) & 0x80) != 0)
			{
				local_1cc += 1;
				uVar5 = FUN_00494f30((byte **)file);
				if ((byte)format[1] != uVar5) {
					local_1cc += -1;
					FUN_00494f60(uVar5,(char **)file);
					goto LAB_00494ded;
				}
				local_1cc += -1;
				pbVar10 = (byte *)(format + 2);
			}
			goto LAB_00494db3;
		}
		local_1a4 = 0;
		local_1b4 &= 0xffffff00;
		local_1a8 = 0;
		local_1b0 = 0;
		local_1c4 = 0;
		local_1bd = 0;
		local_1be = '\0';
		local_1c5 = '\0';
		local_1cd = '\0';
		local_1c0 = '\0';
		local_1c7 = '\0';
		local_1c6 = '\x01';
		local_188 = 0;
		do {
			pbVar10 = (byte *)(format + 1);
			uVar5 = (uint)*pbVar10;
			if (globals::g_CharWidth_1__004b0f74 < 2) {
				uVar6 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + uVar5 * 2) & 4;
			}
			else {
				uVar6 = _unk_FUN_0048f490(uVar5,4);
			}
			if (uVar6 != 0) {
				local_1b0 += 1;
				local_1c4 = (uVar5 - 0x30) + local_1c4 * 10;
				goto switchD_00494330_caseD_46;
			}
			if (false) {
switchD_00494330_caseD_2b:
				local_1cd += '\x01';
			}
			else {
				switch(uVar5) {
				case 0x2a:
					local_1c5 += '\x01';
					break;
				default:
					goto switchD_00494330_caseD_2b;
				case 0x46:
				case 0x4e:
					break;
				case 0x49:
					if ((format[2] != '6') || (format[3] != '4')) goto switchD_00494330_caseD_2b;
					iVar14 += 1;
					local_19c = 0;
					pbVar10 = (byte *)(format + 3);
					break;
				case 0x4c:
					local_1c6 += '\x01';
					break;
				case 0x68:
					local_1c6 += -1;
					local_1c7 += -1;
					break;
				case 0x6c:
					local_1c6 += '\x01';
				case 0x77:
					local_1c7 += '\x01';
				}
			}
switchD_00494330_caseD_46:
			format = (char *)pbVar10;
		} while (local_1cd == '\0');
		ppiVar3 = argptr;
		if (local_1c5 == '\0') {
			local_1b8 = *argptr;
			ppiVar3 = argptr + 1;
			local_18c = argptr;
		}
		argptr = ppiVar3;
		bVar17 = false;
		if ((local_1c7 == '\0') && ((*format == 'S' || (local_1c7 = -1, *format == 'C')))) {
			local_1c7 = '\x01';
		}
		local_1bc = (byte)*format | 0x20;
		local_188 = iVar14;
		uVar18 = local_19c;
		if (local_1bc != 0x6e) {
			if ((local_1bc == 99) || (local_1bc == 0x7b)) {
				local_1cc += 1;
				c = (int **)FUN_00494f30((byte **)file);
				uVar18 = local_19c;
			}
			else {
				c = (int **)FUN_00494f80(&local_1cc,(byte **)file);
				uVar18 = local_19c;
			}
		}
		piVar12 = local_1b8;
		uVar5 = local_1bc;
		local_19c = uVar18;
		if ((local_1b0 != 0) && (local_1c4 == 0)) {
LAB_00494ded:
			local_1cc += -1;
			FUN_00494f60((uint)c,(char **)file);
			goto LAB_00494e06;
		}
		if (false) {
switchD_00494448_caseD_68:
			if ((int **)(uint)(byte)*format != c) goto LAB_00494ded;
			local_1bf += -1;
			if (local_1c5 == '\0') {
				argptr = local_18c;
			}
			goto LAB_00494d38;
		}
		switch(local_1bc) {
		case 99:
			if (local_1b0 == 0) {
				local_1b0 = 1;
				local_1c4 += 1;
			}
			if ('\0' < local_1c7) {
				local_1c0 = '\x01';
			}
			pcVar11 = &DAT_004b3294;
			break;
		case 100:
		case 0x6f:
		case 0x75:
			goto switchD_00494448_caseD_64;
		case 0x65:
		case 0x66:
		case 0x67:
			pcVar11 = &local_160;
			if (c == (int **)0x2d) {
				local_160 = '-';
				pcVar11 = local_15f;
LAB_00494af3:
				local_1c4 += -1;
				local_1cc += 1;
				c = (int **)FUN_00494f30((byte **)file);
				uVar18 = local_19c;
			}
			else {
				if (c == (int **)0x2b) goto LAB_00494af3;
			}
			iVar14 = local_1a8;
			if ((local_1b0 == 0) || (0x15d < local_1c4)) {
				local_1c4 = 0x15d;
			}
			while( true ) {
				if (globals::g_CharWidth_1__004b0f74 < 2) {
					uVar5 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + (int)c * 2) & 4;
				}
				else {
					local_19c = uVar18;
					uVar5 = _unk_FUN_0048f490((uint)c,4);
					uVar18 = local_19c;
				}
				local_19c = uVar18;
				if ((uVar5 == 0) ||
					 (iVar8 = local_1c4 + -1, bVar17 = local_1c4 == 0, local_1c4 = iVar8, bVar17)) break;
				*pcVar11 = (char)c;
				pcVar11 = pcVar11 + 1;
				local_1cc += 1;
				c = (int **)FUN_00494f30((byte **)file);
				iVar14 = iVar14 + 1;
				uVar18 = local_19c;
			}
			if ((DAT_004b0f78 == (char)c) &&
				 (iVar8 = local_1c4 + -1, bVar17 = local_1c4 != 0, local_1c4 = iVar8, bVar17)) {
				local_1cc += 1;
				c = (int **)FUN_00494f30((byte **)file);
				*pcVar11 = DAT_004b0f78;
				while( true ) {
					pcVar11 = pcVar11 + 1;
					if (globals::g_CharWidth_1__004b0f74 < 2) {
						uVar5 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + (int)c * 2) & 4;
						uVar18 = local_19c;
					}
					else {
						uVar5 = _unk_FUN_0048f490((uint)c,4);
						uVar18 = local_19c;
					}
					if ((uVar5 == 0) ||
						 (iVar8 = local_1c4 + -1, bVar17 = local_1c4 == 0, local_1c4 = iVar8, bVar17)) break;
					*pcVar11 = (char)c;
					iVar14 += 1;
					local_1cc += 1;
					local_19c = uVar18;
					c = (int **)FUN_00494f30((byte **)file);
				}
			}
			pcVar13 = pcVar11;
			if ((iVar14 != 0) &&
				 (((c == (int **)0x65 || (c == (int **)0x45)) &&
					(iVar8 = local_1c4 + -1, bVar17 = local_1c4 != 0, local_1c4 = iVar8, bVar17)))) {
				*pcVar11 = 'e';
				pcVar13 = pcVar11 + 1;
				local_1cc += 1;
				local_19c = uVar18;
				c = (int **)FUN_00494f30((byte **)file);
				if (c == (int **)0x2d) {
					*pcVar13 = '-';
					pcVar13 = pcVar11 + 2;
LAB_00494c4e:
					iVar8 = local_1c4 + -1;
					uVar18 = local_19c;
					if (local_1c4 != 0) goto LAB_00494c63;
				}
				else {
					if (c == (int **)0x2b) goto LAB_00494c4e;
				}
				while( true ) {
					if (globals::g_CharWidth_1__004b0f74 < 2) {
						uVar5 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + (int)c * 2) & 4;
						uVar18 = local_19c;
					}
					else {
						uVar5 = _unk_FUN_0048f490((uint)c,4);
						uVar18 = local_19c;
					}
					if ((uVar5 == 0) ||
						 (iVar8 = local_1c4 + -1, bVar17 = local_1c4 == 0, local_1c4 = iVar8, bVar17)) break;
					iVar14 += 1;
					*pcVar13 = (char)c;
					pcVar13 = pcVar13 + 1;
LAB_00494c63:
					local_1c4 = iVar8;
					local_1cc += 1;
					local_19c = uVar18;
					c = (int **)FUN_00494f30((byte **)file);
				}
			}
			local_1cc += -1;
			local_19c = uVar18;
			FUN_00494f60((uint)c,(char **)file);
			if (iVar14 != 0) {
				uVar18 = local_19c;
				if (local_1c5 == '\0') {
					local_1ac += 1;
					*pcVar13 = '\0';
					(*(code *)PTR_FUN_004b0f88)(local_1c6 + -1,local_1b8,&local_160);
					uVar18 = local_19c;
				}
				goto LAB_00494d38;
			}
			goto LAB_00494e06;
		default:
			goto switchD_00494448_caseD_68;
		case 0x69:
			local_1bc = 100;
		case 0x78:
			uVar5 = local_1bc;
			if (c == (int **)0x2d) {
				local_1be = '\x01';
LAB_00494702:
				local_1c4 += -1;
				if ((local_1c4 == 0) && (local_1b0 != 0)) {
					bVar17 = true;
				}
				else {
					local_1cc += 1;
					c = (int **)FUN_00494f30((byte **)file);
					uVar18 = local_19c;
				}
			}
			else {
				if (c == (int **)0x2b) goto LAB_00494702;
			}
			if (c == (int **)0x30) {
				local_1cc += 1;
				local_19c = uVar18;
				c = (int **)FUN_00494f30((byte **)file);
				if (((char)c == 'x') || ((char)c == 'X')) {
					local_1cc += 1;
					c = (int **)FUN_00494f30((byte **)file);
					uVar5 = 0x78;
					local_1bc = 0x78;
					uVar18 = local_19c;
				}
				else {
					local_1a8 = 1;
					if (uVar5 == 0x78) {
						local_1cc += -1;
						FUN_00494f60((uint)c,(char **)file);
						c = (int **)0x30;
						uVar18 = local_19c;
					}
					else {
						uVar5 = 0x6f;
						local_1bc = 0x6f;
						uVar18 = local_19c;
					}
				}
			}
			goto LAB_004947e4;
		case 0x6e:
			iVar8 = local_1cc;
			if (local_1c5 != '\0') goto LAB_00494d38;
			goto LAB_00494aa5;
		case 0x70:
			local_1c6 = '\x01';
switchD_00494448_caseD_64:
			if (c == (int **)0x2d) {
				local_1be = '\x01';
LAB_004947ba:
				local_1c4 += -1;
				if ((local_1c4 == 0) && (local_1b0 != 0)) {
					bVar17 = true;
				}
				else {
					local_1cc += 1;
					c = (int **)FUN_00494f30((byte **)file);
					uVar18 = local_19c;
				}
			}
			else {
				if (c == (int **)0x2b) goto LAB_004947ba;
			}
LAB_004947e4:
			iVar14 = local_1a4;
			local_19c = uVar18;
			if (iVar14 == 0) {
				while (!bVar17) {
					local_19c = uVar18;
					if ((uVar5 == 0x78) || (uVar5 == 0x70)) {
						if (globals::g_CharWidth_1__004b0f74 < 2) {
							uVar6 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + (int)c * 2) & 0x80;
						}
						else {
							uVar6 = _unk_FUN_0048f490((uint)c,0x80);
							uVar18 = local_19c;
						}
						if (uVar6 != 0) {
							iVar14 <<= 4;
							local_19c = uVar18;
							c = (int **)FUN_00494ef0((uint)c);
							goto LAB_004949da;
						}
LAB_004949d6:
						bVar17 = true;
						local_19c = uVar18;
					}
					else {
						if (globals::g_CharWidth_1__004b0f74 < 2) {
							uVar6 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + (int)c * 2) & 4;
						}
						else {
							uVar6 = _unk_FUN_0048f490((uint)c,4);
							uVar18 = local_19c;
						}
						if (uVar6 == 0) goto LAB_004949d6;
						local_19c = uVar18;
						if (uVar5 == 0x6f) {
							if (0x37 < (int)c) goto LAB_004949d6;
							iVar14 <<= 3;
						}
						else {
							iVar14 *= 10;
						}
					}
LAB_004949da:
					if (bVar17) {
						local_1cc += -1;
						FUN_00494f60((uint)c,(char **)file);
						uVar18 = local_19c;
					}
					else {
						local_1a8 += 1;
						iVar14 = iVar14 + -0x30 + (int)c;
						if ((local_1b0 == 0) || (local_1c4 += -1, local_1c4 != 0)) {
							local_1cc += 1;
							c = (int **)FUN_00494f30((byte **)file);
							uVar18 = local_19c;
						}
						else {
							bVar17 = true;
							uVar18 = local_19c;
						}
					}
				}
				local_1a4 = iVar14;
				if (local_1be != '\0') {
					local_1a4 = -iVar14;
				}
			}
			else {
				while( true ) {
					uVar5 = (uint)uVar18;
					uVar6 = (uint)(uVar18 >> 0x20);
					if (bVar17) break;
					if (local_1bc == 0x78) {
						if (globals::g_CharWidth_1__004b0f74 < 2) {
							uVar5 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + (int)c * 2) & 0x80;
						}
						else {
							uVar5 = _unk_FUN_0048f490((uint)c,0x80);
						}
						if (uVar5 != 0) {
							uVar18 = __allshl();
							c = (int **)FUN_00494ef0((uint)c);
							goto LAB_004948b1;
						}
LAB_004948ad:
						bVar17 = true;
					}
					else {
						if (globals::g_CharWidth_1__004b0f74 < 2) {
							uVar7 = *(byte *)(globals::g_CharTranslate_TABLE._0_4_ + (int)c * 2) & 4;
						}
						else {
							uVar7 = _unk_FUN_0048f490((uint)c,4);
						}
						if (uVar7 == 0) goto LAB_004948ad;
						if (local_1bc == 0x6f) {
							if (0x37 < (int)c) goto LAB_004948ad;
							uVar18 = __allshl();
						}
						else {
							uVar18 = __allmul(uVar5,uVar6,10,0);
						}
					}
LAB_004948b1:
					if (bVar17) {
						local_1cc += -1;
						FUN_00494f60((uint)c,(char **)file);
					}
					else {
						ppiVar3 = c + -0xc;
						local_1a8 += 1;
						if ((local_1b0 == 0) || (local_1c4 += -1, local_1c4 != 0)) {
							local_1cc += 1;
							c = (int **)FUN_00494f30((byte **)file);
							uVar18 = uVar18 + (longlong)(int)ppiVar3;
						}
						else {
							bVar17 = true;
							uVar18 = uVar18 + (longlong)(int)ppiVar3;
						}
					}
				}
				if (local_1be != '\0') {
					uVar18 = CONCAT44(-(uVar6 + (uVar5 != 0)),-uVar5);
				}
			}
			iVar14 = local_1a8;
			if (local_1bc == 0x46) {
				iVar14 = 0;
			}
			if (iVar14 != 0) {
				if (local_1c5 == '\0') {
					local_1ac += 1;
					iVar8 = local_1a4;
					iVar14 = local_188;
LAB_00494aa5:
					local_19c._4_4_ = (int)(uVar18 >> 0x20);
					local_19c._0_4_ = (int)uVar18;
					if (iVar14 == 0) {
						if (local_1c6 == '\0') {
							*(short *)local_1b8 = (short)iVar8;
						}
						else {
							*local_1b8 = iVar8;
						}
					}
					else {
						*local_1b8 = (int)local_19c;
						local_1b8[1] = local_19c._4_4_;
					}
				}
				goto LAB_00494d38;
			}
			goto LAB_00494e06;
		case 0x73:
			if ('\0' < local_1c7) {
				local_1c0 = '\x01';
			}
			pcVar11 = " \t-\r]";
			break;
		case 0x7b:
			if ('\0' < local_1c7) {
				local_1c0 = '\x01';
			}
			pbVar10 = (byte *)(format + 1);
			pcVar11 = (char *)pbVar10;
			if (*pbVar10 == 0x5e) {
				pcVar11 = format + 2;
				format = (char *)pbVar10;
				break;
			}
			goto LAB_004944b3;
		}
		local_1bd = 0xff;
		pbVar10 = (byte *)format;
LAB_004944b3:
		format = (char *)pbVar10;
		puVar15 = local_180;
		for (iVar14 = 8; iVar14 != 0; iVar14 += -1) {
			*puVar15 = 0;
			puVar15 = puVar15 + 1;
		}
		if ((local_1bc == 0x7b) && (*pcVar11 == 0x5d)) {
			local_1b4 = CONCAT31(local_1b4._1_3_,0x5d);
			pcVar11 = (char *)((byte *)pcVar11 + 1);
			local_175 = 0x20;
		}
		bVar2 = *pcVar11;
		while (bVar2 != 0x5d) {
			pbVar10 = (byte *)pcVar11 + 1;
			local_184 = local_184 & 0xffffff00 | (uint)bVar2;
			if (((bVar2 == 0x2d) && ((byte)local_1b4 != 0)) && (bVar9 = *pbVar10, bVar9 != 0x5d)) {
				pbVar10 = (byte *)pcVar11 + 2;
				if ((byte)local_1b4 < bVar9) {
					local_194 = local_194 & 0xffffff00 | (uint)bVar9;
					bVar9 = (byte)local_1b4;
				}
				else {
					local_194 = local_194 & 0xffffff00 | local_1b4 & 0xff;
					local_1b4 = local_1b4 & 0xffffff00 | (uint)bVar9;
				}
				if (bVar9 <= (byte)local_194) {
					uVar5 = local_1b4 & 0xff;
					iVar14 = ((local_194 & 0xff) - uVar5) + 1;
					do {
						bVar2 = (byte)uVar5;
						pbVar1 = (byte *)((int)local_180 + (uVar5 >> 3));
						uVar5 += 1;
						iVar14 += -1;
						*pbVar1 = *pbVar1 | '\x01' << (bVar2 & 7);
					} while (iVar14 != 0);
				}
				local_1b4 &= 0xffffff00;
			}
			else {
				local_1b4 = local_1b4 & 0xffffff00 | (uint)bVar2;
				pbVar1 = (byte *)((int)local_180 + (uint)(bVar2 >> 3));
				*pbVar1 = *pbVar1 | '\x01' << (bVar2 & 7);
			}
			pcVar11 = (char *)pbVar10;
			bVar2 = *pbVar10;
		}
		if (*pcVar11 == 0) goto LAB_00494e06;
		if (local_1bc == 0x7b) {
			format = pcVar11;
		}
		local_1cc += -1;
		FUN_00494f60((uint)c,(char **)file);
		piVar16 = piVar12;
		while( true ) {
			if ((local_1b0 != 0) &&
				 (iVar14 = local_1c4 + -1, bVar17 = local_1c4 == 0, local_1c4 = iVar14, piVar4 = piVar16,
				 bVar17)) goto LAB_0049469c;
			local_1cc += 1;
			c = (int **)FUN_00494f30((byte **)file);
			if ((c == (int **)0xffffffff) ||
				 (bVar2 = (byte)c,
				 ((int)(char)(*(byte *)((int)local_180 + ((int)c >> 3)) ^ local_1bd) & 1 << (bVar2 & 7)) ==
				 0)) break;
			if (local_1c5 == '\0') {
				if (local_1c0 == '\0') {
					*(byte *)piVar16 = bVar2;
					piVar16 = (int *)((int)piVar16 + 1);
				}
				else {
					local_19e = bVar2;
					if ((*(byte *)(globals::g_CharTranslate_TABLE._0_4_ + 1 + ((uint)c & 0xff) * 2) & 0x80) !=
							0) {
						local_1cc += 1;
						uVar5 = FUN_00494f30((byte **)file);
						local_19d = (undefined)uVar5;
					}
					FUN_004990c0(&local_18e,&local_19e,globals::g_CharWidth_1__004b0f74);
					*(ushort *)piVar16 = local_18e;
					piVar16 = (int *)((int)piVar16 + 2);
				}
			}
			else {
				piVar12 = (int *)((int)piVar12 + 1);
			}
		}
		local_1cc += -1;
		local_1b8 = piVar16;
		FUN_00494f60((uint)c,(char **)file);
		piVar4 = local_1b8;
LAB_0049469c:
		local_1b8 = piVar4;
		if (piVar12 == piVar16) goto LAB_00494e06;
		uVar18 = local_19c;
		if ((local_1c5 == '\0') && (local_1ac += 1, local_1bc != 99)) {
			if (local_1c0 == '\0') {
				*(undefined *)local_1b8 = 0;
			}
			else {
				*(undefined2 *)local_1b8 = 0;
			}
		}
LAB_00494d38:
		local_1bf += '\x01';
		pbVar10 = (byte *)(format + 1);
		local_19c = uVar18;
LAB_00494db3:
		format = (char *)pbVar10;
		if ((c == (int **)0xffffffff) && ((*format != '%' || (format[1] != 'n')))) goto LAB_00494e06;
		bVar2 = *format;
	} while( true );
}



uint __cdecl FUN_00494ef0(uint param_1)
{
	uint uVar1;
	
	if (std::globals::g_CharWidth_1__004b0f74 < 2) {
		uVar1 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + param_1 * 2) & 4;
	}
	else {
		uVar1 = std::_unk_FUN_0048f490(param_1,4);
	}
	if (uVar1 == 0) {
		param_1 = (param_1 & 0xffffffdf) - 7;
	}
	return param_1;
}



uint __cdecl FUN_00494f30(byte **param_1)
{
	byte bVar1;
	byte *pbVar2;
	uint uVar3;
	
	pbVar2 = param_1[1];
	param_1[1] = pbVar2 + -1;
	if (-1 < (int)(pbVar2 + -1)) {
		bVar1 = **param_1;
		*param_1 = *param_1 + 1;
		return (uint)bVar1;
	}
	uVar3 = std::__fread_internal__00497300((FILE *)param_1);
	return uVar3;
}



void __cdecl FUN_00494f60(uint param_1,char **param_2)
{
	if (param_1 != 0xffffffff) {
		FUN_00499210(param_1,param_2);
	}
	return;
}



uint __cdecl FUN_00494f80(int *param_1,byte **param_2)
{
	uint uVar1;
	uint uVar2;
	
	*param_1 = *param_1 + 1;
	uVar1 = FUN_00494f30(param_2);
	uVar2 = FUN_004991c0(uVar1);
	while (uVar2 != 0) {
		*param_1 = *param_1 + 1;
		uVar1 = FUN_00494f30(param_2);
		uVar2 = FUN_004991c0(uVar1);
	}
	return uVar1;
}



undefined4 __cdecl std::__fdclose__00494fd0(uint fd)
{
	int iVar1;
	int iVar2;
	HANDLE hObject;
	BOOL BVar3;
	DWORD error_value;
	int iVar4;
	
	if (DAT_0076eec0 <= fd) {
		globals::g_msvc_errno = 9;
		globals::g_msvc_doserrno = 0;
		return 0xffffffff;
	}
	iVar4 = (fd & 0x1f) * 8;
	if ((*(byte *)((&DAT_0076edc0)[(int)fd >> 5] + 4 + iVar4) & 1) == 0) {
		globals::g_msvc_errno = 9;
		globals::g_msvc_doserrno = 0;
		return 0xffffffff;
	}
	iVar1 = FUN_004994b0(fd);
	if (iVar1 != -1) {
		if ((fd == 1) || (fd == 2)) {
			iVar1 = FUN_004994b0(2);
			iVar2 = FUN_004994b0(1);
			if (iVar2 == iVar1) goto LAB_00495057;
		}
		hObject = (HANDLE)FUN_004994b0(fd);
		BVar3 = CloseHandle(hObject);
		if (BVar3 == 0) {
			error_value = GetLastError();
			goto LAB_00495059;
		}
	}
LAB_00495057:
	error_value = 0;
LAB_00495059:
	FUN_00499410(fd);
	*(undefined *)((&DAT_0076edc0)[(int)fd >> 5] + 4 + iVar4) = 0;
	if (error_value == 0) {
		return 0;
	}
	__set_doserrno(error_value);
	return 0xffffffff;
}



void __cdecl std::__ffree__004950b0(FILE *file)
{
	if (((file->_flag & 0x83U) != 0) && ((file->_flag & 8U) != 0)) {
		free(file->_base);
		file->_flag = file->_flag & 0xfffffbf7;
		file->_ptr = NULL;
		file->_base = NULL;
		file->_cnt = 0;
	}
	return;
}



undefined4 * __cdecl
std::__fsopen_FUN_004950f0(LPCSTR filename,char *mode,uint shflag,undefined4 *param_4)
{
	char cVar1;
	bool bVar2;
	bool bVar3;
	bool bVar4;
	uint uVar5;
	char *pcVar6;
	uint uVar7;
	
	cVar1 = *mode;
	bVar3 = false;
	bVar4 = false;
	if (cVar1 == 'a') {
		uVar5 = 0x109;
	}
	else {
		if (cVar1 == 'r') {
			uVar5 = 0;
			uVar7 = DAT_0054a420 | 1;
			goto LAB_0049512d;
		}
		if (cVar1 != 'w') {
			return NULL;
		}
		uVar5 = 0x301;
	}
	uVar7 = DAT_0054a420 | 2;
LAB_0049512d:
	pcVar6 = mode + 1;
	bVar2 = true;
	cVar1 = *pcVar6;
	do {
		if ((cVar1 == '\0') || (!bVar2)) {
			uVar5 = FUN_00499500(filename,uVar5,shflag,0x1a4);
			if ((int)uVar5 < 0) {
				return NULL;
			}
			DAT_0054a3e4 += 1;
			param_4[3] = uVar7;
			param_4[1] = 0;
			*param_4 = 0;
			param_4[2] = 0;
			param_4[7] = 0;
			param_4[4] = uVar5;
			return param_4;
		}
		if (false) goto switchD_00495160_caseD_2c;
		switch(cVar1) {
		case '+':
			if ((uVar5 & 2) != 0) break;
			uVar5 = uVar5 & 0xfffffffe | 2;
			uVar7 = uVar7 & 0xfffffffc | 0x80;
			goto LAB_004951de;
		case 'D':
			if ((uVar5 & 0x40) == 0) {
				uVar5 |= 0x40;
				goto LAB_004951de;
			}
			break;
		case 'R':
			if (!bVar4) {
				bVar4 = true;
				uVar5 |= 0x10;
				goto LAB_004951de;
			}
			break;
		case 'S':
			if (!bVar4) {
				bVar4 = true;
				uVar5 |= 0x20;
				goto LAB_004951de;
			}
			break;
		case 'T':
			if ((uVar5 & 0x1000) == 0) {
				uVar5 |= 0x1000;
				goto LAB_004951de;
			}
			break;
		case 'b':
			if ((uVar5 & 0xc000) == 0) {
				uVar5 |= 0x8000;
				goto LAB_004951de;
			}
			break;
		case 'c':
			if (!bVar3) {
				bVar3 = true;
				uVar7 |= 0x4000;
				goto LAB_004951de;
			}
			break;
		case 'n':
			if (!bVar3) {
				bVar3 = true;
				uVar7 &= 0xffffbfff;
				goto LAB_004951de;
			}
			break;
		case 't':
			if ((uVar5 & 0xc000) == 0) {
				uVar5 |= 0x4000;
				goto LAB_004951de;
			}
		}
switchD_00495160_caseD_2c:
		bVar2 = false;
LAB_004951de:
		pcVar6 = pcVar6 + 1;
		cVar1 = *pcVar6;
	} while( true );
}



undefined4 * std::__unk__004952c0(void)
{
	void *pvVar1;
	int iVar2;
	int *piVar3;
	undefined4 *puVar4;
	
	puVar4 = NULL;
	iVar2 = 0;
	piVar3 = DAT_0076dd98;
	if (0 < DAT_0076eda0) {
		do {
			if (*piVar3 == 0) {
				pvVar1 = malloc(0x20);
				DAT_0076dd98[iVar2] = (int)pvVar1;
				if ((undefined4 *)DAT_0076dd98[iVar2] != NULL) {
					puVar4 = (undefined4 *)DAT_0076dd98[iVar2];
				}
				break;
			}
			if ((*(byte *)(*piVar3 + 0xc) & 0x83) == 0) {
				puVar4 = (undefined4 *)DAT_0076dd98[iVar2];
				break;
			}
			iVar2 += 1;
			piVar3 = piVar3 + 1;
		} while (iVar2 < DAT_0076eda0);
	}
	if (puVar4 != NULL) {
		puVar4[1] = 0;
		puVar4[3] = 0;
		puVar4[2] = 0;
		*puVar4 = 0;
		puVar4[7] = 0;
		puVar4[4] = 0xffffffff;
	}
	return puVar4;
}



undefined4 __cdecl
FUN_00495350(PEXCEPTION_RECORD param_1,PVOID param_2,undefined4 param_3,undefined4 param_4,
						int *param_5,PVOID param_6,PVOID param_7,undefined4 param_8)
{
	code *pcVar1;
	undefined4 uVar2;
	
	if (*param_5 != 0x19930520) {
		FUN_00495e30();
	}
	if ((*(byte *)&param_1->ExceptionFlags & 0x66) == 0) {
		if (param_5[3] != 0) {
			if (((param_1->ExceptionCode == 0xe06d7363) && (0x19930520 < param_1->ExceptionInformation[0])
					) && (pcVar1 = *(code **)(param_1->ExceptionInformation[2] + 8), pcVar1 != NULL)) {
				uVar2 = (*pcVar1)(param_1,param_2,param_3,param_4,param_5,param_6,param_7,param_8);
				return uVar2;
			}
			FUN_00495420(param_1,param_2,param_3,param_4,(int)param_5,(char)param_8,param_6,param_7);
		}
	}
	else {
		if ((param_5[1] != 0) && (param_6 == NULL)) {
			FUN_004957a0((int)param_2,param_4,(int)param_5,-1);
			return 1;
		}
	}
	return 1;
}



void __cdecl
FUN_00495420(PEXCEPTION_RECORD param_1,PVOID param_2,undefined4 param_3,undefined4 param_4,
						int param_5,char param_6,PVOID param_7,PVOID param_8)
{
	byte bVar1;
	int *piVar2;
	PEXCEPTION_RECORD pEVar3;
	uint uVar4;
	byte *pbVar5;
	int iVar6;
	byte **ppbVar7;
	int iVar8;
	byte *pbVar9;
	byte *pbVar10;
	bool bVar11;
	uint local_20;
	int *local_1c;
	int local_18;
	int local_14;
	int local_10;
	uint local_c;
	byte **local_8;
	int local_4;
	
	iVar8 = *(int *)((int)param_2 + 8);
	local_10 = iVar8;
	if ((iVar8 < -1) || (*(int *)(param_5 + 4) <= iVar8)) {
		FUN_00495e30();
	}
	pEVar3 = DAT_0054a194;
	if (param_1->ExceptionCode == 0xe06d7363) {
		if (((param_1->NumberParameters == 3) && (param_1->ExceptionInformation[0] == 0x19930520)) &&
			 (param_1->ExceptionInformation[2] == 0)) {
			if (DAT_0054a194 == NULL) {
				return;
			}
			param_1 = DAT_0054a194;
			param_3 = DAT_0054a198;
			uVar4 = FUN_00499950(DAT_0054a194,1);
			if (uVar4 == 0) {
				FUN_00495e30();
			}
			if (pEVar3->ExceptionCode != 0xe06d7363) goto LAB_0049568b;
			if (((pEVar3->NumberParameters == 3) && (pEVar3->ExceptionInformation[0] == 0x19930520)) &&
				 (pEVar3->ExceptionInformation[2] == 0)) {
				FUN_00495e30();
			}
		}
		if (((param_1->ExceptionCode == 0xe06d7363) && (param_1->NumberParameters == 3)) &&
			 (param_1->ExceptionInformation[0] == 0x19930520)) {
			local_1c = (int *)FUN_0048f150(param_5,(int)param_7,iVar8,&local_20,&local_c);
			if (local_20 < local_c) {
				do {
					if ((*local_1c == iVar8 || *local_1c < iVar8) && (iVar8 <= local_1c[1])) {
						local_14 = local_1c[3];
						pbVar10 = (byte *)local_1c[4];
						if (0 < local_14) {
							piVar2 = *(int **)(param_1->ExceptionInformation[2] + 0xc);
							local_8 = (byte **)(piVar2 + 1);
							local_4 = *piVar2;
							do {
								local_18 = local_4;
								if (0 < local_4) {
									iVar8 = *(int *)(pbVar10 + 4);
									ppbVar7 = local_8;
									do {
										if ((iVar8 == 0) || (pbVar5 = (byte *)(iVar8 + 8), *(char *)(iVar8 + 8) == '\0')
											 ) {
LAB_004955e4:
											bVar11 = true;
										}
										else {
											iVar6 = *(int *)(*ppbVar7 + 4);
											if (iVar8 == iVar6) {
LAB_004955bf:
												if (((((**ppbVar7 & 2) == 0) || ((*pbVar10 & 8) != 0)) &&
														(((*(uint *)param_1->ExceptionInformation[2] & 1) == 0 ||
														 ((*pbVar10 & 1) != 0)))) &&
													 (((*(uint *)param_1->ExceptionInformation[2] & 2) == 0 ||
														((*pbVar10 & 2) != 0)))) goto LAB_004955e4;
												bVar11 = false;
											}
											else {
												pbVar9 = (byte *)(iVar6 + 8);
												do {
													bVar1 = *pbVar5;
													bVar11 = bVar1 < *pbVar9;
													if (bVar1 != *pbVar9) {
LAB_004955a2:
														iVar6 = (1 - (uint)bVar11) - (uint)(bVar11 != 0);
														goto LAB_004955a7;
													}
													if (bVar1 == 0) break;
													bVar1 = pbVar5[1];
													bVar11 = bVar1 < pbVar9[1];
													if (bVar1 != pbVar9[1]) goto LAB_004955a2;
													pbVar5 = pbVar5 + 2;
													pbVar9 = pbVar9 + 2;
												} while (bVar1 != 0);
												iVar6 = 0;
LAB_004955a7:
												if (iVar6 == 0) goto LAB_004955bf;
												bVar11 = false;
											}
										}
										if (bVar11) {
											FUN_00495880(param_1,param_2,param_3,param_4,param_5,pbVar10,*ppbVar7,local_1c
																	 ,(int)param_7,param_8);
											iVar8 = local_10;
											goto LAB_00495654;
										}
										ppbVar7 = ppbVar7 + 1;
										local_18 += -1;
									} while (0 < local_18);
								}
								local_14 += -1;
								pbVar10 = pbVar10 + 0x10;
								iVar8 = local_10;
							} while (0 < local_14);
						}
					}
LAB_00495654:
					local_20 += 1;
					local_1c = local_1c + 5;
				} while (local_20 < local_c);
			}
			if (param_6 == '\0') {
				return;
			}
			FUN_00495ca0((int)param_1);
			return;
		}
	}
LAB_0049568b:
	if (param_6 != '\0') {
		FUN_00495da0();
		return;
	}
	FUN_004956d0(param_1,param_2,param_3,param_4,param_5,iVar8,param_7,param_8);
	return;
}



void __cdecl
FUN_004956d0(PEXCEPTION_RECORD param_1,PVOID param_2,undefined4 param_3,undefined4 param_4,
						int param_5,int param_6,PVOID param_7,PVOID param_8)
{
	PVOID pvVar1;
	PVOID pvVar2;
	int iVar3;
	int *piVar4;
	int iVar5;
	
	pvVar2 = param_8;
	pvVar1 = param_7;
	if ((DAT_0054a19c != 0) &&
		 (iVar3 = FUN_0048eff0((undefined4 *)param_1,param_2,param_3,param_4,param_5,param_7,param_8),
		 iVar3 != 0)) {
		return;
	}
	piVar4 = (int *)FUN_0048f150(param_5,(int)pvVar1,param_6,(uint *)&param_8,(uint *)&param_7);
	if (param_8 < param_7) {
		do {
			if ((*piVar4 <= param_6) && (param_6 <= piVar4[1])) {
				iVar5 = piVar4[4] + piVar4[3] * 0x10;
				iVar3 = *(int *)(iVar5 + -0xc);
				if ((iVar3 == 0) || (*(char *)(iVar3 + 8) == '\0')) {
					FUN_00495880(param_1,param_2,param_3,param_4,param_5,(byte *)(iVar5 + -0x10),NULL,piVar4,
											 (int)pvVar1,pvVar2);
				}
			}
			param_8 = (PVOID)((int)param_8 + 1);
			piVar4 = piVar4 + 5;
		} while (param_8 < param_7);
	}
	return;
}



void __cdecl FUN_004957a0(int param_1,undefined4 param_2,int param_3,int param_4)
{
	int iVar1;
	int iVar2;
	undefined4 *in_FS_OFFSET;
	int local_20;
	undefined *local_1c;
	undefined4 local_14;
	undefined *puStack16;
	undefined *puStack12;
	undefined4 local_8;
	
	puStack12 = &DAT_0049fd50;
	puStack16 = &LAB_00496a98;
	local_14 = *in_FS_OFFSET;
	*in_FS_OFFSET = &local_14;
	local_1c = &stack0xffffffd4;
	for (iVar2 = *(int *)(param_1 + 8); local_8 = 0xffffffff, iVar2 != param_4;
			iVar2 = *(int *)(*(int *)(param_3 + 8) + iVar2 * 8)) {
		local_20 = iVar2;
		if ((iVar2 < 0) || (*(int *)(param_3 + 4) <= iVar2)) {
			FUN_00495e30();
		}
		local_8 = 0;
		iVar1 = *(int *)(*(int *)(param_3 + 8) + 4 + iVar2 * 8);
		if (iVar1 != 0) {
			__CallSettingFrame_12(iVar1,param_1,0x103);
		}
	}
	*(int *)(param_1 + 8) = iVar2;
	*in_FS_OFFSET = local_14;
	return;
}



undefined4 __cdecl FUN_00495860(int **param_1)
{
	if (**param_1 == -0x1f928c9d) {
		FUN_00495da0();
	}
	return 0;
}



void __cdecl
FUN_00495880(PEXCEPTION_RECORD param_1,PVOID param_2,undefined4 param_3,undefined4 param_4,
						int param_5,byte *param_6,byte *param_7,int *param_8,int param_9,PVOID param_10)
{
	undefined *UNRECOVERED_JUMPTABLE;
	
	if (param_7 != NULL) {
		FUN_00495a90((int)param_1,(int)param_2,param_6,param_7);
	}
	if (param_10 == NULL) {
		param_10 = param_2;
	}
	FUN_0048eec0(param_10,param_1);
	FUN_004957a0((int)param_2,param_4,param_5,*param_8);
	*(int *)((int)param_2 + 8) = param_8[1] + 1;
	UNRECOVERED_JUMPTABLE =
			 (undefined *)
			 FUN_00495910(param_1,(int)param_2,param_3,param_5,*(undefined4 *)(param_6 + 0xc),param_9,
										0x100);
	if (UNRECOVERED_JUMPTABLE != NULL) {
		FUN_0048ee70(UNRECOVERED_JUMPTABLE);
	}
	return;
}



undefined4 __cdecl
FUN_00495910(undefined4 param_1,int param_2,undefined4 param_3,undefined4 param_4,undefined4 param_5
						,int param_6,int param_7)
{
	undefined4 uVar1;
	undefined4 *in_FS_OFFSET;
	undefined4 local_30;
	undefined4 local_2c;
	undefined4 local_28;
	undefined4 local_24;
	undefined4 local_20;
	undefined *local_1c;
	undefined4 local_14;
	undefined *puStack16;
	undefined *puStack12;
	undefined4 local_8;
	
	puStack12 = &DAT_0049fd60;
	puStack16 = &LAB_00496a98;
	local_14 = *in_FS_OFFSET;
	*in_FS_OFFSET = &local_14;
	local_1c = &stack0xffffffc4;
	local_30 = param_5;
	local_28 = 0;
	local_2c = *(undefined4 *)(param_2 + -4);
	local_20 = DAT_0054a194;
	local_24 = DAT_0054a198;
	DAT_0054a194 = param_1;
	DAT_0054a198 = param_3;
	local_8 = 1;
	uVar1 = FUN_0048ef60(param_2,param_4,param_5,param_6,param_7);
	local_8 = 0xffffffff;
	local_30 = uVar1;
	FUN_004959fa();
	*in_FS_OFFSET = local_14;
	return uVar1;
}



void FUN_004959fa(void)
{
	int unaff_EBX;
	int unaff_EBP;
	int unaff_ESI;
	int *unaff_EDI;
	
	*(undefined4 *)(unaff_ESI + -4) = *(undefined4 *)(unaff_EBP + -0x28);
	DAT_0054a194 = *(undefined4 *)(unaff_EBP + -0x1c);
	DAT_0054a198 = *(undefined4 *)(unaff_EBP + -0x20);
	if ((((*unaff_EDI == -0x1f928c9d) && (unaff_EDI[4] == 3)) && (unaff_EDI[5] == 0x19930520)) &&
		 ((*(int *)(unaff_EBP + -0x24) == 0 && (unaff_EBX != 0)))) {
		__abnormal_termination();
		FUN_00495ca0((int)unaff_EDI);
	}
	return;
}



undefined4 __cdecl FUN_00495a60(int **param_1)
{
	int *piVar1;
	
	piVar1 = *param_1;
	if ((((*piVar1 == -0x1f928c9d) && (piVar1[4] == 3)) && (piVar1[5] == 0x19930520)) &&
		 (piVar1[7] == 0)) {
		return 1;
	}
	return 0;
}



void __cdecl FUN_00495a90(int param_1,int param_2,byte *param_3,byte *param_4)
{
	int *piVar1;
	uint uVar2;
	int iVar3;
	undefined4 *puVar4;
	undefined4 *in_FS_OFFSET;
	undefined *local_1c;
	undefined4 local_14;
	undefined *puStack16;
	undefined *puStack12;
	undefined4 local_8;
	
	puStack12 = &DAT_0049fd78;
	puStack16 = &LAB_00496a98;
	local_14 = *in_FS_OFFSET;
	*in_FS_OFFSET = &local_14;
	local_1c = &stack0xffffffd4;
	if (((*(int *)(param_3 + 4) != 0) && (*(char *)(*(int *)(param_3 + 4) + 8) != '\0')) &&
		 (*(int *)(param_3 + 8) != 0)) {
		piVar1 = (int *)(param_2 + 0xc + *(int *)(param_3 + 8));
		local_8 = 0;
		if ((*param_3 & 8) == 0) {
			if ((*param_4 & 1) == 0) {
				if (*(int *)(param_4 + 0x18) == 0) {
					local_1c = &stack0xffffffd4;
					uVar2 = FUN_00499950(*(void **)(param_1 + 0x18),1);
					if ((uVar2 != 0) && (uVar2 = FUN_00499970(piVar1,1), uVar2 != 0)) {
						uVar2 = *(uint *)(param_4 + 0x14);
						puVar4 = (undefined4 *)FUN_00495d20(*(int *)(param_1 + 0x18),(int *)(param_4 + 8));
						FUN_004982c0(piVar1,puVar4,uVar2);
						goto LAB_00495c80;
					}
				}
				else {
					uVar2 = FUN_00499950(*(void **)(param_1 + 0x18),1);
					if (((uVar2 != 0) && (uVar2 = FUN_00499970(piVar1,1), uVar2 != 0)) &&
						 (uVar2 = FUN_00499990(*(FARPROC *)(param_4 + 0x18)), uVar2 != 0)) {
						if ((*param_4 & 4) == 0) {
							FUN_00495d20(*(int *)(param_1 + 0x18),(int *)(param_4 + 8));
							FUN_0048eeb0(piVar1,*(undefined **)(param_4 + 0x18));
						}
						else {
							FUN_00495d20(*(int *)(param_1 + 0x18),(int *)(param_4 + 8));
							FUN_0048eeb0(piVar1,*(undefined **)(param_4 + 0x18));
						}
						goto LAB_00495c80;
					}
				}
			}
			else {
				local_1c = &stack0xffffffd4;
				uVar2 = FUN_00499950(*(void **)(param_1 + 0x18),1);
				if ((uVar2 != 0) && (uVar2 = FUN_00499970(piVar1,1), uVar2 != 0)) {
					FUN_004982c0(piVar1,*(undefined4 **)(param_1 + 0x18),*(uint *)(param_4 + 0x14));
					if ((*(int *)(param_4 + 0x14) == 4) && (*piVar1 != 0)) {
						iVar3 = FUN_00495d20(*piVar1,(int *)(param_4 + 8));
						*piVar1 = iVar3;
					}
					goto LAB_00495c80;
				}
			}
		}
		else {
			local_1c = &stack0xffffffd4;
			uVar2 = FUN_00499950(*(void **)(param_1 + 0x18),1);
			if ((uVar2 != 0) && (uVar2 = FUN_00499970(piVar1,1), uVar2 != 0)) {
				iVar3 = *(int *)(param_1 + 0x18);
				*piVar1 = iVar3;
				iVar3 = FUN_00495d20(iVar3,(int *)(param_4 + 8));
				*piVar1 = iVar3;
				goto LAB_00495c80;
			}
		}
		FUN_00495e30();
	}
LAB_00495c80:
	*in_FS_OFFSET = local_14;
	return;
}



void __cdecl FUN_00495ca0(int param_1)
{
	undefined *UNRECOVERED_JUMPTABLE;
	undefined4 *in_FS_OFFSET;
	undefined *local_1c;
	undefined4 local_14;
	undefined *puStack16;
	undefined *puStack12;
	undefined4 local_8;
	
	puStack12 = &DAT_0049fd88;
	puStack16 = &LAB_00496a98;
	local_14 = *in_FS_OFFSET;
	*in_FS_OFFSET = &local_14;
	local_1c = &stack0xffffffd8;
	if ((param_1 != 0) &&
		 (UNRECOVERED_JUMPTABLE = *(undefined **)(*(int *)(param_1 + 0x1c) + 4),
		 UNRECOVERED_JUMPTABLE != NULL)) {
		local_8 = 0;
		FUN_0048eeb0(*(undefined4 *)(param_1 + 0x18),UNRECOVERED_JUMPTABLE);
	}
	*in_FS_OFFSET = local_14;
	return;
}



int __cdecl FUN_00495d20(int param_1,int *param_2)
{
	int iVar1;
	int iVar2;
	
	iVar2 = param_1 + *param_2;
	iVar1 = param_2[1];
	if (-1 < iVar1) {
		iVar2 += *(int *)(*(int *)(param_1 + iVar1) + param_2[2]) + iVar1;
	}
	return iVar2;
}



// WARNING: Restarted to delay deadcode elimination for space: stack
// Library Function - Single Match
// Name: __CallSettingFrame@12
// Libraries: Visual Studio 2003 Debug, Visual Studio 2003 Release

void __CallSettingFrame_12(undefined4 param_1,undefined4 param_2,int param_3)
{
	code *pcVar1;
	
	pcVar1 = (code *)__NLG_Notify1(param_3);
	(*pcVar1)();
	if (param_3 == 0x100) {
		param_3 = 2;
	}
	__NLG_Notify1(param_3);
	return;
}



void FUN_00495da0(void)
{
	undefined *puVar1;
	undefined4 *in_FS_OFFSET;
	undefined *local_1c;
	undefined4 local_14;
	undefined *puStack16;
	undefined *puStack12;
	undefined4 local_8;
	
	puStack12 = &DAT_0049fd98;
	puStack16 = &LAB_00496a98;
	local_14 = *in_FS_OFFSET;
	*in_FS_OFFSET = &local_14;
	local_1c = &stack0xffffffd8;
	puVar1 = &stack0xffffffd8;
	if (DAT_0054a1a0 != NULL) {
		local_8 = 1;
		(*DAT_0054a1a0)();
		puVar1 = local_1c;
	}
	local_1c = puVar1;
	local_8 = 0xffffffff;
	FUN_00495e0e();
	*in_FS_OFFSET = local_14;
	return;
}



void FUN_00495e0e(void)
{
	_abort();
	return;
}



void FUN_00495e30(void)
{
	undefined *puVar1;
	undefined4 *in_FS_OFFSET;
	undefined *local_1c;
	undefined4 local_14;
	undefined *puStack16;
	undefined *puStack12;
	undefined4 local_8;
	
	puStack12 = &DAT_0049fdb0;
	puStack16 = &LAB_00496a98;
	local_14 = *in_FS_OFFSET;
	*in_FS_OFFSET = &local_14;
	local_1c = &stack0xffffffd8;
	puVar1 = &stack0xffffffd8;
	if (PTR_FUN_004b32a4 != NULL) {
		local_8 = 1;
		(*(code *)PTR_FUN_004b32a4)();
		puVar1 = local_1c;
	}
	local_1c = puVar1;
	local_8 = 0xffffffff;
	FUN_00495e9e();
	*in_FS_OFFSET = local_14;
	return;
}



void FUN_00495e9e(void)
{
	FUN_00495da0();
	return;
}



void __cdecl FUN_00496050(uint param_1)
{
	FUN_00496070(param_1,0,4);
	return;
}



undefined4 __cdecl FUN_00496070(uint param_1,uint param_2,byte param_3)
{
	uint uVar1;
	
	if ((*(byte *)((int)&DAT_0054a2b8 + (param_1 & 0xff) + 1) & param_3) == 0) {
		if (param_2 == 0) {
			uVar1 = 0;
		}
		else {
			uVar1 = *(ushort *)(std::globals::g_CharTranslate_TABLE + (param_1 & 0xff) * 2 + 10) & param_2
			;
		}
		if (uVar1 == 0) {
			return 0;
		}
	}
	return 1;
}



void FUN_004960b0(void)
{
	char cVar1;
	char cVar2;
	void **ppvVar3;
	void *pvVar4;
	uint uVar5;
	uint uVar6;
	uint uVar7;
	char *pcVar8;
	int iVar9;
	undefined4 *puVar10;
	char *pcVar11;
	char *pcVar12;
	undefined4 *puVar13;
	void **local_4;
	
	iVar9 = 0;
	cVar2 = *std::globals::g_EnvironmentStringsA;
	pcVar8 = std::globals::g_EnvironmentStringsA;
	while (cVar2 != '\0') {
		if (cVar2 != '=') {
			iVar9 += 1;
		}
		uVar5 = 0xffffffff;
		pcVar11 = pcVar8;
		do {
			if (uVar5 == 0) break;
			uVar5 -= 1;
			cVar2 = *pcVar11;
			pcVar11 = pcVar11 + 1;
		} while (cVar2 != '\0');
		pcVar11 = pcVar8 + ~uVar5;
		pcVar8 = pcVar8 + ~uVar5;
		cVar2 = *pcVar11;
	}
	ppvVar3 = (void **)std::malloc(iVar9 * 4 + 4);
	DAT_0054a0f8 = ppvVar3;
	if (ppvVar3 == NULL) {
		__amsg_exit(9);
	}
	cVar2 = *std::globals::g_EnvironmentStringsA;
	local_4 = ppvVar3;
	pcVar8 = std::globals::g_EnvironmentStringsA;
	do {
		if (cVar2 == '\0') {
			std::free(std::globals::g_EnvironmentStringsA);
			std::globals::g_EnvironmentStringsA = NULL;
			*ppvVar3 = NULL;
			return;
		}
		uVar5 = 0xffffffff;
		pcVar11 = pcVar8;
		do {
			if (uVar5 == 0) break;
			uVar5 -= 1;
			cVar1 = *pcVar11;
			pcVar11 = pcVar11 + 1;
		} while (cVar1 != '\0');
		uVar5 = ~uVar5;
		if (cVar2 != '=') {
			pvVar4 = std::malloc(uVar5);
			*ppvVar3 = pvVar4;
			if (pvVar4 == NULL) {
				__amsg_exit(9);
			}
			uVar6 = 0xffffffff;
			pcVar11 = pcVar8;
			do {
				pcVar12 = pcVar11;
				if (uVar6 == 0) break;
				uVar6 -= 1;
				pcVar12 = pcVar11 + 1;
				cVar2 = *pcVar11;
				pcVar11 = pcVar12;
			} while (cVar2 != '\0');
			uVar6 = ~uVar6;
			puVar10 = (undefined4 *)(pcVar12 + -uVar6);
			puVar13 = (undefined4 *)*local_4;
			for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
				*puVar13 = *puVar10;
				puVar10 = puVar10 + 1;
				puVar13 = puVar13 + 1;
			}
			ppvVar3 = local_4 + 1;
			for (uVar6 &= 3; local_4 = ppvVar3, uVar6 != 0; uVar6 -= 1) {
				*(undefined *)puVar13 = *(undefined *)puVar10;
				puVar10 = (undefined4 *)((int)puVar10 + 1);
				puVar13 = (undefined4 *)((int)puVar13 + 1);
			}
		}
		cVar2 = pcVar8[uVar5];
		pcVar8 = pcVar8 + uVar5;
	} while( true );
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void FUN_004961a0(void)
{
	byte **ppbVar1;
	LPSTR *ppCVar2;
	int local_8;
	int local_4;
	
	GetModuleFileNameA(NULL,(LPSTR)&lpFilename_0054a1a8,0x104);
	_DAT_0054a108 = &lpFilename_0054a1a8;
	ppCVar2 = std::globals::g_CommandLineA;
	if (*(char *)std::globals::g_CommandLineA == '\0') {
		ppCVar2 = &lpFilename_0054a1a8;
	}
	FUN_00496240((byte *)ppCVar2,NULL,NULL,&local_8,&local_4);
	ppbVar1 = (byte **)std::malloc(local_4 + local_8 * 4);
	if (ppbVar1 == NULL) {
		__amsg_exit(8);
	}
	FUN_00496240((byte *)ppCVar2,ppbVar1,(byte *)(ppbVar1 + local_8),&local_8,&local_4);
	_DAT_0054a0ec = local_8 + -1;
	_DAT_0054a0f0 = ppbVar1;
	return;
}



void __cdecl FUN_00496240(byte *param_1,byte **param_2,byte *param_3,int *param_4,int *param_5)
{
	byte *pbVar1;
	byte bVar2;
	bool bVar3;
	bool bVar4;
	bool bVar5;
	int *piVar6;
	byte *pbVar7;
	uint uVar8;
	
	piVar6 = param_5;
	*param_5 = 0;
	*param_4 = 1;
	if (param_2 != NULL) {
		*param_2 = param_3;
		param_2 = param_2 + 1;
	}
	if (*param_1 == 0x22) {
		pbVar7 = param_1 + 1;
		bVar2 = param_1[1];
		while ((bVar2 != 0x22 && (bVar2 != 0))) {
			if (((*(byte *)((int)&DAT_0054a2b8 + bVar2 + 1) & 4) != 0) &&
				 (*param_5 = *param_5 + 1, param_3 != NULL)) {
				*param_3 = *pbVar7;
				param_3 = param_3 + 1;
				pbVar7 = pbVar7 + 1;
			}
			*param_5 = *param_5 + 1;
			if (param_3 != NULL) {
				*param_3 = *pbVar7;
				param_3 = param_3 + 1;
			}
			pbVar1 = pbVar7 + 1;
			pbVar7 = pbVar7 + 1;
			bVar2 = *pbVar1;
		}
		*param_5 = *param_5 + 1;
		if (param_3 != NULL) {
			*param_3 = 0;
			param_3 = param_3 + 1;
		}
		if (*pbVar7 == 0x22) {
			pbVar7 = pbVar7 + 1;
		}
	}
	else {
		do {
			*piVar6 = *piVar6 + 1;
			if (param_3 != NULL) {
				*param_3 = *param_1;
				param_3 = param_3 + 1;
			}
			bVar2 = *param_1;
			pbVar7 = param_1 + 1;
			param_5 = (int *)(uint)bVar2;
			if ((*(byte *)((int)param_5 + 0x54a2b9) & 4) != 0) {
				*piVar6 = *piVar6 + 1;
				if (param_3 != NULL) {
					*param_3 = *pbVar7;
					param_3 = param_3 + 1;
				}
				pbVar7 = param_1 + 2;
			}
			if (bVar2 == 0x20) break;
			if (bVar2 == 0) goto LAB_00496319;
			param_1 = pbVar7;
		} while (bVar2 != 9);
		if (bVar2 == 0) {
LAB_00496319:
			pbVar7 = pbVar7 + -1;
		}
		else {
			if (param_3 != NULL) {
				param_3[-1] = 0;
			}
		}
	}
	bVar4 = false;
	bVar5 = false;
	while (*pbVar7 != 0) {
		for (; (*pbVar7 == 0x20 || (*pbVar7 == 9)); pbVar7 = pbVar7 + 1) {
		}
		if (*pbVar7 == 0) break;
		if (param_2 != NULL) {
			*param_2 = param_3;
			param_2 = param_2 + 1;
		}
		*param_4 = *param_4 + 1;
		while( true ) {
			uVar8 = 0;
			bVar3 = true;
			bVar2 = *pbVar7;
			while (bVar2 == 0x5c) {
				pbVar1 = pbVar7 + 1;
				pbVar7 = pbVar7 + 1;
				uVar8 += 1;
				bVar2 = *pbVar1;
			}
			if (*pbVar7 == 0x22) {
				if ((uVar8 & 1) == 0) {
					if ((bVar4) && (pbVar7[1] == 0x22)) {
						pbVar7 = pbVar7 + 1;
					}
					else {
						bVar3 = false;
					}
					bVar4 = !bVar5;
					bVar5 = bVar4;
				}
				uVar8 >>= 1;
			}
			for (; uVar8 != 0; uVar8 -= 1) {
				if (param_3 != NULL) {
					*param_3 = 0x5c;
					param_3 = param_3 + 1;
				}
				*piVar6 = *piVar6 + 1;
			}
			bVar2 = *pbVar7;
			if ((bVar2 == 0) || ((!bVar4 && ((bVar2 == 0x20 || (bVar2 == 9)))))) break;
			if (bVar3) {
				if (param_3 == NULL) {
					if ((*(byte *)((int)&DAT_0054a2b8 + bVar2 + 1) & 4) != 0) {
						pbVar7 = pbVar7 + 1;
						*piVar6 = *piVar6 + 1;
					}
					*piVar6 = *piVar6 + 1;
					goto LAB_00496415;
				}
				if ((*(byte *)((int)&DAT_0054a2b8 + bVar2 + 1) & 4) != 0) {
					*param_3 = bVar2;
					param_3 = param_3 + 1;
					pbVar7 = pbVar7 + 1;
					*piVar6 = *piVar6 + 1;
				}
				*param_3 = *pbVar7;
				param_3 = param_3 + 1;
				*piVar6 = *piVar6 + 1;
				pbVar7 = pbVar7 + 1;
			}
			else {
LAB_00496415:
				pbVar7 = pbVar7 + 1;
			}
		}
		if (param_3 != NULL) {
			*param_3 = 0;
			param_3 = param_3 + 1;
		}
		*piVar6 = *piVar6 + 1;
	}
	if (param_2 != NULL) {
		*param_2 = NULL;
	}
	*param_4 = *param_4 + 1;
	return;
}



LPSTR std::GetEnvironmentStringsA(void)
{
	char cVar1;
	WCHAR WVar2;
	WCHAR *pWVar3;
	int iVar5;
	uint uVar6;
	undefined4 *puVar7;
	uint uVar8;
	undefined4 *puVar9;
	LPWCH lpWideCharStr;
	undefined4 *puVar10;
	undefined4 *puVar11;
	WCHAR *pWVar4;
	
	lpWideCharStr = NULL;
	puVar9 = NULL;
	if (DAT_0054a2b0 == 0) {
		lpWideCharStr = GetEnvironmentStringsW();
		if (lpWideCharStr == NULL) {
			puVar9 = (undefined4 *)GetEnvironmentStrings();
			if (puVar9 == NULL) {
				return (LPSTR)NULL;
			}
			DAT_0054a2b0 = 2;
		}
		else {
			DAT_0054a2b0 = 1;
		}
	}
	if (DAT_0054a2b0 == 1) {
		if ((lpWideCharStr != NULL) || (lpWideCharStr = GetEnvironmentStringsW(), lpWideCharStr != NULL)
			 ) {
			WVar2 = *lpWideCharStr;
			pWVar3 = lpWideCharStr;
			while (WVar2 != L'\0') {
				do {
					pWVar4 = pWVar3;
					pWVar3 = pWVar4 + 1;
				} while (*pWVar3 != L'\0');
				pWVar3 = pWVar4 + 2;
				WVar2 = *pWVar3;
			}
			iVar5 = ((int)((int)pWVar3 - (int)lpWideCharStr) >> 1) + 1;
			uVar6 = WideCharToMultiByte(0,0,lpWideCharStr,iVar5,NULL,0,NULL,NULL);
			if ((uVar6 != 0) && (puVar9 = (undefined4 *)malloc(uVar6), puVar9 != NULL)) {
				iVar5 = WideCharToMultiByte(0,0,lpWideCharStr,iVar5,(LPSTR)puVar9,uVar6,NULL,NULL);
				if (iVar5 == 0) {
					free(puVar9);
					puVar9 = NULL;
				}
				FreeEnvironmentStringsW(lpWideCharStr);
				return (LPSTR)puVar9;
			}
			FreeEnvironmentStringsW(lpWideCharStr);
			return (LPSTR)NULL;
		}
	}
	else {
		if ((DAT_0054a2b0 == 2) &&
			 ((puVar9 != NULL || (puVar9 = (undefined4 *)GetEnvironmentStrings(), puVar9 != NULL)))) {
			cVar1 = *(char *)puVar9;
			puVar7 = puVar9;
			while (cVar1 != '\0') {
				do {
					puVar10 = puVar7;
					puVar7 = (undefined4 *)((int)puVar10 + 1);
				} while (*(char *)((int)puVar10 + 1) != '\0');
				puVar7 = (undefined4 *)((int)puVar10 + 2);
				cVar1 = *(char *)((int)puVar10 + 2);
			}
			uVar6 = (int)puVar7 + (1 - (int)puVar9);
			puVar7 = (undefined4 *)malloc(uVar6);
			if (puVar7 != NULL) {
				puVar10 = puVar9;
				puVar11 = puVar7;
				for (uVar8 = uVar6 >> 2; uVar8 != 0; uVar8 -= 1) {
					*puVar11 = *puVar10;
					puVar10 = puVar10 + 1;
					puVar11 = puVar11 + 1;
				}
				for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
					*(undefined *)puVar11 = *(undefined *)puVar10;
					puVar10 = (undefined4 *)((int)puVar10 + 1);
					puVar11 = (undefined4 *)((int)puVar11 + 1);
				}
				FreeEnvironmentStringsA((LPCH)puVar9);
				return (LPSTR)puVar7;
			}
			FreeEnvironmentStringsA((LPCH)puVar9);
			return (LPSTR)NULL;
		}
	}
	return (LPSTR)NULL;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

undefined4 __cdecl FUN_004965b0(int param_1)
{
	byte *pbVar1;
	byte bVar2;
	byte bVar3;
	UINT CodePage;
	UINT *pUVar4;
	BOOL BVar5;
	uint uVar6;
	uint uVar7;
	int iVar8;
	int iVar9;
	byte *pbVar10;
	byte *pbVar11;
	undefined4 *puVar12;
	_cpinfo local_14;
	
	CodePage = FUN_004967a0(param_1);
	if (CodePage == DAT_0054a3bc) {
		return 0;
	}
	if (CodePage == 0) {
		FUN_00496850();
		return 0;
	}
	iVar9 = 0;
	pUVar4 = &DAT_004b3338;
	do {
		if (*pUVar4 == CodePage) {
			puVar12 = &DAT_0054a2b8;
			for (iVar8 = 0x40; iVar8 != 0; iVar8 += -1) {
				*puVar12 = 0;
				puVar12 = puVar12 + 1;
			}
			*(undefined *)puVar12 = 0;
			uVar6 = 0;
			pbVar10 = &DAT_004b3348 + iVar9 * 0x30;
			do {
				bVar2 = *pbVar10;
				for (pbVar11 = pbVar10; (bVar2 != 0 && (bVar2 = pbVar11[1], bVar2 != 0));
						pbVar11 = pbVar11 + 2) {
					uVar7 = (uint)*pbVar11;
					if (uVar7 <= bVar2) {
						bVar3 = (&DAT_004b3330)[uVar6];
						do {
							pbVar1 = (byte *)((int)&DAT_0054a2b8 + uVar7 + 1);
							*pbVar1 = *pbVar1 | bVar3;
							uVar7 += 1;
						} while (uVar7 <= bVar2);
					}
					bVar2 = pbVar11[2];
				}
				uVar6 += 1;
				pbVar10 = pbVar10 + 8;
			} while (uVar6 < 4);
			DAT_0054a3bc = CodePage;
			DAT_0054a3c0 = FUN_004967f0(CodePage);
			_DAT_0054a3c8 = (&DAT_004b333c)[iVar9 * 0xc];
			_DAT_0054a3cc = (&DAT_004b3340)[iVar9 * 0xc];
			_DAT_0054a3d0 = (&DAT_004b3344)[iVar9 * 0xc];
			return 0;
		}
		pUVar4 = pUVar4 + 0xc;
		iVar9 += 1;
	} while (pUVar4 < &DAT_004b3428);
	BVar5 = GetCPInfo(CodePage,(LPCPINFO)&local_14);
	if (BVar5 != 1) {
		if (_DAT_0054a3d4 == 0) {
			return 0xffffffff;
		}
		FUN_00496850();
		return 0;
	}
	puVar12 = &DAT_0054a2b8;
	for (iVar9 = 0x40; iVar9 != 0; iVar9 += -1) {
		*puVar12 = 0;
		puVar12 = puVar12 + 1;
	}
	*(undefined *)puVar12 = 0;
	if (local_14.MaxCharSize < 2) {
		DAT_0054a3bc = 0;
		DAT_0054a3c0 = 0;
	}
	else {
		if (local_14.LeadByte[0] != '\0') {
			pbVar10 = local_14.LeadByte + 1;
			do {
				bVar2 = *pbVar10;
				if (bVar2 == 0) break;
				for (uVar6 = (uint)pbVar10[-1]; uVar6 <= bVar2; uVar6 += 1) {
					*(byte *)((int)&DAT_0054a2b8 + uVar6 + 1) = *(byte *)((int)&DAT_0054a2b8 + uVar6 + 1) | 4;
				}
				pbVar11 = pbVar10 + 1;
				pbVar10 = pbVar10 + 2;
			} while (*pbVar11 != 0);
		}
		uVar6 = 1;
		do {
			*(byte *)((int)&DAT_0054a2b8 + uVar6 + 1) = *(byte *)((int)&DAT_0054a2b8 + uVar6 + 1) | 8;
			uVar6 += 1;
		} while (uVar6 < 0xff);
		DAT_0054a3bc = CodePage;
		DAT_0054a3c0 = FUN_004967f0(CodePage);
	}
	_DAT_0054a3c8 = 0;
	_DAT_0054a3cc = 0;
	_DAT_0054a3d0 = 0;
	return 0;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

UINT __cdecl FUN_004967a0(int param_1)
{
	UINT UVar1;
	bool bVar2;
	
	if (param_1 == -2) {
		_DAT_0054a3d4 = 1;
										// WARNING: Could not recover jumptable at 0x004967bd. Too many branches
										// WARNING: Treating indirect jump as call
		UVar1 = GetOEMCP();
		return UVar1;
	}
	if (param_1 == -3) {
		_DAT_0054a3d4 = 1;
										// WARNING: Could not recover jumptable at 0x004967d2. Too many branches
										// WARNING: Treating indirect jump as call
		UVar1 = GetACP();
		return UVar1;
	}
	bVar2 = param_1 == -4;
	if (bVar2) {
		param_1 = DAT_0054a190;
	}
	_DAT_0054a3d4 = (uint)bVar2;
	return param_1;
}



undefined4 __cdecl FUN_004967f0(undefined4 param_1)
{
	if (true) {
		switch(param_1) {
		case 0x3a4:
			return 0x411;
		case 0x3a8:
			return 0x804;
		case 0x3b5:
			return 0x412;
		case 0x3b6:
			return 0x404;
		}
	}
	return 0;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void FUN_00496850(void)
{
	int iVar1;
	undefined4 *puVar2;
	
	puVar2 = &DAT_0054a2b8;
	for (iVar1 = 0x40; iVar1 != 0; iVar1 += -1) {
		*puVar2 = 0;
		puVar2 = puVar2 + 1;
	}
	*(undefined *)puVar2 = 0;
	DAT_0054a3bc = 0;
	DAT_0054a3c0 = 0;
	_DAT_0054a3c8 = 0;
	_DAT_0054a3cc = 0;
	_DAT_0054a3d0 = 0;
	return;
}



void FUN_00496880(void)
{
	FUN_004965b0(-3);
	return;
}



void FUN_00496890(void)
{
	byte bVar1;
	undefined4 *puVar2;
	DWORD DVar3;
	HANDLE hFile;
	int iVar4;
	HANDLE *ppvVar5;
	int *piVar6;
	uint uVar7;
	UINT local_48;
	_STARTUPINFOA local_44;
	
	puVar2 = (undefined4 *)std::malloc(0x100);
	if (puVar2 == NULL) {
		__amsg_exit(0x1b);
	}
	DAT_0076eec0 = 0x20;
	DAT_0076edc0 = puVar2;
	if (puVar2 < puVar2 + 0x40) {
		do {
			*(undefined *)(puVar2 + 1) = 0;
			*puVar2 = 0xffffffff;
			*(undefined *)((int)puVar2 + 5) = 10;
			puVar2 = puVar2 + 2;
		} while (puVar2 < DAT_0076edc0 + 0x40);
	}
	GetStartupInfoA((LPSTARTUPINFOA)&local_44);
	if ((local_44.cbReserved2 != 0) && ((UINT *)local_44.lpReserved2 != NULL)) {
		local_48 = *(UINT *)local_44.lpReserved2;
		local_44.lpReserved2 = (LPBYTE)((int)local_44.lpReserved2 + 4);
		ppvVar5 = (HANDLE *)((int)local_44.lpReserved2 + local_48);
		if (0x7ff < (int)local_48) {
			local_48 = 0x800;
		}
		if ((int)DAT_0076eec0 < (int)local_48) {
			piVar6 = &DAT_0076edc4;
			do {
				puVar2 = (undefined4 *)std::malloc(0x100);
				if (puVar2 == NULL) {
					local_48 = DAT_0076eec0;
					break;
				}
				*piVar6 = (int)puVar2;
				DAT_0076eec0 += 0x20;
				if (puVar2 < puVar2 + 0x40) {
					do {
						*(undefined *)(puVar2 + 1) = 0;
						*puVar2 = 0xffffffff;
						*(undefined *)((int)puVar2 + 5) = 10;
						puVar2 = puVar2 + 2;
					} while (puVar2 < (undefined4 *)(*piVar6 + 0x100));
				}
				piVar6 = piVar6 + 1;
			} while ((int)DAT_0076eec0 < (int)local_48);
		}
		uVar7 = 0;
		if (0 < (int)local_48) {
			do {
				if (((*ppvVar5 != (HANDLE)0xffffffff) && ((*local_44.lpReserved2 & 1) != 0)) &&
					 (((*local_44.lpReserved2 & 8) != 0 || (DVar3 = GetFileType(*ppvVar5), DVar3 != 0)))) {
					iVar4 = (int)(&DAT_0076edc0)[(int)uVar7 >> 5];
					*(HANDLE *)(iVar4 + (uVar7 & 0x1f) * 8) = *ppvVar5;
					*(BYTE *)(iVar4 + (uVar7 & 0x1f) * 8 + 4) = *local_44.lpReserved2;
				}
				uVar7 += 1;
				local_44.lpReserved2 = (LPBYTE)((int)local_44.lpReserved2 + 1);
				ppvVar5 = ppvVar5 + 1;
			} while ((int)uVar7 < (int)local_48);
		}
	}
	iVar4 = 0;
	do {
		ppvVar5 = (HANDLE *)(DAT_0076edc0 + iVar4 * 2);
		if (DAT_0076edc0[iVar4 * 2] == -1) {
			*(undefined *)(ppvVar5 + 1) = 0x81;
			if (iVar4 == 0) {
				DVar3 = 0xfffffff6;
			}
			else {
				DVar3 = 0xfffffff5 - (iVar4 != 1);
			}
			hFile = GetStdHandle(DVar3);
			if ((hFile == (HANDLE)0xffffffff) || (DVar3 = GetFileType(hFile), DVar3 == 0)) {
				bVar1 = *(byte *)(ppvVar5 + 1) | 0x40;
				goto LAB_00496a6b;
			}
			*ppvVar5 = hFile;
			if ((DVar3 & 0xff) == 2) {
				bVar1 = *(byte *)(ppvVar5 + 1) | 0x40;
				goto LAB_00496a6b;
			}
			if ((DVar3 & 0xff) == 3) {
				bVar1 = *(byte *)(ppvVar5 + 1) | 8;
				goto LAB_00496a6b;
			}
		}
		else {
			bVar1 = *(byte *)(ppvVar5 + 1) | 0x80;
LAB_00496a6b:
			*(byte *)(ppvVar5 + 1) = bVar1;
		}
		iVar4 += 1;
		if (2 < iVar4) {
			SetHandleCount(DAT_0076eec0);
			return;
		}
	} while( true );
}



void FUN_00496b55(int param_1)
{
	__local_unwind2(*(int *)(param_1 + 0x18),*(int *)(param_1 + 0x1c));
	return;
}



void FUN_00496b70(void)
{
	if ((DAT_0054a124 == 1) || ((DAT_0054a124 == 0 && (DAT_004b0d64 == 1)))) {
		FUN_00496bb0(0xfc);
		if (DAT_0054a3d8 != NULL) {
			(*DAT_0054a3d8)();
		}
		FUN_00496bb0(0xff);
	}
	return;
}



void __cdecl FUN_00496bb0(int param_1)
{
	char cVar1;
	int *piVar2;
	DWORD DVar3;
	HANDLE hFile;
	int iVar4;
	uint uVar5;
	uint uVar6;
	undefined4 *puVar7;
	int iVar8;
	undefined4 *puVar9;
	undefined4 *puVar10;
	char *pcVar11;
	char *pcVar12;
	DWORD local_1a8;
	undefined4 local_1a4 [25];
	undefined4 auStack320 [15];
	undefined4 local_104;
	
	piVar2 = &DAT_004b3430;
	iVar8 = 0;
	do {
		if (param_1 == *piVar2) break;
		piVar2 = piVar2 + 2;
		iVar8 += 1;
	} while (piVar2 < &DAT_004b34c0);
	if (param_1 == (&DAT_004b3430)[iVar8 * 2]) {
		if ((DAT_0054a124 == 1) || ((DAT_0054a124 == 0 && (DAT_004b0d64 == 1)))) {
			if ((DAT_0076edc0 == 0) ||
				 (hFile = *(HANDLE *)(DAT_0076edc0 + 0x10), hFile == (HANDLE)0xffffffff)) {
				hFile = GetStdHandle(0xfffffff4);
			}
			pcVar11 = *(char **)(iVar8 * 8 + 0x4b3434);
			uVar5 = 0xffffffff;
			pcVar12 = pcVar11;
			do {
				if (uVar5 == 0) break;
				uVar5 -= 1;
				cVar1 = *pcVar12;
				pcVar12 = pcVar12 + 1;
			} while (cVar1 != '\0');
			WriteFile(hFile,pcVar11,~uVar5 - 1,&local_1a8,NULL);
		}
		else {
			if (param_1 != 0xfc) {
				DVar3 = GetModuleFileNameA(NULL,(LPSTR)&local_104,0x104);
				if (DVar3 == 0) {
					puVar7 = (undefined4 *)"<program name unknown>";
					puVar9 = &local_104;
					for (iVar4 = 5; iVar4 != 0; iVar4 += -1) {
						*puVar9 = *puVar7;
						puVar7 = puVar7 + 1;
						puVar9 = puVar9 + 1;
					}
					*(undefined2 *)puVar9 = *(undefined2 *)puVar7;
					*(undefined *)((int)puVar9 + 2) = *(undefined *)((int)puVar7 + 2);
				}
				uVar5 = 0xffffffff;
				puVar7 = &local_104;
				puVar9 = &local_104;
				do {
					if (uVar5 == 0) break;
					uVar5 -= 1;
					cVar1 = *(char *)puVar9;
					puVar9 = (undefined4 *)((int)puVar9 + 1);
				} while (cVar1 != '\0');
				if (0x3c < ~uVar5) {
					uVar5 = 0xffffffff;
					puVar7 = &local_104;
					do {
						if (uVar5 == 0) break;
						uVar5 -= 1;
						cVar1 = *(char *)puVar7;
						puVar7 = (undefined4 *)((int)puVar7 + 1);
					} while (cVar1 != '\0');
					puVar7 = (undefined4 *)((int)auStack320 + ~uVar5);
					std::_strncpy((char *)puVar7,"...",3);
				}
				puVar9 = (undefined4 *)"Runtime Error!\n\nProgram: ";
				puVar10 = local_1a4;
				for (iVar4 = 6; iVar4 != 0; iVar4 += -1) {
					*puVar10 = *puVar9;
					puVar9 = puVar9 + 1;
					puVar10 = puVar10 + 1;
				}
				*(undefined2 *)puVar10 = *(undefined2 *)puVar9;
				uVar5 = 0xffffffff;
				do {
					puVar9 = puVar7;
					if (uVar5 == 0) break;
					uVar5 -= 1;
					puVar9 = (undefined4 *)((int)puVar7 + 1);
					cVar1 = *(char *)puVar7;
					puVar7 = puVar9;
				} while (cVar1 != '\0');
				uVar5 = ~uVar5;
				iVar4 = -1;
				puVar7 = local_1a4;
				do {
					puVar10 = puVar7;
					if (iVar4 == 0) break;
					iVar4 += -1;
					puVar10 = (undefined4 *)((int)puVar7 + 1);
					cVar1 = *(char *)puVar7;
					puVar7 = puVar10;
				} while (cVar1 != '\0');
				puVar7 = (undefined4 *)((int)puVar9 - uVar5);
				puVar9 = (undefined4 *)((int)puVar10 + -1);
				for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
					*puVar9 = *puVar7;
					puVar7 = puVar7 + 1;
					puVar9 = puVar9 + 1;
				}
				for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
					*(undefined *)puVar9 = *(undefined *)puVar7;
					puVar7 = (undefined4 *)((int)puVar7 + 1);
					puVar9 = (undefined4 *)((int)puVar9 + 1);
				}
				uVar5 = 0xffffffff;
				pcVar11 = "\n\n";
				do {
					pcVar12 = pcVar11;
					if (uVar5 == 0) break;
					uVar5 -= 1;
					pcVar12 = pcVar11 + 1;
					cVar1 = *pcVar11;
					pcVar11 = pcVar12;
				} while (cVar1 != '\0');
				uVar5 = ~uVar5;
				iVar4 = -1;
				puVar7 = local_1a4;
				do {
					puVar9 = puVar7;
					if (iVar4 == 0) break;
					iVar4 += -1;
					puVar9 = (undefined4 *)((int)puVar7 + 1);
					cVar1 = *(char *)puVar7;
					puVar7 = puVar9;
				} while (cVar1 != '\0');
				puVar7 = (undefined4 *)(pcVar12 + -uVar5);
				puVar9 = (undefined4 *)((int)puVar9 + -1);
				for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
					*puVar9 = *puVar7;
					puVar7 = puVar7 + 1;
					puVar9 = puVar9 + 1;
				}
				for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
					*(undefined *)puVar9 = *(undefined *)puVar7;
					puVar7 = (undefined4 *)((int)puVar7 + 1);
					puVar9 = (undefined4 *)((int)puVar9 + 1);
				}
				uVar5 = 0xffffffff;
				pcVar11 = *(char **)(iVar8 * 8 + 0x4b3434);
				do {
					pcVar12 = pcVar11;
					if (uVar5 == 0) break;
					uVar5 -= 1;
					pcVar12 = pcVar11 + 1;
					cVar1 = *pcVar11;
					pcVar11 = pcVar12;
				} while (cVar1 != '\0');
				uVar5 = ~uVar5;
				iVar8 = -1;
				puVar7 = local_1a4;
				do {
					puVar9 = puVar7;
					if (iVar8 == 0) break;
					iVar8 += -1;
					puVar9 = (undefined4 *)((int)puVar7 + 1);
					cVar1 = *(char *)puVar7;
					puVar7 = puVar9;
				} while (cVar1 != '\0');
				puVar7 = (undefined4 *)(pcVar12 + -uVar5);
				puVar9 = (undefined4 *)((int)puVar9 + -1);
				for (uVar6 = uVar5 >> 2; uVar6 != 0; uVar6 -= 1) {
					*puVar9 = *puVar7;
					puVar7 = puVar7 + 1;
					puVar9 = puVar9 + 1;
				}
				for (uVar5 &= 3; uVar5 != 0; uVar5 -= 1) {
					*(undefined *)puVar9 = *(undefined *)puVar7;
					puVar7 = (undefined4 *)((int)puVar7 + 1);
					puVar9 = (undefined4 *)((int)puVar9 + 1);
				}
				FUN_004999f0(local_1a4,"Microsoft Visual C++ Runtime Library",0x12010);
				return;
			}
		}
	}
	return;
}



LCID __cdecl
std::_unk_FUN_00496d90
					(DWORD param_1,LPCSTR param_2,int param_3,LPWORD param_4,UINT param_5,LCID param_6)
{
	BOOL BVar1;
	LCID LVar2;
	int iVar3;
	int *lpWideCharStr;
	WORD local_2;
	
	lpWideCharStr = NULL;
	if (DAT_0054a3e0 == 0) {
		BVar1 = GetStringTypeA(0,1,(LPCSTR)&lpSrcStr_0049fd38,1,&local_2);
		if (BVar1 == 0) {
			BVar1 = GetStringTypeW(1,(LPCWSTR)&lpSrcStr_0049fd3c,1,&local_2);
			if (BVar1 == 0) {
				return 0;
			}
			DAT_0054a3e0 = 1;
		}
		else {
			DAT_0054a3e0 = 2;
		}
	}
	if (DAT_0054a3e0 == 2) {
		if (param_6 == 0) {
			param_6 = DAT_0054a180;
		}
		LVar2 = GetStringTypeA(param_6,param_1,param_2,param_3,param_4);
		return LVar2;
	}
	param_6 = DAT_0054a3e0;
	if (DAT_0054a3e0 == 1) {
		param_6 = 0;
		if (param_5 == 0) {
			param_5 = DAT_0054a190;
		}
		iVar3 = MultiByteToWideChar(param_5,9,param_2,param_3,NULL,0);
		if (iVar3 != 0) {
			lpWideCharStr = FUN_00499a80(2,iVar3);
			if (lpWideCharStr != NULL) {
				iVar3 = MultiByteToWideChar(param_5,1,param_2,param_3,(LPWSTR)lpWideCharStr,iVar3);
				if (iVar3 != 0) {
					LVar2 = GetStringTypeW(param_1,(LPCWSTR)lpWideCharStr,iVar3,param_4);
					free(lpWideCharStr);
					return LVar2;
				}
			}
		}
		free(lpWideCharStr);
	}
	return param_6;
}



DWORD __cdecl FUN_00496ec0(uint param_1,LONG param_2,DWORD param_3)
{
	HANDLE hFile;
	DWORD DVar1;
	uint error_value;
	int iVar2;
	
	if (param_1 < DAT_0076eec0) {
		iVar2 = (param_1 & 0x1f) * 8;
		if ((*(byte *)((&DAT_0076edc0)[(int)param_1 >> 5] + 4 + iVar2) & 1) != 0) {
			hFile = (HANDLE)FUN_004994b0(param_1);
			if (hFile == (HANDLE)0xffffffff) {
				std::globals::g_msvc_errno = 9;
				return 0xffffffff;
			}
			DVar1 = SetFilePointer(hFile,param_2,NULL,param_3);
			if (DVar1 == 0xffffffff) {
				error_value = GetLastError();
			}
			else {
				error_value = 0;
			}
			if (error_value != 0) {
				std::__set_doserrno(error_value);
				return 0xffffffff;
			}
			*(byte *)((&DAT_0076edc0)[(int)param_1 >> 5] + 4 + iVar2) =
					 *(byte *)((&DAT_0076edc0)[(int)param_1 >> 5] + 4 + iVar2) & 0xfd;
			return DVar1;
		}
	}
	std::globals::g_msvc_errno = 9;
	std::globals::g_msvc_doserrno = 0;
	return 0xffffffff;
}



int __cdecl std::__fdwrite__00496f80(uint param_1,char *param_2,char *param_3)
{
	int *piVar1;
	byte bVar2;
	char cVar3;
	char *pcVar4;
	BOOL BVar5;
	int iVar6;
	char *pcVar7;
	DWORD local_41c;
	DWORD local_414;
	DWORD local_410;
	int local_40c;
	int *local_408;
	char local_404 [1028];
	
	if (param_1 < DAT_0076eec0) {
		piVar1 = &DAT_0076edc0 + ((int)param_1 >> 5);
		iVar6 = (param_1 & 0x1f) * 8;
		bVar2 = *(byte *)(iVar6 + 4 + (&DAT_0076edc0)[(int)param_1 >> 5]);
		if ((bVar2 & 1) != 0) {
			local_41c = 0;
			local_40c = 0;
			if (param_3 == NULL) {
				return 0;
			}
			local_408 = piVar1;
			if ((bVar2 & 0x20) != 0) {
				FUN_00496ec0(param_1,0,2);
			}
			if ((*(byte *)((HANDLE *)(*piVar1 + iVar6) + 1) & 0x80) == 0) {
				BVar5 = WriteFile(*(HANDLE *)(*piVar1 + iVar6),param_2,(DWORD)param_3,&local_410,NULL);
				if (BVar5 == 0) {
					local_414 = GetLastError();
				}
				else {
					local_41c = local_410;
					local_414 = 0;
				}
			}
			else {
				local_414 = 0;
				pcVar7 = param_2;
				if (param_3 != NULL) {
					do {
						pcVar4 = local_404;
						do {
							if (param_3 <= pcVar7 + -(int)param_2) break;
							cVar3 = *pcVar7;
							pcVar7 = pcVar7 + 1;
							if (cVar3 == '\n') {
								*pcVar4 = '\r';
								local_40c += 1;
								pcVar4 = pcVar4 + 1;
							}
							*pcVar4 = cVar3;
							pcVar4 = pcVar4 + 1;
						} while ((int)(pcVar4 + -(int)local_404) < 0x400);
						BVar5 = WriteFile(*(HANDLE *)(iVar6 + *local_408),local_404,
															(DWORD)(pcVar4 + -(int)local_404),&local_410,NULL);
						if (BVar5 == 0) {
							local_414 = GetLastError();
							break;
						}
						local_41c += local_410;
						if (((int)local_410 < (int)(pcVar4 + -(int)local_404)) ||
							 (param_3 <= pcVar7 + -(int)param_2)) break;
					} while( true );
				}
			}
			if (local_41c != 0) {
				return local_41c - local_40c;
			}
			if (local_414 == 0) {
				if (((*(byte *)(iVar6 + 4 + *local_408) & 0x40) != 0) && (*param_2 == '\x1a')) {
					return 0;
				}
				globals::g_msvc_errno = 0x1c;
				globals::g_msvc_doserrno = 0;
				return -1;
			}
			if (local_414 == 5) {
				globals::g_msvc_errno = 9;
				globals::g_msvc_doserrno = local_414;
				return -1;
			}
			__set_doserrno(local_414);
			return -1;
		}
	}
	globals::g_msvc_errno = 9;
	globals::g_msvc_doserrno = 0;
	return -1;
}



void __cdecl std::__set_doserrno(uint error_value)
{
	undefined **ppuVar1;
	int iVar2;
	
	iVar2 = 0;
	ppuVar1 = (undefined **)&DAT_004b34c0;
	do {
		if ((undefined *)error_value == *ppuVar1) {
			globals::g_msvc_errno = (&DAT_004b34c4)[iVar2 * 2];
			globals::g_msvc_doserrno = error_value;
			return;
		}
		ppuVar1 = ppuVar1 + 2;
		iVar2 += 1;
	} while (ppuVar1 < &PTR_DAT_004b3628);
	if ((0x12 < error_value) && (error_value < 0x25)) {
		globals::g_msvc_errno = EACCES;
		globals::g_msvc_doserrno = error_value;
		return;
	}
	if ((error_value < 0xbc) || (globals::g_msvc_errno = ENOEXEC, 0xca < error_value)) {
		globals::g_msvc_errno = EINVAL;
	}
	globals::g_msvc_doserrno = error_value;
	return;
}



int __cdecl
FUN_00497210(int param_1,int param_2,int param_3,int param_4,int param_5,int param_6,int param_7)
{
	int iVar1;
	uint uVar2;
	int local_24 [2];
	int local_1c;
	int local_14;
	uint local_10;
	int local_8;
	
	local_10 = param_1 - 0x76c;
	if (((int)local_10 < 0x46) || (0x8a < (int)local_10)) {
		return -1;
	}
	local_8 = *(int *)(&DAT_004b39dc + param_2 * 4) + param_3;
	if (((local_10 & 3) == 0) && (2 < param_2)) {
		local_8 += 1;
	}
	FUN_00499b20();
	local_1c = param_4;
	local_14 = param_2 + -1;
	iVar1 = param_6 + (param_5 +
										(param_4 + ((param_1 + -0x76d >> 2) + local_10 * 0x16d + local_8) * 0x18) * 0x3c
										) * 0x3c + 0x7c558180 + DAT_004b38f0;
	if (param_7 != 1) {
		if (param_7 != -1) {
			return iVar1;
		}
		if (DAT_004b38f4 == 0) {
			return iVar1;
		}
		uVar2 = FUN_00499df0(local_24);
		if (uVar2 == 0) {
			return iVar1;
		}
	}
	return iVar1 + DAT_004b38f8;
}



uint __cdecl std::__fread_internal__00497300(FILE *file)
{
	byte bVar1;
	uint uVar2;
	char *pcVar3;
	undefined *puVar4;
	
	uVar2 = file->_flag;
	if (((uVar2 & 0x83) != 0) && ((uVar2 & 0x40) == 0)) {
		if ((uVar2 & 2) != 0) {
			file->_flag = uVar2 | 0x20;
			return 0xffffffff;
		}
		file->_flag = uVar2 | 1;
		if ((uVar2 & 0x10c) == 0) {
			FUN_00498da0((int *)file);
		}
		else {
			file->_ptr = file->_base;
		}
		pcVar3 = FUN_004973f0(file->_file,file->_base,file->_bufsiz);
		file->_cnt = (int)pcVar3;
		if ((pcVar3 != NULL) && (pcVar3 != (char *)0xffffffff)) {
			if ((file->_flag & 0x82U) == 0) {
				uVar2 = file->_file;
				if (uVar2 == 0xffffffff) {
					puVar4 = &DAT_004b3428;
				}
				else {
					puVar4 = (undefined *)((&DAT_0076edc0)[(int)uVar2 >> 5] + (uVar2 & 0x1f) * 8);
				}
				if ((puVar4[4] & 0x82) == 0x82) {
					file->_flag = file->_flag | 0x2000;
				}
			}
			if (((file->_bufsiz == 0x200) && ((file->_flag & 8U) != 0)) && ((file->_flag & 0x400U) == 0))
			{
				file->_bufsiz = 0x1000;
			}
			file->_cnt = (int)(pcVar3 + -1);
			bVar1 = *file->_ptr;
			file->_ptr = file->_ptr + 1;
			return (uint)bVar1;
		}
		file->_cnt = 0;
		file->_flag = file->_flag | (-(uint)(pcVar3 != NULL) & 0x10) + 0x10;
	}
	return 0xffffffff;
}



char * __cdecl FUN_004973f0(uint param_1,char *param_2,DWORD param_3)
{
	int *piVar1;
	char cVar2;
	byte bVar3;
	BOOL BVar4;
	DWORD DVar5;
	int iVar6;
	int iVar7;
	char *pcVar8;
	char *pcVar9;
	DWORD local_c;
	int *local_8;
	char *local_4;
	
	if (param_1 < DAT_0076eec0) {
		iVar6 = (param_1 & 0x1f) * 8;
		piVar1 = &DAT_0076edc0 + ((int)param_1 >> 5);
		local_c = iVar6 + (&DAT_0076edc0)[(int)param_1 >> 5];
		bVar3 = *(byte *)(local_c + 4);
		if ((bVar3 & 1) != 0) {
			iVar7 = 0;
			if ((param_3 == 0) || ((bVar3 & 2) != 0)) {
				return NULL;
			}
			pcVar8 = param_2;
			DVar5 = param_3;
			if (((bVar3 & 0x48) != 0) && (*(char *)(local_c + 5) != '\n')) {
				*param_2 = *(char *)(local_c + 5);
				pcVar8 = param_2 + 1;
				iVar7 = 1;
				DVar5 = param_3 - 1;
				*(undefined *)(iVar6 + 5 + *piVar1) = 10;
			}
			local_8 = piVar1;
			BVar4 = ReadFile(*(HANDLE *)(iVar6 + *piVar1),pcVar8,DVar5,&local_c,NULL);
			if (BVar4 == 0) {
				DVar5 = GetLastError();
				if (DVar5 == 5) {
					std::globals::g_msvc_errno = 9;
					std::globals::g_msvc_doserrno = DVar5;
					return (char *)0xffffffff;
				}
				if (DVar5 == 0x6d) {
					return NULL;
				}
				std::__set_doserrno(DVar5);
				return (char *)0xffffffff;
			}
			local_4 = (char *)(iVar7 + local_c);
			bVar3 = *(byte *)(iVar6 + 4 + *piVar1);
			if ((bVar3 & 0x80) != 0) {
				if ((local_c == 0) || (*param_2 != '\n')) {
					bVar3 &= 0xfb;
				}
				else {
					bVar3 |= 4;
				}
				*(byte *)(iVar6 + 4 + *piVar1) = bVar3;
				local_4 = local_4 + (int)param_2;
				pcVar8 = param_2;
				pcVar9 = param_2;
				if (param_2 < local_4) {
					while (cVar2 = *pcVar9, cVar2 != '\x1a') {
						if (cVar2 == '\r') {
							if (pcVar9 < local_4 + -1) {
								if (pcVar9[1] == '\n') {
									pcVar9 = pcVar9 + 2;
									*pcVar8 = '\n';
									goto LAB_004975d8;
								}
								*pcVar8 = '\r';
								pcVar8 = pcVar8 + 1;
								pcVar9 = pcVar9 + 1;
							}
							else {
								DVar5 = 0;
								pcVar9 = pcVar9 + 1;
								BVar4 = ReadFile(*(HANDLE *)(iVar6 + *local_8),&param_3,1,&local_c,NULL);
								if (BVar4 == 0) {
									DVar5 = GetLastError();
								}
								if ((DVar5 == 0) && (local_c != 0)) {
									if ((*(byte *)(iVar6 + 4 + *local_8) & 0x48) == 0) {
										if ((pcVar8 == param_2) && ((char)param_3 == '\n')) {
											*pcVar8 = '\n';
											goto LAB_004975d8;
										}
										FUN_00496ec0(param_1,-1,1);
										if ((char)param_3 != '\n') goto LAB_004975d5;
									}
									else {
										if ((char)param_3 == '\n') {
											*pcVar8 = '\n';
											goto LAB_004975d8;
										}
										*pcVar8 = '\r';
										pcVar8 = pcVar8 + 1;
										*(char *)(iVar6 + 5 + *local_8) = (char)param_3;
									}
								}
								else {
LAB_004975d5:
									*pcVar8 = '\r';
LAB_004975d8:
									pcVar8 = pcVar8 + 1;
								}
							}
						}
						else {
							*pcVar8 = cVar2;
							pcVar8 = pcVar8 + 1;
							pcVar9 = pcVar9 + 1;
						}
						if (local_4 <= pcVar9) {
							return pcVar8 + -(int)param_2;
						}
					}
					bVar3 = *(byte *)(iVar6 + 4 + *local_8);
					if ((bVar3 & 0x40) == 0) {
						*(byte *)(iVar6 + 4 + *local_8) = bVar3 | 2;
					}
				}
				local_4 = pcVar8 + -(int)param_2;
			}
			return local_4;
		}
	}
	std::globals::g_msvc_errno = 9;
	std::globals::g_msvc_doserrno = 0;
	return (char *)0xffffffff;
}



undefined4 __cdecl FUN_00497650(uint param_1)
{
	HANDLE hFile;
	BOOL BVar1;
	uint uVar2;
	
	uVar2 = std::globals::g_msvc_doserrno;
	if ((param_1 < DAT_0076eec0) &&
		 ((*(byte *)((&DAT_0076edc0)[(int)param_1 >> 5] + 4 + (param_1 & 0x1f) * 8) & 1) != 0)) {
		hFile = (HANDLE)FUN_004994b0(param_1);
		BVar1 = FlushFileBuffers(hFile);
		if (BVar1 == 0) {
			uVar2 = GetLastError();
		}
		else {
			uVar2 = 0;
		}
		if (uVar2 == 0) {
			return 0;
		}
	}
	std::globals::g_msvc_doserrno = uVar2;
	std::globals::g_msvc_errno = 9;
	return 0xffffffff;
}



void FUN_004976b0(void)
{
	uint uVar1;
	undefined **ppuVar2;
	int iVar3;
	undefined4 *puVar4;
	
	if (DAT_0076eda0 == 0) {
		DAT_0076eda0 = 0x200;
	}
	else {
		if (DAT_0076eda0 < 0x14) {
			DAT_0076eda0 = 0x14;
		}
	}
	DAT_0076dd98 = FUN_00499a80(DAT_0076eda0,4);
	if (DAT_0076dd98 == NULL) {
		DAT_0076eda0 = 0x14;
		DAT_0076dd98 = FUN_00499a80(0x14,4);
		if (DAT_0076dd98 == NULL) {
			__amsg_exit(0x1a);
		}
	}
	iVar3 = 0;
	ppuVar2 = &PTR_DAT_004b3628;
	do {
		*(undefined ***)((int)DAT_0076dd98 + iVar3) = ppuVar2;
		ppuVar2 = ppuVar2 + 8;
		iVar3 += 4;
	} while ((int)ppuVar2 < 0x4b38a8);
	uVar1 = 0;
	puVar4 = &DAT_004b3638;
	do {
		iVar3 = *(int *)((&DAT_0076edc0)[(int)uVar1 >> 5] + (uVar1 & 0x1f) * 8);
		if ((iVar3 == -1) || (iVar3 == 0)) {
			*puVar4 = 0xffffffff;
		}
		puVar4 = puVar4 + 8;
		uVar1 += 1;
	} while ((int)puVar4 < 0x4b3698);
	return;
}



uint FUN_00497770(void)
{
	FILE *file;
	uint uVar1;
	int iVar2;
	int iVar3;
	
	uVar1 = FUN_00490050();
	if (DAT_0054a110 == 0) {
		return uVar1 & 0xffffff00 | (uint)DAT_0054a110;
	}
	iVar3 = 3;
	uVar1 = 0;
	if (3 < DAT_0076eda0) {
		do {
			file = *(FILE **)(DAT_0076dd98 + iVar3 * 4);
			if (file != NULL) {
				if (((*(byte *)&file->_flag & 0x83) != 0) && (iVar2 = std::fclose(file), iVar2 != -1)) {
					uVar1 += 1;
				}
				if (0x13 < iVar3) {
					std::free(*(void **)(DAT_0076dd98 + iVar3 * 4));
					*(undefined4 *)(DAT_0076dd98 + iVar3 * 4) = 0;
				}
			}
			iVar3 += 1;
		} while (iVar3 < DAT_0076eda0);
	}
	return uVar1;
}



undefined4 __cdecl FUN_00497790(undefined4 *param_1)
{
	undefined4 uVar1;
	uint uVar2;
	void *pvVar3;
	int iVar4;
	
	uVar2 = FUN_00498e00(param_1[4]);
	if (uVar2 != 0) {
		if (param_1 == (undefined4 *)&DAT_004b3648) {
			iVar4 = 0;
		}
		else {
			if (param_1 != (undefined4 *)&DAT_004b3668) {
				return 0;
			}
			iVar4 = 1;
		}
		DAT_0054a3e4 += 1;
		if ((param_1[3] & 0x10c) == 0) {
			if ((&DAT_0054a3e8)[iVar4] == 0) {
				pvVar3 = std::malloc(0x1000);
				(&DAT_0054a3e8)[iVar4] = pvVar3;
				if (pvVar3 == NULL) {
					return 0;
				}
			}
			uVar1 = (&DAT_0054a3e8)[iVar4];
			param_1[6] = 0x1000;
			param_1[2] = uVar1;
			*param_1 = uVar1;
			param_1[1] = 0x1000;
			param_1[3] = param_1[3] | 0x1102;
			return 1;
		}
	}
	return 0;
}



void __cdecl FUN_00497830(int param_1,int *param_2)
{
	if (param_1 == 0) {
		if ((param_2[3] & 0x1000U) != 0) {
			std::__fflush__0048ffe0((FILE *)param_2);
		}
	}
	else {
		if ((param_2[3] & 0x1000U) != 0) {
			std::__fflush__0048ffe0((FILE *)param_2);
			param_2[6] = 0;
			param_2[3] = param_2[3] & 0xffffeeff;
			*param_2 = 0;
			param_2[2] = 0;
			return;
		}
	}
	return;
}



uint __cdecl FUN_00497890(uint param_1)
{
	uint uVar1;
	uint uVar2;
	LPCWSTR pWVar3;
	int iVar4;
	uint local_8 [2];
	
	uVar1 = param_1;
	if (DAT_0054a180 == 0) {
		if ((0x40 < (int)param_1) && ((int)param_1 < 0x5b)) {
			return param_1 + 0x20;
		}
	}
	else {
		if ((int)param_1 < 0x100) {
			if (std::globals::g_CharWidth_1__004b0f74 < 2) {
				uVar2 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + param_1 * 2) & 1;
			}
			else {
				uVar2 = std::_unk_FUN_0048f490(param_1,1);
			}
			if (uVar2 == 0) {
				return uVar1;
			}
		}
		if ((*(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + 1 + ((int)uVar1 >> 8 & 0xffU) * 2) &
				0x80) == 0) {
			param_1 = param_1 & 0xffff0000 | uVar1 & 0xff;
			pWVar3 = (LPCWSTR)0x1;
		}
		else {
			param_1 = param_1 & 0xff000000 | (uint)CONCAT11((char)uVar1,(char)(uVar1 >> 8));
			pWVar3 = (LPCWSTR)0x2;
		}
		iVar4 = FUN_00493f60(DAT_0054a180,0x100,(char *)&param_1,pWVar3,(LPWSTR)local_8,3,0);
		if (iVar4 == 0) {
			return uVar1;
		}
		if (iVar4 == 1) {
			return local_8[0] & 0xff;
		}
		param_1 = (local_8[0] >> 8 & 0xff) << 8 | local_8[0] & 0xff;
	}
	return param_1;
}



undefined4 * __cdecl FUN_00497990(undefined4 *param_1,byte *param_2,uint param_3)
{
	byte bVar1;
	byte bVar2;
	undefined4 *puVar3;
	uint uVar4;
	undefined4 *puVar5;
	
	if (DAT_0054a3bc == 0) {
		puVar3 = (undefined4 *)std::_strncpy((char *)param_1,(char *)param_2,param_3);
		return puVar3;
	}
	uVar4 = param_3;
	puVar3 = param_1;
	puVar5 = param_1;
	if (param_3 != 0) {
		do {
			bVar1 = *param_2;
			param_3 = uVar4 - 1;
			bVar2 = *(byte *)((int)&DAT_0054a2b8 + bVar1 + 1);
			*(byte *)puVar5 = bVar1;
			if ((bVar2 & 4) == 0) {
				puVar3 = (undefined4 *)((int)puVar5 + 1);
				param_2 = param_2 + 1;
				if (bVar1 == 0) break;
			}
			else {
				puVar3 = (undefined4 *)((int)puVar5 + 1);
				if (param_3 == 0) {
					*(undefined *)puVar5 = 0;
					break;
				}
				bVar1 = param_2[1];
				param_3 = uVar4 - 2;
				*(byte *)puVar3 = bVar1;
				puVar3 = (undefined4 *)((int)puVar5 + 2);
				param_2 = param_2 + 2;
				if (bVar1 == 0) {
					*(undefined *)puVar5 = 0;
					break;
				}
			}
			uVar4 = param_3;
			puVar5 = puVar3;
		} while (param_3 != 0);
	}
	if (param_3 != 0) {
		for (uVar4 = param_3 >> 2; uVar4 != 0; uVar4 -= 1) {
			*puVar3 = 0;
			puVar3 = puVar3 + 1;
		}
		for (uVar4 = param_3 & 3; uVar4 != 0; uVar4 -= 1) {
			*(undefined *)puVar3 = 0;
			puVar3 = (undefined4 *)((int)puVar3 + 1);
		}
	}
	return param_1;
}



uint FUN_00497a30(uint param_1,uint param_2)
{
	uint uVar1;
	ushort in_FPUControlWord;
	
	uVar1 = FUN_00497a90((uint)in_FPUControlWord);
	uVar1 = param_2 & param_1 | ~param_2 & uVar1;
	FUN_00497b30(uVar1);
	return uVar1;
}



void __cdecl FUN_00497a70(undefined4 param_1,uint param_2)
{
	FUN_00497a30(param_1,param_2 & 0xfff7ffff);
	return;
}



uint __cdecl FUN_00497a90(uint param_1)
{
	uint uVar1;
	uint uVar2;
	
	uVar1 = 0;
	if ((param_1 & 1) != 0) {
		uVar1 = 0x10;
	}
	if ((param_1 & 4) != 0) {
		uVar1 |= 8;
	}
	if ((param_1 & 8) != 0) {
		uVar1 |= 4;
	}
	if ((param_1 & 0x10) != 0) {
		uVar1 |= 2;
	}
	if ((param_1 & 0x20) != 0) {
		uVar1 |= 1;
	}
	if ((param_1 & 2) != 0) {
		uVar1 |= 0x80000;
	}
	uVar2 = param_1 & 0xc00;
	if (uVar2 < 0x401) {
		if (uVar2 == 0x400) {
			uVar1 |= 0x100;
		}
	}
	else {
		if (uVar2 == 0x800) {
			uVar1 |= 0x200;
		}
		else {
			if (uVar2 == 0xc00) {
				uVar1 |= 0x300;
			}
		}
	}
	if ((param_1 & 0x300) == 0) {
		uVar1 |= 0x20000;
	}
	else {
		if ((param_1 & 0x300) == 0x200) {
			uVar1 |= 0x10000;
		}
	}
	if ((param_1 & 0x1000) != 0) {
		uVar1 |= 0x40000;
	}
	return uVar1;
}



uint __cdecl FUN_00497b30(uint param_1)
{
	uint uVar1;
	uint uVar2;
	byte bVar3;
	
	bVar3 = (param_1 & 0x10) != 0;
	if ((param_1 & 8) != 0) {
		bVar3 |= 4;
	}
	if ((param_1 & 4) != 0) {
		bVar3 |= 8;
	}
	if ((param_1 & 2) != 0) {
		bVar3 |= 0x10;
	}
	if ((param_1 & 1) != 0) {
		bVar3 |= 0x20;
	}
	if ((param_1 & 0x80000) != 0) {
		bVar3 |= 2;
	}
	uVar1 = (uint)bVar3;
	uVar2 = param_1 & 0x300;
	if (uVar2 < 0x101) {
		if (uVar2 == 0x100) {
			uVar1 = bVar3 | 0x400;
		}
	}
	else {
		if (uVar2 == 0x200) {
			uVar1 = (uint)CONCAT11(8,bVar3);
		}
		else {
			if (uVar2 == 0x300) {
				uVar1 = (uint)CONCAT11(0xc,bVar3);
			}
		}
	}
	if ((param_1 & 0x30000) == 0) {
		uVar1 |= 0x300;
	}
	else {
		if ((param_1 & 0x30000) == 0x10000) {
			uVar1 |= 0x200;
		}
	}
	if ((param_1 & 0x40000) != 0) {
		uVar1 |= 0x1000;
	}
	return uVar1;
}



undefined4 __cdecl FUN_00497bc0(int param_1,int param_2)
{
	byte bVar1;
	int *piVar2;
	int iVar3;
	
	bVar1 = (byte)(param_2 >> 0x1f);
	iVar3 = (int)(param_2 + (param_2 >> 0x1f & 0x1fU)) >> 5;
	if ((*(uint *)(param_1 + iVar3 * 4) &
			~(-1 << (0x1f - ((((byte)param_2 ^ bVar1) - bVar1 & 0x1f ^ bVar1) - bVar1) & 0x1f))) != 0) {
		return 0;
	}
	iVar3 += 1;
	if (iVar3 < 3) {
		piVar2 = (int *)(param_1 + iVar3 * 4);
		do {
			if (*piVar2 != 0) {
				return 0;
			}
			iVar3 += 1;
			piVar2 = piVar2 + 1;
		} while (iVar3 < 3);
		return 1;
	}
	return 1;
}



void __cdecl FUN_00497c30(int param_1,int param_2)
{
	byte bVar1;
	int iVar2;
	int iVar3;
	uint *puVar4;
	
	bVar1 = (byte)(param_2 >> 0x1f);
	iVar3 = (int)(param_2 + (param_2 >> 0x1f & 0x1fU)) >> 5;
	iVar2 = FUN_0049a270(*(uint *)(param_1 + iVar3 * 4),
											 1 << (0x1f - ((((byte)param_2 ^ bVar1) - bVar1 & 0x1f ^ bVar1) - bVar1) &
														0x1f),(uint *)(param_1 + iVar3 * 4));
	iVar3 += -1;
	if (-1 < iVar3) {
		puVar4 = (uint *)(param_1 + iVar3 * 4);
		do {
			if (iVar2 == 0) {
				return;
			}
			iVar2 = FUN_0049a270(*puVar4,1,puVar4);
			iVar3 += -1;
			puVar4 = puVar4 + -1;
		} while (-1 < iVar3);
	}
	return;
}



undefined4 __cdecl FUN_00497ca0(int param_1,int param_2)
{
	int iVar1;
	byte bVar2;
	int iVar3;
	undefined4 *puVar4;
	undefined4 local_4;
	
	local_4 = 0;
	bVar2 = (byte)(param_2 >> 0x1f);
	bVar2 = 0x1f - ((((byte)param_2 ^ bVar2) - bVar2 & 0x1f ^ bVar2) - bVar2);
	iVar3 = (int)(param_2 + (param_2 >> 0x1f & 0x1fU)) >> 5;
	if (((*(uint *)(param_1 + iVar3 * 4) & 1 << (bVar2 & 0x1f)) != 0) &&
		 (iVar1 = FUN_00497bc0(param_1,param_2 + 1), iVar1 == 0)) {
		local_4 = FUN_00497c30(param_1,param_2 + -1);
	}
	*(uint *)(param_1 + iVar3 * 4) = *(uint *)(param_1 + iVar3 * 4) & -1 << (bVar2 & 0x1f);
	iVar3 += 1;
	if (iVar3 < 3) {
		puVar4 = (undefined4 *)(param_1 + iVar3 * 4);
		for (iVar1 = 3 - iVar3; iVar1 != 0; iVar1 += -1) {
			*puVar4 = 0;
			puVar4 = puVar4 + 1;
		}
	}
	return local_4;
}



void __cdecl FUN_00497d40(int param_1,undefined4 *param_2)
{
	int iVar1;
	int iVar2;
	
	iVar1 = param_1 - (int)param_2;
	iVar2 = 3;
	do {
		*(undefined4 *)((int)param_2 + iVar1) = *param_2;
		param_2 = param_2 + 1;
		iVar2 += -1;
	} while (iVar2 != 0);
	return;
}



void __cdecl FUN_00497d60(undefined4 *param_1)
{
	*param_1 = 0;
	param_1[1] = 0;
	param_1[2] = 0;
	return;
}



undefined4 __cdecl FUN_00497d70(int *param_1)
{
	int iVar1;
	
	iVar1 = 0;
	do {
		if (*param_1 != 0) {
			return 0;
		}
		iVar1 += 1;
		param_1 = param_1 + 1;
	} while (iVar1 < 3);
	return 1;
}



void __cdecl FUN_00497d90(uint *param_1,int param_2)
{
	int iVar1;
	byte bVar2;
	int iVar3;
	uint uVar4;
	uint uVar5;
	uint *puVar6;
	int iVar7;
	
	iVar1 = (int)(param_2 + (param_2 >> 0x1f & 0x1fU)) >> 5;
	bVar2 = (byte)(param_2 >> 0x1f);
	uVar5 = 0;
	bVar2 = (((byte)param_2 ^ bVar2) - bVar2 & 0x1f ^ bVar2) - bVar2;
	param_2 = 3;
	puVar6 = param_1;
	do {
		uVar4 = *puVar6 >> (bVar2 & 0x1f) | uVar5;
		uVar5 = (~(-1 << (bVar2 & 0x1f)) & *puVar6) << (0x20 - bVar2 & 0x1f);
		*puVar6 = uVar4;
		param_2 += -1;
		puVar6 = puVar6 + 1;
	} while (param_2 != 0);
	iVar7 = 2;
	iVar3 = 8;
	do {
		if (iVar7 < iVar1) {
			*(undefined4 *)((int)param_1 + iVar3) = 0;
		}
		else {
			*(undefined4 *)((int)param_1 + iVar3) = *(undefined4 *)((int)param_1 + iVar3 + iVar1 * -4);
		}
		iVar7 += -1;
		iVar3 += -4;
	} while (-1 < iVar3);
	return;
}



undefined4 __cdecl FUN_00497e50(ushort *param_1,uint *param_2,int *param_3)
{
	ushort uVar1;
	int iVar2;
	undefined4 uVar3;
	uint uVar4;
	int iVar5;
	uint local_18;
	uint local_14;
	int local_10;
	undefined4 local_c [3];
	
	uVar1 = param_1[5];
	local_14 = *(uint *)(param_1 + 1);
	local_18 = *(uint *)(param_1 + 3);
	uVar4 = uVar1 & 0x7fff;
	iVar5 = uVar4 - 0x3fff;
	local_10 = (uint)*param_1 << 0x10;
	if (iVar5 == -0x3fff) {
		iVar5 = 0;
		iVar2 = FUN_00497d70((int *)&local_18);
		if (iVar2 == 0) {
			FUN_00497d60(&local_18);
			uVar3 = 2;
			goto LAB_00497fd1;
		}
	}
	else {
		FUN_00497d40((int)local_c,&local_18);
		iVar2 = FUN_00497ca0((int)&local_18,param_3[2]);
		if (iVar2 != 0) {
			iVar5 = uVar4 - 0x3ffe;
		}
		iVar2 = param_3[1];
		if (iVar5 < iVar2 - param_3[2]) {
			FUN_00497d60(&local_18);
			iVar5 = 0;
			uVar3 = 2;
			goto LAB_00497fd1;
		}
		if (iVar5 <= iVar2) {
			FUN_00497d40((int)&local_18,local_c);
			FUN_00497d90(&local_18,iVar2 - iVar5);
			FUN_00497ca0((int)&local_18,param_3[2]);
			FUN_00497d90(&local_18,param_3[3] + 1);
			iVar5 = 0;
			uVar3 = 2;
			goto LAB_00497fd1;
		}
		if (*param_3 <= iVar5) {
			FUN_00497d60(&local_18);
			local_18 |= 0x80000000;
			FUN_00497d90(&local_18,param_3[3]);
			iVar5 = param_3[5] + *param_3;
			uVar3 = 1;
			goto LAB_00497fd1;
		}
		iVar5 = param_3[5] + iVar5;
		local_18 &= 0x7fffffff;
		FUN_00497d90(&local_18,param_3[3]);
	}
	uVar3 = 0;
LAB_00497fd1:
	local_18 = iVar5 << (0x1fU - (char)param_3[3] & 0x1f) |
						 -(uint)((uVar1 & 0x8000) != 0) & 0x80000000 | local_18;
	if (param_3[4] == 0x40) {
		param_2[1] = local_18;
		*param_2 = local_14;
		return uVar3;
	}
	if (param_3[4] == 0x20) {
		*param_2 = local_18;
	}
	return uVar3;
}



void __cdecl FUN_00498020(ushort *param_1,uint *param_2)
{
	FUN_00497e50(param_1,param_2,(int *)&DAT_004b38a8);
	return;
}



void __cdecl FUN_00498040(ushort *param_1,uint *param_2)
{
	FUN_00497e50(param_1,param_2,(int *)&DAT_004b38c0);
	return;
}



void __cdecl FUN_00498060(uint *param_1,byte *param_2)
{
	ushort local_c [6];
	
	FUN_00498610(local_c,&param_2,param_2,0,0,0,0);
	FUN_00498020(local_c,param_1);
	return;
}



void __cdecl FUN_004980a0(uint *param_1,byte *param_2)
{
	ushort local_c [6];
	
	FUN_00498610(local_c,&param_2,param_2,0,0,0,0);
	FUN_00498040(local_c,param_1);
	return;
}



void __cdecl FUN_004980e0(undefined4 *param_1,int param_2,int param_3)
{
	char *pcVar1;
	char cVar2;
	uint uVar3;
	uint uVar4;
	char *pcVar5;
	int iVar6;
	undefined4 *puVar7;
	char *pcVar8;
	
	pcVar5 = *(char **)(param_3 + 0xc);
	pcVar8 = (char *)((int)param_1 + 1);
	*(undefined *)param_1 = 0x30;
	pcVar1 = pcVar8;
	iVar6 = param_2;
	if (0 < param_2) {
		do {
			cVar2 = *pcVar5;
			if (cVar2 == '\0') {
				cVar2 = '0';
			}
			else {
				pcVar5 = pcVar5 + 1;
			}
			*pcVar1 = cVar2;
			pcVar1 = pcVar1 + 1;
			iVar6 += -1;
			param_2 += -1;
		} while (param_2 != 0);
	}
	*pcVar1 = '\0';
	if ((-1 < iVar6) && ('4' < *pcVar5)) {
		cVar2 = pcVar1[-1];
		while (pcVar5 = pcVar1 + -1, cVar2 == '9') {
			*pcVar5 = '0';
			cVar2 = pcVar1[-2];
			pcVar1 = pcVar5;
		}
		*pcVar5 = *pcVar5 + '\x01';
	}
	if (*(char *)param_1 == '1') {
		*(int *)(param_3 + 4) = *(int *)(param_3 + 4) + 1;
		return;
	}
	uVar3 = 0xffffffff;
	do {
		pcVar5 = pcVar8;
		if (uVar3 == 0) break;
		uVar3 -= 1;
		pcVar5 = pcVar8 + 1;
		cVar2 = *pcVar8;
		pcVar8 = pcVar5;
	} while (cVar2 != '\0');
	uVar3 = ~uVar3;
	puVar7 = (undefined4 *)(pcVar5 + -uVar3);
	for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
		*param_1 = *puVar7;
		puVar7 = puVar7 + 1;
		param_1 = param_1 + 1;
	}
	for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
		*(undefined *)param_1 = *(undefined *)puVar7;
		puVar7 = (undefined4 *)((int)puVar7 + 1);
		param_1 = (undefined4 *)((int)param_1 + 1);
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

undefined * FUN_00498180(undefined param_1)
{
	undefined4 in_stack_ffffffe4;
	undefined2 uVar1;
	uint local_c;
	uint local_8;
	undefined2 local_4;
	
	uVar1 = (undefined2)((uint)in_stack_ffffffe4 >> 0x10);
	FUN_00498200(&local_c,(uint *)&param_1);
	_DAT_0054a418 = FUN_0049a470(local_c,local_8,CONCAT22(uVar1,local_4),0x11,0,&DAT_0054a3f0);
	_DAT_0054a410 = (int)DAT_0054a3f2;
	_DAT_0054a414 = (int)DAT_0054a3f0;
	_DAT_0054a41c = &DAT_0054a3f4;
	return &DAT_0054a410;
}



void __cdecl FUN_00498200(uint *param_1,uint *param_2)
{
	ushort uVar1;
	uint uVar2;
	ushort uVar3;
	ushort uVar4;
	uint uVar5;
	uint uVar6;
	
	uVar6 = 0x80000000;
	uVar1 = *(ushort *)((int)param_2 + 6);
	uVar2 = *param_2;
	uVar3 = uVar1 >> 4;
	uVar4 = uVar3 & 0x7ff;
	if ((uVar3 & 0x7ff) == 0) {
		uVar6 = 0;
		if (((param_2[1] & 0xfffff) == 0) && (uVar2 == 0)) {
			param_1[1] = 0;
			*param_1 = 0;
			*(undefined2 *)(param_1 + 2) = 0;
			return;
		}
		uVar4 = 0x3c01;
	}
	else {
		if (uVar4 == 0x7ff) {
			uVar4 = 0x7fff;
		}
		else {
			uVar4 += 0x3c00;
		}
	}
	uVar5 = uVar2 >> 0x15 | (param_2[1] & 0xfffff) << 0xb | uVar6;
	param_1[1] = uVar5;
	*param_1 = uVar2 << 0xb;
	for (; uVar6 == 0; uVar6 &= 0x80000000) {
		uVar6 = uVar5 * 2;
		uVar5 = *param_1 >> 0x1f | uVar6;
		uVar4 -= 1;
		param_1[1] = uVar5;
		*param_1 = *param_1 * 2;
	}
	*(ushort *)(param_1 + 2) = uVar4 | uVar1 & 0x8000;
	return;
}



undefined4 * __cdecl FUN_004982c0(undefined4 *param_1,undefined4 *param_2,uint param_3)
{
	undefined4 *puVar1;
	uint uVar2;
	uint uVar3;
	undefined4 *puVar4;
	
	if ((param_2 < param_1) && (param_1 < (undefined4 *)(param_3 + (int)param_2))) {
		puVar1 = (undefined4 *)((param_3 - 4) + (int)param_2);
		puVar4 = (undefined4 *)((param_3 - 4) + (int)param_1);
		if (((uint)puVar4 & 3) == 0) {
			uVar2 = param_3 >> 2;
			if (uVar2 < 8) goto LAB_00498480;
			for (; uVar2 != 0; uVar2 -= 1) {
				*puVar4 = *puVar1;
				puVar1 = puVar1 + -1;
				puVar4 = puVar4 + -1;
			}
			switch(param_3 & 3) {
			case 1:
				goto switchD_004984a4_caseD_1;
			case 2:
				goto switchD_004984a4_caseD_2;
			case 3:
				goto switchD_004984a4_caseD_3;
			}
		}
		else {
			switch(param_3) {
			case 0:
				break;
			case 1:
switchD_004984a4_caseD_1:
				*(undefined *)((int)puVar4 + 3) = *(undefined *)((int)puVar1 + 3);
				return param_1;
			case 2:
switchD_004984a4_caseD_2:
				*(undefined *)((int)puVar4 + 3) = *(undefined *)((int)puVar1 + 3);
				*(undefined *)((int)puVar4 + 2) = *(undefined *)((int)puVar1 + 2);
				return param_1;
			case 3:
switchD_004984a4_caseD_3:
				*(undefined *)((int)puVar4 + 3) = *(undefined *)((int)puVar1 + 3);
				*(undefined *)((int)puVar4 + 2) = *(undefined *)((int)puVar1 + 2);
				*(undefined *)((int)puVar4 + 1) = *(undefined *)((int)puVar1 + 1);
				return param_1;
			default:
				uVar3 = param_3 - ((uint)puVar4 & 3);
				switch((uint)puVar4 & 3) {
				case 1:
					*(undefined *)((int)puVar4 + 3) = *(undefined *)((int)puVar1 + 3);
					puVar1 = (undefined4 *)((int)puVar1 + -1);
					uVar2 = uVar3 >> 2;
					puVar4 = (undefined4 *)((int)puVar4 - 1);
					if (uVar2 < 8) {
LAB_00498480:
										// WARNING: Could not recover jumptable at 0x00498482. Too many branches
										// WARNING: Treating indirect jump as call
						puVar1 = (undefined4 *)(*(code *)(&PTR_LAB_00498550)[-uVar2])();
						return puVar1;
					}
					for (; uVar2 != 0; uVar2 -= 1) {
						*puVar4 = *puVar1;
						puVar1 = puVar1 + -1;
						puVar4 = puVar4 + -1;
					}
					switch(uVar3 & 3) {
					case 1:
						goto switchD_004984a4_caseD_1;
					case 2:
						goto switchD_004984a4_caseD_2;
					case 3:
						goto switchD_004984a4_caseD_3;
					}
					break;
				case 2:
					*(undefined *)((int)puVar4 + 3) = *(undefined *)((int)puVar1 + 3);
					uVar2 = uVar3 >> 2;
					*(undefined *)((int)puVar4 + 2) = *(undefined *)((int)puVar1 + 2);
					puVar1 = (undefined4 *)((int)puVar1 + -2);
					puVar4 = (undefined4 *)((int)puVar4 - 2);
					if (uVar2 < 8) goto LAB_00498480;
					for (; uVar2 != 0; uVar2 -= 1) {
						*puVar4 = *puVar1;
						puVar1 = puVar1 + -1;
						puVar4 = puVar4 + -1;
					}
					switch(uVar3 & 3) {
					case 1:
						goto switchD_004984a4_caseD_1;
					case 2:
						goto switchD_004984a4_caseD_2;
					case 3:
						goto switchD_004984a4_caseD_3;
					}
					break;
				case 3:
					*(undefined *)((int)puVar4 + 3) = *(undefined *)((int)puVar1 + 3);
					*(undefined *)((int)puVar4 + 2) = *(undefined *)((int)puVar1 + 2);
					uVar2 = uVar3 >> 2;
					*(undefined *)((int)puVar4 + 1) = *(undefined *)((int)puVar1 + 1);
					puVar1 = (undefined4 *)((int)puVar1 + -3);
					puVar4 = (undefined4 *)((int)puVar4 - 3);
					if (uVar2 < 8) goto LAB_00498480;
					for (; uVar2 != 0; uVar2 -= 1) {
						*puVar4 = *puVar1;
						puVar1 = puVar1 + -1;
						puVar4 = puVar4 + -1;
					}
					switch(uVar3 & 3) {
					case 1:
						goto switchD_004984a4_caseD_1;
					case 2:
						goto switchD_004984a4_caseD_2;
					case 3:
						goto switchD_004984a4_caseD_3;
					}
				}
			}
		}
		return param_1;
	}
	puVar1 = param_1;
	if (((uint)param_1 & 3) == 0) {
		uVar2 = param_3 >> 2;
		if (uVar2 < 8) goto LAB_0049831c;
		for (; uVar2 != 0; uVar2 -= 1) {
			*puVar1 = *param_2;
			param_2 = param_2 + 1;
			puVar1 = puVar1 + 1;
		}
		switch(param_3 & 3) {
		case 1:
			goto switchD_00498314_caseD_1;
		case 2:
			goto switchD_00498314_caseD_2;
		case 3:
			goto switchD_00498314_caseD_3;
		}
	}
	else {
		switch(param_3) {
		case 0:
			break;
		case 1:
switchD_00498314_caseD_1:
			*(undefined *)puVar1 = *(undefined *)param_2;
			return param_1;
		case 2:
switchD_00498314_caseD_2:
			*(undefined *)puVar1 = *(undefined *)param_2;
			*(undefined *)((int)puVar1 + 1) = *(undefined *)((int)param_2 + 1);
			return param_1;
		case 3:
switchD_00498314_caseD_3:
			*(undefined *)puVar1 = *(undefined *)param_2;
			*(undefined *)((int)puVar1 + 1) = *(undefined *)((int)param_2 + 1);
			*(undefined *)((int)puVar1 + 2) = *(undefined *)((int)param_2 + 2);
			return param_1;
		default:
			uVar3 = (param_3 - 4) + ((uint)param_1 & 3);
			switch((uint)param_1 & 3) {
			case 1:
				*(undefined *)param_1 = *(undefined *)param_2;
				*(undefined *)((int)param_1 + 1) = *(undefined *)((int)param_2 + 1);
				uVar2 = uVar3 >> 2;
				*(undefined *)((int)param_1 + 2) = *(undefined *)((int)param_2 + 2);
				param_2 = (undefined4 *)((int)param_2 + 3);
				puVar1 = (undefined4 *)((int)param_1 + 3);
				if (uVar2 < 8) {
LAB_0049831c:
										// WARNING: Could not recover jumptable at 0x0049831c. Too many branches
										// WARNING: Treating indirect jump as call
					puVar1 = (undefined4 *)(*(code *)(&PTR_LAB_0049839c)[uVar2])();
					return puVar1;
				}
				for (; uVar2 != 0; uVar2 -= 1) {
					*puVar1 = *param_2;
					param_2 = param_2 + 1;
					puVar1 = puVar1 + 1;
				}
				switch(uVar3 & 3) {
				case 1:
					goto switchD_00498314_caseD_1;
				case 2:
					goto switchD_00498314_caseD_2;
				case 3:
					goto switchD_00498314_caseD_3;
				}
				break;
			case 2:
				*(undefined *)param_1 = *(undefined *)param_2;
				uVar2 = uVar3 >> 2;
				*(undefined *)((int)param_1 + 1) = *(undefined *)((int)param_2 + 1);
				param_2 = (undefined4 *)((int)param_2 + 2);
				puVar1 = (undefined4 *)((int)param_1 + 2);
				if (uVar2 < 8) goto LAB_0049831c;
				for (; uVar2 != 0; uVar2 -= 1) {
					*puVar1 = *param_2;
					param_2 = param_2 + 1;
					puVar1 = puVar1 + 1;
				}
				switch(uVar3 & 3) {
				case 1:
					goto switchD_00498314_caseD_1;
				case 2:
					goto switchD_00498314_caseD_2;
				case 3:
					goto switchD_00498314_caseD_3;
				}
				break;
			case 3:
				*(undefined *)param_1 = *(undefined *)param_2;
				uVar2 = uVar3 >> 2;
				param_2 = (undefined4 *)((int)param_2 + 1);
				puVar1 = (undefined4 *)((int)param_1 + 1);
				if (uVar2 < 8) goto LAB_0049831c;
				for (; uVar2 != 0; uVar2 -= 1) {
					*puVar1 = *param_2;
					param_2 = param_2 + 1;
					puVar1 = puVar1 + 1;
				}
				switch(uVar3 & 3) {
				case 1:
					goto switchD_00498314_caseD_1;
				case 2:
					goto switchD_00498314_caseD_2;
				case 3:
					goto switchD_00498314_caseD_3;
				}
			}
		}
	}
	return param_1;
}



void FUN_00498600(void)
{
	__amsg_exit(2);
	return;
}



// WARNING: Could not reconcile some variable overlaps

undefined4 __cdecl
FUN_00498610(ushort *param_1,byte **param_2,byte *param_3,int param_4,int param_5,int param_6,
						int param_7)
{
	char cVar1;
	bool bVar2;
	bool bVar3;
	bool bVar4;
	bool bVar5;
	bool bVar6;
	ushort uVar7;
	int iVar8;
	uint uVar9;
	byte bVar10;
	byte *pbVar11;
	byte *pbVar12;
	uint uVar13;
	byte *pbVar14;
	int local_60;
	char *local_5c;
	uint local_54;
	byte *local_50;
	int local_4c;
	int local_48;
	undefined4 local_30;
	ushort local_2c;
	undefined2 uStack42;
	undefined2 uStack40;
	byte *local_26;
	undefined4 local_22;
	char local_1c [23];
	char local_5;
	
	local_5c = local_1c;
	iVar8 = 0;
	uVar13 = 0;
	uVar7 = 0;
	local_4c = 1;
	local_54 = 0;
	bVar2 = false;
	bVar4 = false;
	bVar3 = false;
	bVar5 = false;
	bVar6 = false;
	local_48 = 0;
	local_60 = 0;
	local_30 = 0;
	local_50 = param_3;
	for (pbVar11 = param_3;
			(((bVar10 = *pbVar11, bVar10 == 0x20 || (bVar10 == 9)) || (bVar10 == 10)) ||
			(pbVar14 = param_3, bVar10 == 0xd)); pbVar11 = pbVar11 + 1) {
	}
	do {
		bVar10 = *pbVar11;
		pbVar12 = pbVar11 + 1;
		uVar9 = (uint)bVar10;
		param_3 = (byte *)((uint)param_3 & 0xffffff00 | uVar9);
		if (true) {
			switch(iVar8) {
			case 0:
				if (('0' < (char)bVar10) && ((char)bVar10 < ':')) {
					iVar8 = 3;
					goto LAB_00498ae2;
				}
				if (bVar10 == DAT_004b0f78) {
					iVar8 = 5;
				}
				else {
					if (bVar10 == 0x2b) {
						iVar8 = 2;
						uVar7 = 0;
					}
					else {
						if (bVar10 == 0x2d) {
							iVar8 = 2;
							uVar7 = 0x8000;
						}
						else {
							if (bVar10 != 0x30) goto switchD_00498746_caseD_2c;
							iVar8 = 1;
						}
					}
				}
				break;
			case 1:
				bVar2 = true;
				if (('0' < (char)bVar10) && ((char)bVar10 < ':')) {
					iVar8 = 3;
					goto LAB_00498ae2;
				}
				if (bVar10 != DAT_004b0f78) {
					if (true) {
						switch(bVar10) {
						case 0x2b:
						case 0x2d:
							goto switchD_00498746_caseD_2b;
						case 0x30:
							goto switchD_00498746_caseD_30;
						case 0x44:
						case 0x45:
						case 100:
						case 0x65:
							goto switchD_00498746_caseD_44;
						}
					}
					goto switchD_00498746_caseD_2c;
				}
				iVar8 = 4;
				break;
			case 2:
				if (('0' < (char)bVar10) && ((char)bVar10 < ':')) {
					iVar8 = 3;
					goto LAB_00498ae2;
				}
				if (bVar10 == DAT_004b0f78) {
					iVar8 = 5;
				}
				else {
					if (bVar10 == 0x30) {
switchD_00498746_caseD_30:
						iVar8 = 1;
					}
					else {
						iVar8 = 10;
						pbVar12 = pbVar14;
					}
				}
				break;
			case 3:
				while( true ) {
					bVar2 = true;
					if (std::globals::g_CharWidth_1__004b0f74 < 2) {
						uVar9 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + ((uint)param_3 & 0xff) * 2
														 ) & 4;
					}
					else {
						uVar9 = std::_unk_FUN_0048f490((uint)param_3 & 0xff,4);
					}
					if (uVar9 == 0) break;
					if (uVar13 < 0x19) {
						uVar13 += 1;
						*local_5c = bVar10 - 0x30;
						bVar10 = *pbVar12;
						local_5c = local_5c + 1;
						param_3 = (byte *)((uint)param_3 & 0xffffff00 | (uint)bVar10);
						pbVar12 = pbVar12 + 1;
					}
					else {
						bVar10 = *pbVar12;
						local_60 += 1;
						param_3 = (byte *)((uint)param_3 & 0xffffff00 | (uint)bVar10);
						pbVar12 = pbVar12 + 1;
					}
				}
				local_54 = uVar13;
				if (bVar10 != DAT_004b0f78) {
					if (true) {
						switch(bVar10) {
						case 0x2b:
						case 0x2d:
							goto switchD_00498746_caseD_2b;
						case 0x44:
						case 0x45:
						case 100:
						case 0x65:
							goto switchD_00498746_caseD_44;
						}
					}
					goto switchD_00498746_caseD_2c;
				}
				iVar8 = 4;
				break;
			case 4:
				bVar4 = true;
				if (uVar13 == 0) {
					while (bVar10 == 0x30) {
						bVar10 = *pbVar12;
						local_60 += -1;
						pbVar12 = pbVar12 + 1;
						param_3 = (byte *)((uint)param_3 & 0xffffff00 | (uint)bVar10);
					}
				}
				while( true ) {
					bVar2 = true;
					if (std::globals::g_CharWidth_1__004b0f74 < 2) {
						uVar9 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + ((uint)param_3 & 0xff) * 2
														 ) & 4;
					}
					else {
						uVar9 = std::_unk_FUN_0048f490((uint)param_3 & 0xff,4);
					}
					if (uVar9 == 0) break;
					if (uVar13 < 0x19) {
						uVar13 += 1;
						*local_5c = bVar10 - 0x30;
						local_5c = local_5c + 1;
						local_60 += -1;
					}
					bVar10 = *pbVar12;
					pbVar12 = pbVar12 + 1;
					param_3 = (byte *)((uint)param_3 & 0xffffff00 | (uint)bVar10);
				}
				local_54 = uVar13;
				if (false) {
switchD_00498746_caseD_2c:
					iVar8 = 10;
					goto LAB_00498ae2;
				}
				switch(bVar10) {
				case 0x2b:
				case 0x2d:
switchD_00498746_caseD_2b:
					bVar2 = true;
					pbVar12 = pbVar12 + -1;
					iVar8 = 0xb;
					break;
				default:
					goto switchD_00498746_caseD_2c;
				case 0x44:
				case 0x45:
				case 100:
				case 0x65:
switchD_00498746_caseD_44:
					bVar2 = true;
					iVar8 = 6;
				}
				break;
			case 5:
				bVar4 = true;
				if (std::globals::g_CharWidth_1__004b0f74 < 2) {
					uVar9 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + uVar9 * 2) & 4;
				}
				else {
					uVar9 = std::_unk_FUN_0048f490(uVar9,4);
				}
				if (uVar9 == 0) {
					iVar8 = 10;
					pbVar12 = pbVar14;
				}
				else {
					iVar8 = 4;
					pbVar12 = pbVar11;
				}
				break;
			case 6:
				pbVar11 = pbVar11 + -1;
				pbVar14 = pbVar11;
				local_50 = pbVar11;
				if (('0' < (char)bVar10) && ((char)bVar10 < ':')) {
					iVar8 = 9;
					goto LAB_00498ae2;
				}
				if (bVar10 == 0x2b) {
LAB_00498ad6:
					iVar8 = 7;
					pbVar14 = pbVar11;
					local_50 = pbVar11;
				}
				else {
					if (bVar10 != 0x2d) goto LAB_004989c6;
LAB_00498ac7:
					iVar8 = 7;
					local_4c = -1;
					pbVar14 = pbVar11;
					local_50 = pbVar11;
				}
				break;
			case 7:
				if (('0' < (char)bVar10) && ((char)bVar10 < ':')) {
					iVar8 = 9;
					goto LAB_00498ae2;
				}
LAB_004989c6:
				if (bVar10 == 0x30) {
					iVar8 = 8;
				}
				else {
					iVar8 = 10;
					pbVar12 = pbVar14;
				}
				break;
			case 8:
				bVar3 = true;
				while (bVar10 == 0x30) {
					bVar10 = *pbVar12;
					pbVar12 = pbVar12 + 1;
				}
				if (((char)bVar10 < '1') || ('9' < (char)bVar10)) goto switchD_00498746_caseD_2c;
				iVar8 = 9;
LAB_00498ae2:
				pbVar12 = pbVar12 + -1;
				break;
			case 9:
				bVar3 = true;
				local_48 = 0;
				while( true ) {
					if (std::globals::g_CharWidth_1__004b0f74 < 2) {
						uVar13 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ +
															((uint)param_3 & 0xff) * 2) & 4;
					}
					else {
						uVar13 = std::_unk_FUN_0048f490((uint)param_3 & 0xff,4);
					}
					if (uVar13 == 0) goto LAB_00498a4a;
					local_48 = (char)bVar10 + -0x30 + local_48 * 10;
					if (0x1450 < local_48) break;
					bVar10 = *pbVar12;
					pbVar12 = pbVar12 + 1;
					param_3 = (byte *)((uint)param_3 & 0xffffff00 | (uint)bVar10);
				}
				local_48 = 0x1451;
LAB_00498a4a:
				while( true ) {
					if (std::globals::g_CharWidth_1__004b0f74 < 2) {
						uVar13 = *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ +
															((uint)param_3 & 0xff) * 2) & 4;
					}
					else {
						uVar13 = std::_unk_FUN_0048f490((uint)param_3 & 0xff,4);
					}
					if (uVar13 == 0) break;
					bVar10 = *pbVar12;
					pbVar12 = pbVar12 + 1;
					param_3 = (byte *)((uint)param_3 & 0xffffff00 | (uint)bVar10);
				}
				iVar8 = 10;
				pbVar12 = pbVar12 + -1;
				uVar13 = local_54;
				pbVar14 = local_50;
				break;
			case 0xb:
				if (param_7 == 0) goto switchD_00498746_caseD_2c;
				if (bVar10 == 0x2b) goto LAB_00498ad6;
				if (bVar10 == 0x2d) goto LAB_00498ac7;
				iVar8 = 10;
				pbVar12 = pbVar11;
				pbVar14 = pbVar11;
				local_50 = pbVar11;
			}
		}
		pbVar11 = pbVar12;
	} while (iVar8 != 10);
	*param_2 = pbVar12;
	if (bVar2) {
		if (0x18 < uVar13) {
			if ('\x04' < local_5) {
				local_5 += '\x01';
			}
			local_5c = local_5c + -1;
			local_60 += 1;
			uVar13 = 0x18;
		}
		if (uVar13 == 0) {
			local_2c = 0;
			local_22._0_2_ = 0;
			param_3 = NULL;
			pbVar11 = NULL;
			goto LAB_00498bb4;
		}
		cVar1 = local_5c[-1];
		while (cVar1 == '\0') {
			uVar13 -= 1;
			local_60 += 1;
			cVar1 = local_5c[-2];
			local_5c = local_5c + -1;
		}
		FUN_0049a370(local_1c,uVar13,(uint *)&local_2c);
		if (local_4c < 0) {
			local_48 = -local_48;
		}
		uVar13 = local_48 + local_60;
		if (!bVar3) {
			uVar13 += param_5;
		}
		if (!bVar4) {
			uVar13 -= param_6;
		}
		if ((int)uVar13 < 0x1451) {
			if (-0x1451 < (int)uVar13) {
				FUN_0049aac0((int *)&local_2c,uVar13,param_4);
				pbVar11 = (byte *)CONCAT22(uStack40,uStack42);
				param_3 = local_26;
				goto LAB_00498bb4;
			}
			bVar6 = true;
		}
		else {
			bVar5 = true;
		}
	}
	local_2c = (ushort)param_3;
	pbVar11 = param_3;
	local_22._0_2_ = local_2c;
LAB_00498bb4:
	if (bVar2) {
		if (bVar5) {
			pbVar11 = NULL;
			local_22._0_2_ = 0x7fff;
			param_3 = (byte *)0x80000000;
			local_2c = 0;
			local_30 = 2;
		}
		else {
			if (bVar6) {
				local_2c = 0;
				local_22._0_2_ = 0;
				param_3 = NULL;
				pbVar11 = NULL;
				local_30 = 1;
			}
		}
	}
	else {
		local_2c = 0;
		local_22._0_2_ = 0;
		param_3 = NULL;
		pbVar11 = NULL;
		local_30 = 4;
	}
	*param_1 = local_2c;
	*(byte **)(param_1 + 1) = pbVar11;
	*(byte **)(param_1 + 3) = param_3;
	param_1[5] = (ushort)local_22 | uVar7;
	return local_30;
}



void __cdecl FUN_00498da0(int *param_1)
{
	void *pvVar1;
	
	DAT_0054a3e4 += 1;
	pvVar1 = std::malloc(0x1000);
	param_1[2] = (int)pvVar1;
	if (pvVar1 != NULL) {
		param_1[3] = param_1[3] | 8;
		param_1[6] = 0x1000;
		*param_1 = param_1[2];
		param_1[1] = 0;
		return;
	}
	param_1[6] = 2;
	param_1[3] = param_1[3] | 4;
	param_1[2] = (int)(param_1 + 5);
	*param_1 = (int)(param_1 + 5);
	param_1[1] = 0;
	return;
}



uint __cdecl FUN_00498e00(uint param_1)
{
	if (DAT_0076eec0 <= param_1) {
		return 0;
	}
	return *(byte *)((&DAT_0076edc0)[(int)param_1 >> 5] + 4 + (param_1 & 0x1f) * 8) & 0x40;
}



LPSTR __cdecl FUN_00498e30(LPSTR param_1,ushort param_2)
{
	LPSTR pCVar1;
	
	pCVar1 = param_1;
	if (param_1 == NULL) {
		return param_1;
	}
	if (DAT_0054a180 == 0) {
		if (param_2 < 0x100) {
			*param_1 = (CHAR)param_2;
			return (LPSTR)0x1;
		}
	}
	else {
		param_1 = NULL;
		pCVar1 = (LPSTR)WideCharToMultiByte(DAT_0054a190,0x220,(LPCWSTR)&param_2,1,pCVar1,
																				std::globals::g_CharWidth_1__004b0f74,NULL,(LPBOOL)&param_1)
		;
		if ((pCVar1 != NULL) && (param_1 == NULL)) {
			return pCVar1;
		}
	}
	std::globals::g_msvc_errno = 0x2a;
	return (LPSTR)0xffffffff;
}



// Library Function - Single Match
// Name: __aulldiv
// Library: Visual Studio

undefined8 __aulldiv(uint param_1,uint param_2,uint param_3,uint param_4)
{
	ulonglong uVar1;
	longlong lVar2;
	uint uVar3;
	int iVar4;
	uint uVar5;
	uint uVar6;
	uint uVar7;
	uint uVar8;
	uint uVar9;
	
	uVar3 = param_1;
	uVar8 = param_4;
	uVar6 = param_2;
	uVar9 = param_3;
	if (param_4 == 0) {
		uVar3 = param_2 / param_3;
		iVar4 = (int)(((ulonglong)param_2 % (ulonglong)param_3 << 0x20 | (ulonglong)param_1) /
								 (ulonglong)param_3);
	}
	else {
		do {
			uVar5 = uVar8 >> 1;
			uVar9 = uVar9 >> 1 | (uint)((uVar8 & 1) != 0) << 0x1f;
			uVar7 = uVar6 >> 1;
			uVar3 = uVar3 >> 1 | (uint)((uVar6 & 1) != 0) << 0x1f;
			uVar8 = uVar5;
			uVar6 = uVar7;
		} while (uVar5 != 0);
		uVar1 = CONCAT44(uVar7,uVar3) / (ulonglong)uVar9;
		iVar4 = (int)uVar1;
		lVar2 = (ulonglong)param_3 * (uVar1 & 0xffffffff);
		uVar3 = (uint)((ulonglong)lVar2 >> 0x20);
		uVar8 = uVar3 + iVar4 * param_4;
		if (((CARRY4(uVar3,iVar4 * param_4)) || (param_2 < uVar8)) ||
			 ((param_2 <= uVar8 && (param_1 < (uint)lVar2)))) {
			iVar4 += -1;
		}
		uVar3 = 0;
	}
	return CONCAT44(uVar3,iVar4);
}



// Library Function - Single Match
// Name: __aullrem
// Library: Visual Studio

undefined8 __aullrem(uint param_1,uint param_2,uint param_3,uint param_4)
{
	ulonglong uVar1;
	longlong lVar2;
	uint uVar3;
	uint uVar4;
	uint uVar5;
	int iVar6;
	int iVar7;
	uint uVar8;
	uint uVar9;
	uint uVar10;
	bool bVar11;
	
	uVar3 = param_1;
	uVar4 = param_4;
	uVar9 = param_2;
	uVar10 = param_3;
	if (param_4 == 0) {
		iVar6 = (int)(((ulonglong)param_2 % (ulonglong)param_3 << 0x20 | (ulonglong)param_1) %
								 (ulonglong)param_3);
		iVar7 = 0;
	}
	else {
		do {
			uVar5 = uVar4 >> 1;
			uVar10 = uVar10 >> 1 | (uint)((uVar4 & 1) != 0) << 0x1f;
			uVar8 = uVar9 >> 1;
			uVar3 = uVar3 >> 1 | (uint)((uVar9 & 1) != 0) << 0x1f;
			uVar4 = uVar5;
			uVar9 = uVar8;
		} while (uVar5 != 0);
		uVar1 = CONCAT44(uVar8,uVar3) / (ulonglong)uVar10;
		uVar3 = (int)uVar1 * param_4;
		lVar2 = (uVar1 & 0xffffffff) * (ulonglong)param_3;
		uVar9 = (uint)((ulonglong)lVar2 >> 0x20);
		uVar4 = (uint)lVar2;
		uVar10 = uVar9 + uVar3;
		if (((CARRY4(uVar9,uVar3)) || (param_2 < uVar10)) || ((param_2 <= uVar10 && (param_1 < uVar4))))
		{
			bVar11 = uVar4 < param_3;
			uVar4 -= param_3;
			uVar10 = (uVar10 - param_4) - (uint)bVar11;
		}
		iVar6 = -(uVar4 - param_1);
		iVar7 = -(uint)(uVar4 - param_1 != 0) - ((uVar10 - param_2) - (uint)(uVar4 < param_1));
	}
	return CONCAT44(iVar7,iVar6);
}



void __cdecl std::__unk__00498fa0(uint param_1,int *param_2,ushort *param_3)
{
	uint uVar1;
	int iVar2;
	uint uVar3;
	uint local_58 [10];
	int local_30;
	int local_2c;
	uint local_20;
	
	param_3 = (ushort *)(uint)*param_3;
	if (false) goto switchD_00498fbf_caseD_6;
	switch(*param_2) {
	case 1:
	case 5:
		uVar3 = 8;
		break;
	case 2:
		uVar3 = 4;
		break;
	case 3:
		uVar3 = 0x11;
		break;
	case 4:
		uVar3 = 0x12;
		break;
	default:
		goto switchD_00498fbf_caseD_6;
	case 7:
		*param_2 = 1;
		goto switchD_00498fbf_caseD_6;
	case 8:
		uVar3 = 0x10;
	}
	uVar1 = FUN_00493880(uVar3,(double *)(param_2 + 6),(uint)param_3);
	if (uVar1 == 0) {
		if (((param_1 == 0x10) || (param_1 == 0x16)) || (param_1 == 0x1d)) {
			local_30 = param_2[4];
			local_20 = local_20 & 0xffffffe3 | 3;
			local_2c = param_2[5];
		}
		else {
			local_20 &= 0xfffffffe;
		}
		FUN_00493540(local_58,(uint *)&param_3,(byte)uVar3,param_1,(uint *)(param_2 + 2),
								 (uint *)(param_2 + 6));
	}
switchD_00498fbf_caseD_6:
	__unk_math__00493ed0(param_3,0xffff);
	iVar2 = 0;
	if ((*param_2 != 8) && (DAT_004b38e0 == 0)) {
		iVar2 = lego::nerps::funcs::NERPFunc__False(param_2);
	}
	if (iVar2 == 0) {
		FUN_00493c60(*param_2);
	}
	return;
}



uint __cdecl FUN_004990c0(ushort *param_1,byte *param_2,uint param_3)
{
	byte bVar1;
	int iVar2;
	
	if ((param_2 != NULL) && (param_3 != 0)) {
		bVar1 = *param_2;
		if (bVar1 != 0) {
			if (DAT_0054a180 == 0) {
				if (param_1 == NULL) {
					return 1;
				}
				*param_1 = (ushort)bVar1;
				return 1;
			}
			if ((*(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + 1 + (uint)bVar1 * 2) & 0x80) == 0)
			{
				iVar2 = MultiByteToWideChar(DAT_0054a190,9,(LPCSTR)param_2,1,(LPWSTR)param_1,
																		(uint)(param_1 != NULL));
				if (iVar2 != 0) {
					return 1;
				}
				std::globals::g_msvc_errno = 0x2a;
				return 0xffffffff;
			}
			if (((1 < std::globals::g_CharWidth_1__004b0f74) &&
					(std::globals::g_CharWidth_1__004b0f74 <= (int)param_3)) &&
				 (iVar2 = MultiByteToWideChar(DAT_0054a190,9,(LPCSTR)param_2,
																			std::globals::g_CharWidth_1__004b0f74,(LPWSTR)param_1,
																			(uint)(param_1 != NULL)), iVar2 != 0)) {
				return std::globals::g_CharWidth_1__004b0f74;
			}
			if (param_3 < (uint)std::globals::g_CharWidth_1__004b0f74) {
				std::globals::g_msvc_errno = 0x2a;
				return 0xffffffff;
			}
			if (param_2[1] != 0) {
				return std::globals::g_CharWidth_1__004b0f74;
			}
			std::globals::g_msvc_errno = 0x2a;
			return 0xffffffff;
		}
		if (param_1 != NULL) {
			*param_1 = 0;
			return 0;
		}
	}
	return 0;
}



uint __cdecl FUN_004991c0(uint param_1)
{
	uint uVar1;
	
	if (1 < std::globals::g_CharWidth_1__004b0f74) {
		uVar1 = std::_unk_FUN_0048f490(param_1,8);
		return uVar1;
	}
	return *(byte *)(std::globals::g_CharTranslate_TABLE._0_4_ + param_1 * 2) & 8;
}



// Library Function - Single Match
// Name: __allshl
// Library: Visual Studio

longlong __fastcall __allshl(byte param_1,int param_2)
{
	uint in_EAX;
	
	if (0x3f < param_1) {
		return 0;
	}
	if (param_1 < 0x20) {
		return CONCAT44(param_2 << (param_1 & 0x1f) | in_EAX >> 0x20 - (param_1 & 0x1f),
										in_EAX << (param_1 & 0x1f));
	}
	return (ulonglong)(in_EAX << (param_1 & 0x1f)) << 0x20;
}



uint __cdecl FUN_00499210(uint param_1,char **param_2)
{
	char *pcVar1;
	char *pcVar2;
	
	if ((param_1 != 0xffffffff) &&
		 ((pcVar1 = param_2[3], ((uint)pcVar1 & 1) != 0 ||
			((((uint)pcVar1 & 0x80) != 0 && (((uint)pcVar1 & 2) == 0)))))) {
		if (param_2[2] == NULL) {
			FUN_00498da0((int *)param_2);
		}
		if (*param_2 == param_2[2]) {
			if (param_2[1] != NULL) {
				return 0xffffffff;
			}
			*param_2 = *param_2 + 1;
		}
		if ((*(byte *)(param_2 + 3) & 0x40) == 0) {
			pcVar1 = *param_2;
			*param_2 = pcVar1 + -1;
			pcVar1[-1] = (char)param_1;
		}
		else {
			pcVar1 = *param_2;
			pcVar2 = pcVar1 + -1;
			*param_2 = pcVar2;
			if (*pcVar2 != (char)param_1) {
				*param_2 = pcVar1;
				return 0xffffffff;
			}
		}
		param_2[1] = param_2[1] + 1;
		param_2[3] = (char *)((uint)param_2[3] & 0xffffffef | 1);
		return param_1 & 0xff;
	}
	return 0xffffffff;
}



int FUN_004992a0(void)
{
	undefined4 *puVar1;
	undefined4 *puVar2;
	int *piVar3;
	int iVar4;
	int iVar5;
	int iVar6;
	
	iVar4 = -1;
	iVar5 = 0;
	iVar6 = 0;
	piVar3 = &DAT_0076edc0;
	do {
		puVar2 = (undefined4 *)*piVar3;
		if (puVar2 == NULL) {
			puVar2 = (undefined4 *)std::malloc(0x100);
			if (puVar2 != NULL) {
				DAT_0076eec0 += 0x20;
				(&DAT_0076edc0)[iVar5] = puVar2;
				if (puVar2 < puVar2 + 0x40) {
					do {
						*(undefined *)(puVar2 + 1) = 0;
						*puVar2 = 0xffffffff;
						*(undefined *)((int)puVar2 + 5) = 10;
						puVar2 = puVar2 + 2;
					} while (puVar2 < (undefined4 *)((&DAT_0076edc0)[iVar5] + 0x100));
				}
				iVar4 = iVar5 << 5;
			}
			return iVar4;
		}
		puVar1 = puVar2 + 0x40;
		for (; puVar2 < puVar1; puVar2 = puVar2 + 2) {
			if ((*(byte *)(puVar2 + 1) & 1) == 0) {
				*puVar2 = 0xffffffff;
				iVar4 = ((int)((int)puVar2 - *piVar3) >> 3) + iVar6;
				break;
			}
		}
		if (iVar4 != -1) {
			return iVar4;
		}
		piVar3 = piVar3 + 1;
		iVar5 += 1;
		iVar6 += 0x20;
		if (0x76eebf < (int)piVar3) {
			return -1;
		}
	} while( true );
}



undefined4 __cdecl FUN_00499360(uint param_1,HANDLE param_2)
{
	int *piVar1;
	int iVar2;
	
	if (param_1 < DAT_0076eec0) {
		piVar1 = &DAT_0076edc0 + ((int)param_1 >> 5);
		iVar2 = (param_1 & 0x1f) * 8;
		if (*(int *)((&DAT_0076edc0)[(int)param_1 >> 5] + iVar2) == -1) {
			if (DAT_004b0d64 == 1) {
				if (param_1 == 0) {
					SetStdHandle(0xfffffff6,param_2);
				}
				else {
					if (param_1 == 1) {
						SetStdHandle(0xfffffff5,param_2);
						*(HANDLE *)(*piVar1 + iVar2) = param_2;
						return 0;
					}
					if (param_1 == 2) {
						SetStdHandle(0xfffffff4,param_2);
						*(HANDLE *)(*piVar1 + iVar2) = param_2;
						return 0;
					}
				}
			}
			*(HANDLE *)(*piVar1 + iVar2) = param_2;
			return 0;
		}
	}
	std::globals::g_msvc_errno = 9;
	std::globals::g_msvc_doserrno = 0;
	return 0xffffffff;
}



undefined4 __cdecl FUN_00499410(uint param_1)
{
	int iVar1;
	DWORD nStdHandle;
	
	if (param_1 < DAT_0076eec0) {
		iVar1 = (param_1 & 0x1f) * 8;
		if (((*(byte *)((&DAT_0076edc0)[(int)param_1 >> 5] + 4 + iVar1) & 1) != 0) &&
			 (*(int *)((&DAT_0076edc0)[(int)param_1 >> 5] + iVar1) != -1)) {
			if (DAT_004b0d64 == 1) {
				if (param_1 == 0) {
					nStdHandle = 0xfffffff6;
				}
				else {
					if (param_1 == 1) {
						nStdHandle = 0xfffffff5;
					}
					else {
						if (param_1 != 2) goto LAB_0049947a;
						nStdHandle = 0xfffffff4;
					}
				}
				SetStdHandle(nStdHandle,NULL);
			}
LAB_0049947a:
			*(undefined4 *)((&DAT_0076edc0)[(int)param_1 >> 5] + iVar1) = 0xffffffff;
			return 0;
		}
	}
	std::globals::g_msvc_errno = 9;
	std::globals::g_msvc_doserrno = 0;
	return 0xffffffff;
}



undefined4 __cdecl FUN_004994b0(uint param_1)
{
	if ((param_1 < DAT_0076eec0) &&
		 ((*(byte *)((&DAT_0076edc0)[(int)param_1 >> 5] + 4 + (param_1 & 0x1f) * 8) & 1) != 0)) {
		return *(undefined4 *)((&DAT_0076edc0)[(int)param_1 >> 5] + (param_1 & 0x1f) * 8);
	}
	std::globals::g_msvc_errno = 9;
	std::globals::g_msvc_doserrno = 0;
	return 0xffffffff;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

uint __cdecl FUN_00499500(LPCSTR param_1,uint param_2,uint param_3,undefined4 param_4)
{
	uint uVar1;
	HANDLE hFile;
	char *pcVar2;
	int iVar3;
	DWORD DVar4;
	DWORD dwCreationDisposition;
	DWORD dwFlagsAndAttributes;
	int iVar5;
	bool bVar6;
	byte local_11;
	uint local_10;
	_SECURITY_ATTRIBUTES local_c;
	
	bVar6 = (param_2 & 0x80) == 0;
	local_c.nLength = 0xc;
	local_c.lpSecurityDescriptor = NULL;
	if (bVar6) {
		local_11 = 0;
	}
	else {
		local_11 = 0x10;
	}
	local_c.bInheritHandle = ZEXT14(bVar6);
	if (((param_2 & 0x8000) == 0) && (((param_2 & 0x4000) != 0 || (_DAT_0054a4f4 != 0x8000)))) {
		local_11 |= 0x80;
	}
	uVar1 = param_2 & 3;
	if (uVar1 == 0) {
		local_10 = 0x80000000;
	}
	else {
		if (uVar1 == 1) {
			local_10 = 0x40000000;
		}
		else {
			if (uVar1 != 2) {
				std::globals::g_msvc_errno = 0x16;
				std::globals::g_msvc_doserrno = 0;
				return 0xffffffff;
			}
			local_10 = 0xc0000000;
		}
	}
	if (false) {
switchD_00499598_caseD_11:
		std::globals::g_msvc_errno = 0x16;
		std::globals::g_msvc_doserrno = 0;
		return 0xffffffff;
	}
	switch(param_3) {
	case 0x10:
		DVar4 = 0;
		break;
	default:
		goto switchD_00499598_caseD_11;
	case 0x20:
		DVar4 = 1;
		break;
	case 0x30:
		DVar4 = 2;
		break;
	case 0x40:
		DVar4 = 3;
	}
	uVar1 = param_2 & 0x700;
	if (uVar1 < 0x101) {
		if (uVar1 == 0x100) {
			dwCreationDisposition = 4;
			goto LAB_0049962b;
		}
		if (uVar1 != 0) {
			std::globals::g_msvc_errno = 0x16;
			std::globals::g_msvc_doserrno = 0;
			return 0xffffffff;
		}
LAB_00499606:
		dwCreationDisposition = 3;
		goto LAB_0049962b;
	}
	if (uVar1 < 0x301) {
		if (uVar1 == 0x300) {
			dwCreationDisposition = 2;
			goto LAB_0049962b;
		}
		if (uVar1 != 0x200) {
			std::globals::g_msvc_errno = 0x16;
			std::globals::g_msvc_doserrno = 0;
			return 0xffffffff;
		}
LAB_00499626:
		dwCreationDisposition = 5;
	}
	else {
		if (uVar1 < 0x501) {
			if (uVar1 != 0x500) {
				if (uVar1 != 0x400) {
					std::globals::g_msvc_errno = 0x16;
					std::globals::g_msvc_doserrno = 0;
					return 0xffffffff;
				}
				goto LAB_00499606;
			}
		}
		else {
			if (uVar1 == 0x600) goto LAB_00499626;
			if (uVar1 != 0x700) {
				std::globals::g_msvc_errno = 0x16;
				std::globals::g_msvc_doserrno = 0;
				return 0xffffffff;
			}
		}
		dwCreationDisposition = 1;
	}
LAB_0049962b:
	dwFlagsAndAttributes = 0x80;
	if (((param_2 & 0x100) != 0) && (((byte)param_4 & ~(byte)DAT_0054a0d8 & 0x80) == 0)) {
		dwFlagsAndAttributes = 1;
	}
	if ((param_2 & 0x40) != 0) {
		dwFlagsAndAttributes |= 0x4000000;
		local_10 |= 0x10000;
	}
	if ((param_2 & 0x1000) != 0) {
		dwFlagsAndAttributes |= 0x100;
	}
	if ((param_2 & 0x20) == 0) {
		if ((param_2 & 0x10) != 0) {
			dwFlagsAndAttributes |= 0x10000000;
		}
	}
	else {
		dwFlagsAndAttributes |= 0x8000000;
	}
	uVar1 = FUN_004992a0();
	if (uVar1 == 0xffffffff) {
		std::globals::g_msvc_errno = 0x18;
		std::globals::g_msvc_doserrno = 0;
		return 0xffffffff;
	}
	hFile = CreateFileA(param_1,local_10,DVar4,(LPSECURITY_ATTRIBUTES)&local_c,dwCreationDisposition,
											dwFlagsAndAttributes,NULL);
	if (hFile == (HANDLE)0xffffffff) {
		DVar4 = GetLastError();
		std::__set_doserrno(DVar4);
		return 0xffffffff;
	}
	DVar4 = GetFileType(hFile);
	if (DVar4 == 0) {
		CloseHandle(hFile);
		DVar4 = GetLastError();
		std::__set_doserrno(DVar4);
		return 0xffffffff;
	}
	if (DVar4 == 2) {
		local_11 |= 0x40;
	}
	else {
		if (DVar4 == 3) {
			local_11 |= 8;
		}
	}
	FUN_00499360(uVar1,hFile);
	iVar5 = (uVar1 & 0x1f) * 8;
	*(byte *)(iVar5 + 4 + (&DAT_0076edc0)[(int)uVar1 >> 5]) = local_11 | 1;
	if ((((local_11 & 0x48) == 0) && ((local_11 & 0x80) != 0)) && ((param_2 & 2) != 0)) {
		DVar4 = FUN_00496ec0(uVar1,-1,2);
		if (DVar4 == 0xffffffff) {
			if (std::globals::g_msvc_doserrno != 0x83) {
				std::__fdclose__00494fd0(uVar1);
				return 0xffffffff;
			}
		}
		else {
			param_3 &= 0xffffff00;
			pcVar2 = FUN_004973f0(uVar1,(char *)&param_3,1);
			if (((pcVar2 == NULL) && ((char)param_3 == '\x1a')) &&
				 (iVar3 = FUN_0049ab50((char)uVar1), iVar3 == -1)) {
				std::__fdclose__00494fd0(uVar1);
				return 0xffffffff;
			}
			DVar4 = FUN_00496ec0(uVar1,0,0);
			if (DVar4 == 0xffffffff) {
				std::__fdclose__00494fd0(uVar1);
				return 0xffffffff;
			}
		}
	}
	if (((local_11 & 0x48) == 0) && ((param_2 & 8) != 0)) {
		*(byte *)(iVar5 + 4 + (&DAT_0076edc0)[(int)uVar1 >> 5]) =
				 *(byte *)(iVar5 + 4 + (&DAT_0076edc0)[(int)uVar1 >> 5]) | 0x20;
	}
	return uVar1;
}



void FUN_00499920(void)
{
	DAT_0054a424 = SetUnhandledExceptionFilter((LPTOP_LEVEL_EXCEPTION_FILTER)&LAB_004998c0);
	return;
}



void FUN_00499940(void)
{
	SetUnhandledExceptionFilter(DAT_0054a424);
	return;
}



uint __cdecl FUN_00499950(void *param_1,UINT_PTR param_2)
{
	BOOL BVar1;
	
	BVar1 = IsBadReadPtr(param_1,param_2);
	return (uint)(BVar1 == 0);
}



uint __cdecl FUN_00499970(LPVOID param_1,UINT_PTR param_2)
{
	BOOL BVar1;
	
	BVar1 = IsBadWritePtr(param_1,param_2);
	return (uint)(BVar1 == 0);
}



uint __cdecl FUN_00499990(FARPROC param_1)
{
	BOOL BVar1;
	
	BVar1 = IsBadCodePtr(param_1);
	return (uint)(BVar1 == 0);
}



// Library Function - Single Match
// Name: _abort
// Library: Visual Studio 1998 Release

void __cdecl _abort(void)
{
	FUN_00496bb0(10);
	FUN_0049acd0(0x16);
	std::quick_exit(3);
	return;
}



int __cdecl FUN_004999d0(short *param_1)
{
	short sVar1;
	short *psVar2;
	
	sVar1 = *param_1;
	psVar2 = param_1 + 1;
	while (sVar1 != 0) {
		sVar1 = *psVar2;
		psVar2 = psVar2 + 1;
	}
	return ((int)((int)psVar2 - (int)param_1) >> 1) + -1;
}



int __cdecl FUN_004999f0(undefined4 param_1,undefined4 param_2,undefined4 param_3)
{
	HMODULE hModule;
	int iVar1;
	
	iVar1 = 0;
	if (DAT_0054a428 != NULL) {
LAB_00499a40:
		if (DAT_0054a42c != NULL) {
			iVar1 = (*DAT_0054a42c)();
		}
		if ((iVar1 != 0) && (DAT_0054a430 != NULL)) {
			iVar1 = (*DAT_0054a430)(iVar1);
		}
		iVar1 = (*DAT_0054a428)(iVar1,param_1,param_2,param_3);
		return iVar1;
	}
	hModule = LoadLibraryA("user32.dll");
	if (hModule != NULL) {
		DAT_0054a428 = GetProcAddress(hModule,"MessageBoxA");
		if (DAT_0054a428 != NULL) {
			DAT_0054a42c = GetProcAddress(hModule,"GetActiveWindow");
			DAT_0054a430 = GetProcAddress(hModule,"GetLastActivePopup");
			goto LAB_00499a40;
		}
	}
	return 0;
}



int * __cdecl FUN_00499a80(int param_1,int param_2)
{
	BOOL BVar1;
	uint uVar2;
	int *piVar3;
	uint dwBytes;
	int *piVar4;
	
	dwBytes = param_2 * param_1;
	if (dwBytes < 0xffffffe1) {
		if (dwBytes == 0) {
			dwBytes = 0x10;
		}
		else {
			dwBytes = dwBytes + 0xf & 0xfffffff0;
		}
	}
	do {
		piVar3 = NULL;
		if (dwBytes < 0xffffffe1) {
			if (UINT_004b2fdc < dwBytes) {
LAB_00499ae0:
				if (piVar3 != NULL) {
					return piVar3;
				}
			}
			else {
				piVar3 = FUN_00491bc0((int *)(dwBytes >> 4));
				if (piVar3 != NULL) {
					piVar4 = piVar3;
					for (uVar2 = dwBytes >> 2; uVar2 != 0; uVar2 -= 1) {
						*piVar4 = 0;
						piVar4 = piVar4 + 1;
					}
					for (uVar2 = dwBytes & 3; uVar2 != 0; uVar2 -= 1) {
						*(undefined *)piVar4 = 0;
						piVar4 = (int *)((int)piVar4 + 1);
					}
					goto LAB_00499ae0;
				}
			}
			piVar3 = (int *)HeapAlloc(DAT_0076eec4,8,dwBytes);
		}
		if ((piVar3 != NULL) || (DAT_0054a154 == 0)) {
			return piVar3;
		}
		BVar1 = FUN_00492050(dwBytes);
		if (BVar1 == 0) {
			return NULL;
		}
	} while( true );
}



void FUN_00499b20(void)
{
	if (DAT_0054a4f0 == 0) {
		FUN_00499b40();
		DAT_0054a4f0 += 1;
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void FUN_00499b40(void)
{
	byte bVar1;
	byte bVar2;
	byte *pbVar3;
	DWORD DVar4;
	int iVar5;
	uint uVar6;
	uint uVar7;
	byte *pbVar8;
	undefined4 *puVar9;
	byte *pbVar10;
	undefined4 *puVar11;
	bool bVar12;
	
	DAT_0054a438 = 0;
	_DAT_004b3998 = 0xffffffff;
	DAT_004b3988 = 0xffffffff;
	pbVar3 = FUN_0049b0d0((byte *)"TZ");
	if (pbVar3 == NULL) {
		DVar4 = GetTimeZoneInformation((LPTIME_ZONE_INFORMATION)&lpTimeZoneInformation_0054a440);
		if (DVar4 != 0xffffffff) {
			DAT_0054a438 = 1;
			DAT_004b38f0 = (int)lpTimeZoneInformation_0054a440 * 0x3c;
			if (DAT_0054a486 != 0) {
				DAT_004b38f0 += DAT_0054a494 * 0x3c;
			}
			if ((DAT_0054a4da == 0) || (DAT_0054a4e8 == 0)) {
				DAT_004b38f4 = 0;
				DAT_004b38f8 = 0;
			}
			else {
				DAT_004b38f4 = 1;
				DAT_004b38f8 = (DAT_0054a4e8 - DAT_0054a494) * 0x3c;
			}
			FUN_0049aea0(PTR_DAT_004b3980,(ushort *)&DAT_0054a444,0x40);
			FUN_0049aea0(PTR_DAT_004b3984,(ushort *)&DAT_0054a498,0x40);
			PTR_DAT_004b3984[0x3f] = 0;
			PTR_DAT_004b3980[0x3f] = 0;
			return;
		}
	}
	else {
		if (*pbVar3 != 0) {
			pbVar8 = pbVar3;
			puVar9 = DAT_0054a4ec;
			if (DAT_0054a4ec != NULL) {
				do {
					bVar1 = *pbVar8;
					bVar12 = bVar1 < *(byte *)puVar9;
					if (bVar1 != *(byte *)puVar9) {
LAB_00499c83:
						iVar5 = (1 - (uint)bVar12) - (uint)(bVar12 != 0);
						goto LAB_00499c88;
					}
					if (bVar1 == 0) break;
					bVar1 = pbVar8[1];
					bVar12 = bVar1 < *(byte *)((int)puVar9 + 1);
					if (bVar1 != *(byte *)((int)puVar9 + 1)) goto LAB_00499c83;
					pbVar8 = pbVar8 + 2;
					puVar9 = (undefined4 *)((int)puVar9 + 2);
				} while (bVar1 != 0);
				iVar5 = 0;
LAB_00499c88:
				if (iVar5 == 0) {
					return;
				}
			}
			std::free(DAT_0054a4ec);
			uVar6 = 0xffffffff;
			pbVar8 = pbVar3;
			do {
				if (uVar6 == 0) break;
				uVar6 -= 1;
				bVar1 = *pbVar8;
				pbVar8 = pbVar8 + 1;
			} while (bVar1 != 0);
			DAT_0054a4ec = (undefined4 *)std::malloc(~uVar6);
			if (DAT_0054a4ec != NULL) {
				uVar6 = 0xffffffff;
				pbVar8 = pbVar3;
				do {
					pbVar10 = pbVar8;
					if (uVar6 == 0) break;
					uVar6 -= 1;
					pbVar10 = pbVar8 + 1;
					bVar1 = *pbVar8;
					pbVar8 = pbVar10;
				} while (bVar1 != 0);
				uVar6 = ~uVar6;
				puVar9 = (undefined4 *)(pbVar10 + -uVar6);
				puVar11 = DAT_0054a4ec;
				for (uVar7 = uVar6 >> 2; uVar7 != 0; uVar7 -= 1) {
					*puVar11 = *puVar9;
					puVar9 = puVar9 + 1;
					puVar11 = puVar11 + 1;
				}
				for (uVar6 &= 3; uVar6 != 0; uVar6 -= 1) {
					*(undefined *)puVar11 = *(undefined *)puVar9;
					puVar9 = (undefined4 *)((int)puVar9 + 1);
					puVar11 = (undefined4 *)((int)puVar11 + 1);
				}
				std::_strncpy(PTR_DAT_004b3980,(char *)pbVar3,3);
				pbVar8 = pbVar3 + 3;
				PTR_DAT_004b3980[3] = 0;
				bVar1 = *pbVar8;
				if (bVar1 == 0x2d) {
					pbVar8 = pbVar3 + 4;
				}
				iVar5 = std::__atoi_internal(pbVar8);
				DAT_004b38f0 = iVar5 * 0xe10;
				for (; (bVar2 = *pbVar8, bVar2 == 0x2b || (('/' < (char)bVar2 && ((char)bVar2 < ':'))));
						pbVar8 = pbVar8 + 1) {
				}
				if (*pbVar8 == 0x3a) {
					pbVar8 = pbVar8 + 1;
					iVar5 = std::__atoi_internal(pbVar8);
					DAT_004b38f0 += iVar5 * 0x3c;
					bVar2 = *pbVar8;
					while (('/' < (char)bVar2 && ((char)bVar2 < ':'))) {
						pbVar3 = pbVar8 + 1;
						pbVar8 = pbVar8 + 1;
						bVar2 = *pbVar3;
					}
					if (*pbVar8 == 0x3a) {
						pbVar8 = pbVar8 + 1;
						iVar5 = std::__atoi_internal(pbVar8);
						DAT_004b38f0 += iVar5;
						bVar2 = *pbVar8;
						while (('/' < (char)bVar2 && ((char)bVar2 < ':'))) {
							pbVar3 = pbVar8 + 1;
							pbVar8 = pbVar8 + 1;
							bVar2 = *pbVar3;
						}
					}
				}
				if (bVar1 == 0x2d) {
					DAT_004b38f0 = -DAT_004b38f0;
				}
				DAT_004b38f4 = (int)(char)*pbVar8;
				if (DAT_004b38f4 != 0) {
					std::_strncpy(PTR_DAT_004b3984,(char *)pbVar8,3);
					PTR_DAT_004b3984[3] = 0;
					return;
				}
				*PTR_DAT_004b3984 = 0;
			}
		}
	}
	return;
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

uint __cdecl FUN_00499df0(int *param_1)
{
	uint uVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	uint uVar5;
	int iVar6;
	uint uVar7;
	uint uVar8;
	uint uVar9;
	uint uVar10;
	uint uVar11;
	
	if (DAT_004b38f4 == 0) {
		return 0;
	}
	uVar7 = param_1[5];
	if ((uVar7 == DAT_004b3988) && (uVar7 == _DAT_004b3998)) goto LAB_00499fc4;
	if (DAT_0054a438 == 0) {
		FUN_0049a060(1,1,uVar7,4,1,0,0,2,0,0,0);
		uVar7 = param_1[5];
		uVar11 = 0;
		uVar3 = 0;
		uVar10 = 0;
		uVar4 = 2;
		uVar1 = 0;
		uVar9 = 5;
		uVar8 = 10;
LAB_00499fb8:
		uVar5 = 0;
		iVar6 = 1;
	}
	else {
		if (_DAT_0054a4d8 != 0) {
			uVar10 = (uint)DAT_0054a4dc._2_2_;
			uVar3 = 0;
			uVar1 = 0;
		}
		else {
			uVar3 = DAT_0054a4dc & 0xffff;
			uVar10 = 0;
			uVar1 = (uint)DAT_0054a4dc._2_2_;
		}
		FUN_0049a060(1,(uint)(_DAT_0054a4d8 == 0),uVar7,(uint)DAT_0054a4da,uVar1,uVar3,uVar10,
								 _DAT_0054a4e0 & 0xffff,_DAT_0054a4e0 >> 0x10,DAT_0054a4e4 & 0xffff,
								 DAT_0054a4e4 >> 0x10);
		if (_DAT_0054a484 == 0) {
			uVar11 = (uint)DAT_0054a490._2_2_;
			uVar3 = DAT_0054a490 & 0xffff;
			uVar10 = (uint)DAT_0054a48c._2_2_;
			uVar4 = DAT_0054a48c & 0xffff;
			uVar1 = DAT_0054a488 & 0xffff;
			uVar9 = (uint)DAT_0054a488._2_2_;
			uVar8 = (uint)DAT_0054a486;
			uVar7 = param_1[5];
			goto LAB_00499fb8;
		}
		uVar11 = (uint)DAT_0054a490._2_2_;
		uVar3 = DAT_0054a490 & 0xffff;
		uVar10 = (uint)DAT_0054a48c._2_2_;
		uVar5 = (uint)DAT_0054a488._2_2_;
		uVar4 = DAT_0054a48c & 0xffff;
		uVar7 = param_1[5];
		uVar8 = (uint)DAT_0054a486;
		uVar1 = 0;
		uVar9 = 0;
		iVar6 = 0;
	}
	FUN_0049a060(0,iVar6,uVar7,uVar8,uVar9,uVar1,uVar5,uVar4,uVar10,uVar3,uVar11);
LAB_00499fc4:
	iVar6 = param_1[7];
	if (DAT_004b398c < DAT_004b399c) {
		if ((iVar6 < DAT_004b398c) || (DAT_004b399c < iVar6)) {
			return 0;
		}
		if ((DAT_004b398c < iVar6) && (iVar6 < DAT_004b399c)) {
			return 1;
		}
	}
	else {
		if ((iVar6 < DAT_004b399c) || (DAT_004b398c < iVar6)) {
			return 1;
		}
		if ((DAT_004b399c < iVar6) && (iVar6 < DAT_004b398c)) {
			return 0;
		}
	}
	iVar2 = (*param_1 + (param_1[1] + param_1[2] * 0x3c) * 0x3c) * 1000;
	if (iVar6 != DAT_004b398c) {
		return (uint)(iVar2 < DAT_004b39a0);
	}
	return (uint)(DAT_004b3990 <= iVar2);
}



// WARNING: Globals starting with '_' overlap smaller symbols at the same address

void __cdecl
FUN_0049a060(int param_1,int param_2,uint param_3,int param_4,int param_5,int param_6,int param_7,
						int param_8,int param_9,int param_10,int param_11)
{
	int iVar1;
	int iVar2;
	
	if (param_2 == 1) {
		if ((param_3 & 3) == 0) {
			iVar1 = *(int *)(&DAT_004b39a4 + param_4 * 4);
		}
		else {
			iVar1 = *(int *)(&DAT_004b39dc + param_4 * 4);
		}
		iVar2 = (int)(((int)(param_3 - 1) >> 2) + -0x63db + param_3 * 0x16d + iVar1 + 1) % 7;
		if (iVar2 < param_6) {
			iVar1 = iVar1 + -6 + (param_5 * 7 - iVar2) + param_6;
		}
		else {
			iVar1 = iVar1 + 1 + (param_5 * 7 - iVar2) + param_6;
		}
		if (param_5 == 5) {
			if ((param_3 & 3) == 0) {
				iVar2 = *(int *)(&DAT_004b39a8 + param_4 * 4);
			}
			else {
				iVar2 = *(int *)(&DAT_004b39e0 + param_4 * 4);
			}
			if (iVar2 < iVar1) {
				iVar1 += -7;
			}
		}
	}
	else {
		if ((param_3 & 3) == 0) {
			iVar1 = *(int *)(&DAT_004b39a4 + param_4 * 4);
		}
		else {
			iVar1 = *(int *)(&DAT_004b39dc + param_4 * 4);
		}
		iVar1 += param_7;
	}
	if (param_1 == 1) {
		DAT_004b3988 = param_3;
		DAT_004b398c = iVar1;
		DAT_004b3990 = param_11 + (param_10 + (param_9 + param_8 * 0x3c) * 0x3c) * 1000;
		return;
	}
	DAT_004b39a0 = param_11 + (param_10 + (param_9 + param_8 * 0x3c) * 0x3c + DAT_004b38f8) * 1000;
	if (DAT_004b39a0 < 0) {
		_DAT_004b3998 = param_3;
		DAT_004b399c = iVar1;
		DAT_004b39a0 = DAT_004b39a0 + 86399999;
		return;
	}
	if (86399999 < DAT_004b39a0) {
		DAT_004b39a0 += -86399999;
	}
	_DAT_004b3998 = param_3;
	DAT_004b399c = iVar1;
	return;
}



undefined4 __cdecl FUN_0049a270(uint param_1,uint param_2,uint *param_3)
{
	uint uVar1;
	undefined4 uVar2;
	
	uVar2 = 0;
	uVar1 = param_2 + param_1;
	if ((uVar1 < param_1) || (uVar1 < param_2)) {
		uVar2 = 1;
	}
	*param_3 = uVar1;
	return uVar2;
}



void __cdecl FUN_0049a2a0(uint *param_1,uint *param_2)
{
	int iVar1;
	
	iVar1 = FUN_0049a270(*param_1,*param_2,param_1);
	if (iVar1 != 0) {
		iVar1 = FUN_0049a270(param_1[1],1,param_1 + 1);
		if (iVar1 != 0) {
			param_1[2] = param_1[2] + 1;
		}
	}
	iVar1 = FUN_0049a270(param_1[1],param_2[1],param_1 + 1);
	if (iVar1 != 0) {
		param_1[2] = param_1[2] + 1;
	}
	FUN_0049a270(param_1[2],param_2[2],param_1 + 2);
	return;
}



void __cdecl FUN_0049a310(uint *param_1)
{
	uint uVar1;
	uint uVar2;
	
	uVar1 = *param_1;
	uVar2 = param_1[1];
	*param_1 = uVar1 * 2;
	param_1[1] = uVar2 * 2 | uVar1 >> 0x1f;
	param_1[2] = param_1[2] << 1 | uVar2 >> 0x1f;
	return;
}



void __cdecl FUN_0049a340(uint *param_1)
{
	uint uVar1;
	
	uVar1 = param_1[1];
	param_1[1] = uVar1 >> 1 | param_1[2] << 0x1f;
	param_1[2] = param_1[2] >> 1;
	*param_1 = *param_1 >> 1 | uVar1 << 0x1f;
	return;
}



void __cdecl FUN_0049a370(char *param_1,int param_2,uint *param_3)
{
	uint uVar1;
	uint *puVar2;
	short sVar3;
	uint local_c;
	uint local_8;
	uint local_4;
	
	puVar2 = param_3;
	sVar3 = 0x404e;
	*param_3 = 0;
	param_3[1] = 0;
	param_3[2] = 0;
	if (param_2 != 0) {
		param_3 = (uint *)param_2;
		do {
			local_c = *puVar2;
			local_8 = puVar2[1];
			local_4 = puVar2[2];
			FUN_0049a310(puVar2);
			FUN_0049a310(puVar2);
			FUN_0049a2a0(puVar2,&local_c);
			FUN_0049a310(puVar2);
			local_c = SEXT14(*param_1);
			local_8 = 0;
			local_4 = 0;
			FUN_0049a2a0(puVar2,&local_c);
			param_1 = param_1 + 1;
			param_3 = (uint *)((int)param_3 + -1);
		} while (param_3 != NULL);
	}
	uVar1 = puVar2[2];
	while (uVar1 == 0) {
		sVar3 += -0x10;
		puVar2[2] = puVar2[1] >> 0x10;
		uVar1 = puVar2[2];
		puVar2[1] = *puVar2 >> 0x10 | puVar2[1] << 0x10;
		*puVar2 = *puVar2 << 0x10;
	}
	uVar1 = puVar2[2];
	while ((uVar1 & 0x8000) == 0) {
		FUN_0049a310(puVar2);
		sVar3 += -1;
		uVar1 = puVar2[2];
	}
	*(short *)((int)puVar2 + 10) = sVar3;
	return;
}



// WARNING: Could not reconcile some variable overlaps

undefined4 __cdecl
FUN_0049a470(uint param_1,uint param_2,uint param_3,int param_4,byte param_5,short *param_6)
{
	short *psVar1;
	ushort uVar2;
	char cVar3;
	uint uVar4;
	int iVar5;
	short *psVar6;
	short *psVar7;
	int iVar8;
	short sVar9;
	int iVar10;
	undefined local_1c;
	undefined local_1b;
	undefined local_1a;
	undefined local_19;
	undefined local_18;
	undefined local_17;
	undefined local_16;
	undefined local_15;
	undefined local_14;
	undefined local_13;
	undefined local_12;
	undefined local_11;
	undefined2 local_10;
	undefined4 uStack14;
	undefined4 uStack10;
	undefined local_6;
	char cStack5;
	
	psVar1 = param_6;
	local_1c = 0xcc;
	local_1b = 0xcc;
	local_1a = 0xcc;
	local_19 = 0xcc;
	local_18 = 0xcc;
	local_17 = 0xcc;
	local_16 = 0xcc;
	local_15 = 0xcc;
	local_14 = 0xcc;
	local_13 = 0xcc;
	uVar4 = param_3 & 0x7fff;
	local_12 = 0xfb;
	local_11 = 0x3f;
	if ((param_3 & 0x8000) == 0) {
		*(undefined *)(param_6 + 1) = 0x20;
	}
	else {
		*(undefined *)(param_6 + 1) = 0x2d;
	}
	if ((((short)uVar4 == 0) && (param_2 == 0)) && (param_1 == 0)) {
		*param_6 = 0;
LAB_0049a67f:
		*(undefined *)(psVar1 + 1) = 0x20;
		*(undefined *)((int)psVar1 + 3) = 1;
		*(undefined *)(psVar1 + 2) = 0x30;
		*(undefined *)((int)psVar1 + 5) = 0;
		return 1;
	}
	if ((short)uVar4 == 0x7fff) {
		*param_6 = 1;
		if (((param_2 != 0x80000000) || (param_1 != 0)) && ((param_2 & 0x40000000) == 0)) {
			*(undefined4 *)(param_6 + 2) = 0x4e532331;
			param_6[4] = 0x4e41;
			*(undefined *)((int)param_6 + 3) = 6;
			*(undefined *)(param_6 + 5) = 0;
			return 0;
		}
		if ((((param_3 & 0x8000) != 0) && (param_2 == 0xc0000000)) && (param_1 == 0)) {
			*(undefined4 *)(param_6 + 2) = 0x4e492331;
			*(undefined *)((int)param_6 + 3) = 5;
			param_6[4] = 0x44;
			return 0;
		}
		if ((param_2 == 0x80000000) && (param_1 == 0)) {
			*(undefined4 *)(param_6 + 2) = 0x4e492331;
			*(undefined *)((int)param_6 + 3) = 5;
			param_6[4] = 0x46;
			return 0;
		}
		*(undefined4 *)(param_6 + 2) = 0x4e512331;
		param_6[4] = 0x4e41;
		*(undefined *)((int)param_6 + 3) = 6;
		*(undefined *)(param_6 + 5) = 0;
		return 0;
	}
	local_6 = (undefined)uVar4;
	cStack5 = (char)(uVar4 >> 8);
	local_10 = 0;
	sVar9 = (short)(((uVar4 >> 8) + (param_2 >> 0x18) * 2) * 0x4d + -0x134312f4 + uVar4 * 0x4d10 >>
								 0x10);
	uStack10 = param_2;
	uStack14 = param_1;
	FUN_0049aac0((int *)&local_10,-(int)sVar9,1);
	if (0x3ffe < CONCAT11(cStack5,local_6)) {
		sVar9 += 1;
		FUN_0049a800((int *)&local_10,(int *)&local_1c);
	}
	*psVar1 = sVar9;
	iVar8 = param_4;
	if (((param_5 & 1) != 0) && (iVar8 = param_4 + sVar9, param_4 + sVar9 < 1)) {
		*psVar1 = 0;
		goto LAB_0049a67f;
	}
	if (0x15 < iVar8) {
		iVar8 = 0x15;
	}
	uVar2 = CONCAT11(cStack5,local_6);
	local_6 = 0;
	cStack5 = '\0';
	iVar5 = 8;
	iVar10 = uVar2 - 0x3ffe;
	do {
		FUN_0049a310((uint *)&local_10);
		iVar5 += -1;
	} while (iVar5 != 0);
	if (iVar10 < 0) {
		for (uVar4 = -iVar10 & 0xff; uVar4 != 0; uVar4 -= 1) {
			FUN_0049a340((uint *)&local_10);
		}
	}
	psVar1 = psVar1 + 2;
	iVar8 += 1;
	psVar6 = psVar1;
	if (0 < iVar8) {
		do {
			uStack10._2_2_ = (undefined2)(uStack10 >> 0x10);
			uStack14._2_2_ = (undefined2)(uStack14 >> 0x10);
			param_1 = CONCAT22((undefined2)uStack14,local_10);
			param_2 = CONCAT22((undefined2)uStack10,uStack14._2_2_);
			param_3 = CONCAT13(cStack5,CONCAT12(local_6,uStack10._2_2_));
			FUN_0049a310((uint *)&local_10);
			FUN_0049a310((uint *)&local_10);
			FUN_0049a2a0((uint *)&local_10,&param_1);
			FUN_0049a310((uint *)&local_10);
			cVar3 = cStack5 + '0';
			cStack5 = '\0';
			*(char *)psVar6 = cVar3;
			psVar6 = (short *)((int)psVar6 + 1);
			iVar8 += -1;
		} while (iVar8 != 0);
	}
	psVar7 = psVar6 + -1;
	if (*(char *)((int)psVar6 + -1) < '5') {
		if (psVar1 <= psVar7) {
			do {
				if (*(char *)psVar7 != '0') break;
				psVar7 = (short *)((int)psVar7 + -1);
			} while (psVar1 <= psVar7);
			if (psVar1 <= psVar7) goto LAB_0049a7d6;
		}
		*(char *)psVar1 = '0';
		*param_6 = 0;
		*(undefined *)(param_6 + 1) = 0x20;
		*(undefined *)((int)param_6 + 3) = 1;
		*(undefined *)((int)param_6 + 5) = 0;
		return 1;
	}
	if (psVar1 <= psVar7) {
		do {
			if (*(char *)psVar7 != '9') break;
			*(char *)psVar7 = '0';
			psVar7 = (short *)((int)psVar7 + -1);
		} while (psVar1 <= psVar7);
		if (psVar1 <= psVar7) {
			*(char *)psVar7 = *(char *)psVar7 + '\x01';
			goto LAB_0049a7d6;
		}
	}
	psVar7 = (short *)((int)psVar7 + 1);
	*param_6 = *param_6 + 1;
	*(char *)psVar7 = *(char *)psVar7 + '\x01';
LAB_0049a7d6:
	cVar3 = ((char)psVar7 - (char)param_6) + -3;
	*(char *)((int)param_6 + 3) = cVar3;
	*(undefined *)((int)param_6 + cVar3 + 4) = 0;
	return 1;
}



void __cdecl FUN_0049a800(int *param_1,int *param_2)
{
	ushort uVar1;
	int iVar2;
	ushort uVar3;
	ushort uVar4;
	int iVar5;
	ushort uVar6;
	int *piVar7;
	int *piVar8;
	short *local_20;
	int local_18;
	int local_14;
	int local_10;
	byte local_c;
	undefined uStack11;
	undefined2 uStack10;
	short local_8;
	undefined2 uStack6;
	undefined2 local_4;
	ushort uStack2;
	
	local_14 = 0;
	local_c = 0;
	uStack11 = 0;
	uStack10 = 0;
	local_8 = 0;
	uStack6 = 0;
	uVar3 = *(ushort *)((int)param_2 + 10) & 0x7fff;
	uVar1 = *(ushort *)((int)param_1 + 10) & 0x7fff;
	uVar6 = (*(ushort *)((int)param_2 + 10) ^ *(ushort *)((int)param_1 + 10)) & 0x8000;
	uVar4 = uVar3 + uVar1;
	local_4 = 0;
	uStack2 = 0;
	if (((0x7ffe < uVar1) || (0x7ffe < uVar3)) || (0xbffd < uVar4)) {
		param_1[1] = 0;
		*param_1 = 0;
		param_1[2] = (-(uint)(uVar6 != 0) & 0x80000000) + 0x7fff8000;
		return;
	}
	if (uVar4 < 0x3fc0) {
		param_1[2] = 0;
		param_1[1] = 0;
		*param_1 = 0;
		return;
	}
	if (((uVar1 == 0) && (uVar4 += 1, (param_1[2] & 0x7fffffffU) == 0)) &&
		 ((param_1[1] == 0 && (*param_1 == 0)))) {
		*(undefined2 *)((int)param_1 + 10) = 0;
		return;
	}
	if (((uVar3 == 0) && (uVar4 += 1, (param_2[2] & 0x7fffffffU) == 0)) &&
		 ((param_2[1] == 0 && (*param_2 == 0)))) {
		param_1[2] = 0;
		param_1[1] = 0;
		*param_1 = 0;
		return;
	}
	local_20 = &local_8;
	local_18 = 0;
	iVar5 = 5;
	do {
		if (0 < iVar5) {
			piVar8 = param_2 + 2;
			piVar7 = (int *)(local_18 * 2 + (int)param_1);
			local_10 = iVar5;
			do {
				iVar2 = FUN_0049a270(*(uint *)(local_20 + -2),
														 (uint)*(ushort *)piVar8 * (uint)*(ushort *)piVar7,
														 (uint *)(local_20 + -2));
				if (iVar2 != 0) {
					*local_20 = *local_20 + 1;
				}
				piVar7 = (int *)((int)piVar7 + 2);
				piVar8 = (int *)((int)piVar8 + -2);
				local_10 += -1;
			} while (local_10 != 0);
		}
		local_20 = local_20 + 1;
		local_18 += 1;
		iVar5 += -1;
	} while (0 < iVar5);
	uVar4 += 0xc002;
	while ((0 < (short)uVar4 && ((uStack2 & 0x8000) == 0))) {
		FUN_0049a310((uint *)&local_c);
		uVar4 -= 1;
	}
	if ((short)uVar4 < 1) {
		uVar4 -= 1;
		if ((short)uVar4 < 0) {
			iVar5 = -(int)(short)uVar4;
			uVar4 += (short)iVar5;
			do {
				if ((local_c & 1) != 0) {
					local_14 += 1;
				}
				FUN_0049a340((uint *)&local_c);
				iVar5 += -1;
			} while (iVar5 != 0);
		}
		if (local_14 != 0) {
			local_c |= 1;
		}
	}
	if ((0x8000 < CONCAT11(uStack11,local_c)) ||
		 ((CONCAT22(uStack10,CONCAT11(uStack11,local_c)) & 0x1ffff) == 0x18000)) {
		if (CONCAT22(local_8,uStack10) == -1) {
			uStack10 = 0;
			local_8 = 0;
			if (CONCAT22(local_4,uStack6) == -1) {
				uStack6 = 0;
				local_4 = 0;
				if (uStack2 == 0xffff) {
					uStack2 = 0x8000;
					uVar4 += 1;
				}
				else {
					uStack2 += 1;
				}
			}
			else {
				iVar5 = CONCAT22(local_4,uStack6) + 1;
				uStack6 = (undefined2)iVar5;
				local_4 = (undefined2)((uint)iVar5 >> 0x10);
			}
		}
		else {
			iVar5 = CONCAT22(local_8,uStack10) + 1;
			uStack10 = (undefined2)iVar5;
			local_8 = (short)((uint)iVar5 >> 0x10);
		}
	}
	if (0x7ffe < uVar4) {
		param_1[1] = 0;
		*param_1 = 0;
		param_1[2] = (-(uint)(uVar6 != 0) & 0x80000000) + 0x7fff8000;
		return;
	}
	*(undefined2 *)param_1 = uStack10;
	*(uint *)((int)param_1 + 2) = CONCAT22(uStack6,local_8);
	*(uint *)((int)param_1 + 6) = CONCAT22(uStack2,local_4);
	*(ushort *)((int)param_1 + 10) = uVar4 | uVar6;
	return;
}



void __cdecl FUN_0049aac0(int *param_1,uint param_2,int param_3)
{
	uint uVar1;
	int iVar2;
	int *piVar3;
	int iVar4;
	undefined2 local_c;
	undefined2 uStack10;
	undefined2 local_8;
	undefined2 uStack6;
	int local_4;
	
	iVar4 = 0x4b39b8;
	if (param_2 != 0) {
		if ((int)param_2 < 0) {
			param_2 = -param_2;
			iVar4 = 0x4b3b18;
		}
		if (param_3 == 0) {
			*(undefined2 *)param_1 = 0;
		}
		while (param_2 != 0) {
			iVar4 += 0x54;
			uVar1 = param_2 & 7;
			param_2 = (int)param_2 >> 3;
			if (uVar1 != 0) {
				piVar3 = (int *)(iVar4 + uVar1 * 0xc);
				if (0x7fff < *(ushort *)(iVar4 + uVar1 * 0xc)) {
					local_c = (undefined2)*piVar3;
					uStack10 = (undefined2)((uint)*piVar3 >> 0x10);
					local_8 = (undefined2)piVar3[1];
					uStack6 = (undefined2)((uint)piVar3[1] >> 0x10);
					local_4 = piVar3[2];
					iVar2 = CONCAT22(local_8,uStack10) + -1;
					uStack10 = (undefined2)iVar2;
					local_8 = (undefined2)((uint)iVar2 >> 0x10);
					piVar3 = (int *)&local_c;
				}
				FUN_0049a800(param_1,piVar3);
			}
		}
	}
	return;
}



// WARNING: Function: _alloca4k replaced with injection: alloca_probe

int FUN_0049ab50(byte param_1)
{
	DWORD DVar1;
	DWORD DVar2;
	char *pcVar3;
	int iVar4;
	HANDLE hFile;
	BOOL BVar5;
	int iVar6;
	int iVar7;
	char *pcVar8;
	undefined4 *puVar9;
	undefined3 in_stack_00000005;
	int in_stack_00000008;
	undefined4 auStack4096 [1023];
	undefined4 uStack4;
	
	uStack4 = 0x49ab5a;
	iVar7 = 0;
	if ((_param_1 < DAT_0076eec0) &&
		 ((*(byte *)((&DAT_0076edc0)[(int)_param_1 >> 5] + 4 + (param_1 & 0x1f) * 8) & 1) != 0)) {
		DVar1 = FUN_00496ec0(_param_1,0,1);
		if ((DVar1 != 0xffffffff) && (DVar2 = FUN_00496ec0(_param_1,0,2), DVar2 != 0xffffffff)) {
			pcVar8 = (char *)(in_stack_00000008 - DVar2);
			if ((int)pcVar8 < 1) {
				if ((int)pcVar8 < 0) {
					FUN_00496ec0(_param_1,in_stack_00000008,0);
					hFile = (HANDLE)FUN_004994b0(_param_1);
					BVar5 = SetEndOfFile(hFile);
					iVar7 = (BVar5 != 0) - 1;
					if (iVar7 == -1) {
						std::globals::g_msvc_errno = 0xd;
						std::globals::g_msvc_doserrno = GetLastError();
					}
				}
				FUN_00496ec0(_param_1,DVar1,0);
				return iVar7;
			}
			puVar9 = auStack4096;
			for (iVar6 = 0x400; iVar6 != 0; iVar6 += -1) {
				*puVar9 = 0;
				puVar9 = puVar9 + 1;
			}
			iVar6 = FUN_0049b160(_param_1,0x8000);
			while( true ) {
				pcVar3 = (char *)0x1000;
				if ((int)pcVar8 < 0x1000) {
					pcVar3 = pcVar8;
				}
				iVar4 = std::__fdwrite__00496f80(_param_1,(char *)auStack4096,pcVar3);
				if (iVar4 == -1) break;
				pcVar8 = pcVar8 + -iVar4;
				if ((int)pcVar8 < 1) {
LAB_0049ac31:
					FUN_0049b160(_param_1,iVar6);
					FUN_00496ec0(_param_1,DVar1,0);
					return iVar7;
				}
			}
			if (std::globals::g_msvc_doserrno == 5) {
				std::globals::g_msvc_errno = 0xd;
			}
			iVar7 = -1;
			goto LAB_0049ac31;
		}
	}
	else {
		std::globals::g_msvc_errno = 9;
	}
	return -1;
}



undefined4 __cdecl FUN_0049acd0(int param_1)
{
	int iVar1;
	int iVar2;
	undefined *puVar3;
	undefined4 *puVar4;
	int iVar5;
	code *pcVar6;
	int iVar7;
	code **ppcVar8;
	
	iVar2 = param_1;
	if (false) {
switchD_0049acec_caseD_3:
		return 0xffffffff;
	}
	switch(param_1) {
	case 2:
		ppcVar8 = &DAT_0054a4f8;
		pcVar6 = DAT_0054a4f8;
		break;
	default:
		goto switchD_0049acec_caseD_3;
	case 4:
	case 8:
	case 0xb:
		puVar3 = FUN_0049ae50(param_1);
		ppcVar8 = (code **)(puVar3 + 8);
		pcVar6 = *ppcVar8;
		break;
	case 0xf:
		ppcVar8 = &DAT_0054a504;
		pcVar6 = DAT_0054a504;
		break;
	case 0x15:
		ppcVar8 = &DAT_0054a4fc;
		pcVar6 = DAT_0054a4fc;
		break;
	case 0x16:
		ppcVar8 = &DAT_0054a500;
		pcVar6 = DAT_0054a500;
	}
	if (pcVar6 == (code *)0x1) {
		return 0;
	}
	if (pcVar6 == NULL) {
		std::quick_exit(3);
	}
	iVar1 = DAT_0054a1a4;
	iVar5 = DAT_004b332c;
	if (((param_1 == 8) || (param_1 == 0xb)) || (iVar7 = param_1, param_1 == 4)) {
		DAT_0054a1a4 = 0;
		iVar7 = iVar1;
		if (param_1 == 8) {
			DAT_004b332c = 0x8c;
			param_1 = iVar5;
			goto LAB_0049ad8f;
		}
	}
	else {
LAB_0049ad8f:
		if (iVar2 == 8) {
			if (DAT_004b3320 < DAT_004b3324 + DAT_004b3320) {
				iVar5 = (DAT_004b3324 + DAT_004b3320) - DAT_004b3320;
				puVar4 = (undefined4 *)(DAT_004b3320 * 0xc + 0x4b32b0);
				do {
					*puVar4 = 0;
					puVar4 = puVar4 + 3;
					iVar5 += -1;
				} while (iVar5 != 0);
			}
			goto LAB_0049adc6;
		}
	}
	*ppcVar8 = NULL;
LAB_0049adc6:
	if (iVar2 == 8) {
		(*pcVar6)(8,DAT_004b332c);
	}
	else {
		(*pcVar6)(iVar2);
		if ((iVar2 != 0xb) && (iVar2 != 4)) {
			return 0;
		}
	}
	if (iVar2 == 8) {
		DAT_004b332c = param_1;
	}
	DAT_0054a1a4 = iVar7;
	return 0;
}



undefined * __cdecl FUN_0049ae50(int param_1)
{
	int *piVar1;
	undefined *puVar2;
	undefined *puVar3;
	
	puVar2 = &DAT_004b32a8;
	if (DAT_004b32ac != param_1) {
		puVar3 = puVar2;
		do {
			puVar2 = puVar3 + 0xc;
			if (&DAT_004b32a8 + DAT_004b3328 * 0xc <= puVar2) break;
			piVar1 = (int *)(puVar3 + 0x10);
			puVar3 = puVar2;
		} while (*piVar1 != param_1);
	}
	if ((&DAT_004b32a8 + DAT_004b3328 * 0xc <= puVar2) || (*(int *)(puVar2 + 4) != param_1)) {
		puVar2 = NULL;
	}
	return puVar2;
}



uint __cdecl FUN_0049aea0(LPSTR param_1,ushort *param_2,uint param_3)
{
	char cVar1;
	uint uVar2;
	uint uVar3;
	DWORD DVar4;
	int iVar5;
	int iVar6;
	ushort *lpWideCharStr;
	int local_4;
	
	uVar3 = param_3;
	lpWideCharStr = param_2;
	uVar2 = 0;
	local_4 = 0;
	if ((param_1 != NULL) && (param_3 == 0)) {
		return uVar2;
	}
	if (param_1 == NULL) {
		if (DAT_0054a180 == 0) {
			uVar3 = FUN_004999d0((short *)param_2);
			return uVar3;
		}
		iVar5 = WideCharToMultiByte(DAT_0054a190,0x220,(LPCWSTR)param_2,-1,NULL,0,NULL,&local_4);
		if ((iVar5 != 0) && (local_4 == 0)) {
			return iVar5 - 1;
		}
	}
	else {
		if (DAT_0054a180 == 0) {
			if (param_3 == 0) {
				return 0;
			}
			while (*param_2 < 0x100) {
				param_1[uVar2] = *(CHAR *)param_2;
				if (*param_2 == 0) {
					return uVar2;
				}
				uVar2 += 1;
				param_2 = param_2 + 1;
				if (param_3 <= uVar2) {
					return uVar2;
				}
			}
		}
		else {
			if (std::globals::g_CharWidth_1__004b0f74 == 1) {
				if (param_3 != 0) {
					uVar3 = FUN_0049b090((short *)param_2,param_3);
				}
				uVar3 = WideCharToMultiByte(DAT_0054a190,0x220,(LPCWSTR)lpWideCharStr,uVar3,param_1,uVar3,
																		NULL,&local_4);
				if ((uVar3 != 0) && (local_4 == 0)) {
					if (param_1[uVar3 - 1] == '\0') {
						return uVar3 - 1;
					}
					return uVar3;
				}
			}
			else {
				uVar2 = WideCharToMultiByte(DAT_0054a190,0x220,(LPCWSTR)param_2,-1,param_1,param_3,NULL,
																		&local_4);
				if (uVar2 == 0) {
					if ((local_4 == 0) && (DVar4 = GetLastError(), DVar4 == 0x7a)) {
						if (uVar3 != 0) {
							do {
								iVar5 = WideCharToMultiByte(DAT_0054a190,0,(LPCWSTR)lpWideCharStr,1,(LPSTR)&param_2,
																						std::globals::g_CharWidth_1__004b0f74,NULL,&local_4);
								if (iVar5 == 0) {
									std::globals::g_msvc_errno = 0x2a;
									return 0xffffffff;
								}
								if (local_4 != 0) {
									std::globals::g_msvc_errno = 0x2a;
									return 0xffffffff;
								}
								if (uVar3 < iVar5 + uVar2) {
									return uVar2;
								}
								iVar6 = 0;
								if (0 < iVar5) {
									do {
										cVar1 = *(char *)((int)&param_2 + iVar6);
										param_1[uVar2] = cVar1;
										if (cVar1 == '\0') {
											return uVar2;
										}
										iVar6 += 1;
										uVar2 += 1;
									} while (iVar6 < iVar5);
								}
								lpWideCharStr = lpWideCharStr + 1;
							} while (uVar2 < uVar3);
						}
						return uVar2;
					}
				}
				else {
					if (local_4 == 0) {
						return uVar2 - 1;
					}
				}
			}
		}
	}
	std::globals::g_msvc_errno = 0x2a;
	return 0xffffffff;
}



int __cdecl FUN_0049b090(short *param_1,int param_2)
{
	short *psVar1;
	int iVar2;
	
	psVar1 = param_1;
	iVar2 = param_2;
	if (param_2 != 0) {
		do {
			if (*psVar1 == 0) break;
			psVar1 = psVar1 + 1;
			iVar2 += -1;
		} while (iVar2 != 0);
		if ((iVar2 != 0) && (*psVar1 == 0)) {
			return ((int)((int)psVar1 - (int)param_1) >> 1) + 1;
		}
	}
	return param_2;
}



byte * __cdecl FUN_0049b0d0(byte *param_1)
{
	byte bVar1;
	LPCWSTR pWVar2;
	LPWSTR pWVar3;
	uint uVar4;
	LPWSTR pWVar5;
	uint uVar6;
	byte *pbVar7;
	byte **ppbVar8;
	byte *pbVar9;
	
	if (((DAT_0054a0f8 != NULL) ||
			(((DAT_0054a100 == 0 || (pWVar2 = FUN_0049b220(), pWVar2 == NULL)) && (DAT_0054a0f8 != NULL)))
			) && (param_1 != NULL)) {
		uVar4 = 0xffffffff;
		pbVar7 = *DAT_0054a0f8;
		pbVar9 = param_1;
		do {
			if (uVar4 == 0) break;
			uVar4 -= 1;
			bVar1 = *pbVar9;
			pbVar9 = pbVar9 + 1;
		} while (bVar1 != 0);
		pWVar5 = (LPWSTR)(~uVar4 - 1);
		ppbVar8 = DAT_0054a0f8;
		if (pbVar7 != NULL) {
			do {
				uVar6 = 0xffffffff;
				pbVar9 = pbVar7;
				do {
					if (uVar6 == 0) break;
					uVar6 -= 1;
					bVar1 = *pbVar9;
					pbVar9 = pbVar9 + 1;
				} while (bVar1 != 0);
				if (((pWVar5 < (LPWSTR)(~uVar6 - 1)) && (*(char *)((int)pWVar5 + (int)pbVar7) == '=')) &&
					 (pWVar3 = FUN_0049b1e0(pbVar7,param_1,pWVar5), pWVar3 == NULL)) {
					return *ppbVar8 + ~uVar4;
				}
				pbVar7 = ppbVar8[1];
				ppbVar8 = ppbVar8 + 1;
				if (pbVar7 == NULL) {
					return NULL;
				}
			} while( true );
		}
	}
	return NULL;
}



int __cdecl FUN_0049b160(uint param_1,int param_2)
{
	byte bVar1;
	byte bVar2;
	
	if (param_1 < DAT_0076eec0) {
		bVar1 = *(byte *)((&DAT_0076edc0)[(int)param_1 >> 5] + 4 + (param_1 & 0x1f) * 8);
		if ((bVar1 & 1) != 0) {
			if (param_2 == 0x8000) {
				bVar2 = bVar1 & 0x7f;
			}
			else {
				if (param_2 != 0x4000) {
					std::globals::g_msvc_errno = 0x16;
					return -1;
				}
				bVar2 = bVar1 | 0x80;
			}
			*(byte *)((&DAT_0076edc0)[(int)param_1 >> 5] + 4 + (param_1 & 0x1f) * 8) = bVar2;
			return (-(uint)((bVar1 & 0x80) != 0) & 0xffffc000) + 0x8000;
		}
	}
	std::globals::g_msvc_errno = 9;
	return -1;
}



LPWSTR __cdecl FUN_0049b1e0(byte *param_1,byte *param_2,LPWSTR param_3)
{
	int iVar1;
	
	if (param_3 == NULL) {
		return param_3;
	}
	iVar1 = FUN_0049b2a0(DAT_0054a3c0,1,param_1,param_3,param_2,(char *)param_3,DAT_0054a3bc);
	if (iVar1 == 0) {
		return (LPWSTR)0x7fffffff;
	}
	return (LPWSTR)(iVar1 + -2);
}



LPCWSTR FUN_0049b220(void)
{
	LPCWSTR lpWideCharStr;
	uint length;
	uint *lpMultiByteStr;
	int iVar1;
	LPCWSTR *ppWVar2;
	
	lpWideCharStr = *DAT_0054a100;
	ppWVar2 = DAT_0054a100;
	if (lpWideCharStr == NULL) {
		return NULL;
	}
	while (((length = WideCharToMultiByte(1,0,lpWideCharStr,-1,NULL,0,NULL,NULL), length != 0 &&
					(lpMultiByteStr = (uint *)std::malloc(length), lpMultiByteStr != NULL)) &&
				 (iVar1 = WideCharToMultiByte(1,0,*ppWVar2,-1,(LPSTR)lpMultiByteStr,length,NULL,NULL),
				 iVar1 != 0))) {
		FUN_0049b570(lpMultiByteStr,0);
		lpWideCharStr = ppWVar2[1];
		ppWVar2 = ppWVar2 + 1;
		if (lpWideCharStr == NULL) {
			return lpWideCharStr;
		}
	}
	return (LPCWSTR)0xffffffff;
}



int __cdecl
FUN_0049b2a0(LCID param_1,DWORD param_2,byte *param_3,LPWSTR param_4,byte *param_5,char *param_6,
						UINT param_7)
{
	int iVar1;
	LPWSTR cbMultiByte;
	BOOL BVar2;
	byte *pbVar3;
	PCNZWCH lpWideCharStr;
	int iVar4;
	int iVar5;
	int local_18;
	_cpinfo local_14;
	
	if (DAT_0054a510 == 0) {
		iVar1 = CompareStringA(0,0,(PCNZCH)&lpSrcStr_0049fd38,1,(PCNZCH)&lpSrcStr_0049fd38,1);
		if (iVar1 == 0) {
			iVar1 = CompareStringW(0,0,(PCNZWCH)&lpSrcStr_0049fd3c,1,(PCNZWCH)&lpSrcStr_0049fd3c,1);
			if (iVar1 == 0) {
				return 0;
			}
			DAT_0054a510 = 1;
		}
		else {
			DAT_0054a510 = 2;
		}
	}
	cbMultiByte = param_4;
	if (0 < (int)param_4) {
		cbMultiByte = (LPWSTR)FUN_00494180((char *)param_3,(int)param_4);
	}
	if (0 < (int)param_6) {
		param_6 = FUN_00494180((char *)param_5,(int)param_6);
	}
	if (DAT_0054a510 == 2) {
		iVar1 = CompareStringA(param_1,param_2,(PCNZCH)param_3,(int)cbMultiByte,(PCNZCH)param_5,
													 (int)param_6);
		return iVar1;
	}
	local_18 = DAT_0054a510;
	if (DAT_0054a510 == 1) {
		local_18 = 0;
		param_4 = NULL;
		if (param_7 == 0) {
			param_7 = DAT_0054a190;
		}
		if ((cbMultiByte == NULL) || (param_6 == NULL)) {
			if (cbMultiByte == (LPWSTR)param_6) {
				return 2;
			}
			if (1 < (int)param_6) {
				return 1;
			}
			if (1 < (int)cbMultiByte) {
				return 3;
			}
			BVar2 = GetCPInfo(param_7,(LPCPINFO)&local_14);
			if (BVar2 == 0) {
				return 0;
			}
			if (0 < (int)cbMultiByte) {
				if (local_14.MaxCharSize < 2) {
					return 3;
				}
				pbVar3 = local_14.LeadByte;
				while( true ) {
					if ((local_14.LeadByte[0] == 0) || (pbVar3[1] == 0)) {
						return 3;
					}
					if ((*pbVar3 <= *param_3) && (*param_3 <= pbVar3[1])) break;
					local_14.LeadByte[0] = pbVar3[2];
					pbVar3 = pbVar3 + 2;
				}
				return 2;
			}
			if (0 < (int)param_6) {
				if (local_14.MaxCharSize < 2) {
					return 1;
				}
				pbVar3 = local_14.LeadByte;
				while( true ) {
					if ((local_14.LeadByte[0] == 0) || (pbVar3[1] == 0)) {
						return 1;
					}
					if ((*pbVar3 <= *param_5) && (*param_5 <= pbVar3[1])) break;
					local_14.LeadByte[0] = pbVar3[2];
					pbVar3 = pbVar3 + 2;
				}
				return 2;
			}
		}
		iVar1 = MultiByteToWideChar(param_7,9,(LPCSTR)param_3,(int)cbMultiByte,NULL,0);
		if (iVar1 == 0) {
			return 0;
		}
		lpWideCharStr = (PCNZWCH)std::malloc(iVar1 * 2);
		if (lpWideCharStr == NULL) {
			return 0;
		}
		iVar4 = MultiByteToWideChar(param_7,1,(LPCSTR)param_3,(int)cbMultiByte,lpWideCharStr,iVar1);
		if ((((iVar4 != 0) &&
				 (iVar4 = MultiByteToWideChar(param_7,9,(LPCSTR)param_5,(int)param_6,NULL,0), iVar4 != 0))
				&& (param_4 = (LPWSTR)std::malloc(iVar4 * 2), param_4 != NULL)) &&
			 (iVar5 = MultiByteToWideChar(param_7,1,(LPCSTR)param_5,(int)param_6,param_4,iVar4),
			 iVar5 != 0)) {
			local_18 = CompareStringW(param_1,param_2,lpWideCharStr,iVar1,param_4,iVar4);
		}
		std::free(lpWideCharStr);
		std::free(param_4);
	}
	return local_18;
}



undefined4 __cdecl FUN_0049b570(uint *param_1,int param_2)
{
	char cVar1;
	uint *puVar2;
	LPCWSTR pWVar3;
	int iVar4;
	LwoFrame *pLVar5;
	uint *puVar6;
	uint uVar7;
	uint uVar8;
	uint *puVar9;
	uint *puVar10;
	bool bVar11;
	
	if (param_1 == NULL) {
		return 0xffffffff;
	}
	puVar2 = FUN_0049b870(param_1,0x3d);
	if (puVar2 == NULL) {
		return 0xffffffff;
	}
	if (param_1 == puVar2) {
		return 0xffffffff;
	}
	bVar11 = *(char *)((int)puVar2 + 1) == '\0';
	if (DAT_0054a0f8 == DAT_0054a0fc) {
		DAT_0054a0f8 = (LwoFrame *)FUN_0049b800((char **)DAT_0054a0f8);
	}
	if (DAT_0054a0f8 == NULL) {
		if ((param_2 == 0) || (DAT_0054a100 == NULL)) {
			if (bVar11) {
				return 0;
			}
			DAT_0054a0f8 = (LwoFrame *)std::malloc(4);
			if (DAT_0054a0f8 == NULL) {
				return 0xffffffff;
			}
			DAT_0054a0f8->dwSize = 0;
			if (DAT_0054a100 == NULL) {
				DAT_0054a100 = (undefined4 *)std::malloc(4);
				if (DAT_0054a100 == NULL) {
					return 0xffffffff;
				}
				*DAT_0054a100 = 0;
			}
		}
		else {
			pWVar3 = FUN_0049b220();
			if (pWVar3 != NULL) {
				return 0xffffffff;
			}
		}
	}
	pLVar5 = DAT_0054a0f8;
	puVar2 = (uint *)((int)puVar2 - (int)param_1);
	iVar4 = FUN_0049b780((byte *)param_1,(LPWSTR)puVar2);
	if ((iVar4 < 0) || (pLVar5->dwSize == 0)) {
		if (bVar11) {
			return 0;
		}
		if (iVar4 < 0) {
			iVar4 = -iVar4;
		}
		pLVar5 = (LwoFrame *)FUN_0048df40(pLVar5,iVar4 * 4 + 8);
		if (pLVar5 == NULL) {
			return 0xffffffff;
		}
		(&pLVar5->dwSize)[iVar4] = (uint)param_1;
		*(undefined4 *)(&pLVar5->field_0x4 + iVar4 * 4) = 0;
		DAT_0054a0f8 = pLVar5;
	}
	else {
		if (bVar11) {
			std::free((void *)(&pLVar5->dwSize)[iVar4]);
			uVar7 = (&pLVar5->dwSize)[iVar4];
			puVar6 = &pLVar5->dwSize + iVar4;
			while (uVar7 != 0) {
				*puVar6 = puVar6[1];
				iVar4 += 1;
				uVar7 = puVar6[1];
				puVar6 = puVar6 + 1;
			}
			pLVar5 = (LwoFrame *)FUN_0048df40(pLVar5,iVar4 * 4);
			if (pLVar5 != NULL) {
				DAT_0054a0f8 = pLVar5;
			}
		}
		else {
			(&pLVar5->dwSize)[iVar4] = (uint)param_1;
		}
	}
	if (param_2 != 0) {
		uVar7 = 0xffffffff;
		puVar6 = param_1;
		do {
			if (uVar7 == 0) break;
			uVar7 -= 1;
			cVar1 = *(char *)puVar6;
			puVar6 = (uint *)((int)puVar6 + 1);
		} while (cVar1 != '\0');
		puVar6 = (uint *)std::malloc(~uVar7 + 1);
		if (puVar6 != NULL) {
			uVar7 = 0xffffffff;
			do {
				puVar9 = param_1;
				if (uVar7 == 0) break;
				uVar7 -= 1;
				puVar9 = (uint *)((int)param_1 + 1);
				cVar1 = *(char *)param_1;
				param_1 = puVar9;
			} while (cVar1 != '\0');
			uVar7 = ~uVar7;
			puVar9 = (uint *)((int)puVar9 - uVar7);
			puVar10 = puVar6;
			for (uVar8 = uVar7 >> 2; uVar8 != 0; uVar8 -= 1) {
				*puVar10 = *puVar9;
				puVar9 = puVar9 + 1;
				puVar10 = puVar10 + 1;
			}
			for (uVar7 &= 3; uVar7 != 0; uVar7 -= 1) {
				*(undefined *)puVar10 = *(undefined *)puVar9;
				puVar9 = (uint *)((int)puVar9 + 1);
				puVar10 = (uint *)((int)puVar10 + 1);
			}
			*(undefined *)((int)puVar6 + (int)puVar2) = 0;
			SetEnvironmentVariableA
								((LPCSTR)puVar6,(LPCSTR)(~-(uint)bVar11 & (int)puVar6 + 1 + (int)puVar2));
			std::free(puVar6);
			return 0;
		}
	}
	return 0;
}



int __cdecl FUN_0049b780(byte *param_1,LPWSTR param_2)
{
	byte *pbVar1;
	LPWSTR pWVar2;
	byte **ppbVar3;
	
	pbVar1 = *DAT_0054a0f8;
	ppbVar3 = DAT_0054a0f8;
	if (pbVar1 == NULL) {
		return 0;
	}
	while ((pWVar2 = FUN_0049b1e0(param_1,pbVar1,param_2), pWVar2 != NULL ||
				 (((*ppbVar3)[(int)param_2] != 0x3d && ((*ppbVar3)[(int)param_2] != 0))))) {
		pbVar1 = ppbVar3[1];
		ppbVar3 = ppbVar3 + 1;
		if (pbVar1 == NULL) {
			return -((int)((int)ppbVar3 - (int)DAT_0054a0f8) >> 2);
		}
	}
	return (int)((int)ppbVar3 - (int)DAT_0054a0f8) >> 2;
}



undefined4 * __cdecl FUN_0049b800(char **param_1)
{
	char *pcVar1;
	char **ppcVar2;
	undefined4 *puVar3;
	undefined4 *puVar4;
	int iVar5;
	undefined4 *puVar6;
	
	iVar5 = 0;
	if (param_1 != NULL) {
		pcVar1 = *param_1;
		ppcVar2 = param_1;
		while (pcVar1 != NULL) {
			ppcVar2 = ppcVar2 + 1;
			iVar5 += 1;
			pcVar1 = *ppcVar2;
		}
		puVar3 = (undefined4 *)std::malloc(iVar5 * 4 + 4);
		if (puVar3 == NULL) {
			__amsg_exit(9);
		}
		pcVar1 = *param_1;
		puVar6 = puVar3;
		while (pcVar1 != NULL) {
			param_1 = param_1 + 1;
			puVar4 = FUN_0049b920(pcVar1);
			*puVar6 = puVar4;
			puVar6 = puVar6 + 1;
			pcVar1 = *param_1;
		}
		*puVar6 = 0;
		return puVar3;
	}
	return NULL;
}



uint * __cdecl FUN_0049b870(uint *param_1,uint param_2)
{
	uint *puVar1;
	uint uVar2;
	
	if (DAT_0054a3bc == 0) {
		puVar1 = FUN_00491760(param_1,(char)param_2);
		return puVar1;
	}
	uVar2 = (uint)*(byte *)param_1;
	if (*(byte *)param_1 == 0) {
LAB_0049b907:
		return (uint *)((param_2 != uVar2) - 1 & (uint)param_1);
	}
	do {
		if ((*(byte *)((int)&DAT_0054a2b8 + uVar2 + 1) & 4) == 0) {
			puVar1 = param_1;
			if (param_2 == uVar2) goto LAB_0049b907;
		}
		else {
			puVar1 = (uint *)((int)param_1 + 1);
			if (*(byte *)((int)param_1 + 1) == 0) {
				return NULL;
			}
			if (param_2 == (uVar2 << 8 | (uint)*(byte *)((int)param_1 + 1))) {
				return param_1;
			}
		}
		uVar2 = (uint)*(byte *)((int)puVar1 + 1);
		param_1 = (uint *)((int)puVar1 + 1);
		if (*(byte *)((int)puVar1 + 1) == 0) {
			return (uint *)((param_2 != uVar2) - 1 & (uint)param_1);
		}
	} while( true );
}



undefined4 * __cdecl FUN_0049b920(char *param_1)
{
	char cVar1;
	undefined4 *puVar2;
	uint uVar3;
	uint uVar4;
	undefined4 *puVar5;
	char *pcVar6;
	undefined4 *puVar7;
	
	if (param_1 != NULL) {
		uVar3 = 0xffffffff;
		pcVar6 = param_1;
		do {
			if (uVar3 == 0) break;
			uVar3 -= 1;
			cVar1 = *pcVar6;
			pcVar6 = pcVar6 + 1;
		} while (cVar1 != '\0');
		puVar2 = (undefined4 *)std::malloc(~uVar3);
		if (puVar2 != NULL) {
			uVar3 = 0xffffffff;
			do {
				pcVar6 = param_1;
				if (uVar3 == 0) break;
				uVar3 -= 1;
				pcVar6 = param_1 + 1;
				cVar1 = *param_1;
				param_1 = pcVar6;
			} while (cVar1 != '\0');
			uVar3 = ~uVar3;
			puVar5 = (undefined4 *)(pcVar6 + -uVar3);
			puVar7 = puVar2;
			for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 -= 1) {
				*puVar7 = *puVar5;
				puVar5 = puVar5 + 1;
				puVar7 = puVar7 + 1;
			}
			for (uVar3 &= 3; uVar3 != 0; uVar3 -= 1) {
				*(undefined *)puVar7 = *(undefined *)puVar5;
				puVar5 = (undefined4 *)((int)puVar5 + 1);
				puVar7 = (undefined4 *)((int)puVar7 + 1);
			}
			return puVar2;
		}
	}
	return NULL;
}



HRESULT Direct3DRMCreate(IUnknown **lplpIDirect3DRM)
{
	HRESULT HVar1;
	
										// WARNING: Could not recover jumptable at 0x0049b970. Too many branches
										// WARNING: Treating indirect jump as call
	HVar1 = Direct3DRMCreate(lplpIDirect3DRM);
	return HVar1;
}



Vector3F * D3DRMVectorRandom(Vector3F *d)
{
	Vector3F *pVVar1;
	
										// WARNING: Could not recover jumptable at 0x0049b976. Too many branches
										// WARNING: Treating indirect jump as call
	pVVar1 = D3DRMVectorRandom(d);
	return pVVar1;
}



Vector3F * D3DRMVectorRotate(Vector3F *r,Vector3F *v,Vector3F *axis,float theta)
{
	Vector3F *pVVar1;
	
										// WARNING: Could not recover jumptable at 0x0049b97c. Too many branches
										// WARNING: Treating indirect jump as call
	pVVar1 = D3DRMVectorRotate(r,v,axis,theta);
	return pVVar1;
}



HRESULT DirectDrawEnumerateA(DDENUMCALLBACKA *lpCallback,LPVOID lpContext)
{
	HRESULT HVar1;
	
										// WARNING: Could not recover jumptable at 0x0049b982. Too many branches
										// WARNING: Treating indirect jump as call
	HVar1 = DirectDrawEnumerateA(lpCallback,lpContext);
	return HVar1;
}



HRESULT DirectDrawCreate(LPGUID lpGUID,IUnknown **lplpIDirectDraw,LPUNKNOWN pUnkOuter)
{
	HRESULT HVar1;
	
										// WARNING: Could not recover jumptable at 0x0049b988. Too many branches
										// WARNING: Treating indirect jump as call
	HVar1 = DirectDrawCreate(lpGUID,lplpIDirectDraw,pUnkOuter);
	return HVar1;
}



HRESULT AVIStreamInfoA(IUnknown *pIAVIStream,void *pAVIStreamInfoA,LONG lSize)
{
	HRESULT HVar1;
	
										// WARNING: Could not recover jumptable at 0x0049b98e. Too many branches
										// WARNING: Treating indirect jump as call
	HVar1 = AVIStreamInfoA(pIAVIStream,pAVIStreamInfoA,lSize);
	return HVar1;
}



IUnknown * AVIStreamGetFrameOpen(IUnknown *pIAVIStream,BITMAPINFOHEADER *lpbiWanted)
{
	IUnknown *pIVar1;
	
										// WARNING: Could not recover jumptable at 0x0049b994. Too many branches
										// WARNING: Treating indirect jump as call
	pIVar1 = AVIStreamGetFrameOpen(pIAVIStream,lpbiWanted);
	return pIVar1;
}



HRESULT AVIStreamOpenFromFileA
									(IUnknown **lplpIAVIStream,LPCSTR szFile,DWORD fccType,LONG lParam,UINT mode,
									CLSID *pclsidHandler)
{
	HRESULT HVar1;
	
										// WARNING: Could not recover jumptable at 0x0049b99a. Too many branches
										// WARNING: Treating indirect jump as call
	HVar1 = AVIStreamOpenFromFileA(lplpIAVIStream,szFile,fccType,lParam,mode,pclsidHandler);
	return HVar1;
}



ULONG AVIStreamRelease(IUnknown *pIAVIStream)
{
	ULONG UVar1;
	
										// WARNING: Could not recover jumptable at 0x0049b9a0. Too many branches
										// WARNING: Treating indirect jump as call
	UVar1 = AVIStreamRelease(pIAVIStream);
	return UVar1;
}



LPVOID AVIStreamGetFrame(IUnknown *pIGetFrame,LONG lPos)
{
	LPVOID pvVar1;
	
										// WARNING: Could not recover jumptable at 0x0049b9a6. Too many branches
										// WARNING: Treating indirect jump as call
	pvVar1 = AVIStreamGetFrame(pIGetFrame,lPos);
	return pvVar1;
}



HRESULT DirectInputCreateA(HINSTANCE hInst,DWORD dwVersion,IUnknown **lplpIDirectInput,
													IUnknown *pUnkOuter)
{
	HRESULT HVar1;
	
										// WARNING: Could not recover jumptable at 0x0049ca68. Too many branches
										// WARNING: Treating indirect jump as call
	HVar1 = DirectInputCreateA(hInst,dwVersion,lplpIDirectInput,pUnkOuter);
	return HVar1;
}



HRESULT DirectSoundCreate(LPGUID lpGuid,IDirectSound **lplpIDirectSound,IUnknown *pUnkOuter)
{
	HRESULT HVar1;
	
										// WARNING: Could not recover jumptable at 0x0049ca6e. Too many branches
										// WARNING: Treating indirect jump as call
	HVar1 = DirectSoundCreate(lpGuid,lplpIDirectSound,pUnkOuter);
	return HVar1;
}



void RtlUnwind(PVOID TargetFrame,PVOID TargetIp,PEXCEPTION_RECORD ExceptionRecord,PVOID ReturnValue)
{
										// WARNING: Could not recover jumptable at 0x0049ca74. Too many branches
										// WARNING: Treating indirect jump as call
	RtlUnwind(TargetFrame,TargetIp,ExceptionRecord,ReturnValue);
	return;
}



// RNC (Rob Northern Compression)
// https://moddingwiki.shikadi.net/wiki/Rob_Northern_Compression

uint __cdecl rnc::Rnc_Decompress(byte *srcBuffer,byte **out_dstBuffer)
{
	short sVar1;
	byte *dstBuffer;
	uint uVar2;
	
	uVar2 = *(uint *)(srcBuffer + 4);
	uVar2 = ((uVar2 & 0xff00) + uVar2 * 0x10000) * 0x100 + (uVar2 >> 0x10 & 0xff) * 0x100 +
					(uVar2 >> 0x18);
	if (out_dstBuffer == NULL) {
		return uVar2;
	}
	dstBuffer = (byte *)std::malloc(uVar2);
	if (dstBuffer != NULL) {
		sVar1 = Rnc_Decompress__internal(srcBuffer,dstBuffer);
		if (sVar1 != 0) {
			std::free(dstBuffer);
			return 0;
		}
		*out_dstBuffer = dstBuffer;
		return uVar2;
	}
	return 0;
}



short __cdecl rnc::Rnc_Decompress__internal(byte *srcBuffer,byte *dstBuffer)
{
	byte bVar1;
	short sVar2;
	int iVar3;
	uint uVar4;
	uint uVar5;
	undefined4 *puVar6;
	
	iVar3 = std::strncmp((char *)srcBuffer,const::s_RNC,3);
	if (iVar3 != 0) {
		return -1;
	}
	bVar1 = srcBuffer[3];
	if (bVar1 == 0) {
		uVar5 = *(uint *)(srcBuffer + 4);
		uVar4 = (((uVar5 >> 8 & 0xff) + uVar5 * 0x100) * 0x100 + (uVar5 >> 0x10 & 0xff)) * 0x100 +
						(uVar5 >> 0x18);
		puVar6 = (undefined4 *)(srcBuffer + 0x12);
		for (uVar5 = uVar4 >> 2; uVar5 != 0; uVar5 -= 1) {
			*(undefined4 *)dstBuffer = *puVar6;
			puVar6 = puVar6 + 1;
			dstBuffer = (byte *)((int)dstBuffer + 4);
		}
		for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
			*dstBuffer = *(undefined *)puVar6;
			puVar6 = (undefined4 *)((int)puVar6 + 1);
			dstBuffer = (byte *)((int)dstBuffer + 1);
		}
		return 0;
	}
	if (bVar1 == 1) {
		sVar2 = Rnc_Decompress_Method1(srcBuffer,dstBuffer);
		return sVar2;
	}
	if (bVar1 != 2) {
		return -2;
	}
	sVar2 = Rnc_Decompress_Method2(srcBuffer,dstBuffer);
	return sVar2;
}



short __cdecl rnc::Rnc_Decompress_Method1(byte *srcBuffer,byte *dstBuffer)
{
	uint uVar1;
	uint uVar2;
	int iVar3;
	byte *pbVar4;
	
	Rnc_BitStreamInit(srcBuffer,dstBuffer);
	Rnc_BitStreamAdvance(2);
	if (globals::g_RncOutput < globals::g_RncOutputEnd) {
		do {
			Rnc_ReadHuffmanTable(globals::g_RncHuffmanTable_Raw,0x10);
			Rnc_ReadHuffmanTable(globals::g_RncHuffmanTable_Dst,0x10);
			Rnc_ReadHuffmanTable(globals::g_RncHuffmanTable_Len,0x10);
			uVar1 = Rnc_BitStreamAdvance(0x10);
			while( true ) {
				uVar2 = Rnc_ReadHuffman(globals::g_RncHuffmanTable_Raw);
				if ((short)uVar2 != 0) {
					iVar3 = (uVar2 + 0xffff & 0xffff) + 1;
					do {
						*globals::g_RncOutput = *globals::g_RncInput;
						globals::g_RncOutput = globals::g_RncOutput + 1;
						globals::g_RncInput = globals::g_RncInput + 1;
						iVar3 += -1;
					} while (iVar3 != 0);
				}
				uVar1 += 0xffff;
				globals::g_RncBitBuffer =
						 (((uint)globals::g_RncInput[1] + (uint)globals::g_RncInput[2] * 0x100) * 0x100 +
							(uint)*globals::g_RncInput << (globals::g_RncBitCount & 0x1f)) +
						 ((1 << (globals::g_RncBitCount & 0x1f)) - 1U & globals::g_RncBitBuffer);
				if ((short)uVar1 == 0) break;
				uVar2 = Rnc_ReadHuffman(globals::g_RncHuffmanTable_Dst);
				pbVar4 = globals::g_RncOutput + (-1 - (uVar2 & 0xffff));
				uVar2 = Rnc_ReadHuffman(globals::g_RncHuffmanTable_Len);
				if ((short)uVar2 != -2) {
					iVar3 = (uVar2 + 0x10001 & 0xffff) + 1;
					do {
						*globals::g_RncOutput = *pbVar4;
						globals::g_RncOutput = globals::g_RncOutput + 1;
						pbVar4 = pbVar4 + 1;
						iVar3 += -1;
					} while (iVar3 != 0);
				}
			}
		} while (globals::g_RncOutput < globals::g_RncOutputEnd);
	}
	return 0;
}



short __cdecl rnc::Rnc_Decompress_Method2(byte *srcBuffer,byte *dstBuffer)
{
	short sVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	byte *pbVar5;
	
	Rnc_BitStreamInit(srcBuffer,dstBuffer);
	Rnc_FUN_0049cff0(2);
	if (globals::g_RncOutput < globals::g_RncOutputEnd) {
		do {
			while( true ) {
				while( true ) {
					iVar2 = Rnc_FUN_0049cff0(1);
					sVar1 = (short)iVar2;
					while (sVar1 == 0) {
						*globals::g_RncOutput = *globals::g_RncInput;
						globals::g_RncOutput = globals::g_RncOutput + 1;
						globals::g_RncInput = globals::g_RncInput + 1;
						iVar2 = Rnc_FUN_0049cff0(1);
						sVar1 = (short)iVar2;
					}
					iVar2 = Rnc_FUN_0049cff0(1);
					if ((short)iVar2 != 0) break;
					uVar3 = Rnc_FUN_0049d130();
					if ((short)uVar3 == 9) {
						iVar2 = Rnc_FUN_0049cff0(4);
						if ((short)(iVar2 * 4) != -0xc) {
							iVar2 = (iVar2 * 4 + 0x1000bU & 0xffff) + 1;
							do {
								*globals::g_RncOutput = *globals::g_RncInput;
								globals::g_RncOutput = globals::g_RncOutput + 1;
								globals::g_RncInput = globals::g_RncInput + 1;
								iVar2 += -1;
							} while (iVar2 != 0);
						}
					}
					else {
						uVar4 = Rnc_FUN_0049d170();
						pbVar5 = globals::g_RncOutput + -(uVar4 & 0xffff);
						if ((short)uVar3 != 0) {
							iVar2 = (uVar3 + 0xffff & 0xffff) + 1;
							do {
								*globals::g_RncOutput = *pbVar5;
								globals::g_RncOutput = globals::g_RncOutput + 1;
								pbVar5 = pbVar5 + 1;
								iVar2 += -1;
							} while (iVar2 != 0);
						}
					}
				}
				iVar2 = Rnc_FUN_0049cff0(1);
				if ((short)iVar2 != 0) break;
				sVar1 = 2;
				uVar3 = *globals::g_RncInput + 1;
				globals::g_RncInput = globals::g_RncInput + 1;
LAB_0049ce07:
				pbVar5 = globals::g_RncOutput + -(uVar3 & 0xffff);
				if (sVar1 != 0) {
					iVar2 = (ushort)(sVar1 - 1) + 1;
					do {
						*globals::g_RncOutput = *pbVar5;
						globals::g_RncOutput = globals::g_RncOutput + 1;
						pbVar5 = pbVar5 + 1;
						iVar2 += -1;
					} while (iVar2 != 0);
				}
			}
			iVar2 = Rnc_FUN_0049cff0(1);
			if ((short)iVar2 == 0) {
				sVar1 = 3;
LAB_0049ce02:
				uVar3 = Rnc_FUN_0049d170();
				goto LAB_0049ce07;
			}
			sVar1 = *globals::g_RncInput + 8;
			globals::g_RncInput = globals::g_RncInput + 1;
			if (sVar1 != 8) goto LAB_0049ce02;
			Rnc_FUN_0049cff0(1);
		} while (globals::g_RncOutput < globals::g_RncOutputEnd);
	}
	return 0;
}



byte * __cdecl rnc::Rnc_BitStreamInit(byte *srcBuffer,byte *dstBuffer)
{
	uint uVar1;
	
	uVar1 = *(uint *)(srcBuffer + 4);
	globals::g_RncBitCount = 0;
	globals::g_RncInput = srcBuffer + 0x12;
	globals::g_RncOutput = dstBuffer;
	globals::g_RncOutputEnd =
			 dstBuffer +
			 (uVar1 >> 0x18) +
			 (((uVar1 >> 8 & 0xff) + uVar1 * 0x100) * 0x100 + (uVar1 >> 0x10 & 0xff)) * 0x100;
	return dstBuffer +
				 (uVar1 >> 0x18) +
				 (((uVar1 >> 8 & 0xff) + uVar1 * 0x100) * 0x100 + (uVar1 >> 0x10 & 0xff)) * 0x100;
}



uint __cdecl rnc::Rnc_BitStreamAdvance(byte bits)
{
	uint uVar1;
	int iVar2;
	uint *puVar3;
	uint uVar4;
	
	uVar1 = 0;
	uVar4 = 1;
	_bits = (uint)(byte)(bits - 1);
	if (bits != 0) {
		iVar2 = _bits + 1;
		puVar3 = (uint *)globals::g_RncInput;
		do {
			if (globals::g_RncBitCount == 0) {
				globals::g_RncBitBuffer = *puVar3;
				puVar3 = (uint *)((int)puVar3 + 2);
				globals::g_RncBitCount = 0x10;
				globals::g_RncInput = (byte *)puVar3;
			}
			if ((globals::g_RncBitBuffer & 1) != 0) {
				uVar1 |= uVar4;
			}
			uVar4 <<= 1;
			globals::g_RncBitBuffer >>= 1;
			globals::g_RncBitCount -= 1;
			iVar2 += -1;
		} while (iVar2 != 0);
	}
	return uVar1;
}



int __cdecl rnc::Rnc_FUN_0049cff0(byte bits)
{
	int iVar1;
	byte *pbVar2;
	int iVar3;
	
	iVar1 = 0;
	_bits = (uint)(byte)(bits - 1);
	if (bits != 0) {
		iVar3 = _bits + 1;
		pbVar2 = globals::g_RncInput;
		do {
			if (globals::g_RncBitCount == 0) {
				globals::g_Rnc_BYTE_00559088 = *pbVar2;
				pbVar2 = pbVar2 + 1;
				globals::g_RncBitCount = 8;
				globals::g_RncInput = pbVar2;
			}
			iVar1 *= 2;
			if ((globals::g_Rnc_BYTE_00559088 & 0x80) != 0) {
				iVar1 += 1;
			}
			globals::g_Rnc_BYTE_00559088 <<= 1;
			globals::g_RncBitCount -= 1;
			iVar3 += -1;
		} while (iVar3 != 0);
	}
	return iVar1;
}



void __cdecl rnc::Rnc_ReadHuffmanTable(HuffmanLeaf *table,byte bits)
{
	byte bits_00;
	uint uVar1;
	uint uVar2;
	ushort *puVar3;
	
	Rnc_FUN_0049d210(table,bits);
	uVar1 = Rnc_BitStreamAdvance(5);
	bits_00 = (byte)uVar1;
	if (bits_00 != 0) {
		if (0x10 < bits_00) {
			bits_00 = 0x10;
		}
		if (bits_00 != 0) {
			puVar3 = &table->count_2;
			uVar1 = (uint)bits_00;
			do {
				uVar2 = Rnc_BitStreamAdvance(4);
				*puVar3 = (ushort)uVar2;
				puVar3 = puVar3 + 8;
				uVar1 -= 1;
			} while (uVar1 != 0);
		}
		Rnc_FUN_0049d250(table,bits_00);
	}
	return;
}



uint __cdecl rnc::Rnc_ReadHuffman(HuffmanLeaf *table)
{
	uint uVar1;
	byte bVar2;
	
	bVar2 = 0;
	for (; (table->count_2 == 0 ||
				 (((1 << ((byte)table->count_2 & 0x1f)) - 1U & globals::g_RncBitBuffer) != table->value_2));
			table = table + 1) {
		bVar2 += 1;
	}
	uVar1 = Rnc_BitStreamAdvance(*(byte *)&table->count_2);
	if (bVar2 < 2) {
		return uVar1 & 0xffff0000 | (uint)bVar2;
	}
	uVar1 = Rnc_BitStreamAdvance(bVar2 - 1);
	return uVar1 | 1 << (bVar2 - 1 & 0x1f);
}



uint __cdecl rnc::Rnc_FUN_0049d130(void)
{
	uint uVar1;
	int iVar2;
	uint unaff_ESI;
	uint uVar3;
	
	uVar1 = Rnc_FUN_0049cff0(1);
	uVar3 = (unaff_ESI & 0xffff0000 | uVar1 & 0xffff) + 4;
	uVar1 = Rnc_FUN_0049cff0(1);
	if ((short)uVar1 == 0) {
		return uVar1 & 0xffff0000 | uVar3 & 0xffff;
	}
	iVar2 = Rnc_FUN_0049cff0(1);
	return iVar2 + -2 + uVar3 * 2;
}



int __cdecl rnc::Rnc_FUN_0049d170(void)
{
	byte bVar1;
	int iVar2;
	uint uVar3;
	uint uVar4;
	
	uVar4 = 0;
	iVar2 = Rnc_FUN_0049cff0(1);
	if ((short)iVar2 != 0) {
		uVar4 = Rnc_FUN_0049cff0(1);
		iVar2 = Rnc_FUN_0049cff0(1);
		if ((short)iVar2 == 0) {
			if ((short)uVar4 == 0) {
				uVar3 = Rnc_FUN_0049cff0(1);
				uVar4 = (uVar4 & 0xffff0000 | uVar3 & 0xffff) + 2;
			}
		}
		else {
			iVar2 = Rnc_FUN_0049cff0(1);
			uVar4 = iVar2 + uVar4 * 2 | 4;
			iVar2 = Rnc_FUN_0049cff0(1);
			if ((short)iVar2 == 0) {
				iVar2 = Rnc_FUN_0049cff0(1);
				uVar4 = iVar2 + uVar4 * 2;
			}
		}
	}
	bVar1 = *globals::g_RncInput;
	globals::g_RncInput = globals::g_RncInput + 1;
	return uVar4 * 0x100 + 1 + (uint)bVar1;
}



void __cdecl rnc::Rnc_FUN_0049d210(HuffmanLeaf *table,byte bits)
{
	int iVar1;
	
	_bits = (uint)(byte)(bits - 1);
	if (bits != 0) {
		iVar1 = _bits + 1;
		do {
			table->value_1 = 0;
			table->count_1 = 0xffff;
			table->value_2 = 0;
			table->count_2 = 0;
			table = table + 1;
			iVar1 += -1;
		} while (iVar1 != 0);
	}
	return;
}



void __cdecl rnc::Rnc_FUN_0049d250(HuffmanLeaf *table,byte bits)
{
	uint uVar1;
	ushort uVar2;
	uint uVar3;
	uint *puVar4;
	uint uVar5;
	uint local_4;
	
	uVar2 = 1;
	local_4 = 0;
	uVar3 = 0x80000000;
	do {
		uVar5 = (uint)bits;
		if (bits != 0) {
			puVar4 = &table->value_2;
			do {
				if (*(ushort *)(puVar4 + 1) == uVar2) {
					uVar1 = Rnc_MirrorBits(local_4 / uVar3,(byte)uVar2);
					*puVar4 = uVar1;
					local_4 += uVar3;
				}
				puVar4 = puVar4 + 4;
				uVar5 -= 1;
			} while (uVar5 != 0);
		}
		uVar2 += 1;
		uVar3 >>= 1;
	} while (uVar2 < 0x11);
	return;
}



uint __cdecl rnc::Rnc_MirrorBits(uint value,byte param_2)
{
	uint uVar1;
	int iVar2;
	
	uVar1 = 0;
	_param_2 = (uint)(byte)(param_2 - 1);
	if (param_2 != 0) {
		iVar2 = _param_2 + 1;
		do {
			uVar1 <<= 1;
			if ((value & 1) != 0) {
				uVar1 |= 1;
			}
			value >>= 1;
			iVar2 += -1;
		} while (iVar2 != 0);
	}
	return uVar1;
}



BOOL __cdecl
lego::wnd::Win_ChooseScreenMode
					(BOOL showDialog,BOOL isDebug,BOOL isBest,BOOL isWindow,LPCSTR errorMessage)
{
	bool bVar1;
	BOOL BVar2;
	DeviceModeFlags *pDVar3;
	int iVar4;
	int iVar5;
	uint availableIndex;
	DriverMode *driverMode;
	INT_PTR local_4;
	
	local_4 = 1;
	setup::globals::g_CurrentDriverMode = NULL;
	setup::globals::g_CurrentDeviceMode = NULL;
	setup::globals::g_CurrentScreenMode = NULL;
	setup::globals::g_IsFullScreen_Backup = 1;
	setup::globals::g_IsFullScreen = 1;
	setup::globals::g_RegisteredScreenModes_COUNT = 0;
	setup::Setup_RegisterScreenMode(640,480,0x10);
	if (isDebug != 0) {
		setup::Setup_RegisterScreenMode(800,600,0x10);
		setup::Setup_RegisterScreenMode(1024,768,0x10);
	}
	setup::Dlg_PopulateDriverModes
						(setup::globals::g_DriverModes_TABLE,(uint *)&setup::globals::g_DriverModes_COUNT);
	if (setup::globals::g_DriverModes_COUNT != 0) {
		setup::globals::g_CurrentDriverMode = setup::globals::g_DriverModes_TABLE;
		if (isBest == 0) {
			if (showDialog != 0) {
				local_4 = DialogBoxParamA(globals::wnd::g_hInstance,(LPCSTR)LEGORR_MODESELECTION_DIALOG,
																	globals::wnd::g_hWnd,setup::Setup_ModeDialogProc,0);
			}
		}
		else {
			bVar1 = false;
			iVar5 = setup::globals::g_DriverModes_COUNT + -1;
			local_4 = 1;
			setup::globals::g_IsFullScreen = ZEXT14(isWindow == 0);
			if (-1 < iVar5) {
				driverMode = setup::globals::g_DriverModes_TABLE + iVar5;
LAB_0049d3d2:
				BVar2 = setup::Dlg_PopulateDeviceModes
													(driverMode,setup::globals::g_DeviceModes_TABLE,
													 (uint *)&setup::globals::g_DeviceModes_COUNT);
				if (BVar2 == 0) {
					MessageBoxA(NULL,"Please install DirectX version 6 or later","Error",0);
					return 0;
				}
				setup::Dlg_PopulateScreenModes
									(driverMode,setup::globals::g_IsFullScreen,setup::globals::g_ScreenModes_TABLE,
									 (uint *)&setup::globals::g_ScreenModes_COUNT);
				availableIndex = 0;
				if (setup::globals::g_ScreenModes_COUNT != 0) {
					do {
						BVar2 = setup::Setup_HasRegisteredScreenMode(availableIndex);
						if (BVar2 != 0) {
							iVar4 = setup::globals::g_DeviceModes_COUNT + -1;
							if (-1 < iVar4) {
								pDVar3 = &setup::globals::g_DeviceModes_TABLE[iVar4].flags;
								goto LAB_0049d447;
							}
							break;
						}
						availableIndex += 1;
					} while (availableIndex < (uint)setup::globals::g_ScreenModes_COUNT);
				}
				goto LAB_0049d48f;
			}
LAB_0049d4a8:
			if (!bVar1) {
				MessageBoxA(NULL,errorMessage,"Error",0);
				return 0;
			}
		}
		if (local_4 == 1) {
			if (setup::globals::g_IsFullScreen != 0) {
				BVar2 = main::Main_DirectDrawCreate
													(1,setup::globals::g_CurrentDriverMode,setup::globals::g_CurrentDeviceMode
													 ,setup::globals::g_CurrentScreenMode,0,0,320,200);
				return BVar2;
			}
			if (setup::globals::g_CurrentScreenMode == NULL) {
				BVar2 = main::Main_DirectDrawCreate
													(0,NULL,setup::globals::g_CurrentDeviceMode,NULL,40,40,640,480);
				return BVar2;
			}
			BVar2 = main::Main_DirectDrawCreate
												(0,NULL,setup::globals::g_CurrentDeviceMode,NULL,100,100,
												 setup::globals::g_CurrentScreenMode->screenWidth,
												 setup::globals::g_CurrentScreenMode->screenHeight);
			return BVar2;
		}
	}
	return 0;
	while( true ) {
		iVar4 += -1;
		pDVar3 = pDVar3 + -0x45;
		if (iVar4 < 0) break;
LAB_0049d447:
		if ((*pDVar3 & DEVICEMODE_HARDWARE) != DEVICEMODE_NONE) {
			setup::globals::g_CurrentScreenMode = setup::globals::g_ScreenModes_TABLE + availableIndex;
			bVar1 = true;
			setup::globals::g_CurrentDeviceMode = setup::globals::g_DeviceModes_TABLE + iVar4;
			setup::globals::g_CurrentDriverMode = driverMode;
			break;
		}
	}
LAB_0049d48f:
	if (bVar1) goto LAB_0049d4a8;
	iVar5 += -1;
	driverMode = driverMode + -1;
	if (iVar5 < 0) goto LAB_0049d4a8;
	goto LAB_0049d3d2;
}



INT_PTR lego::wnd::setup::Setup_ModeDialogProc(HWND hDlg,UINT message,WPARAM wParam,LPARAM lParam)
{
	short sVar1;
	HWND pHVar2;
	LRESULT LVar3;
	WPARAM wParam2;
	BOOL BVar4;
	short sVar5;
	uint uVar6;
	int iVar7;
	uint outIndex;
	tagRECT dlgRect;
	tagRECT desktopRect;
	char screenModeText [1024];
	
	if (message == WM_INITDIALOG) {
		pHVar2 = GetDesktopWindow();
		GetWindowRect(pHVar2,(LPRECT)&desktopRect);
		GetWindowRect(hDlg,(LPRECT)&dlgRect);
		MoveWindow(hDlg,desktopRect.right / 2 - (dlgRect.right - dlgRect.left) / 2,
							 desktopRect.bottom / 2 - (dlgRect.bottom - dlgRect.top) / 2,
							 dlgRect.right - dlgRect.left,dlgRect.bottom - dlgRect.top,1);
		if (globals::g_IsFullScreen == 0) {
			iVar7 = LEGORR_ID_WINDOW_RADIOBUTTON;
		}
		else {
			iVar7 = LEGORR_ID_FULLSCREEN_RADIOBUTTON;
		}
		pHVar2 = GetDlgItem(hDlg,iVar7);
		SendMessageA(pHVar2,BM_SETCHECK,BST_CHECKED,0);
		pHVar2 = GetDlgItem(hDlg,LEGORR_ID_DRIVER_LISTBOX);
		uVar6 = 0;
		if (globals::g_DriverModes_COUNT != 0) {
			iVar7 = 0x5590bc;
			do {
				SendMessageA(pHVar2,LB_ADDSTRING,0,iVar7);
				uVar6 += 1;
				iVar7 += 0x114;
			} while (uVar6 < (uint)globals::g_DriverModes_COUNT);
		}
		SendMessageA(pHVar2,LB_SETCURSEL,0,0);
		SetFocus(pHVar2);
		Setup_UpdateRadioButtons(hDlg);
		Setup_RebuildDeviceModes(hDlg);
		Setup_RebuildScreenModes(hDlg);
		return 0;
	}
	if (message != WM_COMMAND) {
		return 0;
	}
	sVar1 = (short)(wParam >> 0x10);
	sVar5 = (short)wParam;
	if (sVar1 == 1) {
		if (sVar5 == LEGORR_ID_DEVICE_LISTBOX) {
			LVar3 = SendMessageA((HWND)lParam,LB_GETCURSEL,0,0);
			globals::g_CurrentDeviceMode = globals::g_DeviceModes_TABLE + LVar3;
			return 1;
		}
		if (sVar5 == LEGORR_ID_SCREENMODES_LISTBOX) {
			wParam2 = SendMessageA((HWND)lParam,LB_GETCURSEL,0,0);
			SendMessageA((HWND)lParam,LB_GETTEXT,wParam2,(LPARAM)screenModeText);
			BVar4 = Setup_GetScreenMode(screenModeText,&outIndex);
			if (BVar4 != 0) {
				globals::g_CurrentScreenMode = globals::g_ScreenModes_TABLE + outIndex;
				return 1;
			}
		}
		else {
			if (sVar5 == LEGORR_ID_DRIVER_LISTBOX) {
				LVar3 = SendMessageA((HWND)lParam,LB_GETCURSEL,0,0);
				globals::g_CurrentDriverMode = globals::g_DriverModes_TABLE + LVar3;
				Setup_UpdateRadioButtons(hDlg);
				Setup_RebuildScreenModes(hDlg);
				Setup_RebuildDeviceModes(hDlg);
				return 1;
			}
		}
	}
	else {
		if (sVar1 == 0) {
			if (sVar5 == LEGORR_ID_WINDOW_RADIOBUTTON) {
				Setup_ChangeFullScreenMode(hDlg,0);
			}
			if (sVar5 == LEGORR_ID_FULLSCREEN_RADIOBUTTON) {
				Setup_ChangeFullScreenMode(hDlg,1);
				return 1;
			}
			if ((sVar5 == IDOK) || (sVar5 == IDCANCEL)) {
				EndDialog(hDlg,wParam);
			}
		}
	}
	return 1;
}



void __cdecl lego::wnd::setup::Setup_ChangeFullScreenMode(HWND hDlg,BOOL isFullScreen)
{
	HWND hWnd;
	
	globals::g_IsFullScreen = isFullScreen;
	Setup_RebuildScreenModes(hDlg);
	hWnd = GetDlgItem(hDlg,LEGORR_ID_SCREENMODES_LABEL);
	if (isFullScreen != 0) {
		SendMessageA(hWnd,WM_SETTEXT,0,(LPARAM)"Screen Mode");
		return;
	}
	SendMessageA(hWnd,WM_SETTEXT,0,(LPARAM)"Window Size");
	return;
}



void __cdecl lego::wnd::setup::Setup_RebuildScreenModes(HWND hDlg)
{
	bool bVar1;
	HWND hCtrl_Screens;
	int iVar2;
	BOOL BVar3;
	HWND hCtrl_OK;
	ScreenMode *pSVar4;
	uint local_104;
	char unsupportedMessage [256];
	
	bVar1 = true;
	hCtrl_Screens = GetDlgItem(hDlg,LEGORR_ID_SCREENMODES_LISTBOX);
	iVar2 = SendMessageA(hCtrl_Screens,LB_DELETESTRING,0,0);
	while (iVar2 != -1) {
		iVar2 = SendMessageA(hCtrl_Screens,LB_DELETESTRING,0,0);
	}
	Dlg_PopulateScreenModes
						(globals::g_CurrentDriverMode,globals::g_IsFullScreen,globals::g_ScreenModes_TABLE,
						 (uint *)&globals::g_ScreenModes_COUNT);
	local_104 = 0;
	if (globals::g_ScreenModes_COUNT != 0) {
		pSVar4 = globals::g_ScreenModes_TABLE;
		do {
			BVar3 = Setup_HasRegisteredScreenMode(local_104);
			if ((BVar3 != 0) &&
				 (SendMessageA(hCtrl_Screens,LB_ADDSTRING,0,(LPARAM)pSVar4->displayName), bVar1)) {
				bVar1 = false;
				globals::g_CurrentScreenMode = pSVar4;
			}
			local_104 += 1;
			pSVar4 = pSVar4 + 1;
		} while (local_104 < (uint)globals::g_ScreenModes_COUNT);
	}
	hCtrl_OK = GetDlgItem(hDlg,IDOK);
	if (bVar1) {
		if (globals::g_IsFullScreen == 0) {
			iVar2 = Setup_GetDeviceBitsPerPixel();
			std::sprintf(unsupportedMessage,"No supported %i bit modes found",iVar2);
		}
		else {
			std::sprintf(unsupportedMessage,"No supported screen modes found");
		}
		SendMessageA(hCtrl_Screens,LB_ADDSTRING,0,(LPARAM)unsupportedMessage);
		BVar3 = 0;
	}
	else {
		BVar3 = 1;
	}
	EnableWindow(hCtrl_OK,BVar3);
	SendMessageA(hCtrl_Screens,LB_SETCURSEL,0,0);
	return;
}



void __cdecl lego::wnd::setup::Setup_RebuildDeviceModes(HWND hDlg)
{
	HWND hWnd;
	int iVar1;
	BOOL BVar2;
	WPARAM wParam;
	WPARAM WVar3;
	WPARAM local_4;
	
	local_4 = 0;
	hWnd = GetDlgItem(hDlg,LEGORR_ID_DEVICE_LISTBOX);
	iVar1 = SendMessageA(hWnd,LB_DELETESTRING,0,0);
	while (iVar1 != -1) {
		iVar1 = SendMessageA(hWnd,LB_DELETESTRING,0,0);
	}
	BVar2 = Dlg_PopulateDeviceModes
										(globals::g_CurrentDriverMode,globals::g_DeviceModes_TABLE,
										 (uint *)&globals::g_DeviceModes_COUNT);
	if (BVar2 != 0) {
		WVar3 = 0;
		wParam = 0;
		if (globals::g_DeviceModes_COUNT != 0) {
			iVar1 = 0x55a64c;
			do {
				if ((*(uint *)(iVar1 + 0x100) & 0x2000) != 0) {
					local_4 = WVar3;
				}
				SendMessageA(hWnd,LB_ADDSTRING,0,iVar1);
				WVar3 += 1;
				iVar1 += 0x114;
				wParam = local_4;
			} while (WVar3 < (uint)globals::g_DeviceModes_COUNT);
		}
		globals::g_CurrentDeviceMode = globals::g_DeviceModes_TABLE + wParam;
		SendMessageA(hWnd,LB_SETCURSEL,wParam,0);
		return;
	}
	SendMessageA(hWnd,LB_ADDSTRING,0,(LPARAM)"Error: DirectX6 not installed.");
	SendMessageA(hWnd,LB_SETCURSEL,0,0);
	return;
}



void __cdecl
lego::wnd::setup::Setup_RegisterScreenMode(int screenWidth,int screenHeight,int bitDepth)
{
	globals::g_RegisteredScreenModes_TABLE[globals::g_RegisteredScreenModes_COUNT].screenWidth =
			 screenWidth;
	globals::g_RegisteredScreenModes_TABLE[globals::g_RegisteredScreenModes_COUNT].screenHeight =
			 screenHeight;
	globals::g_RegisteredScreenModes_TABLE[globals::g_RegisteredScreenModes_COUNT].bitDepth = bitDepth
	;
	globals::g_RegisteredScreenModes_COUNT = globals::g_RegisteredScreenModes_COUNT + 1;
	return;
}



BOOL __cdecl lego::wnd::setup::Setup_HasRegisteredScreenMode(int availableIndex)
{
	int *piVar1;
	uint uVar2;
	
	if (globals::g_RegisteredScreenModes_COUNT == 0) {
		return 1;
	}
	uVar2 = 0;
	if (globals::g_RegisteredScreenModes_COUNT != 0) {
		piVar1 = &globals::g_RegisteredScreenModes_TABLE[0].screenHeight;
		do {
			if (((piVar1[-1] == 0) ||
					(piVar1[-1] == globals::g_ScreenModes_TABLE[availableIndex].screenWidth)) &&
				 ((*piVar1 == 0 || (*piVar1 == globals::g_ScreenModes_TABLE[availableIndex].screenHeight))))
			{
				if (piVar1[1] == 0) {
					return 1;
				}
				if (piVar1[1] == globals::g_ScreenModes_TABLE[availableIndex].bitDepth) {
					return 1;
				}
			}
			uVar2 += 1;
			piVar1 = piVar1 + 0x44;
		} while (uVar2 < (uint)globals::g_RegisteredScreenModes_COUNT);
	}
	return 0;
}



BOOL __cdecl lego::wnd::setup::Setup_GetScreenMode(char *displayName,uint *out_index)
{
	byte bVar1;
	byte *pbVar2;
	int iVar3;
	uint uVar4;
	byte *pbVar5;
	byte *pbVar6;
	bool bVar7;
	
	uVar4 = 0;
	if (globals::g_ScreenModes_COUNT == 0) {
		return 0;
	}
	pbVar2 = (byte *)globals::g_ScreenModes_TABLE[0].displayName;
	pbVar5 = (byte *)displayName;
	pbVar6 = pbVar2;
LAB_0049dc2b:
	do {
		bVar1 = *pbVar2;
		bVar7 = bVar1 < *pbVar5;
		if (bVar1 == *pbVar5) {
			if (bVar1 != 0) {
				bVar1 = pbVar2[1];
				bVar7 = bVar1 < pbVar5[1];
				if (bVar1 != pbVar5[1]) goto LAB_0049dc4f;
				pbVar2 = pbVar2 + 2;
				pbVar5 = pbVar5 + 2;
				if (bVar1 != 0) goto LAB_0049dc2b;
			}
			iVar3 = 0;
		}
		else {
LAB_0049dc4f:
			iVar3 = (1 - (uint)bVar7) - (uint)(bVar7 != 0);
		}
		if (iVar3 == 0) {
			*out_index = uVar4;
			return 1;
		}
		uVar4 += 1;
		pbVar2 = pbVar6 + 0x110;
		pbVar5 = (byte *)displayName;
		pbVar6 = pbVar2;
		if ((uint)globals::g_ScreenModes_COUNT <= uVar4) {
			return 0;
		}
	} while( true );
}



void __cdecl lego::wnd::setup::Setup_UpdateRadioButtons(HWND hDlg)
{
	HWND pHVar1;
	
	if ((*(byte *)&globals::g_CurrentDriverMode->flags & DRIVERMODE_NOGUID_20) == 0) {
		globals::g_IsFullScreen_Backup = globals::g_IsFullScreen;
		Setup_ChangeFullScreenMode(hDlg,1);
		pHVar1 = GetDlgItem(hDlg,LEGORR_ID_WINDOW_RADIOBUTTON);
		SendMessageA(pHVar1,BM_SETCHECK,0,0);
		EnableWindow(pHVar1,0);
		pHVar1 = GetDlgItem(hDlg,LEGORR_ID_FULLSCREEN_RADIOBUTTON);
		SendMessageA(pHVar1,BM_SETCHECK,1,0);
	}
	else {
		pHVar1 = GetDlgItem(hDlg,LEGORR_ID_WINDOW_RADIOBUTTON);
		EnableWindow(pHVar1,1);
		if (globals::g_IsFullScreen_Backup == 0) {
			Setup_ChangeFullScreenMode(hDlg,0);
			pHVar1 = GetDlgItem(hDlg,LEGORR_ID_FULLSCREEN_RADIOBUTTON);
			SendMessageA(pHVar1,BM_SETCHECK,0,0);
			pHVar1 = GetDlgItem(hDlg,LEGORR_ID_WINDOW_RADIOBUTTON);
			SendMessageA(pHVar1,BM_SETCHECK,1,0);
			return;
		}
	}
	return;
}



// Library Function - Single Match
// Name: __strnicmp
// Libraries: Visual Studio 1998 Debug, Visual Studio 1998 Release

int __cdecl std::_strnicmp(char *_Str1,char *_Str2,size_t _MaxCount)
{
	byte bVar1;
	byte bVar3;
	uint uVar2;
	uint uVar4;
	bool bVar5;
	
	if (_MaxCount != 0) {
		if (DAT_0054a180 == 0) {
			do {
				bVar3 = *_Str1;
				bVar1 = *_Str2;
				if ((bVar3 == 0) || (bVar1 == 0)) break;
				_Str1 = (char *)((byte *)_Str1 + 1);
				_Str2 = (char *)((byte *)_Str2 + 1);
				if ((0x40 < bVar3) && (bVar3 < 0x5b)) {
					bVar3 += 0x20;
				}
				if ((0x40 < bVar1) && (bVar1 < 0x5b)) {
					bVar1 += 0x20;
				}
				bVar5 = bVar3 < bVar1;
				if (bVar3 != bVar1) goto LAB_0049ddcb;
				_MaxCount -= 1;
			} while (_MaxCount != 0);
			_MaxCount = 0;
			bVar5 = bVar3 < bVar1;
			if (bVar3 != bVar1) {
LAB_0049ddcb:
				_MaxCount = 0xffffffff;
				if (!bVar5) {
					_MaxCount = 1;
				}
			}
		}
		else {
			uVar4 = 0;
			uVar2 = 0;
			do {
				uVar2 = uVar2 & 0xffffff00 | (uint)(byte)*_Str1;
				uVar4 = uVar4 & 0xffffff00 | (uint)(byte)*_Str2;
				if ((uVar2 == 0) || (uVar4 == 0)) break;
				_Str1 = (char *)((byte *)_Str1 + 1);
				_Str2 = (char *)((byte *)_Str2 + 1);
				uVar4 = FUN_00497890(uVar4);
				uVar2 = FUN_00497890(uVar2);
				bVar5 = uVar2 < uVar4;
				if (uVar2 != uVar4) goto LAB_0049de0d;
				_MaxCount -= 1;
			} while (_MaxCount != 0);
			_MaxCount = 0;
			bVar5 = uVar2 < uVar4;
			if (uVar2 != uVar4) {
LAB_0049de0d:
				_MaxCount = 0xffffffff;
				if (!bVar5) {
					_MaxCount = 1;
				}
			}
		}
	}
	return _MaxCount;
}



char * __cdecl std::itoa(int value,char *buffer,int radix)
{
	if ((radix == 10) && (value < 0)) {
		__itoa__internal(value,buffer,10,1);
		return buffer;
	}
	__itoa__internal(value,buffer,radix,0);
	return buffer;
}



void __cdecl std::__itoa__internal(int value,char *buffer,int radix,BOOL isNegative)
{
	ulonglong uVar1;
	char *pcVar2;
	char cVar3;
	char *pcVar4;
	
	pcVar2 = buffer;
	if (isNegative != 0) {
		*buffer = '-';
		buffer = buffer + 1;
		value = -value;
		pcVar2 = buffer;
	}
	do {
		pcVar4 = pcVar2;
		uVar1 = (ulonglong)(uint)value;
		value = (uint)value / (uint)radix;
		cVar3 = (char)(uVar1 % (ulonglong)(uint)radix);
		if ((uint)(uVar1 % (ulonglong)(uint)radix) < 10) {
			cVar3 += '0';
		}
		else {
			cVar3 += 'W';
		}
		*pcVar4 = cVar3;
		pcVar2 = pcVar4 + 1;
	} while (value != 0);
	pcVar4[1] = '\0';
	do {
		cVar3 = *pcVar4;
		*pcVar4 = *buffer;
		*buffer = cVar3;
		pcVar4 = pcVar4 + -1;
		buffer = buffer + 1;
	} while (buffer < pcVar4);
	return;
}



char * __cdecl std::_strlwr(char *str)
{
	char *pcVar1;
	char cVar2;
	char *pcVar3;
	uint uVar4;
	int iVar5;
	uint uVar6;
	LPWSTR buffer;
	undefined4 *puVar7;
	LPWSTR pWVar8;
	LPWSTR pWVar9;
	undefined4 *puVar10;
	
	buffer = NULL;
	if (DAT_0054a180 == 0) {
		pcVar3 = str;
		if (*str != '\0') {
			do {
				cVar2 = *str;
				if (('@' < cVar2) && (cVar2 < '[')) {
					*str = cVar2 + ' ';
				}
				pcVar1 = str + 1;
				str = str + 1;
			} while (*pcVar1 != '\0');
			return pcVar3;
		}
	}
	else {
		uVar4 = FUN_00493f60(DAT_0054a180,0x100,str,(LPCWSTR)0xffffffff,NULL,0,0);
		if (((uVar4 != 0) && (buffer = (LPWSTR)malloc(uVar4), buffer != NULL)) &&
			 (iVar5 = FUN_00493f60(DAT_0054a180,0x100,str,(LPCWSTR)0xffffffff,buffer,uVar4,0), iVar5 != 0)
			 ) {
			uVar4 = 0xffffffff;
			pWVar8 = buffer;
			do {
				pWVar9 = pWVar8;
				if (uVar4 == 0) break;
				uVar4 -= 1;
				pWVar9 = (LPWSTR)((int)pWVar8 + 1);
				cVar2 = *(char *)pWVar8;
				pWVar8 = pWVar9;
			} while (cVar2 != '\0');
			uVar4 = ~uVar4;
			puVar7 = (undefined4 *)((int)pWVar9 - uVar4);
			puVar10 = (undefined4 *)str;
			for (uVar6 = uVar4 >> 2; uVar6 != 0; uVar6 -= 1) {
				*puVar10 = *puVar7;
				puVar7 = puVar7 + 1;
				puVar10 = puVar10 + 1;
			}
			for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
				*(undefined *)puVar10 = *(undefined *)puVar7;
				puVar7 = (undefined4 *)((int)puVar7 + 1);
				puVar10 = (undefined4 *)((int)puVar10 + 1);
			}
		}
		free(buffer);
	}
	return str;
}



char * __cdecl std::_strupr(char *str)
{
	char *pcVar1;
	char cVar2;
	char *pcVar3;
	uint uVar4;
	int iVar5;
	uint uVar6;
	LPWSTR buffer;
	undefined4 *puVar7;
	LPWSTR pWVar8;
	LPWSTR pWVar9;
	undefined4 *puVar10;
	
	buffer = NULL;
	if (DAT_0054a180 == 0) {
		pcVar3 = str;
		if (*str != '\0') {
			do {
				cVar2 = *str;
				if (('`' < cVar2) && (cVar2 < '{')) {
					*str = cVar2 + -0x20;
				}
				pcVar1 = str + 1;
				str = str + 1;
			} while (*pcVar1 != '\0');
			return pcVar3;
		}
	}
	else {
		uVar4 = FUN_00493f60(DAT_0054a180,0x200,str,(LPCWSTR)0xffffffff,NULL,0,0);
		if (((uVar4 != 0) && (buffer = (LPWSTR)malloc(uVar4), buffer != NULL)) &&
			 (iVar5 = FUN_00493f60(DAT_0054a180,0x200,str,(LPCWSTR)0xffffffff,buffer,uVar4,0), iVar5 != 0)
			 ) {
			uVar4 = 0xffffffff;
			pWVar8 = buffer;
			do {
				pWVar9 = pWVar8;
				if (uVar4 == 0) break;
				uVar4 -= 1;
				pWVar9 = (LPWSTR)((int)pWVar8 + 1);
				cVar2 = *(char *)pWVar8;
				pWVar8 = pWVar9;
			} while (cVar2 != '\0');
			uVar4 = ~uVar4;
			puVar7 = (undefined4 *)((int)pWVar9 - uVar4);
			puVar10 = (undefined4 *)str;
			for (uVar6 = uVar4 >> 2; uVar6 != 0; uVar6 -= 1) {
				*puVar10 = *puVar7;
				puVar7 = puVar7 + 1;
				puVar10 = puVar10 + 1;
			}
			for (uVar4 &= 3; uVar4 != 0; uVar4 -= 1) {
				*(undefined *)puVar10 = *(undefined *)puVar7;
				puVar7 = (undefined4 *)((int)puVar7 + 1);
				puVar10 = (undefined4 *)((int)puVar10 + 1);
			}
		}
		free(buffer);
	}
	return str;
}



void Unwind_0049e050(void)
{
	int unaff_EBP;
	
	FUN_0045ddb0(*(undefined **)(unaff_EBP + -0x210));
	return;
}



void Unwind_0049e05e(void)
{
	int unaff_EBP;
	
	FUN_0045ddb0(*(undefined **)(unaff_EBP + -0x210));
	return;
}



void Unwind_0049e080(void)
{
	int unaff_EBP;
	
	FUN_0045ddb0(*(undefined **)(unaff_EBP + 4));
	return;
}



void Unwind_0049e0a0(void)
{
	int unaff_EBP;
	
	FUN_0045ddb0(*(undefined **)(unaff_EBP + -0x10));
	return;
}


